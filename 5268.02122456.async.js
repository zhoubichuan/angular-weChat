(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5268],{64335:function(Tn,me,se){"use strict";var De=se(67294),he=(0,De.createContext)({});me.Z=he},21349:function(Tn,me,se){"use strict";var De=se(84305),he=se(39559),y=se(85893),Pe=se(94184),q=se.n(Pe),Ce=se(67294),pe=se(64335),Ke=se(53645),Se=se.n(Ke),ot=function(bt){var Dt=(0,Ce.useContext)(pe.Z),_r=bt.children,Nt=bt.contentWidth,gr=bt.className,Qt=bt.style,Pt=(0,Ce.useContext)(he.ZP.ConfigContext),Ft=Pt.getPrefixCls,xr=bt.prefixCls||Ft("pro"),ee=Nt||Dt.contentWidth,sr="".concat(xr,"-grid-content");return(0,y.jsx)("div",{className:q()(sr,gr,{wide:ee==="Fixed"}),style:Qt,children:(0,y.jsx)("div",{className:"".concat(xr,"-grid-content-children"),children:_r})})};me.Z=ot},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Tn){try{let Se=function(){q||(q=!0,y())},ot=function(){try{Pe.documentElement.doScroll("left")}catch(mt){return void setTimeout(ot,50)}Se()};var pe=Se,Ke=ot,me=(me=document.getElementsByTagName("script"))[me.length-1],se=me.getAttribute("data-injectcss"),me=me.getAttribute("data-disable-injectsvg");if(!me){var De,he,y,Pe,q,Ce=function(bt,Dt){Dt.parentNode.insertBefore(bt,Dt)};if(se&&!Tn.__iconfont__svg__cssinject__){Tn.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(mt){console&&console.log(mt)}}De=function(){var bt,Dt=document.createElement("div");Dt.innerHTML=Tn._iconfont_svg_string_3580659,(Dt=Dt.getElementsByTagName("svg")[0])&&(Dt.setAttribute("aria-hidden","true"),Dt.style.position="absolute",Dt.style.width=0,Dt.style.height=0,Dt.style.overflow="hidden",Dt=Dt,(bt=document.body).firstChild?Ce(Dt,bt.firstChild):bt.appendChild(Dt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(De,0):(he=function(){document.removeEventListener("DOMContentLoaded",he,!1),De()},document.addEventListener("DOMContentLoaded",he,!1)):document.attachEvent&&(y=De,Pe=Tn.document,q=!1,ot(),Pe.onreadystatechange=function(){Pe.readyState=="complete"&&(Pe.onreadystatechange=null,Se())})}}catch(Se){}}(window)},41537:function(Tn,me,se){"use strict";se.d(me,{zP:function(){return bP},JE:function(){return AI},ns:function(){return xP}});var De={};se.r(De),se.d(De,{add:function(){return Uh},adjoint:function(){return Xi},clone:function(){return Yn},copy:function(){return An},create:function(){return tn},determinant:function(){return Li},equals:function(){return ph},exactEquals:function(){return jh},frob:function(){return hh},fromQuat:function(){return Ds},fromQuat2:function(){return Ss},fromRotation:function(){return hs},fromRotationTranslation:function(){return Ro},fromRotationTranslationScale:function(){return da},fromRotationTranslationScaleOrigin:function(){return cu},fromScaling:function(){return fs},fromTranslation:function(){return So},fromValues:function(){return ti},fromXRotation:function(){return Ws},fromYRotation:function(){return Es},fromZRotation:function(){return Xs},frustum:function(){return no},getRotation:function(){return Fa},getScaling:function(){return Ua},getTranslation:function(){return ea},identity:function(){return Bi},invert:function(){return zn},lookAt:function(){return kc},mul:function(){return sd},multiply:function(){return Ni},multiplyScalar:function(){return Vh},multiplyScalarAndAdd:function(){return od},ortho:function(){return Mc},orthoNO:function(){return Fu},orthoZO:function(){return Uo},perspective:function(){return Is},perspectiveFromFieldOfView:function(){return Tc},perspectiveNO:function(){return Zo},perspectiveZO:function(){return Sa},rotate:function(){return fo},rotateX:function(){return ho},rotateY:function(){return po},rotateZ:function(){return qa},scale:function(){return aa},set:function(){return In},str:function(){return Zh},sub:function(){return ud},subtract:function(){return Ic},targetTo:function(){return Rl},translate:function(){return qn},transpose:function(){return yi}});var he=se(67294),y=(0,he.createContext)({});function Pe(){return(0,he.useContext)(y)}var q={},Ce={},pe=function(i){return Ce[i]},Ke=function(i,r){Ce[i]=r},Se=function(i){return q[i]},ot=function(i,r){q[i]=r},mt={},bt={},Dt=34,_r=10,Nt=13;function gr(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Qt(e,i){var r=gr(e);return function(n,t){return i(r(n),t,e)}}function Pt(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function Ft(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function xr(e){return e<0?"-"+Ft(-e,6):e>9999?"+"+Ft(e,6):Ft(e,4)}function ee(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":xr(e.getUTCFullYear(),4)+"-"+Ft(e.getUTCMonth()+1,2)+"-"+Ft(e.getUTCDate(),2)+(t?"T"+Ft(i,2)+":"+Ft(r,2)+":"+Ft(n,2)+"."+Ft(t,3)+"Z":n?"T"+Ft(i,2)+":"+Ft(r,2)+":"+Ft(n,2)+"Z":r||i?"T"+Ft(i,2)+":"+Ft(r,2)+"Z":"")}function sr(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(E,C){var T,O,L=t(E,function(B,V){if(T)return T(B,V-1);O=B,T=C?Qt(B,C):gr(B)});return L.columns=O||[],L}function t(E,C){var T=[],O=E.length,L=0,B=0,V,ne=O<=0,ie=!1;E.charCodeAt(O-1)===_r&&--O,E.charCodeAt(O-1)===Nt&&--O;function ke(){if(ne)return bt;if(ie)return ie=!1,mt;var ut,St=L,Lt;if(E.charCodeAt(St)===Dt){for(;L++<O&&E.charCodeAt(L)!==Dt||E.charCodeAt(++L)===Dt;);return(ut=L)>=O?ne=!0:(Lt=E.charCodeAt(L++))===_r?ie=!0:Lt===Nt&&(ie=!0,E.charCodeAt(L)===_r&&++L),E.slice(St+1,ut-1).replace(/""/g,'"')}for(;L<O;){if((Lt=E.charCodeAt(ut=L++))===_r)ie=!0;else if(Lt===Nt)ie=!0,E.charCodeAt(L)===_r&&++L;else if(Lt!==r)continue;return E.slice(St,ut)}return ne=!0,E.slice(St,O)}for(;(V=ke())!==bt;){for(var Fe=[];V!==mt&&V!==bt;)Fe.push(V),V=ke();C&&(Fe=C(Fe,B++))==null||T.push(Fe)}return T}function o(E,C){return E.map(function(T){return C.map(function(O){return x(T[O])}).join(e)})}function u(E,C){return C==null&&(C=Pt(E)),[C.map(x).join(e)].concat(o(E,C)).join(`
`)}function l(E,C){return C==null&&(C=Pt(E)),o(E,C).join(`
`)}function p(E){return E.map(v).join(`
`)}function v(E){return E.map(x).join(e)}function x(E){return E==null?"":E instanceof Date?ee(E):i.test(E+="")?'"'+E.replace(/"/g,'""')+'"':E}return{parse:n,parseRows:t,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var Tt=sr(","),ht=Tt.parse,jt=Tt.parseRows,dt=Tt.format,lr=Tt.formatBody,jr=Tt.formatRows,ue=Tt.formatRow,He=Tt.formatValue,W=se(85061),Y=se(28991),Re=se(38163),gt=se.n(Re),wt=63710088e-1,qt={centimeters:wt*100,centimetres:wt*100,degrees:wt/111325,feet:wt*3.28084,inches:wt*39.37,kilometers:wt/1e3,kilometres:wt/1e3,meters:wt,metres:wt,miles:wt/1609.344,millimeters:wt*1e3,millimetres:wt*1e3,nauticalmiles:wt/1852,radians:1,yards:wt*1.0936},fr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/wt,yards:1.0936133},br={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function bn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function en(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return Ci(i).geometry;case"LineString":return Si(i).geometry;case"Polygon":return Vn(i).geometry;case"MultiPoint":return _i(i).geometry;case"MultiLineString":return zi(i).geometry;case"MultiPolygon":return $n(i).geometry;default:throw new Error(e+" is invalid")}}function Ci(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wt(e[0])||!Wt(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return bn(n,i,r)}function Wn(e,i,r){return r===void 0&&(r={}),Vi(e.map(function(n){return Ci(n,i)}),r)}function Vn(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return bn(l,i,r)}function va(e,i,r){return r===void 0&&(r={}),Vi(e.map(function(n){return Vn(n,i)}),r)}function Si(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return bn(n,i,r)}function ci(e,i,r){return r===void 0&&(r={}),Vi(e.map(function(n){return Si(n,i)}),r)}function Vi(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function zi(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return bn(n,i,r)}function _i(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return bn(n,i,r)}function $n(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return bn(n,i,r)}function ii(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return bn(n,i,r)}function Co(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Ba(e,i){i===void 0&&(i="kilometers");var r=qt[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ya(e,i){i===void 0&&(i="kilometers");var r=qt[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Et(e,i){return ae(ya(e,i))}function de(e){var i=e%360;return i<0&&(i+=360),i}function ae(e){var i=e%(2*Math.PI);return i*180/Math.PI}function xe(e){var i=e%360;return i*Math.PI/180}function N(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Ba(ya(e,i),r)}function Qe(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=br[i];if(!n)throw new Error("invalid original units");var t=br[r];if(!t)throw new Error("invalid final units");return e/n*t}function Wt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Dr(e){return!!e&&e.constructor===Object}function qe(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Wt(i))throw new Error("bbox must only contain numbers")})}function kt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function hr(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Hr(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Hr(e[0]);throw new Error("coordinates must only contain numbers")}function qr(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Hn(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Bn(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function Kr(e){return e.type==="Feature"?e.geometry:e}function fi(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ri(e,i,r){if(e!==null)for(var n,t,o,u,l,p,v,x=0,E=0,C,T=e.type,O=T==="FeatureCollection",L=T==="Feature",B=O?e.features.length:1,V=0;V<B;V++){v=O?e.features[V].geometry:L?e.geometry:e,C=v?v.type==="GeometryCollection":!1,l=C?v.geometries.length:1;for(var ne=0;ne<l;ne++){var ie=0,ke=0;if(u=C?v.geometries[ne]:v,u!==null){p=u.coordinates;var Fe=u.type;switch(x=r&&(Fe==="Polygon"||Fe==="MultiPolygon")?1:0,Fe){case null:break;case"Point":if(i(p,E,V,ie,ke)===!1)return!1;E++,ie++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],E,V,ie,ke)===!1)return!1;E++,Fe==="MultiPoint"&&ie++}Fe==="LineString"&&ie++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],E,V,ie,ke)===!1)return!1;E++}Fe==="MultiLineString"&&ie++,Fe==="Polygon"&&ke++}Fe==="Polygon"&&ie++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(ke=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],E,V,ie,ke)===!1)return!1;E++}ke++}ie++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(ri(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function sa(e,i,r,n){var t=r;return ri(e,function(o,u,l,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,l,p,v)},n),t}function wa(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Na(e,i,r){var n=r;return wa(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function _a(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function ra(e,i,r){var n=r;return _a(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function K(e){var i=[];return ri(e,function(r){i.push(r)}),i}function re(e,i){var r,n,t,o,u,l,p,v,x,E,C=0,T=e.type==="FeatureCollection",O=e.type==="Feature",L=T?e.features.length:1;for(r=0;r<L;r++){for(l=T?e.features[r].geometry:O?e.geometry:e,v=T?e.features[r].properties:O?e.properties:{},x=T?e.features[r].bbox:O?e.bbox:void 0,E=T?e.features[r].id:O?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,t=0;t<u;t++){if(o=p?l.geometries[t]:l,o===null){if(i(null,C,v,x,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,C,v,x,E)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],C,v,x,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function fe(e,i,r){var n=r;return re(e,function(t,o,u,l,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,l,p)}),n}function we(e,i){re(e,function(r,n,t,o,u){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(bn(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],E={type:p,coordinates:x};if(i(bn(E,t),n,v)===!1)return!1}})}function Ze(e,i,r){var n=r;return we(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function tt(e,i){we(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(ri(r,function(E,C,T,O,L){if(l===void 0||n>p||O>v||L>x){l=E,p=n,v=O,x=L,o=0;return}var B=lineString([l,E],r.properties);if(i(B,n,t,L,o)===!1)return!1;o++,l=E})===!1)return!1}}})}function pt(e,i,r){var n=r,t=!1;return tt(e,function(o,u,l,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,l,p,v),t=!0}),n}function _e(e,i){if(!e)throw new Error("geojson is required");we(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],r.properties),n,t,l)===!1)return!1;break}}})}function We(e,i,r){var n=r;return _e(e,function(t,o,u,l){o===0&&r===void 0?n=t:n=i(n,t,o,u,l)}),n}function Bt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function Rr(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}function Kt(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(V){return V[l]&&V[l].type&&V[l].coordinates&&V[l].coordinates.length>0}).forEach(function(V,ne){var ie=gt()((0,Y.Z)({},V[l]),!0);we(ie,function(ke){var Fe=kr(ke),ut=(0,Y.Z)((0,Y.Z)({},V),{},{_id:ne,coordinates:Fe});p.push(ut)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],E=[];if(u){var C="Polygon";Array.isArray(u[0])||(C="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(C="LineString");var T=gt()({type:C,coordinates:(0,W.Z)(x[u])},!0);E=T.coordinates}else if(r&&n&&t&&o){var O=[parseFloat(x[r]),parseFloat(x[n])],L=[parseFloat(x[t]),parseFloat(x[o])];E=[O,L]}else r&&n&&(E=[parseFloat(x[r]),parseFloat(x[n])]);var B=(0,Y.Z)((0,Y.Z)({},x),{},{_id:v,coordinates:E});p.push(B)}return{dataArray:p}}function er(e,i){var r=ht(e);return Kt(r,i)}function Or(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function On(e,i){return i===void 0?null:e.properties[i]?e.properties[i]:e.properties&&e.properties[i]?Or(e.properties[i]+"")%1000019:null}function Cn(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),gt()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(we(e,function(t,o){var u=On(t,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=kr(t),v=(0,Y.Z)((0,Y.Z)({},t.properties),{},{coordinates:p,_id:l});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function Gt(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function En(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var nr=se(28481),yt=se(96486),xi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function dn(e){this.message=e}dn.prototype=new Error,dn.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new dn("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,t,o,u=0;o=i.charAt(u++);~o&&(t=n%4?t*64+o:o,n++%4)?r+=String.fromCharCode(255&t>>(-2*n&6)):0)o=xi.indexOf(o);return r}function ua(e){e=String(e);for(var i,r,n,t,o="",u=0,l=e.length%3;u<e.length;){if((r=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(t=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|t,o+=xi.charAt(i>>18&63)+xi.charAt(i>>12&63)+xi.charAt(i>>6&63)+xi.charAt(i&63)}return l?o.slice(0,l-3)+"===".substring(l):o}var vt=se(6610),_t=se(5991),Ii=function(){function e(i,r){(0,vt.Z)(this,e),this.buffers=i,this.type=r}return(0,_t.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,t){throw new Error("not implemented")}}]),e}(),ui,Ki=function(){return ui||(ui=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof se.g!="undefined"?se.g:{})};ui=Ki();var Qi;typeof window=="undefined"?Qi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Qi=window;var la=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fi=la?my.getSystemInfoSync().pixelRatio:Qi.devicePixelRatio,pr=se(10379),wr=se(46070),Ye=se(77608),Ma=(0,_t.Z)(function e(i,r){(0,vt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),Le=se(63349);function ws(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=is(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function is(e,i){if(!!e){if(typeof e=="string")return na(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return na(e,i)}}function na(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Bs=new WeakMap,Qa=function(){function e(){(0,vt.Z)(this,e),Bs.set(this,{})}return(0,_t.Z)(e,[{key:"addEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bs.get(this);o||(o={}),o[r]||(o[r]=[]),o[r].push(n),Bs.set(this,o),t.capture,t.once,t.passive}},{key:"removeEventListener",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bs.get(this);if(o){var u=o[r];if(u&&u.length>0){for(var l=u.length;l--;l>0)if(u[l]===n){u.splice(l,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Bs.get(this)[r.type];if(n){var t=ws(n),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u(r)}}catch(l){t.e(l)}finally{t.f()}}}}]),e}();function Ga(e){var i=Ja();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ca=function(e){(0,pr.Z)(r,e);var i=Ga(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.childNodes=[],n}return(0,_t.Z)(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var o=this.childNodes.findIndex(function(u){return u===t});return o>-1?this.childNodes.splice(o,1):null}}]),r}(Qa);function jo(e){var i=Ko();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Su=function(e){(0,pr.Z)(r,e);var i=jo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n}return(0,_t.Z)(r,[{key:"setAttribute",value:function(t,o){this[t]=o}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,o){this[t]=o}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(ca),Ao=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,To,fa,eo,Go;if(Ao){var Wa=my.getSystemInfoSync();To=Wa.screenWidth,fa=Wa.screenHeight,eo=Wa.windowWidth,Go=Wa.windowHeight}else{var Ys=Qi.innerWidth,Dl=Qi.innerHeight;To=Ys,fa=Dl,eo=Ys,Go=Dl}var Qo={width:To,height:fa,availWidth:eo,availHeight:Go,availLeft:0,availTop:0},ce=Qo.availWidth,Ie=Qo.availHeight,ft={style:[]};function Xt(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return ft}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return ft}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Yr(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ce+"px",height:Ie+"px",margin:"0px",padding:"0px"})}function jn(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ce,e.clientHeight=Ie),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Di(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ce,e.offsetHeight=Ie)}function so(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ce,e.scrollHeight=Ie)}function za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Xa(e){var i=Jo();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Oo(){}var vo=function(e){(0,pr.Z)(r,e);var i=Xa(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,vt.Z)(this,r),n=i.call(this),n.className="",n.children=[],n.focus=Oo,n.blur=Oo,n.insertBefore=Oo,n.appendChild=Oo,n.removeChild=Oo,n.remove=Oo,n.innerHTML="",n.tagName=t.toUpperCase(),Xt((0,Le.Z)(n),o),Yr((0,Le.Z)(n)),za((0,Le.Z)(n)),jn((0,Le.Z)(n)),Di((0,Le.Z)(n)),so((0,Le.Z)(n)),n}return(0,_t.Z)(r)}(Su);function Cs(e){var i=As();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function As(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ts=function(e){(0,pr.Z)(r,e);var i=Cs(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,_t.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(vo);function qs(e){var i=hu();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function hu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ds=function(e){(0,pr.Z)(r,e);var i=qs(r);function r(){return(0,vt.Z)(this,r),i.call(this,"video")}return(0,_t.Z)(r)}(Ts),Zi={},Ia={};function Bc(e,i){Zi=e,Zi.id=i,"tagName"in Zi||(Zi.tagName="CANVAS"),Zi.type="canvas",Mixin.parentNode(Zi),Mixin.style(Zi),Mixin.classList(Zi),Mixin.clientRegion(Zi),Mixin.offsetRegion(Zi),Zi.focus=function(){},Zi.blur=function(){}}function hf(e,i){var r=1024,n=1024;Ia={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Ia||(Ia.tagName="CANVAS"),Mixin.parentNode(Ia),Mixin.style(Ia),Mixin.classList(Ia),Mixin.clientRegion(Ia),Mixin.offsetRegion(Ia),Ia.getContext=function(t){if(t==="2d")return e},Ia.focus=function(){},Ia.blur=function(){}}function Ms(){return Zi}function pf(){return Ia}var hl=(0,_t.Z)(function e(){(0,vt.Z)(this,e);var i=Ms(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Xt(r),za(r),Object.assign(r,{addEventListener:function(t,o){r["on".concat(t)]=o.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r}),Qu={href:"",protocol:"",host:""};function Ks(e){var i=Bl();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b=function(e){(0,pr.Z)(r,e);var i=Ks(r);function r(){return(0,vt.Z)(this,r),i.call(this,"body",0)}return(0,_t.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o,u){}},{key:"dispatchEvent",value:function(t){}}]),r}(vo),k=function(e){(0,pr.Z)(r,e);var i=Ks(r);function r(){return(0,vt.Z)(this,r),i.call(this,"html",0)}return(0,_t.Z)(r,[{key:"addEventListener",value:function(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(t,o){}},{key:"dispatchEvent",value:function(t){}}]),r}(vo),z={},R={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Qu,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new hl:i==="video"?new ds:new vo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){z[i]||(z[i]=[]),z[i].push(r)},removeEventListener:function(i,r){var n=z[i];if(n&&n.length>0){for(var t=n.length;t--;t>0)if(n[t]===r){n.splice(t,1);break}}},dispatchEvent:function(i){var r=i.type,n=z[r];if(n)for(var t=0;t<n.length;t++)n[t](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Ma(i)}};R.documentElement=new k,R.head=new vo("head"),R.body=new b;var te=Object,Me=se(90484),st=function(){function e(){(0,vt.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Me.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,_t.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Rt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ot,yr,Lr;if(Rt){var Gn=my.getSystemInfoSync();Ot=Gn.system,yr=Gn.platform,Lr=Gn.language}else{var Qn={versions:function(){var e=Qi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Qi.navigator.browserLanguage||Qi.navigator.language).toLowerCase()};Qn.versions.android?yr="android":Qn.versions.trident?yr="IE":Qn.versions.presto?yr="Opera":Qn.versions.webKit?yr="webKit":Qn.versions.gecko?yr="Firefox":Qn.versions.mobile?yr="mobile":Qn.versions.ios?yr="ios":Qn.versions.iPhone?yr="iPhone":Qn.versions.iPad?yr="ipad":Qn.versions.webApp?yr="webApp":Qn.versions.weixin?yr="weixin":Qn.versions.qq&&(yr="qq"),Ot=Qi.navigator.userAgent,Lr=Qn.language}var pi=Ot.toLowerCase().indexOf("android")!==-1,$i=pi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ca="Mozilla/5.0 (".concat($i,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Lr),Ra={platform:yr,language:Lr,appVersion:"5.0 (".concat($i,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ca},Yi={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},vs=0,pu=0;function pl(e){var i=Date.now(),r=Math.max(vs+23,i);return pu=setTimeout(function(){e(vs=r)},r-i),pu}function df(e){var i=Ms();return i.requestAnimationFrame?i.requestAnimationFrame(e):pl(e)}function dl(e){var i=Ms();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Nc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,vt.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,_t.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],t=r.type,o=Nu(n),u="data:".concat(t,";base64, ");return u+o}}]),e}();function Nu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,t=0;t<n;t++)i+=String.fromCharCode(r[t]);return ua(i)}var zu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Zu={};function mo(e){var i=Xf();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Xf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zc=new Map,ms=new Map,vf=new Map,Ju={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Qs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function $f(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Qs.call(this,"readystatechange",i)}var Ns=function(e){(0,pr.Z)(r,e);var i=mo(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,zc.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,_t.Z)(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=vf.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=ms.get("responseHeader");return Object.keys(t).map(function(o){return"".concat(o,": ").concat(t[o])}).join(`
`)}},{key:"getResponseHeader",value:function(t){return ms.get("responseHeader")[t]}},{key:"open",value:function(t,o,u){this._method=t,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(t,o){var u=zc.get("requestHeader");u[t]=o,zc.set("requestHeader",u)}},{key:"addEventListener",value:function(t,o){var u=this;typeof o=="function"&&(this["on"+t]=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};l.target=l.target||u,o.call(u,l)})}},{key:"removeEventListener",value:function(t,o){this["on"+t]===o&&(this["on"+t]=null)}}]),r}(Qa);Ns.UNSEND=0,Ns.OPENED=1,Ns.HEADERS_RECEIVED=2,Ns.LOADING=3,Ns.DONE=4;function ka(e){var i=Nl();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ah=function(e){(0,pr.Z)(r,e);var i=ka(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.touches=[],t.targetTouches=[],t.changedTouches=[],t.target=Ms(),t.currentTarget=Ms(),t}return(0,_t.Z)(r)}(Ma);function Uu(e){var i=e||{},r=i.x,n=r===void 0?0:r,t=i.y,o=t===void 0?0:t,u=i.clientX,l=u===void 0?0:u,p=i.clientY,v=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=l,e.y=v)}function Zc(e){return function(i){var r=new Ah(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Uu(n)}),r.touches.forEach(function(n){return Uu(n)}),r.targetTouches.forEach(function(n){return Uu(n)}),R.dispatchEvent(r)}}function up(e){return function(i){i.type=e,R.dispatchEvent(i)}}var lp=Zc("touchstart"),Yf=Zc("touchmove"),Uc=Zc("touchend"),fc=up("mapCameaParams");function zl(e){var i=Zl();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Zl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vl=function(e){(0,pr.Z)(r,e);var i=zl(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),t.target=Ms(),t.currentTarget=Ms(),t}return(0,_t.Z)(r)}(Ma),ml=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],gl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Js="touch";function mf(e,i,r){for(var n=new vl(e),t=0;t<ml.length;t++){var o=ml[t];n[o]=i[o]||gl[t]}return n.type=e,n.target=Ms(),n.currentTarget=Ms(),n.buttons=gf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=yl(i),n.pointerType=Js,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function gf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Ul=null;function yl(e){return Ul===e.identifier}function hc(e){Ul===null&&(Ul=e.identifier)}function Vc(e){Ul===e.identifier&&(Ul=null)}function pc(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var t=r[n];n===0&&e==="pointerdown"?hc(t):(e==="pointerup"||e==="pointercancel")&&Vc(t);var o=mf(e,t,i);R.dispatchEvent(o)}}}var yf=pc("pointerdown"),cp=pc("pointermove"),_f=pc("pointerup");function _l(e){var i=xf();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function xf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qf=function(e){(0,pr.Z)(r,e);var i=_l(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,_t.Z)(r)}(Ma);function Vu(e){return function(i){i.type=e,R.dispatchEvent(i)}}var Th=Vu("mousedown"),Mh=Vu("mousemove"),kh=Vu("mouseup"),Vl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ih=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),es=Vl||Ih,$a={atob:Pi,btoa:ua,devicePixelRatio:Fi,Blob:Ii,document:R,Element:Su,Event:Ma,EventTarget:Qa,HTMLCanvasElement:te,HTMLElement:vo,HTMLMediaElement:Ts,HTMLVideoElement:ds,Image:hl,ImageData:st,navigator:Ra,Node:ca,requestAnimationFrame:df,cancelAnimationFrame:dl,screen:Qo,XMLHttpRequest:Ns,performance:Yi,URL:Nc,WebGLRenderingContext:zu,WebGL2RenderingContext:Zu,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};R.addEventListener(i,r,n)},removeEventListener:function(i,r,n){R.removeEventListener(i,r)},dispatchEvent:function(i){R.dispatchEvent(i)},innerWidth:Qo.availWidth,innerHeight:Qo.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ha=es?$a:Qi,jl=es?Ns:Qi.XMLHttpRequest,el=es?Qu:Qi.location;function Hi(e){var i=e;return typeof e=="string"&&(i=ha.document.getElementById(e)),i}function Oa(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ps(e){return Oa(e).split(/\s+/)}function jc(e){var i,r,n=ha==null||(i=ha.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var t in e)if(e[t]&&e[t]in n)return e[t];return e[0]}function Ri(e,i,r){var n=ha.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function gs(e){var i=e.parentNode;i&&i.removeChild(e)}function wu(e,i){if(e.classList!==void 0)for(var r=Ps(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!Gc(e,i)){var o=Cu(e);dc(e,(o?o+" ":"")+i)}}function Gl(e,i){e.classList!==void 0?e.classList.remove(i):dc(e,Oa((" "+Cu(e)+" ").replace(" "+i+" "," ")))}function Gc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Cu(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function dc(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Cu(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ho(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var vc=jc(["transform","WebkitTransform"]);function Hl(e,i){e.style[vc]=i}function Mo(){if(typeof Event=="function")ha.dispatchEvent(new Event("resize"));else{var e=ha.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ha,0),ha.dispatchEvent(e)}}function Ln(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function uo(){var e,i=ha.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,nr.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var La=uo()<1?1:ha.devicePixelRatio;function xl(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function eu(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function zs(e,i){var r,n=eu((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=eu(i),o=yt.pull.apply(void 0,[n].concat((0,W.Z)(t)));e.setAttribute("style",o.join(";"))}function bf(e){return Object.entries(e).map(function(i){var r=(0,nr.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function hn(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function mc(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function bl(e){e.innerHTML=""}function tl(e){e.setAttribute("draggable","false")}function xa(e,i){if(typeof i=="string"){var r=document.createElement("div");for(r.innerHTML=i;r.firstChild;)e.append(r.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,W.Z)(i)):e.append(i)}function Rs(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Hc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Au(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Os(e){if(e.length===0)throw new Error("mean requires at least one data point");return Au(e)/e.length}function ju(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var Ef={min:Hc,max:Rs,mean:Os,sum:Au,mode:ju};function Wl(e,i){return e.map(function(r){return r[i]})}function Kf(e,i){return Ef[e](i)}var Sf=se(14665);function tu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Zs=se(51814);function Oi(e,i,r){return(0,Zs.Z)()?Oi=Reflect.construct.bind():Oi=function(t,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(t,l),v=new p;return u&&(0,Sf.Z)(v,u.prototype),v},Oi.apply(null,arguments)}function ru(e){var i=typeof Map=="function"?new Map:void 0;return ru=function(n){if(n===null||!tu(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return Oi(n,arguments,(0,Ye.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,Sf.Z)(t,n)},ru(e)}function du(e){var i=ts();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var El=function(e){(0,pr.Z)(r,e);var i=du(r);function r(n,t,o,u){var l;return(0,vt.Z)(this,r),l=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=t,l.url=o,l.body=u,l}return(0,_t.Z)(r)}(ru(Error));function rl(e,i){var r=new jl,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(l){return i(l)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new El(r.status,r.statusText,n.toString(),u))}},r.send(e.body),r}function Us(e){return new Promise(function(i,r){rl(e,function(n,t,o,u,l){n?r({err:n,data:null,xhr:l}):i({err:null,data:t,cacheControl:o,expires:u,xhr:l})})})}function as(e,i){return rl(e,i)}var vu=function(i,r){return as((0,Y.Z)((0,Y.Z)({},i),{},{type:"json"}),r)},Xn=function(i,r){return as((0,Y.Z)((0,Y.Z)({},i),{},{type:"arrayBuffer"}),r)},Un=function(i,r){return as(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function wf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function mu(e,i){var r=new ha.Image,n=ha.URL||ha.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=os})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):os}function rs(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var nu=function(i,r,n){var t=function(u,l){if(u)r(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?rs(v,r):mu(v,r)}};return i.type==="json"?vu(i,t):Xn(i,t)};function gc(e){return typeof e=="number"}function Xl(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return ri(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}Xl.default=Xl;var ba=Xl,Pa=2*Math.PI*6378137/2;function Qf(e,i){var r=(0,nr.Z)(i,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function $l(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;gu(i,n)}),i}function gu(e,i){return Array.isArray(i[0])?i.forEach(function(r){gu(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Gu(e,i){return Lo(e,i)}function Lo(e,i){return Array.isArray(e[0])?e.map(function(r){return Lo(r,i)}):i(e)}function Tu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=yc(e,i);var n=e[0],t=e[1],o=n*Pa/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Pa/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Hu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Pa*180,o=n/Pa*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function Wc(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Yl(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function yc(e,i){if(i===!1)return e;var r=Wc(e[0]),n=Yl(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Fo(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(l*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function Xc(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=l/t;return[x,v]}function _c(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function Ph(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function Sl(e,i,r){var n=xe(i[1]-e[1]),t=xe(i[0]-e[0]),o=xe(e[1]),u=xe(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Ba(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function ql(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function nl(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Wu(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function ks(e){return[[e[0],e[1]],[e[2],e[3]]]}function $c(e){var i=xc(e,[0,0]);return[e[0]/i,e[1]/i]}function xc(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Jf(e,i){return e[0]*i[0]+e[1]*i[1]}function Kl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function f(e,i){return Math.acos(Jf(e,i)/(Kl(e)*Kl(i)))*180/Math.PI}function d(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function h(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=xc(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=d(r,v);if(o>0){var E=t[o-1].rotation;E-x>360-E+x&&(x=x+360)}t.push({start:u,end:l,dis:p,rotation:x,duration:0})}return t.map(function(C){C.duration=i*(C.dis/n)}),t}}function g(e){if(gc(e[0]))return e;if(gc(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(gc(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function w(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function M(e){return ba(Vi([Si(e)]))}var I=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,vt.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,_t.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function F(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var j=null,J=se(2650);function ye(e){return typeof e=="string"?!!d3.color(e):!1}function le(e){var i=J.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ee(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function Ue(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function je(e){var i=ha.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=null;if(e.weights){var t=0;e.weights.map(function(C,T){var O=e.colors[T]||"rgba(0, 0, 0, 0)",L=t+C;r.fillStyle=O,r.fillRect(t*256,0,L*256,1),t=L})}else{for(var o=r.createLinearGradient(0,0,256,1),u=e.positions[0],l=e.positions[e.positions.length-1],p=0;p<e.colors.length;++p){var v=(e.positions[p]-u)/(l-u);o.addColorStop(v,e.colors[p])}r.fillStyle=o,r.fillRect(0,0,256,1)}if(es)return n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1};n=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),E=0;E<x.data.length;E+=4)x.data[E+0]=n[E+0],x.data[E+1]=n[E+1],x.data[E+2]=n[E+2],x.data[E+3]=n[E+3];return i=null,r=null,x}var nt;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right"})(nt||(nt={}));var Ne={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function at(e,i,r){var n=e.classList;for(var t in Ne)Ne.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}function rt(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var be=se(92137),or=se(87757),$=se.n(or);function ur(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var Tr={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},rn=Tr.self||Tr.window||{},Qr=Tr.window||Tr.self||{},Sn=Tr.self||Tr.window||{},Jn=Tr.document||{},ei=typeof importScripts=="function",ni=typeof window!="undefined"&&typeof window.orientation!="undefined",ji=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){ur(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){ur(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),wn=ji,vi=new Map;function wi(e){ur(e.source&&!e.url||!e.source&&e.url);var i=vi.get(e.source||e.url);return i||(e.url&&(i=mi(e.url),vi.set(e.url,i)),e.source&&(i=ai(e.source),vi.set(e.source,i))),ur(i),i}function mi(e){if(!e.startsWith("http"))return e;var i=Ai(e);return ai(i)}function ai(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function Ai(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function si(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(oi(e))n.add(e);else if(oi(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)si(e[t],i,n)}}return r===void 0?Array.from(n):[]}function oi(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var go=function(){},to=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;ur(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=go,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=go,this.onError=go,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||si(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=wi({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),Do=to,bo=function(){return bo=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},bo.apply(this,arguments)},Ya=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},lo=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Ls=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=bo(bo({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),Ya(this,void 0,void 0,function(){var t,o=this;return lo(this,function(u){switch(u.label){case 0:return t=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Ya(this,void 0,void 0,function(){var i,r,n;return lo(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new wn(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Do({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return ni?this.maxMobileConcurrency:this.maxConcurrency},e}(),ys=Ls,Vs=function(){return Vs=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Vs.apply(this,arguments)},ss=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},yu={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},iu=function(){function e(i){this.workerPools=new Map,this.props=Vs({},yu),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return Do.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=ss(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=Vs(Vs({},this.props),i);try{for(var t=ss(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new ys({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),bc=iu,il=new Map,Xu=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!Ql(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=il.get(i);r||(r=function(n){if(!!Ql(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=il.get(i);il.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=si(r);self.postMessage(n,t)}},e}(),Fs=Xu;function Ql(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function Mu(e){return JSON.parse(Jl(e))}function Jl(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function $u(e){return""+e.name}function Bo(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var ku=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Yu=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function wl(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function ma(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),ku(this,void 0,void 0,function(){var t,o,u,l,p,v,x,E;return Yu(this,function(C){switch(C.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),l=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,l.startJob(p,js.bind(null,n))];case 1:return v=C.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return E=C.sent(),[2,E.result]}})})}function js(e,i,r,n){return ku(this,void 0,void 0,function(){var t,o,u,l,p,v,x;return Yu(this,function(E){switch(E.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,E.label=4;case 4:return E.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=E.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=E.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),E.label=9;case 9:return[2]}})})}var _s=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),al=_s,Yc=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},qc=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Cf=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),t(l,p,u.done,u.value)})}}function t(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},au=0,ol,ou;function Cl(e,i){var r=this;if(typeof self!="undefined"){var n={process:Kc};Fs.onmessage=function(t,o){return Yc(r,void 0,void 0,function(){var u,l,p,v,x,E,C,T,O,L,B;return qc(this,function(V){switch(V.label){case 0:switch(V.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=V.sent(),Fs.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");ol=new al,ou=o.options||{},p=i(ol,ou,n),V.label=4;case 4:V.trys.push([4,9,10,15]),v=Cf(p),V.label=5;case 5:return[4,v.next()];case 6:if(x=V.sent(),!!x.done)return[3,8];E=x.value,Fs.postMessage("output-batch",{result:E}),V.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return C=V.sent(),L={error:C},[3,15];case 10:return V.trys.push([10,,13,14]),x&&!x.done&&(B=v.return)?[4,B.call(v)]:[3,12];case 11:V.sent(),V.label=12;case 12:return[3,14];case 13:if(L)throw L.error;return[7];case 14:return[7];case 15:return Fs.postMessage("done",{}),[3,18];case 16:return ol.push(o.input),[3,18];case 17:return ol.close(),[3,18];case 18:return[3,20];case 19:return T=V.sent(),O=T instanceof Error?T.message:"",Fs.postMessage("error",{error:O}),[3,20];case 20:return[2]}})})}}}function Kc(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=au++,o=function(l,p){if(p.id===t)switch(l){case"done":Fs.removeEventListener(o),r(p.result);break;case"error":Fs.removeEventListener(o),n(p.error);break;default:}};Fs.addEventListener(o);var u={id:t,input:e,options:i};Fs.postMessage("process",u)})}var _u=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},No=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},ec={};function Rh(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),_u(this,void 0,void 0,function(){return No(this,function(n){switch(n.label){case 0:return i&&(e=Oh(e,i,r)),ec[e]=ec[e]||eh(e),[4,ec[e]];case 1:return[2,n.sent()]}})})}function Oh(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function eh(e){return _u(this,void 0,void 0,function(){var i,r,n;return No(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,fp(n,e)]}})})}function fp(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var Yp="0.0.3",Qc={id:"null",name:"null",module:"web-worker-helper",options:{}};function Ec(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function Af(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Lh(e){var i=e.filter;return i?[1]:[0]}function sl(e,i){return[i]}var Tf=se(9187),Iu=se.n(Tf),X=se(96156),Vr=se(31437),Mf=Vr.create(),Pv=Vr.create(),us=Vr.create(),tc=Vr.create(),Sc=Vr.create();function hp(e,i,r,n,t){Vr.add(e,r,n),Vr.normalize(e,e),i=Vr.fromValues(-e[1],e[0]);var o=Vr.fromValues(-r[1],r[0]);return[t/Vr.dot(i,o),i]}function Pu(e,i){return Vr.set(e,-i[1],i[0])}function kf(e,i,r){return Vr.sub(e,i,r),Vr.normalize(e,e),e}function Eo(e,i){return e[0]===i[0]&&e[1]===i[1]}function pp(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var qp=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,X.Z)(this,"lastFlip",-1),(0,X.Z)(this,"miter",Vr.fromValues(0,0)),(0,X.Z)(this,"started",!1),(0,X.Z)(this,"dash",!1),(0,X.Z)(this,"totalDistance",0),(0,X.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,_t.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,W.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,V=this.segment_gaode2(t,u,E,T,L,C,O,B);u+=V}if(this.dash)for(var ne=0;ne<t.positions.length/6;ne++)t.positions[ne*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,W.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,V=this.simpleSegment(t,u,E,T,L,C,O,B);u+=V}if(this.dash)for(var ne=0;ne<t.positions.length/6;ne++)t.positions[ne*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,E=r.indices,C=r.positions,T=r.normals,O=this.cap==="square",L=this.join==="bevel",B=Fo([p[0],p[1]]),V=Fo([l[0],l[1]]);kf(us,o,t);var ne=0;if(this.dash&&(ne=this.lineSegmentDistance(B,V),this.totalDistance+=ne),this.normal||(this.normal=Vr.create(),Pu(this.normal,us)),!this.started)if(this.started=!0,O){var ie=Vr.create(),ke=Vr.create();Vr.add(ie,this.normal,us),Vr.add(ke,this.normal,us),T.push(ke[0],ke[1],0),T.push(ie[0],ie[1],0),C.push(t[0],t[1],t[2]|0,this.totalDistance-ne,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),C.push(t[0],t[1],t[2]|0,this.totalDistance-ne,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,t,this.normal,this.thickness,this.totalDistance-ne);if(E.push(n+0,n+1,n+2),u){Eo(o,u)&&Vr.add(u,o,Vr.normalize(u,Vr.subtract(u,o,t))),kf(tc,u,o);var St=hp(Sc,Vr.create(),us,tc,this.thickness),Lt=(0,nr.Z)(St,2),zt=Lt[0],dr=Lt[1],cr=Vr.dot(Sc,this.normal)<0?-1:1,Br=L;if(!Br&&this.join==="miter"){var _n=zt;_n>this.miterLimit&&(Br=!0)}Br?(T.push(this.normal[0],this.normal[1],0),T.push(dr[0],dr[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,W.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),Pu(Mf,tc),Vr.copy(this.normal,Mf),T.push(this.normal[0],this.normal[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(C,T,o,dr,zt,this.totalDistance),E.push.apply(E,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,Vr.copy(this.normal,dr),x+=2),this.lastFlip=cr}else{if(Pu(this.normal,us),O){var Fe=Vr.create(),ut=Vr.create();Vr.sub(ut,us,this.normal),Vr.add(Fe,us,this.normal),T.push(ut[0],ut[1],0),T.push(Fe[0],Fe[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=Fo([o[0],o[1]]),C=Fo([t[0],t[1]]);kf(us,E,C);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,C),this.totalDistance+=T),this.normal||(this.normal=Vr.create(),Pu(this.normal,us)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)Pu(this.normal,us),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Fo([u[0],u[1]]);Eo(E,O)&&Vr.add(O,E,Vr.normalize(O,Vr.subtract(O,E,C))),kf(tc,O,E);var L=hp(Sc,Vr.create(),us,tc,this.thickness),B=(0,nr.Z)(L,2),V=B[0],ne=B[1],ie=Vr.dot(Sc,this.normal)<0?-1:1;this.extrusions(v,x,o,ne,V,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,Vr.copy(this.normal,ne),l+=2,this.lastFlip=ie}return l}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=this.cap==="square",C=this.join==="bevel",T=Fo([o[0],o[1]]),O=Fo([t[0],t[1]]);kf(us,T,O);var L=0;if(this.dash&&(L=this.lineSegmentDistance(T,O),this.totalDistance+=L),this.normal||(this.normal=Vr.create(),Pu(this.normal,us)),!this.started)if(this.started=!0,E){var B=Vr.create(),V=Vr.create();Vr.add(B,this.normal,us),Vr.add(V,this.normal,us),x.push(V[0],V[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-L);if(p.push(n+0,n+1,n+2),u){var ke=Fo([u[0],u[1]]);Eo(T,ke)&&Vr.add(ke,T,Vr.normalize(ke,Vr.subtract(ke,T,O))),kf(tc,ke,T);var Fe=hp(Sc,Vr.create(),us,tc,this.thickness),ut=(0,nr.Z)(Fe,2),St=ut[0],Lt=ut[1],zt=Vr.dot(Sc,this.normal)<0?-1:1,dr=C;if(!dr&&this.join==="miter"){var cr=St;cr>this.miterLimit&&(dr=!0)}dr?(x.push(this.normal[0],this.normal[1],0),x.push(Lt[0],Lt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,W.Z)(this.lastFlip!==-zt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Pu(Mf,tc),Vr.copy(this.normal,Mf),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Lt,St,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),zt=-1,Vr.copy(this.normal,Lt),l+=2),this.lastFlip=zt}else{if(Pu(this.normal,us),E){var ne=Vr.create(),ie=Vr.create();Vr.sub(ie,us,this.normal),Vr.add(ne,us,this.normal),x.push(ie[0],ie[1],0),x.push(ne[0],ne[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}();function If(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new qp({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(C){t.extrude(C)})}var E=t.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function Jc(e){var i=g(e.coordinates);return{vertices:[].concat((0,W.Z)(i),(0,W.Z)(i),(0,W.Z)(i),(0,W.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Pf(e){var i=e.coordinates,r=Iu().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Iu()(n,o,t),vertices:n,size:t}}var Fh=function(){var e=(0,be.Z)($().mark(function i(r){var n,t,o,u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,l={a_Color:Ec,a_Position:Af,filter:Lh,a_vertexId:sl,a_PickingColor:function(L){var B=L.id;return o?Ue(B):[0,0,0]},a_DistanceAndIndex:function(L,B,V,ne,ie,ke){return ke===void 0?[V[3],10]:[V[3],ke]},a_Total_Distance:function(L,B,V){return[V[5]]},a_Size:function(L){var B=L.size,V=B===void 0?1:B;return Array.isArray(V)?[V[0],V[1]]:[V,0]},a_Normal:function(L,B,V,ne,ie){return ie},a_Miter:function(L,B,V){return[V[4]]},a_iconMapUV:function(L){var B=L.texture,V=u[B]||{x:0,y:0},ne=V.x,ie=V.y;return[ne,ie]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,t.forEach(function(O,L){var B=If(O),V=B.indices,ne=B.vertices,ie=B.normals,ke=B.size,Fe=B.indexes;V.forEach(function(zt){x.push(zt+v)}),E=ke;var ut=ne.length/ke;p.sizePerElement=E,p.elements.push({featureIdx:L,vertices:ne,normals:ie,offset:v}),v+=ut;for(var St=function(dr){var cr=(ie==null?void 0:ie.slice(dr*3,dr*3+3))||[],Br=ne.slice(dr*ke,dr*ke+ke),_n=0;Fe&&Fe[dr]!==void 0&&(_n=Fe[dr]),n.forEach(function(Zn){if(Zn&&l[Zn.name]){var qi;(qi=Zn.buffer.data).push.apply(qi,(0,W.Z)(l[Zn.name](O,L,Br,dr,cr,_n)))}})},Lt=0;Lt<ut;Lt++)St(Lt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),th=function(){var e=(0,be.Z)($().mark(function i(r){var n,t,o,u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,l={a_Color:Ec,a_Position:Af,filter:Lh,a_vertexId:sl,a_PickingColor:function(L){var B=L.id;return o?Ue(B):[0,0,0]},a_Shape:function(L){var B=L.shape,V=B===void 0?2:B,ne=u.indexOf(V);return[ne]},a_Extrude:function(L,B,V,ne){var ie=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],ke=ne%4*3;return[ie[ke],ie[ke+1],ie[ke+2]]},a_Size:function(L){var B=L.size,V=B===void 0?5:B;return Array.isArray(V)?[V[0]]:[V]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,t.forEach(function(O,L){var B=Jc(O),V=B.indices,ne=B.vertices,ie=B.normals,ke=B.size,Fe=B.indexes;V.forEach(function(zt){x.push(zt+v)}),E=ke;var ut=ne.length/ke;p.sizePerElement=E,p.elements.push({featureIdx:L,vertices:ne,normals:ie,offset:v}),v+=ut;for(var St=function(dr){var cr=(ie==null?void 0:ie.slice(dr*3,dr*3+3))||[],Br=ne.slice(dr*ke,dr*ke+ke),_n=0;Fe&&Fe[dr]!==void 0&&(_n=Fe[dr]),n.forEach(function(Zn){if(Zn&&l[Zn.name]){var qi;(qi=Zn.buffer.data).push.apply(qi,(0,W.Z)(l[Zn.name](O,L,Br,dr,cr,_n)))}})},Lt=0;Lt<ut;Lt++)St(Lt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),wc=function(){var e=(0,be.Z)($().mark(function i(r){var n,t,o,u,l,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:Ec,a_Position:Af,filter:Lh,a_vertexId:sl,a_PickingColor:function(O){var L=O.id;return o?Ue(L):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(T,O){var L=Pf(T),B=L.indices,V=L.vertices,ne=L.normals,ie=L.size,ke=L.indexes;B.forEach(function(Lt){v.push(Lt+p)}),x=ie;var Fe=V.length/ie;l.sizePerElement=x,l.elements.push({featureIdx:O,vertices:V,normals:ne,offset:p}),p+=Fe;for(var ut=function(zt){var dr=(ne==null?void 0:ne.slice(zt*3,zt*3+3))||[],cr=V.slice(zt*ie,zt*ie+ie),Br=0;ke&&ke[zt]!==void 0&&(Br=ke[zt]),n.forEach(function(_n){if(_n&&u[_n.name]){var Zn;(Zn=_n.buffer.data).push.apply(Zn,(0,W.Z)(u[_n.name](T,O,cr,zt,dr,Br)))}})},St=0;St<Fe;St++)ut(St)}),C.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return C.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),ef={pointFill:th,line:Fh,polygonFill:wc},Rf=(0,Y.Z)({},ef);function Dh(e){return Al.apply(this,arguments)}function Al(){return Al=(0,be.Z)($().mark(function e(i){var r,n;return $().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!Rf[r]){o.next=3;break}return o.abrupt("return",Rf[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Al.apply(this,arguments)}Cl(Dh);var rh=new Map;function nh(e,i){rh.set(e,i)}function Bh(e){var i=rh.get(e);return i}var Of=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var x=d.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(x,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,s,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=P?L:function(t){return function(){return M.apply(t,arguments)}},C=function(t){return null==t},N=TypeError,D=function(t){if(C(t))throw N("Can't call method on "+t);return t},F=Object,W=function(t){return F(D(t))},z=R({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return z(W(t),e)},U=0,G=Math.random(),H=R(1..toString),V=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++U+G,36)},q="object"==typeof document&&document.all,Z={all:q,IS_HTMLDDA:void 0===q&&void 0!==q},Y=Z.all,$=Z.IS_HTMLDDA?function(t){return"function"==typeof t||t===Y}:function(t){return"function"==typeof t},K=function(t){return $(t)?t:void 0},Q=function(t,e){return arguments.length<2?K(O[t]):O[t]&&O[t][e]},X=Q("navigator","userAgent")||"",J=O.process,tt=O.Deno,et=J&&J.versions||tt&&tt.version,rt=et&&et.v8;rt&&(E=(w=rt.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&X&&(!(w=X.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=X.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var nt=E,ot=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&nt&&nt<41})),it=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,at=I("wks"),ut=O.Symbol,st=ut&&ut.for,ct=it?ut:ut&&ut.withoutSetter||V,ft=function(t){if(!B(at,t)||!ot&&"string"!=typeof at[t]){var e="Symbol."+t;ot&&B(ut,t)?at[t]=ut[t]:at[t]=it&&st?st(e):ct(e)}return at[t]},lt={};lt[ft("toStringTag")]="z";var ht="[object z]"===String(lt),pt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),vt=Z.all,dt=Z.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:$(t)||t===vt}:function(t){return"object"==typeof t?null!==t:$(t)},yt=O.document,gt=dt(yt)&&dt(yt.createElement),mt=function(t){return gt?yt.createElement(t):{}},xt=!pt&&!j((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),bt=pt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),wt=String,Et=TypeError,At=function(t){if(dt(t))return t;throw Et(wt(t)+" is not an object")},Ot=Function.prototype.call,St=P?Ot.bind(Ot):function(){return Ot.apply(Ot,arguments)},Tt=R({}.isPrototypeOf),kt=Object,It=it?function(t){return"symbol"==typeof t}:function(t){var e=Q("Symbol");return $(e)&&Tt(e.prototype,kt(t))},jt=String,Pt=function(t){try{return jt(t)}catch(t){return"Object"}},_t=TypeError,Mt=function(t){if($(t))return t;throw _t(Pt(t)+" is not a function")},Lt=function(t,e){var r=t[e];return C(r)?void 0:Mt(r)},Rt=TypeError,Ct=TypeError,Nt=ft("toPrimitive"),Dt=function(t,e){if(!dt(t)||It(t))return t;var r,n=Lt(t,Nt);if(n){if(void 0===e&&(e="default"),r=St(n,t,e),!dt(r)||It(r))return r;throw Ct("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;if($(r=t.valueOf)&&!dt(n=St(r,t)))return n;if("string"!==e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;throw Rt("Can't convert object to primitive value")}(t,e)},Ft=function(t){var e=Dt(t,"string");return It(e)?e:e+""},Wt=TypeError,zt=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Ut={f:pt?bt?function(t,e,r){if(At(t),e=Ft(e),At(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Bt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return zt(t,e,r)}:zt:function(t,e,r){if(At(t),e=Ft(e),At(r),xt)try{return zt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Wt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Gt=Function.prototype,Ht=pt&&Object.getOwnPropertyDescriptor,Vt=B(Gt,"name"),qt={EXISTS:Vt,PROPER:Vt&&"something"===function(){}.name,CONFIGURABLE:Vt&&(!pt||pt&&Ht(Gt,"name").configurable)},Zt=R(Function.toString);$(k.inspectSource)||(k.inspectSource=function(t){return Zt(t)});var Yt,$t,Kt,Qt=k.inspectSource,Xt=O.WeakMap,Jt=$(Xt)&&/native code/.test(String(Xt)),te=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ee=pt?function(t,e,r){return Ut.f(t,e,te(1,r))}:function(t,e,r){return t[e]=r,t},re=I("keys"),ne=function(t){return re[t]||(re[t]=V(t))},oe={},ie=O.TypeError,ae=O.WeakMap;if(Jt||k.state){var ue=k.state||(k.state=new ae);ue.get=ue.get,ue.has=ue.has,ue.set=ue.set,Yt=function(t,e){if(ue.has(t))throw ie("Object already initialized");return e.facade=t,ue.set(t,e),e},$t=function(t){return ue.get(t)||{}},Kt=function(t){return ue.has(t)}}else{var se=ne("state");oe[se]=!0,Yt=function(t,e){if(B(t,se))throw ie("Object already initialized");return e.facade=t,ee(t,se,e),e},$t=function(t){return B(t,se)?t[se]:{}},Kt=function(t){return B(t,se)}}var ce={set:Yt,get:$t,has:Kt,enforce:function(t){return Kt(t)?$t(t):Yt(t,{})},getterFor:function(t){return function(e){var r;if(!dt(e)||(r=$t(e)).type!==t)throw ie("Incompatible receiver, "+t+" required");return r}}},fe=b((function(t){var e=qt.CONFIGURABLE,r=ce.enforce,n=ce.get,o=Object.defineProperty,i=pt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(pt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&B(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&B(u,"constructor")&&u.constructor?pt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return B(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return $(this)&&n(this).source||Qt(this)}),"toString")})),le=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if($(r)&&fe(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ut.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},he=R({}.toString),pe=R("".slice),ve=function(t){return pe(he(t),8,-1)},de=ft("toStringTag"),ye=Object,ge="Arguments"==ve(function(){return arguments}()),me=ht?ve:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ye(t),de))?r:ge?ve(e):"Object"==(n=ve(e))&&$(e.callee)?"Arguments":n},xe=ht?{}.toString:function(){return"[object "+me(this)+"]"};ht||le(Object.prototype,"toString",xe,{unsafe:!0});var be={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,Ee={f:we&&!be.call({1:2},1)?function(t){var e=we(this,t);return!!e&&e.enumerable}:be},Ae=Object,Oe=R("".split),Se=j((function(){return!Ae("z").propertyIsEnumerable(0)}))?function(t){return"String"==ve(t)?Oe(t,""):Ae(t)}:Ae,Te=function(t){return Se(D(t))},ke=Object.getOwnPropertyDescriptor,Ie={f:pt?ke:function(t,e){if(t=Te(t),e=Ft(e),xt)try{return ke(t,e)}catch(t){}if(B(t,e))return te(!St(Ee.f,t,e),t[e])}},je=Math.ceil,Pe=Math.floor,_e=Math.trunc||function(t){var e=+t;return(e>0?Pe:je)(e)},Me=function(t){var e=+t;return e!=e||0===e?0:_e(e)},Le=Math.max,Re=Math.min,Ce=function(t,e){var r=Me(t);return r<0?Le(r+e,0):Re(r,e)},Ne=Math.min,De=function(t){return t>0?Ne(Me(t),9007199254740991):0},Fe=function(t){return De(t.length)},We=function(t){return function(e,r,n){var o,i=Te(e),a=Fe(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},ze={includes:We(!0),indexOf:We(!1)},Be=ze.indexOf,Ue=R([].push),Ge=function(t,e){var r,n=Te(t),o=0,i=[];for(r in n)!B(oe,r)&&B(n,r)&&Ue(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~Be(i,r)||Ue(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ve=He.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ge(t,Ve)}},Ze={f:Object.getOwnPropertySymbols},Ye=R([].concat),$e=Q("Reflect","ownKeys")||function(t){var e=qe.f(At(t)),r=Ze.f;return r?Ye(e,r(t)):e},Ke=function(t,e,r){for(var n=$e(e),o=Ut.f,i=Ie.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Qe=/#|\\.prototype\\./,Xe=function(t,e){var r=tr[Je(t)];return r==rr||r!=er&&($(e)?j(e):!!e)},Je=Xe.normalize=function(t){return String(t).replace(Qe,".").toLowerCase()},tr=Xe.data={},er=Xe.NATIVE="N",rr=Xe.POLYFILL="P",nr=Xe,or=Ie.f,ir=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=or(r,n))&&a.value:r[n],!nr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Ke(i,o)}(t.sham||o&&o.sham)&&ee(i,"sham",!0),le(r,n,i,t)}},ar="process"==ve(O.process),ur=String,sr=TypeError,cr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=R(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return At(r),function(t){if("object"==typeof t||$(t))return t;throw sr("Can't set "+ur(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),fr=Ut.f,lr=ft("toStringTag"),hr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,lr)&&fr(t,lr,{configurable:!0,value:e})},pr=ft("species"),vr=function(t){var e=Q(t),r=Ut.f;pt&&e&&!e[pr]&&r(e,pr,{configurable:!0,get:function(){return this}})},dr=TypeError,yr=function(t,e){if(Tt(e,t))return t;throw dr("Incorrect invocation")},gr=function(){},mr=[],xr=Q("Reflect","construct"),br=/^\\s*(?:class|function)\\b/,wr=R(br.exec),Er=!br.exec(gr),Ar=function(t){if(!$(t))return!1;try{return xr(gr,mr,t),!0}catch(t){return!1}},Or=function(t){if(!$(t))return!1;switch(me(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Er||!!wr(br,Qt(t))}catch(t){return!0}};Or.sham=!0;var Sr,Tr,kr,Ir,jr=!xr||j((function(){var t;return Ar(Ar.call)||!Ar(Object)||!Ar((function(){t=!0}))||t}))?Or:Ar,Pr=TypeError,_r=function(t){if(jr(t))return t;throw Pr(Pt(t)+" is not a constructor")},Mr=ft("species"),Lr=function(t,e){var r,n=At(t).constructor;return void 0===n||C(r=At(n)[Mr])?e:_r(r)},Rr=Function.prototype,Cr=Rr.apply,Nr=Rr.call,Dr="object"==typeof Reflect&&Reflect.apply||(P?Nr.bind(Cr):function(){return Nr.apply(Cr,arguments)}),Fr=function(t){if("Function"===ve(t))return R(t)},Wr=Fr(Fr.bind),zr=function(t,e){return Mt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=Q("document","documentElement"),Ur=R([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(X),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Sr=O.location}catch(t){}var en=function(t){if(B(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Sr.protocol+"//"+Sr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=$(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Dr(e,void 0,r)},Tr(Jr),Jr},Zr=function(t){delete tn[t]},ar?Tr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?Tr=function(t){$r.now(rn(t))}:Qr&&!Vr?(Ir=(kr=new Qr).port2,kr.port1.onmessage=nn,Tr=zr(Ir.postMessage,Ir)):O.addEventListener&&$(O.postMessage)&&!O.importScripts&&Sr&&"file:"!==Sr.protocol&&!j(on)?(Tr=on,O.addEventListener("message",nn,!1)):Tr="onreadystatechange"in mt("script")?function(t){Br.appendChild(mt("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(X)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(X),gn=Ie.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ar&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ar||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ar?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ar&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,ft("species")),Nn=!1,Dn=$(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:nr("Promise",(function(){var t=Qt(Mn),e=t!==String(Mn);if(!e&&66===nt)return!0;if(!nt||nt<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Mt(e),this.reject=Mt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=ce.getterFor("Promise"),Zn=ce.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!dt(t)||!$(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?St(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){St(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ar?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ar||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){St(Un,O,(function(){var e=t.facade;ar?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{St(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){yr(this,Kn),Mt(t),St(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=le(Kn,"then",(function(t,e){var r=qn(this),n=to(Lr(this,$n));return r.parent=!0,n.ok=!$(t)||t,n.fail=$(e)&&e,n.domain=ar?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},$(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||le(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){St(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}cr&&cr(Yn,Kn)}ir({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),hr($n,"Promise",!1),vr("Promise");var po={},vo=ft("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=ft("iterator"),xo=function(t){if(!C(t))return Lt(t,mo)||Lt(t,"@@iterator")||po[me(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Mt(r))return At(St(r,t));throw bo(Pt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;At(t);try{if(!(n=Lt(t,"return"))){if("throw"===e)throw r;return r}n=St(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return At(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(At(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Pt(t)+" is not iterable");if(go(o)){for(i=0,a=Fe(t);a>i;i++)if((u=g(t[i]))&&Tt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=St(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Tt(So,u))return u}return new Oo(!1)},ko=ft("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ir({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Mt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,St(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ir({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),$(Mn)){var Co=Q("Promise").prototype.catch;Ro.catch!==Co&&le(Ro,"catch",Co,{unsafe:!0})}ir({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Mt(e.resolve);To(t,(function(t){St(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ir({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return St(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;Q("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ir({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(At(t),dt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=mt("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==ve(t)},gi=ft("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(jr(e)&&(e===mi||yi(e.prototype))||dt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=R([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=W(s),d=Se(v),y=zr(c,f),g=Fe(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ee(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ft(e);n in t?Ut.f(t,n,te(0,r)):t[n]=r},ji=ft("species"),Pi=function(t){return nt>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=ft("species"),Li=Array,Ri=Math.max;ir({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=Te(this),a=Fe(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(jr(r)&&(r===Li||yi(r.prototype))||dt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=qt.EXISTS,Ni=Ut.f,Di=Function.prototype,Fi=R(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=R(Wi.exec);pt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ir({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return Ge(t,He)},Vi={f:pt&&!bt?Object.defineProperties:function(t,e){At(t);for(var r,n=Te(e),o=Hi(e),i=o.length,a=0;i>a;)Ut.f(t,r=o[a++],n[r]);return t}},qi=ne("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=mt("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=He.length;r--;)delete Ki.prototype[He[r]];return Ki()};oe[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=At(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=Ut.f,Ji=ft("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ne("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=W(t);if(B(e,aa))return e[aa];var r=e.constructor;return $(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=ft("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!dt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),$(ea[fa])||le(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=qt.PROPER,ya=qt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=ft("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:te(+!n,r)}),hr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(cr?cr(u,ga):$(u[xa])||le(u,xa,ba)),hr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ee(p,"name","values"):(h=!0,d=function(){return St(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&le(p,c,s[c]);else ir({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&le(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=Ut.f,Oa=ce.set,Sa=ce.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:Te(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),pt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=Ut.f,La=ce.enforce,Ra=ce.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=ft("toStringTag"),Ha=V("TYPED_ARRAY_TAG"),Va=_a&&!!cr&&"Opera"!==me(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(dt(e)){var r=Ra(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!dt(t))return!1;var e=me(t);return B(Za,e)||B(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!$(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&cr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&cr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&cr(Fa,za),pt&&!B(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return dt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ee(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if($(t)&&(!cr||Tt(Wa,t)))return t;throw Ua(Pt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(pt){if(r)for(var o in Za){var i=O[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||le(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(pt){if(cr){if(r)for(n in Za)if((o=O[n])&&B(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return le(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||le(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!dt(t))return!1;var e=me(t);return"DataView"===e||B(Za,e)||B(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)le(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Me(t),r=De(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=W(this),r=Fe(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=Fe(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=qe.f,mu=Ut.f,xu=qt.PROPER,bu=qt.CONFIGURABLE,wu=ce.get,Eu=ce.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=R(pu),Mu=R([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ee(Au,"name","ArrayBuffer");else{(Ou=function(t){return yr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ee(Ou,Vu,Au[Vu]);Su.constructor=Ou}cr&&ca(ku)!==Iu&&cr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=R(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){yr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),pt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){yr(this,ku),yr(t,Su);var n=wu(t).byteLength,o=Me(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:De(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),pt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,pt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});hr(Ou,"ArrayBuffer"),hr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!dt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Me(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=R("".slice),ns=function(t){return"Big"===rs(me(t),0,3)},os=TypeError,is=function(t){var e=Dt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=_r(this),f=W(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=St(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=Fe(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return cr&&$(n=e.constructor)&&n!==r&&dt(o=n.prototype)&&o!==r.prototype&&cr(t,o),t},cs=b((function(t){var e=qe.f,r=Ei.forEach,n=ce.get,o=ce.set,i=ce.enforce,a=Ut.f,u=Ie.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Tt(l,t)||"ArrayBuffer"==(e=me(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!It(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ft(e),E(t,e)?te(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ft(e),!(E(t,e)&&dt(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};pt?(p||(Ie.f=A,Ut.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ir({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return yr(t,k),ss(dt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):St(us,T,e):new S(ou(e)),t,T)})),cr&&cr(T,d),r(e(S),(function(t){t in T||ee(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){yr(t,k);var i,a,u,s=0,l=0;if(dt(e)){if(!w(e))return m(e)?x(T,e):St(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=De(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),cr&&cr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ee(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ee(k,v,b);var P=T!=S;I[b]=T,ir({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ee(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ee(k,"BYTES_PER_ELEMENT",g),vr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Pt(e)+" of "+Pt(t))},hs=Math.min,ps=R([].copyWithin||function(t,e){var r=W(this),n=Fe(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=R("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(me(this),0,3)?is(t):+t;return St(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Lr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=Fe(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=ze.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=ze.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=ft("iterator"),Ds=O.Uint8Array,Fs=R(Ta.values),Ws=R(Ta.keys),zs=R(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=R([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Dr(Qs,this,arguments)||0;var e=Te(this),r=Fe(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Me(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Dr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Mt(r);var i=W(e),a=Se(i),u=Fe(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return St(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=W(t);if(bc)return St(gc,this,r,e);var n=this.length,o=Fe(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=X.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(X),Lc=X.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&Fr(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(nt)return nt<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Mt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ce(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,De((void 0===e?n:Ce(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Dr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=R([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===me(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=At(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=ce.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=R("".charAt),mf=R("".indexOf),xf=R("".replace),bf=R("".slice),wf=(tf=/b*/g,St(df,Jc=/a/,"a"),St(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=St(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=St(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=St(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&St(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ir({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=ft("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=ft(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=Fr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=Fr(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));le(String.prototype,t,s[0]),le(kf,o,s[1])}n&&ee(kf[o],"sham",!0)},jf=R("".charAt),Pf=R("".charCodeAt),_f=R("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(D(e)),a=Me(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=R("".charAt),Ff=R("".replace),Wf=R("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=W(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if($(r)){var n=St(r,t,e);return null!==n&&At(n),n}if("RegExp"===ve(t))return St(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=ft("replace"),qf=Math.max,Zf=Math.min,Yf=R([].concat),$f=R([].push),Kf=R("".indexOf),Qf=R("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=D(this),o=C(t)?void 0:Lt(t,Vf);return o?St(o,t,n,r):St(e,rf(n),t,r)},function(t,o){var i=At(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=$(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,De(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Me(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Dr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ir({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=pt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ir({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=W(this),c=Fe(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Me(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=R([].concat),pl=!fl||j((function(){if(pt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=W(t),n=arguments.length,o=1,i=Ze.f,a=Ee.f;n>o;)for(var u,s=Se(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],pt&&!St(a,s,u)||(r[u]=s[u]);return r}:fl;ir({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ir({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=ce.set,ml=ce.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=qe.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==ve(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(Te(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!dt(t)&&((!El||"ArrayBuffer"!=ve(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=Ut.f,r=!1,n=V("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=R([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ir({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!dt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!B(t,n)&&i(t),t}};oe[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=R(u[t]);le(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!dt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(nr(t,!$(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(nr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){yr(t,u);var r=ss(new a,t,s);return C(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ir({global:!0,constructor:!0,forced:s!=a},c),hr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=ce.set,Pl=ce.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=R([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(At(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&B(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(dt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=ce.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(Jt&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=R(Hl.delete),ql=R(Hl.has),Zl=R(Hl.get),Yl=R(Hl.set);ru(Hl,{delete:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(dt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=ft("iterator"),Kl=ft("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ee(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ee(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ee(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=D(this),n=C(e)?void 0:Lt(e,t);return n?St(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=At(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,De(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=ft("isConcatSpreadable"),Rh=nt>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!dt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ir({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=W(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=Fe(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=Ut.f,zh=Tl.fastKey,Bh=ce.set,Uh=ce.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),pt||(t.size=0),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),pt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,pt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),pt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),pt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),vr(e)}});var Gh=R([].join),Hh=Se!=Object,Vh=Ai("join",",");ir({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(Te(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ir({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(W(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ir({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=R(1..valueOf),Np=R("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(D(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=qe.f,Gp=Ie.f,Hp=Ut.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=R("".slice),Kp=R("".charCodeAt),Qp=function(t){var e=Dt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Dt(t,"number");if(It(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(nr("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Tt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=pt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)B(qp,Jp=ev[rv])&&!B(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,le(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=R((function(t){var e=rf(D(this)),r="",n=Me(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=R("".slice),cv=R(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ir({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Me(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=R("".replace);ir({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(D(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=qt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&le(RegExp.prototype,"toString",(function(){var t=At(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||B(t,"flags")||!Tt(bv,t)?e:St(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,Tl="l7-worker",su=3,ih=!0;function ah(e){nh(Tl,e)}function oh(){var e=Bh(Tl);if(!e)throw new Error("get worker failed by workerName: ".concat(Tl,"."));return e}function sh(e,i){return Lf.apply(this,arguments)}function Lf(){return Lf=(0,be.Z)($().mark(function e(i,r){var n,t,o,u,l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=oh(),t=bc.getWorkerFarm({maxConcurrency:su,reuseWorkers:ih}),o=t.getWorkerPool({name:Tl,source:n}),v.next=5,o.startJob(Tl,function(x,E,C){return x.done(C)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),Lf.apply(this,arguments)}ah(Of);var Gs={BACK:1029,FRONT:1028};function ul(e){switch(e){case"GAODE1.x":return Gs.BACK;case"GAODE2.x":return Gs.BACK;case"MAPBOX":return Gs.FRONT;case"SIMPLE":return Gs.FRONT;case"GLOBEL":return Gs.BACK;case"DEBAULT":return Gs.FRONT;default:return Gs.FRONT}}function Kp(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Nh(){return typeof importScripts=="function"}var Nd=Nh()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Ff;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Ff||(Ff={}));var Ru;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Ru||(Ru={}));var xu=0,dp=1,tf=2;function Df(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function ll(e){e.forEach(function(i){i.properties.state=xu}),e.forEach(function(i){i.isCurrent&&!Jp(i)&&qu(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&tf)})}function Qp(e){e.forEach(function(r){r.properties.state=xu}),e.forEach(function(r){r.isCurrent&&Jp(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&tf),r.children.length&&(r.isVisible||r.properties.state&dp)?r.children.forEach(function(n){n.properties.state=dp}):r.isCurrent&&qu(r)})}function Jp(e){for(;e;){if(e.isLoaded)return e.properties.state|=tf,!0;e=e.parent}return!1}function qu(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=tf:qu(i)})}var Ml,Bf=256,rc=[-Infinity,-Infinity,Infinity,Infinity],ed=.2,vp=5,zh=(Ml={},(0,X.Z)(Ml,Ff.Realtime,Df),(0,X.Z)(Ml,Ff.Overlap,ll),(0,X.Z)(Ml,Ff.Replace,Qp),Ml),mp=function(){};function ga(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function nc(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var ko=function(i,r,n){var t=nc(i,r,n),o=(0,nr.Z)(t,2),u=o[0],l=o[1],p=nc(i+1,r+1,n),v=(0,nr.Z)(p,2),x=v[0],E=v[1];return[u,E,x,l]};function uu(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?rc:v,E=Math.ceil(i)+p;if(Number.isFinite(u)&&E<u)return[];Number.isFinite(t)&&E>t&&(E=t);for(var C=(0,nr.Z)(r,4),T=C[0],O=C[1],L=C[2],B=C[3],V=[Math.max(T,x[0]),Math.max(O,x[1]),Math.min(L,x[2]),Math.min(B,x[3])],ne=[],ie=ga(V[0],V[1],E),ke=(0,nr.Z)(ie,2),Fe=ke[0],ut=ke[1],St=ga(V[2],V[3],E),Lt=(0,nr.Z)(St,2),zt=Lt[0],dr=Lt[1],cr=Fe;cr<=zt;cr++)for(var Br=dr;Br<=ut;Br++)ne.push({x:cr,y:Br,z:E});var _n=(zt+Fe)/2,Zn=(ut+dr)/2,qi=function(xo,wo){return Math.abs(xo-_n)+Math.abs(wo-Zn)};return ne.sort(function(Ta,xo){return qi(Ta.x,Ta.y)-qi(xo.x,xo.y)}),ne}var td=function(i,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=r;return t&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function zd(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Zd(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),l=parseInt(r[1],10);l<=u;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}function uh(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=Zd(e),u=Math.abs(r+n)%o.length,l=o[u];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,ko(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function Ud(e,i){var r=i.x,n=i.y,t=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,E=i.service,C=E===void 0?"WMTS":E,T=i.tileMatrixset,O="".concat(e,"&SERVICE=").concat(C,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(T,"&FORMAT=").concat(x,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return O}function gp(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],l=[r,o],p=[t,o],v=[t,n];return Vn([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var lu=se(26729),yp=se.n(lu);function lh(e){var i=rd();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function rd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nd=function(e){(0,pr.Z)(r,e);var i=lh(r);function r(n){var t;(0,vt.Z)(this,r),t=i.call(this),(0,X.Z)((0,Le.Z)(t),"tileSize",256),(0,X.Z)((0,Le.Z)(t),"isVisible",!1),(0,X.Z)((0,Le.Z)(t),"isCurrent",!1),(0,X.Z)((0,Le.Z)(t),"isVisibleChange",!1),(0,X.Z)((0,Le.Z)(t),"loadedLayers",0),(0,X.Z)((0,Le.Z)(t),"isLayerLoaded",!1),(0,X.Z)((0,Le.Z)(t),"isLoad",!1),(0,X.Z)((0,Le.Z)(t),"isChildLoad",!1),(0,X.Z)((0,Le.Z)(t),"parent",null),(0,X.Z)((0,Le.Z)(t),"children",[]),(0,X.Z)((0,Le.Z)(t),"data",null),(0,X.Z)((0,Le.Z)(t),"properties",{}),(0,X.Z)((0,Le.Z)(t),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return t.x=o,t.y=u,t.z=l,t.warp=x||!0,t.tileSize=p,t}return(0,_t.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===Ru.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Ru.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Ru.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Ru.Cancelled}},{key:"isDone",get:function(){return[Ru.Loaded,Ru.Cancelled,Ru.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return ko(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,nr.Z)(this.bounds,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(l-o)/2,(p-u)/2],x=gp(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,be.Z)($().mark(function o(u){var l,p,v,x,E,C,T,O,L,B,V,ne,ie,ke,Fe,ut,St;return $().wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Ru.Loading,E=null,zt.prev=7,T=this.x,O=this.y,L=this.z,B=this.bounds,V=this.tileSize,ne=this.warp,ie=td(T,O,L,ne),ke=ie.warpX,Fe=ie.warpY,ut=this.abortController.signal,St={x:ke,y:Fe,z:L,bounds:B,tileSize:V,signal:ut,warp:ne},zt.next=14,l(St,this);case 14:E=zt.sent,zt.next=20;break;case 17:zt.prev=17,zt.t0=zt.catch(7),C=zt.t0;case 20:if(x===this.loadDataId){zt.next=22;break}return zt.abrupt("return");case 22:if(!(this.isCancelled&&!E)){zt.next=24;break}return zt.abrupt("return");case 24:if(!(C||!E)){zt.next=28;break}return this.loadStatus=Ru.Failure,v(C,this),zt.abrupt("return");case 28:this.loadStatus=Ru.Loaded,this.data=E,p(this);case 31:case"end":return zt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Ru.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(lu.EventEmitter),ch=function(i,r){var n=ks(i),t=nl(n,r),o=360*3-180,u=85.0511287798065,l=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return l},Za=function(i,r){var n=ks(i),t=ks(r),o=Wu(n,t);return o};function kl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ic(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ic(e,i){if(!!e){if(typeof e=="string")return rf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rf(e,i)}}function rf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _p(e){var i=Vd();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Vd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z=function(e){(0,pr.Z)(r,e);var i=_p(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,X.Z)((0,Le.Z)(t),"currentTiles",[]),(0,X.Z)((0,Le.Z)(t),"cacheTiles",new Map),(0,X.Z)((0,Le.Z)(t),"throttleUpdate",(0,yt.throttle)(function(o,u){t.update(o,u)},16)),(0,X.Z)((0,Le.Z)(t),"onTileLoad",function(o){t.emit("tile-loaded",o),t.updateTileVisible()}),(0,X.Z)((0,Le.Z)(t),"onTileError",function(o,u){t.emit("tile-error",{error:o,tile:u}),t.updateTileVisible()}),(0,X.Z)((0,Le.Z)(t),"onTileUnload",function(o){t.emit("tile-unload",o)}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:rc,getTileData:mp,warp:!0,updateStrategy:Ff.Overlap},t.updateOptions(n),t}return(0,_t.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,Y.Z)((0,Y.Z)((0,Y.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,l=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Za(this.lastViewStates.latLonBoundsBuffer,o))){var p=ch(o,ed);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p};var v=!1,x=this.getTileIndices(l,p).filter(function(E){return u.options.warp||E.x>=0&&E.x<Math.pow(2,l)});this.currentTiles=x.map(function(E){var C=E.x,T=E.y,O=E.z,L=u.getTile(C,T,O);if(L){var B,V,ne=((B=L)===null||B===void 0?void 0:B.isFailure)||((V=L)===null||V===void 0?void 0:V.isCancelled);return ne&&L.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),L}return L=u.createTile(C,T,O),v=!0,L}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=kl(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,nr.Z)(o.value,2),l=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(l),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"pruneRequests",value:function(){var t=[],o=kl(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&t.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=ga(t,o,p),x=this.tiles.filter(function(E){return E.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"destroy",value:function(){var t=kl(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(l){t.e(l)}finally{t.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=kl(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(O){u.e(O)}finally{u.f()}var v=kl(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.isCurrent=!0,E.isVisible=!0}}catch(O){v.e(O)}finally{v.f()}var C=Array.from(this.cacheTiles.values());typeof t=="function"?t(C):zh[t](C);var T=!1;Array.from(this.cacheTiles.values()).forEach(function(O){O.isVisible!==o.get(O.key)?(O.isVisibleChange=!0,T=!0):O.isVisibleChange=!1}),T&&this.emit("tile-update")}},{key:"getTileIndices",value:function(t,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),E=Math.ceil(this.options.minZoom),C=uu({maxZoom:x,minZoom:E,zoomOffset:v,tileSize:l,zoom:t,latLonBounds:o,extent:p});return C}},{key:"getTileId",value:function(t,o,u){var l="".concat(t,",").concat(o,",").concat(u);return l}},{key:"getTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=new nd({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=vp*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=kl(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,nr.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(E){u.e(E)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=kl(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(E){t.e(E)}finally{t.f()}var l=kl(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(E){l.e(E)}finally{l.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(t,o,u);if(l)return l}return null}}]),r}(yp()),Ae;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ae||(Ae={}));function $e(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*(o-1))/(o-1)),n?vr(e,i,l,n,t):vr(e,i,l,.314,t)}function $t(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Cr(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Yt(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=Cr(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),l=o+r,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function vr(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=Yt(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject($t(p,r),$t(v,r))),[0])}else{var x=Yt(e,i,n),E=[e[0],x[0],i[0]],C=[e[1],x[1],i[1]];return[$t(E,r),$t(C,r),0]}}function Pr(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*29)/29),Xr(e,i,l,t)}function Fr(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),l=t+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function Nr(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Wr(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function Xr(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=Fr(t,o),l=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[Nr(l,r),Nr(p,r),0]}else{var v=Wr(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),E=Math.sin(r*v)/Math.sin(v),C=[Math.sin(t[0]),Math.sin(t[1])],T=[Math.cos(t[0]),Math.cos(t[1])],O=[Math.sin(o[0]),Math.sin(o[1])],L=[Math.cos(o[0]),Math.cos(o[1])],B=x*T[1]*T[0]+E*L[1]*L[0],V=x*T[1]*C[0]+E*L[1]*O[0],ne=x*C[1]+E*O[1];return[radiansToDegrees(Math.atan2(V,B)),radiansToDegrees(Math.atan2(ne,Math.sqrt(B*B+V*V)))]}}function ln(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],l=Gr(o,u),p=r;r+=l,n.push({p1:o,p2:u,totalDistance:r,distance:l,lastTotalDistance:p})}for(var v=r*i,x,E,C=0,T=n;C<T.length;C++){var O=T[C],L=O.totalDistance;if(L>v){var B=O.p1,V=O.p2,ne=(v-O.lastTotalDistance)/O.distance,ie=zr(V,B,ne);x=ie[0],E=ie[1];break}}return{lng:x,lat:E,height:0}}function zr(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function Gr(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function At(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=Zr(t,i);return _objectSpread(_objectSpread({},t),o)})}function ar(e,i){return new Promise(function(r){e.inited?r(At(e,i)):e.once("update",function(){r(At(e,i))})})}function Zr(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var E=x[0],C=x[1],T=typeof t=="string"?e[t]||0:t,O;switch(n){case"arc":O=arcLineAtOffset;break;case"greatcircle":O=greatCircleLineAtOffset;break;default:O=arcLineAtOffset}var L=O(E,C,r,T,o,l,v),B=_slicedToArray(L,3),V=B[0],ne=B[1],ie=B[2];return{lng:V,lat:ne,height:ie}}function on(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||Kp(e)?u([e]):Mr(e,function(l){u(l)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Mr(e,i){var r=e,n=[];if(typeof r=="string")nu({url:r},function(u,l){l&&(n.push(l),i(n))});else{var t=r.length,o=0;r.forEach(function(u){nu({url:u},function(l,p){o++,p&&n.push(p),o===t&&i(n)})})}return on}var $r=se(38929),vn=se(3614),Kn=se.n(vn),mr=function(){function e(i,r,n,t){(0,vt.Z)(this,e),(0,X.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new $r.VectorTile(new(Kn())(i))}return(0,_t.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);t.push((0,Y.Z)((0,Y.Z)({},l),{},{properties:(0,Y.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Er={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Dn=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=uh(r,n),p.abrupt("return",new Promise(function(v){var x=Xn((0,Y.Z)((0,Y.Z)({},o),{},{url:u}),function(E,C){if(E||!C)v(void 0);else{var T=new mr(C,t.x,t.y,t.z);v(T)}});t.xhrCancel=function(){return x.abort()}}));case 2:case"end":return p.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function cn(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,l){return Dn(r,u,l,i==null?void 0:i.requestParameters)},t=(0,Y.Z)((0,Y.Z)((0,Y.Z)({},Er),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Ur(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,l,p=e[i],v=e[i+1],x=e[r],E=e[r+1],C=i+3;C<r;C+=3){var T=pn(e[C],e[C+1],p,v,x,E);if(T>t)l=C,t=T;else if(T===t){var O=Math.abs(C-o);O<u&&(l=C,u=O)}}t>n&&(l-i>3&&Ur(e,i,l,n),e[l+2]=t,r-l>3&&Ur(e,l,r,n))}function pn(e,i,r,n,t,o){var u=t-r,l=o-n;if(u!==0||l!==0){var p=((e-r)*u+(i-n)*l)/(u*u+l*l);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=l*p)}return u=e-r,l=i-n,u*u+l*l}function un(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return ki(t),t}function ki(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")di(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)di(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)di(e,i[n][t])}function di(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function fn(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)mn(r,e.features[n],i,n);else e.type==="Feature"?mn(r,e,i):mn(r,{geometry:e},i);return r}function mn(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")li(t,l);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)li(t[v],l);else if(o==="LineString")bi(t,l,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)l=[],bi(t[v],l,u,!1),e.push(un(p,"LineString",l,i.properties));return}else Ui(t,l,u,!1);else if(o==="Polygon")Ui(t,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];Ui(t[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)mn(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(un(p,o,l,i.properties))}}function li(e,i){i.push(ro(e[0])),i.push(co(e[1])),i.push(0)}function bi(e,i,r,n){for(var t,o,u=0,l=0;l<e.length;l++){var p=ro(e[l][0]),v=co(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,Ur(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function Ui(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];bi(e[t],o,r,n),i.push(o)}}function ro(e){return e/360+.5}function co(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Ti(e,i,r,n,t,o,u,l){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],E=x.geometry,C=x.type,T=t===0?x.minX:x.minY,O=t===0?x.maxX:x.maxY;if(T>=r&&O<n){p.push(x);continue}else if(O<r||T>=n)continue;var L=[];if(C==="Point"||C==="MultiPoint")ls(E,L,r,n,t);else if(C==="LineString")Ha(E,L,r,n,t,!1,l.lineMetrics);else if(C==="MultiLineString")yo(E,L,r,n,t,!1);else if(C==="Polygon")yo(E,L,r,n,t,!0);else if(C==="MultiPolygon")for(var B=0;B<E.length;B++){var V=[];yo(E[B],V,r,n,t,!0),V.length&&L.push(V)}if(L.length){if(l.lineMetrics&&C==="LineString"){for(B=0;B<L.length;B++)p.push(un(x.id,C,L[B],x.tags));continue}(C==="LineString"||C==="MultiLineString")&&(L.length===1?(C="LineString",L=L[0]):C="MultiLineString"),(C==="Point"||C==="MultiPoint")&&(C=L.length===3?"Point":"MultiPoint"),p.push(un(x.id,C,L,x.tags))}}return p.length?p:null}function ls(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Ha(e,i,r,n,t,o,u){for(var l=Wo(e),p=t===0?Xo:xs,v=e.start,x,E,C=0;C<e.length-3;C+=3){var T=e[C],O=e[C+1],L=e[C+2],B=e[C+3],V=e[C+4],ne=t===0?T:O,ie=t===0?B:V,ke=!1;u&&(x=Math.sqrt(Math.pow(T-B,2)+Math.pow(O-V,2))),ne<r?ie>r&&(E=p(l,T,O,B,V,r),u&&(l.start=v+x*E)):ne>n?ie<n&&(E=p(l,T,O,B,V,n),u&&(l.start=v+x*E)):zo(l,T,O,L),ie<r&&ne>=r&&(E=p(l,T,O,B,V,r),ke=!0),ie>n&&ne<=n&&(E=p(l,T,O,B,V,n),ke=!0),!o&&ke&&(u&&(l.end=v+x*E),i.push(l),l=Wo(e)),u&&(v+=x)}var Fe=e.length-3;T=e[Fe],O=e[Fe+1],L=e[Fe+2],ne=t===0?T:O,ne>=r&&ne<=n&&zo(l,T,O,L),Fe=l.length-3,o&&Fe>=3&&(l[Fe]!==l[0]||l[Fe+1]!==l[1])&&zo(l,l[0],l[1],l[2]),l.length&&i.push(l)}function Wo(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function yo(e,i,r,n,t,o){for(var u=0;u<e.length;u++)Ha(e[u],i,r,n,t,o,!1)}function zo(e,i,r,n){e.push(i),e.push(r),e.push(n)}function Xo(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function xs(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function _o(e,i){var r=i.buffer/i.extent,n=e,t=Ti(e,1,-1-r,r,0,-1,2,i),o=Ti(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Ti(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=Mi(t,1).concat(n)),o&&(n=n.concat(Mi(o,-1)))),n}function Mi(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Io(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<t.geometry.length;l++)u.push(Io(t.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<t.geometry.length;l++){for(var p=[],v=0;v<t.geometry[l].length;v++)p.push(Io(t.geometry[l][v],i));u.push(p)}r.push(un(t.id,o,u,t.tags))}return r}function Io(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function ia(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(ns(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var E=[];for(l=0;l<v[u].length;l+=2)E.push(ns(v[u][l],v[u][l+1],i,r,n,t));p.geometry.push(E)}}return e.transformed=!0,e}function ns(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function gi(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,Gi(u,e[l],o,t);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,E=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),E>u.maxY&&(u.maxY=E)}return u}function Gi(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<t.length;l+=3)u.push(t[l]),u.push(t[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")pa(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<t.length;l++)pa(u,t[l],e,r,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(l=0;l<v.length;l++)pa(u,v[l],e,r,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var E in i.tags)x[E]=i.tags[E];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var C={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(C.id=i.id),e.features.push(C)}}function pa(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,l.push(i[p]),l.push(i[p+1])),r.numPoints++;t&&Po(l,o),e.push(l)}function Po(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=l}}function Il(e,i){return new ze(e,i)}function ze(e,i){i=this.options=Zt(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=fn(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=_o(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}ze.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ze.prototype.splitTile=function(e,i,r,n,t,o,u){for(var l=[e,i,r,n],p=this.options,v=p.debug;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,E=Jt(i,r,n),C=this.tiles[E];if(!C&&(v>1&&console.time("creation"),C=this.tiles[E]=gi(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,C.numFeatures,C.numPoints,C.numSimplified),console.timeEnd("creation"));var T="z"+i;this.stats[T]=(this.stats[T]||0)+1,this.total++}if(C.source=e,t){if(i===p.maxZoom||i===t)continue;var O=1<<t-i;if(r!==Math.floor(o/O)||n!==Math.floor(u/O))continue}else if(i===p.indexMaxZoom||C.numPoints<=p.indexMaxPoints)continue;if(C.source=null,e.length!==0){v>1&&console.time("clipping");var L=.5*p.buffer/p.extent,B=.5-L,V=.5+L,ne=1+L,ie,ke,Fe,ut,St,Lt;ie=ke=Fe=ut=null,St=Ti(e,x,r-L,r+V,0,C.minX,C.maxX,p),Lt=Ti(e,x,r+B,r+ne,0,C.minX,C.maxX,p),e=null,St&&(ie=Ti(St,x,n-L,n+V,1,C.minY,C.maxY,p),ke=Ti(St,x,n+B,n+ne,1,C.minY,C.maxY,p),St=null),Lt&&(Fe=Ti(Lt,x,n-L,n+V,1,C.minY,C.maxY,p),ut=Ti(Lt,x,n+B,n+ne,1,C.minY,C.maxY,p),Lt=null),v>1&&console.timeEnd("clipping"),l.push(ie||[],i+1,r*2,n*2),l.push(ke||[],i+1,r*2,n*2+1),l.push(Fe||[],i+1,r*2+1,n*2),l.push(ut||[],i+1,r*2+1,n*2+1)}}},ze.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=Jt(e,i,r);if(this.tiles[l])return ia(this.tiles[l],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,E;!E&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),E=this.tiles[Jt(p,v,x)];return!E||!E.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(E.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[l]?ia(this.tiles[l],t):null)};function Jt(e,i,r){return((1<<e)*r+i)*32+e}function Zt(e,i){for(var r in i)e[r]=i[r];return e}var Mn=function(){function e(i,r,n,t){(0,vt.Z)(this,e),(0,X.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=i}return(0,_t.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Wi={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Oe(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function ge(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Oe(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var it=["Unknown","Point","LineString","Polygon"];function It(e,i,r,n,t){var o=t.geometry,u=t.type,l=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,E=e*r,C=it[u],T,O;function L(ne){for(var ie=0;ie<ne.length;ie++){var ke=ne[ie];if(ke[3])break;var Fe=180-(ke[1]+E)*360/v,ut=(ke[0]+x)*360/v-180,St=360/Math.PI*Math.atan(Math.exp(Fe*Math.PI/180))-90;ne[ie]=[ut,St,0,1]}}switch(u){case 1:var B=[];for(T=0;T<o.length;T++)B[T]=o[T][0];o=B,L(o);break;case 2:for(T=0;T<o.length;T++)L(o[T]);break;case 3:for(o=ge(o),T=0;T<o.length;T++)for(O=0;O<o[T].length;O++)L(o[T][O]);break}o.length===1?o=o[0]:C="Multi"+C;var V={type:"Feature",geometry:{type:C,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return V}var Ht=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=v?v.features.map(function(T){return It(o,t.x,t.y,t.z,T)}):[],E={layers:{defaultLayer:{features:x}}},C=new Mn(E,r.x,r.y,r.z);p(C)}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function ct(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,Y.Z)((0,Y.Z)({},i),e.geojsonvtOptions)}function Xe(e,i){var r=ct(i),n=r.extent||4096,t=Il(e,r),o=function(p,v){return Ht(v,t,p,n)},u=(0,Y.Z)((0,Y.Z)((0,Y.Z)({},Wi),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function xt(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Te(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(T){return T.rasterData}),u=n*t,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),E=et(x,o,v);if(typeof E=="number")l.push(E);else{var C=Mt(x);l.push(C)}}return l}function et(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:et(n,i,r)}})}function Be(e){var i=(0,nr.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,t,u]}function Mt(e){var i=Be(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=Mt(e[1])),Array.isArray(t)&&(t=Mt(e[2])),xt(r,n,t)}var Ut={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Ir}};function Ir(e,i){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,nr.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||nn(r,p,v),E=(i==null?void 0:i.GMinMax)||nn(n,p,v),C=(i==null?void 0:i.BMinMax)||nn(t,p,v),T=0;T<r.length;T++)o.push(Math.max(0,r[T]-x[0])),o.push(Math.max(0,n[T]-E[0])),o.push(Math.max(0,t[T]-C[0]));return{rasterData:o,rMinMax:x,gMinMax:E,bMinMax:C}}function nn(e,i,r){var n=e.slice().sort(function(l,p){return l-p}),t=n.length,o=n[Math.ceil(t*i/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function an(e,i,r){return gn.apply(this,arguments)}function gn(){return gn=(0,be.Z)($().mark(function e(i,r,n){var t,o,u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(i.length!==0){E.next=2;break}return E.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return E.next=4,Promise.all(i.map(function(C){var T=C.data,O=C.bands,L=O===void 0?[0]:O;return r(T,L)}));case 4:t=E.sent,o=[],t.forEach(function(C){Array.isArray(C)?o.push.apply(o,(0,W.Z)(C)):o.push(C)}),u=o[0],l=u.width,p=u.height,E.t0=(0,Me.Z)(n),E.next=E.t0==="function"?11:E.t0==="object"?13:15;break;case 11:return v=n(o),E.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Te(n,o)}:v=Jr(n,o),E.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return E.abrupt("return",(0,Y.Z)((0,Y.Z)({},v),{},{width:l,height:p}));case 17:case"end":return E.stop()}},e)})),gn.apply(this,arguments)}function Jr(e,i){var r=Ut[e.type];if(r.type==="function")return r.method(i,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?Nn(r.expression,i):{rasterData:Te(r.expression,i)}}function Nn(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Te(e.r||["band",0],i),n=Te(e.g||["band",0],i),t=Te(e.b||["band",0],i);return[r,n,t]}function xn(e,i,r,n){return Pn.apply(this,arguments)}function Pn(){return Pn=(0,be.Z)($().mark(function e(i,r,n,t){var o;return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,an(i,r,n);case 2:o=l.sent,t(null,{data:o});case 4:case"end":return l.stop()}},e)})),Pn.apply(this,arguments)}function Fn(e,i){return e.map(function(r){return r[i]*1})}function kn(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function hi(e){return Array.isArray(e)?e.length===0?!1:!!kn(e[0]):!1}function Aa(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function cs(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,E;if(l===void 0||Aa(e))v=Array.from(e),x=n,E=t;else{var C=Array.isArray(e)?e:[e];v=an(C,l,p)}var T={_id:1,dataArray:[{_id:1,data:v,width:x,height:E,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return T}var Ji=se(81253),Ea=["extent","min","max","width","height","format","operation"];function Pl(e,i){var r=i.extent,n=i.min,t=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,Ji.Z)(i,Ea),x;if(l===void 0||Aa(e))x=Array.from(e);else{var E=Array.isArray(e)?e:[e];x=an(E,l,p)}var C={_id:1,dataArray:[(0,Y.Z)((0,Y.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return C}var Hs=se(28660),sn=se(86700),Ou=se(84879),tr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Lu=se(31745),Cc=se.n(Lu);function Nf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Rv(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Rv(e,i){if(!!e){if(typeof e=="string")return $o(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $o(e,i)}}function $o(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var nf=30;function af(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,E=x===void 0?0:x,C=0,T=v;Array.from(i).forEach(function(L,B){if(!l[L]){var V=r(L,B);T+nf>o&&(T=0,C++),l[L]={x:T,y:E+C*nf,width:nf,height:nf,advance:V},T+=nf}});var O=n+t*2;return{mapping:l,xOffset:T,yOffset:E+C*O,canvasHeight:ad(E+(C+1)*O)}}function id(e,i,r){var n=0,t=0,o=0,u=[],l={},p=Nf(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var E=x.size;n+E+i>r&&(xp(l,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+E+i,o=Math.max(o,E)}}}catch(T){p.e(T)}finally{p.f()}u.length>0&&xp(l,u,t);var C=ad(o+t+i);return{mapping:l,canvasHeight:C}}function xp(e,i,r){var n=Nf(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,l=o.xOffset;e[u.id]=(0,Y.Z)((0,Y.Z)({},u),{},{x:l,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function ad(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var fh,Ac;function jd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ov(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Ov(e,i){if(!!e){if(typeof e=="string")return Lv(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lv(e,i)}}function Lv(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bs(e){var i=zf();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function zf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fv=Q(),a="sans-serif",s="normal",c=24,m=3,_=.25,S=8,A=1024,P=1,D=1,U=3,G=null;function Q(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function oe(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function ve(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Ve=(fh=(0,sn.b2)(),fh(Ac=function(e){(0,pr.Z)(r,e);var i=bs(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"fontAtlas",void 0),(0,X.Z)((0,Le.Z)(n),"iconFontMap",void 0),(0,X.Z)((0,Le.Z)(n),"iconFontGlyphs",{}),(0,X.Z)((0,Le.Z)(n),"fontOptions",void 0),(0,X.Z)((0,Le.Z)(n),"key",void 0),(0,X.Z)((0,Le.Z)(n),"cache",new I(U)),n}return(0,_t.Z)(r,[{key:"scale",get:function(){return D}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:a,fontWeight:s,characterSet:Fv,fontSize:c,buffer:m,sdf:!0,cutoff:_,radius:S,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Y.Z)((0,Y.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(t,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,E=l.buffer,C=l.sdf,T=l.radius,O=l.cutoff,L=l.iconfont,B=u&&u.data;B||(B=ha.document.createElement("canvas"),B.width=A);var V=B.getContext("2d",{willReadFrequently:!0});oe(V,p,x,v);var ne=af((0,Y.Z)({getFontWidth:function(Yo){return V.measureText(Yo).width},fontHeight:x*D,buffer:E,characterSet:o,maxCanvasWidth:A},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),ie=ne.mapping,ke=ne.canvasHeight,Fe=ne.xOffset,ut=ne.yOffset,St=V.getImageData(0,0,B.width,B.height);if(B.height=ke,V.putImageData(St,0,0),oe(V,p,x,v),C){var Lt=new(Cc())(x,E,T,O,p,v),zt=V.getImageData(0,0,Lt.size,Lt.size),dr=jd(o),cr;try{for(dr.s();!(cr=dr.n()).done;){var Br=cr.value;if(L){var _n=String.fromCharCode(parseInt(Br.replace("&#x","").replace(";",""),16)),Zn=Lt.draw(_n);ve(Zn,zt)}else ve(Lt.draw(Br),zt);V.putImageData(zt,ie[Br].x,ie[Br].y)}}catch(wo){dr.e(wo)}finally{dr.f()}}else{var qi=jd(o),Ta;try{for(qi.s();!(Ta=qi.n()).done;){var xo=Ta.value;V.fillText(xo,ie[xo].x,ie[xo].y+x*P)}}catch(wo){qi.e(wo)}finally{qi.f()}}return{xOffset:Fe,yOffset:ut,mapping:ie,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){return"key";var t,o,u,l,p,v,x,E}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(E){v.has(E)||l.push(E)}),l}}]),r}(lu.EventEmitter))||Ac),Ge,lt;function Je(e){var i=Ct();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Ct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vt=3,rr=1024,ir=64,Ar=(Ge=(0,sn.b2)(),Ge(lt=function(e){(0,pr.Z)(r,e);var i=Je(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"canvasHeight",128),(0,X.Z)((0,Le.Z)(n),"texture",void 0),(0,X.Z)((0,Le.Z)(n),"canvas",void 0),(0,X.Z)((0,Le.Z)(n),"iconData",void 0),(0,X.Z)((0,Le.Z)(n),"iconMap",void 0),(0,X.Z)((0,Le.Z)(n),"ctx",void 0),(0,X.Z)((0,Le.Z)(n),"loadingImageCount",0),n}return(0,_t.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ha.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,be.Z)($().mark(function o(u,l){var p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:ir}),this.updateIconMap(),E.next=6,this.loadImage(l);case 6:p=E.sent,v=this.iconData.find(function(C){return C.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return E.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:ir}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var E=l.iconData.find(function(C){return C.id===t});E&&(E.image=v,E.width=v.width,E.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+t))},l.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=rr,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,E=x===void 0?64:x,C=u.height,T=C===void 0?64:C,O=Math.max(E,T),L=O/ir,B=T/L,V=E/L;v&&t.ctx.drawImage(v,l+(ir-V)/2,p+(ir-B)/2,V,B)})}},{key:"updateIconMap",value:function(){var t=id(this.iconData,Vt,rr),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+t))},p.src=t})}}]),r}(lu.EventEmitter))||lt),Sr=se(49685);function tn(){var e=new Sr.WT(16);return Sr.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Yn(e){var i=new Sr.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function An(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ti(e,i,r,n,t,o,u,l,p,v,x,E,C,T,O,L){var B=new Sr.WT(16);return B[0]=e,B[1]=i,B[2]=r,B[3]=n,B[4]=t,B[5]=o,B[6]=u,B[7]=l,B[8]=p,B[9]=v,B[10]=x,B[11]=E,B[12]=C,B[13]=T,B[14]=O,B[15]=L,B}function In(e,i,r,n,t,o,u,l,p,v,x,E,C,T,O,L,B){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=E,e[11]=C,e[12]=T,e[13]=O,e[14]=L,e[15]=B,e}function Bi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yi(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function zn(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],C=i[10],T=i[11],O=i[12],L=i[13],B=i[14],V=i[15],ne=r*l-n*u,ie=r*p-t*u,ke=r*v-o*u,Fe=n*p-t*l,ut=n*v-o*l,St=t*v-o*p,Lt=x*L-E*O,zt=x*B-C*O,dr=x*V-T*O,cr=E*B-C*L,Br=E*V-T*L,_n=C*V-T*B,Zn=ne*_n-ie*Br+ke*cr+Fe*dr-ut*zt+St*Lt;return Zn?(Zn=1/Zn,e[0]=(l*_n-p*Br+v*cr)*Zn,e[1]=(t*Br-n*_n-o*cr)*Zn,e[2]=(L*St-B*ut+V*Fe)*Zn,e[3]=(C*ut-E*St-T*Fe)*Zn,e[4]=(p*dr-u*_n-v*zt)*Zn,e[5]=(r*_n-t*dr+o*zt)*Zn,e[6]=(B*ke-O*St-V*ie)*Zn,e[7]=(x*St-C*ke+T*ie)*Zn,e[8]=(u*Br-l*dr+v*Lt)*Zn,e[9]=(n*dr-r*Br-o*Lt)*Zn,e[10]=(O*ut-L*ke+V*ne)*Zn,e[11]=(E*ke-x*ut-T*ne)*Zn,e[12]=(l*zt-u*cr-p*Lt)*Zn,e[13]=(r*cr-n*zt+t*Lt)*Zn,e[14]=(L*ie-O*Fe-B*ne)*Zn,e[15]=(x*Fe-E*ie+C*ne)*Zn,e):null}function Xi(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],C=i[10],T=i[11],O=i[12],L=i[13],B=i[14],V=i[15];return e[0]=l*(C*V-T*B)-E*(p*V-v*B)+L*(p*T-v*C),e[1]=-(n*(C*V-T*B)-E*(t*V-o*B)+L*(t*T-o*C)),e[2]=n*(p*V-v*B)-l*(t*V-o*B)+L*(t*v-o*p),e[3]=-(n*(p*T-v*C)-l*(t*T-o*C)+E*(t*v-o*p)),e[4]=-(u*(C*V-T*B)-x*(p*V-v*B)+O*(p*T-v*C)),e[5]=r*(C*V-T*B)-x*(t*V-o*B)+O*(t*T-o*C),e[6]=-(r*(p*V-v*B)-u*(t*V-o*B)+O*(t*v-o*p)),e[7]=r*(p*T-v*C)-u*(t*T-o*C)+x*(t*v-o*p),e[8]=u*(E*V-T*L)-x*(l*V-v*L)+O*(l*T-v*E),e[9]=-(r*(E*V-T*L)-x*(n*V-o*L)+O*(n*T-o*E)),e[10]=r*(l*V-v*L)-u*(n*V-o*L)+O*(n*v-o*l),e[11]=-(r*(l*T-v*E)-u*(n*T-o*E)+x*(n*v-o*l)),e[12]=-(u*(E*B-C*L)-x*(l*B-p*L)+O*(l*C-p*E)),e[13]=r*(E*B-C*L)-x*(n*B-t*L)+O*(n*C-t*E),e[14]=-(r*(l*B-p*L)-u*(n*B-t*L)+O*(n*p-t*l)),e[15]=r*(l*C-p*E)-u*(n*C-t*E)+x*(n*p-t*l),e}function Li(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],E=e[10],C=e[11],T=e[12],O=e[13],L=e[14],B=e[15],V=i*u-r*o,ne=i*l-n*o,ie=i*p-t*o,ke=r*l-n*u,Fe=r*p-t*u,ut=n*p-t*l,St=v*O-x*T,Lt=v*L-E*T,zt=v*B-C*T,dr=x*L-E*O,cr=x*B-C*O,Br=E*B-C*L;return V*Br-ne*cr+ie*dr+ke*zt-Fe*Lt+ut*St}function Ni(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=i[8],C=i[9],T=i[10],O=i[11],L=i[12],B=i[13],V=i[14],ne=i[15],ie=r[0],ke=r[1],Fe=r[2],ut=r[3];return e[0]=ie*n+ke*l+Fe*E+ut*L,e[1]=ie*t+ke*p+Fe*C+ut*B,e[2]=ie*o+ke*v+Fe*T+ut*V,e[3]=ie*u+ke*x+Fe*O+ut*ne,ie=r[4],ke=r[5],Fe=r[6],ut=r[7],e[4]=ie*n+ke*l+Fe*E+ut*L,e[5]=ie*t+ke*p+Fe*C+ut*B,e[6]=ie*o+ke*v+Fe*T+ut*V,e[7]=ie*u+ke*x+Fe*O+ut*ne,ie=r[8],ke=r[9],Fe=r[10],ut=r[11],e[8]=ie*n+ke*l+Fe*E+ut*L,e[9]=ie*t+ke*p+Fe*C+ut*B,e[10]=ie*o+ke*v+Fe*T+ut*V,e[11]=ie*u+ke*x+Fe*O+ut*ne,ie=r[12],ke=r[13],Fe=r[14],ut=r[15],e[12]=ie*n+ke*l+Fe*E+ut*L,e[13]=ie*t+ke*p+Fe*C+ut*B,e[14]=ie*o+ke*v+Fe*T+ut*V,e[15]=ie*u+ke*x+Fe*O+ut*ne,e}function qn(e,i,r){var n=r[0],t=r[1],o=r[2],u,l,p,v,x,E,C,T,O,L,B,V;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],E=i[5],C=i[6],T=i[7],O=i[8],L=i[9],B=i[10],V=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=E,e[6]=C,e[7]=T,e[8]=O,e[9]=L,e[10]=B,e[11]=V,e[12]=u*n+x*t+O*o+i[12],e[13]=l*n+E*t+L*o+i[13],e[14]=p*n+C*t+B*o+i[14],e[15]=v*n+T*t+V*o+i[15]),e}function aa(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function fo(e,i,r,n){var t=n[0],o=n[1],u=n[2],l=Math.hypot(t,o,u),p,v,x,E,C,T,O,L,B,V,ne,ie,ke,Fe,ut,St,Lt,zt,dr,cr,Br,_n,Zn,qi;return l<Sr.Ib?null:(l=1/l,t*=l,o*=l,u*=l,p=Math.sin(r),v=Math.cos(r),x=1-v,E=i[0],C=i[1],T=i[2],O=i[3],L=i[4],B=i[5],V=i[6],ne=i[7],ie=i[8],ke=i[9],Fe=i[10],ut=i[11],St=t*t*x+v,Lt=o*t*x+u*p,zt=u*t*x-o*p,dr=t*o*x-u*p,cr=o*o*x+v,Br=u*o*x+t*p,_n=t*u*x+o*p,Zn=o*u*x-t*p,qi=u*u*x+v,e[0]=E*St+L*Lt+ie*zt,e[1]=C*St+B*Lt+ke*zt,e[2]=T*St+V*Lt+Fe*zt,e[3]=O*St+ne*Lt+ut*zt,e[4]=E*dr+L*cr+ie*Br,e[5]=C*dr+B*cr+ke*Br,e[6]=T*dr+V*cr+Fe*Br,e[7]=O*dr+ne*cr+ut*Br,e[8]=E*_n+L*Zn+ie*qi,e[9]=C*_n+B*Zn+ke*qi,e[10]=T*_n+V*Zn+Fe*qi,e[11]=O*_n+ne*Zn+ut*qi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function ho(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],E=i[10],C=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=l*t+E*n,e[7]=p*t+C*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=E*t-l*n,e[11]=C*t-p*n,e}function po(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],E=i[10],C=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=l*t-E*n,e[3]=p*t-C*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=l*n+E*t,e[11]=p*n+C*t,e}function qa(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],E=i[6],C=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=l*t+E*n,e[3]=p*t+C*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=E*t-l*n,e[7]=C*t-p*n,e}function So(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function fs(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hs(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),l,p,v;return u<Sr.Ib?null:(u=1/u,n*=u,t*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*l,e[2]=o*n*v-t*l,e[3]=0,e[4]=n*t*v-o*l,e[5]=t*t*v+p,e[6]=o*t*v+n*l,e[7]=0,e[8]=n*o*v+t*l,e[9]=t*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ws(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Es(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xs(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ro(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=n+n,p=t+t,v=o+o,x=n*l,E=n*p,C=n*v,T=t*p,O=t*v,L=o*v,B=u*l,V=u*p,ne=u*v;return e[0]=1-(T+L),e[1]=E+ne,e[2]=C-V,e[3]=0,e[4]=E-ne,e[5]=1-(x+L),e[6]=O+B,e[7]=0,e[8]=C+V,e[9]=O-B,e[10]=1-(x+T),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ss(e,i){var r=new Sr.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=n*n+t*t+o*o+u*u;return E>0?(r[0]=(l*u+x*n+p*o-v*t)*2/E,r[1]=(p*u+x*t+v*n-l*o)*2/E,r[2]=(v*u+x*o+l*t-p*n)*2/E):(r[0]=(l*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-l*o)*2,r[2]=(v*u+x*o+l*t-p*n)*2),Ro(e,i,r),e}function ea(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Ua(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function Fa(e,i){var r=new Sr.WT(3);Ua(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,l=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,E=i[6]*o,C=i[8]*n,T=i[9]*t,O=i[10]*o,L=u+x+O,B=0;return L>0?(B=Math.sqrt(L+1)*2,e[3]=.25*B,e[0]=(E-T)/B,e[1]=(C-p)/B,e[2]=(l-v)/B):u>x&&u>O?(B=Math.sqrt(1+u-x-O)*2,e[3]=(E-T)/B,e[0]=.25*B,e[1]=(l+v)/B,e[2]=(C+p)/B):x>O?(B=Math.sqrt(1+x-u-O)*2,e[3]=(C-p)/B,e[0]=(l+v)/B,e[1]=.25*B,e[2]=(E+T)/B):(B=Math.sqrt(1+O-u-x)*2,e[3]=(l-v)/B,e[0]=(C+p)/B,e[1]=(E+T)/B,e[2]=.25*B),e}function da(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3],p=t+t,v=o+o,x=u+u,E=t*p,C=t*v,T=t*x,O=o*v,L=o*x,B=u*x,V=l*p,ne=l*v,ie=l*x,ke=n[0],Fe=n[1],ut=n[2];return e[0]=(1-(O+B))*ke,e[1]=(C+ie)*ke,e[2]=(T-ne)*ke,e[3]=0,e[4]=(C-ie)*Fe,e[5]=(1-(E+B))*Fe,e[6]=(L+V)*Fe,e[7]=0,e[8]=(T+ne)*ut,e[9]=(L-V)*ut,e[10]=(1-(E+O))*ut,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function cu(e,i,r,n,t){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,E=l+l,C=o*v,T=o*x,O=o*E,L=u*x,B=u*E,V=l*E,ne=p*v,ie=p*x,ke=p*E,Fe=n[0],ut=n[1],St=n[2],Lt=t[0],zt=t[1],dr=t[2],cr=(1-(L+V))*Fe,Br=(T+ke)*Fe,_n=(O-ie)*Fe,Zn=(T-ke)*ut,qi=(1-(C+V))*ut,Ta=(B+ne)*ut,xo=(O+ie)*St,wo=(B-ne)*St,Yo=(1-(C+L))*St;return e[0]=cr,e[1]=Br,e[2]=_n,e[3]=0,e[4]=Zn,e[5]=qi,e[6]=Ta,e[7]=0,e[8]=xo,e[9]=wo,e[10]=Yo,e[11]=0,e[12]=r[0]+Lt-(cr*Lt+Zn*zt+xo*dr),e[13]=r[1]+zt-(Br*Lt+qi*zt+wo*dr),e[14]=r[2]+dr-(_n*Lt+Ta*zt+Yo*dr),e[15]=1,e}function Ds(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,l=n+n,p=t+t,v=r*u,x=n*u,E=n*l,C=t*u,T=t*l,O=t*p,L=o*u,B=o*l,V=o*p;return e[0]=1-E-O,e[1]=x+V,e[2]=C-B,e[3]=0,e[4]=x-V,e[5]=1-v-O,e[6]=T+L,e[7]=0,e[8]=C+B,e[9]=T-L,e[10]=1-v-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function no(e,i,r,n,t,o,u){var l=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*l,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function Zo(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var Is=Zo;function Sa(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Tc(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Fu(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Mc=Fu;function Uo(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function kc(e,i,r,n){var t,o,u,l,p,v,x,E,C,T,O=i[0],L=i[1],B=i[2],V=n[0],ne=n[1],ie=n[2],ke=r[0],Fe=r[1],ut=r[2];return Math.abs(O-ke)<Sr.Ib&&Math.abs(L-Fe)<Sr.Ib&&Math.abs(B-ut)<Sr.Ib?Bi(e):(x=O-ke,E=L-Fe,C=B-ut,T=1/Math.hypot(x,E,C),x*=T,E*=T,C*=T,t=ne*C-ie*E,o=ie*x-V*C,u=V*E-ne*x,T=Math.hypot(t,o,u),T?(T=1/T,t*=T,o*=T,u*=T):(t=0,o=0,u=0),l=E*u-C*o,p=C*t-x*u,v=x*o-E*t,T=Math.hypot(l,p,v),T?(T=1/T,l*=T,p*=T,v*=T):(l=0,p=0,v=0),e[0]=t,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=E,e[7]=0,e[8]=u,e[9]=v,e[10]=C,e[11]=0,e[12]=-(t*O+o*L+u*B),e[13]=-(l*O+p*L+v*B),e[14]=-(x*O+E*L+C*B),e[15]=1,e)}function Rl(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=t-r[0],E=o-r[1],C=u-r[2],T=x*x+E*E+C*C;T>0&&(T=1/Math.sqrt(T),x*=T,E*=T,C*=T);var O=p*C-v*E,L=v*x-l*C,B=l*E-p*x;return T=O*O+L*L+B*B,T>0&&(T=1/Math.sqrt(T),O*=T,L*=T,B*=T),e[0]=O,e[1]=L,e[2]=B,e[3]=0,e[4]=E*B-C*L,e[5]=C*O-x*B,e[6]=x*L-E*O,e[7]=0,e[8]=x,e[9]=E,e[10]=C,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function Zh(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hh(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Uh(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Ic(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Vh(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function od(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function jh(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function ph(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],E=e[9],C=e[10],T=e[11],O=e[12],L=e[13],B=e[14],V=e[15],ne=i[0],ie=i[1],ke=i[2],Fe=i[3],ut=i[4],St=i[5],Lt=i[6],zt=i[7],dr=i[8],cr=i[9],Br=i[10],_n=i[11],Zn=i[12],qi=i[13],Ta=i[14],xo=i[15];return Math.abs(r-ne)<=Sr.Ib*Math.max(1,Math.abs(r),Math.abs(ne))&&Math.abs(n-ie)<=Sr.Ib*Math.max(1,Math.abs(n),Math.abs(ie))&&Math.abs(t-ke)<=Sr.Ib*Math.max(1,Math.abs(t),Math.abs(ke))&&Math.abs(o-Fe)<=Sr.Ib*Math.max(1,Math.abs(o),Math.abs(Fe))&&Math.abs(u-ut)<=Sr.Ib*Math.max(1,Math.abs(u),Math.abs(ut))&&Math.abs(l-St)<=Sr.Ib*Math.max(1,Math.abs(l),Math.abs(St))&&Math.abs(p-Lt)<=Sr.Ib*Math.max(1,Math.abs(p),Math.abs(Lt))&&Math.abs(v-zt)<=Sr.Ib*Math.max(1,Math.abs(v),Math.abs(zt))&&Math.abs(x-dr)<=Sr.Ib*Math.max(1,Math.abs(x),Math.abs(dr))&&Math.abs(E-cr)<=Sr.Ib*Math.max(1,Math.abs(E),Math.abs(cr))&&Math.abs(C-Br)<=Sr.Ib*Math.max(1,Math.abs(C),Math.abs(Br))&&Math.abs(T-_n)<=Sr.Ib*Math.max(1,Math.abs(T),Math.abs(_n))&&Math.abs(O-Zn)<=Sr.Ib*Math.max(1,Math.abs(O),Math.abs(Zn))&&Math.abs(L-qi)<=Sr.Ib*Math.max(1,Math.abs(L),Math.abs(qi))&&Math.abs(B-Ta)<=Sr.Ib*Math.max(1,Math.abs(B),Math.abs(Ta))&&Math.abs(V-xo)<=Sr.Ib*Math.max(1,Math.abs(V),Math.abs(xo))}var sd=Ni,ud=Ic,Pc,Gh,Hh=(Pc=(0,sn.b2)(),Pc(Gh=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"viewport",void 0),(0,X.Z)(this,"overridedViewProjectionMatrix",void 0),(0,X.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,X.Z)(this,"jitteredProjectionMatrix",void 0),(0,X.Z)(this,"viewMatrixInverse",void 0),(0,X.Z)(this,"cameraPosition",void 0)}return(0,_t.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=tn(),zn(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,nr.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=So(tn(),[r,n,0]);this.jitteredProjectionMatrix=Ni(tn(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ni(tn(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Gh),bu;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(bu||(bu={}));var dh,bp;function ld(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ep(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Ep(e,i){if(!!e){if(typeof e=="string")return Wh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wh(e,i)}}function Wh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var cd={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Sp=(dh=(0,sn.b2)(),dh(bp=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"container",void 0),(0,X.Z)(this,"controlCorners",void 0),(0,X.Z)(this,"controlContainer",void 0),(0,X.Z)(this,"scene",void 0),(0,X.Z)(this,"mapsService",void 0),(0,X.Z)(this,"controls",[]),(0,X.Z)(this,"unAddControls",[])}return(0,_t.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(tr.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(tr.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=ld(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Ri("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");r[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=Ri("div",p,t)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,W.Z)(p),[cd[l]])}Object.values(bu).forEach(function(l){o(u(l))})}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&gs(this.controlCorners[r]);this.controlContainer&&gs(this.controlContainer)}}]),e}())||bp),Xh,$h,fd=(Xh=(0,sn.b2)(),Xh($h=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"container",void 0),(0,X.Z)(this,"scene",void 0),(0,X.Z)(this,"mapsService",void 0),(0,X.Z)(this,"markers",[]),(0,X.Z)(this,"markerLayers",[]),(0,X.Z)(this,"unAddMarkers",[]),(0,X.Z)(this,"unAddMarkerLayers",[])}return(0,_t.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(tr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||$h),vh,wp,Yh=(vh=(0,sn.b2)(),vh(wp=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"scene",void 0),(0,X.Z)(this,"mapsService",void 0),(0,X.Z)(this,"popups",[]),(0,X.Z)(this,"unAddPopups",[])}return(0,_t.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,W.Z)(this.popups),(0,W.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(tr.IMapService)}}]),e}())||wp),Cp={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},mh=Cp,qh,gh,Gd={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Dv={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Hd=(qh=(0,sn.b2)(),qh(gh=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"sceneConfigCache",{}),(0,X.Z)(this,"layerConfigCache",{}),(0,X.Z)(this,"layerAttributeConfigCache",{})}return(0,_t.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return mh[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,Y.Z)((0,Y.Z)({},Gd),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,Y.Z)({},(0,yt.merge)({},this.sceneConfigCache[r],Dv,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,Y.Z)((0,Y.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||gh);function oa(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ta(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function Bv(){var e=new Sr.WT(4);return Sr.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function hd(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Vo(e,i,r,n){var t=new Sr.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Rc(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function yg(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function yh(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Nv(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function V0(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Wd(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function of(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Xd(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function pd(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function $d(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Yd(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function qd(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function j0(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function dd(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function G0(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function H0(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function W0(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function X0(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function $0(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function cl(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function Kd(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function Y0(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],E=i[1],C=i[2],T=i[3];return e[0]=E*v-C*p+T*l,e[1]=-(x*v)+C*u-T*o,e[2]=x*p-E*u+T*t,e[3]=-(x*l)+E*o-C*t,e}function sf(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=l+n*(r[3]-l),e}function _g(e,i){i=i||1;var r,n,t,o,u,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=t*t+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function vd(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function Kh(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],l=r[1],p=r[2],v=r[3],x=v*n+l*o-p*t,E=v*t+p*n-u*o,C=v*o+u*t-l*n,T=-u*n-l*t-p*o;return e[0]=x*v+T*-u+E*-p-C*-l,e[1]=E*v+T*-l+C*-u-x*-p,e[2]=C*v+T*-p+x*-l-E*-u,e[3]=i[3],e}function Ap(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Tp(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Mp(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function kp(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var q0=null,K0=null,Q0=null,J0=null,zv=null,Zv=null,Zf=null,em=function(){var e=Bv();return function(i,r,n,t,o,u){var l,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,l=n;l<p;l+=r)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),Ip=Math.PI/180,Qd=512,Jd=4003e4;function md(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},E=Qd*o,C=Math.cos(r*Ip),T=E/360,O=T/C,L=E/Jd/C;if(x.pixelsPerMeter=[L,-L,L],x.metersPerPixel=[1/L,-1/L,1/L],x.pixelsPerDegree=[T,-O,L],x.degreesPerPixel=[1/T,-1/O,1/L],l){var B=Ip*Math.tan(r*Ip)/C,V=T*B/2,ne=E/Jd*B,ie=ne/O*L;x.pixelsPerDegree2=[0,-V,ne],x.pixelsPerMeter2=[ie,0,ie],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var uf;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(uf||(uf={}));var Uf={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},gd,ev,Qh,yd,Pp,tm=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Uv=(gd=(0,sn.b2)(),ev=(0,sn.f3)(tr.ICameraService),gd(Qh=(yd=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"needRefresh",!0),oa(this,"cameraService",Pp,this),(0,X.Z)(this,"coordinateSystem",void 0),(0,X.Z)(this,"viewportCenter",void 0),(0,X.Z)(this,"viewportCenterProjection",void 0),(0,X.Z)(this,"pixelsPerDegree",void 0),(0,X.Z)(this,"pixelsPerDegree2",void 0),(0,X.Z)(this,"pixelsPerMeter",void 0)}return(0,_t.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=md({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===uf.LNGLAT||this.coordinateSystem===uf.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===uf.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===uf.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=md({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),E=this.cameraService.getProjectionMatrix(),C=Ni([],E,x),T=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=vd([],[T[0],T[1],0,1],C),x=this.cameraService.getViewMatrixUncentered()||x,C=Ni([],E,x),C=Ni([],C,tm),this.cameraService.setViewProjectionMatrix(C),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),Pp=ta(yd.prototype,"cameraService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||Qh),rm=se(20396),Rp=se.n(rm),fu;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(fu||(fu={}));var Vv,jv,Gv,tv,Hv;function Oc(e){var i=_d();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function _d(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wv={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Op=(Vv=(0,sn.b2)(),jv=(0,sn.f3)(tr.IMapService),Vv(Gv=(tv=function(e){(0,pr.Z)(r,e);var i=Oc(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"indragging",!1),oa((0,Le.Z)(n),"mapService",Hv,(0,Le.Z)(n)),(0,X.Z)((0,Le.Z)(n),"hammertime",void 0),(0,X.Z)((0,Le.Z)(n),"lastClickTime",0),(0,X.Z)((0,Le.Z)(n),"lastClickXY",[-1,-1]),(0,X.Z)((0,Le.Z)(n),"clickTimer",void 0),(0,X.Z)((0,Le.Z)(n),"$containter",void 0),(0,X.Z)((0,Le.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=Wv[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(fu.Drag,p)}),(0,X.Z)((0,Le.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(fu.Hover,p)}),(0,X.Z)((0,Le.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,X.Z)((0,Le.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,E=v,C=l.type,T=n.mapService.getMapContainer();if(T)if(es)x=x-T.left-0,E=E-T.top-0;else{var O=T.getBoundingClientRect(),L=O.top,B=O.left;x=x-B-T.clientLeft,E=E-L-T.clientTop}var V=n.mapService.containerToLngLat([x,E]);if(C==="click"){if(!es&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(x,E,V);return}if(C==="touch"){n.isDoubleTap(x,E,V);return}C!=="click"&&C!=="dblclick"&&n.emit(fu.Hover,{x,y:E,lngLat:V,type:C,target:l})}),n}return(0,_t.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(fu.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(fu.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(fu.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(fu.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(es)ha.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(Rp()).Manager(t);o.add(new(Rp()).Tap({event:"dblclick",taps:2})),o.add(new(Rp()).Tap({event:"click"})),o.add(new(Rp()).Pan({threshold:0,pointers:0})),o.add(new(Rp()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(es)ha.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,l,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),l=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),l=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),E=x.top,C=x.left;l-=C,p-=E}var T=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:T,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(fu.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",l.emit(fu.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(yp()),Hv=ta(tv.prototype,"mapService",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv))||Gv),Xv=0;function K2(e){if(es)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Xv++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Q2(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(t){if(t!=null&&t.classList){var o;t==null||(o=t.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var H;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(H||(H={}));var xg,bg,Eg,Sg,wg,Cg,Ag,Lp,Tg,Mg,kg,Ig,Pg,J2=(xg=(0,sn.b2)(),bg=(0,sn.f3)(tr.IMapService),Eg=(0,sn.f3)(tr.IRendererService),Sg=(0,sn.f3)(tr.IGlobalConfigService),wg=(0,sn.f3)(tr.IInteractionService),Cg=(0,sn.f3)(tr.ILayerService),xg(Ag=(Lp=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,X.Z)(this,"pickedColors",void 0),(0,X.Z)(this,"pickedTileLayers",[]),oa(this,"mapService",Tg,this),oa(this,"rendererService",Mg,this),oa(this,"configService",kg,this),oa(this,"interactionService",Ig,this),oa(this,"layerService",Pg,this),(0,X.Z)(this,"pickingFBO",void 0),(0,X.Z)(this,"width",0),(0,X.Z)(this,"height",0),(0,X.Z)(this,"alreadyInPicking",!1),(0,X.Z)(this,"pickBufferScale",1),(0,X.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,E=x.readPixels,C=x.getContainer,T=i.getContainerSize(C()),O=T.width,L=T.height;O*=La,L*=La;var B=r.getLayerConfig(),V=B.enableHighlight,ne=B.enableSelect,ie=t*La,ke=o*La;if(ie>O-1*La||ie<0||ke>L-1*La||ke<0)return!1;var Fe=E({x:Math.floor(ie/i.pickBufferScale),y:Math.floor((L-(o+1)*La)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Fe,Fe[0]!==0||Fe[1]!==0||Fe[2]!==0){var ut=Ee(Fe),St=r.layerPickService.getFeatureById(ut);ut!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Lt={x:t,y:o,type:l,lngLat:u,featureId:ut,feature:St,target:p};St&&(v=!0,r.setCurrentPickId(ut),i.triggerHoverOnLayer(r,Lt))}else{var zt={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,Y.Z)((0,Y.Z)({},zt),{},{type:"unpick"})),i.triggerHoverOnLayer(r,zt),r.setCurrentPickId(null)}if(V&&r.layerPickService.highlightPickedFeature(Fe),ne&&l==="click"&&(Fe==null?void 0:Fe.toString())!==[0,0,0,0].toString()){var dr=Ee(Fe);r.getCurrentSelectedId()===null||dr!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Fe),r.setCurrentSelectedId(dr)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return v})}return(0,_t.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=La,v*=La,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.interactionService.on(fu.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,be.Z)($().mark(function n(t,o,u){var l=this,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var T=l.pickBox(t,o);u(T)});case 3:case"end":return C.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(dr){var cr=dr<0?0:dr;return Math.floor(cr*La/t.pickBufferScale)}),u=(0,nr.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],E=this.rendererService,C=E.readPixels,T=E.getContainer,O=this.getContainerSize(T()),L=O.width,B=O.height;if(L*=La,B*=La,l>(L-1)*La/this.pickBufferScale||v<0||p>(B-1)*La/this.pickBufferScale||x<0)return[];for(var V=Math.min(L/this.pickBufferScale,v)-l,ne=Math.min(B/this.pickBufferScale,x)-p,ie=C({x:l,y:Math.floor(B/this.pickBufferScale-(x+1)),width:V,height:ne,data:new Uint8Array(V*ne*4),framebuffer:this.pickingFBO}),ke=[],Fe={},ut=0;ut<ie.length/4;ut=ut+1){var St=ie.slice(ut*4,ut*4+4),Lt=Ee(St);if(Lt!==-1&&!Fe[Lt]){var zt=r.layerPickService.getFeatureById(Lt);ke.push((0,Y.Z)((0,Y.Z)({},zt),{},{pickedFeatureIdx:Lt})),Fe[Lt]=!0}}return ke}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,l=t.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/La,height:r.height/La}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,be.Z)($().mark(function n(t){return $().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=La,o*=La,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,be.Z)($().mark(function n(t){var o=this,u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var E=o.layerService.getRenderList();E.filter(function(C){return C.needPick(t.type)}).reverse().some(function(C){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),C.layerPickService.pickRender(t);var T=o.pickFromPickingFBO(C,t);return o.layerService.pickedLayerId=T?+C.id:-1,T&&!C.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Q2(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),Tg=ta(Lp.prototype,"mapService",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=ta(Lp.prototype,"rendererService",[Eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=ta(Lp.prototype,"configService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=ta(Lp.prototype,"interactionService",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=ta(Lp.prototype,"layerService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp))||Ag),eE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,vt.Z)(this,e),(0,X.Z)(this,"autoStart",void 0),(0,X.Z)(this,"startTime",0),(0,X.Z)(this,"oldTime",0),(0,X.Z)(this,"running",!1),(0,X.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,_t.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Rg,Og,Lg,Fg,$v,Dg,Bg;function tE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function rE(e,i){if(!!e){if(typeof e=="string")return Ng(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ng(e,i)}}function Ng(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function nE(e){var i=iE();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aE=(Rg=(0,sn.b2)(),Og=(0,sn.f3)(tr.IRendererService),Lg=(0,sn.f3)(tr.IMapService),Rg(Fg=($v=function(e){(0,pr.Z)(r,e);var i=nE(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"pickedLayerId",-1),(0,X.Z)((0,Le.Z)(n),"clock",new eE),(0,X.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,X.Z)((0,Le.Z)(n),"layers",[]),(0,X.Z)((0,Le.Z)(n),"layerList",[]),(0,X.Z)((0,Le.Z)(n),"layerRenderID",void 0),(0,X.Z)((0,Le.Z)(n),"sceneInited",!1),(0,X.Z)((0,Le.Z)(n),"animateInstanceCount",0),(0,X.Z)((0,Le.Z)(n),"shaderPicking",!0),(0,X.Z)((0,Le.Z)(n),"enableRender",!0),oa((0,Le.Z)(n),"renderService",Dg,(0,Le.Z)(n)),oa((0,Le.Z)(n),"mapService",Bg,(0,Le.Z)(n)),(0,X.Z)((0,Le.Z)(n),"reRender",(0,yt.throttle)(function(){n.updateLayerRenderList(),n.renderLayers()},32)),(0,X.Z)((0,Le.Z)(n),"throttleRenderLayers",(0,yt.throttle)(function(){n.renderLayers()},16)),n}return(0,_t.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.updateLayerRenderList(),o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,be.Z)($().mark(function o(){var u=this;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,be.Z)($().mark(function x(E){return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(E.startInit){T.next=4;break}return T.next=3,E.init();case 3:u.updateLayerRenderList();case 4:case"end":return T.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(t,o){if(o){var u=o.layerChildren.indexOf(t);u>-1&&o.layerChildren.splice(u,1)}else{var l=this.layers.indexOf(t);l>-1&&this.layers.splice(l,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers(),this.emit("layerChange",this.layers)}},{key:"removeAllLayers",value:function(){this.destroy(),this.renderLayers()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){x.next=2;break}return x.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),u=tE(this.layerList),x.prev=5,u.s();case 7:if((l=u.n()).done){x.next=19;break}if(p=l.value,p.masks.filter(function(E){return E.inited}).length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(){var E=(0,be.Z)($().mark(function C(T){return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:T.render();case 1:case"end":return L.stop()}},C)}));return function(C){return E.apply(this,arguments)}}())),!p.getLayerConfig().enableMultiPassRenderer){x.next=15;break}return x.next=13,p.renderMultiPass();case 13:x.next=17;break;case 15:return x.next=17,p.render();case 17:x.next=7;break;case 19:x.next=24;break;case 21:x.prev=21,x.t0=x.catch(5),u.e(x.t0);case 24:return x.prev=24,u.f(),x.finish(24);case 27:this.alreadyInRendering=!1;case 28:case"end":return x.stop()}},o,this,[[5,21,24,27]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){t.filter(function(o){return o.inited}).map(function(o){o.render()})}},{key:"beforeRenderData",value:function(){var n=(0,be.Z)($().mark(function o(u){var l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderLayer",value:function(){var n=(0,be.Z)($().mark(function o(u){var l=this;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(u.masks.filter(function(x){return x.inited}).length>0&&u.masks.map(function(x){l.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.render()}),!u.getLayerConfig().enableMultiPassRenderer){v.next=6;break}return v.next=4,u.renderMultiPass();case 4:v.next=8;break;case 6:return v.next=8,u.render();case 8:case"end":return v.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=le(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ha.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ha.cancelAnimationFrame(this.layerRenderID)}}]),r}(lu.EventEmitter),Dg=ta($v.prototype,"renderService",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=ta($v.prototype,"mapService",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v))||Fg),oE=function(){function e(i){var r=this;(0,vt.Z)(this,e),(0,X.Z)(this,"name",void 0),(0,X.Z)(this,"type",void 0),(0,X.Z)(this,"scale",void 0),(0,X.Z)(this,"descriptor",void 0),(0,X.Z)(this,"featureBufferLayout",[]),(0,X.Z)(this,"needRescale",!1),(0,X.Z)(this,"needRemapping",!1),(0,X.Z)(this,"needRegenerateVertices",!1),(0,X.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,X.Z)(this,"vertexAttribute",void 0),(0,X.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=r.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,_t.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,W.Z)(r));if(!(0,yt.isNil)(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),sE=["modelType"],uE=["buffer","update","name"],lE=["buffer","update","name"],cE=["buffer","update","name"],rv,zg,Zg,Ug,nm,Vg,fE=(rv={},(0,X.Z)(rv,H.FLOAT,4),(0,X.Z)(rv,H.UNSIGNED_BYTE,1),(0,X.Z)(rv,H.UNSIGNED_SHORT,2),rv),hE=(zg=(0,sn.b2)(),Zg=(0,sn.f3)(tr.IRendererService),zg(Ug=(nm=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"attributesAndIndices",void 0),oa(this,"rendererService",Vg,this),(0,X.Z)(this,"attributes",[]),(0,X.Z)(this,"triangulation",void 0),(0,X.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,_t.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new oE(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,Y.Z)((0,Y.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Fe){return Fe.name===r});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,E=p.size,C=E===void 0?0:E,T=fE[x.type||H.FLOAT];if(v){var O=this.featureLayout,L=O.elements,B=O.sizePerElement,V=L.slice(t,o);if(!V.length)return;var ne=V[0].offset,ie=ne*C*T,ke=V.map(function(Fe,ut){for(var St=Fe.featureIdx,Lt=Fe.vertices,zt=Fe.normals,dr=Lt.length/B,cr=[],Br=0;Br<dr;Br++){var _n=zt?zt.slice(Br*3,Br*3+3):[];cr.push.apply(cr,(0,W.Z)(v(n[St],St,Lt.slice(Br*B,Br*B+B),ut,_n)))}return cr}).reduce(function(Fe,ut){return Fe.push.apply(Fe,(0,W.Z)(ut)),Fe},[]);l.vertexAttribute.updateBuffer({data:ke,offset:ie}),u==null||u.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndicesAscy",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(O){return O.resetDescriptor(),O.descriptor}).filter(function(O){return O}),l=t.modelType,p=(0,Ji.Z)(t,sE),v=this.rendererService,x=v.createAttribute,E=v.createBuffer,C=v.createElements,T={};return new Promise(function(O,L){sh(l,(0,Y.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:r,segmentNumber:n},p)).then(function(B){B.descriptors.forEach(function(ne,ie){if(ne){var ke=ne.buffer,Fe=ne.update,ut=ne.name,St=(0,Ji.Z)(ne,uE),Lt=x((0,Y.Z)({buffer:E(ke)},St));T[ne.name||""]=Lt,o.attributes[ie].vertexAttribute=Lt}}),o.featureLayout=B.featureLayout;var V=C({data:B.indices,type:H.UNSIGNED_INT,count:B.indices.length});o.attributesAndIndices={attributes:T,elements:V,count:null},O(o.attributesAndIndices)}).catch(function(B){console.warn(B),L(B)})})}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(ie){return ie.resetDescriptor(),ie.descriptor}),l=0,p=0,v=[],x=[],E=[],C=3;r.forEach(function(ie,ke){var Fe=o.triangulation(ie,t),ut=Fe.indices,St=Fe.vertices,Lt=Fe.normals,zt=Fe.size,dr=Fe.indexes,cr=Fe.count;typeof cr=="number"&&(p+=cr),ut.forEach(function(qi){x.push(qi+l)}),C=zt;var Br=St.length/zt;o.featureLayout.sizePerElement=C,o.featureLayout.elements.push({featureIdx:ke,vertices:St,normals:Lt,offset:l}),l+=Br;for(var _n=function(Ta){var xo=(Lt==null?void 0:Lt.slice(Ta*3,Ta*3+3))||[],wo=St.slice(Ta*zt,Ta*zt+zt),Yo=0;dr&&dr[Ta]!==void 0&&(Yo=dr[Ta]),u.forEach(function(Ll,kv){if(Ll&&Ll.update){var Bd;(Bd=Ll.buffer.data).push.apply(Bd,(0,W.Z)(Ll.update(ie,ke,wo,Ta,xo,Yo)))}})},Zn=0;Zn<Br;Zn++)_n(Zn)});var T=this.rendererService,O=T.createAttribute,L=T.createBuffer,B=T.createElements,V={};u.forEach(function(ie,ke){if(ie){var Fe=ie.buffer,ut=ie.update,St=ie.name,Lt=(0,Ji.Z)(ie,lE),zt=O((0,Y.Z)({buffer:L(Fe)},Lt));V[ie.name||""]=zt,o.attributes[ke].vertexAttribute=zt}});var ne=B({data:x,type:H.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:V,elements:ne,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(T){return T.resetDescriptor(),T.descriptor}),u=0,l=[],p=3;r.forEach(function(T,O){var L=t.triangulation(T),B=L.indices,V=L.vertices,ne=L.normals,ie=L.size,ke=L.indexes;B.forEach(function(Lt){l.push(Lt+u)}),p=ie;var Fe=V.length/ie;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:O,vertices:V,normals:ne,offset:u}),u+=Fe;for(var ut=function(zt){var dr=(ne==null?void 0:ne.slice(zt*3,zt*3+3))||[],cr=V.slice(zt*ie,zt*ie+ie),Br=0;ke&&ke[zt]!==void 0&&(Br=ke[zt]),o.forEach(function(_n,Zn){if(_n&&_n.update){var qi;(qi=_n.buffer.data).push.apply(qi,(0,W.Z)(_n.update(T,O,cr,zt,dr,Br)))}})},St=0;St<Fe;St++)ut(St)});var v=this.rendererService,x=v.createAttribute,E=v.createBuffer,C={};return o.forEach(function(T,O){if(T){var L=T.buffer,B=T.update,V=T.name,ne=(0,Ji.Z)(T,cE),ie=x((0,Y.Z)({buffer:E(L)},ne));C[T.name||""]=ie,t.attributes[O].vertexAttribute=ie}}),{attributes:C}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(r){return r.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Vg=ta(nm.prototype,"rendererService",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||Ug),im=se(34155);function am(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function om(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Yv(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(l){u={error:l}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function qv(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function sm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var um={exports:{}},Kv={exports:{}},nv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(nv,nv.exports);var Ol={},lm={exports:{}},cm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(cm,cm.exports);var Jh={};Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.fallback=jg,Jh.wrap=Gg;var pE=Jh.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,dE=Jh.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,vE=Jh.hasNextTick=typeof im=="object"&&typeof im.nextTick=="function";function jg(e){setTimeout(e,0)}function Gg(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var iv;pE?iv=queueMicrotask:dE?iv=setImmediate:vE?iv=im.nextTick:iv=jg,Jh.default=Gg(iv),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=cm.exports,n=l(r),t=Jh,o=l(t),u=Ol;function l(E){return E&&E.__esModule?E:{default:E}}function p(E){return(0,u.isAsync)(E)?function(){for(var C=[],T=arguments.length;T--;)C[T]=arguments[T];var O=C.pop(),L=E.apply(this,C);return v(L,O)}:(0,n.default)(function(C,T){var O;try{O=E.apply(this,C)}catch(L){return T(L)}if(O&&typeof O.then=="function")return v(O,T);T(null,O)})}function v(E,C){return E.then(function(T){x(C,null,T)},function(T){x(C,T&&T.message?T:new Error(T))})}function x(E,C,T){try{E(C,T)}catch(O){(0,o.default)(function(L){throw L},O)}}e.exports=i.default}(lm,lm.exports),Object.defineProperty(Ol,"__esModule",{value:!0}),Ol.isAsyncIterable=Ol.isAsyncGenerator=Ol.isAsync=void 0;var mE=lm.exports,gE=yE(mE);function yE(e){return e&&e.__esModule?e:{default:e}}function Hg(e){return e[Symbol.toStringTag]==="AsyncFunction"}function _E(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function xE(e){return typeof e[Symbol.asyncIterator]=="function"}function bE(e){if(typeof e!="function")throw new Error("expected a function");return Hg(e)?(0,gE.default)(e):e}Ol.default=bE,Ol.isAsync=Hg,Ol.isAsyncGenerator=_E,Ol.isAsyncIterable=xE;var Fp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[t-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[t-1]=function(E){for(var C=[],T=arguments.length-1;T-- >0;)C[T]=arguments[T+1];if(E)return x(E);v(C.length>1?C:C[0])},n.apply(u,l)})}return o}e.exports=i.default})(Fp,Fp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=nv.exports,n=p(r),t=Ol,o=p(t),u=Fp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,E){var C=(0,n.default)(x)?[]:{};v(x,function(T,O,L){(0,o.default)(T)(function(B){for(var V,ne=[],ie=arguments.length-1;ie-- >0;)ne[ie]=arguments[ie+1];ne.length<2&&(V=ne,ne=V[0]),C[O]=ne,L(B)})},function(T){return E(T,C)})},3),e.exports=i.default}(Kv,Kv.exports);var fm={exports:{}},Qv={exports:{}},hm={exports:{}},av={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(av,av.exports);var pm={exports:{}},dm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(dm,dm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=nv.exports,n=u(r),t=dm.exports,o=u(t);function u(E){return E&&E.__esModule?E:{default:E}}function l(E){var C=-1,T=E.length;return function(){return++C<T?{value:E[C],key:C}:null}}function p(E){var C=-1;return function(){var O=E.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(E){var C=E?Object.keys(E):[],T=-1,O=C.length;return function L(){var B=C[++T];return B==="__proto__"?L():T<O?{value:E[B],key:B}:null}}function x(E){if((0,n.default)(E))return l(E);var C=(0,o.default)(E);return C?p(C):v(E)}e.exports=i.default}(pm,pm.exports);var ov={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(ov,ov.exports);var vm={exports:{}},sv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(sv,sv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=sv.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,E=!1,C=!1,T=0,O=0;function L(){T>=l||C||x||(C=!0,u.next().then(function(ne){var ie=ne.value,ke=ne.done;if(!(E||x)){if(C=!1,ke){x=!0,T<=0&&v(null);return}T++,p(ie,O,B),O++,L()}}).catch(V))}function B(ne,ie){if(T-=1,!E){if(ne)return V(ne);if(ne===!1){x=!0,E=!0;return}if(ie===n.default||x&&T<=0)return x=!0,v(null);L()}}function V(ne){E||(C=!1,x=!0,v(ne))}L()}e.exports=i.default}(vm,vm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=T(r),t=pm.exports,o=T(t),u=ov.exports,l=T(u),p=Ol,v=vm.exports,x=T(v),E=sv.exports,C=T(E);function T(O){return O&&O.__esModule?O:{default:O}}i.default=function(O){return function(L,B,V){if(V=(0,n.default)(V),O<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!L)return V(null);if((0,p.isAsyncGenerator)(L))return(0,x.default)(L,O,B,V);if((0,p.isAsyncIterable)(L))return(0,x.default)(L[Symbol.asyncIterator](),O,B,V);var ne=(0,o.default)(L),ie=!1,ke=!1,Fe=0,ut=!1;function St(zt,dr){if(!ke)if(Fe-=1,zt)ie=!0,V(zt);else if(zt===!1)ie=!0,ke=!0;else{if(dr===C.default||ie&&Fe<=0)return ie=!0,V(null);ut||Lt()}}function Lt(){for(ut=!0;Fe<O&&!ie;){var zt=ne();if(zt===null){ie=!0,Fe<=0&&V(null);return}Fe+=1,B(zt.value,zt.key,(0,l.default)(St))}ut=!1}Lt()}},e.exports=i.default}(hm,hm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=hm.exports,n=p(r),t=Ol,o=p(t),u=Fp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,E,C,T){return(0,n.default)(E)(x,(0,o.default)(C),T)}i.default=(0,l.default)(v,4),e.exports=i.default}(Qv,Qv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=Qv.exports,n=u(r),t=Fp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(fm,fm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=Kv.exports,n=u(r),t=fm.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(um,um.exports);var Jv=sm(um.exports),Vf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Jv(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,qv([],Yv(n.args),!1)),t(null,i)})},e}(),mm={exports:{}},gm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=nv.exports,n=B(r),t=sv.exports,o=B(t),u=Qv.exports,l=B(u),p=av.exports,v=B(p),x=ov.exports,E=B(x),C=Ol,T=B(C),O=Fp.exports,L=B(O);function B(ke){return ke&&ke.__esModule?ke:{default:ke}}function V(ke,Fe,ut){ut=(0,v.default)(ut);var St=0,Lt=0,zt=ke.length,dr=!1;zt===0&&ut(null);function cr(Br,_n){Br===!1&&(dr=!0),dr!==!0&&(Br?ut(Br):(++Lt===zt||_n===o.default)&&ut(null))}for(;St<zt;St++)Fe(ke[St],St,(0,E.default)(cr))}function ne(ke,Fe,ut){return(0,l.default)(ke,Infinity,Fe,ut)}function ie(ke,Fe,ut){var St=(0,n.default)(ke)?V:ne;return St(ke,(0,T.default)(Fe),ut)}i.default=(0,L.default)(ie,3),e.exports=i.default})(gm,gm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=gm.exports,n=u(r),t=Kv.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(mm,mm.exports);var EE=sm(mm.exports),zP=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return EE(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){return om(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),ym={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=av.exports,n=x(r),t=ov.exports,o=x(t),u=Ol,l=x(u),p=Fp.exports,v=x(p);function x(C){return C&&C.__esModule?C:{default:C}}function E(C,T){if(T=(0,n.default)(T),!Array.isArray(C))return T(new Error("First argument to waterfall must be an array of functions"));if(!C.length)return T();var O=0;function L(V){var ne=(0,l.default)(C[O++]);ne.apply(void 0,V.concat([(0,o.default)(B)]))}function B(V){for(var ne=[],ie=arguments.length-1;ie-- >0;)ne[ie]=arguments[ie+1];if(V!==!1){if(V||O===C.length)return T.apply(void 0,[V].concat(ne));L(ne)}}L([])}i.default=(0,v.default)(E),e.exports=i.default})(ym,ym.exports);var Wg=sm(ym.exports),ZP=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Wg(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,qv([],Yv(n),!1));t(o?null:!1,i)})},e}(),Xg=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Jv(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),SE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Jv(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){return om(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,qv([],Yv(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),wE=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Jv(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return am(n,void 0,void 0,function(){var o;return om(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,qv([],Yv(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),CE=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Wg(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),$g=se(67709),AE=se.n($g),Yg,qg,Kg,Qg,Jg,ey,ty,ry,ny,iy,ay,oy,sy,uy,ly,cy,fy,Du,hy,py,dy,vy,gy,yy,_y,xy,by,Ey,Sy,wy,Cy,Ay,Ty;function TE(e){var i=ME();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function ME(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=(Yg=(0,sn.b2)(),qg=(0,sn.f3)(tr.SceneID),Kg=(0,sn.f3)(tr.IIconService),Qg=(0,sn.f3)(tr.IFontService),Jg=(0,sn.f3)(tr.IControlService),ey=(0,sn.f3)(tr.IGlobalConfigService),ty=(0,sn.f3)(tr.IMapService),ry=(0,sn.f3)(tr.ICoordinateSystemService),ny=(0,sn.f3)(tr.IRendererService),iy=(0,sn.f3)(tr.ILayerService),ay=(0,sn.f3)(tr.ICameraService),oy=(0,sn.f3)(tr.IInteractionService),sy=(0,sn.f3)(tr.IPickingService),uy=(0,sn.f3)(tr.IShaderModuleService),ly=(0,sn.f3)(tr.IMarkerService),cy=(0,sn.f3)(tr.IPopupService),Yg(fy=(Du=function(e){(0,pr.Z)(r,e);var i=TE(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,X.Z)((0,Le.Z)(n),"destroyed",!1),(0,X.Z)((0,Le.Z)(n),"loaded",!1),oa((0,Le.Z)(n),"id",hy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"iconService",py,(0,Le.Z)(n)),oa((0,Le.Z)(n),"fontService",dy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"controlService",vy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"configService",gy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"map",yy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"coordinateSystemService",_y,(0,Le.Z)(n)),oa((0,Le.Z)(n),"rendererService",xy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"layerService",by,(0,Le.Z)(n)),oa((0,Le.Z)(n),"cameraService",Ey,(0,Le.Z)(n)),oa((0,Le.Z)(n),"interactionService",Sy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"pickingService",wy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"shaderModuleService",Cy,(0,Le.Z)(n)),oa((0,Le.Z)(n),"markerService",Ay,(0,Le.Z)(n)),oa((0,Le.Z)(n),"popupService",Ty,(0,Le.Z)(n)),(0,X.Z)((0,Le.Z)(n),"inited",!1),(0,X.Z)((0,Le.Z)(n),"initPromise",void 0),(0,X.Z)((0,Le.Z)(n),"rendering",!1),(0,X.Z)((0,Le.Z)(n),"$container",void 0),(0,X.Z)((0,Le.Z)(n),"canvas",void 0),(0,X.Z)((0,Le.Z)(n),"markerContainer",void 0),(0,X.Z)((0,Le.Z)(n),"hooks",void 0),(0,X.Z)((0,Le.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Mo(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,X.Z)((0,Le.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new SE},n}return(0,_t.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,be.Z)($().mark(function u(){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(fu.Drag,o.addSceneEvent.bind(o));case 9:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,be.Z)($().mark(function u(){var l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l=o.map.getOverlayContainer(),l?o.$container=l:o.$container=K2(o.configService.getSceneConfig(o.id).id||""),!o.$container){x.next=12;break}return o.canvas=Ri("canvas","",o.$container),o.setCanvas(),x.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.initContainer(),AE()(o.$container,o.handleWindowResized),ha.matchMedia&&((p=ha.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),x.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return x.stop()}},u)}))),this.render()}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,be.Z)($().mark(function u(){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(fu.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,be.Z)($().mark(function u(){var l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=t.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(t){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var l=t==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return l}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Ri("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,$g.unbind)(this.$container,this.handleWindowResized),ha.matchMedia){var l;(l=ha.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=La,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=La,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(lu.EventEmitter),hy=ta(Du.prototype,"id",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=ta(Du.prototype,"iconService",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=ta(Du.prototype,"fontService",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=ta(Du.prototype,"controlService",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=ta(Du.prototype,"configService",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=ta(Du.prototype,"map",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=ta(Du.prototype,"coordinateSystemService",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=ta(Du.prototype,"rendererService",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=ta(Du.prototype,"layerService",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ey=ta(Du.prototype,"cameraService",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=ta(Du.prototype,"interactionService",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=ta(Du.prototype,"pickingService",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=ta(Du.prototype,"shaderModuleService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=ta(Du.prototype,"markerService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=ta(Du.prototype,"popupService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du))||fy);function IE(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var PE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function My(e){var i={};return e=e.replace(PE,function(r,n,t){var o=t.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(IE(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var ky,Iy,Py="#define PI 3.14159265359",RE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,OE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,LE=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,FE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,DE=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,BE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,NE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,zE=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,ZE=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,UE=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,VE=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,jE=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,GE=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,HE=/precision\s+(high|low|medium)p\s+float/,WE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,XE=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,$E=(ky=(0,sn.b2)(),ky(Iy=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"moduleCache",{}),(0,X.Z)(this,"rawContentCache",{})}return(0,_t.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Py,fs:Py}),this.registerModule("decode",{vs:RE,fs:""}),this.registerModule("projection",{vs:NE,fs:""}),this.registerModule("project",{vs:BE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:zE}),this.registerModule("lighting",{vs:LE,fs:""}),this.registerModule("light",{vs:OE,fs:""}),this.registerModule("picking",{vs:DE,fs:FE}),this.registerModule("styleMapping",{vs:ZE,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:GE,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:UE,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:VE,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:jE,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var t=n.vs,o=n.fs,u=n.uniforms,l=My(t),p=l.content,v=l.uniforms,x=My(o),E=x.content,C=x.uniforms;this.rawContentCache[r]={fs:E,uniforms:(0,Y.Z)((0,Y.Z)((0,Y.Z)({},v),C),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.processModule(t,[],"vs"),l=u.content,p=u.includeList,v=this.processModule(o,[],"fs"),x=v.content,E=v.includeList,C=x,T=(0,yt.uniq)(p.concat(E).concat(r)).reduce(function(O,L){return(0,Y.Z)((0,Y.Z)({},O),n.rawContentCache[L].uniforms)},{});return HE.test(x)||(C=WE+x),this.moduleCache[r]={fs:C.trim(),uniforms:T,vs:l.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(XE,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var E=o.rawContentCache[x][t];n.push(x);var C=o.processModule(E,n,t),T=C.content;return T});return{content:u,includeList:n}}}]),e}())||Iy),ja=se(66213),ep;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(ep||(ep={}));var Ry,Oy,e0=(Ry=(0,sn.b2)(),Ry(Oy=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"shaderModuleService",void 0),(0,X.Z)(this,"rendererService",void 0),(0,X.Z)(this,"cameraService",void 0),(0,X.Z)(this,"mapService",void 0),(0,X.Z)(this,"interactionService",void 0),(0,X.Z)(this,"layerService",void 0),(0,X.Z)(this,"config",void 0)}return(0,_t.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return ep.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(tr.IRendererService),this.cameraService=r.getContainer().get(tr.ICameraService),this.mapService=r.getContainer().get(tr.IMapService),this.interactionService=r.getContainer().get(tr.IInteractionService),this.layerService=r.getContainer().get(tr.ILayerService),this.shaderModuleService=r.getContainer().get(tr.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Oy),Ly,Fy;function YE(e){var i=qE();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=(Ly=(0,sn.b2)(),Ly(Fy=function(e){(0,pr.Z)(r,e);var i=YE(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){(0,ja.Z)((0,Ye.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(e0))||Fy),Dy,By,Ny,_m,zy;function QE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=JE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function JE(e,i){if(!!e){if(typeof e=="string")return Zy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zy(e,i)}}function Zy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var eS=(Dy=(0,sn.b2)(),By=(0,sn.f3)(tr.IPostProcessor),Dy(Ny=(_m=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"passes",[]),oa(this,"postProcessor",zy,this),(0,X.Z)(this,"layer",void 0),(0,X.Z)(this,"renderFlag",void 0),(0,X.Z)(this,"width",0),(0,X.Z)(this,"height",0)}return(0,_t.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,be.Z)($().mark(function n(){var t,o,u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=QE(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===ep.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),zy=ta(_m.prototype,"postProcessor",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m))||Ny),Uy,Vy;function tS(e){var i=rS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=(Uy=(0,sn.b2)(),Uy(Vy=function(e){(0,pr.Z)(r,e);var i=tS(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"pickingFBO",void 0),(0,X.Z)((0,Le.Z)(n),"layer",void 0),(0,X.Z)((0,Le.Z)(n),"width",0),(0,X.Z)((0,Le.Z)(n),"height",0),(0,X.Z)((0,Le.Z)(n),"alreadyInRendering",!1),(0,X.Z)((0,Le.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,E=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(E))){var C=n.rendererService,T=C.getViewportSize,O=C.readPixels,L=C.useFramebuffer,B=T(),V=B.width,ne=B.height,ie=n.layer.getLayerConfig(),ke=ie.enableHighlight,Fe=ie.enableSelect,ut=p*La,St=v*La;if(!(ut>V||ut<0||St>ne||St<0)){var Lt;L(n.pickingFBO,function(){var zt;if(Lt=O({x:Math.round(ut),y:Math.round(ne-(v+1)*La),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Lt[0]!==0||Lt[1]!==0||Lt[2]!==0){var dr=Ee(Lt),cr=n.layer.getSource().getFeatureById(dr),Br={x:p,y:v,type:E,lngLat:x,featureId:dr,feature:cr};cr&&(n.layer.setCurrentPickId(dr),n.triggerHoverOnLayer(Br))}else{var _n={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+E:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,Y.Z)((0,Y.Z)({},_n),{},{type:"unpick"})),n.triggerHoverOnLayer(_n),n.layer.setCurrentPickId(null)}ke&&n.highlightPickedFeature(Lt),Fe&&E==="click"&&((zt=Lt)===null||zt===void 0?void 0:zt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Lt)})}}}),n}return(0,_t.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){(0,ja.Z)((0,Ye.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),E=x.width,C=x.height;this.pickingFBO=p({color:l({width:E,height:C,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.interactionService.on(fu.Hover,this.pickFromPickingFBO),this.interactionService.on(fu.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(fu.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),E=x.width,C=x.height;this.alreadyInRendering=!0,(this.width!==E||this.height!==C)&&(this.pickingFBO.resize({width:E,height:C}),this.width=E,this.height=C),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var T=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(T),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,nr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,nr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=Ue(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=Ue(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(e0))||Vy),jy,Gy,Hy,xm,Wy,iS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_h=(jy=(0,sn.b2)(),Gy=(0,sn.f3)(tr.IShaderModuleService),jy(Hy=(xm=function(){function e(){(0,vt.Z)(this,e),oa(this,"shaderModuleService",Wy,this),(0,X.Z)(this,"rendererService",void 0),(0,X.Z)(this,"config",void 0),(0,X.Z)(this,"quad",iS),(0,X.Z)(this,"enabled",!0),(0,X.Z)(this,"renderToScreen",!1),(0,X.Z)(this,"model",void 0),(0,X.Z)(this,"name",void 0),(0,X.Z)(this,"optionsToUpdate",{})}return(0,_t.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return ep.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(tr.IRendererService),this.shaderModuleService=r.getContainer().get(tr.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,l=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,E=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:H.FLOAT}),size:2})},uniforms:(0,Y.Z)((0,Y.Z)({u_Texture:null},E),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),E=x.width,C=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var T=(0,Y.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[E,C]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(T.u_BloomFinal=1,T.u_Texture2=n),t.model.draw({uniforms:T})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,Y.Z)((0,Y.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){(0,yt.isNil)(r[t])||(n["u_".concat((0,yt.upperFirst)((0,yt.camelCase)(t)))]=r[t])}),n}}]),e}(),Wy=ta(xm.prototype,"shaderModuleService",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm))||Hy),Xy,$y;function aS(e){var i=oS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function oS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,uS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lS=(Xy=(0,sn.b2)(),Xy($y=function(e){(0,pr.Z)(r,e);var i=aS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:uS,fs:sS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,yt.isNil)(t.bloomRadius)||(o.u_radius=t.bloomRadius),(0,yt.isNil)(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),(0,yt.isNil)(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(_h))||$y),Yy,qy;function cS(e){var i=fS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,pS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dS=(Yy=(0,sn.b2)(),Yy(qy=function(e){(0,pr.Z)(r,e);var i=cS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:pS,fs:hS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,yt.isNil)(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(_h))||qy),Ky,Qy;function vS(e){var i=mS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function mS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,yS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_S=(Ky=(0,sn.b2)(),Ky(Qy=function(e){(0,pr.Z)(r,e);var i=vS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:yS,fs:gS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return(0,yt.isNil)(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(_h))||Qy),Jy,e_;function xS(e){var i=bS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function bS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ES=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,SS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wS=(Jy=(0,sn.b2)(),Jy(e_=function(e){(0,pr.Z)(r,e);var i=xS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:SS,fs:ES});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(_h))||e_),t_,r_;function CS(e){var i=AS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,MS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,kS=(t_=(0,sn.b2)(),t_(r_=function(e){(0,pr.Z)(r,e);var i=CS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:MS,fs:TS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(_h))||r_),n_,i_;function IS(e){var i=PS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function PS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,OS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=(n_=(0,sn.b2)(),n_(i_=function(e){(0,pr.Z)(r,e);var i=IS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:OS,fs:RS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(_h))||i_),a_,o_;function FS(e){var i=DS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,NS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zS=(a_=(0,sn.b2)(),a_(o_=function(e){(0,pr.Z)(r,e);var i=FS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:NS,fs:BS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,Y.Z)((0,Y.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(_h))||o_),s_,u_;function ZS(e){var i=US();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,jS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,GS=(s_=(0,sn.b2)(),s_(u_=function(e){(0,pr.Z)(r,e);var i=ZS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:jS,fs:VS}),this.shaderModuleService.getModule("noise-pass")}}]),r}(_h))||u_),l_,c_;function HS(e){var i=WS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$S=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,YS=(l_=(0,sn.b2)(),l_(c_=function(e){(0,pr.Z)(r,e);var i=HS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:XS,fs:$S}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(_h))||c_),f_,h_,p_,d_,xd,v_,qS=(f_=(0,sn.b2)(),h_=(0,sn.f3)(tr.IRendererService),p_=(0,sn.zY)(),f_(d_=(xd=function(){function e(){(0,vt.Z)(this,e),oa(this,"rendererService",v_,this),(0,X.Z)(this,"passes",[]),(0,X.Z)(this,"readFBO",void 0),(0,X.Z)(this,"writeFBO",void 0)}return(0,_t.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,l=o.height;return t({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,be.Z)($().mark(function n(t,o){var u,l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,be.Z)($().mark(function n(t){var o,u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),v_=ta(xd.prototype,"rendererService",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ta(xd.prototype,"init",[p_],Object.getOwnPropertyDescriptor(xd.prototype,"init"),xd.prototype),xd))||d_),m_,g_;function KS(e){var i=QS();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function QS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=(m_=(0,sn.b2)(),m_(g_=function(e){(0,pr.Z)(r,e);var i=KS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){(0,ja.Z)((0,Ye.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(e0))||g_),y_,__,x_,bm,b_;function ew(e){var i=tw();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rw=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,E_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,nw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function S_(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var iw=1,aw=(y_=(0,sn.b2)(),__=(0,sn.f3)(tr.IShaderModuleService),y_(x_=(bm=function(e){(0,pr.Z)(r,e);var i=ew(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),oa((0,Le.Z)(n),"shaderModuleService",b_,(0,Le.Z)(n)),(0,X.Z)((0,Le.Z)(n),"haltonSequence",[]),(0,X.Z)((0,Le.Z)(n),"accumulatingId",0),(0,X.Z)((0,Le.Z)(n),"frame",0),(0,X.Z)((0,Le.Z)(n),"timer",void 0),(0,X.Z)((0,Le.Z)(n),"sampleRenderTarget",void 0),(0,X.Z)((0,Le.Z)(n),"prevRenderTarget",void 0),(0,X.Z)((0,Le.Z)(n),"outputRenderTarget",void 0),(0,X.Z)((0,Le.Z)(n),"copyRenderTarget",void 0),(0,X.Z)((0,Le.Z)(n),"blendModel",void 0),(0,X.Z)((0,Le.Z)(n),"outputModel",void 0),(0,X.Z)((0,Le.Z)(n),"copyModel",void 0),n}return(0,_t.Z)(r,[{key:"getType",value:function(){return ep.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){(0,ja.Z)((0,Ye.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([S_(v,2),S_(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",rw),this.outputModel=this.createTriangleModel("copy-pass",E_,{blend:{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE_MINUS_SRC_ALPHA,srcAlpha:H.ONE,dstAlpha:H.ONE_MINUS_SRC_ALPHA},equation:{rgb:H.FUNC_ADD,alpha:H.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",E_)}},{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,C=x.height;this.sampleRenderTarget.resize({width:E,height:C}),this.prevRenderTarget.resize({width:E,height:C}),this.outputRenderTarget.resize({width:E,height:C}),this.copyRenderTarget.resize({width:E,height:C}),this.resetFrame(),this.stopAccumulating();var T=t.multiPassRenderer.getPostProcessor().getReadFBO();v(T,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:T}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var O=function L(B){!o.accumulatingId||B!==o.accumulatingId||o.isFinished()||(o.doRender(t),ha.requestAnimationFrame(function(){L(B)}))};this.accumulatingId=iw++,this.timer=ha.setTimeout(function(){O(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,C=x.height,T=t.getLayerConfig(),O=T.jitterScale,L=O===void 0?1:O,B=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((B[0]*2-1)/E*L,(B[1]*2-1)/C*L),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var V=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:V.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var ne=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ne,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ha.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:nw,fs:o});var l=this.shaderModuleService.getModule(t),p=l.vs,v=l.fs,x=l.uniforms,E=this.rendererService,C=E.createAttribute,T=E.createBuffer,O=E.createModel;return O((0,Y.Z)({vs:p,fs:v,attributes:{a_Position:C({buffer:T({data:[-4,-4,4,-4,0,4],type:H.FLOAT}),size:2})},uniforms:(0,Y.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(e0),b_=ta(bm.prototype,"shaderModuleService",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||x_),uv=new sn.W2;uv.bind(tr.IGlobalConfigService).to(Hd).inSingletonScope(),(0,sn.GW)((0,sn.b2)(),lu.EventEmitter),uv.bind(tr.IEventEmitter).to(lu.EventEmitter);var w_=(0,Ou.Z)(uv,!1),Em=function(i){var r=w_.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},UP=function(i){var r=w_.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},ac=uv,ow=0;function sw(){var e=new sn.W2;return e.parent=uv,e.bind(tr.SceneID).toConstantValue("".concat(ow++)),e.bind(tr.IShaderModuleService).to($E).inSingletonScope(),e.bind(tr.ILayerService).to(aE).inSingletonScope(),e.bind(tr.ISceneService).to(kE).inSingletonScope(),e.bind(tr.ICameraService).to(Hh).inSingletonScope(),e.bind(tr.ICoordinateSystemService).to(Uv).inSingletonScope(),e.bind(tr.IInteractionService).to(Op).inSingletonScope(),e.bind(tr.IPickingService).to(J2).inSingletonScope(),e.bind(tr.IControlService).to(Sp).inSingletonScope(),e.bind(tr.IMarkerService).to(fd).inSingletonScope(),e.bind(tr.IIconService).to(Ar).inSingletonScope(),e.bind(tr.IFontService).to(Ve).inSingletonScope(),e.bind(tr.IPopupService).to(Yh).inSingletonScope(),e.bind(tr.INormalPass).to(KE).whenTargetNamed("clear"),e.bind(tr.INormalPass).to(nS).whenTargetNamed("pixelPicking"),e.bind(tr.INormalPass).to(JS).whenTargetNamed("render"),e.bind(tr.INormalPass).to(aw).whenTargetNamed("taa"),e.bind(tr.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(tr.INormalPass,r)}}),e.bind(tr.IPostProcessingPass).to(kS).whenTargetNamed("copy"),e.bind(tr.IPostProcessingPass).to(lS).whenTargetNamed("bloom"),e.bind(tr.IPostProcessingPass).to(dS).whenTargetNamed("blurH"),e.bind(tr.IPostProcessingPass).to(_S).whenTargetNamed("blurV"),e.bind(tr.IPostProcessingPass).to(GS).whenTargetNamed("noise"),e.bind(tr.IPostProcessingPass).to(YS).whenTargetNamed("sepia"),e.bind(tr.IPostProcessingPass).to(wS).whenTargetNamed("colorHalftone"),e.bind(tr.IPostProcessingPass).to(LS).whenTargetNamed("hexagonalPixelate"),e.bind(tr.IPostProcessingPass).to(zS).whenTargetNamed("ink"),e.bind(tr.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(tr.IPostProcessingPass,r);return n.setName(r),n}}),e}function t0(e){var i=new sn.W2;return i.parent=e,i.bind(tr.IStyleAttributeService).to(hE).inSingletonScope(),i.bind(tr.IMultiPassRenderer).to(eS).inSingletonScope(),i.bind(tr.IPostProcessor).to(qS).inSingletonScope(),i}var uw=null;function VP(e){return uw.indexOf(e)}var lw=2,jP=4,cw=64,GP=128,fw=256,hw=512,HP=8192,WP=16384,XP=32768,pw=null,C_=131072,$P=262144,dw=524288,YP=1048576,vw=2097152,qP=4194304,mw=8388608,gw=16777216,yw=null;function r0(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function KP(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],E=[],C=[],T=[r0(i[0],i[1]),r0(i[2],i[3])],O=[r0(l[0],l[1]),r0(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(L){var B=_slicedToArray(L,2),V=B[0],ne=B[1];x.push([].concat(T,[(V+1)*mw+(ne+1)*vw+getShapeIndex(o)*C_+r,(n+512)*dw+(t+512)*cw])),E.push([].concat(O,[p,v])),C.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:E,packedBuffer3:C}}function QP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*yw+r*gw+n*C_+r*pw+n*hw+r*fw+n*lw+r}var lf;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(lf||(lf={}));var io;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(io||(io={}));var tp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(tp||(tp={}));var yn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(yn||(yn={}));var cf;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer"})(cf||(cf={}));var _w=["mapload","mapchange","mapAfterFrameChange"],Dp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},n0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],xw=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:r.x,y:r.y,z:r.z},function(x,E){if(x||E.length===0){v(x);return}E&&xn([{data:E,bands:[0]}],t,o,function(C,T){C?v(C):T&&p(T)})})}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function bw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return uh(r,i)}):e.map(function(r){return{url:uh(r.url,i),bands:r.bands||[0]}}):uh(e,i)}function Ew(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function A_(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var Sw=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o,u){var l,p,v,x,E,C;return $().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(l=Ew(n.url),!(l.length>1)){O.next=15;break}return O.next=4,ww(l,n);case 4:if(p=O.sent,v=p.rasterFiles,x=p.xhrList,E=p.errList,A_(r,x),!(E.length>0)){O.next=12;break}return t(E,null),O.abrupt("return");case 12:xn(v,o,u,t),O.next=17;break;case 15:C=Xn(n,function(L,B){if(L)t(L);else if(B){var V=[{data:B,bands:l[0].bands}];xn(V,o,u,t)}}),A_(r,[C]);case 17:case"end":return O.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function ww(e,i){return Sm.apply(this,arguments)}function Sm(){return Sm=(0,be.Z)($().mark(function e(i,r){var n,t,o,u,l,p,v,x,E,C,T;return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){L.next=20;break}return l=i[u],p=(0,Y.Z)((0,Y.Z)({},r),{},{url:l.url}),v=l.bands,L.next=10,Us((0,Y.Z)((0,Y.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=L.sent,E=x.err,C=x.data,T=x.xhr,E&&o.push(E),t.push(T),n.push({data:C,bands:v});case 17:u++,L.next=4;break;case 20:return L.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return L.stop()}},e)})),Sm.apply(this,arguments)}var Cw=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o,u){var l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:bw(r,n)},v.abrupt("return",new Promise(function(x,E){Sw(t,l,function(C,T){C?E(C):T&&x(T)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),T_=function(){var e=(0,be.Z)($().mark(function i(r,n,t,o){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=Array.isArray(r)?r[0]:r,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||Ud,u=p(l,(0,Y.Z)((0,Y.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||uh,u=v(l,n)),E.abrupt("return",new Promise(function(C,T){var O,L=nu({url:u,type:(o==null||(O=o.requestParameters)===null||O===void 0?void 0:O.type)||"arrayBuffer"},function(B,V){B?T(B):V&&C(V)},o.transformResponse);t.xhrCancel=function(){return L.abort()}}));case 3:case"end":return E.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),M_=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Aw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},JP=[cf.ARRAYBUFFER,cf.RGB];function Tw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Mw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Tw(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||cf.IMAGE;r===cf.RGB&&(r=cf.ARRAYBUFFER);var n=function(u,l){switch(r){case cf.IMAGE:return T_(e,u,l,i);case cf.ARRAYBUFFER:return Cw(e,u,l,(i==null?void 0:i.format)||M_,i==null?void 0:i.operation);case cf.CUSTOMARRAYBUFFER:case cf.CUSTOMRGB:return xw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||M_,i==null?void 0:i.operation);default:return T_(e,u,l,i)}},t=(0,Y.Z)((0,Y.Z)((0,Y.Z)({},Aw),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var kw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Iw=function(){var e=(0,be.Z)($().mark(function i(r){return $().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,nr.Z)(r.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],E={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,textLng:(l+v)/2,textLat:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(E)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function Pw(e,i){var r=function(o){return Iw(o)},n=(0,Y.Z)((0,Y.Z)((0,Y.Z)({},kw),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Rw=se(69848),k_=se.n(Rw);function I_(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=Ow(x),e}var E=new(k_())({radius:n,minZoom:l,maxZoom:o}),C={type:"FeatureCollection",features:[]};return C.features=e.dataArray.map(function(T){return{type:"Feature",geometry:{type:"Point",coordinates:T.coordinates},properties:(0,Y.Z)({},T)}}),E.load(C.features),E}function Ow(e){return e.map(function(i,r){return(0,Y.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Lw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Fw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function P_(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Dw(e){if(e.length===0)throw new Error("mean requires at least one data point");return P_(e)/e.length}var Bw={min:Fw,max:Lw,mean:Dw,sum:P_};function Nw(e){var i=zw();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Zw(e,i){if(Array.isArray(i))return i}var Uw=function(e){(0,pr.Z)(r,e);var i=Nw(r);function r(n,t){var o;return(0,vt.Z)(this,r),o=i.call(this),(0,X.Z)((0,Le.Z)(o),"type","source"),(0,X.Z)((0,Le.Z)(o),"isTile",!1),(0,X.Z)((0,Le.Z)(o),"inited",!1),(0,X.Z)((0,Le.Z)(o),"hooks",{init:new Vf}),(0,X.Z)((0,Le.Z)(o),"parser",{type:"geojson"}),(0,X.Z)((0,Le.Z)(o),"transforms",[]),(0,X.Z)((0,Le.Z)(o),"cluster",!1),(0,X.Z)((0,Le.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,X.Z)((0,Le.Z)(o),"invalidExtent",!1),(0,X.Z)((0,Le.Z)(o),"dataArrayChanged",!1),(0,X.Z)((0,Le.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,_t.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(E){E.id||(E.properties.point_count=1)}),(v||(0,yt.isFunction)(p))&&(x=x.map(function(E){var C=E.id;if(C){var T=o.clusterIndex.getLeaves(C,Infinity),O=T.map(function(V){return V.properties}),L;if((0,yt.isString)(p)&&v){var B=Fn(O,v);L=Bw[p](B)}(0,yt.isFunction)(p)&&(L=p(O)),E.properties.stat=L}else E.properties.point_count=1;return E})),this.data=pe("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=(0,yt.cloneDeep)(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var E=this.data.dataArray.find(function(C){return C._id===t});x.properties=E}return x}else return l==="json"&&p?this.data.dataArray.find(function(C){return C._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,Y.Z)((0,Y.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(l){return l[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,be.Z)($().mark(function o(){var u=this;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(E){x(E)}});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=(0,yt.mergeWith)(this.cfg,t,Zw);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Y.Z)((0,Y.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=pe(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=$l(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new Z((0,Y.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=Se(l)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=I_(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=nl(ks(this.extent),t)),o[0].concat(o[1])}}]),r}(lu.EventEmitter);function Vw(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function R_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function jw(e,i){if(!!e){if(typeof e=="string")return O_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O_(e,i)}}function O_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var wm=6378e3;function Gw(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*wm)*(256<<20)/2,u=Hw(r,t),l=u.gridHash,p=u.gridOffset,v=Yw(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function Hw(e,i){var r=Infinity,n=-Infinity,t,o=R_(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;t=l.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(ie){o.e(ie)}finally{o.f()}var p=(r+n)/2,v=Ww(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},E=R_(e),C;try{for(E.s();!(C=E.n()).done;){var T=C.value,O=T.coordinates[1],L=T.coordinates[0];if(Number.isFinite(O)&&Number.isFinite(L)){var B=Math.floor((O+90)/v.yOffset),V=Math.floor((L+180)/v.xOffset),ne="".concat(B,"-").concat(V);x[ne]=x[ne]||{count:0,points:[]},x[ne].count+=1,x[ne].points.push(T)}}}catch(ie){E.e(ie)}finally{E.f()}return{gridHash:x,gridOffset:v}}function Ww(e,i){var r=Xw(e),n=$w(i,e);return{yOffset:r,xOffset:n}}function Xw(e){return e/wm*(180/Math.PI)}function $w(e,i){return i/wm*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Yw(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=Wl(e[t].points,r.field);v[r.method]=Ef[r.method](x)}return Object.assign(v,{_id:o,coordinates:Fo([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var bd=Math.PI/3,qw=[0,bd,2*bd,3*bd,4*bd,5*bd];function Kw(e){return e[0]}function Qw(e){return e[1]}function Jw(){var e=0,i=0,r=1,n=1,t=Kw,o=Qw,u,l,p;function v(E){var C={},T=[],O,L=E.length;for(O=0;O<L;++O)if(!(isNaN(V=+t.call(null,B=E[O],O,E))||isNaN(ne=+o.call(null,B,O,E)))){var B,V,ne,ie=Math.round(ne=ne/p),ke=Math.round(V=V/l-(ie&1)/2),Fe=ne-ie;if(Math.abs(Fe)*3>1){var ut=V-ke,St=ke+(V<ke?-1:1)/2,Lt=ie+(ne<ie?-1:1),zt=V-St,dr=ne-Lt;ut*ut+Fe*Fe>zt*zt+dr*dr&&(ke=St+(ie&1?1:-1)/2,ie=Lt)}var cr=ke+"-"+ie,Br=C[cr];Br?Br.push(B):(T.push(Br=C[cr]=[B]),Br.x=(ke+(ie&1)/2)*l,Br.y=ie*p)}return T}function x(E){var C=0,T=0;return qw.map(function(O){var L=Math.sin(O)*E,B=-Math.cos(O)*E,V=L-C,ne=B-T;return C=L,T=B,[V,ne]})}return v.hexagon=function(E){return"m"+x(E==null?u:+E).join("l")+"z"},v.centers=function(){for(var E=[],C=Math.round(i/p),T=Math.round(e/l),O=C*p;O<n+u;O+=p,++C)for(var L=T*l+(C&1)*l/2;L<r+l/2;L+=l)E.push([L,O]);return E},v.mesh=function(){var E=x(u).slice(0,4).join("l");return v.centers().map(function(C){return"M"+C+"m"+E}).join("")},v.x=function(E){return arguments.length?(t=E,v):t},v.y=function(E){return arguments.length?(o=E,v):o},v.radius=function(E){return arguments.length?(u=+E,l=u*2*Math.sin(bd),p=u*1.5,v):u},v.size=function(E){return arguments.length?(e=i=0,r=+E[0],n=+E[1],v):[r-e,n-i]},v.extent=function(E){return arguments.length?(e=+E[0][0],i=+E[0][1],r=+E[1][0],n=+E[1][1],v):[[e,i],[r,n]]},v.radius(1)}var eC=6378e3;function tC(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=t/(2*Math.PI*eC)*(256<<20)/2,p=r.map(function(C){var T=Fo(C.coordinates),O=(0,nr.Z)(T,2),L=O[0],B=O[1];return(0,Y.Z)((0,Y.Z)({},C),{},{coordinates:[L,B]})}),v=Jw().radius(l).x(function(C){return C.coordinates[0]}).y(function(C){return C.coordinates[1]}),x=v(p),E={dataArray:x.map(function(C,T){var O;if(i.field&&u){var L=Wl(C,i.field);C[u]=Ef[u](L)}return O={},(0,X.Z)(O,i.method,C[u]),(0,X.Z)(O,"count",C.length),(0,X.Z)(O,"rawData",C),(0,X.Z)(O,"coordinates",[C.x,C.y]),(0,X.Z)(O,"_id",T),O}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return E}function rC(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,Y.Z)((0,Y.Z)({},u),o[l])}),e}function nC(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ke("rasterTile",Mw),Ke("mvt",cn),Ke("geojsonvt",Xe),Ke("testTile",Pw),Ke("geojson",Cn),Ke("image",on),Ke("csv",er),Ke("json",Kt),Ke("raster",cs),Ke("rasterRgb",Pl),ot("cluster",I_),ot("filter",Vw),ot("join",rC),ot("map",nC),ot("grid",Gw),ot("hexagon",tC);var Cm=Uw;function iC(e){var i=aC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L_=function(e){(0,pr.Z)(r,e);var i=iC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),(0,X.Z)((0,Le.Z)(t),"added",!1),(0,X.Z)((0,Le.Z)(t),"eventHandle",function(o){t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,Y.Z)((0,Y.Z)({},t.getDefault()),n),F(["update","onMove","onMapClick"],(0,Le.Z)(t)),t.init(),t}return(0,_t.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:nt.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(tr.IMapService),this.sceneSerive=t.get(tr.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&gs(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&gs(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),Hl(o,"".concat(Ne[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var E=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),C=E.containerHeight,T=E.containerWidth,O=E.bounds;if(!O)return;if(Math.abs(O[0][0])>180||Math.abs(O[1][0])>180){if(x.x>T){var L=this.mapsService.lngLatToContainer([p-360,v]);x.x=L.x}if(x.x<0){var B=this.mapsService.lngLatToContainer([p+360,v]);x.x=B.x}}(x.x>T||x.x<0||x.y>C||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Ri("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}wu(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(E){var C,T,O=((C=t.markerOption)===null||C===void 0?void 0:C.style)&&((T=t.markerOption)===null||T===void 0?void 0:T.style[E]);o&&(o.style[E]=O)}),o.addEventListener("click",function(E){t.onMapClick(E)}),o.addEventListener("click",this.eventHandle),at(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(lu.EventEmitter);function oC(e){var i=sC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eR=function(e){(0,pr.Z)(r,e);var i=oC(r);function r(n){var t,o;return(0,vt.Z)(this,r),o=i.call(this),(0,X.Z)((0,Le.Z)(o),"markers",[]),(0,X.Z)((0,Le.Z)(o),"points",[]),(0,X.Z)((0,Le.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,yt.merge)(o.getDefault(),n),F(["update"],(0,Le.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,_t.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(tr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=nl(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,Y.Z)((0,Y.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,l=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(k_())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,l=t[0].concat(t[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,E=u.markerLayerOption.clusterOption,C=E.field,T=E.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var O,L=u.getLeaves((O=v.properties)===null||O===void 0?void 0:O.cluster_id);if(v.properties.clusterData=L,C&&T){var B=L==null?void 0:L.map(function(Fe){var ut=(0,X.Z)({},C,Fe.properties[C]);return ut}),V=Wl(B,C),ne=Kf(T,V),ie="point_"+T;v.properties[ie]=ne.toFixed(2)}}var ke=u.clusterMarker(v);u.clusterMarkers.push(ke),ke.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new L_({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Wu(this.bbox,o))&&(this.bbox=nl(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Ri("div","l7-marker-cluster"),u=Ri("div","",o),l=Ri("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var E=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return l.textContent=E,o}}]),r}(lu.EventEmitter),tR=se(4157);function uC(e){var i=lC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ed=function(e){(0,pr.Z)(r,e);var i=uC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,Y.Z)((0,Y.Z)({},t.getDefault(n)),n||{}),t}return(0,_t.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var l=(0,nr.Z)(u,2),p=l[0],v=l[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,Y.Z)((0,Y.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(tr.IMapService),this.renderService=t.get(tr.IRendererService),this.layerService=t.get(tr.ILayerService),this.controlService=t.get(tr.IControlService),this.configService=t.get(tr.IGlobalConfigService),this.scene=t.get(tr.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),wu(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;gs(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ri("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Gl(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;wu(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:bu.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:bu.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&Gl(o,u),t&&wu(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];t.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(yp());(0,X.Z)(Ed,"controlCount",0);function cC(e){var i=fC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i0=function(e){(0,pr.Z)(r,e);var i=cC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"isDisable",!1),n}return(0,_t.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ri("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,l=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,l=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&gs(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(Gl(this.button,"l7-button-control--row"),Gl(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=Ri("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,wu(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(gs(this.buttonText),this.buttonText=void 0)}}]),r}(Ed);function hC(e){var i=pC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function pC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F_=function(e){(0,pr.Z)(r,e);var i=hC(r);function r(n,t){var o;return(0,vt.Z)(this,r),o=i.call(this),(0,X.Z)((0,Le.Z)(o),"isShow",!1),(0,X.Z)((0,Le.Z)(o),"timeout",null),(0,X.Z)((0,Le.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Gl(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,Le.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,Le.Z)(o)}),(0,X.Z)((0,Le.Z)(o),"hide",function(){return o.isShow&&(wu(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,Le.Z)(o)}),(0,X.Z)((0,Le.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,X.Z)((0,Le.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,X.Z)((0,Le.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,X.Z)((0,Le.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,X.Z)((0,Le.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,Le.Z)(o)),o}return(0,_t.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(bl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),gs(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,nr.Z)(p,2),E=x[0],C=x[1],T=this.button.getBoundingClientRect(),O=u.getBoundingClientRect(),L=hn(T,O),B=L.left,V=L.right,ne=L.top,ie=L.bottom,ke=!1,Fe=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(T.width+V,"px"):v.includes("right")&&(t.left="".concat(T.width+B,"px")),v.includes("start")?t.top="".concat(ne,"px"):v.includes("end")?t.bottom="".concat(ie,"px"):(t.top="".concat(ne+T.height/2,"px"),Fe=!0,t.transform="translate(".concat(E,"px, calc(").concat(C,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(T.height+ie,"px"):v.includes("bottom")&&(t.top="".concat(T.height+ne,"px")),v.includes("start")?t.left="".concat(B,"px"):v.includes("end")?t.right="".concat(V,"px"):(t.left="".concat(B+T.width/2,"px"),ke=!0,t.transform="translate(calc(".concat(E,"px - 50%), ").concat(C,"px)"))),t.transform="translate(calc(".concat(E,"px - ").concat(ke?"50%":"0%","), calc(").concat(C,"px - ").concat(Fe?"50%":"0%",")");var ut=v.split("-");ut.length&&wu(this.popperDOM,ut.map(function(St){return"l7-popper-".concat(St)}).join(" ")),xl(this.popperDOM,bf(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,l=u===void 0?"":u,p=t.content,v=Ri("div","l7-popper l7-popper-hide ".concat(l)),x=Ri("div","l7-popper-content"),E=Ri("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(E),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(lu.EventEmitter);(0,X.Z)(F_,"conflictPopperList",[]);function dC(e){var i=vC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},gC=function(e){(0,pr.Z)(r,e);var i=dC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,ja.Z)((0,Ye.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t),l=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:l instanceof Element?"bottom":mC[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new F_(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if((0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(i0);function yC(e){var i=_C();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xh;(function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"})(xh||(xh={}));var D_=function(e){(0,pr.Z)(r,e);var i=yC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"selectValue",[]),(0,X.Z)((0,Le.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=Ri("div","l7-select-control-item ".concat(p?xh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=Ri("span");return x.innerText=l.text,v.appendChild(x),v}),(0,X.Z)((0,Le.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,W.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,_t.Z)(r,[{key:"setOptions",value:function(t){(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(xh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(wu(p,xh.ActiveOptionClassName),x&&mc(x,!0)):(Gl(p,xh.ActiveOptionClassName),x&&mc(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),l=Ri("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&wu(l,"l7-select-control--multiple");var p=t.map(function(v,x){var E=u?o.createImageOption(v):o.createNormalOption(v);return E.setAttribute(xh.OptionValueAttrKey,v.value),E.setAttribute(xh.OptionIndexAttrKey,window.String(x)),E.addEventListener("click",o.onItemClick.bind(o,v)),E});return l.append.apply(l,(0,W.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=Ri("div","l7-select-control-item ".concat(o?xh.ActiveOptionClassName:"")),l=Ri("img");l.setAttribute("src",t.img),tl(l),u.appendChild(l);var p=Ri("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=Ri("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=Ri("input");return o.setAttribute("type","checkbox"),t&&mc(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(gC);function xC(e){var i=bC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B_=function(e){(0,pr.Z)(r,e);var i=xC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getDefault",value:function(){return{position:bu.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Ri("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(bl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,l=o.img,p=Ri("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),tl(p),u){var v=Ri("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(Ed),bh=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function N_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function EC(e,i){if(!!e){if(typeof e=="string")return z_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z_(e,i)}}function z_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Z_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Eh=function(){if(typeof document=="undefined")return!1;var e=Z_[0],i={},r=N_(Z_),n;try{for(r.s();!(n=r.n()).done;){var t=n.value,o=t==null?void 0:t[1];if(o in document){var u=N_(t.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,nr.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(E){u.e(E)}finally{u.f()}return i}}}catch(E){r.e(E)}finally{r.f()}return!1}(),U_={change:Eh.fullscreenchange,error:Eh.fullscreenerror},oc={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function l(){oc.off("change",l),n()};oc.on("change",o);var u=i[Eh.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!oc.isFullscreen){i();return}var n=function o(){oc.off("change",o),i()};oc.on("change",n);var t=document[Eh.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return oc.isFullscreen?oc.exit():oc.request(i,r)},onchange:function(i){oc.on("change",i)},onerror:function(i){oc.on("error",i)},on:function(i,r){var n=U_[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=U_[i];n&&document.removeEventListener(n,r,!1)},raw:Eh};Object.defineProperties(oc,{isFullscreen:{get:function(){return Boolean(document[Eh.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[Eh.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Eh.fullscreenEnabled])}}}),Eh||(oc={isEnabled:!1});var Am=oc;function SC(e){var i=wC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CC=function(e){(0,pr.Z)(r,e);var i=SC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),(0,X.Z)((0,Le.Z)(t),"isFullscreen",!1),(0,X.Z)((0,Le.Z)(t),"toggleFullscreen",(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!Am.isEnabled){l.next=3;break}return l.next=3,Am.toggle(t.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,X.Z)((0,Le.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,X.Z)((0,Le.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,E=o.exitTitle;t.isFullscreen?(t.setBtnTitle(E),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(l)),t.emit("fullscreenChange",t.isFullscreen)}),Am.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,_t.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,l=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(l)),(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Hi(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,ja.Z)((0,Ye.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:bh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:bh("l7-icon-exit-fullscreen")})}}]),r}(i0);function AC(e){var i=TC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=function(e){(0,pr.Z)(r,e);var i=AC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"onClick",(0,be.Z)($().mark(function l(){var p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,X.Z)((0,Le.Z)(n),"mergeImage",(0,be.Z)($().mark(function l(){var p,v,x,E,C,T,O,L,B,V,ne,ie,ke,Fe,ut=arguments;return $().wrap(function(Lt){for(;;)switch(Lt.prev=Lt.next){case 0:for(x=n.controlOption.imageType,E=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},C=E.width,T=C===void 0?0:C,O=E.height,L=O===void 0?0:O,B=document.createElement("canvas"),B.width=T,B.height=L,V=B.getContext("2d"),ne=ut.length,ie=new Array(ne),ke=0;ke<ne;ke++)ie[ke]=ut[ke];return Lt.next=9,Promise.all(ie.map(function(zt){return new Promise(function(dr){var cr=new Image;cr.onload=function(){dr(cr)},cr.src=zt})}));case 9:return Fe=Lt.sent,Fe.forEach(function(zt){V==null||V.drawImage(zt,0,0,T,L)}),Lt.abrupt("return",B.toDataURL("image/".concat(x)));case 12:case"end":return Lt.stop()}},l)}))),n}return(0,_t.Z)(r,[{key:"onAdd",value:function(){var t=(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:bh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var t=this.mapsService.exportMap("png"),o=this.scene.exportPng("png");return this.mergeImage(t,o)}}]),r}(i0);function kC(e){var i=IC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=function(e){(0,pr.Z)(r,e);var i=kC(r);function r(n){var t;return(0,vt.Z)(this,r),t=i.call(this,n),(0,X.Z)((0,Le.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,E=v.latitude;!(0,yt.isNaN)(x)&&!(0,yt.isNaN)(E)?o([x,E]):u()},function(l){u(l)})})}),(0,X.Z)((0,Le.Z)(t),"onClick",(0,be.Z)($().mark(function o(){var u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(l=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,_t.Z)(r,[{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:bh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(i0),RC={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-nqiT6Vu948AAAAAAAAAAAAAARQnAQ"},light:{text:"\u6708\u5149\u94F6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*J_wYQL_PaUEAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*U7M9QI1yat4AAAAAAAAAAAAAARQnAQ"},fresh:{text:"\u8349\u8272\u9752",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*T-oBT4hB5ucAAAAAAAAAAAAAARQnAQ"},grey:{text:"\u96C5\u58EB\u7070",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OREXQ4vgQRIAAAAAAAAAAAAAARQnAQ"},graffiti:{text:"\u6D82\u9E26",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*4UApTKmeiy4AAAAAAAAAAAAAARQnAQ"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*0GrCQLtDjNcAAAAAAAAAAAAAARQnAQ"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*uWxqSZQlPkkAAAAAAAAAAAAAARQnAQ"},wine:{text:"\u9171\u7C7D",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*OFPrTbg3an0AAAAAAAAAAAAAARQnAQ"}},OC={normal:{text:"\u6807\u51C6",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*AnfJTbIBJOkAAAAAAAAAAAAAARQnAQ"},light:{text:"\u4EAE",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gnuiQIok9qIAAAAAAAAAAAAAARQnAQ"},dark:{text:"\u6697",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*NwG-TbOlBH0AAAAAAAAAAAAAARQnAQ"},satellite:{text:"\u536B\u661F",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*2X5EQLKul3IAAAAAAAAAAAAAARQnAQ"},outdoors:{text:"\u6237\u5916",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*gXFLRIaBUI0AAAAAAAAAAAAAARQnAQ"}};function LC(e){var i=FC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=function(e){(0,pr.Z)(r,e);var i=LC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,_t.Z)(r,[{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:bh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?OC:RC;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,nr.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,nr.Z)(o,2),p=l[0],v=l[1],x=(u=t[p])!==null&&u!==void 0?u:{},E=x.text,C=x.img;return{text:E!=null?E:p,value:v,img:C,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(D_);function BC(e){var i=NC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V_=function(e){(0,pr.Z)(r,e);var i=BC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,X.Z)((0,Le.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,X.Z)((0,Le.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,_t.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=t.getLayer(l)||t.getLayerByName(l);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:bh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,ja.Z)((0,Ye.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(D_);function zC(e){var i=ZC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UC=function(e){(0,pr.Z)(r,e);var i=zC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"location",[0,0]),(0,X.Z)((0,Le.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,_t.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:bu.BOTTOMLEFT,transform:function(u){var l=(0,nr.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Ri("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(Ed);function VC(e){var i=jC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GC=function(e){(0,pr.Z)(r,e);var i=VC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,X.Z)((0,Le.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,X.Z)((0,Le.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,_t.Z)(r,[{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:bu.BOTTOMRIGHT,name:"zoom",zoomInText:bh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:bh("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Ri("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){bl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,l,p){var v=Ri("button",u,l);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,v.addEventListener("click",p),v}}]),r}(Ed);function HC(e){var i=WC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC=function(e){(0,pr.Z)(r,e);var i=HC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),E=l.containerToLngLat([p,v]),C=Sl([x.lng,x.lat],[E.lng,E.lat]);n.updateScales(C)}),n}return(0,_t.Z)(r,[{key:"getDefault",value:function(t){return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:bu.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Ri("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,l=o.imperial;u&&t&&this.updateMetric(t),l&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){bl(t);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&xl(t,"width: ".concat(p,"px")),u&&(this.mScale=Ri("div","l7-control-scale-line",t)),l&&(this.iScale=Ri("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var l=this.controlOption.maxWidth;t.style.width=Math.round(l*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(Ed);function $C(e){var i=YC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tm=function(e){(0,pr.Z)(r,e);var i=$C(r);function r(n){var t;(0,vt.Z)(this,r),t=i.call(this),(0,X.Z)((0,Le.Z)(t),"isShow",!0),(0,X.Z)((0,Le.Z)(t),"onMouseMove",function(u){var l,p=t.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,E=x===void 0?0:x,C=v.top,T=C===void 0?0:C;t.setPopupPosition(u.clientX-E,u.clientY-T)}),(0,X.Z)((0,Le.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,l=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([l,p]),x=v.x,E=v.y;t.setPopupPosition(x,E)}}),(0,X.Z)((0,Le.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,X.Z)((0,Le.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,X.Z)((0,Le.Z)(t),"update",function(){var u=!!t.lngLat,l=t.popupOption,p=l.className,v=l.style,x=l.maxWidth,E=l.anchor,C=l.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var T=t.mapsService.getMarkerContainer();if(!t.container&&T&&(t.container=Ri("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),T),v&&t.container.setAttribute("style",v),t.tip=Ri("div","l7-popup-tip",t.container),t.container.appendChild(t.content),C&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(B){t.container.addEventListener(B,function(V){V.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),t.updateLngLatPosition(),Hl(t.container,"".concat(Ne[E])),at(t.container,E,"popup"),x){var O=t.container.getBoundingClientRect(),L=O.width;L>parseFloat(x)&&(t.container.style.width=x)}else t.container.style.removeProperty("width")}}),t.popupOption=(0,Y.Z)((0,Y.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,_t.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(tr.IMapService),this.sceneService=t.get(tr.ISceneService),this.layerService=t.get(tr.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!this.isOpen())return this.content&&gs(this.content),this.container&&(gs(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,Y.Z)((0,Y.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(gs(this.container),this.container=void 0),this.popupOption.title&&this.setTitle(this.popupOption.title),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Gl(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&wu(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Ri("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),bl(this.contentTitle),xa(this.contentTitle,t)):this.contentTitle&&(gs(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:nt.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),xa(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&gs(this.content),this.contentTitle=void 0,this.content=Ri("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=bh("l7-icon-guanbi");wu(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){t.hide()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=Ri("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(lu.EventEmitter);function qC(e){var i=KC();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rR=function(e){(0,pr.Z)(r,e);var i=qC(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"layerConfigMap",new WeakMap),n}return(0,_t.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,l=o.items;return(t=u!=null?u:l)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return(0,ja.Z)((0,Ye.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,ja.Z)((0,Ye.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,ja.Z)((0,Ye.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,Y.Z)((0,Y.Z)({},(0,ja.Z)((0,Ye.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption.trigger;this.layerConfigItems.forEach(function(u){var l,p=t.getLayerByConfig(u);if(!!p){var v=(0,Y.Z)({},u);if(o==="hover"){var x=t.onLayerMouseMove.bind(t,p),E=t.onLayerMouseOut.bind(t,p);v.onMouseMove=x,v.onMouseOut=E,p==null||p.on("mousemove",x),p==null||p.on("mouseout",E)}else{var C=t.onLayerClick.bind(t,p);v.onClick=C,p==null||p.on("click",C)}var T=p==null||(l=p.getSource)===null||l===void 0?void 0:l.call(p),O=t.onSourceUpdate.bind(t,p);T==null||T.on("update",O),v.onSourceUpdate=O,t.layerConfigMap.set(p,v)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u=t.getLayerByConfig(o),l=u&&t.layerConfigMap.get(u);if(!!l){var p=l.onMouseMove,v=l.onMouseOut,x=l.onClick,E=l.onSourceUpdate;if(p&&u.off("mousemove",p),v&&u.off("mouseout",v),x&&u.off("click",x),E){var C;u==null||(C=u.getSource())===null||C===void 0||C.off("update",E)}}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,o){if(this.isShow&&this.isSameFeature(t,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setLnglat(o.lngLat),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onSourceUpdate",value:function(t){var o;((o=this.displayFeatureInfo)===null||o===void 0?void 0:o.layer)===t&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var x=u.title,E=u.fields,C=u.customContent;if(x){l=document.createDocumentFragment();var T=x instanceof Function?x(v):x;xa(l,T)}if(C){var O=C instanceof Function?C(v):C;xa(p,O)}else E!=null&&E.length&&(E==null||E.forEach(function(L){var B,V,ne=typeof L=="string"?{field:L}:L,ie=ne.field,ke=ne.formatField,Fe=ne.formatValue,ut=ne.getValue,St=Ri("div","l7-layer-popup__row"),Lt=ut?ut(o.feature):(0,yt.get)(v,ie),zt=(B=ke instanceof Function?ke(ie,v):ke)!==null&&B!==void 0?B:ie,dr=(V=Fe instanceof Function?Fe(Lt,v):Fe)!==null&&V!==void 0?V:Lt,cr=Ri("span","l7-layer-popup__key",St);xa(cr,zt),xa(cr,document.createTextNode("\uFF1A"));var Br=Ri("span","l7-layer-popup__value",St);xa(Br,dr),p.appendChild(St)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(Tm);function QC(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}QC(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var rp,Mm=(rp={},(0,X.Z)(rp,lf.additive,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE,srcAlpha:1,dstAlpha:1}}),(0,X.Z)(rp,lf.none,{enable:!1}),(0,X.Z)(rp,lf.normal,{enable:!0,func:{srcRGB:H.SRC_ALPHA,dstRGB:H.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,X.Z)(rp,lf.subtractive,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE,srcAlpha:H.ZERO,dstAlpha:H.ONE_MINUS_SRC_COLOR},equation:{rgb:H.FUNC_SUBTRACT,alpha:H.FUNC_SUBTRACT}}),(0,X.Z)(rp,lf.max,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE},equation:{rgb:H.MAX_EXT}}),(0,X.Z)(rp,lf.min,{enable:!0,func:{srcRGB:H.ONE,dstRGB:H.ONE},equation:{rgb:H.MIN_EXT}}),rp);function sc(e,i,r,n,t){i.updateStyleAttribute(e,r,n,t)}function JC(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&a0("opacity",i,e.opacity),e.strokeWidth&&a0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&a0("strokeOpacity",i,e.strokeOpacity),e.stroke&&eA("stroke",i,e.stroke),e.offsets&&j_("offsets",i,e.offsets),e.textOffset&&j_("textOffset",i,e.textOffset),e.thetaOffset&&a0("thetaOffset",i,e.thetaOffset))}function a0(e,i,r){(0,yt.isString)(r)?sc(e,i,r,function(n){return n}):(0,yt.isNumber)(r)||(Array.isArray(r)&&r.length===2?(0,yt.isString)(r[0])&&(0,yt.isFunction)(r[1])||(0,yt.isString)(r[0])&&Array.isArray(r[1])&&(0,yt.isNumber)(r[1][0])&&(0,yt.isNumber)(r[1][1])?sc(e,i,r[0],r[1]):sc(e,i,[1],void 0):sc(e,i,[1],void 0))}function j_(e,i,r){(0,yt.isString)(r)?sc(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&(0,yt.isString)(r[0])&&(0,yt.isFunction)(r[1])?sc(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&(0,yt.isNumber)(r[0])&&(0,yt.isNumber)(r[1])?sc(e,i,r,void 0):sc(e,i,[0,0],void 0)}function eA(e,i,r){(0,yt.isString)(r)||(Array.isArray(r)&&r.length===2&&((0,yt.isString)(r[0])&&(0,yt.isFunction)(r[1])||(0,yt.isString)(r[0])&&Array.isArray(r[1])&&r[1].length>0)?sc(e,i,r[0],r[1]):sc(e,i,"#fff",void 0))}var ps;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ps||(ps={}));function tA(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=$c(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function rA(e,i,r){if(e.length>0&&i.version===ps["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ps["GAODE2.x"],t.originCoordinates=(0,yt.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordByLayer(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=ps["GAODE2.x"],t.originCoordinates=(0,yt.cloneDeep)(t.coordinates),t.coordinates=i.lngLatToCoordsByLayer(t.coordinates,n)})}}function nA(e,i){e.length>0&&i.version===ps.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=iA(r.coordinates,i),r.simpleCoordinate=!0)})}function iA(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function aA(e,i){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&t.push(i[p])});var o=e.mapping?e.mapping(t):[];return o}function oA(e,i,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(T){return T.scale!==void 0}).forEach(function(T){var O=aA(T,v);T.needRemapping=!1,T.name==="color"&&(O=O.map(function(L){return le(L)})),x[T.name]=Array.isArray(O)&&O.length===1?O[0]:O,T.name==="shape"&&(x.shape=r.getIconFontKey(x[T.name]))}),x.shape==="line"&&l.enable){var E=x.coordinates,C=tA(E[0],E[1]);x.coordinates.splice(1,0,C,C)}return x});return rA(p,n,t),nA(p,n),p}function sA(e,i,r,n,t,o){var u=new Cm(t,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=oA(l,v,i,r,e);return u.destroy(),x}function G_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function H_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),G_(i).forEach(function(l){var p=(0,nr.Z)(l,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var uA=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function lA(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}uA.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var cA=function(){function e(i){(0,vt.Z)(this,e),this.layer=i}return(0,_t.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(r);n.hooks.beforePickingEncode.call(),n.masks.length>0&&n.masks.filter(function(t){return t.inited}).forEach(function(){var t=(0,be.Z)($().mark(function o(u){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:u.render();case 1:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}()),n.renderModels(!0),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(tr.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(tr.IPickingService),l=o.get(tr.IMapService),p=this.layer.getSource().extent,v=Qf(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},E=t||r;if(v){var C=this.readRasterValue(r,p,l,n.x,n.y);return x.rasterValue=C,u.triggerHoverOnLayer(E,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(E,(0,Y.Z)((0,Y.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(E,x),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var l=r.getSource().data.dataArray[0],p=(0,nr.Z)(n,4),v=p[0],x=v===void 0?0:v,E=p[1],C=E===void 0?0:E,T=p[2],O=T===void 0?10:T,L=p[3],B=L===void 0?-10:L,V=t.lngLatToContainer([x,C]),ne=t.lngLatToContainer([O,B]),ie=ne.x-V.x,ke=V.y-ne.y,Fe=[(o-V.x)/ie,(u-ne.y)/ke],ut=l.width||1,St=l.height||1,Lt=Math.floor(Fe[0]*ut),zt=Math.floor(Fe[1]*St),dr=Math.max(0,zt-1)*ut+Lt,cr=l.data[dr];return cr}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,nr.Z)(r,3),o=t[0],u=t[1],l=t[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,nr.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),fA=function(){function e(i){(0,vt.Z)(this,e),this.layer=i;var r=this.layer.getContainer();this.rendererService=r.get(tr.IRendererService)}return(0,_t.Z)(e,[{key:"getColorTexture",value:function(r){var n=this.getTextureKey(r);return this.key===n?this.colorTexture:(this.createColorTexture(r),this.key=n,this.colorTexture)}},{key:"createColorTexture",value:function(r){var n=this.rendererService.createTexture2D,t=je(r),o=n({data:t.data,width:t.width,height:t.height,flipY:!1});return this.colorTexture=o,o}},{key:"setColorTexture",value:function(r,n){this.key=this.getTextureKey(n),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getTextureKey",value:function(r){return"".concat(r.colors.join("_"),"_").concat(r.positions.join("_"))}}]),e}(),hA=["passes"],pA=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],W_,km,X_;function dA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function vA(e,i){if(!!e){if(typeof e=="string")return $_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $_(e,i)}}function $_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mA(e){var i=gA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y_=0,np=(W_=Em(tr.IGlobalConfigService),km=function(e){(0,pr.Z)(r,e);var i=mA(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vt.Z)(this,r),n=i.call(this),(0,X.Z)((0,Le.Z)(n),"id","".concat(Y_++)),(0,X.Z)((0,Le.Z)(n),"name","".concat(Y_)),(0,X.Z)((0,Le.Z)(n),"visible",!0),(0,X.Z)((0,Le.Z)(n),"zIndex",0),(0,X.Z)((0,Le.Z)(n),"inited",!1),(0,X.Z)((0,Le.Z)(n),"layerModelNeedUpdate",!1),(0,X.Z)((0,Le.Z)(n),"pickedFeatureID",null),(0,X.Z)((0,Le.Z)(n),"selectedFeatureID",null),(0,X.Z)((0,Le.Z)(n),"styleNeedUpdate",!1),(0,X.Z)((0,Le.Z)(n),"forceRender",!1),(0,X.Z)((0,Le.Z)(n),"clusterZoom",0),(0,X.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,X.Z)((0,Le.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,X.Z)((0,Le.Z)(n),"hooks",{init:new wE,afterInit:new Xg,beforeRender:new Xg,beforeRenderData:new CE,afterRender:new Vf,beforePickingEncode:new Vf,afterPickingEncode:new Vf,beforeHighlight:new Vf(["pickedColor"]),afterHighlight:new Vf,beforeSelect:new Vf(["pickedColor"]),afterSelect:new Vf,beforeDestroy:new Vf,afterDestroy:new Vf}),(0,X.Z)((0,Le.Z)(n),"models",[]),(0,X.Z)((0,Le.Z)(n),"startInit",!1),(0,X.Z)((0,Le.Z)(n),"layerChildren",[]),(0,X.Z)((0,Le.Z)(n),"masks",[]),oa((0,Le.Z)(n),"configService",X_,(0,Le.Z)(n)),(0,X.Z)((0,Le.Z)(n),"animateOptions",{enable:!1}),(0,X.Z)((0,Le.Z)(n),"currentPickId",null),(0,X.Z)((0,Le.Z)(n),"pendingStyleAttributes",[]),(0,X.Z)((0,Le.Z)(n),"scaleOptions",{}),(0,X.Z)((0,Le.Z)(n),"animateStatus",!1),(0,X.Z)((0,Le.Z)(n),"isDestroyed",!1),(0,X.Z)((0,Le.Z)(n),"encodeDataLength",0),(0,X.Z)((0,Le.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,_t.Z)(r,[{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=t[l])}),!this.startInit)this.needUpdateConfig=(0,Y.Z)((0,Y.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(tr.SceneID);JC(t,this),this.configService.setLayerConfig(u,this.id,(0,Y.Z)((0,Y.Z)((0,Y.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,be.Z)($().mark(function o(){var u=this,l,p,v,x,E,C,T;return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:l=this.container.get(tr.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(tr.IIconService),this.fontService=this.container.get(tr.IFontService),this.rendererService=this.container.get(tr.IRendererService),this.layerService=this.container.get(tr.ILayerService),this.interactionService=this.container.get(tr.IInteractionService),this.pickingService=this.container.get(tr.IPickingService),this.mapService=this.container.get(tr.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(tr.ICameraService),this.coordinateService=this.container.get(tr.ICoordinateSystemService),this.shaderModuleService=this.container.get(tr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(tr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(tr.IFactoryNormalPass),this.styleAttributeService=this.container.get(tr.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(tr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(B){var V=B.attributeName,ne=B.attributeField,ie=B.attributeValues,ke=B.updateOptions;u.styleAttributeService.updateStyleAttribute(V,{scale:(0,Y.Z)({field:ne},u.splitValuesAndCallbackInAttribute(ie,u.getLayerConfig()[V]))},ke)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(tr.ILayerPlugin),E=dA(this.plugins);try{for(E.s();!(C=E.n()).done;)T=C.value,T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(B){E.e(B)}finally{E.f()}return this.layerPickService=new cA(this),this.textureService=new fA(this),L.next=29,this.hooks.init.promise();case 29:this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 33:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(t,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?sA(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.updateLayerConfig((0,Y.Z)((0,Y.Z)((0,Y.Z)({},this.getDefaultConfig()),this.rawConfig),this.needUpdateConfig));var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){return this.updateStyleAttribute("filter",t,o,u),this}},{key:"shape",value:function(t,o,u){var l,p,v,x=(l=this.styleAttributeService)===null||l===void 0||(p=l.getLayerStyleAttribute("shape"))===null||p===void 0||(v=p.scale)===null||v===void 0?void 0:v.field,E=t;return this.shapeOption={field:t,values:o},this.updateStyleAttribute("shape",t,o,u),this.tileLayer||lA(this,x,E),this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return(0,yt.isObject)(t)?(o.enable=!0,o=(0,Y.Z)((0,Y.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?this.layerSource.setData(t,o):this.on("inited",function(){var l=u.getSource();l?u.layerSource.setData(t,o):u.source(new Cm(t,o))}),this}},{key:"style",value:function(t){var o=this,u=t.passes,l=(0,Ji.Z)(t,hA);return u&&G_(u).forEach(function(p){var v=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);v&&v.updateOptions(p[1])}),this.rawConfig=(0,Y.Z)((0,Y.Z)({},this.rawConfig),l),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(t,o){return(0,yt.isObject)(t)?this.scaleOptions=(0,Y.Z)((0,Y.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this))}},{key:"renderMultiPass",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=(0,yt.isObject)(t)?!0:t,(0,yt.isObject)(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if((0,yt.isObject)(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:(0,yt.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,yt.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,yt.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,yt.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ue(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=(0,yt.isObject)(t)?!0:t,(0,yt.isObject)(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if((0,yt.isObject)(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:(0,yt.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,yt.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,yt.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,yt.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ue(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=H_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,E=v.height;this.multiPassRenderer.resize(x,E)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(p){return p.destroy(!1)}),this.layerChildren=[],this.masks.map(function(p){return p.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(l),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}p==="update"&&o.sourceEvent()})}},{key:"initSource",value:function(t){this.layerSource=t,this.clusterZoom=0,this.addSourceEvent()}},{key:"getSource",value:function(){return this.layerSource}},{key:"addSourceEvent",value:function(){var t=this;this.layerSource.on("update",function(){if(t.coordCenter===void 0){var o,u=t.layerSource.center;t.coordCenter=u,(o=t.mapService)!==null&&o!==void 0&&o.setCoordCenter&&t.mapService.setCoordCenter(u)}t.sourceEvent()})}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,X.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,X.Z)({value:v},t,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!(0,yt.isUndefined)(v)}).map(function(v){return(0,X.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,be.Z)($().mark(function o(u){var l=this,p,v,x,E,C,T,O,L,B,V,ne,ie,ke,Fe;return $().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,E=u.triangulation,C=u.segmentNumber,T=u.workerEnabled,O=T===void 0?!1:T,L=u.workerOptions,B=(0,Ji.Z)(u,pA),this.shaderModuleService.registerModule(p,{vs:v,fs:x}),V=this.shaderModuleService.getModule(p),ne=V.vs,ie=V.fs,ke=V.uniforms,Fe=this.rendererService.createModel,St.abrupt("return",new Promise(function(Lt,zt){if(L&&L.modelType in ef&&O)l.styleAttributeService.createAttributesAndIndicesAscy(l.encodedData,C,L).then(function(Ta){var xo=Ta.attributes,wo=Ta.elements,Yo=Fe((0,Y.Z)({attributes:xo,uniforms:ke,fs:ie,vs:ne,elements:wo,blend:Mm[lf.normal]},B));Lt(Yo)}).catch(function(Ta){return zt(Ta)});else{var dr=l.styleAttributeService.createAttributesAndIndices(l.encodedData,E,C),cr=dr.attributes,Br=dr.elements,_n=dr.count,Zn=(0,Y.Z)({attributes:cr,uniforms:ke,fs:ie,vs:ne,elements:Br,blend:Mm[lf.normal]},B);_n&&(Zn.count=_n);var qi=Fe(Zn);Lt(qi)}}));case 5:case"end":return St.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,be.Z)($().mark(function o(u){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(t){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},t)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,l){["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,X.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,Y.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:l})}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:(0,yt.isFunction)(t)?void 0:t||o,callback:(0,yt.isFunction)(t)?t:void 0}}}]),r}(lu.EventEmitter),X_=ta(km.prototype,"configService",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km),q_,Im,K_;function yA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_A(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function _A(e,i){if(!!e){if(typeof e=="string")return Q_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Q_(e,i)}}function Q_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Da=(q_=Em(tr.IGlobalConfigService),Im=function(){function e(i){(0,vt.Z)(this,e),oa(this,"configService",K_,this),this.layer=i,this.rendererService=i.getContainer().get(tr.IRendererService),this.pickingService=i.getContainer().get(tr.IPickingService),this.shaderModuleService=i.getContainer().get(tr.IShaderModuleService),this.styleAttributeService=i.getContainer().get(tr.IStyleAttributeService),this.mapService=i.getContainer().get(tr.IMapService),this.iconService=i.getContainer().get(tr.IIconService),this.fontService=i.getContainer().get(tr.IFontService),this.cameraService=i.getContainer().get(tr.ICameraService),this.layerService=i.getContainer().get(tr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:H.NEAREST,min:H.NEAREST,width:1,height:1}))}return(0,_t.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return(0,yt.isEqual)(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),(0,yt.isEqual)(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),(0,yt.isEqual)(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),(0,yt.isEqual)(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),(0,yt.isEqual)(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),(0,yt.isEqual)(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!(0,yt.isNumber)(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!(0,yt.isNumber)(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!(0,yt.isNumber)(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!(0,yt.isNumber)(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return(0,yt.isString)(r)?!!(0,J.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=le(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&(0,yt.isNumber)(r[0])&&(0,yt.isNumber)(r[1]))}},{key:"patchMod",value:function(r,n){for(var t=0;t<n;t++)r.push(-1)}},{key:"patchData",value:function(r,n,t){var o=yA(t),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,p=l.attr,v=l.count,x=n[p];x!==void 0?p==="stroke"?r.push.apply(r,(0,W.Z)(le(x))):p==="offsets"?this.isOffsetStatic(x)?r.push(-x[0],x[1]):r.push(0,0):r.push((0,yt.isNumber)(x)?x:1):this.patchMod(r,v)}}catch(E){o.e(E)}finally{o.f()}}},{key:"calDataFrame",value:function(r,n,t){for(var o=n.length,u=Math.ceil(o*r/this.DATA_TEXTURE_WIDTH),l=u*this.DATA_TEXTURE_WIDTH,p=[],v=0;v<o;v++){var x=n[v];this.patchData(p,x,t)}for(var E=p.length;E<l;E++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return Mm[lf[t]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,be.Z)($().mark(function n(){return $().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var i=(0,be.Z)($().mark(function n(){return $().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var i=(0,be.Z)($().mark(function n(){return $().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),K_=ta(Im.prototype,"configService",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im),Pm=100,nR=36,iR=40;function J_(e){return e/180*Math.acos(-1)}function e1(e){var i=J_(e[0])+Math.PI/2,r=J_(e[1]),n=Pm+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function aR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],E=[],C=[],T=[],O=[],L=0;L<=l;L++){for(var B=L/l,V=B*Math.PI,ne=0;ne<=p;ne++){var ie=ne/p,ke=ie*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-V),mat4.identity(r),mat4.rotateY(r,r,ke),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),E.push(o.slice()),C.push.apply(C,_toConsumableArray(o.slice())),vec3.normalize(o,o),T.push.apply(T,_toConsumableArray(o.slice())),O.push([ie,1-B]),C.push(ie,1-B)}if(L>0)for(var Fe=E.length,ut=Fe-2*(p+1);ut+p+2<Fe;ut++)v.push([ut,ut+1,ut+p+1]),x.push(ut,ut+1,ut+p+1),v.push([ut+p+1,ut+1,ut+p+2]),x.push(ut+p+1,ut+1,ut+p+2)}return{cells:v,positions:E,uvs:O,positionsArr:C,indicesArr:x,normalArr:T}}var o0=Vr.create(),oR=Vr.create(),$s=Vr.create(),ip=Vr.create(),Sd=Vr.create();function Rm(e,i,r,n,t){Vr.add(e,r,n),Vr.normalize(e,e),i=Vr.fromValues(-e[1],e[0]);var o=Vr.fromValues(-r[1],r[0]);return[t/Vr.dot(i,o),i]}function ap(e,i){return Vr.set(e,-i[1],i[0])}function wd(e,i,r){return Vr.sub(e,i,r),Vr.normalize(e,e),e}function Om(e,i){return e[0]===i[0]&&e[1]===i[1]}function sR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var xA=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,X.Z)(this,"lastFlip",-1),(0,X.Z)(this,"miter",Vr.fromValues(0,0)),(0,X.Z)(this,"started",!1),(0,X.Z)(this,"dash",!1),(0,X.Z)(this,"totalDistance",0),(0,X.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,_t.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,W.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,V=this.simpleSegment(t,u,E,T,L,C,O,B);u+=V}if(this.dash)for(var ne=0;ne<t.positions.length/6;ne++)t.positions[ne*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,E=r[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var C=n[l-1],T=r[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var O=n[l],L=l<r.length-1?[].concat((0,W.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,B=l<n.length-1?n[l+1]:null,V=this.segment_gaode2(t,u,E,T,L,C,O,B);u+=V}if(this.dash)for(var ne=0;ne<t.positions.length/6;ne++)t.positions[ne*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=Fo([o[0],o[1]]),C=Fo([t[0],t[1]]);wd($s,E,C);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,C),this.totalDistance+=T),this.normal||(this.normal=Vr.create(),ap(this.normal,$s)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)ap(this.normal,$s),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Fo([u[0],u[1]]);Om(E,O)&&Vr.add(O,E,Vr.normalize(O,Vr.subtract(O,E,C))),wd(ip,O,E);var L=Rm(Sd,Vr.create(),$s,ip,this.thickness),B=(0,nr.Z)(L,2),V=B[0],ne=B[1],ie=Vr.dot(Sd,this.normal)<0?-1:1;this.extrusions(v,x,o,ne,V,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,Vr.copy(this.normal,ne),l+=2,this.lastFlip=ie}return l}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,E=r.indices,C=r.positions,T=r.normals,O=this.cap==="square",L=this.join==="bevel",B=Fo([p[0],p[1]]),V=Fo([l[0],l[1]]);wd($s,o,t);var ne=0;if(this.dash&&(ne=this.lineSegmentDistance(B,V),this.totalDistance+=ne),this.normal||(this.normal=Vr.create(),ap(this.normal,$s)),!this.started)if(this.started=!0,O){var ie=Vr.create(),ke=Vr.create();Vr.add(ie,this.normal,$s),Vr.add(ke,this.normal,$s),T.push(ke[0],ke[1],0),T.push(ie[0],ie[1],0),C.push(t[0],t[1],t[2]|0,this.totalDistance-ne,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),C.push(t[0],t[1],t[2]|0,this.totalDistance-ne,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,t,this.normal,this.thickness,this.totalDistance-ne);if(E.push(n+0,n+1,n+2),u){Om(o,u)&&Vr.add(u,o,Vr.normalize(u,Vr.subtract(u,o,t))),wd(ip,u,o);var St=Rm(Sd,Vr.create(),$s,ip,this.thickness),Lt=(0,nr.Z)(St,2),zt=Lt[0],dr=Lt[1],cr=Vr.dot(Sd,this.normal)<0?-1:1,Br=L;if(!Br&&this.join==="miter"){var _n=zt;_n>this.miterLimit&&(Br=!0)}Br?(T.push(this.normal[0],this.normal[1],0),T.push(dr[0],dr[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,W.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),ap(o0,ip),Vr.copy(this.normal,o0),T.push(this.normal[0],this.normal[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(C,T,o,dr,zt,this.totalDistance),E.push.apply(E,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,Vr.copy(this.normal,dr),x+=2),this.lastFlip=cr}else{if(ap(this.normal,$s),O){var Fe=Vr.create(),ut=Vr.create();Vr.sub(ut,$s,this.normal),Vr.add(Fe,$s,this.normal),T.push(ut[0],ut[1],0),T.push(Fe[0],Fe[1],0),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),C.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(C,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,E=this.cap==="square",C=this.join==="bevel",T=Fo([o[0],o[1]]),O=Fo([t[0],t[1]]);wd($s,T,O);var L=0;if(this.dash&&(L=this.lineSegmentDistance(T,O),this.totalDistance+=L),this.normal||(this.normal=Vr.create(),ap(this.normal,$s)),!this.started)if(this.started=!0,E){var B=Vr.create(),V=Vr.create();Vr.add(B,this.normal,$s),Vr.add(V,this.normal,$s),x.push(V[0],V[1],0),x.push(B[0],B[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-L,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-L);if(p.push(n+0,n+1,n+2),u){var ke=Fo([u[0],u[1]]);Om(T,ke)&&Vr.add(ke,T,Vr.normalize(ke,Vr.subtract(ke,T,O))),wd(ip,ke,T);var Fe=Rm(Sd,Vr.create(),$s,ip,this.thickness),ut=(0,nr.Z)(Fe,2),St=ut[0],Lt=ut[1],zt=Vr.dot(Sd,this.normal)<0?-1:1,dr=C;if(!dr&&this.join==="miter"){var cr=St;cr>this.miterLimit&&(dr=!0)}dr?(x.push(this.normal[0],this.normal[1],0),x.push(Lt[0],Lt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,W.Z)(this.lastFlip!==-zt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),ap(o0,ip),Vr.copy(this.normal,o0),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*zt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Lt,St,this.totalDistance),p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),zt=-1,Vr.copy(this.normal,Lt),l+=2),this.lastFlip=zt}else{if(ap(this.normal,$s),E){var ne=Vr.create(),ie=Vr.create();Vr.sub(ie,$s,this.normal),Vr.add(ne,$s,this.normal),x.push(ie[0],ie[1],0),x.push(ne[0],ne[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,W.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),Ka=se(77160);function bA(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=Iu().flatten(e),o=t.vertices,u=t.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=Iu()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,W.Z)(x));for(var E=function(O){var L=t.vertices.slice(O*u,(O+1)*u),B=t.vertices.slice((O+1)*u,(O+2)*u);B.length===0&&(B=t.vertices.slice(0,u));var V=l.length/3;l.push(L[0],L[1],1,B[0],B[1],1,L[0],L[1],0,B[0],B[1],0),p.push.apply(p,(0,W.Z)([0,2,1,2,3,1].map(function(ne){return ne+V})))},C=0;C<n;C++)E(C);return{positions:l,index:p}}function EA(e){var i=Iu().flatten(e),r=Iu()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function t1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=Iu().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],E=0;E<u.length/l;E++)l===2?p.push(u[E*2],u[E*2+1],1,-1,-1):p.push(u[E*3],u[E*3+1],1,-1,-1),x.push(0,0,1);var C=Iu()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,W.Z)(C));for(var T=function(B){var V=o.vertices.slice(B*l,(B+1)*l),ne=o.vertices.slice((B+1)*l,(B+2)*l);ne.length===0&&(ne=o.vertices.slice(0,l));var ie=p.length/5;p.push(V[0],V[1],1,0,0,ne[0],ne[1],1,.1,0,V[0],V[1],0,0,.8,ne[0],ne[1],0,.1,.8);var ke=SA([ne[0],ne[1],1],[V[0],V[1],0],[V[0],V[1],1],i);x.push.apply(x,(0,W.Z)(ke).concat((0,W.Z)(ke),(0,W.Z)(ke),(0,W.Z)(ke))),v.push.apply(v,(0,W.Z)([1,2,0,3,2,1].map(function(Fe){return Fe+ie})))},O=0;O<t;O++)T(O);return{positions:p,index:v,normals:x}}function SA(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=Ka.create(),o=Ka.create(),u=Ka.create();n&&(e=Tu(e),i=Tu(i),r=Tu(r));var l=Ka.fromValues.apply(Ka,(0,W.Z)(e)),p=Ka.fromValues.apply(Ka,(0,W.Z)(i)),v=Ka.fromValues.apply(Ka,(0,W.Z)(r));Ka.sub(t,v,p),Ka.sub(o,l,p),Ka.cross(u,t,o);var x=Ka.create();return Ka.normalize(x,u),x}var Lc,Bp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Bp||(Bp={}));var Np;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Np||(Np={}));function lv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function r1(){return lv(30)}function n1(){return lv(4)}function i1(){return lv(3)}function a1(){return lv(6,1)}function o1(){return lv(5)}var Cd=(Lc={},(0,X.Z)(Lc,Np.CIRCLE,r1),(0,X.Z)(Lc,Np.HEXAGON,a1),(0,X.Z)(Lc,Np.TRIANGLE,i1),(0,X.Z)(Lc,Np.SQUARE,n1),(0,X.Z)(Lc,Np.PENTAGON,o1),(0,X.Z)(Lc,Bp.CYLINDER,r1),(0,X.Z)(Lc,Bp.HEXAGONCOLUMN,a1),(0,X.Z)(Lc,Bp.TRIANGLECOLUMN,i1),(0,X.Z)(Lc,Bp.SQUARECOLUMN,n1),(0,X.Z)(Lc,Bp.PENTAGONCOLUMN,o1),Lc),s0={};function zp(e){var i=g(e.coordinates);return{vertices:[].concat((0,W.Z)(i),(0,W.Z)(i),(0,W.Z)(i),(0,W.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function s1(e){var i=g(e.coordinates),r=e1(i);return{vertices:[].concat((0,W.Z)(r),(0,W.Z)(r),(0,W.Z)(r),(0,W.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Lm(e){var i=e.shape,r=IA(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function wA(e){var i=g(e.coordinates);return{vertices:(0,W.Z)(i),indices:[0],size:i.length}}function Zp(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new xA({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(C){t.extrude(C)})}var E=t.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function CA(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=AA(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function uR(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=TA(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function u1(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function Ad(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function AA(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var r=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],t=Ad(i[0],r);n.push(t);for(var o=1;o<i.length-1;o++){var u=u1(i[o-1],i[o]);r+=u;var l=Ad(i[o],r);n.push(l),n.push(l)}var p=u1(i[i.length-2],i[i.length-1]);return r+=p,n.push(Ad(i[i.length-1],r)),{results:n,totalDistance:r}}function TA(e){if(e.length<2)return{results:e};var i=[],r=Ad(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=Ad(e[n]);i.push(t),i.push(t)}return i.push(Ad(e[e.length-1])),{results:i}}function cv(e){var i=e.coordinates,r=Iu().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Iu()(n,o,t),vertices:n,size:t}}function MA(e){var i=e.coordinates,r=Iu().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:Iu()(n,o,t),vertices:kA(n),size:t+4}}function kA(e){for(var i=[],r=w(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,W.Z)(n),[t]))}return i}function l1(e){var i=e.coordinates,r=t1(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function c1(e){var i=e.shape,r=RA(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function u0(e){var i=e.coordinates,r=[].concat((0,W.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,W.Z)(i[1]),[0,1,0],(0,W.Z)(i[0]),[0,0,1],(0,W.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function l0(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,W.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<r;l++)u(l);return{vertices:t,indices:o,size:7}}function f1(e){var i=e.coordinates;i.length===2&&i.push(0);var r=c0(-1,1),n=c0(1,1),t=c0(-1,-1),o=c0(1,-1),u=[].concat((0,W.Z)(i),(0,W.Z)(r),(0,W.Z)(i),(0,W.Z)(t),(0,W.Z)(i),(0,W.Z)(o),(0,W.Z)(i),(0,W.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function IA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s0&&s0[e])return s0[e];var r=Cd[e]?Cd[e]():Cd.cylinder(),n=t1([r],i);return s0[e]=n,n}function lR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),E=0,C=i.length;E<C;E+=3){o=i[E+0]*3,u=i[E+1]*3,l=i[E+2]*3;var T=[e[o],e[o+1]],O=[e[u],e[u+1]],L=[e[l],e[l+1]];n&&(T=lngLatToMeters(T),O=lngLatToMeters(O),L=lngLatToMeters(L));var B=T,V=_slicedToArray(B,2),ne=V[0],ie=V[1],ke=vec3.fromValues(ne,ie,e[o+2]),Fe=O,ut=_slicedToArray(Fe,2),St=ut[0],Lt=ut[1],zt=vec3.fromValues(St,Lt,e[u+2]),dr=L,cr=_slicedToArray(dr,2),Br=cr[0],_n=cr[1],Zn=vec3.fromValues(Br,_n,e[l+2]);vec3.sub(p,Zn,zt),vec3.sub(v,ke,zt),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[l]+=p[0],t[l+1]+=p[1],t[l+2]+=p[2]}return PA(t),t}function PA(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function cR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function RA(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Cd[e]?Cd[e]():Cd.circle(),n=i.indexOf(e)===-1?EA([r]):bA([r]);return n}function c0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function fR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function hR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function OA(e){var i=LA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,DA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,BA=function(e){(0,pr.Z)(r,e);var i=OA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,E=t.windowColor,C=E===void 0?"rgb(30,60,89)":E,T=t.time,O=T===void 0?0:T,L=t.sweep,B=L===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:L;return{u_cityCenter:B.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*B.sweepRadius,u_circleSweep:B.enable?1:0,u_circleSweepColor:le(B.sweepColor).slice(0,3),u_circleSweepSpeed:B.sweepSpeed,u_opacity:u,u_baseColor:le(p),u_brightColor:le(x),u_windowColor:le(C),u_time:this.layer.getLayerAnimateTime()||O}}},{key:"calCityGeo",value:function(){var t=(0,nr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var E=l-o,C=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(E,2)+Math.pow(C,2))/4}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:DA,fragmentShader:FA,triangulation:l1,depth:{enable:!0},cull:{enable:!0,face:H.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Da);function NA(e){var i=zA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZA=function(e){(0,pr.Z)(r,e);var i=NA(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","CityBuildingLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new BA(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(np);function UA(e){var i=VA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jA=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,GA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,HA=function(e){(0,pr.Z)(r,e);var i=UA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:jA,fragmentShader:GA,triangulation:c1,primitive:H.TRIANGLES,depth:{enable:!1},stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Da);function WA(e){var i=XA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $A=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,YA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qA=function(e){(0,pr.Z)(r,e);var i=WA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:$A,fragmentShader:YA,triangulation:Lm,primitive:H.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Da);function KA(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,E=0;E<o;E++){var C=E-l;n.push(C/l,-x/p,0),t.push(E/e),t.push(1-v/i)}for(var T=0;T<i;T++)for(var O=0;O<e;O++){var L=O+o*T,B=O+o*(T+1),V=O+1+o*(T+1),ne=O+1+o*T;r.push(L,B,ne),r.push(B,V,ne)}return{vertices:n,indices:r,uvs:t}}var h1,p1;function QA(e){var i=JA();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e3=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,t3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,r3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,n3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,i3=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,a3=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,d1=(h1=(0,sn.b2)(),h1(p1=function(e){(0,pr.Z)(r,e);var i=QA(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"render",value:function(){var t=this,o=this.rendererService,u=o.clear,l=o.useFramebuffer;l(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.heatmapFramerBuffer}),t.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return $().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,E=this.styleAttributeService.getLayerStyleAttribute("shape"),C=(E==null||(u=E.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=C,V.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=V.sent,this.colorModel=C==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),T=v(),O=T.width,L=T.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(O/4),height:Math.floor(L/4),wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.LINEAR,mag:H.LINEAR}),depth:!1}),this.updateColorTexture(),V.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return V.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:yn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=f1,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:a3,fragmentShader:i3,triangulation:f1,depth:{enable:!1},cull:{enable:!0,face:ul(this.mapService.version)},blend:{enable:!0,func:{srcRGB:H.ONE,srcAlpha:1,dstRGB:H.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,l=t.maskInside,p=l===void 0?!0:l;this.shaderModuleService.registerModule("heatmapColor",{vs:n3,fs:r3});var v=this.shaderModuleService.getModule("heatmapColor"),x=v.vs,E=v.fs,C=v.uniforms,T=this.rendererService,O=T.createAttribute,L=T.createElements,B=T.createBuffer,V=T.createModel;return V({vs:x,fs:E,attributes:{a_Position:O({buffer:B({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:H.FLOAT}),size:3}),a_Uv:O({buffer:B({data:[0,1,1,1,0,0,1,0],type:H.FLOAT}),size:2})},uniforms:(0,Y.Z)({},C),depth:{enable:!1},blend:this.getBlend(),elements:L({data:[0,2,1,2,3,1],type:H.UNSIGNED_INT,count:6}),stencil:rt(u,p)})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity;(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=tn();zn(l,this.cameraService.getViewProjectionMatrixUncentered()),(t=this.colorModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,W.Z)(l)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),o=t.mask,u=o===void 0?!1:o,l=t.maskInside,p=l===void 0?!0:l,v=this.rendererService.getViewportSize,x=v(),E=x.width,C=x.height,T=KA(E/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:t3,fs:e3});var O=this.shaderModuleService.getModule("heatmap3dColor"),L=O.vs,B=O.fs,V=O.uniforms,ne=this.rendererService,ie=ne.createAttribute,ke=ne.createElements,Fe=ne.createBuffer,ut=ne.createModel;return ut({vs:L,fs:B,attributes:{a_Position:ie({buffer:Fe({data:T.vertices,type:H.FLOAT}),size:3}),a_Uv:ie({buffer:Fe({data:T.uvs,type:H.FLOAT}),size:2})},primitive:H.TRIANGLES,uniforms:(0,Y.Z)({},V),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:H.SRC_ALPHA,srcAlpha:1,dstRGB:H.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ke({data:T.indices,type:H.UNSIGNED_INT,count:T.indices.length}),stencil:rt(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=je(u);this.colorTexture=t({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.NEAREST,mag:H.NEAREST,flipY:!1})}}]),r}(Da))||p1);function o3(e){var i=s3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function s3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,l3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,c3=function(e){(0,pr.Z)(r,e);var i=o3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:l3,fragmentShader:u3,triangulation:c1,depth:{enable:!1},primitive:H.TRIANGLES,blend:this.getBlend(),stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(Da),f3={heatmap:d1,heatmap3d:d1,grid:HA,grid3d:qA,hexagon:c3},h3=f3;function p3(e){var i=v3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m3=function(e){(0,pr.Z)(r,e);var i=p3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","HeatMapLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new h3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){return u.draw({uniforms:t.layerModel.getUninforms()})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(np);function g3(e){var i=y3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,x3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,b3=function(e){(0,pr.Z)(r,e);var i=g3(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u=this,l,p,v,x,E,C,T,O,L,B,V;return $().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mask,v=p===void 0?!1:p,x=l.maskInside,E=x===void 0?!0:x,C=this.layer.getSource(),T=this.rendererService.createTexture2D,this.texture=T({height:0,width:0}),!es){ie.next=12;break}O=this.layerService.sceneService.getSceneConfig().canvas,L=O.createImage(),L.crossOrigin="anonymous",L.src=C.data.originData,L.onload=function(){u.texture=T({data:L,width:L.width,height:L.height}),u.layerService.reRender()},ie.next=16;break;case 12:return ie.next=14,C.data.images;case 14:B=ie.sent,this.texture=T({data:B[0],width:B[0].width,height:B[0].height,mag:H.LINEAR,min:H.LINEAR});case 16:return ie.next=18,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:x3,fragmentShader:_3,triangulation:u0,primitive:H.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:rt(v,E)});case 18:return V=ie.sent,ie.abrupt("return",[V]);case 20:case"end":return ie.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Da),E3={image:b3},S3=E3;function w3(e){var i=C3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v1=function(e){(0,pr.Z)(r,e);var i=w3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","ImageLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new S3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(np);function A3(e){var i=T3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function T3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M3=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,k3=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,I3=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,P3=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,R3=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,O3=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,L3={solid:0,dash:1},F3=function(e){(0,pr.Z)(r,e);var i=A3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.forward,B=L===void 0?!0:L,V=t.lineTexture,ne=V===void 0?!1:V,ie=t.iconStep,ke=ie===void 0?100:ie,Fe=t.segmentNumber,ut=Fe===void 0?30:Fe,St=t.thetaOffset,Lt=St===void 0?.314:St;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Lt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Lt});var zt=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,zt,this.cellProperties),cr=dr.data,Br=dr.width,_n=dr.height;this.rowCount=_n,this.dataTexture=this.cellLength>0&&cr.length>0?this.createTexture2D({flipY:!0,data:cr,format:H.LUMINANCE,type:H.FLOAT,width:Br,height:_n}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}O.length===2&&O.push(0,0);var Zn=0,qi=[0,0,0,0],Ta=[0,0,0,0];return l&&p&&(qi=le(l),Ta=le(p),Zn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,yt.isNumber)(Lt)?Lt:0,u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ut,u_line_type:L3[C||"solid"],u_dash_array:O,u_blur:.9,u_lineDir:B?1:-1,u_texture:this.texture,u_line_texture:ne?1:0,u_icon_step:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zn,u_sourceColor:qi,u_targetColor:Ta}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:M3,vert:k3,type:"Dash"}:o&&u?{frag:R3,vert:O3,type:"Linear"}:{frag:I3,vert:P3,type:""}}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V;return $().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,ie.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+B,vertexShader:L,fragmentShader:O,triangulation:l0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:rt(x,C)});case 4:return V=ie.sent,ie.abrupt("return",[V]);case 6:case"end":return ie.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function D3(e){var i=B3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function B3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,z3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Z3=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,U3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,V3={solid:0,dash:1},j3=function(e){(0,pr.Z)(r,e);var i=D3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,V=t.iconStep,ne=V===void 0?100:V,ie=t.segmentNumber,ke=ie===void 0?30:ie,Fe=t.globalArcHeight,ut=Fe===void 0?10:Fe;O.length===2&&O.push(0,0);var St=0,Lt=[0,0,0,0],zt=[0,0,0,0];if(l&&p&&(Lt=le(l),zt=le(p),St=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var dr=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,dr,this.cellProperties),Br=cr.data,_n=cr.width,Zn=cr.height;this.rowCount=Zn,this.dataTexture=this.cellLength>0&&Br.length>0?this.createTexture2D({flipY:!0,data:Br,format:H.LUMINANCE,type:H.FLOAT,width:_n,height:Zn}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Pm,u_global_height:ut,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:V3[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:St,u_sourceColor:Lt,u_targetColor:zt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:Z3,vert:U3,type:"Linear"}:{frag:N3,vert:z3,type:""}}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V;return $().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,ie.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+B,vertexShader:L,fragmentShader:O,triangulation:l0,blend:this.getBlend(),segmentNumber:p,stencil:rt(x,C)});case 4:return V=ie.sent,ie.abrupt("return",[V]);case 6:case"end":return ie.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function G3(e){var i=H3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function H3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,X3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,$3=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Y3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,q3={solid:0,dash:1},K3=function(e){(0,pr.Z)(r,e);var i=G3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,V=t.iconStep,ne=V===void 0?100:V,ie=t.segmentNumber,ke=ie===void 0?30:ie,Fe=t.globalArcHeight,ut=Fe===void 0?10:Fe;O.length===2&&O.push(0,0);var St=0,Lt=[0,0,0,0],zt=[0,0,0,0];if(l&&p&&(Lt=le(l),zt=le(p),St=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var dr=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,dr,this.cellProperties),Br=cr.data,_n=cr.width,Zn=cr.height;this.rowCount=Zn,this.dataTexture=this.cellLength>0&&Br.length>0?this.createTexture2D({flipY:!0,data:Br,format:H.LUMINANCE,type:H.FLOAT,width:_n,height:Zn}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Pm,u_global_height:ut,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:q3[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:St,u_sourceColor:Lt,u_targetColor:zt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:$3,vert:Y3,type:"Linear"}:{frag:W3,vert:X3,type:""}}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V;return $().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,C=E===void 0?!0:E,T=this.getShaders(),O=T.frag,L=T.vert,B=T.type,ie.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+B,vertexShader:L,fragmentShader:O,triangulation:l0,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:rt(x,C)});case 4:return V=ie.sent,ie.abrupt("return",[V]);case 6:case"end":return ie.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function Q3(e){var i=J3();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function J3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,tT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,rT={solid:0,dash:1},nT=function(e){(0,pr.Z)(r,e);var i=Q3(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5]:T,L=t.lineTexture,B=L===void 0?!1:L,V=t.iconStep,ne=V===void 0?100:V,ie=t.segmentNumber,ke=ie===void 0?30:ie;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Fe=0,ut=[0,0,0,0],St=[0,0,0,0];if(l&&p&&(ut=le(l),St=le(p),Fe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Lt=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,Lt,this.cellProperties),dr=zt.data,cr=zt.width,Br=zt.height;this.rowCount=Br,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:H.LUMINANCE,type:H.FLOAT,width:cr,height:Br}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:rT[C]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:ut,u_targetColor:St}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:tT,fragmentShader:eT,triangulation:l0,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function iT(e){var i=aT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function aT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oT=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,sT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,uT=function(e){(0,pr.Z)(r,e);var i=iT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.arrow,x=v===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:v,E=0,C=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(C=le(l),T=le(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,O,this.cellProperties),B=L.data,V=L.width,ne=L.height;this.rowCount=ne,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:H.LUMINANCE,type:H.FLOAT,width:V,height:ne}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:C,u_targetColor:T,u_arrow:Number(x.enable),u_arrowHeight:x.arrowHeight||3,u_arrowWidth:x.arrowWidth||2,u_tailWidth:x.tailWidth===void 0?1:x.tailWidth}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B;return $().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=this.getShaders(),O=T.frag,L=T.vert,this.layer.triangulation=Zp,ne.next=5,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:L,fragmentShader:O,triangulation:Zp,depth:{enable:C},blend:this.getBlend(),stencil:rt(p,x)});case 5:return B=ne.sent,ne.abrupt("return",[B]);case 7:case"end":return ne.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:oT,vert:sT,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:yn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10,l[5]]:[l[3],x,l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:yn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],l=o.coordinates[3]||[0,0];return[u[0],u[1],l[0],l[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(Da),m1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(m1||(m1={}));var Td;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Td||(Td={}));var Fm;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(Fm||(Fm={}));var g1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(g1||(g1={}));function lT(e){var i=cT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function cT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fT=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,hT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,y1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,dT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,vT={solid:0,dash:1},_1=function(e){(0,pr.Z)(r,e);var i=lT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,X.Z)((0,Le.Z)(n),"dataTexture",n.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.lineType,C=E===void 0?"solid":E,T=t.dashArray,O=T===void 0?[10,5,0,0]:T,L=t.lineTexture,B=L===void 0?!1:L,V=t.iconStep,ne=V===void 0?100:V,ie=t.vertexHeightScale,ke=ie===void 0?20:ie,Fe=t.borderWidth,ut=Fe===void 0?0:Fe,St=t.borderColor,Lt=St===void 0?"#ccc":St,zt=t.raisingHeight,dr=zt===void 0?0:zt,cr=t.heightfixed,Br=cr===void 0?!1:cr,_n=t.linearDir,Zn=_n===void 0?Td.VERTICAL:_n,qi=t.blur,Ta=qi===void 0?[1,1,1]:qi,xo=t.arrow,wo=xo===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:xo;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var Yo=0,Ll=[0,0,0,0],kv=[0,0,0,0];if(l&&p&&(Ll=le(l),kv=le(p),Yo=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Bd=this.layer.getEncodedData(),Iv=this.calDataFrame(this.cellLength,Bd,this.cellProperties),Z0=Iv.data,gg=Iv.width,U0=Iv.height;this.rowCount=U0,this.dataTexture=this.cellLength>0&&Z0.length>0?this.createTexture2D({flipY:!0,data:Z0,format:H.LUMINANCE,type:H.FLOAT,width:gg,height:U0}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x===Fm.NORMAL?0:1,u_line_type:vT[C],u_dash_array:O,u_blur:Ta,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:ut,u_borderColor:le(Lt),u_linearDir:Zn===Td.VERTICAL?1:0,u_linearColor:Yo,u_sourceColor:Ll,u_targetColor:kv,u_heightfixed:Number(Br),u_vertexScale:ke,u_raisingHeight:Number(dr),u_arrow:Number(wo.enable),u_arrowHeight:wo.arrowHeight||3,u_arrowWidth:wo.arrowWidth||2,u_tailWidth:wo.tailWidth===void 0?1:wo.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V,ne,ie,ke;return $().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=u.workerEnabled,O=T===void 0?!1:T,L=u.enablePicking,B=this.getShaders(),V=B.frag,ne=B.vert,ie=B.type,this.layer.triangulation=If,ut.next=5,this.layer.buildLayerModel({moduleName:"line"+ie,vertexShader:ne,fragmentShader:V,triangulation:If,depth:{enable:C},blend:this.getBlend(),stencil:rt(p,x),workerEnabled:O,workerOptions:{modelType:"line"+ie,enablePicking:L,iconMap:this.iconService.getIconMap()}});case 5:return ke=ut.sent,ut.abrupt("return",[ke]);case 7:case"end":return ut.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:fT,vert:hT,type:"Dash"}:o&&u?{frag:dT,vert:y1,type:"Linear"}:{frag:pT,vert:y1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:yn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u,l,p,v,x,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function mT(e){var i=gT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,_T=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,xT=function(e){(0,pr.Z)(r,e);var i=mT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=je(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.NEAREST,mag:H.NEAREST,flipY:!1})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.vertexHeightScale,p=l===void 0?20:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.heightfixed,C=E===void 0?!1:E,T=t.linearDir,O=T===void 0?Td.VERTICAL:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),V=B.data,ne=B.width,ie=B.height;this.rowCount=ie,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:H.LUMINANCE,type:H.FLOAT,width:ne,height:ie}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:O===Td.VERTICAL?1:0,u_opacity:(0,yt.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(C),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.colorTexture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T;return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,this.layer.triangulation=Zp,L.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:_T,fragmentShader:yT,triangulation:Zp,depth:{enable:C},blend:this.getBlend(),stencil:rt(p,x)});case 4:return T=L.sent,L.abrupt("return",[T]);case 6:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:yn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(Da);function bT(e){var i=ET();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,wT=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,x1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,CT=function(e){(0,pr.Z)(r,e);var i=bT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,E=0,C=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(C=le(l),T=le(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var O=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,O,this.cellProperties),B=L.data,V=L.width,ne=L.height;this.rowCount=ne,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:H.LUMINANCE,type:H.FLOAT,width:V,height:ne}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:C,u_targetColor:T,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:wT,vert:x1,type:"lineSimpleLinear"}:{frag:ST,vert:x1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return $().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),C=E.frag,T=E.vert,O=E.type,V.next=4,this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:CA,primitive:H.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x),pick:!1});case 4:return L=V.sent,V.abrupt("return",[L]);case 6:case"end":return V.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:yn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(Da);function AT(e){var i=TT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function TT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MT=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;


#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

void main() {
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // if(u_coord > 0.0) { // \u4F7F\u7528\u7ECF\u7EAC\u5EA6\u5750\u6807
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
  // } else { // \u4F7F\u7528\u504F\u79FB\u5750\u6807
  //   vec2 pointPos = a_Position.xy;
  //   vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   tileWorld.xy += pointOffset;

  //   tileWorld.xy += offset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     tileWorld.w *= u_PixelsPerMeter.z;
  //   }
  //   gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}
`,IT=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,PT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_size;

#pragma include "projection"

void main() {

  vec3 size = a_Miter * u_size * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
}
`,RT=function(e){(0,pr.Z)(r,e);var i=AT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.usage,p=t.color,v=p===void 0?"#fff":p,x=t.size,E=x===void 0?1:x;return{u_opacity:Number(u),u_color:l==="basemap"?le(v):[0,0,0,0],u_size:l==="basemap"?E:1}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O;return $().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,C=E===void 0?!1:E,T=u.usage,this.layer.triangulation=Zp,B.next=4,this.layer.buildLayerModel({moduleName:"lineTile_"+T,vertexShader:T==="basemap"?PT:kT,fragmentShader:T==="basemap"?IT:MT,triangulation:Zp,blend:this.getBlend(),depth:{enable:C},stencil:rt(p,x),pick:T!=="basemap"});case 4:return O=B.sent,B.abrupt("return",[O]);case 6:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(l){var p=l.size,v=p===void 0?1:p;return Array.isArray(v)?[v[0],v[1]]:[v,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(l,p,v,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(l,p,v){return[v[4]]}}})}}]),r}(Da);function OT(e){var i=LT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function LT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,DT=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,BT=function(e){(0,pr.Z)(r,e);var i=OT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.NEAREST,min:H.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,E=t.heightfixed,C=E===void 0?!1:E,T=t.lineTexture,O=T===void 0?!1:T,L=t.iconStep,B=L===void 0?100:L,V=t.iconStepCount,ne=V===void 0?1:V;this.rendererService.getDirty()&&this.texture.bind();var ie=0,ke=[0,0,0,0],Fe=[0,0,0,0];return l&&p&&(ke=le(l),Fe=le(p),ie=1),{u_heightfixed:Number(C),u_opacity:(0,yt.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:O?1:0,u_iconStepCount:ne,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ie,u_sourceColor:ke,u_targetColor:Fe}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:DT,fragmentShader:FT,triangulation:Zp,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:yn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da),NT={arc:F3,arc3d:j3,greatcircle:nT,wall:BT,line:_1,halfLine:uT,simple:CT,linearline:xT,tileLine:RT,earthArc3d:K3},zT=NT;function ZT(e){var i=UT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function UT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dm=function(e){(0,pr.Z)(r,e);var i=ZT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","LineLayer"),(0,X.Z)((0,Le.Z)(n),"arrowInsertCount",0),(0,X.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new zT[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},halfLine:{},earthArc3d:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,Y.Z)({},u);u.coordinates.map(function(p){o.push((0,Y.Z)((0,Y.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),r}(np);function VT(e){var i=jT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function jT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,HT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,WT=function(e){(0,pr.Z)(r,e);var i=VT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"raiseCount",0),(0,X.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,E=t.pickLight,C=E===void 0?!1:E,T=t.heightfixed,O=T===void 0?!1:T,L=t.opacityLinear,B=L===void 0?{enable:!1,dir:"up"}:L,V=t.lightEnable,ne=V===void 0?!0:V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var ie=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,ie,this.cellProperties),Fe=ke.data,ut=ke.width,St=ke.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:H.LUMINANCE,type:H.FLOAT,width:ut,height:St}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var Lt=0,zt=[0,0,0,0],dr=[0,0,0,0];if(v&&x&&(zt=le(v),dr=le(x),Lt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var cr=u.speed,Br=cr===void 0?.01:cr;this.raiseCount+=Br,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(C),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(p)?p:1,u_linearColor:Lt,u_sourceColor:zt,u_targetColor:dr,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(ne)}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,E.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:HT,fragmentShader:GT,triangulation:Lm,depth:{enable:!0},cull:{enable:!0,face:ul(this.mapService.version)},blend:this.getBlend()});case 4:return v=E.sent,E.abrupt("return",[v]);case 6:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=g(o.coordinates);return e1([u[0],u[1]])}}})}}]),r}(Da);function XT(e){var i=$T();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function $T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YT=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,qT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,KT=function(e){(0,pr.Z)(r,e);var i=XT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.offsets,O=T===void 0?[0,0]:T,L=t.blend,B=t.blur,V=B===void 0?0:B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O});var ne=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,ne,this.cellProperties),ke=ie.data,Fe=ie.width,ut=ie.height;this.rowCount=ut,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:H.LUMINANCE,type:H.FLOAT,width:Fe,height:ut}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_blur:V,u_additive:L==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_stroke_opacity:(0,yt.isNumber)(p)?p:1,u_stroke_width:(0,yt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(C),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=s1,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:qT,fragmentShader:YT,triangulation:s1,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v){var x=(0,nr.Z)(p,3),E=x[0],C=x[1],T=x[2],O=Ka.fromValues(0,0,1),L=Ka.fromValues(E,0,T),B=E>=0?Ka.angle(O,L):Math.PI*2-Ka.angle(O,L),V=Math.PI*2-Math.asin(C/100),ne=tn();po(ne,ne,B),ho(ne,ne,V);var ie=Ka.fromValues(1,1,0);Ka.transformMat4(ie,ie,ne),Ka.normalize(ie,ie);var ke=Ka.fromValues(-1,1,0);Ka.transformMat4(ke,ke,ne),Ka.normalize(ke,ke);var Fe=Ka.fromValues(-1,-1,0);Ka.transformMat4(Fe,Fe,ne),Ka.normalize(Fe,Fe);var ut=Ka.fromValues(1,-1,0);Ka.transformMat4(ut,ut,ne),Ka.normalize(ut,ut);var St=[].concat((0,W.Z)(ie),(0,W.Z)(ke),(0,W.Z)(Fe),(0,W.Z)(ut)),Lt=v%4*3;return[St[Lt],St[Lt+1],St[Lt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(Da);function QT(e){var i=JT();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function JT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,t5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,b1=function(e){(0,pr.Z)(r,e);var i=QT(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"raiseCount",0),(0,X.Z)((0,Le.Z)(n),"raiseRepeat",0),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,E=t.pickLight,C=E===void 0?!1:E,T=t.heightfixed,O=T===void 0?!1:T,L=t.opacityLinear,B=L===void 0?{enable:!1,dir:"up"}:L,V=t.lightEnable,ne=V===void 0?!0:V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var ie=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,ie,this.cellProperties),Fe=ke.data,ut=ke.width,St=ke.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:H.LUMINANCE,type:H.FLOAT,width:ut,height:St}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var Lt=0,zt=[0,0,0,0],dr=[0,0,0,0];if(v&&x&&(zt=le(v),dr=le(x),Lt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var cr=u.speed,Br=cr===void 0?.01:cr;this.raiseCount+=Br,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(C),u_heightfixed:Number(O),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(p)?p:1,u_linearColor:Lt,u_sourceColor:zt,u_targetColor:dr,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(ne)}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,T.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:t5,fragmentShader:e5,triangulation:Lm,blend:this.getBlend(),cull:{enable:!0,face:ul(this.mapService.version)},depth:{enable:p}});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(o){var u=g(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(Da);function r5(e){var i=n5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function n5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,i5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Bm=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,S1=function(e){(0,pr.Z)(r,e);var i=r5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"meter2coord",1),(0,X.Z)((0,Le.Z)(n),"meterYScale",1),(0,X.Z)((0,Le.Z)(n),"isMeter",!1),(0,X.Z)((0,Le.Z)(n),"unit","l7size"),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.offsets,O=T===void 0?[0,0]:T,L=t.blend,B=t.blur,V=B===void 0?0:B,ne=t.raisingHeight,ie=ne===void 0?0:ne,ke=t.heightfixed,Fe=ke===void 0?!1:ke,ut=t.unit,St=ut===void 0?"l7size":ut;if(this.updateUnit(St),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:C,offsets:O});var Lt=this.layer.getEncodedData(),zt=this.calDataFrame(this.cellLength,Lt,this.cellProperties),dr=zt.data,cr=zt.width,Br=zt.height;this.rowCount=Br,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:H.LUMINANCE,type:H.FLOAT,width:cr,height:Br}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(ie),u_heightfixed:Number(Fe),u_meter2coord:this.meter2coord,u_meteryScale:this.meterYScale,u_isMeter:Number(this.isMeter),u_blur:V,u_additive:L==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_stroke_opacity:(0,yt.isNumber)(p)?p:1,u_stroke_width:(0,yt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(C),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Jc)}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateUnit("l7size"),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,nr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version,E=ha==null?void 0:ha.mapboxgl;if(x===ps.MAPBOX&&E!==null&&E!==void 0&&E.MercatorCoordinate){var C=E.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),T=C.meterInMercatorCoordinateUnits(),O=new E.MercatorCoordinate(C.x-T,C.y,C.z),L=O.toLngLat(),B=new E.MercatorCoordinate(C.x,C.y-T,C.z),V=B.toLngLat();this.meter2coord=v[0]-L.lng,this.meterYScale=(V.lat-v[1])/this.meter2coord;return}var ne=this.mapService.meterToCoord(v,[o,u]),ie=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(ne+ie)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V,ne,ie,ke,Fe;return $().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.animateOption,C=E===void 0?{enable:!1}:E,T=u.workerEnabled,O=T===void 0?!1:T,L=u.enablePicking,B=u.shape2d,V=this.getShaders(C),ne=V.frag,ie=V.vert,ke=V.type,this.layer.triangulation=Jc,St.next=5,this.layer.buildLayerModel({moduleName:ke,vertexShader:ie,fragmentShader:ne,triangulation:Jc,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x),workerEnabled:O,workerOptions:{modelType:ke,enablePicking:L,shape2d:B}});case 5:return Fe=St.sent,St.abrupt("return",[Fe]);case 7:case"end":return St.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:E1,vert:Bm,type:"pointWave"};default:return{frag:E1,vert:Bm,type:"pointWave"}}else return{frag:i5,vert:Bm,type:"pointFill"}}},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.indexOf(p);return[v]}}})}},{key:"updateUnit",value:function(t){var o=this.mapService.version;this.unit!==t&&(this.unit!=="meter"&&t==="meter"&&o!==ps.DEFUALT&&o!==ps.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&t!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=t)}}]),r}(Da);function a5(e){var i=o5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,u5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,l5=function(e){(0,pr.Z)(r,e);var i=a5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"meter2coord",1),(0,X.Z)((0,Le.Z)(n),"isMeter",!1),(0,X.Z)((0,Le.Z)(n),"radian",0),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:H.LINEAR,min:H.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.rotation,x=t.raisingHeight,E=x===void 0?0:x,C=t.heightfixed,T=C===void 0?!1:C;this.rendererService.getDirty()&&this.texture.bind();var O=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(O=-1),this.radian=v!==void 0?O*Math.PI*v/180:O*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),V=B.data,ne=B.width,ie=B.height;this.rowCount=ie,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:H.LUMINANCE,type:H.FLOAT,width:ne,height:ie}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(T),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,yt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),u=this.layer.getLayerConfig(),l=u.unit,p=l===void 0?"l7size":l,v=this.mapService.version,p==="meter"&&v!==ps.DEFUALT&&v!==ps.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),E.next=7,this.buildModels();case 7:return E.abrupt("return",E.sent);case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,nr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version;if(x===ps.MAPBOX&&window.mapboxgl.MercatorCoordinate){var E=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),C=1,T=C*E.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(E.x-T,E.y,E.z),L=O.toLngLat();this.meter2coord=v[0]-L.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),V=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(B+V)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:u5,fragmentShader:s5,triangulation:zp,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x),cull:{enable:!0,face:ul(this.mapService.version)}});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:yn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.rotate,p=l===void 0?0:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(Da);function c5(e){var i=f5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function f5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,p5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,w1=function(e){(0,pr.Z)(r,e);var i=c5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:H.LINEAR,min:H.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.heightfixed,C=E===void 0?!1:E;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),L=O.data,B=O.width,V=O.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:H.LUMINANCE,type:H.FLOAT,width:B,height:V}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(x),u_heightfixed:Number(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,yt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:p5,fragmentShader:h5,triangulation:wA,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),r}(Da);function d5(e){var i=v5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function v5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m5=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,g5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function C1(e){var i=e.coordinates;return{vertices:(0,W.Z)(i),indices:[0],size:i.length}}var A1=function(e){(0,pr.Z)(r,e);var i=d5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return{u_opacity:(0,yt.isNumber)(u)?u:1}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=C1,T.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:g5,fragmentShader:m5,triangulation:C1,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:rt(p,x),pick:!1});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Da);function y5(e){var i=_5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function _5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x5=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,b5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,E5=function(e){(0,pr.Z)(r,e);var i=y5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"meter2coord",1),(0,X.Z)((0,Le.Z)(n),"isMeter",!1),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.blend,p=t.speed,v=p===void 0?1:p;return{u_isMeter:Number(this.isMeter),u_speed:v,u_additive:l==="additive"?1:0,u_opacity:(0,yt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.layer.getLayerConfig(),l=u.unit,p=l===void 0?"l7size":l,v=this.mapService.version,p==="meter"&&v!==ps.DEFUALT&&v!==ps.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),E.next=5,this.buildModels();case 5:return E.abrupt("return",E.sent);case 6:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"calMeter2Coord",value:function(){var t=(0,nr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(o+l)/2,(u+p)/2],x=this.mapService.version;if(x===ps.MAPBOX&&window.mapboxgl.MercatorCoordinate){var E=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:v[0],lat:v[1]},0),C=1,T=C*E.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(E.x-T,E.y,E.z),L=O.toLngLat();this.meter2coord=v[0]-L.lng;return}var B=this.mapService.meterToCoord(v,[o,u]),V=this.mapService.meterToCoord(v,[l===o?l+.1:l,p===u?u+.1:p]);this.meter2coord=(B+V)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:b5,fragmentShader:x5,triangulation:zp,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]*t.meter2coord]:[p*t.meter2coord]}}})}}]),r}(Da);function S5(e){var i=w5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function w5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,A5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function T1(e){var i=e.coordinates;return{vertices:(0,W.Z)(i),indices:[0],size:i.length}}var T5=function(e){(0,pr.Z)(r,e);var i=S5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.blend,x=t.strokeOpacity,E=x===void 0?1:x,C=t.strokeWidth,T=C===void 0?0:C,O=t.stroke,L=O===void 0?"#fff":O;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var B=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,B,this.cellProperties),ne=V.data,ie=V.width,ke=V.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&ne.length>0?this.createTexture2D({flipY:!0,data:ne,format:H.LUMINANCE,type:H.FLOAT,width:ie,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,yt.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,yt.isNumber)(E)?E:1,u_stroke_width:(0,yt.isNumber)(T)?T:1,u_stroke_color:this.getStrokeColor(L)}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=T1,T.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:A5,fragmentShader:C5,triangulation:T1,depth:{enable:!1},primitive:H.POINTS,blend:this.getBlend(),stencil:rt(p,x)});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Da);function M5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=k5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function k5(e,i){if(!!e){if(typeof e=="string")return M1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M1(e,i)}}function M1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var I5=function(){function e(i,r,n){(0,vt.Z)(this,e),(0,X.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,_t.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(r,n,t,o,u,l){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,l,p,v){var x=p.seenUids,E=this.boxCells[u];if(E!==null){var C=this.bboxes,T=M5(E),O;try{for(T.s();!(O=T.n()).done;){var L=O.value;if(!x.box[L]){x.box[L]=!0;var B=L*4;if(r<=C[B+2]&&n<=C[B+3]&&t>=C[B+0]&&o>=C[B+1]&&(!v||v(this.boxKeys[L]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[L],x1:C[B],y1:C[B+1],x2:C[B+2],y2:C[B+3]})}}}}catch(V){T.e(V)}finally{T.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,l,p,v){for(var x=this.convertToXCellCoord(r),E=this.convertToYCellCoord(n),C=this.convertToXCellCoord(t),T=this.convertToYCellCoord(o),O=x;O<=C;O++)for(var L=E;L<=T;L++){var B=this.xCellCount*L+O;if(u.call(this,r,n,t,o,B,l,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),P5=I5,k1=function(){function e(i,r){(0,vt.Z)(this,e),(0,X.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new P5(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,_t.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=Vo(n,t,0,1),u=Bv(),l=ti.apply(De,(0,W.Z)(r));return vd(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function I1(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=R5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function R5(e,i){if(!!e){if(typeof e=="string")return P1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P1(e,i)}}function P1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function R1(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function O1(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*t,v=r;v<=n;v++)e[v].x-=p}}function L1(e,i,r,n,t,o,u){var l=(i-r)*t,p=(-n*u+.5)*o,v=I1(e),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.x+=l,E.y+=p}}catch(C){v.e(C)}finally{v.f()}}function O5(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,C=o==="right"?1:o==="left"?0:.5,T=E.length;r.forEach(function(ne){if(ne.split("").forEach(function(ke){var Fe=i[ke],ut=0;Fe&&(E.push({glyph:ke,x:p,y:v+ut,vertical:!1,scale:1,metrics:Fe}),p+=Fe.advance+u)}),E.length!==T){var ie=p-u;x=Math.max(ie,x),O1(E,i,T,E.length-1,C)}p=0,v-=n+5});var O=R1(t),L=O.horizontalAlign,B=O.verticalAlign;L1(E,C,L,B,x,n,r.length);var V=v-l;e.top+=-B*V,e.bottom=e.top-V,e.left+=-L*x,e.right=e.left+x}function L5(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,C=o==="right"?1:o==="left"?0:.5,T=E.length;r.forEach(function(ne){var ie=i[ne],ke=0;if(ie&&(E.push({glyph:ne,x:ie.advance/2,y:v+ke,vertical:!1,scale:1,metrics:ie}),p+=ie.advance+u),E.length!==T){var Fe=p-u;x=Math.max(Fe,x),O1(E,i,T,E.length-1,C)}p=0,v-=n+5});var O=R1(t),L=O.horizontalAlign,B=O.verticalAlign;L1(E,C,L,B,x,n,r.length);var V=v-l;e.top+=-B*V,e.bottom=e.top-V,e.left+=-L*x,e.right=e.left+x}function F1(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?L5(x,i,p,r,n,t,o):O5(x,i,p,r,n,t,o),v.length?x:!1}function D1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=I1(t),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,E=v.advance*p.scale/2,C=r?[p.x+E,p.y]:[0,0],T=r?[0,0]:[p.x+E+i[0],p.y+i[1]],O=(0-x)*p.scale-E+T[0],L=(0-x)*p.scale+T[1],B=O+v.width*p.scale,V=L+v.height*p.scale,ne={x:O,y:L},ie={x:B,y:L},ke={x:O,y:V},Fe={x:B,y:V};o.push({tl:ne,tr:ie,bl:ke,br:Fe,tex:v,glyphOffset:C})}}catch(ut){u.e(ut)}finally{u.f()}return o}function F5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=D5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function D5(e,i){if(!!e){if(typeof e=="string")return B1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B1(e,i)}}function B1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function B5(e){var i=N5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function N5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,z1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Z1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,W.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,W.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,W.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,W.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var U1=function(e){(0,pr.Z)(r,e);var i=B5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"glyphInfoMap",{}),(0,X.Z)((0,Le.Z)(n),"currentZoom",-1),(0,X.Z)((0,Le.Z)(n),"textureHeight",0),(0,X.Z)((0,Le.Z)(n),"textCount",0),(0,X.Z)((0,Le.Z)(n),"preTextStyle",{}),(0,X.Z)((0,Le.Z)(n),"mapping",(0,be.Z)($().mark(function l(){return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.stroke,p=l===void 0?"#fff":l,v=t.strokeWidth,x=v===void 0?0:v,E=t.textAnchor,C=E===void 0?"center":E,T=t.textOffset,O=t.textAllowOverlap,L=O===void 0?!1:O,B=t.halo,V=B===void 0?.5:B,ne=t.gamma,ie=ne===void 0?2:ne,ke=t.raisingHeight,Fe=ke===void 0?0:ke,ut=this.fontService,St=ut.canvas,Lt=ut.mapping;if(Lt&&Object.keys(Lt).length!==this.textCount&&St&&(this.updateTexture(),this.textCount=Object.keys(Lt).length),this.preTextStyle={textAnchor:C,textAllowOverlap:L,textOffset:T},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:x,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:x,stroke:p});var zt=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,zt,this.cellProperties),cr=dr.data,Br=dr.width,_n=dr.height;this.rowCount=_n,this.dataTexture=this.cellLength>0&&cr.length>0?this.createTexture2D({flipY:!0,data:cr,format:H.LUMINANCE,type:H.FLOAT,width:Br,height:_n}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Fe),u_opacity:(0,yt.isNumber)(u)?u:1,u_stroke_width:(0,yt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:V,u_gamma_scale:ie,u_sdf_map_size:[(St==null?void 0:St.width)||1,(St==null?void 0:St.height)||1]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),u=this.layer.getLayerConfig(),l=u.textAnchor,p=l===void 0?"center":l,v=u.textAllowOverlap,x=v===void 0?!0:v,E=u.textOffset,this.preTextStyle={textAnchor:p,textAllowOverlap:x,textOffset:E},T.next=6,this.buildModels();case 6:return T.abrupt("return",T.sent);case 7:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T;return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.textAllowOverlap,C=E===void 0?!1:E,this.initGlyph(),this.updateTexture(),C||this.filterGlyphs(),L.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:z1,fragmentShader:N1,triangulation:Z1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x)});case 6:return T=L.sent,L.abrupt("return",[T]);case 8:case"end":return L.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return $().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(u=this.layer.getLayerConfig(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,x=v===void 0?"center":v,E=u.textOffset,C=this.layer.getEncodedData(),!(JSON.stringify(E)!==JSON.stringify(this.preTextStyle.textOffset)||x!==this.preTextStyle.textAnchor)){V.next=6;break}return V.next=5,this.mapping();case 5:return V.abrupt("return",!0);case 6:if(!(C.length<5||p)){V.next=8;break}return V.abrupt("return",!1);case 8:if(T=this.mapService.getZoom(),O=this.mapService.getBounds(),L=Wu(this.extent,O),!(Math.abs(this.currentZoom-T)>1||!L||p!==this.preTextStyle.textAllowOverlap)){V.next=15;break}return V.next=14,this.reBuildModel();case 14:return V.abrupt("return",!0);case 15:return V.abrupt("return",!1);case 16:case"end":return V.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:yn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.rotate,l=u===void 0?0:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:yn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:yn.Attribute,descriptor:{name:"a_tex",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return nl(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T=T.toString();var O=F5(T),L;try{for(O.s();!(L=O.n()).done;){var B=L.value;x.indexOf(B)===-1&&x.push(B)}}catch(V){O.e(V)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T="".concat(T),x.indexOf(T)===-1&&x.push(T)}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!0})}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.fontService.mapping,l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,E=x===void 0?"center":x,C=l.textOffset,T=this.layer.getEncodedData();this.glyphInfo=T.map(function(O){var L=O.shape,B=L===void 0?"":L,V=O.id,ne=O.size,ie=ne===void 0?1:ne,ke=F1(B.toString(),u,ie,E,"left",v,C||O.textOffset||[0,0],t),Fe=D1(ke,C,!1);return O.shaping=ke,O.glyphQuads=Fe,O.centroid=g(O.coordinates),O.originCentroid=O.version==="GAODE2.x"?g(O.originCoordinates):O.originCentroid=O.centroid,o.glyphInfoMap[V]={shaping:ke,glyphQuads:Fe,centroid:g(O.coordinates)},O})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),E=x.width,C=x.height,T=new k1(E,C),O=this.glyphInfo.filter(function(L){var B=L.shaping,V=L.id,ne=V===void 0?0:V,ie=L.version==="GAODE2.x"?L.originCentroid:L.centroid,ke=L.size,Fe=ke/16,ut=t.mapService.lngLatToContainer(ie),St=T.placeCollisionBox({x1:B.left*Fe-l[0],x2:B.right*Fe+l[0],y1:B.top*Fe-l[1],y2:B.bottom*Fe+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Lt=St.box;return Lt&&Lt.length?(T.insertCollisionBox(Lt,ne),!0):!1});O.forEach(function(L){t.glyphInfoMap[L.id]=L})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:H.LINEAR,min:H.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.filterGlyphs(),T.next=4,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:z1,fragmentShader:N1,triangulation:Z1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x)});case 4:E=T.sent,this.layer.models=[E];case 6:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Da);function z5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Z5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Z5(e,i){if(!!e){if(typeof e=="string")return V1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V1(e,i)}}function V1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function U5(e){var i=V5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function V5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,G1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,H1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;

uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;
uniform vec4 u_color;

void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  
  gl_FragColor = mix(vec4(u_color.rgb, u_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
}
`,W1=`#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_size;

varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "projection"

void main() {
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = u_size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;

}
`;function X1(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,W.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,W.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,W.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,W.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var j5=function(e){(0,pr.Z)(r,e);var i=U5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"glyphInfoMap",{}),(0,X.Z)((0,Le.Z)(n),"currentZoom",-1),(0,X.Z)((0,Le.Z)(n),"textureHeight",0),(0,X.Z)((0,Le.Z)(n),"textCount",0),(0,X.Z)((0,Le.Z)(n),"preTextStyle",{}),(0,X.Z)((0,Le.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.stroke,p=l===void 0?"#fff":l,v=t.strokeWidth,x=v===void 0?0:v,E=t.textAnchor,C=E===void 0?"center":E,T=t.textAllowOverlap,O=T===void 0?!1:T,L=t.halo,B=L===void 0?.5:L,V=t.gamma,ne=V===void 0?2:V,ie=t.usage,ke=t.color,Fe=ke===void 0?"#fff":ke,ut=t.size,St=ut===void 0?1:ut,Lt=this.fontService,zt=Lt.canvas,dr=Lt.mapping;return Object.keys(dr).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(dr).length),this.preTextStyle={textAnchor:C,textAllowOverlap:O},{u_opacity:(0,yt.isNumber)(u)?u:1,u_stroke_width:(0,yt.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:B,u_gamma_scale:ne,u_sdf_map_size:[zt.width,zt.height],u_color:ie==="basemap"?le(Fe):[0,0,0,0],u_size:ie==="basemap"?St:1}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return this.extent=this.textExtent(),u=this.layer.getLayerConfig(),l=u.textAnchor,p=l===void 0?"center":l,v=u.textAllowOverlap,x=v===void 0?!0:v,this.preTextStyle={textAnchor:p,textAllowOverlap:x},C.next=5,this.buildModels();case 5:return C.abrupt("return",C.sent);case 6:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.mapping(),u=this.layer.getLayerConfig(),l=u.usage,x.next=4,this.layer.buildLayerModel({moduleName:"pointTileText_"+l,vertexShader:l==="basemap"?W1:G1,fragmentShader:l==="basemap"?H1:j1,triangulation:X1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:l!=="basemap"});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.usage;this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:yn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(l,p,v){return[v[5],v[6]]}}}),o!=="basemap"&&this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(l){var p=l.size,v=p===void 0?12:p;return Array.isArray(v)?[v[0]]:[v]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:yn.Attribute,descriptor:{name:"a_tex",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(l,p,v){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return nl(t,.5)}},{key:"initTextFont",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var C=E.shape,T=C===void 0?"":C;T=T.toString();var O=z5(T),L;try{for(O.s();!(L=O.n()).done;){var B=L.value;x.indexOf(B)===-1&&x.push(B)}}catch(V){O.e(V)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"generateGlyphLayout",value:function(){var t=this,o=this.fontService.mapping,u=this.layer.getLayerConfig(),l=u.spacing,p=l===void 0?2:l,v=u.textAnchor,x=v===void 0?"center":v,E=this.layer.getEncodedData();this.glyphInfo=E.map(function(C){var T=C.shape,O=T===void 0?"":T,L=C.id,B=C.size,V=B===void 0?1:B,ne=C.textOffset,ie=ne===void 0?[0,0]:ne,ke=F1(O.toString(),o,V,x,"left",p,ie,!1),Fe=D1(ke,ie,!1);return C.shaping=ke,C.glyphQuads=Fe,C.centroid=g(C.coordinates),C.originCentroid=C.version==="GAODE2.x"?g(C.originCoordinates):C.originCentroid=C.centroid,t.glyphInfoMap[L]={shaping:ke,glyphQuads:Fe,centroid:g(C.coordinates)},C})}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[4,4]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),E=x.width,C=x.height,T=new k1(E,C),O=this.glyphInfo.filter(function(L){var B=L.shaping,V=L.id,ne=V===void 0?0:V,ie=L.version==="GAODE2.x"?L.originCentroid:L.centroid,ke=L.size,Fe=ke/24,ut=t.mapService.lngLatToContainer(ie),St=T.placeCollisionBox({x1:B.left*Fe-l[0],x2:B.right*Fe+l[0],y1:B.top*Fe-l[1],y2:B.bottom*Fe+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Lt=St.box;return Lt&&Lt.length?(T.insertCollisionBox(Lt,ne),!0):!1});O.forEach(function(L){t.glyphInfoMap[L.id]=L})}}},{key:"initGlyph",value:function(){this.initTextFont(),this.generateGlyphLayout()}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:H.LINEAR,min:H.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return u=this.layer.getLayerConfig(),l=u.usage,this.filterGlyphs(),x.next=4,this.layer.buildLayerModel({moduleName:"pointTileText_"+l,vertexShader:l==="basemap"?W1:G1,fragmentShader:l==="basemap"?H1:j1,triangulation:X1.bind(this),depth:{enable:!1},blend:this.getBlend(),pick:l!=="basemap"});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(Da);function G5(e){var i=H5();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function H5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W5=`uniform float u_additive;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));


  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,X5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, 0.0);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width));
  offset = project_pixel(offset);

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

// if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
// } else {

  // vec2 pointPos = a_Position.xy;
  // vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  // vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  // world.xy += offset;
  // world.xy += pointOffset;

  // if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //   // Needs to be divided with project_uCommonUnitsPerMeter
  //   world.w *= u_PixelsPerMeter.z;
  // }

  // gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
// }

 
  setPickingColor(a_PickingColor);


}
`,$5=function(e){(0,pr.Z)(r,e);var i=G5(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,E=t.stroke,C=E===void 0?"rgba(0,0,0,0)":E,T=t.blend;return{u_additive:T==="additive"?1:0,u_opacity:Number(u),u_stroke_opacity:Number(p),u_stroke_width:Number(x),u_stroke_color:this.getStrokeColor(C)}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return u=this.layer.getLayerConfig(),l=u.workerEnabled,p=l===void 0?!1:l,v=u.usage,this.layer.triangulation=zp,C.next=4,this.layer.buildLayerModel({moduleName:"pointTile_"+v,vertexShader:X5,fragmentShader:W5,triangulation:zp,depth:{enable:!1},cull:{enable:!0,face:ul(this.mapService.version)},blend:this.getBlend(),workerEnabled:p,workerOptions:{modelType:"pointTile"},pick:v!=="basemap"});case 4:return x=C.sent,C.abrupt("return",[x]);case 6:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(Da),Y5={fillImage:l5,fill:S1,radar:E5,image:w1,normal:A1,simplePoint:T5,extrude:b1,text:U1,tile:$5,tileText:j5,earthFill:KT,earthExtrude:WT},q5=Y5;function K5(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Q5(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Q5(e,i){if(!!e){if(typeof e=="string")return $1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $1(e,i)}}function $1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function J5(e){var i=eM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f0=function(e){(0,pr.Z)(r,e);var i=J5(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","PointLayer"),(0,X.Z)((0,Le.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new q5[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=K5(u),E;try{for(x.s();!(E=x.n()).done;){var C=E.value;if(typeof C=="string"&&v.hasOwnProperty(C))return"image"}}catch(T){x.e(T)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"normal":x==="simple"?"simplePoint":x==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(u==null?void 0:u.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":p.hasOwnProperty(x)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(np);function tM(e){var i=rM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function rM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,aM=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,oM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,sM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,uM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,lM=function(e){(0,pr.Z)(r,e);var i=tM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.heightfixed,p=l===void 0?!1:l,v=t.raisingHeight,x=v===void 0?0:v,E=t.topsurface,C=E===void 0?!0:E,T=t.sidesurface,O=T===void 0?!0:T,L=t.sourceColor,B=t.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var V=this.layer.getEncodedData(),ne=this.calDataFrame(this.cellLength,V,this.cellProperties),ie=ne.data,ke=ne.width,Fe=ne.height;this.rowCount=Fe,this.dataTexture=this.cellLength>0&&ie.length>0?this.createTexture2D({flipY:!0,data:ie,format:H.LUMINANCE,type:H.FLOAT,width:ke,height:Fe}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}var ut=0,St=[1,1,1,1],Lt=[1,1,1,1];return L&&B&&(St=le(L),Lt=le(B),ut=1),{u_topsurface:Number(C),u_sidesurface:Number(O),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(x),u_opacity:(0,yt.isNumber)(u)?u:1,u_linearColor:ut,u_sourceColor:St,u_targetColor:Lt,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L;return $().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),C=E.frag,T=E.vert,O=E.type,V.next=4,this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:l1,stencil:rt(p,x)});case 4:return L=V.sent,V.abrupt("return",[L]);case 6:case"end":return V.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:aM,vert:oM,type:"polygonExtrudeTexture"}:o?{frag:sM,vert:uM,type:"polygonExtrudePickLight"}:{frag:nM,vert:iM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t,o;(t=this.dataTexture)===null||t===void 0||t.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,nr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:yn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(T,O,L){var B=L[0],V=L[1];return[(B-u)/x,(V-l)/E,L[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(T,O,L,B,V){return V}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yn.Attribute,descriptor:{name:"a_Size",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(T){var O=T.size,L=O===void 0?10:O;return Array.isArray(L)?[L[0]]:[L]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.mapTexture,l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:H.CLAMP_TO_EDGE,wrapT:H.CLAMP_TO_EDGE,min:H.LINEAR,mag:H.LINEAR}),t.layerService.reRender()}}}}]),r}(Da);function cM(e){var i=fM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hM=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pM=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,vM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,mM=function(e){(0,pr.Z)(r,e);var i=cM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.opacity,p=l===void 0?1:l,v=t.opacityLinear,x=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,E,this.cellProperties),T=C.data,O=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:H.LUMINANCE,type:H.FLOAT,width:O,height:L}):this.createTexture2D({flipY:!0,data:[1],format:H.LUMINANCE,type:H.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,yt.isNumber)(p)?p:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V,ne,ie;return $().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,E=this.layer.getLayerConfig(),C=E.mask,T=C===void 0?!1:C,O=E.maskInside,L=O===void 0?!0:O,B=E.workerEnabled,V=B===void 0?!1:B,ne=E.enablePicking,this.layer.triangulation=v,Fe.next=5,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,triangulation:v,primitive:H.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rt(T,L),workerEnabled:V,workerOptions:{modelType:x,enablePicking:ne}});case 5:return ie=Fe.sent,Fe.abrupt("return",[ie]);case 7:case"end":return Fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.dataTexture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:yn.Attribute,descriptor:{name:"a_linear",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:pM,vert:dM,type:"polygonLinear",triangulation:MA}:{frag:hM,vert:vM,type:"polygonFill",triangulation:Pf}}}]),r}(Da);function gM(e){var i=yM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function yM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _M=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,xM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,bM=function(e){(0,pr.Z)(r,e);var i=gM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.watercolor,p=l===void 0?"#6D99A8":l,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:le(p),u_watercolor2:le(x),u_opacity:(0,yt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:xM,fragmentShader:_M,triangulation:cv,primitive:H.TRIANGLES,depth:{enable:!1},stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,nr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:yn.Attribute,descriptor:{name:"a_uv",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(T,O,L,B){var V=T.version===ps["GAODE2.x"]?T.originCoordinates[0][B]:L,ne=(0,nr.Z)(V,2),ie=ne[0],ke=ne[1];return[(ie-u)/x,(ke-l)/E]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function l(v){var x=0,E=[],C=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];C.map(function(T){var O=new Image;O.crossOrigin="",O.src=T,E.push(O),O.onload=function(){x++,x===3&&v(E)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:H.MIRRORED_REPEAT,wrapT:H.MIRRORED_REPEAT,min:H.LINEAR,mag:H.LINEAR})}}}]),r}(Da);function EM(e){var i=SM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function SM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wM=`uniform float u_opacity : 1.0;
varying vec4 v_color;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

// uniform vec2 u_tileOrigin;
// uniform float u_coord;

varying vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  // if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
    }
  // } else {
  //   vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  //   vec2 pointOffset = a_Position.xy *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
  //   world.xy += pointOffset;

  //   if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
  //     // Needs to be divided with project_uCommonUnitsPerMeter
  //     world.w *= u_PixelsPerMeter.z;
  //   }

  //   gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
  // }

  setPickingColor(a_PickingColor);
}

`,AM=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,TM=`attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}`,MM=function(e){(0,pr.Z)(r,e);var i=EM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.usage,p=t.color,v=p===void 0?"#fff":p;return{u_opacity:u,u_color:l==="basemap"?le(v):[0,0,0,0]}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C;return $().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.usage,this.layer.triangulation=cv,O.next=4,this.layer.buildLayerModel({moduleName:"polygonTile_"+E,vertexShader:E==="basemap"?TM:CM,fragmentShader:E==="basemap"?AM:wM,triangulation:cv,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x),pick:E!=="basemap"});case 4:return C=O.sent,O.abrupt("return",[C]);case 6:case"end":return O.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(Da);function kM(e){var i=IM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function IM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,RM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,OM=function(e){(0,pr.Z)(r,e);var i=kM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:(0,yt.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:RM,fragmentShader:PM,triangulation:cv,primitive:H.TRIANGLES,depth:{enable:!1},stencil:rt(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,nr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:yn.Attribute,descriptor:{name:"a_uv",buffer:{usage:H.STATIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(T,O,L,B){var V=T.version===ps["GAODE2.x"]?T.originCoordinates[0][B]:L,ne=(0,nr.Z)(V,2),ie=ne[0],ke=ne[1];return[(ie-u)/x,(ke-l)/E]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:H.MIRRORED_REPEAT,wrapT:H.MIRRORED_REPEAT,min:H.LINEAR,mag:H.LINEAR}),t.layerService.reRender()}}}]),r}(Da),LM={fill:mM,line:_1,extrude:lM,text:U1,point_fill:S1,point_image:w1,point_normal:A1,point_extrude:b1,water:OM,ocean:bM,tile:MM},FM=LM;function DM(e){var i=BM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function BM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nm=function(e){(0,pr.Z)(r,e);var i=DM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","PolygonLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new FM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":u==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(np);function NM(e){var i=zM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function zM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,UM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Y1=function(e){(0,pr.Z)(r,e);var i=NM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.clampLow,p=l===void 0?!0:l,v=t.clampHigh,x=v===void 0?!0:v,E=t.noDataValue,C=E===void 0?-9999999:E,T=t.domain,O=T===void 0?[0,1]:T,L=t.rampColors;return this.colorTexture=this.layer.textureService.getColorTexture(L),{u_opacity:u||1,u_texture:this.texture,u_domain:O,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:C,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,be.Z)($().mark(function o(u){var l,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!Array.isArray(u.data)){C.next=4;break}return C.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return C.next=6,u.data;case 6:return l=C.sent,p=l.rasterData,v=l.width,x=l.height,C.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return C.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V,ne;return $().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,T=E.data.dataArray[0],ke.next=6,this.getRasterData(T);case 6:return O=ke.sent,L=O.data,B=O.width,V=O.height,this.texture=C({data:L,width:B,height:V,format:H.LUMINANCE,type:H.FLOAT}),ke.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:UM,fragmentShader:ZM,triangulation:u0,primitive:H.TRIANGLES,depth:{enable:!1},stencil:rt(p,x)});case 13:return ne=ke.sent,ke.abrupt("return",[ne]);case 15:case"end":return ke.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,l=je(u);this.colorTexture=t({data:l.data,width:l.width,height:l.height,flipY:!1})}}]),r}(Da),VM=["data"],jM=["rasterData"];function GM(e){var i=HM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function HM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
 
}`,XM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,$M=function(e){(0,pr.Z)(r,e);var i=GM(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"dataOption",{}),n}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,E=v.gMinMax,C=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:E,u_bminmax:C}}},{key:"getRasterData",value:function(){var n=(0,be.Z)($().mark(function o(u){var l,p,v,x,E;return $().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(u.data)){T.next=4;break}return l=u.data,p=(0,Ji.Z)(u,VM),this.dataOption=p,T.abrupt("return",(0,Y.Z)({data:l},p));case 4:return T.next=6,u.data;case 6:if(v=T.sent,x=v.rasterData,E=(0,Ji.Z)(v,jM),this.dataOption=E,!Array.isArray(x)){T.next=14;break}return T.abrupt("return",(0,Y.Z)({data:x},E));case 14:return T.abrupt("return",(0,Y.Z)({data:Array.from(x)},E));case 15:case"end":return T.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O,L,B,V,ne;return $().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,T=E.data.dataArray[0],ke.next=6,this.getRasterData(T);case 6:return O=ke.sent,L=O.data,B=O.width,V=O.height,this.texture=C({data:L,width:B,height:V,format:H.RGB,type:H.FLOAT}),ke.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:XM,fragmentShader:WM,triangulation:u0,primitive:H.TRIANGLES,depth:{enable:!1},stencil:rt(p,x)});case 13:return ne=ke.sent,ke.abrupt("return",[ne]);case 15:case"end":return ke.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Da);function YM(e){var i=qM();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function qM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 256.0;
  float r = baseColor.r * 256.0 * 256.0;
  float g = baseColor.g * 256.0;
  float b = baseColor.b;
  float value =  (r + g + b) * 0.1 - 10000.0;
  
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,QM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,JM=function(e){(0,pr.Z)(r,e);var i=YM(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,l=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,E=x===void 0?-9999999:x,C=t.domain,T=C===void 0?[0,1]:C,O=t.rampColors,L=t.colorTexture,B=L;return L?this.layer.textureService.setColorTexture(L,O):B=this.layer.textureService.getColorTexture(O),{u_opacity:o||1,u_texture:this.texture,u_domain:T,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:E,u_colorTexture:B}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x,E,C,T,O;return $().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),C=this.rendererService.createTexture2D,B.next=5,E.data.images;case 5:return T=B.sent,this.texture=C({data:T[0],width:T[0].width,height:T[0].height}),B.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:QM,fragmentShader:KM,triangulation:u0,primitive:H.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rt(p,x)});case 9:return O=B.sent,B.abrupt("return",[O]);case 11:case"end":return B.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(Da),e4={raster:Y1,rasterRgb:$M,raster3d:Y1,rasterTerrainRgb:JM},t4=e4;function r4(e){var i=n4();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function n4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h0=function(e){(0,pr.Z)(r,e);var i=r4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","RasterLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new t4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(np);function i4(e){var i=a4();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function a4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o4=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,s4=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,u4=function(e){(0,pr.Z)(r,e);var i=i4(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?0:o,l=t.color,p=l===void 0?"#000":l;return{u_opacity:(0,yt.isNumber)(u)?u:0,u_color:le(p)}}},{key:"initModels",value:function(){var n=(0,be.Z)($().mark(function o(){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:s4,fragmentShader:o4,triangulation:cv,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:H.ALWAYS,ref:1,mask:255},opFront:{fail:H.REPLACE,zfail:H.REPLACE,zpass:H.REPLACE}},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Da),l4={fill:u4},c4=l4;function f4(e){var i=h4();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zm=function(e){(0,pr.Z)(r,e);var i=f4(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"type","MaskLayer"),n}return(0,_t.Z)(r,[{key:"buildModels",value:function(){var n=(0,be.Z)($().mark(function o(){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new c4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(np),q1,K1,Q1,J1,p0,ex,tx,p4=(q1=(0,sn.b2)(),K1=(0,sn.f3)(tr.IMapService),Q1=(0,sn.f3)(tr.IFontService),q1(J1=(p0=function(){function e(){(0,vt.Z)(this,e),oa(this,"mapService",ex,this),oa(this,"fontService",tx,this)}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,be.Z)($().mark(function u(){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t.generateMaping(r,{styleAttributeService:o});case 1:case"end":return p.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,be.Z)($().mark(function l(p){return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p){x.next=2;break}return x.abrupt("return",p);case 2:return r.dataState.dataMappingNeedUpdate=!1,t.generateMaping(r,{styleAttributeService:o}),x.abrupt("return",!0);case 5:case"end":return x.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(O){return O.needRemapping}),E=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(E=v.filter(function(O){return t.applyAttributeMapping(p,O)[0]})),x.length)if(p!=null&&p.needRemapping){var C=t.mapping(r,l,E,void 0);r.setEncodedData(C),p.needRemapping=!1}else{var T=t.mapping(r,x,E,r.getEncodedData());r.setEncodedData(T)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=r.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(E){return t.applyAttributeMapping(l,E)[0]})),v=r.processData(v);var x=this.mapping(r,u,v,void 0);r.setEncodedData(x),r.emit("dataUpdate",null)}},{key:"mapping",value:function(r,n,t,o){var u=this,l=r.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(C){return C.scale!==void 0}),E=t.map(function(C,T){var O=o?o[T]:{},L=(0,Y.Z)({id:C._id,coordinates:C.coordinates},O);if(x.forEach(function(ne){var ie=u.applyAttributeMapping(ne,C);ne.needRemapping=!1,ne.name==="color"&&(ie=ie.map(function(ke){return le(ke)})),L[ne.name]=Array.isArray(ie)&&ie.length===1?ie[0]:ie,ne.name==="shape"&&(L.shape=u.fontService.getIconFontKey(L[ne.name]))}),v.enable&&(L.shape==="line"||L.shape==="halfLine")){var B=L.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var V=u.getArrowPoints(B[0],B[1]);L.coordinates.splice(1,0,V,V),r.arrowInsertCount++}}return L});return this.adjustData2Amap2Coordinates(E,r),this.adjustData2SimpleCoordinates(E),E}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===ps["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof r[0].coordinates[0]=="number"?r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ps["GAODE2.x"],u.originCoordinates=(0,yt.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordByLayer(u.coordinates,o)}):r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ps["GAODE2.x"],u.originCoordinates=(0,yt.cloneDeep)(u.coordinates),u.coordinates=t.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===ps.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(l)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=r.mapping?r.mapping(u):[];return l}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=$c(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),ex=ta(p0.prototype,"mapService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=ta(p0.prototype,"fontService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0))||J1),rx,nx,d4=(rx=(0,sn.b2)(),rx(nx=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(tr.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,be.Z)($().mark(function t(){var o,u,l,p;return $().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,l=u.data,p=u.options,o=new Cm(l,p),r.setSource(o)),!o.inited){x.next=6;break}n.updateClusterData(r),x.next=8;break;case 6:return x.next=8,new Promise(function(E){o.on("update",function(C){C.type==="inited"&&n.updateClusterData(r),E(null)})});case 8:case"end":return x.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,be.Z)($().mark(function t(){var o,u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,p.abrupt("return",o||u);case 4:case"end":return p.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(l)),t&&Math.abs(r.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||nx);function Zm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function ix(e){return e.length===1&&(e=v4(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function v4(e){return function(i,r){return Zm(e(i),r)}}var ax=ix(Zm),m4=ax.right,pR=ax.left,d0=m4;function ox(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var sx=Array.prototype,dR=sx.slice,vR=sx.map,Um=Math.sqrt(50),Vm=Math.sqrt(10),jm=Math.sqrt(2);function ux(e,i,r){var n,t=-1,o,u,l;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=v0(e,i,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/l;return n&&u.reverse(),u}function v0(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=Um?10:o>=Vm?5:o>=jm?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=Um?10:o>=Vm?5:o>=jm?2:1)}function Gm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=Um?t*=10:o>=Vm?t*=5:o>=jm&&(t*=2),i<e?-t:t}function mR(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],E=v[1],C=r(p,x,E);Array.isArray(C)||(C=tickStep(x,E,C),C=range(Math.ceil(x/C)*C,E,C));for(var T=C.length;C[0]<=x;)C.shift(),--T;for(;C[T-1]>E;)C.pop(),--T;var O=new Array(T+1),L;for(o=0;o<=T;++o)L=O[o]=[],L.x0=o>0?C[o-1]:x,L.x1=o<T?C[o]:E;for(o=0;o<u;++o)l=p[o],x<=l&&l<=E&&O[bisect(C,l,0,T)].push(t[o]);return O}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function gR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function g4(e){return e===null?NaN:+e}function y4(e,i,r){if(r==null&&(r=g4),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return u+(l-u)*(t-o)}}var _4=se(87765),Fc="$";function m0(){}m0.prototype=lx.prototype={constructor:m0,has:function(e){return Fc+e in this},get:function(e){return this[Fc+e]},set:function(e,i){return this[Fc+e]=i,this},remove:function(e){var i=Fc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Fc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Fc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Fc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Fc)return!1;return!0},each:function(e){for(var i in this)i[0]===Fc&&e(this[i],i.slice(1),this)}};function lx(e,i){var r=new m0;if(e instanceof m0)e.each(function(l,p){r.set(p,l)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var Hm=lx;function yR(){var e=[],i=[],r,n,t;function o(l,p,v,x){if(p>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var E=-1,C=l.length,T=e[p++],O,L,B=map(),V,ne=v();++E<C;)(V=B.get(O=T(L=l[E])+""))?V.push(L):B.set(O,[L]);return B.each(function(ie,ke){x(ne,ke,o(ie,p,v,x))}),ne}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(E,C){v.push({key:C,values:u(E,p)})})),x!=null?v.sort(function(E,C){return x(E.key,C.key)}):v}return t={object:function(l){return o(l,0,x4,b4)},map:function(l){return o(l,0,cx,fx)},entries:function(l){return u(o(l,0,cx,fx),0)},key:function(l){return e.push(l),t},sortKeys:function(l){return i[e.length-1]=l,t},sortValues:function(l){return r=l,t},rollup:function(l){return n=l,t}}}function x4(){return{}}function b4(e,i,r){e[i]=r}function cx(){return map()}function fx(e,i,r){e.set(i,r)}function g0(){}var Up=Hm.prototype;g0.prototype=E4.prototype={constructor:g0,has:Up.has,add:function(e){return e+="",this[Fc+e]=e,this},remove:Up.remove,clear:Up.clear,values:Up.keys,size:Up.size,empty:Up.empty,each:Up.each};function E4(e,i){var r=new g0;if(e instanceof g0)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var _R=null,hx=Array.prototype,y0=hx.map,Vp=hx.slice;function op(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function px(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var dx={name:"implicit"};function _0(){var e=Hm(),i=[],r=[],n=dx;function t(o){var u=o+"",l=e.get(u);if(!l){if(n!==dx)return n;e.set(u,l=i.push(o))}return r[(l-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=Hm();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=Vp.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return _0(i,r).unknown(n)},op.apply(t,arguments),t}function vx(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var E=i().length,C=n[1]<n[0],T=n[C-0],O=n[1-C];t=(O-T)/Math.max(1,E-l+p*2),u&&(t=Math.floor(t)),T+=(O-T-t*(E-l))*v,o=t*(1-l),u&&(T=Math.round(T),o=Math.round(o));var L=sequence(E).map(function(B){return T+t*B});return r(C?L.reverse():L)}return e.domain=function(E){return arguments.length?(i(E),x()):i()},e.range=function(E){return arguments.length?(n=[+E[0],+E[1]],x()):n.slice()},e.rangeRound=function(E){return n=[+E[0],+E[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(E){return arguments.length?(u=!!E,x()):u},e.padding=function(E){return arguments.length?(l=Math.min(1,p=+E),x()):l},e.paddingInner=function(E){return arguments.length?(l=Math.min(1,E),x()):l},e.paddingOuter=function(E){return arguments.length?(p=+E,x()):p},e.align=function(E){return arguments.length?(v=Math.max(0,Math.min(1,E)),x()):v},e.copy=function(){return vx(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function mx(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return mx(i())},e}function xR(){return mx(vx.apply(null,arguments).paddingInner(1))}var S4=se(21775),w4=se(73626);function C4(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function A4(e){return function(){return e}}function Wm(e){return+e}var gx=[0,1];function Ku(e){return e}function Xm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:A4(isNaN(i)?NaN:.5)}function yx(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function T4(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=Xm(t,n),o=r(u,o)):(n=Xm(n,t),o=r(o,u)),function(l){return o(n(l))}}function M4(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=Xm(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(l){var p=d0(e,l,1,n)-1;return o[p](t[p](l))}}function x0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function $m(){var e=gx,i=gx,r=S4.Z,n,t,o,u=Ku,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?M4:T4,p=v=null,E}function E(C){return isNaN(C=+C)?o:(p||(p=l(e.map(n),i,r)))(n(u(C)))}return E.invert=function(C){return u(t((v||(v=l(i,e.map(n),w4.Z)))(C)))},E.domain=function(C){return arguments.length?(e=y0.call(C,Wm),u===Ku||(u=yx(e)),x()):e.slice()},E.range=function(C){return arguments.length?(i=Vp.call(C),x()):i.slice()},E.rangeRound=function(C){return i=Vp.call(C),r=C4,x()},E.clamp=function(C){return arguments.length?(u=C?yx(e):Ku,E):u!==Ku},E.interpolate=function(C){return arguments.length?(r=C,x()):r},E.unknown=function(C){return arguments.length?(o=C,E):o},function(C,T){return n=C,t=T,x()}}function _x(e,i){return $m()(e,i)}var k4=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function b0(e){if(!(i=k4.exec(e)))throw new Error("invalid format: "+e);var i;return new Ym({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}b0.prototype=Ym.prototype;function Ym(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Ym.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function I4(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function E0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Md(e){return e=E0(Math.abs(e)),e?e[1]:NaN}function P4(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Md(i)/3)))*3-Md(Math.abs(e)))}function R4(e,i){return function(r,n){for(var t=r.length,o=[],u=0,l=e[0],p=0;t>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(r.substring(t-=l,t+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function O4(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function L4(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var xx;function F4(e,i){var r=E0(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(xx=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+E0(e,Math.max(0,i+o-1))[0]}function bx(e,i){var r=E0(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var Ex={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:I4,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return bx(e*100,i)},r:bx,s:F4,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Sx(e){return e}var Cx=Array.prototype.map,Ax=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function D4(e){var i=e.grouping===void 0||e.thousands===void 0?Sx:R4(Cx.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Sx:O4(Cx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(E){E=b0(E);var C=E.fill,T=E.align,O=E.sign,L=E.symbol,B=E.zero,V=E.width,ne=E.comma,ie=E.precision,ke=E.trim,Fe=E.type;Fe==="n"?(ne=!0,Fe="g"):Ex[Fe]||(ie===void 0&&(ie=12),ke=!0,Fe="g"),(B||C==="0"&&T==="=")&&(B=!0,C="0",T="=");var ut=L==="$"?r:L==="#"&&/[boxX]/.test(Fe)?"0"+Fe.toLowerCase():"",St=L==="$"?n:/[%p]/.test(Fe)?u:"",Lt=Ex[Fe],zt=/[defgprs%]/.test(Fe);ie=ie===void 0?6:/[gprs]/.test(Fe)?Math.max(1,Math.min(21,ie)):Math.max(0,Math.min(20,ie));function dr(cr){var Br=ut,_n=St,Zn,qi,Ta;if(Fe==="c")_n=Lt(cr)+_n,cr="";else{cr=+cr;var xo=cr<0||1/cr<0;if(cr=isNaN(cr)?p:Lt(Math.abs(cr),ie),ke&&(cr=L4(cr)),xo&&+cr==0&&O!=="+"&&(xo=!1),Br=(xo?O==="("?O:l:O==="-"||O==="("?"":O)+Br,_n=(Fe==="s"?Ax[8+xx/3]:"")+_n+(xo&&O==="("?")":""),zt){for(Zn=-1,qi=cr.length;++Zn<qi;)if(Ta=cr.charCodeAt(Zn),48>Ta||Ta>57){_n=(Ta===46?t+cr.slice(Zn+1):cr.slice(Zn))+_n,cr=cr.slice(0,Zn);break}}}ne&&!B&&(cr=i(cr,Infinity));var wo=Br.length+cr.length+_n.length,Yo=wo<V?new Array(V-wo+1).join(C):"";switch(ne&&B&&(cr=i(Yo+cr,Yo.length?V-_n.length:Infinity),Yo=""),T){case"<":cr=Br+cr+_n+Yo;break;case"=":cr=Br+Yo+cr+_n;break;case"^":cr=Yo.slice(0,wo=Yo.length>>1)+Br+cr+_n+Yo.slice(wo);break;default:cr=Yo+Br+cr+_n;break}return o(cr)}return dr.toString=function(){return E+""},dr}function x(E,C){var T=v((E=b0(E),E.type="f",E)),O=Math.max(-8,Math.min(8,Math.floor(Md(C)/3)))*3,L=Math.pow(10,-O),B=Ax[8+O/3];return function(V){return T(L*V)+B}}return{format:v,formatPrefix:x}}var S0,qm,Tx;B4({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function B4(e){return S0=D4(e),qm=S0.format,Tx=S0.formatPrefix,S0}function N4(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Md(i)-Md(e))+1}function z4(e){return Math.max(0,-Md(Math.abs(e)))}function Z4(e,i,r,n){var t=Gm(e,i,r),o;switch(n=b0(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=P4(t,u))&&(n.precision=o),Tx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=N4(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=z4(t))&&(n.precision=o-(n.type==="%")*2);break}}return qm(n)}function kd(e){var i=e.domain;return e.ticks=function(r){var n=i();return ux(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return Z4(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=t,t=o,o=p),p=v0(u,l,r),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=v0(u,l,r)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=v0(u,l,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function Mx(){var e=_x(Ku,Ku);return e.copy=function(){return x0(e,Mx())},op.apply(e,arguments),kd(e)}function kx(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=y0.call(n,Wm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return kx(e).unknown(i)},e=arguments.length?y0.call(e,Wm):[0,1],kd(r)}function Ix(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function Px(e){return Math.log(e)}function Rx(e){return Math.exp(e)}function U4(e){return-Math.log(-e)}function V4(e){return-Math.exp(-e)}function j4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function G4(e){return e===10?j4:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function H4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Ox(e){return function(i){return-e(-i)}}function W4(e){var i=e(Px,Rx),r=i.domain,n=10,t,o;function u(){return t=H4(n),o=G4(n),r()[0]<0?(t=Ox(t),o=Ox(o),e(U4,V4)):e(Px,Rx),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(r(l),u()):r()},i.ticks=function(l){var p=r(),v=p[0],x=p[p.length-1],E;(E=x<v)&&(C=v,v=x,x=C);var C=t(v),T=t(x),O,L,B,V=l==null?10:+l,ne=[];if(!(n%1)&&T-C<V){if(C=Math.round(C)-1,T=Math.round(T)+1,v>0){for(;C<T;++C)for(L=1,O=o(C);L<n;++L)if(B=O*L,!(B<v)){if(B>x)break;ne.push(B)}}else for(;C<T;++C)for(L=n-1,O=o(C);L>=1;--L)if(B=O*L,!(B<v)){if(B>x)break;ne.push(B)}}else ne=ux(C,T,Math.min(T-C,V)).map(o);return E?ne.reverse():ne},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=qm(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var E=x/o(Math.round(t(x)));return E*n<n-.5&&(E*=n),E<=v?p(x):""}},i.nice=function(){return r(Ix(r(),{floor:function(l){return o(Math.floor(t(l)))},ceil:function(l){return o(Math.ceil(t(l)))}}))},i}function Lx(){var e=W4($m()).domain([1,10]);return e.copy=function(){return x0(e,Lx()).base(e.base())},op.apply(e,arguments),e}function Fx(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Dx(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function X4(e){var i=1,r=e(Fx(i),Dx(i));return r.constant=function(n){return arguments.length?e(Fx(i=+n),Dx(i)):i},linearish(r)}function $4(){var e=X4(transformer());return e.copy=function(){return copy(e,$4()).constant(e.constant())},initRange.apply(e,arguments)}function Bx(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Y4(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function q4(e){return e<0?-e*e:e*e}function K4(e){var i=e(Ku,Ku),r=1;function n(){return r===1?e(Ku,Ku):r===.5?e(Y4,q4):e(Bx(r),Bx(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},kd(i)}function Km(){var e=K4($m());return e.copy=function(){return x0(e,Km()).exponent(e.exponent())},op.apply(e,arguments),e}function bR(){return Km.apply(null,arguments).exponent(.5)}function Nx(){var e=[],i=[],r=[],n;function t(){var u=0,l=Math.max(1,i.length);for(r=new Array(l-1);++u<l;)r[u-1]=y4(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[d0(r,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(Zm),t()},o.range=function(u){return arguments.length?(i=Vp.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Nx().domain(e).range(i).unknown(n)},op.apply(o,arguments)}function zx(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[d0(n,p,0,r)]:o}function l(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(r=(t=Vp.call(p)).length-1,l()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return zx().domain([e,i]).range(t).unknown(o)},op.apply(kd(u),arguments)}function Zx(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[d0(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=Vp.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=Vp.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return Zx().domain(e).range(i).unknown(r)},op.apply(t,arguments)}var Qm=new Date,Jm=new Date;function fl(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),l=t.ceil(o);return o-u<l-o?u:l},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,l){var p=[],v;if(o=t.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},t.filter=function(o){return fl(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return Qm.setTime(+o),Jm.setTime(+u),e(Qm),e(Jm),Math.floor(r(Qm,Jm))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var eg=fl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});eg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Id=eg,ER=eg.range,Ux=fl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Q4=Ux,SR=Ux.range,w0=1e3,fv=6e4,Vx=36e5,jx=864e5,Gx=6048e5;function jp(e){return fl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*fv)/Gx})}var tg=jp(0),C0=jp(1),J4=jp(2),e6=jp(3),Pd=jp(4),t6=jp(5),r6=jp(6),wR=tg.range,CR=C0.range,AR=J4.range,TR=e6.range,MR=Pd.range,kR=t6.range,IR=r6.range,Hx=fl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*fv)/jx},function(e){return e.getDate()-1}),rg=Hx,PR=Hx.range,Wx=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*w0-e.getMinutes()*fv)},function(e,i){e.setTime(+e+i*Vx)},function(e,i){return(i-e)/Vx},function(e){return e.getHours()}),n6=Wx,RR=Wx.range,Xx=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*w0)},function(e,i){e.setTime(+e+i*fv)},function(e,i){return(i-e)/fv},function(e){return e.getMinutes()}),i6=Xx,OR=Xx.range,$x=fl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*w0)},function(e,i){return(i-e)/w0},function(e){return e.getUTCSeconds()}),a6=$x,LR=$x.range,A0=fl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});A0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):A0};var o6=A0,FR=A0.range;function Gp(e){return fl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/Gx})}var Yx=Gp(0),T0=Gp(1),s6=Gp(2),u6=Gp(3),Rd=Gp(4),l6=Gp(5),c6=Gp(6),DR=Yx.range,BR=T0.range,NR=s6.range,zR=u6.range,ZR=Rd.range,UR=l6.range,VR=c6.range,qx=fl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/jx},function(e){return e.getUTCDate()-1}),Kx=qx,jR=qx.range,ng=fl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ng.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var hv=ng,GR=ng.range;function ig(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ag(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function pv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function f6(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=dv(t),x=vv(t),E=dv(o),C=vv(o),T=dv(u),O=vv(u),L=dv(l),B=vv(l),V=dv(p),ne=vv(p),ie={a:xo,A:wo,b:Yo,B:Ll,c:null,d:nb,e:nb,f:L6,g:G6,G:W6,H:P6,I:R6,j:O6,L:ib,m:F6,M:D6,p:kv,q:Bd,Q:cb,s:fb,S:B6,u:N6,U:z6,V:Z6,w:U6,W:V6,x:null,X:null,y:j6,Y:H6,Z:X6,"%":lb},ke={a:Iv,A:Z0,b:gg,B:U0,c:null,d:ob,e:ob,f:K6,g:sk,G:lk,H:$6,I:Y6,j:q6,L:sb,m:Q6,M:J6,p:BP,q:NP,Q:cb,s:fb,S:ek,u:tk,U:rk,V:nk,w:ik,W:ak,x:null,X:null,y:ok,Y:uk,Z:ck,"%":lb},Fe={a:dr,A:cr,b:Br,B:_n,c:Zn,d:tb,e:tb,f:T6,g:eb,G:Jx,H:rb,I:rb,j:S6,L:A6,m:E6,M:w6,p:zt,q:b6,Q:k6,s:I6,S:C6,u:m6,U:g6,V:y6,w:v6,W:_6,x:qi,X:Ta,y:eb,Y:Jx,Z:x6,"%":M6};ie.x=ut(r,ie),ie.X=ut(n,ie),ie.c=ut(i,ie),ke.x=ut(r,ke),ke.X=ut(n,ke),ke.c=ut(i,ke);function ut(Ei,Va){return function(oo){var Rn=[],Fl=-1,qo=0,lc=Ei.length,cc,$p,q2;for(oo instanceof Date||(oo=new Date(+oo));++Fl<lc;)Ei.charCodeAt(Fl)===37&&(Rn.push(Ei.slice(qo,Fl)),($p=Qx[cc=Ei.charAt(++Fl)])!=null?cc=Ei.charAt(++Fl):$p=cc==="e"?" ":"0",(q2=Va[cc])&&(cc=q2(oo,$p)),Rn.push(cc),qo=Fl+1);return Rn.push(Ei.slice(qo,Fl)),Rn.join("")}}function St(Ei,Va){return function(oo){var Rn=pv(1900,void 0,1),Fl=Lt(Rn,Ei,oo+="",0),qo,lc;if(Fl!=oo.length)return null;if("Q"in Rn)return new Date(Rn.Q);if("s"in Rn)return new Date(Rn.s*1e3+("L"in Rn?Rn.L:0));if(Va&&!("Z"in Rn)&&(Rn.Z=0),"p"in Rn&&(Rn.H=Rn.H%12+Rn.p*12),Rn.m===void 0&&(Rn.m="q"in Rn?Rn.q:0),"V"in Rn){if(Rn.V<1||Rn.V>53)return null;"w"in Rn||(Rn.w=1),"Z"in Rn?(qo=ag(pv(Rn.y,0,1)),lc=qo.getUTCDay(),qo=lc>4||lc===0?T0.ceil(qo):T0(qo),qo=Kx.offset(qo,(Rn.V-1)*7),Rn.y=qo.getUTCFullYear(),Rn.m=qo.getUTCMonth(),Rn.d=qo.getUTCDate()+(Rn.w+6)%7):(qo=ig(pv(Rn.y,0,1)),lc=qo.getDay(),qo=lc>4||lc===0?C0.ceil(qo):C0(qo),qo=rg.offset(qo,(Rn.V-1)*7),Rn.y=qo.getFullYear(),Rn.m=qo.getMonth(),Rn.d=qo.getDate()+(Rn.w+6)%7)}else("W"in Rn||"U"in Rn)&&("w"in Rn||(Rn.w="u"in Rn?Rn.u%7:"W"in Rn?1:0),lc="Z"in Rn?ag(pv(Rn.y,0,1)).getUTCDay():ig(pv(Rn.y,0,1)).getDay(),Rn.m=0,Rn.d="W"in Rn?(Rn.w+6)%7+Rn.W*7-(lc+5)%7:Rn.w+Rn.U*7-(lc+6)%7);return"Z"in Rn?(Rn.H+=Rn.Z/100|0,Rn.M+=Rn.Z%100,ag(Rn)):ig(Rn)}}function Lt(Ei,Va,oo,Rn){for(var Fl=0,qo=Va.length,lc=oo.length,cc,$p;Fl<qo;){if(Rn>=lc)return-1;if(cc=Va.charCodeAt(Fl++),cc===37){if(cc=Va.charAt(Fl++),$p=Fe[cc in Qx?Va.charAt(Fl++):cc],!$p||(Rn=$p(Ei,oo,Rn))<0)return-1}else if(cc!=oo.charCodeAt(Rn++))return-1}return Rn}function zt(Ei,Va,oo){var Rn=v.exec(Va.slice(oo));return Rn?(Ei.p=x[Rn[0].toLowerCase()],oo+Rn[0].length):-1}function dr(Ei,Va,oo){var Rn=T.exec(Va.slice(oo));return Rn?(Ei.w=O[Rn[0].toLowerCase()],oo+Rn[0].length):-1}function cr(Ei,Va,oo){var Rn=E.exec(Va.slice(oo));return Rn?(Ei.w=C[Rn[0].toLowerCase()],oo+Rn[0].length):-1}function Br(Ei,Va,oo){var Rn=V.exec(Va.slice(oo));return Rn?(Ei.m=ne[Rn[0].toLowerCase()],oo+Rn[0].length):-1}function _n(Ei,Va,oo){var Rn=L.exec(Va.slice(oo));return Rn?(Ei.m=B[Rn[0].toLowerCase()],oo+Rn[0].length):-1}function Zn(Ei,Va,oo){return Lt(Ei,i,Va,oo)}function qi(Ei,Va,oo){return Lt(Ei,r,Va,oo)}function Ta(Ei,Va,oo){return Lt(Ei,n,Va,oo)}function xo(Ei){return u[Ei.getDay()]}function wo(Ei){return o[Ei.getDay()]}function Yo(Ei){return p[Ei.getMonth()]}function Ll(Ei){return l[Ei.getMonth()]}function kv(Ei){return t[+(Ei.getHours()>=12)]}function Bd(Ei){return 1+~~(Ei.getMonth()/3)}function Iv(Ei){return u[Ei.getUTCDay()]}function Z0(Ei){return o[Ei.getUTCDay()]}function gg(Ei){return p[Ei.getUTCMonth()]}function U0(Ei){return l[Ei.getUTCMonth()]}function BP(Ei){return t[+(Ei.getUTCHours()>=12)]}function NP(Ei){return 1+~~(Ei.getUTCMonth()/3)}return{format:function(Ei){var Va=ut(Ei+="",ie);return Va.toString=function(){return Ei},Va},parse:function(Ei){var Va=St(Ei+="",!1);return Va.toString=function(){return Ei},Va},utcFormat:function(Ei){var Va=ut(Ei+="",ke);return Va.toString=function(){return Ei},Va},utcParse:function(Ei){var Va=St(Ei+="",!0);return Va.toString=function(){return Ei},Va}}}var Qx={"-":"",_:" ","0":"0"},Eu=/^\s*\d+/,h6=/^%/,p6=/[\\^$*+?|[\]().{}]/g;function ao(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function d6(e){return e.replace(p6,"\\$&")}function dv(e){return new RegExp("^(?:"+e.map(d6).join("|")+")","i")}function vv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function v6(e,i,r){var n=Eu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function m6(e,i,r){var n=Eu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function g6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function y6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function _6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Jx(e,i,r){var n=Eu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function eb(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function x6(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function b6(e,i,r){var n=Eu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function E6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function tb(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function S6(e,i,r){var n=Eu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function rb(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function w6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function C6(e,i,r){var n=Eu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function A6(e,i,r){var n=Eu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function T6(e,i,r){var n=Eu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function M6(e,i,r){var n=h6.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function k6(e,i,r){var n=Eu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function I6(e,i,r){var n=Eu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function nb(e,i){return ao(e.getDate(),i,2)}function P6(e,i){return ao(e.getHours(),i,2)}function R6(e,i){return ao(e.getHours()%12||12,i,2)}function O6(e,i){return ao(1+rg.count(Id(e),e),i,3)}function ib(e,i){return ao(e.getMilliseconds(),i,3)}function L6(e,i){return ib(e,i)+"000"}function F6(e,i){return ao(e.getMonth()+1,i,2)}function D6(e,i){return ao(e.getMinutes(),i,2)}function B6(e,i){return ao(e.getSeconds(),i,2)}function N6(e){var i=e.getDay();return i===0?7:i}function z6(e,i){return ao(tg.count(Id(e)-1,e),i,2)}function ab(e){var i=e.getDay();return i>=4||i===0?Pd(e):Pd.ceil(e)}function Z6(e,i){return e=ab(e),ao(Pd.count(Id(e),e)+(Id(e).getDay()===4),i,2)}function U6(e){return e.getDay()}function V6(e,i){return ao(C0.count(Id(e)-1,e),i,2)}function j6(e,i){return ao(e.getFullYear()%100,i,2)}function G6(e,i){return e=ab(e),ao(e.getFullYear()%100,i,2)}function H6(e,i){return ao(e.getFullYear()%1e4,i,4)}function W6(e,i){var r=e.getDay();return e=r>=4||r===0?Pd(e):Pd.ceil(e),ao(e.getFullYear()%1e4,i,4)}function X6(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ao(i/60|0,"0",2)+ao(i%60,"0",2)}function ob(e,i){return ao(e.getUTCDate(),i,2)}function $6(e,i){return ao(e.getUTCHours(),i,2)}function Y6(e,i){return ao(e.getUTCHours()%12||12,i,2)}function q6(e,i){return ao(1+Kx.count(hv(e),e),i,3)}function sb(e,i){return ao(e.getUTCMilliseconds(),i,3)}function K6(e,i){return sb(e,i)+"000"}function Q6(e,i){return ao(e.getUTCMonth()+1,i,2)}function J6(e,i){return ao(e.getUTCMinutes(),i,2)}function ek(e,i){return ao(e.getUTCSeconds(),i,2)}function tk(e){var i=e.getUTCDay();return i===0?7:i}function rk(e,i){return ao(Yx.count(hv(e)-1,e),i,2)}function ub(e){var i=e.getUTCDay();return i>=4||i===0?Rd(e):Rd.ceil(e)}function nk(e,i){return e=ub(e),ao(Rd.count(hv(e),e)+(hv(e).getUTCDay()===4),i,2)}function ik(e){return e.getUTCDay()}function ak(e,i){return ao(T0.count(hv(e)-1,e),i,2)}function ok(e,i){return ao(e.getUTCFullYear()%100,i,2)}function sk(e,i){return e=ub(e),ao(e.getUTCFullYear()%100,i,2)}function uk(e,i){return ao(e.getUTCFullYear()%1e4,i,4)}function lk(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Rd(e):Rd.ceil(e),ao(e.getUTCFullYear()%1e4,i,4)}function ck(){return"+0000"}function lb(){return"%"}function cb(e){return+e}function fb(e){return Math.floor(+e/1e3)}var Od,hb,fk,hk,pk;dk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function dk(e){return Od=f6(e),hb=Od.format,fk=Od.parse,hk=Od.utcFormat,pk=Od.utcParse,Od}var mv=1e3,gv=mv*60,yv=gv*60,_v=yv*24,vk=_v*7,pb=_v*30,og=_v*365;function mk(e){return new Date(e)}function gk(e){return e instanceof Date?+e:+new Date(+e)}function db(e,i,r,n,t,o,u,l,p){var v=_x(Ku,Ku),x=v.invert,E=v.domain,C=p(".%L"),T=p(":%S"),O=p("%I:%M"),L=p("%I %p"),B=p("%a %d"),V=p("%b %d"),ne=p("%B"),ie=p("%Y"),ke=[[u,1,mv],[u,5,5*mv],[u,15,15*mv],[u,30,30*mv],[o,1,gv],[o,5,5*gv],[o,15,15*gv],[o,30,30*gv],[t,1,yv],[t,3,3*yv],[t,6,6*yv],[t,12,12*yv],[n,1,_v],[n,2,2*_v],[r,1,vk],[i,1,pb],[i,3,3*pb],[e,1,og]];function Fe(St){return(u(St)<St?C:o(St)<St?T:t(St)<St?O:n(St)<St?L:i(St)<St?r(St)<St?B:V:e(St)<St?ne:ie)(St)}function ut(St,Lt,zt,dr){if(St==null&&(St=10),typeof St=="number"){var cr=Math.abs(zt-Lt)/St,Br=ix(function(_n){return _n[2]}).right(ke,cr);Br===ke.length?(dr=Gm(Lt/og,zt/og,St),St=e):Br?(Br=ke[cr/ke[Br-1][2]<ke[Br][2]/cr?Br-1:Br],dr=Br[1],St=Br[0]):(dr=Math.max(Gm(Lt,zt,St),1),St=l)}return dr==null?St:St.every(dr)}return v.invert=function(St){return new Date(x(St))},v.domain=function(St){return arguments.length?E(y0.call(St,gk)):E().map(mk)},v.ticks=function(St,Lt){var zt=E(),dr=zt[0],cr=zt[zt.length-1],Br=cr<dr,_n;return Br&&(_n=dr,dr=cr,cr=_n),_n=ut(St,dr,cr,Lt),_n=_n?_n.range(dr,cr+1):[],Br?_n.reverse():_n},v.tickFormat=function(St,Lt){return Lt==null?Fe:p(Lt)},v.nice=function(St,Lt){var zt=E();return(St=ut(St,zt[0],zt[zt.length-1],Lt))?E(Ix(zt,St)):v},v.copy=function(){return x0(v,db(e,i,r,n,t,o,u,l,p))},v}function yk(){return op.apply(db(Id,Q4,tg,rg,n6,i6,a6,o6,hb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function HR(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function M0(){var e=0,i=1,r,n,t,o,u=Ku,l=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function xv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function vb(){var e=kd(M0()(Ku));return e.copy=function(){return xv(e,vb())},px.apply(e,arguments)}function _k(){var e=loggish(M0()).domain([1,10]);return e.copy=function(){return xv(e,_k()).base(e.base())},initInterpolator.apply(e,arguments)}function xk(){var e=symlogish(M0());return e.copy=function(){return xv(e,xk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function mb(){var e=powish(M0());return e.copy=function(){return xv(e,mb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function WR(){return mb.apply(null,arguments).exponent(.5)}function bk(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return bk(i).domain(e)},initInterpolator.apply(r,arguments)}function k0(){var e=0,i=.5,r=1,n,t,o,u,l,p=Ku,v,x=!1,E;function C(T){return isNaN(T=+T)?E:(T=.5+((T=+v(T))-t)*(T<t?u:l),p(x?Math.max(0,Math.min(1,T)):T))}return C.domain=function(T){return arguments.length?(n=v(e=+T[0]),t=v(i=+T[1]),o=v(r=+T[2]),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),C):[e,i,r]},C.clamp=function(T){return arguments.length?(x=!!T,C):x},C.interpolator=function(T){return arguments.length?(p=T,C):p},C.unknown=function(T){return arguments.length?(E=T,C):E},function(T){return v=T,n=T(e),t=T(i),o=T(r),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),C}}function gb(){var e=kd(k0()(Ku));return e.copy=function(){return xv(e,gb())},px.apply(e,arguments)}function Ek(){var e=loggish(k0()).domain([.1,1,10]);return e.copy=function(){return copy(e,Ek()).base(e.base())},initInterpolator.apply(e,arguments)}function Sk(){var e=symlogish(k0());return e.copy=function(){return copy(e,Sk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function yb(){var e=powish(k0());return e.copy=function(){return copy(e,yb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function XR(){return yb.apply(null,arguments).exponent(.5)}var uc,_b,xb,wk=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Ck=(uc={},(0,X.Z)(uc,io.LINEAR,Mx),(0,X.Z)(uc,io.POWER,Km),(0,X.Z)(uc,io.LOG,Lx),(0,X.Z)(uc,io.IDENTITY,kx),(0,X.Z)(uc,io.SEQUENTIAL,vb),(0,X.Z)(uc,io.TIME,yk),(0,X.Z)(uc,io.QUANTILE,Nx),(0,X.Z)(uc,io.QUANTIZE,zx),(0,X.Z)(uc,io.THRESHOLD,Zx),(0,X.Z)(uc,io.CAT,_0),(0,X.Z)(uc,io.DIVERGING,gb),uc),Ak=(_b=(0,sn.b2)(),_b(xb=function(){function e(){(0,vt.Z)(this,e),(0,X.Z)(this,"scaleOptions",{})}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,be.Z)($().mark(function u(){var l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(t.scaleOptions=r.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){E.next=7;break}return E.abrupt("return");case 7:t.caculateScalesForAttributes(p||[],v);case 8:case"end":return E.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,be.Z)($().mark(function l(p){var v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(p){C.next=2;break}return C.abrupt("return",p);case 2:if(t.scaleOptions=r.getScaleOptions(),v=o.getLayerStyleAttributes(),x=r.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){C.next=7;break}return C.abrupt("return",!0);case 7:return t.caculateScalesForAttributes(v||[],x),r.layerModelNeedUpdate=!0,C.abrupt("return",!0);case 10:case"end":return C.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&t.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale;u.names=t.parseFields(o.scale.field||[]);var l=[];u.names.forEach(function(p){var v;l.push(t.createScale(p,o.name,(v=o.scale)===null||v===void 0?void 0:v.values,n))}),l.some(function(p){return p.type===tp.VARIABLE})?(u.type=tp.VARIABLE,l.forEach(function(p){var v;if(!u.callback&&u.values!=="text")switch((v=p.option)===null||v===void 0?void 0:v.type){case io.LOG:case io.LINEAR:case io.POWER:if(u.values&&u.values.length>2){var x=p.scale.ticks(u.values.length);p.scale.domain(x)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case io.QUANTILE:case io.QUANTIZE:case io.THRESHOLD:p.scale.range(u.values);break;case io.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case io.DIVERGING:case io.SEQUENTIAL:p.scale.interpolator(_4.hD(u.values));break}if(u.values==="text"){var E;p.scale.range((E=p.option)===null||E===void 0?void 0:E.domain)}})):(u.type=tp.CONSTANT,u.defaultValues=l.map(function(p,v){return p.scale(u.names[v])})),u.scalers=l.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:(0,yt.isString)(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:tp.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=_0([r]),v.type=tp.CONSTANT),v;var x=(l=o.find(function(T){return!(0,yt.isNil)(T[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||(0,yt.isNil)(x)&&!p)v.scale=_0([r]),v.type=tp.CONSTANT;else{var E=p&&p.type||this.getDefaultType(x);t==="text"&&(E=io.CAT);var C=this.createScaleConfig(E,r,p,o);v.scale=this.createDefaultScale(C),v.option=C}return v}},{key:"getDefaultType",value:function(r){var n=io.LINEAR;return typeof r=="string"&&(n=wk.test(r)?io.TIME:io.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r!==io.CAT&&r!==io.QUANTILE&&r!==io.DIVERGING)u.domain=ox(l);else if(r===io.CAT)u.domain=(0,yt.uniq)(l);else if(r===io.QUANTILE)u.domain=l;else if(r===io.DIVERGING){var p=ox(l),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}return(0,Y.Z)((0,Y.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,l=r.nice,p=Ck[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||xb),bb,Eb,Tk=(bb=(0,sn.b2)(),bb(Eb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,Y.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||Eb),Mk=function(){function e(i){var r=i.rendererService,n=i.layerService,t=i.parent;(0,vt.Z)(this,e),(0,X.Z)(this,"tileResource",new Map),(0,X.Z)(this,"_tiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,_t.Z)(e,[{key:"tiles",get:function(){return this._tiles}},{key:"hasTile",value:function(r){return this._tiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this._tiles.push(r)}},{key:"getTile",value:function(r){return this._tiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this._tiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this._tiles.findIndex(function(o){return o.key===r}),t=this._tiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);n==null||n.updateVisible(r.isVisible)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.some(function(o){var u=n.getTile(o==null?void 0:o.key);return(u==null?void 0:u.isLoaded)===!1})}},{key:"render",value:function(){var i=(0,be.Z)($().mark(function n(){var t=this,o;return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:o=this.getRenderLayers(),o.map(function(){var p=(0,be.Z)($().mark(function v(x){return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,t.layerService.renderLayer(x);case 2:case"end":return C.stop()}},v)}));return function(v){return p.apply(this,arguments)}}());case 2:case"end":return l.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this._tiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,W.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this._tiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,W.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this._tiles}},{key:"destroy",value:function(){this._tiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),kk=se(32676);function Ik(e,i,r){r===void 0&&(r={});var n=Kr(e),t=Kr(i),o=kk.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?Vn(o[0],r.properties):$n(o,r.properties)}var Pk=Ik,Rk=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=Vn(o.coordinates);n===null?n=u:n=Pk(n,u)}),t&&(n.properties=(0,Y.Z)({},t)),n}}]),e}(),bv="select",Ev="active",Ok=function(){function e(i){var r=i.layerService,n=i.tileLayerService,t=i.parent;(0,vt.Z)(this,e),(0,X.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new Rk}return(0,_t.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(tr.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,nr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(bv,l),this.updateHighLight(t,o,u,bv)}},{key:"highlightPickedFeature",value:function(r){var n=(0,nr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Ev,l),this.updateHighLight(t,o,u,Ev)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case bv:l==null||l.hooks.beforeSelect.call([r,n,t]);break;case Ev:l==null||l.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(bv),n=this.tilePickID.get(Ev);if(r){var t=this.pickId2Color(r),o=(0,nr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,bv);return}if(n){var v=this.pickId2Color(n),x=(0,nr.Z)(v,3),E=x[0],C=x[1],T=x[2];this.updateHighLight(E,C,T,Ev);return}}},{key:"color2PickId",value:function(r,n,t){return Ee(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return Ue(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.map(function(o){t.push.apply(t,(0,W.Z)(o.getFeatureById(r)))}),t.length<=0?null:[]}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}();function Lk(e){return e==="PolygonLayer"?Nm:e==="LineLayer"?Dm:f0}function Fk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var Hp=function(){function e(i,r){(0,vt.Z)(this,e),(0,X.Z)(this,"visible",!0),(0,X.Z)(this,"layers",[]),(0,X.Z)(this,"isLoaded",!1),this.parent=r,this.sourceTile=i,this.x=i.x,this.y=i.y,this.z=i.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,_t.Z)(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(r){var n=(0,nr.Z)(this.sourceTile.bounds,4),t=n[0],o=n[1],u=n[2],l=n[3],p=r.lng,v=r.lat;return p>=t&&p<=u&&v>=o&&v<=l}},{key:"getLayerOptions",value:function(){var r=this.parent.getLayerConfig();return(0,Y.Z)((0,Y.Z)({},r),{},{autoFit:!1,mask:Fk(this.parent.type)||r.mask})}},{key:"addMask",value:function(){var i=(0,be.Z)($().mark(function n(t,o){var u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=t0(this.parent.sceneContainer),o.setContainer(u,this.parent.sceneContainer),p.next=4,o.init();case 4:t.addMaskLayer(o);case 5:case"end":return p.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"addLayer",value:function(){var i=(0,be.Z)($().mark(function n(t){var o;return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t.isTileLayer=!0,o=t0(this.parent.sceneContainer),t.setContainer(o,this.parent.sceneContainer),this.layers.push(t),l.next=6,t.init();case 6:case"end":return l.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"updateVisible",value:function(r){this.visible=r,this.updateOptions("visible",r)}},{key:"updateOptions",value:function(r,n){this.layers.forEach(function(t){t.updateLayerConfig((0,X.Z)({},r,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(r){return[]}},{key:"getFeatureById",value:function(r){return[]}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()})}}]),e}();function Dk(e){var i=Bk();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Bk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I0=function(e){(0,pr.Z)(r,e);var i=Dk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v,x;return $().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=Lk(this.parent.type),v=this.getSourceOption(),v){C.next=7;break}return this.isLoaded=!0,C.abrupt("return");case 7:if(x=new p((0,Y.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(T){var O,L,B=T;x[B]((O=u[B])===null||O===void 0?void 0:O.field,(L=u[B])===null||L===void 0?void 0:L.values)}),!l.mask){C.next=12;break}return C.next=12,this.addTileMask(x);case 12:return C.next=14,this.addLayer(x);case 14:this.setLayerMinMaxZoom(x),this.isLoaded=!0;case 16:case"end":return C.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addTileMask",value:function(){var n=(0,be.Z)($().mark(function o(u){var l;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=new zm({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}),v.next=3,this.addMask(u,l);case 3:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();return o?o.getSource().data.dataArray.filter(function(u){return u._id===t}):[]}}]),r}(Hp);function Nk(e){var i=zk();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function zk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zk=function(e){(0,pr.Z)(r,e);var i=Nk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new Dm().source(u.data,u.options).size(1).shape("line").color("red"),v=new f0({minZoom:this.z-1,maxZoom:this.z+1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),E.next=6,this.addLayer(p);case 6:return E.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(Hp);function Uk(e){var i=Vk();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Vk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jk=function(e){(0,pr.Z)(r,e);var i=Uk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new v1((0,Y.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Hp),Gk=["rasterData"];function Hk(e){var i=Wk();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Wk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xk={positions:[0,1],colors:["#000","#fff"]},$k=function(e){(0,pr.Z)(r,e);var i=Hk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),this.colorTexture=this.parent.textureService.getColorTexture(l.rampColors),v=new h0((0,Y.Z)((0,Y.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Ji.Z)(o,Gk);return{data:u,options:{parser:(0,Y.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u.rampColors,v=p===void 0?Xk:p;this.colorTexture=this.parent.textureService.getColorTexture(v),this.layers.forEach(function(x){return x.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(Hp),Yk=["rasterData"];function qk(e){var i=Kk();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Kk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qk=function(e){(0,pr.Z)(r,e);var i=qk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new h0((0,Y.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,Ji.Z)(o,Yk);return{data:u,options:{parser:(0,Y.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}}]),r}(Hp);function Jk(e){var i=e7();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function e7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t7=function(e){(0,pr.Z)(r,e);var i=Jk(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new h0((0,Y.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(Hp);function r7(e){var i=n7();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function n7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i7=function(e){(0,pr.Z)(r,e);var i=r7(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,be.Z)($().mark(function o(){var u,l,p,v;return $().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new zm((0,Y.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(C){var T,O,L=C;v[L]((T=u[L])===null||T===void 0?void 0:T.field,(O=u[L])===null||O===void 0?void 0:O.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:t.transforms}}}}]),r}(Hp);function a7(e){var i=e.type;switch(i){case"PolygonLayer":return I0;case"LineLayer":return I0;case"PointLayer":return I0;case"TileDebugLayer":return Zk;case"MaskLayer":return i7;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case"rgb":case"customRGB":return Qk;case"arraybuffer":case"customArrayBuffer":return $k;case"terrainRGB":return t7;default:return jk}default:return I0}}var o7=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive"],Sb=function(){function e(i){(0,vt.Z)(this,e),(0,X.Z)(this,"initedTileset",!1),(0,X.Z)(this,"viewchange",(0,yt.debounce)(this.mapchange,24)),this.parent=i;var r=this.parent.getContainer();this.rendererService=r.get(tr.IRendererService),this.layerService=r.get(tr.ILayerService),this.mapService=r.get(tr.IMapService),this.pickingService=r.get(tr.IPickingService),this.tileLayerService=new Mk({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new Ok({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,_t.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}},{key:"mapchange",value:function(){var r,n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),l=u.visible;o<2&&l?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=2&&!l&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===t.toString()||(this.lastViewStates={zoom:o,latLonBounds:t},(r=this.tilesetManager)===null||r===void 0||r.throttleUpdate(o,t))}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",function(){return r.mapchange()}),this.mapService.on("moveend",function(){return r.viewchange()})}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var i=(0,be.Z)($().mark(function n(){var t=this,o,u;return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,be.Z)($().mark(function x(E){var C,T;return $().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(t.tileLayerService.hasTile(E.key)){L.next=9;break}return C=a7(t.parent),T=new C(E,t.parent),L.next=5,T.initTileLayer();case 5:t.tilePickService.setPickState(),T.getLayers().length!==0&&(t.tileLayerService.addTile(T),t.tileLayerService.updateTileVisible(E),t.layerService.reRender()),L.next=12;break;case 9:t.tileLayerService.updateTileVisible(E),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return L.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;o7.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[t].apply(v,l)}),t==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),r}})}}]),e}(),wb,Cb,s7=(wb=(0,sn.b2)(),wb(Cb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"initLayerModel",value:function(){var i=(0,be.Z)($().mark(function n(t){return $().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:t.styleNeedUpdate=!1;case 4:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var i=(0,be.Z)($().mark(function n(t){return $().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,be.Z)($().mark(function t(){return $().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new Sb(r),u.abrupt("return");case 4:return u.next=6,n.initLayerModel(r);case 6:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,be.Z)($().mark(function o(u){return $().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!r.getSource().isTile){p.next=5;break}return r.tileLayer=new Sb(r),p.abrupt("return",!1);case 5:return p.next=7,n.prepareLayerModel(r);case 7:return p.abrupt("return",!0);case 8:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||Cb),Ab,Tb,u7=(Ab=(0,sn.b2)(),Ab(Tb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o)})}}]),e}())||Tb),Mb,kb,l7=["type"],Ib={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},c7={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},f7={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},h7={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function p7(e){var i={u_DirectionalLights:new Array(3).fill((0,Y.Z)({},f7)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Y.Z)({},h7)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[c7]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,Ji.Z)(r,l7),u=Ib[t].lights,l=Ib[t].num,p=i[l];i[u][p]=(0,Y.Z)((0,Y.Z)({},i[u][p]),o),i[l]++}),i}var d7=(Mb=(0,sn.b2)(),Mb(kb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,Y.Z)({},p7()))})})}}]),e}())||kb),Pb,Rb,v7=(Pb=(0,sn.b2)(),Pb(Rb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,E=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=H_(r,E,u,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||Rb),Ob,Lb,P0={NONE:0,ENCODE:1,HIGHLIGHT:2},m7=(Ob=(0,sn.b2)(),Ob(Lb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:yn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:H.FLOAT},size:3,update:function(p){var v=p.id;return u?Ue(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:P0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:P0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?le(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ee(new Uint8Array(o))}),r.models.forEach(function(E){return E.addUniforms({u_PickingStage:P0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(C){return C*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?le(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ee(new Uint8Array(o))}),r.models.forEach(function(E){return E.addUniforms({u_PickingStage:P0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(C){return C*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(C){return C*255}),u_EnableSelect:1})})})}}]),e}())||Lb),g7=["mvt","geojsonvt","testTile"];function y7(e){var i=e.getSource();return g7.includes(i.parser.type)}function $R(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Fb,Db,_7=(Fb=(0,sn.b2)(),Fb(Db=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){y7(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerFilterAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:yn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:H.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:yn.Attribute,descriptor:{name:"filter",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:yn.Attribute,descriptor:{name:"a_Color",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:yn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:H.DYNAMIC_DRAW,data:[],type:H.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||Db),Bb,Nb,zb,Zb,Ub,Vb,Ld,jb,Gb,Hb,Wb,x7=(Bb=(0,sn.b2)(),Nb=(0,sn.f3)(tr.ICameraService),zb=(0,sn.f3)(tr.ICoordinateSystemService),Zb=(0,sn.f3)(tr.IRendererService),Ub=(0,sn.f3)(tr.IMapService),Bb(Vb=(Ld=function(){function e(){(0,vt.Z)(this,e),oa(this,"cameraService",jb,this),oa(this,"coordinateSystemService",Gb,this),oa(this,"rendererService",Hb,this),oa(this,"mapService",Wb,this)}return(0,_t.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(E){var C;E.addUniforms((C={},(0,X.Z)(C,Dp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,X.Z)(C,Dp.ViewMatrix,n.cameraService.getViewMatrix()),(0,X.Z)(C,Dp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,X.Z)(C,Dp.Zoom,n.cameraService.getZoom()),(0,X.Z)(C,Dp.ZoomScale,n.cameraService.getZoomScale()),(0,X.Z)(C,Dp.FocalDistance,n.cameraService.getFocalDistance()),(0,X.Z)(C,Dp.CameraPosition,n.cameraService.getCameraPosition()),(0,X.Z)(C,Uf.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,X.Z)(C,Uf.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,X.Z)(C,Uf.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,X.Z)(C,Uf.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,X.Z)(C,Uf.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,X.Z)(C,Uf.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,X.Z)(C,Uf.Mvp,o),(0,X.Z)(C,"u_SceneCenterMKT",u),(0,X.Z)(C,"u_ViewportSize",[v,x]),(0,X.Z)(C,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,X.Z)(C,"u_DevicePixelRatio",ha.devicePixelRatio),(0,X.Z)(C,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,X.Z)(C,"u_shaderPick",Number(r.getShaderPickStat())),C))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),jb=ta(Ld.prototype,"cameraService",[Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gb=ta(Ld.prototype,"coordinateSystemService",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hb=ta(Ld.prototype,"rendererService",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wb=ta(Ld.prototype,"mapService",[Ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||Vb),Xb,$b,b7=(Xb=(0,sn.b2)(),Xb($b=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||$b),Yb,qb,E7=(Yb=(0,sn.b2)(),Yb(qb=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){t.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||qb);ac.bind(tr.ILayerPlugin).to(d4).inRequestScope(),ac.bind(tr.ILayerPlugin).to(_7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(Ak).inRequestScope(),ac.bind(tr.ILayerPlugin).to(p4).inRequestScope(),ac.bind(tr.ILayerPlugin).to(u7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(E7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(b7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(v7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(x7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(Tk).inRequestScope(),ac.bind(tr.ILayerPlugin).to(d7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(m7).inRequestScope(),ac.bind(tr.ILayerPlugin).to(s7).inRequestScope();var S7=se(88307),w7=se.n(S7),C7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,l=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,_t.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Sh,Sv,wh,Dc,wv,sp,Cv,R0,jf,Wp,Bu,Gf,Hf,O0,A7=(Sh={},(0,X.Z)(Sh,H.POINTS,"points"),(0,X.Z)(Sh,H.LINES,"lines"),(0,X.Z)(Sh,H.LINE_LOOP,"line loop"),(0,X.Z)(Sh,H.LINE_STRIP,"line strip"),(0,X.Z)(Sh,H.TRIANGLES,"triangles"),(0,X.Z)(Sh,H.TRIANGLE_FAN,"triangle fan"),(0,X.Z)(Sh,H.TRIANGLE_STRIP,"triangle strip"),Sh),Kb=(Sv={},(0,X.Z)(Sv,H.STATIC_DRAW,"static"),(0,X.Z)(Sv,H.DYNAMIC_DRAW,"dynamic"),(0,X.Z)(Sv,H.STREAM_DRAW,"stream"),Sv),sg=(wh={},(0,X.Z)(wh,H.BYTE,"int8"),(0,X.Z)(wh,H.UNSIGNED_INT,"int16"),(0,X.Z)(wh,H.INT,"int32"),(0,X.Z)(wh,H.UNSIGNED_BYTE,"uint8"),(0,X.Z)(wh,H.UNSIGNED_SHORT,"uint16"),(0,X.Z)(wh,H.UNSIGNED_INT,"uint32"),(0,X.Z)(wh,H.FLOAT,"float"),wh),T7=(Dc={},(0,X.Z)(Dc,H.ALPHA,"alpha"),(0,X.Z)(Dc,H.LUMINANCE,"luminance"),(0,X.Z)(Dc,H.LUMINANCE_ALPHA,"luminance alpha"),(0,X.Z)(Dc,H.RGB,"rgb"),(0,X.Z)(Dc,H.RGBA,"rgba"),(0,X.Z)(Dc,H.RGBA4,"rgba4"),(0,X.Z)(Dc,H.RGB5_A1,"rgb5 a1"),(0,X.Z)(Dc,H.RGB565,"rgb565"),(0,X.Z)(Dc,H.DEPTH_COMPONENT,"depth"),(0,X.Z)(Dc,H.DEPTH_STENCIL,"depth stencil"),Dc),M7=(wv={},(0,X.Z)(wv,H.DONT_CARE,"dont care"),(0,X.Z)(wv,H.NICEST,"nice"),(0,X.Z)(wv,H.FASTEST,"fast"),wv),Qb=(sp={},(0,X.Z)(sp,H.NEAREST,"nearest"),(0,X.Z)(sp,H.LINEAR,"linear"),(0,X.Z)(sp,H.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,X.Z)(sp,H.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,X.Z)(sp,H.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,X.Z)(sp,H.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),sp),Jb=(Cv={},(0,X.Z)(Cv,H.REPEAT,"repeat"),(0,X.Z)(Cv,H.CLAMP_TO_EDGE,"clamp"),(0,X.Z)(Cv,H.MIRRORED_REPEAT,"mirror"),Cv),k7=(R0={},(0,X.Z)(R0,H.NONE,"none"),(0,X.Z)(R0,H.BROWSER_DEFAULT_WEBGL,"browser"),R0),I7=(jf={},(0,X.Z)(jf,H.NEVER,"never"),(0,X.Z)(jf,H.ALWAYS,"always"),(0,X.Z)(jf,H.LESS,"less"),(0,X.Z)(jf,H.LEQUAL,"lequal"),(0,X.Z)(jf,H.GREATER,"greater"),(0,X.Z)(jf,H.GEQUAL,"gequal"),(0,X.Z)(jf,H.EQUAL,"equal"),(0,X.Z)(jf,H.NOTEQUAL,"notequal"),jf),e2=(Wp={},(0,X.Z)(Wp,H.FUNC_ADD,"add"),(0,X.Z)(Wp,H.MIN_EXT,"min"),(0,X.Z)(Wp,H.MAX_EXT,"max"),(0,X.Z)(Wp,H.FUNC_SUBTRACT,"subtract"),(0,X.Z)(Wp,H.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Wp),L0=(Bu={},(0,X.Z)(Bu,H.ZERO,"zero"),(0,X.Z)(Bu,H.ONE,"one"),(0,X.Z)(Bu,H.SRC_COLOR,"src color"),(0,X.Z)(Bu,H.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,X.Z)(Bu,H.SRC_ALPHA,"src alpha"),(0,X.Z)(Bu,H.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,X.Z)(Bu,H.DST_COLOR,"dst color"),(0,X.Z)(Bu,H.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,X.Z)(Bu,H.DST_ALPHA,"dst alpha"),(0,X.Z)(Bu,H.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,X.Z)(Bu,H.CONSTANT_COLOR,"constant color"),(0,X.Z)(Bu,H.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,X.Z)(Bu,H.CONSTANT_ALPHA,"constant alpha"),(0,X.Z)(Bu,H.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,X.Z)(Bu,H.SRC_ALPHA_SATURATE,"src alpha saturate"),Bu),P7=(Gf={},(0,X.Z)(Gf,H.NEVER,"never"),(0,X.Z)(Gf,H.ALWAYS,"always"),(0,X.Z)(Gf,H.LESS,"less"),(0,X.Z)(Gf,H.LEQUAL,"lequal"),(0,X.Z)(Gf,H.GREATER,"greater"),(0,X.Z)(Gf,H.GEQUAL,"gequal"),(0,X.Z)(Gf,H.EQUAL,"equal"),(0,X.Z)(Gf,H.NOTEQUAL,"notequal"),Gf),Fd=(Hf={},(0,X.Z)(Hf,H.ZERO,"zero"),(0,X.Z)(Hf,H.KEEP,"keep"),(0,X.Z)(Hf,H.REPLACE,"replace"),(0,X.Z)(Hf,H.INVERT,"invert"),(0,X.Z)(Hf,H.INCR,"increment"),(0,X.Z)(Hf,H.DECR,"decrement"),(0,X.Z)(Hf,H.INCR_WRAP,"increment wrap"),(0,X.Z)(Hf,H.DECR_WRAP,"decrement wrap"),Hf),R7=(O0={},(0,X.Z)(O0,H.FRONT,"front"),(0,X.Z)(O0,H.BACK,"back"),O0),O7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:Kb[t||H.STATIC_DRAW],type:sg[o||H.UNSIGNED_BYTE]})}return(0,_t.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),L7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:Kb[t||H.STATIC_DRAW],type:sg[o||H.UNSIGNED_BYTE],count:u})}return(0,_t.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),F7=function(){function e(i,r){(0,vt.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,l={width:n,height:t};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,_t.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),D7=function(){function e(i,r){(0,vt.Z)(this,e),(0,X.Z)(this,"destroyed",!1),(0,X.Z)(this,"uniforms",{}),this.reGl=i;var n=r.pick,t=n===void 0?!0:n,o=r.vs,u=r.fs,l=r.attributes,p=r.uniforms,v=r.primitive,x=r.count,E=r.elements,C=r.depth,T=r.blend,O=r.stencil,L=r.cull,B=r.instances,V={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Fe){V[Fe]=i.prop(Fe)}));var ne={};Object.keys(l).forEach(function(Fe){ne[Fe]=l[Fe].get()});var ie={attributes:ne,frag:u,uniforms:V,vert:o,blend:{},primitive:A7[v===void 0?H.TRIANGLES:v]};if(B&&(ie.instances=B),x?ie.count=x:E&&(ie.elements=E.get()),this.initDepthDrawParams({depth:C},ie),this.initBlendDrawParams({blend:T},ie),this.initStencilDrawParams({stencil:O},ie),this.initCullDrawParams({cull:L},ie),this.drawCommand=i(ie),t){var ke=(0,yt.cloneDeep)(ie);ke.blend=(0,Y.Z)((0,Y.Z)({},ke.blend),{},{enable:!1}),this.drawPickCommand=i(ke)}this.drawParams=ie}return(0,_t.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};if(Object.keys(r).forEach(function(u){t[u]=r[u].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,yt.cloneDeep)(this.drawParams);o.blend=(0,Y.Z)((0,Y.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(r){var n={};if(Object.keys(r).forEach(function(o){n[o]=r[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var t=(0,yt.cloneDeep)(this.drawParams);t.blend=(0,Y.Z)((0,Y.Z)({},t.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(t)}}},{key:"addUniforms",value:function(r){this.uniforms=(0,Y.Z)((0,Y.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,Y.Z)((0,Y.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var l=(0,Me.Z)(t[u]);l==="boolean"||l==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:I7[t.func||H.LESS],range:t.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var t=r.blend;if(t){var o=t.enable,u=t.func,l=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:L0[u&&u.srcRGB||H.SRC_ALPHA],srcAlpha:L0[u&&u.srcAlpha||H.SRC_ALPHA],dstRGB:L0[u&&u.dstRGB||H.ONE_MINUS_SRC_ALPHA],dstAlpha:L0[u&&u.dstAlpha||H.ONE_MINUS_SRC_ALPHA]},equation:{rgb:e2[l&&l.rgb||H.FUNC_ADD],alpha:e2[l&&l.alpha||H.FUNC_ADD]},color:v}}}},{key:"initStencilDrawParams",value:function(r,n){var t=r.stencil;if(t){var o=t.enable,u=t.mask,l=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:H.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,E=x===void 0?{fail:H.KEEP,zfail:H.KEEP,zpass:H.KEEP}:x,C=t.opBack,T=C===void 0?{fail:H.KEEP,zfail:H.KEEP,zpass:H.KEEP}:C;n.stencil={enable:!!o,mask:l,func:(0,Y.Z)((0,Y.Z)({},v),{},{cmp:P7[v.cmp]}),opFront:{fail:Fd[E.fail],zfail:Fd[E.zfail],zpass:Fd[E.zpass]},opBack:{fail:Fd[T.fail],zfail:Fd[T.zfail],zpass:Fd[T.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,l=u===void 0?H.BACK:u;n.cull={enable:!!o,face:R7[l]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,yt.isTypedArray)(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}(0,yt.isPlainObject)(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),B7=function(){function e(i,r){(0,vt.Z)(this,e),(0,X.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?H.UNSIGNED_BYTE:t,u=r.width,l=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,E=x===void 0?H.RGBA:x,C=r.mipmap,T=C===void 0?!1:C,O=r.wrapS,L=O===void 0?H.CLAMP_TO_EDGE:O,B=r.wrapT,V=B===void 0?H.CLAMP_TO_EDGE:B,ne=r.aniso,ie=ne===void 0?0:ne,ke=r.alignment,Fe=ke===void 0?1:ke,ut=r.premultiplyAlpha,St=ut===void 0?!1:ut,Lt=r.mag,zt=Lt===void 0?H.NEAREST:Lt,dr=r.min,cr=dr===void 0?H.NEAREST:dr,Br=r.colorSpace,_n=Br===void 0?H.BROWSER_DEFAULT_WEBGL:Br,Zn=r.x,qi=Zn===void 0?0:Zn,Ta=r.y,xo=Ta===void 0?0:Ta,wo=r.copy,Yo=wo===void 0?!1:wo;this.width=u,this.height=l;var Ll={width:u,height:l,type:sg[o],format:T7[E],wrapS:Jb[L],wrapT:Jb[V],mag:Qb[zt],min:Qb[cr],alignment:Fe,flipY:v,colorSpace:k7[_n],premultiplyAlpha:St,aniso:ie,x:qi,y:xo,copy:Yo};n&&(Ll.data=n),typeof T=="number"?Ll.mipmap=M7[T]:typeof T=="boolean"&&(Ll.mipmap=T),this.texture=i.texture(Ll)}return(0,_t.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),t2,r2,N7=(t2=(0,sn.b2)(),t2(r2=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,X.Z)(this,"createModel",function(r){return new D7(i.gl,r)}),(0,X.Z)(this,"createAttribute",function(r){return new C7(i.gl,r)}),(0,X.Z)(this,"createBuffer",function(r){return new O7(i.gl,r)}),(0,X.Z)(this,"createElements",function(r){return new L7(i.gl,r)}),(0,X.Z)(this,"createTexture2D",function(r){return new B7(i.gl,r)}),(0,X.Z)(this,"createFramebuffer",function(r){return new F7(i.gl,r)}),(0,X.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,X.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,l=r.framebuffer,p=l===void 0?null:l,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,X.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,X.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,l=r.height,p={x:t,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,X.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,X.Z)(this,"getContainer",function(){if(es)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,X.Z)(this,"getCanvas",function(){return i.canvas}),(0,X.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,X.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,_t.Z)(e,[{key:"init",value:function(){var i=(0,be.Z)($().mark(function n(t,o,u){var l=this;return $().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,E){w7()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(T,O){(T||!O)&&E(T),x(O)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||r2);function z7(e){var i=Z7();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function Z7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ug=["selectstart","selecting","selectend"],U7=function(e){(0,pr.Z)(r,e);var i=z7(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,vt.Z)(this,r),t=i.call(this),(0,X.Z)((0,Le.Z)(t),"isEnable",!1),(0,X.Z)((0,Le.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,X.Z)((0,Le.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,X.Z)((0,Le.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,_t.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Ri("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),E=Math.min(u,v),C=Math.abs(o-p),T=Math.abs(u-v);this.box.style.top="".concat(E,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(C,"px"),this.box.style.height="".concat(T,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return M([[o,u],[p,v]])}}]),r}(lu.EventEmitter),V7=function(){function e(i){(0,vt.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=sw();this.container=u,n.setContainer(u,r,t,o),u.bind(tr.IRendererService).to(N7).inSingletonScope(),this.sceneService=u.get(tr.ISceneService),this.mapService=u.get(tr.IMapService),this.iconService=u.get(tr.IIconService),this.fontService=u.get(tr.IFontService),this.controlService=u.get(tr.IControlService),this.layerService=u.get(tr.ILayerService),this.markerService=u.get(tr.IMarkerService),this.interactionService=u.get(tr.IInteractionService),this.popupService=u.get(tr.IPopupService),this.boxSelect=new U7(this,{}),es?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,_t.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=t0(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!t||!o)){var x=new zm().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=t0(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,nr.Z)(t,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var i=(0,be.Z)($().mark(function n(t,o){return $().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(es){l.next=5;break}return l.next=3,this.iconService.addImage(t,o);case 3:l.next=6;break;case 5:this.iconService.addImageMini(t,o,this.sceneService);case 6:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else n0.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else n0.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){n0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(ug.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else n0.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,Y.Z)((0,Y.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(tr.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Hi(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new B_({position:t}))}}]),e}(),YR="2.11.6";function n2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qR(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?n2(Object(r),!0).forEach(function(n){j7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function j7(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function KR(e,i){return X7(e)||W7(e,i)||H7(e,i)||G7()}function G7(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H7(e,i){if(!!e){if(typeof e=="string")return i2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i2(e,i)}}function i2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function W7(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function X7(e){if(Array.isArray(e))return e}var QR=null,JR=null,a2,lg,o2,$7=(a2=Em(tr.IGlobalConfigService),lg=function(){function e(i){(0,vt.Z)(this,e),oa(this,"configService",o2,this),this.config=i}return(0,_t.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(tr.MapConfig).toConstantValue((0,Y.Z)((0,Y.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(tr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),o2=ta(lg.prototype,"configService",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lg),Y7=se(6158),Av=se.n(Y7),q7=function(){function e(i){(0,vt.Z)(this,e),(0,X.Z)(this,"size",1e4),this.size=i||1e4}return(0,_t.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),K7={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},s2,u2,l2,c2,f2,h2,Dd,p2,d2,v2,m2,g2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Q7=12,J7=(s2=(0,sn.b2)(),u2=(0,sn.f3)(tr.MapConfig),l2=(0,sn.f3)(tr.IGlobalConfigService),c2=(0,sn.f3)(tr.ICoordinateSystemService),f2=(0,sn.f3)(tr.IEventEmitter),s2(h2=(Dd=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,X.Z)(this,"version",ps.DEFUALT),(0,X.Z)(this,"simpleMapCoord",new q7),(0,X.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),oa(this,"config",p2,this),oa(this,"configService",d2,this),oa(this,"coordinateSystemService",v2,this),oa(this,"eventEmitter",m2,this),(0,X.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,_t.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ri("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){_w.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(g2[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(g2[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===ps.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return K7}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>Q7&&n?this.coordinateSystemService.setCoordinateSystem(uf.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(uf.LNGLAT)}}]),e}(),p2=ta(Dd.prototype,"config",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=ta(Dd.prototype,"configService",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=ta(Dd.prototype,"coordinateSystemService",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=ta(Dd.prototype,"eventEmitter",[f2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd))||h2);function Tv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function F0(e,i){var r=vd([],i,e);return qd(r,r,1/r[3]),r}function e8(e,i){var r=e%i;return r<0?i+r:r}function t8(e,i,r){return r*i+(1-r)*e}function Xp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var ff=Math.PI,y2=ff/4,Ch=ff/180,_2=180/ff,cg=512,fg=4003e4,eI=1.5;function x2(e){return Math.pow(2,e)}function tI(e){return Math.log2(e)}function D0(e,i){var r=(0,nr.Z)(e,2),n=r[0],t=r[1];Xp(Number.isFinite(n)&&Number.isFinite(i)),Xp(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=cg;var o=n*Ch,u=t*Ch,l=i*(o+ff)/(2*ff),p=i*(ff-Math.log(Math.tan(y2+u*.5)))/(2*ff);return[l,p]}function hg(e,i){var r=(0,nr.Z)(e,2),n=r[0],t=r[1];i*=cg;var o=n/i*(2*ff)-ff,u=2*(Math.atan(Math.exp(ff-t/i*(2*ff)))-y2);return[o*_2,u*_2]}function r8(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Ch);return tI(fg*r)-9}function b2(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:x2(n),Xp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var l={},p=cg*t,v=Math.cos(i*Ch),x=p/360,E=x/v,C=p/fg/v;if(l.pixelsPerMeter=[C,-C,C],l.metersPerPixel=[1/C,-1/C,1/C],l.pixelsPerDegree=[x,-E,C],l.degreesPerPixel=[1/x,-1/E,1/C],u){var T=Ch*Math.tan(i*Ch)/v,O=x*T/2,L=p/fg*T,B=L/E*C;l.pixelsPerDegree2=[0,-O,L],l.pixelsPerMeter2=[B,0,B]}return l}function n8(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,E=b2({longitude:n,latitude:t,scale:x,highPrecision:!0}),C=E.pixelsPerMeter,T=E.pixelsPerMeter2,O=D0(e,x);O[0]+=l*(C[0]+T[0]*p),O[1]+=p*(C[1]+T[1]*p);var L=hg(O,x),B=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[L[0],L[1],B]:L}function rI(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=Tv();return qn(v,v,[0,0,-t]),aa(v,v,[1,1,1/i]),ho(v,v,-r*Ch),qa(v,v,n*Ch),p&&aa(v,v,[1,-1,1]),u&&qn(v,v,Ka.negate([],u)),v}function nI(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?eI:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,E=u*Ch,C=Math.atan(.5/t),T=Math.sin(C)*t/Math.sin(Math.PI/2-E-C),O=Math.cos(Math.PI/2-E)*T+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:O*x}}function iI(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=nI({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,E=l.far,C=Is([],p,v,x,E);return C}function aI(e,i){var r=(0,nr.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return Xp(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),F0(i,[n,t,u,1])}function E2(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,nr.Z)(e,3),t=n[0],o=n[1],u=n[2];if(Xp(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=F0(i,[t,o,u,1]);return l}var p=F0(i,[t,o,0,1]),v=F0(i,[t,o,1,1]),x=p[2],E=v[2],C=x===E?0:((r||0)-x)/(E-x);return Vr.lerp([],p,v,C)}var S2=Tv(),oI=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?S2:t,u=i.projectionMatrix,l=u===void 0?S2:u;(0,vt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=Tv();Ni(p,p,this.projectionMatrix),Ni(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=Tv();aa(v,v,[this.width/2,-this.height/2,1]),qn(v,v,[1,-1,0]),Ni(v,v,this.viewProjectionMatrix);var x=zn(Tv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,_t.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ph(r.projectionMatrix,this.projectionMatrix)&&ph(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),l=aI(u,this.pixelProjectionMatrix),p=(0,nr.Z)(l,2),v=p[0],x=p[1],E=o?x:this.height-x;return r.length===2?[v,E]:[v,E,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,l=(0,nr.Z)(r,3),p=l[0],v=l[1],x=l[2],E=o?v:this.height-v,C=u&&u*this.pixelsPerMeter,T=E2([p,E,x],this.pixelUnprojectionMatrix,C),O=this.unprojectPosition(T),L=(0,nr.Z)(O,3),B=L[0],V=L[1],ne=L[2];return Number.isFinite(x)?[B,V,ne]:Number.isFinite(u)?[B,V,u]:[B,V]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,nr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,nr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function sI(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,E=x===void 0?[0,0]:x,C=(0,nr.Z)(n,2),T=(0,nr.Z)(C[0],2),O=T[0],L=T[1],B=(0,nr.Z)(C[1],2),V=B[0],ne=B[1];if(Number.isFinite(v)){var ie=v;v={top:ie,bottom:ie,left:ie,right:ie}}else Xp(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var ke=new w2({width:i,height:r,longitude:0,latitude:0,zoom:0}),Fe=ke.project([O,ne]),ut=ke.project([V,L]),St=[Math.max(Math.abs(ut[0]-Fe[0]),o),Math.max(Math.abs(ut[1]-Fe[1]),o)],Lt=[i-v.left-v.right-Math.abs(E[0])*2,r-v.top-v.bottom-Math.abs(E[1])*2];Xp(Lt[0]>0&&Lt[1]>0);var zt=Lt[0]/St[0],dr=Lt[1]/St[1],cr=(v.right-v.left)/2/zt,Br=(v.bottom-v.top)/2/dr,_n=[(ut[0]+Fe[0])/2+cr,(ut[1]+Fe[1])/2+Br],Zn=ke.unproject(_n),qi=ke.zoom+Math.log2(Math.abs(Math.min(zt,dr)));return{longitude:Zn[0],latitude:Zn[1],zoom:Math.min(qi,l)}}var w2=function(e){(0,pr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,E=x===void 0?0:x,C=n.pitch,T=C===void 0?0:C,O=n.bearing,L=O===void 0?0:O,B=n.altitude,V=B===void 0?1.5:B,ne=n.nearZMultiplier,ie=n.farZMultiplier;(0,vt.Z)(this,i),t=t||1,o=o||1;var ke=x2(E);V=Math.max(.75,V);var Fe=D0([v,l],ke);Fe[2]=0;var ut=iI({width:t,height:o,pitch:T,bearing:L,altitude:V,nearZMultiplier:ne||1/o,farZMultiplier:ie||1.01}),St=rI({height:o,center:Fe,pitch:T,bearing:L,altitude:V,flipY:!0});return r=(0,wr.Z)(this,(0,Ye.Z)(i).call(this,{width:t,height:o,viewMatrix:St,projectionMatrix:ut})),r.latitude=l,r.longitude=v,r.zoom=E,r.pitch=T,r.bearing=L,r.altitude=V,r.scale=ke,r.center=Fe,r.pixelsPerMeter=b2((0,Le.Z)((0,Le.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Le.Z)((0,Le.Z)(r))),r}return(0,_t.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return D0(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hg(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=E2(o,this.pixelUnprojectionMatrix),l=D0(t,this.scale),p=Vr.add([],l,Vr.negate([],u)),v=Vr.add([],this.center,p);return hg(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=sI(Object.assign({width:o,height:u,bounds:n},t)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(oI),uI=function(){function e(){(0,vt.Z)(this,e)}return(0,_t.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,l=r.viewportHeight,p=r.viewportWidth;this.viewport=new w2({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),lI=["id","attributionControl","style","token","rotation","mapInstance"],C2,A2;function cI(e){var i=fI();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function fI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function hI(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}hI(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Av();var pI=0,T2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",dI=(C2=(0,sn.b2)(),C2(A2=function(e){(0,pr.Z)(r,e);var i=cI(r);function r(){var n;(0,vt.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,X.Z)((0,Le.Z)(n),"version",ps.MAPBOX),n}return(0,_t.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,E=u.z,C=E===void 0?0:E;return{x:p,y:x,z:C}}},{key:"getModelMatrix",value:function(t,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),E=tn();return qn(E,E,Ka.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),aa(E,E,Ka.fromValues(x*l[0],-x*l[1],x*l[2])),ho(E,E,u[0]),po(E,E,u[1]),qa(E,E,u[2]),E}},{key:"init",value:function(){var n=(0,be.Z)($().mark(function o(){var u=this,l,p,v,x,E,C,T,O,L,B,V,ne,ie;return $().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,E=x===void 0?!1:x,C=l.style,T=C===void 0?"light":C,O=l.token,L=O===void 0?T2:O,B=l.rotation,V=B===void 0?0:B,ne=l.mapInstance,ie=(0,Ji.Z)(l,lI),this.viewport=new uI,!ne&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),L===T2&&T!=="blank"&&!window.mapboxgl.accessToken&&!ne&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ne&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=L),ne?(this.map=ne,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,Y.Z)({container:this.$mapContainer,style:this.getMapStyleValue(T),attributionControl:E,bearing:V},ie))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Fe.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(l))}},{key:"once",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Av()).LngLat(t[0],t[1]),l=new(Av()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=Av().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Av().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),E=v.x,C=v.y,T=x.x,O=x.y,L=Math.sqrt(Math.pow(E-T,2)+Math.pow(C-O,2))*4194304*2;return L/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+pI++,o.appendChild(u),u}}]),r}(J7))||A2);function vI(e){var i=mI();return function(){var n=(0,Ye.Z)(e),t;if(i){var o=(0,Ye.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,wr.Z)(this,t)}}function mI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gI(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}gI(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var yI=function(e){(0,pr.Z)(r,e);var i=vI(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,_t.Z)(r,[{key:"getServiceConstructor",value:function(){return dI}}]),r}($7);function M2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k2(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?M2(Object(r),!0).forEach(function(n){_I(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _I(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function xI(e,i){return wI(e)||SI(e,i)||EI(e,i)||bI()}function bI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EI(e,i){if(!!e){if(typeof e=="string")return I2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I2(e,i)}}function I2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function SI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function wI(e){if(Array.isArray(e))return e}var CI=he.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,he.createRef)(),l=(0,he.useState)(),p=xI(l,2),v=p[0],x=p[1];return(0,he.useEffect)(function(){var E=new V7(k2(k2({id:u.current},t),{},{map:new yI(n)}));return E.on("loaded",function(){x(E),o&&o(E)}),function(){E.destroy()}},[]),(0,he.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,he.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,he.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,he.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,he.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),he.createElement(y.Provider,{value:v},(0,he.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),AI=CI;function P2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?P2(Object(r),!0).forEach(function(n){TI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TI(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function a8(e,i){return PI(e)||II(e,i)||kI(e,i)||MI()}function MI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kI(e,i){if(!!e){if(typeof e=="string")return R2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R2(e,i)}}function R2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function II(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function PI(e){if(Array.isArray(e))return e}var o8=null,s8=null;function O2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O2(Object(r),!0).forEach(function(n){RI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RI(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function l8(e,i){return DI(e)||FI(e,i)||LI(e,i)||OI()}function OI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LI(e,i){if(!!e){if(typeof e=="string")return L2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L2(e,i)}}function L2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function FI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function DI(e){if(Array.isArray(e))return e}var c8=null,f8=null;function F2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?F2(Object(r),!0).forEach(function(n){BI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BI(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function p8(e,i){return UI(e)||ZI(e,i)||zI(e,i)||NI()}function NI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zI(e,i){if(!!e){if(typeof e=="string")return D2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D2(e,i)}}function D2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ZI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function UI(e){if(Array.isArray(e))return e}var d8=null,v8=null;function m8(e,i){return HI(e)||GI(e,i)||jI(e,i)||VI()}function VI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jI(e,i){if(!!e){if(typeof e=="string")return B2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B2(e,i)}}function B2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function GI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function HI(e){if(Array.isArray(e))return e}var g8=null,y8=null;function N2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _8(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N2(Object(r),!0).forEach(function(n){WI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WI(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function x8(e,i){if(e==null)return{};var r=XI(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function XI(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var b8={exportImage:MC,fullscreen:CC,geoLocate:PC,layer:V_,layerSwitch:V_,logo:B_,mapTheme:DC,mouseLocation:UC,zoom:GC,scale:XC},E8=null,z2=se(73935);function Z2(e,i){return KI(e)||qI(e,i)||YI(e,i)||$I()}function $I(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YI(e,i){if(!!e){if(typeof e=="string")return U2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U2(e,i)}}function U2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qI(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function KI(e){if(Array.isArray(e))return e}var V2=he.useEffect,j2=he.useState,QI=/\B([A-Z])/g,JI=function(i){return i.replace(QI,"-$1").toLowerCase()};function S8(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=j2(),u=Z2(o,2),l=u[0],p=u[1],v=useSceneValue(),x=j2(function(){return document.createElement("div")}),E=Z2(x,1),C=E[0];return V2(function(){var T=new Control({position:t});return T.onAdd=function(){if(i&&(C.className=i),r){var O=Object.keys(r).map(function(L){return"".concat(JI(L),":").concat(r[L])}).join(";");C.style.cssText=O}return C},T.onRemove=function(){},p(T),v.addControl(T),function(){v.removeControl(T)}},[]),V2(function(){l&&l.setPosition(t||"bottomleft")},[t]),createPortal(n,C)}var G2=(0,he.createContext)({});function w8(){return useContext(G2)}var eP=se(18446),Wf=se.n(eP),tP=he.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Wf()),rP=he.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Wf()),nP=he.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Wf()),iP=he.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Wf()),aP=he.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Wf()),oP=he.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Wf()),sP=he.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Wf()),uP=he.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Wf()),lP=["data"];function cP(e,i){if(e==null)return{};var r=fP(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function fP(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var hP=he.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=cP(n,lP);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},Wf()),C8=he.useEffect,pP=he.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Wf());function dP(e,i){return yP(e)||gP(e,i)||mP(e,i)||vP()}function vP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mP(e,i){if(!!e){if(typeof e=="string")return H2(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H2(e,i)}}function H2(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function gP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],t=!0,o=!1,u,l;try{for(r=r.call(e);!(t=(u=r.next()).done)&&(n.push(u.value),!(i&&n.length===i));t=!0);}catch(p){o=!0,l=p}finally{try{!t&&r.return!=null&&r.return()}finally{if(o)throw l}}return n}}function yP(e){if(Array.isArray(e))return e}var Mv=he.useEffect,_P=he.useState;function W2(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,E=i.animate,C=i.options,T=i.onLayerLoaded,O=Pe(),L=_P(function(){var ne;switch(e){case"polygonLayer":ne=new Nm(C);break;case"lineLayer":ne=new Dm(C);break;case"pointLayer":ne=new f0(C);break;case"heatmapLayer":ne=new m3(C);break;case"rasterLayer":ne=new h0(C);break;case"imageLayer":ne=new v1(C);break;case"citybuildingLayer":ne=new ZA(C);break;default:ne=new Nm(C)}return ne.on("inited",function(){T&&T(ne,O)}),ne}),B=dP(L,1),V=B[0];return Mv(function(){return O.addLayer(V),function(){O.removeLayer(V)}},[]),Mv(function(){V.inited&&C&&V.updateLayerConfig(C)},[C==null?void 0:C.minZoom,C==null?void 0:C.maxZoom,C==null?void 0:C.visible]),Mv(function(){V.inited&&(C==null?void 0:C.zIndex)&&V.setIndex(C.zIndex)},[C==null?void 0:C.zIndex]),Mv(function(){V.inited&&(C==null?void 0:C.blend)&&V.setBlend(C.blend)},[C==null?void 0:C.blend]),Mv(function(){O.render()}),he.createElement(G2.Provider,{value:V},he.createElement(hP,{layer:V,source:r}),l&&he.createElement(aP,{layer:V,scale:l}),n&&he.createElement(nP,{layer:V,color:n}),u&&he.createElement(uP,{layer:V,size:u}),t&&he.createElement(sP,{layer:V,shape:t}),o&&he.createElement(pP,{layer:V,style:o}),p&&he.createElement(tP,{layer:V,active:p}),v&&he.createElement(oP,{layer:V,select:v}),x&&he.createElement(iP,{layer:V,filter:x}),E&&he.createElement(rP,{layer:V,animate:E}),i.children)}var A8=null,T8=null,xP=he.memo(function(i){return W2("pointLayer",i)}),bP=he.memo(function(i){return W2("heatmapLayer",i)}),M8=null,k8=null,I8=null,P8=he.useEffect,R8=null,O8=null;function pg(e){return pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},pg(e)}function X2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function B0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?X2(Object(r),!0).forEach(function(n){EP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function SP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function $2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wP(e,i,r){return i&&$2(e.prototype,i),r&&$2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function CP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&dg(e,i)}function dg(e,i){return dg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},dg(e,i)}function AP(e){var i=kP();return function(){var n=N0(e),t;if(i){var o=N0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return TP(this,t)}}function TP(e,i){if(i&&(pg(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MP(e)}function MP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function N0(e){return N0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},N0(e)}var L8=function(e){CP(r,e);var i=AP(r);function r(n){var t;return SP(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return wP(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new Tm(B0(B0({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,l,p,v,x,E=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],C=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],T=E.toString()!==C.toString();if(T){var O;this.popup.remove(),this.popup=new Tm(B0(B0({},this.props.option),{},{stopPropagation:(O=this.props.option)===null||O===void 0?void 0:O.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return he.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,z2.createPortal)(t.props.children,t.el)})}}]),r}(he.PureComponent);function vg(e){return vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},vg(e)}function IP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Y2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function PP(e,i,r){return i&&Y2(e.prototype,i),r&&Y2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function RP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&mg(e,i)}function mg(e,i){return mg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},mg(e,i)}function OP(e){var i=DP();return function(){var n=z0(e),t;if(i){var o=z0(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return LP(this,t)}}function LP(e,i){if(i&&(vg(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FP(e)}function FP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function z0(e){return z0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},z0(e)}var F8=function(e){RP(r,e);var i=OP(r);function r(n){var t;return IP(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return PP(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,l=t.option,p=t.onMarkerLoaded,v=new L_(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=JSON.stringify(t==null?void 0:t.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return he.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,z2.createPortal)(t.props.children,t.el)})}}]),r}(he.PureComponent),D8=he.useEffect,B8=null,N8=null,z8=he.useEffect,Z8=null},66213:function(Tn,me,se){"use strict";se.d(me,{Z:function(){return y}});var De=se(77608);function he(Pe,q){for(;!Object.prototype.hasOwnProperty.call(Pe,q)&&(Pe=(0,De.Z)(Pe),Pe!==null););return Pe}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(q,Ce,pe){var Ke=he(q,Ce);if(!!Ke){var Se=Object.getOwnPropertyDescriptor(Ke,Ce);return Se.get?Se.get.call(arguments.length<3?q:pe):Se.value}},y.apply(this,arguments)}},38163:function(Tn){Tn.exports=me;function me(he,y){var Pe=he&&he.type,q;if(Pe==="FeatureCollection")for(q=0;q<he.features.length;q++)me(he.features[q],y);else if(Pe==="GeometryCollection")for(q=0;q<he.geometries.length;q++)me(he.geometries[q],y);else if(Pe==="Feature")me(he.geometry,y);else if(Pe==="Polygon")se(he.coordinates,y);else if(Pe==="MultiPolygon")for(q=0;q<he.coordinates.length;q++)se(he.coordinates[q],y);return he}function se(he,y){if(he.length!==0){De(he[0],y);for(var Pe=1;Pe<he.length;Pe++)De(he[Pe],!y)}}function De(he,y){for(var Pe=0,q=0,Ce=0,pe=he.length,Ke=pe-1;Ce<pe;Ke=Ce++){var Se=(he[Ce][0]-he[Ke][0])*(he[Ke][1]+he[Ce][1]),ot=Pe+Se;q+=Math.abs(Pe)>=Math.abs(Se)?Pe-ot+Se:Se-ot+Pe,Pe=ot}Pe+q>=0!=!!y&&he.reverse()}},75550:function(Tn){"use strict";Tn.exports=me;function me(se,De){this.x=se,this.y=De}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(se){return this.clone()._add(se)},sub:function(se){return this.clone()._sub(se)},multByPoint:function(se){return this.clone()._multByPoint(se)},divByPoint:function(se){return this.clone()._divByPoint(se)},mult:function(se){return this.clone()._mult(se)},div:function(se){return this.clone()._div(se)},rotate:function(se){return this.clone()._rotate(se)},rotateAround:function(se,De){return this.clone()._rotateAround(se,De)},matMult:function(se){return this.clone()._matMult(se)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(se){return this.x===se.x&&this.y===se.y},dist:function(se){return Math.sqrt(this.distSqr(se))},distSqr:function(se){var De=se.x-this.x,he=se.y-this.y;return De*De+he*he},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(se){return Math.atan2(this.y-se.y,this.x-se.x)},angleWith:function(se){return this.angleWithSep(se.x,se.y)},angleWithSep:function(se,De){return Math.atan2(this.x*De-this.y*se,this.x*se+this.y*De)},_matMult:function(se){var De=se[0]*this.x+se[1]*this.y,he=se[2]*this.x+se[3]*this.y;return this.x=De,this.y=he,this},_add:function(se){return this.x+=se.x,this.y+=se.y,this},_sub:function(se){return this.x-=se.x,this.y-=se.y,this},_mult:function(se){return this.x*=se,this.y*=se,this},_div:function(se){return this.x/=se,this.y/=se,this},_multByPoint:function(se){return this.x*=se.x,this.y*=se.y,this},_divByPoint:function(se){return this.x/=se.x,this.y/=se.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var se=this.y;return this.y=this.x,this.x=-se,this},_rotate:function(se){var De=Math.cos(se),he=Math.sin(se),y=De*this.x-he*this.y,Pe=he*this.x+De*this.y;return this.x=y,this.y=Pe,this},_rotateAround:function(se,De){var he=Math.cos(se),y=Math.sin(se),Pe=De.x+he*(this.x-De.x)-y*(this.y-De.y),q=De.y+y*(this.x-De.x)+he*(this.y-De.y);return this.x=Pe,this.y=q,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(se){return se instanceof me?se:Array.isArray(se)?new me(se[0],se[1]):se}},38929:function(Tn,me,se){Tn.exports.VectorTile=se(22779),se(66024),se(59701)},22779:function(Tn,me,se){"use strict";var De=se(59701);Tn.exports=he;function he(Pe,q){this.layers=Pe.readFields(y,{},q)}function y(Pe,q,Ce){if(Pe===3){var pe=new De(Ce,Ce.readVarint()+Ce.pos);pe.length&&(q[pe.name]=pe)}}},66024:function(Tn,me,se){"use strict";var De=se(75550);Tn.exports=he;function he(pe,Ke,Se,ot,mt){this.properties={},this.extent=Se,this.type=0,this._pbf=pe,this._geometry=-1,this._keys=ot,this._values=mt,pe.readFields(y,this,Ke)}function y(pe,Ke,Se){pe==1?Ke.id=Se.readVarint():pe==2?Pe(Se,Ke):pe==3?Ke.type=Se.readVarint():pe==4&&(Ke._geometry=Se.pos)}function Pe(pe,Ke){for(var Se=pe.readVarint()+pe.pos;pe.pos<Se;){var ot=Ke._keys[pe.readVarint()],mt=Ke._values[pe.readVarint()];Ke.properties[ot]=mt}}he.types=["Unknown","Point","LineString","Polygon"],he.prototype.loadGeometry=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Ke=pe.readVarint()+pe.pos,Se=1,ot=0,mt=0,bt=0,Dt=[],_r;pe.pos<Ke;){if(ot<=0){var Nt=pe.readVarint();Se=Nt&7,ot=Nt>>3}if(ot--,Se===1||Se===2)mt+=pe.readSVarint(),bt+=pe.readSVarint(),Se===1&&(_r&&Dt.push(_r),_r=[]),_r.push(new De(mt,bt));else if(Se===7)_r&&_r.push(_r[0].clone());else throw new Error("unknown command "+Se)}return _r&&Dt.push(_r),Dt},he.prototype.bbox=function(){var pe=this._pbf;pe.pos=this._geometry;for(var Ke=pe.readVarint()+pe.pos,Se=1,ot=0,mt=0,bt=0,Dt=Infinity,_r=-Infinity,Nt=Infinity,gr=-Infinity;pe.pos<Ke;){if(ot<=0){var Qt=pe.readVarint();Se=Qt&7,ot=Qt>>3}if(ot--,Se===1||Se===2)mt+=pe.readSVarint(),bt+=pe.readSVarint(),mt<Dt&&(Dt=mt),mt>_r&&(_r=mt),bt<Nt&&(Nt=bt),bt>gr&&(gr=bt);else if(Se!==7)throw new Error("unknown command "+Se)}return[Dt,Nt,_r,gr]},he.prototype.toGeoJSON=function(pe,Ke,Se){var ot=this.extent*Math.pow(2,Se),mt=this.extent*pe,bt=this.extent*Ke,Dt=this.loadGeometry(),_r=he.types[this.type],Nt,gr;function Qt(xr){for(var ee=0;ee<xr.length;ee++){var sr=xr[ee],Tt=180-(sr.y+bt)*360/ot;xr[ee]=[(sr.x+mt)*360/ot-180,360/Math.PI*Math.atan(Math.exp(Tt*Math.PI/180))-90]}}switch(this.type){case 1:var Pt=[];for(Nt=0;Nt<Dt.length;Nt++)Pt[Nt]=Dt[Nt][0];Dt=Pt,Qt(Dt);break;case 2:for(Nt=0;Nt<Dt.length;Nt++)Qt(Dt[Nt]);break;case 3:for(Dt=q(Dt),Nt=0;Nt<Dt.length;Nt++)for(gr=0;gr<Dt[Nt].length;gr++)Qt(Dt[Nt][gr]);break}Dt.length===1?Dt=Dt[0]:_r="Multi"+_r;var Ft={type:"Feature",geometry:{type:_r,coordinates:Dt},properties:this.properties};return"id"in this&&(Ft.id=this.id),Ft};function q(pe){var Ke=pe.length;if(Ke<=1)return[pe];for(var Se=[],ot,mt,bt=0;bt<Ke;bt++){var Dt=Ce(pe[bt]);Dt!==0&&(mt===void 0&&(mt=Dt<0),mt===Dt<0?(ot&&Se.push(ot),ot=[pe[bt]]):ot.push(pe[bt]))}return ot&&Se.push(ot),Se}function Ce(pe){for(var Ke=0,Se=0,ot=pe.length,mt=ot-1,bt,Dt;Se<ot;mt=Se++)bt=pe[Se],Dt=pe[mt],Ke+=(Dt.x-bt.x)*(bt.y+Dt.y);return Ke}},59701:function(Tn,me,se){"use strict";var De=se(66024);Tn.exports=he;function he(q,Ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=q,this._keys=[],this._values=[],this._features=[],q.readFields(y,this,Ce),this.length=this._features.length}function y(q,Ce,pe){q===15?Ce.version=pe.readVarint():q===1?Ce.name=pe.readString():q===5?Ce.extent=pe.readVarint():q===2?Ce._features.push(pe.pos):q===3?Ce._keys.push(pe.readString()):q===4&&Ce._values.push(Pe(pe))}function Pe(q){for(var Ce=null,pe=q.readVarint()+q.pos;q.pos<pe;){var Ke=q.readVarint()>>3;Ce=Ke===1?q.readString():Ke===2?q.readFloat():Ke===3?q.readDouble():Ke===4?q.readVarint64():Ke===5?q.readVarint():Ke===6?q.readSVarint():Ke===7?q.readBoolean():null}return Ce}he.prototype.feature=function(q){if(q<0||q>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[q];var Ce=this._pbf.readVarint()+this._pbf.pos;return new De(this._pbf,Ce,this.extent,this._keys,this._values)}},53645:function(){},9187:function(Tn){"use strict";Tn.exports=me,Tn.exports.default=me;function me(W,Y,Re){Re=Re||2;var gt=Y&&Y.length,wt=gt?Y[0]*Re:W.length,qt=se(W,0,wt,Re,!0),fr=[];if(!qt||qt.next===qt.prev)return fr;var br,bn,en,Ci,Wn,Vn,va;if(gt&&(qt=pe(W,Y,qt,Re)),W.length>80*Re){br=en=W[0],bn=Ci=W[1];for(var Si=Re;Si<wt;Si+=Re)Wn=W[Si],Vn=W[Si+1],Wn<br&&(br=Wn),Vn<bn&&(bn=Vn),Wn>en&&(en=Wn),Vn>Ci&&(Ci=Vn);va=Math.max(en-br,Ci-bn),va=va!==0?32767/va:0}return he(qt,fr,Re,br,bn,va,0),fr}function se(W,Y,Re,gt,wt){var qt,fr;if(wt===He(W,Y,Re,gt)>0)for(qt=Y;qt<Re;qt+=gt)fr=lr(qt,W[qt],W[qt+1],fr);else for(qt=Re-gt;qt>=Y;qt-=gt)fr=lr(qt,W[qt],W[qt+1],fr);return fr&&Ft(fr,fr.next)&&(jr(fr),fr=fr.next),fr}function De(W,Y){if(!W)return W;Y||(Y=W);var Re=W,gt;do if(gt=!1,!Re.steiner&&(Ft(Re,Re.next)||Pt(Re.prev,Re,Re.next)===0)){if(jr(Re),Re=Y=Re.prev,Re===Re.next)break;gt=!0}else Re=Re.next;while(gt||Re!==Y);return Y}function he(W,Y,Re,gt,wt,qt,fr){if(!!W){!fr&&qt&&bt(W,gt,wt,qt);for(var br=W,bn,en;W.prev!==W.next;){if(bn=W.prev,en=W.next,qt?Pe(W,gt,wt,qt):y(W)){Y.push(bn.i/Re|0),Y.push(W.i/Re|0),Y.push(en.i/Re|0),jr(W),W=en.next,br=en.next;continue}if(W=en,W===br){fr?fr===1?(W=q(De(W),Y,Re),he(W,Y,Re,gt,wt,qt,2)):fr===2&&Ce(W,Y,Re,gt,wt,qt):he(De(W),Y,Re,gt,wt,qt,1);break}}}}function y(W){var Y=W.prev,Re=W,gt=W.next;if(Pt(Y,Re,gt)>=0)return!1;for(var wt=Y.x,qt=Re.x,fr=gt.x,br=Y.y,bn=Re.y,en=gt.y,Ci=wt<qt?wt<fr?wt:fr:qt<fr?qt:fr,Wn=br<bn?br<en?br:en:bn<en?bn:en,Vn=wt>qt?wt>fr?wt:fr:qt>fr?qt:fr,va=br>bn?br>en?br:en:bn>en?bn:en,Si=gt.next;Si!==Y;){if(Si.x>=Ci&&Si.x<=Vn&&Si.y>=Wn&&Si.y<=va&&gr(wt,br,qt,bn,fr,en,Si.x,Si.y)&&Pt(Si.prev,Si,Si.next)>=0)return!1;Si=Si.next}return!0}function Pe(W,Y,Re,gt){var wt=W.prev,qt=W,fr=W.next;if(Pt(wt,qt,fr)>=0)return!1;for(var br=wt.x,bn=qt.x,en=fr.x,Ci=wt.y,Wn=qt.y,Vn=fr.y,va=br<bn?br<en?br:en:bn<en?bn:en,Si=Ci<Wn?Ci<Vn?Ci:Vn:Wn<Vn?Wn:Vn,ci=br>bn?br>en?br:en:bn>en?bn:en,Vi=Ci>Wn?Ci>Vn?Ci:Vn:Wn>Vn?Wn:Vn,zi=_r(va,Si,Y,Re,gt),_i=_r(ci,Vi,Y,Re,gt),$n=W.prevZ,ii=W.nextZ;$n&&$n.z>=zi&&ii&&ii.z<=_i;){if($n.x>=va&&$n.x<=ci&&$n.y>=Si&&$n.y<=Vi&&$n!==wt&&$n!==fr&&gr(br,Ci,bn,Wn,en,Vn,$n.x,$n.y)&&Pt($n.prev,$n,$n.next)>=0||($n=$n.prevZ,ii.x>=va&&ii.x<=ci&&ii.y>=Si&&ii.y<=Vi&&ii!==wt&&ii!==fr&&gr(br,Ci,bn,Wn,en,Vn,ii.x,ii.y)&&Pt(ii.prev,ii,ii.next)>=0))return!1;ii=ii.nextZ}for(;$n&&$n.z>=zi;){if($n.x>=va&&$n.x<=ci&&$n.y>=Si&&$n.y<=Vi&&$n!==wt&&$n!==fr&&gr(br,Ci,bn,Wn,en,Vn,$n.x,$n.y)&&Pt($n.prev,$n,$n.next)>=0)return!1;$n=$n.prevZ}for(;ii&&ii.z<=_i;){if(ii.x>=va&&ii.x<=ci&&ii.y>=Si&&ii.y<=Vi&&ii!==wt&&ii!==fr&&gr(br,Ci,bn,Wn,en,Vn,ii.x,ii.y)&&Pt(ii.prev,ii,ii.next)>=0)return!1;ii=ii.nextZ}return!0}function q(W,Y,Re){var gt=W;do{var wt=gt.prev,qt=gt.next.next;!Ft(wt,qt)&&xr(wt,gt,gt.next,qt)&&ht(wt,qt)&&ht(qt,wt)&&(Y.push(wt.i/Re|0),Y.push(gt.i/Re|0),Y.push(qt.i/Re|0),jr(gt),jr(gt.next),gt=W=qt),gt=gt.next}while(gt!==W);return De(gt)}function Ce(W,Y,Re,gt,wt,qt){var fr=W;do{for(var br=fr.next.next;br!==fr.prev;){if(fr.i!==br.i&&Qt(fr,br)){var bn=dt(fr,br);fr=De(fr,fr.next),bn=De(bn,bn.next),he(fr,Y,Re,gt,wt,qt,0),he(bn,Y,Re,gt,wt,qt,0);return}br=br.next}fr=fr.next}while(fr!==W)}function pe(W,Y,Re,gt){var wt=[],qt,fr,br,bn,en;for(qt=0,fr=Y.length;qt<fr;qt++)br=Y[qt]*gt,bn=qt<fr-1?Y[qt+1]*gt:W.length,en=se(W,br,bn,gt,!1),en===en.next&&(en.steiner=!0),wt.push(Nt(en));for(wt.sort(Ke),qt=0;qt<wt.length;qt++)Re=Se(wt[qt],Re);return Re}function Ke(W,Y){return W.x-Y.x}function Se(W,Y){var Re=ot(W,Y);if(!Re)return Y;var gt=dt(Re,W);return De(gt,gt.next),De(Re,Re.next)}function ot(W,Y){var Re=Y,gt=W.x,wt=W.y,qt=-Infinity,fr;do{if(wt<=Re.y&&wt>=Re.next.y&&Re.next.y!==Re.y){var br=Re.x+(wt-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(br<=gt&&br>qt&&(qt=br,fr=Re.x<Re.next.x?Re:Re.next,br===gt))return fr}Re=Re.next}while(Re!==Y);if(!fr)return null;var bn=fr,en=fr.x,Ci=fr.y,Wn=Infinity,Vn;Re=fr;do gt>=Re.x&&Re.x>=en&&gt!==Re.x&&gr(wt<Ci?gt:qt,wt,en,Ci,wt<Ci?qt:gt,wt,Re.x,Re.y)&&(Vn=Math.abs(wt-Re.y)/(gt-Re.x),ht(Re,W)&&(Vn<Wn||Vn===Wn&&(Re.x>fr.x||Re.x===fr.x&&mt(fr,Re)))&&(fr=Re,Wn=Vn)),Re=Re.next;while(Re!==bn);return fr}function mt(W,Y){return Pt(W.prev,W,Y.prev)<0&&Pt(Y.next,W,W.next)<0}function bt(W,Y,Re,gt){var wt=W;do wt.z===0&&(wt.z=_r(wt.x,wt.y,Y,Re,gt)),wt.prevZ=wt.prev,wt.nextZ=wt.next,wt=wt.next;while(wt!==W);wt.prevZ.nextZ=null,wt.prevZ=null,Dt(wt)}function Dt(W){var Y,Re,gt,wt,qt,fr,br,bn,en=1;do{for(Re=W,W=null,qt=null,fr=0;Re;){for(fr++,gt=Re,br=0,Y=0;Y<en&&(br++,gt=gt.nextZ,!!gt);Y++);for(bn=en;br>0||bn>0&&gt;)br!==0&&(bn===0||!gt||Re.z<=gt.z)?(wt=Re,Re=Re.nextZ,br--):(wt=gt,gt=gt.nextZ,bn--),qt?qt.nextZ=wt:W=wt,wt.prevZ=qt,qt=wt;Re=gt}qt.nextZ=null,en*=2}while(fr>1);return W}function _r(W,Y,Re,gt,wt){return W=(W-Re)*wt|0,Y=(Y-gt)*wt|0,W=(W|W<<8)&16711935,W=(W|W<<4)&252645135,W=(W|W<<2)&858993459,W=(W|W<<1)&1431655765,Y=(Y|Y<<8)&16711935,Y=(Y|Y<<4)&252645135,Y=(Y|Y<<2)&858993459,Y=(Y|Y<<1)&1431655765,W|Y<<1}function Nt(W){var Y=W,Re=W;do(Y.x<Re.x||Y.x===Re.x&&Y.y<Re.y)&&(Re=Y),Y=Y.next;while(Y!==W);return Re}function gr(W,Y,Re,gt,wt,qt,fr,br){return(wt-fr)*(Y-br)>=(W-fr)*(qt-br)&&(W-fr)*(gt-br)>=(Re-fr)*(Y-br)&&(Re-fr)*(qt-br)>=(wt-fr)*(gt-br)}function Qt(W,Y){return W.next.i!==Y.i&&W.prev.i!==Y.i&&!Tt(W,Y)&&(ht(W,Y)&&ht(Y,W)&&jt(W,Y)&&(Pt(W.prev,W,Y.prev)||Pt(W,Y.prev,Y))||Ft(W,Y)&&Pt(W.prev,W,W.next)>0&&Pt(Y.prev,Y,Y.next)>0)}function Pt(W,Y,Re){return(Y.y-W.y)*(Re.x-Y.x)-(Y.x-W.x)*(Re.y-Y.y)}function Ft(W,Y){return W.x===Y.x&&W.y===Y.y}function xr(W,Y,Re,gt){var wt=sr(Pt(W,Y,Re)),qt=sr(Pt(W,Y,gt)),fr=sr(Pt(Re,gt,W)),br=sr(Pt(Re,gt,Y));return!!(wt!==qt&&fr!==br||wt===0&&ee(W,Re,Y)||qt===0&&ee(W,gt,Y)||fr===0&&ee(Re,W,gt)||br===0&&ee(Re,Y,gt))}function ee(W,Y,Re){return Y.x<=Math.max(W.x,Re.x)&&Y.x>=Math.min(W.x,Re.x)&&Y.y<=Math.max(W.y,Re.y)&&Y.y>=Math.min(W.y,Re.y)}function sr(W){return W>0?1:W<0?-1:0}function Tt(W,Y){var Re=W;do{if(Re.i!==W.i&&Re.next.i!==W.i&&Re.i!==Y.i&&Re.next.i!==Y.i&&xr(Re,Re.next,W,Y))return!0;Re=Re.next}while(Re!==W);return!1}function ht(W,Y){return Pt(W.prev,W,W.next)<0?Pt(W,Y,W.next)>=0&&Pt(W,W.prev,Y)>=0:Pt(W,Y,W.prev)<0||Pt(W,W.next,Y)<0}function jt(W,Y){var Re=W,gt=!1,wt=(W.x+Y.x)/2,qt=(W.y+Y.y)/2;do Re.y>qt!=Re.next.y>qt&&Re.next.y!==Re.y&&wt<(Re.next.x-Re.x)*(qt-Re.y)/(Re.next.y-Re.y)+Re.x&&(gt=!gt),Re=Re.next;while(Re!==W);return gt}function dt(W,Y){var Re=new ue(W.i,W.x,W.y),gt=new ue(Y.i,Y.x,Y.y),wt=W.next,qt=Y.prev;return W.next=Y,Y.prev=W,Re.next=wt,wt.prev=Re,gt.next=Re,Re.prev=gt,qt.next=gt,gt.prev=qt,gt}function lr(W,Y,Re,gt){var wt=new ue(W,Y,Re);return gt?(wt.next=gt.next,wt.prev=gt,gt.next.prev=wt,gt.next=wt):(wt.prev=wt,wt.next=wt),wt}function jr(W){W.next.prev=W.prev,W.prev.next=W.next,W.prevZ&&(W.prevZ.nextZ=W.nextZ),W.nextZ&&(W.nextZ.prevZ=W.prevZ)}function ue(W,Y,Re){this.i=W,this.x=Y,this.y=Re,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}me.deviation=function(W,Y,Re,gt){var wt=Y&&Y.length,qt=wt?Y[0]*Re:W.length,fr=Math.abs(He(W,0,qt,Re));if(wt)for(var br=0,bn=Y.length;br<bn;br++){var en=Y[br]*Re,Ci=br<bn-1?Y[br+1]*Re:W.length;fr-=Math.abs(He(W,en,Ci,Re))}var Wn=0;for(br=0;br<gt.length;br+=3){var Vn=gt[br]*Re,va=gt[br+1]*Re,Si=gt[br+2]*Re;Wn+=Math.abs((W[Vn]-W[Si])*(W[va+1]-W[Vn+1])-(W[Vn]-W[va])*(W[Si+1]-W[Vn+1]))}return fr===0&&Wn===0?0:Math.abs((Wn-fr)/fr)};function He(W,Y,Re,gt){for(var wt=0,qt=Y,fr=Re-gt;qt<Re;qt+=gt)wt+=(W[fr]-W[qt])*(W[qt+1]+W[fr+1]),fr=qt;return wt}me.flatten=function(W){for(var Y=W[0][0].length,Re={vertices:[],holes:[],dimensions:Y},gt=0,wt=0;wt<W.length;wt++){for(var qt=0;qt<W[wt].length;qt++)for(var fr=0;fr<Y;fr++)Re.vertices.push(W[wt][qt][fr]);wt>0&&(gt+=W[wt-1].length,Re.holes.push(gt))}return Re}},67709:function(Tn){function me(De){var he=De.target||De.srcElement;he.__resizeRAF__&&cancelAnimationFrame(he.__resizeRAF__),he.__resizeRAF__=requestAnimationFrame(function(){var y=he.__resizeTrigger__,Pe=y&&y.__resizeListeners__;Pe&&Pe.forEach(function(q){q.call(y,De)})})}var se=function(he,y){var Pe=this,q=Pe.document,Ce,pe=q.attachEvent;typeof navigator!="undefined"&&(Ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ke(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",me)}if(!he.__resizeListeners__)if(he.__resizeListeners__=[],pe)he.__resizeTrigger__=he,he.attachEvent("onresize",me);else{getComputedStyle(he).position==="static"&&(he.style.position="relative");var Se=he.__resizeTrigger__=q.createElement("object");Se.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Se.setAttribute("class","resize-sensor"),Se.setAttribute("tabindex","-1"),Se.setAttribute("title",""),Se.__resizeElement__=he,Se.onload=Ke,Se.type="text/html",Ce&&he.appendChild(Se),Se.data="about:blank",Ce||he.appendChild(Se)}he.__resizeListeners__.push(y)};Tn.exports=typeof window=="undefined"?se:se.bind(window),Tn.exports.unbind=function(De,he){var y=document.attachEvent,Pe=De.__resizeListeners__||[];if(he){var q=Pe.indexOf(he);q!==-1&&Pe.splice(q,1)}else Pe=De.__resizeListeners__=[];if(!Pe.length){if(y)De.detachEvent("onresize",me);else if(De.__resizeTrigger__){var Ce=De.__resizeTrigger__.contentDocument,pe=Ce&&Ce.defaultView;pe&&(pe.removeEventListener("resize",me),delete pe.__resizeTrigger__),De.__resizeTrigger__=!De.removeChild(De.__resizeTrigger__)}delete De.__resizeListeners__}}},26729:function(Tn){"use strict";var me=Object.prototype.hasOwnProperty,se="~";function De(){}Object.create&&(De.prototype=Object.create(null),new De().__proto__||(se=!1));function he(Ce,pe,Ke){this.fn=Ce,this.context=pe,this.once=Ke||!1}function y(Ce,pe,Ke,Se,ot){if(typeof Ke!="function")throw new TypeError("The listener must be a function");var mt=new he(Ke,Se||Ce,ot),bt=se?se+pe:pe;return Ce._events[bt]?Ce._events[bt].fn?Ce._events[bt]=[Ce._events[bt],mt]:Ce._events[bt].push(mt):(Ce._events[bt]=mt,Ce._eventsCount++),Ce}function Pe(Ce,pe){--Ce._eventsCount==0?Ce._events=new De:delete Ce._events[pe]}function q(){this._events=new De,this._eventsCount=0}q.prototype.eventNames=function(){var pe=[],Ke,Se;if(this._eventsCount===0)return pe;for(Se in Ke=this._events)me.call(Ke,Se)&&pe.push(se?Se.slice(1):Se);return Object.getOwnPropertySymbols?pe.concat(Object.getOwnPropertySymbols(Ke)):pe},q.prototype.listeners=function(pe){var Ke=se?se+pe:pe,Se=this._events[Ke];if(!Se)return[];if(Se.fn)return[Se.fn];for(var ot=0,mt=Se.length,bt=new Array(mt);ot<mt;ot++)bt[ot]=Se[ot].fn;return bt},q.prototype.listenerCount=function(pe){var Ke=se?se+pe:pe,Se=this._events[Ke];return Se?Se.fn?1:Se.length:0},q.prototype.emit=function(pe,Ke,Se,ot,mt,bt){var Dt=se?se+pe:pe;if(!this._events[Dt])return!1;var _r=this._events[Dt],Nt=arguments.length,gr,Qt;if(_r.fn){switch(_r.once&&this.removeListener(pe,_r.fn,void 0,!0),Nt){case 1:return _r.fn.call(_r.context),!0;case 2:return _r.fn.call(_r.context,Ke),!0;case 3:return _r.fn.call(_r.context,Ke,Se),!0;case 4:return _r.fn.call(_r.context,Ke,Se,ot),!0;case 5:return _r.fn.call(_r.context,Ke,Se,ot,mt),!0;case 6:return _r.fn.call(_r.context,Ke,Se,ot,mt,bt),!0}for(Qt=1,gr=new Array(Nt-1);Qt<Nt;Qt++)gr[Qt-1]=arguments[Qt];_r.fn.apply(_r.context,gr)}else{var Pt=_r.length,Ft;for(Qt=0;Qt<Pt;Qt++)switch(_r[Qt].once&&this.removeListener(pe,_r[Qt].fn,void 0,!0),Nt){case 1:_r[Qt].fn.call(_r[Qt].context);break;case 2:_r[Qt].fn.call(_r[Qt].context,Ke);break;case 3:_r[Qt].fn.call(_r[Qt].context,Ke,Se);break;case 4:_r[Qt].fn.call(_r[Qt].context,Ke,Se,ot);break;default:if(!gr)for(Ft=1,gr=new Array(Nt-1);Ft<Nt;Ft++)gr[Ft-1]=arguments[Ft];_r[Qt].fn.apply(_r[Qt].context,gr)}}return!0},q.prototype.on=function(pe,Ke,Se){return y(this,pe,Ke,Se,!1)},q.prototype.once=function(pe,Ke,Se){return y(this,pe,Ke,Se,!0)},q.prototype.removeListener=function(pe,Ke,Se,ot){var mt=se?se+pe:pe;if(!this._events[mt])return this;if(!Ke)return Pe(this,mt),this;var bt=this._events[mt];if(bt.fn)bt.fn===Ke&&(!ot||bt.once)&&(!Se||bt.context===Se)&&Pe(this,mt);else{for(var Dt=0,_r=[],Nt=bt.length;Dt<Nt;Dt++)(bt[Dt].fn!==Ke||ot&&!bt[Dt].once||Se&&bt[Dt].context!==Se)&&_r.push(bt[Dt]);_r.length?this._events[mt]=_r.length===1?_r[0]:_r:Pe(this,mt)}return this},q.prototype.removeAllListeners=function(pe){var Ke;return pe?(Ke=se?se+pe:pe,this._events[Ke]&&Pe(this,Ke)):(this._events=new De,this._eventsCount=0),this},q.prototype.off=q.prototype.removeListener,q.prototype.addListener=q.prototype.on,q.prefixed=se,q.EventEmitter=q,Tn.exports=q},80645:function(Tn,me){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */me.read=function(se,De,he,y,Pe){var q,Ce,pe=Pe*8-y-1,Ke=(1<<pe)-1,Se=Ke>>1,ot=-7,mt=he?Pe-1:0,bt=he?-1:1,Dt=se[De+mt];for(mt+=bt,q=Dt&(1<<-ot)-1,Dt>>=-ot,ot+=pe;ot>0;q=q*256+se[De+mt],mt+=bt,ot-=8);for(Ce=q&(1<<-ot)-1,q>>=-ot,ot+=y;ot>0;Ce=Ce*256+se[De+mt],mt+=bt,ot-=8);if(q===0)q=1-Se;else{if(q===Ke)return Ce?NaN:(Dt?-1:1)*Infinity;Ce=Ce+Math.pow(2,y),q=q-Se}return(Dt?-1:1)*Ce*Math.pow(2,q-y)},me.write=function(se,De,he,y,Pe,q){var Ce,pe,Ke,Se=q*8-Pe-1,ot=(1<<Se)-1,mt=ot>>1,bt=Pe===23?Math.pow(2,-24)-Math.pow(2,-77):0,Dt=y?0:q-1,_r=y?1:-1,Nt=De<0||De===0&&1/De<0?1:0;for(De=Math.abs(De),isNaN(De)||De===Infinity?(pe=isNaN(De)?1:0,Ce=ot):(Ce=Math.floor(Math.log(De)/Math.LN2),De*(Ke=Math.pow(2,-Ce))<1&&(Ce--,Ke*=2),Ce+mt>=1?De+=bt/Ke:De+=bt*Math.pow(2,1-mt),De*Ke>=2&&(Ce++,Ke/=2),Ce+mt>=ot?(pe=0,Ce=ot):Ce+mt>=1?(pe=(De*Ke-1)*Math.pow(2,Pe),Ce=Ce+mt):(pe=De*Math.pow(2,mt-1)*Math.pow(2,Pe),Ce=0));Pe>=8;se[he+Dt]=pe&255,Dt+=_r,pe/=256,Pe-=8);for(Ce=Ce<<Pe|pe,Se+=Pe;Se>0;se[he+Dt]=Ce&255,Dt+=_r,Ce/=256,Se-=8);se[he+Dt-_r]|=Nt*128}},7375:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0});var se=Symbol.for("INJECTION");function De(Ce,pe,Ke,Se){function ot(){return Se&&!Reflect.hasMetadata(se,this,pe)&&Reflect.defineMetadata(se,Ke(),this,pe),Reflect.hasMetadata(se,this,pe)?Reflect.getMetadata(se,this,pe):Ke()}function mt(bt){Reflect.defineMetadata(se,bt,this,pe)}Object.defineProperty(Ce,pe,{configurable:!0,enumerable:!0,get:ot,set:mt})}function he(Ce,pe){return function(Ke){return function(Se,ot){var mt=function(){return Ce.get(Ke)};De(Se,ot,mt,pe)}}}me.makePropertyInjectDecorator=he;function y(Ce,pe){return function(Ke,Se){return function(ot,mt){var bt=function(){return Ce.getNamed(Ke,Se)};De(ot,mt,bt,pe)}}}me.makePropertyInjectNamedDecorator=y;function Pe(Ce,pe){return function(Ke,Se,ot){return function(mt,bt){var Dt=function(){return Ce.getTagged(Ke,Se,ot)};De(mt,bt,Dt,pe)}}}me.makePropertyInjectTaggedDecorator=Pe;function q(Ce,pe){return function(Ke){return function(Se,ot){var mt=function(){return Ce.getAll(Ke)};De(Se,ot,mt,pe)}}}me.makePropertyMultiInjectDecorator=q},84879:function(Tn,me,se){"use strict";var De;De={value:!0};var he=se(7375);function y(Pe,q){q===void 0&&(q=!0);var Ce=he.makePropertyInjectDecorator(Pe,q),pe=he.makePropertyInjectNamedDecorator(Pe,q),Ke=he.makePropertyInjectTaggedDecorator(Pe,q),Se=he.makePropertyMultiInjectDecorator(Pe,q);return{lazyInject:Ce,lazyInjectNamed:pe,lazyInjectTagged:Ke,lazyMultiInject:Se}}me.Z=y},99934:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.tagProperty=me.tagParameter=me.decorate=void 0;var De=se(16674),he=se(6867);function y(Se,ot,mt,bt){var Dt=he.TAGGED;q(Dt,Se,ot,bt,mt)}me.tagParameter=y;function Pe(Se,ot,mt){var bt=he.TAGGED_PROP;q(bt,Se.constructor,ot,mt)}me.tagProperty=Pe;function q(Se,ot,mt,bt,Dt){var _r={},Nt=typeof Dt=="number",gr=Dt!==void 0&&Nt?Dt.toString():mt;if(Nt&&mt!==void 0)throw new Error(De.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(Se,ot)&&(_r=Reflect.getMetadata(Se,ot));var Qt=_r[gr];if(!Array.isArray(Qt))Qt=[];else for(var Pt=0,Ft=Qt;Pt<Ft.length;Pt++){var xr=Ft[Pt];if(xr.key===bt.key)throw new Error(De.DUPLICATED_METADATA+" "+xr.key.toString())}Qt.push(bt),_r[gr]=Qt,Reflect.defineMetadata(Se,_r,ot)}function Ce(Se,ot){Reflect.decorate(Se,ot)}function pe(Se,ot){return function(mt,bt){ot(mt,bt,Se)}}function Ke(Se,ot,mt){typeof mt=="number"?Ce([pe(mt,Se)],ot):typeof mt=="string"?Reflect.decorate([Se],ot,mt):Ce([Se],ot)}me.decorate=Ke},5744:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.inject=me.LazyServiceIdentifer=void 0;var De=se(16674),he=se(6867),y=se(47738),Pe=se(99934),q=function(){function pe(Ke){this._cb=Ke}return pe.prototype.unwrap=function(){return this._cb()},pe}();me.LazyServiceIdentifer=q;function Ce(pe){return function(Ke,Se,ot){if(pe===void 0)throw new Error(De.UNDEFINED_INJECT_ANNOTATION(Ke.name));var mt=new y.Metadata(he.INJECT_TAG,pe);typeof ot=="number"?Pe.tagParameter(Ke,Se,ot,mt):Pe.tagProperty(Ke,Se,mt)}}me.inject=Ce},64315:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.injectable=void 0;var De=se(16674),he=se(6867);function y(){return function(Pe){if(Reflect.hasOwnMetadata(he.PARAM_TYPES,Pe))throw new Error(De.DUPLICATED_INJECTABLE_DECORATOR);var q=Reflect.getMetadata(he.DESIGN_PARAM_TYPES,Pe)||[];return Reflect.defineMetadata(he.PARAM_TYPES,q,Pe),Pe}}me.injectable=y},71693:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.multiInject=void 0;var De=se(6867),he=se(47738),y=se(99934);function Pe(q){return function(Ce,pe,Ke){var Se=new he.Metadata(De.MULTI_INJECT_TAG,q);typeof Ke=="number"?y.tagParameter(Ce,pe,Ke,Se):y.tagProperty(Ce,pe,Se)}}me.multiInject=Pe},38085:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.named=void 0;var De=se(6867),he=se(47738),y=se(99934);function Pe(q){return function(Ce,pe,Ke){var Se=new he.Metadata(De.NAMED_TAG,q);typeof Ke=="number"?y.tagParameter(Ce,pe,Ke,Se):y.tagProperty(Ce,pe,Se)}}me.named=Pe},6515:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.optional=void 0;var De=se(6867),he=se(47738),y=se(99934);function Pe(){return function(q,Ce,pe){var Ke=new he.Metadata(De.OPTIONAL_TAG,!0);typeof pe=="number"?y.tagParameter(q,Ce,pe,Ke):y.tagProperty(q,Ce,Ke)}}me.optional=Pe},7014:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.postConstruct=void 0;var De=se(16674),he=se(6867),y=se(47738);function Pe(){return function(q,Ce,pe){var Ke=new y.Metadata(he.POST_CONSTRUCT,Ce);if(Reflect.hasOwnMetadata(he.POST_CONSTRUCT,q.constructor))throw new Error(De.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(he.POST_CONSTRUCT,Ke,q.constructor)}}me.postConstruct=Pe},32052:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.tagged=void 0;var De=se(47738),he=se(99934);function y(Pe,q){return function(Ce,pe,Ke){var Se=new De.Metadata(Pe,q);typeof Ke=="number"?he.tagParameter(Ce,pe,Ke,Se):he.tagProperty(Ce,pe,Se)}}me.tagged=y},55638:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.targetName=void 0;var De=se(6867),he=se(47738),y=se(99934);function Pe(q){return function(Ce,pe,Ke){var Se=new he.Metadata(De.NAME_TAG,q);y.tagParameter(Ce,pe,Ke,Se)}}me.targetName=Pe},86757:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.unmanaged=void 0;var De=se(6867),he=se(47738),y=se(99934);function Pe(){return function(q,Ce,pe){var Ke=new he.Metadata(De.UNMANAGED_TAG,!0);y.tagParameter(q,Ce,pe,Ke)}}me.unmanaged=Pe},44290:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Binding=void 0;var De=se(28421),he=se(37791),y=function(){function Pe(q,Ce){this.id=he.id(),this.activated=!1,this.serviceIdentifier=q,this.scope=Ce,this.type=De.BindingTypeEnum.Invalid,this.constraint=function(pe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Pe.prototype.clone=function(){var q=new Pe(this.serviceIdentifier,this.scope);return q.activated=q.scope===De.BindingScopeEnum.Singleton?this.activated:!1,q.implementationType=this.implementationType,q.dynamicValue=this.dynamicValue,q.scope=this.scope,q.type=this.type,q.factory=this.factory,q.provider=this.provider,q.constraint=this.constraint,q.onActivation=this.onActivation,q.cache=this.cache,q},Pe}();me.Binding=y},23184:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingCount=void 0;var se={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};me.BindingCount=se},16674:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.STACK_OVERFLOW=me.CIRCULAR_DEPENDENCY_IN_FACTORY=me.POST_CONSTRUCT_ERROR=me.MULTIPLE_POST_CONSTRUCT_METHODS=me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=me.ARGUMENTS_LENGTH_MISMATCH=me.INVALID_DECORATOR_OPERATION=me.INVALID_TO_SELF_VALUE=me.INVALID_FUNCTION_BINDING=me.INVALID_MIDDLEWARE_RETURN=me.NO_MORE_SNAPSHOTS_AVAILABLE=me.INVALID_BINDING_TYPE=me.NOT_IMPLEMENTED=me.CIRCULAR_DEPENDENCY=me.UNDEFINED_INJECT_ANNOTATION=me.MISSING_INJECT_ANNOTATION=me.MISSING_INJECTABLE_ANNOTATION=me.NOT_REGISTERED=me.CANNOT_UNBIND=me.AMBIGUOUS_MATCH=me.KEY_NOT_FOUND=me.NULL_ARGUMENT=me.DUPLICATED_METADATA=me.DUPLICATED_INJECTABLE_DECORATOR=void 0,me.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",me.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",me.NULL_ARGUMENT="NULL argument",me.KEY_NOT_FOUND="Key Not Found",me.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",me.CANNOT_UNBIND="Could not unbind serviceIdentifier:",me.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",me.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",me.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var se=function(Pe){return"@inject called with undefined this could mean that the class "+Pe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};me.UNDEFINED_INJECT_ANNOTATION=se,me.CIRCULAR_DEPENDENCY="Circular dependency found:",me.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",me.INVALID_BINDING_TYPE="Invalid binding type:",me.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",me.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",me.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",me.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",me.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var De=function(){for(var Pe=[],q=0;q<arguments.length;q++)Pe[q]=arguments[q];return"The number of constructor arguments in the derived class "+(Pe[0]+" must be >= than the number of constructor arguments of its base class.")};me.ARGUMENTS_LENGTH_MISMATCH=De,me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",me.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var he=function(){for(var Pe=[],q=0;q<arguments.length;q++)Pe[q]=arguments[q];return"@postConstruct error in class "+Pe[0]+": "+Pe[1]};me.POST_CONSTRUCT_ERROR=he;var y=function(){for(var Pe=[],q=0;q<arguments.length;q++)Pe[q]=arguments[q];return"It looks like there is a circular dependency "+("in one of the '"+Pe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Pe[1]+"'.")};me.CIRCULAR_DEPENDENCY_IN_FACTORY=y,me.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.TargetTypeEnum=me.BindingTypeEnum=me.BindingScopeEnum=void 0;var se={Request:"Request",Singleton:"Singleton",Transient:"Transient"};me.BindingScopeEnum=se;var De={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};me.BindingTypeEnum=De;var he={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};me.TargetTypeEnum=he},6867:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.NON_CUSTOM_TAG_KEYS=me.POST_CONSTRUCT=me.DESIGN_PARAM_TYPES=me.PARAM_TYPES=me.TAGGED_PROP=me.TAGGED=me.MULTI_INJECT_TAG=me.INJECT_TAG=me.OPTIONAL_TAG=me.UNMANAGED_TAG=me.NAME_TAG=me.NAMED_TAG=void 0,me.NAMED_TAG="named",me.NAME_TAG="name",me.UNMANAGED_TAG="unmanaged",me.OPTIONAL_TAG="optional",me.INJECT_TAG="inject",me.MULTI_INJECT_TAG="multi_inject",me.TAGGED="inversify:tagged",me.TAGGED_PROP="inversify:tagged_props",me.PARAM_TYPES="inversify:paramtypes",me.DESIGN_PARAM_TYPES="design:paramtypes",me.POST_CONSTRUCT="post_construct";function se(){return[me.INJECT_TAG,me.MULTI_INJECT_TAG,me.NAME_TAG,me.UNMANAGED_TAG,me.NAMED_TAG,me.OPTIONAL_TAG]}me.NON_CUSTOM_TAG_KEYS=se()},51389:function(Tn,me,se){"use strict";var De=this&&this.__awaiter||function(Qt,Pt,Ft,xr){function ee(sr){return sr instanceof Ft?sr:new Ft(function(Tt){Tt(sr)})}return new(Ft||(Ft=Promise))(function(sr,Tt){function ht(lr){try{dt(xr.next(lr))}catch(jr){Tt(jr)}}function jt(lr){try{dt(xr.throw(lr))}catch(jr){Tt(jr)}}function dt(lr){lr.done?sr(lr.value):ee(lr.value).then(ht,jt)}dt((xr=xr.apply(Qt,Pt||[])).next())})},he=this&&this.__generator||function(Qt,Pt){var Ft={label:0,sent:function(){if(sr[0]&1)throw sr[1];return sr[1]},trys:[],ops:[]},xr,ee,sr,Tt;return Tt={next:ht(0),throw:ht(1),return:ht(2)},typeof Symbol=="function"&&(Tt[Symbol.iterator]=function(){return this}),Tt;function ht(dt){return function(lr){return jt([dt,lr])}}function jt(dt){if(xr)throw new TypeError("Generator is already executing.");for(;Ft;)try{if(xr=1,ee&&(sr=dt[0]&2?ee.return:dt[0]?ee.throw||((sr=ee.return)&&sr.call(ee),0):ee.next)&&!(sr=sr.call(ee,dt[1])).done)return sr;switch(ee=0,sr&&(dt=[dt[0]&2,sr.value]),dt[0]){case 0:case 1:sr=dt;break;case 4:return Ft.label++,{value:dt[1],done:!1};case 5:Ft.label++,ee=dt[1],dt=[0];continue;case 7:dt=Ft.ops.pop(),Ft.trys.pop();continue;default:if(sr=Ft.trys,!(sr=sr.length>0&&sr[sr.length-1])&&(dt[0]===6||dt[0]===2)){Ft=0;continue}if(dt[0]===3&&(!sr||dt[1]>sr[0]&&dt[1]<sr[3])){Ft.label=dt[1];break}if(dt[0]===6&&Ft.label<sr[1]){Ft.label=sr[1],sr=dt;break}if(sr&&Ft.label<sr[2]){Ft.label=sr[2],Ft.ops.push(dt);break}sr[2]&&Ft.ops.pop(),Ft.trys.pop();continue}dt=Pt.call(Qt,Ft)}catch(lr){dt=[6,lr],ee=0}finally{xr=sr=0}if(dt[0]&5)throw dt[1];return{value:dt[0]?dt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Qt,Pt){for(var Ft=0,xr=Pt.length,ee=Qt.length;Ft<xr;Ft++,ee++)Qt[ee]=Pt[Ft];return Qt};Object.defineProperty(me,"__esModule",{value:!0}),me.Container=void 0;var Pe=se(44290),q=se(16674),Ce=se(28421),pe=se(6867),Ke=se(51377),Se=se(86311),ot=se(31927),mt=se(15451),bt=se(37791),Dt=se(55800),_r=se(85700),Nt=se(80175),gr=function(){function Qt(Pt){this._appliedMiddleware=[];var Ft=Pt||{};if(typeof Ft!="object")throw new Error(""+q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Ft.defaultScope===void 0)Ft.defaultScope=Ce.BindingScopeEnum.Transient;else if(Ft.defaultScope!==Ce.BindingScopeEnum.Singleton&&Ft.defaultScope!==Ce.BindingScopeEnum.Transient&&Ft.defaultScope!==Ce.BindingScopeEnum.Request)throw new Error(""+q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Ft.autoBindInjectable===void 0)Ft.autoBindInjectable=!1;else if(typeof Ft.autoBindInjectable!="boolean")throw new Error(""+q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Ft.skipBaseClassChecks===void 0)Ft.skipBaseClassChecks=!1;else if(typeof Ft.skipBaseClassChecks!="boolean")throw new Error(""+q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Ft.autoBindInjectable,defaultScope:Ft.defaultScope,skipBaseClassChecks:Ft.skipBaseClassChecks},this.id=bt.id(),this._bindingDictionary=new Nt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ke.MetadataReader}return Qt.merge=function(Pt,Ft){for(var xr=[],ee=2;ee<arguments.length;ee++)xr[ee-2]=arguments[ee];var sr=new Qt,Tt=y([Pt,Ft],xr).map(function(dt){return Se.getBindingDictionary(dt)}),ht=Se.getBindingDictionary(sr);function jt(dt,lr){dt.traverse(function(jr,ue){ue.forEach(function(He){lr.add(He.serviceIdentifier,He.clone())})})}return Tt.forEach(function(dt){jt(dt,ht)}),sr},Qt.prototype.load=function(){for(var Pt=[],Ft=0;Ft<arguments.length;Ft++)Pt[Ft]=arguments[Ft];for(var xr=this._getContainerModuleHelpersFactory(),ee=0,sr=Pt;ee<sr.length;ee++){var Tt=sr[ee],ht=xr(Tt.id);Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)}},Qt.prototype.loadAsync=function(){for(var Pt=[],Ft=0;Ft<arguments.length;Ft++)Pt[Ft]=arguments[Ft];return De(this,void 0,void 0,function(){var xr,ee,sr,Tt,ht;return he(this,function(jt){switch(jt.label){case 0:xr=this._getContainerModuleHelpersFactory(),ee=0,sr=Pt,jt.label=1;case 1:return ee<sr.length?(Tt=sr[ee],ht=xr(Tt.id),[4,Tt.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)]):[3,4];case 2:jt.sent(),jt.label=3;case 3:return ee++,[3,1];case 4:return[2]}})})},Qt.prototype.unload=function(){for(var Pt=this,Ft=[],xr=0;xr<arguments.length;xr++)Ft[xr]=arguments[xr];var ee=function(sr){return function(Tt){return Tt.moduleId===sr}};Ft.forEach(function(sr){var Tt=ee(sr.id);Pt._bindingDictionary.removeByCondition(Tt)})},Qt.prototype.bind=function(Pt){var Ft=this.options.defaultScope||Ce.BindingScopeEnum.Transient,xr=new Pe.Binding(Pt,Ft);return this._bindingDictionary.add(Pt,xr),new mt.BindingToSyntax(xr)},Qt.prototype.rebind=function(Pt){return this.unbind(Pt),this.bind(Pt)},Qt.prototype.unbind=function(Pt){try{this._bindingDictionary.remove(Pt)}catch(Ft){throw new Error(q.CANNOT_UNBIND+" "+Dt.getServiceIdentifierAsString(Pt))}},Qt.prototype.unbindAll=function(){this._bindingDictionary=new Nt.Lookup},Qt.prototype.isBound=function(Pt){var Ft=this._bindingDictionary.hasKey(Pt);return!Ft&&this.parent&&(Ft=this.parent.isBound(Pt)),Ft},Qt.prototype.isBoundNamed=function(Pt,Ft){return this.isBoundTagged(Pt,pe.NAMED_TAG,Ft)},Qt.prototype.isBoundTagged=function(Pt,Ft,xr){var ee=!1;if(this._bindingDictionary.hasKey(Pt)){var sr=this._bindingDictionary.get(Pt),Tt=Se.createMockRequest(this,Pt,Ft,xr);ee=sr.some(function(ht){return ht.constraint(Tt)})}return!ee&&this.parent&&(ee=this.parent.isBoundTagged(Pt,Ft,xr)),ee},Qt.prototype.snapshot=function(){this._snapshots.push(_r.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Qt.prototype.restore=function(){var Pt=this._snapshots.pop();if(Pt===void 0)throw new Error(q.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Pt.bindings,this._middleware=Pt.middleware},Qt.prototype.createChild=function(Pt){var Ft=new Qt(Pt||this.options);return Ft.parent=this,Ft},Qt.prototype.applyMiddleware=function(){for(var Pt=[],Ft=0;Ft<arguments.length;Ft++)Pt[Ft]=arguments[Ft];this._appliedMiddleware=this._appliedMiddleware.concat(Pt);var xr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Pt.reduce(function(ee,sr){return sr(ee)},xr)},Qt.prototype.applyCustomMetadataReader=function(Pt){this._metadataReader=Pt},Qt.prototype.get=function(Pt){return this._get(!1,!1,Ce.TargetTypeEnum.Variable,Pt)},Qt.prototype.getTagged=function(Pt,Ft,xr){return this._get(!1,!1,Ce.TargetTypeEnum.Variable,Pt,Ft,xr)},Qt.prototype.getNamed=function(Pt,Ft){return this.getTagged(Pt,pe.NAMED_TAG,Ft)},Qt.prototype.getAll=function(Pt){return this._get(!0,!0,Ce.TargetTypeEnum.Variable,Pt)},Qt.prototype.getAllTagged=function(Pt,Ft,xr){return this._get(!1,!0,Ce.TargetTypeEnum.Variable,Pt,Ft,xr)},Qt.prototype.getAllNamed=function(Pt,Ft){return this.getAllTagged(Pt,pe.NAMED_TAG,Ft)},Qt.prototype.resolve=function(Pt){var Ft=this.createChild();return Ft.bind(Pt).toSelf(),this._appliedMiddleware.forEach(function(xr){Ft.applyMiddleware(xr)}),Ft.get(Pt)},Qt.prototype._getContainerModuleHelpersFactory=function(){var Pt=this,Ft=function(ht,jt){ht._binding.moduleId=jt},xr=function(ht){return function(jt){var dt=Pt.bind.bind(Pt),lr=dt(jt);return Ft(lr,ht),lr}},ee=function(ht){return function(jt){var dt=Pt.unbind.bind(Pt);dt(jt)}},sr=function(ht){return function(jt){var dt=Pt.isBound.bind(Pt);return dt(jt)}},Tt=function(ht){return function(jt){var dt=Pt.rebind.bind(Pt),lr=dt(jt);return Ft(lr,ht),lr}};return function(ht){return{bindFunction:xr(ht),isboundFunction:sr(ht),rebindFunction:Tt(ht),unbindFunction:ee(ht)}}},Qt.prototype._get=function(Pt,Ft,xr,ee,sr,Tt){var ht=null,jt={avoidConstraints:Pt,contextInterceptor:function(dt){return dt},isMultiInject:Ft,key:sr,serviceIdentifier:ee,targetType:xr,value:Tt};if(this._middleware){if(ht=this._middleware(jt),ht==null)throw new Error(q.INVALID_MIDDLEWARE_RETURN)}else ht=this._planAndResolve()(jt);return ht},Qt.prototype._planAndResolve=function(){var Pt=this;return function(Ft){var xr=Se.plan(Pt._metadataReader,Pt,Ft.isMultiInject,Ft.targetType,Ft.serviceIdentifier,Ft.key,Ft.value,Ft.avoidConstraints);xr=Ft.contextInterceptor(xr);var ee=ot.resolve(xr);return ee}},Qt}();me.Container=gr},33244:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.AsyncContainerModule=me.ContainerModule=void 0;var De=se(37791),he=function(){function Pe(q){this.id=De.id(),this.registry=q}return Pe}();me.ContainerModule=he;var y=function(){function Pe(q){this.id=De.id(),this.registry=q}return Pe}();me.AsyncContainerModule=y},85700:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.ContainerSnapshot=void 0;var se=function(){function De(){}return De.of=function(he,y){var Pe=new De;return Pe.bindings=he,Pe.middleware=y,Pe},De}();me.ContainerSnapshot=se},80175:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Lookup=void 0;var De=se(16674),he=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Pe,q){if(Pe==null)throw new Error(De.NULL_ARGUMENT);if(q==null)throw new Error(De.NULL_ARGUMENT);var Ce=this._map.get(Pe);Ce!==void 0?(Ce.push(q),this._map.set(Pe,Ce)):this._map.set(Pe,[q])},y.prototype.get=function(Pe){if(Pe==null)throw new Error(De.NULL_ARGUMENT);var q=this._map.get(Pe);if(q!==void 0)return q;throw new Error(De.KEY_NOT_FOUND)},y.prototype.remove=function(Pe){if(Pe==null)throw new Error(De.NULL_ARGUMENT);if(!this._map.delete(Pe))throw new Error(De.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Pe){var q=this;this._map.forEach(function(Ce,pe){var Ke=Ce.filter(function(Se){return!Pe(Se)});Ke.length>0?q._map.set(pe,Ke):q._map.delete(pe)})},y.prototype.hasKey=function(Pe){if(Pe==null)throw new Error(De.NULL_ARGUMENT);return this._map.has(Pe)},y.prototype.clone=function(){var Pe=new y;return this._map.forEach(function(q,Ce){q.forEach(function(pe){return Pe.add(Ce,pe.clone())})}),Pe},y.prototype.traverse=function(Pe){this._map.forEach(function(q,Ce){Pe(Ce,q)})},y}();me.Lookup=he},86700:function(Tn,me,se){"use strict";var De;De={value:!0},De=De=De=De=De=De=me.GW=De=De=me.zY=De=De=De=De=De=me.f3=De=De=me.b2=De=De=De=De=De=me.W2=De=void 0;var he=se(6867);De=he;var y=se(51389);Object.defineProperty(me,"W2",{enumerable:!0,get:function(){return y.Container}});var Pe=se(28421);De={enumerable:!0,get:function(){return Pe.BindingScopeEnum}},De={enumerable:!0,get:function(){return Pe.BindingTypeEnum}},De={enumerable:!0,get:function(){return Pe.TargetTypeEnum}};var q=se(33244);De={enumerable:!0,get:function(){return q.AsyncContainerModule}},De={enumerable:!0,get:function(){return q.ContainerModule}};var Ce=se(64315);Object.defineProperty(me,"b2",{enumerable:!0,get:function(){return Ce.injectable}});var pe=se(32052);De={enumerable:!0,get:function(){return pe.tagged}};var Ke=se(38085);De={enumerable:!0,get:function(){return Ke.named}};var Se=se(5744);Object.defineProperty(me,"f3",{enumerable:!0,get:function(){return Se.inject}}),De={enumerable:!0,get:function(){return Se.LazyServiceIdentifer}};var ot=se(6515);De={enumerable:!0,get:function(){return ot.optional}};var mt=se(86757);De={enumerable:!0,get:function(){return mt.unmanaged}};var bt=se(71693);De={enumerable:!0,get:function(){return bt.multiInject}};var Dt=se(55638);De={enumerable:!0,get:function(){return Dt.targetName}};var _r=se(7014);Object.defineProperty(me,"zY",{enumerable:!0,get:function(){return _r.postConstruct}});var Nt=se(51377);De={enumerable:!0,get:function(){return Nt.MetadataReader}};var gr=se(37791);De={enumerable:!0,get:function(){return gr.id}};var Qt=se(99934);Object.defineProperty(me,"GW",{enumerable:!0,get:function(){return Qt.decorate}});var Pt=se(80758);De={enumerable:!0,get:function(){return Pt.traverseAncerstors}},De={enumerable:!0,get:function(){return Pt.taggedConstraint}},De={enumerable:!0,get:function(){return Pt.namedConstraint}},De={enumerable:!0,get:function(){return Pt.typeConstraint}};var Ft=se(55800);De={enumerable:!0,get:function(){return Ft.getServiceIdentifierAsString}};var xr=se(70600);De={enumerable:!0,get:function(){return xr.multiBindToService}}},95228:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Context=void 0;var De=se(37791),he=function(){function y(Pe){this.id=De.id(),this.container=Pe}return y.prototype.addPlan=function(Pe){this.plan=Pe},y.prototype.setCurrentRequest=function(Pe){this.currentRequest=Pe},y}();me.Context=he},47738:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Metadata=void 0;var De=se(6867),he=function(){function y(Pe,q){this.key=Pe,this.value=q}return y.prototype.toString=function(){return this.key===De.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();me.Metadata=he},51377:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.MetadataReader=void 0;var De=se(6867),he=function(){function y(){}return y.prototype.getConstructorMetadata=function(Pe){var q=Reflect.getMetadata(De.PARAM_TYPES,Pe),Ce=Reflect.getMetadata(De.TAGGED,Pe);return{compilerGeneratedMetadata:q,userGeneratedMetadata:Ce||{}}},y.prototype.getPropertiesMetadata=function(Pe){var q=Reflect.getMetadata(De.TAGGED_PROP,Pe)||[];return q},y}();me.MetadataReader=he},55314:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Plan=void 0;var se=function(){function De(he,y){this.parentContext=he,this.rootRequest=y}return De}();me.Plan=se},86311:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.getBindingDictionary=me.createMockRequest=me.plan=void 0;var De=se(23184),he=se(16674),y=se(28421),Pe=se(6867),q=se(85265),Ce=se(55800),pe=se(95228),Ke=se(47738),Se=se(55314),ot=se(6e3),mt=se(6748),bt=se(18924);function Dt(ee){return ee._bindingDictionary}me.getBindingDictionary=Dt;function _r(ee,sr,Tt,ht,jt,dt){var lr=ee?Pe.MULTI_INJECT_TAG:Pe.INJECT_TAG,jr=new Ke.Metadata(lr,Tt),ue=new bt.Target(sr,ht,Tt,jr);if(jt!==void 0){var He=new Ke.Metadata(jt,dt);ue.metadata.push(He)}return ue}function Nt(ee,sr,Tt,ht,jt){var dt=Pt(Tt.container,jt.serviceIdentifier),lr=[];return dt.length===De.BindingCount.NoBindingsAvailable&&Tt.container.options.autoBindInjectable&&typeof jt.serviceIdentifier=="function"&&ee.getConstructorMetadata(jt.serviceIdentifier).compilerGeneratedMetadata&&(Tt.container.bind(jt.serviceIdentifier).toSelf(),dt=Pt(Tt.container,jt.serviceIdentifier)),sr?lr=dt:lr=dt.filter(function(jr){var ue=new mt.Request(jr.serviceIdentifier,Tt,ht,jr,jt);return jr.constraint(ue)}),gr(jt.serviceIdentifier,lr,jt,Tt.container),lr}function gr(ee,sr,Tt,ht){switch(sr.length){case De.BindingCount.NoBindingsAvailable:if(Tt.isOptional())return sr;var jt=Ce.getServiceIdentifierAsString(ee),dt=he.NOT_REGISTERED;throw dt+=Ce.listMetadataForTarget(jt,Tt),dt+=Ce.listRegisteredBindingsForServiceIdentifier(ht,jt,Pt),new Error(dt);case De.BindingCount.OnlyOneBindingAvailable:if(!Tt.isArray())return sr;case De.BindingCount.MultipleBindingsAvailable:default:if(Tt.isArray())return sr;var jt=Ce.getServiceIdentifierAsString(ee),dt=he.AMBIGUOUS_MATCH+" "+jt;throw dt+=Ce.listRegisteredBindingsForServiceIdentifier(ht,jt,Pt),new Error(dt)}}function Qt(ee,sr,Tt,ht,jt,dt){var lr,jr;if(jt===null){lr=Nt(ee,sr,ht,null,dt),jr=new mt.Request(Tt,ht,null,lr,dt);var ue=new Se.Plan(ht,jr);ht.addPlan(ue)}else lr=Nt(ee,sr,ht,jt,dt),jr=jt.addChildRequest(dt.serviceIdentifier,lr,dt);lr.forEach(function(He){var W=null;if(dt.isArray())W=jr.addChildRequest(He.serviceIdentifier,He,dt);else{if(He.cache)return;W=jr}if(He.type===y.BindingTypeEnum.Instance&&He.implementationType!==null){var Y=ot.getDependencies(ee,He.implementationType);if(!ht.container.options.skipBaseClassChecks){var Re=ot.getBaseClassDependencyCount(ee,He.implementationType);if(Y.length<Re){var gt=he.ARGUMENTS_LENGTH_MISMATCH(ot.getFunctionName(He.implementationType));throw new Error(gt)}}Y.forEach(function(wt){Qt(ee,!1,wt.serviceIdentifier,ht,W,wt)})}})}function Pt(ee,sr){var Tt=[],ht=Dt(ee);return ht.hasKey(sr)?Tt=ht.get(sr):ee.parent!==null&&(Tt=Pt(ee.parent,sr)),Tt}function Ft(ee,sr,Tt,ht,jt,dt,lr,jr){jr===void 0&&(jr=!1);var ue=new pe.Context(sr),He=_r(Tt,ht,jt,"",dt,lr);try{return Qt(ee,jr,jt,ue,null,He),ue}catch(W){throw q.isStackOverflowExeption(W)&&ue.plan&&Ce.circularDependencyToException(ue.plan.rootRequest),W}}me.plan=Ft;function xr(ee,sr,Tt,ht){var jt=new bt.Target(y.TargetTypeEnum.Variable,"",sr,new Ke.Metadata(Tt,ht)),dt=new pe.Context(ee),lr=new mt.Request(sr,dt,null,[],jt);return lr}me.createMockRequest=xr},88460:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.QueryableString=void 0;var se=function(){function De(he){this.str=he}return De.prototype.startsWith=function(he){return this.str.indexOf(he)===0},De.prototype.endsWith=function(he){var y="",Pe=he.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Pe)},De.prototype.contains=function(he){return this.str.indexOf(he)!==-1},De.prototype.equals=function(he){return this.str===he},De.prototype.value=function(){return this.str},De}();me.QueryableString=se},6e3:function(Tn,me,se){"use strict";var De=this&&this.__spreadArray||function(Nt,gr){for(var Qt=0,Pt=gr.length,Ft=Nt.length;Qt<Pt;Qt++,Ft++)Nt[Ft]=gr[Qt];return Nt};Object.defineProperty(me,"__esModule",{value:!0}),me.getFunctionName=me.getBaseClassDependencyCount=me.getDependencies=void 0;var he=se(5744),y=se(16674),Pe=se(28421),q=se(6867),Ce=se(55800);Object.defineProperty(me,"getFunctionName",{enumerable:!0,get:function(){return Ce.getFunctionName}});var pe=se(18924);function Ke(Nt,gr){var Qt=Ce.getFunctionName(gr),Pt=Se(Nt,Qt,gr,!1);return Pt}me.getDependencies=Ke;function Se(Nt,gr,Qt,Pt){var Ft=Nt.getConstructorMetadata(Qt),xr=Ft.compilerGeneratedMetadata;if(xr===void 0){var ee=y.MISSING_INJECTABLE_ANNOTATION+" "+gr+".";throw new Error(ee)}var sr=Ft.userGeneratedMetadata,Tt=Object.keys(sr),ht=Qt.length===0&&Tt.length>0,jt=Tt.length>Qt.length,dt=ht||jt?Tt.length:Qt.length,lr=mt(Pt,gr,xr,sr,dt),jr=bt(Nt,Qt),ue=De(De([],lr),jr);return ue}function ot(Nt,gr,Qt,Pt,Ft){var xr=Ft[Nt.toString()]||[],ee=_r(xr),sr=ee.unmanaged!==!0,Tt=Pt[Nt],ht=ee.inject||ee.multiInject;if(Tt=ht||Tt,Tt instanceof he.LazyServiceIdentifer&&(Tt=Tt.unwrap()),sr){var jt=Tt===Object,dt=Tt===Function,lr=Tt===void 0,jr=jt||dt||lr;if(!gr&&jr){var ue=y.MISSING_INJECT_ANNOTATION+" argument "+Nt+" in class "+Qt+".";throw new Error(ue)}var He=new pe.Target(Pe.TargetTypeEnum.ConstructorArgument,ee.targetName,Tt);return He.metadata=xr,He}return null}function mt(Nt,gr,Qt,Pt,Ft){for(var xr=[],ee=0;ee<Ft;ee++){var sr=ee,Tt=ot(sr,Nt,gr,Qt,Pt);Tt!==null&&xr.push(Tt)}return xr}function bt(Nt,gr){for(var Qt=Nt.getPropertiesMetadata(gr),Pt=[],Ft=Object.keys(Qt),xr=0,ee=Ft;xr<ee.length;xr++){var sr=ee[xr],Tt=Qt[sr],ht=_r(Qt[sr]),jt=ht.targetName||sr,dt=ht.inject||ht.multiInject,lr=new pe.Target(Pe.TargetTypeEnum.ClassProperty,jt,dt);lr.metadata=Tt,Pt.push(lr)}var jr=Object.getPrototypeOf(gr.prototype).constructor;if(jr!==Object){var ue=bt(Nt,jr);Pt=De(De([],Pt),ue)}return Pt}function Dt(Nt,gr){var Qt=Object.getPrototypeOf(gr.prototype).constructor;if(Qt!==Object){var Pt=Ce.getFunctionName(Qt),Ft=Se(Nt,Pt,Qt,!0),xr=Ft.map(function(Tt){return Tt.metadata.filter(function(ht){return ht.key===q.UNMANAGED_TAG})}),ee=[].concat.apply([],xr).length,sr=Ft.length-ee;return sr>0?sr:Dt(Nt,Qt)}else return 0}me.getBaseClassDependencyCount=Dt;function _r(Nt){var gr={};return Nt.forEach(function(Qt){gr[Qt.key.toString()]=Qt.value}),{inject:gr[q.INJECT_TAG],multiInject:gr[q.MULTI_INJECT_TAG],targetName:gr[q.NAME_TAG],unmanaged:gr[q.UNMANAGED_TAG]}}},6748:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Request=void 0;var De=se(37791),he=function(){function y(Pe,q,Ce,pe,Ke){this.id=De.id(),this.serviceIdentifier=Pe,this.parentContext=q,this.parentRequest=Ce,this.target=Ke,this.childRequests=[],this.bindings=Array.isArray(pe)?pe:[pe],this.requestScope=Ce===null?new Map:null}return y.prototype.addChildRequest=function(Pe,q,Ce){var pe=new y(Pe,this.parentContext,this,q,Ce);return this.childRequests.push(pe),pe},y}();me.Request=he},18924:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.Target=void 0;var De=se(6867),he=se(37791),y=se(47738),Pe=se(88460),q=function(){function Ce(pe,Ke,Se,ot){this.id=he.id(),this.type=pe,this.serviceIdentifier=Se,this.name=new Pe.QueryableString(Ke||""),this.metadata=new Array;var mt=null;typeof ot=="string"?mt=new y.Metadata(De.NAMED_TAG,ot):ot instanceof y.Metadata&&(mt=ot),mt!==null&&this.metadata.push(mt)}return Ce.prototype.hasTag=function(pe){for(var Ke=0,Se=this.metadata;Ke<Se.length;Ke++){var ot=Se[Ke];if(ot.key===pe)return!0}return!1},Ce.prototype.isArray=function(){return this.hasTag(De.MULTI_INJECT_TAG)},Ce.prototype.matchesArray=function(pe){return this.matchesTag(De.MULTI_INJECT_TAG)(pe)},Ce.prototype.isNamed=function(){return this.hasTag(De.NAMED_TAG)},Ce.prototype.isTagged=function(){return this.metadata.some(function(pe){return De.NON_CUSTOM_TAG_KEYS.every(function(Ke){return pe.key!==Ke})})},Ce.prototype.isOptional=function(){return this.matchesTag(De.OPTIONAL_TAG)(!0)},Ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(pe){return pe.key===De.NAMED_TAG})[0]:null},Ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(pe){return De.NON_CUSTOM_TAG_KEYS.every(function(Ke){return pe.key!==Ke})}):null},Ce.prototype.matchesNamedTag=function(pe){return this.matchesTag(De.NAMED_TAG)(pe)},Ce.prototype.matchesTag=function(pe){var Ke=this;return function(Se){for(var ot=0,mt=Ke.metadata;ot<mt.length;ot++){var bt=mt[ot];if(bt.key===pe&&bt.value===Se)return!0}return!1}},Ce}();me.Target=q},52279:function(Tn,me,se){"use strict";var De=this&&this.__spreadArray||function(Se,ot){for(var mt=0,bt=ot.length,Dt=Se.length;mt<bt;mt++,Dt++)Se[Dt]=ot[mt];return Se};Object.defineProperty(me,"__esModule",{value:!0}),me.resolveInstance=void 0;var he=se(16674),y=se(28421),Pe=se(6867);function q(Se,ot,mt){var bt=ot.filter(function(_r){return _r.target!==null&&_r.target.type===y.TargetTypeEnum.ClassProperty}),Dt=bt.map(mt);return bt.forEach(function(_r,Nt){var gr="";gr=_r.target.name.value();var Qt=Dt[Nt];Se[gr]=Qt}),Se}function Ce(Se,ot){return new(Se.bind.apply(Se,De([void 0],ot)))}function pe(Se,ot){if(Reflect.hasMetadata(Pe.POST_CONSTRUCT,Se)){var mt=Reflect.getMetadata(Pe.POST_CONSTRUCT,Se);try{ot[mt.value]()}catch(bt){throw new Error(he.POST_CONSTRUCT_ERROR(Se.name,bt.message))}}}function Ke(Se,ot,mt){var bt=null;if(ot.length>0){var Dt=ot.filter(function(Nt){return Nt.target!==null&&Nt.target.type===y.TargetTypeEnum.ConstructorArgument}),_r=Dt.map(mt);bt=Ce(Se,_r),bt=q(bt,ot,mt)}else bt=new Se;return pe(Se,bt),bt}me.resolveInstance=Ke},31927:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.resolve=void 0;var De=se(16674),he=se(28421),y=se(85265),Pe=se(55800),q=se(52279),Ce=function(Se,ot,mt){try{return mt()}catch(bt){throw y.isStackOverflowExeption(bt)?new Error(De.CIRCULAR_DEPENDENCY_IN_FACTORY(Se,ot.toString())):bt}},pe=function(Se){return function(ot){ot.parentContext.setCurrentRequest(ot);var mt=ot.bindings,bt=ot.childRequests,Dt=ot.target&&ot.target.isArray(),_r=!ot.parentRequest||!ot.parentRequest.target||!ot.target||!ot.parentRequest.target.matchesArray(ot.target.serviceIdentifier);if(Dt&&_r)return bt.map(function(xr){var ee=pe(Se);return ee(xr)});var Nt=null;if(ot.target.isOptional()&&mt.length===0)return;var gr=mt[0],Qt=gr.scope===he.BindingScopeEnum.Singleton,Pt=gr.scope===he.BindingScopeEnum.Request;if(Qt&&gr.activated)return gr.cache;if(Pt&&Se!==null&&Se.has(gr.id))return Se.get(gr.id);if(gr.type===he.BindingTypeEnum.ConstantValue)Nt=gr.cache,gr.activated=!0;else if(gr.type===he.BindingTypeEnum.Function)Nt=gr.cache,gr.activated=!0;else if(gr.type===he.BindingTypeEnum.Constructor)Nt=gr.implementationType;else if(gr.type===he.BindingTypeEnum.DynamicValue&&gr.dynamicValue!==null)Nt=Ce("toDynamicValue",gr.serviceIdentifier,function(){return gr.dynamicValue(ot.parentContext)});else if(gr.type===he.BindingTypeEnum.Factory&&gr.factory!==null)Nt=Ce("toFactory",gr.serviceIdentifier,function(){return gr.factory(ot.parentContext)});else if(gr.type===he.BindingTypeEnum.Provider&&gr.provider!==null)Nt=Ce("toProvider",gr.serviceIdentifier,function(){return gr.provider(ot.parentContext)});else if(gr.type===he.BindingTypeEnum.Instance&&gr.implementationType!==null)Nt=q.resolveInstance(gr.implementationType,bt,pe(Se));else{var Ft=Pe.getServiceIdentifierAsString(ot.serviceIdentifier);throw new Error(De.INVALID_BINDING_TYPE+" "+Ft)}return typeof gr.onActivation=="function"&&(Nt=gr.onActivation(ot.parentContext,Nt)),Qt&&(gr.cache=Nt,gr.activated=!0),Pt&&Se!==null&&!Se.has(gr.id)&&Se.set(gr.id,Nt),Nt}};function Ke(Se){var ot=pe(Se.plan.rootRequest.requestScope);return ot(Se.plan.rootRequest)}me.resolve=Ke},83366:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingInSyntax=void 0;var De=se(28421),he=se(71325),y=function(){function Pe(q){this._binding=q}return Pe.prototype.inRequestScope=function(){return this._binding.scope=De.BindingScopeEnum.Request,new he.BindingWhenOnSyntax(this._binding)},Pe.prototype.inSingletonScope=function(){return this._binding.scope=De.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},Pe.prototype.inTransientScope=function(){return this._binding.scope=De.BindingScopeEnum.Transient,new he.BindingWhenOnSyntax(this._binding)},Pe}();me.BindingInSyntax=y},74889:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingInWhenOnSyntax=void 0;var De=se(83366),he=se(51811),y=se(98370),Pe=function(){function q(Ce){this._binding=Ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new he.BindingOnSyntax(this._binding),this._bindingInSyntax=new De.BindingInSyntax(Ce)}return q.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},q.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},q.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},q.prototype.when=function(Ce){return this._bindingWhenSyntax.when(Ce)},q.prototype.whenTargetNamed=function(Ce){return this._bindingWhenSyntax.whenTargetNamed(Ce)},q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},q.prototype.whenTargetTagged=function(Ce,pe){return this._bindingWhenSyntax.whenTargetTagged(Ce,pe)},q.prototype.whenInjectedInto=function(Ce){return this._bindingWhenSyntax.whenInjectedInto(Ce)},q.prototype.whenParentNamed=function(Ce){return this._bindingWhenSyntax.whenParentNamed(Ce)},q.prototype.whenParentTagged=function(Ce,pe){return this._bindingWhenSyntax.whenParentTagged(Ce,pe)},q.prototype.whenAnyAncestorIs=function(Ce){return this._bindingWhenSyntax.whenAnyAncestorIs(Ce)},q.prototype.whenNoAncestorIs=function(Ce){return this._bindingWhenSyntax.whenNoAncestorIs(Ce)},q.prototype.whenAnyAncestorNamed=function(Ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(Ce)},q.prototype.whenAnyAncestorTagged=function(Ce,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(Ce,pe)},q.prototype.whenNoAncestorNamed=function(Ce){return this._bindingWhenSyntax.whenNoAncestorNamed(Ce)},q.prototype.whenNoAncestorTagged=function(Ce,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(Ce,pe)},q.prototype.whenAnyAncestorMatches=function(Ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(Ce)},q.prototype.whenNoAncestorMatches=function(Ce){return this._bindingWhenSyntax.whenNoAncestorMatches(Ce)},q.prototype.onActivation=function(Ce){return this._bindingOnSyntax.onActivation(Ce)},q}();me.BindingInWhenOnSyntax=Pe},51811:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingOnSyntax=void 0;var De=se(98370),he=function(){function y(Pe){this._binding=Pe}return y.prototype.onActivation=function(Pe){return this._binding.onActivation=Pe,new De.BindingWhenSyntax(this._binding)},y}();me.BindingOnSyntax=he},15451:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingToSyntax=void 0;var De=se(16674),he=se(28421),y=se(74889),Pe=se(71325),q=function(){function Ce(pe){this._binding=pe}return Ce.prototype.to=function(pe){return this._binding.type=he.BindingTypeEnum.Instance,this._binding.implementationType=pe,new y.BindingInWhenOnSyntax(this._binding)},Ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+De.INVALID_TO_SELF_VALUE);var pe=this._binding.serviceIdentifier;return this.to(pe)},Ce.prototype.toConstantValue=function(pe){return this._binding.type=he.BindingTypeEnum.ConstantValue,this._binding.cache=pe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=he.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},Ce.prototype.toDynamicValue=function(pe){return this._binding.type=he.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=pe,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Ce.prototype.toConstructor=function(pe){return this._binding.type=he.BindingTypeEnum.Constructor,this._binding.implementationType=pe,this._binding.scope=he.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},Ce.prototype.toFactory=function(pe){return this._binding.type=he.BindingTypeEnum.Factory,this._binding.factory=pe,this._binding.scope=he.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},Ce.prototype.toFunction=function(pe){if(typeof pe!="function")throw new Error(De.INVALID_FUNCTION_BINDING);var Ke=this.toConstantValue(pe);return this._binding.type=he.BindingTypeEnum.Function,this._binding.scope=he.BindingScopeEnum.Singleton,Ke},Ce.prototype.toAutoFactory=function(pe){return this._binding.type=he.BindingTypeEnum.Factory,this._binding.factory=function(Ke){var Se=function(){return Ke.container.get(pe)};return Se},this._binding.scope=he.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},Ce.prototype.toProvider=function(pe){return this._binding.type=he.BindingTypeEnum.Provider,this._binding.provider=pe,this._binding.scope=he.BindingScopeEnum.Singleton,new Pe.BindingWhenOnSyntax(this._binding)},Ce.prototype.toService=function(pe){this.toDynamicValue(function(Ke){return Ke.container.get(pe)})},Ce}();me.BindingToSyntax=q},71325:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingWhenOnSyntax=void 0;var De=se(51811),he=se(98370),y=function(){function Pe(q){this._binding=q,this._bindingWhenSyntax=new he.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new De.BindingOnSyntax(this._binding)}return Pe.prototype.when=function(q){return this._bindingWhenSyntax.when(q)},Pe.prototype.whenTargetNamed=function(q){return this._bindingWhenSyntax.whenTargetNamed(q)},Pe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Pe.prototype.whenTargetTagged=function(q,Ce){return this._bindingWhenSyntax.whenTargetTagged(q,Ce)},Pe.prototype.whenInjectedInto=function(q){return this._bindingWhenSyntax.whenInjectedInto(q)},Pe.prototype.whenParentNamed=function(q){return this._bindingWhenSyntax.whenParentNamed(q)},Pe.prototype.whenParentTagged=function(q,Ce){return this._bindingWhenSyntax.whenParentTagged(q,Ce)},Pe.prototype.whenAnyAncestorIs=function(q){return this._bindingWhenSyntax.whenAnyAncestorIs(q)},Pe.prototype.whenNoAncestorIs=function(q){return this._bindingWhenSyntax.whenNoAncestorIs(q)},Pe.prototype.whenAnyAncestorNamed=function(q){return this._bindingWhenSyntax.whenAnyAncestorNamed(q)},Pe.prototype.whenAnyAncestorTagged=function(q,Ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(q,Ce)},Pe.prototype.whenNoAncestorNamed=function(q){return this._bindingWhenSyntax.whenNoAncestorNamed(q)},Pe.prototype.whenNoAncestorTagged=function(q,Ce){return this._bindingWhenSyntax.whenNoAncestorTagged(q,Ce)},Pe.prototype.whenAnyAncestorMatches=function(q){return this._bindingWhenSyntax.whenAnyAncestorMatches(q)},Pe.prototype.whenNoAncestorMatches=function(q){return this._bindingWhenSyntax.whenNoAncestorMatches(q)},Pe.prototype.onActivation=function(q){return this._bindingOnSyntax.onActivation(q)},Pe}();me.BindingWhenOnSyntax=y},98370:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.BindingWhenSyntax=void 0;var De=se(51811),he=se(80758),y=function(){function Pe(q){this._binding=q}return Pe.prototype.when=function(q){return this._binding.constraint=q,new De.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetNamed=function(q){return this._binding.constraint=he.namedConstraint(q),new De.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(q){var Ce=q.target!==null&&!q.target.isNamed()&&!q.target.isTagged();return Ce},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenTargetTagged=function(q,Ce){return this._binding.constraint=he.taggedConstraint(q)(Ce),new De.BindingOnSyntax(this._binding)},Pe.prototype.whenInjectedInto=function(q){return this._binding.constraint=function(Ce){return he.typeConstraint(q)(Ce.parentRequest)},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenParentNamed=function(q){return this._binding.constraint=function(Ce){return he.namedConstraint(q)(Ce.parentRequest)},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenParentTagged=function(q,Ce){return this._binding.constraint=function(pe){return he.taggedConstraint(q)(Ce)(pe.parentRequest)},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorIs=function(q){return this._binding.constraint=function(Ce){return he.traverseAncerstors(Ce,he.typeConstraint(q))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorIs=function(q){return this._binding.constraint=function(Ce){return!he.traverseAncerstors(Ce,he.typeConstraint(q))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorNamed=function(q){return this._binding.constraint=function(Ce){return he.traverseAncerstors(Ce,he.namedConstraint(q))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorNamed=function(q){return this._binding.constraint=function(Ce){return!he.traverseAncerstors(Ce,he.namedConstraint(q))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorTagged=function(q,Ce){return this._binding.constraint=function(pe){return he.traverseAncerstors(pe,he.taggedConstraint(q)(Ce))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorTagged=function(q,Ce){return this._binding.constraint=function(pe){return!he.traverseAncerstors(pe,he.taggedConstraint(q)(Ce))},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenAnyAncestorMatches=function(q){return this._binding.constraint=function(Ce){return he.traverseAncerstors(Ce,q)},new De.BindingOnSyntax(this._binding)},Pe.prototype.whenNoAncestorMatches=function(q){return this._binding.constraint=function(Ce){return!he.traverseAncerstors(Ce,q)},new De.BindingOnSyntax(this._binding)},Pe}();me.BindingWhenSyntax=y},80758:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.typeConstraint=me.namedConstraint=me.taggedConstraint=me.traverseAncerstors=void 0;var De=se(6867),he=se(47738),y=function(pe,Ke){var Se=pe.parentRequest;return Se!==null?Ke(Se)?!0:y(Se,Ke):!1};me.traverseAncerstors=y;var Pe=function(pe){return function(Ke){var Se=function(ot){return ot!==null&&ot.target!==null&&ot.target.matchesTag(pe)(Ke)};return Se.metaData=new he.Metadata(pe,Ke),Se}};me.taggedConstraint=Pe;var q=Pe(De.NAMED_TAG);me.namedConstraint=q;var Ce=function(pe){return function(Ke){var Se=null;if(Ke!==null)if(Se=Ke.bindings[0],typeof pe=="string"){var ot=Se.serviceIdentifier;return ot===pe}else{var mt=Ke.bindings[0].implementationType;return pe===mt}return!1}};me.typeConstraint=Ce},70600:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.multiBindToService=void 0;var se=function(De){return function(he){return function(){for(var y=[],Pe=0;Pe<arguments.length;Pe++)y[Pe]=arguments[Pe];return y.forEach(function(q){return De.bind(q).toService(he)})}}};me.multiBindToService=se},85265:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.isStackOverflowExeption=void 0;var De=se(16674);function he(y){return y instanceof RangeError||y.message===De.STACK_OVERFLOW}me.isStackOverflowExeption=he},37791:function(Tn,me){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.id=void 0;var se=0;function De(){return se++}me.id=De},55800:function(Tn,me,se){"use strict";Object.defineProperty(me,"__esModule",{value:!0}),me.circularDependencyToException=me.listMetadataForTarget=me.listRegisteredBindingsForServiceIdentifier=me.getServiceIdentifierAsString=me.getFunctionName=void 0;var De=se(16674);function he(Se){if(typeof Se=="function"){var ot=Se;return ot.name}else{if(typeof Se=="symbol")return Se.toString();var ot=Se;return ot}}me.getServiceIdentifierAsString=he;function y(Se,ot,mt){var bt="",Dt=mt(Se,ot);return Dt.length!==0&&(bt=`
Registered bindings:`,Dt.forEach(function(_r){var Nt="Object";_r.implementationType!==null&&(Nt=Ke(_r.implementationType)),bt=bt+`
 `+Nt,_r.constraint.metaData&&(bt=bt+" - "+_r.constraint.metaData)})),bt}me.listRegisteredBindingsForServiceIdentifier=y;function Pe(Se,ot){return Se.parentRequest===null?!1:Se.parentRequest.serviceIdentifier===ot?!0:Pe(Se.parentRequest,ot)}function q(Se){function ot(bt,Dt){Dt===void 0&&(Dt=[]);var _r=he(bt.serviceIdentifier);return Dt.push(_r),bt.parentRequest!==null?ot(bt.parentRequest,Dt):Dt}var mt=ot(Se);return mt.reverse().join(" --> ")}function Ce(Se){Se.childRequests.forEach(function(ot){if(Pe(ot,ot.serviceIdentifier)){var mt=q(ot);throw new Error(De.CIRCULAR_DEPENDENCY+" "+mt)}else Ce(ot)})}me.circularDependencyToException=Ce;function pe(Se,ot){if(ot.isTagged()||ot.isNamed()){var mt="",bt=ot.getNamedTag(),Dt=ot.getCustomTags();return bt!==null&&(mt+=bt.toString()+`
`),Dt!==null&&Dt.forEach(function(_r){mt+=_r.toString()+`
`})," "+Se+`
 `+Se+" - "+mt}else return" "+Se}me.listMetadataForTarget=pe;function Ke(Se){if(Se.name)return Se.name;var ot=Se.toString(),mt=ot.match(/^function\s*([^\s(]+)/);return mt?mt[1]:"Anonymous function: "+ot}me.getFunctionName=Ke},31745:function(Tn){"use strict";Tn.exports=se,Tn.exports.default=se;var me=1e20;function se(q,Ce,pe,Ke,Se,ot){this.fontSize=q||24,this.buffer=Ce===void 0?3:Ce,this.cutoff=Ke||.25,this.fontFamily=Se||"sans-serif",this.fontWeight=ot||"normal",this.radius=pe||8;var mt=this.size=this.fontSize+this.buffer*2,bt=mt+this.buffer*2,Dt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Dt?this.canvas=my.createOffscreenCanvas(mt,mt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=mt),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(bt*bt),this.gridInner=new Float64Array(bt*bt),this.f=new Float64Array(bt),this.z=new Float64Array(bt+1),this.v=new Uint16Array(bt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Dt?this.middle=Math.round(mt/2*1):this.middle=Math.round(mt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function De(q,Ce,pe,Ke,Se,ot,mt){ot.fill(me,0,Ce*pe),mt.fill(0,0,Ce*pe);for(var bt=(Ce-Ke)/2,Dt=0;Dt<Se;Dt++)for(var _r=0;_r<Ke;_r++){var Nt=(Dt+bt)*Ce+_r+bt,gr=q.data[4*(Dt*Ke+_r)+3]/255;if(gr===1)ot[Nt]=0,mt[Nt]=me;else if(gr===0)ot[Nt]=me,mt[Nt]=0;else{var Qt=Math.max(0,.5-gr),Pt=Math.max(0,gr-.5);ot[Nt]=Qt*Qt,mt[Nt]=Pt*Pt}}}function he(q,Ce,pe,Ke,Se,ot,mt){for(var bt=0;bt<Ce*pe;bt++){var Dt=Math.sqrt(Ke[bt])-Math.sqrt(Se[bt]);q[bt]=Math.round(255-255*(Dt/ot+mt))}}se.prototype._draw=function(q,Ce){var pe=this.ctx.measureText(q),Ke=pe.width,Se=2*this.buffer,ot,mt,bt,Dt,_r,Nt,gr,Qt;Ce&&this.useMetrics?(_r=Math.floor(pe.actualBoundingBoxAscent),Qt=this.buffer+Math.ceil(pe.actualBoundingBoxAscent),Nt=this.buffer,gr=this.buffer,mt=Math.min(this.size,Math.ceil(pe.actualBoundingBoxRight-pe.actualBoundingBoxLeft)),Dt=Math.min(this.size-Nt,Math.ceil(pe.actualBoundingBoxAscent+pe.actualBoundingBoxDescent)),ot=mt+Se,bt=Dt+Se,this.ctx.textBaseline="alphabetic"):(ot=mt=this.size,bt=Dt=this.size,_r=19*this.fontSize/24,Nt=gr=0,Qt=this.middle,this.ctx.textBaseline="middle");var Pt;mt&&Dt&&(this.ctx.clearRect(gr,Nt,mt,Dt),this.ctx.fillText(q,this.buffer,Qt),Pt=this.ctx.getImageData(gr,Nt,mt,Dt));var Ft=new Uint8ClampedArray(ot*bt);return De(Pt,ot,bt,mt,Dt,this.gridOuter,this.gridInner),y(this.gridOuter,ot,bt,this.f,this.v,this.z),y(this.gridInner,ot,bt,this.f,this.v,this.z),he(Ft,ot,bt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Ft,metrics:{width:mt,height:Dt,sdfWidth:ot,sdfHeight:bt,top:_r,left:0,advance:Ke}}},se.prototype.draw=function(q){return this._draw(q,!1).data},se.prototype.drawWithMetrics=function(q){return this._draw(q,!0)};function y(q,Ce,pe,Ke,Se,ot){for(var mt=0;mt<Ce;mt++)Pe(q,mt,Ce,pe,Ke,Se,ot);for(var bt=0;bt<pe;bt++)Pe(q,bt*Ce,1,Ce,Ke,Se,ot)}function Pe(q,Ce,pe,Ke,Se,ot,mt){var bt,Dt,_r,Nt;for(ot[0]=0,mt[0]=-me,mt[1]=me,bt=0;bt<Ke;bt++)Se[bt]=q[Ce+bt*pe];for(bt=1,Dt=0,_r=0;bt<Ke;bt++){do Nt=ot[Dt],_r=(Se[bt]-Se[Nt]+bt*bt-Nt*Nt)/(bt-Nt)/2;while(_r<=mt[Dt]&&--Dt>-1);Dt++,ot[Dt]=bt,mt[Dt]=_r,mt[Dt+1]=me}for(bt=0,Dt=0;bt<Ke;bt++){for(;mt[Dt+1]<bt;)Dt++;Nt=ot[Dt],q[Ce+bt*pe]=Se[Nt]+(bt-Nt)*(bt-Nt)}}},18857:function(Tn,me,se){"use strict";se.r(me),se.d(me,{Function:function(){return Ks},Interpreter:function(){return Ia},default:function(){return Bl},evaluate:function(){return Qu},vm:function(){return De}});var De={};se.r(De),se.d(De,{Script:function(){return hl},compileFunction:function(){return hf},createContext:function(){return Bc},runInContext:function(){return Ms},runInNewContext:function(){return pf}});var he={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Pe={5:y,"5module":y+" export import",6:y+" const class extends export import super"},q=/^in(stanceof)?$/,Ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",pe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ke=new RegExp("["+Ce+"]"),Se=new RegExp("["+Ce+pe+"]");Ce=pe=null;var ot=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],mt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function bt(b,k){for(var z=65536,R=0;R<k.length;R+=2){if(z+=k[R],z>b)return!1;if(z+=k[R+1],z>=b)return!0}}function Dt(b,k){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Ke.test(String.fromCharCode(b)):k===!1?!1:bt(b,ot)}function _r(b,k){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Se.test(String.fromCharCode(b)):k===!1?!1:bt(b,ot)||bt(b,mt)}var Nt=function(k,z){z===void 0&&(z={}),this.label=k,this.keyword=z.keyword,this.beforeExpr=!!z.beforeExpr,this.startsExpr=!!z.startsExpr,this.isLoop=!!z.isLoop,this.isAssign=!!z.isAssign,this.prefix=!!z.prefix,this.postfix=!!z.postfix,this.binop=z.binop||null,this.updateContext=null};function gr(b,k){return new Nt(b,{beforeExpr:!0,binop:k})}var Qt={beforeExpr:!0},Pt={startsExpr:!0},Ft={};function xr(b,k){return k===void 0&&(k={}),k.keyword=b,Ft[b]=new Nt(b,k)}var ee={num:new Nt("num",Pt),regexp:new Nt("regexp",Pt),string:new Nt("string",Pt),name:new Nt("name",Pt),eof:new Nt("eof"),bracketL:new Nt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Nt("]"),braceL:new Nt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Nt("}"),parenL:new Nt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Nt(")"),comma:new Nt(",",Qt),semi:new Nt(";",Qt),colon:new Nt(":",Qt),dot:new Nt("."),question:new Nt("?",Qt),questionDot:new Nt("?."),arrow:new Nt("=>",Qt),template:new Nt("template"),invalidTemplate:new Nt("invalidTemplate"),ellipsis:new Nt("...",Qt),backQuote:new Nt("`",Pt),dollarBraceL:new Nt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Nt("=",{beforeExpr:!0,isAssign:!0}),assign:new Nt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Nt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Nt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:gr("||",1),logicalAND:gr("&&",2),bitwiseOR:gr("|",3),bitwiseXOR:gr("^",4),bitwiseAND:gr("&",5),equality:gr("==/!=/===/!==",6),relational:gr("</>/<=/>=",7),bitShift:gr("<</>>/>>>",8),plusMin:new Nt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:gr("%",10),star:gr("*",10),slash:gr("/",10),starstar:new Nt("**",{beforeExpr:!0}),coalesce:gr("??",1),_break:xr("break"),_case:xr("case",Qt),_catch:xr("catch"),_continue:xr("continue"),_debugger:xr("debugger"),_default:xr("default",Qt),_do:xr("do",{isLoop:!0,beforeExpr:!0}),_else:xr("else",Qt),_finally:xr("finally"),_for:xr("for",{isLoop:!0}),_function:xr("function",Pt),_if:xr("if"),_return:xr("return",Qt),_switch:xr("switch"),_throw:xr("throw",Qt),_try:xr("try"),_var:xr("var"),_const:xr("const"),_while:xr("while",{isLoop:!0}),_with:xr("with"),_new:xr("new",{beforeExpr:!0,startsExpr:!0}),_this:xr("this",Pt),_super:xr("super",Pt),_class:xr("class",Pt),_extends:xr("extends",Qt),_export:xr("export"),_import:xr("import",Pt),_null:xr("null",Pt),_true:xr("true",Pt),_false:xr("false",Pt),_in:xr("in",{beforeExpr:!0,binop:7}),_instanceof:xr("instanceof",{beforeExpr:!0,binop:7}),_typeof:xr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:xr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:xr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},sr=/\r\n?|\n|\u2028|\u2029/,Tt=new RegExp(sr.source,"g");function ht(b,k){return b===10||b===13||!k&&(b===8232||b===8233)}var jt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,dt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,lr=Object.prototype,jr=lr.hasOwnProperty,ue=lr.toString;function He(b,k){return jr.call(b,k)}var W=Array.isArray||function(b){return ue.call(b)==="[object Array]"};function Y(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var Re=function(k,z){this.line=k,this.column=z};Re.prototype.offset=function(k){return new Re(this.line,this.column+k)};var gt=function(k,z,R){this.start=z,this.end=R,k.sourceFile!==null&&(this.source=k.sourceFile)};function wt(b,k){for(var z=1,R=0;;){Tt.lastIndex=R;var te=Tt.exec(b);if(te&&te.index<k)++z,R=te.index+te[0].length;else return new Re(z,k-R)}}var qt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function fr(b){var k={};for(var z in qt)k[z]=b&&He(b,z)?b[z]:qt[z];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),W(k.onToken)){var R=k.onToken;k.onToken=function(te){return R.push(te)}}return W(k.onComment)&&(k.onComment=br(k,k.onComment)),k}function br(b,k){return function(z,R,te,Me,st,Rt){var Ot={type:z?"Block":"Line",value:R,start:te,end:Me};b.locations&&(Ot.loc=new gt(this,st,Rt)),b.ranges&&(Ot.range=[te,Me]),k.push(Ot)}}var bn=1,en=2,Ci=bn|en,Wn=4,Vn=8,va=16,Si=32,ci=64,Vi=128;function zi(b,k){return en|(b?Wn:0)|(k?Vn:0)}var _i=0,$n=1,ii=2,Co=3,Ba=4,ya=5,Et=function(k,z,R){this.options=k=fr(k),this.sourceFile=k.sourceFile,this.keywords=Y(Pe[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var te="";if(k.allowReserved!==!0){for(var Me=k.ecmaVersion;!(te=he[Me]);Me--);k.sourceType==="module"&&(te+=" await")}this.reservedWords=Y(te);var st=(te?te+" ":"")+he.strict;this.reservedWordsStrict=Y(st),this.reservedWordsStrictBind=Y(st+" "+he.strictBind),this.input=String(z),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(sr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(bn),this.regexpState=null},de={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Et.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},de.inFunction.get=function(){return(this.currentVarScope().flags&en)>0},de.inGenerator.get=function(){return(this.currentVarScope().flags&Vn)>0},de.inAsync.get=function(){return(this.currentVarScope().flags&Wn)>0},de.allowSuper.get=function(){return(this.currentThisScope().flags&ci)>0},de.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Vi)>0},de.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Et.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&en)>0},Et.extend=function(){for(var k=[],z=arguments.length;z--;)k[z]=arguments[z];for(var R=this,te=0;te<k.length;te++)R=k[te](R);return R},Et.parse=function(k,z){return new this(z,k).parse()},Et.parseExpressionAt=function(k,z,R){var te=new this(R,k,z);return te.nextToken(),te.parseExpression()},Et.tokenizer=function(k,z){return new this(z,k)},Object.defineProperties(Et.prototype,de);var ae=Et.prototype,xe=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ae.strictDirective=function(b){for(;;){dt.lastIndex=b,b+=dt.exec(this.input)[0].length;var k=xe.exec(this.input.slice(b));if(!k)return!1;if((k[1]||k[2])==="use strict"){dt.lastIndex=b+k[0].length;var z=dt.exec(this.input),R=z.index+z[0].length,te=this.input.charAt(R);return te===";"||te==="}"||sr.test(z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(te)||te==="!"&&this.input.charAt(R+1)==="=")}b+=k[0].length,dt.lastIndex=b,b+=dt.exec(this.input)[0].length,this.input[b]===";"&&b++}},ae.eat=function(b){return this.type===b?(this.next(),!0):!1},ae.isContextual=function(b){return this.type===ee.name&&this.value===b&&!this.containsEsc},ae.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},ae.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},ae.canInsertSemicolon=function(){return this.type===ee.eof||this.type===ee.braceR||sr.test(this.input.slice(this.lastTokEnd,this.start))},ae.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ae.semicolon=function(){!this.eat(ee.semi)&&!this.insertSemicolon()&&this.unexpected()},ae.afterTrailingComma=function(b,k){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},ae.expect=function(b){this.eat(b)||this.unexpected()},ae.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function N(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ae.checkPatternErrors=function(b,k){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var z=k?b.parenthesizedAssign:b.parenthesizedBind;z>-1&&this.raiseRecoverable(z,"Parenthesized pattern")}},ae.checkExpressionErrors=function(b,k){if(!b)return!1;var z=b.shorthandAssign,R=b.doubleProto;if(!k)return z>=0||R>=0;z>=0&&this.raise(z,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},ae.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ae.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var Qe=Et.prototype;Qe.parseTopLevel=function(b){var k={};for(b.body||(b.body=[]);this.type!==ee.eof;){var z=this.parseStatement(null,!0,k);b.body.push(z)}if(this.inModule)for(var R=0,te=Object.keys(this.undefinedExports);R<te.length;R+=1){var Me=te[R];this.raiseRecoverable(this.undefinedExports[Me].start,"Export '"+Me+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var Wt={kind:"loop"},Dr={kind:"switch"};Qe.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;dt.lastIndex=this.pos;var k=dt.exec(this.input),z=this.pos+k[0].length,R=this.input.charCodeAt(z);if(R===91)return!0;if(b)return!1;if(R===123)return!0;if(Dt(R,!0)){for(var te=z+1;_r(this.input.charCodeAt(te),!0);)++te;var Me=this.input.slice(z,te);if(!q.test(Me))return!0}return!1},Qe.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;dt.lastIndex=this.pos;var b=dt.exec(this.input),k=this.pos+b[0].length;return!sr.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!_r(this.input.charAt(k+8)))},Qe.parseStatement=function(b,k,z){var R=this.type,te=this.startNode(),Me;switch(this.isLet(b)&&(R=ee._var,Me="let"),R){case ee._break:case ee._continue:return this.parseBreakContinueStatement(te,R.keyword);case ee._debugger:return this.parseDebuggerStatement(te);case ee._do:return this.parseDoStatement(te);case ee._for:return this.parseForStatement(te);case ee._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(te,!1,!b);case ee._class:return b&&this.unexpected(),this.parseClass(te,!0);case ee._if:return this.parseIfStatement(te);case ee._return:return this.parseReturnStatement(te);case ee._switch:return this.parseSwitchStatement(te);case ee._throw:return this.parseThrowStatement(te);case ee._try:return this.parseTryStatement(te);case ee._const:case ee._var:return Me=Me||this.value,b&&Me!=="var"&&this.unexpected(),this.parseVarStatement(te,Me);case ee._while:return this.parseWhileStatement(te);case ee._with:return this.parseWithStatement(te);case ee.braceL:return this.parseBlock(!0,te);case ee.semi:return this.parseEmptyStatement(te);case ee._export:case ee._import:if(this.options.ecmaVersion>10&&R===ee._import){dt.lastIndex=this.pos;var st=dt.exec(this.input),Rt=this.pos+st[0].length,Ot=this.input.charCodeAt(Rt);if(Ot===40||Ot===46)return this.parseExpressionStatement(te,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===ee._import?this.parseImport(te):this.parseExport(te,z);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(te,!0,!b);var yr=this.value,Lr=this.parseExpression();return R===ee.name&&Lr.type==="Identifier"&&this.eat(ee.colon)?this.parseLabeledStatement(te,yr,Lr,b):this.parseExpressionStatement(te,Lr)}},Qe.parseBreakContinueStatement=function(b,k){var z=k==="break";this.next(),this.eat(ee.semi)||this.insertSemicolon()?b.label=null:this.type!==ee.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var te=this.labels[R];if((b.label==null||te.name===b.label.name)&&(te.kind!=null&&(z||te.kind==="loop")||b.label&&z))break}return R===this.labels.length&&this.raise(b.start,"Unsyntactic "+k),this.finishNode(b,z?"BreakStatement":"ContinueStatement")},Qe.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},Qe.parseDoStatement=function(b){return this.next(),this.labels.push(Wt),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(ee._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ee.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},Qe.parseForStatement=function(b){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Wt),this.enterScope(0),this.expect(ee.parenL),this.type===ee.semi)return k>-1&&this.unexpected(k),this.parseFor(b,null);var z=this.isLet();if(this.type===ee._var||this.type===ee._const||z){var R=this.startNode(),te=z?"let":this.value;return this.next(),this.parseVar(R,!0,te),this.finishNode(R,"VariableDeclaration"),(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ee._in?k>-1&&this.unexpected(k):b.await=k>-1),this.parseForIn(b,R)):(k>-1&&this.unexpected(k),this.parseFor(b,R))}var Me=new N,st=this.parseExpression(!0,Me);return this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ee._in?k>-1&&this.unexpected(k):b.await=k>-1),this.toAssignable(st,!1,Me),this.checkLVal(st),this.parseForIn(b,st)):(this.checkExpressionErrors(Me,!0),k>-1&&this.unexpected(k),this.parseFor(b,st))},Qe.parseFunctionStatement=function(b,k,z){return this.next(),this.parseFunction(b,kt|(z?0:hr),!1,k)},Qe.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(ee._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},Qe.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ee.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},Qe.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(ee.braceL),this.labels.push(Dr),this.enterScope(0);for(var k,z=!1;this.type!==ee.braceR;)if(this.type===ee._case||this.type===ee._default){var R=this.type===ee._case;k&&this.finishNode(k,"SwitchCase"),b.cases.push(k=this.startNode()),k.consequent=[],this.next(),R?k.test=this.parseExpression():(z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),z=!0,k.test=null),this.expect(ee.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},Qe.parseThrowStatement=function(b){return this.next(),sr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var qe=[];Qe.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===ee._catch){var k=this.startNode();if(this.next(),this.eat(ee.parenL)){k.param=this.parseBindingAtom();var z=k.param.type==="Identifier";this.enterScope(z?Si:0),this.checkLVal(k.param,z?Ba:ii),this.expect(ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(k,"CatchClause")}return b.finalizer=this.eat(ee._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},Qe.parseVarStatement=function(b,k){return this.next(),this.parseVar(b,!1,k),this.semicolon(),this.finishNode(b,"VariableDeclaration")},Qe.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(Wt),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},Qe.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},Qe.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},Qe.parseLabeledStatement=function(b,k,z,R){for(var te=0,Me=this.labels;te<Me.length;te+=1){var st=Me[te];st.name===k&&this.raise(z.start,"Label '"+k+"' is already declared")}for(var Rt=this.type.isLoop?"loop":this.type===ee._switch?"switch":null,Ot=this.labels.length-1;Ot>=0;Ot--){var yr=this.labels[Ot];if(yr.statementStart===b.start)yr.statementStart=this.start,yr.kind=Rt;else break}return this.labels.push({name:k,kind:Rt,statementStart:this.start}),b.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),b.label=z,this.finishNode(b,"LabeledStatement")},Qe.parseExpressionStatement=function(b,k){return b.expression=k,this.semicolon(),this.finishNode(b,"ExpressionStatement")},Qe.parseBlock=function(b,k,z){for(b===void 0&&(b=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(ee.braceL),b&&this.enterScope(0);this.type!==ee.braceR;){var R=this.parseStatement(null);k.body.push(R)}return z&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(k,"BlockStatement")},Qe.parseFor=function(b,k){return b.init=k,this.expect(ee.semi),b.test=this.type===ee.semi?null:this.parseExpression(),this.expect(ee.semi),b.update=this.type===ee.parenR?null:this.parseExpression(),this.expect(ee.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},Qe.parseForIn=function(b,k){var z=this.type===ee._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!z||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),b.left=k,b.right=z?this.parseExpression():this.parseMaybeAssign(),this.expect(ee.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,z?"ForInStatement":"ForOfStatement")},Qe.parseVar=function(b,k,z){for(b.declarations=[],b.kind=z;;){var R=this.startNode();if(this.parseVarId(R,z),this.eat(ee.eq)?R.init=this.parseMaybeAssign(k):z==="const"&&!(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(k&&(this.type===ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,b.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(ee.comma))break}return b},Qe.parseVarId=function(b,k){b.id=this.parseBindingAtom(),this.checkLVal(b.id,k==="var"?$n:ii,!1)};var kt=1,hr=2,kr=4;Qe.parseFunction=function(b,k,z,R){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===ee.star&&k&hr&&this.unexpected(),b.generator=this.eat(ee.star)),this.options.ecmaVersion>=8&&(b.async=!!R),k&kt&&(b.id=k&kr&&this.type!==ee.name?null:this.parseIdent(),b.id&&!(k&hr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?$n:ii:Co));var te=this.yieldPos,Me=this.awaitPos,st=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(b.async,b.generator)),k&kt||(b.id=this.type===ee.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,z,!1),this.yieldPos=te,this.awaitPos=Me,this.awaitIdentPos=st,this.finishNode(b,k&kt?"FunctionDeclaration":"FunctionExpression")},Qe.parseFunctionParams=function(b){this.expect(ee.parenL),b.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Qe.parseClass=function(b,k){this.next();var z=this.strict;this.strict=!0,this.parseClassId(b,k),this.parseClassSuper(b);var R=this.startNode(),te=!1;for(R.body=[],this.expect(ee.braceL);this.type!==ee.braceR;){var Me=this.parseClassElement(b.superClass!==null);Me&&(R.body.push(Me),Me.type==="MethodDefinition"&&Me.kind==="constructor"&&(te&&this.raise(Me.start,"Duplicate constructor in the same class"),te=!0))}return this.strict=z,this.next(),b.body=this.finishNode(R,"ClassBody"),this.finishNode(b,k?"ClassDeclaration":"ClassExpression")},Qe.parseClassElement=function(b){var k=this;if(this.eat(ee.semi))return null;var z=this.startNode(),R=function(Ot,yr){yr===void 0&&(yr=!1);var Lr=k.start,Gn=k.startLoc;return k.eatContextual(Ot)?k.type!==ee.parenL&&(!yr||!k.canInsertSemicolon())?!0:(z.key&&k.unexpected(),z.computed=!1,z.key=k.startNodeAt(Lr,Gn),z.key.name=Ot,k.finishNode(z.key,"Identifier"),!1):!1};z.kind="method",z.static=R("static");var te=this.eat(ee.star),Me=!1;te||(this.options.ecmaVersion>=8&&R("async",!0)?(Me=!0,te=this.options.ecmaVersion>=9&&this.eat(ee.star)):R("get")?z.kind="get":R("set")&&(z.kind="set")),z.key||this.parsePropertyName(z);var st=z.key,Rt=!1;return!z.computed&&!z.static&&(st.type==="Identifier"&&st.name==="constructor"||st.type==="Literal"&&st.value==="constructor")?(z.kind!=="method"&&this.raise(st.start,"Constructor can't have get/set modifier"),te&&this.raise(st.start,"Constructor can't be a generator"),Me&&this.raise(st.start,"Constructor can't be an async method"),z.kind="constructor",Rt=b):z.static&&st.type==="Identifier"&&st.name==="prototype"&&this.raise(st.start,"Classes may not have a static property named prototype"),this.parseClassMethod(z,te,Me,Rt),z.kind==="get"&&z.value.params.length!==0&&this.raiseRecoverable(z.value.start,"getter should have no params"),z.kind==="set"&&z.value.params.length!==1&&this.raiseRecoverable(z.value.start,"setter should have exactly one param"),z.kind==="set"&&z.value.params[0].type==="RestElement"&&this.raiseRecoverable(z.value.params[0].start,"Setter cannot use rest params"),z},Qe.parseClassMethod=function(b,k,z,R){return b.value=this.parseMethod(k,z,R),this.finishNode(b,"MethodDefinition")},Qe.parseClassId=function(b,k){this.type===ee.name?(b.id=this.parseIdent(),k&&this.checkLVal(b.id,ii,!1)):(k===!0&&this.unexpected(),b.id=null)},Qe.parseClassSuper=function(b){b.superClass=this.eat(ee._extends)?this.parseExprSubscripts():null},Qe.parseExport=function(b,k){if(this.next(),this.eat(ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(k,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==ee.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(ee._default)){this.checkExport(k,"default",this.lastTokStart);var z;if(this.type===ee._function||(z=this.isAsyncFunction())){var R=this.startNode();this.next(),z&&this.next(),b.declaration=this.parseFunction(R,kt|kr,!1,z)}else if(this.type===ee._class){var te=this.startNode();b.declaration=this.parseClass(te,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,b.declaration.declarations):this.checkExport(k,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==ee.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Me=0,st=b.specifiers;Me<st.length;Me+=1){var Rt=st[Me];this.checkUnreserved(Rt.local),this.checkLocalExport(Rt.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},Qe.checkExport=function(b,k,z){!b||(He(b,k)&&this.raiseRecoverable(z,"Duplicate export '"+k+"'"),b[k]=!0)},Qe.checkPatternExport=function(b,k){var z=k.type;if(z==="Identifier")this.checkExport(b,k.name,k.start);else if(z==="ObjectPattern")for(var R=0,te=k.properties;R<te.length;R+=1){var Me=te[R];this.checkPatternExport(b,Me)}else if(z==="ArrayPattern")for(var st=0,Rt=k.elements;st<Rt.length;st+=1){var Ot=Rt[st];Ot&&this.checkPatternExport(b,Ot)}else z==="Property"?this.checkPatternExport(b,k.value):z==="AssignmentPattern"?this.checkPatternExport(b,k.left):z==="RestElement"?this.checkPatternExport(b,k.argument):z==="ParenthesizedExpression"&&this.checkPatternExport(b,k.expression)},Qe.checkVariableExport=function(b,k){if(!!b)for(var z=0,R=k;z<R.length;z+=1){var te=R[z];this.checkPatternExport(b,te.id)}},Qe.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Qe.parseExportSpecifiers=function(b){var k=[],z=!0;for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(z)z=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(b,R.exported.name,R.exported.start),k.push(this.finishNode(R,"ExportSpecifier"))}return k},Qe.parseImport=function(b){return this.next(),this.type===ee.string?(b.specifiers=qe,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},Qe.parseImportSpecifiers=function(){var b=[],k=!0;if(this.type===ee.name){var z=this.startNode();if(z.local=this.parseIdent(),this.checkLVal(z.local,ii),b.push(this.finishNode(z,"ImportDefaultSpecifier")),!this.eat(ee.comma))return b}if(this.type===ee.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,ii),b.push(this.finishNode(R,"ImportNamespaceSpecifier")),b}for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(k)k=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var te=this.startNode();te.imported=this.parseIdent(!0),this.eatContextual("as")?te.local=this.parseIdent():(this.checkUnreserved(te.imported),te.local=te.imported),this.checkLVal(te.local,ii),b.push(this.finishNode(te,"ImportSpecifier"))}return b},Qe.adaptDirectivePrologue=function(b){for(var k=0;k<b.length&&this.isDirectiveCandidate(b[k]);++k)b[k].directive=b[k].expression.raw.slice(1,-1)},Qe.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Hr=Et.prototype;Hr.toAssignable=function(b,k,z){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",z&&this.checkPatternErrors(z,!0);for(var R=0,te=b.properties;R<te.length;R+=1){var Me=te[R];this.toAssignable(Me,k),Me.type==="RestElement"&&(Me.argument.type==="ArrayPattern"||Me.argument.type==="ObjectPattern")&&this.raise(Me.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,k);break;case"ArrayExpression":b.type="ArrayPattern",z&&this.checkPatternErrors(z,!0),this.toAssignableList(b.elements,k);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,k),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,k,z);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(b.start,"Assigning to rvalue")}else z&&this.checkPatternErrors(z,!0);return b},Hr.toAssignableList=function(b,k){for(var z=b.length,R=0;R<z;R++){var te=b[R];te&&this.toAssignable(te,k)}if(z){var Me=b[z-1];this.options.ecmaVersion===6&&k&&Me&&Me.type==="RestElement"&&Me.argument.type!=="Identifier"&&this.unexpected(Me.argument.start)}return b},Hr.parseSpread=function(b){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,b),this.finishNode(k,"SpreadElement")},Hr.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ee.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Hr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ee.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(ee.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case ee.braceL:return this.parseObj(!0)}return this.parseIdent()},Hr.parseBindingList=function(b,k,z){for(var R=[],te=!0;!this.eat(b);)if(te?te=!1:this.expect(ee.comma),k&&this.type===ee.comma)R.push(null);else{if(z&&this.afterTrailingComma(b))break;if(this.type===ee.ellipsis){var Me=this.parseRestBinding();this.parseBindingListItem(Me),R.push(Me),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var st=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(st),R.push(st)}}return R},Hr.parseBindingListItem=function(b){return b},Hr.parseMaybeDefault=function(b,k,z){if(z=z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ee.eq))return z;var R=this.startNodeAt(b,k);return R.left=z,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},Hr.checkLVal=function(b,k,z){switch(k===void 0&&(k=_i),b.type){case"Identifier":k===ii&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(k?"Binding ":"Assigning to ")+b.name+" in strict mode"),z&&(He(z,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),z[b.name]=!0),k!==_i&&k!==ya&&this.declareName(b.name,k,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,te=b.properties;R<te.length;R+=1){var Me=te[R];this.checkLVal(Me,k,z)}break;case"Property":this.checkLVal(b.value,k,z);break;case"ArrayPattern":for(var st=0,Rt=b.elements;st<Rt.length;st+=1){var Ot=Rt[st];Ot&&this.checkLVal(Ot,k,z)}break;case"AssignmentPattern":this.checkLVal(b.left,k,z);break;case"RestElement":this.checkLVal(b.argument,k,z);break;case"ParenthesizedExpression":this.checkLVal(b.expression,k,z);break;default:this.raise(b.start,(k?"Binding":"Assigning to")+" rvalue")}};var qr=Et.prototype;qr.checkPropClash=function(b,k,z){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var R=b.key,te;switch(R.type){case"Identifier":te=R.name;break;case"Literal":te=String(R.value);break;default:return}var Me=b.kind;if(this.options.ecmaVersion>=6){te==="__proto__"&&Me==="init"&&(k.proto&&(z?z.doubleProto<0&&(z.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),k.proto=!0);return}te="$"+te;var st=k[te];if(st){var Rt;Me==="init"?Rt=this.strict&&st.init||st.get||st.set:Rt=st.init||st[Me],Rt&&this.raiseRecoverable(R.start,"Redefinition of property")}else st=k[te]={init:!1,get:!1,set:!1};st[Me]=!0}},qr.parseExpression=function(b,k){var z=this.start,R=this.startLoc,te=this.parseMaybeAssign(b,k);if(this.type===ee.comma){var Me=this.startNodeAt(z,R);for(Me.expressions=[te];this.eat(ee.comma);)Me.expressions.push(this.parseMaybeAssign(b,k));return this.finishNode(Me,"SequenceExpression")}return te},qr.parseMaybeAssign=function(b,k,z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var R=!1,te=-1,Me=-1;k?(te=k.parenthesizedAssign,Me=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new N,R=!0);var st=this.start,Rt=this.startLoc;(this.type===ee.parenL||this.type===ee.name)&&(this.potentialArrowAt=this.start);var Ot=this.parseMaybeConditional(b,k);if(z&&(Ot=z.call(this,Ot,st,Rt)),this.type.isAssign){var yr=this.startNodeAt(st,Rt);return yr.operator=this.value,yr.left=this.type===ee.eq?this.toAssignable(Ot,!1,k):Ot,R||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=yr.left.start&&(k.shorthandAssign=-1),this.checkLVal(Ot),this.next(),yr.right=this.parseMaybeAssign(b),this.finishNode(yr,"AssignmentExpression")}else R&&this.checkExpressionErrors(k,!0);return te>-1&&(k.parenthesizedAssign=te),Me>-1&&(k.trailingComma=Me),Ot},qr.parseMaybeConditional=function(b,k){var z=this.start,R=this.startLoc,te=this.parseExprOps(b,k);if(this.checkExpressionErrors(k))return te;if(this.eat(ee.question)){var Me=this.startNodeAt(z,R);return Me.test=te,Me.consequent=this.parseMaybeAssign(),this.expect(ee.colon),Me.alternate=this.parseMaybeAssign(b),this.finishNode(Me,"ConditionalExpression")}return te},qr.parseExprOps=function(b,k){var z=this.start,R=this.startLoc,te=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||te.start===z&&te.type==="ArrowFunctionExpression"?te:this.parseExprOp(te,z,R,-1,b)},qr.parseExprOp=function(b,k,z,R,te){var Me=this.type.binop;if(Me!=null&&(!te||this.type!==ee._in)&&Me>R){var st=this.type===ee.logicalOR||this.type===ee.logicalAND,Rt=this.type===ee.coalesce;Rt&&(Me=ee.logicalAND.binop);var Ot=this.value;this.next();var yr=this.start,Lr=this.startLoc,Gn=this.parseExprOp(this.parseMaybeUnary(null,!1),yr,Lr,Me,te),Qn=this.buildBinary(k,z,b,Gn,Ot,st||Rt);return(st&&this.type===ee.coalesce||Rt&&(this.type===ee.logicalOR||this.type===ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Qn,k,z,R,te)}return b},qr.buildBinary=function(b,k,z,R,te,Me){var st=this.startNodeAt(b,k);return st.left=z,st.operator=te,st.right=R,this.finishNode(st,Me?"LogicalExpression":"BinaryExpression")},qr.parseMaybeUnary=function(b,k){var z=this.start,R=this.startLoc,te;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))te=this.parseAwait(),k=!0;else if(this.type.prefix){var Me=this.startNode(),st=this.type===ee.incDec;Me.operator=this.value,Me.prefix=!0,this.next(),Me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),st?this.checkLVal(Me.argument):this.strict&&Me.operator==="delete"&&Me.argument.type==="Identifier"?this.raiseRecoverable(Me.start,"Deleting local variable in strict mode"):k=!0,te=this.finishNode(Me,st?"UpdateExpression":"UnaryExpression")}else{if(te=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return te;for(;this.type.postfix&&!this.canInsertSemicolon();){var Rt=this.startNodeAt(z,R);Rt.operator=this.value,Rt.prefix=!1,Rt.argument=te,this.checkLVal(te),this.next(),te=this.finishNode(Rt,"UpdateExpression")}}return!k&&this.eat(ee.starstar)?this.buildBinary(z,R,te,this.parseMaybeUnary(null,!1),"**",!1):te},qr.parseExprSubscripts=function(b){var k=this.start,z=this.startLoc,R=this.parseExprAtom(b);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var te=this.parseSubscripts(R,k,z);return b&&te.type==="MemberExpression"&&(b.parenthesizedAssign>=te.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=te.start&&(b.parenthesizedBind=-1)),te},qr.parseSubscripts=function(b,k,z,R){for(var te=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,Me=!1;;){var st=this.parseSubscript(b,k,z,R,te,Me);if(st.optional&&(Me=!0),st===b||st.type==="ArrowFunctionExpression"){if(Me){var Rt=this.startNodeAt(k,z);Rt.expression=st,st=this.finishNode(Rt,"ChainExpression")}return st}b=st}},qr.parseSubscript=function(b,k,z,R,te,Me){var st=this.options.ecmaVersion>=11,Rt=st&&this.eat(ee.questionDot);R&&Rt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ot=this.eat(ee.bracketL);if(Ot||Rt&&this.type!==ee.parenL&&this.type!==ee.backQuote||this.eat(ee.dot)){var yr=this.startNodeAt(k,z);yr.object=b,yr.property=Ot?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),yr.computed=!!Ot,Ot&&this.expect(ee.bracketR),st&&(yr.optional=Rt),b=this.finishNode(yr,"MemberExpression")}else if(!R&&this.eat(ee.parenL)){var Lr=new N,Gn=this.yieldPos,Qn=this.awaitPos,pi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var $i=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1,Lr);if(te&&!Rt&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Lr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Gn,this.awaitPos=Qn,this.awaitIdentPos=pi,this.parseArrowExpression(this.startNodeAt(k,z),$i,!0);this.checkExpressionErrors(Lr,!0),this.yieldPos=Gn||this.yieldPos,this.awaitPos=Qn||this.awaitPos,this.awaitIdentPos=pi||this.awaitIdentPos;var Ca=this.startNodeAt(k,z);Ca.callee=b,Ca.arguments=$i,st&&(Ca.optional=Rt),b=this.finishNode(Ca,"CallExpression")}else if(this.type===ee.backQuote){(Rt||Me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ra=this.startNodeAt(k,z);Ra.tag=b,Ra.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(Ra,"TaggedTemplateExpression")}return b},qr.parseExprAtom=function(b){this.type===ee.slash&&this.readRegexp();var k,z=this.potentialArrowAt===this.start;switch(this.type){case ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===ee.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==ee.dot&&this.type!==ee.bracketL&&this.type!==ee.parenL&&this.unexpected(),this.finishNode(k,"Super");case ee._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case ee.name:var R=this.start,te=this.startLoc,Me=this.containsEsc,st=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Me&&st.name==="async"&&!this.canInsertSemicolon()&&this.eat(ee._function))return this.parseFunction(this.startNodeAt(R,te),0,!1,!0);if(z&&!this.canInsertSemicolon()){if(this.eat(ee.arrow))return this.parseArrowExpression(this.startNodeAt(R,te),[st],!1);if(this.options.ecmaVersion>=8&&st.name==="async"&&this.type===ee.name&&!Me)return st=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,te),[st],!0)}return st;case ee.regexp:var Rt=this.value;return k=this.parseLiteral(Rt.value),k.regex={pattern:Rt.pattern,flags:Rt.flags},k;case ee.num:case ee.string:return this.parseLiteral(this.value);case ee._null:case ee._true:case ee._false:return k=this.startNode(),k.value=this.type===ee._null?null:this.type===ee._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case ee.parenL:var Ot=this.start,yr=this.parseParenAndDistinguishExpression(z);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(yr)&&(b.parenthesizedAssign=Ot),b.parenthesizedBind<0&&(b.parenthesizedBind=Ot)),yr;case ee.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(ee.bracketR,!0,!0,b),this.finishNode(k,"ArrayExpression");case ee.braceL:return this.parseObj(!1,b);case ee._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case ee._class:return this.parseClass(this.startNode(),!1);case ee._new:return this.parseNew();case ee.backQuote:return this.parseTemplate();case ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},qr.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case ee.parenL:return this.parseDynamicImport(b);case ee.dot:return b.meta=k,this.parseImportMeta(b);default:this.unexpected()}},qr.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(ee.parenR)){var k=this.start;this.eat(ee.comma)&&this.eat(ee.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(b,"ImportExpression")},qr.parseImportMeta=function(b){this.next();var k=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},qr.parseLiteral=function(b){var k=this.startNode();return k.value=b,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},qr.parseParenExpression=function(){this.expect(ee.parenL);var b=this.parseExpression();return this.expect(ee.parenR),b},qr.parseParenAndDistinguishExpression=function(b){var k=this.start,z=this.startLoc,R,te=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Me=this.start,st=this.startLoc,Rt=[],Ot=!0,yr=!1,Lr=new N,Gn=this.yieldPos,Qn=this.awaitPos,pi;for(this.yieldPos=0,this.awaitPos=0;this.type!==ee.parenR;)if(Ot?Ot=!1:this.expect(ee.comma),te&&this.afterTrailingComma(ee.parenR,!0)){yr=!0;break}else if(this.type===ee.ellipsis){pi=this.start,Rt.push(this.parseParenItem(this.parseRestBinding())),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Rt.push(this.parseMaybeAssign(!1,Lr,this.parseParenItem));var $i=this.start,Ca=this.startLoc;if(this.expect(ee.parenR),b&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Lr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Gn,this.awaitPos=Qn,this.parseParenArrowList(k,z,Rt);(!Rt.length||yr)&&this.unexpected(this.lastTokStart),pi&&this.unexpected(pi),this.checkExpressionErrors(Lr,!0),this.yieldPos=Gn||this.yieldPos,this.awaitPos=Qn||this.awaitPos,Rt.length>1?(R=this.startNodeAt(Me,st),R.expressions=Rt,this.finishNodeAt(R,"SequenceExpression",$i,Ca)):R=Rt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ra=this.startNodeAt(k,z);return Ra.expression=R,this.finishNode(Ra,"ParenthesizedExpression")}else return R},qr.parseParenItem=function(b){return b},qr.parseParenArrowList=function(b,k,z){return this.parseArrowExpression(this.startNodeAt(b,k),z)};var Hn=[];qr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ee.dot)){b.meta=k;var z=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),z&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var R=this.start,te=this.startLoc,Me=this.type===ee._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),R,te,!0),Me&&b.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(ee.parenL)?b.arguments=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1):b.arguments=Hn,this.finishNode(b,"NewExpression")},qr.parseTemplateElement=function(b){var k=b.isTagged,z=this.startNode();return this.type===ee.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),z.value={raw:this.value,cooked:null}):z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),z.tail=this.type===ee.backQuote,this.finishNode(z,"TemplateElement")},qr.parseTemplate=function(b){b===void 0&&(b={});var k=b.isTagged;k===void 0&&(k=!1);var z=this.startNode();this.next(),z.expressions=[];var R=this.parseTemplateElement({isTagged:k});for(z.quasis=[R];!R.tail;)this.type===ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ee.dollarBraceL),z.expressions.push(this.parseExpression()),this.expect(ee.braceR),z.quasis.push(R=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(z,"TemplateLiteral")},qr.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===ee.name||this.type===ee.num||this.type===ee.string||this.type===ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ee.star)&&!sr.test(this.input.slice(this.lastTokEnd,this.start))},qr.parseObj=function(b,k){var z=this.startNode(),R=!0,te={};for(z.properties=[],this.next();!this.eat(ee.braceR);){if(R)R=!1;else if(this.expect(ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ee.braceR))break;var Me=this.parseProperty(b,k);b||this.checkPropClash(Me,te,k),z.properties.push(Me)}return this.finishNode(z,b?"ObjectPattern":"ObjectExpression")},qr.parseProperty=function(b,k){var z=this.startNode(),R,te,Me,st;if(this.options.ecmaVersion>=9&&this.eat(ee.ellipsis))return b?(z.argument=this.parseIdent(!1),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(z,"RestElement")):(this.type===ee.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),z.argument=this.parseMaybeAssign(!1,k),this.type===ee.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(z,"SpreadElement"));this.options.ecmaVersion>=6&&(z.method=!1,z.shorthand=!1,(b||k)&&(Me=this.start,st=this.startLoc),b||(R=this.eat(ee.star)));var Rt=this.containsEsc;return this.parsePropertyName(z),!b&&!Rt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(z)?(te=!0,R=this.options.ecmaVersion>=9&&this.eat(ee.star),this.parsePropertyName(z,k)):te=!1,this.parsePropertyValue(z,b,R,te,Me,st,k,Rt),this.finishNode(z,"Property")},qr.parsePropertyValue=function(b,k,z,R,te,Me,st,Rt){if((z||R)&&this.type===ee.colon&&this.unexpected(),this.eat(ee.colon))b.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,st),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ee.parenL)k&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(z,R);else if(!k&&!Rt&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==ee.comma&&this.type!==ee.braceR&&this.type!==ee.eq){(z||R)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Ot=b.kind==="get"?0:1;if(b.value.params.length!==Ot){var yr=b.value.start;b.kind==="get"?this.raiseRecoverable(yr,"getter should have no params"):this.raiseRecoverable(yr,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((z||R)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=te),b.kind="init",k?b.value=this.parseMaybeDefault(te,Me,b.key):this.type===ee.eq&&st?(st.shorthandAssign<0&&(st.shorthandAssign=this.start),b.value=this.parseMaybeDefault(te,Me,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},qr.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(ee.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(ee.bracketR),b.key;b.computed=!1}return b.key=this.type===ee.num||this.type===ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},qr.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},qr.parseMethod=function(b,k,z){var R=this.startNode(),te=this.yieldPos,Me=this.awaitPos,st=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=b),this.options.ecmaVersion>=8&&(R.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(zi(k,R.generator)|ci|(z?Vi:0)),this.expect(ee.parenL),R.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=te,this.awaitPos=Me,this.awaitIdentPos=st,this.finishNode(R,"FunctionExpression")},qr.parseArrowExpression=function(b,k,z){var R=this.yieldPos,te=this.awaitPos,Me=this.awaitIdentPos;return this.enterScope(zi(z,!1)|va),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(k,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=R,this.awaitPos=te,this.awaitIdentPos=Me,this.finishNode(b,"ArrowFunctionExpression")},qr.parseFunctionBody=function(b,k,z){var R=k&&this.type!==ee.braceL,te=this.strict,Me=!1;if(R)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var st=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!te||st)&&(Me=this.strictDirective(this.end),Me&&st&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Rt=this.labels;this.labels=[],Me&&(this.strict=!0),this.checkParams(b,!te&&!Me&&!k&&!z&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,ya),b.body=this.parseBlock(!1,void 0,Me&&!te),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=Rt}this.exitScope()},qr.isSimpleParamList=function(b){for(var k=0,z=b;k<z.length;k+=1){var R=z[k];if(R.type!=="Identifier")return!1}return!0},qr.checkParams=function(b,k){for(var z={},R=0,te=b.params;R<te.length;R+=1){var Me=te[R];this.checkLVal(Me,$n,k?null:z)}},qr.parseExprList=function(b,k,z,R){for(var te=[],Me=!0;!this.eat(b);){if(Me)Me=!1;else if(this.expect(ee.comma),k&&this.afterTrailingComma(b))break;var st=void 0;z&&this.type===ee.comma?st=null:this.type===ee.ellipsis?(st=this.parseSpread(R),R&&this.type===ee.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):st=this.parseMaybeAssign(!1,R),te.push(st)}return te},qr.checkUnreserved=function(b){var k=b.start,z=b.end,R=b.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(k,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,z).indexOf("\\")!==-1)){var te=this.strict?this.reservedWordsStrict:this.reservedWords;te.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+R+"' is reserved"))}},qr.parseIdent=function(b,k){var z=this.startNode();return this.type===ee.name?z.name=this.value:this.type.keyword?(z.name=this.type.keyword,(z.name==="class"||z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(z,"Identifier"),b||(this.checkUnreserved(z),z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=z.start)),z},qr.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===ee.semi||this.canInsertSemicolon()||this.type!==ee.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(ee.star),k.argument=this.parseMaybeAssign(b)),this.finishNode(k,"YieldExpression")},qr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var Bn=Et.prototype;Bn.raise=function(b,k){var z=wt(this.input,b);k+=" ("+z.line+":"+z.column+")";var R=new SyntaxError(k);throw R.pos=b,R.loc=z,R.raisedAt=this.pos,R},Bn.raiseRecoverable=Bn.raise,Bn.curPosition=function(){if(this.options.locations)return new Re(this.curLine,this.pos-this.lineStart)};var Kr=Et.prototype,fi=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};Kr.enterScope=function(b){this.scopeStack.push(new fi(b))},Kr.exitScope=function(){this.scopeStack.pop()},Kr.treatFunctionsAsVarInScope=function(b){return b.flags&en||!this.inModule&&b.flags&bn},Kr.declareName=function(b,k,z){var R=!1;if(k===ii){var te=this.currentScope();R=te.lexical.indexOf(b)>-1||te.functions.indexOf(b)>-1||te.var.indexOf(b)>-1,te.lexical.push(b),this.inModule&&te.flags&bn&&delete this.undefinedExports[b]}else if(k===Ba){var Me=this.currentScope();Me.lexical.push(b)}else if(k===Co){var st=this.currentScope();this.treatFunctionsAsVar?R=st.lexical.indexOf(b)>-1:R=st.lexical.indexOf(b)>-1||st.var.indexOf(b)>-1,st.functions.push(b)}else for(var Rt=this.scopeStack.length-1;Rt>=0;--Rt){var Ot=this.scopeStack[Rt];if(Ot.lexical.indexOf(b)>-1&&!(Ot.flags&Si&&Ot.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Ot)&&Ot.functions.indexOf(b)>-1){R=!0;break}if(Ot.var.push(b),this.inModule&&Ot.flags&bn&&delete this.undefinedExports[b],Ot.flags&Ci)break}R&&this.raiseRecoverable(z,"Identifier '"+b+"' has already been declared")},Kr.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},Kr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Kr.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Ci)return k}},Kr.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Ci&&!(k.flags&va))return k}};var ri=function(k,z,R){this.type="",this.start=z,this.end=0,k.options.locations&&(this.loc=new gt(k,R)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[z,0])},sa=Et.prototype;sa.startNode=function(){return new ri(this,this.start,this.startLoc)},sa.startNodeAt=function(b,k){return new ri(this,b,k)};function wa(b,k,z,R){return b.type=k,b.end=z,this.options.locations&&(b.loc.end=R),this.options.ranges&&(b.range[1]=z),b}sa.finishNode=function(b,k){return wa.call(this,b,k,this.lastTokEnd,this.lastTokEndLoc)},sa.finishNodeAt=function(b,k,z,R){return wa.call(this,b,k,z,R)};var Na=function(k,z,R,te,Me){this.token=k,this.isExpr=!!z,this.preserveSpace=!!R,this.override=te,this.generator=!!Me},_a={b_stat:new Na("{",!1),b_expr:new Na("{",!0),b_tmpl:new Na("${",!1),p_stat:new Na("(",!1),p_expr:new Na("(",!0),q_tmpl:new Na("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new Na("function",!1),f_expr:new Na("function",!0),f_expr_gen:new Na("function",!0,!1,null,!0),f_gen:new Na("function",!1,!1,null,!0)},ra=Et.prototype;ra.initialContext=function(){return[_a.b_stat]},ra.braceIsBlock=function(b){var k=this.curContext();return k===_a.f_expr||k===_a.f_stat?!0:b===ee.colon&&(k===_a.b_stat||k===_a.b_expr)?!k.isExpr:b===ee._return||b===ee.name&&this.exprAllowed?sr.test(this.input.slice(this.lastTokEnd,this.start)):b===ee._else||b===ee.semi||b===ee.eof||b===ee.parenR||b===ee.arrow?!0:b===ee.braceL?k===_a.b_stat:b===ee._var||b===ee._const||b===ee.name?!1:!this.exprAllowed},ra.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var k=this.context[b];if(k.token==="function")return k.generator}return!1},ra.updateContext=function(b){var k,z=this.type;z.keyword&&b===ee.dot?this.exprAllowed=!1:(k=z.updateContext)?k.call(this,b):this.exprAllowed=z.beforeExpr},ee.parenR.updateContext=ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===_a.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},ee.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?_a.b_stat:_a.b_expr),this.exprAllowed=!0},ee.dollarBraceL.updateContext=function(){this.context.push(_a.b_tmpl),this.exprAllowed=!0},ee.parenL.updateContext=function(b){var k=b===ee._if||b===ee._for||b===ee._with||b===ee._while;this.context.push(k?_a.p_stat:_a.p_expr),this.exprAllowed=!0},ee.incDec.updateContext=function(){},ee._function.updateContext=ee._class.updateContext=function(b){b.beforeExpr&&b!==ee.semi&&b!==ee._else&&!(b===ee._return&&sr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===ee.colon||b===ee.braceL)&&this.curContext()===_a.b_stat)?this.context.push(_a.f_expr):this.context.push(_a.f_stat),this.exprAllowed=!1},ee.backQuote.updateContext=function(){this.curContext()===_a.q_tmpl?this.context.pop():this.context.push(_a.q_tmpl),this.exprAllowed=!1},ee.star.updateContext=function(b){if(b===ee._function){var k=this.context.length-1;this.context[k]===_a.f_expr?this.context[k]=_a.f_expr_gen:this.context[k]=_a.f_gen}this.exprAllowed=!0},ee.name.updateContext=function(b){var k=!1;this.options.ecmaVersion>=6&&b!==ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var K="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",re=K+" Extended_Pictographic",fe=re,we={9:K,10:re,11:fe},Ze="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",tt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",pt=tt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",_e=pt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",We={9:tt,10:pt,11:_e},Bt={};function Rr(b){var k=Bt[b]={binary:Y(we[b]+" "+Ze),nonBinary:{General_Category:Y(Ze),Script:Y(We[b])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}Rr(9),Rr(10),Rr(11);var Kt=Et.prototype,er=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Bt[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};er.prototype.reset=function(k,z,R){var te=R.indexOf("u")!==-1;this.start=k|0,this.source=z+"",this.flags=R,this.switchU=te&&this.parser.options.ecmaVersion>=6,this.switchN=te&&this.parser.options.ecmaVersion>=9},er.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},er.prototype.at=function(k,z){z===void 0&&(z=!1);var R=this.source,te=R.length;if(k>=te)return-1;var Me=R.charCodeAt(k);if(!(z||this.switchU)||Me<=55295||Me>=57344||k+1>=te)return Me;var st=R.charCodeAt(k+1);return st>=56320&&st<=57343?(Me<<10)+st-56613888:Me},er.prototype.nextIndex=function(k,z){z===void 0&&(z=!1);var R=this.source,te=R.length;if(k>=te)return te;var Me=R.charCodeAt(k),st;return!(z||this.switchU)||Me<=55295||Me>=57344||k+1>=te||(st=R.charCodeAt(k+1))<56320||st>57343?k+1:k+2},er.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},er.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},er.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},er.prototype.eat=function(k,z){return z===void 0&&(z=!1),this.current(z)===k?(this.advance(z),!0):!1};function Or(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}Kt.validateRegExpFlags=function(b){for(var k=b.validFlags,z=b.flags,R=0;R<z.length;R++){var te=z.charAt(R);k.indexOf(te)===-1&&this.raise(b.start,"Invalid regular expression flag"),z.indexOf(te,R+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},Kt.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},Kt.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var k=0,z=b.backReferenceNames;k<z.length;k+=1){var R=z[k];b.groupNames.indexOf(R)===-1&&b.raise("Invalid named capture referenced")}},Kt.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},Kt.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},Kt.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},Kt.regexp_eatAssertion=function(b){var k=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=k}if(b.eat(40)&&b.eat(63)){var z=!1;if(this.options.ecmaVersion>=9&&(z=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!z,!0}return b.pos=k,!1},Kt.regexp_eatQuantifier=function(b,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(b,k)?(b.eat(63),!0):!1},Kt.regexp_eatQuantifierPrefix=function(b,k){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,k)},Kt.regexp_eatBracedQuantifier=function(b,k){var z=b.pos;if(b.eat(123)){var R=0,te=-1;if(this.regexp_eatDecimalDigits(b)&&(R=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(te=b.lastIntValue),b.eat(125)))return te!==-1&&te<R&&!k&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!k&&b.raise("Incomplete quantifier"),b.pos=z}return!1},Kt.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},Kt.regexp_eatReverseSolidusAtomEscape=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=k}return!1},Kt.regexp_eatUncapturingGroup=function(b){var k=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=k}return!1},Kt.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},Kt.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},Kt.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},Kt.regexp_eatSyntaxCharacter=function(b){var k=b.current();return On(k)?(b.lastIntValue=k,b.advance(),!0):!1};function On(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}Kt.regexp_eatPatternCharacters=function(b){for(var k=b.pos,z=0;(z=b.current())!==-1&&!On(z);)b.advance();return b.pos!==k},Kt.regexp_eatExtendedPatternCharacter=function(b){var k=b.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(b.advance(),!0):!1},Kt.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},Kt.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},Kt.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Or(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Or(b.lastIntValue);return!0}return!1},Kt.regexp_eatRegExpIdentifierStart=function(b){var k=b.pos,z=this.options.ecmaVersion>=11,R=b.current(z);return b.advance(z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,z)&&(R=b.lastIntValue),Cn(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function Cn(b){return Dt(b,!0)||b===36||b===95}Kt.regexp_eatRegExpIdentifierPart=function(b){var k=b.pos,z=this.options.ecmaVersion>=11,R=b.current(z);return b.advance(z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,z)&&(R=b.lastIntValue),Gt(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function Gt(b){return _r(b,!0)||b===36||b===95||b===8204||b===8205}Kt.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},Kt.regexp_eatBackReference=function(b){var k=b.pos;if(this.regexp_eatDecimalEscape(b)){var z=b.lastIntValue;if(b.switchU)return z>b.maxBackReference&&(b.maxBackReference=z),!0;if(z<=b.numCapturingParens)return!0;b.pos=k}return!1},Kt.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},Kt.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},Kt.regexp_eatCControlLetter=function(b){var k=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=k}return!1},Kt.regexp_eatZero=function(b){return b.current()===48&&!Pi(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},Kt.regexp_eatControlEscape=function(b){var k=b.current();return k===116?(b.lastIntValue=9,b.advance(),!0):k===110?(b.lastIntValue=10,b.advance(),!0):k===118?(b.lastIntValue=11,b.advance(),!0):k===102?(b.lastIntValue=12,b.advance(),!0):k===114?(b.lastIntValue=13,b.advance(),!0):!1},Kt.regexp_eatControlLetter=function(b){var k=b.current();return En(k)?(b.lastIntValue=k%32,b.advance(),!0):!1};function En(b){return b>=65&&b<=90||b>=97&&b<=122}Kt.regexp_eatRegExpUnicodeEscapeSequence=function(b,k){k===void 0&&(k=!1);var z=b.pos,R=k||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var te=b.lastIntValue;if(R&&te>=55296&&te<=56319){var Me=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var st=b.lastIntValue;if(st>=56320&&st<=57343)return b.lastIntValue=(te-55296)*1024+(st-56320)+65536,!0}b.pos=Me,b.lastIntValue=te}return!0}if(R&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&nr(b.lastIntValue))return!0;R&&b.raise("Invalid unicode escape"),b.pos=z}return!1};function nr(b){return b>=0&&b<=1114111}Kt.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var k=b.current();return k!==99&&(!b.switchN||k!==107)?(b.lastIntValue=k,b.advance(),!0):!1},Kt.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var k=b.current();if(k>=49&&k<=57){do b.lastIntValue=10*b.lastIntValue+(k-48),b.advance();while((k=b.current())>=48&&k<=57);return!0}return!1},Kt.regexp_eatCharacterClassEscape=function(b){var k=b.current();if(yt(k))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function yt(b){return b===100||b===68||b===115||b===83||b===119||b===87}Kt.regexp_eatUnicodePropertyValueExpression=function(b){var k=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var z=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var R=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,z,R),!0}}if(b.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var te=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,te),!0}return!1},Kt.regexp_validateUnicodePropertyNameAndValue=function(b,k,z){He(b.unicodeProperties.nonBinary,k)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[k].test(z)||b.raise("Invalid property value")},Kt.regexp_validateUnicodePropertyNameOrValue=function(b,k){b.unicodeProperties.binary.test(k)||b.raise("Invalid property name")},Kt.regexp_eatUnicodePropertyName=function(b){var k=0;for(b.lastStringValue="";xi(k=b.current());)b.lastStringValue+=Or(k),b.advance();return b.lastStringValue!==""};function xi(b){return En(b)||b===95}Kt.regexp_eatUnicodePropertyValue=function(b){var k=0;for(b.lastStringValue="";dn(k=b.current());)b.lastStringValue+=Or(k),b.advance();return b.lastStringValue!==""};function dn(b){return xi(b)||Pi(b)}Kt.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},Kt.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},Kt.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var k=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var z=b.lastIntValue;b.switchU&&(k===-1||z===-1)&&b.raise("Invalid character class"),k!==-1&&z!==-1&&k>z&&b.raise("Range out of order in character class")}}},Kt.regexp_eatClassAtom=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var z=b.current();(z===99||_t(z))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=k}var R=b.current();return R!==93?(b.lastIntValue=R,b.advance(),!0):!1},Kt.regexp_eatClassEscape=function(b){var k=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=k}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},Kt.regexp_eatClassControlLetter=function(b){var k=b.current();return Pi(k)||k===95?(b.lastIntValue=k%32,b.advance(),!0):!1},Kt.regexp_eatHexEscapeSequence=function(b){var k=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=k}return!1},Kt.regexp_eatDecimalDigits=function(b){var k=b.pos,z=0;for(b.lastIntValue=0;Pi(z=b.current());)b.lastIntValue=10*b.lastIntValue+(z-48),b.advance();return b.pos!==k};function Pi(b){return b>=48&&b<=57}Kt.regexp_eatHexDigits=function(b){var k=b.pos,z=0;for(b.lastIntValue=0;ua(z=b.current());)b.lastIntValue=16*b.lastIntValue+vt(z),b.advance();return b.pos!==k};function ua(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function vt(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}Kt.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var k=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var z=b.lastIntValue;k<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=k*64+z*8+b.lastIntValue:b.lastIntValue=k*8+z}else b.lastIntValue=k;return!0}return!1},Kt.regexp_eatOctalDigit=function(b){var k=b.current();return _t(k)?(b.lastIntValue=k-48,b.advance(),!0):(b.lastIntValue=0,!1)};function _t(b){return b>=48&&b<=55}Kt.regexp_eatFixedHexDigits=function(b,k){var z=b.pos;b.lastIntValue=0;for(var R=0;R<k;++R){var te=b.current();if(!ua(te))return b.pos=z,!1;b.lastIntValue=16*b.lastIntValue+vt(te),b.advance()}return!0};var Ii=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new gt(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},ui=Et.prototype;ui.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ii(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ui.getToken=function(){return this.next(),new Ii(this)},typeof Symbol!="undefined"&&(ui[Symbol.iterator]=function(){var b=this;return{next:function(){var k=b.getToken();return{done:k.type===ee.eof,value:k}}}}),ui.curContext=function(){return this.context[this.context.length-1]},ui.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ee.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},ui.readToken=function(b){return Dt(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},ui.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var k=this.input.charCodeAt(this.pos+1);return(b<<10)+k-56613888},ui.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),k=this.pos,z=this.input.indexOf("*/",this.pos+=2);if(z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=z+2,this.options.locations){Tt.lastIndex=k;for(var R;(R=Tt.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,z),k,this.pos,b,this.curPosition())},ui.skipLineComment=function(b){for(var k=this.pos,z=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!ht(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+b,this.pos),k,this.pos,z,this.curPosition())},ui.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&jt.test(String.fromCharCode(b)))++this.pos;else break e}}},ui.finishToken=function(b,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var z=this.type;this.type=b,this.value=k,this.updateContext(z)},ui.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&k===46?(this.pos+=3,this.finishToken(ee.ellipsis)):(++this.pos,this.finishToken(ee.dot))},ui.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(ee.assign,2):this.finishOp(ee.slash,1)},ui.readToken_mult_modulo_exp=function(b){var k=this.input.charCodeAt(this.pos+1),z=1,R=b===42?ee.star:ee.modulo;return this.options.ecmaVersion>=7&&b===42&&k===42&&(++z,R=ee.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(ee.assign,z+1):this.finishOp(R,z)},ui.readToken_pipe_amp=function(b){var k=this.input.charCodeAt(this.pos+1);if(k===b){if(this.options.ecmaVersion>=12){var z=this.input.charCodeAt(this.pos+2);if(z===61)return this.finishOp(ee.assign,3)}return this.finishOp(b===124?ee.logicalOR:ee.logicalAND,2)}return k===61?this.finishOp(ee.assign,2):this.finishOp(b===124?ee.bitwiseOR:ee.bitwiseAND,1)},ui.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(ee.assign,2):this.finishOp(ee.bitwiseXOR,1)},ui.readToken_plus_min=function(b){var k=this.input.charCodeAt(this.pos+1);return k===b?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||sr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ee.incDec,2):k===61?this.finishOp(ee.assign,2):this.finishOp(ee.plusMin,1)},ui.readToken_lt_gt=function(b){var k=this.input.charCodeAt(this.pos+1),z=1;return k===b?(z=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+z)===61?this.finishOp(ee.assign,z+1):this.finishOp(ee.bitShift,z)):k===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(z=2),this.finishOp(ee.relational,z))},ui.readToken_eq_excl=function(b){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ee.arrow)):this.finishOp(b===61?ee.eq:ee.prefix,1)},ui.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var z=this.input.charCodeAt(this.pos+2);if(z<48||z>57)return this.finishOp(ee.questionDot,2)}if(k===63){if(b>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(ee.assign,3)}return this.finishOp(ee.coalesce,2)}}return this.finishOp(ee.question,1)},ui.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ee.parenL);case 41:return++this.pos,this.finishToken(ee.parenR);case 59:return++this.pos,this.finishToken(ee.semi);case 44:return++this.pos,this.finishToken(ee.comma);case 91:return++this.pos,this.finishToken(ee.bracketL);case 93:return++this.pos,this.finishToken(ee.bracketR);case 123:return++this.pos,this.finishToken(ee.braceL);case 125:return++this.pos,this.finishToken(ee.braceR);case 58:return++this.pos,this.finishToken(ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ee.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+la(b)+"'")},ui.finishOp=function(b,k){var z=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(b,z)},ui.readRegexp=function(){for(var b,k,z=this.pos;;){this.pos>=this.input.length&&this.raise(z,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(sr.test(R)&&this.raise(z,"Unterminated regular expression"),b)b=!1;else{if(R==="[")k=!0;else if(R==="]"&&k)k=!1;else if(R==="/"&&!k)break;b=R==="\\"}++this.pos}var te=this.input.slice(z,this.pos);++this.pos;var Me=this.pos,st=this.readWord1();this.containsEsc&&this.unexpected(Me);var Rt=this.regexpState||(this.regexpState=new er(this));Rt.reset(z,te,st),this.validateRegExpFlags(Rt),this.validateRegExpPattern(Rt);var Ot=null;try{Ot=new RegExp(te,st)}catch(yr){}return this.finishToken(ee.regexp,{pattern:te,flags:st,value:Ot})},ui.readInt=function(b,k,z){for(var R=this.options.ecmaVersion>=12&&k===void 0,te=z&&this.input.charCodeAt(this.pos)===48,Me=this.pos,st=0,Rt=0,Ot=0,yr=k==null?Infinity:k;Ot<yr;++Ot,++this.pos){var Lr=this.input.charCodeAt(this.pos),Gn=void 0;if(R&&Lr===95){te&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Rt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ot===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Rt=Lr;continue}if(Lr>=97?Gn=Lr-97+10:Lr>=65?Gn=Lr-65+10:Lr>=48&&Lr<=57?Gn=Lr-48:Gn=Infinity,Gn>=b)break;Rt=Lr,st=st*b+Gn}return R&&Rt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Me||k!=null&&this.pos-Me!==k?null:st};function Ki(b,k){return k?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function Qi(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}ui.readRadixNumber=function(b){var k=this.pos;this.pos+=2;var z=this.readInt(b);return z==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(z=Qi(this.input.slice(k,this.pos)),++this.pos):Dt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,z)},ui.readNumber=function(b){var k=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var z=this.pos-k>=2&&this.input.charCodeAt(k)===48;z&&this.strict&&this.raise(k,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!z&&!b&&this.options.ecmaVersion>=11&&R===110){var te=Qi(this.input.slice(k,this.pos));return++this.pos,Dt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,te)}z&&/[89]/.test(this.input.slice(k,this.pos))&&(z=!1),R===46&&!z&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!z&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),Dt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Me=Ki(this.input.slice(k,this.pos),z);return this.finishToken(ee.num,Me)},ui.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),k;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var z=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(z,"Code point out of bounds")}else k=this.readHexChar(4);return k};function la(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}ui.readString=function(b){for(var k="",z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===b)break;R===92?(k+=this.input.slice(z,this.pos),k+=this.readEscapedChar(!1),z=this.pos):(ht(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(z,this.pos++),this.finishToken(ee.string,k)};var Fi={};ui.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===Fi)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},ui.invalidStringToken=function(b,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Fi;this.raise(b,k)},ui.readTmplToken=function(){for(var b="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var z=this.input.charCodeAt(this.pos);if(z===96||z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ee.template||this.type===ee.invalidTemplate)?z===36?(this.pos+=2,this.finishToken(ee.dollarBraceL)):(++this.pos,this.finishToken(ee.backQuote)):(b+=this.input.slice(k,this.pos),this.finishToken(ee.template,b));if(z===92)b+=this.input.slice(k,this.pos),b+=this.readEscapedChar(!0),k=this.pos;else if(ht(z)){switch(b+=this.input.slice(k,this.pos),++this.pos,z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},ui.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ui.readEscapedChar=function(b){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return la(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var z=this.pos-1;return this.invalidStringToken(z,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],te=parseInt(R,8);return te>255&&(R=R.slice(0,-1),te=parseInt(R,8)),this.pos+=R.length-1,k=this.input.charCodeAt(this.pos),(R!=="0"||k===56||k===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-R.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(te)}return ht(k)?"":String.fromCharCode(k)}},ui.readHexChar=function(b){var k=this.pos,z=this.readInt(16,b);return z===null&&this.invalidStringToken(k,"Bad character escape sequence"),z},ui.readWord1=function(){this.containsEsc=!1;for(var b="",k=!0,z=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var te=this.fullCharCodeAtPos();if(_r(te,R))this.pos+=te<=65535?1:2;else if(te===92){this.containsEsc=!0,b+=this.input.slice(z,this.pos);var Me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var st=this.readCodePoint();(k?Dt:_r)(st,R)||this.invalidStringToken(Me,"Invalid Unicode escape"),b+=la(st),z=this.pos}else break;k=!1}return b+this.input.slice(z,this.pos)},ui.readWord=function(){var b=this.readWord1(),k=ee.name;return this.keywords.test(b)&&(k=Ft[b]),this.finishToken(k,b)};var pr="7.4.1";Et.acorn={Parser:Et,version:pr,defaultOptions:qt,Position:Re,SourceLocation:gt,getLineInfo:wt,Node:ri,TokenType:Nt,tokTypes:ee,keywordTypes:Ft,TokContext:Na,tokContexts:_a,isIdentifierChar:_r,isIdentifierStart:Dt,Token:Ii,isNewLine:ht,lineBreak:sr,lineBreakG:Tt,nonASCIIwhitespace:jt};function wr(b,k){return Et.parse(b,k)}function Ye(b,k,z){return Et.parseExpressionAt(b,k,z)}function Ma(b,k){return Et.tokenizer(b,k)}function Le(b,k){b.prototype=Object.create(k.prototype),b.prototype.constructor=b,b.__proto__=k}function ws(b){var k=typeof Map=="function"?new Map:void 0;return ws=function(R){if(R===null||!Bs(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(R))return k.get(R);k.set(R,te)}function te(){return na(R,arguments,Ga(this).constructor)}return te.prototype=Object.create(R.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),Qa(te,R)},ws(b)}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function na(b,k,z){return is()?na=Reflect.construct:na=function(te,Me,st){var Rt=[null];Rt.push.apply(Rt,Me);var Ot=Function.bind.apply(te,Rt),yr=new Ot;return st&&Qa(yr,st.prototype),yr},na.apply(null,arguments)}function Bs(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function Qa(b,k){return Qa=Object.setPrototypeOf||function(R,te){return R.__proto__=te,R},Qa(b,k)}function Ga(b){return Ga=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},Ga(b)}var Ja=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(Error)),ca=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(SyntaxError)),jo=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(ReferenceError)),Ko=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(ws(TypeError)),Su=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ja),Ao=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(ca),To=function(b){Le(k,b);function k(){return b.apply(this,arguments)||this}return k}(jo),fa={UnknownError:[3001,"%0",Su],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Su],NodeTypeSyntaxError:[1001,"Unknown node type: %0",To],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",To],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",To],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",To],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",To],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",To],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",To],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",To],ParamTypeSyntaxError:[1009,"Unknown param type: %0",To],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",To],FunctionUndefinedReferenceError:[2001,"%0 is not a function",jo],VariableUndefinedReferenceError:[2002,"%0 is not defined",jo],IsNotConstructor:[2003,"%0 is not a constructor",Ko]};function eo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Go(b,k,z){return eo()?Go=Reflect.construct:Go=function(te,Me,st){var Rt=[null];Rt.push.apply(Rt,Me);var Ot=Function.bind.apply(te,Rt),yr=new Ot;return st&&Wa(yr,st.prototype),yr},Go.apply(null,arguments)}function Wa(b,k){return Wa=Object.setPrototypeOf||function(R,te){return R.__proto__=te,R},Wa(b,k)}var Ys="0.0.3";function Dl(b,k){Object.defineProperty(b,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var Qo=Object.prototype.hasOwnProperty,ce=Symbol("Break"),Ie=Symbol("Continue"),ft=Symbol("DefaultCase"),Xt=Symbol("EmptyStatementReturn"),Yr=Symbol("WithScopeName"),jn=Symbol("SuperScopeName"),Di=Symbol("RootScopeName"),so=Symbol("GlobalScopeName");function za(b){return typeof b=="function"}var Xa=function(){function b(z){this.interpreter=z}var k=b.prototype;return k.generator=function(){var R=this.interpreter;function te(){return this.getCurrentScope()}function Me(){return this.getGlobalScope()}function st(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:te.bind(R),getGlobalScope:Me.bind(R),getCurrentContext:st.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},b}();function Jo(b,k,z){if(z===void 0&&(z=!0),!(b instanceof Xa))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var R=b.generator(),te=R.getOptions(),Me={timeout:te.timeout,_initEnv:function(){z||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},st=z?R.getGlobalScope():R.getCurrentScope(),Rt=new Ia(st,Me);return Rt.evaluate(k)}}Object.defineProperty(Jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Oo(b){if(!(b instanceof Xa))throw new Error("Illegal call");for(var k=b.generator(),z=arguments.length,R=new Array(z>1?z-1:0),te=1;te<z;te++)R[te-1]=arguments[te];var Me=R.pop(),st=new Ia(k.getGlobalScope(),k.getOptions()),Rt=`
		    (function anonymous(`+R.join(",")+`){
		        `+Me+`
		    });
		    `;return st.evaluate(Rt)}Object.defineProperty(Oo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var vo=function(k){this.value=k},Cs=function(k){this.value=k},As=function(k){this.value=k},Ts=function(k,z,R){z===void 0&&(z=null),this.name=R,this.parent=z,this.data=k,this.labelStack=[]};function qs(){}function hu(b,k){return b===void 0&&(b=null),new Ts(Object.create(null),b,k)}function ds(b){return Object.create(b)}var Zi={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Jo,Function:Oo};typeof JSON!="undefined"&&(Zi.JSON=JSON),typeof Promise!="undefined"&&(Zi.Promise=Promise),typeof Set!="undefined"&&(Zi.Set=Set),typeof Map!="undefined"&&(Zi.Map=Map),typeof Symbol!="undefined"&&(Zi.Symbol=Symbol),typeof Proxy!="undefined"&&(Zi.Proxy=Proxy),typeof WeakMap!="undefined"&&(Zi.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Zi.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Zi.Reflect=Reflect);var Ia=function(){function b(z,R){z===void 0&&(z=b.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||b.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?b.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=b.prototype;return k.initEnvironment=function(R){var te;if(R instanceof Ts)te=R;else{var Me=null,st=this.createSuperScope(R);this.options.rootContext&&(Me=new Ts(ds(this.options.rootContext),st,Di)),te=new Ts(R,Me||st,so)}this.globalScope=te,this.currentScope=this.globalScope,this.globalContext=te.data,this.currentContext=te.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Rt=this.options._initEnv;Rt&&Rt.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(R){return R instanceof Su||R instanceof To||R instanceof Ao},k.createSuperScope=function(R){var te=Object.assign({},Zi),Me=Object.keys(te);return Me.forEach(function(st){st in R&&delete te[st]}),new Ts(te,null,jn)},k.setCurrentContext=function(R){this.currentContext=R},k.setCurrentScope=function(R){this.currentScope=R},k.evaluate=function(R){R===void 0&&(R="");var te;if(!!R)return te=wr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(te,R)},k.appendCode=function(R){return this.evaluate(R)},k.evaluateNode=function(R,te){var Me=this;te===void 0&&(te=""),this.value=void 0,this.source=te,this.sourceList.push(te),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var st=this.getCurrentScope(),Rt=this.getCurrentContext(),Ot=st.labelStack.concat([]),yr=this.callStack.concat([]),Lr=function(){Me.setCurrentScope(st),Me.setCurrentContext(Rt),st.labelStack=Ot,Me.callStack=yr};try{var Gn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Gn()}catch(Qn){throw Qn}finally{Lr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(R,te,Me){var st=R[1].replace("%0",String(te));return Me!==null&&(st+=this.getNodePosition(Me||this.lastExecNode)),st},k.createError=function(R,te){return new te(R)},k.createThrowError=function(R,te){return this.createError(R,te)},k.createInternalThrowError=function(R,te,Me){return this.createError(this.createErrorMessage(R,te,Me),R[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,te=Date.now();return te-this.execStartTime>R},k.getNodePosition=function(R){if(R){var te="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+te:""}return""},k.createClosure=function(R){var te=this,Me;switch(R.type){case"BinaryExpression":Me=this.binaryExpressionHandler(R);break;case"LogicalExpression":Me=this.logicalExpressionHandler(R);break;case"UnaryExpression":Me=this.unaryExpressionHandler(R);break;case"UpdateExpression":Me=this.updateExpressionHandler(R);break;case"ObjectExpression":Me=this.objectExpressionHandler(R);break;case"ArrayExpression":Me=this.arrayExpressionHandler(R);break;case"CallExpression":Me=this.callExpressionHandler(R);break;case"NewExpression":Me=this.newExpressionHandler(R);break;case"MemberExpression":Me=this.memberExpressionHandler(R);break;case"ThisExpression":Me=this.thisExpressionHandler(R);break;case"SequenceExpression":Me=this.sequenceExpressionHandler(R);break;case"Literal":Me=this.literalHandler(R);break;case"Identifier":Me=this.identifierHandler(R);break;case"AssignmentExpression":Me=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":Me=this.functionDeclarationHandler(R);break;case"VariableDeclaration":Me=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":Me=this.programHandler(R);break;case"ExpressionStatement":Me=this.expressionStatementHandler(R);break;case"EmptyStatement":Me=this.emptyStatementHandler(R);break;case"ReturnStatement":Me=this.returnStatementHandler(R);break;case"FunctionExpression":Me=this.functionExpressionHandler(R);break;case"IfStatement":Me=this.ifStatementHandler(R);break;case"ConditionalExpression":Me=this.conditionalExpressionHandler(R);break;case"ForStatement":Me=this.forStatementHandler(R);break;case"WhileStatement":Me=this.whileStatementHandler(R);break;case"DoWhileStatement":Me=this.doWhileStatementHandler(R);break;case"ForInStatement":Me=this.forInStatementHandler(R);break;case"WithStatement":Me=this.withStatementHandler(R);break;case"ThrowStatement":Me=this.throwStatementHandler(R);break;case"TryStatement":Me=this.tryStatementHandler(R);break;case"ContinueStatement":Me=this.continueStatementHandler(R);break;case"BreakStatement":Me=this.breakStatementHandler(R);break;case"SwitchStatement":Me=this.switchStatementHandler(R);break;case"LabeledStatement":Me=this.labeledStatementHandler(R);break;case"DebuggerStatement":Me=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(fa.NodeTypeSyntaxError,R.type,R)}return function(){var st=te.options.timeout;if(st&&st>0&&te.checkTimeout())throw te.createInternalThrowError(fa.ExecutionTimeOutError,st,null);return te.lastExecNode=R,Me.apply(void 0,arguments)}},k.binaryExpressionHandler=function(R){var te=this,Me=this.createClosure(R.left),st=this.createClosure(R.right);return function(){var Rt=Me(),Ot=st();switch(R.operator){case"==":return Rt==Ot;case"!=":return Rt!=Ot;case"===":return Rt===Ot;case"!==":return Rt!==Ot;case"<":return Rt<Ot;case"<=":return Rt<=Ot;case">":return Rt>Ot;case">=":return Rt>=Ot;case"<<":return Rt<<Ot;case">>":return Rt>>Ot;case">>>":return Rt>>>Ot;case"+":return Rt+Ot;case"-":return Rt-Ot;case"*":return Rt*Ot;case"**":return Math.pow(Rt,Ot);case"/":return Rt/Ot;case"%":return Rt%Ot;case"|":return Rt|Ot;case"^":return Rt^Ot;case"&":return Rt&Ot;case"in":return Rt in Ot;case"instanceof":return Rt instanceof Ot;default:throw te.createInternalThrowError(fa.BinaryOperatorSyntaxError,R.operator,R)}}},k.logicalExpressionHandler=function(R){var te=this,Me=this.createClosure(R.left),st=this.createClosure(R.right);return function(){switch(R.operator){case"||":return Me()||st();case"&&":return Me()&&st();default:throw te.createInternalThrowError(fa.LogicalOperatorSyntaxError,R.operator,R)}}},k.unaryExpressionHandler=function(R){var te=this;switch(R.operator){case"delete":var Me=this.createObjectGetter(R.argument),st=this.createNameGetter(R.argument);return function(){var Lr=Me(),Gn=st();return delete Lr[Gn]};default:var Rt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Ot=this.createObjectGetter(R.argument),yr=this.createNameGetter(R.argument);Rt=function(){return Ot()[yr()]}}else Rt=this.createClosure(R.argument);return function(){var Lr=Rt();switch(R.operator){case"-":return-Lr;case"+":return+Lr;case"!":return!Lr;case"~":return~Lr;case"void":return;case"typeof":return typeof Lr;default:throw te.createInternalThrowError(fa.UnaryOperatorSyntaxError,R.operator,R)}}}},k.updateExpressionHandler=function(R){var te=this,Me=this.createObjectGetter(R.argument),st=this.createNameGetter(R.argument);return function(){var Rt=Me(),Ot=st();switch(te.assertVariable(Rt,Ot,R),R.operator){case"++":return R.prefix?++Rt[Ot]:Rt[Ot]++;case"--":return R.prefix?--Rt[Ot]:Rt[Ot]--;default:throw te.createInternalThrowError(fa.UpdateOperatorSyntaxError,R.operator,R)}}},k.objectExpressionHandler=function(R){var te=this,Me=[];function st(Ot){return Ot.type==="Identifier"?Ot.name:Ot.type==="Literal"?Ot.value:this.throwError(fa.ObjectStructureSyntaxError,Ot.type,Ot)}var Rt=Object.create(null);return R.properties.forEach(function(Ot){var yr=Ot.kind,Lr=st(Ot.key);(!Rt[Lr]||yr==="init")&&(Rt[Lr]={}),Rt[Lr][yr]=te.createClosure(Ot.value),Me.push({key:Lr,property:Ot})}),function(){for(var Ot={},yr=Me.length,Lr=0;Lr<yr;Lr++){var Gn=Me[Lr],Qn=Gn.key,pi=Rt[Qn],$i=pi.init?pi.init():void 0,Ca=pi.get?pi.get():function(){},Ra=pi.set?pi.set():function(pl){};if("set"in pi||"get"in pi){var Yi={configurable:!0,enumerable:!0,get:Ca,set:Ra};Object.defineProperty(Ot,Qn,Yi)}else{var vs=Gn.property,pu=vs.kind;vs.key.type==="Identifier"&&vs.value.type==="FunctionExpression"&&pu==="init"&&!vs.value.id&&Dl($i,vs.key.name),Ot[Qn]=$i}}return Ot}},k.arrayExpressionHandler=function(R){var te=this,Me=R.elements.map(function(st){return st&&te.createClosure(st)});return function(){for(var st=Me.length,Rt=Array(st),Ot=0;Ot<st;Ot++){var yr=Me[Ot];yr&&(Rt[Ot]=yr())}return Rt}},k.safeObjectGet=function(R,te,Me){return R[te]},k.createCallFunctionGetter=function(R){var te=this;switch(R.type){case"MemberExpression":var Me=this.createClosure(R.object),st=this.createMemberKeyGetter(R),Rt=this.source;return function(){var yr=Me(),Lr=st(),Gn=te.safeObjectGet(yr,Lr,R);if(!Gn||!za(Gn)){var Qn=Rt.slice(R.start,R.end);throw te.createInternalThrowError(fa.FunctionUndefinedReferenceError,Qn,R)}return Gn.__IS_EVAL_FUNC?function(pi){return Gn(new Xa(te),pi,!0)}:Gn.__IS_FUNCTION_FUNC?function(){for(var pi=arguments.length,$i=new Array(pi),Ca=0;Ca<pi;Ca++)$i[Ca]=arguments[Ca];return Gn.apply(void 0,[new Xa(te)].concat($i))}:Gn.bind(yr)};default:var Ot=this.createClosure(R);return function(){var yr="";R.type==="Identifier"&&(yr=R.name);var Lr=Ot();if(!Lr||!za(Lr))throw te.createInternalThrowError(fa.FunctionUndefinedReferenceError,yr,R);if(R.type==="Identifier"&&Lr.__IS_EVAL_FUNC&&yr==="eval")return function(pi){var $i=te.getScopeFromName(yr,te.getCurrentScope()),Ca=$i.name===jn||$i.name===so||$i.name===Di;return Lr(new Xa(te),pi,!Ca)};if(Lr.__IS_EVAL_FUNC)return function(pi){return Lr(new Xa(te),pi,!0)};if(Lr.__IS_FUNCTION_FUNC)return function(){for(var pi=arguments.length,$i=new Array(pi),Ca=0;Ca<pi;Ca++)$i[Ca]=arguments[Ca];return Lr.apply(void 0,[new Xa(te)].concat($i))};var Gn=te.options.globalContextInFunction;if(R.type==="Identifier"){var Qn=te.getIdentifierScope(R);Qn.name===Yr&&(Gn=Qn.data)}return Lr.bind(Gn)}}},k.callExpressionHandler=function(R){var te=this,Me=this.createCallFunctionGetter(R.callee),st=R.arguments.map(function(Rt){return te.createClosure(Rt)});return function(){return Me().apply(void 0,st.map(function(Rt){return Rt()}))}},k.functionExpressionHandler=function(R){var te=this,Me=this,st=this.source,Rt=this.collectDeclVars,Ot=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var yr=R.id?R.id.name:"",Lr=R.params.length,Gn=R.params.map(function(Ca){return te.createParamNameGetter(Ca)}),Qn=this.createClosure(R.body),pi=this.collectDeclVars,$i=this.collectDeclFuncs;return this.collectDeclVars=Rt,this.collectDeclFuncs=Ot,function(){var Ca=Me.getCurrentScope(),Ra=function Yi(){for(var vs=arguments.length,pu=new Array(vs),pl=0;pl<vs;pl++)pu[pl]=arguments[pl];Me.callStack.push(""+yr);var df=Me.getCurrentScope(),dl=hu(Ca,"FunctionScope("+yr+")");Me.setCurrentScope(dl),Me.addDeclarationsToScope(pi,$i,dl),yr&&(dl.data[yr]=Yi),dl.data.arguments=arguments,Gn.forEach(function(zu,Zu){dl.data[zu()]=pu[Zu]});var Nc=Me.getCurrentContext();Me.setCurrentContext(this);var Nu=Qn();if(Me.setCurrentContext(Nc),Me.setCurrentScope(df),Me.callStack.pop(),Nu instanceof vo)return Nu.value};return Dl(Ra,yr),Object.defineProperty(Ra,"length",{value:Lr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ra,"toString",{value:function(){return st.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ra,"valueOf",{value:function(){return st.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ra}},k.newExpressionHandler=function(R){var te=this,Me=this.source,st=this.createClosure(R.callee),Rt=R.arguments.map(function(Ot){return te.createClosure(Ot)});return function(){var Ot=st();if(!za(Ot)||Ot.__IS_EVAL_FUNC){var yr=R.callee,Lr=Me.slice(yr.start,yr.end);throw te.createInternalThrowError(fa.IsNotConstructor,Lr,R)}return Ot.__IS_FUNCTION_FUNC?Ot.apply(void 0,[new Xa(te)].concat(Rt.map(function(Gn){return Gn()}))):Go(Ot,Rt.map(function(Gn){return Gn()}))}},k.memberExpressionHandler=function(R){var te=this.createClosure(R.object),Me=this.createMemberKeyGetter(R);return function(){var st=te(),Rt=Me();return st[Rt]}},k.thisExpressionHandler=function(R){var te=this;return function(){return te.getCurrentContext()}},k.sequenceExpressionHandler=function(R){var te=this,Me=R.expressions.map(function(st){return te.createClosure(st)});return function(){for(var st,Rt=Me.length,Ot=0;Ot<Rt;Ot++){var yr=Me[Ot];st=yr()}return st}},k.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},k.identifierHandler=function(R){var te=this;return function(){var Me=te.getCurrentScope(),st=te.getScopeDataFromName(R.name,Me);return te.assertVariable(st,R.name,R),st[R.name]}},k.getIdentifierScope=function(R){var te=this.getCurrentScope(),Me=this.getScopeFromName(R.name,te);return Me},k.assignmentExpressionHandler=function(R){var te=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var Me=this.createObjectGetter(R.left),st=this.createNameGetter(R.left),Rt=this.createClosure(R.right);return function(){var Ot=Me(),yr=st(),Lr=Rt();switch(R.operator!=="="&&te.assertVariable(Ot,yr,R),R.operator){case"=":return Ot[yr]=Lr;case"+=":return Ot[yr]+=Lr;case"-=":return Ot[yr]-=Lr;case"*=":return Ot[yr]*=Lr;case"**=":return Ot[yr]=Math.pow(Ot[yr],Lr);case"/=":return Ot[yr]/=Lr;case"%=":return Ot[yr]%=Lr;case"<<=":return Ot[yr]<<=Lr;case">>=":return Ot[yr]>>=Lr;case">>>=":return Ot[yr]>>>=Lr;case"&=":return Ot[yr]&=Lr;case"^=":return Ot[yr]^=Lr;case"|=":return Ot[yr]|=Lr;default:throw te.createInternalThrowError(fa.AssignmentExpressionSyntaxError,R.type,R)}}},k.functionDeclarationHandler=function(R){if(R.id){var te=this.functionExpressionHandler(R);Object.defineProperty(te,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,te)}return function(){return Xt}},k.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(fa.VariableTypeSyntaxError,R.type,R)},k.variableDeclarationHandler=function(R){for(var te=this,Me,st=[],Rt=0;Rt<R.declarations.length;Rt++){var Ot=R.declarations[Rt];this.varDeclaration(this.getVariableName(Ot.id)),Ot.init&&st.push({type:"AssignmentExpression",operator:"=",left:Ot.id,right:Ot.init})}return st.length&&(Me=this.createClosure({type:"BlockStatement",body:st})),function(){if(Me){var yr=te.isVarDeclMode;te.isVarDeclMode=!0,Me(),te.isVarDeclMode=yr}return Xt}},k.assertVariable=function(R,te,Me){if(R===this.globalScope.data&&!(te in R))throw this.createInternalThrowError(fa.VariableUndefinedReferenceError,te,Me)},k.programHandler=function(R){var te=this,Me=R.body.map(function(st){return te.createClosure(st)});return function(){for(var st=Xt,Rt=0;Rt<Me.length;Rt++){var Ot=Me[Rt],yr=te.setValue(Ot());if(yr!==Xt&&(st=yr,st instanceof vo||st instanceof Cs||st instanceof As||st===ce||st===Ie))break}return st}},k.expressionStatementHandler=function(R){return this.createClosure(R.expression)},k.emptyStatementHandler=function(R){return function(){return Xt}},k.returnStatementHandler=function(R){var te=R.argument?this.createClosure(R.argument):qs;return function(){return new vo(te())}},k.ifStatementHandler=function(R){var te=this.createClosure(R.test),Me=this.createClosure(R.consequent),st=R.alternate?this.createClosure(R.alternate):function(){return Xt};return function(){return te()?Me():st()}},k.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},k.forStatementHandler=function(R){var te=this,Me=qs,st=R.test?this.createClosure(R.test):function(){return!0},Rt=qs,Ot=this.createClosure(R.body);return R.type==="ForStatement"&&(Me=R.init?this.createClosure(R.init):Me,Rt=R.update?this.createClosure(R.update):qs),function(yr){var Lr,Gn=Xt,Qn=R.type==="DoWhileStatement";for(yr&&yr.type==="LabeledStatement"&&(Lr=yr.label.name),Me();Qn||st();Rt()){Qn=!1;var pi=te.setValue(Ot());if(!(pi===Xt||pi===Ie)){if(pi===ce)break;if(Gn=pi,Gn instanceof As&&Gn.value===Lr){Gn=Xt;continue}if(Gn instanceof vo||Gn instanceof Cs||Gn instanceof As)break}}return Gn}},k.whileStatementHandler=function(R){return this.forStatementHandler(R)},k.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},k.forInStatementHandler=function(R){var te=this,Me=R.left,st=this.createClosure(R.right),Rt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),Me=R.left.declarations[0].id),function(Ot){var yr,Lr=Xt,Gn;Ot&&Ot.type==="LabeledStatement"&&(yr=Ot.label.name);var Qn=st();for(Gn in Qn){te.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Me,right:{type:"Literal",value:Gn}})();var pi=te.setValue(Rt());if(!(pi===Xt||pi===Ie)){if(pi===ce)break;if(Lr=pi,Lr instanceof As&&Lr.value===yr){Lr=Xt;continue}if(Lr instanceof vo||Lr instanceof Cs||Lr instanceof As)break}}return Lr}},k.withStatementHandler=function(R){var te=this,Me=this.createClosure(R.object),st=this.createClosure(R.body);return function(){var Rt=Me(),Ot=te.getCurrentScope(),yr=new Ts(Rt,Ot,Yr);te.setCurrentScope(yr);var Lr=te.setValue(st());return te.setCurrentScope(Ot),Lr}},k.throwStatementHandler=function(R){var te=this,Me=this.createClosure(R.argument);return function(){throw te.setValue(void 0),Me()}},k.tryStatementHandler=function(R){var te=this,Me=this.createClosure(R.block),st=R.handler?this.catchClauseHandler(R.handler):null,Rt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Ot=te.getCurrentScope(),yr=te.getCurrentContext(),Lr=Ot.labelStack.concat([]),Gn=te.callStack.concat([]),Qn=Xt,pi,$i,Ca=function(){te.setCurrentScope(Ot),te.setCurrentContext(yr),Ot.labelStack=Lr,te.callStack=Gn};try{Qn=te.setValue(Me()),Qn instanceof vo&&(pi=Qn)}catch(Ra){if(Ca(),te.isInterruptThrow(Ra))throw Ra;if(st)try{Qn=te.setValue(st(Ra)),Qn instanceof vo&&(pi=Qn)}catch(Yi){if(Ca(),te.isInterruptThrow(Yi))throw Yi;$i=Yi}}if(Rt)try{Qn=Rt(),Qn instanceof vo&&(pi=Qn)}catch(Ra){if(Ca(),te.isInterruptThrow(Ra))throw Ra;$i=Ra}if($i)throw $i;return pi||Qn}},k.catchClauseHandler=function(R){var te=this,Me=this.createParamNameGetter(R.param),st=this.createClosure(R.body);return function(Rt){var Ot,yr=te.getCurrentScope(),Lr=yr.data,Gn=Me(),Qn=Qo.call(Lr,Gn),pi=Lr[Gn];return Lr[Gn]=Rt,Ot=st(),Qn?Lr[Gn]=pi:delete Lr[Gn],Ot}},k.continueStatementHandler=function(R){return function(){return R.label?new As(R.label.name):Ie}},k.breakStatementHandler=function(R){return function(){return R.label?new Cs(R.label.name):ce}},k.switchStatementHandler=function(R){var te=this,Me=this.createClosure(R.discriminant),st=R.cases.map(function(Rt){return te.switchCaseHandler(Rt)});return function(){for(var Rt=Me(),Ot=!1,yr,Lr,Gn,Qn=0;Qn<st.length;Qn++){var pi=st[Qn](),$i=pi.testClosure();if($i===ft){Gn=pi;continue}if(Ot||$i===Rt){if(Ot=!0,Lr=te.setValue(pi.bodyClosure()),Lr===Xt)continue;if(Lr===ce||(yr=Lr,yr instanceof vo||yr instanceof Cs||yr instanceof As||yr===Ie))break}}if(!Ot&&Gn){Lr=te.setValue(Gn.bodyClosure());var Ca=Lr===Xt||Lr===ce||Lr===Ie;Ca||(yr=Lr)}return yr}},k.switchCaseHandler=function(R){var te=R.test?this.createClosure(R.test):function(){return ft},Me=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:te,bodyClosure:Me}}},k.labeledStatementHandler=function(R){var te=this,Me=R.label.name,st=this.createClosure(R.body);return function(){var Rt,Ot=te.getCurrentScope();return Ot.labelStack.push(Me),Rt=st(R),Rt instanceof Cs&&Rt.value===Me&&(Rt=Xt),Ot.labelStack.pop(),Rt}},k.debuggerStatementHandler=function(R){return function(){debugger;return Xt}},k.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(fa.ParamTypeSyntaxError,R.type,R)},k.createObjectKeyGetter=function(R){var te;return R.type==="Identifier"?te=function(){return R.name}:te=this.createClosure(R),function(){return te()}},k.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},k.createObjectGetter=function(R){var te=this;switch(R.type){case"Identifier":return function(){return te.getScopeDataFromName(R.name,te.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,R.type,R)}},k.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,R.type,R)}},k.varDeclaration=function(R){var te=this.collectDeclVars;te[R]=void 0},k.funcDeclaration=function(R,te){var Me=this.collectDeclFuncs;Me[R]=te},k.addDeclarationsToScope=function(R,te,Me){var st=Me.data;for(var Rt in te){var Ot=te[Rt];st[Rt]=Ot&&Ot()}for(var yr in R)yr in st||(st[yr]=void 0)},k.getScopeValue=function(R,te){var Me=this.getScopeFromName(R,te);return Me.data[R]},k.getScopeDataFromName=function(R,te){return this.getScopeFromName(R,te).data},k.getScopeFromName=function(R,te){var Me=te;do if(R in Me.data)return Me;while(Me=Me.parent);return this.globalScope},k.setValue=function(R){var te=this.callStack.length;return this.isVarDeclMode||te||R===Xt||R===ce||R===Ie||R instanceof Cs||R instanceof As||(this.value=R instanceof vo?R.value:R),R},k.getValue=function(){return this.value},b}();Ia.version=Ys,Ia.eval=Jo,Ia.Function=Oo,Ia.ecmaVersion=5,Ia.globalContextInFunction=void 0,Ia.global=Object.create(null);function Bc(b){return b===void 0&&(b=Object.create(null)),b}function hf(b,k,z){k===void 0&&(k=[]),z===void 0&&(z={});var R=z.parsingContext,te=z.timeout===void 0?0:z.timeout,Me=`
    (function anonymous(`+k.join(",")+`){
         `+b+`
    });
    `,st=new Ia(R,{ecmaVersion:z.ecmaVersion,timeout:te,rootContext:z.rootContext,globalContextInFunction:z.globalContextInFunction});return st.evaluate(Me)}function Ms(b,k,z){var R=new Ia(k,z);return R.evaluate(b)}var pf=Ms,hl=function(){function b(z){this._code=z}var k=b.prototype;return k.runInContext=function(R){return Ms(this._code,R)},k.runInNewContext=function(R){return Ms(this._code,R)},b}(),Qu=function(b,k,z){return Ms(b,k,z)};function Ks(){for(var b=arguments.length,k=new Array(b),z=0;z<b;z++)k[z]=arguments[z];var R=k.pop();return hf(R||"",k)}var Bl=Qu},20396:function(Tn,me,se){var De;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(he,y,Pe,q){"use strict";var Ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,pe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ke=Ce||pe,Se=["","webkit","Moz","MS","ms","o"],ot=Ke?"":y.createElement("div"),mt="function",bt=Math.round,Dt=Math.abs,_r=Date.now;function Nt(ce,Ie,ft){return setTimeout(Tt(ce,ft),Ie)}function gr(ce,Ie,ft){return Array.isArray(ce)?(Qt(ce,ft[Ie],ft),!0):!1}function Qt(ce,Ie,ft){var Xt;if(!!ce)if(ce.forEach)ce.forEach(Ie,ft);else if(ce.length!==q)for(Xt=0;Xt<ce.length;)Ie.call(ft,ce[Xt],Xt,ce),Xt++;else for(Xt in ce)ce.hasOwnProperty(Xt)&&Ie.call(ft,ce[Xt],Xt,ce)}function Pt(ce,Ie,ft){var Xt="DEPRECATED METHOD: "+Ie+`
`+ft+` AT 
`;return function(){var Yr=new Error("get-stack-trace"),jn=Yr&&Yr.stack?Yr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Di=he.console&&(he.console.warn||he.console.log);return Di&&Di.call(he.console,Xt,jn),ce.apply(this,arguments)}}var Ft;typeof Object.assign!="function"?Ft=function(Ie){if(Ie===q||Ie===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(Ie),Xt=1;Xt<arguments.length;Xt++){var Yr=arguments[Xt];if(Yr!==q&&Yr!==null)for(var jn in Yr)Yr.hasOwnProperty(jn)&&(ft[jn]=Yr[jn])}return ft}:Ft=Object.assign;var xr=Pt(function(Ie,ft,Xt){for(var Yr=Object.keys(ft),jn=0;jn<Yr.length;)(!Xt||Xt&&Ie[Yr[jn]]===q)&&(Ie[Yr[jn]]=ft[Yr[jn]]),jn++;return Ie},"extend","Use `assign`."),ee=Pt(function(Ie,ft){return xr(Ie,ft,!0)},"merge","Use `assign`.");function sr(ce,Ie,ft){var Xt=Ie.prototype,Yr;Yr=ce.prototype=Object.create(Xt),Yr.constructor=ce,Yr._super=Xt,ft&&Ft(Yr,ft)}function Tt(ce,Ie){return function(){return ce.apply(Ie,arguments)}}function ht(ce,Ie){return typeof ce==mt?ce.apply(Ie&&Ie[0]||q,Ie):ce}function jt(ce,Ie){return ce===q?Ie:ce}function dt(ce,Ie,ft){Qt(He(Ie),function(Xt){ce.addEventListener(Xt,ft,!1)})}function lr(ce,Ie,ft){Qt(He(Ie),function(Xt){ce.removeEventListener(Xt,ft,!1)})}function jr(ce,Ie){for(;ce;){if(ce==Ie)return!0;ce=ce.parentNode}return!1}function ue(ce,Ie){return ce.indexOf(Ie)>-1}function He(ce){return ce.trim().split(/\s+/g)}function W(ce,Ie,ft){if(ce.indexOf&&!ft)return ce.indexOf(Ie);for(var Xt=0;Xt<ce.length;){if(ft&&ce[Xt][ft]==Ie||!ft&&ce[Xt]===Ie)return Xt;Xt++}return-1}function Y(ce){return Array.prototype.slice.call(ce,0)}function Re(ce,Ie,ft){for(var Xt=[],Yr=[],jn=0;jn<ce.length;){var Di=Ie?ce[jn][Ie]:ce[jn];W(Yr,Di)<0&&Xt.push(ce[jn]),Yr[jn]=Di,jn++}return ft&&(Ie?Xt=Xt.sort(function(za,Xa){return za[Ie]>Xa[Ie]}):Xt=Xt.sort()),Xt}function gt(ce,Ie){for(var ft,Xt,Yr=Ie[0].toUpperCase()+Ie.slice(1),jn=0;jn<Se.length;){if(ft=Se[jn],Xt=ft?ft+Yr:Ie,Xt in ce)return Xt;jn++}return q}var wt=1;function qt(){return wt++}function fr(ce){var Ie=ce.ownerDocument||ce;return Ie.defaultView||Ie.parentWindow||he}var br=/mobile|tablet|ip(ad|hone|od)|android/i,bn="ontouchstart"in he,en=gt(he,"PointerEvent")!==q,Ci=bn&&br.test(navigator.userAgent),Wn="touch",Vn="pen",va="mouse",Si="kinect",ci=25,Vi=1,zi=2,_i=4,$n=8,ii=1,Co=2,Ba=4,ya=8,Et=16,de=Co|Ba,ae=ya|Et,xe=de|ae,N=["x","y"],Qe=["clientX","clientY"];function Wt(ce,Ie){var ft=this;this.manager=ce,this.callback=Ie,this.element=ce.element,this.target=ce.options.inputTarget,this.domHandler=function(Xt){ht(ce.options.enable,[ce])&&ft.handler(Xt)},this.init()}Wt.prototype={handler:function(){},init:function(){this.evEl&&dt(this.element,this.evEl,this.domHandler),this.evTarget&&dt(this.target,this.evTarget,this.domHandler),this.evWin&&dt(fr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&lr(this.element,this.evEl,this.domHandler),this.evTarget&&lr(this.target,this.evTarget,this.domHandler),this.evWin&&lr(fr(this.element),this.evWin,this.domHandler)}};function Dr(ce){var Ie,ft=ce.options.inputClass;return ft?Ie=ft:en?Ie=Ze:Ci?Ie=er:bn?Ie=Gt:Ie=ra,new Ie(ce,qe)}function qe(ce,Ie,ft){var Xt=ft.pointers.length,Yr=ft.changedPointers.length,jn=Ie&Vi&&Xt-Yr==0,Di=Ie&(_i|$n)&&Xt-Yr==0;ft.isFirst=!!jn,ft.isFinal=!!Di,jn&&(ce.session={}),ft.eventType=Ie,kt(ce,ft),ce.emit("hammer.input",ft),ce.recognize(ft),ce.session.prevInput=ft}function kt(ce,Ie){var ft=ce.session,Xt=Ie.pointers,Yr=Xt.length;ft.firstInput||(ft.firstInput=Hr(Ie)),Yr>1&&!ft.firstMultiple?ft.firstMultiple=Hr(Ie):Yr===1&&(ft.firstMultiple=!1);var jn=ft.firstInput,Di=ft.firstMultiple,so=Di?Di.center:jn.center,za=Ie.center=qr(Xt);Ie.timeStamp=_r(),Ie.deltaTime=Ie.timeStamp-jn.timeStamp,Ie.angle=fi(so,za),Ie.distance=Kr(so,za),hr(ft,Ie),Ie.offsetDirection=Bn(Ie.deltaX,Ie.deltaY);var Xa=Hn(Ie.deltaTime,Ie.deltaX,Ie.deltaY);Ie.overallVelocityX=Xa.x,Ie.overallVelocityY=Xa.y,Ie.overallVelocity=Dt(Xa.x)>Dt(Xa.y)?Xa.x:Xa.y,Ie.scale=Di?sa(Di.pointers,Xt):1,Ie.rotation=Di?ri(Di.pointers,Xt):0,Ie.maxPointers=ft.prevInput?Ie.pointers.length>ft.prevInput.maxPointers?Ie.pointers.length:ft.prevInput.maxPointers:Ie.pointers.length,kr(ft,Ie);var Jo=ce.element;jr(Ie.srcEvent.target,Jo)&&(Jo=Ie.srcEvent.target),Ie.target=Jo}function hr(ce,Ie){var ft=Ie.center,Xt=ce.offsetDelta||{},Yr=ce.prevDelta||{},jn=ce.prevInput||{};(Ie.eventType===Vi||jn.eventType===_i)&&(Yr=ce.prevDelta={x:jn.deltaX||0,y:jn.deltaY||0},Xt=ce.offsetDelta={x:ft.x,y:ft.y}),Ie.deltaX=Yr.x+(ft.x-Xt.x),Ie.deltaY=Yr.y+(ft.y-Xt.y)}function kr(ce,Ie){var ft=ce.lastInterval||Ie,Xt=Ie.timeStamp-ft.timeStamp,Yr,jn,Di,so;if(Ie.eventType!=$n&&(Xt>ci||ft.velocity===q)){var za=Ie.deltaX-ft.deltaX,Xa=Ie.deltaY-ft.deltaY,Jo=Hn(Xt,za,Xa);jn=Jo.x,Di=Jo.y,Yr=Dt(Jo.x)>Dt(Jo.y)?Jo.x:Jo.y,so=Bn(za,Xa),ce.lastInterval=Ie}else Yr=ft.velocity,jn=ft.velocityX,Di=ft.velocityY,so=ft.direction;Ie.velocity=Yr,Ie.velocityX=jn,Ie.velocityY=Di,Ie.direction=so}function Hr(ce){for(var Ie=[],ft=0;ft<ce.pointers.length;)Ie[ft]={clientX:bt(ce.pointers[ft].clientX),clientY:bt(ce.pointers[ft].clientY)},ft++;return{timeStamp:_r(),pointers:Ie,center:qr(Ie),deltaX:ce.deltaX,deltaY:ce.deltaY}}function qr(ce){var Ie=ce.length;if(Ie===1)return{x:bt(ce[0].clientX),y:bt(ce[0].clientY)};for(var ft=0,Xt=0,Yr=0;Yr<Ie;)ft+=ce[Yr].clientX,Xt+=ce[Yr].clientY,Yr++;return{x:bt(ft/Ie),y:bt(Xt/Ie)}}function Hn(ce,Ie,ft){return{x:Ie/ce||0,y:ft/ce||0}}function Bn(ce,Ie){return ce===Ie?ii:Dt(ce)>=Dt(Ie)?ce<0?Co:Ba:Ie<0?ya:Et}function Kr(ce,Ie,ft){ft||(ft=N);var Xt=Ie[ft[0]]-ce[ft[0]],Yr=Ie[ft[1]]-ce[ft[1]];return Math.sqrt(Xt*Xt+Yr*Yr)}function fi(ce,Ie,ft){ft||(ft=N);var Xt=Ie[ft[0]]-ce[ft[0]],Yr=Ie[ft[1]]-ce[ft[1]];return Math.atan2(Yr,Xt)*180/Math.PI}function ri(ce,Ie){return fi(Ie[1],Ie[0],Qe)+fi(ce[1],ce[0],Qe)}function sa(ce,Ie){return Kr(Ie[0],Ie[1],Qe)/Kr(ce[0],ce[1],Qe)}var wa={mousedown:Vi,mousemove:zi,mouseup:_i},Na="mousedown",_a="mousemove mouseup";function ra(){this.evEl=Na,this.evWin=_a,this.pressed=!1,Wt.apply(this,arguments)}sr(ra,Wt,{handler:function(Ie){var ft=wa[Ie.type];ft&Vi&&Ie.button===0&&(this.pressed=!0),ft&zi&&Ie.which!==1&&(ft=_i),!!this.pressed&&(ft&_i&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[Ie],changedPointers:[Ie],pointerType:va,srcEvent:Ie}))}});var K={pointerdown:Vi,pointermove:zi,pointerup:_i,pointercancel:$n,pointerout:$n},re={2:Wn,3:Vn,4:va,5:Si},fe="pointerdown",we="pointermove pointerup pointercancel";!Ke&&he.MSPointerEvent&&!he.PointerEvent&&(fe="MSPointerDown",we="MSPointerMove MSPointerUp MSPointerCancel");function Ze(){this.evEl=fe,this.evWin=we,Wt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}sr(Ze,Wt,{handler:function(Ie){var ft=this.store,Xt=!1,Yr=Ie.type.toLowerCase().replace("ms",""),jn=K[Yr],Di=re[Ie.pointerType]||Ie.pointerType,so=Di==Wn,za=W(ft,Ie.pointerId,"pointerId");jn&Vi&&(Ie.button===0||so)?za<0&&(ft.push(Ie),za=ft.length-1):jn&(_i|$n)&&(Xt=!0),!(za<0)&&(ft[za]=Ie,this.callback(this.manager,jn,{pointers:ft,changedPointers:[Ie],pointerType:Di,srcEvent:Ie}),Xt&&ft.splice(za,1))}});var tt={touchstart:Vi,touchmove:zi,touchend:_i,touchcancel:$n},pt="touchstart",_e="touchstart touchmove touchend touchcancel";function We(){this.evTarget=pt,this.evWin=_e,this.started=!1,Wt.apply(this,arguments)}sr(We,Wt,{handler:function(Ie){var ft=tt[Ie.type];if(ft===Vi&&(this.started=!0),!!this.started){var Xt=Bt.call(this,Ie,ft);ft&(_i|$n)&&Xt[0].length-Xt[1].length==0&&(this.started=!1),this.callback(this.manager,ft,{pointers:Xt[0],changedPointers:Xt[1],pointerType:Wn,srcEvent:Ie})}}});function Bt(ce,Ie){var ft=Y(ce.touches),Xt=Y(ce.changedTouches);return Ie&(_i|$n)&&(ft=Re(ft.concat(Xt),"identifier",!0)),[ft,Xt]}var Rr={touchstart:Vi,touchmove:zi,touchend:_i,touchcancel:$n},Kt="touchstart touchmove touchend touchcancel";function er(){this.evTarget=Kt,this.targetIds={},Wt.apply(this,arguments)}sr(er,Wt,{handler:function(Ie){var ft=Rr[Ie.type],Xt=Or.call(this,Ie,ft);!Xt||this.callback(this.manager,ft,{pointers:Xt[0],changedPointers:Xt[1],pointerType:Wn,srcEvent:Ie})}});function Or(ce,Ie){var ft=Y(ce.touches),Xt=this.targetIds;if(Ie&(Vi|zi)&&ft.length===1)return Xt[ft[0].identifier]=!0,[ft,ft];var Yr,jn,Di=Y(ce.changedTouches),so=[],za=this.target;if(jn=ft.filter(function(Xa){return jr(Xa.target,za)}),Ie===Vi)for(Yr=0;Yr<jn.length;)Xt[jn[Yr].identifier]=!0,Yr++;for(Yr=0;Yr<Di.length;)Xt[Di[Yr].identifier]&&so.push(Di[Yr]),Ie&(_i|$n)&&delete Xt[Di[Yr].identifier],Yr++;if(!!so.length)return[Re(jn.concat(so),"identifier",!0),so]}var On=2500,Cn=25;function Gt(){Wt.apply(this,arguments);var ce=Tt(this.handler,this);this.touch=new er(this.manager,ce),this.mouse=new ra(this.manager,ce),this.primaryTouch=null,this.lastTouches=[]}sr(Gt,Wt,{handler:function(Ie,ft,Xt){var Yr=Xt.pointerType==Wn,jn=Xt.pointerType==va;if(!(jn&&Xt.sourceCapabilities&&Xt.sourceCapabilities.firesTouchEvents)){if(Yr)En.call(this,ft,Xt);else if(jn&&yt.call(this,Xt))return;this.callback(Ie,ft,Xt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function En(ce,Ie){ce&Vi?(this.primaryTouch=Ie.changedPointers[0].identifier,nr.call(this,Ie)):ce&(_i|$n)&&nr.call(this,Ie)}function nr(ce){var Ie=ce.changedPointers[0];if(Ie.identifier===this.primaryTouch){var ft={x:Ie.clientX,y:Ie.clientY};this.lastTouches.push(ft);var Xt=this.lastTouches,Yr=function(){var jn=Xt.indexOf(ft);jn>-1&&Xt.splice(jn,1)};setTimeout(Yr,On)}}function yt(ce){for(var Ie=ce.srcEvent.clientX,ft=ce.srcEvent.clientY,Xt=0;Xt<this.lastTouches.length;Xt++){var Yr=this.lastTouches[Xt],jn=Math.abs(Ie-Yr.x),Di=Math.abs(ft-Yr.y);if(jn<=Cn&&Di<=Cn)return!0}return!1}var xi=Ke?q:gt(ot.style,"touchAction"),dn=xi!==q,Pi="compute",ua="auto",vt="manipulation",_t="none",Ii="pan-x",ui="pan-y",Ki=Fi();function Qi(ce,Ie){this.manager=ce,this.set(Ie)}Qi.prototype={set:function(ce){ce==Pi&&(ce=this.compute()),dn&&this.manager.element.style&&Ki[ce]&&(this.manager.element.style[xi]=ce),this.actions=ce.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ce=[];return Qt(this.manager.recognizers,function(Ie){ht(Ie.options.enable,[Ie])&&(ce=ce.concat(Ie.getTouchAction()))}),la(ce.join(" "))},preventDefaults:function(ce){var Ie=ce.srcEvent,ft=ce.offsetDirection;if(this.manager.session.prevented){Ie.preventDefault();return}var Xt=this.actions,Yr=ue(Xt,_t)&&!Ki[_t],jn=ue(Xt,ui)&&!Ki[ui],Di=ue(Xt,Ii)&&!Ki[Ii];if(Yr){var so=ce.pointers.length===1,za=ce.distance<2,Xa=ce.deltaTime<250;if(so&&za&&Xa)return}if(!(Di&&jn)&&(Yr||jn&&ft&de||Di&&ft&ae))return this.preventSrc(Ie)},preventSrc:function(ce){this.manager.session.prevented=!0,ce.preventDefault()}};function la(ce){if(ue(ce,_t))return _t;var Ie=ue(ce,Ii),ft=ue(ce,ui);return Ie&&ft?_t:Ie||ft?Ie?Ii:ui:ue(ce,vt)?vt:ua}function Fi(){if(!dn)return!1;var ce={};if(Ke)return ce;var Ie=he.CSS&&he.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){ce[ft]=Ie?he.CSS.supports("touch-action",ft):!0}),ce}var pr=1,wr=2,Ye=4,Ma=8,Le=Ma,ws=16,is=32;function na(ce){this.options=Ft({},this.defaults,ce||{}),this.id=qt(),this.manager=null,this.options.enable=jt(this.options.enable,!0),this.state=pr,this.simultaneous={},this.requireFail=[]}na.prototype={defaults:{},set:function(ce){return Ft(this.options,ce),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ce){if(gr(ce,"recognizeWith",this))return this;var Ie=this.simultaneous;return ce=Ga(ce,this),Ie[ce.id]||(Ie[ce.id]=ce,ce.recognizeWith(this)),this},dropRecognizeWith:function(ce){return gr(ce,"dropRecognizeWith",this)?this:(ce=Ga(ce,this),delete this.simultaneous[ce.id],this)},requireFailure:function(ce){if(gr(ce,"requireFailure",this))return this;var Ie=this.requireFail;return ce=Ga(ce,this),W(Ie,ce)===-1&&(Ie.push(ce),ce.requireFailure(this)),this},dropRequireFailure:function(ce){if(gr(ce,"dropRequireFailure",this))return this;ce=Ga(ce,this);var Ie=W(this.requireFail,ce);return Ie>-1&&this.requireFail.splice(Ie,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ce){return!!this.simultaneous[ce.id]},emit:function(ce){var Ie=this,ft=this.state;function Xt(Yr){Ie.manager.emit(Yr,ce)}ft<Ma&&Xt(Ie.options.event+Bs(ft)),Xt(Ie.options.event),ce.additionalEvent&&Xt(ce.additionalEvent),ft>=Ma&&Xt(Ie.options.event+Bs(ft))},tryEmit:function(ce){if(this.canEmit())return this.emit(ce);this.state=is},canEmit:function(){for(var ce=0;ce<this.requireFail.length;){if(!(this.requireFail[ce].state&(is|pr)))return!1;ce++}return!0},recognize:function(ce){var Ie=Ft({},ce);if(!ht(this.options.enable,[this,Ie])){this.reset(),this.state=is;return}this.state&(Le|ws|is)&&(this.state=pr),this.state=this.process(Ie),this.state&(wr|Ye|Ma|ws)&&this.tryEmit(Ie)},process:function(ce){},getTouchAction:function(){},reset:function(){}};function Bs(ce){return ce&ws?"cancel":ce&Ma?"end":ce&Ye?"move":ce&wr?"start":""}function Qa(ce){return ce==Et?"down":ce==ya?"up":ce==Co?"left":ce==Ba?"right":""}function Ga(ce,Ie){var ft=Ie.manager;return ft?ft.get(ce):ce}function Ja(){na.apply(this,arguments)}sr(Ja,na,{defaults:{pointers:1},attrTest:function(ce){var Ie=this.options.pointers;return Ie===0||ce.pointers.length===Ie},process:function(ce){var Ie=this.state,ft=ce.eventType,Xt=Ie&(wr|Ye),Yr=this.attrTest(ce);return Xt&&(ft&$n||!Yr)?Ie|ws:Xt||Yr?ft&_i?Ie|Ma:Ie&wr?Ie|Ye:wr:is}});function ca(){Ja.apply(this,arguments),this.pX=null,this.pY=null}sr(ca,Ja,{defaults:{event:"pan",threshold:10,pointers:1,direction:xe},getTouchAction:function(){var ce=this.options.direction,Ie=[];return ce&de&&Ie.push(ui),ce&ae&&Ie.push(Ii),Ie},directionTest:function(ce){var Ie=this.options,ft=!0,Xt=ce.distance,Yr=ce.direction,jn=ce.deltaX,Di=ce.deltaY;return Yr&Ie.direction||(Ie.direction&de?(Yr=jn===0?ii:jn<0?Co:Ba,ft=jn!=this.pX,Xt=Math.abs(ce.deltaX)):(Yr=Di===0?ii:Di<0?ya:Et,ft=Di!=this.pY,Xt=Math.abs(ce.deltaY))),ce.direction=Yr,ft&&Xt>Ie.threshold&&Yr&Ie.direction},attrTest:function(ce){return Ja.prototype.attrTest.call(this,ce)&&(this.state&wr||!(this.state&wr)&&this.directionTest(ce))},emit:function(ce){this.pX=ce.deltaX,this.pY=ce.deltaY;var Ie=Qa(ce.direction);Ie&&(ce.additionalEvent=this.options.event+Ie),this._super.emit.call(this,ce)}});function jo(){Ja.apply(this,arguments)}sr(jo,Ja,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function(ce){return this._super.attrTest.call(this,ce)&&(Math.abs(ce.scale-1)>this.options.threshold||this.state&wr)},emit:function(ce){if(ce.scale!==1){var Ie=ce.scale<1?"in":"out";ce.additionalEvent=this.options.event+Ie}this._super.emit.call(this,ce)}});function Ko(){na.apply(this,arguments),this._timer=null,this._input=null}sr(Ko,na,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ua]},process:function(ce){var Ie=this.options,ft=ce.pointers.length===Ie.pointers,Xt=ce.distance<Ie.threshold,Yr=ce.deltaTime>Ie.time;if(this._input=ce,!Xt||!ft||ce.eventType&(_i|$n)&&!Yr)this.reset();else if(ce.eventType&Vi)this.reset(),this._timer=Nt(function(){this.state=Le,this.tryEmit()},Ie.time,this);else if(ce.eventType&_i)return Le;return is},reset:function(){clearTimeout(this._timer)},emit:function(ce){this.state===Le&&(ce&&ce.eventType&_i?this.manager.emit(this.options.event+"up",ce):(this._input.timeStamp=_r(),this.manager.emit(this.options.event,this._input)))}});function Su(){Ja.apply(this,arguments)}sr(Su,Ja,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function(ce){return this._super.attrTest.call(this,ce)&&(Math.abs(ce.rotation)>this.options.threshold||this.state&wr)}});function Ao(){Ja.apply(this,arguments)}sr(Ao,Ja,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:de|ae,pointers:1},getTouchAction:function(){return ca.prototype.getTouchAction.call(this)},attrTest:function(ce){var Ie=this.options.direction,ft;return Ie&(de|ae)?ft=ce.overallVelocity:Ie&de?ft=ce.overallVelocityX:Ie&ae&&(ft=ce.overallVelocityY),this._super.attrTest.call(this,ce)&&Ie&ce.offsetDirection&&ce.distance>this.options.threshold&&ce.maxPointers==this.options.pointers&&Dt(ft)>this.options.velocity&&ce.eventType&_i},emit:function(ce){var Ie=Qa(ce.offsetDirection);Ie&&this.manager.emit(this.options.event+Ie,ce),this.manager.emit(this.options.event,ce)}});function To(){na.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}sr(To,na,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vt]},process:function(ce){var Ie=this.options,ft=ce.pointers.length===Ie.pointers,Xt=ce.distance<Ie.threshold,Yr=ce.deltaTime<Ie.time;if(this.reset(),ce.eventType&Vi&&this.count===0)return this.failTimeout();if(Xt&&Yr&&ft){if(ce.eventType!=_i)return this.failTimeout();var jn=this.pTime?ce.timeStamp-this.pTime<Ie.interval:!0,Di=!this.pCenter||Kr(this.pCenter,ce.center)<Ie.posThreshold;this.pTime=ce.timeStamp,this.pCenter=ce.center,!Di||!jn?this.count=1:this.count+=1,this._input=ce;var so=this.count%Ie.taps;if(so===0)return this.hasRequireFailures()?(this._timer=Nt(function(){this.state=Le,this.tryEmit()},Ie.interval,this),wr):Le}return is},failTimeout:function(){return this._timer=Nt(function(){this.state=is},this.options.interval,this),is},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Le&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function fa(ce,Ie){return Ie=Ie||{},Ie.recognizers=jt(Ie.recognizers,fa.defaults.preset),new Wa(ce,Ie)}fa.VERSION="2.0.7",fa.defaults={domEvents:!1,touchAction:Pi,enable:!0,inputTarget:null,inputClass:null,preset:[[Su,{enable:!1}],[jo,{enable:!1},["rotate"]],[Ao,{direction:de}],[ca,{direction:de},["swipe"]],[To],[To,{event:"doubletap",taps:2},["tap"]],[Ko]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var eo=1,Go=2;function Wa(ce,Ie){this.options=Ft({},fa.defaults,Ie||{}),this.options.inputTarget=this.options.inputTarget||ce,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ce,this.input=Dr(this),this.touchAction=new Qi(this,this.options.touchAction),Ys(this,!0),Qt(this.options.recognizers,function(ft){var Xt=this.add(new ft[0](ft[1]));ft[2]&&Xt.recognizeWith(ft[2]),ft[3]&&Xt.requireFailure(ft[3])},this)}Wa.prototype={set:function(ce){return Ft(this.options,ce),ce.touchAction&&this.touchAction.update(),ce.inputTarget&&(this.input.destroy(),this.input.target=ce.inputTarget,this.input.init()),this},stop:function(ce){this.session.stopped=ce?Go:eo},recognize:function(ce){var Ie=this.session;if(!Ie.stopped){this.touchAction.preventDefaults(ce);var ft,Xt=this.recognizers,Yr=Ie.curRecognizer;(!Yr||Yr&&Yr.state&Le)&&(Yr=Ie.curRecognizer=null);for(var jn=0;jn<Xt.length;)ft=Xt[jn],Ie.stopped!==Go&&(!Yr||ft==Yr||ft.canRecognizeWith(Yr))?ft.recognize(ce):ft.reset(),!Yr&&ft.state&(wr|Ye|Ma)&&(Yr=Ie.curRecognizer=ft),jn++}},get:function(ce){if(ce instanceof na)return ce;for(var Ie=this.recognizers,ft=0;ft<Ie.length;ft++)if(Ie[ft].options.event==ce)return Ie[ft];return null},add:function(ce){if(gr(ce,"add",this))return this;var Ie=this.get(ce.options.event);return Ie&&this.remove(Ie),this.recognizers.push(ce),ce.manager=this,this.touchAction.update(),ce},remove:function(ce){if(gr(ce,"remove",this))return this;if(ce=this.get(ce),ce){var Ie=this.recognizers,ft=W(Ie,ce);ft!==-1&&(Ie.splice(ft,1),this.touchAction.update())}return this},on:function(ce,Ie){if(ce!==q&&Ie!==q){var ft=this.handlers;return Qt(He(ce),function(Xt){ft[Xt]=ft[Xt]||[],ft[Xt].push(Ie)}),this}},off:function(ce,Ie){if(ce!==q){var ft=this.handlers;return Qt(He(ce),function(Xt){Ie?ft[Xt]&&ft[Xt].splice(W(ft[Xt],Ie),1):delete ft[Xt]}),this}},emit:function(ce,Ie){this.options.domEvents&&Dl(ce,Ie);var ft=this.handlers[ce]&&this.handlers[ce].slice();if(!(!ft||!ft.length)){Ie.type=ce,Ie.preventDefault=function(){Ie.srcEvent.preventDefault()};for(var Xt=0;Xt<ft.length;)ft[Xt](Ie),Xt++}},destroy:function(){this.element&&Ys(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ys(ce,Ie){var ft=ce.element;if(!!ft.style){var Xt;Qt(ce.options.cssProps,function(Yr,jn){Xt=gt(ft.style,jn),Ie?(ce.oldCssProps[Xt]=ft.style[Xt],ft.style[Xt]=Yr):ft.style[Xt]=ce.oldCssProps[Xt]||""}),Ie||(ce.oldCssProps={})}}function Dl(ce,Ie){if(!Ke){var ft=y.createEvent("Event");ft.initEvent(ce,!0,!0),ft.gesture=Ie,Ie.target.dispatchEvent(ft)}}if(!Ke){Ft(fa,{INPUT_START:Vi,INPUT_MOVE:zi,INPUT_END:_i,INPUT_CANCEL:$n,STATE_POSSIBLE:pr,STATE_BEGAN:wr,STATE_CHANGED:Ye,STATE_ENDED:Ma,STATE_RECOGNIZED:Le,STATE_CANCELLED:ws,STATE_FAILED:is,DIRECTION_NONE:ii,DIRECTION_LEFT:Co,DIRECTION_RIGHT:Ba,DIRECTION_UP:ya,DIRECTION_DOWN:Et,DIRECTION_HORIZONTAL:de,DIRECTION_VERTICAL:ae,DIRECTION_ALL:xe,Manager:Wa,Input:Wt,TouchAction:Qi,TouchInput:er,MouseInput:ra,PointerEventInput:Ze,TouchMouseInput:Gt,SingleTouchInput:We,Recognizer:na,AttrRecognizer:Ja,Tap:To,Pan:ca,Swipe:Ao,Pinch:jo,Rotate:Su,Press:Ko,on:dt,off:lr,each:Qt,merge:ee,extend:xr,assign:Ft,inherit:sr,bindFn:Tt,prefixed:gt});var Qo=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Qo.Hammer=fa,De=function(){return fa}.call(me,se,me,Tn),De!==q&&(Tn.exports=De)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Tn,me,se){(function(De,he){Tn.exports=he(se(18857))})(this,function(De){"use strict";var he=function(Z){return Z instanceof Uint8Array||Z instanceof Uint16Array||Z instanceof Uint32Array||Z instanceof Int8Array||Z instanceof Int16Array||Z instanceof Int32Array||Z instanceof Float32Array||Z instanceof Float64Array||Z instanceof Uint8ClampedArray},y=function(Z,Ae){for(var $e=Object.keys(Ae),$t=0;$t<$e.length;++$t)Z[$e[$t]]=Ae[$e[$t]];return Z},Pe=`
`;function q(Z){return typeof atob!="undefined"?atob(Z):"base64:"+Z}function Ce(Z){var Ae=new Error("(regl) "+Z);throw console.error(Ae),Ae}function pe(Z,Ae){Z||Ce(Ae)}function Ke(Z){return Z?": "+Z:""}function Se(Z,Ae,$e){Z in Ae||Ce("unknown parameter ("+Z+")"+Ke($e)+". possible values: "+Object.keys(Ae).join())}function ot(Z,Ae){he(Z)||Ce("invalid parameter type"+Ke(Ae)+". must be a typed array")}function mt(Z,Ae){switch(Ae){case"number":return typeof Z=="number";case"object":return typeof Z=="object";case"string":return typeof Z=="string";case"boolean":return typeof Z=="boolean";case"function":return typeof Z=="function";case"undefined":return typeof Z=="undefined";case"symbol":return typeof Z=="symbol"}}function bt(Z,Ae,$e){mt(Z,Ae)||Ce("invalid parameter type"+Ke($e)+". expected "+Ae+", got "+typeof Z)}function Dt(Z,Ae){Z>=0&&(Z|0)===Z||Ce("invalid parameter type, ("+Z+")"+Ke(Ae)+". must be a nonnegative integer")}function _r(Z,Ae,$e){Ae.indexOf(Z)<0&&Ce("invalid value"+Ke($e)+". must be one of: "+Ae)}var Nt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function gr(Z){Object.keys(Z).forEach(function(Ae){Nt.indexOf(Ae)<0&&Ce('invalid regl constructor argument "'+Ae+'". must be one of '+Nt)})}function Qt(Z,Ae){for(Z=Z+"";Z.length<Ae;)Z=" "+Z;return Z}function Pt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ft(Z,Ae){this.number=Z,this.line=Ae,this.errors=[]}function xr(Z,Ae,$e){this.file=Z,this.line=Ae,this.message=$e}function ee(){var Z=new Error,Ae=(Z.stack||Z).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ae);if($e)return $e[1];var $t=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ae);return $t?$t[1]:"unknown"}function sr(){var Z=new Error,Ae=(Z.stack||Z).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ae);if($e)return $e[1];var $t=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ae);return $t?$t[1]:"unknown"}function Tt(Z,Ae){var $e=Z.split(`
`),$t=1,Cr=0,Yt={unknown:new Pt,0:new Pt};Yt.unknown.name=Yt[0].name=Ae||ee(),Yt.unknown.lines.push(new Ft(0,""));for(var vr=0;vr<$e.length;++vr){var Pr=$e[vr],Fr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Pr);if(Fr)switch(Fr[1]){case"line":var Nr=/(\d+)(\s+\d+)?/.exec(Fr[2]);Nr&&($t=Nr[1]|0,Nr[2]&&(Cr=Nr[2]|0,Cr in Yt||(Yt[Cr]=new Pt)));break;case"define":var Wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Fr[2]);Wr&&(Yt[Cr].name=Wr[1]?q(Wr[2]):Wr[2]);break}Yt[Cr].lines.push(new Ft($t++,Pr))}return Object.keys(Yt).forEach(function(Xr){var ln=Yt[Xr];ln.lines.forEach(function(zr){ln.index[zr.number]=zr})}),Yt}function ht(Z){var Ae=[];return Z.split(`
`).forEach(function($e){if(!($e.length<5)){var $t=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);$t?Ae.push(new xr($t[1]|0,$t[2]|0,$t[3].trim())):$e.length>0&&Ae.push(new xr("unknown",0,$e))}}),Ae}function jt(Z,Ae){Ae.forEach(function($e){var $t=Z[$e.file];if($t){var Cr=$t.index[$e.line];if(Cr){Cr.errors.push($e),$t.hasErrors=!0;return}}Z.unknown.hasErrors=!0,Z.unknown.lines[0].errors.push($e)})}function dt(Z,Ae,$e,$t,Cr){if(!Z.getShaderParameter(Ae,Z.COMPILE_STATUS)){var Yt=Z.getShaderInfoLog(Ae),vr=$t===Z.FRAGMENT_SHADER?"fragment":"vertex";Re($e,"string",vr+" shader source must be a string",Cr);var Pr=Tt($e,Cr),Fr=ht(Yt);jt(Pr,Fr),Object.keys(Pr).forEach(function(Nr){var Wr=Pr[Nr];if(!Wr.hasErrors)return;var Xr=[""],ln=[""];function zr(Gr,At){Xr.push(Gr),ln.push(At||"")}zr("file number "+Nr+": "+Wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Wr.lines.forEach(function(Gr){if(Gr.errors.length>0){zr(Qt(Gr.number,4)+"|  ","background-color:yellow; font-weight:bold"),zr(Gr.line+Pe,"color:red; background-color:yellow; font-weight:bold");var At=0;Gr.errors.forEach(function(ar){var Zr=ar.message,on=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Zr);if(on){var Mr=on[1];switch(Zr=on[2],Mr){case"assign":Mr="=";break}At=Math.max(Gr.line.indexOf(Mr,At),0)}else At=0;zr(Qt("| ",6)),zr(Qt("^^^",At+3)+Pe,"font-weight:bold"),zr(Qt("| ",6)),zr(Zr+Pe,"font-weight:bold")}),zr(Qt("| ",6)+Pe)}else zr(Qt(Gr.number,4)+"|  "),zr(Gr.line+Pe,"color:red")}),typeof document!="undefined"&&!window.chrome?(ln[0]=Xr.join("%c"),console.log.apply(console,ln)):console.log(Xr.join(""))}),pe.raise("Error compiling "+vr+" shader, "+Pr[0].name)}}function lr(Z,Ae,$e,$t,Cr){if(!Z.getProgramParameter(Ae,Z.LINK_STATUS)){var Yt=Z.getProgramInfoLog(Ae),vr=Tt($e,Cr),Pr=Tt($t,Cr),Fr='Error linking program with vertex shader, "'+Pr[0].name+'", and fragment shader "'+vr[0].name+'"';typeof document!="undefined"?console.log("%c"+Fr+Pe+"%c"+Yt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Fr+Pe+Yt),pe.raise(Fr)}}function jr(Z){Z._commandRef=ee()}function ue(Z,Ae,$e,$t){jr(Z);function Cr(Fr){return Fr?$t.id(Fr):0}Z._fragId=Cr(Z.static.frag),Z._vertId=Cr(Z.static.vert);function Yt(Fr,Nr){Object.keys(Nr).forEach(function(Wr){Fr[$t.id(Wr)]=!0})}var vr=Z._uniformSet={};Yt(vr,Ae.static),Yt(vr,Ae.dynamic);var Pr=Z._attributeSet={};Yt(Pr,$e.static),Yt(Pr,$e.dynamic),Z._hasCount="count"in Z.static||"count"in Z.dynamic||"elements"in Z.static||"elements"in Z.dynamic}function He(Z,Ae){var $e=sr();Ce(Z+" in command "+(Ae||ee())+($e==="unknown"?"":" called from "+$e))}function W(Z,Ae,$e){Z||He(Ae,$e||ee())}function Y(Z,Ae,$e,$t){Z in Ae||He("unknown parameter ("+Z+")"+Ke($e)+". possible values: "+Object.keys(Ae).join(),$t||ee())}function Re(Z,Ae,$e,$t){mt(Z,Ae)||He("invalid parameter type"+Ke($e)+". expected "+Ae+", got "+typeof Z,$t||ee())}function gt(Z){Z()}function wt(Z,Ae,$e){Z.texture?_r(Z.texture._texture.internalformat,Ae,"unsupported texture format for attachment"):_r(Z.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var qt=33071,fr=9728,br=9984,bn=9985,en=9986,Ci=9987,Wn=5120,Vn=5121,va=5122,Si=5123,ci=5124,Vi=5125,zi=5126,_i=32819,$n=32820,ii=33635,Co=34042,Ba=36193,ya={};ya[Wn]=ya[Vn]=1,ya[va]=ya[Si]=ya[Ba]=ya[ii]=ya[_i]=ya[$n]=2,ya[ci]=ya[Vi]=ya[zi]=ya[Co]=4;function Et(Z,Ae){return Z===$n||Z===_i||Z===ii?2:Z===Co?4:ya[Z]*Ae}function de(Z){return!(Z&Z-1)&&!!Z}function ae(Z,Ae,$e){var $t,Cr=Ae.width,Yt=Ae.height,vr=Ae.channels;pe(Cr>0&&Cr<=$e.maxTextureSize&&Yt>0&&Yt<=$e.maxTextureSize,"invalid texture shape"),(Z.wrapS!==qt||Z.wrapT!==qt)&&pe(de(Cr)&&de(Yt),"incompatible wrap mode for texture, both width and height must be power of 2"),Ae.mipmask===1?Cr!==1&&Yt!==1&&pe(Z.minFilter!==br&&Z.minFilter!==en&&Z.minFilter!==bn&&Z.minFilter!==Ci,"min filter requires mipmap"):(pe(de(Cr)&&de(Yt),"texture must be a square power of 2 to support mipmapping"),pe(Ae.mipmask===(Cr<<1)-1,"missing or incomplete mipmap data")),Ae.type===zi&&($e.extensions.indexOf("oes_texture_float_linear")<0&&pe(Z.minFilter===fr&&Z.magFilter===fr,"filter not supported, must enable oes_texture_float_linear"),pe(!Z.genMipmaps,"mipmap generation not supported with float textures"));var Pr=Ae.images;for($t=0;$t<16;++$t)if(Pr[$t]){var Fr=Cr>>$t,Nr=Yt>>$t;pe(Ae.mipmask&1<<$t,"missing mipmap data");var Wr=Pr[$t];if(pe(Wr.width===Fr&&Wr.height===Nr,"invalid shape for mip images"),pe(Wr.format===Ae.format&&Wr.internalformat===Ae.internalformat&&Wr.type===Ae.type,"incompatible type for mip image"),!Wr.compressed)if(Wr.data){var Xr=Math.ceil(Et(Wr.type,vr)*Fr/Wr.unpackAlignment)*Wr.unpackAlignment;pe(Wr.data.byteLength===Xr*Nr,"invalid data for image, buffer size is inconsistent with image format")}else Wr.element||Wr.copy}else Z.genMipmaps||pe((Ae.mipmask&1<<$t)==0,"extra mipmap data");Ae.compressed&&pe(!Z.genMipmaps,"mipmap generation for compressed images not supported")}function xe(Z,Ae,$e,$t){var Cr=Z.width,Yt=Z.height,vr=Z.channels;pe(Cr>0&&Cr<=$t.maxTextureSize&&Yt>0&&Yt<=$t.maxTextureSize,"invalid texture shape"),pe(Cr===Yt,"cube map must be square"),pe(Ae.wrapS===qt&&Ae.wrapT===qt,"wrap mode not supported by cube map");for(var Pr=0;Pr<$e.length;++Pr){var Fr=$e[Pr];pe(Fr.width===Cr&&Fr.height===Yt,"inconsistent cube map face shape"),Ae.genMipmaps&&(pe(!Fr.compressed,"can not generate mipmap for compressed textures"),pe(Fr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Nr=Fr.images,Wr=0;Wr<16;++Wr){var Xr=Nr[Wr];if(Xr){var ln=Cr>>Wr,zr=Yt>>Wr;pe(Fr.mipmask&1<<Wr,"missing mipmap data"),pe(Xr.width===ln&&Xr.height===zr,"invalid shape for mip images"),pe(Xr.format===Z.format&&Xr.internalformat===Z.internalformat&&Xr.type===Z.type,"incompatible type for mip image"),Xr.compressed||(Xr.data?pe(Xr.data.byteLength===ln*zr*Math.max(Et(Xr.type,vr),Xr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Xr.element||Xr.copy)}}}}var N=y(pe,{optional:gt,raise:Ce,commandRaise:He,command:W,parameter:Se,commandParameter:Y,constructor:gr,type:bt,commandType:Re,isTypedArray:ot,nni:Dt,oneOf:_r,shaderError:dt,linkError:lr,callSite:sr,saveCommandRef:jr,saveDrawInfo:ue,framebufferFormat:wt,guessCommand:ee,texture2D:ae,textureCube:xe}),Qe=0,Wt=0,Dr=5,qe=6;function kt(Z,Ae){this.id=Qe++,this.type=Z,this.data=Ae}function hr(Z){return Z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function kr(Z){if(Z.length===0)return[];var Ae=Z.charAt(0),$e=Z.charAt(Z.length-1);if(Z.length>1&&Ae===$e&&(Ae==='"'||Ae==="'"))return['"'+hr(Z.substr(1,Z.length-2))+'"'];var $t=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Z);if($t)return kr(Z.substr(0,$t.index)).concat(kr($t[1])).concat(kr(Z.substr($t.index+$t[0].length)));var Cr=Z.split(".");if(Cr.length===1)return['"'+hr(Z)+'"'];for(var Yt=[],vr=0;vr<Cr.length;++vr)Yt=Yt.concat(kr(Cr[vr]));return Yt}function Hr(Z){return"["+kr(Z).join("][")+"]"}function qr(Z,Ae){return new kt(Z,Hr(Ae+""))}function Hn(Z){return typeof Z=="function"&&!Z._reglType||Z instanceof kt}function Bn(Z,Ae){if(typeof Z=="function")return new kt(Wt,Z);if(typeof Z=="number"||typeof Z=="boolean")return new kt(Dr,Z);if(Array.isArray(Z))return new kt(qe,Z.map(function($e,$t){return Bn($e,Ae+"["+$t+"]")}));if(Z instanceof kt)return Z;N(!1,"invalid option type in uniform "+Ae)}var Kr={DynamicVariable:kt,define:qr,isDynamic:Hn,unbox:Bn,accessor:Hr},fi={next:typeof requestAnimationFrame=="function"?function(Z){return requestAnimationFrame(Z)}:function(Z){return setTimeout(Z,16)},cancel:typeof cancelAnimationFrame=="function"?function(Z){return cancelAnimationFrame(Z)}:clearTimeout},ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sa=ri?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function wa(){var Z={"":0},Ae=[""];return{id:function($e){var $t=Z[$e];return $t||($t=Z[$e]=Ae.length,Ae.push($e),$t)},str:function($e){return Ae[$e]}}}function Na(Z,Ae,$e){var $t=document.createElement("canvas");y($t.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),Z.appendChild($t),Z===document.body&&($t.style.position="absolute",y(Z.style,{margin:0,padding:0}));function Cr(){var Pr=window.innerWidth,Fr=window.innerHeight;if(Z!==document.body){var Nr=$t.getBoundingClientRect();Pr=Nr.right-Nr.left,Fr=Nr.bottom-Nr.top}$t.width=$e*Pr,$t.height=$e*Fr}var Yt;Z!==document.body&&typeof ResizeObserver=="function"?(Yt=new ResizeObserver(function(){setTimeout(Cr)}),Yt.observe(Z)):window.addEventListener("resize",Cr,!1);function vr(){Yt?Yt.disconnect():window.removeEventListener("resize",Cr),Z.removeChild($t)}return Cr(),{canvas:$t,onDestroy:vr}}function _a(Z,Ae){function $e($t){try{return Z.getContext($t,Ae)}catch(Cr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function ra(Z){return typeof Z.nodeName=="string"&&typeof Z.appendChild=="function"&&typeof Z.getBoundingClientRect=="function"}function K(Z){return typeof Z.drawArrays=="function"||typeof Z.drawElements=="function"}function re(Z){return typeof Z=="string"?Z.split():(N(Array.isArray(Z),"invalid extension array"),Z)}function fe(Z){return typeof Z=="string"?(N(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Z)):Z}function we(Z){var Ae=Z||{},$e,$t,Cr,Yt,vr={},Pr=[],Fr=[],Nr=typeof window=="undefined"?1:window.devicePixelRatio,Wr=!1,Xr=function(Gr){Gr&&N.raise(Gr)},ln=function(){};if(typeof Ae=="string"?(N(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(Ae),N($e,"invalid query string for element")):typeof Ae=="object"?ra(Ae)?$e=Ae:K(Ae)?(Yt=Ae,Cr=Yt.canvas):(N.constructor(Ae),"gl"in Ae?Yt=Ae.gl:"canvas"in Ae?Cr=fe(Ae.canvas):"container"in Ae&&($t=fe(Ae.container)),"attributes"in Ae&&(vr=Ae.attributes,N.type(vr,"object","invalid context attributes")),"extensions"in Ae&&(Pr=re(Ae.extensions)),"optionalExtensions"in Ae&&(Fr=re(Ae.optionalExtensions)),"onDone"in Ae&&(N.type(Ae.onDone,"function","invalid or missing onDone callback"),Xr=Ae.onDone),"profile"in Ae&&(Wr=!!Ae.profile),"pixelRatio"in Ae&&(Nr=+Ae.pixelRatio,N(Nr>0,"invalid pixel ratio"))):N.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?Cr=$e:$t=$e),!Yt){if(!Cr){N(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var zr=Na($t||document.body,Xr,Nr);if(!zr)return null;Cr=zr.canvas,ln=zr.onDestroy}vr.premultipliedAlpha===void 0&&(vr.premultipliedAlpha=!0),Yt=_a(Cr,vr)}return Yt?{gl:Yt,canvas:Cr,container:$t,extensions:Pr,optionalExtensions:Fr,pixelRatio:Nr,profile:Wr,onDone:Xr,onDestroy:ln}:(ln(),Xr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ze(Z,Ae){var $e={};function $t(Pr){N.type(Pr,"string","extension name must be string");var Fr=Pr.toLowerCase(),Nr;try{Nr=$e[Fr]=Cr(Pr)}catch(Wr){}return!!Nr}function Cr(Pr){return Z.getExtension(Pr)?Z.getExtension(Pr):Z.getExtension(Pr.toLowerCase())?Z.getExtension(Pr.toLowerCase()):null}for(var Yt=0;Yt<Ae.extensions.length;++Yt){var vr=Ae.extensions[Yt];if(!$t(vr))return Ae.onDestroy(),Ae.onDone('"'+vr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ae.optionalExtensions.forEach($t),{extensions:$e,restore:function(){Object.keys($e).forEach(function(Pr){if($e[Pr]&&!$t(Pr))throw new Error("(regl): error restoring extension "+Pr)})}}}function tt(Z,Ae){for(var $e=Array(Z),$t=0;$t<Z;++$t)$e[$t]=Ae($t);return $e}var pt=5120,_e=5121,We=5122,Bt=5123,Rr=5124,Kt=5125,er=5126;function Or(Z){for(var Ae=16;Ae<=1<<28;Ae*=16)if(Z<=Ae)return Ae;return 0}function On(Z){var Ae,$e;return Ae=(Z>65535)<<4,Z>>>=Ae,$e=(Z>255)<<3,Z>>>=$e,Ae|=$e,$e=(Z>15)<<2,Z>>>=$e,Ae|=$e,$e=(Z>3)<<1,Z>>>=$e,Ae|=$e,Ae|Z>>1}function Cn(){var Z=tt(8,function(){return[]});function Ae(Yt){var vr=Or(Yt),Pr=Z[On(vr)>>2];return Pr.length>0?Pr.pop():new ArrayBuffer(vr)}function $e(Yt){Z[On(Yt.byteLength)>>2].push(Yt)}function $t(Yt,vr){var Pr=null;switch(Yt){case pt:Pr=new Int8Array(Ae(vr),0,vr);break;case _e:Pr=new Uint8Array(Ae(vr),0,vr);break;case We:Pr=new Int16Array(Ae(2*vr),0,vr);break;case Bt:Pr=new Uint16Array(Ae(2*vr),0,vr);break;case Rr:Pr=new Int32Array(Ae(4*vr),0,vr);break;case Kt:Pr=new Uint32Array(Ae(4*vr),0,vr);break;case er:Pr=new Float32Array(Ae(4*vr),0,vr);break;default:return null}return Pr.length!==vr?Pr.subarray(0,vr):Pr}function Cr(Yt){$e(Yt.buffer)}return{alloc:Ae,free:$e,allocType:$t,freeType:Cr}}var Gt=Cn();Gt.zero=Cn();var En=3408,nr=3410,yt=3411,xi=3412,dn=3413,Pi=3414,ua=3415,vt=33901,_t=33902,Ii=3379,ui=3386,Ki=34921,Qi=36347,la=36348,Fi=35661,pr=35660,wr=34930,Ye=36349,Ma=34076,Le=34024,ws=7936,is=7937,na=7938,Bs=35724,Qa=34047,Ga=36063,Ja=34852,ca=3553,jo=34067,Ko=34069,Su=33984,Ao=6408,To=5126,fa=5121,eo=36160,Go=36053,Wa=36064,Ys=16384,Dl=function(Z,Ae){var $e=1;Ae.ext_texture_filter_anisotropic&&($e=Z.getParameter(Qa));var $t=1,Cr=1;Ae.webgl_draw_buffers&&($t=Z.getParameter(Ja),Cr=Z.getParameter(Ga));var Yt=!!Ae.oes_texture_float;if(Yt){var vr=Z.createTexture();Z.bindTexture(ca,vr),Z.texImage2D(ca,0,Ao,1,1,0,Ao,To,null);var Pr=Z.createFramebuffer();if(Z.bindFramebuffer(eo,Pr),Z.framebufferTexture2D(eo,Wa,ca,vr,0),Z.bindTexture(ca,null),Z.checkFramebufferStatus(eo)!==Go)Yt=!1;else{Z.viewport(0,0,1,1),Z.clearColor(1,0,0,1),Z.clear(Ys);var Fr=Gt.allocType(To,4);Z.readPixels(0,0,1,1,Ao,To,Fr),Z.getError()?Yt=!1:(Z.deleteFramebuffer(Pr),Z.deleteTexture(vr),Yt=Fr[0]===1),Gt.freeType(Fr)}}var Nr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Wr=!0;if(!Nr){var Xr=Z.createTexture(),ln=Gt.allocType(fa,36);Z.activeTexture(Su),Z.bindTexture(jo,Xr),Z.texImage2D(Ko,0,Ao,3,3,0,Ao,fa,ln),Gt.freeType(ln),Z.bindTexture(jo,null),Z.deleteTexture(Xr),Wr=!Z.getError()}return{colorBits:[Z.getParameter(nr),Z.getParameter(yt),Z.getParameter(xi),Z.getParameter(dn)],depthBits:Z.getParameter(Pi),stencilBits:Z.getParameter(ua),subpixelBits:Z.getParameter(En),extensions:Object.keys(Ae).filter(function(zr){return!!Ae[zr]}),maxAnisotropic:$e,maxDrawbuffers:$t,maxColorAttachments:Cr,pointSizeDims:Z.getParameter(vt),lineWidthDims:Z.getParameter(_t),maxViewportDims:Z.getParameter(ui),maxCombinedTextureUnits:Z.getParameter(Fi),maxCubeMapSize:Z.getParameter(Ma),maxRenderbufferSize:Z.getParameter(Le),maxTextureUnits:Z.getParameter(wr),maxTextureSize:Z.getParameter(Ii),maxAttributes:Z.getParameter(Ki),maxVertexUniforms:Z.getParameter(Qi),maxVertexTextureUnits:Z.getParameter(pr),maxVaryingVectors:Z.getParameter(la),maxFragmentUniforms:Z.getParameter(Ye),glsl:Z.getParameter(Bs),renderer:Z.getParameter(is),vendor:Z.getParameter(ws),version:Z.getParameter(na),readFloat:Yt,npotTextureCube:Wr}};function Qo(Z){return!!Z&&typeof Z=="object"&&Array.isArray(Z.shape)&&Array.isArray(Z.stride)&&typeof Z.offset=="number"&&Z.shape.length===Z.stride.length&&(Array.isArray(Z.data)||he(Z.data))}var ce=function(Z){return Object.keys(Z).map(function(Ae){return Z[Ae]})},Ie={shape:so,flatten:Di};function ft(Z,Ae,$e){for(var $t=0;$t<Ae;++$t)$e[$t]=Z[$t]}function Xt(Z,Ae,$e,$t){for(var Cr=0,Yt=0;Yt<Ae;++Yt)for(var vr=Z[Yt],Pr=0;Pr<$e;++Pr)$t[Cr++]=vr[Pr]}function Yr(Z,Ae,$e,$t,Cr,Yt){for(var vr=Yt,Pr=0;Pr<Ae;++Pr)for(var Fr=Z[Pr],Nr=0;Nr<$e;++Nr)for(var Wr=Fr[Nr],Xr=0;Xr<$t;++Xr)Cr[vr++]=Wr[Xr]}function jn(Z,Ae,$e,$t,Cr){for(var Yt=1,vr=$e+1;vr<Ae.length;++vr)Yt*=Ae[vr];var Pr=Ae[$e];if(Ae.length-$e==4){var Fr=Ae[$e+1],Nr=Ae[$e+2],Wr=Ae[$e+3];for(vr=0;vr<Pr;++vr)Yr(Z[vr],Fr,Nr,Wr,$t,Cr),Cr+=Yt}else for(vr=0;vr<Pr;++vr)jn(Z[vr],Ae,$e+1,$t,Cr),Cr+=Yt}function Di(Z,Ae,$e,$t){var Cr=1;if(Ae.length)for(var Yt=0;Yt<Ae.length;++Yt)Cr*=Ae[Yt];else Cr=0;var vr=$t||Gt.allocType($e,Cr);switch(Ae.length){case 0:break;case 1:ft(Z,Ae[0],vr);break;case 2:Xt(Z,Ae[0],Ae[1],vr);break;case 3:Yr(Z,Ae[0],Ae[1],Ae[2],vr,0);break;default:jn(Z,Ae,0,vr,0)}return vr}function so(Z){for(var Ae=[],$e=Z;$e.length;$e=$e[0])Ae.push($e.length);return Ae}var za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xa=5120,Jo=5122,Oo=5124,vo=5121,Cs=5123,As=5125,Ts=5126,qs=5126,hu={int8:Xa,int16:Jo,int32:Oo,uint8:vo,uint16:Cs,uint32:As,float:Ts,float32:qs},ds=35048,Zi=35040,Ia={dynamic:ds,stream:Zi,static:35044},Bc=Ie.flatten,hf=Ie.shape,Ms=35044,pf=35040,hl=5121,Qu=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function Bl(Z){return za[Object.prototype.toString.call(Z)]|0}function b(Z,Ae){for(var $e=0;$e<Ae.length;++$e)Z[$e]=Ae[$e]}function k(Z,Ae,$e,$t,Cr,Yt,vr){for(var Pr=0,Fr=0;Fr<$e;++Fr)for(var Nr=0;Nr<$t;++Nr)Z[Pr++]=Ae[Cr*Fr+Yt*Nr+vr]}function z(Z,Ae,$e,$t){var Cr=0,Yt={};function vr(At){this.id=Cr++,this.buffer=Z.createBuffer(),this.type=At,this.usage=Ms,this.byteLength=0,this.dimension=1,this.dtype=hl,this.persistentData=null,$e.profile&&(this.stats={size:0})}vr.prototype.bind=function(){Z.bindBuffer(this.type,this.buffer)},vr.prototype.destroy=function(){ln(this)};var Pr=[];function Fr(At,ar){var Zr=Pr.pop();return Zr||(Zr=new vr(At)),Zr.bind(),Xr(Zr,ar,pf,0,1,!1),Zr}function Nr(At){Pr.push(At)}function Wr(At,ar,Zr){At.byteLength=ar.byteLength,Z.bufferData(At.type,ar,Zr)}function Xr(At,ar,Zr,on,Mr,$r){var vn;if(At.usage=Zr,Array.isArray(ar)){if(At.dtype=on||Qu,ar.length>0){var Kn;if(Array.isArray(ar[0])){vn=hf(ar);for(var mr=1,Er=1;Er<vn.length;++Er)mr*=vn[Er];At.dimension=mr,Kn=Bc(ar,vn,At.dtype),Wr(At,Kn,Zr),$r?At.persistentData=Kn:Gt.freeType(Kn)}else if(typeof ar[0]=="number"){At.dimension=Mr;var Dn=Gt.allocType(At.dtype,ar.length);b(Dn,ar),Wr(At,Dn,Zr),$r?At.persistentData=Dn:Gt.freeType(Dn)}else he(ar[0])?(At.dimension=ar[0].length,At.dtype=on||Bl(ar[0])||Qu,Kn=Bc(ar,[ar.length,ar[0].length],At.dtype),Wr(At,Kn,Zr),$r?At.persistentData=Kn:Gt.freeType(Kn)):N.raise("invalid buffer data")}}else if(he(ar))At.dtype=on||Bl(ar),At.dimension=Mr,Wr(At,ar,Zr),$r&&(At.persistentData=new Uint8Array(new Uint8Array(ar.buffer)));else if(Qo(ar)){vn=ar.shape;var cn=ar.stride,Ur=ar.offset,pn=0,un=0,ki=0,di=0;vn.length===1?(pn=vn[0],un=1,ki=cn[0],di=0):vn.length===2?(pn=vn[0],un=vn[1],ki=cn[0],di=cn[1]):N.raise("invalid shape"),At.dtype=on||Bl(ar.data)||Qu,At.dimension=un;var fn=Gt.allocType(At.dtype,pn*un);k(fn,ar.data,pn,un,ki,di,Ur),Wr(At,fn,Zr),$r?At.persistentData=fn:Gt.freeType(fn)}else ar instanceof ArrayBuffer?(At.dtype=hl,At.dimension=Mr,Wr(At,ar,Zr),$r&&(At.persistentData=new Uint8Array(new Uint8Array(ar)))):N.raise("invalid buffer data")}function ln(At){Ae.bufferCount--,$t(At);var ar=At.buffer;N(ar,"buffer must not be deleted already"),Z.deleteBuffer(ar),At.buffer=null,delete Yt[At.id]}function zr(At,ar,Zr,on){Ae.bufferCount++;var Mr=new vr(ar);Yt[Mr.id]=Mr;function $r(mr){var Er=Ms,Dn=null,cn=0,Ur=0,pn=1;return Array.isArray(mr)||he(mr)||Qo(mr)||mr instanceof ArrayBuffer?Dn=mr:typeof mr=="number"?cn=mr|0:mr&&(N.type(mr,"object","buffer arguments must be an object, a number or an array"),"data"in mr&&(N(Dn===null||Array.isArray(Dn)||he(Dn)||Qo(Dn),"invalid data for buffer"),Dn=mr.data),"usage"in mr&&(N.parameter(mr.usage,Ia,"invalid buffer usage"),Er=Ia[mr.usage]),"type"in mr&&(N.parameter(mr.type,hu,"invalid buffer type"),Ur=hu[mr.type]),"dimension"in mr&&(N.type(mr.dimension,"number","invalid dimension"),pn=mr.dimension|0),"length"in mr&&(N.nni(cn,"buffer length must be a nonnegative integer"),cn=mr.length|0)),Mr.bind(),Dn?Xr(Mr,Dn,Er,Ur,pn,on):(cn&&Z.bufferData(Mr.type,cn,Er),Mr.dtype=Ur||hl,Mr.usage=Er,Mr.dimension=pn,Mr.byteLength=cn),$e.profile&&(Mr.stats.size=Mr.byteLength*Ks[Mr.dtype]),$r}function vn(mr,Er){N(Er+mr.byteLength<=Mr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+mr.byteLength+" starting from offset "+Er+" to a buffer of size "+Mr.byteLength),Z.bufferSubData(Mr.type,Er,mr)}function Kn(mr,Er){var Dn=(Er||0)|0,cn;if(Mr.bind(),he(mr)||mr instanceof ArrayBuffer)vn(mr,Dn);else if(Array.isArray(mr)){if(mr.length>0)if(typeof mr[0]=="number"){var Ur=Gt.allocType(Mr.dtype,mr.length);b(Ur,mr),vn(Ur,Dn),Gt.freeType(Ur)}else if(Array.isArray(mr[0])||he(mr[0])){cn=hf(mr);var pn=Bc(mr,cn,Mr.dtype);vn(pn,Dn),Gt.freeType(pn)}else N.raise("invalid buffer data")}else if(Qo(mr)){cn=mr.shape;var un=mr.stride,ki=0,di=0,fn=0,mn=0;cn.length===1?(ki=cn[0],di=1,fn=un[0],mn=0):cn.length===2?(ki=cn[0],di=cn[1],fn=un[0],mn=un[1]):N.raise("invalid shape");var li=Array.isArray(mr.data)?Mr.dtype:Bl(mr.data),bi=Gt.allocType(li,ki*di);k(bi,mr.data,ki,di,fn,mn,mr.offset),vn(bi,Dn),Gt.freeType(bi)}else N.raise("invalid data for buffer subdata");return $r}return Zr||$r(At),$r._reglType="buffer",$r._buffer=Mr,$r.subdata=Kn,$e.profile&&($r.stats=Mr.stats),$r.destroy=function(){ln(Mr)},$r}function Gr(){ce(Yt).forEach(function(At){At.buffer=Z.createBuffer(),Z.bindBuffer(At.type,At.buffer),Z.bufferData(At.type,At.persistentData||At.byteLength,At.usage)})}return $e.profile&&(Ae.getTotalBufferSize=function(){var At=0;return Object.keys(Yt).forEach(function(ar){At+=Yt[ar].stats.size}),At}),{create:zr,createStream:Fr,destroyStream:Nr,clear:function(){ce(Yt).forEach(ln),Pr.forEach(ln)},getBuffer:function(At){return At&&At._buffer instanceof vr?At._buffer:null},restore:Gr,_initBuffer:Xr}}var R=0,te=0,Me=1,st=1,Rt=4,Ot=4,yr={points:R,point:te,lines:Me,line:st,triangles:Rt,triangle:Ot,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Lr=0,Gn=1,Qn=4,pi=5120,$i=5121,Ca=5122,Ra=5123,Yi=5124,vs=5125,pu=34963,pl=35040,df=35044;function dl(Z,Ae,$e,$t){var Cr={},Yt=0,vr={uint8:$i,uint16:Ra};Ae.oes_element_index_uint&&(vr.uint32=vs);function Pr(Gr){this.id=Yt++,Cr[this.id]=this,this.buffer=Gr,this.primType=Qn,this.vertCount=0,this.type=0}Pr.prototype.bind=function(){this.buffer.bind()};var Fr=[];function Nr(Gr){var At=Fr.pop();return At||(At=new Pr($e.create(null,pu,!0,!1)._buffer)),Xr(At,Gr,pl,-1,-1,0,0),At}function Wr(Gr){Fr.push(Gr)}function Xr(Gr,At,ar,Zr,on,Mr,$r){Gr.buffer.bind();var vn;if(At){var Kn=$r;!$r&&(!he(At)||Qo(At)&&!he(At.data))&&(Kn=Ae.oes_element_index_uint?vs:Ra),$e._initBuffer(Gr.buffer,At,ar,Kn,3)}else Z.bufferData(pu,Mr,ar),Gr.buffer.dtype=vn||$i,Gr.buffer.usage=ar,Gr.buffer.dimension=3,Gr.buffer.byteLength=Mr;if(vn=$r,!$r){switch(Gr.buffer.dtype){case $i:case pi:vn=$i;break;case Ra:case Ca:vn=Ra;break;case vs:case Yi:vn=vs;break;default:N.raise("unsupported type for element array")}Gr.buffer.dtype=vn}Gr.type=vn,N(vn!==vs||!!Ae.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var mr=on;mr<0&&(mr=Gr.buffer.byteLength,vn===Ra?mr>>=1:vn===vs&&(mr>>=2)),Gr.vertCount=mr;var Er=Zr;if(Zr<0){Er=Qn;var Dn=Gr.buffer.dimension;Dn===1&&(Er=Lr),Dn===2&&(Er=Gn),Dn===3&&(Er=Qn)}Gr.primType=Er}function ln(Gr){$t.elementsCount--,N(Gr.buffer!==null,"must not double destroy elements"),delete Cr[Gr.id],Gr.buffer.destroy(),Gr.buffer=null}function zr(Gr,At){var ar=$e.create(null,pu,!0),Zr=new Pr(ar._buffer);$t.elementsCount++;function on(Mr){if(!Mr)ar(),Zr.primType=Qn,Zr.vertCount=0,Zr.type=$i;else if(typeof Mr=="number")ar(Mr),Zr.primType=Qn,Zr.vertCount=Mr|0,Zr.type=$i;else{var $r=null,vn=df,Kn=-1,mr=-1,Er=0,Dn=0;Array.isArray(Mr)||he(Mr)||Qo(Mr)?$r=Mr:(N.type(Mr,"object","invalid arguments for elements"),"data"in Mr&&($r=Mr.data,N(Array.isArray($r)||he($r)||Qo($r),"invalid data for element buffer")),"usage"in Mr&&(N.parameter(Mr.usage,Ia,"invalid element buffer usage"),vn=Ia[Mr.usage]),"primitive"in Mr&&(N.parameter(Mr.primitive,yr,"invalid element buffer primitive"),Kn=yr[Mr.primitive]),"count"in Mr&&(N(typeof Mr.count=="number"&&Mr.count>=0,"invalid vertex count for elements"),mr=Mr.count|0),"type"in Mr&&(N.parameter(Mr.type,vr,"invalid buffer type"),Dn=vr[Mr.type]),"length"in Mr?Er=Mr.length|0:(Er=mr,Dn===Ra||Dn===Ca?Er*=2:(Dn===vs||Dn===Yi)&&(Er*=4))),Xr(Zr,$r,vn,Kn,mr,Er,Dn)}return on}return on(Gr),on._reglType="elements",on._elements=Zr,on.subdata=function(Mr,$r){return ar.subdata(Mr,$r),on},on.destroy=function(){ln(Zr)},on}return{create:zr,createStream:Nr,destroyStream:Wr,getElements:function(Gr){return typeof Gr=="function"&&Gr._elements instanceof Pr?Gr._elements:null},clear:function(){ce(Cr).forEach(ln)}}}var Nc=new Float32Array(1),Nu=new Uint32Array(Nc.buffer),zu=5123;function Zu(Z){for(var Ae=Gt.allocType(zu,Z.length),$e=0;$e<Z.length;++$e)if(isNaN(Z[$e]))Ae[$e]=65535;else if(Z[$e]===Infinity)Ae[$e]=31744;else if(Z[$e]===-Infinity)Ae[$e]=64512;else{Nc[0]=Z[$e];var $t=Nu[0],Cr=$t>>>31<<15,Yt=($t<<1>>>24)-127,vr=$t>>13&(1<<10)-1;if(Yt<-24)Ae[$e]=Cr;else if(Yt<-14){var Pr=-14-Yt;Ae[$e]=Cr+(vr+(1<<10)>>Pr)}else Yt>15?Ae[$e]=Cr+31744:Ae[$e]=Cr+(Yt+15<<10)+vr}return Ae}function mo(Z){return Array.isArray(Z)||he(Z)}var Xf=function(Z){return!(Z&Z-1)&&!!Z},zc=34467,ms=3553,vf=34067,Ju=34069,Qs=6408,$f=6406,Ns=6407,ka=6409,Nl=6410,Ah=32854,Uu=32855,Zc=36194,up=32819,lp=32820,Yf=33635,Uc=34042,fc=6402,zl=34041,Zl=35904,vl=35906,ml=36193,gl=33776,Js=33777,mf=33778,gf=33779,Ul=35986,yl=35987,hc=34798,Vc=35840,pc=35841,yf=35842,cp=35843,_f=36196,_l=5121,xf=5123,qf=5125,Vu=5126,Th=10242,Mh=10243,kh=10497,Vl=33071,Ih=33648,es=10240,$a=10241,ha=9728,jl=9729,el=9984,Hi=9985,Oa=9986,Ps=9987,jc=33170,Ri=4352,gs=4353,wu=4354,Gl=34046,Gc=3317,dc=37440,Cu=37441,Ho=37443,vc=37444,Hl=33984,Mo=[el,Oa,Hi,Ps],Ln=[0,ka,Nl,Ns,Qs],uo={};uo[ka]=uo[$f]=uo[fc]=1,uo[zl]=uo[Nl]=2,uo[Ns]=uo[Zl]=3,uo[Qs]=uo[vl]=4;function La(Z){return"[object "+Z+"]"}var xl=La("HTMLCanvasElement"),eu=La("OffscreenCanvas"),zs=La("CanvasRenderingContext2D"),bf=La("ImageBitmap"),hn=La("HTMLImageElement"),mc=La("HTMLVideoElement"),bl=Object.keys(za).concat([xl,eu,zs,bf,hn,mc]),tl=[];tl[_l]=1,tl[Vu]=4,tl[ml]=2,tl[xf]=2,tl[qf]=4;var xa=[];xa[Ah]=2,xa[Uu]=2,xa[Zc]=2,xa[zl]=4,xa[gl]=.5,xa[Js]=.5,xa[mf]=1,xa[gf]=1,xa[Ul]=.5,xa[yl]=1,xa[hc]=1,xa[Vc]=.5,xa[pc]=.25,xa[yf]=.5,xa[cp]=.25,xa[_f]=.5;function Rs(Z){return Array.isArray(Z)&&(Z.length===0||typeof Z[0]=="number")}function Hc(Z){if(!Array.isArray(Z))return!1;var Ae=Z.length;return!(Ae===0||!mo(Z[0]))}function Au(Z){return Object.prototype.toString.call(Z)}function Os(Z){return Au(Z)===xl}function ju(Z){return Au(Z)===eu}function Ef(Z){return Au(Z)===zs}function Wl(Z){return Au(Z)===bf}function Kf(Z){return Au(Z)===hn}function Sf(Z){return Au(Z)===mc}function tu(Z){var Ae=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Ae&&Z&&Z.getContext)}function Zs(Z){var Ae=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Ae&&Z&&"src"in Z&&"crossOrigin"in Z)}function Oi(Z){if(!Z)return!1;if(tu(Z)||Zs(Z))return!0;var Ae=Au(Z);return bl.indexOf(Ae)>=0?!0:Rs(Z)||Hc(Z)||Qo(Z)}function ru(Z){return za[Object.prototype.toString.call(Z)]|0}function du(Z,Ae){var $e=Ae.length;switch(Z.type){case _l:case xf:case qf:case Vu:var $t=Gt.allocType(Z.type,$e);$t.set(Ae),Z.data=$t;break;case ml:Z.data=Zu(Ae);break;default:N.raise("unsupported texture type, must specify a typed array")}}function ts(Z,Ae){return Gt.allocType(Z.type===ml?Vu:Z.type,Ae)}function El(Z,Ae){Z.type===ml?(Z.data=Zu(Ae),Gt.freeType(Ae)):Z.data=Ae}function rl(Z,Ae,$e,$t,Cr,Yt){for(var vr=Z.width,Pr=Z.height,Fr=Z.channels,Nr=vr*Pr*Fr,Wr=ts(Z,Nr),Xr=0,ln=0;ln<Pr;++ln)for(var zr=0;zr<vr;++zr)for(var Gr=0;Gr<Fr;++Gr)Wr[Xr++]=Ae[$e*zr+$t*ln+Cr*Gr+Yt];El(Z,Wr)}function Us(Z,Ae,$e,$t,Cr,Yt){var vr;if(typeof xa[Z]!="undefined"?vr=xa[Z]:vr=uo[Z]*tl[Ae],Yt&&(vr*=6),Cr){for(var Pr=0,Fr=$e;Fr>=1;)Pr+=vr*Fr*Fr,Fr/=2;return Pr}else return vr*$e*$t}function as(Z,Ae,$e,$t,Cr,Yt,vr){var Pr={"don't care":Ri,"dont care":Ri,nice:wu,fast:gs},Fr={repeat:kh,clamp:Vl,mirror:Ih},Nr={nearest:ha,linear:jl},Wr=y({mipmap:Ps,"nearest mipmap nearest":el,"linear mipmap nearest":Hi,"nearest mipmap linear":Oa,"linear mipmap linear":Ps},Nr),Xr={none:0,browser:vc},ln={uint8:_l,rgba4:up,rgb565:Yf,"rgb5 a1":lp},zr={alpha:$f,luminance:ka,"luminance alpha":Nl,rgb:Ns,rgba:Qs,rgba4:Ah,"rgb5 a1":Uu,rgb565:Zc},Gr={};Ae.ext_srgb&&(zr.srgb=Zl,zr.srgba=vl),Ae.oes_texture_float&&(ln.float32=ln.float=Vu),Ae.oes_texture_half_float&&(ln.float16=ln["half float"]=ml),Ae.webgl_depth_texture&&(y(zr,{depth:fc,"depth stencil":zl}),y(ln,{uint16:xf,uint32:qf,"depth stencil":Uc})),Ae.webgl_compressed_texture_s3tc&&y(Gr,{"rgb s3tc dxt1":gl,"rgba s3tc dxt1":Js,"rgba s3tc dxt3":mf,"rgba s3tc dxt5":gf}),Ae.webgl_compressed_texture_atc&&y(Gr,{"rgb atc":Ul,"rgba atc explicit alpha":yl,"rgba atc interpolated alpha":hc}),Ae.webgl_compressed_texture_pvrtc&&y(Gr,{"rgb pvrtc 4bppv1":Vc,"rgb pvrtc 2bppv1":pc,"rgba pvrtc 4bppv1":yf,"rgba pvrtc 2bppv1":cp}),Ae.webgl_compressed_texture_etc1&&(Gr["rgb etc1"]=_f);var At=Array.prototype.slice.call(Z.getParameter(zc)||new Uint32Array(0));Object.keys(Gr).forEach(function(ze){var Jt=Gr[ze];At.indexOf(Jt)>=0&&(zr[ze]=Jt)});var ar=Object.keys(zr);$e.textureFormats=ar;var Zr=[];Object.keys(zr).forEach(function(ze){var Jt=zr[ze];Zr[Jt]=ze});var on=[];Object.keys(ln).forEach(function(ze){var Jt=ln[ze];on[Jt]=ze});var Mr=[];Object.keys(Nr).forEach(function(ze){var Jt=Nr[ze];Mr[Jt]=ze});var $r=[];Object.keys(Wr).forEach(function(ze){var Jt=Wr[ze];$r[Jt]=ze});var vn=[];Object.keys(Fr).forEach(function(ze){var Jt=Fr[ze];vn[Jt]=ze});var Kn=ar.reduce(function(ze,Jt){var Zt=zr[Jt];return Zt===ka||Zt===$f||Zt===ka||Zt===Nl||Zt===fc||Zt===zl||Ae.ext_srgb&&(Zt===Zl||Zt===vl)?ze[Zt]=Zt:Zt===Uu||Jt.indexOf("rgba")>=0?ze[Zt]=Qs:ze[Zt]=Ns,ze},{});function mr(){this.internalformat=Qs,this.format=Qs,this.type=_l,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=vc,this.width=0,this.height=0,this.channels=0}function Er(ze,Jt){ze.internalformat=Jt.internalformat,ze.format=Jt.format,ze.type=Jt.type,ze.compressed=Jt.compressed,ze.premultiplyAlpha=Jt.premultiplyAlpha,ze.flipY=Jt.flipY,ze.unpackAlignment=Jt.unpackAlignment,ze.colorSpace=Jt.colorSpace,ze.width=Jt.width,ze.height=Jt.height,ze.channels=Jt.channels}function Dn(ze,Jt){if(!(typeof Jt!="object"||!Jt)){if("premultiplyAlpha"in Jt&&(N.type(Jt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),ze.premultiplyAlpha=Jt.premultiplyAlpha),"flipY"in Jt&&(N.type(Jt.flipY,"boolean","invalid texture flip"),ze.flipY=Jt.flipY),"alignment"in Jt&&(N.oneOf(Jt.alignment,[1,2,4,8],"invalid texture unpack alignment"),ze.unpackAlignment=Jt.alignment),"colorSpace"in Jt&&(N.parameter(Jt.colorSpace,Xr,"invalid colorSpace"),ze.colorSpace=Xr[Jt.colorSpace]),"type"in Jt){var Zt=Jt.type;N(Ae.oes_texture_float||!(Zt==="float"||Zt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),N(Ae.oes_texture_half_float||!(Zt==="half float"||Zt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),N(Ae.webgl_depth_texture||!(Zt==="uint16"||Zt==="uint32"||Zt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(Zt,ln,"invalid texture type"),ze.type=ln[Zt]}var Mn=ze.width,Wi=ze.height,Oe=ze.channels,ge=!1;"shape"in Jt?(N(Array.isArray(Jt.shape)&&Jt.shape.length>=2,"shape must be an array"),Mn=Jt.shape[0],Wi=Jt.shape[1],Jt.shape.length===3&&(Oe=Jt.shape[2],N(Oe>0&&Oe<=4,"invalid number of channels"),ge=!0),N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid width"),N(Wi>=0&&Wi<=$e.maxTextureSize,"invalid height")):("radius"in Jt&&(Mn=Wi=Jt.radius,N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid radius")),"width"in Jt&&(Mn=Jt.width,N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid width")),"height"in Jt&&(Wi=Jt.height,N(Wi>=0&&Wi<=$e.maxTextureSize,"invalid height")),"channels"in Jt&&(Oe=Jt.channels,N(Oe>0&&Oe<=4,"invalid number of channels"),ge=!0)),ze.width=Mn|0,ze.height=Wi|0,ze.channels=Oe|0;var it=!1;if("format"in Jt){var It=Jt.format;N(Ae.webgl_depth_texture||!(It==="depth"||It==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(It,zr,"invalid texture format");var Ht=ze.internalformat=zr[It];ze.format=Kn[Ht],It in ln&&("type"in Jt||(ze.type=ln[It])),It in Gr&&(ze.compressed=!0),it=!0}!ge&&it?ze.channels=uo[ze.format]:ge&&!it?ze.channels!==Ln[ze.format]&&(ze.format=ze.internalformat=Ln[ze.channels]):it&&ge&&N(ze.channels===uo[ze.format],"number of channels inconsistent with specified format")}}function cn(ze){Z.pixelStorei(dc,ze.flipY),Z.pixelStorei(Cu,ze.premultiplyAlpha),Z.pixelStorei(Ho,ze.colorSpace),Z.pixelStorei(Gc,ze.unpackAlignment)}function Ur(){mr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function pn(ze,Jt){var Zt=null;if(Oi(Jt)?Zt=Jt:Jt&&(N.type(Jt,"object","invalid pixel data type"),Dn(ze,Jt),"x"in Jt&&(ze.xOffset=Jt.x|0),"y"in Jt&&(ze.yOffset=Jt.y|0),Oi(Jt.data)&&(Zt=Jt.data)),N(!ze.compressed||Zt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Jt.copy){N(!Zt,"can not specify copy and data field for the same texture");var Mn=Cr.viewportWidth,Wi=Cr.viewportHeight;ze.width=ze.width||Mn-ze.xOffset,ze.height=ze.height||Wi-ze.yOffset,ze.needsCopy=!0,N(ze.xOffset>=0&&ze.xOffset<Mn&&ze.yOffset>=0&&ze.yOffset<Wi&&ze.width>0&&ze.width<=Mn&&ze.height>0&&ze.height<=Wi,"copy texture read out of bounds")}else if(!Zt)ze.width=ze.width||1,ze.height=ze.height||1,ze.channels=ze.channels||4;else if(he(Zt))ze.channels=ze.channels||4,ze.data=Zt,!("type"in Jt)&&ze.type===_l&&(ze.type=ru(Zt));else if(Rs(Zt))ze.channels=ze.channels||4,du(ze,Zt),ze.alignment=1,ze.needsFree=!0;else if(Qo(Zt)){var Oe=Zt.data;!Array.isArray(Oe)&&ze.type===_l&&(ze.type=ru(Oe));var ge=Zt.shape,it=Zt.stride,It,Ht,ct,Xe,xt,Te;ge.length===3?(ct=ge[2],Te=it[2]):(N(ge.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ct=1,Te=1),It=ge[0],Ht=ge[1],Xe=it[0],xt=it[1],ze.alignment=1,ze.width=It,ze.height=Ht,ze.channels=ct,ze.format=ze.internalformat=Ln[ct],ze.needsFree=!0,rl(ze,Oe,Xe,xt,Te,Zt.offset)}else if(tu(Zt)||Os(Zt)||ju(Zt)||Ef(Zt))tu(Zt)||Os(Zt)||ju(Zt)?ze.element=Zt:ze.element=Zt.canvas,ze.width=ze.element.width,ze.height=ze.element.height,ze.channels=4;else if(Wl(Zt))ze.element=Zt,ze.width=Zt.width,ze.height=Zt.height,ze.channels=4;else if(Kf(Zt))ze.element=Zt,ze.width=Zt.naturalWidth,ze.height=Zt.naturalHeight,ze.channels=4;else if(Zs(Zt))ze.element=Zt,ze.width=Zt.width,ze.height=Zt.height,ze.channels=4;else if(Sf(Zt))ze.element=Zt,ze.width=Zt.videoWidth,ze.height=Zt.videoHeight,ze.channels=4;else if(Hc(Zt)){var et=ze.width||Zt[0].length,Be=ze.height||Zt.length,Mt=ze.channels;mo(Zt[0][0])?Mt=Mt||Zt[0][0].length:Mt=Mt||1;for(var Ut=Ie.shape(Zt),Ir=1,nn=0;nn<Ut.length;++nn)Ir*=Ut[nn];var an=ts(ze,Ir);Ie.flatten(Zt,Ut,"",an),El(ze,an),ze.alignment=1,ze.width=et,ze.height=Be,ze.channels=Mt,ze.format=ze.internalformat=Ln[Mt],ze.needsFree=!0}ze.type===Vu?N($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):ze.type===ml&&N($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function un(ze,Jt,Zt){var Mn=ze.element,Wi=ze.data,Oe=ze.internalformat,ge=ze.format,it=ze.type,It=ze.width,Ht=ze.height;cn(ze),Mn?Z.texImage2D(Jt,Zt,ge,ge,it,Mn):ze.compressed?Z.compressedTexImage2D(Jt,Zt,Oe,It,Ht,0,Wi):ze.needsCopy?($t(),Z.copyTexImage2D(Jt,Zt,ge,ze.xOffset,ze.yOffset,It,Ht,0)):Z.texImage2D(Jt,Zt,ge,It,Ht,0,ge,it,Wi||null)}function ki(ze,Jt,Zt,Mn,Wi){var Oe=ze.element,ge=ze.data,it=ze.internalformat,It=ze.format,Ht=ze.type,ct=ze.width,Xe=ze.height;cn(ze),Oe?Z.texSubImage2D(Jt,Wi,Zt,Mn,It,Ht,Oe):ze.compressed?Z.compressedTexSubImage2D(Jt,Wi,Zt,Mn,it,ct,Xe,ge):ze.needsCopy?($t(),Z.copyTexSubImage2D(Jt,Wi,Zt,Mn,ze.xOffset,ze.yOffset,ct,Xe)):Z.texSubImage2D(Jt,Wi,Zt,Mn,ct,Xe,It,Ht,ge)}var di=[];function fn(){return di.pop()||new Ur}function mn(ze){ze.needsFree&&Gt.freeType(ze.data),Ur.call(ze),di.push(ze)}function li(){mr.call(this),this.genMipmaps=!1,this.mipmapHint=Ri,this.mipmask=0,this.images=Array(16)}function bi(ze,Jt,Zt){var Mn=ze.images[0]=fn();ze.mipmask=1,Mn.width=ze.width=Jt,Mn.height=ze.height=Zt,Mn.channels=ze.channels=4}function Ui(ze,Jt){var Zt=null;if(Oi(Jt))Zt=ze.images[0]=fn(),Er(Zt,ze),pn(Zt,Jt),ze.mipmask=1;else if(Dn(ze,Jt),Array.isArray(Jt.mipmap))for(var Mn=Jt.mipmap,Wi=0;Wi<Mn.length;++Wi)Zt=ze.images[Wi]=fn(),Er(Zt,ze),Zt.width>>=Wi,Zt.height>>=Wi,pn(Zt,Mn[Wi]),ze.mipmask|=1<<Wi;else Zt=ze.images[0]=fn(),Er(Zt,ze),pn(Zt,Jt),ze.mipmask=1;Er(ze,ze.images[0]),ze.compressed&&(ze.internalformat===gl||ze.internalformat===Js||ze.internalformat===mf||ze.internalformat===gf)&&N(ze.width%4==0&&ze.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ro(ze,Jt){for(var Zt=ze.images,Mn=0;Mn<Zt.length;++Mn){if(!Zt[Mn])return;un(Zt[Mn],Jt,Mn)}}var co=[];function Ti(){var ze=co.pop()||new li;mr.call(ze),ze.mipmask=0;for(var Jt=0;Jt<16;++Jt)ze.images[Jt]=null;return ze}function ls(ze){for(var Jt=ze.images,Zt=0;Zt<Jt.length;++Zt)Jt[Zt]&&mn(Jt[Zt]),Jt[Zt]=null;co.push(ze)}function Ha(){this.minFilter=ha,this.magFilter=ha,this.wrapS=Vl,this.wrapT=Vl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ri}function Wo(ze,Jt){if("min"in Jt){var Zt=Jt.min;N.parameter(Zt,Wr),ze.minFilter=Wr[Zt],Mo.indexOf(ze.minFilter)>=0&&!("faces"in Jt)&&(ze.genMipmaps=!0)}if("mag"in Jt){var Mn=Jt.mag;N.parameter(Mn,Nr),ze.magFilter=Nr[Mn]}var Wi=ze.wrapS,Oe=ze.wrapT;if("wrap"in Jt){var ge=Jt.wrap;typeof ge=="string"?(N.parameter(ge,Fr),Wi=Oe=Fr[ge]):Array.isArray(ge)&&(N.parameter(ge[0],Fr),N.parameter(ge[1],Fr),Wi=Fr[ge[0]],Oe=Fr[ge[1]])}else{if("wrapS"in Jt){var it=Jt.wrapS;N.parameter(it,Fr),Wi=Fr[it]}if("wrapT"in Jt){var It=Jt.wrapT;N.parameter(It,Fr),Oe=Fr[It]}}if(ze.wrapS=Wi,ze.wrapT=Oe,"anisotropic"in Jt){var Ht=Jt.anisotropic;N(typeof Ht=="number"&&Ht>=1&&Ht<=$e.maxAnisotropic,"aniso samples must be between 1 and "),ze.anisotropic=Jt.anisotropic}if("mipmap"in Jt){var ct=!1;switch(typeof Jt.mipmap){case"string":N.parameter(Jt.mipmap,Pr,"invalid mipmap hint"),ze.mipmapHint=Pr[Jt.mipmap],ze.genMipmaps=!0,ct=!0;break;case"boolean":ct=ze.genMipmaps=Jt.mipmap;break;case"object":N(Array.isArray(Jt.mipmap),"invalid mipmap type"),ze.genMipmaps=!1,ct=!0;break;default:N.raise("invalid mipmap type")}ct&&!("min"in Jt)&&(ze.minFilter=el)}}function yo(ze,Jt){Z.texParameteri(Jt,$a,ze.minFilter),Z.texParameteri(Jt,es,ze.magFilter),Z.texParameteri(Jt,Th,ze.wrapS),Z.texParameteri(Jt,Mh,ze.wrapT),Ae.ext_texture_filter_anisotropic&&Z.texParameteri(Jt,Gl,ze.anisotropic),ze.genMipmaps&&(Z.hint(jc,ze.mipmapHint),Z.generateMipmap(Jt))}var zo=0,Xo={},xs=$e.maxTextureUnits,_o=Array(xs).map(function(){return null});function Mi(ze){mr.call(this),this.mipmask=0,this.internalformat=Qs,this.id=zo++,this.refCount=1,this.target=ze,this.texture=Z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ha,vr.profile&&(this.stats={size:0})}function Io(ze){Z.activeTexture(Hl),Z.bindTexture(ze.target,ze.texture)}function ia(){var ze=_o[0];ze?Z.bindTexture(ze.target,ze.texture):Z.bindTexture(ms,null)}function ns(ze){var Jt=ze.texture;N(Jt,"must not double destroy texture");var Zt=ze.unit,Mn=ze.target;Zt>=0&&(Z.activeTexture(Hl+Zt),Z.bindTexture(Mn,null),_o[Zt]=null),Z.deleteTexture(Jt),ze.texture=null,ze.params=null,ze.pixels=null,ze.refCount=0,delete Xo[ze.id],Yt.textureCount--}y(Mi.prototype,{bind:function(){var ze=this;ze.bindCount+=1;var Jt=ze.unit;if(Jt<0){for(var Zt=0;Zt<xs;++Zt){var Mn=_o[Zt];if(Mn){if(Mn.bindCount>0)continue;Mn.unit=-1}_o[Zt]=ze,Jt=Zt;break}Jt>=xs&&N.raise("insufficient number of texture units"),vr.profile&&Yt.maxTextureUnits<Jt+1&&(Yt.maxTextureUnits=Jt+1),ze.unit=Jt,Z.activeTexture(Hl+Jt),Z.bindTexture(ze.target,ze.texture)}return Jt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ns(this)}});function gi(ze,Jt){var Zt=new Mi(ms);Xo[Zt.id]=Zt,Yt.textureCount++;function Mn(ge,it){var It=Zt.texInfo;Ha.call(It);var Ht=Ti();return typeof ge=="number"?typeof it=="number"?bi(Ht,ge|0,it|0):bi(Ht,ge|0,ge|0):ge?(N.type(ge,"object","invalid arguments to regl.texture"),Wo(It,ge),Ui(Ht,ge)):bi(Ht,1,1),It.genMipmaps&&(Ht.mipmask=(Ht.width<<1)-1),Zt.mipmask=Ht.mipmask,Er(Zt,Ht),N.texture2D(It,Ht,$e),Zt.internalformat=Ht.internalformat,Mn.width=Ht.width,Mn.height=Ht.height,Io(Zt),ro(Ht,ms),yo(It,ms),ia(),ls(Ht),vr.profile&&(Zt.stats.size=Us(Zt.internalformat,Zt.type,Ht.width,Ht.height,It.genMipmaps,!1)),Mn.format=Zr[Zt.internalformat],Mn.type=on[Zt.type],Mn.mag=Mr[It.magFilter],Mn.min=$r[It.minFilter],Mn.wrapS=vn[It.wrapS],Mn.wrapT=vn[It.wrapT],Mn}function Wi(ge,it,It,Ht){N(!!ge,"must specify image data");var ct=it|0,Xe=It|0,xt=Ht|0,Te=fn();return Er(Te,Zt),Te.width=0,Te.height=0,pn(Te,ge),Te.width=Te.width||(Zt.width>>xt)-ct,Te.height=Te.height||(Zt.height>>xt)-Xe,N(Zt.type===Te.type&&Zt.format===Te.format&&Zt.internalformat===Te.internalformat,"incompatible format for texture.subimage"),N(ct>=0&&Xe>=0&&ct+Te.width<=Zt.width&&Xe+Te.height<=Zt.height,"texture.subimage write out of bounds"),N(Zt.mipmask&1<<xt,"missing mipmap data"),N(Te.data||Te.element||Te.needsCopy,"missing image data"),Io(Zt),ki(Te,ms,ct,Xe,xt),ia(),mn(Te),Mn}function Oe(ge,it){var It=ge|0,Ht=it|0||It;if(It===Zt.width&&Ht===Zt.height)return Mn;Mn.width=Zt.width=It,Mn.height=Zt.height=Ht,Io(Zt);for(var ct=0;Zt.mipmask>>ct;++ct){var Xe=It>>ct,xt=Ht>>ct;if(!Xe||!xt)break;Z.texImage2D(ms,ct,Zt.format,Xe,xt,0,Zt.format,Zt.type,null)}return ia(),vr.profile&&(Zt.stats.size=Us(Zt.internalformat,Zt.type,It,Ht,!1,!1)),Mn}return Mn(ze,Jt),Mn.subimage=Wi,Mn.resize=Oe,Mn._reglType="texture2d",Mn._texture=Zt,vr.profile&&(Mn.stats=Zt.stats),Mn.destroy=function(){Zt.decRef()},Mn}function Gi(ze,Jt,Zt,Mn,Wi,Oe){var ge=new Mi(vf);Xo[ge.id]=ge,Yt.cubeCount++;var it=new Array(6);function It(Xe,xt,Te,et,Be,Mt){var Ut,Ir=ge.texInfo;for(Ha.call(Ir),Ut=0;Ut<6;++Ut)it[Ut]=Ti();if(typeof Xe=="number"||!Xe){var nn=Xe|0||1;for(Ut=0;Ut<6;++Ut)bi(it[Ut],nn,nn)}else if(typeof Xe=="object")if(xt)Ui(it[0],Xe),Ui(it[1],xt),Ui(it[2],Te),Ui(it[3],et),Ui(it[4],Be),Ui(it[5],Mt);else if(Wo(Ir,Xe),Dn(ge,Xe),"faces"in Xe){var an=Xe.faces;for(N(Array.isArray(an)&&an.length===6,"cube faces must be a length 6 array"),Ut=0;Ut<6;++Ut)N(typeof an[Ut]=="object"&&!!an[Ut],"invalid input for cube map face"),Er(it[Ut],ge),Ui(it[Ut],an[Ut])}else for(Ut=0;Ut<6;++Ut)Ui(it[Ut],Xe);else N.raise("invalid arguments to cube map");for(Er(ge,it[0]),N.optional(function(){$e.npotTextureCube||N(Xf(ge.width)&&Xf(ge.height),"your browser does not support non power or two texture dimensions")}),Ir.genMipmaps?ge.mipmask=(it[0].width<<1)-1:ge.mipmask=it[0].mipmask,N.textureCube(ge,Ir,it,$e),ge.internalformat=it[0].internalformat,It.width=it[0].width,It.height=it[0].height,Io(ge),Ut=0;Ut<6;++Ut)ro(it[Ut],Ju+Ut);for(yo(Ir,vf),ia(),vr.profile&&(ge.stats.size=Us(ge.internalformat,ge.type,It.width,It.height,Ir.genMipmaps,!0)),It.format=Zr[ge.internalformat],It.type=on[ge.type],It.mag=Mr[Ir.magFilter],It.min=$r[Ir.minFilter],It.wrapS=vn[Ir.wrapS],It.wrapT=vn[Ir.wrapT],Ut=0;Ut<6;++Ut)ls(it[Ut]);return It}function Ht(Xe,xt,Te,et,Be){N(!!xt,"must specify image data"),N(typeof Xe=="number"&&Xe===(Xe|0)&&Xe>=0&&Xe<6,"invalid face");var Mt=Te|0,Ut=et|0,Ir=Be|0,nn=fn();return Er(nn,ge),nn.width=0,nn.height=0,pn(nn,xt),nn.width=nn.width||(ge.width>>Ir)-Mt,nn.height=nn.height||(ge.height>>Ir)-Ut,N(ge.type===nn.type&&ge.format===nn.format&&ge.internalformat===nn.internalformat,"incompatible format for texture.subimage"),N(Mt>=0&&Ut>=0&&Mt+nn.width<=ge.width&&Ut+nn.height<=ge.height,"texture.subimage write out of bounds"),N(ge.mipmask&1<<Ir,"missing mipmap data"),N(nn.data||nn.element||nn.needsCopy,"missing image data"),Io(ge),ki(nn,Ju+Xe,Mt,Ut,Ir),ia(),mn(nn),It}function ct(Xe){var xt=Xe|0;if(xt!==ge.width){It.width=ge.width=xt,It.height=ge.height=xt,Io(ge);for(var Te=0;Te<6;++Te)for(var et=0;ge.mipmask>>et;++et)Z.texImage2D(Ju+Te,et,ge.format,xt>>et,xt>>et,0,ge.format,ge.type,null);return ia(),vr.profile&&(ge.stats.size=Us(ge.internalformat,ge.type,It.width,It.height,!1,!0)),It}}return It(ze,Jt,Zt,Mn,Wi,Oe),It.subimage=Ht,It.resize=ct,It._reglType="textureCube",It._texture=ge,vr.profile&&(It.stats=ge.stats),It.destroy=function(){ge.decRef()},It}function pa(){for(var ze=0;ze<xs;++ze)Z.activeTexture(Hl+ze),Z.bindTexture(ms,null),_o[ze]=null;ce(Xo).forEach(ns),Yt.cubeCount=0,Yt.textureCount=0}vr.profile&&(Yt.getTotalTextureSize=function(){var ze=0;return Object.keys(Xo).forEach(function(Jt){ze+=Xo[Jt].stats.size}),ze});function Po(){for(var ze=0;ze<xs;++ze){var Jt=_o[ze];Jt&&(Jt.bindCount=0,Jt.unit=-1,_o[ze]=null)}ce(Xo).forEach(function(Zt){Zt.texture=Z.createTexture(),Z.bindTexture(Zt.target,Zt.texture);for(var Mn=0;Mn<32;++Mn)if((Zt.mipmask&1<<Mn)!=0)if(Zt.target===ms)Z.texImage2D(ms,Mn,Zt.internalformat,Zt.width>>Mn,Zt.height>>Mn,0,Zt.internalformat,Zt.type,null);else for(var Wi=0;Wi<6;++Wi)Z.texImage2D(Ju+Wi,Mn,Zt.internalformat,Zt.width>>Mn,Zt.height>>Mn,0,Zt.internalformat,Zt.type,null);yo(Zt.texInfo,Zt.target)})}function Il(){for(var ze=0;ze<xs;++ze){var Jt=_o[ze];Jt&&(Jt.bindCount=0,Jt.unit=-1,_o[ze]=null),Z.activeTexture(Hl+ze),Z.bindTexture(ms,null),Z.bindTexture(vf,null)}}return{create2D:gi,createCube:Gi,clear:pa,getTexture:function(ze){return null},restore:Po,refresh:Il}}var vu=36161,Xn=32854,Un=32855,wf=36194,os=33189,mu=36168,rs=34041,nu=35907,gc=34836,Xl=34842,ba=34843,Pa=[];Pa[Xn]=2,Pa[Un]=2,Pa[wf]=2,Pa[os]=2,Pa[mu]=1,Pa[rs]=4,Pa[nu]=4,Pa[gc]=16,Pa[Xl]=8,Pa[ba]=6;function Qf(Z,Ae,$e){return Pa[Z]*Ae*$e}var $l=function(Z,Ae,$e,$t,Cr){var Yt={rgba4:Xn,rgb565:wf,"rgb5 a1":Un,depth:os,stencil:mu,"depth stencil":rs};Ae.ext_srgb&&(Yt.srgba=nu),Ae.ext_color_buffer_half_float&&(Yt.rgba16f=Xl,Yt.rgb16f=ba),Ae.webgl_color_buffer_float&&(Yt.rgba32f=gc);var vr=[];Object.keys(Yt).forEach(function(zr){var Gr=Yt[zr];vr[Gr]=zr});var Pr=0,Fr={};function Nr(zr){this.id=Pr++,this.refCount=1,this.renderbuffer=zr,this.format=Xn,this.width=0,this.height=0,Cr.profile&&(this.stats={size:0})}Nr.prototype.decRef=function(){--this.refCount<=0&&Wr(this)};function Wr(zr){var Gr=zr.renderbuffer;N(Gr,"must not double destroy renderbuffer"),Z.bindRenderbuffer(vu,null),Z.deleteRenderbuffer(Gr),zr.renderbuffer=null,zr.refCount=0,delete Fr[zr.id],$t.renderbufferCount--}function Xr(zr,Gr){var At=new Nr(Z.createRenderbuffer());Fr[At.id]=At,$t.renderbufferCount++;function ar(on,Mr){var $r=0,vn=0,Kn=Xn;if(typeof on=="object"&&on){var mr=on;if("shape"in mr){var Er=mr.shape;N(Array.isArray(Er)&&Er.length>=2,"invalid renderbuffer shape"),$r=Er[0]|0,vn=Er[1]|0}else"radius"in mr&&($r=vn=mr.radius|0),"width"in mr&&($r=mr.width|0),"height"in mr&&(vn=mr.height|0);"format"in mr&&(N.parameter(mr.format,Yt,"invalid renderbuffer format"),Kn=Yt[mr.format])}else typeof on=="number"?($r=on|0,typeof Mr=="number"?vn=Mr|0:vn=$r):on?N.raise("invalid arguments to renderbuffer constructor"):$r=vn=1;if(N($r>0&&vn>0&&$r<=$e.maxRenderbufferSize&&vn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!($r===At.width&&vn===At.height&&Kn===At.format))return ar.width=At.width=$r,ar.height=At.height=vn,At.format=Kn,Z.bindRenderbuffer(vu,At.renderbuffer),Z.renderbufferStorage(vu,Kn,$r,vn),N(Z.getError()===0,"invalid render buffer format"),Cr.profile&&(At.stats.size=Qf(At.format,At.width,At.height)),ar.format=vr[At.format],ar}function Zr(on,Mr){var $r=on|0,vn=Mr|0||$r;return $r===At.width&&vn===At.height||(N($r>0&&vn>0&&$r<=$e.maxRenderbufferSize&&vn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),ar.width=At.width=$r,ar.height=At.height=vn,Z.bindRenderbuffer(vu,At.renderbuffer),Z.renderbufferStorage(vu,At.format,$r,vn),N(Z.getError()===0,"invalid render buffer format"),Cr.profile&&(At.stats.size=Qf(At.format,At.width,At.height))),ar}return ar(zr,Gr),ar.resize=Zr,ar._reglType="renderbuffer",ar._renderbuffer=At,Cr.profile&&(ar.stats=At.stats),ar.destroy=function(){At.decRef()},ar}Cr.profile&&($t.getTotalRenderbufferSize=function(){var zr=0;return Object.keys(Fr).forEach(function(Gr){zr+=Fr[Gr].stats.size}),zr});function ln(){ce(Fr).forEach(function(zr){zr.renderbuffer=Z.createRenderbuffer(),Z.bindRenderbuffer(vu,zr.renderbuffer),Z.renderbufferStorage(vu,zr.format,zr.width,zr.height)}),Z.bindRenderbuffer(vu,null)}return{create:Xr,clear:function(){ce(Fr).forEach(Wr)},restore:ln}},gu=36160,Gu=36161,Lo=3553,Tu=34069,Hu=36064,Wc=36096,Yl=36128,yc=33306,Fo=36053,Xc=36054,_c=36055,Ph=36057,Sl=36061,ql=36193,nl=5121,Wu=5126,ks=6407,$c=6408,xc=6402,Jf=[ks,$c],Kl=[];Kl[$c]=4,Kl[ks]=3;var f=[];f[nl]=1,f[Wu]=4,f[ql]=2;var d=32854,h=32855,g=36194,w=33189,M=36168,I=34041,F=35907,j=34836,J=34842,ye=34843,le=[d,h,g,F,J,ye,j],Ee={};Ee[Fo]="complete",Ee[Xc]="incomplete attachment",Ee[Ph]="incomplete dimensions",Ee[_c]="incomplete, missing attachment",Ee[Sl]="unsupported";function Ue(Z,Ae,$e,$t,Cr,Yt){var vr={cur:null,next:null,dirty:!1,setFBO:null},Pr=["rgba"],Fr=["rgba4","rgb565","rgb5 a1"];Ae.ext_srgb&&Fr.push("srgba"),Ae.ext_color_buffer_half_float&&Fr.push("rgba16f","rgb16f"),Ae.webgl_color_buffer_float&&Fr.push("rgba32f");var Nr=["uint8"];Ae.oes_texture_half_float&&Nr.push("half float","float16"),Ae.oes_texture_float&&Nr.push("float","float32");function Wr(Ur,pn,un){this.target=Ur,this.texture=pn,this.renderbuffer=un;var ki=0,di=0;pn?(ki=pn.width,di=pn.height):un&&(ki=un.width,di=un.height),this.width=ki,this.height=di}function Xr(Ur){Ur&&(Ur.texture&&Ur.texture._texture.decRef(),Ur.renderbuffer&&Ur.renderbuffer._renderbuffer.decRef())}function ln(Ur,pn,un){if(!!Ur)if(Ur.texture){var ki=Ur.texture._texture,di=Math.max(1,ki.width),fn=Math.max(1,ki.height);N(di===pn&&fn===un,"inconsistent width/height for supplied texture"),ki.refCount+=1}else{var mn=Ur.renderbuffer._renderbuffer;N(mn.width===pn&&mn.height===un,"inconsistent width/height for renderbuffer"),mn.refCount+=1}}function zr(Ur,pn){pn&&(pn.texture?Z.framebufferTexture2D(gu,Ur,pn.target,pn.texture._texture.texture,0):Z.framebufferRenderbuffer(gu,Ur,Gu,pn.renderbuffer._renderbuffer.renderbuffer))}function Gr(Ur){var pn=Lo,un=null,ki=null,di=Ur;typeof Ur=="object"&&(di=Ur.data,"target"in Ur&&(pn=Ur.target|0)),N.type(di,"function","invalid attachment data");var fn=di._reglType;return fn==="texture2d"?(un=di,N(pn===Lo)):fn==="textureCube"?(un=di,N(pn>=Tu&&pn<Tu+6,"invalid cube map target")):fn==="renderbuffer"?(ki=di,pn=Gu):N.raise("invalid regl object for attachment"),new Wr(pn,un,ki)}function At(Ur,pn,un,ki,di){if(un){var fn=$t.create2D({width:Ur,height:pn,format:ki,type:di});return fn._texture.refCount=0,new Wr(Lo,fn,null)}else{var mn=Cr.create({width:Ur,height:pn,format:ki});return mn._renderbuffer.refCount=0,new Wr(Gu,null,mn)}}function ar(Ur){return Ur&&(Ur.texture||Ur.renderbuffer)}function Zr(Ur,pn,un){Ur&&(Ur.texture?Ur.texture.resize(pn,un):Ur.renderbuffer&&Ur.renderbuffer.resize(pn,un),Ur.width=pn,Ur.height=un)}var on=0,Mr={};function $r(){this.id=on++,Mr[this.id]=this,this.framebuffer=Z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function vn(Ur){Ur.colorAttachments.forEach(Xr),Xr(Ur.depthAttachment),Xr(Ur.stencilAttachment),Xr(Ur.depthStencilAttachment)}function Kn(Ur){var pn=Ur.framebuffer;N(pn,"must not double destroy framebuffer"),Z.deleteFramebuffer(pn),Ur.framebuffer=null,Yt.framebufferCount--,delete Mr[Ur.id]}function mr(Ur){var pn;Z.bindFramebuffer(gu,Ur.framebuffer);var un=Ur.colorAttachments;for(pn=0;pn<un.length;++pn)zr(Hu+pn,un[pn]);for(pn=un.length;pn<$e.maxColorAttachments;++pn)Z.framebufferTexture2D(gu,Hu+pn,Lo,null,0);Z.framebufferTexture2D(gu,yc,Lo,null,0),Z.framebufferTexture2D(gu,Wc,Lo,null,0),Z.framebufferTexture2D(gu,Yl,Lo,null,0),zr(Wc,Ur.depthAttachment),zr(Yl,Ur.stencilAttachment),zr(yc,Ur.depthStencilAttachment);var ki=Z.checkFramebufferStatus(gu);!Z.isContextLost()&&ki!==Fo&&N.raise("framebuffer configuration not supported, status = "+Ee[ki]),Z.bindFramebuffer(gu,vr.next?vr.next.framebuffer:null),vr.cur=vr.next,Z.getError()}function Er(Ur,pn){var un=new $r;Yt.framebufferCount++;function ki(fn,mn){var li;N(vr.next!==un,"can not update framebuffer which is currently in use");var bi=0,Ui=0,ro=!0,co=!0,Ti=null,ls=!0,Ha="rgba",Wo="uint8",yo=1,zo=null,Xo=null,xs=null,_o=!1;if(typeof fn=="number")bi=fn|0,Ui=mn|0||bi;else if(!fn)bi=Ui=1;else{N.type(fn,"object","invalid arguments for framebuffer");var Mi=fn;if("shape"in Mi){var Io=Mi.shape;N(Array.isArray(Io)&&Io.length>=2,"invalid shape for framebuffer"),bi=Io[0],Ui=Io[1]}else"radius"in Mi&&(bi=Ui=Mi.radius),"width"in Mi&&(bi=Mi.width),"height"in Mi&&(Ui=Mi.height);("color"in Mi||"colors"in Mi)&&(Ti=Mi.color||Mi.colors,Array.isArray(Ti)&&N(Ti.length===1||Ae.webgl_draw_buffers,"multiple render targets not supported")),Ti||("colorCount"in Mi&&(yo=Mi.colorCount|0,N(yo>0,"invalid color buffer count")),"colorTexture"in Mi&&(ls=!!Mi.colorTexture,Ha="rgba4"),"colorType"in Mi&&(Wo=Mi.colorType,ls?(N(Ae.oes_texture_float||!(Wo==="float"||Wo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),N(Ae.oes_texture_half_float||!(Wo==="half float"||Wo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Wo==="half float"||Wo==="float16"?(N(Ae.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ha="rgba16f"):(Wo==="float"||Wo==="float32")&&(N(Ae.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ha="rgba32f"),N.oneOf(Wo,Nr,"invalid color type")),"colorFormat"in Mi&&(Ha=Mi.colorFormat,Pr.indexOf(Ha)>=0?ls=!0:Fr.indexOf(Ha)>=0?ls=!1:N.optional(function(){ls?N.oneOf(Mi.colorFormat,Pr,"invalid color format for texture"):N.oneOf(Mi.colorFormat,Fr,"invalid color format for renderbuffer")}))),("depthTexture"in Mi||"depthStencilTexture"in Mi)&&(_o=!!(Mi.depthTexture||Mi.depthStencilTexture),N(!_o||Ae.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Mi&&(typeof Mi.depth=="boolean"?ro=Mi.depth:(zo=Mi.depth,co=!1)),"stencil"in Mi&&(typeof Mi.stencil=="boolean"?co=Mi.stencil:(Xo=Mi.stencil,ro=!1)),"depthStencil"in Mi&&(typeof Mi.depthStencil=="boolean"?ro=co=Mi.depthStencil:(xs=Mi.depthStencil,ro=!1,co=!1))}var ia=null,ns=null,gi=null,Gi=null;if(Array.isArray(Ti))ia=Ti.map(Gr);else if(Ti)ia=[Gr(Ti)];else for(ia=new Array(yo),li=0;li<yo;++li)ia[li]=At(bi,Ui,ls,Ha,Wo);N(Ae.webgl_draw_buffers||ia.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),N(ia.length<=$e.maxColorAttachments,"too many color attachments, not supported"),bi=bi||ia[0].width,Ui=Ui||ia[0].height,zo?ns=Gr(zo):ro&&!co&&(ns=At(bi,Ui,_o,"depth","uint32")),Xo?gi=Gr(Xo):co&&!ro&&(gi=At(bi,Ui,!1,"stencil","uint8")),xs?Gi=Gr(xs):!zo&&!Xo&&co&&ro&&(Gi=At(bi,Ui,_o,"depth stencil","depth stencil")),N(!!zo+!!Xo+!!xs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var pa=null;for(li=0;li<ia.length;++li)if(ln(ia[li],bi,Ui),N(!ia[li]||ia[li].texture&&Jf.indexOf(ia[li].texture._texture.format)>=0||ia[li].renderbuffer&&le.indexOf(ia[li].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+li+" is invalid"),ia[li]&&ia[li].texture){var Po=Kl[ia[li].texture._texture.format]*f[ia[li].texture._texture.type];pa===null?pa=Po:N(pa===Po,"all color attachments much have the same number of bits per pixel.")}return ln(ns,bi,Ui),N(!ns||ns.texture&&ns.texture._texture.format===xc||ns.renderbuffer&&ns.renderbuffer._renderbuffer.format===w,"invalid depth attachment for framebuffer object"),ln(gi,bi,Ui),N(!gi||gi.renderbuffer&&gi.renderbuffer._renderbuffer.format===M,"invalid stencil attachment for framebuffer object"),ln(Gi,bi,Ui),N(!Gi||Gi.texture&&Gi.texture._texture.format===I||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===I,"invalid depth-stencil attachment for framebuffer object"),vn(un),un.width=bi,un.height=Ui,un.colorAttachments=ia,un.depthAttachment=ns,un.stencilAttachment=gi,un.depthStencilAttachment=Gi,ki.color=ia.map(ar),ki.depth=ar(ns),ki.stencil=ar(gi),ki.depthStencil=ar(Gi),ki.width=un.width,ki.height=un.height,mr(un),ki}function di(fn,mn){N(vr.next!==un,"can not resize a framebuffer which is currently in use");var li=Math.max(fn|0,1),bi=Math.max(mn|0||li,1);if(li===un.width&&bi===un.height)return ki;for(var Ui=un.colorAttachments,ro=0;ro<Ui.length;++ro)Zr(Ui[ro],li,bi);return Zr(un.depthAttachment,li,bi),Zr(un.stencilAttachment,li,bi),Zr(un.depthStencilAttachment,li,bi),un.width=ki.width=li,un.height=ki.height=bi,mr(un),ki}return ki(Ur,pn),y(ki,{resize:di,_reglType:"framebuffer",_framebuffer:un,destroy:function(){Kn(un),vn(un)},use:function(fn){vr.setFBO({framebuffer:ki},fn)}})}function Dn(Ur){var pn=Array(6);function un(di){var fn;N(pn.indexOf(vr.next)<0,"can not update framebuffer which is currently in use");var mn={color:null},li=0,bi=null,Ui="rgba",ro="uint8",co=1;if(typeof di=="number")li=di|0;else if(!di)li=1;else{N.type(di,"object","invalid arguments for framebuffer");var Ti=di;if("shape"in Ti){var ls=Ti.shape;N(Array.isArray(ls)&&ls.length>=2,"invalid shape for framebuffer"),N(ls[0]===ls[1],"cube framebuffer must be square"),li=ls[0]}else"radius"in Ti&&(li=Ti.radius|0),"width"in Ti?(li=Ti.width|0,"height"in Ti&&N(Ti.height===li,"must be square")):"height"in Ti&&(li=Ti.height|0);("color"in Ti||"colors"in Ti)&&(bi=Ti.color||Ti.colors,Array.isArray(bi)&&N(bi.length===1||Ae.webgl_draw_buffers,"multiple render targets not supported")),bi||("colorCount"in Ti&&(co=Ti.colorCount|0,N(co>0,"invalid color buffer count")),"colorType"in Ti&&(N.oneOf(Ti.colorType,Nr,"invalid color type"),ro=Ti.colorType),"colorFormat"in Ti&&(Ui=Ti.colorFormat,N.oneOf(Ti.colorFormat,Pr,"invalid color format for texture"))),"depth"in Ti&&(mn.depth=Ti.depth),"stencil"in Ti&&(mn.stencil=Ti.stencil),"depthStencil"in Ti&&(mn.depthStencil=Ti.depthStencil)}var Ha;if(bi)if(Array.isArray(bi))for(Ha=[],fn=0;fn<bi.length;++fn)Ha[fn]=bi[fn];else Ha=[bi];else{Ha=Array(co);var Wo={radius:li,format:Ui,type:ro};for(fn=0;fn<co;++fn)Ha[fn]=$t.createCube(Wo)}for(mn.color=Array(Ha.length),fn=0;fn<Ha.length;++fn){var yo=Ha[fn];N(typeof yo=="function"&&yo._reglType==="textureCube","invalid cube map"),li=li||yo.width,N(yo.width===li&&yo.height===li,"invalid cube map shape"),mn.color[fn]={target:Tu,data:Ha[fn]}}for(fn=0;fn<6;++fn){for(var zo=0;zo<Ha.length;++zo)mn.color[zo].target=Tu+fn;fn>0&&(mn.depth=pn[0].depth,mn.stencil=pn[0].stencil,mn.depthStencil=pn[0].depthStencil),pn[fn]?pn[fn](mn):pn[fn]=Er(mn)}return y(un,{width:li,height:li,color:Ha})}function ki(di){var fn,mn=di|0;if(N(mn>0&&mn<=$e.maxCubeMapSize,"invalid radius for cube fbo"),mn===un.width)return un;var li=un.color;for(fn=0;fn<li.length;++fn)li[fn].resize(mn);for(fn=0;fn<6;++fn)pn[fn].resize(mn);return un.width=un.height=mn,un}return un(Ur),y(un,{faces:pn,resize:ki,_reglType:"framebufferCube",destroy:function(){pn.forEach(function(di){di.destroy()})}})}function cn(){vr.cur=null,vr.next=null,vr.dirty=!0,ce(Mr).forEach(function(Ur){Ur.framebuffer=Z.createFramebuffer(),mr(Ur)})}return y(vr,{getFramebuffer:function(Ur){if(typeof Ur=="function"&&Ur._reglType==="framebuffer"){var pn=Ur._framebuffer;if(pn instanceof $r)return pn}return null},create:Er,createCube:Dn,clear:function(){ce(Mr).forEach(Kn)},restore:cn})}var je=5126,nt=34962,Ne=34963,at=["attributes","elements","offset","count","primitive","instances"];function rt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=je,this.offset=0,this.stride=0,this.divisor=0}function be(Z,Ae,$e,$t,Cr,Yt,vr){for(var Pr=$e.maxAttributes,Fr=new Array(Pr),Nr=0;Nr<Pr;++Nr)Fr[Nr]=new rt;var Wr=0,Xr={},ln={Record:rt,scope:{},state:Fr,currentVAO:null,targetVAO:null,restore:Gr()?vn:function(){},createVAO:Kn,getVAO:ar,destroyBuffer:zr,setVAO:Gr()?Zr:on,clear:Gr()?Mr:function(){}};function zr(mr){for(var Er=0;Er<Fr.length;++Er){var Dn=Fr[Er];Dn.buffer===mr&&(Z.disableVertexAttribArray(Er),Dn.buffer=null)}}function Gr(){return Ae.oes_vertex_array_object}function At(){return Ae.angle_instanced_arrays}function ar(mr){return typeof mr=="function"&&mr._vao?mr._vao:null}function Zr(mr){if(mr!==ln.currentVAO){var Er=Gr();mr?Er.bindVertexArrayOES(mr.vao):Er.bindVertexArrayOES(null),ln.currentVAO=mr}}function on(mr){if(mr!==ln.currentVAO){if(mr)mr.bindAttrs();else{for(var Er=At(),Dn=0;Dn<Fr.length;++Dn){var cn=Fr[Dn];cn.buffer?(Z.enableVertexAttribArray(Dn),cn.buffer.bind(),Z.vertexAttribPointer(Dn,cn.size,cn.type,cn.normalized,cn.stride,cn.offfset),Er&&cn.divisor&&Er.vertexAttribDivisorANGLE(Dn,cn.divisor)):(Z.disableVertexAttribArray(Dn),Z.vertexAttrib4f(Dn,cn.x,cn.y,cn.z,cn.w))}vr.elements?Z.bindBuffer(Ne,vr.elements.buffer.buffer):Z.bindBuffer(Ne,null)}ln.currentVAO=mr}}function Mr(){ce(Xr).forEach(function(mr){mr.destroy()})}function $r(){this.id=++Wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var mr=Gr();mr?this.vao=mr.createVertexArrayOES():this.vao=null,Xr[this.id]=this,this.buffers=[]}$r.prototype.bindAttrs=function(){for(var mr=At(),Er=this.attributes,Dn=0;Dn<Er.length;++Dn){var cn=Er[Dn];cn.buffer?(Z.enableVertexAttribArray(Dn),Z.bindBuffer(nt,cn.buffer.buffer),Z.vertexAttribPointer(Dn,cn.size,cn.type,cn.normalized,cn.stride,cn.offset),mr&&cn.divisor&&mr.vertexAttribDivisorANGLE(Dn,cn.divisor)):(Z.disableVertexAttribArray(Dn),Z.vertexAttrib4f(Dn,cn.x,cn.y,cn.z,cn.w))}for(var Ur=Er.length;Ur<Pr;++Ur)Z.disableVertexAttribArray(Ur);var pn=Yt.getElements(this.elements);pn?Z.bindBuffer(Ne,pn.buffer.buffer):Z.bindBuffer(Ne,null)},$r.prototype.refresh=function(){var mr=Gr();mr&&(mr.bindVertexArrayOES(this.vao),this.bindAttrs(),ln.currentVAO=null,mr.bindVertexArrayOES(null))},$r.prototype.destroy=function(){if(this.vao){var mr=Gr();this===ln.currentVAO&&(ln.currentVAO=null,mr.bindVertexArrayOES(null)),mr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Xr[this.id]&&(delete Xr[this.id],$t.vaoCount-=1)};function vn(){var mr=Gr();mr&&ce(Xr).forEach(function(Er){Er.refresh()})}function Kn(mr){var Er=new $r;$t.vaoCount+=1;function Dn(cn){var Ur;if(Array.isArray(cn))Ur=cn,Er.elements&&Er.ownsElements&&Er.elements.destroy(),Er.elements=null,Er.ownsElements=!1,Er.offset=0,Er.count=0,Er.instances=-1,Er.primitive=4;else{if(N(typeof cn=="object","invalid arguments for create vao"),N("attributes"in cn,"must specify attributes for vao"),cn.elements){var pn=cn.elements;Er.ownsElements?typeof pn=="function"&&pn._reglType==="elements"?(Er.elements.destroy(),Er.ownsElements=!1):(Er.elements(pn),Er.ownsElements=!1):Yt.getElements(cn.elements)?(Er.elements=cn.elements,Er.ownsElements=!1):(Er.elements=Yt.create(cn.elements),Er.ownsElements=!0)}else Er.elements=null,Er.ownsElements=!1;Ur=cn.attributes,Er.offset=0,Er.count=-1,Er.instances=-1,Er.primitive=4,Er.elements&&(Er.count=Er.elements._elements.vertCount,Er.primitive=Er.elements._elements.primType),"offset"in cn&&(Er.offset=cn.offset|0),"count"in cn&&(Er.count=cn.count|0),"instances"in cn&&(Er.instances=cn.instances|0),"primitive"in cn&&(N(cn.primitive in yr,"bad primitive type: "+cn.primitive),Er.primitive=yr[cn.primitive]),N.optional(function(){for(var ro=Object.keys(cn),co=0;co<ro.length;++co)N(at.indexOf(ro[co])>=0,'invalid option for vao: "'+ro[co]+'" valid options are '+at)}),N(Array.isArray(Ur),"attributes must be an array")}N(Ur.length<Pr,"too many attributes"),N(Ur.length>0,"must specify at least one attribute");var un={},ki=Er.attributes;ki.length=Ur.length;for(var di=0;di<Ur.length;++di){var fn=Ur[di],mn=ki[di]=new rt,li=fn.data||fn;if(Array.isArray(li)||he(li)||Qo(li)){var bi;Er.buffers[di]&&(bi=Er.buffers[di],he(li)&&bi._buffer.byteLength>=li.byteLength?bi.subdata(li):(bi.destroy(),Er.buffers[di]=null)),Er.buffers[di]||(bi=Er.buffers[di]=Cr.create(fn,nt,!1,!0)),mn.buffer=Cr.getBuffer(bi),mn.size=mn.buffer.dimension|0,mn.normalized=!1,mn.type=mn.buffer.dtype,mn.offset=0,mn.stride=0,mn.divisor=0,mn.state=1,un[di]=1}else Cr.getBuffer(fn)?(mn.buffer=Cr.getBuffer(fn),mn.size=mn.buffer.dimension|0,mn.normalized=!1,mn.type=mn.buffer.dtype,mn.offset=0,mn.stride=0,mn.divisor=0,mn.state=1):Cr.getBuffer(fn.buffer)?(mn.buffer=Cr.getBuffer(fn.buffer),mn.size=(+fn.size||mn.buffer.dimension)|0,mn.normalized=!!fn.normalized||!1,"type"in fn?(N.parameter(fn.type,hu,"invalid buffer type"),mn.type=hu[fn.type]):mn.type=mn.buffer.dtype,mn.offset=(fn.offset||0)|0,mn.stride=(fn.stride||0)|0,mn.divisor=(fn.divisor||0)|0,mn.state=1,N(mn.size>=1&&mn.size<=4,"size must be between 1 and 4"),N(mn.offset>=0,"invalid offset"),N(mn.stride>=0&&mn.stride<=255,"stride must be between 0 and 255"),N(mn.divisor>=0,"divisor must be positive"),N(!mn.divisor||!!Ae.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in fn?(N(di>0,"first attribute must not be a constant"),mn.x=+fn.x||0,mn.y=+fn.y||0,mn.z=+fn.z||0,mn.w=+fn.w||0,mn.state=2):N(!1,"invalid attribute spec for location "+di)}for(var Ui=0;Ui<Er.buffers.length;++Ui)!un[Ui]&&Er.buffers[Ui]&&(Er.buffers[Ui].destroy(),Er.buffers[Ui]=null);return Er.refresh(),Dn}return Dn.destroy=function(){for(var cn=0;cn<Er.buffers.length;++cn)Er.buffers[cn]&&Er.buffers[cn].destroy();Er.buffers.length=0,Er.ownsElements&&(Er.elements.destroy(),Er.elements=null,Er.ownsElements=!1),Er.destroy()},Dn._vao=Er,Dn._reglType="vao",Dn(mr)}return ln}var or=35632,$=35633,ur=35718,Tr=35721;function rn(Z,Ae,$e,$t){var Cr={},Yt={};function vr(At,ar,Zr,on){this.name=At,this.id=ar,this.location=Zr,this.info=on}function Pr(At,ar){for(var Zr=0;Zr<At.length;++Zr)if(At[Zr].id===ar.id){At[Zr].location=ar.location;return}At.push(ar)}function Fr(At,ar,Zr){var on=At===or?Cr:Yt,Mr=on[ar];if(!Mr){var $r=Ae.str(ar);Mr=Z.createShader(At),Z.shaderSource(Mr,$r),Z.compileShader(Mr),N.shaderError(Z,Mr,$r,At,Zr),on[ar]=Mr}return Mr}var Nr={},Wr=[],Xr=0;function ln(At,ar){this.id=Xr++,this.fragId=At,this.vertId=ar,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,$t.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function zr(At,ar,Zr){var on,Mr,$r=Fr(or,At.fragId),vn=Fr($,At.vertId),Kn=At.program=Z.createProgram();if(Z.attachShader(Kn,$r),Z.attachShader(Kn,vn),Zr)for(on=0;on<Zr.length;++on){var mr=Zr[on];Z.bindAttribLocation(Kn,mr[0],mr[1])}Z.linkProgram(Kn),N.linkError(Z,Kn,Ae.str(At.fragId),Ae.str(At.vertId),ar);var Er=Z.getProgramParameter(Kn,ur);$t.profile&&(At.stats.uniformsCount=Er);var Dn=At.uniforms;for(on=0;on<Er;++on)if(Mr=Z.getActiveUniform(Kn,on),Mr)if(Mr.size>1)for(var cn=0;cn<Mr.size;++cn){var Ur=Mr.name.replace("[0]","["+cn+"]");Pr(Dn,new vr(Ur,Ae.id(Ur),Z.getUniformLocation(Kn,Ur),Mr))}else Pr(Dn,new vr(Mr.name,Ae.id(Mr.name),Z.getUniformLocation(Kn,Mr.name),Mr));var pn=Z.getProgramParameter(Kn,Tr);$t.profile&&(At.stats.attributesCount=pn);var un=At.attributes;for(on=0;on<pn;++on)Mr=Z.getActiveAttrib(Kn,on),Mr&&Pr(un,new vr(Mr.name,Ae.id(Mr.name),Z.getAttribLocation(Kn,Mr.name),Mr))}$t.profile&&($e.getMaxUniformsCount=function(){var At=0;return Wr.forEach(function(ar){ar.stats.uniformsCount>At&&(At=ar.stats.uniformsCount)}),At},$e.getMaxAttributesCount=function(){var At=0;return Wr.forEach(function(ar){ar.stats.attributesCount>At&&(At=ar.stats.attributesCount)}),At});function Gr(){Cr={},Yt={};for(var At=0;At<Wr.length;++At)zr(Wr[At],null,Wr[At].attributes.map(function(ar){return[ar.location,ar.name]}))}return{clear:function(){var At=Z.deleteShader.bind(Z);ce(Cr).forEach(At),Cr={},ce(Yt).forEach(At),Yt={},Wr.forEach(function(ar){Z.deleteProgram(ar.program)}),Wr.length=0,Nr={},$e.shaderCount=0},program:function(At,ar,Zr,on){N.command(At>=0,"missing vertex shader",Zr),N.command(ar>=0,"missing fragment shader",Zr);var Mr=Nr[ar];Mr||(Mr=Nr[ar]={});var $r=Mr[At];if($r&&($r.refCount++,!on))return $r;var vn=new ln(ar,At);return $e.shaderCount++,zr(vn,Zr,on),$r||(Mr[At]=vn),Wr.push(vn),y(vn,{destroy:function(){if(vn.refCount--,vn.refCount<=0){Z.deleteProgram(vn.program);var Kn=Wr.indexOf(vn);Wr.splice(Kn,1),$e.shaderCount--}Mr[vn.vertId].refCount<=0&&(Z.deleteShader(Yt[vn.vertId]),delete Yt[vn.vertId],delete Nr[vn.fragId][vn.vertId]),Object.keys(Nr[vn.fragId]).length||(Z.deleteShader(Cr[vn.fragId]),delete Cr[vn.fragId],delete Nr[vn.fragId])}})},restore:Gr,shader:Fr,frag:-1,vert:-1}}var Qr=6408,Sn=5121,Jn=3333,ei=5126;function ni(Z,Ae,$e,$t,Cr,Yt,vr){function Pr(Wr){var Xr;Ae.next===null?(N(Cr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Xr=Sn):(N(Ae.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Xr=Ae.next.colorAttachments[0].texture._texture.type,N.optional(function(){Yt.oes_texture_float?(N(Xr===Sn||Xr===ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Xr===ei&&N(vr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):N(Xr===Sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ln=0,zr=0,Gr=$t.framebufferWidth,At=$t.framebufferHeight,ar=null;he(Wr)?ar=Wr:Wr&&(N.type(Wr,"object","invalid arguments to regl.read()"),ln=Wr.x|0,zr=Wr.y|0,N(ln>=0&&ln<$t.framebufferWidth,"invalid x offset for regl.read"),N(zr>=0&&zr<$t.framebufferHeight,"invalid y offset for regl.read"),Gr=(Wr.width||$t.framebufferWidth-ln)|0,At=(Wr.height||$t.framebufferHeight-zr)|0,ar=Wr.data||null),ar&&(Xr===Sn?N(ar instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Xr===ei&&N(ar instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),N(Gr>0&&Gr+ln<=$t.framebufferWidth,"invalid width for read pixels"),N(At>0&&At+zr<=$t.framebufferHeight,"invalid height for read pixels"),$e();var Zr=Gr*At*4;return ar||(Xr===Sn?ar=new Uint8Array(Zr):Xr===ei&&(ar=ar||new Float32Array(Zr))),N.isTypedArray(ar,"data buffer for regl.read() must be a typedarray"),N(ar.byteLength>=Zr,"data buffer for regl.read() too small"),Z.pixelStorei(Jn,4),Z.readPixels(ln,zr,Gr,At,Qr,Xr,ar),ar}function Fr(Wr){var Xr;return Ae.setFBO({framebuffer:Wr.framebuffer},function(){Xr=Pr(Wr)}),Xr}function Nr(Wr){return!Wr||!("framebuffer"in Wr)?Pr(Wr):Fr(Wr)}return Nr}function ji(Z){return Array.prototype.slice.call(Z)}function wn(Z){return ji(Z).join("")}function vi(){var Z=0,Ae=[],$e=[];function $t(Xr){for(var ln=0;ln<$e.length;++ln)if($e[ln]===Xr)return Ae[ln];var zr="g"+Z++;return Ae.push(zr),$e.push(Xr),zr}function Cr(){var Xr=[];function ln(){Xr.push.apply(Xr,ji(arguments))}var zr=[];function Gr(){var At="v"+Z++;return zr.push(At),arguments.length>0&&(Xr.push(At,"="),Xr.push.apply(Xr,ji(arguments)),Xr.push(";")),At}return y(ln,{def:Gr,toString:function(){return wn([zr.length>0?"var "+zr.join(",")+";":"",wn(Xr)])}})}function Yt(){var Xr=Cr(),ln=Cr(),zr=Xr.toString,Gr=ln.toString;function At(ar,Zr){ln(ar,Zr,"=",Xr.def(ar,Zr),";")}return y(function(){Xr.apply(Xr,ji(arguments))},{def:Xr.def,entry:Xr,exit:ln,save:At,set:function(ar,Zr,on){At(ar,Zr),Xr(ar,Zr,"=",on,";")},toString:function(){return zr()+Gr()}})}function vr(){var Xr=wn(arguments),ln=Yt(),zr=Yt(),Gr=ln.toString,At=zr.toString;return y(ln,{then:function(){return ln.apply(ln,ji(arguments)),this},else:function(){return zr.apply(zr,ji(arguments)),this},toString:function(){var ar=At();return ar&&(ar="else{"+ar+"}"),wn(["if(",Xr,"){",Gr(),"}",ar])}})}var Pr=Cr(),Fr={};function Nr(Xr,ln){var zr=[];function Gr(){var Mr="a"+zr.length;return zr.push(Mr),Mr}ln=ln||0;for(var At=0;At<ln;++At)Gr();var ar=Yt(),Zr=ar.toString,on=Fr[Xr]=y(ar,{arg:Gr,toString:function(){return wn(["function(",zr.join(),"){",Zr(),"}"])}});return on}function Wr(){var Xr=['"use strict";',Pr,"return {"];Object.keys(Fr).forEach(function(At){Xr.push('"',At,'":',Fr[At].toString(),",")}),Xr.push("}");var ln=wn(Xr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),zr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Gr=zr?De.Function.apply(null,Ae.concat(ln)):Function.apply(null,Ae.concat(ln));return Gr.apply(null,$e)}return{global:Pr,link:$t,block:Cr,proc:Nr,scope:Yt,cond:vr,compile:Wr}}var wi="xyzw".split(""),mi=5121,ai=1,Ai=2,si=0,oi=1,go=2,to=3,Do=4,bo=5,Ya=6,lo="dither",Ls="blend.enable",ys="blend.color",Vs="blend.equation",ss="blend.func",yu="depth.enable",iu="depth.func",bc="depth.range",il="depth.mask",Xu="colorMask",Fs="cull.enable",Ql="cull.face",Mu="frontFace",Jl="lineWidth",$u="polygonOffset.enable",Bo="polygonOffset.offset",ku="sample.alpha",Yu="sample.enable",wl="sample.coverage",ma="stencil.enable",js="stencil.mask",_s="stencil.func",al="stencil.opFront",Yc="stencil.opBack",qc="scissor.enable",Cf="scissor.box",au="viewport",ol="profile",ou="framebuffer",Cl="vert",Kc="frag",_u="elements",No="primitive",ec="count",Rh="offset",Oh="instances",eh="vao",fp="Width",Yp="Height",Qc=ou+fp,Ec=ou+Yp,Af=au+fp,Lh=au+Yp,sl="drawingBuffer",Tf=sl+fp,Iu=sl+Yp,X=[ss,Vs,_s,al,Yc,wl,au,Cf,Bo],Vr=34962,Mf=34963,Pv=35632,us=35633,tc=3553,Sc=34067,hp=2884,Pu=3042,kf=3024,Eo=2960,pp=2929,qp=3089,If=32823,Jc=32926,Pf=32928,Fh=5126,th=35664,wc=35665,ef=35666,Rf=5124,Dh=35667,Al=35668,rh=35669,nh=35670,Bh=35671,Of=35672,Tl=35673,su=35674,ih=35675,ah=35676,oh=35678,sh=35680,Lf=4,Gs=1028,ul=1029,Kp=2304,Nh=2305,Nd=32775,Ff=32776,Ru=519,xu=7680,dp=0,tf=1,Df=32774,ll=513,Qp=36160,Jp=36064,qu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ml=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Bf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},rc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ed={frag:Pv,vert:us},vp={cw:Kp,ccw:Nh};function zh(Z){return Array.isArray(Z)||he(Z)||Qo(Z)}function mp(Z){return Z.sort(function(Ae,$e){return Ae===au?-1:$e===au?1:Ae<$e?-1:1})}function ga(Z,Ae,$e,$t){this.thisDep=Z,this.contextDep=Ae,this.propDep=$e,this.append=$t}function nc(Z){return Z&&!(Z.thisDep||Z.contextDep||Z.propDep)}function ko(Z){return new ga(!1,!1,!1,Z)}function uu(Z,Ae){var $e=Z.type;if($e===si){var $t=Z.data.length;return new ga(!0,$t>=1,$t>=2,Ae)}else if($e===Do){var Cr=Z.data;return new ga(Cr.thisDep,Cr.contextDep,Cr.propDep,Ae)}else{if($e===bo)return new ga(!1,!1,!1,Ae);if($e===Ya){for(var Yt=!1,vr=!1,Pr=!1,Fr=0;Fr<Z.data.length;++Fr){var Nr=Z.data[Fr];if(Nr.type===oi)Pr=!0;else if(Nr.type===go)vr=!0;else if(Nr.type===to)Yt=!0;else if(Nr.type===si){Yt=!0;var Wr=Nr.data;Wr>=1&&(vr=!0),Wr>=2&&(Pr=!0)}else Nr.type===Do&&(Yt=Yt||Nr.data.thisDep,vr=vr||Nr.data.contextDep,Pr=Pr||Nr.data.propDep)}return new ga(Yt,vr,Pr,Ae)}else return new ga($e===to,$e===go,$e===oi,Ae)}}var td=new ga(!1,!1,!1,function(){});function zd(Z,Ae,$e,$t,Cr,Yt,vr,Pr,Fr,Nr,Wr,Xr,ln,zr,Gr){var At=Nr.Record,ar={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(ar.min=Nd,ar.max=Ff);var Zr=$e.angle_instanced_arrays,on=$e.webgl_draw_buffers,Mr=$e.oes_vertex_array_object,$r={dirty:!0,profile:Gr.profile},vn={},Kn=[],mr={},Er={};function Dn(Oe){return Oe.replace(".","_")}function cn(Oe,ge,it){var It=Dn(Oe);Kn.push(Oe),vn[It]=$r[It]=!!it,mr[It]=ge}function Ur(Oe,ge,it){var It=Dn(Oe);Kn.push(Oe),Array.isArray(it)?($r[It]=it.slice(),vn[It]=it.slice()):$r[It]=vn[It]=it,Er[It]=ge}cn(lo,kf),cn(Ls,Pu),Ur(ys,"blendColor",[0,0,0,0]),Ur(Vs,"blendEquationSeparate",[Df,Df]),Ur(ss,"blendFuncSeparate",[tf,dp,tf,dp]),cn(yu,pp,!0),Ur(iu,"depthFunc",ll),Ur(bc,"depthRange",[0,1]),Ur(il,"depthMask",!0),Ur(Xu,Xu,[!0,!0,!0,!0]),cn(Fs,hp),Ur(Ql,"cullFace",ul),Ur(Mu,Mu,Nh),Ur(Jl,Jl,1),cn($u,If),Ur(Bo,"polygonOffset",[0,0]),cn(ku,Jc),cn(Yu,Pf),Ur(wl,"sampleCoverage",[1,!1]),cn(ma,Eo),Ur(js,"stencilMask",-1),Ur(_s,"stencilFunc",[Ru,0,-1]),Ur(al,"stencilOpSeparate",[Gs,xu,xu,xu]),Ur(Yc,"stencilOpSeparate",[ul,xu,xu,xu]),cn(qc,qp),Ur(Cf,"scissor",[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]),Ur(au,au,[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]);var pn={gl:Z,context:ln,strings:Ae,next:vn,current:$r,draw:Xr,elements:Yt,buffer:Cr,shader:Wr,attributes:Nr.state,vao:Nr,uniforms:Fr,framebuffer:Pr,extensions:$e,timer:zr,isBufferArgs:zh},un={primTypes:yr,compareFuncs:Bf,blendFuncs:qu,blendEquations:ar,stencilOps:rc,glTypes:hu,orientationType:vp};N.optional(function(){pn.isArrayLike=mo}),on&&(un.backBuffer=[ul],un.drawBuffer=tt($t.maxDrawbuffers,function(Oe){return Oe===0?[0]:tt(Oe,function(ge){return Jp+ge})}));var ki=0;function di(){var Oe=vi(),ge=Oe.link,it=Oe.global;Oe.id=ki++,Oe.batchId="0";var It=ge(pn),Ht=Oe.shared={props:"a0"};Object.keys(pn).forEach(function(et){Ht[et]=it.def(It,".",et)}),N.optional(function(){Oe.CHECK=ge(N),Oe.commandStr=N.guessCommand(),Oe.command=ge(Oe.commandStr),Oe.assert=function(et,Be,Mt){et("if(!(",Be,"))",this.CHECK,".commandRaise(",ge(Mt),",",this.command,");")},un.invalidBlendCombinations=Ml});var ct=Oe.next={},Xe=Oe.current={};Object.keys(Er).forEach(function(et){Array.isArray($r[et])&&(ct[et]=it.def(Ht.next,".",et),Xe[et]=it.def(Ht.current,".",et))});var xt=Oe.constants={};Object.keys(un).forEach(function(et){xt[et]=it.def(JSON.stringify(un[et]))}),Oe.invoke=function(et,Be){switch(Be.type){case si:var Mt=["this",Ht.context,Ht.props,Oe.batchId];return et.def(ge(Be.data),".call(",Mt.slice(0,Math.max(Be.data.length+1,4)),")");case oi:return et.def(Ht.props,Be.data);case go:return et.def(Ht.context,Be.data);case to:return et.def("this",Be.data);case Do:return Be.data.append(Oe,et),Be.data.ref;case bo:return Be.data.toString();case Ya:return Be.data.map(function(Ut){return Oe.invoke(et,Ut)})}},Oe.attribCache={};var Te={};return Oe.scopeAttrib=function(et){var Be=Ae.id(et);if(Be in Te)return Te[Be];var Mt=Nr.scope[Be];Mt||(Mt=Nr.scope[Be]=new At);var Ut=Te[Be]=ge(Mt);return Ut},Oe}function fn(Oe){var ge=Oe.static,it=Oe.dynamic,It;if(ol in ge){var Ht=!!ge[ol];It=ko(function(Xe,xt){return Ht}),It.enable=Ht}else if(ol in it){var ct=it[ol];It=uu(ct,function(Xe,xt){return Xe.invoke(xt,ct)})}return It}function mn(Oe,ge){var it=Oe.static,It=Oe.dynamic;if(ou in it){var Ht=it[ou];return Ht?(Ht=Pr.getFramebuffer(Ht),N.command(Ht,"invalid framebuffer object"),ko(function(Xe,xt){var Te=Xe.link(Ht),et=Xe.shared;xt.set(et.framebuffer,".next",Te);var Be=et.context;return xt.set(Be,"."+Qc,Te+".width"),xt.set(Be,"."+Ec,Te+".height"),Te})):ko(function(Xe,xt){var Te=Xe.shared;xt.set(Te.framebuffer,".next","null");var et=Te.context;return xt.set(et,"."+Qc,et+"."+Tf),xt.set(et,"."+Ec,et+"."+Iu),"null"})}else if(ou in It){var ct=It[ou];return uu(ct,function(Xe,xt){var Te=Xe.invoke(xt,ct),et=Xe.shared,Be=et.framebuffer,Mt=xt.def(Be,".getFramebuffer(",Te,")");N.optional(function(){Xe.assert(xt,"!"+Te+"||"+Mt,"invalid framebuffer object")}),xt.set(Be,".next",Mt);var Ut=et.context;return xt.set(Ut,"."+Qc,Mt+"?"+Mt+".width:"+Ut+"."+Tf),xt.set(Ut,"."+Ec,Mt+"?"+Mt+".height:"+Ut+"."+Iu),Mt})}else return null}function li(Oe,ge,it){var It=Oe.static,Ht=Oe.dynamic;function ct(Te){if(Te in It){var et=It[Te];N.commandType(et,"object","invalid "+Te,it.commandStr);var Be=!0,Mt=et.x|0,Ut=et.y|0,Ir,nn;return"width"in et?(Ir=et.width|0,N.command(Ir>=0,"invalid "+Te,it.commandStr)):Be=!1,"height"in et?(nn=et.height|0,N.command(nn>=0,"invalid "+Te,it.commandStr)):Be=!1,new ga(!Be&&ge&&ge.thisDep,!Be&&ge&&ge.contextDep,!Be&&ge&&ge.propDep,function(Jr,Nn){var xn=Jr.shared.context,Pn=Ir;"width"in et||(Pn=Nn.def(xn,".",Qc,"-",Mt));var Fn=nn;return"height"in et||(Fn=Nn.def(xn,".",Ec,"-",Ut)),[Mt,Ut,Pn,Fn]})}else if(Te in Ht){var an=Ht[Te],gn=uu(an,function(Jr,Nn){var xn=Jr.invoke(Nn,an);N.optional(function(){Jr.assert(Nn,xn+"&&typeof "+xn+'==="object"',"invalid "+Te)});var Pn=Jr.shared.context,Fn=Nn.def(xn,".x|0"),kn=Nn.def(xn,".y|0"),hi=Nn.def('"width" in ',xn,"?",xn,".width|0:","(",Pn,".",Qc,"-",Fn,")"),Aa=Nn.def('"height" in ',xn,"?",xn,".height|0:","(",Pn,".",Ec,"-",kn,")");return N.optional(function(){Jr.assert(Nn,hi+">=0&&"+Aa+">=0","invalid "+Te)}),[Fn,kn,hi,Aa]});return ge&&(gn.thisDep=gn.thisDep||ge.thisDep,gn.contextDep=gn.contextDep||ge.contextDep,gn.propDep=gn.propDep||ge.propDep),gn}else return ge?new ga(ge.thisDep,ge.contextDep,ge.propDep,function(Jr,Nn){var xn=Jr.shared.context;return[0,0,Nn.def(xn,".",Qc),Nn.def(xn,".",Ec)]}):null}var Xe=ct(au);if(Xe){var xt=Xe;Xe=new ga(Xe.thisDep,Xe.contextDep,Xe.propDep,function(Te,et){var Be=xt.append(Te,et),Mt=Te.shared.context;return et.set(Mt,"."+Af,Be[2]),et.set(Mt,"."+Lh,Be[3]),Be})}return{viewport:Xe,scissor_box:ct(Cf)}}function bi(Oe,ge){var it=Oe.static,It=typeof it[Kc]=="string"&&typeof it[Cl]=="string";if(It){if(Object.keys(ge.dynamic).length>0)return null;var Ht=ge.static,ct=Object.keys(Ht);if(ct.length>0&&typeof Ht[ct[0]]=="number"){for(var Xe=[],xt=0;xt<ct.length;++xt)N(typeof Ht[ct[xt]]=="number","must specify all vertex attribute locations when using vaos"),Xe.push([Ht[ct[xt]]|0,ct[xt]]);return Xe}}return null}function Ui(Oe,ge,it){var It=Oe.static,Ht=Oe.dynamic;function ct(Be){if(Be in It){var Mt=Ae.id(It[Be]);N.optional(function(){Wr.shader(ed[Be],Mt,N.guessCommand())});var Ut=ko(function(){return Mt});return Ut.id=Mt,Ut}else if(Be in Ht){var Ir=Ht[Be];return uu(Ir,function(nn,an){var gn=nn.invoke(an,Ir),Jr=an.def(nn.shared.strings,".id(",gn,")");return N.optional(function(){an(nn.shared.shader,".shader(",ed[Be],",",Jr,",",nn.command,");")}),Jr})}return null}var Xe=ct(Kc),xt=ct(Cl),Te=null,et;return nc(Xe)&&nc(xt)?(Te=Wr.program(xt.id,Xe.id,null,it),et=ko(function(Be,Mt){return Be.link(Te)})):et=new ga(Xe&&Xe.thisDep||xt&&xt.thisDep,Xe&&Xe.contextDep||xt&&xt.contextDep,Xe&&Xe.propDep||xt&&xt.propDep,function(Be,Mt){var Ut=Be.shared.shader,Ir;Xe?Ir=Xe.append(Be,Mt):Ir=Mt.def(Ut,".",Kc);var nn;xt?nn=xt.append(Be,Mt):nn=Mt.def(Ut,".",Cl);var an=Ut+".program("+nn+","+Ir;return N.optional(function(){an+=","+Be.command}),Mt.def(an+")")}),{frag:Xe,vert:xt,progVar:et,program:Te}}function ro(Oe,ge){var it=Oe.static,It=Oe.dynamic,Ht={},ct=!1;function Xe(){if(eh in it){var Nn=it[eh];return Nn!==null&&Nr.getVAO(Nn)===null&&(Nn=Nr.createVAO(Nn)),ct=!0,Ht.vao=Nn,ko(function(Pn){var Fn=Nr.getVAO(Nn);return Fn?Pn.link(Fn):"null"})}else if(eh in It){ct=!0;var xn=It[eh];return uu(xn,function(Pn,Fn){var kn=Pn.invoke(Fn,xn);return Fn.def(Pn.shared.vao+".getVAO("+kn+")")})}return null}var xt=Xe(),Te=!1;function et(){if(_u in it){var Nn=it[_u];if(Ht.elements=Nn,zh(Nn)){var xn=Ht.elements=Yt.create(Nn,!0);Nn=Yt.getElements(xn),Te=!0}else Nn&&(Nn=Yt.getElements(Nn),Te=!0,N.command(Nn,"invalid elements",ge.commandStr));var Pn=ko(function(kn,hi){if(Nn){var Aa=kn.link(Nn);return kn.ELEMENTS=Aa,Aa}return kn.ELEMENTS=null,null});return Pn.value=Nn,Pn}else if(_u in It){Te=!0;var Fn=It[_u];return uu(Fn,function(kn,hi){var Aa=kn.shared,cs=Aa.isBufferArgs,Ji=Aa.elements,Ea=kn.invoke(hi,Fn),Pl=hi.def("null"),Hs=hi.def(cs,"(",Ea,")"),sn=kn.cond(Hs).then(Pl,"=",Ji,".createStream(",Ea,");").else(Pl,"=",Ji,".getElements(",Ea,");");return N.optional(function(){kn.assert(sn.else,"!"+Ea+"||"+Pl,"invalid elements")}),hi.entry(sn),hi.exit(kn.cond(Hs).then(Ji,".destroyStream(",Pl,");")),kn.ELEMENTS=Pl,Pl})}else if(ct)return new ga(xt.thisDep,xt.contextDep,xt.propDep,function(kn,hi){return hi.def(kn.shared.vao+".currentVAO?"+kn.shared.elements+".getElements("+kn.shared.vao+".currentVAO.elements):null")});return null}var Be=et();function Mt(){if(No in it){var Nn=it[No];return Ht.primitive=Nn,N.commandParameter(Nn,yr,"invalid primitve",ge.commandStr),ko(function(Pn,Fn){return yr[Nn]})}else if(No in It){var xn=It[No];return uu(xn,function(Pn,Fn){var kn=Pn.constants.primTypes,hi=Pn.invoke(Fn,xn);return N.optional(function(){Pn.assert(Fn,hi+" in "+kn,"invalid primitive, must be one of "+Object.keys(yr))}),Fn.def(kn,"[",hi,"]")})}else{if(Te)return nc(Be)?Be.value?ko(function(Pn,Fn){return Fn.def(Pn.ELEMENTS,".primType")}):ko(function(){return Lf}):new ga(Be.thisDep,Be.contextDep,Be.propDep,function(Pn,Fn){var kn=Pn.ELEMENTS;return Fn.def(kn,"?",kn,".primType:",Lf)});if(ct)return new ga(xt.thisDep,xt.contextDep,xt.propDep,function(Pn,Fn){return Fn.def(Pn.shared.vao+".currentVAO?"+Pn.shared.vao+".currentVAO.primitive:"+Lf)})}return null}function Ut(Nn,xn){if(Nn in it){var Pn=it[Nn]|0;return xn?Ht.offset=Pn:Ht.instances=Pn,N.command(!xn||Pn>=0,"invalid "+Nn,ge.commandStr),ko(function(kn,hi){return xn&&(kn.OFFSET=Pn),Pn})}else if(Nn in It){var Fn=It[Nn];return uu(Fn,function(kn,hi){var Aa=kn.invoke(hi,Fn);return xn&&(kn.OFFSET=Aa,N.optional(function(){kn.assert(hi,Aa+">=0","invalid "+Nn)})),Aa})}else if(xn){if(Te)return ko(function(kn,hi){return kn.OFFSET=0,0});if(ct)return new ga(xt.thisDep,xt.contextDep,xt.propDep,function(kn,hi){return hi.def(kn.shared.vao+".currentVAO?"+kn.shared.vao+".currentVAO.offset:0")})}else if(ct)return new ga(xt.thisDep,xt.contextDep,xt.propDep,function(kn,hi){return hi.def(kn.shared.vao+".currentVAO?"+kn.shared.vao+".currentVAO.instances:-1")});return null}var Ir=Ut(Rh,!0);function nn(){if(ec in it){var Nn=it[ec]|0;return Ht.count=Nn,N.command(typeof Nn=="number"&&Nn>=0,"invalid vertex count",ge.commandStr),ko(function(){return Nn})}else if(ec in It){var xn=It[ec];return uu(xn,function(hi,Aa){var cs=hi.invoke(Aa,xn);return N.optional(function(){hi.assert(Aa,"typeof "+cs+'==="number"&&'+cs+">=0&&"+cs+"===("+cs+"|0)","invalid vertex count")}),cs})}else if(Te)if(nc(Be)){if(Be)return Ir?new ga(Ir.thisDep,Ir.contextDep,Ir.propDep,function(hi,Aa){var cs=Aa.def(hi.ELEMENTS,".vertCount-",hi.OFFSET);return N.optional(function(){hi.assert(Aa,cs+">=0","invalid vertex offset/element buffer too small")}),cs}):ko(function(hi,Aa){return Aa.def(hi.ELEMENTS,".vertCount")});var Pn=ko(function(){return-1});return N.optional(function(){Pn.MISSING=!0}),Pn}else{var Fn=new ga(Be.thisDep||Ir.thisDep,Be.contextDep||Ir.contextDep,Be.propDep||Ir.propDep,function(hi,Aa){var cs=hi.ELEMENTS;return hi.OFFSET?Aa.def(cs,"?",cs,".vertCount-",hi.OFFSET,":-1"):Aa.def(cs,"?",cs,".vertCount:-1")});return N.optional(function(){Fn.DYNAMIC=!0}),Fn}else if(ct){var kn=new ga(xt.thisDep,xt.contextDep,xt.propDep,function(hi,Aa){return Aa.def(hi.shared.vao,".currentVAO?",hi.shared.vao,".currentVAO.count:-1")});return kn}return null}var an=Mt(),gn=nn(),Jr=Ut(Oh,!1);return{elements:Be,primitive:an,count:gn,instances:Jr,offset:Ir,vao:xt,vaoActive:ct,elementsActive:Te,static:Ht}}function co(Oe,ge){var it=Oe.static,It=Oe.dynamic,Ht={};return Kn.forEach(function(ct){var Xe=Dn(ct);function xt(Te,et){if(ct in it){var Be=Te(it[ct]);Ht[Xe]=ko(function(){return Be})}else if(ct in It){var Mt=It[ct];Ht[Xe]=uu(Mt,function(Ut,Ir){return et(Ut,Ir,Ut.invoke(Ir,Mt))})}}switch(ct){case Fs:case Ls:case lo:case ma:case yu:case qc:case $u:case ku:case Yu:case il:return xt(function(Te){return N.commandType(Te,"boolean",ct,ge.commandStr),Te},function(Te,et,Be){return N.optional(function(){Te.assert(et,"typeof "+Be+'==="boolean"',"invalid flag "+ct,Te.commandStr)}),Be});case iu:return xt(function(Te){return N.commandParameter(Te,Bf,"invalid "+ct,ge.commandStr),Bf[Te]},function(Te,et,Be){var Mt=Te.constants.compareFuncs;return N.optional(function(){Te.assert(et,Be+" in "+Mt,"invalid "+ct+", must be one of "+Object.keys(Bf))}),et.def(Mt,"[",Be,"]")});case bc:return xt(function(Te){return N.command(mo(Te)&&Te.length===2&&typeof Te[0]=="number"&&typeof Te[1]=="number"&&Te[0]<=Te[1],"depth range is 2d array",ge.commandStr),Te},function(Te,et,Be){N.optional(function(){Te.assert(et,Te.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var Mt=et.def("+",Be,"[0]"),Ut=et.def("+",Be,"[1]");return[Mt,Ut]});case ss:return xt(function(Te){N.commandType(Te,"object","blend.func",ge.commandStr);var et="srcRGB"in Te?Te.srcRGB:Te.src,Be="srcAlpha"in Te?Te.srcAlpha:Te.src,Mt="dstRGB"in Te?Te.dstRGB:Te.dst,Ut="dstAlpha"in Te?Te.dstAlpha:Te.dst;return N.commandParameter(et,qu,Xe+".srcRGB",ge.commandStr),N.commandParameter(Be,qu,Xe+".srcAlpha",ge.commandStr),N.commandParameter(Mt,qu,Xe+".dstRGB",ge.commandStr),N.commandParameter(Ut,qu,Xe+".dstAlpha",ge.commandStr),N.command(Ml.indexOf(et+", "+Mt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+et+", "+Mt+")",ge.commandStr),[qu[et],qu[Mt],qu[Be],qu[Ut]]},function(Te,et,Be){var Mt=Te.constants.blendFuncs;N.optional(function(){Te.assert(et,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Ut(xn,Pn){var Fn=et.def('"',xn,Pn,'" in ',Be,"?",Be,".",xn,Pn,":",Be,".",xn);return N.optional(function(){Te.assert(et,Fn+" in "+Mt,"invalid "+ct+"."+xn+Pn+", must be one of "+Object.keys(qu))}),Fn}var Ir=Ut("src","RGB"),nn=Ut("dst","RGB");N.optional(function(){var xn=Te.constants.invalidBlendCombinations;Te.assert(et,xn+".indexOf("+Ir+'+", "+'+nn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var an=et.def(Mt,"[",Ir,"]"),gn=et.def(Mt,"[",Ut("src","Alpha"),"]"),Jr=et.def(Mt,"[",nn,"]"),Nn=et.def(Mt,"[",Ut("dst","Alpha"),"]");return[an,Jr,gn,Nn]});case Vs:return xt(function(Te){if(typeof Te=="string")return N.commandParameter(Te,ar,"invalid "+ct,ge.commandStr),[ar[Te],ar[Te]];if(typeof Te=="object")return N.commandParameter(Te.rgb,ar,ct+".rgb",ge.commandStr),N.commandParameter(Te.alpha,ar,ct+".alpha",ge.commandStr),[ar[Te.rgb],ar[Te.alpha]];N.commandRaise("invalid blend.equation",ge.commandStr)},function(Te,et,Be){var Mt=Te.constants.blendEquations,Ut=et.def(),Ir=et.def(),nn=Te.cond("typeof ",Be,'==="string"');return N.optional(function(){function an(gn,Jr,Nn){Te.assert(gn,Nn+" in "+Mt,"invalid "+Jr+", must be one of "+Object.keys(ar))}an(nn.then,ct,Be),Te.assert(nn.else,Be+"&&typeof "+Be+'==="object"',"invalid "+ct),an(nn.else,ct+".rgb",Be+".rgb"),an(nn.else,ct+".alpha",Be+".alpha")}),nn.then(Ut,"=",Ir,"=",Mt,"[",Be,"];"),nn.else(Ut,"=",Mt,"[",Be,".rgb];",Ir,"=",Mt,"[",Be,".alpha];"),et(nn),[Ut,Ir]});case ys:return xt(function(Te){return N.command(mo(Te)&&Te.length===4,"blend.color must be a 4d array",ge.commandStr),tt(4,function(et){return+Te[et]})},function(Te,et,Be){return N.optional(function(){Te.assert(et,Te.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),tt(4,function(Mt){return et.def("+",Be,"[",Mt,"]")})});case js:return xt(function(Te){return N.commandType(Te,"number",Xe,ge.commandStr),Te|0},function(Te,et,Be){return N.optional(function(){Te.assert(et,"typeof "+Be+'==="number"',"invalid stencil.mask")}),et.def(Be,"|0")});case _s:return xt(function(Te){N.commandType(Te,"object",Xe,ge.commandStr);var et=Te.cmp||"keep",Be=Te.ref||0,Mt="mask"in Te?Te.mask:-1;return N.commandParameter(et,Bf,ct+".cmp",ge.commandStr),N.commandType(Be,"number",ct+".ref",ge.commandStr),N.commandType(Mt,"number",ct+".mask",ge.commandStr),[Bf[et],Be,Mt]},function(Te,et,Be){var Mt=Te.constants.compareFuncs;N.optional(function(){function an(){Te.assert(et,Array.prototype.join.call(arguments,""),"invalid stencil.func")}an(Be+"&&typeof ",Be,'==="object"'),an('!("cmp" in ',Be,")||(",Be,".cmp in ",Mt,")")});var Ut=et.def('"cmp" in ',Be,"?",Mt,"[",Be,".cmp]",":",xu),Ir=et.def(Be,".ref|0"),nn=et.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Ut,Ir,nn]});case al:case Yc:return xt(function(Te){N.commandType(Te,"object",Xe,ge.commandStr);var et=Te.fail||"keep",Be=Te.zfail||"keep",Mt=Te.zpass||"keep";return N.commandParameter(et,rc,ct+".fail",ge.commandStr),N.commandParameter(Be,rc,ct+".zfail",ge.commandStr),N.commandParameter(Mt,rc,ct+".zpass",ge.commandStr),[ct===Yc?ul:Gs,rc[et],rc[Be],rc[Mt]]},function(Te,et,Be){var Mt=Te.constants.stencilOps;N.optional(function(){Te.assert(et,Be+"&&typeof "+Be+'==="object"',"invalid "+ct)});function Ut(Ir){return N.optional(function(){Te.assert(et,'!("'+Ir+'" in '+Be+")||("+Be+"."+Ir+" in "+Mt+")","invalid "+ct+"."+Ir+", must be one of "+Object.keys(rc))}),et.def('"',Ir,'" in ',Be,"?",Mt,"[",Be,".",Ir,"]:",xu)}return[ct===Yc?ul:Gs,Ut("fail"),Ut("zfail"),Ut("zpass")]});case Bo:return xt(function(Te){N.commandType(Te,"object",Xe,ge.commandStr);var et=Te.factor|0,Be=Te.units|0;return N.commandType(et,"number",Xe+".factor",ge.commandStr),N.commandType(Be,"number",Xe+".units",ge.commandStr),[et,Be]},function(Te,et,Be){N.optional(function(){Te.assert(et,Be+"&&typeof "+Be+'==="object"',"invalid "+ct)});var Mt=et.def(Be,".factor|0"),Ut=et.def(Be,".units|0");return[Mt,Ut]});case Ql:return xt(function(Te){var et=0;return Te==="front"?et=Gs:Te==="back"&&(et=ul),N.command(!!et,Xe,ge.commandStr),et},function(Te,et,Be){return N.optional(function(){Te.assert(et,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),et.def(Be,'==="front"?',Gs,":",ul)});case Jl:return xt(function(Te){return N.command(typeof Te=="number"&&Te>=$t.lineWidthDims[0]&&Te<=$t.lineWidthDims[1],"invalid line width, must be a positive number between "+$t.lineWidthDims[0]+" and "+$t.lineWidthDims[1],ge.commandStr),Te},function(Te,et,Be){return N.optional(function(){Te.assert(et,"typeof "+Be+'==="number"&&'+Be+">="+$t.lineWidthDims[0]+"&&"+Be+"<="+$t.lineWidthDims[1],"invalid line width")}),Be});case Mu:return xt(function(Te){return N.commandParameter(Te,vp,Xe,ge.commandStr),vp[Te]},function(Te,et,Be){return N.optional(function(){Te.assert(et,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),et.def(Be+'==="cw"?'+Kp+":"+Nh)});case Xu:return xt(function(Te){return N.command(mo(Te)&&Te.length===4,"color.mask must be length 4 array",ge.commandStr),Te.map(function(et){return!!et})},function(Te,et,Be){return N.optional(function(){Te.assert(et,Te.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),tt(4,function(Mt){return"!!"+Be+"["+Mt+"]"})});case wl:return xt(function(Te){N.command(typeof Te=="object"&&Te,Xe,ge.commandStr);var et="value"in Te?Te.value:1,Be=!!Te.invert;return N.command(typeof et=="number"&&et>=0&&et<=1,"sample.coverage.value must be a number between 0 and 1",ge.commandStr),[et,Be]},function(Te,et,Be){N.optional(function(){Te.assert(et,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var Mt=et.def('"value" in ',Be,"?+",Be,".value:1"),Ut=et.def("!!",Be,".invert");return[Mt,Ut]})}}),Ht}function Ti(Oe,ge){var it=Oe.static,It=Oe.dynamic,Ht={};return Object.keys(it).forEach(function(ct){var Xe=it[ct],xt;if(typeof Xe=="number"||typeof Xe=="boolean")xt=ko(function(){return Xe});else if(typeof Xe=="function"){var Te=Xe._reglType;Te==="texture2d"||Te==="textureCube"?xt=ko(function(et){return et.link(Xe)}):Te==="framebuffer"||Te==="framebufferCube"?(N.command(Xe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ct+'"',ge.commandStr),xt=ko(function(et){return et.link(Xe.color[0])})):N.commandRaise('invalid data for uniform "'+ct+'"',ge.commandStr)}else mo(Xe)?xt=ko(function(et){var Be=et.global.def("[",tt(Xe.length,function(Mt){return N.command(typeof Xe[Mt]=="number"||typeof Xe[Mt]=="boolean","invalid uniform "+ct,et.commandStr),Xe[Mt]}),"]");return Be}):N.commandRaise('invalid or missing data for uniform "'+ct+'"',ge.commandStr);xt.value=Xe,Ht[ct]=xt}),Object.keys(It).forEach(function(ct){var Xe=It[ct];Ht[ct]=uu(Xe,function(xt,Te){return xt.invoke(Te,Xe)})}),Ht}function ls(Oe,ge){var it=Oe.static,It=Oe.dynamic,Ht={};return Object.keys(it).forEach(function(ct){var Xe=it[ct],xt=Ae.id(ct),Te=new At;if(zh(Xe))Te.state=ai,Te.buffer=Cr.getBuffer(Cr.create(Xe,Vr,!1,!0)),Te.type=0;else{var et=Cr.getBuffer(Xe);if(et)Te.state=ai,Te.buffer=et,Te.type=0;else if(N.command(typeof Xe=="object"&&Xe,"invalid data for attribute "+ct,ge.commandStr),"constant"in Xe){var Be=Xe.constant;Te.buffer="null",Te.state=Ai,typeof Be=="number"?Te.x=Be:(N.command(mo(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+ct,ge.commandStr),wi.forEach(function(Jr,Nn){Nn<Be.length&&(Te[Jr]=Be[Nn])}))}else{zh(Xe.buffer)?et=Cr.getBuffer(Cr.create(Xe.buffer,Vr,!1,!0)):et=Cr.getBuffer(Xe.buffer),N.command(!!et,'missing buffer for attribute "'+ct+'"',ge.commandStr);var Mt=Xe.offset|0;N.command(Mt>=0,'invalid offset for attribute "'+ct+'"',ge.commandStr);var Ut=Xe.stride|0;N.command(Ut>=0&&Ut<256,'invalid stride for attribute "'+ct+'", must be integer betweeen [0, 255]',ge.commandStr);var Ir=Xe.size|0;N.command(!("size"in Xe)||Ir>0&&Ir<=4,'invalid size for attribute "'+ct+'", must be 1,2,3,4',ge.commandStr);var nn=!!Xe.normalized,an=0;"type"in Xe&&(N.commandParameter(Xe.type,hu,"invalid type for attribute "+ct,ge.commandStr),an=hu[Xe.type]);var gn=Xe.divisor|0;N.optional(function(){"divisor"in Xe&&(N.command(gn===0||Zr,'cannot specify divisor for attribute "'+ct+'", instancing not supported',ge.commandStr),N.command(gn>=0,'invalid divisor for attribute "'+ct+'"',ge.commandStr));var Jr=ge.commandStr,Nn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Xe).forEach(function(xn){N.command(Nn.indexOf(xn)>=0,'unknown parameter "'+xn+'" for attribute pointer "'+ct+'" (valid parameters are '+Nn+")",Jr)})}),Te.buffer=et,Te.state=ai,Te.size=Ir,Te.normalized=nn,Te.type=an||et.dtype,Te.offset=Mt,Te.stride=Ut,Te.divisor=gn}}Ht[ct]=ko(function(Jr,Nn){var xn=Jr.attribCache;if(xt in xn)return xn[xt];var Pn={isStream:!1};return Object.keys(Te).forEach(function(Fn){Pn[Fn]=Te[Fn]}),Te.buffer&&(Pn.buffer=Jr.link(Te.buffer),Pn.type=Pn.type||Pn.buffer+".dtype"),xn[xt]=Pn,Pn})}),Object.keys(It).forEach(function(ct){var Xe=It[ct];function xt(Te,et){var Be=Te.invoke(et,Xe),Mt=Te.shared,Ut=Te.constants,Ir=Mt.isBufferArgs,nn=Mt.buffer;N.optional(function(){Te.assert(et,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+Ir+"("+Be+")||"+nn+".getBuffer("+Be+")||"+nn+".getBuffer("+Be+".buffer)||"+Ir+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+Mt.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+ct+'"')});var an={isStream:et.def(!1)},gn=new At;gn.state=ai,Object.keys(gn).forEach(function(Pn){an[Pn]=et.def(""+gn[Pn])});var Jr=an.buffer,Nn=an.type;et("if(",Ir,"(",Be,")){",an.isStream,"=true;",Jr,"=",nn,".createStream(",Vr,",",Be,");",Nn,"=",Jr,".dtype;","}else{",Jr,"=",nn,".getBuffer(",Be,");","if(",Jr,"){",Nn,"=",Jr,".dtype;",'}else if("constant" in ',Be,"){",an.state,"=",Ai,";","if(typeof "+Be+'.constant === "number"){',an[wi[0]],"=",Be,".constant;",wi.slice(1).map(function(Pn){return an[Pn]}).join("="),"=0;","}else{",wi.map(function(Pn,Fn){return an[Pn]+"="+Be+".constant.length>"+Fn+"?"+Be+".constant["+Fn+"]:0;"}).join(""),"}}else{","if(",Ir,"(",Be,".buffer)){",Jr,"=",nn,".createStream(",Vr,",",Be,".buffer);","}else{",Jr,"=",nn,".getBuffer(",Be,".buffer);","}",Nn,'="type" in ',Be,"?",Ut.glTypes,"[",Be,".type]:",Jr,".dtype;",an.normalized,"=!!",Be,".normalized;");function xn(Pn){et(an[Pn],"=",Be,".",Pn,"|0;")}return xn("size"),xn("offset"),xn("stride"),xn("divisor"),et("}}"),et.exit("if(",an.isStream,"){",nn,".destroyStream(",Jr,");","}"),an}Ht[ct]=uu(Xe,xt)}),Ht}function Ha(Oe){var ge=Oe.static,it=Oe.dynamic,It={};return Object.keys(ge).forEach(function(Ht){var ct=ge[Ht];It[Ht]=ko(function(Xe,xt){return typeof ct=="number"||typeof ct=="boolean"?""+ct:Xe.link(ct)})}),Object.keys(it).forEach(function(Ht){var ct=it[Ht];It[Ht]=uu(ct,function(Xe,xt){return Xe.invoke(xt,ct)})}),It}function Wo(Oe,ge,it,It,Ht){var ct=Oe.static,Xe=Oe.dynamic;N.optional(function(){var xn=[ou,Cl,Kc,_u,No,Rh,ec,Oh,ol,eh].concat(Kn);function Pn(Fn){Object.keys(Fn).forEach(function(kn){N.command(xn.indexOf(kn)>=0,'unknown parameter "'+kn+'"',Ht.commandStr)})}Pn(ct),Pn(Xe)});var xt=bi(Oe,ge),Te=mn(Oe,Ht),et=li(Oe,Te,Ht),Be=ro(Oe,Ht),Mt=co(Oe,Ht),Ut=Ui(Oe,Ht,xt);function Ir(xn){var Pn=et[xn];Pn&&(Mt[xn]=Pn)}Ir(au),Ir(Dn(Cf));var nn=Object.keys(Mt).length>0,an={framebuffer:Te,draw:Be,shader:Ut,state:Mt,dirty:nn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(an.profile=fn(Oe,Ht),an.uniforms=Ti(it,Ht),an.drawVAO=an.scopeVAO=Be.vao,!an.drawVAO&&Ut.program&&!xt&&$e.angle_instanced_arrays&&Be.static.elements){var gn=!0,Jr=Ut.program.attributes.map(function(xn){var Pn=ge.static[xn];return gn=gn&&!!Pn,Pn});if(gn&&Jr.length>0){var Nn=Nr.getVAO(Nr.createVAO({attributes:Jr,elements:Be.static.elements}));an.drawVAO=new ga(null,null,null,function(xn,Pn){return xn.link(Nn)}),an.useVAO=!0}}return xt?an.useVAO=!0:an.attributes=ls(ge,Ht),an.context=Ha(It,Ht),an}function yo(Oe,ge,it){var It=Oe.shared,Ht=It.context,ct=Oe.scope();Object.keys(it).forEach(function(Xe){ge.save(Ht,"."+Xe);var xt=it[Xe],Te=xt.append(Oe,ge);Array.isArray(Te)?ct(Ht,".",Xe,"=[",Te.join(),"];"):ct(Ht,".",Xe,"=",Te,";")}),ge(ct)}function zo(Oe,ge,it,It){var Ht=Oe.shared,ct=Ht.gl,Xe=Ht.framebuffer,xt;on&&(xt=ge.def(Ht.extensions,".webgl_draw_buffers"));var Te=Oe.constants,et=Te.drawBuffer,Be=Te.backBuffer,Mt;it?Mt=it.append(Oe,ge):Mt=ge.def(Xe,".next"),It||ge("if(",Mt,"!==",Xe,".cur){"),ge("if(",Mt,"){",ct,".bindFramebuffer(",Qp,",",Mt,".framebuffer);"),on&&ge(xt,".drawBuffersWEBGL(",et,"[",Mt,".colorAttachments.length]);"),ge("}else{",ct,".bindFramebuffer(",Qp,",null);"),on&&ge(xt,".drawBuffersWEBGL(",Be,");"),ge("}",Xe,".cur=",Mt,";"),It||ge("}")}function Xo(Oe,ge,it){var It=Oe.shared,Ht=It.gl,ct=Oe.current,Xe=Oe.next,xt=It.current,Te=It.next,et=Oe.cond(xt,".dirty");Kn.forEach(function(Be){var Mt=Dn(Be);if(!(Mt in it.state)){var Ut,Ir;if(Mt in Xe){Ut=Xe[Mt],Ir=ct[Mt];var nn=tt($r[Mt].length,function(gn){return et.def(Ut,"[",gn,"]")});et(Oe.cond(nn.map(function(gn,Jr){return gn+"!=="+Ir+"["+Jr+"]"}).join("||")).then(Ht,".",Er[Mt],"(",nn,");",nn.map(function(gn,Jr){return Ir+"["+Jr+"]="+gn}).join(";"),";"))}else{Ut=et.def(Te,".",Mt);var an=Oe.cond(Ut,"!==",xt,".",Mt);et(an),Mt in mr?an(Oe.cond(Ut).then(Ht,".enable(",mr[Mt],");").else(Ht,".disable(",mr[Mt],");"),xt,".",Mt,"=",Ut,";"):an(Ht,".",Er[Mt],"(",Ut,");",xt,".",Mt,"=",Ut,";")}}}),Object.keys(it.state).length===0&&et(xt,".dirty=false;"),ge(et)}function xs(Oe,ge,it,It){var Ht=Oe.shared,ct=Oe.current,Xe=Ht.current,xt=Ht.gl;mp(Object.keys(it)).forEach(function(Te){var et=it[Te];if(!(It&&!It(et))){var Be=et.append(Oe,ge);if(mr[Te]){var Mt=mr[Te];nc(et)?Be?ge(xt,".enable(",Mt,");"):ge(xt,".disable(",Mt,");"):ge(Oe.cond(Be).then(xt,".enable(",Mt,");").else(xt,".disable(",Mt,");")),ge(Xe,".",Te,"=",Be,";")}else if(mo(Be)){var Ut=ct[Te];ge(xt,".",Er[Te],"(",Be,");",Be.map(function(Ir,nn){return Ut+"["+nn+"]="+Ir}).join(";"),";")}else ge(xt,".",Er[Te],"(",Be,");",Xe,".",Te,"=",Be,";")}})}function _o(Oe,ge){Zr&&(Oe.instancing=ge.def(Oe.shared.extensions,".angle_instanced_arrays"))}function Mi(Oe,ge,it,It,Ht){var ct=Oe.shared,Xe=Oe.stats,xt=ct.current,Te=ct.timer,et=it.profile;function Be(){var xn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return xn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Mt,Ut;function Ir(xn){Mt=ge.def(),xn(Mt,"=",Be(),";"),typeof Ht=="string"?xn(Xe,".count+=",Ht,";"):xn(Xe,".count++;"),zr&&(It?(Ut=ge.def(),xn(Ut,"=",Te,".getNumPendingQueries();")):xn(Te,".beginQuery(",Xe,");"))}function nn(xn){xn(Xe,".cpuTime+=",Be(),"-",Mt,";"),zr&&(It?xn(Te,".pushScopeStats(",Ut,",",Te,".getNumPendingQueries(),",Xe,");"):xn(Te,".endQuery();"))}function an(xn){var Pn=ge.def(xt,".profile");ge(xt,".profile=",xn,";"),ge.exit(xt,".profile=",Pn,";")}var gn;if(et){if(nc(et)){et.enable?(Ir(ge),nn(ge.exit),an("true")):an("false");return}gn=et.append(Oe,ge),an(gn)}else gn=ge.def(xt,".profile");var Jr=Oe.block();Ir(Jr),ge("if(",gn,"){",Jr,"}");var Nn=Oe.block();nn(Nn),ge.exit("if(",gn,"){",Nn,"}")}function Io(Oe,ge,it,It,Ht){var ct=Oe.shared;function Xe(Te){switch(Te){case th:case Dh:case Bh:return 2;case wc:case Al:case Of:return 3;case ef:case rh:case Tl:return 4;default:return 1}}function xt(Te,et,Be){var Mt=ct.gl,Ut=ge.def(Te,".location"),Ir=ge.def(ct.attributes,"[",Ut,"]"),nn=Be.state,an=Be.buffer,gn=[Be.x,Be.y,Be.z,Be.w],Jr=["buffer","normalized","offset","stride"];function Nn(){ge("if(!",Ir,".buffer){",Mt,".enableVertexAttribArray(",Ut,");}");var Pn=Be.type,Fn;if(Be.size?Fn=ge.def(Be.size,"||",et):Fn=et,ge("if(",Ir,".type!==",Pn,"||",Ir,".size!==",Fn,"||",Jr.map(function(hi){return Ir+"."+hi+"!=="+Be[hi]}).join("||"),"){",Mt,".bindBuffer(",Vr,",",an,".buffer);",Mt,".vertexAttribPointer(",[Ut,Fn,Pn,Be.normalized,Be.stride,Be.offset],");",Ir,".type=",Pn,";",Ir,".size=",Fn,";",Jr.map(function(hi){return Ir+"."+hi+"="+Be[hi]+";"}).join(""),"}"),Zr){var kn=Be.divisor;ge("if(",Ir,".divisor!==",kn,"){",Oe.instancing,".vertexAttribDivisorANGLE(",[Ut,kn],");",Ir,".divisor=",kn,";}")}}function xn(){ge("if(",Ir,".buffer){",Mt,".disableVertexAttribArray(",Ut,");",Ir,".buffer=null;","}if(",wi.map(function(Pn,Fn){return Ir+"."+Pn+"!=="+gn[Fn]}).join("||"),"){",Mt,".vertexAttrib4f(",Ut,",",gn,");",wi.map(function(Pn,Fn){return Ir+"."+Pn+"="+gn[Fn]+";"}).join(""),"}")}nn===ai?Nn():nn===Ai?xn():(ge("if(",nn,"===",ai,"){"),Nn(),ge("}else{"),xn(),ge("}"))}It.forEach(function(Te){var et=Te.name,Be=it.attributes[et],Mt;if(Be){if(!Ht(Be))return;Mt=Be.append(Oe,ge)}else{if(!Ht(td))return;var Ut=Oe.scopeAttrib(et);N.optional(function(){Oe.assert(ge,Ut+".state","missing attribute "+et)}),Mt={},Object.keys(new At).forEach(function(Ir){Mt[Ir]=ge.def(Ut,".",Ir)})}xt(Oe.link(Te),Xe(Te.info.type),Mt)})}function ia(Oe,ge,it,It,Ht,ct){for(var Xe=Oe.shared,xt=Xe.gl,Te,et=0;et<It.length;++et){var Be=It[et],Mt=Be.name,Ut=Be.info.type,Ir=it.uniforms[Mt],nn=Oe.link(Be),an=nn+".location",gn;if(Ir){if(!Ht(Ir))continue;if(nc(Ir)){var Jr=Ir.value;if(N.command(Jr!==null&&typeof Jr!="undefined",'missing uniform "'+Mt+'"',Oe.commandStr),Ut===oh||Ut===sh){N.command(typeof Jr=="function"&&(Ut===oh&&(Jr._reglType==="texture2d"||Jr._reglType==="framebuffer")||Ut===sh&&(Jr._reglType==="textureCube"||Jr._reglType==="framebufferCube")),"invalid texture for uniform "+Mt,Oe.commandStr);var Nn=Oe.link(Jr._texture||Jr.color[0]._texture);ge(xt,".uniform1i(",an,",",Nn+".bind());"),ge.exit(Nn,".unbind();")}else if(Ut===su||Ut===ih||Ut===ah){N.optional(function(){N.command(mo(Jr),"invalid matrix for uniform "+Mt,Oe.commandStr),N.command(Ut===su&&Jr.length===4||Ut===ih&&Jr.length===9||Ut===ah&&Jr.length===16,"invalid length for matrix uniform "+Mt,Oe.commandStr)});var xn=Oe.global.def("new Float32Array(["+Array.prototype.slice.call(Jr)+"])"),Pn=2;Ut===ih?Pn=3:Ut===ah&&(Pn=4),ge(xt,".uniformMatrix",Pn,"fv(",an,",false,",xn,");")}else{switch(Ut){case Fh:N.commandType(Jr,"number","uniform "+Mt,Oe.commandStr),Te="1f";break;case th:N.command(mo(Jr)&&Jr.length===2,"uniform "+Mt,Oe.commandStr),Te="2f";break;case wc:N.command(mo(Jr)&&Jr.length===3,"uniform "+Mt,Oe.commandStr),Te="3f";break;case ef:N.command(mo(Jr)&&Jr.length===4,"uniform "+Mt,Oe.commandStr),Te="4f";break;case nh:N.commandType(Jr,"boolean","uniform "+Mt,Oe.commandStr),Te="1i";break;case Rf:N.commandType(Jr,"number","uniform "+Mt,Oe.commandStr),Te="1i";break;case Bh:N.command(mo(Jr)&&Jr.length===2,"uniform "+Mt,Oe.commandStr),Te="2i";break;case Dh:N.command(mo(Jr)&&Jr.length===2,"uniform "+Mt,Oe.commandStr),Te="2i";break;case Of:N.command(mo(Jr)&&Jr.length===3,"uniform "+Mt,Oe.commandStr),Te="3i";break;case Al:N.command(mo(Jr)&&Jr.length===3,"uniform "+Mt,Oe.commandStr),Te="3i";break;case Tl:N.command(mo(Jr)&&Jr.length===4,"uniform "+Mt,Oe.commandStr),Te="4i";break;case rh:N.command(mo(Jr)&&Jr.length===4,"uniform "+Mt,Oe.commandStr),Te="4i";break}ge(xt,".uniform",Te,"(",an,",",mo(Jr)?Array.prototype.slice.call(Jr):Jr,");")}continue}else gn=Ir.append(Oe,ge)}else{if(!Ht(td))continue;gn=ge.def(Xe.uniforms,"[",Ae.id(Mt),"]")}Ut===oh?(N(!Array.isArray(gn),"must specify a scalar prop for textures"),ge("if(",gn,"&&",gn,'._reglType==="framebuffer"){',gn,"=",gn,".color[0];","}")):Ut===sh&&(N(!Array.isArray(gn),"must specify a scalar prop for cube maps"),ge("if(",gn,"&&",gn,'._reglType==="framebufferCube"){',gn,"=",gn,".color[0];","}")),N.optional(function(){function Hs(Lu,Cc){Oe.assert(ge,Lu,'bad data or missing for uniform "'+Mt+'".  '+Cc)}function sn(Lu){N(!Array.isArray(gn),"must not specify an array type for uniform"),Hs("typeof "+gn+'==="'+Lu+'"',"invalid type, expected "+Lu)}function Ou(Lu,Cc){Array.isArray(gn)?N(gn.length===Lu,"must have length "+Lu):Hs(Xe.isArrayLike+"("+gn+")&&"+gn+".length==="+Lu,"invalid vector, should have length "+Lu,Oe.commandStr)}function tr(Lu){N(!Array.isArray(gn),"must not specify a value type"),Hs("typeof "+gn+'==="function"&&'+gn+'._reglType==="texture'+(Lu===tc?"2d":"Cube")+'"',"invalid texture type",Oe.commandStr)}switch(Ut){case Rf:sn("number");break;case Dh:Ou(2,"number");break;case Al:Ou(3,"number");break;case rh:Ou(4,"number");break;case Fh:sn("number");break;case th:Ou(2,"number");break;case wc:Ou(3,"number");break;case ef:Ou(4,"number");break;case nh:sn("boolean");break;case Bh:Ou(2,"boolean");break;case Of:Ou(3,"boolean");break;case Tl:Ou(4,"boolean");break;case su:Ou(4,"number");break;case ih:Ou(9,"number");break;case ah:Ou(16,"number");break;case oh:tr(tc);break;case sh:tr(Sc);break}});var Fn=1;switch(Ut){case oh:case sh:var kn=ge.def(gn,"._texture");ge(xt,".uniform1i(",an,",",kn,".bind());"),ge.exit(kn,".unbind();");continue;case Rf:case nh:Te="1i";break;case Dh:case Bh:Te="2i",Fn=2;break;case Al:case Of:Te="3i",Fn=3;break;case rh:case Tl:Te="4i",Fn=4;break;case Fh:Te="1f";break;case th:Te="2f",Fn=2;break;case wc:Te="3f",Fn=3;break;case ef:Te="4f",Fn=4;break;case su:Te="Matrix2fv";break;case ih:Te="Matrix3fv";break;case ah:Te="Matrix4fv";break}if(Te.charAt(0)==="M"){ge(xt,".uniform",Te,"(",an,",");var hi=Math.pow(Ut-su+2,2),Aa=Oe.global.def("new Float32Array(",hi,")");Array.isArray(gn)?ge("false,(",tt(hi,function(Hs){return Aa+"["+Hs+"]="+gn[Hs]}),",",Aa,")"):ge("false,(Array.isArray(",gn,")||",gn," instanceof Float32Array)?",gn,":(",tt(hi,function(Hs){return Aa+"["+Hs+"]="+gn+"["+Hs+"]"}),",",Aa,")"),ge(");")}else if(Fn>1){for(var cs=[],Ji=[],Ea=0;Ea<Fn;++Ea)Array.isArray(gn)?Ji.push(gn[Ea]):Ji.push(ge.def(gn+"["+Ea+"]")),ct&&cs.push(ge.def());ct&&ge("if(!",Oe.batchId,"||",cs.map(function(Hs,sn){return Hs+"!=="+Ji[sn]}).join("||"),"){",cs.map(function(Hs,sn){return Hs+"="+Ji[sn]+";"}).join("")),ge(xt,".uniform",Te,"(",an,",",Ji.join(","),");"),ct&&ge("}")}else{if(N(!Array.isArray(gn),"uniform value must not be an array"),ct){var Pl=ge.def();ge("if(!",Oe.batchId,"||",Pl,"!==",gn,"){",Pl,"=",gn,";")}ge(xt,".uniform",Te,"(",an,",",gn,");"),ct&&ge("}")}}}function ns(Oe,ge,it,It){var Ht=Oe.shared,ct=Ht.gl,Xe=Ht.draw,xt=It.draw;function Te(){var Fn=xt.elements,kn,hi=ge;return Fn?((Fn.contextDep&&It.contextDynamic||Fn.propDep)&&(hi=it),kn=Fn.append(Oe,hi),xt.elementsActive&&hi("if("+kn+")"+ct+".bindBuffer("+Mf+","+kn+".buffer.buffer);")):(kn=hi.def(),hi(kn,"=",Xe,".",_u,";","if(",kn,"){",ct,".bindBuffer(",Mf,",",kn,".buffer.buffer);}","else if(",Ht.vao,".currentVAO){",kn,"=",Oe.shared.elements+".getElements("+Ht.vao,".currentVAO.elements);",Mr?"":"if("+kn+")"+ct+".bindBuffer("+Mf+","+kn+".buffer.buffer);","}")),kn}function et(){var Fn=xt.count,kn,hi=ge;return Fn?((Fn.contextDep&&It.contextDynamic||Fn.propDep)&&(hi=it),kn=Fn.append(Oe,hi),N.optional(function(){Fn.MISSING&&Oe.assert(ge,"false","missing vertex count"),Fn.DYNAMIC&&Oe.assert(hi,kn+">=0","missing vertex count")})):(kn=hi.def(Xe,".",ec),N.optional(function(){Oe.assert(hi,kn+">=0","missing vertex count")})),kn}var Be=Te();function Mt(Fn){var kn=xt[Fn];return kn?kn.contextDep&&It.contextDynamic||kn.propDep?kn.append(Oe,it):kn.append(Oe,ge):ge.def(Xe,".",Fn)}var Ut=Mt(No),Ir=Mt(Rh),nn=et();if(typeof nn=="number"){if(nn===0)return}else it("if(",nn,"){"),it.exit("}");var an,gn;Zr&&(an=Mt(Oh),gn=Oe.instancing);var Jr=Be+".type",Nn=xt.elements&&nc(xt.elements)&&!xt.vaoActive;function xn(){function Fn(){it(gn,".drawElementsInstancedANGLE(",[Ut,nn,Jr,Ir+"<<(("+Jr+"-"+mi+")>>1)",an],");")}function kn(){it(gn,".drawArraysInstancedANGLE(",[Ut,Ir,nn,an],");")}Be&&Be!=="null"?Nn?Fn():(it("if(",Be,"){"),Fn(),it("}else{"),kn(),it("}")):kn()}function Pn(){function Fn(){it(ct+".drawElements("+[Ut,nn,Jr,Ir+"<<(("+Jr+"-"+mi+")>>1)"]+");")}function kn(){it(ct+".drawArrays("+[Ut,Ir,nn]+");")}Be&&Be!=="null"?Nn?Fn():(it("if(",Be,"){"),Fn(),it("}else{"),kn(),it("}")):kn()}Zr&&(typeof an!="number"||an>=0)?typeof an=="string"?(it("if(",an,">0){"),xn(),it("}else if(",an,"<0){"),Pn(),it("}")):xn():Pn()}function gi(Oe,ge,it,It,Ht){var ct=di(),Xe=ct.proc("body",Ht);return N.optional(function(){ct.commandStr=ge.commandStr,ct.command=ct.link(ge.commandStr)}),Zr&&(ct.instancing=Xe.def(ct.shared.extensions,".angle_instanced_arrays")),Oe(ct,Xe,it,It),ct.compile().body}function Gi(Oe,ge,it,It){_o(Oe,ge),it.useVAO?it.drawVAO?ge(Oe.shared.vao,".setVAO(",it.drawVAO.append(Oe,ge),");"):ge(Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"):(ge(Oe.shared.vao,".setVAO(null);"),Io(Oe,ge,it,It.attributes,function(){return!0})),ia(Oe,ge,it,It.uniforms,function(){return!0},!1),ns(Oe,ge,ge,it)}function pa(Oe,ge){var it=Oe.proc("draw",1);_o(Oe,it),yo(Oe,it,ge.context),zo(Oe,it,ge.framebuffer),Xo(Oe,it,ge),xs(Oe,it,ge.state),Mi(Oe,it,ge,!1,!0);var It=ge.shader.progVar.append(Oe,it);if(it(Oe.shared.gl,".useProgram(",It,".program);"),ge.shader.program)Gi(Oe,it,ge,ge.shader.program);else{it(Oe.shared.vao,".setVAO(null);");var Ht=Oe.global.def("{}"),ct=it.def(It,".id"),Xe=it.def(Ht,"[",ct,"]");it(Oe.cond(Xe).then(Xe,".call(this,a0);").else(Xe,"=",Ht,"[",ct,"]=",Oe.link(function(xt){return gi(Gi,Oe,ge,xt,1)}),"(",It,");",Xe,".call(this,a0);"))}Object.keys(ge.state).length>0&&it(Oe.shared.current,".dirty=true;"),Oe.shared.vao&&it(Oe.shared.vao,".setVAO(null);")}function Po(Oe,ge,it,It){Oe.batchId="a1",_o(Oe,ge);function Ht(){return!0}Io(Oe,ge,it,It.attributes,Ht),ia(Oe,ge,it,It.uniforms,Ht,!1),ns(Oe,ge,ge,it)}function Il(Oe,ge,it,It){_o(Oe,ge);var Ht=it.contextDep,ct=ge.def(),Xe="a0",xt="a1",Te=ge.def();Oe.shared.props=Te,Oe.batchId=ct;var et=Oe.scope(),Be=Oe.scope();ge(et.entry,"for(",ct,"=0;",ct,"<",xt,";++",ct,"){",Te,"=",Xe,"[",ct,"];",Be,"}",et.exit);function Mt(Jr){return Jr.contextDep&&Ht||Jr.propDep}function Ut(Jr){return!Mt(Jr)}if(it.needsContext&&yo(Oe,Be,it.context),it.needsFramebuffer&&zo(Oe,Be,it.framebuffer),xs(Oe,Be,it.state,Mt),it.profile&&Mt(it.profile)&&Mi(Oe,Be,it,!1,!0),It)it.useVAO?it.drawVAO?Mt(it.drawVAO)?Be(Oe.shared.vao,".setVAO(",it.drawVAO.append(Oe,Be),");"):et(Oe.shared.vao,".setVAO(",it.drawVAO.append(Oe,et),");"):et(Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"):(et(Oe.shared.vao,".setVAO(null);"),Io(Oe,et,it,It.attributes,Ut),Io(Oe,Be,it,It.attributes,Mt)),ia(Oe,et,it,It.uniforms,Ut,!1),ia(Oe,Be,it,It.uniforms,Mt,!0),ns(Oe,et,Be,it);else{var Ir=Oe.global.def("{}"),nn=it.shader.progVar.append(Oe,Be),an=Be.def(nn,".id"),gn=Be.def(Ir,"[",an,"]");Be(Oe.shared.gl,".useProgram(",nn,".program);","if(!",gn,"){",gn,"=",Ir,"[",an,"]=",Oe.link(function(Jr){return gi(Po,Oe,it,Jr,2)}),"(",nn,");}",gn,".call(this,a0[",ct,"],",ct,");")}}function ze(Oe,ge){var it=Oe.proc("batch",2);Oe.batchId="0",_o(Oe,it);var It=!1,Ht=!0;Object.keys(ge.context).forEach(function(Ir){It=It||ge.context[Ir].propDep}),It||(yo(Oe,it,ge.context),Ht=!1);var ct=ge.framebuffer,Xe=!1;ct?(ct.propDep?It=Xe=!0:ct.contextDep&&It&&(Xe=!0),Xe||zo(Oe,it,ct)):zo(Oe,it,null),ge.state.viewport&&ge.state.viewport.propDep&&(It=!0);function xt(Ir){return Ir.contextDep&&It||Ir.propDep}Xo(Oe,it,ge),xs(Oe,it,ge.state,function(Ir){return!xt(Ir)}),(!ge.profile||!xt(ge.profile))&&Mi(Oe,it,ge,!1,"a1"),ge.contextDep=It,ge.needsContext=Ht,ge.needsFramebuffer=Xe;var Te=ge.shader.progVar;if(Te.contextDep&&It||Te.propDep)Il(Oe,it,ge,null);else{var et=Te.append(Oe,it);if(it(Oe.shared.gl,".useProgram(",et,".program);"),ge.shader.program)Il(Oe,it,ge,ge.shader.program);else{it(Oe.shared.vao,".setVAO(null);");var Be=Oe.global.def("{}"),Mt=it.def(et,".id"),Ut=it.def(Be,"[",Mt,"]");it(Oe.cond(Ut).then(Ut,".call(this,a0,a1);").else(Ut,"=",Be,"[",Mt,"]=",Oe.link(function(Ir){return gi(Il,Oe,ge,Ir,2)}),"(",et,");",Ut,".call(this,a0,a1);"))}}Object.keys(ge.state).length>0&&it(Oe.shared.current,".dirty=true;"),Oe.shared.vao&&it(Oe.shared.vao,".setVAO(null);")}function Jt(Oe,ge){var it=Oe.proc("scope",3);Oe.batchId="a2";var It=Oe.shared,Ht=It.current;yo(Oe,it,ge.context),ge.framebuffer&&ge.framebuffer.append(Oe,it),mp(Object.keys(ge.state)).forEach(function(Xe){var xt=ge.state[Xe],Te=xt.append(Oe,it);mo(Te)?Te.forEach(function(et,Be){it.set(Oe.next[Xe],"["+Be+"]",et)}):it.set(It.next,"."+Xe,Te)}),Mi(Oe,it,ge,!0,!0),[_u,Rh,ec,Oh,No].forEach(function(Xe){var xt=ge.draw[Xe];!xt||it.set(It.draw,"."+Xe,""+xt.append(Oe,it))}),Object.keys(ge.uniforms).forEach(function(Xe){var xt=ge.uniforms[Xe].append(Oe,it);Array.isArray(xt)&&(xt="["+xt.join()+"]"),it.set(It.uniforms,"["+Ae.id(Xe)+"]",xt)}),Object.keys(ge.attributes).forEach(function(Xe){var xt=ge.attributes[Xe].append(Oe,it),Te=Oe.scopeAttrib(Xe);Object.keys(new At).forEach(function(et){it.set(Te,"."+et,xt[et])})}),ge.scopeVAO&&it.set(It.vao,".targetVAO",ge.scopeVAO.append(Oe,it));function ct(Xe){var xt=ge.shader[Xe];xt&&it.set(It.shader,"."+Xe,xt.append(Oe,it))}ct(Cl),ct(Kc),Object.keys(ge.state).length>0&&(it(Ht,".dirty=true;"),it.exit(Ht,".dirty=true;")),it("a1(",Oe.shared.context,",a0,",Oe.batchId,");")}function Zt(Oe){if(!(typeof Oe!="object"||mo(Oe))){for(var ge=Object.keys(Oe),it=0;it<ge.length;++it)if(Kr.isDynamic(Oe[ge[it]]))return!0;return!1}}function Mn(Oe,ge,it){var It=ge.static[it];if(!It||!Zt(It))return;var Ht=Oe.global,ct=Object.keys(It),Xe=!1,xt=!1,Te=!1,et=Oe.global.def("{}");ct.forEach(function(Mt){var Ut=It[Mt];if(Kr.isDynamic(Ut)){typeof Ut=="function"&&(Ut=It[Mt]=Kr.unbox(Ut));var Ir=uu(Ut,null);Xe=Xe||Ir.thisDep,Te=Te||Ir.propDep,xt=xt||Ir.contextDep}else{switch(Ht(et,".",Mt,"="),typeof Ut){case"number":Ht(Ut);break;case"string":Ht('"',Ut,'"');break;case"object":Array.isArray(Ut)&&Ht("[",Ut.join(),"]");break;default:Ht(Oe.link(Ut));break}Ht(";")}});function Be(Mt,Ut){ct.forEach(function(Ir){var nn=It[Ir];if(!!Kr.isDynamic(nn)){var an=Mt.invoke(Ut,nn);Ut(et,".",Ir,"=",an,";")}})}ge.dynamic[it]=new Kr.DynamicVariable(Do,{thisDep:Xe,contextDep:xt,propDep:Te,ref:et,append:Be}),delete ge.static[it]}function Wi(Oe,ge,it,It,Ht){var ct=di();ct.stats=ct.link(Ht),Object.keys(ge.static).forEach(function(xt){Mn(ct,ge,xt)}),X.forEach(function(xt){Mn(ct,Oe,xt)});var Xe=Wo(Oe,ge,it,It,ct);return pa(ct,Xe),Jt(ct,Xe),ze(ct,Xe),y(ct.compile(),{destroy:function(){Xe.shader.program.destroy()}})}return{next:vn,current:$r,procs:function(){var Oe=di(),ge=Oe.proc("poll"),it=Oe.proc("refresh"),It=Oe.block();ge(It),it(It);var Ht=Oe.shared,ct=Ht.gl,Xe=Ht.next,xt=Ht.current;It(xt,".dirty=false;"),zo(Oe,ge),zo(Oe,it,null,!0);var Te;Zr&&(Te=Oe.link(Zr)),$e.oes_vertex_array_object&&it(Oe.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var et=0;et<$t.maxAttributes;++et){var Be=it.def(Ht.attributes,"[",et,"]"),Mt=Oe.cond(Be,".buffer");Mt.then(ct,".enableVertexAttribArray(",et,");",ct,".bindBuffer(",Vr,",",Be,".buffer.buffer);",ct,".vertexAttribPointer(",et,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(ct,".disableVertexAttribArray(",et,");",ct,".vertexAttrib4f(",et,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),it(Mt),Zr&&it(Te,".vertexAttribDivisorANGLE(",et,",",Be,".divisor);")}return it(Oe.shared.vao,".currentVAO=null;",Oe.shared.vao,".setVAO(",Oe.shared.vao,".targetVAO);"),Object.keys(mr).forEach(function(Ut){var Ir=mr[Ut],nn=It.def(Xe,".",Ut),an=Oe.block();an("if(",nn,"){",ct,".enable(",Ir,")}else{",ct,".disable(",Ir,")}",xt,".",Ut,"=",nn,";"),it(an),ge("if(",nn,"!==",xt,".",Ut,"){",an,"}")}),Object.keys(Er).forEach(function(Ut){var Ir=Er[Ut],nn=$r[Ut],an,gn,Jr=Oe.block();if(Jr(ct,".",Ir,"("),mo(nn)){var Nn=nn.length;an=Oe.global.def(Xe,".",Ut),gn=Oe.global.def(xt,".",Ut),Jr(tt(Nn,function(xn){return an+"["+xn+"]"}),");",tt(Nn,function(xn){return gn+"["+xn+"]="+an+"["+xn+"];"}).join("")),ge("if(",tt(Nn,function(xn){return an+"["+xn+"]!=="+gn+"["+xn+"]"}).join("||"),"){",Jr,"}")}else an=It.def(Xe,".",Ut),gn=It.def(xt,".",Ut),Jr(an,");",xt,".",Ut,"=",an,";"),ge("if(",an,"!==",gn,"){",Jr,"}");it(Jr)}),Oe.compile()}(),compile:Wi}}function Zd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var uh=34918,Ud=34919,gp=35007,lu=function(Z,Ae){if(!Ae.ext_disjoint_timer_query)return null;var $e=[];function $t(){return $e.pop()||Ae.ext_disjoint_timer_query.createQueryEXT()}function Cr(Zr){$e.push(Zr)}var Yt=[];function vr(Zr){var on=$t();Ae.ext_disjoint_timer_query.beginQueryEXT(gp,on),Yt.push(on),zr(Yt.length-1,Yt.length,Zr)}function Pr(){Ae.ext_disjoint_timer_query.endQueryEXT(gp)}function Fr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Nr=[];function Wr(){return Nr.pop()||new Fr}function Xr(Zr){Nr.push(Zr)}var ln=[];function zr(Zr,on,Mr){var $r=Wr();$r.startQueryIndex=Zr,$r.endQueryIndex=on,$r.sum=0,$r.stats=Mr,ln.push($r)}var Gr=[],At=[];function ar(){var Zr,on,Mr=Yt.length;if(Mr!==0){At.length=Math.max(At.length,Mr+1),Gr.length=Math.max(Gr.length,Mr+1),Gr[0]=0,At[0]=0;var $r=0;for(Zr=0,on=0;on<Yt.length;++on){var vn=Yt[on];Ae.ext_disjoint_timer_query.getQueryObjectEXT(vn,Ud)?($r+=Ae.ext_disjoint_timer_query.getQueryObjectEXT(vn,uh),Cr(vn)):Yt[Zr++]=vn,Gr[on+1]=$r,At[on+1]=Zr}for(Yt.length=Zr,Zr=0,on=0;on<ln.length;++on){var Kn=ln[on],mr=Kn.startQueryIndex,Er=Kn.endQueryIndex;Kn.sum+=Gr[Er]-Gr[mr];var Dn=At[mr],cn=At[Er];cn===Dn?(Kn.stats.gpuTime+=Kn.sum/1e6,Xr(Kn)):(Kn.startQueryIndex=Dn,Kn.endQueryIndex=cn,ln[Zr++]=Kn)}ln.length=Zr}}return{beginQuery:vr,endQuery:Pr,pushScopeStats:zr,update:ar,getNumPendingQueries:function(){return Yt.length},clear:function(){$e.push.apply($e,Yt);for(var Zr=0;Zr<$e.length;Zr++)Ae.ext_disjoint_timer_query.deleteQueryEXT($e[Zr]);Yt.length=0,$e.length=0},restore:function(){Yt.length=0,$e.length=0}}},yp=16384,lh=256,rd=1024,nd=34962,ch="webglcontextlost",Za="webglcontextrestored",kl=1,ic=2,rf=3;function _p(Z,Ae){for(var $e=0;$e<Z.length;++$e)if(Z[$e]===Ae)return $e;return-1}function Vd(Z){var Ae=we(Z);if(!Ae)return null;var $e=Ae.gl,$t=$e.getContextAttributes(),Cr=$e.isContextLost(),Yt=Ze($e,Ae);if(!Yt)return null;var vr=wa(),Pr=Zd(),Fr=Yt.extensions,Nr=lu($e,Fr),Wr=sa(),Xr=$e.drawingBufferWidth,ln=$e.drawingBufferHeight,zr={tick:0,time:0,viewportWidth:Xr,viewportHeight:ln,framebufferWidth:Xr,framebufferHeight:ln,drawingBufferWidth:Xr,drawingBufferHeight:ln,pixelRatio:Ae.pixelRatio},Gr={},At={elements:null,primitive:4,count:-1,offset:0,instances:-1},ar=Dl($e,Fr),Zr=z($e,Pr,Ae,$r),on=dl($e,Fr,Zr,Pr),Mr=be($e,Fr,ar,Pr,Zr,on,At);function $r(gi){return Mr.destroyBuffer(gi)}var vn=rn($e,vr,Pr,Ae),Kn=as($e,Fr,ar,function(){Dn.procs.poll()},zr,Pr,Ae),mr=$l($e,Fr,ar,Pr,Ae),Er=Ue($e,Fr,ar,Kn,mr,Pr),Dn=zd($e,vr,Fr,ar,Zr,on,Kn,Er,Gr,Mr,vn,At,zr,Nr,Ae),cn=ni($e,Er,Dn.procs.poll,zr,$t,Fr,ar),Ur=Dn.next,pn=$e.canvas,un=[],ki=[],di=[],fn=[Ae.onDestroy],mn=null;function li(){if(un.length===0){Nr&&Nr.update(),mn=null;return}mn=fi.next(li),_o();for(var gi=un.length-1;gi>=0;--gi){var Gi=un[gi];Gi&&Gi(zr,null,0)}$e.flush(),Nr&&Nr.update()}function bi(){!mn&&un.length>0&&(mn=fi.next(li))}function Ui(){mn&&(fi.cancel(li),mn=null)}function ro(gi){gi.preventDefault(),Cr=!0,Ui(),ki.forEach(function(Gi){Gi()})}function co(gi){$e.getError(),Cr=!1,Yt.restore(),vn.restore(),Zr.restore(),Kn.restore(),mr.restore(),Er.restore(),Mr.restore(),Nr&&Nr.restore(),Dn.procs.refresh(),bi(),di.forEach(function(Gi){Gi()})}var Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ti&&pn&&(pn.addEventListener(ch,ro,!1),pn.addEventListener(Za,co,!1));function ls(){un.length=0,Ui(),!Ti&&pn&&(pn.removeEventListener(ch,ro),pn.removeEventListener(Za,co)),vn.clear(),Er.clear(),mr.clear(),Mr.clear(),Kn.clear(),on.clear(),Zr.clear(),Nr&&Nr.clear(),fn.forEach(function(gi){gi()})}function Ha(gi){N(!!gi,"invalid args to regl({...})"),N.type(gi,"object","invalid args to regl({...})");function Gi(ct){var Xe=y({},ct);delete Xe.uniforms,delete Xe.attributes,delete Xe.context,delete Xe.vao,"stencil"in Xe&&Xe.stencil.op&&(Xe.stencil.opBack=Xe.stencil.opFront=Xe.stencil.op,delete Xe.stencil.op);function xt(Te){if(Te in Xe){var et=Xe[Te];delete Xe[Te],Object.keys(et).forEach(function(Be){Xe[Te+"."+Be]=et[Be]})}}return xt("blend"),xt("depth"),xt("cull"),xt("stencil"),xt("polygonOffset"),xt("scissor"),xt("sample"),"vao"in ct&&(Xe.vao=ct.vao),Xe}function pa(ct,Xe){var xt={},Te={};return Object.keys(ct).forEach(function(et){var Be=ct[et];if(Kr.isDynamic(Be)){Te[et]=Kr.unbox(Be,et);return}else if(Xe&&Array.isArray(Be)){for(var Mt=0;Mt<Be.length;++Mt)if(Kr.isDynamic(Be[Mt])){Te[et]=Kr.unbox(Be,et);return}}xt[et]=Be}),{dynamic:Te,static:xt}}var Po=pa(gi.context||{},!0),Il=pa(gi.uniforms||{},!0),ze=pa(gi.attributes||{},!1),Jt=pa(Gi(gi),!1),Zt={gpuTime:0,cpuTime:0,count:0},Mn=Dn.compile(Jt,ze,Il,Po,Zt),Wi=Mn.draw,Oe=Mn.batch,ge=Mn.scope,it=[];function It(ct){for(;it.length<ct;)it.push(null);return it}function Ht(ct,Xe){var xt;if(Cr&&N.raise("context lost"),typeof ct=="function")return ge.call(this,null,ct,0);if(typeof Xe=="function")if(typeof ct=="number")for(xt=0;xt<ct;++xt)ge.call(this,null,Xe,xt);else if(Array.isArray(ct))for(xt=0;xt<ct.length;++xt)ge.call(this,ct[xt],Xe,xt);else return ge.call(this,ct,Xe,0);else if(typeof ct=="number"){if(ct>0)return Oe.call(this,It(ct|0),ct|0)}else if(Array.isArray(ct)){if(ct.length)return Oe.call(this,ct,ct.length)}else return Wi.call(this,ct)}return y(Ht,{stats:Zt,destroy:function(){Mn.destroy()}})}var Wo=Er.setFBO=Ha({framebuffer:Kr.define.call(null,kl,"framebuffer")});function yo(gi,Gi){var pa=0;Dn.procs.poll();var Po=Gi.color;Po&&($e.clearColor(+Po[0]||0,+Po[1]||0,+Po[2]||0,+Po[3]||0),pa|=yp),"depth"in Gi&&($e.clearDepth(+Gi.depth),pa|=lh),"stencil"in Gi&&($e.clearStencil(Gi.stencil|0),pa|=rd),N(!!pa,"called regl.clear with no buffer specified"),$e.clear(pa)}function zo(gi){if(N(typeof gi=="object"&&gi,"regl.clear() takes an object as input"),"framebuffer"in gi)if(gi.framebuffer&&gi.framebuffer_reglType==="framebufferCube")for(var Gi=0;Gi<6;++Gi)Wo(y({framebuffer:gi.framebuffer.faces[Gi]},gi),yo);else Wo(gi,yo);else yo(null,gi)}function Xo(gi){N.type(gi,"function","regl.frame() callback must be a function"),un.push(gi);function Gi(){var pa=_p(un,gi);N(pa>=0,"cannot cancel a frame twice");function Po(){var Il=_p(un,Po);un[Il]=un[un.length-1],un.length-=1,un.length<=0&&Ui()}un[pa]=Po}return bi(),{cancel:Gi}}function xs(){var gi=Ur.viewport,Gi=Ur.scissor_box;gi[0]=gi[1]=Gi[0]=Gi[1]=0,zr.viewportWidth=zr.framebufferWidth=zr.drawingBufferWidth=gi[2]=Gi[2]=$e.drawingBufferWidth,zr.viewportHeight=zr.framebufferHeight=zr.drawingBufferHeight=gi[3]=Gi[3]=$e.drawingBufferHeight}function _o(){zr.tick+=1,zr.time=Io(),xs(),Dn.procs.poll()}function Mi(){Kn.refresh(),xs(),Dn.procs.refresh(),Nr&&Nr.update()}function Io(){return(sa()-Wr)/1e3}Mi();function ia(gi,Gi){N.type(Gi,"function","listener callback must be a function");var pa;switch(gi){case"frame":return Xo(Gi);case"lost":pa=ki;break;case"restore":pa=di;break;case"destroy":pa=fn;break;default:N.raise("invalid event, must be one of frame,lost,restore,destroy")}return pa.push(Gi),{cancel:function(){for(var Po=0;Po<pa.length;++Po)if(pa[Po]===Gi){pa[Po]=pa[pa.length-1],pa.pop();return}}}}var ns=y(Ha,{clear:zo,prop:Kr.define.bind(null,kl),context:Kr.define.bind(null,ic),this:Kr.define.bind(null,rf),draw:Ha({}),buffer:function(gi){return Zr.create(gi,nd,!1,!1)},elements:function(gi){return on.create(gi,!1)},texture:Kn.create2D,cube:Kn.createCube,renderbuffer:mr.create,framebuffer:Er.create,framebufferCube:Er.createCube,vao:Mr.createVAO,attributes:$t,frame:Xo,on:ia,limits:ar,hasExtension:function(gi){return ar.extensions.indexOf(gi.toLowerCase())>=0},read:cn,destroy:ls,_gl:$e,_refresh:Mi,poll:function(){_o(),Nr&&Nr.update()},now:Io,stats:Pr});return Ae.onDone(null,ns),ns}return Vd})},6158:function(Tn){(function(me,se){Tn.exports=se()})(this,function(){"use strict";var me,se,De;function he(y,Pe){if(!me)me=Pe;else if(!se)se=Pe;else{var q="var sharedChunk = {}; ("+me+")(sharedChunk); ("+se+")(sharedChunk);",Ce={};me(Ce),De=Pe(Ce),typeof window!="undefined"&&(De.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}return he(["exports"],function(y){"use strict";function Pe(a,s){return a(s={exports:{}},s.exports),s.exports}var q=Ce;function Ce(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}Ce.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Ce.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Ce.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Ce.prototype.solveCurveX=function(a,s){var c,m,_,S,A;for(s===void 0&&(s=1e-6),_=a,A=0;A<8;A++){if(S=this.sampleCurveX(_)-a,Math.abs(S)<s)return _;var P=this.sampleCurveDerivativeX(_);if(Math.abs(P)<1e-6)break;_-=S/P}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(S=this.sampleCurveX(_),Math.abs(S-a)<s)return _;a>S?c=_:m=_,_=.5*(m-c)+c}return _},Ce.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var pe=Ke;function Ke(a,s){this.x=a,this.y=s}Ke.prototype={clone:function(){return new Ke(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ke.convert=function(a){return a instanceof Ke?a:Array.isArray(a)?new Ke(a[0],a[1]):a};var Se=typeof self!="undefined"?self:{},ot=Math.pow(2,53)-1;function mt(a,s,c,m){var _=new q(a,s,c,m);return function(S){return _.solve(S)}}var bt=mt(.25,.1,.25,1);function Dt(a,s,c){return Math.min(c,Math.max(s,a))}function _r(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function Nt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var A in S)a[A]=S[A]}return a}var gr=1;function Qt(){return gr++}function Pt(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Ft(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function xr(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function ee(a,s){return a.indexOf(s,a.length-s.length)!==-1}function sr(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function Tt(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function ht(a){return Array.isArray(a)?a.map(ht):typeof a=="object"&&a?sr(a,ht):a}var jt={};function dt(a){jt[a]||(typeof console!="undefined"&&console.warn(a),jt[a]=!0)}function lr(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function jr(a){for(var s=0,c=0,m=a.length,_=m-1,S=void 0,A=void 0;c<m;_=c++)s+=((A=a[_]).x-(S=a[c]).x)*(S.y+A.y);return s}function ue(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function He(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,S,A){var P=S||A;return s[_]=!P||P.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var W=null;function Y(a){if(W==null){var s=a.navigator?a.navigator.userAgent:null;W=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return W}function Re(a){try{var s=Se[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var gt,wt,qt,fr,br=Se.performance&&Se.performance.now?Se.performance.now.bind(Se.performance):Date.now.bind(Date),bn=Se.requestAnimationFrame||Se.mozRequestAnimationFrame||Se.webkitRequestAnimationFrame||Se.msRequestAnimationFrame,en=Se.cancelAnimationFrame||Se.mozCancelAnimationFrame||Se.webkitCancelAnimationFrame||Se.msCancelAnimationFrame,Ci={now:br,frame:function(a){var s=bn(a);return{cancel:function(){return en(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=Se.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return gt||(gt=Se.document.createElement("a")),gt.href=a,gt.href},hardwareConcurrency:Se.navigator&&Se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Se.devicePixelRatio},get prefersReducedMotion(){return!!Se.matchMedia&&(wt==null&&(wt=Se.matchMedia("(prefers-reduced-motion: reduce)")),wt.matches)}},Wn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Vn={supported:!1,testSupport:function(a){!va&&fr&&(Si?ci(a):qt=a)}},va=!1,Si=!1;function ci(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,fr),a.isContextLost())return;Vn.supported=!0}catch(c){}a.deleteTexture(s),va=!0}Se.document&&((fr=Se.document.createElement("img")).onload=function(){qt&&ci(qt),qt=null,Si=!0},fr.onerror=function(){va=!0,qt=null},fr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Vi="01",zi=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function _i(a){return a.indexOf("mapbox:")===0}zi.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vi,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},zi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},zi.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},zi.prototype.normalizeStyleURL=function(a,s){if(!_i(a))return a;var c=Ba(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},zi.prototype.normalizeGlyphsURL=function(a,s){if(!_i(a))return a;var c=Ba(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},zi.prototype.normalizeSourceURL=function(a,s){if(!_i(a))return a;var c=Ba(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},zi.prototype.normalizeSpriteURL=function(a,s,c,m){var _=Ba(a);return _i(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,ya(_))},zi.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!_i(a))return a;var c=Ba(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ci.devicePixelRatio>=2||s===512?"@2x":"")+(Vn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var S=0,A=_;S<A.length;S+=1){var P=A[S].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(c.params)||Wn.ACCESS_TOKEN;return Wn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},zi.prototype.canonicalizeTileURL=function(a,s){var c=Ba(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(S){return!S.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},zi.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&_i(s),m=[],_=0,S=a.tiles||[];_<S.length;_+=1){var A=S[_];ii(A)?m.push(this.canonicalizeTileURL(A,c)):m.push(A)}return m},zi.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Ba(Wn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!Wn.REQUIRE_ACCESS_TOKEN)return ya(a);if(!(s=s||Wn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(S){return S.indexOf("access_token")===-1}),a.params.push("access_token="+s),ya(a)};var $n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ii(a){return $n.test(a)}var Co=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ba(a){var s=a.match(Co);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function ya(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Et(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(Se.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var de=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};de.prototype.getStorageKey=function(a){var s,c=Et(Wn.ACCESS_TOKEN);return s=c&&c.u?Se.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):Wn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},de.prototype.fetchEventData=function(){var a=Re("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=Se.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=Se.localStorage.getItem(c);_&&(this.anonId=_)}catch(S){dt("Unable to read from LocalStorage")}},de.prototype.saveEventData=function(){var a=Re("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{Se.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Se.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){dt("Unable to write to LocalStorage")}},de.prototype.processRequests=function(a){},de.prototype.postEvent=function(a,s,c,m){var _=this;if(Wn.EVENTS_URL){var S=Ba(Wn.EVENTS_URL);S.params.push("access_token="+(m||Wn.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Vi,userId:this.anonId},P=s?Nt(A,s):A,D={url:ya(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=ra(D,function(U){_.pendingRequest=null,c(U),_.saveEventData(),_.processRequests(m)})}},de.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ae,xe,N=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,S){this.skuToken=_,(Wn.EVENTS_URL&&S||Wn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(A){return _i(A)||ii(A)}))&&this.queueRequest({id:m,timestamp:Date.now()},S)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),S=_.id,A=_.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),Ft(this.anonId)||(this.anonId=Pt()),this.postEvent(A,{skuToken:this.skuToken},function(P){P||S&&(m.success[S]=!0)},c))}},s}(de),Qe=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){Wn.EVENTS_URL&&Wn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return _i(_)||ii(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Et(Wn.ACCESS_TOKEN),S=_?_.u:Wn.ACCESS_TOKEN,A=S!==this.eventData.tokenU;Ft(this.anonId)||(this.anonId=Pt(),A=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),U=new Date(P),G=(P-this.eventData.lastSuccess)/864e5;A=A||G>=1||G<-1||D.getDate()!==U.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(Q){Q||(m.eventData.lastSuccess=P,m.eventData.tokenU=S)},c)}},s}(de)),Wt=Qe.postTurnstileEvent.bind(Qe),Dr=new N,qe=Dr.postMapLoadEvent.bind(Dr),kt=500,hr=50;function kr(){Se.caches&&!ae&&(ae=Se.caches.open("mapbox-tiles"))}function Hr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var qr,Hn=1/0;function Bn(){return qr==null&&(qr=Se.OffscreenCanvas&&new Se.OffscreenCanvas(1,1).getContext("2d")&&typeof Se.createImageBitmap=="function"),qr}var Kr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Kr);var fi=function(a){function s(c,m,_){m===401&&ii(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),ri=ue()?function(){return self.worker&&self.worker.referrer}:function(){return(Se.location.protocol==="blob:"?Se.parent:Se).location.href},sa,wa,Na=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(ri())&&!/^\w+:/.test(c))){if(Se.fetch&&Se.Request&&Se.AbortController&&Se.Request.prototype.hasOwnProperty("signal"))return function(m,_){var S,A=new Se.AbortController,P=new Se.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ri(),signal:A.signal}),D=!1,U=!1,G=(S=P.url).indexOf("sku=")>0&&ii(S);m.type==="json"&&P.headers.set("Accept","application/json");var Q=function(ve,Ve,Ge){if(!U){if(ve&&ve.message!=="SecurityError"&&dt(ve),Ve&&Ge)return oe(Ve);var lt=Date.now();Se.fetch(P).then(function(Je){if(Je.ok){var Ct=G?Je.clone():null;return oe(Je,Ct,lt)}return _(new fi(Je.statusText,Je.status,m.url))}).catch(function(Je){Je.code!==20&&_(new Error(Je.message))})}},oe=function(ve,Ve,Ge){(m.type==="arrayBuffer"?ve.arrayBuffer():m.type==="json"?ve.json():ve.text()).then(function(lt){U||(Ve&&Ge&&function(Je,Ct,Vt){if(kr(),ae){var rr={status:Ct.status,statusText:Ct.statusText,headers:new Se.Headers};Ct.headers.forEach(function(Ar,Sr){return rr.headers.set(Sr,Ar)});var ir=He(Ct.headers.get("Cache-Control")||"");ir["no-store"]||(ir["max-age"]&&rr.headers.set("Expires",new Date(Vt+1e3*ir["max-age"]).toUTCString()),new Date(rr.headers.get("Expires")).getTime()-Vt<42e4||function(Ar,Sr){if(xe===void 0)try{new Response(new ReadableStream),xe=!0}catch(tn){xe=!1}xe?Sr(Ar.body):Ar.blob().then(Sr)}(Ct,function(Ar){var Sr=new Se.Response(Ar,rr);kr(),ae&&ae.then(function(tn){return tn.put(Hr(Je.url),Sr)}).catch(function(tn){return dt(tn.message)})}))}}(P,Ve,Ge),D=!0,_(null,lt,ve.headers.get("Cache-Control"),ve.headers.get("Expires")))}).catch(function(lt){U||_(new Error(lt.message))})};return G?function(ve,Ve){if(kr(),!ae)return Ve(null);var Ge=Hr(ve.url);ae.then(function(lt){lt.match(Ge).then(function(Je){var Ct=function(Vt){if(!Vt)return!1;var rr=new Date(Vt.headers.get("Expires")||0),ir=He(Vt.headers.get("Cache-Control")||"");return rr>Date.now()&&!ir["no-cache"]}(Je);lt.delete(Ge),Ct&&lt.put(Ge,Je.clone()),Ve(null,Je,Ct)}).catch(Ve)}).catch(Ve)}(P,Q):Q(null,null),{cancel:function(){U=!0,D||A.abort()}}}(a,s);if(ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var S=new Se.XMLHttpRequest;for(var A in S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer"),m.headers)S.setRequestHeader(A,m.headers[A]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=function(){_(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var P=S.response;if(m.type==="json")try{P=JSON.parse(S.response)}catch(D){return _(D)}_(null,P,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else _(new fi(S.statusText,S.status,m.url))},S.send(m.body),{cancel:function(){return S.abort()}}}(a,s)},_a=function(a,s){return Na(Nt(a,{type:"arrayBuffer"}),s)},ra=function(a,s){return Na(Nt(a,{method:"POST"}),s)},K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";sa=[],wa=0;var re=function(a,s){if(Vn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),wa>=Wn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return sa.push(c),c}wa++;var m=!1,_=function(){if(!m)for(m=!0,wa--;sa.length&&wa<Wn.MAX_PARALLEL_IMAGE_REQUESTS;){var A=sa.shift();A.cancelled||(A.cancel=re(A.requestParameters,A.callback).cancel)}},S=_a(a,function(A,P,D,U){_(),A?s(A):P&&(Bn()?function(G,Q){var oe=new Se.Blob([new Uint8Array(G)],{type:"image/png"});Se.createImageBitmap(oe).then(function(ve){Q(null,ve)}).catch(function(ve){Q(new Error("Could not load image because of "+ve.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,s):function(G,Q,oe,ve){var Ve=new Se.Image,Ge=Se.URL;Ve.onload=function(){Q(null,Ve),Ge.revokeObjectURL(Ve.src),Ve.onload=null,Se.requestAnimationFrame(function(){Ve.src=K})},Ve.onerror=function(){return Q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var lt=new Se.Blob([new Uint8Array(G)],{type:"image/png"});Ve.cacheControl=oe,Ve.expires=ve,Ve.src=G.byteLength?Ge.createObjectURL(lt):K}(P,s,D,U))});return{cancel:function(){S.cancel(),_()}}};function fe(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function we(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Ze=function(a,s){s===void 0&&(s={}),Nt(this,s),this.type=a},tt=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",Nt({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ze),pt=function(){};pt.prototype.on=function(a,s){return this._listeners=this._listeners||{},fe(a,s,this._listeners),this},pt.prototype.off=function(a,s){return we(a,s,this._listeners),we(a,s,this._oneTimeListeners),this},pt.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},fe(a,s,this._oneTimeListeners),this},pt.prototype.fire=function(a,s){typeof a=="string"&&(a=new Ze(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var S=0,A=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];S<A.length;S+=1){var P=A[S];we(c,P,this._oneTimeListeners),P.call(this,a)}var D=this._eventedParent;D&&(Nt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(a))}else a instanceof tt&&console.error(a.error);return this},pt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},pt.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},We=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function Bt(a){var s=a.value;return s?[new We(a.key,s,"constants have been deprecated as of v8")]:[]}function Rr(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var A in S)a[A]=S[A]}return a}function Kt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function er(a){if(Array.isArray(a))return a.map(er);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=er(a[c]);return s}return Kt(a)}var Or=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),On=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};On.prototype.concat=function(a){return new On(this,a)},On.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},On.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Cn={kind:"null"},Gt={kind:"number"},En={kind:"string"},nr={kind:"boolean"},yt={kind:"color"},xi={kind:"object"},dn={kind:"value"},Pi={kind:"collator"},ua={kind:"formatted"},vt={kind:"resolvedImage"};function _t(a,s){return{kind:"array",itemType:a,N:s}}function Ii(a){if(a.kind==="array"){var s=Ii(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var ui=[Cn,Gt,En,nr,yt,ua,xi,_t(dn),vt];function Ki(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Ki(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=ui;c<m.length;c+=1)if(!Ki(m[c],s))return null}}return"Expected "+Ii(a)+" but found "+Ii(s)+" instead."}function Qi(a,s){return s.some(function(c){return c.kind===a.kind})}function la(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var Fi=Pe(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(P){return(P=Math.round(P))<0?0:P>255?255:P}function _(P){return m(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function S(P){return(D=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:D>1?1:D;var D}function A(P,D,U){return U<0?U+=1:U>1&&(U-=1),6*U<1?P+(D-P)*U*6:2*U<1?D:3*U<2?P+(D-P)*(2/3-U)*6:P}try{s.parseCSSColor=function(P){var D,U=P.replace(/ /g,"").toLowerCase();if(U in c)return c[U].slice();if(U[0]==="#")return U.length===4?(D=parseInt(U.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:U.length===7&&(D=parseInt(U.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var G=U.indexOf("("),Q=U.indexOf(")");if(G!==-1&&Q+1===U.length){var oe=U.substr(0,G),ve=U.substr(G+1,Q-(G+1)).split(","),Ve=1;switch(oe){case"rgba":if(ve.length!==4)return null;Ve=S(ve.pop());case"rgb":return ve.length!==3?null:[_(ve[0]),_(ve[1]),_(ve[2]),Ve];case"hsla":if(ve.length!==4)return null;Ve=S(ve.pop());case"hsl":if(ve.length!==3)return null;var Ge=(parseFloat(ve[0])%360+360)%360/360,lt=S(ve[1]),Je=S(ve[2]),Ct=Je<=.5?Je*(lt+1):Je+lt-Je*lt,Vt=2*Je-Ct;return[m(255*A(Vt,Ct,Ge+1/3)),m(255*A(Vt,Ct,Ge)),m(255*A(Vt,Ct,Ge-1/3)),Ve];default:return null}}return null}}catch(P){}}).parseCSSColor,pr=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};pr.parse=function(a){if(a){if(a instanceof pr)return a;if(typeof a=="string"){var s=Fi(a);if(s)return new pr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},pr.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},pr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1);var wr=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};wr.prototype.compare=function(a,s){return this.collator.compare(a,s)},wr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ye=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},Ma=function(a){this.sections=a};Ma.fromString=function(a){return new Ma([new Ye(a,null,null,null,null)])},Ma.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Ma.factory=function(a){return a instanceof Ma?a:Ma.fromString(a)},Ma.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Ma.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var Le=function(a){this.name=a.name,this.available=a.available};function ws(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function is(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof pr||a instanceof wr||a instanceof Ma||a instanceof Le)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!is(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!is(a[m]))return!1;return!0}return!1}function na(a){if(a===null)return Cn;if(typeof a=="string")return En;if(typeof a=="boolean")return nr;if(typeof a=="number")return Gt;if(a instanceof pr)return yt;if(a instanceof wr)return Pi;if(a instanceof Ma)return ua;if(a instanceof Le)return vt;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var S=na(_[m]);if(s){if(s===S)continue;s=dn;break}s=S}return _t(s||dn,c)}return xi}function Bs(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof pr||a instanceof Ma||a instanceof Le?a.toString():JSON.stringify(a)}Le.prototype.toString=function(){return this.name},Le.fromString=function(a){return a?new Le({name:a,available:!1}):null},Le.prototype.serialize=function(){return["image",this.name]};var Qa=function(a,s){this.type=a,this.value=s};Qa.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!is(a[1]))return s.error("invalid value");var c=a[1],m=na(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new Qa(m,c)},Qa.prototype.evaluate=function(){return this.value},Qa.prototype.eachChild=function(){},Qa.prototype.outputDefined=function(){return!0},Qa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pr?["rgba"].concat(this.value.toArray()):this.value instanceof Ma?this.value.serialize():this.value};var Ga=function(a){this.name="ExpressionEvaluationError",this.message=a};Ga.prototype.toJSON=function(){return this.message};var Ja={string:En,number:Gt,boolean:nr,object:xi},ca=function(a,s){this.type=a,this.args=s};ca.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var S,A;if(a.length>2){var P=a[1];if(typeof P!="string"||!(P in Ja)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=Ja[P],m++}else S=dn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=a[2],m++}c=_t(S,A)}else c=Ja[_];for(var D=[];m<a.length;m++){var U=s.parse(a[m],m,dn);if(!U)return null;D.push(U)}return new ca(c,D)},ca.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!Ki(this.type,na(c)))return c;if(s===this.args.length-1)throw new Ga("Expected value to be of type "+Ii(this.type)+", but found "+Ii(na(c))+" instead.")}return null},ca.prototype.eachChild=function(a){this.args.forEach(a)},ca.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ca.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var jo=function(a){this.type=ua,this.sections=a};jo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,S=1;S<=a.length-1;++S){var A=a[S];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;var P=null;if(A["font-scale"]&&!(P=s.parse(A["font-scale"],1,Gt)))return null;var D=null;if(A["text-font"]&&!(D=s.parse(A["text-font"],1,_t(En))))return null;var U=null;if(A["text-color"]&&!(U=s.parse(A["text-color"],1,yt)))return null;var G=m[m.length-1];G.scale=P,G.font=D,G.textColor=U}else{var Q=s.parse(a[S],1,dn);if(!Q)return null;var oe=Q.type.kind;if(oe!=="string"&&oe!=="value"&&oe!=="null"&&oe!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:Q,scale:null,font:null,textColor:null})}}return new jo(m)},jo.prototype.evaluate=function(a){return new Ma(this.sections.map(function(s){var c=s.content.evaluate(a);return na(c)===vt?new Ye("",c,null,null,null):new Ye(Bs(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},jo.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var Ko=function(a){this.type=vt,this.input=a};Ko.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,En);return c?new Ko(c):s.error("No image name provided.")},Ko.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=Le.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},Ko.prototype.eachChild=function(a){a(this.input)},Ko.prototype.outputDefined=function(){return!1},Ko.prototype.serialize=function(){return["image",this.input.serialize()]};var Su={"to-boolean":nr,"to-color":yt,"to-number":Gt,"to-string":En},Ao=function(a,s){this.type=a,this.args=s};Ao.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=Su[c],_=[],S=1;S<a.length;S++){var A=s.parse(a[S],S,dn);if(!A)return null;_.push(A)}return new Ao(m,_)},Ao.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof pr)return s;if(typeof s=="string"){var S=a.parseColor(s);if(S)return S}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":ws(s[0],s[1],s[2],s[3])))return new pr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ga(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var A=null,P=0,D=this.args;P<D.length;P+=1){if((A=D[P].evaluate(a))===null)return 0;var U=Number(A);if(!isNaN(U))return U}throw new Ga("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?Ma.fromString(Bs(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Le.fromString(Bs(this.args[0].evaluate(a))):Bs(this.args[0].evaluate(a))},Ao.prototype.eachChild=function(a){this.args.forEach(a)},Ao.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ao.prototype.serialize=function(){if(this.type.kind==="formatted")return new jo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ko(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var To=["Unknown","Point","LineString","Polygon"],fa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?To[this.feature.type]:this.feature.type:null},fa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fa.prototype.canonicalID=function(){return this.canonical},fa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fa.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=pr.parse(a)),s};var eo=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};eo.prototype.evaluate=function(a){return this._evaluate(a,this.args)},eo.prototype.eachChild=function(a){this.args.forEach(a)},eo.prototype.outputDefined=function(){return!1},eo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},eo.parse=function(a,s){var c,m=a[0],_=eo.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(_)?_[0]:_.type,A=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,P=A.filter(function(ti){var In=ti[0];return!Array.isArray(In)||In.length===a.length-1}),D=null,U=0,G=P;U<G.length;U+=1){var Q=G[U],oe=Q[0],ve=Q[1];D=new qs(s.registry,s.path,null,s.scope);for(var Ve=[],Ge=!1,lt=1;lt<a.length;lt++){var Je=a[lt],Ct=Array.isArray(oe)?oe[lt-1]:oe.type,Vt=D.parse(Je,1+Ve.length,Ct);if(!Vt){Ge=!0;break}Ve.push(Vt)}if(!Ge)if(Array.isArray(oe)&&oe.length!==Ve.length)D.error("Expected "+oe.length+" arguments, but found "+Ve.length+" instead.");else{for(var rr=0;rr<Ve.length;rr++){var ir=Array.isArray(oe)?oe[rr]:oe.type,Ar=Ve[rr];D.concat(rr+1).checkSubtype(ir,Ar.type)}if(D.errors.length===0)return new eo(m,S,ve,Ve)}}if(P.length===1)(c=s.errors).push.apply(c,D.errors);else{for(var Sr=(P.length?P:A).map(function(ti){var In;return In=ti[0],Array.isArray(In)?"("+In.map(Ii).join(", ")+")":"("+Ii(In.type)+"...)"}).join(" | "),tn=[],Yn=1;Yn<a.length;Yn++){var An=s.parse(a[Yn],1+tn.length);if(!An)return null;tn.push(Ii(An.type))}s.error("Expected arguments of type "+Sr+", but found ("+tn.join(", ")+") instead.")}return null},eo.register=function(a,s){for(var c in eo.definitions=s,s)a[c]=eo};var Go=function(a,s,c){this.type=Pi,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Wa(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function Ys(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Dl(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function Qo(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function ce(a,s){for(var c,m,_,S,A,P,D,U=!1,G=0,Q=s.length;G<Q;G++)for(var oe=s[G],ve=0,Ve=oe.length;ve<Ve-1;ve++){if((S=(c=a)[0]-(m=oe[ve])[0])*(D=c[1]-(_=oe[ve+1])[1])-(P=c[0]-_[0])*(A=c[1]-m[1])==0&&S*P<=0&&A*D<=0)return!1;Qo(a,oe[ve],oe[ve+1])&&(U=!U)}return U}function Ie(a,s){for(var c=0;c<s.length;c++)if(ce(a,s[c]))return!0;return!1}function ft(a,s,c,m){var _=m[0]-c[0],S=m[1]-c[1],A=(a[0]-c[0])*S-_*(a[1]-c[1]),P=(s[0]-c[0])*S-_*(s[1]-c[1]);return A>0&&P<0||A<0&&P>0}function Xt(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var S=_[m],A=0;A<S.length-1;++A)if((Q=[(G=S[A+1])[0]-(U=S[A])[0],G[1]-U[1]])[0]*(oe=[(D=s)[0]-(P=a)[0],D[1]-P[1]])[1]-Q[1]*oe[0]!=0&&ft(P,D,U,G)&&ft(U,G,P,D))return!0;var P,D,U,G,Q,oe;return!1}function Yr(a,s){for(var c=0;c<a.length;++c)if(!ce(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(Xt(a[m],a[m+1],s))return!1;return!0}function jn(a,s){for(var c=0;c<s.length;c++)if(Yr(a,s[c]))return!0;return!1}function Di(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var S=[],A=0;A<a[_].length;A++){var P=Dl(a[_][A],c);Wa(s,P),S.push(P)}m.push(S)}return m}function so(a,s,c){for(var m=[],_=0;_<a.length;_++){var S=Di(a[_],s,c);m.push(S)}return m}function za(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,S=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;S===0&&(S=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=S}Wa(s,a)}function Xa(a,s,c,m){for(var _=8192*Math.pow(2,m.z),S=[8192*m.x,8192*m.y],A=[],P=0,D=a;P<D.length;P+=1)for(var U=0,G=D[P];U<G.length;U+=1){var Q=G[U],oe=[Q.x+S[0],Q.y+S[1]];za(oe,s,c,_),A.push(oe)}return A}function Jo(a,s,c,m){for(var _,S=8192*Math.pow(2,m.z),A=[8192*m.x,8192*m.y],P=[],D=0,U=a;D<U.length;D+=1){for(var G=[],Q=0,oe=U[D];Q<oe.length;Q+=1){var ve=oe[Q],Ve=[ve.x+A[0],ve.y+A[1]];Wa(s,Ve),G.push(Ve)}P.push(G)}if(s[2]-s[0]<=S/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Ge=0,lt=P;Ge<lt.length;Ge+=1)for(var Je=0,Ct=lt[Ge];Je<Ct.length;Je+=1)za(Ct[Je],s,c,S)}return P}Go.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,nr);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,nr);if(!_)return null;var S=null;return c.locale&&!(S=s.parse(c.locale,1,En))?null:new Go(m,_,S)},Go.prototype.evaluate=function(a){return new wr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Go.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Oo=function(a,s){this.type=nr,this.geojson=a,this.geometries=s};function vo(a){if(a instanceof eo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Oo)return!1;var s=!0;return a.eachChild(function(c){s&&!vo(c)&&(s=!1)}),s}function Cs(a){if(a instanceof eo&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!Cs(c)&&(s=!1)}),s}function As(a,s){if(a instanceof eo&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!As(m,s)&&(c=!1)}),c}Oo.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(is(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Oo(c,c.features[m].geometry)}else if(c.type==="Feature"){var S=c.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Oo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Oo(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Oo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var A=Di(c.coordinates,_,S),P=Xa(s.geometry(),m,_,S);if(!Ys(m,_))return!1;for(var D=0,U=P;D<U.length;D+=1)if(!ce(U[D],A))return!1}if(c.type==="MultiPolygon"){var G=so(c.coordinates,_,S),Q=Xa(s.geometry(),m,_,S);if(!Ys(m,_))return!1;for(var oe=0,ve=Q;oe<ve.length;oe+=1)if(!Ie(ve[oe],G))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var A=Di(c.coordinates,_,S),P=Jo(s.geometry(),m,_,S);if(!Ys(m,_))return!1;for(var D=0,U=P;D<U.length;D+=1)if(!Yr(U[D],A))return!1}if(c.type==="MultiPolygon"){var G=so(c.coordinates,_,S),Q=Jo(s.geometry(),m,_,S);if(!Ys(m,_))return!1;for(var oe=0,ve=Q;oe<ve.length;oe+=1)if(!jn(ve[oe],G))return!1}return!0}(a,this.geometries)}return!1},Oo.prototype.eachChild=function(){},Oo.prototype.outputDefined=function(){return!0},Oo.prototype.serialize=function(){return["within",this.geojson]};var Ts=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};Ts.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new Ts(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Ts.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Ts.prototype.eachChild=function(){},Ts.prototype.outputDefined=function(){return!1},Ts.prototype.serialize=function(){return["var",this.name]};var qs=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new On),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(S){return"["+S+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function hu(a,s){for(var c,m=a.length-1,_=0,S=m,A=0;_<=S;)if((c=a[A=Math.floor((_+S)/2)])<=s){if(A===m||s<a[A+1])return A;_=A+1}else{if(!(c>s))throw new Ga("Input is not a number.");S=A-1}return 0}qs.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},qs.prototype._parse=function(a,s){function c(U,G,Q){return Q==="assert"?new ca(G,[U]):Q==="coerce"?new Ao(G,[U]):U}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var S=_.parse(a,this);if(!S)return null;if(this.expectedType){var A=this.expectedType,P=S.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||P.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(A,P))return null}else S=c(S,A,s.typeAnnotation||"coerce");else S=c(S,A,s.typeAnnotation||"assert")}if(!(S instanceof Qa)&&S.type.kind!=="resolvedImage"&&function U(G){if(G instanceof Ts)return U(G.boundExpression);if(G instanceof eo&&G.name==="error"||G instanceof Go||G instanceof Oo)return!1;var Q=G instanceof Ao||G instanceof ca,oe=!0;return G.eachChild(function(ve){oe=Q?oe&&U(ve):oe&&ve instanceof Qa}),!!oe&&vo(G)&&As(G,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var D=new fa;try{S=new Qa(S.type,S.evaluate(D))}catch(U){return this.error(U.message),null}}return S}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},qs.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new qs(this.registry,m,s||null,_,this.errors)},qs.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Or(m,a))},qs.prototype.checkSubtype=function(a,s){var c=Ki(a,s);return c&&this.error(c),c};var ds=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var S=_[m],A=S[1];this.labels.push(S[0]),this.outputs.push(A)}};function Zi(a,s,c){return a*(1-c)+s*c}ds.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,Gt);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var S=1;S<a.length;S+=2){var A=S===1?-1/0:a[S],P=a[S+1],D=S,U=S+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var G=s.parse(P,U,_);if(!G)return null;_=_||G.type,m.push([A,G])}return new ds(_,c,m)},ds.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[hu(s,m)].evaluate(a)},ds.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},ds.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},ds.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Ia=Object.freeze({__proto__:null,number:Zi,color:function(a,s,c){return new pr(Zi(a.r,s.r,c),Zi(a.g,s.g,c),Zi(a.b,s.b,c),Zi(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return Zi(m,s[_],c)})}}),Bc=6/29*3*(6/29),hf=Math.PI/180,Ms=180/Math.PI;function pf(a){return a>.008856451679035631?Math.pow(a,1/3):a/Bc+4/29}function hl(a){return a>6/29?a*a*a:Bc*(a-4/29)}function Qu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ks(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Bl(a){var s=Ks(a.r),c=Ks(a.g),m=Ks(a.b),_=pf((.4124564*s+.3575761*c+.1804375*m)/.95047),S=pf((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-pf((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function b(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*hl(s),c=.95047*hl(c),m=1.08883*hl(m),new pr(Qu(3.2404542*c-1.5371385*s-.4985314*m),Qu(-.969266*c+1.8760108*s+.041556*m),Qu(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function k(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var z={forward:Bl,reverse:b,interpolate:function(a,s,c){return{l:Zi(a.l,s.l,c),a:Zi(a.a,s.a,c),b:Zi(a.b,s.b,c),alpha:Zi(a.alpha,s.alpha,c)}}},R={forward:function(a){var s=Bl(a),c=s.l,m=s.a,_=s.b,S=Math.atan2(_,m)*Ms;return{h:S<0?S+360:S,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*hf,c=a.c;return b({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:k(a.h,s.h,c),c:Zi(a.c,s.c,c),l:Zi(a.l,s.l,c),alpha:Zi(a.alpha,s.alpha,c)}}},te=Object.freeze({__proto__:null,lab:z,hcl:R}),Me=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var S=0,A=_;S<A.length;S+=1){var P=A[S],D=P[1];this.labels.push(P[0]),this.outputs.push(D)}};function st(a,s,c,m){var _=m-c,S=a-c;return _===0?0:s===1?S/_:(Math.pow(s,S)-1)/(Math.pow(s,_)-1)}Me.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=st(s,a.base,c,m);else if(a.name==="linear")_=st(s,1,c,m);else if(a.name==="cubic-bezier"){var S=a.controlPoints;_=new q(S[0],S[1],S[2],S[3]).solve(st(s,1,c,m))}return _},Me.parse=function(a,s){var c=a[0],m=a[1],_=a[2],S=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var A=m[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var P=m.slice(1);if(P.length!==4||P.some(function(lt){return typeof lt!="number"||lt<0||lt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Gt)))return null;var D=[],U=null;c==="interpolate-hcl"||c==="interpolate-lab"?U=yt:s.expectedType&&s.expectedType.kind!=="value"&&(U=s.expectedType);for(var G=0;G<S.length;G+=2){var Q=S[G],oe=S[G+1],ve=G+3,Ve=G+4;if(typeof Q!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ve);if(D.length&&D[D.length-1][0]>=Q)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ve);var Ge=s.parse(oe,Ve,U);if(!Ge)return null;U=U||Ge.type,D.push([Q,Ge])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new Me(U,c,m,_,D):s.error("Type "+Ii(U)+" is not interpolatable.")},Me.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var S=hu(s,m),A=Me.interpolationFactor(this.interpolation,m,s[S],s[S+1]),P=c[S].evaluate(a),D=c[S+1].evaluate(a);return this.operator==="interpolate"?Ia[this.type.kind.toLowerCase()](P,D,A):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(D),A)):z.reverse(z.interpolate(z.forward(P),z.forward(D),A))},Me.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Me.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Me.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Rt=function(a,s){this.type=a,this.args=s};Rt.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],S=0,A=a.slice(1);S<A.length;S+=1){var P=s.parse(A[S],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!P)return null;c=c||P.type,_.push(P)}var D=m&&_.some(function(U){return Ki(m,U.type)});return new Rt(D?dn:c,_)},Rt.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,S=this.args;_<S.length&&(m++,(c=S[_].evaluate(a))&&c instanceof Le&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Rt.prototype.eachChild=function(a){this.args.forEach(a)},Rt.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Rt.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Ot=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Ot.prototype.evaluate=function(a){return this.result.evaluate(a)},Ot.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Ot.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var S=s.parse(a[m+1],m+1);if(!S)return null;c.push([_,S])}var A=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return A?new Ot(c,A):null},Ot.prototype.outputDefined=function(){return this.result.outputDefined()},Ot.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var yr=function(a,s,c){this.type=a,this.index=s,this.input=c};yr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Gt),m=s.parse(a[2],2,_t(s.expectedType||dn));return c&&m?new yr(m.type.itemType,c,m):null},yr.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Ga("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Ga("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Ga("Array index must be an integer, but found "+s+" instead.");return c[s]},yr.prototype.eachChild=function(a){a(this.index),a(this.input)},yr.prototype.outputDefined=function(){return!1},yr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Lr=function(a,s){this.type=nr,this.needle=a,this.haystack=s};Lr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,dn),m=s.parse(a[2],2,dn);return c&&m?Qi(c.type,[nr,En,Gt,Cn,dn])?new Lr(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(c.type)+" instead"):null},Lr.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!la(s,["boolean","string","number","null"]))throw new Ga("Expected first argument to be of type boolean, string, number or null, but found "+Ii(na(s))+" instead.");if(!la(c,["string","array"]))throw new Ga("Expected second argument to be of type array or string, but found "+Ii(na(c))+" instead.");return c.indexOf(s)>=0},Lr.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Lr.prototype.outputDefined=function(){return!0},Lr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Gn=function(a,s,c){this.type=Gt,this.needle=a,this.haystack=s,this.fromIndex=c};Gn.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,dn),m=s.parse(a[2],2,dn);if(!c||!m)return null;if(!Qi(c.type,[nr,En,Gt,Cn,dn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Gt);return _?new Gn(c,m,_):null}return new Gn(c,m)},Gn.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!la(s,["boolean","string","number","null"]))throw new Ga("Expected first argument to be of type boolean, string, number or null, but found "+Ii(na(s))+" instead.");if(!la(c,["string","array"]))throw new Ga("Expected second argument to be of type array or string, but found "+Ii(na(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},Gn.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Gn.prototype.outputDefined=function(){return!1},Gn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Qn=function(a,s,c,m,_,S){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=S};Qn.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},S=[],A=2;A<a.length-1;A+=2){var P=a[A],D=a[A+1];Array.isArray(P)||(P=[P]);var U=s.concat(A);if(P.length===0)return U.error("Expected at least one branch label.");for(var G=0,Q=P;G<Q.length;G+=1){var oe=Q[G];if(typeof oe!="number"&&typeof oe!="string")return U.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof oe=="number"&&Math.floor(oe)!==oe)return U.error("Numeric branch labels must be integer values.");if(c){if(U.checkSubtype(c,na(oe)))return null}else c=na(oe);if(_[String(oe)]!==void 0)return U.error("Branch labels must be unique.");_[String(oe)]=S.length}var ve=s.parse(D,A,m);if(!ve)return null;m=m||ve.type,S.push(ve)}var Ve=s.parse(a[1],1,dn);if(!Ve)return null;var Ge=s.parse(a[a.length-1],a.length-1,m);return Ge?Ve.type.kind!=="value"&&s.concat(1).checkSubtype(c,Ve.type)?null:new Qn(c,m,Ve,_,S,Ge):null},Qn.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(na(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Qn.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Qn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Qn.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,S=Object.keys(this.cases).sort();_<S.length;_+=1){var A=S[_];(Q=m[this.cases[A]])===void 0?(m[this.cases[A]]=c.length,c.push([this.cases[A],[A]])):c[Q][1].push(A)}for(var P=function(ve){return a.inputType.kind==="number"?Number(ve):ve},D=0,U=c;D<U.length;D+=1){var G=U[D],Q=G[0],oe=G[1];s.push(oe.length===1?P(oe[0]):oe.map(P)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var pi=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};pi.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var S=s.parse(a[_],_,nr);if(!S)return null;var A=s.parse(a[_+1],_+1,c);if(!A)return null;m.push([S,A]),c=c||A.type}var P=s.parse(a[a.length-1],a.length-1,c);return P?new pi(c,m,P):null},pi.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},pi.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},pi.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},pi.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var $i=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function Ca(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Ra(a,s,c,m){return m.compare(s,c)===0}function Yi(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(S,A,P){this.type=nr,this.lhs=S,this.rhs=A,this.collator=P,this.hasUntypedArgument=S.type.kind==="value"||A.type.kind==="value"}return _.parse=function(S,A){if(S.length!==3&&S.length!==4)return A.error("Expected two or three arguments.");var P=S[0],D=A.parse(S[1],1,dn);if(!D)return null;if(!Ca(P,D.type))return A.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ii(D.type)+"'.");var U=A.parse(S[2],2,dn);if(!U)return null;if(!Ca(P,U.type))return A.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ii(U.type)+"'.");if(D.type.kind!==U.type.kind&&D.type.kind!=="value"&&U.type.kind!=="value")return A.error("Cannot compare types '"+Ii(D.type)+"' and '"+Ii(U.type)+"'.");m&&(D.type.kind==="value"&&U.type.kind!=="value"?D=new ca(U.type,[D]):D.type.kind!=="value"&&U.type.kind==="value"&&(U=new ca(D.type,[U])));var G=null;if(S.length===4){if(D.type.kind!=="string"&&U.type.kind!=="string"&&D.type.kind!=="value"&&U.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(G=A.parse(S[3],3,Pi)))return null}return new _(D,U,G)},_.prototype.evaluate=function(S){var A=this.lhs.evaluate(S),P=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){var D=na(A),U=na(P);if(D.kind!==U.kind||D.kind!=="string"&&D.kind!=="number")throw new Ga('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+D.kind+", "+U.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var G=na(A),Q=na(P);if(G.kind!=="string"||Q.kind!=="string")return s(S,A,P)}return this.collator?c(S,A,P,this.collator.evaluate(S)):s(S,A,P)},_.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var S=[a];return this.eachChild(function(A){S.push(A.serialize())}),S},_}()}$i.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,dn),m=s.parse(a[2],2,Gt);if(!c||!m)return null;if(!Qi(c.type,[_t(dn),En,dn]))return s.error("Expected first argument to be of type array or string, but found "+Ii(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Gt);return _?new $i(c.type,c,m,_):null}return new $i(c.type,c,m)},$i.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!la(s,["string","array"]))throw new Ga("Expected first argument to be of type array or string, but found "+Ii(na(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},$i.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},$i.prototype.outputDefined=function(){return!1},$i.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var vs=Yi("==",function(a,s,c){return s===c},Ra),pu=Yi("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!Ra(0,s,c,m)}),pl=Yi("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),df=Yi(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),dl=Yi("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),Nc=Yi(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),Nu=function(a,s,c,m,_){this.type=En,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};Nu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,Gt);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,En)))return null;var S=null;if(m.currency&&!(S=s.parse(m.currency,1,En)))return null;var A=null;if(m["min-fraction-digits"]&&!(A=s.parse(m["min-fraction-digits"],1,Gt)))return null;var P=null;return m["max-fraction-digits"]&&!(P=s.parse(m["max-fraction-digits"],1,Gt))?null:new Nu(c,_,S,A,P)},Nu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Nu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var zu=function(a){this.type=Gt,this.input=a};zu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Ii(c.type)+" instead."):new zu(c):null},zu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ga("Expected value to be of type string or array, but found "+Ii(na(s))+" instead.")},zu.prototype.eachChild=function(a){a(this.input)},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Zu={"==":vs,"!=":pu,">":df,"<":pl,">=":Nc,"<=":dl,array:ca,at:yr,boolean:ca,case:pi,coalesce:Rt,collator:Go,format:jo,image:Ko,in:Lr,"index-of":Gn,interpolate:Me,"interpolate-hcl":Me,"interpolate-lab":Me,length:zu,let:Ot,literal:Qa,match:Qn,number:ca,"number-format":Nu,object:ca,slice:$i,step:ds,string:ca,"to-boolean":Ao,"to-color":Ao,"to-number":Ao,"to-string":Ao,var:Ts,within:Oo};function mo(a,s){var c=s[0],m=s[1],_=s[2],S=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var A=S?S.evaluate(a):1,P=ws(c,m,_,A);if(P)throw new Ga(P);return new pr(c/255*A,m/255*A,_/255*A,A)}function Xf(a,s){return a in s}function zc(a,s){var c=s[a];return c===void 0?null:c}function ms(a){return{type:a}}function vf(a){return{result:"success",value:a}}function Ju(a){return{result:"error",value:a}}function Qs(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function $f(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ns(a){return!!a.expression&&a.expression.interpolated}function ka(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Nl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Ah(a){return a}function Uu(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function Zc(a,s,c,m,_){return Uu(typeof c===_?m[c]:void 0,a.default,s.default)}function up(a,s,c){if(ka(c)!=="number")return Uu(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=hu(a.stops.map(function(S){return S[0]}),c);return a.stops[_][1]}function lp(a,s,c){var m=a.base!==void 0?a.base:1;if(ka(c)!=="number")return Uu(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var S=hu(a.stops.map(function(Q){return Q[0]}),c),A=function(Q,oe,ve,Ve){var Ge=Ve-ve,lt=Q-ve;return Ge===0?0:oe===1?lt/Ge:(Math.pow(oe,lt)-1)/(Math.pow(oe,Ge)-1)}(c,m,a.stops[S][0],a.stops[S+1][0]),P=a.stops[S][1],D=a.stops[S+1][1],U=Ia[s.type]||Ah;if(a.colorSpace&&a.colorSpace!=="rgb"){var G=te[a.colorSpace];U=function(Q,oe){return G.reverse(G.interpolate(G.forward(Q),G.forward(oe),A))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var Q=[],oe=arguments.length;oe--;)Q[oe]=arguments[oe];var ve=P.evaluate.apply(void 0,Q),Ve=D.evaluate.apply(void 0,Q);if(ve!==void 0&&Ve!==void 0)return U(ve,Ve,A)}}:U(P,D,A)}function Yf(a,s,c){return s.type==="color"?c=pr.parse(c):s.type==="formatted"?c=Ma.fromString(c.toString()):s.type==="resolvedImage"?c=Le.fromString(c.toString()):ka(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Uu(c,a.default,s.default)}eo.register(Zu,{error:[{kind:"error"},[En],function(a,s){throw new Ga(s[0].evaluate(a))}],typeof:[En,[dn],function(a,s){return Ii(na(s[0].evaluate(a)))}],"to-rgba":[_t(Gt,4),[yt],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[yt,[Gt,Gt,Gt],mo],rgba:[yt,[Gt,Gt,Gt,Gt],mo],has:{type:nr,overloads:[[[En],function(a,s){return Xf(s[0].evaluate(a),a.properties())}],[[En,xi],function(a,s){var c=s[1];return Xf(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:dn,overloads:[[[En],function(a,s){return zc(s[0].evaluate(a),a.properties())}],[[En,xi],function(a,s){var c=s[1];return zc(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[dn,[En],function(a,s){return zc(s[0].evaluate(a),a.featureState||{})}],properties:[xi,[],function(a){return a.properties()}],"geometry-type":[En,[],function(a){return a.geometryType()}],id:[dn,[],function(a){return a.id()}],zoom:[Gt,[],function(a){return a.globals.zoom}],"heatmap-density":[Gt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Gt,[],function(a){return a.globals.lineProgress||0}],accumulated:[dn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Gt,ms(Gt),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[Gt,ms(Gt),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:Gt,overloads:[[[Gt,Gt],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[Gt],function(a,s){return-s[0].evaluate(a)}]]},"/":[Gt,[Gt,Gt],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[Gt,[Gt,Gt],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[Gt,[],function(){return Math.LN2}],pi:[Gt,[],function(){return Math.PI}],e:[Gt,[],function(){return Math.E}],"^":[Gt,[Gt,Gt],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[Gt,[Gt],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[Gt,[Gt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[Gt,[Gt],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[Gt,[Gt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[Gt,[Gt],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[Gt,[Gt],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[Gt,[Gt],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[Gt,[Gt],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[Gt,[Gt],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[Gt,[Gt],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[Gt,ms(Gt),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[Gt,ms(Gt),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[Gt,[Gt],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[Gt,[Gt],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Gt,[Gt],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[Gt,[Gt],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[nr,[En,dn],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[nr,[dn],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[nr,[En],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[nr,[En,dn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<S}],"filter-id-<":[nr,[dn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[nr,[En,dn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>S}],"filter-id->":[nr,[dn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[nr,[En,dn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<=S}],"filter-id-<=":[nr,[dn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[nr,[En,dn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>=S}],"filter-id->=":[nr,[dn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[nr,[dn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[nr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[nr,[_t(En)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[nr,[_t(dn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[nr,[En,_t(dn)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[nr,[En,_t(dn)],function(a,s){var c=s[0],m=s[1];return function(_,S,A,P){for(;A<=P;){var D=A+P>>1;if(S[D]===_)return!0;S[D]>_?P=D-1:A=D+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:nr,overloads:[[[nr,nr],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[ms(nr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:nr,overloads:[[[nr,nr],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[ms(nr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[nr,[nr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[nr,[En],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[En,[En],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[En,[En],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[En,ms(dn),function(a,s){return s.map(function(c){return Bs(c.evaluate(a))}).join("")}],"resolved-locale":[En,[Pi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var Uc=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new fa,this._defaultValue=s?function(c){return c.type==="color"&&Nl(c.default)?new pr(0,0,0,0):c.type==="color"?pr.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function fc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Zu}function zl(a,s){var c=new qs(Zu,[],s?function(_){var S={color:yt,string:En,number:Gt,enum:En,boolean:nr,formatted:ua,resolvedImage:vt};return _.type==="array"?_t(S[_.value]||dn,_.length):S[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?vf(new Uc(m,s)):Ju(c.errors)}Uc.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},Uc.prototype.evaluate=function(a,s,c,m,_,S){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Ga("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Zl=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!Cs(s.expression)};Zl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},Zl.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)};var vl=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!Cs(s.expression),this.interpolationType=m};function ml(a,s){if((a=zl(a,s)).result==="error")return a;var c=a.value.expression,m=vo(c);if(!m&&!Qs(s))return Ju([new Or("","data expressions not supported")]);var _=As(c,["zoom"]);if(!_&&!$f(s))return Ju([new Or("","zoom expressions not supported")]);var S=function A(P){var D=null;if(P instanceof Ot)D=A(P.result);else if(P instanceof Rt)for(var U=0,G=P.args;U<G.length&&!(D=A(G[U]));U+=1);else(P instanceof ds||P instanceof Me)&&P.input instanceof eo&&P.input.name==="zoom"&&(D=P);return D instanceof Or||P.eachChild(function(Q){var oe=A(Q);oe instanceof Or?D=oe:!D&&oe?D=new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&oe&&D!==oe&&(D=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(c);return S||_?S instanceof Or?Ju([S]):S instanceof Me&&!Ns(s)?Ju([new Or("",'"interpolate" expressions cannot be used with this property')]):vf(S?new vl(m?"camera":"composite",a.value,S.labels,S instanceof Me?S.interpolation:void 0):new Zl(m?"constant":"source",a.value)):Ju([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}vl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},vl.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)},vl.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?Me.interpolationFactor(this.interpolationType,a,s,c):0};var gl=function(a,s){this._parameters=a,this._specification=s,Rr(this,function c(m,_){var S,A,P,D=_.type==="color",U=m.stops&&typeof m.stops[0][0]=="object",G=U||!(U||m.property!==void 0),Q=m.type||(Ns(_)?"exponential":"interval");if(D&&((m=Rr({},m)).stops&&(m.stops=m.stops.map(function(An){return[An[0],pr.parse(An[1])]})),m.default=pr.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!te[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(Q==="exponential")S=lp;else if(Q==="interval")S=up;else if(Q==="categorical"){S=Zc,A=Object.create(null);for(var oe=0,ve=m.stops;oe<ve.length;oe+=1){var Ve=ve[oe];A[Ve[0]]=Ve[1]}P=typeof m.stops[0][0]}else{if(Q!=="identity")throw new Error('Unknown function type "'+Q+'"');S=Yf}if(U){for(var Ge={},lt=[],Je=0;Je<m.stops.length;Je++){var Ct=m.stops[Je],Vt=Ct[0].zoom;Ge[Vt]===void 0&&(Ge[Vt]={zoom:Vt,type:m.type,property:m.property,default:m.default,stops:[]},lt.push(Vt)),Ge[Vt].stops.push([Ct[0].value,Ct[1]])}for(var rr=[],ir=0,Ar=lt;ir<Ar.length;ir+=1){var Sr=Ar[ir];rr.push([Ge[Sr].zoom,c(Ge[Sr],_)])}var tn={name:"linear"};return{kind:"composite",interpolationType:tn,interpolationFactor:Me.interpolationFactor.bind(void 0,tn),zoomStops:rr.map(function(An){return An[0]}),evaluate:function(An,ti){var In=An.zoom;return lp({stops:rr,base:m.base},_,In).evaluate(In,ti)}}}if(G){var Yn=Q==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Yn,interpolationFactor:Me.interpolationFactor.bind(void 0,Yn),zoomStops:m.stops.map(function(An){return An[0]}),evaluate:function(An){return S(m,_,An.zoom,A,P)}}}return{kind:"source",evaluate:function(An,ti){var In=ti&&ti.properties?ti.properties[m.property]:void 0;return In===void 0?Uu(m.default,_.default):S(m,_,In,A,P)}}}(this._parameters,this._specification))};function Js(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},S=a.style,A=a.styleSpec,P=[],D=ka(c);if(D!=="object")return[new We(s,c,"object expected, "+D+" found")];for(var U in c){var G=U.split(".")[0],Q=m[G]||m["*"],oe=void 0;if(_[G])oe=_[G];else if(m[G])oe=Hi;else if(_["*"])oe=_["*"];else{if(!m["*"]){P.push(new We(s,c[U],'unknown property "'+U+'"'));continue}oe=Hi}P=P.concat(oe({key:(s&&s+".")+U,value:c[U],valueSpec:Q,style:S,styleSpec:A,object:c,objectKey:U},c))}for(var ve in m)_[ve]||m[ve].required&&m[ve].default===void 0&&c[ve]===void 0&&P.push(new We(s,c,'missing required property "'+ve+'"'));return P}function mf(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,S=a.key,A=a.arrayElementValidator||Hi;if(ka(s)!=="array")return[new We(S,s,"array expected, "+ka(s)+" found")];if(c.length&&s.length!==c.length)return[new We(S,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new We(S,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var P={type:c.value,values:c.values};_.$version<7&&(P.function=c.function),ka(c.value)==="object"&&(P=c.value);for(var D=[],U=0;U<s.length;U++)D=D.concat(A({array:s,arrayIndex:U,value:s[U],valueSpec:P,style:m,styleSpec:_,key:S+"["+U+"]"}));return D}function gf(a){var s=a.key,c=a.value,m=a.valueSpec,_=ka(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new We(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new We(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new We(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Ul(a){var s,c,m,_=a.valueSpec,S=Kt(a.value.type),A={},P=S!=="categorical"&&a.value.property===void 0,D=!P,U=ka(a.value.stops)==="array"&&ka(a.value.stops[0])==="array"&&ka(a.value.stops[0][0])==="object",G=Js({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(ve){if(S==="identity")return[new We(ve.key,ve.value,'identity function may not have a "stops" property')];var Ve=[],Ge=ve.value;return Ve=Ve.concat(mf({key:ve.key,value:Ge,valueSpec:ve.valueSpec,style:ve.style,styleSpec:ve.styleSpec,arrayElementValidator:Q})),ka(Ge)==="array"&&Ge.length===0&&Ve.push(new We(ve.key,Ge,"array must have at least one stop")),Ve},default:function(ve){return Hi({key:ve.key,value:ve.value,valueSpec:_,style:ve.style,styleSpec:ve.styleSpec})}}});return S==="identity"&&P&&G.push(new We(a.key,a.value,'missing required property "property"')),S==="identity"||a.value.stops||G.push(new We(a.key,a.value,'missing required property "stops"')),S==="exponential"&&a.valueSpec.expression&&!Ns(a.valueSpec)&&G.push(new We(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!Qs(a.valueSpec)?G.push(new We(a.key,a.value,"property functions not supported")):P&&!$f(a.valueSpec)&&G.push(new We(a.key,a.value,"zoom functions not supported"))),S!=="categorical"&&!U||a.value.property!==void 0||G.push(new We(a.key,a.value,'"property" property is required')),G;function Q(ve){var Ve=[],Ge=ve.value,lt=ve.key;if(ka(Ge)!=="array")return[new We(lt,Ge,"array expected, "+ka(Ge)+" found")];if(Ge.length!==2)return[new We(lt,Ge,"array length 2 expected, length "+Ge.length+" found")];if(U){if(ka(Ge[0])!=="object")return[new We(lt,Ge,"object expected, "+ka(Ge[0])+" found")];if(Ge[0].zoom===void 0)return[new We(lt,Ge,"object stop key must have zoom")];if(Ge[0].value===void 0)return[new We(lt,Ge,"object stop key must have value")];if(m&&m>Kt(Ge[0].zoom))return[new We(lt,Ge[0].zoom,"stop zoom values must appear in ascending order")];Kt(Ge[0].zoom)!==m&&(m=Kt(Ge[0].zoom),c=void 0,A={}),Ve=Ve.concat(Js({key:lt+"[0]",value:Ge[0],valueSpec:{zoom:{}},style:ve.style,styleSpec:ve.styleSpec,objectElementValidators:{zoom:gf,value:oe}}))}else Ve=Ve.concat(oe({key:lt+"[0]",value:Ge[0],valueSpec:{},style:ve.style,styleSpec:ve.styleSpec},Ge));return fc(er(Ge[1]))?Ve.concat([new We(lt+"[1]",Ge[1],"expressions are not allowed in function stops.")]):Ve.concat(Hi({key:lt+"[1]",value:Ge[1],valueSpec:_,style:ve.style,styleSpec:ve.styleSpec}))}function oe(ve,Ve){var Ge=ka(ve.value),lt=Kt(ve.value),Je=ve.value!==null?ve.value:Ve;if(s){if(Ge!==s)return[new We(ve.key,Je,Ge+" stop domain type must match previous stop domain type "+s)]}else s=Ge;if(Ge!=="number"&&Ge!=="string"&&Ge!=="boolean")return[new We(ve.key,Je,"stop domain value must be a number, string, or boolean")];if(Ge!=="number"&&S!=="categorical"){var Ct="number expected, "+Ge+" found";return Qs(_)&&S===void 0&&(Ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(ve.key,Je,Ct)]}return S!=="categorical"||Ge!=="number"||isFinite(lt)&&Math.floor(lt)===lt?S!=="categorical"&&Ge==="number"&&c!==void 0&&lt<c?[new We(ve.key,Je,"stop domain values must appear in ascending order")]:(c=lt,S==="categorical"&&lt in A?[new We(ve.key,Je,"stop domain values must be unique")]:(A[lt]=!0,[])):[new We(ve.key,Je,"integer expected, found "+lt)]}}function yl(a){var s=(a.expressionContext==="property"?ml:zl)(er(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new We(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new We(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Cs(c))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Cs(c))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!As(c,["zoom","feature-state"]))return[new We(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!vo(c))return[new We(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hc(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(Kt(c))===-1&&_.push(new We(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(Kt(c))===-1&&_.push(new We(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function Vc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!Vc(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}gl.deserialize=function(a){return new gl(a._parameters,a._specification)},gl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var pc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function yf(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Vc(a)||(a=_f(a));var s=zl(a,pc);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function cp(a,s){return a<s?-1:a>s?1:0}function _f(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?_l(a[1],a[2],"=="):c==="!="?Vu(_l(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?_l(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(_f))):c==="all"?["all"].concat(a.slice(1).map(_f)):c==="none"?["all"].concat(a.slice(1).map(_f).map(Vu)):c==="in"?xf(a[1],a.slice(2)):c==="!in"?Vu(xf(a[1],a.slice(2))):c==="has"?qf(a[1]):c==="!has"?Vu(qf(a[1])):c!=="within"||a}function _l(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function xf(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(cp)]]:["filter-in-small",a,["literal",s]]}}function qf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Vu(a){return["!",a]}function Th(a){return Vc(er(a.value))?yl(Rr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(ka(m)!=="array")return[new We(_,m,"array expected, "+ka(m)+" found")];var S,A=c.styleSpec,P=[];if(m.length<1)return[new We(_,m,"filter array must have at least 1 element")];switch(P=P.concat(hc({key:_+"[0]",value:m[0],valueSpec:A.filter_operator,style:c.style,styleSpec:c.styleSpec})),Kt(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Kt(m[1])==="$type"&&P.push(new We(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&P.push(new We(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(S=ka(m[1]))!=="string"&&P.push(new We(_+"[1]",m[1],"string expected, "+S+" found"));for(var D=2;D<m.length;D++)S=ka(m[D]),Kt(m[1])==="$type"?P=P.concat(hc({key:_+"["+D+"]",value:m[D],valueSpec:A.geometry_type,style:c.style,styleSpec:c.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&P.push(new We(_+"["+D+"]",m[D],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var U=1;U<m.length;U++)P=P.concat(s({key:_+"["+U+"]",value:m[U],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":S=ka(m[1]),m.length!==2?P.push(new We(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="string"&&P.push(new We(_+"[1]",m[1],"string expected, "+S+" found"));break;case"within":S=ka(m[1]),m.length!==2?P.push(new We(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="object"&&P.push(new We(_+"[1]",m[1],"object expected, "+S+" found"))}return P}(a)}function Mh(a,s){var c=a.key,m=a.style,_=a.styleSpec,S=a.value,A=a.objectKey,P=_[s+"_"+a.layerType];if(!P)return[];var D=A.match(/^(.*)-transition$/);if(s==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return Hi({key:c,value:S,valueSpec:_.transition,style:m,styleSpec:_});var U,G=a.valueSpec||P[A];if(!G)return[new We(c,S,'unknown property "'+A+'"')];if(ka(S)==="string"&&Qs(G)&&!G.tokens&&(U=/^{([^}]+)}$/.exec(S)))return[new We(c,S,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(U[1])+" }`.")];var Q=[];return a.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&Q.push(new We(c,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Nl(er(S))&&Kt(S.type)==="identity"&&Q.push(new We(c,S,'"text-font" does not support identity functions'))),Q.concat(Hi({key:a.key,value:S,valueSpec:G,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:A}))}function kh(a){return Mh(a,"paint")}function Vl(a){return Mh(a,"layout")}function Ih(a){var s=[],c=a.value,m=a.key,_=a.style,S=a.styleSpec;c.type||c.ref||s.push(new We(m,c,'either "type" or "ref" is required'));var A,P=Kt(c.type),D=Kt(c.ref);if(c.id)for(var U=Kt(c.id),G=0;G<a.arrayIndex;G++){var Q=_.layers[G];Kt(Q.id)===U&&s.push(new We(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+Q.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in c&&s.push(new We(m,c[Ve],'"'+Ve+'" is prohibited for ref layers'))}),_.layers.forEach(function(Ve){Kt(Ve.id)===D&&(A=Ve)}),A?A.ref?s.push(new We(m,c.ref,"ref cannot reference another ref layer")):P=Kt(A.type):s.push(new We(m,c.ref,'ref layer "'+D+'" not found'));else if(P!=="background")if(c.source){var oe=_.sources&&_.sources[c.source],ve=oe&&Kt(oe.type);oe?ve==="vector"&&P==="raster"?s.push(new We(m,c.source,'layer "'+c.id+'" requires a raster source')):ve==="raster"&&P!=="raster"?s.push(new We(m,c.source,'layer "'+c.id+'" requires a vector source')):ve!=="vector"||c["source-layer"]?ve==="raster-dem"&&P!=="hillshade"?s.push(new We(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!c.paint||!c.paint["line-gradient"]||ve==="geojson"&&oe.lineMetrics||s.push(new We(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new We(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new We(m,c.source,'source "'+c.source+'" not found'))}else s.push(new We(m,c,'missing required property "source"'));return s=s.concat(Js({key:m,value:c,valueSpec:S.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Hi({key:m+".type",value:c.type,valueSpec:S.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:Th,layout:function(Ve){return Js({layer:c,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(Ge){return Vl(Rr({layerType:P},Ge))}}})},paint:function(Ve){return Js({layer:c,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(Ge){return kh(Rr({layerType:P},Ge))}}})}}}))}function es(a){var s=a.value,c=a.key,m=ka(s);return m!=="string"?[new We(c,s,"string expected, "+m+" found")]:[]}var $a={promoteId:function(a){var s=a.key,c=a.value;if(ka(c)==="string")return es({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,es({key:s+"."+_,value:c[_]}));return m}};function ha(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new We(c,s,'"type" is required')];var S,A=Kt(s.type);switch(A){case"vector":case"raster":case"raster-dem":return Js({key:c,value:s,valueSpec:m["source_"+A.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:$a});case"geojson":if(S=Js({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:$a}),s.cluster)for(var P in s.clusterProperties){var D=s.clusterProperties[P],U=D[0],G=typeof U=="string"?[U,["accumulated"],["get",P]]:U;S.push.apply(S,yl({key:c+"."+P+".map",value:D[1],expressionContext:"cluster-map"})),S.push.apply(S,yl({key:c+"."+P+".reduce",value:G,expressionContext:"cluster-reduce"}))}return S;case"video":return Js({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return Js({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new We(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return hc({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function jl(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,S=[],A=ka(s);if(s===void 0)return S;if(A!=="object")return S.concat([new We("light",s,"object expected, "+A+" found")]);for(var P in s){var D=P.match(/^(.*)-transition$/);S=S.concat(D&&m[D[1]]&&m[D[1]].transition?Hi({key:P,value:s[P],valueSpec:c.transition,style:_,styleSpec:c}):m[P]?Hi({key:P,value:s[P],valueSpec:m[P],style:_,styleSpec:c}):[new We(P,s[P],'unknown property "'+P+'"')])}return S}var el={"*":function(){return[]},array:mf,boolean:function(a){var s=a.value,c=a.key,m=ka(s);return m!=="boolean"?[new We(c,s,"boolean expected, "+m+" found")]:[]},number:gf,color:function(a){var s=a.key,c=a.value,m=ka(c);return m!=="string"?[new We(s,c,"color expected, "+m+" found")]:Fi(c)===null?[new We(s,c,'color expected, "'+c+'" found')]:[]},constants:Bt,enum:hc,filter:Th,function:Ul,layer:Ih,object:Js,source:ha,light:jl,string:es,formatted:function(a){return es(a).length===0?[]:yl(a)},resolvedImage:function(a){return es(a).length===0?[]:yl(a)}};function Hi(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&Nl(Kt(s))?Ul(a):c.expression&&fc(er(s))?yl(a):c.type&&el[c.type]?el[c.type](a):Js(Rr({},a,{valueSpec:c.type?m[c.type]:c}))}function Oa(a){var s=a.value,c=a.key,m=es(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new We(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new We(c,s,'"glyphs" url must include a "{range}" token'))),m}function Ps(a,s){s===void 0&&(s=_e);var c=[];return c=c.concat(Hi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:Oa,"*":function(){return[]}}})),a.constants&&(c=c.concat(Bt({key:"constants",value:a.constants,style:a,styleSpec:s}))),jc(c)}function jc(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function Ri(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return jc(a.apply(this,s))}}Ps.source=Ri(ha),Ps.light=Ri(jl),Ps.layer=Ri(Ih),Ps.filter=Ri(Th),Ps.paintProperty=Ri(kh),Ps.layoutProperty=Ri(Vl);var gs=Ps,wu=gs.light,Gl=gs.paintProperty,Gc=gs.layoutProperty;function dc(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new tt(new Error(_[m].message))),c=!0;return c}var Cu=Ho;function Ho(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[3+S],P=_[3+S+1];m.push(A===P?null:_.subarray(A,P))}var D=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],D),this.bboxes=_.subarray(D),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var U=0;U<this.d*this.d;U++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var G=c/s*a;this.min=-G,this.max=a+G}Ho.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Ho.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ho.prototype._insertCell=function(a,s,c,m,_,S){this.cells[_].push(S)},Ho.prototype.query=function(a,s,c,m,_){var S=this.min,A=this.max;if(a<=S&&s<=S&&A<=c&&A<=m&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(a,s,c,m,this._queryCell,P,{},_),P},Ho.prototype._queryCell=function(a,s,c,m,_,S,A,P){var D=this.cells[_];if(D!==null)for(var U=this.keys,G=this.bboxes,Q=0;Q<D.length;Q++){var oe=D[Q];if(A[oe]===void 0){var ve=4*oe;(P?P(G[ve+0],G[ve+1],G[ve+2],G[ve+3]):a<=G[ve+2]&&s<=G[ve+3]&&c>=G[ve+0]&&m>=G[ve+1])?(A[oe]=!0,S.push(U[oe])):A[oe]=!1}}},Ho.prototype._forEachCell=function(a,s,c,m,_,S,A,P){for(var D=this._convertToCellCoord(a),U=this._convertToCellCoord(s),G=this._convertToCellCoord(c),Q=this._convertToCellCoord(m),oe=D;oe<=G;oe++)for(var ve=U;ve<=Q;ve++){var Ve=this.d*ve+oe;if((!P||P(this._convertFromCellCoord(oe),this._convertFromCellCoord(ve),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(ve+1)))&&_.call(this,a,s,c,m,Ve,S,A,P))return}},Ho.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ho.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ho.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=s,A=0;A<a.length;A++){var P=a[A];_[3+A]=S,_.set(P,S),S+=P.length}return _[3+a.length]=S,_.set(this.keys,S),_[3+a.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer};var vc=Se.ImageData,Hl=Se.ImageBitmap,Mo={};function Ln(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Mo[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var uo in Ln("Object",Object),Cu.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},Cu.deserialize=function(a){return new Cu(a.buffer)},Ln("Grid",Cu),Ln("Color",pr),Ln("Error",Error),Ln("ResolvedImage",Le),Ln("StylePropertyFunction",gl),Ln("StyleExpression",Uc,{omit:["_evaluator"]}),Ln("ZoomDependentExpression",vl),Ln("ZoomConstantExpression",Zl),Ln("CompoundExpression",eo,{omit:["_evaluate"]}),Zu)Zu[uo]._classRegistryKey||Ln("Expression_"+uo,Zu[uo]);function La(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function xl(a){return Hl&&a instanceof Hl}function eu(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(La(a)||xl(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof vc)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,S=a;_<S.length;_+=1)m.push(eu(S[_],s));return m}if(typeof a=="object"){var A=a.constructor,P=A._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var D=A.serialize?A.serialize(a,s):{};if(!A.serialize){for(var U in a)if(a.hasOwnProperty(U)&&!(Mo[P].omit.indexOf(U)>=0)){var G=a[U];D[U]=Mo[P].shallow.indexOf(U)>=0?G:eu(G,s)}a instanceof Error&&(D.message=a.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(D.$name=P),D}throw new Error("can't serialize object of type "+typeof a)}function zs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||La(a)||xl(a)||ArrayBuffer.isView(a)||a instanceof vc)return a;if(Array.isArray(a))return a.map(zs);if(typeof a=="object"){var s=a.$name||"Object",c=Mo[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,S=Object.keys(a);_<S.length;_+=1){var A=S[_];if(A!=="$name"){var P=a[A];m[A]=Mo[s].shallow.indexOf(A)>=0?P:zs(P)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var bf=function(){this.first=!0};bf.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var hn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function mc(a){for(var s=0,c=a;s<c.length;s+=1)if(bl(c[s].charCodeAt(0)))return!0;return!1}function bl(a){return!(a!==746&&a!==747&&(a<4352||!(hn["Bopomofo Extended"](a)||hn.Bopomofo(a)||hn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||hn["CJK Compatibility Ideographs"](a)||hn["CJK Compatibility"](a)||hn["CJK Radicals Supplement"](a)||hn["CJK Strokes"](a)||!(!hn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||hn["CJK Unified Ideographs Extension A"](a)||hn["CJK Unified Ideographs"](a)||hn["Enclosed CJK Letters and Months"](a)||hn["Hangul Compatibility Jamo"](a)||hn["Hangul Jamo Extended-A"](a)||hn["Hangul Jamo Extended-B"](a)||hn["Hangul Jamo"](a)||hn["Hangul Syllables"](a)||hn.Hiragana(a)||hn["Ideographic Description Characters"](a)||hn.Kanbun(a)||hn["Kangxi Radicals"](a)||hn["Katakana Phonetic Extensions"](a)||hn.Katakana(a)&&a!==12540||!(!hn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!hn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||hn["Unified Canadian Aboriginal Syllabics"](a)||hn["Unified Canadian Aboriginal Syllabics Extended"](a)||hn["Vertical Forms"](a)||hn["Yijing Hexagram Symbols"](a)||hn["Yi Syllables"](a)||hn["Yi Radicals"](a))))}function tl(a){return!(bl(a)||function(s){return!!(hn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||hn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||hn["Letterlike Symbols"](s)||hn["Number Forms"](s)||hn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||hn["Control Pictures"](s)&&s!==9251||hn["Optical Character Recognition"](s)||hn["Enclosed Alphanumerics"](s)||hn["Geometric Shapes"](s)||hn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||hn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||hn["CJK Symbols and Punctuation"](s)||hn.Katakana(s)||hn["Private Use Area"](s)||hn["CJK Compatibility Forms"](s)||hn["Small Form Variants"](s)||hn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function xa(a){return a>=1424&&a<=2303||hn["Arabic Presentation Forms-A"](a)||hn["Arabic Presentation Forms-B"](a)}function Rs(a,s){return!(!s&&xa(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||hn.Khmer(a))}function Hc(a){for(var s=0,c=a;s<c.length;s+=1)if(xa(c[s].charCodeAt(0)))return!0;return!1}var Au=null,Os="unavailable",ju=null,Ef=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Os="error"),Au&&Au(a)};function Wl(){Kf.fire(new Ze("pluginStateChange",{pluginStatus:Os,pluginURL:ju}))}var Kf=new pt,Sf=function(){return Os},tu=function(){if(Os!=="deferred"||!ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os="loading",Wl(),ju&&_a({url:ju},function(a){a?Ef(a):(Os="loaded",Wl())})},Zs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Os==="loaded"||Zs.applyArabicShaping!=null},isLoading:function(){return Os==="loading"},setState:function(a){Os=a.pluginStatus,ju=a.pluginURL},isParsed:function(){return Zs.applyArabicShaping!=null&&Zs.processBidirectionalText!=null&&Zs.processStyledBidirectionalText!=null},getPluginURL:function(){return ju}},Oi=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bf,this.transition={})};Oi.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!Rs(_[m].charCodeAt(0),c))return!1;return!0}(a,Zs.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var ru=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(Nl(c))return new gl(c,m);if(fc(c)){var _=ml(c,m);if(_.result==="error")throw new Error(_.value.map(function(A){return A.key+": "+A.message}).join(", "));return _.value}var S=c;return typeof c=="string"&&m.type==="color"&&(S=pr.parse(c)),{kind:"constant",evaluate:function(){return S}}}(s===void 0?a.specification.default:s,a.specification)};ru.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ru.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var du=function(a){this.property=a,this.value=new ru(a,void 0)};du.prototype.transitioned=function(a,s){return new El(this.property,this.value,s,Nt({},a.transition,this.transition),a.now)},du.prototype.untransitioned=function(){return new El(this.property,this.value,null,{},0)};var ts=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};ts.prototype.getValue=function(a){return ht(this._values[a].value.value)},ts.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new du(this._values[a].property)),this._values[a].value=new ru(this._values[a].property,s===null?void 0:ht(s))},ts.prototype.getTransition=function(a){return ht(this._values[a].transition)},ts.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new du(this._values[a].property)),this._values[a].transition=ht(s)||void 0},ts.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var S=this.getTransition(m);S!==void 0&&(a[m+"-transition"]=S)}return a},ts.prototype.transitioned=function(a,s){for(var c=new rl(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var S=_[m];c._values[S]=this._values[S].transitioned(a,s._values[S])}return c},ts.prototype.untransitioned=function(){for(var a=new rl(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var El=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};El.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),S=this.prior;if(S){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return S.possiblyEvaluate(a,s,c);var A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,s,c),_,function(P){if(P<=0)return 0;if(P>=1)return 1;var D=P*P,U=D*P;return 4*(P<.5?U:3*(P-D)+U-.75)}(A))}return _};var rl=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};rl.prototype.possiblyEvaluate=function(a,s,c){for(var m=new vu(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var A=S[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,c)}return m},rl.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var Us=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Us.prototype.getValue=function(a){return ht(this._values[a].value)},Us.prototype.setValue=function(a,s){this._values[a]=new ru(this._values[a].property,s===null?void 0:ht(s))},Us.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},Us.prototype.possiblyEvaluate=function(a,s,c){for(var m=new vu(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var A=S[_];m._values[A]=this._values[A].possiblyEvaluate(a,s,c)}return m};var as=function(a,s,c){this.property=a,this.value=s,this.parameters=c};as.prototype.isConstant=function(){return this.value.kind==="constant"},as.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},as.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var vu=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};vu.prototype.get=function(a){return this._values[a]};var Xn=function(a){this.specification=a};Xn.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},Xn.prototype.interpolate=function(a,s,c){var m=Ia[this.specification.type];return m?m(a,s,c):a};var Un=function(a,s){this.specification=a,this.overrides=s};Un.prototype.possiblyEvaluate=function(a,s,c,m){return new as(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},Un.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new as(this,{kind:"constant",value:void 0},a.parameters);var m=Ia[this.specification.type];return m?new as(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},Un.prototype.evaluate=function(a,s,c,m,_,S){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,S)};var wf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,S){if(c.value===void 0)return new as(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var A=c.expression.evaluate(m,null,{},_,S),P=c.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,D=this._calculate(P,P,P,m);return new as(this,{kind:"constant",value:D},m)}if(c.expression.kind==="camera"){var U=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new as(this,{kind:"constant",value:U},m)}return new as(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,S,A,P){if(c.kind==="source"){var D=c.evaluate(m,_,S,A,P);return this._calculate(D,D,D,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,S),c.evaluate({zoom:Math.floor(m.zoom)},_,S),c.evaluate({zoom:Math.floor(m.zoom)+1},_,S),m):c.value},s.prototype._calculate=function(c,m,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(Un),os=function(a){this.specification=a};os.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Oi(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Oi(Math.floor(s.zoom),s)),a.expression.evaluate(new Oi(Math.floor(s.zoom+1),s)),s)}},os.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},os.prototype.interpolate=function(a){return a};var mu=function(a){this.specification=a};mu.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},mu.prototype.interpolate=function(){return!1};var rs=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new ru(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new du(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};Ln("DataDrivenProperty",Un),Ln("DataConstantProperty",Xn),Ln("CrossFadedDataDrivenProperty",wf),Ln("CrossFadedProperty",os),Ln("ColorRampProperty",mu);var nu=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new Us(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new ts(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var S in c.layout)this.setLayoutProperty(S,c.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vu(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(Gc,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return ee(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(Gl,"layers."+this.id+".paint."+c,c,m,_))return!1;if(ee(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var S=this._transitionablePaint._values[c],A=S.property.specification["property-type"]==="cross-faded-data-driven",P=S.value.isDataDriven(),D=S.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var U=this._transitionablePaint._values[c].value;return U.isDataDriven()||P||A||this._handleOverridablePaintPropertyUpdate(c,D,U)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Tt(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,S,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&dc(this,c.call(gs,{key:m,layerType:this.type,objectKey:_,value:S,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof as&&Qs(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(pt),gc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Xl=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ba=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Pa(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var S=gc[_.type].BYTES_PER_ELEMENT,A=c=Qf(c,Math.max(s,S)),P=_.components||1;return m=Math.max(m,S),c+=S*P,{name:_.name,type:_.type,components:P,offset:A}}),size:Qf(c,Math.max(m,s)),alignment:s}}function Qf(a,s){return Math.ceil(a/s)*s}ba.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},ba.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},ba.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ba.prototype.clear=function(){this.length=0},ba.prototype.resize=function(a){this.reserve(a),this.length=a},ba.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},ba.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var $l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.int16[S+0]=m,this.int16[S+1]=_,c},s}(ba);$l.prototype.bytesPerElement=4,Ln("StructArrayLayout2i4",$l);var gu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=4*c;return this.int16[P+0]=m,this.int16[P+1]=_,this.int16[P+2]=S,this.int16[P+3]=A,c},s}(ba);gu.prototype.bytesPerElement=8,Ln("StructArrayLayout4i8",gu);var Gu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,D){var U=6*c;return this.int16[U+0]=m,this.int16[U+1]=_,this.int16[U+2]=S,this.int16[U+3]=A,this.int16[U+4]=P,this.int16[U+5]=D,c},s}(ba);Gu.prototype.bytesPerElement=12,Ln("StructArrayLayout2i4i12",Gu);var Lo=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,D){var U=4*c,G=8*c;return this.int16[U+0]=m,this.int16[U+1]=_,this.uint8[G+4]=S,this.uint8[G+5]=A,this.uint8[G+6]=P,this.uint8[G+7]=D,c},s}(ba);Lo.prototype.bytesPerElement=8,Ln("StructArrayLayout2i4ub8",Lo);var Tu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.float32[S+0]=m,this.float32[S+1]=_,c},s}(ba);Tu.prototype.bytesPerElement=8,Ln("StructArrayLayout2f8",Tu);var Hu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,D,U,G,Q){var oe=this.length;return this.resize(oe+1),this.emplace(oe,c,m,_,S,A,P,D,U,G,Q)},s.prototype.emplace=function(c,m,_,S,A,P,D,U,G,Q,oe){var ve=10*c;return this.uint16[ve+0]=m,this.uint16[ve+1]=_,this.uint16[ve+2]=S,this.uint16[ve+3]=A,this.uint16[ve+4]=P,this.uint16[ve+5]=D,this.uint16[ve+6]=U,this.uint16[ve+7]=G,this.uint16[ve+8]=Q,this.uint16[ve+9]=oe,c},s}(ba);Hu.prototype.bytesPerElement=20,Ln("StructArrayLayout10ui20",Hu);var Wc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,D,U,G,Q,oe,ve){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,c,m,_,S,A,P,D,U,G,Q,oe,ve)},s.prototype.emplace=function(c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve){var Ge=12*c;return this.int16[Ge+0]=m,this.int16[Ge+1]=_,this.int16[Ge+2]=S,this.int16[Ge+3]=A,this.uint16[Ge+4]=P,this.uint16[Ge+5]=D,this.uint16[Ge+6]=U,this.uint16[Ge+7]=G,this.int16[Ge+8]=Q,this.int16[Ge+9]=oe,this.int16[Ge+10]=ve,this.int16[Ge+11]=Ve,c},s}(ba);Wc.prototype.bytesPerElement=24,Ln("StructArrayLayout4i4ui4i24",Wc);var Yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.float32[A+0]=m,this.float32[A+1]=_,this.float32[A+2]=S,c},s}(ba);Yl.prototype.bytesPerElement=12,Ln("StructArrayLayout3f12",Yl);var yc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(ba);yc.prototype.bytesPerElement=4,Ln("StructArrayLayout1ul4",yc);var Fo=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,D,U,G){var Q=this.length;return this.resize(Q+1),this.emplace(Q,c,m,_,S,A,P,D,U,G)},s.prototype.emplace=function(c,m,_,S,A,P,D,U,G,Q){var oe=10*c,ve=5*c;return this.int16[oe+0]=m,this.int16[oe+1]=_,this.int16[oe+2]=S,this.int16[oe+3]=A,this.int16[oe+4]=P,this.int16[oe+5]=D,this.uint32[ve+3]=U,this.uint16[oe+8]=G,this.uint16[oe+9]=Q,c},s}(ba);Fo.prototype.bytesPerElement=20,Ln("StructArrayLayout6i1ul2ui20",Fo);var Xc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,A,P)},s.prototype.emplace=function(c,m,_,S,A,P,D){var U=6*c;return this.int16[U+0]=m,this.int16[U+1]=_,this.int16[U+2]=S,this.int16[U+3]=A,this.int16[U+4]=P,this.int16[U+5]=D,c},s}(ba);Xc.prototype.bytesPerElement=12,Ln("StructArrayLayout2i2i2i12",Xc);var _c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,S,A)},s.prototype.emplace=function(c,m,_,S,A,P){var D=4*c,U=8*c;return this.float32[D+0]=m,this.float32[D+1]=_,this.float32[D+2]=S,this.int16[U+6]=A,this.int16[U+7]=P,c},s}(ba);_c.prototype.bytesPerElement=16,Ln("StructArrayLayout2f1f2i16",_c);var Ph=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=12*c,D=3*c;return this.uint8[P+0]=m,this.uint8[P+1]=_,this.float32[D+1]=S,this.float32[D+2]=A,c},s}(ba);Ph.prototype.bytesPerElement=12,Ln("StructArrayLayout2ub2f12",Ph);var Sl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.uint16[A+0]=m,this.uint16[A+1]=_,this.uint16[A+2]=S,c},s}(ba);Sl.prototype.bytesPerElement=6,Ln("StructArrayLayout3ui6",Sl);var ql=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct){var Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct)},s.prototype.emplace=function(c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct,Vt){var rr=24*c,ir=12*c,Ar=48*c;return this.int16[rr+0]=m,this.int16[rr+1]=_,this.uint16[rr+2]=S,this.uint16[rr+3]=A,this.uint32[ir+2]=P,this.uint32[ir+3]=D,this.uint32[ir+4]=U,this.uint16[rr+10]=G,this.uint16[rr+11]=Q,this.uint16[rr+12]=oe,this.float32[ir+7]=ve,this.float32[ir+8]=Ve,this.uint8[Ar+36]=Ge,this.uint8[Ar+37]=lt,this.uint8[Ar+38]=Je,this.uint32[ir+10]=Ct,this.int16[rr+22]=Vt,c},s}(ba);ql.prototype.bytesPerElement=48,Ln("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ql);var nl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct,Vt,rr,ir,Ar,Sr,tn,Yn,An,ti,In,Bi){var yi=this.length;return this.resize(yi+1),this.emplace(yi,c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct,Vt,rr,ir,Ar,Sr,tn,Yn,An,ti,In,Bi)},s.prototype.emplace=function(c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge,lt,Je,Ct,Vt,rr,ir,Ar,Sr,tn,Yn,An,ti,In,Bi,yi){var zn=34*c,Xi=17*c;return this.int16[zn+0]=m,this.int16[zn+1]=_,this.int16[zn+2]=S,this.int16[zn+3]=A,this.int16[zn+4]=P,this.int16[zn+5]=D,this.int16[zn+6]=U,this.int16[zn+7]=G,this.uint16[zn+8]=Q,this.uint16[zn+9]=oe,this.uint16[zn+10]=ve,this.uint16[zn+11]=Ve,this.uint16[zn+12]=Ge,this.uint16[zn+13]=lt,this.uint16[zn+14]=Je,this.uint16[zn+15]=Ct,this.uint16[zn+16]=Vt,this.uint16[zn+17]=rr,this.uint16[zn+18]=ir,this.uint16[zn+19]=Ar,this.uint16[zn+20]=Sr,this.uint16[zn+21]=tn,this.uint16[zn+22]=Yn,this.uint32[Xi+12]=An,this.float32[Xi+13]=ti,this.float32[Xi+14]=In,this.float32[Xi+15]=Bi,this.float32[Xi+16]=yi,c},s}(ba);nl.prototype.bytesPerElement=68,Ln("StructArrayLayout8i15ui1ul4f68",nl);var Wu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(ba);Wu.prototype.bytesPerElement=4,Ln("StructArrayLayout1f4",Wu);var ks=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=3*c;return this.int16[A+0]=m,this.int16[A+1]=_,this.int16[A+2]=S,c},s}(ba);ks.prototype.bytesPerElement=6,Ln("StructArrayLayout3i6",ks);var $c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var A=4*c;return this.uint32[2*c+0]=m,this.uint16[A+2]=_,this.uint16[A+3]=S,c},s}(ba);$c.prototype.bytesPerElement=8,Ln("StructArrayLayout1ul2ui8",$c);var xc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.uint16[S+0]=m,this.uint16[S+1]=_,c},s}(ba);xc.prototype.bytesPerElement=4,Ln("StructArrayLayout2ui4",xc);var Jf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(ba);Jf.prototype.bytesPerElement=2,Ln("StructArrayLayout1ui2",Jf);var Kl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,A){var P=4*c;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=S,this.float32[P+3]=A,c},s}(ba);Kl.prototype.bytesPerElement=16,Ln("StructArrayLayout4f16",Kl);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new pe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(Xl);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(Fo);Ln("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(Xl);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(ql);Ln("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(Xl);w.prototype.size=68;var M=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}(nl);Ln("SymbolInstanceArray",M);var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}(Wu);Ln("GlyphOffsetArray",I);var F=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(ks);Ln("SymbolLineVertexArray",F);var j=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(Xl);j.prototype.size=8;var J=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new j(this,c)},s}($c);Ln("FeatureIndexArray",J);var ye=Pa([{name:"a_pos",components:2,type:"Int16"}],4).members,le=function(a){a===void 0&&(a=[]),this.segments=a};function Ee(a,s){return 256*(a=Dt(Math.floor(a),0,255))+Dt(Math.floor(s),0,255)}le.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>le.MAX_VERTEX_ARRAY_LENGTH&&dt("Max vertices per segment is "+le.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>le.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},le.prototype.get=function(){return this.segments},le.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},le.simpleSegment=function(a,s,c,m){return new le([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},le.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ln("SegmentVector",le);var Ue=Pa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=Pe(function(a){a.exports=function(s,c){var m,_,S,A,P,D,U,G;for(_=s.length-(m=3&s.length),S=c,P=3432918353,D=461845907,G=0;G<_;)U=255&s.charCodeAt(G)|(255&s.charCodeAt(++G))<<8|(255&s.charCodeAt(++G))<<16|(255&s.charCodeAt(++G))<<24,++G,S=27492+(65535&(A=5*(65535&(S=(S^=U=(65535&(U=(U=(65535&U)*P+(((U>>>16)*P&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(U=0,m){case 3:U^=(255&s.charCodeAt(G+2))<<16;case 2:U^=(255&s.charCodeAt(G+1))<<8;case 1:S^=U=(65535&(U=(U=(65535&(U^=255&s.charCodeAt(G)))*P+(((U>>>16)*P&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return S^=s.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),nt=Pe(function(a){a.exports=function(s,c){for(var m,_=s.length,S=c^_,A=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:S^=(255&s.charCodeAt(A+2))<<16;case 2:S^=(255&s.charCodeAt(A+1))<<8;case 1:S=1540483477*(65535&(S^=255&s.charCodeAt(A)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),Ne=je,at=nt;Ne.murmur3=je,Ne.murmur2=at;var rt=function(){this.ids=[],this.positions=[],this.indexed=!1};rt.prototype.add=function(a,s,c,m){this.ids.push(or(a)),this.positions.push(s,c,m)},rt.prototype.getPositions=function(a){for(var s=or(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var S=[];this.ids[c]===s;)S.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return S},rt.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(S,A,P,D){for(;P<D;){for(var U=S[P+D>>1],G=P-1,Q=D+1;;){do G++;while(S[G]<U);do Q--;while(S[Q]>U);if(G>=Q)break;$(S,G,Q),$(A,3*G,3*Q),$(A,3*G+1,3*Q+1),$(A,3*G+2,3*Q+2)}Q-P<D-Q?(_(S,A,P,Q),P=Q+1):(_(S,A,Q+1,D),D=Q)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},rt.deserialize=function(a){var s=new rt;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var be=Math.pow(2,53)-1;function or(a){var s=+a;return!isNaN(s)&&s<=be?s:Ne(String(a))}function $(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}Ln("FeaturePositionMap",rt);var ur=function(a,s){this.gl=a.gl,this.location=s},Tr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(ur),rn=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(ur),Qr=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(ur),Sn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(ur),Jn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(ur),ei=function(a){function s(c,m){a.call(this,c,m),this.current=pr.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(ur),ni=new Float32Array(16),ji=function(a){function s(c,m){a.call(this,c,m),this.current=ni}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(ur);function wn(a){return[Ee(255*a.r,255*a.g),Ee(255*a.b,255*a.a)]}var vi=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};vi.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},vi.prototype.getBinding=function(a,s,c){return this.type==="color"?new ei(a,s):new rn(a,s)};var wi=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};wi.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},wi.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},wi.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new Jn(a,s):new rn(a,s)};var mi=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};mi.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.paintVertexArray.length,A=this.expression.evaluate(new Oi(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(S,a,A)},mi.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},mi.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=wn(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var S=a;S<s;S++)this.paintVertexArray.emplace(S,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},mi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ai=function(a,s,c,m,_,S){this.expression=a,this.uniformNames=s.map(function(A){return"u_"+A+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(A){return{name:"a_"+A,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new S};ai.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.expression.evaluate(new Oi(this.zoom),s,{},m,[],_),A=this.expression.evaluate(new Oi(this.zoom+1),s,{},m,[],_),P=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(P,a,S,A)},ai.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),S=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,S)},ai.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=wn(c),S=wn(m),A=a;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1]);else{for(var P=a;P<s;P++)this.paintVertexArray.emplace(P,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},ai.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ai.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Dt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},ai.prototype.getBinding=function(a,s,c){return new rn(a,s)};var Ai=function(a,s,c,m,_,S){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=S,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Ai.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},Ai.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},Ai.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],S=m[c.mid],A=m[c.max];if(_&&S&&A)for(var P=a;P<s;P++)this.zoomInPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],S.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],S.pixelRatio,A.pixelRatio)}},Ai.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Ue.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Ue.members,this.expression.isStateDependent))},Ai.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var si=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var S=a.paint.get(_);if(S instanceof as&&Qs(S.property.specification)){var A=go(_,a.type),P=S.value,D=S.property.specification.type,U=S.property.useIntegerZoom,G=S.property.specification["property-type"],Q=G==="cross-faded"||G==="cross-faded-data-driven";if(P.kind==="constant")this.binders[_]=Q?new wi(P.value,A):new vi(P.value,A,D),m.push("/u_"+_);else if(P.kind==="source"||Q){var oe=to(_,D,"source");this.binders[_]=Q?new Ai(P,D,U,s,oe,a.id):new mi(P,A,D,oe),m.push("/a_"+_)}else{var ve=to(_,D,"composite");this.binders[_]=new ai(P,A,D,U,s,ve),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};si.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof mi||s instanceof ai?s.maxValue:0},si.prototype.populatePaintArrays=function(a,s,c,m,_){for(var S in this.binders){var A=this.binders[S];(A instanceof mi||A instanceof ai||A instanceof Ai)&&A.populatePaintArray(a,s,c,m,_)}},si.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof wi&&m.setConstantPatternPositions(a,s)}},si.prototype.updatePaintArrays=function(a,s,c,m,_){var S=!1;for(var A in a)for(var P=0,D=s.getPositions(A);P<D.length;P+=1){var U=D[P],G=c.feature(U.index);for(var Q in this.binders){var oe=this.binders[Q];if((oe instanceof mi||oe instanceof ai||oe instanceof Ai)&&oe.expression.isStateDependent===!0){var ve=m.paint.get(Q);oe.expression=ve.value,oe.updatePaintArray(U.start,U.end,G,a[A],_),S=!0}}}return S},si.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof vi||c instanceof wi)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},si.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof mi||c instanceof ai)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof Ai)for(var _=0;_<Ue.members.length;_++)a.push(Ue.members[_].name)}return a},si.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof vi||c instanceof wi||c instanceof ai)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},si.prototype.getPaintVertexBuffers=function(){return this._buffers},si.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof vi||_ instanceof wi||_ instanceof ai)for(var S=0,A=_.uniformNames;S<A.length;S+=1){var P=A[S];if(s[P]){var D=_.getBinding(a,s[P],P);c.push({name:P,property:m,binding:D})}}}return c},si.prototype.setUniforms=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1){var A=S[_],P=A.name,D=A.property;this.binders[D].setUniform(A.binding,m,c.get(D),P)}},si.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof Ai){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof mi||c instanceof ai)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},si.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof mi||c instanceof ai||c instanceof Ai)&&c.upload(a)}this.updatePaintBuffers()},si.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof mi||s instanceof ai||s instanceof Ai)&&s.destroy()}};var oi=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var S=_[m];this.programConfigurations[S.id]=new si(S,s,c)}this.needsUpload=!1,this._featureMap=new rt,this._bufferOffset=0};function go(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function to(a,s,c){var m={color:{source:Tu,composite:Kl},number:{source:Wu,composite:Tu}},_=function(S){return{"line-pattern":{source:Hu,composite:Hu},"fill-pattern":{source:Hu,composite:Hu},"fill-extrusion-pattern":{source:Hu,composite:Hu}}[S]}(a);return _&&_[c]||m[s][c]}oi.prototype.populatePaintArrays=function(a,s,c,m,_,S){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,s,m,_,S);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},oi.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,S=c;_<S.length;_+=1){var A=S[_];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(a,this._featureMap,s,A,m)||this.needsUpload}},oi.prototype.get=function(a){return this.programConfigurations[a]},oi.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},oi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Ln("ConstantBinder",vi),Ln("CrossFadedConstantBinder",wi),Ln("SourceExpressionBinder",mi),Ln("CrossFadedCompositeBinder",Ai),Ln("CompositeExpressionBinder",ai),Ln("ProgramConfiguration",si,{omit:["_buffers"]}),Ln("ProgramConfigurationSet",oi);var Do=Math.pow(2,14)-1,bo=-Do-1;function Ya(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],S=0;S<_.length;S++){var A=_[S],P=Math.round(A.x*s),D=Math.round(A.y*s);A.x=Dt(P,bo,Do),A.y=Dt(D,bo,Do),(P<A.x||P>A.x+1||D<A.y||D>A.y+1)&&dt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function lo(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?Ya(a):[]}}function Ls(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var ys=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new $l,this.indexArray=new Sl,this.segments=new le,this.programConfigurations=new oi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Vs(a,s){for(var c=0;c<a.length;c++)if(Mu(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(Mu(a,s[m]))return!0;return!!bc(a,s)}function ss(a,s,c){return!!Mu(a,s)||!!Xu(s,a,c)}function yu(a,s){if(a.length===1)return Ql(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(Mu(a,m[_]))return!0;for(var S=0;S<a.length;S++)if(Ql(s,a[S]))return!0;for(var A=0;A<s.length;A++)if(bc(a,s[A]))return!0;return!1}function iu(a,s,c){if(a.length>1){if(bc(a,s))return!0;for(var m=0;m<s.length;m++)if(Xu(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(Xu(a[_],s,c))return!0;return!1}function bc(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],S=0;S<s.length-1;S++)if(il(m,_,s[S],s[S+1]))return!0;return!1}function il(a,s,c,m){return lr(a,c,m)!==lr(s,c,m)&&lr(a,s,c)!==lr(a,s,m)}function Xu(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(Fs(a,s[_-1],s[_])<m)return!0;return!1}function Fs(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Ql(a,s){for(var c,m,_,S=!1,A=0;A<a.length;A++)for(var P=0,D=(c=a[A]).length-1;P<c.length;D=P++)(m=c[P]).y>s.y!=(_=c[D]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(S=!S);return S}function Mu(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var S=a[m],A=a[_];S.y>s.y!=A.y>s.y&&s.x<(A.x-S.x)*(s.y-S.y)/(A.y-S.y)+S.x&&(c=!c)}return c}function Jl(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var S=lr(a,s,c[0]);return S!==lr(a,s,c[1])||S!==lr(a,s,c[2])||S!==lr(a,s,c[3])}function $u(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function Bo(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ku(a,s,c,m,_){if(!s[0]&&!s[1])return a;var S=pe.convert(s)._mult(_);c==="viewport"&&S._rotate(-m);for(var A=[],P=0;P<a.length;P++)A.push(a[P].sub(S));return A}ys.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],S=null;m.type==="circle"&&(S=m.layout.get("circle-sort-key"));for(var A=0,P=a;A<P.length;A+=1){var D=P[A],U=D.feature,G=D.id,Q=D.index,oe=D.sourceLayerIndex,ve=this.layers[0]._featureFilter.needGeometry,Ve=lo(U,ve);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Ve,c)){var Ge=S?S.evaluate(Ve,{},c):void 0,lt={id:G,properties:U.properties,type:U.type,sourceLayerIndex:oe,index:Q,geometry:ve?Ve.geometry:Ya(U),patterns:{},sortKey:Ge};_.push(lt)}}S&&_.sort(function(tn,Yn){return tn.sortKey-Yn.sortKey});for(var Je=0,Ct=_;Je<Ct.length;Je+=1){var Vt=Ct[Je],rr=Vt.geometry,ir=Vt.index,Ar=Vt.sourceLayerIndex,Sr=a[ir].feature;this.addFeature(Vt,rr,ir,c),s.featureIndex.insert(Sr,rr,ir,Ar,this.index)}},ys.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ys.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ye),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ys.prototype.addFeature=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1)for(var A=0,P=S[_];A<P.length;A+=1){var D=P[A],U=D.x,G=D.y;if(!(U<0||U>=8192||G<0||G>=8192)){var Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),oe=Q.vertexLength;Ls(this.layoutVertexArray,U,G,-1,-1),Ls(this.layoutVertexArray,U,G,1,-1),Ls(this.layoutVertexArray,U,G,1,1),Ls(this.layoutVertexArray,U,G,-1,1),this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+3,oe+2),Q.vertexLength+=4,Q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},Ln("CircleBucket",ys,{omit:["layers"]});var Yu=new rs({"circle-sort-key":new Un(_e.layout_circle["circle-sort-key"])}),wl={paint:new rs({"circle-radius":new Un(_e.paint_circle["circle-radius"]),"circle-color":new Un(_e.paint_circle["circle-color"]),"circle-blur":new Un(_e.paint_circle["circle-blur"]),"circle-opacity":new Un(_e.paint_circle["circle-opacity"]),"circle-translate":new Xn(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new Xn(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xn(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xn(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Un(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Un(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Un(_e.paint_circle["circle-stroke-opacity"])}),layout:Yu},ma=typeof Float32Array!="undefined"?Float32Array:Array;function js(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function _s(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3],P=s[4],D=s[5],U=s[6],G=s[7],Q=s[8],oe=s[9],ve=s[10],Ve=s[11],Ge=s[12],lt=s[13],Je=s[14],Ct=s[15],Vt=c[0],rr=c[1],ir=c[2],Ar=c[3];return a[0]=Vt*m+rr*P+ir*Q+Ar*Ge,a[1]=Vt*_+rr*D+ir*oe+Ar*lt,a[2]=Vt*S+rr*U+ir*ve+Ar*Je,a[3]=Vt*A+rr*G+ir*Ve+Ar*Ct,a[4]=(Vt=c[4])*m+(rr=c[5])*P+(ir=c[6])*Q+(Ar=c[7])*Ge,a[5]=Vt*_+rr*D+ir*oe+Ar*lt,a[6]=Vt*S+rr*U+ir*ve+Ar*Je,a[7]=Vt*A+rr*G+ir*Ve+Ar*Ct,a[8]=(Vt=c[8])*m+(rr=c[9])*P+(ir=c[10])*Q+(Ar=c[11])*Ge,a[9]=Vt*_+rr*D+ir*oe+Ar*lt,a[10]=Vt*S+rr*U+ir*ve+Ar*Je,a[11]=Vt*A+rr*G+ir*Ve+Ar*Ct,a[12]=(Vt=c[12])*m+(rr=c[13])*P+(ir=c[14])*Q+(Ar=c[15])*Ge,a[13]=Vt*_+rr*D+ir*oe+Ar*lt,a[14]=Vt*S+rr*U+ir*ve+Ar*Je,a[15]=Vt*A+rr*G+ir*Ve+Ar*Ct,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var al,Yc=_s;function qc(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*S+c[12]*A,a[1]=c[1]*m+c[5]*_+c[9]*S+c[13]*A,a[2]=c[2]*m+c[6]*_+c[10]*S+c[14]*A,a[3]=c[3]*m+c[7]*_+c[11]*S+c[15]*A,a}al=new ma(3),ma!=Float32Array&&(al[0]=0,al[1]=0,al[2]=0),function(){var a=new ma(4);ma!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Cf=(function(){var a=new ma(2);ma!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,wl)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new ys(c)},s.prototype.queryRadius=function(c){var m=c;return $u("circle-radius",this,m)+$u("circle-stroke-width",this,m)+Bo(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,D,U){for(var G=ku(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,D),Q=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),oe=this.paint.get("circle-pitch-alignment")==="map",ve=oe?G:function(Sr,tn){return Sr.map(function(Yn){return au(Yn,tn)})}(G,U),Ve=oe?Q*D:Q,Ge=0,lt=S;Ge<lt.length;Ge+=1)for(var Je=0,Ct=lt[Ge];Je<Ct.length;Je+=1){var Vt=Ct[Je],rr=oe?Vt:au(Vt,U),ir=Ve,Ar=qc([],[Vt.x,Vt.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ir*=Ar[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ir*=P.cameraToCenterDistance/Ar[3]),ss(ve,rr,ir))return!0}return!1},s}(nu));function au(a,s){var c=qc([],[a.x,a.y,0,1],s);return new pe(c[0]/c[3],c[1]/c[3])}var ol=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(ys);function ou(a,s,c,m){var _=s.width,S=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*S*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*S*c);return a.width=_,a.height=S,a.data=m,a}function Cl(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var S=ou({},{width:m,height:_},c);Kc(a,S,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=S.data}}function Kc(a,s,c,m,_,S){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=a.data,P=s.data,D=0;D<_.height;D++)for(var U=((c.y+D)*a.width+c.x)*S,G=((m.y+D)*s.width+m.x)*S,Q=0;Q<_.width*S;Q++)P[G+Q]=A[U+Q];return s}Ln("HeatmapBucket",ol,{omit:["layers"]});var _u=function(a,s){ou(this,a,1,s)};_u.prototype.resize=function(a){Cl(this,a,1)},_u.prototype.clone=function(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))},_u.copy=function(a,s,c,m,_){Kc(a,s,c,m,_,1)};var No=function(a,s){ou(this,a,4,s)};No.prototype.resize=function(a){Cl(this,a,4)},No.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},No.prototype.clone=function(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))},No.copy=function(a,s,c,m,_){Kc(a,s,c,m,_,4)},Ln("AlphaImage",_u),Ln("RGBAImage",No);var ec={paint:new rs({"heatmap-radius":new Un(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Un(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xn(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mu(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xn(_e.paint_heatmap["heatmap-opacity"])})};function Rh(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new No({width:c,height:m}),S=function(Ve,Ge,lt){s[a.evaluationKey]=lt;var Je=a.expression.evaluate(s);_.data[Ve+Ge+0]=Math.floor(255*Je.r/Je.a),_.data[Ve+Ge+1]=Math.floor(255*Je.g/Je.a),_.data[Ve+Ge+2]=Math.floor(255*Je.b/Je.a),_.data[Ve+Ge+3]=Math.floor(255*Je.a)};if(a.clips)for(var A=0,P=0;A<m;++A,P+=4*c)for(var D=0,U=0;D<c;D++,U+=4){var G=D/(c-1),Q=a.clips[A];S(P,U,Q.start*(1-G)+Q.end*G)}else for(var oe=0,ve=0;oe<c;oe++,ve+=4)S(0,ve,oe/(c-1));return _}var Oh=function(a){function s(c){a.call(this,c,ec),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new ol(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Rh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(nu),eh={paint:new rs({"hillshade-illumination-direction":new Xn(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xn(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xn(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xn(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xn(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xn(_e.paint_hillshade["hillshade-accent-color"])})},fp=function(a){function s(c){a.call(this,c,eh)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(nu),Yp=Pa([{name:"a_pos",components:2,type:"Int16"}],4).members,Qc=Af,Ec=Af;function Af(a,s,c){c=c||2;var m,_,S,A,P,D,U,G=s&&s.length,Q=G?s[0]*c:a.length,oe=Lh(a,0,Q,c,!0),ve=[];if(!oe||oe.next===oe.prev)return ve;if(G&&(oe=function(Ge,lt,Je,Ct){var Vt,rr,ir,Ar=[];for(Vt=0,rr=lt.length;Vt<rr;Vt++)(ir=Lh(Ge,lt[Vt]*Ct,Vt<rr-1?lt[Vt+1]*Ct:Ge.length,Ct,!1))===ir.next&&(ir.steiner=!0),Ar.push(hp(ir));for(Ar.sort(Pv),Vt=0;Vt<Ar.length;Vt++)us(Ar[Vt],Je),Je=sl(Je,Je.next);return Je}(a,s,oe,c)),a.length>80*c){m=S=a[0],_=A=a[1];for(var Ve=c;Ve<Q;Ve+=c)(P=a[Ve])<m&&(m=P),(D=a[Ve+1])<_&&(_=D),P>S&&(S=P),D>A&&(A=D);U=(U=Math.max(S-m,A-_))!==0?1/U:0}return Tf(oe,ve,c,m,_,U),ve}function Lh(a,s,c,m,_){var S,A;if(_===Rf(a,s,c,m)>0)for(S=s;S<c;S+=m)A=th(S,a[S],a[S+1],A);else for(S=c-m;S>=s;S-=m)A=th(S,a[S],a[S+1],A);return A&&pp(A,A.next)&&(wc(A),A=A.next),A}function sl(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!pp(m,m.next)&&Eo(m.prev,m,m.next)!==0)m=m.next;else{if(wc(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function Tf(a,s,c,m,_,S,A){if(a){!A&&S&&function(G,Q,oe,ve){var Ve=G;do Ve.z===null&&(Ve.z=Sc(Ve.x,Ve.y,Q,oe,ve)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==G);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(Ge){var lt,Je,Ct,Vt,rr,ir,Ar,Sr,tn=1;do{for(Je=Ge,Ge=null,rr=null,ir=0;Je;){for(ir++,Ct=Je,Ar=0,lt=0;lt<tn&&(Ar++,Ct=Ct.nextZ);lt++);for(Sr=tn;Ar>0||Sr>0&&Ct;)Ar!==0&&(Sr===0||!Ct||Je.z<=Ct.z)?(Vt=Je,Je=Je.nextZ,Ar--):(Vt=Ct,Ct=Ct.nextZ,Sr--),rr?rr.nextZ=Vt:Ge=Vt,Vt.prevZ=rr,rr=Vt;Je=Ct}rr.nextZ=null,tn*=2}while(ir>1)}(Ve)}(a,m,_,S);for(var P,D,U=a;a.prev!==a.next;)if(P=a.prev,D=a.next,S?X(a,m,_,S):Iu(a))s.push(P.i/c),s.push(a.i/c),s.push(D.i/c),wc(a),a=D.next,U=D.next;else if((a=D)===U){A?A===1?Tf(a=Vr(sl(a),s,c),s,c,m,_,S,2):A===2&&Mf(a,s,c,m,_,S):Tf(sl(a),s,c,m,_,S,1);break}}}function Iu(a){var s=a.prev,c=a,m=a.next;if(Eo(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(Pu(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&Eo(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function X(a,s,c,m){var _=a.prev,S=a,A=a.next;if(Eo(_,S,A)>=0)return!1;for(var P=_.x>S.x?_.x>A.x?_.x:A.x:S.x>A.x?S.x:A.x,D=_.y>S.y?_.y>A.y?_.y:A.y:S.y>A.y?S.y:A.y,U=Sc(_.x<S.x?_.x<A.x?_.x:A.x:S.x<A.x?S.x:A.x,_.y<S.y?_.y<A.y?_.y:A.y:S.y<A.y?S.y:A.y,s,c,m),G=Sc(P,D,s,c,m),Q=a.prevZ,oe=a.nextZ;Q&&Q.z>=U&&oe&&oe.z<=G;){if(Q!==a.prev&&Q!==a.next&&Pu(_.x,_.y,S.x,S.y,A.x,A.y,Q.x,Q.y)&&Eo(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,oe!==a.prev&&oe!==a.next&&Pu(_.x,_.y,S.x,S.y,A.x,A.y,oe.x,oe.y)&&Eo(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Q&&Q.z>=U;){if(Q!==a.prev&&Q!==a.next&&Pu(_.x,_.y,S.x,S.y,A.x,A.y,Q.x,Q.y)&&Eo(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;oe&&oe.z<=G;){if(oe!==a.prev&&oe!==a.next&&Pu(_.x,_.y,S.x,S.y,A.x,A.y,oe.x,oe.y)&&Eo(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Vr(a,s,c){var m=a;do{var _=m.prev,S=m.next.next;!pp(_,S)&&qp(_,m,m.next,S)&&Pf(_,S)&&Pf(S,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(S.i/c),wc(m),wc(m.next),m=a=S),m=m.next}while(m!==a);return sl(m)}function Mf(a,s,c,m,_,S){var A=a;do{for(var P=A.next.next;P!==A.prev;){if(A.i!==P.i&&kf(A,P)){var D=Fh(A,P);return A=sl(A,A.next),D=sl(D,D.next),Tf(A,s,c,m,_,S),void Tf(D,s,c,m,_,S)}P=P.next}A=A.next}while(A!==a)}function Pv(a,s){return a.x-s.x}function us(a,s){if(s=function(m,_){var S,A=_,P=m.x,D=m.y,U=-1/0;do{if(D<=A.y&&D>=A.next.y&&A.next.y!==A.y){var G=A.x+(D-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(G<=P&&G>U){if(U=G,G===P){if(D===A.y)return A;if(D===A.next.y)return A.next}S=A.x<A.next.x?A:A.next}}A=A.next}while(A!==_);if(!S)return null;if(P===U)return S;var Q,oe=S,ve=S.x,Ve=S.y,Ge=1/0;A=S;do P>=A.x&&A.x>=ve&&P!==A.x&&Pu(D<Ve?P:U,D,ve,Ve,D<Ve?U:P,D,A.x,A.y)&&(Q=Math.abs(D-A.y)/(P-A.x),Pf(A,m)&&(Q<Ge||Q===Ge&&(A.x>S.x||A.x===S.x&&tc(S,A)))&&(S=A,Ge=Q)),A=A.next;while(A!==oe);return S}(a,s)){var c=Fh(s,a);sl(s,s.next),sl(c,c.next)}}function tc(a,s){return Eo(a.prev,a,s.prev)<0&&Eo(s.next,a,a.next)<0}function Sc(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function hp(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function Pu(a,s,c,m,_,S,A,P){return(_-A)*(s-P)-(a-A)*(S-P)>=0&&(a-A)*(m-P)-(c-A)*(s-P)>=0&&(c-A)*(S-P)-(_-A)*(m-P)>=0}function kf(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&qp(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(Pf(a,s)&&Pf(s,a)&&function(c,m){var _=c,S=!1,A=(c.x+m.x)/2,P=(c.y+m.y)/2;do _.y>P!=_.next.y>P&&_.next.y!==_.y&&A<(_.next.x-_.x)*(P-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==c);return S}(a,s)&&(Eo(a.prev,a,s.prev)||Eo(a,s.prev,s))||pp(a,s)&&Eo(a.prev,a,a.next)>0&&Eo(s.prev,s,s.next)>0)}function Eo(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function pp(a,s){return a.x===s.x&&a.y===s.y}function qp(a,s,c,m){var _=Jc(Eo(a,s,c)),S=Jc(Eo(a,s,m)),A=Jc(Eo(c,m,a)),P=Jc(Eo(c,m,s));return _!==S&&A!==P||!(_!==0||!If(a,c,s))||!(S!==0||!If(a,m,s))||!(A!==0||!If(c,a,m))||!(P!==0||!If(c,s,m))}function If(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function Jc(a){return a>0?1:a<0?-1:0}function Pf(a,s){return Eo(a.prev,a,a.next)<0?Eo(a,s,a.next)>=0&&Eo(a,a.prev,s)>=0:Eo(a,s,a.prev)<0||Eo(a,a.next,s)<0}function Fh(a,s){var c=new ef(a.i,a.x,a.y),m=new ef(s.i,s.x,s.y),_=a.next,S=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,S.next=m,m.prev=S,m}function th(a,s,c,m){var _=new ef(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function wc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ef(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rf(a,s,c,m){for(var _=0,S=s,A=c-m;S<c;S+=m)_+=(a[A]-a[S])*(a[S+1]+a[A+1]),A=S;return _}function Dh(a,s,c,m,_){(function S(A,P,D,U,G){for(;U>D;){if(U-D>600){var Q=U-D+1,oe=P-D+1,ve=Math.log(Q),Ve=.5*Math.exp(2*ve/3),Ge=.5*Math.sqrt(ve*Ve*(Q-Ve)/Q)*(oe-Q/2<0?-1:1);S(A,P,Math.max(D,Math.floor(P-oe*Ve/Q+Ge)),Math.min(U,Math.floor(P+(Q-oe)*Ve/Q+Ge)),G)}var lt=A[P],Je=D,Ct=U;for(Al(A,D,P),G(A[U],lt)>0&&Al(A,D,U);Je<Ct;){for(Al(A,Je,Ct),Je++,Ct--;G(A[Je],lt)<0;)Je++;for(;G(A[Ct],lt)>0;)Ct--}G(A[D],lt)===0?Al(A,D,Ct):Al(A,++Ct,U),Ct<=P&&(D=Ct+1),P<=Ct&&(U=Ct-1)}})(a,s,c||0,m||a.length-1,_||rh)}function Al(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function rh(a,s){return a<s?-1:a>s?1:0}function nh(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,S=[],A=0;A<c;A++){var P=jr(a[A]);P!==0&&(a[A].area=Math.abs(P),_===void 0&&(_=P<0),_===P<0?(m&&S.push(m),m=[a[A]]):m.push(a[A]))}if(m&&S.push(m),s>1)for(var D=0;D<S.length;D++)S[D].length<=s||(Dh(S[D],s,1,S[D].length-1,Bh),S[D]=S[D].slice(0,s));return S}function Bh(a,s){return s.area-a.area}function Of(a,s,c){for(var m=c.patternDependencies,_=!1,S=0,A=s;S<A.length;S+=1){var P=A[S].paint.get(a+"-pattern");P.isConstant()||(_=!0);var D=P.constantOr(null);D&&(_=!0,m[D.to]=!0,m[D.from]=!0)}return _}function Tl(a,s,c,m,_){for(var S=_.patternDependencies,A=0,P=s;A<P.length;A+=1){var D=P[A],U=D.paint.get(a+"-pattern").value;if(U.kind!=="constant"){var G=U.evaluate({zoom:m-1},c,{},_.availableImages),Q=U.evaluate({zoom:m},c,{},_.availableImages),oe=U.evaluate({zoom:m+1},c,{},_.availableImages);Q=Q&&Q.name?Q.name:Q,oe=oe&&oe.name?oe.name:oe,S[G=G&&G.name?G.name:G]=!0,S[Q]=!0,S[oe]=!0,c.patterns[D.id]={min:G,mid:Q,max:oe}}}return c}Af.deviation=function(a,s,c,m){var _=s&&s.length,S=Math.abs(Rf(a,0,_?s[0]*c:a.length,c));if(_)for(var A=0,P=s.length;A<P;A++)S-=Math.abs(Rf(a,s[A]*c,A<P-1?s[A+1]*c:a.length,c));var D=0;for(A=0;A<m.length;A+=3){var U=m[A]*c,G=m[A+1]*c,Q=m[A+2]*c;D+=Math.abs((a[U]-a[Q])*(a[G+1]-a[U+1])-(a[U]-a[G])*(a[Q+1]-a[U+1]))}return S===0&&D===0?0:Math.abs((D-S)/S)},Af.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var S=0;S<a[_].length;S++)for(var A=0;A<s;A++)c.vertices.push(a[_][S][A]);_>0&&c.holes.push(m+=a[_-1].length)}return c},Qc.default=Ec;var su=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $l,this.indexArray=new Sl,this.indexArray2=new xc,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new le,this.segments2=new le,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};su.prototype.populate=function(a,s,c){this.hasPattern=Of("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],S=0,A=a;S<A.length;S+=1){var P=A[S],D=P.feature,U=P.id,G=P.index,Q=P.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,ve=lo(D,oe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ve,c)){var Ve=m?m.evaluate(ve,{},c,s.availableImages):void 0,Ge={id:U,properties:D.properties,type:D.type,sourceLayerIndex:Q,index:G,geometry:oe?ve.geometry:Ya(D),patterns:{},sortKey:Ve};_.push(Ge)}}m&&_.sort(function(Sr,tn){return Sr.sortKey-tn.sortKey});for(var lt=0,Je=_;lt<Je.length;lt+=1){var Ct=Je[lt],Vt=Ct.geometry,rr=Ct.index,ir=Ct.sourceLayerIndex;if(this.hasPattern){var Ar=Tl("fill",this.layers,Ct,this.zoom,s);this.patternFeatures.push(Ar)}else this.addFeature(Ct,Vt,rr,c,{});s.featureIndex.insert(a[rr].feature,Vt,rr,ir,this.index)}},su.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},su.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},su.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},su.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yp),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},su.prototype.addFeature=function(a,s,c,m,_){for(var S=0,A=nh(s,500);S<A.length;S+=1){for(var P=A[S],D=0,U=0,G=P;U<G.length;U+=1)D+=G[U].length;for(var Q=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),oe=Q.vertexLength,ve=[],Ve=[],Ge=0,lt=P;Ge<lt.length;Ge+=1){var Je=lt[Ge];if(Je.length!==0){Je!==P[0]&&Ve.push(ve.length/2);var Ct=this.segments2.prepareSegment(Je.length,this.layoutVertexArray,this.indexArray2),Vt=Ct.vertexLength;this.layoutVertexArray.emplaceBack(Je[0].x,Je[0].y),this.indexArray2.emplaceBack(Vt+Je.length-1,Vt),ve.push(Je[0].x),ve.push(Je[0].y);for(var rr=1;rr<Je.length;rr++)this.layoutVertexArray.emplaceBack(Je[rr].x,Je[rr].y),this.indexArray2.emplaceBack(Vt+rr-1,Vt+rr),ve.push(Je[rr].x),ve.push(Je[rr].y);Ct.vertexLength+=Je.length,Ct.primitiveLength+=Je.length}}for(var ir=Qc(ve,Ve),Ar=0;Ar<ir.length;Ar+=3)this.indexArray.emplaceBack(oe+ir[Ar],oe+ir[Ar+1],oe+ir[Ar+2]);Q.vertexLength+=D,Q.primitiveLength+=ir.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Ln("FillBucket",su,{omit:["layers","patternFeatures"]});var ih=new rs({"fill-sort-key":new Un(_e.layout_fill["fill-sort-key"])}),ah={paint:new rs({"fill-antialias":new Xn(_e.paint_fill["fill-antialias"]),"fill-opacity":new Un(_e.paint_fill["fill-opacity"]),"fill-color":new Un(_e.paint_fill["fill-color"]),"fill-outline-color":new Un(_e.paint_fill["fill-outline-color"]),"fill-translate":new Xn(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new Xn(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new wf(_e.paint_fill["fill-pattern"])}),layout:ih},oh=function(a){function s(c){a.call(this,c,ah)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new su(c)},s.prototype.queryRadius=function(){return Bo(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,D){return yu(ku(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,D),S)},s.prototype.isTileClipped=function(){return!0},s}(nu),sh=Pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Lf=Gs;function Gs(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(ul,this,s)}function ul(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var S=m.readVarint()+m.pos;m.pos<S;){var A=_._keys[m.readVarint()],P=_._values[m.readVarint()];_.properties[A]=P}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Kp(a){for(var s,c,m=0,_=0,S=a.length,A=S-1;_<S;A=_++)m+=((c=a[A]).x-(s=a[_]).x)*(s.y+c.y);return m}Gs.types=["Unknown","Point","LineString","Polygon"],Gs.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,S=0,A=0,P=[];a.pos<c;){if(_<=0){var D=a.readVarint();m=7&D,_=D>>3}if(_--,m===1||m===2)S+=a.readSVarint(),A+=a.readSVarint(),m===1&&(s&&P.push(s),s=[]),s.push(new pe(S,A));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&P.push(s),P},Gs.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,S=0,A=1/0,P=-1/0,D=1/0,U=-1/0;a.pos<s;){if(m<=0){var G=a.readVarint();c=7&G,m=G>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<A&&(A=_),_>P&&(P=_),(S+=a.readSVarint())<D&&(D=S),S>U&&(U=S);else if(c!==7)throw new Error("unknown command "+c)}return[A,D,P,U]},Gs.prototype.toGeoJSON=function(a,s,c){var m,_,S=this.extent*Math.pow(2,c),A=this.extent*a,P=this.extent*s,D=this.loadGeometry(),U=Gs.types[this.type];function G(ve){for(var Ve=0;Ve<ve.length;Ve++){var Ge=ve[Ve];ve[Ve]=[360*(Ge.x+A)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ge.y+P)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var Q=[];for(m=0;m<D.length;m++)Q[m]=D[m][0];G(D=Q);break;case 2:for(m=0;m<D.length;m++)G(D[m]);break;case 3:for(D=function(ve){var Ve=ve.length;if(Ve<=1)return[ve];for(var Ge,lt,Je=[],Ct=0;Ct<Ve;Ct++){var Vt=Kp(ve[Ct]);Vt!==0&&(lt===void 0&&(lt=Vt<0),lt===Vt<0?(Ge&&Je.push(Ge),Ge=[ve[Ct]]):Ge.push(ve[Ct]))}return Ge&&Je.push(Ge),Je}(D),m=0;m<D.length;m++)for(_=0;_<D[m].length;_++)G(D[m][_])}D.length===1?D=D[0]:U="Multi"+U;var oe={type:"Feature",geometry:{type:U,coordinates:D},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var Nh=Nd;function Nd(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Ff,this,s),this.length=this._features.length}function Ff(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,S=m.readVarint()+m.pos;m.pos<S;){var A=m.readVarint()>>3;_=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return _}(c))}function Ru(a,s,c){if(a===3){var m=new Nh(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}Nd.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new Lf(this._pbf,s,this.extent,this._keys,this._values)};var xu={VectorTile:function(a,s){this.layers=a.readFields(Ru,{},s)},VectorTileFeature:Lf,VectorTileLayer:Nh},dp=xu.VectorTileFeature.types,tf=Math.pow(2,13);function Df(a,s,c,m,_,S,A,P){a.emplaceBack(s,c,2*Math.floor(m*tf)+A,_*tf*2,S*tf*2,Math.round(P))}var ll=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Gu,this.indexArray=new Sl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new le,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Qp(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}ll.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Of("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var S=_[m],A=S.feature,P=S.id,D=S.index,U=S.sourceLayerIndex,G=this.layers[0]._featureFilter.needGeometry,Q=lo(A,G);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Q,c)){var oe={id:P,sourceLayerIndex:U,index:D,geometry:G?Q.geometry:Ya(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(Tl("fill-extrusion",this.layers,oe,this.zoom,s)):this.addFeature(oe,oe.geometry,D,c,{}),s.featureIndex.insert(A,oe.geometry,D,U,this.index,!0)}}},ll.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},ll.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},ll.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ll.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ll.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,sh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ll.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ll.prototype.addFeature=function(a,s,c,m,_){for(var S=0,A=nh(s,500);S<A.length;S+=1){for(var P=A[S],D=0,U=0,G=P;U<G.length;U+=1)D+=G[U].length;for(var Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),oe=0,ve=P;oe<ve.length;oe+=1){var Ve=ve[oe];if(Ve.length!==0&&!((Xi=Ve).every(function(Li){return Li.x<0})||Xi.every(function(Li){return Li.x>8192})||Xi.every(function(Li){return Li.y<0})||Xi.every(function(Li){return Li.y>8192})))for(var Ge=0,lt=0;lt<Ve.length;lt++){var Je=Ve[lt];if(lt>=1){var Ct=Ve[lt-1];if(!Qp(Je,Ct)){Q.vertexLength+4>le.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Vt=Je.sub(Ct)._perp()._unit(),rr=Ct.dist(Je);Ge+rr>32768&&(Ge=0),Df(this.layoutVertexArray,Je.x,Je.y,Vt.x,Vt.y,0,0,Ge),Df(this.layoutVertexArray,Je.x,Je.y,Vt.x,Vt.y,0,1,Ge),Df(this.layoutVertexArray,Ct.x,Ct.y,Vt.x,Vt.y,0,0,Ge+=rr),Df(this.layoutVertexArray,Ct.x,Ct.y,Vt.x,Vt.y,0,1,Ge);var ir=Q.vertexLength;this.indexArray.emplaceBack(ir,ir+2,ir+1),this.indexArray.emplaceBack(ir+1,ir+2,ir+3),Q.vertexLength+=4,Q.primitiveLength+=2}}}}if(Q.vertexLength+D>le.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),dp[a.type]==="Polygon"){for(var Ar=[],Sr=[],tn=Q.vertexLength,Yn=0,An=P;Yn<An.length;Yn+=1){var ti=An[Yn];if(ti.length!==0){ti!==P[0]&&Sr.push(Ar.length/2);for(var In=0;In<ti.length;In++){var Bi=ti[In];Df(this.layoutVertexArray,Bi.x,Bi.y,0,0,1,1,0),Ar.push(Bi.x),Ar.push(Bi.y)}}}for(var yi=Qc(Ar,Sr),zn=0;zn<yi.length;zn+=3)this.indexArray.emplaceBack(tn+yi[zn],tn+yi[zn+2],tn+yi[zn+1]);Q.primitiveLength+=yi.length/3,Q.vertexLength+=D}}var Xi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Ln("FillExtrusionBucket",ll,{omit:["layers","features"]});var Jp={paint:new rs({"fill-extrusion-opacity":new Xn(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Un(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xn(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xn(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wf(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Un(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Un(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xn(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},qu=function(a){function s(c){a.call(this,c,Jp)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new ll(c)},s.prototype.queryRadius=function(){return Bo(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,D,U){var G=ku(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,D),Q=this.paint.get("fill-extrusion-height").evaluate(m,_),oe=this.paint.get("fill-extrusion-base").evaluate(m,_),ve=function(Ge,lt,Je,Ct){for(var Vt=[],rr=0,ir=Ge;rr<ir.length;rr+=1){var Ar=ir[rr],Sr=[Ar.x,Ar.y,0,1];qc(Sr,Sr,lt),Vt.push(new pe(Sr[0]/Sr[3],Sr[1]/Sr[3]))}return Vt}(G,U),Ve=function(Ge,lt,Je,Ct){for(var Vt=[],rr=[],ir=Ct[8]*lt,Ar=Ct[9]*lt,Sr=Ct[10]*lt,tn=Ct[11]*lt,Yn=Ct[8]*Je,An=Ct[9]*Je,ti=Ct[10]*Je,In=Ct[11]*Je,Bi=0,yi=Ge;Bi<yi.length;Bi+=1){for(var zn=[],Xi=[],Li=0,Ni=yi[Bi];Li<Ni.length;Li+=1){var qn=Ni[Li],aa=qn.x,fo=qn.y,ho=Ct[0]*aa+Ct[4]*fo+Ct[12],po=Ct[1]*aa+Ct[5]*fo+Ct[13],qa=Ct[2]*aa+Ct[6]*fo+Ct[14],So=Ct[3]*aa+Ct[7]*fo+Ct[15],fs=qa+Sr,hs=So+tn,Ws=ho+Yn,Es=po+An,Xs=qa+ti,Ro=So+In,Ss=new pe((ho+ir)/hs,(po+Ar)/hs);Ss.z=fs/hs,zn.push(Ss);var ea=new pe(Ws/Ro,Es/Ro);ea.z=Xs/Ro,Xi.push(ea)}Vt.push(zn),rr.push(Xi)}return[Vt,rr]}(S,oe,Q,U);return function(Ge,lt,Je){var Ct=1/0;yu(Je,lt)&&(Ct=Bf(Je,lt[0]));for(var Vt=0;Vt<lt.length;Vt++)for(var rr=lt[Vt],ir=Ge[Vt],Ar=0;Ar<rr.length-1;Ar++){var Sr=rr[Ar],tn=[Sr,rr[Ar+1],ir[Ar+1],ir[Ar],Sr];Vs(Je,tn)&&(Ct=Math.min(Ct,Bf(Je,tn)))}return Ct!==1/0&&Ct}(Ve[0],Ve[1],ve)},s}(nu);function Ml(a,s){return a.x*s.x+a.y*s.y}function Bf(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var S=s[m],A=a[0],P=c.sub(_),D=S.sub(_),U=A.sub(_),G=Ml(P,P),Q=Ml(P,D),oe=Ml(D,D),ve=Ml(U,P),Ve=Ml(U,D),Ge=G*oe-Q*Q,lt=(oe*ve-Q*Ve)/Ge,Je=(G*Ve-Q*ve)/Ge,Ct=_.z*(1-lt-Je)+c.z*lt+S.z*Je;if(isFinite(Ct))return Ct}return 1/0}for(var Vt=1/0,rr=0,ir=s;rr<ir.length;rr+=1)Vt=Math.min(Vt,ir[rr].z);return Vt}var rc=Pa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ed=Pa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,vp=xu.VectorTileFeature.types,zh=Math.cos(Math.PI/180*37.5),mp=Math.pow(2,14)/.5,ga=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Lo,this.layoutVertexArray2=new Tu,this.indexArray=new Sl,this.programConfigurations=new oi(a.layers,a.zoom),this.segments=new le,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};ga.prototype.populate=function(a,s,c){this.hasPattern=Of("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],S=0,A=a;S<A.length;S+=1){var P=A[S],D=P.feature,U=P.id,G=P.index,Q=P.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,ve=lo(D,oe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ve,c)){var Ve=m?m.evaluate(ve,{},c):void 0,Ge={id:U,properties:D.properties,type:D.type,sourceLayerIndex:Q,index:G,geometry:oe?ve.geometry:Ya(D),patterns:{},sortKey:Ve};_.push(Ge)}}m&&_.sort(function(Sr,tn){return Sr.sortKey-tn.sortKey});for(var lt=0,Je=_;lt<Je.length;lt+=1){var Ct=Je[lt],Vt=Ct.geometry,rr=Ct.index,ir=Ct.sourceLayerIndex;if(this.hasPattern){var Ar=Tl("line",this.layers,Ct,this.zoom,s);this.patternFeatures.push(Ar)}else this.addFeature(Ct,Vt,rr,c,{});s.featureIndex.insert(a[rr].feature,Vt,rr,ir,this.index)}},ga.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},ga.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},ga.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ga.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ga.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,ed)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,rc),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ga.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ga.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},ga.prototype.addFeature=function(a,s,c,m,_){var S=this.layers[0].layout,A=S.get("line-join").evaluate(a,{}),P=S.get("line-cap"),D=S.get("line-miter-limit"),U=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var G=0,Q=s;G<Q.length;G+=1)this.addLine(Q[G],a,A,P,D,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},ga.prototype.addLine=function(a,s,c,m,_,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<a.length-1;A++)this.totalDistance+=a[A].dist(a[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=vp[s.type]==="Polygon",D=a.length;D>=2&&a[D-1].equals(a[D-2]);)D--;for(var U=0;U<D-1&&a[U].equals(a[U+1]);)U++;if(!(D<(P?3:2))){c==="bevel"&&(_=1.05);var G,Q=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),ve=void 0,Ve=void 0,Ge=void 0,lt=void 0;this.e1=this.e2=-1,P&&(lt=a[U].sub(G=a[D-2])._unit()._perp());for(var Je=U;Je<D;Je++)if(!(Ve=Je===D-1?P?a[U+1]:void 0:a[Je+1])||!a[Je].equals(Ve)){lt&&(Ge=lt),G&&(ve=G),G=a[Je],lt=Ve?Ve.sub(G)._unit()._perp():Ge;var Ct=(Ge=Ge||lt).add(lt);Ct.x===0&&Ct.y===0||Ct._unit();var Vt=Ge.x*lt.x+Ge.y*lt.y,rr=Ct.x*lt.x+Ct.y*lt.y,ir=rr!==0?1/rr:1/0,Ar=2*Math.sqrt(2-2*rr),Sr=rr<zh&&ve&&Ve,tn=Ge.x*lt.y-Ge.y*lt.x>0;if(Sr&&Je>U){var Yn=G.dist(ve);if(Yn>2*Q){var An=G.sub(G.sub(ve)._mult(Q/Yn)._round());this.updateDistance(ve,An),this.addCurrentVertex(An,Ge,0,0,oe),ve=An}}var ti=ve&&Ve,In=ti?c:P?"butt":m;if(ti&&In==="round"&&(ir<S?In="miter":ir<=2&&(In="fakeround")),In==="miter"&&ir>_&&(In="bevel"),In==="bevel"&&(ir>2&&(In="flipbevel"),ir<_&&(In="miter")),ve&&this.updateDistance(ve,G),In==="miter")Ct._mult(ir),this.addCurrentVertex(G,Ct,0,0,oe);else if(In==="flipbevel"){if(ir>100)Ct=lt.mult(-1);else{var Bi=ir*Ge.add(lt).mag()/Ge.sub(lt).mag();Ct._perp()._mult(Bi*(tn?-1:1))}this.addCurrentVertex(G,Ct,0,0,oe),this.addCurrentVertex(G,Ct.mult(-1),0,0,oe)}else if(In==="bevel"||In==="fakeround"){var yi=-Math.sqrt(ir*ir-1),zn=tn?yi:0,Xi=tn?0:yi;if(ve&&this.addCurrentVertex(G,Ge,zn,Xi,oe),In==="fakeround")for(var Li=Math.round(180*Ar/Math.PI/20),Ni=1;Ni<Li;Ni++){var qn=Ni/Li;if(qn!==.5){var aa=qn-.5;qn+=qn*aa*(qn-1)*((1.0904+Vt*(Vt*(3.55645-1.43519*Vt)-3.2452))*aa*aa+(.848013+Vt*(.215638*Vt-1.06021)))}var fo=lt.sub(Ge)._mult(qn)._add(Ge)._unit()._mult(tn?-1:1);this.addHalfVertex(G,fo.x,fo.y,!1,tn,0,oe)}Ve&&this.addCurrentVertex(G,lt,-zn,-Xi,oe)}else if(In==="butt")this.addCurrentVertex(G,Ct,0,0,oe);else if(In==="square"){var ho=ve?1:-1;this.addCurrentVertex(G,Ct,ho,ho,oe)}else In==="round"&&(ve&&(this.addCurrentVertex(G,Ge,0,0,oe),this.addCurrentVertex(G,Ge,1,1,oe,!0)),Ve&&(this.addCurrentVertex(G,lt,-1,-1,oe,!0),this.addCurrentVertex(G,lt,0,0,oe)));if(Sr&&Je<D-1){var po=G.dist(Ve);if(po>2*Q){var qa=G.add(Ve.sub(G)._mult(Q/po)._round());this.updateDistance(G,qa),this.addCurrentVertex(qa,lt,0,0,oe),G=qa}}}}},ga.prototype.addCurrentVertex=function(a,s,c,m,_,S){S===void 0&&(S=!1);var A=s.y*m-s.x,P=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,S,!1,c,_),this.addHalfVertex(a,A,P,S,!0,-m,_),this.distance>mp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,S))},ga.prototype.addHalfVertex=function(a,s,c,m,_,S,A){var P=.5*(this.lineClips?this.scaledDistance*(mp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(S===0?0:S<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),A.primitiveLength++),_?this.e2=D:this.e1=D},ga.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ga.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Ln("LineBucket",ga,{omit:["layers","patternFeatures"]});var nc=new rs({"line-cap":new Xn(_e.layout_line["line-cap"]),"line-join":new Un(_e.layout_line["line-join"]),"line-miter-limit":new Xn(_e.layout_line["line-miter-limit"]),"line-round-limit":new Xn(_e.layout_line["line-round-limit"]),"line-sort-key":new Un(_e.layout_line["line-sort-key"])}),ko={paint:new rs({"line-opacity":new Un(_e.paint_line["line-opacity"]),"line-color":new Un(_e.paint_line["line-color"]),"line-translate":new Xn(_e.paint_line["line-translate"]),"line-translate-anchor":new Xn(_e.paint_line["line-translate-anchor"]),"line-width":new Un(_e.paint_line["line-width"]),"line-gap-width":new Un(_e.paint_line["line-gap-width"]),"line-offset":new Un(_e.paint_line["line-offset"]),"line-blur":new Un(_e.paint_line["line-blur"]),"line-dasharray":new os(_e.paint_line["line-dasharray"]),"line-pattern":new wf(_e.paint_line["line-pattern"]),"line-gradient":new mu(_e.paint_line["line-gradient"])}),layout:nc},uu=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new Oi(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,S){return m=Nt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,S)},s}(Un))(ko.paint.properties["line-width"].specification);uu.useIntegerZoom=!0;var td=function(a){function s(c){a.call(this,c,ko),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ds,this.gradientVersion=(this.gradientVersion+1)%ot)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=uu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new ga(c)},s.prototype.queryRadius=function(c){var m=c,_=zd($u("line-width",this,m),$u("line-gap-width",this,m)),S=$u("line-offset",this,m);return _/2+Math.abs(S)+Bo(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,A,P,D){var U=ku(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,D),G=D/2*zd(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),Q=this.paint.get("line-offset").evaluate(m,_);return Q&&(S=function(oe,ve){for(var Ve=[],Ge=new pe(0,0),lt=0;lt<oe.length;lt++){for(var Je=oe[lt],Ct=[],Vt=0;Vt<Je.length;Vt++){var rr=Je[Vt],ir=Je[Vt+1],Ar=Vt===0?Ge:rr.sub(Je[Vt-1])._unit()._perp(),Sr=Vt===Je.length-1?Ge:ir.sub(rr)._unit()._perp(),tn=Ar._add(Sr)._unit();tn._mult(1/(tn.x*Sr.x+tn.y*Sr.y)),Ct.push(tn._mult(ve)._add(rr))}Ve.push(Ct)}return Ve}(S,Q*D)),function(oe,ve,Ve){for(var Ge=0;Ge<ve.length;Ge++){var lt=ve[Ge];if(oe.length>=3){for(var Je=0;Je<lt.length;Je++)if(Mu(oe,lt[Je]))return!0}if(iu(oe,lt,Ve))return!0}return!1}(U,S,G)},s.prototype.isTileClipped=function(){return!0},s}(nu);function zd(a,s){return s>0?s+2*a:a}var Zd=Pa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uh=Pa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ud=(Pa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Pa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),gp=(Pa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),lu=Pa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yp(a,s,c){return a.sections.forEach(function(m){m.text=function(_,S,A){var P=S.layout.get("text-transform").evaluate(A,{});return P==="uppercase"?_=_.toLocaleUpperCase():P==="lowercase"&&(_=_.toLocaleLowerCase()),Zs.applyArabicShaping&&(_=Zs.applyArabicShaping(_)),_}(m.text,s,c)}),a}Pa([{name:"triangle",components:3,type:"Uint16"}]),Pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pa([{type:"Float32",name:"offsetX"}]),Pa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var lh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},rd=function(a,s,c,m,_){var S,A,P=8*_-m-1,D=(1<<P)-1,U=D>>1,G=-7,Q=c?_-1:0,oe=c?-1:1,ve=a[s+Q];for(Q+=oe,S=ve&(1<<-G)-1,ve>>=-G,G+=P;G>0;S=256*S+a[s+Q],Q+=oe,G-=8);for(A=S&(1<<-G)-1,S>>=-G,G+=m;G>0;A=256*A+a[s+Q],Q+=oe,G-=8);if(S===0)S=1-U;else{if(S===D)return A?NaN:1/0*(ve?-1:1);A+=Math.pow(2,m),S-=U}return(ve?-1:1)*A*Math.pow(2,S-m)},nd=function(a,s,c,m,_,S){var A,P,D,U=8*S-_-1,G=(1<<U)-1,Q=G>>1,oe=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,ve=m?0:S-1,Ve=m?1:-1,Ge=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,A=G):(A=Math.floor(Math.log(s)/Math.LN2),s*(D=Math.pow(2,-A))<1&&(A--,D*=2),(s+=A+Q>=1?oe/D:oe*Math.pow(2,1-Q))*D>=2&&(A++,D/=2),A+Q>=G?(P=0,A=G):A+Q>=1?(P=(s*D-1)*Math.pow(2,_),A+=Q):(P=s*Math.pow(2,Q-1)*Math.pow(2,_),A=0));_>=8;a[c+ve]=255&P,ve+=Ve,P/=256,_-=8);for(A=A<<_|P,U+=_;U>0;a[c+ve]=255&A,ve+=Ve,A/=256,U-=8);a[c+ve-Ve]|=128*Ge},ch=Za;function Za(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Za.Varint=0,Za.Fixed64=1,Za.Bytes=2,Za.Fixed32=5;var kl=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ic(a){return a.type===Za.Bytes?a.readVarint()+a.pos:a.pos+1}function rf(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function _p(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function Vd(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function Z(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function Ae(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function $e(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function $t(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function Cr(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Yt(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function vr(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function Pr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Fr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Nr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function Wr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function Xr(a,s,c){a===1&&c.readMessage(ln,s)}function ln(a,s,c){if(a===3){var m=c.readMessage(zr,{}),_=m.width,S=m.height,A=m.left,P=m.top,D=m.advance;s.push({id:m.id,bitmap:new _u({width:_+6,height:S+6},m.bitmap),metrics:{width:_,height:S,left:A,top:P,advance:D}})}}function zr(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Gr(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var S=_[m];s+=S.w*S.h,c=Math.max(c,S.w)}a.sort(function(Ge,lt){return lt.h-Ge.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],P=0,D=0,U=0,G=a;U<G.length;U+=1)for(var Q=G[U],oe=A.length-1;oe>=0;oe--){var ve=A[oe];if(!(Q.w>ve.w||Q.h>ve.h)){if(Q.x=ve.x,Q.y=ve.y,D=Math.max(D,Q.y+Q.h),P=Math.max(P,Q.x+Q.w),Q.w===ve.w&&Q.h===ve.h){var Ve=A.pop();oe<A.length&&(A[oe]=Ve)}else Q.h===ve.h?(ve.x+=Q.w,ve.w-=Q.w):Q.w===ve.w?(ve.y+=Q.h,ve.h-=Q.h):(A.push({x:ve.x+Q.w,y:ve.y,w:ve.w-Q.w,h:Q.h}),ve.y+=Q.h,ve.h-=Q.h);break}}return{w:P,h:D,fill:s/(P*D)||0}}Za.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,S=this.pos;this.type=7&m,a(_,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Fr(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Wr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Fr(this.buf,this.pos)+4294967296*Fr(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Fr(this.buf,this.pos)+4294967296*Wr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=rd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=rd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,S,A){var P,D,U=A.buf;if(P=(112&(D=U[A.pos++]))>>4,D<128||(P|=(127&(D=U[A.pos++]))<<3,D<128)||(P|=(127&(D=U[A.pos++]))<<10,D<128)||(P|=(127&(D=U[A.pos++]))<<17,D<128)||(P|=(127&(D=U[A.pos++]))<<24,D<128)||(P|=(1&(D=U[A.pos++]))<<31,D<128))return rf(_,P,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&kl?function(c,m,_){return kl.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var S="",A=m;A<_;){var P,D,U,G=c[A],Q=null,oe=G>239?4:G>223?3:G>191?2:1;if(A+oe>_)break;oe===1?G<128&&(Q=G):oe===2?(192&(P=c[A+1]))==128&&(Q=(31&G)<<6|63&P)<=127&&(Q=null):oe===3?(D=c[A+2],(192&(P=c[A+1]))==128&&(192&D)==128&&((Q=(15&G)<<12|(63&P)<<6|63&D)<=2047||Q>=55296&&Q<=57343)&&(Q=null)):oe===4&&(D=c[A+2],U=c[A+3],(192&(P=c[A+1]))==128&&(192&D)==128&&(192&U)==128&&((Q=(15&G)<<18|(63&P)<<12|(63&D)<<6|63&U)<=65535||Q>=1114112)&&(Q=null)),Q===null?(Q=65533,oe=1):Q>65535&&(Q-=65536,S+=String.fromCharCode(Q>>>10&1023|55296),Q=56320|1023&Q),S+=String.fromCharCode(Q),A+=oe}return S}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Za.Bytes)return a.push(this.readVarint(s));var c=ic(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Za.Bytes)return a.push(this.readSVarint());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Za.Bytes)return a.push(this.readBoolean());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Za.Bytes)return a.push(this.readFloat());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Za.Bytes)return a.push(this.readDouble());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed32());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed32());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed64());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed64());var s=ic(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Za.Varint)for(;this.buf[this.pos++]>127;);else if(s===Za.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Za.Fixed32)this.pos+=4;else{if(s!==Za.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Nr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Nr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Nr(this.buf,-1&a,this.pos),Nr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Nr(this.buf,-1&a,this.pos),Nr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(S,A,P){P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,P.buf[P.pos]=127&(S>>>=7)}(m,0,c),function(S,A){var P=(7&S)<<4;A.buf[A.pos++]|=P|((S>>>=3)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S|((S>>>=7)?128:0),S&&(A.buf[A.pos++]=127&S)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,S){for(var A,P,D=0;D<_.length;D++){if((A=_.charCodeAt(D))>55295&&A<57344){if(!P){A>56319||D+1===_.length?(m[S++]=239,m[S++]=191,m[S++]=189):P=A;continue}if(A<56320){m[S++]=239,m[S++]=191,m[S++]=189,P=A;continue}A=P-55296<<10|A-56320|65536,P=null}else P&&(m[S++]=239,m[S++]=191,m[S++]=189,P=null);A<128?m[S++]=A:(A<2048?m[S++]=A>>6|192:(A<65536?m[S++]=A>>12|224:(m[S++]=A>>18|240,m[S++]=A>>12&63|128),m[S++]=A>>6&63|128),m[S++]=63&A|128)}return S}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&_p(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),nd(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),nd(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&_p(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,Za.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,Vd,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,Z,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,$t,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Ae,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,$e,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,Cr,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Yt,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,vr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Pr,s)},writeBytesField:function(a,s){this.writeTag(a,Za.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Za.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Za.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var At=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,S=s.stretchY,A=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=S,this.content=A,this.version=m},ar={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};ar.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},ar.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},ar.tlbr.get=function(){return this.tl.concat(this.br)},ar.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(At.prototype,ar);var Zr=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var S=Gr(_),A=new No({width:S.w||1,height:S.h||1});for(var P in a){var D=a[P],U=c[P].paddedRect;No.copy(D.data,A,{x:0,y:0},{x:U.x+1,y:U.y+1},D.data)}for(var G in s){var Q=s[G],oe=m[G].paddedRect,ve=oe.x+1,Ve=oe.y+1,Ge=Q.data.width,lt=Q.data.height;No.copy(Q.data,A,{x:0,y:0},{x:ve,y:Ve},Q.data),No.copy(Q.data,A,{x:0,y:lt-1},{x:ve,y:Ve-1},{width:Ge,height:1}),No.copy(Q.data,A,{x:0,y:0},{x:ve,y:Ve+lt},{width:Ge,height:1}),No.copy(Q.data,A,{x:Ge-1,y:0},{x:ve-1,y:Ve},{width:1,height:lt}),No.copy(Q.data,A,{x:0,y:0},{x:ve+Ge,y:Ve},{width:1,height:lt})}this.image=A,this.iconPositions=c,this.patternPositions=m};Zr.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],S={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(S),s[m]=new At(S,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Zr.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},Zr.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},Ln("ImagePosition",At),Ln("ImageAtlas",Zr);var on={horizontal:1,vertical:2,horizontalOnly:3},Mr=function(){this.scale=1,this.fontStack="",this.imageName=null};Mr.forText=function(a,s){var c=new Mr;return c.scale=a||1,c.fontStack=s,c},Mr.forImage=function(a){var s=new Mr;return s.imageName=a,s};var $r=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function vn(a,s,c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge){var lt,Je=$r.fromFeature(a,_);Q===on.vertical&&Je.verticalizePunctuation();var Ct=Zs.processBidirectionalText,Vt=Zs.processStyledBidirectionalText;if(Ct&&Je.sections.length===1){lt=[];for(var rr=0,ir=Ct(Je.toString(),pn(Je,U,S,s,m,ve,Ve));rr<ir.length;rr+=1){var Ar=ir[rr],Sr=new $r;Sr.text=Ar,Sr.sections=Je.sections;for(var tn=0;tn<Ar.length;tn++)Sr.sectionIndex.push(0);lt.push(Sr)}}else if(Vt){lt=[];for(var Yn=0,An=Vt(Je.text,Je.sectionIndex,pn(Je,U,S,s,m,ve,Ve));Yn<An.length;Yn+=1){var ti=An[Yn],In=new $r;In.text=ti[0],In.sectionIndex=ti[1],In.sections=Je.sections,lt.push(In)}}else lt=function(zn,Xi){for(var Li=[],Ni=zn.text,qn=0,aa=0,fo=Xi;aa<fo.length;aa+=1){var ho=fo[aa];Li.push(zn.substring(qn,ho)),qn=ho}return qn<Ni.length&&Li.push(zn.substring(qn,Ni.length)),Li}(Je,pn(Je,U,S,s,m,ve,Ve));var Bi=[],yi={positionedLines:Bi,text:Je.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:Q,iconsInText:!1,verticalizable:!1};return function(zn,Xi,Li,Ni,qn,aa,fo,ho,po,qa,So,fs){for(var hs=0,Ws=-17,Es=0,Xs=0,Ro=ho==="right"?1:ho==="left"?0:.5,Ss=0,ea=0,Ua=qn;ea<Ua.length;ea+=1){var Fa=Ua[ea];Fa.trim();var da=Fa.getMaxScale(),cu=24*(da-1),Ds={positionedGlyphs:[],lineOffset:0};zn.positionedLines[Ss]=Ds;var no=Ds.positionedGlyphs,Zo=0;if(Fa.length()){for(var Is=0;Is<Fa.length();Is++){var Sa=Fa.getSection(Is),Tc=Fa.getSectionIndex(Is),Fu=Fa.getCharCode(Is),Mc=0,Uo=null,kc=null,Rl=null,Zh=24,hh=!(po===on.horizontal||!So&&!bl(Fu)||So&&(Kn[Fu]||(Pc=Fu,hn.Arabic(Pc)||hn["Arabic Supplement"](Pc)||hn["Arabic Extended-A"](Pc)||hn["Arabic Presentation Forms-A"](Pc)||hn["Arabic Presentation Forms-B"](Pc))));if(Sa.imageName){var Uh=Ni[Sa.imageName];if(!Uh)continue;Rl=Sa.imageName,zn.iconsInText=zn.iconsInText||!0,kc=Uh.paddedRect;var Ic=Uh.displaySize;Sa.scale=24*Sa.scale/fs,Mc=cu+(24-Ic[1]*Sa.scale),Zh=(Uo={width:Ic[0],height:Ic[1],left:1,top:-3,advance:hh?Ic[1]:Ic[0]}).advance;var Vh=hh?Ic[0]*Sa.scale-24*da:Ic[1]*Sa.scale-24*da;Vh>0&&Vh>Zo&&(Zo=Vh)}else{var od=Li[Sa.fontStack],jh=od&&od[Fu];if(jh&&jh.rect)kc=jh.rect,Uo=jh.metrics;else{var ph=Xi[Sa.fontStack],sd=ph&&ph[Fu];if(!sd)continue;Uo=sd.metrics}Mc=24*(da-Sa.scale)}hh?(zn.verticalizable=!0,no.push({glyph:Fu,imageName:Rl,x:hs,y:Ws+Mc,vertical:hh,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:Tc,metrics:Uo,rect:kc}),hs+=Zh*Sa.scale+qa):(no.push({glyph:Fu,imageName:Rl,x:hs,y:Ws+Mc,vertical:hh,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:Tc,metrics:Uo,rect:kc}),hs+=Uo.advance*Sa.scale+qa)}no.length!==0&&(Es=Math.max(hs-qa,Es),ki(no,0,no.length-1,Ro,Zo)),hs=0;var ud=aa*da+Zo;Ds.lineOffset=Math.max(Zo,cu),Ws+=ud,Xs=Math.max(ud,Xs),++Ss}else Ws+=aa,++Ss}var Pc,Gh=Ws- -17,Hh=un(fo),bu=Hh.horizontalAlign,dh=Hh.verticalAlign;(function(bp,ld,Ep,Wh,cd,Sp,Xh,$h,fd){var vh,wp=(ld-Ep)*cd;vh=Sp!==Xh?-$h*Wh- -17:(-Wh*fd+.5)*Xh;for(var Yh=0,Cp=bp;Yh<Cp.length;Yh+=1)for(var mh=0,qh=Cp[Yh].positionedGlyphs;mh<qh.length;mh+=1){var gh=qh[mh];gh.x+=wp,gh.y+=vh}})(zn.positionedLines,Ro,bu,dh,Es,Xs,aa,Gh,qn.length),zn.top+=-dh*Gh,zn.bottom=zn.top+Gh,zn.left+=-bu*Es,zn.right=zn.left+Es}(yi,s,c,m,lt,A,P,D,Q,U,oe,Ge),!function(zn){for(var Xi=0,Li=zn;Xi<Li.length;Xi+=1)if(Li[Xi].positionedGlyphs.length!==0)return!1;return!0}(Bi)&&yi}$r.fromFeature=function(a,s){for(var c=new $r,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},$r.prototype.length=function(){return this.text.length},$r.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},$r.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},$r.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},$r.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&tl(m)&&!lh[a[c+1]]||_&&tl(_)&&!lh[a[c-1]]||!lh[a[c]]?a[c]:lh[a[c]]}return s}(this.text)},$r.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&Kn[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&Kn[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},$r.prototype.substring=function(a,s){var c=new $r;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},$r.prototype.toString=function(){return this.text},$r.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},$r.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Mr.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},$r.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Mr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):dt("Reached maximum number of images 6401")}else dt("Can't add FormattedSection with an empty image.")},$r.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Kn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mr={};function Er(a,s,c,m,_,S){if(s.imageName){var A=m[s.imageName];return A?A.displaySize[0]*s.scale*24/S+_:0}var P=c[s.fontStack],D=P&&P[a];return D?D.metrics.advance*s.scale+_:0}function Dn(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function cn(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Ur(a,s,c,m,_,S){for(var A=null,P=Dn(s,c,_,S),D=0,U=m;D<U.length;D+=1){var G=U[D],Q=Dn(s-G.x,c,_,S)+G.badness;Q<=P&&(A=G,P=Q)}return{index:a,x:s,priorBreak:A,badness:P}}function pn(a,s,c,m,_,S,A){if(S!=="point")return[];if(!a)return[];for(var P,D=[],U=function(lt,Je,Ct,Vt,rr,ir){for(var Ar=0,Sr=0;Sr<lt.length();Sr++){var tn=lt.getSection(Sr);Ar+=Er(lt.getCharCode(Sr),tn,Vt,rr,Je,ir)}return Ar/Math.max(1,Math.ceil(Ar/Ct))}(a,s,c,m,_,A),G=a.text.indexOf("\u200B")>=0,Q=0,oe=0;oe<a.length();oe++){var ve=a.getSection(oe),Ve=a.getCharCode(oe);if(Kn[Ve]||(Q+=Er(Ve,ve,m,_,s,A)),oe<a.length()-1){var Ge=!((P=Ve)<11904||!(hn["Bopomofo Extended"](P)||hn.Bopomofo(P)||hn["CJK Compatibility Forms"](P)||hn["CJK Compatibility Ideographs"](P)||hn["CJK Compatibility"](P)||hn["CJK Radicals Supplement"](P)||hn["CJK Strokes"](P)||hn["CJK Symbols and Punctuation"](P)||hn["CJK Unified Ideographs Extension A"](P)||hn["CJK Unified Ideographs"](P)||hn["Enclosed CJK Letters and Months"](P)||hn["Halfwidth and Fullwidth Forms"](P)||hn.Hiragana(P)||hn["Ideographic Description Characters"](P)||hn["Kangxi Radicals"](P)||hn["Katakana Phonetic Extensions"](P)||hn.Katakana(P)||hn["Vertical Forms"](P)||hn["Yi Radicals"](P)||hn["Yi Syllables"](P)));(mr[Ve]||Ge||ve.imageName)&&D.push(Ur(oe+1,Q,U,D,cn(Ve,a.getCharCode(oe+1),Ge&&G),!1))}}return function lt(Je){return Je?lt(Je.priorBreak).concat(Je.index):[]}(Ur(a.length(),Q,U,D,0,!0))}function un(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function ki(a,s,c,m,_){if(m||_)for(var S=a[c],A=(a[c].x+S.metrics.advance*S.scale)*m,P=s;P<=c;P++)a[P].x-=A,a[P].y+=_}function di(a,s,c,m,_,S){var A,P=a.image;if(P.content){var D=P.content,U=P.pixelRatio||1;A=[D[0]/U,D[1]/U,P.displaySize[0]-D[2]/U,P.displaySize[1]-D[3]/U]}var G,Q,oe,ve,Ve=s.left*S,Ge=s.right*S;c==="width"||c==="both"?(ve=_[0]+Ve-m[3],Q=_[0]+Ge+m[1]):Q=(ve=_[0]+(Ve+Ge-P.displaySize[0])/2)+P.displaySize[0];var lt=s.top*S,Je=s.bottom*S;return c==="height"||c==="both"?(G=_[1]+lt-m[0],oe=_[1]+Je+m[2]):oe=(G=_[1]+(lt+Je-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:G,right:Q,bottom:oe,left:ve,collisionPadding:A}}mr[10]=!0,mr[32]=!0,mr[38]=!0,mr[40]=!0,mr[41]=!0,mr[43]=!0,mr[45]=!0,mr[47]=!0,mr[173]=!0,mr[183]=!0,mr[8203]=!0,mr[8208]=!0,mr[8211]=!0,mr[8231]=!0;var fn=function(a){function s(c,m,_,S){a.call(this,c,m),this.angle=_,S!==void 0&&(this.segment=S)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(pe);function mn(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Oi(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,S=0;S<m.length&&m[S]<=a;)S++;for(var A=S=Math.max(0,S-1);A<m.length&&m[A]<a+1;)A++;A=Math.min(m.length-1,A);var P=m[S],D=m[A];return c.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:D,interpolationType:_}:{kind:"camera",minZoom:P,maxZoom:D,minSize:c.evaluate(new Oi(P)),maxSize:c.evaluate(new Oi(D)),interpolationType:_}}function li(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?Zi(_/128,c.upperSize/128,s.uSizeT):m}function bi(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,S=_?Dt(Me.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=Zi(a.minSize,a.maxSize,S):c=S}return{uSizeT:c,uSize:m}}Ln("Anchor",fn);var Ui=Object.freeze({__proto__:null,getSizeData:mn,evaluateSizeForFeature:li,evaluateSizeForZoom:bi,SIZE_PACK_FACTOR:128});function ro(a,s,c,m,_){if(s.segment===void 0)return!0;for(var S=s,A=s.segment+1,P=0;P>-c/2;){if(--A<0)return!1;P-=a[A].dist(S),S=a[A]}P+=a[A].dist(a[A+1]),A++;for(var D=[],U=0;P<c/2;){var G=a[A],Q=a[A+1];if(!Q)return!1;var oe=a[A-1].angleTo(G)-G.angleTo(Q);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:P,angleDelta:oe}),U+=oe;P-D[0].distance>m;)U-=D.shift().angleDelta;if(U>_)return!1;A++,P+=G.dist(Q)}return!0}function co(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function Ti(a,s,c){return a?.6*s*c:0}function ls(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function Ha(a,s,c,m,_,S){for(var A=Ti(c,_,S),P=ls(c,m)*S,D=0,U=co(a)/2,G=0;G<a.length-1;G++){var Q=a[G],oe=a[G+1],ve=Q.dist(oe);if(D+ve>U){var Ve=(U-D)/ve,Ge=Zi(Q.x,oe.x,Ve),lt=Zi(Q.y,oe.y,Ve),Je=new fn(Ge,lt,oe.angleTo(Q),G);return Je._round(),!A||ro(a,Je,P,A,s)?Je:void 0}D+=ve}}function Wo(a,s,c,m,_,S,A,P,D){var U=Ti(m,S,A),G=ls(m,_),Q=G*A,oe=a[0].x===0||a[0].x===D||a[0].y===0||a[0].y===D;return s-Q<s/4&&(s=Q+s/4),function ve(Ve,Ge,lt,Je,Ct,Vt,rr,ir,Ar){for(var Sr=Vt/2,tn=co(Ve),Yn=0,An=Ge-lt,ti=[],In=0;In<Ve.length-1;In++){for(var Bi=Ve[In],yi=Ve[In+1],zn=Bi.dist(yi),Xi=yi.angleTo(Bi);An+lt<Yn+zn;){var Li=((An+=lt)-Yn)/zn,Ni=Zi(Bi.x,yi.x,Li),qn=Zi(Bi.y,yi.y,Li);if(Ni>=0&&Ni<Ar&&qn>=0&&qn<Ar&&An-Sr>=0&&An+Sr<=tn){var aa=new fn(Ni,qn,Xi,In);aa._round(),Je&&!ro(Ve,aa,Vt,Je,Ct)||ti.push(aa)}}Yn+=zn}return ir||ti.length||rr||(ti=ve(Ve,Yn/2,lt,Je,Ct,Vt,rr,!0,Ar)),ti}(a,oe?s/2*P%s:(G/2+2*S)*A*P%s,s,U,c,Q,oe,!1,D)}function yo(a,s,c,m,_){for(var S=[],A=0;A<a.length;A++)for(var P=a[A],D=void 0,U=0;U<P.length-1;U++){var G=P[U],Q=P[U+1];G.x<s&&Q.x<s||(G.x<s?G=new pe(s,G.y+(s-G.x)/(Q.x-G.x)*(Q.y-G.y))._round():Q.x<s&&(Q=new pe(s,G.y+(s-G.x)/(Q.x-G.x)*(Q.y-G.y))._round()),G.y<c&&Q.y<c||(G.y<c?G=new pe(G.x+(c-G.y)/(Q.y-G.y)*(Q.x-G.x),c)._round():Q.y<c&&(Q=new pe(G.x+(c-G.y)/(Q.y-G.y)*(Q.x-G.x),c)._round()),G.x>=m&&Q.x>=m||(G.x>=m?G=new pe(m,G.y+(m-G.x)/(Q.x-G.x)*(Q.y-G.y))._round():Q.x>=m&&(Q=new pe(m,G.y+(m-G.x)/(Q.x-G.x)*(Q.y-G.y))._round()),G.y>=_&&Q.y>=_||(G.y>=_?G=new pe(G.x+(_-G.y)/(Q.y-G.y)*(Q.x-G.x),_)._round():Q.y>=_&&(Q=new pe(G.x+(_-G.y)/(Q.y-G.y)*(Q.x-G.x),_)._round()),D&&G.equals(D[D.length-1])||S.push(D=[G]),D.push(Q)))))}return S}function zo(a,s,c,m){var _=[],S=a.image,A=S.pixelRatio,P=S.paddedRect.w-2,D=S.paddedRect.h-2,U=a.right-a.left,G=a.bottom-a.top,Q=S.stretchX||[[0,P]],oe=S.stretchY||[[0,D]],ve=function(Ni,qn){return Ni+qn[1]-qn[0]},Ve=Q.reduce(ve,0),Ge=oe.reduce(ve,0),lt=P-Ve,Je=D-Ge,Ct=0,Vt=Ve,rr=0,ir=Ge,Ar=0,Sr=lt,tn=0,Yn=Je;if(S.content&&m){var An=S.content;Ct=Xo(Q,0,An[0]),rr=Xo(oe,0,An[1]),Vt=Xo(Q,An[0],An[2]),ir=Xo(oe,An[1],An[3]),Ar=An[0]-Ct,tn=An[1]-rr,Sr=An[2]-An[0]-Vt,Yn=An[3]-An[1]-ir}var ti=function(Ni,qn,aa,fo){var ho=_o(Ni.stretch-Ct,Vt,U,a.left),po=Mi(Ni.fixed-Ar,Sr,Ni.stretch,Ve),qa=_o(qn.stretch-rr,ir,G,a.top),So=Mi(qn.fixed-tn,Yn,qn.stretch,Ge),fs=_o(aa.stretch-Ct,Vt,U,a.left),hs=Mi(aa.fixed-Ar,Sr,aa.stretch,Ve),Ws=_o(fo.stretch-rr,ir,G,a.top),Es=Mi(fo.fixed-tn,Yn,fo.stretch,Ge),Xs=new pe(ho,qa),Ro=new pe(fs,qa),Ss=new pe(fs,Ws),ea=new pe(ho,Ws),Ua=new pe(po/A,So/A),Fa=new pe(hs/A,Es/A),da=s*Math.PI/180;if(da){var cu=Math.sin(da),Ds=Math.cos(da),no=[Ds,-cu,cu,Ds];Xs._matMult(no),Ro._matMult(no),ea._matMult(no),Ss._matMult(no)}var Zo=Ni.stretch+Ni.fixed,Is=qn.stretch+qn.fixed;return{tl:Xs,tr:Ro,bl:ea,br:Ss,tex:{x:S.paddedRect.x+1+Zo,y:S.paddedRect.y+1+Is,w:aa.stretch+aa.fixed-Zo,h:fo.stretch+fo.fixed-Is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ua,pixelOffsetBR:Fa,minFontScaleX:Sr/A/U,minFontScaleY:Yn/A/G,isSDF:c}};if(m&&(S.stretchX||S.stretchY))for(var In=xs(Q,lt,Ve),Bi=xs(oe,Je,Ge),yi=0;yi<In.length-1;yi++)for(var zn=In[yi],Xi=In[yi+1],Li=0;Li<Bi.length-1;Li++)_.push(ti(zn,Bi[Li],Xi,Bi[Li+1]));else _.push(ti({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:D+1}));return _}function Xo(a,s,c){for(var m=0,_=0,S=a;_<S.length;_+=1){var A=S[_];m+=Math.max(s,Math.min(c,A[1]))-Math.max(s,Math.min(c,A[0]))}return m}function xs(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,S=a;_<S.length;_+=1){var A=S[_],P=A[0],D=A[1],U=m[m.length-1];m.push({fixed:P-U.stretch,stretch:U.stretch}),m.push({fixed:P-U.stretch,stretch:U.stretch+(D-P)})}return m.push({fixed:s+1,stretch:c}),m}function _o(a,s,c,m){return a/s*c+m}function Mi(a,s,c,m){return a-s*c/m}var Io=function(a,s,c,m,_,S,A,P,D,U){if(this.boxStartIndex=a.length,D){var G=S.top,Q=S.bottom,oe=S.collisionPadding;oe&&(G-=oe[1],Q+=oe[3]);var ve=Q-G;ve>0&&(ve=Math.max(10,ve),this.circleDiameter=ve)}else{var Ve=S.top*A-P,Ge=S.bottom*A+P,lt=S.left*A-P,Je=S.right*A+P,Ct=S.collisionPadding;if(Ct&&(lt-=Ct[0]*A,Ve-=Ct[1]*A,Je+=Ct[2]*A,Ge+=Ct[3]*A),U){var Vt=new pe(lt,Ve),rr=new pe(Je,Ve),ir=new pe(lt,Ge),Ar=new pe(Je,Ge),Sr=U*Math.PI/180;Vt._rotate(Sr),rr._rotate(Sr),ir._rotate(Sr),Ar._rotate(Sr),lt=Math.min(Vt.x,rr.x,ir.x,Ar.x),Je=Math.max(Vt.x,rr.x,ir.x,Ar.x),Ve=Math.min(Vt.y,rr.y,ir.y,Ar.y),Ge=Math.max(Vt.y,rr.y,ir.y,Ar.y)}a.emplaceBack(s.x,s.y,lt,Ve,Je,Ge,c,m,_)}this.boxEndIndex=a.length},ia=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=ns),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function ns(a,s){return a<s?-1:a>s?1:0}function gi(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,S=-1/0,A=-1/0,P=a[0],D=0;D<P.length;D++){var U=P[D];(!D||U.x<m)&&(m=U.x),(!D||U.y<_)&&(_=U.y),(!D||U.x>S)&&(S=U.x),(!D||U.y>A)&&(A=U.y)}var G=Math.min(S-m,A-_),Q=G/2,oe=new ia([],Gi);if(G===0)return new pe(m,_);for(var ve=m;ve<S;ve+=G)for(var Ve=_;Ve<A;Ve+=G)oe.push(new pa(ve+Q,Ve+Q,Q,a));for(var Ge=function(Ct){for(var Vt=0,rr=0,ir=0,Ar=Ct[0],Sr=0,tn=Ar.length,Yn=tn-1;Sr<tn;Yn=Sr++){var An=Ar[Sr],ti=Ar[Yn],In=An.x*ti.y-ti.x*An.y;rr+=(An.x+ti.x)*In,ir+=(An.y+ti.y)*In,Vt+=3*In}return new pa(rr/Vt,ir/Vt,0,Ct)}(a),lt=oe.length;oe.length;){var Je=oe.pop();(Je.d>Ge.d||!Ge.d)&&(Ge=Je,c&&console.log("found best %d after %d probes",Math.round(1e4*Je.d)/1e4,lt)),Je.max-Ge.d<=s||(oe.push(new pa(Je.p.x-(Q=Je.h/2),Je.p.y-Q,Q,a)),oe.push(new pa(Je.p.x+Q,Je.p.y-Q,Q,a)),oe.push(new pa(Je.p.x-Q,Je.p.y+Q,Q,a)),oe.push(new pa(Je.p.x+Q,Je.p.y+Q,Q,a)),lt+=4)}return c&&(console.log("num probes: "+lt),console.log("best distance: "+Ge.d)),Ge.p}function Gi(a,s){return s.max-a.max}function pa(a,s,c,m){this.p=new pe(a,s),this.h=c,this.d=function(_,S){for(var A=!1,P=1/0,D=0;D<S.length;D++)for(var U=S[D],G=0,Q=U.length,oe=Q-1;G<Q;oe=G++){var ve=U[G],Ve=U[oe];ve.y>_.y!=Ve.y>_.y&&_.x<(Ve.x-ve.x)*(_.y-ve.y)/(Ve.y-ve.y)+ve.x&&(A=!A),P=Math.min(P,Fs(_,ve,Ve))}return(A?1:-1)*Math.sqrt(P)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}ia.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},ia.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},ia.prototype.peek=function(){return this.data[0]},ia.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,S=s[_];if(c(m,S)>=0)break;s[a]=S,a=_}s[a]=m},ia.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var S=1+(a<<1),A=s[S],P=S+1;if(P<this.length&&c(s[P],A)<0&&(S=P,A=s[P]),c(A,_)>=0)break;s[a]=A,a=S}s[a]=_};var Po=Number.POSITIVE_INFINITY;function Il(a,s){return s[1]!==Po?function(c,m,_){var S=0,A=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":A=_-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-_}switch(c){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,A]}(a,s[0],s[1]):function(c,m){var _=0,S=0;m<0&&(m=0);var A=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":S=A-7;break;case"bottom-right":case"bottom-left":S=7-A;break;case"bottom":S=7-m;break;case"top":S=m-7}switch(c){case"top-right":case"bottom-right":_=-A;break;case"top-left":case"bottom-left":_=A;break;case"left":_=m;break;case"right":_=-m}return[_,S]}(a,s[0])}function ze(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jt(a,s,c,m,_,S,A,P,D,U,G,Q,oe,ve,Ve){var Ge=function(rr,ir,Ar,Sr,tn,Yn,An,ti){for(var In=Sr.layout.get("text-rotate").evaluate(Yn,{})*Math.PI/180,Bi=[],yi=0,zn=ir.positionedLines;yi<zn.length;yi+=1)for(var Xi=zn[yi],Li=0,Ni=Xi.positionedGlyphs;Li<Ni.length;Li+=1){var qn=Ni[Li];if(qn.rect){var aa=qn.rect||{},fo=4,ho=!0,po=1,qa=0,So=(tn||ti)&&qn.vertical,fs=qn.metrics.advance*qn.scale/2;if(ti&&ir.verticalizable&&(qa=Xi.lineOffset/2-(qn.imageName?-(24-qn.metrics.width*qn.scale)/2:24*(qn.scale-1))),qn.imageName){var hs=An[qn.imageName];ho=hs.sdf,fo=1/(po=hs.pixelRatio)}var Ws=tn?[qn.x+fs,qn.y]:[0,0],Es=tn?[0,0]:[qn.x+fs+Ar[0],qn.y+Ar[1]-qa],Xs=[0,0];So&&(Xs=Es,Es=[0,0]);var Ro=(qn.metrics.left-fo)*qn.scale-fs+Es[0],Ss=(-qn.metrics.top-fo)*qn.scale+Es[1],ea=Ro+aa.w*qn.scale/po,Ua=Ss+aa.h*qn.scale/po,Fa=new pe(Ro,Ss),da=new pe(ea,Ss),cu=new pe(Ro,Ua),Ds=new pe(ea,Ua);if(So){var no=new pe(-fs,fs- -17),Zo=-Math.PI/2,Is=12-fs,Sa=new pe(22-Is,-(qn.imageName?Is:0)),Tc=new(Function.prototype.bind.apply(pe,[null].concat(Xs)));Fa._rotateAround(Zo,no)._add(Sa)._add(Tc),da._rotateAround(Zo,no)._add(Sa)._add(Tc),cu._rotateAround(Zo,no)._add(Sa)._add(Tc),Ds._rotateAround(Zo,no)._add(Sa)._add(Tc)}if(In){var Fu=Math.sin(In),Mc=Math.cos(In),Uo=[Mc,-Fu,Fu,Mc];Fa._matMult(Uo),da._matMult(Uo),cu._matMult(Uo),Ds._matMult(Uo)}var kc=new pe(0,0),Rl=new pe(0,0);Bi.push({tl:Fa,tr:da,bl:cu,br:Ds,tex:aa,writingMode:ir.writingMode,glyphOffset:Ws,sectionIndex:qn.sectionIndex,isSDF:ho,pixelOffsetTL:kc,pixelOffsetBR:Rl,minFontScaleX:0,minFontScaleY:0})}}return Bi}(0,c,P,_,S,A,m,a.allowVerticalPlacement),lt=a.textSizeData,Je=null;lt.kind==="source"?(Je=[128*_.layout.get("text-size").evaluate(A,{})])[0]>32640&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):lt.kind==="composite"&&((Je=[128*ve.compositeTextSizes[0].evaluate(A,{},Ve),128*ve.compositeTextSizes[1].evaluate(A,{},Ve)])[0]>32640||Je[1]>32640)&&dt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ge,Je,P,S,A,U,s,D.lineStartIndex,D.lineLength,oe,Ve);for(var Ct=0,Vt=G;Ct<Vt.length;Ct+=1)Q[Vt[Ct]]=a.text.placedSymbolArray.length-1;return 4*Ge.length}function Zt(a){for(var s in a)return a[s];return null}function Mn(a,s,c,m){var _=a.compareText;if(s in _){for(var S=_[s],A=S.length-1;A>=0;A--)if(m.dist(S[A])<c)return!0}else _[s]=[];return _[s].push(m),!1}var Wi=xu.VectorTileFeature.types,Oe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ge(a,s,c,m,_,S,A,P,D,U,G,Q,oe){var ve=P?Math.min(32640,Math.round(P[0])):0,Ve=P?Math.min(32640,Math.round(P[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),S,A,(ve<<1)+(D?1:0),Ve,16*U,16*G,256*Q,256*oe)}function it(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function It(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(Hc(c[s].text))return!0;return!1}var Ht=function(a){this.layoutVertexArray=new Wc,this.indexArray=new Sl,this.programConfigurations=a,this.segments=new le,this.dynamicLayoutVertexArray=new Yl,this.opacityVertexArray=new yc,this.placedSymbolArray=new g};Ht.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ht.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Zd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,uh.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Oe,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},Ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ln("SymbolBuffers",Ht);var ct=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new le,this.collisionVertexArray=new Ph};ct.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Ud.members,!0)},ct.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ln("CollisionBuffers",ct);var Xe=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=js([]),this.placementViewportMatrix=js([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mn(this.zoom,s["text-size"]),this.iconSizeData=mn(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(S){return on[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=a.sourceID};Xe.prototype.createArrays=function(){this.text=new Ht(new oi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Ht(new oi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new I,this.lineVertexArray=new F,this.symbolInstances=new M},Xe.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var S=0;S<a.length;S++)if(s[a.charCodeAt(S)]=!0,(c||m)&&_){var A=lh[a.charAt(S)];A&&(s[A.charCodeAt(0)]=!0)}},Xe.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,S=_.get("text-font"),A=_.get("text-field"),P=_.get("icon-image"),D=(A.value.kind!=="constant"||A.value.value instanceof Ma&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),U=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,G=_.get("symbol-sort-key");if(this.features=[],D||U){for(var Q=s.iconDependencies,oe=s.glyphDependencies,ve=s.availableImages,Ve=new Oi(this.zoom),Ge=0,lt=a;Ge<lt.length;Ge+=1){var Je=lt[Ge],Ct=Je.feature,Vt=Je.id,rr=Je.index,ir=Je.sourceLayerIndex,Ar=m._featureFilter.needGeometry,Sr=lo(Ct,Ar);if(m._featureFilter.filter(Ve,Sr,c)){Ar||(Sr.geometry=Ya(Ct));var tn=void 0;if(D){var Yn=m.getValueAndResolveTokens("text-field",Sr,c,ve),An=Ma.factory(Yn);It(An)&&(this.hasRTLText=!0),(!this.hasRTLText||Sf()==="unavailable"||this.hasRTLText&&Zs.isParsed())&&(tn=yp(An,m,Sr))}var ti=void 0;if(U){var In=m.getValueAndResolveTokens("icon-image",Sr,c,ve);ti=In instanceof Le?In:Le.fromString(In)}if(tn||ti){var Bi=this.sortFeaturesByKey?G.evaluate(Sr,{},c):void 0;if(this.features.push({id:Vt,text:tn,icon:ti,index:rr,sourceLayerIndex:ir,geometry:Sr.geometry,properties:Ct.properties,type:Wi[Ct.type],sortKey:Bi}),ti&&(Q[ti.name]=!0),tn){var yi=S.evaluate(Sr,{},c).join(","),zn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(on.vertical)>=0;for(var Xi=0,Li=tn.sections;Xi<Li.length;Xi+=1){var Ni=Li[Xi];if(Ni.image)Q[Ni.image.name]=!0;else{var qn=mc(tn.toString()),aa=Ni.fontStack||yi,fo=oe[aa]=oe[aa]||{};this.calculateGlyphDependencies(Ni.text,fo,zn,this.allowVerticalPlacement,qn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(ho){var po={},qa={},So=[],fs=0;function hs(no){So.push(ho[no]),fs++}function Ws(no,Zo,Is){var Sa=qa[no];return delete qa[no],qa[Zo]=Sa,So[Sa].geometry[0].pop(),So[Sa].geometry[0]=So[Sa].geometry[0].concat(Is[0]),Sa}function Es(no,Zo,Is){var Sa=po[Zo];return delete po[Zo],po[no]=Sa,So[Sa].geometry[0].shift(),So[Sa].geometry[0]=Is[0].concat(So[Sa].geometry[0]),Sa}function Xs(no,Zo,Is){var Sa=Is?Zo[0][Zo[0].length-1]:Zo[0][0];return no+":"+Sa.x+":"+Sa.y}for(var Ro=0;Ro<ho.length;Ro++){var Ss=ho[Ro],ea=Ss.geometry,Ua=Ss.text?Ss.text.toString():null;if(Ua){var Fa=Xs(Ua,ea),da=Xs(Ua,ea,!0);if(Fa in qa&&da in po&&qa[Fa]!==po[da]){var cu=Es(Fa,da,ea),Ds=Ws(Fa,da,So[cu].geometry);delete po[Fa],delete qa[da],qa[Xs(Ua,So[Ds].geometry,!0)]=Ds,So[cu].geometry=null}else Fa in qa?Ws(Fa,da,ea):da in po?Es(Fa,da,ea):(hs(Ro),po[Fa]=fs-1,qa[da]=fs-1)}else hs(Ro)}return So.filter(function(no){return no.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ho,po){return ho.sortKey-po.sortKey})}},Xe.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},Xe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Xe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Xe.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Xe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Xe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Xe.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),S={},A=a.segment+1;A<s.length;A++)S[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:m},A<s.length-1&&(m+=s[A+1].dist(s[A]));for(var P=a.segment||0;P>=0;P--)S[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:_},P>0&&(_+=s[P-1].dist(s[P]));for(var D=0;D<s.length;D++){var U=S[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},Xe.prototype.addSymbols=function(a,s,c,m,_,S,A,P,D,U,G,Q){for(var oe=a.indexArray,ve=a.layoutVertexArray,Ve=a.segments.prepareSegment(4*s.length,ve,oe,this.canOverlap?S.sortKey:void 0),Ge=this.glyphOffsetArray.length,lt=Ve.vertexLength,Je=this.allowVerticalPlacement&&A===on.vertical?Math.PI/2:0,Ct=S.text&&S.text.sections,Vt=0;Vt<s.length;Vt++){var rr=s[Vt],ir=rr.tl,Ar=rr.tr,Sr=rr.bl,tn=rr.br,Yn=rr.tex,An=rr.pixelOffsetTL,ti=rr.pixelOffsetBR,In=rr.minFontScaleX,Bi=rr.minFontScaleY,yi=rr.glyphOffset,zn=rr.isSDF,Xi=rr.sectionIndex,Li=Ve.vertexLength,Ni=yi[1];ge(ve,P.x,P.y,ir.x,Ni+ir.y,Yn.x,Yn.y,c,zn,An.x,An.y,In,Bi),ge(ve,P.x,P.y,Ar.x,Ni+Ar.y,Yn.x+Yn.w,Yn.y,c,zn,ti.x,An.y,In,Bi),ge(ve,P.x,P.y,Sr.x,Ni+Sr.y,Yn.x,Yn.y+Yn.h,c,zn,An.x,ti.y,In,Bi),ge(ve,P.x,P.y,tn.x,Ni+tn.y,Yn.x+Yn.w,Yn.y+Yn.h,c,zn,ti.x,ti.y,In,Bi),it(a.dynamicLayoutVertexArray,P,Je),oe.emplaceBack(Li,Li+1,Li+2),oe.emplaceBack(Li+1,Li+2,Li+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yi[0]),Vt!==s.length-1&&Xi===s[Vt+1].sectionIndex||a.programConfigurations.populatePaintArrays(ve.length,S,S.index,{},Q,Ct&&Ct[Xi])}a.placedSymbolArray.emplaceBack(P.x,P.y,Ge,this.glyphOffsetArray.length-Ge,lt,D,U,P.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],A,0,!1,0,G)},Xe.prototype._addCollisionDebugVertex=function(a,s,c,m,_,S){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(S.x),Math.round(S.y))},Xe.prototype.addCollisionDebugVertices=function(a,s,c,m,_,S,A){var P=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),D=P.vertexLength,U=_.layoutVertexArray,G=_.collisionVertexArray,Q=A.anchorX,oe=A.anchorY;this._addCollisionDebugVertex(U,G,S,Q,oe,new pe(a,s)),this._addCollisionDebugVertex(U,G,S,Q,oe,new pe(c,s)),this._addCollisionDebugVertex(U,G,S,Q,oe,new pe(c,m)),this._addCollisionDebugVertex(U,G,S,Q,oe,new pe(a,m)),P.vertexLength+=4;var ve=_.indexArray;ve.emplaceBack(D,D+1),ve.emplaceBack(D+1,D+2),ve.emplaceBack(D+2,D+3),ve.emplaceBack(D+3,D),P.primitiveLength+=4},Xe.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var S=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,m?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,c)}},Xe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ct(Xc,gp.members,xc),this.iconCollisionBox=new ct(Xc,gp.members,xc);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Xe.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,S,A,P,D){for(var U={},G=s;G<c;G++){var Q=a.get(G);U.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},U.textFeatureIndex=Q.featureIndex;break}for(var oe=m;oe<_;oe++){var ve=a.get(oe);U.verticalTextBox={x1:ve.x1,y1:ve.y1,x2:ve.x2,y2:ve.y2,anchorPointX:ve.anchorPointX,anchorPointY:ve.anchorPointY},U.verticalTextFeatureIndex=ve.featureIndex;break}for(var Ve=S;Ve<A;Ve++){var Ge=a.get(Ve);U.iconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},U.iconFeatureIndex=Ge.featureIndex;break}for(var lt=P;lt<D;lt++){var Je=a.get(lt);U.verticalIconBox={x1:Je.x1,y1:Je.y1,x2:Je.x2,y2:Je.y2,anchorPointX:Je.anchorPointX,anchorPointY:Je.anchorPointY},U.verticalIconFeatureIndex=Je.featureIndex;break}return U},Xe.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},Xe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Xe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Xe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Xe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Xe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Xe.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},Xe.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],S=[],A=0;A<this.symbolInstances.length;++A){S.push(A);var P=this.symbolInstances.get(A);m.push(0|Math.round(s*P.anchorX+c*P.anchorY)),_.push(P.featureIndex)}return S.sort(function(D,U){return m[D]-m[U]||_[U]-_[D]}),S},Xe.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Xe.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(S,A,P){S>=0&&P.indexOf(S)===A&&s.addIndicesForPlacedSymbol(s.text,S)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ln("SymbolBucket",Xe,{omit:["layers","collisionBoxArray","features","compareText"]}),Xe.MAX_GLYPHS=65535,Xe.addDynamicAttributes=it;var xt=new rs({"symbol-placement":new Xn(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new Xn(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xn(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Un(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xn(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xn(_e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xn(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xn(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xn(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Un(_e.layout_symbol["icon-size"]),"icon-text-fit":new Xn(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xn(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Un(_e.layout_symbol["icon-image"]),"icon-rotate":new Un(_e.layout_symbol["icon-rotate"]),"icon-padding":new Xn(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new Xn(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new Un(_e.layout_symbol["icon-offset"]),"icon-anchor":new Un(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xn(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xn(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xn(_e.layout_symbol["text-rotation-alignment"]),"text-field":new Un(_e.layout_symbol["text-field"]),"text-font":new Un(_e.layout_symbol["text-font"]),"text-size":new Un(_e.layout_symbol["text-size"]),"text-max-width":new Un(_e.layout_symbol["text-max-width"]),"text-line-height":new Xn(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new Un(_e.layout_symbol["text-letter-spacing"]),"text-justify":new Un(_e.layout_symbol["text-justify"]),"text-radial-offset":new Un(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xn(_e.layout_symbol["text-variable-anchor"]),"text-anchor":new Un(_e.layout_symbol["text-anchor"]),"text-max-angle":new Xn(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new Xn(_e.layout_symbol["text-writing-mode"]),"text-rotate":new Un(_e.layout_symbol["text-rotate"]),"text-padding":new Xn(_e.layout_symbol["text-padding"]),"text-keep-upright":new Xn(_e.layout_symbol["text-keep-upright"]),"text-transform":new Un(_e.layout_symbol["text-transform"]),"text-offset":new Un(_e.layout_symbol["text-offset"]),"text-allow-overlap":new Xn(_e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xn(_e.layout_symbol["text-ignore-placement"]),"text-optional":new Xn(_e.layout_symbol["text-optional"])}),Te={paint:new rs({"icon-opacity":new Un(_e.paint_symbol["icon-opacity"]),"icon-color":new Un(_e.paint_symbol["icon-color"]),"icon-halo-color":new Un(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Un(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Un(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new Xn(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xn(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Un(_e.paint_symbol["text-opacity"]),"text-color":new Un(_e.paint_symbol["text-color"],{runtimeType:yt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new Un(_e.paint_symbol["text-halo-color"]),"text-halo-width":new Un(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new Un(_e.paint_symbol["text-halo-blur"]),"text-translate":new Xn(_e.paint_symbol["text-translate"]),"text-translate-anchor":new Xn(_e.paint_symbol["text-translate-anchor"])}),layout:xt},et=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Cn,this.defaultValue=a};et.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},et.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},et.prototype.outputDefined=function(){return!1},et.prototype.serialize=function(){return null},Ln("FormatSectionOverride",et,{omit:["defaultValue"]});var Be=function(a){function s(c){a.call(this,c,Te)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var S=[],A=0,P=_;A<P.length;A+=1){var D=P[A];S.indexOf(D)<0&&S.push(D)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,S){var A=this.layout.get(c).evaluate(m,{},_,S),P=this._unevaluatedLayout._values[c];return P.isDataDriven()||fc(P.value)||!A?A:function(D,U){return U.replace(/{([^{}]+)}/g,function(G,Q){return Q in D?String(D[Q]):""})}(m.properties,A)},s.prototype.createBucket=function(c){return new Xe(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=Te.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var S,A=this.paint.get(_),P=new et(A),D=new Uc(P,A.property.specification);S=A.value.kind==="constant"||A.value.kind==="source"?new Zl("source",D):new vl("composite",D,A.value.zoomStops,A.value._interpolationType),this.paint._values[_]=new as(A.property,S,A.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),S=Te.paint.properties[m],A=!1,P=function(G){for(var Q=0,oe=G;Q<oe.length;Q+=1)if(S.overrides&&S.overrides.hasOverride(oe[Q]))return void(A=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Ma)P(_.value.value.sections);else if(_.value.kind==="source"){var D=function(G){A||(G instanceof Qa&&na(G.value)===ua?P(G.value.sections):G instanceof jo?P(G.sections):G.eachChild(D))},U=_.value;U._styleExpression&&D(U._styleExpression.expression)}return A},s}(nu),Mt={paint:new rs({"background-color":new Xn(_e.paint_background["background-color"]),"background-pattern":new os(_e.paint_background["background-pattern"]),"background-opacity":new Xn(_e.paint_background["background-opacity"])})},Ut=function(a){function s(c){a.call(this,c,Mt)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(nu),Ir={paint:new rs({"raster-opacity":new Xn(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xn(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xn(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xn(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new Xn(_e.paint_raster["raster-saturation"]),"raster-contrast":new Xn(_e.paint_raster["raster-contrast"]),"raster-resampling":new Xn(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new Xn(_e.paint_raster["raster-fade-duration"])})},nn=function(a){function s(c){a.call(this,c,Ir)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(nu),an=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(nu),gn={circle:Cf,heatmap:Oh,hillshade:fp,fill:oh,"fill-extrusion":qu,line:td,symbol:Be,background:Ut,raster:nn},Jr=Se.HTMLImageElement,Nn=Se.HTMLCanvasElement,xn=Se.HTMLVideoElement,Pn=Se.ImageData,Fn=Se.ImageBitmap,kn=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};kn.prototype.update=function(a,s,c){var m=a.width,_=a.height,S=!(this.size&&this.size[0]===m&&this.size[1]===_||c),A=this.context,P=A.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[m,_],a instanceof Jr||a instanceof Nn||a instanceof xn||a instanceof Pn||Fn&&a instanceof Fn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,a):P.texImage2D(P.TEXTURE_2D,0,this.format,m,_,0,this.format,P.UNSIGNED_BYTE,a.data);else{var D=c||{x:0,y:0},U=D.x,G=D.y;a instanceof Jr||a instanceof Nn||a instanceof xn||a instanceof Pn||Fn&&a instanceof Fn?P.texSubImage2D(P.TEXTURE_2D,0,U,G,P.RGBA,P.UNSIGNED_BYTE,a):P.texSubImage2D(P.TEXTURE_2D,0,U,G,m,_,P.RGBA,P.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},kn.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},kn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},kn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var hi=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};hi.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},hi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Aa=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},xr(["receive","process"],this),this.invoker=new hi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ue()?a:Se};function cs(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}Aa.prototype.send=function(a,s,c,m,_){var S=this;_===void 0&&(_=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[A]=c);var P=Y(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:eu(s,P)},P),{cancel:function(){c&&delete S.callbacks[A],S.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:S.mapId})}}},Aa.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else ue()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},Aa.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},Aa.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(zs(s.error)):m(null,zs(s.data)))}else{var _=!1,S=Y(this.globalScope)?void 0:[],A=s.hasCallback?function(G,Q){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:G?eu(G):null,data:eu(Q,S)},S)}:function(G){_=!0},P=null,D=zs(s.data);if(this.parent[s.type])P=this.parent[s.type](s.sourceMapId,D,A);else if(this.parent.getWorkerSource){var U=s.type.split(".");P=this.parent.getWorkerSource(s.sourceMapId,U[0],D.source)[U[1]](D,A)}else A(new Error("Could not find function "+s.type));!_&&P&&P.cancel&&(this.cancelCallbacks[a]=P.cancel)}},Aa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ji=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Ji.prototype.setNorthEast=function(a){return this._ne=a instanceof Ea?new Ea(a.lng,a.lat):Ea.convert(a),this},Ji.prototype.setSouthWest=function(a){return this._sw=a instanceof Ea?new Ea(a.lng,a.lat):Ea.convert(a),this},Ji.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof Ea)s=a,c=a;else{if(!(a instanceof Ji))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ji.convert(a)):this.extend(Ea.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new Ea(s.lng,s.lat),this._ne=new Ea(c.lng,c.lat)),this},Ji.prototype.getCenter=function(){return new Ea((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ji.prototype.getSouthWest=function(){return this._sw},Ji.prototype.getNorthEast=function(){return this._ne},Ji.prototype.getNorthWest=function(){return new Ea(this.getWest(),this.getNorth())},Ji.prototype.getSouthEast=function(){return new Ea(this.getEast(),this.getSouth())},Ji.prototype.getWest=function(){return this._sw.lng},Ji.prototype.getSouth=function(){return this._sw.lat},Ji.prototype.getEast=function(){return this._ne.lng},Ji.prototype.getNorth=function(){return this._ne.lat},Ji.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ji.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ji.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ji.prototype.contains=function(a){var s=Ea.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},Ji.convert=function(a){return!a||a instanceof Ji?a:new Ji(a)};var Ea=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ea.prototype.wrap=function(){return new Ea(_r(this.lng,-180,180),this.lat)},Ea.prototype.toArray=function(){return[this.lng,this.lat]},Ea.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ea.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},Ea.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Ji(new Ea(this.lng-c,this.lat-s),new Ea(this.lng+c,this.lat+s))},Ea.convert=function(a){if(a instanceof Ea)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ea(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ea(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Pl=2*Math.PI*63710088e-1;function Hs(a){return Pl*Math.cos(a*Math.PI/180)}function sn(a){return(180+a)/360}function Ou(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function tr(a,s){return a/Hs(s)}function Lu(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Cc=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};Cc.fromLngLat=function(a,s){s===void 0&&(s=0);var c=Ea.convert(a);return new Cc(sn(c.lng),Ou(c.lat),tr(s,c.lat))},Cc.prototype.toLngLat=function(){return new Ea(360*this.x-180,Lu(this.y))},Cc.prototype.toAltitude=function(){return this.z*Hs(Lu(this.y))},Cc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Pl*(a=Lu(this.y),1/Math.cos(a*Math.PI/180));var a};var Nf=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=nf(0,a,a,s,c)};Nf.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Nf.prototype.url=function(a,s){var c,m,_,S,A,P=(m=this.y,_=this.z,S=cs(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),A=cs(256*(c+1),256*(m+1),_),S[0]+","+S[1]+","+A[0]+","+A[1]),D=function(U,G,Q){for(var oe,ve="",Ve=U;Ve>0;Ve--)ve+=(G&(oe=1<<Ve-1)?1:0)+(Q&oe?2:0);return ve}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",P)},Nf.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new pe(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},Nf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Rv=function(a,s){this.wrap=a,this.canonical=s,this.key=nf(a,s.z,s.z,s.x,s.y)},$o=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new Nf(c,+m,+_),this.key=nf(s,a,c,m,_)};function nf(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var S=1<<c;return(S*S*a+S*_+m).toString(36)+c.toString(36)+s.toString(36)}$o.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},$o.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new $o(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $o(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},$o.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?nf(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):nf(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},$o.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},$o.prototype.children=function(a){if(this.overscaledZ>=a)return[new $o(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new $o(s,this.wrap,s,c,m),new $o(s,this.wrap,s,c+1,m),new $o(s,this.wrap,s,c,m+1),new $o(s,this.wrap,s,c+1,m+1)]},$o.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},$o.prototype.wrapped=function(){return new $o(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},$o.prototype.unwrapTo=function(a){return new $o(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},$o.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},$o.prototype.toUnwrapped=function(){return new Rv(this.wrap,this.canonical)},$o.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},$o.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Cc(a.x-this.wrap,a.y))},Ln("CanonicalTileID",Nf),Ln("OverscaledTileID",$o,{omit:["posMatrix"]});var af=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return dt('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};af.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},af.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},af.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},af.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},af.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},af.prototype.getPixels=function(){return new No({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},af.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,S=c*this.dim,A=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:S=A-1;break;case 1:A=S+1}for(var P=-s*this.dim,D=-c*this.dim,U=S;U<A;U++)for(var G=m;G<_;G++)this.data[this._idx(G,U)]=a.data[this._idx(G+P,U+D)]},Ln("DEMData",af);var id=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};id.prototype.encode=function(a){return this._stringToNumber[a]},id.prototype.decode=function(a){return this._numberToString[a]};var xp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},ad={geometry:{configurable:!0}};ad.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ad.geometry.set=function(a){this._geometry=a},xp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(xp.prototype,ad);var fh=function(){this.state={},this.stateChanges={},this.deletedStates={}};fh.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Nt(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var S in this.deletedStates[a][m]={},this.state[a][m])c[S]||(this.deletedStates[a][m][S]=null);else for(var A in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][A]===null&&delete this.deletedStates[a][m][A]},fh.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},fh.prototype.getState=function(a,s){var c=String(s),m=Nt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var S in _)delete m[S]}return m},fh.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},fh.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Nt(this.state[m][S],this.stateChanges[m][S]),_[S]=this.state[m][S];c[m]=_}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var P={};if(this.deletedStates[A]===null)for(var D in this.state[A])P[D]={},this.state[A][D]={};else for(var U in this.deletedStates[A]){if(this.deletedStates[A][U]===null)this.state[A][U]={};else for(var G=0,Q=Object.keys(this.deletedStates[A][U]);G<Q.length;G+=1)delete this.state[A][U][Q[G]];P[U]=this.state[A][U]}c[A]=c[A]||{},Nt(c[A],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var oe in a)a[oe].setFeatureState(c,s)};var Ac=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Cu(8192,16,0),this.grid3D=new Cu(8192,16,0),this.featureIndexArray=new J,this.promoteId=s};function jd(a,s,c,m,_){return sr(a,function(S,A){var P=s instanceof vu?s.get(A):null;return P&&P.evaluate?P.evaluate(c,m,_):P})}function Ov(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,S=0,A=a;S<A.length;S+=1){var P=A[S];s=Math.min(s,P.x),c=Math.min(c,P.y),m=Math.max(m,P.x),_=Math.max(_,P.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function Lv(a,s){return s-a}Ac.prototype.insert=function(a,s,c,m,_,S){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var P=S?this.grid3D:this.grid,D=0;D<s.length;D++){for(var U=s[D],G=[1/0,1/0,-1/0,-1/0],Q=0;Q<U.length;Q++){var oe=U[Q];G[0]=Math.min(G[0],oe.x),G[1]=Math.min(G[1],oe.y),G[2]=Math.max(G[2],oe.x),G[3]=Math.max(G[3],oe.y)}G[0]<8192&&G[1]<8192&&G[2]>=0&&G[3]>=0&&P.insert(A,G[0],G[1],G[2],G[3])}},Ac.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xu.VectorTile(new ch(this.rawTileData)).layers,this.sourceLayerCoder=new id(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ac.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var S=a.params||{},A=8192/a.tileSize/a.scale,P=yf(S.filter),D=a.queryGeometry,U=a.queryPadding*A,G=Ov(D),Q=this.grid.query(G.minX-U,G.minY-U,G.maxX+U,G.maxY+U),oe=Ov(a.cameraQueryGeometry),ve=this.grid3D.query(oe.minX-U,oe.minY-U,oe.maxX+U,oe.maxY+U,function(rr,ir,Ar,Sr){return function(tn,Yn,An,ti,In){for(var Bi=0,yi=tn;Bi<yi.length;Bi+=1){var zn=yi[Bi];if(Yn<=zn.x&&An<=zn.y&&ti>=zn.x&&In>=zn.y)return!0}var Xi=[new pe(Yn,An),new pe(Yn,In),new pe(ti,In),new pe(ti,An)];if(tn.length>2){for(var Li=0,Ni=Xi;Li<Ni.length;Li+=1)if(Mu(tn,Ni[Li]))return!0}for(var qn=0;qn<tn.length-1;qn++)if(Jl(tn[qn],tn[qn+1],Xi))return!0;return!1}(a.cameraQueryGeometry,rr-U,ir-U,Ar+U,Sr+U)}),Ve=0,Ge=ve;Ve<Ge.length;Ve+=1)Q.push(Ge[Ve]);Q.sort(Lv);for(var lt,Je={},Ct=function(rr){var ir=Q[rr];if(ir!==lt){lt=ir;var Ar=_.featureIndexArray.get(ir),Sr=null;_.loadMatchingFeature(Je,Ar.bucketIndex,Ar.sourceLayerIndex,Ar.featureIndex,P,S.layers,S.availableImages,s,c,m,function(tn,Yn,An){return Sr||(Sr=Ya(tn)),Yn.queryIntersectsFeature(D,tn,An,Sr,_.z,a.transform,A,a.pixelPosMatrix)})}},Vt=0;Vt<Q.length;Vt++)Ct(Vt);return Je},Ac.prototype.loadMatchingFeature=function(a,s,c,m,_,S,A,P,D,U,G){var Q=this.bucketLayerIDs[s];if(!S||function(tn,Yn){for(var An=0;An<tn.length;An++)if(Yn.indexOf(tn[An])>=0)return!0;return!1}(S,Q)){var oe=this.sourceLayerCoder.decode(c),ve=this.vtLayers[oe].feature(m);if(_.needGeometry){var Ve=lo(ve,!0);if(!_.filter(new Oi(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!_.filter(new Oi(this.tileID.overscaledZ),ve))return;for(var Ge=this.getId(ve,oe),lt=0;lt<Q.length;lt++){var Je=Q[lt];if(!(S&&S.indexOf(Je)<0)){var Ct=P[Je];if(Ct){var Vt={};Ge!==void 0&&U&&(Vt=U.getState(Ct.sourceLayer||"_geojsonTileLayer",Ge));var rr=Nt({},D[Je]);rr.paint=jd(rr.paint,Ct.paint,ve,Vt,A),rr.layout=jd(rr.layout,Ct.layout,ve,Vt,A);var ir=!G||G(ve,Ct,Vt);if(ir){var Ar=new xp(ve,this.z,this.x,this.y,Ge);Ar.layer=rr;var Sr=a[Je];Sr===void 0&&(Sr=a[Je]=[]),Sr.push({featureIndex:m,feature:Ar,intersectionZ:ir})}}}}}},Ac.prototype.lookupSymbolFeatures=function(a,s,c,m,_,S,A,P){var D={};this.loadVTLayers();for(var U=yf(_),G=0,Q=a;G<Q.length;G+=1)this.loadMatchingFeature(D,c,m,Q[G],U,S,A,P,s);return D},Ac.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},Ac.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},Ln("FeatureIndex",Ac,{omit:["rawTileData","sourceLayerCoder"]});var bs=function(a,s){this.tileID=a,this.uid=Qt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};bs.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<Ci.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},bs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},bs.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(U,G){var Q={};if(!G)return Q;for(var oe=function(){var Ge=Ve[ve],lt=Ge.layerIds.map(function(Vt){return G.getLayer(Vt)}).filter(Boolean);if(lt.length!==0){Ge.layers=lt,Ge.stateDependentLayerIds&&(Ge.stateDependentLayers=Ge.stateDependentLayerIds.map(function(Vt){return lt.filter(function(rr){return rr.id===Vt})[0]}));for(var Je=0,Ct=lt;Je<Ct.length;Je+=1)Q[Ct[Je].id]=Ge}},ve=0,Ve=U;ve<Ve.length;ve+=1)oe();return Q}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof Xe){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var A=this.buckets[S];if(A instanceof Xe&&A.hasRTLText){this.hasRTLText=!0,Zs.isLoading()||Zs.isLoaded()||Sf()!=="deferred"||tu();break}}for(var P in this.queryPadding=0,this.buckets){var D=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(P).queryRadius(D))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},bs.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},bs.prototype.getBucket=function(a){return this.buckets[a.id]},bs.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kn(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kn(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},bs.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},bs.prototype.queryRenderedFeatures=function(a,s,c,m,_,S,A,P,D,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:U,transform:P,params:A,queryPadding:this.queryPadding*D},a,s,c):{}},bs.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",S=m._geojsonTileLayer||m[_];if(S)for(var A=yf(s&&s.filter),P=this.tileID.canonical,D=P.z,U=P.x,G=P.y,Q={z:D,x:U,y:G},oe=0;oe<S.length;oe++){var ve=S.feature(oe);if(A.needGeometry){var Ve=lo(ve,!0);if(!A.filter(new Oi(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!A.filter(new Oi(this.tileID.overscaledZ),ve))continue;var Ge=c.getId(ve,_),lt=new xp(ve,D,U,G,Ge);lt.tile=Q,a.push(lt)}}},bs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},bs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},bs.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=He(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var S=this.expirationTime-s;S?this.expirationTime=m+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},bs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},bs.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],S=_.layers[0].sourceLayer||"_geojsonTileLayer",A=c[S],P=a[S];if(A&&P&&Object.keys(P).length!==0){_.update(P,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=s&&s.style&&s.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}}},bs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},bs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ci.now()},bs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},bs.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Ci.now()+a},bs.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},bs.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var S=0,A=s;S<A.length;S+=1)if(_[A[S]])return!0}}return!1};var zf=Se.performance,Fv=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},zf.mark(this._marks.start)};Fv.prototype.finish=function(){zf.mark(this._marks.end);var a=zf.getEntriesByName(this._marks.measure);return a.length===0&&(zf.measure(this._marks.measure,this._marks.start,this._marks.end),a=zf.getEntriesByName(this._marks.measure),zf.clearMarks(this._marks.start),zf.clearMarks(this._marks.end),zf.clearMeasures(this._marks.measure)),a},y.Actor=Aa,y.AlphaImage=_u,y.CanonicalTileID=Nf,y.CollisionBoxArray=d,y.Color=pr,y.DEMData=af,y.DataConstantProperty=Xn,y.DictionaryCoder=id,y.EXTENT=8192,y.ErrorEvent=tt,y.EvaluationParameters=Oi,y.Event=Ze,y.Evented=pt,y.FeatureIndex=Ac,y.FillBucket=su,y.FillExtrusionBucket=ll,y.ImageAtlas=Zr,y.ImagePosition=At,y.LineBucket=ga,y.LngLat=Ea,y.LngLatBounds=Ji,y.MercatorCoordinate=Cc,y.ONE_EM=24,y.OverscaledTileID=$o,y.Point=pe,y.Point$1=pe,y.Properties=rs,y.Protobuf=ch,y.RGBAImage=No,y.RequestManager=zi,y.RequestPerformance=Fv,y.ResourceType=Kr,y.SegmentVector=le,y.SourceFeatureState=fh,y.StructArrayLayout1ui2=Jf,y.StructArrayLayout2f1f2i16=_c,y.StructArrayLayout2i4=$l,y.StructArrayLayout3ui6=Sl,y.StructArrayLayout4i8=gu,y.SymbolBucket=Xe,y.Texture=kn,y.Tile=bs,y.Transitionable=ts,y.Uniform1f=rn,y.Uniform1i=Tr,y.Uniform2f=Qr,y.Uniform3f=Sn,y.Uniform4f=Jn,y.UniformColor=ei,y.UniformMatrix4f=ji,y.UnwrappedTileID=Rv,y.ValidationError=We,y.WritingMode=on,y.ZoomHistory=bf,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=it,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),S=null;a.forEach(function(A,P){s(A,function(D,U){D&&(S=D),_[P]=U,--m==0&&c(S,_)})})},y.bezier=mt,y.bindAll=xr,y.browser=Ci,y.cacheEntryPossiblyAdded=function(a){++Hn>hr&&(a.getActor().send("enforceCacheSizeLimit",kt),Hn=0)},y.clamp=Dt,y.clearTileCache=function(a){var s=Se.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=yo,y.clone=function(a){var s=new ma(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=ht,y.clone$2=function(a){var s=new ma(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=lu,y.config=Wn,y.create=function(){var a=new ma(16);return ma!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new ma(9);return ma!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new ma(4);return ma!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=Pe,y.createExpression=zl,y.createLayout=Pa,y.createStyleLayer=function(a){return a.type==="custom"?new an(a):new gn[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],S=s[2],A=c[0],P=c[1],D=c[2];return a[0]=_*D-S*P,a[1]=S*A-m*D,a[2]=m*P-_*A,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=bt,y.emitValidationErrors=dc,y.endsWith=ee,y.enforceCacheSizeLimit=function(a){kr(),ae&&ae.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=li,y.evaluateSizeForZoom=bi,y.evaluateVariableOffset=Il,y.evented=Kf,y.extend=Nt,y.featureFilter=yf,y.filterObject=Tt,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=un,y.getAnchorJustification=ze,y.getArrayBuffer=_a,y.getImage=re,y.getJSON=function(a,s){return Na(Nt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=Sf,y.getReferrer=ri,y.getVideo=function(a,s){var c,m,_=Se.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var S=0;S<a.length;S++){var A=Se.document.createElement("source");c=a[S],m=void 0,(m=Se.document.createElement("a")).href=c,(m.protocol!==Se.document.location.protocol||m.host!==Se.document.location.host)&&(_.crossOrigin="Anonymous"),A.src=a[S],_.appendChild(A)}return{cancel:function(){}}},y.identity=js,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],S=s[3],A=s[4],P=s[5],D=s[6],U=s[7],G=s[8],Q=s[9],oe=s[10],ve=s[11],Ve=s[12],Ge=s[13],lt=s[14],Je=s[15],Ct=c*P-m*A,Vt=c*D-_*A,rr=c*U-S*A,ir=m*D-_*P,Ar=m*U-S*P,Sr=_*U-S*D,tn=G*Ge-Q*Ve,Yn=G*lt-oe*Ve,An=G*Je-ve*Ve,ti=Q*lt-oe*Ge,In=Q*Je-ve*Ge,Bi=oe*Je-ve*lt,yi=Ct*Bi-Vt*In+rr*ti+ir*An-Ar*Yn+Sr*tn;return yi?(a[0]=(P*Bi-D*In+U*ti)*(yi=1/yi),a[1]=(_*In-m*Bi-S*ti)*yi,a[2]=(Ge*Sr-lt*Ar+Je*ir)*yi,a[3]=(oe*Ar-Q*Sr-ve*ir)*yi,a[4]=(D*An-A*Bi-U*Yn)*yi,a[5]=(c*Bi-_*An+S*Yn)*yi,a[6]=(lt*rr-Ve*Sr-Je*Vt)*yi,a[7]=(G*Sr-oe*rr+ve*Vt)*yi,a[8]=(A*In-P*An+U*tn)*yi,a[9]=(m*An-c*In-S*tn)*yi,a[10]=(Ve*Ar-Ge*rr+Je*Ct)*yi,a[11]=(Q*rr-G*Ar-ve*Ct)*yi,a[12]=(P*Yn-A*ti-D*tn)*yi,a[13]=(c*ti-m*Yn+_*tn)*yi,a[14]=(Ge*Vt-Ve*ir-lt*Ct)*yi,a[15]=(G*ir-Q*Vt+oe*Ct)*yi,a):null},y.isChar=hn,y.isMapboxURL=_i,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=Na,y.mapObject=sr,y.mercatorXfromLng=sn,y.mercatorYfromLat=Ou,y.mercatorZfromAltitude=tr,y.mul=Yc,y.multiply=_s,y.mvt=xu,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],S=c*c+m*m+_*_;return S>0&&(S=1/Math.sqrt(S)),a[0]=s[0]*S,a[1]=s[1]*S,a[2]=s[2]*S,a},y.number=Zi,y.offscreenCanvasSupported=Bn,y.ortho=function(a,s,c,m,_,S,A){var P=1/(s-c),D=1/(m-_),U=1/(S-A);return a[0]=-2*P,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*U,a[11]=0,a[12]=(s+c)*P,a[13]=(_+m)*D,a[14]=(A+S)*U,a[15]=1,a},y.parseGlyphPBF=function(a){return new ch(a).readFields(Xr,[])},y.pbf=ch,y.performSymbolLayout=function(a,s,c,m,_,S,A){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var P=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,U={};if(a.textSizeData.kind==="composite"){var G=a.textSizeData,Q=G.maxZoom;U.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Oi(G.minZoom),A),D["text-size"].possiblyEvaluate(new Oi(Q),A)]}if(a.iconSizeData.kind==="composite"){var oe=a.iconSizeData,ve=oe.maxZoom;U.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Oi(oe.minZoom),A),D["icon-size"].possiblyEvaluate(new Oi(ve),A)]}U.layoutTextSize=D["text-size"].possiblyEvaluate(new Oi(a.zoom+1),A),U.layoutIconSize=D["icon-size"].possiblyEvaluate(new Oi(a.zoom+1),A),U.textMaxSize=D["text-size"].possiblyEvaluate(new Oi(18));for(var Ve=24*P.get("text-line-height"),Ge=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",lt=P.get("text-keep-upright"),Je=P.get("text-size"),Ct=function(){var ir=rr[Vt],Ar=P.get("text-font").evaluate(ir,{},A).join(","),Sr=Je.evaluate(ir,{},A),tn=U.layoutTextSize.evaluate(ir,{},A),Yn=U.layoutIconSize.evaluate(ir,{},A),An={horizontal:{},vertical:void 0},ti=ir.text,In=[0,0];if(ti){var Bi=ti.toString(),yi=24*P.get("text-letter-spacing").evaluate(ir,{},A),zn=function(ea){for(var Ua=0,Fa=ea;Ua<Fa.length;Ua+=1)if(da=Fa[Ua].charCodeAt(0),hn.Arabic(da)||hn["Arabic Supplement"](da)||hn["Arabic Extended-A"](da)||hn["Arabic Presentation Forms-A"](da)||hn["Arabic Presentation Forms-B"](da))return!1;var da;return!0}(Bi)?yi:0,Xi=P.get("text-anchor").evaluate(ir,{},A),Li=P.get("text-variable-anchor");if(!Li){var Ni=P.get("text-radial-offset").evaluate(ir,{},A);In=Ni?Il(Xi,[24*Ni,Po]):P.get("text-offset").evaluate(ir,{},A).map(function(ea){return 24*ea})}var qn=Ge?"center":P.get("text-justify").evaluate(ir,{},A),aa=P.get("symbol-placement"),fo=aa==="point"?24*P.get("text-max-width").evaluate(ir,{},A):0,ho=function(){a.allowVerticalPlacement&&mc(Bi)&&(An.vertical=vn(ti,s,c,_,Ar,fo,Ve,Xi,"left",zn,In,on.vertical,!0,aa,tn,Sr))};if(!Ge&&Li){for(var po=qn==="auto"?Li.map(function(ea){return ze(ea)}):[qn],qa=!1,So=0;So<po.length;So++){var fs=po[So];if(!An.horizontal[fs])if(qa)An.horizontal[fs]=An.horizontal[0];else{var hs=vn(ti,s,c,_,Ar,fo,Ve,"center",fs,zn,In,on.horizontal,!1,aa,tn,Sr);hs&&(An.horizontal[fs]=hs,qa=hs.positionedLines.length===1)}}ho()}else{qn==="auto"&&(qn=ze(Xi));var Ws=vn(ti,s,c,_,Ar,fo,Ve,Xi,qn,zn,In,on.horizontal,!1,aa,tn,Sr);Ws&&(An.horizontal[qn]=Ws),ho(),mc(Bi)&&Ge&&lt&&(An.vertical=vn(ti,s,c,_,Ar,fo,Ve,Xi,qn,zn,In,on.vertical,!1,aa,tn,Sr))}}var Es=void 0,Xs=!1;if(ir.icon&&ir.icon.name){var Ro=m[ir.icon.name];Ro&&(Es=function(ea,Ua,Fa){var da=un(Fa),cu=Ua[0]-ea.displaySize[0]*da.horizontalAlign,Ds=Ua[1]-ea.displaySize[1]*da.verticalAlign;return{image:ea,top:Ds,bottom:Ds+ea.displaySize[1],left:cu,right:cu+ea.displaySize[0]}}(_[ir.icon.name],P.get("icon-offset").evaluate(ir,{},A),P.get("icon-anchor").evaluate(ir,{},A)),Xs=Ro.sdf,a.sdfIcons===void 0?a.sdfIcons=Ro.sdf:a.sdfIcons!==Ro.sdf&&dt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ro.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Ss=Zt(An.horizontal)||An.vertical;a.iconsInText=!!Ss&&Ss.iconsInText,(Ss||Es)&&function(ea,Ua,Fa,da,cu,Ds,no,Zo,Is,Sa,Tc){var Fu=Ds.textMaxSize.evaluate(Ua,{});Fu===void 0&&(Fu=no);var Mc,Uo=ea.layers[0].layout,kc=Uo.get("icon-offset").evaluate(Ua,{},Tc),Rl=Zt(Fa.horizontal),Zh=no/24,hh=ea.tilePixelRatio*Zh,Uh=ea.tilePixelRatio*Fu/24,Ic=ea.tilePixelRatio*Zo,Vh=ea.tilePixelRatio*Uo.get("symbol-spacing"),od=Uo.get("text-padding")*ea.tilePixelRatio,jh=Uo.get("icon-padding")*ea.tilePixelRatio,ph=Uo.get("text-max-angle")/180*Math.PI,sd=Uo.get("text-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",ud=Uo.get("icon-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",Pc=Uo.get("symbol-placement"),Gh=Vh/2,Hh=Uo.get("icon-text-fit");da&&Hh!=="none"&&(ea.allowVerticalPlacement&&Fa.vertical&&(Mc=di(da,Fa.vertical,Hh,Uo.get("icon-text-fit-padding"),kc,Zh)),Rl&&(da=di(da,Rl,Hh,Uo.get("icon-text-fit-padding"),kc,Zh)));var bu=function(Bv,hd){hd.x<0||hd.x>=8192||hd.y<0||hd.y>=8192||function(Vo,Rc,yg,yh,Nv,V0,Wd,of,Xd,pd,$d,Yd,qd,j0,dd,G0,H0,W0,X0,$0,cl,Kd,Y0,sf,_g){var vd,Kh,Ap,Tp,Mp,kp=Vo.addToLineVertexArray(Rc,yg),q0=0,K0=0,Q0=0,J0=0,zv=-1,Zv=-1,Zf={},em=Ne(""),Ip=0,Qd=0;if(of._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ip=(vd=of.layout.get("text-offset").evaluate(cl,{},sf).map(function(Op){return 24*Op}))[0],Qd=vd[1]):(Ip=24*of.layout.get("text-radial-offset").evaluate(cl,{},sf),Qd=Po),Vo.allowVerticalPlacement&&yh.vertical){var Jd=of.layout.get("text-rotate").evaluate(cl,{},sf)+90;Tp=new Io(Xd,Rc,pd,$d,Yd,yh.vertical,qd,j0,dd,Jd),Wd&&(Mp=new Io(Xd,Rc,pd,$d,Yd,Wd,H0,W0,dd,Jd))}if(Nv){var md=of.layout.get("icon-rotate").evaluate(cl,{}),uf=of.layout.get("icon-text-fit")!=="none",Uf=zo(Nv,md,Y0,uf),gd=Wd?zo(Wd,md,Y0,uf):void 0;Ap=new Io(Xd,Rc,pd,$d,Yd,Nv,H0,W0,!1,md),q0=4*Uf.length;var ev=Vo.iconSizeData,Qh=null;ev.kind==="source"?(Qh=[128*of.layout.get("icon-size").evaluate(cl,{})])[0]>32640&&dt(Vo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ev.kind==="composite"&&((Qh=[128*Kd.compositeIconSizes[0].evaluate(cl,{},sf),128*Kd.compositeIconSizes[1].evaluate(cl,{},sf)])[0]>32640||Qh[1]>32640)&&dt(Vo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Vo.addSymbols(Vo.icon,Uf,Qh,$0,X0,cl,!1,Rc,kp.lineStartIndex,kp.lineLength,-1,sf),zv=Vo.icon.placedSymbolArray.length-1,gd&&(K0=4*gd.length,Vo.addSymbols(Vo.icon,gd,Qh,$0,X0,cl,on.vertical,Rc,kp.lineStartIndex,kp.lineLength,-1,sf),Zv=Vo.icon.placedSymbolArray.length-1)}for(var yd in yh.horizontal){var Pp=yh.horizontal[yd];if(!Kh){em=Ne(Pp.text);var tm=of.layout.get("text-rotate").evaluate(cl,{},sf);Kh=new Io(Xd,Rc,pd,$d,Yd,Pp,qd,j0,dd,tm)}var Uv=Pp.positionedLines.length===1;if(Q0+=Jt(Vo,Rc,Pp,V0,of,dd,cl,G0,kp,yh.vertical?on.horizontal:on.horizontalOnly,Uv?Object.keys(yh.horizontal):[yd],Zf,zv,Kd,sf),Uv)break}yh.vertical&&(J0+=Jt(Vo,Rc,yh.vertical,V0,of,dd,cl,G0,kp,on.vertical,["vertical"],Zf,Zv,Kd,sf));var rm=Kh?Kh.boxStartIndex:Vo.collisionBoxArray.length,Rp=Kh?Kh.boxEndIndex:Vo.collisionBoxArray.length,fu=Tp?Tp.boxStartIndex:Vo.collisionBoxArray.length,Vv=Tp?Tp.boxEndIndex:Vo.collisionBoxArray.length,jv=Ap?Ap.boxStartIndex:Vo.collisionBoxArray.length,Gv=Ap?Ap.boxEndIndex:Vo.collisionBoxArray.length,tv=Mp?Mp.boxStartIndex:Vo.collisionBoxArray.length,Hv=Mp?Mp.boxEndIndex:Vo.collisionBoxArray.length,Oc=-1,_d=function(Op,Xv){return Op&&Op.circleDiameter?Math.max(Op.circleDiameter,Xv):Xv};Oc=_d(Kh,Oc),Oc=_d(Tp,Oc),Oc=_d(Ap,Oc);var Wv=(Oc=_d(Mp,Oc))>-1?1:0;Wv&&(Oc*=_g/24),Vo.glyphOffsetArray.length>=Xe.MAX_GLYPHS&&dt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cl.sortKey!==void 0&&Vo.addToSortKeyRanges(Vo.symbolInstances.length,cl.sortKey),Vo.symbolInstances.emplaceBack(Rc.x,Rc.y,Zf.right>=0?Zf.right:-1,Zf.center>=0?Zf.center:-1,Zf.left>=0?Zf.left:-1,Zf.vertical||-1,zv,Zv,em,rm,Rp,fu,Vv,jv,Gv,tv,Hv,pd,Q0,J0,q0,K0,Wv,0,qd,Ip,Qd,Oc)}(ea,hd,Bv,Fa,da,cu,Mc,ea.layers[0],ea.collisionBoxArray,Ua.index,Ua.sourceLayerIndex,ea.index,hh,od,sd,Is,Ic,jh,ud,kc,Ua,Ds,Sa,Tc,no)};if(Pc==="line")for(var dh=0,bp=yo(Ua.geometry,0,0,8192,8192);dh<bp.length;dh+=1)for(var ld=bp[dh],Ep=0,Wh=Wo(ld,Vh,ph,Fa.vertical||Rl,da,24,Uh,ea.overscaling,8192);Ep<Wh.length;Ep+=1){var cd=Wh[Ep];Rl&&Mn(ea,Rl.text,Gh,cd)||bu(ld,cd)}else if(Pc==="line-center")for(var Sp=0,Xh=Ua.geometry;Sp<Xh.length;Sp+=1){var $h=Xh[Sp];if($h.length>1){var fd=Ha($h,ph,Fa.vertical||Rl,da,24,Uh);fd&&bu($h,fd)}}else if(Ua.type==="Polygon")for(var vh=0,wp=nh(Ua.geometry,0);vh<wp.length;vh+=1){var Yh=wp[vh],Cp=gi(Yh,16);bu(Yh[0],new fn(Cp.x,Cp.y,0))}else if(Ua.type==="LineString")for(var mh=0,qh=Ua.geometry;mh<qh.length;mh+=1){var gh=qh[mh];bu(gh,new fn(gh[0].x,gh[0].y,0))}else if(Ua.type==="Point")for(var Gd=0,Dv=Ua.geometry;Gd<Dv.length;Gd+=1)for(var Hd=0,oa=Dv[Gd];Hd<oa.length;Hd+=1){var ta=oa[Hd];bu([ta],new fn(ta.x,ta.y,0))}}(a,ir,An,Es,m,U,tn,Yn,In,Xs,A)},Vt=0,rr=a.features;Vt<rr.length;Vt+=1)Ct();S&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var S,A=1/Math.tan(s/2);return a[0]=A/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(S=1/(m-_)),a[14]=2*_*m*S):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=Zs,y.polygonIntersectsPolygon=Vs,y.postMapLoadEvent=qe,y.postTurnstileEvent=Wt,y.potpack=Gr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Ln,y.registerForPluginStateChange=function(a){return a({pluginStatus:Os,pluginURL:ju}),Kf.on("pluginStateChange",a),a},y.renderColorRamp=Rh,y.rotate=function(a,s,c){var m=s[0],_=s[1],S=s[2],A=s[3],P=Math.sin(c),D=Math.cos(c);return a[0]=m*D+S*P,a[1]=_*D+A*P,a[2]=m*-P+S*D,a[3]=_*-P+A*D,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[4],A=s[5],P=s[6],D=s[7],U=s[8],G=s[9],Q=s[10],oe=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=S*_+U*m,a[5]=A*_+G*m,a[6]=P*_+Q*m,a[7]=D*_+oe*m,a[8]=U*_-S*m,a[9]=G*_-A*m,a[10]=Q*_-P*m,a[11]=oe*_-D*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[0],A=s[1],P=s[2],D=s[3],U=s[4],G=s[5],Q=s[6],oe=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=S*_+U*m,a[1]=A*_+G*m,a[2]=P*_+Q*m,a[3]=D*_+oe*m,a[4]=U*_-S*m,a[5]=G*_-A*m,a[6]=Q*_-P*m,a[7]=oe*_-D*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],S=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*S,a[9]=s[9]*S,a[10]=s[10]*S,a[11]=s[11]*S,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){kt=a,hr=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),Os==="deferred"||Os==="loading"||Os==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ju=Ci.resolveURL(a),Os="deferred",Au=s,Wl(),c||tu()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=_e,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=Ui,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],S=s[2];return a[0]=m*c[0]+_*c[3]+S*c[6],a[1]=m*c[1]+_*c[4]+S*c[7],a[2]=m*c[2]+_*c[5]+S*c[8],a},y.transformMat4=qc,y.translate=function(a,s,c){var m,_,S,A,P,D,U,G,Q,oe,ve,Ve,Ge=c[0],lt=c[1],Je=c[2];return s===a?(a[12]=s[0]*Ge+s[4]*lt+s[8]*Je+s[12],a[13]=s[1]*Ge+s[5]*lt+s[9]*Je+s[13],a[14]=s[2]*Ge+s[6]*lt+s[10]*Je+s[14],a[15]=s[3]*Ge+s[7]*lt+s[11]*Je+s[15]):(_=s[1],S=s[2],A=s[3],P=s[4],D=s[5],U=s[6],G=s[7],Q=s[8],oe=s[9],ve=s[10],Ve=s[11],a[0]=m=s[0],a[1]=_,a[2]=S,a[3]=A,a[4]=P,a[5]=D,a[6]=U,a[7]=G,a[8]=Q,a[9]=oe,a[10]=ve,a[11]=Ve,a[12]=m*Ge+P*lt+Q*Je+s[12],a[13]=_*Ge+D*lt+oe*Je+s[13],a[14]=S*Ge+U*lt+ve*Je+s[14],a[15]=A*Ge+G*lt+Ve*Je+s[15]),a},y.triggerPluginCompletionEvent=Ef,y.uniqueId=Qt,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=wu,y.validateStyle=gs,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=xu,y.version="1.13.2",y.warnOnce=dt,y.webpSupported=Vn,y.window=Se,y.wrap=_r}),he(["./shared"],function(y){"use strict";function Pe(K){var re=typeof K;if(re==="number"||re==="boolean"||re==="string"||K==null)return JSON.stringify(K);if(Array.isArray(K)){for(var fe="[",we=0,Ze=K;we<Ze.length;we+=1)fe+=Pe(Ze[we])+",";return fe+"]"}for(var tt=Object.keys(K).sort(),pt="{",_e=0;_e<tt.length;_e++)pt+=JSON.stringify(tt[_e])+":"+Pe(K[tt[_e]])+",";return pt+"}"}function q(K){for(var re="",fe=0,we=y.refProperties;fe<we.length;fe+=1)re+="/"+Pe(K[we[fe]]);return re}var Ce=function(K){this.keyCache={},K&&this.replace(K)};Ce.prototype.replace=function(K){this._layerConfigs={},this._layers={},this.update(K,[])},Ce.prototype.update=function(K,re){for(var fe=this,we=0,Ze=K;we<Ze.length;we+=1){var tt=Ze[we];this._layerConfigs[tt.id]=tt;var pt=this._layers[tt.id]=y.createStyleLayer(tt);pt._featureFilter=y.featureFilter(pt.filter),this.keyCache[tt.id]&&delete this.keyCache[tt.id]}for(var _e=0,We=re;_e<We.length;_e+=1){var Bt=We[_e];delete this.keyCache[Bt],delete this._layerConfigs[Bt],delete this._layers[Bt]}this.familiesBySource={};for(var Rr=0,Kt=function(nr,yt){for(var xi={},dn=0;dn<nr.length;dn++){var Pi=yt&&yt[nr[dn].id]||q(nr[dn]);yt&&(yt[nr[dn].id]=Pi);var ua=xi[Pi];ua||(ua=xi[Pi]=[]),ua.push(nr[dn])}var vt=[];for(var _t in xi)vt.push(xi[_t]);return vt}(y.values(this._layerConfigs),this.keyCache);Rr<Kt.length;Rr+=1){var er=Kt[Rr].map(function(nr){return fe._layers[nr.id]}),Or=er[0];if(Or.visibility!=="none"){var On=Or.source||"",Cn=this.familiesBySource[On];Cn||(Cn=this.familiesBySource[On]={});var Gt=Or.sourceLayer||"_geojsonTileLayer",En=Cn[Gt];En||(En=Cn[Gt]=[]),En.push(er)}}};var pe=function(K){var re={},fe=[];for(var we in K){var Ze=K[we],tt=re[we]={};for(var pt in Ze){var _e=Ze[+pt];if(_e&&_e.bitmap.width!==0&&_e.bitmap.height!==0){var We={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};fe.push(We),tt[pt]={rect:We,metrics:_e.metrics}}}}var Bt=y.potpack(fe),Rr=new y.AlphaImage({width:Bt.w||1,height:Bt.h||1});for(var Kt in K){var er=K[Kt];for(var Or in er){var On=er[+Or];if(On&&On.bitmap.width!==0&&On.bitmap.height!==0){var Cn=re[Kt][Or].rect;y.AlphaImage.copy(On.bitmap,Rr,{x:0,y:0},{x:Cn.x+1,y:Cn.y+1},On.bitmap)}}}this.image=Rr,this.positions=re};y.register("GlyphAtlas",pe);var Ke=function(K){this.tileID=new y.OverscaledTileID(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId};function Se(K,re,fe){for(var we=new y.EvaluationParameters(re),Ze=0,tt=K;Ze<tt.length;Ze+=1)tt[Ze].recalculate(we,fe)}function ot(K,re){var fe=y.getArrayBuffer(K.request,function(we,Ze,tt,pt){we?re(we):Ze&&re(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Ze)),rawData:Ze,cacheControl:tt,expires:pt})});return function(){fe.cancel(),re()}}Ke.prototype.parse=function(K,re,fe,we,Ze){var tt=this;this.status="parsing",this.data=K,this.collisionBoxArray=new y.CollisionBoxArray;var pt=new y.DictionaryCoder(Object.keys(K.layers).sort()),_e=new y.FeatureIndex(this.tileID,this.promoteId);_e.bucketLayerIDs=[];var We,Bt,Rr,Kt,er={},Or={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe},On=re.familiesBySource[this.source];for(var Cn in On){var Gt=K.layers[Cn];if(Gt){Gt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+Cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var En=pt.encode(Cn),nr=[],yt=0;yt<Gt.length;yt++){var xi=Gt.feature(yt),dn=_e.getId(xi,Cn);nr.push({feature:xi,id:dn,index:yt,sourceLayerIndex:En})}for(var Pi=0,ua=On[Cn];Pi<ua.length;Pi+=1){var vt=ua[Pi],_t=vt[0];_t.minzoom&&this.zoom<Math.floor(_t.minzoom)||_t.maxzoom&&this.zoom>=_t.maxzoom||_t.visibility!=="none"&&(Se(vt,this.zoom,fe),(er[_t.id]=_t.createBucket({index:_e.bucketLayerIDs.length,layers:vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:En,sourceID:this.source})).populate(nr,Or,this.tileID.canonical),_e.bucketLayerIDs.push(vt.map(function(la){return la.id})))}}}var Ii=y.mapObject(Or.glyphDependencies,function(la){return Object.keys(la).map(Number)});Object.keys(Ii).length?we.send("getGlyphs",{uid:this.uid,stacks:Ii},function(la,Fi){We||(We=la,Bt=Fi,Qi.call(tt))}):Bt={};var ui=Object.keys(Or.iconDependencies);ui.length?we.send("getImages",{icons:ui,source:this.source,tileID:this.tileID,type:"icons"},function(la,Fi){We||(We=la,Rr=Fi,Qi.call(tt))}):Rr={};var Ki=Object.keys(Or.patternDependencies);function Qi(){if(We)return Ze(We);if(Bt&&Rr&&Kt){var la=new pe(Bt),Fi=new y.ImageAtlas(Rr,Kt);for(var pr in er){var wr=er[pr];wr instanceof y.SymbolBucket?(Se(wr.layers,this.zoom,fe),y.performSymbolLayout(wr,Bt,la.positions,Rr,Fi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):wr.hasPattern&&(wr instanceof y.LineBucket||wr instanceof y.FillBucket||wr instanceof y.FillExtrusionBucket)&&(Se(wr.layers,this.zoom,fe),wr.addFeatures(Or,this.tileID.canonical,Fi.patternPositions))}this.status="done",Ze(null,{buckets:y.values(er).filter(function(Ye){return!Ye.isEmpty()}),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:la.image,imageAtlas:Fi,glyphMap:this.returnDependencies?Bt:null,iconMap:this.returnDependencies?Rr:null,glyphPositions:this.returnDependencies?la.positions:null})}}Ki.length?we.send("getImages",{icons:Ki,source:this.source,tileID:this.tileID,type:"patterns"},function(la,Fi){We||(We=la,Kt=Fi,Qi.call(tt))}):Kt={},Qi.call(this)};var mt=function(K,re,fe,we){this.actor=K,this.layerIndex=re,this.availableImages=fe,this.loadVectorData=we||ot,this.loading={},this.loaded={}};mt.prototype.loadTile=function(K,re){var fe=this,we=K.uid;this.loading||(this.loading={});var Ze=!!(K&&K.request&&K.request.collectResourceTiming)&&new y.RequestPerformance(K.request),tt=this.loading[we]=new Ke(K);tt.abort=this.loadVectorData(K,function(pt,_e){if(delete fe.loading[we],pt||!_e)return tt.status="done",fe.loaded[we]=tt,re(pt);var We=_e.rawData,Bt={};_e.expires&&(Bt.expires=_e.expires),_e.cacheControl&&(Bt.cacheControl=_e.cacheControl);var Rr={};if(Ze){var Kt=Ze.finish();Kt&&(Rr.resourceTiming=JSON.parse(JSON.stringify(Kt)))}tt.vectorTile=_e.vectorTile,tt.parse(_e.vectorTile,fe.layerIndex,fe.availableImages,fe.actor,function(er,Or){if(er||!Or)return re(er);re(null,y.extend({rawTileData:We.slice(0)},Or,Bt,Rr))}),fe.loaded=fe.loaded||{},fe.loaded[we]=tt})},mt.prototype.reloadTile=function(K,re){var fe=this,we=this.loaded,Ze=K.uid,tt=this;if(we&&we[Ze]){var pt=we[Ze];pt.showCollisionBoxes=K.showCollisionBoxes;var _e=function(We,Bt){var Rr=pt.reloadCallback;Rr&&(delete pt.reloadCallback,pt.parse(pt.vectorTile,tt.layerIndex,fe.availableImages,tt.actor,Rr)),re(We,Bt)};pt.status==="parsing"?pt.reloadCallback=_e:pt.status==="done"&&(pt.vectorTile?pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,_e):_e())}},mt.prototype.abortTile=function(K,re){var fe=this.loading,we=K.uid;fe&&fe[we]&&fe[we].abort&&(fe[we].abort(),delete fe[we]),re()},mt.prototype.removeTile=function(K,re){var fe=this.loaded,we=K.uid;fe&&fe[we]&&delete fe[we],re()};var bt=y.window.ImageBitmap,Dt=function(){this.loaded={}};function _r(K,re){if(K.length!==0){Nt(K[0],re);for(var fe=1;fe<K.length;fe++)Nt(K[fe],!re)}}function Nt(K,re){for(var fe=0,we=0,Ze=K.length,tt=Ze-1;we<Ze;tt=we++)fe+=(K[we][0]-K[tt][0])*(K[tt][1]+K[we][1]);fe>=0!=!!re&&K.reverse()}Dt.prototype.loadTile=function(K,re){var fe=K.uid,we=K.encoding,Ze=K.rawImageData,tt=bt&&Ze instanceof bt?this.getImageData(Ze):Ze,pt=new y.DEMData(fe,tt,we);this.loaded=this.loaded||{},this.loaded[fe]=pt,re(null,pt)},Dt.prototype.getImageData=function(K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);var re=this.offscreenCanvasContext.getImageData(-1,-1,K.width+2,K.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:re.width,height:re.height},re.data)},Dt.prototype.removeTile=function(K){var re=this.loaded,fe=K.uid;re&&re[fe]&&delete re[fe]};var gr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Qt=function(K){this._feature=K,this.extent=y.EXTENT,this.type=K.type,this.properties=K.tags,"id"in K&&!isNaN(K.id)&&(this.id=parseInt(K.id,10))};Qt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var K=[],re=0,fe=this._feature.geometry;re<fe.length;re+=1){var we=fe[re];K.push([new y.Point$1(we[0],we[1])])}return K}for(var Ze=[],tt=0,pt=this._feature.geometry;tt<pt.length;tt+=1){for(var _e=[],We=0,Bt=pt[tt];We<Bt.length;We+=1){var Rr=Bt[We];_e.push(new y.Point$1(Rr[0],Rr[1]))}Ze.push(_e)}return Ze},Qt.prototype.toGeoJSON=function(K,re,fe){return gr.call(this,K,re,fe)};var Pt=function(K){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=K.length,this._features=K};Pt.prototype.feature=function(K){return new Qt(this._features[K])};var Ft=y.vectorTile.VectorTileFeature,xr=ee;function ee(K,re){this.options=re||{},this.features=K,this.length=K.length}function sr(K,re){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=re||4096}ee.prototype.feature=function(K){return new sr(this.features[K],this.options.extent)},sr.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var re=0;re<K.length;re++){for(var fe=K[re],we=[],Ze=0;Ze<fe.length;Ze++)we.push(new y.Point$1(fe[Ze][0],fe[Ze][1]));this.geometry.push(we)}return this.geometry},sr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,re=1/0,fe=-1/0,we=1/0,Ze=-1/0,tt=0;tt<K.length;tt++)for(var pt=K[tt],_e=0;_e<pt.length;_e++){var We=pt[_e];re=Math.min(re,We.x),fe=Math.max(fe,We.x),we=Math.min(we,We.y),Ze=Math.max(Ze,We.y)}return[re,we,fe,Ze]},sr.prototype.toGeoJSON=Ft.prototype.toGeoJSON;var Tt=jt,ht=xr;function jt(K){var re=new y.pbf;return function(fe,we){for(var Ze in fe.layers)we.writeMessage(3,dt,fe.layers[Ze])}(K,re),re.finish()}function dt(K,re){var fe;re.writeVarintField(15,K.version||1),re.writeStringField(1,K.name||""),re.writeVarintField(5,K.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(fe=0;fe<K.length;fe++)we.feature=K.feature(fe),re.writeMessage(2,lr,we);var Ze=we.keys;for(fe=0;fe<Ze.length;fe++)re.writeStringField(3,Ze[fe]);var tt=we.values;for(fe=0;fe<tt.length;fe++)re.writeMessage(4,Y,tt[fe])}function lr(K,re){var fe=K.feature;fe.id!==void 0&&re.writeVarintField(1,fe.id),re.writeMessage(2,jr,K),re.writeVarintField(3,fe.type),re.writeMessage(4,W,fe)}function jr(K,re){var fe=K.feature,we=K.keys,Ze=K.values,tt=K.keycache,pt=K.valuecache;for(var _e in fe.properties){var We=tt[_e];We===void 0&&(we.push(_e),tt[_e]=We=we.length-1),re.writeVarint(We);var Bt=fe.properties[_e],Rr=typeof Bt;Rr!=="string"&&Rr!=="boolean"&&Rr!=="number"&&(Bt=JSON.stringify(Bt));var Kt=Rr+":"+Bt,er=pt[Kt];er===void 0&&(Ze.push(Bt),pt[Kt]=er=Ze.length-1),re.writeVarint(er)}}function ue(K,re){return(re<<3)+(7&K)}function He(K){return K<<1^K>>31}function W(K,re){for(var fe=K.loadGeometry(),we=K.type,Ze=0,tt=0,pt=fe.length,_e=0;_e<pt;_e++){var We=fe[_e],Bt=1;we===1&&(Bt=We.length),re.writeVarint(ue(1,Bt));for(var Rr=we===3?We.length-1:We.length,Kt=0;Kt<Rr;Kt++){Kt===1&&we!==1&&re.writeVarint(ue(2,Rr-1));var er=We[Kt].x-Ze,Or=We[Kt].y-tt;re.writeVarint(He(er)),re.writeVarint(He(Or)),Ze+=er,tt+=Or}we===3&&re.writeVarint(ue(7,1))}}function Y(K,re){var fe=typeof K;fe==="string"?re.writeStringField(1,K):fe==="boolean"?re.writeBooleanField(7,K):fe==="number"&&(K%1!=0?re.writeDoubleField(3,K):K<0?re.writeSVarintField(6,K):re.writeVarintField(5,K))}function Re(K,re,fe,we){gt(K,fe,we),gt(re,2*fe,2*we),gt(re,2*fe+1,2*we+1)}function gt(K,re,fe){var we=K[re];K[re]=K[fe],K[fe]=we}function wt(K,re,fe,we){var Ze=K-fe,tt=re-we;return Ze*Ze+tt*tt}Tt.fromVectorTileJs=jt,Tt.fromGeojsonVt=function(K,re){re=re||{};var fe={};for(var we in K)fe[we]=new xr(K[we].features,re),fe[we].name=we,fe[we].version=re.version,fe[we].extent=re.extent;return jt({layers:fe})},Tt.GeoJSONWrapper=ht;var qt=function(K){return K[0]},fr=function(K){return K[1]},br=function(K,re,fe,we,Ze){re===void 0&&(re=qt),fe===void 0&&(fe=fr),we===void 0&&(we=64),Ze===void 0&&(Ze=Float64Array),this.nodeSize=we,this.points=K;for(var tt=K.length<65536?Uint16Array:Uint32Array,pt=this.ids=new tt(K.length),_e=this.coords=new Ze(2*K.length),We=0;We<K.length;We++)pt[We]=We,_e[2*We]=re(K[We]),_e[2*We+1]=fe(K[We]);(function Bt(Rr,Kt,er,Or,On,Cn){if(!(On-Or<=er)){var Gt=Or+On>>1;(function En(nr,yt,xi,dn,Pi,ua){for(;Pi>dn;){if(Pi-dn>600){var vt=Pi-dn+1,_t=xi-dn+1,Ii=Math.log(vt),ui=.5*Math.exp(2*Ii/3),Ki=.5*Math.sqrt(Ii*ui*(vt-ui)/vt)*(_t-vt/2<0?-1:1);En(nr,yt,xi,Math.max(dn,Math.floor(xi-_t*ui/vt+Ki)),Math.min(Pi,Math.floor(xi+(vt-_t)*ui/vt+Ki)),ua)}var Qi=yt[2*xi+ua],la=dn,Fi=Pi;for(Re(nr,yt,dn,xi),yt[2*Pi+ua]>Qi&&Re(nr,yt,dn,Pi);la<Fi;){for(Re(nr,yt,la,Fi),la++,Fi--;yt[2*la+ua]<Qi;)la++;for(;yt[2*Fi+ua]>Qi;)Fi--}yt[2*dn+ua]===Qi?Re(nr,yt,dn,Fi):Re(nr,yt,++Fi,Pi),Fi<=xi&&(dn=Fi+1),xi<=Fi&&(Pi=Fi-1)}})(Rr,Kt,Gt,Or,On,Cn%2),Bt(Rr,Kt,er,Or,Gt-1,Cn+1),Bt(Rr,Kt,er,Gt+1,On,Cn+1)}})(pt,_e,we,0,pt.length-1,0)};br.prototype.range=function(K,re,fe,we){return function(Ze,tt,pt,_e,We,Bt,Rr){for(var Kt,er,Or=[0,Ze.length-1,0],On=[];Or.length;){var Cn=Or.pop(),Gt=Or.pop(),En=Or.pop();if(Gt-En<=Rr)for(var nr=En;nr<=Gt;nr++)er=tt[2*nr+1],(Kt=tt[2*nr])>=pt&&Kt<=We&&er>=_e&&er<=Bt&&On.push(Ze[nr]);else{var yt=Math.floor((En+Gt)/2);er=tt[2*yt+1],(Kt=tt[2*yt])>=pt&&Kt<=We&&er>=_e&&er<=Bt&&On.push(Ze[yt]);var xi=(Cn+1)%2;(Cn===0?pt<=Kt:_e<=er)&&(Or.push(En),Or.push(yt-1),Or.push(xi)),(Cn===0?We>=Kt:Bt>=er)&&(Or.push(yt+1),Or.push(Gt),Or.push(xi))}}return On}(this.ids,this.coords,K,re,fe,we,this.nodeSize)},br.prototype.within=function(K,re,fe){return function(we,Ze,tt,pt,_e,We){for(var Bt=[0,we.length-1,0],Rr=[],Kt=_e*_e;Bt.length;){var er=Bt.pop(),Or=Bt.pop(),On=Bt.pop();if(Or-On<=We)for(var Cn=On;Cn<=Or;Cn++)wt(Ze[2*Cn],Ze[2*Cn+1],tt,pt)<=Kt&&Rr.push(we[Cn]);else{var Gt=Math.floor((On+Or)/2),En=Ze[2*Gt],nr=Ze[2*Gt+1];wt(En,nr,tt,pt)<=Kt&&Rr.push(we[Gt]);var yt=(er+1)%2;(er===0?tt-_e<=En:pt-_e<=nr)&&(Bt.push(On),Bt.push(Gt-1),Bt.push(yt)),(er===0?tt+_e>=En:pt+_e>=nr)&&(Bt.push(Gt+1),Bt.push(Or),Bt.push(yt))}}return Rr}(this.ids,this.coords,K,re,fe,this.nodeSize)};var bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(K){return K}},en=function(K){this.options=Vi(Object.create(bn),K),this.trees=new Array(this.options.maxZoom+1)};function Ci(K,re,fe,we,Ze){return{x:K,y:re,zoom:1/0,id:fe,parentId:-1,numPoints:we,properties:Ze}}function Wn(K,re){var fe=K.geometry.coordinates,we=fe[1];return{x:Si(fe[0]),y:ci(we),zoom:1/0,index:re,parentId:-1}}function Vn(K){return{type:"Feature",id:K.id,properties:va(K),geometry:{type:"Point",coordinates:[(we=K.x,360*(we-.5)),(re=K.y,fe=(180-360*re)*Math.PI/180,360*Math.atan(Math.exp(fe))/Math.PI-90)]}};var re,fe,we}function va(K){var re=K.numPoints,fe=re>=1e4?Math.round(re/1e3)+"k":re>=1e3?Math.round(re/100)/10+"k":re;return Vi(Vi({},K.properties),{cluster:!0,cluster_id:K.id,point_count:re,point_count_abbreviated:fe})}function Si(K){return K/360+.5}function ci(K){var re=Math.sin(K*Math.PI/180),fe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return fe<0?0:fe>1?1:fe}function Vi(K,re){for(var fe in re)K[fe]=re[fe];return K}function zi(K){return K.x}function _i(K){return K.y}function $n(K,re,fe,we,Ze,tt){var pt=Ze-fe,_e=tt-we;if(pt!==0||_e!==0){var We=((K-fe)*pt+(re-we)*_e)/(pt*pt+_e*_e);We>1?(fe=Ze,we=tt):We>0&&(fe+=pt*We,we+=_e*We)}return(pt=K-fe)*pt+(_e=re-we)*_e}function ii(K,re,fe,we){var Ze={id:K===void 0?null:K,type:re,geometry:fe,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(tt){var pt=tt.geometry,_e=tt.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Co(tt,pt);else if(_e==="Polygon"||_e==="MultiLineString")for(var We=0;We<pt.length;We++)Co(tt,pt[We]);else if(_e==="MultiPolygon")for(We=0;We<pt.length;We++)for(var Bt=0;Bt<pt[We].length;Bt++)Co(tt,pt[We][Bt])}(Ze),Ze}function Co(K,re){for(var fe=0;fe<re.length;fe+=3)K.minX=Math.min(K.minX,re[fe]),K.minY=Math.min(K.minY,re[fe+1]),K.maxX=Math.max(K.maxX,re[fe]),K.maxY=Math.max(K.maxY,re[fe+1])}function Ba(K,re,fe,we){if(re.geometry){var Ze=re.geometry.coordinates,tt=re.geometry.type,pt=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2),_e=[],We=re.id;if(fe.promoteId?We=re.properties[fe.promoteId]:fe.generateId&&(We=we||0),tt==="Point")ya(Ze,_e);else if(tt==="MultiPoint")for(var Bt=0;Bt<Ze.length;Bt++)ya(Ze[Bt],_e);else if(tt==="LineString")Et(Ze,_e,pt,!1);else if(tt==="MultiLineString"){if(fe.lineMetrics){for(Bt=0;Bt<Ze.length;Bt++)Et(Ze[Bt],_e=[],pt,!1),K.push(ii(We,"LineString",_e,re.properties));return}de(Ze,_e,pt,!1)}else if(tt==="Polygon")de(Ze,_e,pt,!0);else{if(tt!=="MultiPolygon"){if(tt==="GeometryCollection"){for(Bt=0;Bt<re.geometry.geometries.length;Bt++)Ba(K,{id:We,geometry:re.geometry.geometries[Bt],properties:re.properties},fe,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Bt=0;Bt<Ze.length;Bt++){var Rr=[];de(Ze[Bt],Rr,pt,!0),_e.push(Rr)}}K.push(ii(We,tt,_e,re.properties))}}function ya(K,re){re.push(ae(K[0])),re.push(xe(K[1])),re.push(0)}function Et(K,re,fe,we){for(var Ze,tt,pt=0,_e=0;_e<K.length;_e++){var We=ae(K[_e][0]),Bt=xe(K[_e][1]);re.push(We),re.push(Bt),re.push(0),_e>0&&(pt+=we?(Ze*Bt-We*tt)/2:Math.sqrt(Math.pow(We-Ze,2)+Math.pow(Bt-tt,2))),Ze=We,tt=Bt}var Rr=re.length-3;re[2]=1,function Kt(er,Or,On,Cn){for(var Gt,En=Cn,nr=On-Or>>1,yt=On-Or,xi=er[Or],dn=er[Or+1],Pi=er[On],ua=er[On+1],vt=Or+3;vt<On;vt+=3){var _t=$n(er[vt],er[vt+1],xi,dn,Pi,ua);if(_t>En)Gt=vt,En=_t;else if(_t===En){var Ii=Math.abs(vt-nr);Ii<yt&&(Gt=vt,yt=Ii)}}En>Cn&&(Gt-Or>3&&Kt(er,Or,Gt,Cn),er[Gt+2]=En,On-Gt>3&&Kt(er,Gt,On,Cn))}(re,0,Rr,fe),re[Rr+2]=1,re.size=Math.abs(pt),re.start=0,re.end=re.size}function de(K,re,fe,we){for(var Ze=0;Ze<K.length;Ze++){var tt=[];Et(K[Ze],tt,fe,we),re.push(tt)}}function ae(K){return K/360+.5}function xe(K){var re=Math.sin(K*Math.PI/180),fe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return fe<0?0:fe>1?1:fe}function N(K,re,fe,we,Ze,tt,pt,_e){if(we/=re,tt>=(fe/=re)&&pt<we)return K;if(pt<fe||tt>=we)return null;for(var We=[],Bt=0;Bt<K.length;Bt++){var Rr=K[Bt],Kt=Rr.geometry,er=Rr.type,Or=Ze===0?Rr.minX:Rr.minY,On=Ze===0?Rr.maxX:Rr.maxY;if(Or>=fe&&On<we)We.push(Rr);else if(!(On<fe||Or>=we)){var Cn=[];if(er==="Point"||er==="MultiPoint")Qe(Kt,Cn,fe,we,Ze);else if(er==="LineString")Wt(Kt,Cn,fe,we,Ze,!1,_e.lineMetrics);else if(er==="MultiLineString")qe(Kt,Cn,fe,we,Ze,!1);else if(er==="Polygon")qe(Kt,Cn,fe,we,Ze,!0);else if(er==="MultiPolygon")for(var Gt=0;Gt<Kt.length;Gt++){var En=[];qe(Kt[Gt],En,fe,we,Ze,!0),En.length&&Cn.push(En)}if(Cn.length){if(_e.lineMetrics&&er==="LineString"){for(Gt=0;Gt<Cn.length;Gt++)We.push(ii(Rr.id,er,Cn[Gt],Rr.tags));continue}er!=="LineString"&&er!=="MultiLineString"||(Cn.length===1?(er="LineString",Cn=Cn[0]):er="MultiLineString"),er!=="Point"&&er!=="MultiPoint"||(er=Cn.length===3?"Point":"MultiPoint"),We.push(ii(Rr.id,er,Cn,Rr.tags))}}}return We.length?We:null}function Qe(K,re,fe,we,Ze){for(var tt=0;tt<K.length;tt+=3){var pt=K[tt+Ze];pt>=fe&&pt<=we&&(re.push(K[tt]),re.push(K[tt+1]),re.push(K[tt+2]))}}function Wt(K,re,fe,we,Ze,tt,pt){for(var _e,We,Bt=Dr(K),Rr=Ze===0?hr:kr,Kt=K.start,er=0;er<K.length-3;er+=3){var Or=K[er],On=K[er+1],Cn=K[er+2],Gt=K[er+3],En=K[er+4],nr=Ze===0?Or:On,yt=Ze===0?Gt:En,xi=!1;pt&&(_e=Math.sqrt(Math.pow(Or-Gt,2)+Math.pow(On-En,2))),nr<fe?yt>fe&&(We=Rr(Bt,Or,On,Gt,En,fe),pt&&(Bt.start=Kt+_e*We)):nr>we?yt<we&&(We=Rr(Bt,Or,On,Gt,En,we),pt&&(Bt.start=Kt+_e*We)):kt(Bt,Or,On,Cn),yt<fe&&nr>=fe&&(We=Rr(Bt,Or,On,Gt,En,fe),xi=!0),yt>we&&nr<=we&&(We=Rr(Bt,Or,On,Gt,En,we),xi=!0),!tt&&xi&&(pt&&(Bt.end=Kt+_e*We),re.push(Bt),Bt=Dr(K)),pt&&(Kt+=_e)}var dn=K.length-3;Or=K[dn],On=K[dn+1],Cn=K[dn+2],(nr=Ze===0?Or:On)>=fe&&nr<=we&&kt(Bt,Or,On,Cn),dn=Bt.length-3,tt&&dn>=3&&(Bt[dn]!==Bt[0]||Bt[dn+1]!==Bt[1])&&kt(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&re.push(Bt)}function Dr(K){var re=[];return re.size=K.size,re.start=K.start,re.end=K.end,re}function qe(K,re,fe,we,Ze,tt){for(var pt=0;pt<K.length;pt++)Wt(K[pt],re,fe,we,Ze,tt,!1)}function kt(K,re,fe,we){K.push(re),K.push(fe),K.push(we)}function hr(K,re,fe,we,Ze,tt){var pt=(tt-re)/(we-re);return K.push(tt),K.push(fe+(Ze-fe)*pt),K.push(1),pt}function kr(K,re,fe,we,Ze,tt){var pt=(tt-fe)/(Ze-fe);return K.push(re+(we-re)*pt),K.push(tt),K.push(1),pt}function Hr(K,re){for(var fe=[],we=0;we<K.length;we++){var Ze,tt=K[we],pt=tt.type;if(pt==="Point"||pt==="MultiPoint"||pt==="LineString")Ze=qr(tt.geometry,re);else if(pt==="MultiLineString"||pt==="Polygon"){Ze=[];for(var _e=0;_e<tt.geometry.length;_e++)Ze.push(qr(tt.geometry[_e],re))}else if(pt==="MultiPolygon")for(Ze=[],_e=0;_e<tt.geometry.length;_e++){for(var We=[],Bt=0;Bt<tt.geometry[_e].length;Bt++)We.push(qr(tt.geometry[_e][Bt],re));Ze.push(We)}fe.push(ii(tt.id,pt,Ze,tt.tags))}return fe}function qr(K,re){var fe=[];fe.size=K.size,K.start!==void 0&&(fe.start=K.start,fe.end=K.end);for(var we=0;we<K.length;we+=3)fe.push(K[we]+re,K[we+1],K[we+2]);return fe}function Hn(K,re){if(K.transformed)return K;var fe,we,Ze,tt=1<<K.z,pt=K.x,_e=K.y;for(fe=0;fe<K.features.length;fe++){var We=K.features[fe],Bt=We.geometry,Rr=We.type;if(We.geometry=[],Rr===1)for(we=0;we<Bt.length;we+=2)We.geometry.push(Bn(Bt[we],Bt[we+1],re,tt,pt,_e));else for(we=0;we<Bt.length;we++){var Kt=[];for(Ze=0;Ze<Bt[we].length;Ze+=2)Kt.push(Bn(Bt[we][Ze],Bt[we][Ze+1],re,tt,pt,_e));We.geometry.push(Kt)}}return K.transformed=!0,K}function Bn(K,re,fe,we,Ze,tt){return[Math.round(fe*(K*we-Ze)),Math.round(fe*(re*we-tt))]}function Kr(K,re,fe,we,Ze){for(var tt=re===Ze.maxZoom?0:Ze.tolerance/((1<<re)*Ze.extent),pt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:fe,y:we,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<K.length;_e++){pt.numFeatures++,fi(pt,K[_e],tt,Ze);var We=K[_e].minX,Bt=K[_e].minY,Rr=K[_e].maxX,Kt=K[_e].maxY;We<pt.minX&&(pt.minX=We),Bt<pt.minY&&(pt.minY=Bt),Rr>pt.maxX&&(pt.maxX=Rr),Kt>pt.maxY&&(pt.maxY=Kt)}return pt}function fi(K,re,fe,we){var Ze=re.geometry,tt=re.type,pt=[];if(tt==="Point"||tt==="MultiPoint")for(var _e=0;_e<Ze.length;_e+=3)pt.push(Ze[_e]),pt.push(Ze[_e+1]),K.numPoints++,K.numSimplified++;else if(tt==="LineString")ri(pt,Ze,K,fe,!1,!1);else if(tt==="MultiLineString"||tt==="Polygon")for(_e=0;_e<Ze.length;_e++)ri(pt,Ze[_e],K,fe,tt==="Polygon",_e===0);else if(tt==="MultiPolygon")for(var We=0;We<Ze.length;We++){var Bt=Ze[We];for(_e=0;_e<Bt.length;_e++)ri(pt,Bt[_e],K,fe,!0,_e===0)}if(pt.length){var Rr=re.tags||null;if(tt==="LineString"&&we.lineMetrics){for(var Kt in Rr={},re.tags)Rr[Kt]=re.tags[Kt];Rr.mapbox_clip_start=Ze.start/Ze.size,Rr.mapbox_clip_end=Ze.end/Ze.size}var er={geometry:pt,type:tt==="Polygon"||tt==="MultiPolygon"?3:tt==="LineString"||tt==="MultiLineString"?2:1,tags:Rr};re.id!==null&&(er.id=re.id),K.features.push(er)}}function ri(K,re,fe,we,Ze,tt){var pt=we*we;if(we>0&&re.size<(Ze?pt:we))fe.numPoints+=re.length/3;else{for(var _e=[],We=0;We<re.length;We+=3)(we===0||re[We+2]>pt)&&(fe.numSimplified++,_e.push(re[We]),_e.push(re[We+1])),fe.numPoints++;Ze&&function(Bt,Rr){for(var Kt=0,er=0,Or=Bt.length,On=Or-2;er<Or;On=er,er+=2)Kt+=(Bt[er]-Bt[On])*(Bt[er+1]+Bt[On+1]);if(Kt>0===Rr)for(er=0,Or=Bt.length;er<Or/2;er+=2){var Cn=Bt[er],Gt=Bt[er+1];Bt[er]=Bt[Or-2-er],Bt[er+1]=Bt[Or-1-er],Bt[Or-2-er]=Cn,Bt[Or-1-er]=Gt}}(_e,tt),K.push(_e)}}function sa(K,re){var fe=(re=this.options=function(Ze,tt){for(var pt in tt)Ze[pt]=tt[pt];return Ze}(Object.create(this.options),re)).debug;if(fe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(Ze,tt){var pt=[];if(Ze.type==="FeatureCollection")for(var _e=0;_e<Ze.features.length;_e++)Ba(pt,Ze.features[_e],tt,_e);else Ba(pt,Ze.type==="Feature"?Ze:{geometry:Ze},tt);return pt}(K,re);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=function(Ze,tt){var pt=tt.buffer/tt.extent,_e=Ze,We=N(Ze,1,-1-pt,pt,0,-1,2,tt),Bt=N(Ze,1,1-pt,2+pt,0,-1,2,tt);return(We||Bt)&&(_e=N(Ze,1,-pt,1+pt,0,-1,2,tt)||[],We&&(_e=Hr(We,1).concat(_e)),Bt&&(_e=_e.concat(Hr(Bt,-1)))),_e}(we,re)).length&&this.splitTile(we,0,0,0),fe&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wa(K,re,fe){return 32*((1<<K)*fe+re)+K}function Na(K,re){var fe=K.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);var we=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!we)return re(null,null);var Ze=new Pt(we.features),tt=Tt(Ze);tt.byteOffset===0&&tt.byteLength===tt.buffer.byteLength||(tt=new Uint8Array(tt)),re(null,{vectorTile:Ze,rawData:tt.buffer})}en.prototype.load=function(K){var re=this.options,fe=re.log,we=re.minZoom,Ze=re.maxZoom,tt=re.nodeSize;fe&&console.time("total time");var pt="prepare "+K.length+" points";fe&&console.time(pt),this.points=K;for(var _e=[],We=0;We<K.length;We++)K[We].geometry&&_e.push(Wn(K[We],We));this.trees[Ze+1]=new br(_e,zi,_i,tt,Float32Array),fe&&console.timeEnd(pt);for(var Bt=Ze;Bt>=we;Bt--){var Rr=+Date.now();_e=this._cluster(_e,Bt),this.trees[Bt]=new br(_e,zi,_i,tt,Float32Array),fe&&console.log("z%d: %d clusters in %dms",Bt,_e.length,+Date.now()-Rr)}return fe&&console.timeEnd("total time"),this},en.prototype.getClusters=function(K,re){var fe=((K[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,K[1])),Ze=K[2]===180?180:((K[2]+180)%360+360)%360-180,tt=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)fe=-180,Ze=180;else if(fe>Ze){var pt=this.getClusters([fe,we,180,tt],re),_e=this.getClusters([-180,we,Ze,tt],re);return pt.concat(_e)}for(var We=this.trees[this._limitZoom(re)],Bt=[],Rr=0,Kt=We.range(Si(fe),ci(tt),Si(Ze),ci(we));Rr<Kt.length;Rr+=1){var er=We.points[Kt[Rr]];Bt.push(er.numPoints?Vn(er):this.points[er.index])}return Bt},en.prototype.getChildren=function(K){var re=this._getOriginId(K),fe=this._getOriginZoom(K),we="No cluster with the specified id.",Ze=this.trees[fe];if(!Ze)throw new Error(we);var tt=Ze.points[re];if(!tt)throw new Error(we);for(var pt=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),_e=[],We=0,Bt=Ze.within(tt.x,tt.y,pt);We<Bt.length;We+=1){var Rr=Ze.points[Bt[We]];Rr.parentId===K&&_e.push(Rr.numPoints?Vn(Rr):this.points[Rr.index])}if(_e.length===0)throw new Error(we);return _e},en.prototype.getLeaves=function(K,re,fe){var we=[];return this._appendLeaves(we,K,re=re||10,fe=fe||0,0),we},en.prototype.getTile=function(K,re,fe){var we=this.trees[this._limitZoom(K)],Ze=Math.pow(2,K),tt=this.options,pt=tt.radius/tt.extent,_e=(fe-pt)/Ze,We=(fe+1+pt)/Ze,Bt={features:[]};return this._addTileFeatures(we.range((re-pt)/Ze,_e,(re+1+pt)/Ze,We),we.points,re,fe,Ze,Bt),re===0&&this._addTileFeatures(we.range(1-pt/Ze,_e,1,We),we.points,Ze,fe,Ze,Bt),re===Ze-1&&this._addTileFeatures(we.range(0,_e,pt/Ze,We),we.points,-1,fe,Ze,Bt),Bt.features.length?Bt:null},en.prototype.getClusterExpansionZoom=function(K){for(var re=this._getOriginZoom(K)-1;re<=this.options.maxZoom;){var fe=this.getChildren(K);if(re++,fe.length!==1)break;K=fe[0].properties.cluster_id}return re},en.prototype._appendLeaves=function(K,re,fe,we,Ze){for(var tt=0,pt=this.getChildren(re);tt<pt.length;tt+=1){var _e=pt[tt],We=_e.properties;if(We&&We.cluster?Ze+We.point_count<=we?Ze+=We.point_count:Ze=this._appendLeaves(K,We.cluster_id,fe,we,Ze):Ze<we?Ze++:K.push(_e),K.length===fe)break}return Ze},en.prototype._addTileFeatures=function(K,re,fe,we,Ze,tt){for(var pt=0,_e=K;pt<_e.length;pt+=1){var We=re[_e[pt]],Bt=We.numPoints,Rr={type:1,geometry:[[Math.round(this.options.extent*(We.x*Ze-fe)),Math.round(this.options.extent*(We.y*Ze-we))]],tags:Bt?va(We):this.points[We.index].properties},Kt=void 0;Bt?Kt=We.id:this.options.generateId?Kt=We.index:this.points[We.index].id&&(Kt=this.points[We.index].id),Kt!==void 0&&(Rr.id=Kt),tt.features.push(Rr)}},en.prototype._limitZoom=function(K){return Math.max(this.options.minZoom,Math.min(+K,this.options.maxZoom+1))},en.prototype._cluster=function(K,re){for(var fe=[],we=this.options,Ze=we.reduce,tt=we.minPoints,pt=we.radius/(we.extent*Math.pow(2,re)),_e=0;_e<K.length;_e++){var We=K[_e];if(!(We.zoom<=re)){We.zoom=re;for(var Bt=this.trees[re+1],Rr=Bt.within(We.x,We.y,pt),Kt=We.numPoints||1,er=Kt,Or=0,On=Rr;Or<On.length;Or+=1){var Cn=Bt.points[On[Or]];Cn.zoom>re&&(er+=Cn.numPoints||1)}if(er>=tt){for(var Gt=We.x*Kt,En=We.y*Kt,nr=Ze&&Kt>1?this._map(We,!0):null,yt=(_e<<5)+(re+1)+this.points.length,xi=0,dn=Rr;xi<dn.length;xi+=1){var Pi=Bt.points[dn[xi]];if(!(Pi.zoom<=re)){Pi.zoom=re;var ua=Pi.numPoints||1;Gt+=Pi.x*ua,En+=Pi.y*ua,Pi.parentId=yt,Ze&&(nr||(nr=this._map(We,!0)),Ze(nr,this._map(Pi)))}}We.parentId=yt,fe.push(Ci(Gt/er,En/er,yt,er,nr))}else if(fe.push(We),er>1)for(var vt=0,_t=Rr;vt<_t.length;vt+=1){var Ii=Bt.points[_t[vt]];Ii.zoom<=re||(Ii.zoom=re,fe.push(Ii))}}}return fe},en.prototype._getOriginId=function(K){return K-this.points.length>>5},en.prototype._getOriginZoom=function(K){return(K-this.points.length)%32},en.prototype._map=function(K,re){if(K.numPoints)return re?Vi({},K.properties):K.properties;var fe=this.points[K.index].properties,we=this.options.map(fe);return re&&we===fe?Vi({},we):we},sa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sa.prototype.splitTile=function(K,re,fe,we,Ze,tt,pt){for(var _e=[K,re,fe,we],We=this.options,Bt=We.debug;_e.length;){we=_e.pop(),fe=_e.pop(),re=_e.pop(),K=_e.pop();var Rr=1<<re,Kt=wa(re,fe,we),er=this.tiles[Kt];if(!er&&(Bt>1&&console.time("creation"),er=this.tiles[Kt]=Kr(K,re,fe,we,We),this.tileCoords.push({z:re,x:fe,y:we}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,fe,we,er.numFeatures,er.numPoints,er.numSimplified),console.timeEnd("creation"));var Or="z"+re;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(er.source=K,Ze){if(re===We.maxZoom||re===Ze)continue;var On=1<<Ze-re;if(fe!==Math.floor(tt/On)||we!==Math.floor(pt/On))continue}else if(re===We.indexMaxZoom||er.numPoints<=We.indexMaxPoints)continue;if(er.source=null,K.length!==0){Bt>1&&console.time("clipping");var Cn,Gt,En,nr,yt,xi,dn=.5*We.buffer/We.extent,Pi=.5-dn,ua=.5+dn,vt=1+dn;Cn=Gt=En=nr=null,yt=N(K,Rr,fe-dn,fe+ua,0,er.minX,er.maxX,We),xi=N(K,Rr,fe+Pi,fe+vt,0,er.minX,er.maxX,We),K=null,yt&&(Cn=N(yt,Rr,we-dn,we+ua,1,er.minY,er.maxY,We),Gt=N(yt,Rr,we+Pi,we+vt,1,er.minY,er.maxY,We),yt=null),xi&&(En=N(xi,Rr,we-dn,we+ua,1,er.minY,er.maxY,We),nr=N(xi,Rr,we+Pi,we+vt,1,er.minY,er.maxY,We),xi=null),Bt>1&&console.timeEnd("clipping"),_e.push(Cn||[],re+1,2*fe,2*we),_e.push(Gt||[],re+1,2*fe,2*we+1),_e.push(En||[],re+1,2*fe+1,2*we),_e.push(nr||[],re+1,2*fe+1,2*we+1)}}},sa.prototype.getTile=function(K,re,fe){var we=this.options,Ze=we.extent,tt=we.debug;if(K<0||K>24)return null;var pt=1<<K,_e=wa(K,re=(re%pt+pt)%pt,fe);if(this.tiles[_e])return Hn(this.tiles[_e],Ze);tt>1&&console.log("drilling down to z%d-%d-%d",K,re,fe);for(var We,Bt=K,Rr=re,Kt=fe;!We&&Bt>0;)Bt--,Rr=Math.floor(Rr/2),Kt=Math.floor(Kt/2),We=this.tiles[wa(Bt,Rr,Kt)];return We&&We.source?(tt>1&&console.log("found parent tile z%d-%d-%d",Bt,Rr,Kt),tt>1&&console.time("drilling down"),this.splitTile(We.source,Bt,Rr,Kt,K,re,fe),tt>1&&console.timeEnd("drilling down"),this.tiles[_e]?Hn(this.tiles[_e],Ze):null):null};var _a=function(K){function re(fe,we,Ze,tt){K.call(this,fe,we,Ze,Na),tt&&(this.loadGeoJSON=tt)}return K&&(re.__proto__=K),(re.prototype=Object.create(K&&K.prototype)).constructor=re,re.prototype.loadData=function(fe,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=we,this._pendingLoadDataParams=fe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},re.prototype._loadData=function(){var fe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var we=this._pendingCallback,Ze=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var tt=!!(Ze&&Ze.request&&Ze.request.collectResourceTiming)&&new y.RequestPerformance(Ze.request);this.loadGeoJSON(Ze,function(pt,_e){if(pt||!_e)return we(pt);if(typeof _e!="object")return we(new Error("Input data given to '"+Ze.source+"' is not a valid GeoJSON object."));(function er(Or,On){var Cn,Gt=Or&&Or.type;if(Gt==="FeatureCollection")for(Cn=0;Cn<Or.features.length;Cn++)er(Or.features[Cn],On);else if(Gt==="GeometryCollection")for(Cn=0;Cn<Or.geometries.length;Cn++)er(Or.geometries[Cn],On);else if(Gt==="Feature")er(Or.geometry,On);else if(Gt==="Polygon")_r(Or.coordinates,On);else if(Gt==="MultiPolygon")for(Cn=0;Cn<Or.coordinates.length;Cn++)_r(Or.coordinates[Cn],On);return Or})(_e,!0);try{if(Ze.filter){var We=y.createExpression(Ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(function(er){return er.key+": "+er.message}).join(", "));var Bt=_e.features.filter(function(er){return We.value.evaluate({zoom:0},er)});_e={type:"FeatureCollection",features:Bt}}fe._geoJSONIndex=Ze.cluster?new en(function(er){var Or=er.superclusterOptions,On=er.clusterProperties;if(!On||!Or)return Or;for(var Cn={},Gt={},En={accumulated:null,zoom:0},nr={properties:null},yt=Object.keys(On),xi=0,dn=yt;xi<dn.length;xi+=1){var Pi=dn[xi],ua=On[Pi],vt=ua[0],_t=y.createExpression(ua[1]),Ii=y.createExpression(typeof vt=="string"?[vt,["accumulated"],["get",Pi]]:vt);Cn[Pi]=_t.value,Gt[Pi]=Ii.value}return Or.map=function(ui){nr.properties=ui;for(var Ki={},Qi=0,la=yt;Qi<la.length;Qi+=1){var Fi=la[Qi];Ki[Fi]=Cn[Fi].evaluate(En,nr)}return Ki},Or.reduce=function(ui,Ki){nr.properties=Ki;for(var Qi=0,la=yt;Qi<la.length;Qi+=1){var Fi=la[Qi];En.accumulated=ui[Fi],ui[Fi]=Gt[Fi].evaluate(En,nr)}},Or}(Ze)).load(_e.features):function(er,Or){return new sa(er,Or)}(_e,Ze.geojsonVtOptions)}catch(er){return we(er)}fe.loaded={};var Rr={};if(tt){var Kt=tt.finish();Kt&&(Rr.resourceTiming={},Rr.resourceTiming[Ze.source]=JSON.parse(JSON.stringify(Kt)))}we(null,Rr)})}},re.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},re.prototype.reloadTile=function(fe,we){var Ze=this.loaded;return Ze&&Ze[fe.uid]?K.prototype.reloadTile.call(this,fe,we):this.loadTile(fe,we)},re.prototype.loadGeoJSON=function(fe,we){if(fe.request)y.getJSON(fe.request,we);else{if(typeof fe.data!="string")return we(new Error("Input data given to '"+fe.source+"' is not a valid GeoJSON object."));try{return we(null,JSON.parse(fe.data))}catch(Ze){return we(new Error("Input data given to '"+fe.source+"' is not a valid GeoJSON object."))}}},re.prototype.removeSource=function(fe,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),we()},re.prototype.getClusterExpansionZoom=function(fe,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Ze){we(Ze)}},re.prototype.getClusterChildren=function(fe,we){try{we(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Ze){we(Ze)}},re.prototype.getClusterLeaves=function(fe,we){try{we(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Ze){we(Ze)}},re}(mt),ra=function(K){var re=this;this.self=K,this.actor=new y.Actor(K,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:mt,geojson:_a},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(fe,we){if(re.workerSourceTypes[fe])throw new Error('Worker source with name "'+fe+'" already registered.');re.workerSourceTypes[fe]=we},this.self.registerRTLTextPlugin=function(fe){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=fe.applyArabicShaping,y.plugin.processBidirectionalText=fe.processBidirectionalText,y.plugin.processStyledBidirectionalText=fe.processStyledBidirectionalText}};return ra.prototype.setReferrer=function(K,re){this.referrer=re},ra.prototype.setImages=function(K,re,fe){for(var we in this.availableImages[K]=re,this.workerSources[K]){var Ze=this.workerSources[K][we];for(var tt in Ze)Ze[tt].availableImages=re}fe()},ra.prototype.setLayers=function(K,re,fe){this.getLayerIndex(K).replace(re),fe()},ra.prototype.updateLayers=function(K,re,fe){this.getLayerIndex(K).update(re.layers,re.removedIds),fe()},ra.prototype.loadTile=function(K,re,fe){this.getWorkerSource(K,re.type,re.source).loadTile(re,fe)},ra.prototype.loadDEMTile=function(K,re,fe){this.getDEMWorkerSource(K,re.source).loadTile(re,fe)},ra.prototype.reloadTile=function(K,re,fe){this.getWorkerSource(K,re.type,re.source).reloadTile(re,fe)},ra.prototype.abortTile=function(K,re,fe){this.getWorkerSource(K,re.type,re.source).abortTile(re,fe)},ra.prototype.removeTile=function(K,re,fe){this.getWorkerSource(K,re.type,re.source).removeTile(re,fe)},ra.prototype.removeDEMTile=function(K,re){this.getDEMWorkerSource(K,re.source).removeTile(re)},ra.prototype.removeSource=function(K,re,fe){if(this.workerSources[K]&&this.workerSources[K][re.type]&&this.workerSources[K][re.type][re.source]){var we=this.workerSources[K][re.type][re.source];delete this.workerSources[K][re.type][re.source],we.removeSource!==void 0?we.removeSource(re,fe):fe()}},ra.prototype.loadWorkerSource=function(K,re,fe){try{this.self.importScripts(re.url),fe()}catch(we){fe(we.toString())}},ra.prototype.syncRTLPluginState=function(K,re,fe){try{y.plugin.setState(re);var we=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&we!=null){this.self.importScripts(we);var Ze=y.plugin.isParsed();fe(Ze?void 0:new Error("RTL Text Plugin failed to import scripts from "+we),Ze)}}catch(tt){fe(tt.toString())}},ra.prototype.getAvailableImages=function(K){var re=this.availableImages[K];return re||(re=[]),re},ra.prototype.getLayerIndex=function(K){var re=this.layerIndexes[K];return re||(re=this.layerIndexes[K]=new Ce),re},ra.prototype.getWorkerSource=function(K,re,fe){var we=this;return this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][re]||(this.workerSources[K][re]={}),this.workerSources[K][re][fe]||(this.workerSources[K][re][fe]=new this.workerSourceTypes[re]({send:function(Ze,tt,pt){we.actor.send(Ze,tt,pt,K)}},this.getLayerIndex(K),this.getAvailableImages(K))),this.workerSources[K][re][fe]},ra.prototype.getDEMWorkerSource=function(K,re){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][re]||(this.demWorkerSources[K][re]=new Dt),this.demWorkerSources[K][re]},ra.prototype.enforceCacheSizeLimit=function(K,re){y.enforceCacheSizeLimit(re)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ra(self)),ra}),he(["./shared"],function(y){"use strict";var Pe=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var I,F,j=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(j);try{F=new Worker(J),I=!0}catch(ye){I=!1}return F&&F.terminate(),URL.revokeObjectURL(J),I}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var I=document.createElement("canvas");I.width=I.height=1;var F=I.getContext("2d");if(!F)return!1;var j=F.getImageData(0,0,1,1);return j&&j.width===I.width}()?(g[M=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[M]=function(I){var F=function(J){var ye=document.createElement("canvas"),le=Object.create(d.webGLContextAttributes);return le.failIfMajorPerformanceCaveat=J,ye.probablySupportsContext?ye.probablySupportsContext("webgl",le)||ye.probablySupportsContext("experimental-webgl",le):ye.supportsContext?ye.supportsContext("webgl",le)||ye.supportsContext("experimental-webgl",le):ye.getContext("webgl",le)||ye.getContext("experimental-webgl",le)}(I);if(!F)return!1;var j=F.createShader(F.VERTEX_SHADER);return!(!j||F.isContextLost())&&(F.shaderSource(j,"void main() {}"),F.compileShader(j),F.getShaderParameter(j,F.COMPILE_STATUS)===!0)}(M)),g[M]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var M}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),q={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},Ce=y.window.document&&y.window.document.documentElement.style;function pe(f){if(!Ce)return f[0];for(var d=0;d<f.length;d++)if(f[d]in Ce)return f[d];return f[0]}var Ke,Se=pe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);q.disableDrag=function(){Ce&&Se&&(Ke=Ce[Se],Ce[Se]="none")},q.enableDrag=function(){Ce&&Se&&(Ce[Se]=Ke)};var ot=pe(["transform","WebkitTransform"]);q.setTransform=function(f,d){f.style[ot]=d};var mt=!1;try{var bt=Object.defineProperty({},"passive",{get:function(){mt=!0}});y.window.addEventListener("test",bt,bt),y.window.removeEventListener("test",bt,bt)}catch(f){mt=!1}q.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&mt?g:g.capture)},q.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&mt?g:g.capture)};var Dt=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",Dt,!0)};function _r(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}q.suppressClick=function(){y.window.addEventListener("click",Dt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Dt,!0)},0)},q.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},q.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},q.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},q.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var Nt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var M=w[g];this._notify(M.ids,M.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,M=0,I=h;M<I.length;M+=1){var F=I[M];if(F[0]<w||F[1]<F[0]||g<F[1])return!1;w=F[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var M=0,I=h;M<I.length;M+=1)this.images[I[M]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},M=0,I=h;M<I.length;M+=1){var F=I[M];this.images[F]||this.fire(new y.Event("styleimagemissing",{id:F}));var j=this.images[F];j?w[F]={data:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:Boolean(j.userImage&&j.userImage.render)}:y.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var M={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new y.ImagePosition(M,w);this.patterns[h]={bin:M,position:I}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),M=w.w,I=w.h,F=this.atlasImage;for(var j in F.resize({width:M||1,height:I||1}),this.patterns){var J=this.patterns[j].bin,ye=J.x+1,le=J.y+1,Ee=this.images[j].data,Ue=Ee.width,je=Ee.height;y.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ye,y:le},{width:Ue,height:je}),y.RGBAImage.copy(Ee,F,{x:0,y:je-1},{x:ye,y:le-1},{width:Ue,height:1}),y.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ye,y:le+je},{width:Ue,height:1}),y.RGBAImage.copy(Ee,F,{x:Ue-1,y:0},{x:ye-1,y:le},{width:1,height:je}),y.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ye+Ue,y:le},{width:1,height:je})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var M=w[g];if(!this.callbackDispatchedThisFrame[M]){this.callbackDispatchedThisFrame[M]=!0;var I=this.images[M];_r(I)&&this.updateImage(M,I)}}},d}(y.Evented),gr=Ft,Qt=Ft,Pt=1e20;function Ft(f,d,h,g,w,M){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=M||"normal",this.radius=h||8;var I=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=I,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.d=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Int16Array(I),this.middle=Math.round(I/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function xr(f,d,h,g,w,M,I){for(var F=0;F<d;F++){for(var j=0;j<h;j++)g[j]=f[j*d+F];for(ee(g,w,M,I,h),j=0;j<h;j++)f[j*d+F]=w[j]}for(j=0;j<h;j++){for(F=0;F<d;F++)g[F]=f[j*d+F];for(ee(g,w,M,I,d),F=0;F<d;F++)f[j*d+F]=Math.sqrt(w[F])}}function ee(f,d,h,g,w){h[0]=0,g[0]=-Pt,g[1]=+Pt;for(var M=1,I=0;M<w;M++){for(var F=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);F<=g[I];)I--,F=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);h[++I]=M,g[I]=F,g[I+1]=+Pt}for(M=0,I=0;M<w;M++){for(;g[I+1]<M;)I++;d[M]=(M-h[I])*(M-h[I])+f[h[I]]}}Ft.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?Pt:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?Pt:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(xr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),xr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},gr.default=Qt;var sr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};sr.prototype.setURL=function(f){this.url=f},sr.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var M=0,I=f[w];M<I.length;M+=1)g.push({stack:w,id:I[M]});y.asyncAll(g,function(F,j){var J=F.stack,ye=F.id,le=h.entries[J];le||(le=h.entries[J]={glyphs:{},requests:{},ranges:{}});var Ee=le.glyphs[ye];if(Ee===void 0){if(Ee=h._tinySDF(le,J,ye))return le.glyphs[ye]=Ee,void j(null,{stack:J,id:ye,glyph:Ee});var Ue=Math.floor(ye/256);if(256*Ue>65535)j(new Error("glyphs > 65535 not supported"));else if(le.ranges[Ue])j(null,{stack:J,id:ye,glyph:Ee});else{var je=le.requests[Ue];je||(je=le.requests[Ue]=[],sr.loadGlyphRange(J,Ue,h.url,h.requestManager,function(nt,Ne){if(Ne){for(var at in Ne)h._doesCharSupportLocalGlyph(+at)||(le.glyphs[+at]=Ne[+at]);le.ranges[Ue]=!0}for(var rt=0,be=je;rt<be.length;rt+=1)(0,be[rt])(nt,Ne);delete le.requests[Ue]})),je.push(function(nt,Ne){nt?j(nt):Ne&&j(null,{stack:J,id:ye,glyph:Ne[ye]||null})})}}else j(null,{stack:J,id:ye,glyph:Ee})},function(F,j){if(F)d(F);else if(j){for(var J={},ye=0,le=j;ye<le.length;ye+=1){var Ee=le[ye],Ue=Ee.stack,je=Ee.id,nt=Ee.glyph;(J[Ue]||(J[Ue]={}))[je]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}d(null,J)}})},sr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},sr.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),w=f.tinySDF=new sr.TinySDF(24,3,8,.25,g,M)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},sr.loadGlyphRange=function(f,d,h,g,w){var M=256*d,I=M+255,F=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",M+"-"+I),y.ResourceType.Glyphs);y.getArrayBuffer(F,function(j,J){if(j)w(j);else if(J){for(var ye={},le=0,Ee=y.parseGlyphPBF(J);le<Ee.length;le+=1){var Ue=Ee[le];ye[Ue.id]=Ue}w(null,ye)}})},sr.TinySDF=gr;var Tt=function(){this.specification=y.styleSpec.light.position};Tt.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},Tt.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var ht=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Tt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),jt=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(ht),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var M=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),M):this._transitionable.setValue(w,M)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),dt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};dt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},dt.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,M=f[0]*h,I=!0;g.push({left:w,right:M,isDash:I,zeroLength:f[0]===0});for(var F=f[0],j=1;j<f.length;j++){var J=f[j];g.push({left:w=F*h,right:M=(F+=J)*h,isDash:I=!I,zeroLength:J===0})}return g},dt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var M=this.width*(this.nextRow+h+w),I=0,F=f[I],j=0;j<this.width;j++){j/F.right>1&&(F=f[++I]);var J=Math.abs(j-F.left),ye=Math.abs(j-F.right),le=Math.min(J,ye),Ee=void 0,Ue=w/h*(g+1);if(F.isDash){var je=g-Math.abs(Ue);Ee=Math.sqrt(le*le+je*je)}else Ee=g-Math.sqrt(le*le+Ue*Ue);this.data[M+j]=Math.max(0,Math.min(255,Ee+128))}},dt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],M=f[f.length-1];w.isDash===M.isDash&&(w.left=M.left-this.width,M.right=w.right+this.width);for(var I=this.width*this.nextRow,F=0,j=f[F],J=0;J<this.width;J++){J/j.right>1&&(j=f[++F]);var ye=Math.abs(J-j.left),le=Math.abs(J-j.right),Ee=Math.min(ye,le);this.data[I+J]=Math.max(0,Math.min(255,(j.isDash?Ee:-Ee)+128))}},dt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,M=0;M<f.length;M++)w+=f[M];if(w!==0){var I=this.width/w,F=this.getDashRanges(f,this.width,I);d?this.addRoundDash(F,I,h):this.addRegularDash(F)}var j={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,j},dt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var lr=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var M=new f.Actor(g[w],h,this.id);M.name="Worker "+w,this.actors.push(M)}};function jr(f,d,h){var g=function(w,M){if(w)return h(w);if(M){var I=y.pick(y.extend(M,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(I.vectorLayers=M.vector_layers,I.vectorLayerIds=I.vectorLayers.map(function(F){return F.id})),I.tiles=d.canonicalizeTileset(I,f.url),h(null,I)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}lr.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},lr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},lr.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},lr.Actor=y.Actor;var ue=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};ue.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},ue.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<M};var He=function(f){function d(h,g,w,M){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new ue(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function I(F,j){return delete h.request,h.aborted?g(null):F&&F.status!==404?g(F):(j&&j.resourceTiming&&(h.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&h.setExpiryData(j),h.loadVectorData(j,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}M.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",M,I.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",M,I.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),W=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new ue(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,M=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(M,y.ResourceType.Tile),function(I,F){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(F){w.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var j=w.map.painter.context,J=j.gl;h.texture=w.map.painter.getTileTexture(F.width),h.texture?h.texture.update(F,{useMipmap:!0}):(h.texture=new y.Texture(j,F,J.RGBA,{useMipmap:!0}),h.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),j.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Y=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function M(I,F){I&&(h.state="errored",g(I)),F&&(h.dem=F,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(I,F){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(F){this.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var j=y.window.ImageBitmap&&F instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?F:y.browser.getImageData(F,1),J={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:j,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",J,M.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),M=(g.x-1+w)%w,I=g.x===0?h.wrap-1:h.wrap,F=(g.x+1+w)%w,j=g.x+1===w?h.wrap+1:h.wrap,J={};return J[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y).key]={backfilled:!1},J[new y.OverscaledTileID(h.overscaledZ,j,g.z,F,g.y).key]={backfilled:!1},g.y>0&&(J[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y-1).key]={backfilled:!1},J[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},J[new y.OverscaledTileID(h.overscaledZ,j,g.z,F,g.y-1).key]={backfilled:!1}),g.y+1<w&&(J[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y+1).key]={backfilled:!1},J[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},J[new y.OverscaledTileID(h.overscaledZ,j,g.z,F,g.y+1).key]={backfilled:!1}),J},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(W),Re=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(M),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var I=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*I,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*I,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*I,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var M={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(M.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",M))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,M){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},M),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),M=this._data;typeof M=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(M),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(M),this.actor.send(this.type+".loadData",w,function(I,F){g._removed||F&&F.abandoned||(g._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[g.id]&&(g._resourceTiming=F.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(I))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,M=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(M,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(I,F){return delete h.request,h.unloadVectorData(),h.aborted?g(null):I?g(I):(h.loadVectorData(F,w.map.painter,M==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),gt=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),wt=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(M,I){w._loaded=!0,M?w.fire(new y.ErrorEvent(M)):I&&(w.image=I,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(I){for(var F=1/0,j=1/0,J=-1/0,ye=-1/0,le=0,Ee=I;le<Ee.length;le+=1){var Ue=Ee[le];F=Math.min(F,Ue.x),j=Math.min(j,Ue.y),J=Math.max(J,Ue.x),ye=Math.max(ye,Ue.y)}var je=Math.max(J-F,ye-j),nt=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),Ne=Math.pow(2,nt);return new y.CanonicalTileID(nt,Math.floor((F+J)/2*Ne),Math.floor((j+ye)/2*Ne))}(w),this.minzoom=this.maxzoom=this.tileID.z;var M=w.map(function(I){return g.tileID.getTilePoint(I)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(M[2].x,M[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),qt=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,M=g.urls;w<M.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(M[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(I,F){h._loaded=!0,I?h.fire(new y.ErrorEvent(I)):F&&(h.video=F,h.video.loop=!0,h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(wt),fr=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(I){return!Array.isArray(I)||I.length!==2||I.some(function(F){return typeof F!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var M in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,gt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var I=this.tiles[M];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(wt),br={vector:He,raster:W,"raster-dem":Y,geojson:Re,video:qt,image:wt,canvas:fr};function bn(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function en(f,d,h,g,w,M){var I=function(nt,Ne,at){if(nt)for(var rt=0,be=nt;rt<be.length;rt+=1){var or=Ne[be[rt]];if(or&&or.source===at&&or.type==="fill-extrusion")return!0}else for(var $ in Ne){var ur=Ne[$];if(ur.source===at&&ur.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),F=M.maxPitchScaleFactor(),j=f.tilesIn(g,F,I);j.sort(Ci);for(var J=[],ye=0,le=j;ye<le.length;ye+=1){var Ee=le[ye];J.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(d,h,f._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,w,M,F,bn(f.transform,Ee.tileID))})}var Ue=function(nt){for(var Ne={},at={},rt=0,be=nt;rt<be.length;rt+=1){var or=be[rt],$=or.queryResults,ur=or.wrappedTileID,Tr=at[ur]=at[ur]||{};for(var rn in $)for(var Qr=$[rn],Sn=Tr[rn]=Tr[rn]||{},Jn=Ne[rn]=Ne[rn]||[],ei=0,ni=Qr;ei<ni.length;ei+=1){var ji=ni[ei];Sn[ji.featureIndex]||(Sn[ji.featureIndex]=!0,Jn.push(ji))}}return Ne}(J);for(var je in Ue)Ue[je].forEach(function(nt){var Ne=nt.feature,at=f.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=at});return Ue}function Ci(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var Wn=function(f,d){this.max=f,this.onRemove=d,this.reset()};Wn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Wn.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var M={value:d,timeout:void 0};if(h!==void 0&&(M.timeout=setTimeout(function(){g.remove(f,M)},h)),this.data[w].push(M),this.order.push(w),this.order.length>this.max){var I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this},Wn.prototype.has=function(f){return f.wrapped().key in this.data},Wn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},Wn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},Wn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},Wn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},Wn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},Wn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Wn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var M=w[g];f(M.value)||d.push(M)}for(var I=0,F=d;I<F.length;I+=1){var j=F[I];this.remove(j.value.tileID,j)}};var Vn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Vn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Vn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Vn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var va={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Si=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Si.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Si.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Si.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Si.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],M=d.attributes[w.name];M!==void 0&&f.vertexAttribPointer(M,w.components,f[va[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},Si.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ci=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ci.prototype.get=function(){return this.current},ci.prototype.set=function(f){},ci.prototype.getDefault=function(){return this.default},ci.prototype.setDefault=function(){this.set(this.default)};var Vi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(ci),zi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(ci),_i=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(ci),$n=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(ci),ii=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(ci),Co=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(ci),Ba=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(ci),ya=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(ci),Et=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(ci),de=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(ci),ae=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(ci),xe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(ci),N=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(ci),Qe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(ci),Wt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(ci),Dr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(ci),qe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(ci),kt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(ci),hr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(ci),kr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(ci),Hr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(ci),qr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(ci),Hn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(ci),Bn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(ci),Kr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(ci),fi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(ci),ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(ci),sa=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(ci),wa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(ci),Na=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(ci),_a=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(ci),ra=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(ci),K=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(ra),re=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(ra),fe=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new K(f,w),g&&(this.depthAttachment=new re(f,w))};fe.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var we=function(f,d,h){this.func=f,this.mask=d,this.range=h};we.ReadOnly=!1,we.ReadWrite=!0,we.disabled=new we(519,we.ReadOnly,[0,1]);var Ze=function(f,d,h,g,w,M){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=M};Ze.disabled=new Ze({func:519,mask:0},0,0,7680,7680,7680);var tt=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};tt.disabled=new tt(tt.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),tt.unblended=new tt(tt.Replace,y.Color.transparent,[!0,!0,!0,!0]),tt.alphaBlended=new tt([1,771],y.Color.transparent,[!0,!0,!0,!0]);var pt=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};pt.disabled=new pt(!1,1029,2305),pt.backCCW=new pt(!0,1029,2305);var _e=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Vi(this),this.clearDepth=new zi(this),this.clearStencil=new _i(this),this.colorMask=new $n(this),this.depthMask=new ii(this),this.stencilMask=new Co(this),this.stencilFunc=new Ba(this),this.stencilOp=new ya(this),this.stencilTest=new Et(this),this.depthRange=new de(this),this.depthTest=new ae(this),this.depthFunc=new xe(this),this.blend=new N(this),this.blendFunc=new Qe(this),this.blendColor=new Wt(this),this.blendEquation=new Dr(this),this.cullFace=new qe(this),this.cullFaceSide=new kt(this),this.frontFace=new hr(this),this.program=new kr(this),this.activeTexture=new Hr(this),this.viewport=new qr(this),this.bindFramebuffer=new Hn(this),this.bindRenderbuffer=new Bn(this),this.bindTexture=new Kr(this),this.bindVertexBuffer=new fi(this),this.bindElementBuffer=new ri(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new sa(this),this.pixelStoreUnpack=new wa(this),this.pixelStoreUnpackPremultiplyAlpha=new Na(this),this.pixelStoreUnpackFlipY=new _a(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};_e.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},_e.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},_e.prototype.createIndexBuffer=function(f,d){return new Vn(this,f,d)},_e.prototype.createVertexBuffer=function(f,d,h){return new Si(this,f,d,h)},_e.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},_e.prototype.createFramebuffer=function(f,d,h){return new fe(this,f,d,h)},_e.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},_e.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},_e.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},_e.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},_e.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},_e.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var We=function(f){function d(h,g,w){var M=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(I){I.dataType==="source"&&I.sourceDataType==="metadata"&&(M._sourceLoaded=!0),M._sourceLoaded&&!M._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(M.reload(),M.transform&&M.update(M.transform))}),this.on("error",function(){M._sourceErrored=!0}),this._source=function(I,F,j,J){var ye=new br[F.type](I,F,j,J);if(ye.id!==I)throw new Error("Expected Source id to be "+I+" instead of "+ye.id);return y.bindAll(["load","abort","unload","serialize","prepare"],ye),ye}(h,g,w,this),this._tiles={},this._cache=new Wn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(Bt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var M in this._tiles)this._isIdRenderable(M,h)&&w.push(this._tiles[M]);return h?w.sort(function(I,F){var j=I.tileID,J=F.tileID,ye=new y.Point(j.canonical.x,j.canonical.y)._rotate(g.transform.angle),le=new y.Point(J.canonical.x,J.canonical.y)._rotate(g.transform.angle);return j.overscaledZ-J.overscaledZ||le.y-ye.y||le.x-ye.x}).map(function(I){return I.tileID.key}):w.map(function(I){return I.tileID}).sort(Bt).map(function(I){return I.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,M){if(M)return h.state="errored",void(M.status!==404?this._source.fire(new y.ErrorEvent(M,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var M=g[w];if(h.neighboringTiles&&h.neighboringTiles[M]){var I=this.getTileByID(M);F(h,I),F(I,h)}}function F(j,J){j.needsHillshadePrepare=!0;var ye=J.tileID.canonical.x-j.tileID.canonical.x,le=J.tileID.canonical.y-j.tileID.canonical.y,Ee=Math.pow(2,j.tileID.canonical.z),Ue=J.tileID.key;ye===0&&le===0||Math.abs(le)>1||(Math.abs(ye)>1&&(Math.abs(ye+Ee)===1?ye+=Ee:Math.abs(ye-Ee)===1&&(ye-=Ee)),J.dem&&j.dem&&(j.dem.backfillBorder(J.dem,ye,le),j.neighboringTiles&&j.neighboringTiles[Ue]&&(j.neighboringTiles[Ue].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,M){for(var I in this._tiles){var F=this._tiles[I];if(!(M[I]||!F.hasData()||F.tileID.overscaledZ<=g||F.tileID.overscaledZ>w)){for(var j=F.tileID;F&&F.tileID.overscaledZ>g+1;){var J=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[J.key])&&F.hasData()&&(j=J)}for(var ye=j;ye.overscaledZ>g;)if(h[(ye=ye.scaledTo(ye.overscaledZ-1)).key]){M[j.key]=j;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var M=h.overscaledZ-1;M>=g;M--){var I=h.scaledTo(M),F=this._getLoadedTile(I);if(F)return F}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,M=Math.floor(g*w*5),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(I)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var M in this._tiles){var I=this._tiles[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+g),w[I.tileID.key]=I}for(var F in this._tiles=w,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var j in this._tiles)this._setTileReloadTimer(j,this._tiles[j])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Tr){return new y.OverscaledTileID(Tr.canonical.z,Tr.wrap,Tr.canonical.z,Tr.canonical.x,Tr.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(Tr){return g._source.hasTile(Tr)}))):w=[];var M=h.coveringZoomLevel(this._source),I=Math.max(M-d.maxOverzooming,this._source.minzoom),F=Math.max(M+d.maxUnderzooming,this._source.minzoom),j=this._updateRetainedTiles(w,M);if(Rr(this._source.type)){for(var J={},ye={},le=0,Ee=Object.keys(j);le<Ee.length;le+=1){var Ue=Ee[le],je=j[Ue],nt=this._tiles[Ue];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=y.browser.now())){var Ne=this.findLoadedParent(je,I);Ne&&(this._addTile(Ne.tileID),J[Ne.tileID.key]=Ne.tileID),ye[Ue]=je}}for(var at in this._retainLoadedChildren(ye,M,F,j),J)j[at]||(this._coveredTiles[at]=!0,j[at]=J[at])}for(var rt in j)this._tiles[rt].clearFadeHold();for(var be=0,or=y.keysDifference(this._tiles,j);be<or.length;be+=1){var $=or[be],ur=this._tiles[$];ur.hasSymbolBuckets&&!ur.holdingForFade()?ur.setHoldDuration(this.map._fadeDuration):ur.hasSymbolBuckets&&!ur.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},M={},I=Math.max(g-d.maxOverzooming,this._source.minzoom),F=Math.max(g+d.maxUnderzooming,this._source.minzoom),j={},J=0,ye=h;J<ye.length;J+=1){var le=ye[J],Ee=this._addTile(le);w[le.key]=le,Ee.hasData()||g<this._source.maxzoom&&(j[le.key]=le)}this._retainLoadedChildren(j,g,F,w);for(var Ue=0,je=h;Ue<je.length;Ue+=1){var nt=je[Ue],Ne=this._tiles[nt.key];if(!Ne.hasData()){if(g+1>this._source.maxzoom){var at=nt.children(this._source.maxzoom)[0],rt=this.getTile(at);if(rt&&rt.hasData()){w[at.key]=at;continue}}else{var be=nt.children(this._source.maxzoom);if(w[be[0].key]&&w[be[1].key]&&w[be[2].key]&&w[be[3].key])continue}for(var or=Ne.wasRequested(),$=nt.overscaledZ-1;$>=I;--$){var ur=nt.scaledTo($);if(M[ur.key]||(M[ur.key]=!0,!(Ne=this.getTile(ur))&&or&&(Ne=this._addTile(ur)),Ne&&(w[ur.key]=ur,or=Ne.wasRequested(),Ne.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,M=this._tiles[h].tileID;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){w=this._loadedParentTiles[M.key];break}g.push(M.key);var I=M.scaledTo(M.overscaledZ-1);if(w=this._getLoadedTile(I))break;M=I}for(var F=0,j=g;F<j.length;F+=1)this._loadedParentTiles[j[F]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var M=g.getExpiryTimeout();M&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},M))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var M=this,I=[],F=this.transform;if(!F)return I;for(var j=w?F.getCameraQueryGeometry(h):h,J=h.map(function($){return F.pointCoordinate($)}),ye=j.map(function($){return F.pointCoordinate($)}),le=this.getIds(),Ee=1/0,Ue=1/0,je=-1/0,nt=-1/0,Ne=0,at=ye;Ne<at.length;Ne+=1){var rt=at[Ne];Ee=Math.min(Ee,rt.x),Ue=Math.min(Ue,rt.y),je=Math.max(je,rt.x),nt=Math.max(nt,rt.y)}for(var be=function($){var ur=M._tiles[le[$]];if(!ur.holdingForFade()){var Tr=ur.tileID,rn=Math.pow(2,F.zoom-ur.tileID.overscaledZ),Qr=g*ur.queryPadding*y.EXTENT/ur.tileSize/rn,Sn=[Tr.getTilePoint(new y.MercatorCoordinate(Ee,Ue)),Tr.getTilePoint(new y.MercatorCoordinate(je,nt))];if(Sn[0].x-Qr<y.EXTENT&&Sn[0].y-Qr<y.EXTENT&&Sn[1].x+Qr>=0&&Sn[1].y+Qr>=0){var Jn=J.map(function(ni){return Tr.getTilePoint(ni)}),ei=ye.map(function(ni){return Tr.getTilePoint(ni)});I.push({tile:ur,tileID:Tr,queryGeometry:Jn,cameraQueryGeometry:ei,scale:rn})}}},or=0;or<le.length;or++)be(or);return I},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(j){return g._tiles[j].tileID}),M=0,I=w;M<I.length;M+=1){var F=I[M];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Rr(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var M=this._tiles[h];M&&M.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(M){return!M.hasDependency(h,g)})},d}(y.Evented);function Bt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function Rr(f){return f==="raster"||f==="image"||f==="video"}function Kt(){return new y.window.Worker(Kl.workerUrl)}We.maxOverzooming=10,We.maxUnderzooming=3;var er="mapboxgl_preloaded_worker_pool",Or=function(){this.active={}};Or.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<Or.workerCount;)this.workers.push(new Kt);return this.active[f]=!0,this.workers.slice()},Or.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Or.prototype.isPreloaded=function(){return!!this.active[er]},Or.prototype.numActive=function(){return Object.keys(this.active).length};var On,Cn=Math.floor(y.browser.hardwareConcurrency/2);function Gt(){return On||(On=new Or),On}function En(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function nr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=En(f[g],d[f[g].ref]));return f}Or.workerCount=Math.max(Math.min(Cn,6),1);var yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function xi(f,d,h){h.push({command:yt.addSource,args:[f,d[f]]})}function dn(f,d,h){d.push({command:yt.removeSource,args:[f]}),h[f]=!0}function Pi(f,d,h,g){dn(f,h,g),xi(f,d,h)}function ua(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function vt(f,d,h,g,w,M){var I;for(I in d=d||{},f=f||{})f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}));for(I in d)d.hasOwnProperty(I)&&!f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}))}function _t(f){return f.id}function Ii(f,d){return f[d.id]=d,f}var ui=function(f,d){this.reset(f,d)};ui.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ui.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,M=this._distances[w],I=h-M,F=I>0?(g-M)/I:0;return this.points[w].mult(1-F).add(this.points[d].mult(F))};var Ki=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Qi(f,d,h,g,w){var M=y.create();return d?(y.scale(M,M,[1/w,1/w,1]),h||y.rotateZ(M,M,g.angle)):y.multiply(M,g.labelPlaneMatrix,f),M}function la(f,d,h,g,w){if(d){var M=y.clone(f);return y.scale(M,M,[w,w,1]),h||y.rotateZ(M,M,-g.angle),M}return g.glCoordMatrix}function Fi(f,d){var h=[f.x,f.y,0,1];Ga(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function pr(f,d){return .5+f/d*.5}function wr(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function Ye(f,d,h,g,w,M,I,F){var j=g?f.textSizeData:f.iconSizeData,J=y.evaluateSizeForZoom(j,h.transform.zoom),ye=[256/h.width*2+1,256/h.height*2+1],le=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;le.clear();for(var Ee=f.lineVertexArray,Ue=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,je=h.transform.width/h.transform.height,nt=!1,Ne=0;Ne<Ue.length;Ne++){var at=Ue.get(Ne);if(at.hidden||at.writingMode===y.WritingMode.vertical&&!nt)Qa(at.numGlyphs,le);else{nt=!1;var rt=[at.anchorX,at.anchorY,0,1];if(y.transformMat4(rt,rt,d),wr(rt,ye)){var be=pr(h.transform.cameraToCenterDistance,rt[3]),or=y.evaluateSizeForFeature(j,J,at),$=I?or/be:or*be,ur=new y.Point(at.anchorX,at.anchorY),Tr=Fi(ur,w).point,rn={},Qr=ws(at,$,!1,F,d,w,M,f.glyphOffsetArray,Ee,le,Tr,ur,rn,je);nt=Qr.useVertical,(Qr.notEnoughRoom||nt||Qr.needsFlipping&&ws(at,$,!0,F,d,w,M,f.glyphOffsetArray,Ee,le,Tr,ur,rn,je).notEnoughRoom)&&Qa(at.numGlyphs,le)}else Qa(at.numGlyphs,le)}}g?f.text.dynamicLayoutVertexBuffer.updateData(le):f.icon.dynamicLayoutVertexBuffer.updateData(le)}function Ma(f,d,h,g,w,M,I,F,j,J,ye){var le=F.glyphStartIndex+F.numGlyphs,Ee=F.lineStartIndex,Ue=F.lineStartIndex+F.lineLength,je=d.getoffsetX(F.glyphStartIndex),nt=d.getoffsetX(le-1),Ne=na(f*je,h,g,w,M,I,F.segment,Ee,Ue,j,J,ye);if(!Ne)return null;var at=na(f*nt,h,g,w,M,I,F.segment,Ee,Ue,j,J,ye);return at?{first:Ne,last:at}:null}function Le(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function ws(f,d,h,g,w,M,I,F,j,J,ye,le,Ee,Ue){var je,nt=d/24,Ne=f.lineOffsetX*nt,at=f.lineOffsetY*nt;if(f.numGlyphs>1){var rt=f.glyphStartIndex+f.numGlyphs,be=f.lineStartIndex,or=f.lineStartIndex+f.lineLength,$=Ma(nt,F,Ne,at,h,ye,le,f,j,M,Ee);if(!$)return{notEnoughRoom:!0};var ur=Fi($.first.point,I).point,Tr=Fi($.last.point,I).point;if(g&&!h){var rn=Le(f.writingMode,ur,Tr,Ue);if(rn)return rn}je=[$.first];for(var Qr=f.glyphStartIndex+1;Qr<rt-1;Qr++)je.push(na(nt*F.getoffsetX(Qr),Ne,at,h,ye,le,f.segment,be,or,j,M,Ee));je.push($.last)}else{if(g&&!h){var Sn=Fi(le,w).point,Jn=f.lineStartIndex+f.segment+1,ei=new y.Point(j.getx(Jn),j.gety(Jn)),ni=Fi(ei,w),ji=ni.signedDistanceFromCamera>0?ni.point:is(le,ei,Sn,1,w),wn=Le(f.writingMode,Sn,ji,Ue);if(wn)return wn}var vi=na(nt*F.getoffsetX(f.glyphStartIndex),Ne,at,h,ye,le,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,j,M,Ee);if(!vi)return{notEnoughRoom:!0};je=[vi]}for(var wi=0,mi=je;wi<mi.length;wi+=1){var ai=mi[wi];y.addDynamicAttributes(J,ai.point,ai.angle)}return{}}function is(f,d,h,g,w){var M=Fi(f.add(f.sub(d)._unit()),w).point,I=h.sub(M);return h.add(I._mult(g/I.mag()))}function na(f,d,h,g,w,M,I,F,j,J,ye,le){var Ee=g?f-d:f+d,Ue=Ee>0?1:-1,je=0;g&&(Ue*=-1,je=Math.PI),Ue<0&&(je+=Math.PI);for(var nt=Ue>0?F+I:F+I+1,Ne=w,at=w,rt=0,be=0,or=Math.abs(Ee),$=[];rt+be<=or;){if((nt+=Ue)<F||nt>=j)return null;if(at=Ne,$.push(Ne),(Ne=le[nt])===void 0){var ur=new y.Point(J.getx(nt),J.gety(nt)),Tr=Fi(ur,ye);if(Tr.signedDistanceFromCamera>0)Ne=le[nt]=Tr.point;else{var rn=nt-Ue;Ne=is(rt===0?M:new y.Point(J.getx(rn),J.gety(rn)),ur,at,or-rt+1,ye)}}rt+=be,be=at.dist(Ne)}var Qr=(or-rt)/be,Sn=Ne.sub(at),Jn=Sn.mult(Qr)._add(at);Jn._add(Sn._unit()._perp()._mult(h*Ue));var ei=je+Math.atan2(Ne.y-at.y,Ne.x-at.x);return $.push(Jn),{point:Jn,angle:ei,path:$}}Ki.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ki.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},Ki.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},Ki.prototype._insertBoxCell=function(f,d,h,g,w,M){this.boxCells[w].push(M)},Ki.prototype._insertCircleCell=function(f,d,h,g,w,M){this.circleCells[w].push(M)},Ki.prototype._query=function(f,d,h,g,w,M){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var I=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var F=0;F<this.boxKeys.length;F++)I.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var j=0;j<this.circleKeys.length;j++){var J=this.circles[3*j],ye=this.circles[3*j+1],le=this.circles[3*j+2];I.push({key:this.circleKeys[j],x1:J-le,y1:ye-le,x2:J+le,y2:ye+le})}return M?I.filter(M):I}return this._forEachCell(f,d,h,g,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},M),w?I.length>0:I},Ki.prototype._queryCircle=function(f,d,h,g,w){var M=f-h,I=f+h,F=d-h,j=d+h;if(I<0||M>this.width||j<0||F>this.height)return!g&&[];var J=[];return this._forEachCell(M,F,I,j,this._queryCellCircle,J,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?J.length>0:J},Ki.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},Ki.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},Ki.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},Ki.prototype._queryCell=function(f,d,h,g,w,M,I,F){var j=I.seenUids,J=this.boxCells[w];if(J!==null)for(var ye=this.bboxes,le=0,Ee=J;le<Ee.length;le+=1){var Ue=Ee[le];if(!j.box[Ue]){j.box[Ue]=!0;var je=4*Ue;if(f<=ye[je+2]&&d<=ye[je+3]&&h>=ye[je+0]&&g>=ye[je+1]&&(!F||F(this.boxKeys[Ue]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[Ue],x1:ye[je],y1:ye[je+1],x2:ye[je+2],y2:ye[je+3]})}}}var nt=this.circleCells[w];if(nt!==null)for(var Ne=this.circles,at=0,rt=nt;at<rt.length;at+=1){var be=rt[at];if(!j.circle[be]){j.circle[be]=!0;var or=3*be;if(this._circleAndRectCollide(Ne[or],Ne[or+1],Ne[or+2],f,d,h,g)&&(!F||F(this.circleKeys[be]))){if(I.hitTest)return M.push(!0),!0;var $=Ne[or],ur=Ne[or+1],Tr=Ne[or+2];M.push({key:this.circleKeys[be],x1:$-Tr,y1:ur-Tr,x2:$+Tr,y2:ur+Tr})}}}},Ki.prototype._queryCellCircle=function(f,d,h,g,w,M,I,F){var j=I.circle,J=I.seenUids,ye=this.boxCells[w];if(ye!==null)for(var le=this.bboxes,Ee=0,Ue=ye;Ee<Ue.length;Ee+=1){var je=Ue[Ee];if(!J.box[je]){J.box[je]=!0;var nt=4*je;if(this._circleAndRectCollide(j.x,j.y,j.radius,le[nt+0],le[nt+1],le[nt+2],le[nt+3])&&(!F||F(this.boxKeys[je])))return M.push(!0),!0}}var Ne=this.circleCells[w];if(Ne!==null)for(var at=this.circles,rt=0,be=Ne;rt<be.length;rt+=1){var or=be[rt];if(!J.circle[or]){J.circle[or]=!0;var $=3*or;if(this._circlesCollide(at[$],at[$+1],at[$+2],j.x,j.y,j.radius)&&(!F||F(this.circleKeys[or])))return M.push(!0),!0}}},Ki.prototype._forEachCell=function(f,d,h,g,w,M,I,F){for(var j=this._convertToXCellCoord(f),J=this._convertToYCellCoord(d),ye=this._convertToXCellCoord(h),le=this._convertToYCellCoord(g),Ee=j;Ee<=ye;Ee++)for(var Ue=J;Ue<=le;Ue++)if(w.call(this,f,d,h,g,this.xCellCount*Ue+Ee,M,I,F))return},Ki.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},Ki.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},Ki.prototype._circlesCollide=function(f,d,h,g,w,M){var I=g-f,F=w-d,j=h+M;return j*j>I*I+F*F},Ki.prototype._circleAndRectCollide=function(f,d,h,g,w,M,I){var F=(M-g)/2,j=Math.abs(f-(g+F));if(j>F+h)return!1;var J=(I-w)/2,ye=Math.abs(d-(w+J));if(ye>J+h)return!1;if(j<=F||ye<=J)return!0;var le=j-F,Ee=ye-J;return le*le+Ee*Ee<=h*h};var Bs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qa(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(Bs,3*g)}}function Ga(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var Ja=function(f,d,h){d===void 0&&(d=new Ki(f.width+200,f.height+200,25)),h===void 0&&(h=new Ki(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function ca(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}Ja.prototype.placeCollisionBox=function(f,d,h,g,w){var M=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),I=h*M.perspectiveRatio,F=f.x1*I+M.point.x,j=f.y1*I+M.point.y,J=f.x2*I+M.point.x,ye=f.y2*I+M.point.y;return!this.isInsideGrid(F,j,J,ye)||!d&&this.grid.hitTest(F,j,J,ye,w)?{box:[],offscreen:!1}:{box:[F,j,J,ye],offscreen:this.isOffscreen(F,j,J,ye)}},Ja.prototype.placeCollisionCircles=function(f,d,h,g,w,M,I,F,j,J,ye,le,Ee){var Ue=[],je=new y.Point(d.anchorX,d.anchorY),nt=Fi(je,M),Ne=pr(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),at=(J?w/Ne:w*Ne)/y.ONE_EM,rt=Fi(je,I).point,be=Ma(at,g,d.lineOffsetX*at,d.lineOffsetY*at,!1,rt,je,d,h,I,{}),or=!1,$=!1,ur=!0;if(be){for(var Tr=.5*le*Ne+Ee,rn=new y.Point(-100,-100),Qr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Sn=new ui,Jn=be.first,ei=be.last,ni=[],ji=Jn.path.length-1;ji>=1;ji--)ni.push(Jn.path[ji]);for(var wn=1;wn<ei.path.length;wn++)ni.push(ei.path[wn]);var vi=2.5*Tr;if(F){var wi=ni.map(function(iu){return Fi(iu,F)});ni=wi.some(function(iu){return iu.signedDistanceFromCamera<=0})?[]:wi.map(function(iu){return iu.point})}var mi=[];if(ni.length>0){for(var ai=ni[0].clone(),Ai=ni[0].clone(),si=1;si<ni.length;si++)ai.x=Math.min(ai.x,ni[si].x),ai.y=Math.min(ai.y,ni[si].y),Ai.x=Math.max(Ai.x,ni[si].x),Ai.y=Math.max(Ai.y,ni[si].y);mi=ai.x>=rn.x&&Ai.x<=Qr.x&&ai.y>=rn.y&&Ai.y<=Qr.y?[ni]:Ai.x<rn.x||ai.x>Qr.x||Ai.y<rn.y||ai.y>Qr.y?[]:y.clipLine([ni],rn.x,rn.y,Qr.x,Qr.y)}for(var oi=0,go=mi;oi<go.length;oi+=1){var to;Sn.reset(go[oi],.25*Tr),to=Sn.length<=.5*Tr?1:Math.ceil(Sn.paddedLength/vi)+1;for(var Do=0;Do<to;Do++){var bo=Do/Math.max(to-1,1),Ya=Sn.lerp(bo),lo=Ya.x+100,Ls=Ya.y+100;Ue.push(lo,Ls,Tr,0);var ys=lo-Tr,Vs=Ls-Tr,ss=lo+Tr,yu=Ls+Tr;if(ur=ur&&this.isOffscreen(ys,Vs,ss,yu),$=$||this.isInsideGrid(ys,Vs,ss,yu),!f&&this.grid.hitTestCircle(lo,Ls,Tr,ye)&&(or=!0,!j))return{circles:[],offscreen:!1,collisionDetected:or}}}}return{circles:!j&&or||!$?[]:Ue,offscreen:ur,collisionDetected:or}},Ja.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,M=-1/0,I=0,F=f;I<F.length;I+=1){var j=F[I],J=new y.Point(j.x+100,j.y+100);h=Math.min(h,J.x),g=Math.min(g,J.y),w=Math.max(w,J.x),M=Math.max(M,J.y),d.push(J)}for(var ye={},le={},Ee=0,Ue=this.grid.query(h,g,w,M).concat(this.ignoredGrid.query(h,g,w,M));Ee<Ue.length;Ee+=1){var je=Ue[Ee],nt=je.key;if(ye[nt.bucketInstanceId]===void 0&&(ye[nt.bucketInstanceId]={}),!ye[nt.bucketInstanceId][nt.featureIndex]){var Ne=[new y.Point(je.x1,je.y1),new y.Point(je.x2,je.y1),new y.Point(je.x2,je.y2),new y.Point(je.x1,je.y2)];y.polygonIntersectsPolygon(d,Ne)&&(ye[nt.bucketInstanceId][nt.featureIndex]=!0,le[nt.bucketInstanceId]===void 0&&(le[nt.bucketInstanceId]=[]),le[nt.bucketInstanceId].push(nt.featureIndex))}}return le},Ja.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},Ja.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var M=d?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},F=0;F<f.length;F+=4)M.insertCircle(I,f[F],f[F+1],f[F+2])},Ja.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Ga(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ja.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},Ja.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},Ja.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var jo=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};jo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ko=function(f,d,h,g,w){this.text=new jo(f?f.text:null,d,h,w),this.icon=new jo(f?f.icon:null,d,g,w)};Ko.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Su=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},Ao=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},To=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},fa=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function eo(f,d,h,g,w){var M=y.getAnchorAlignment(f),I=-(M.horizontalAlign-.5)*d,F=-(M.verticalAlign-.5)*h,j=y.evaluateVariableOffset(f,g);return new y.Point(I+j[0]*w,F+j[1]*w)}function Go(f,d,h,g,w,M){var I=f.x1,F=f.x2,j=f.y1,J=f.y2,ye=f.anchorPointX,le=f.anchorPointY,Ee=new y.Point(d,h);return g&&Ee._rotate(w?M:-M),{x1:I+Ee.x,y1:j+Ee.y,x2:F+Ee.x,y2:J+Ee.y,anchorPointX:ye,anchorPointY:le}}fa.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Wa=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new Ja(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new fa(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Ys(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}Wa.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),M=h.latestFeatureIndex;if(w&&M&&d.id===w.layerIds[0]){var I=h.collisionBoxArray,F=w.layers[0].layout,j=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),J=h.tileSize/y.EXTENT,ye=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),le=F.get("text-pitch-alignment")==="map",Ee=F.get("text-rotation-alignment")==="map",Ue=ca(h,1,this.transform.zoom),je=Qi(ye,le,Ee,this.transform,Ue),nt=null;if(le){var Ne=la(ye,le,Ee,this.transform,Ue);nt=y.multiply([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[w.bucketInstanceId]=new To(w.bucketInstanceId,M,w.sourceLayerIndex,w.index,h.tileID);var at={bucket:w,layout:F,posMatrix:ye,textLabelPlaneMatrix:je,labelToScreenMatrix:nt,scale:j,textPixelRatio:J,holdingForFade:h.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var rt=0,be=w.sortKeyRanges;rt<be.length;rt+=1){var or=be[rt];f.push({sortKey:or.sortKey,symbolInstanceStart:or.symbolInstanceStart,symbolInstanceEnd:or.symbolInstanceEnd,parameters:at})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:at})}},Wa.prototype.attemptAnchorPlacement=function(f,d,h,g,w,M,I,F,j,J,ye,le,Ee,Ue,je){var nt,Ne=[le.textOffset0,le.textOffset1],at=eo(f,h,g,Ne,w),rt=this.collisionIndex.placeCollisionBox(Go(d,at.x,at.y,M,I,this.transform.angle),ye,F,j,J.predicate);if(!je||this.collisionIndex.placeCollisionBox(Go(je,at.x,at.y,M,I,this.transform.angle),ye,F,j,J.predicate).box.length!==0)return rt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[le.crossTileID].anchor),this.variableOffsets[le.crossTileID]={textOffset:Ne,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:nt},this.markUsedJustification(Ee,f,le,Ue),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Ue,le),this.placedOrientations[le.crossTileID]=Ue),{shift:at,placedGlyphBoxes:rt}):void 0},Wa.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,M=w.bucket,I=w.layout,F=w.posMatrix,j=w.textLabelPlaneMatrix,J=w.labelToScreenMatrix,ye=w.textPixelRatio,le=w.holdingForFade,Ee=w.collisionBoxArray,Ue=w.partiallyEvaluatedTextSize,je=w.collisionGroup,nt=I.get("text-optional"),Ne=I.get("icon-optional"),at=I.get("text-allow-overlap"),rt=I.get("icon-allow-overlap"),be=I.get("text-rotation-alignment")==="map",or=I.get("text-pitch-alignment")==="map",$=I.get("icon-text-fit")!=="none",ur=I.get("symbol-z-order")==="viewport-y",Tr=at&&(rt||!M.hasIconData()||Ne),rn=rt&&(at||!M.hasTextData()||nt);!M.collisionArrays&&Ee&&M.deserializeCollisionBoxes(Ee);var Qr=function(wn,vi){if(!d[wn.crossTileID])if(le)g.placements[wn.crossTileID]=new Su(!1,!1,!1);else{var wi,mi=!1,ai=!1,Ai=!0,si=null,oi={box:null,offscreen:null},go={box:null,offscreen:null},to=null,Do=null,bo=0,Ya=0,lo=0;vi.textFeatureIndex?bo=vi.textFeatureIndex:wn.useRuntimeCollisionCircles&&(bo=wn.featureIndex),vi.verticalTextFeatureIndex&&(Ya=vi.verticalTextFeatureIndex);var Ls=vi.textBox;if(Ls){var ys=function(ma){var js=y.WritingMode.horizontal;if(M.allowVerticalPlacement&&!ma&&g.prevPlacement){var _s=g.prevPlacement.placedOrientations[wn.crossTileID];_s&&(g.placedOrientations[wn.crossTileID]=_s,g.markUsedOrientation(M,js=_s,wn))}return js},Vs=function(ma,js){if(M.allowVerticalPlacement&&wn.numVerticalGlyphVertices>0&&vi.verticalTextBox)for(var _s=0,al=M.writingModes;_s<al.length&&(al[_s]===y.WritingMode.vertical?(oi=js(),go=oi):oi=ma(),!(oi&&oi.box&&oi.box.length));_s+=1);else oi=ma()};if(I.get("text-variable-anchor")){var ss=I.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[wn.crossTileID]){var yu=g.prevPlacement.variableOffsets[wn.crossTileID];ss.indexOf(yu.anchor)>0&&(ss=ss.filter(function(ma){return ma!==yu.anchor})).unshift(yu.anchor)}var iu=function(ma,js,_s){for(var al=ma.x2-ma.x1,Yc=ma.y2-ma.y1,qc=wn.textBoxScale,Cf=$&&!rt?js:null,au={box:[],offscreen:!1},ol=at?2*ss.length:ss.length,ou=0;ou<ol;++ou){var Cl=g.attemptAnchorPlacement(ss[ou%ss.length],ma,al,Yc,qc,be,or,ye,F,je,ou>=ss.length,wn,M,_s,Cf);if(Cl&&(au=Cl.placedGlyphBoxes)&&au.box&&au.box.length){mi=!0,si=Cl.shift;break}}return au};Vs(function(){return iu(Ls,vi.iconBox,y.WritingMode.horizontal)},function(){var ma=vi.verticalTextBox;return M.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&wn.numVerticalGlyphVertices>0&&ma?iu(ma,vi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),oi&&(mi=oi.box,Ai=oi.offscreen);var bc=ys(oi&&oi.box);if(!mi&&g.prevPlacement){var il=g.prevPlacement.variableOffsets[wn.crossTileID];il&&(g.variableOffsets[wn.crossTileID]=il,g.markUsedJustification(M,il.anchor,wn,bc))}}else{var Xu=function(ma,js){var _s=g.collisionIndex.placeCollisionBox(ma,at,ye,F,je.predicate);return _s&&_s.box&&_s.box.length&&(g.markUsedOrientation(M,js,wn),g.placedOrientations[wn.crossTileID]=js),_s};Vs(function(){return Xu(Ls,y.WritingMode.horizontal)},function(){var ma=vi.verticalTextBox;return M.allowVerticalPlacement&&wn.numVerticalGlyphVertices>0&&ma?Xu(ma,y.WritingMode.vertical):{box:null,offscreen:null}}),ys(oi&&oi.box&&oi.box.length)}}if(mi=(wi=oi)&&wi.box&&wi.box.length>0,Ai=wi&&wi.offscreen,wn.useRuntimeCollisionCircles){var Fs=M.text.placedSymbolArray.get(wn.centerJustifiedTextSymbolIndex),Ql=y.evaluateSizeForFeature(M.textSizeData,Ue,Fs),Mu=I.get("text-padding");to=g.collisionIndex.placeCollisionCircles(at,Fs,M.lineVertexArray,M.glyphOffsetArray,Ql,F,j,J,h,or,je.predicate,wn.collisionCircleDiameter,Mu),mi=at||to.circles.length>0&&!to.collisionDetected,Ai=Ai&&to.offscreen}if(vi.iconFeatureIndex&&(lo=vi.iconFeatureIndex),vi.iconBox){var Jl=function(ma){var js=$&&si?Go(ma,si.x,si.y,be,or,g.transform.angle):ma;return g.collisionIndex.placeCollisionBox(js,rt,ye,F,je.predicate)};ai=go&&go.box&&go.box.length&&vi.verticalIconBox?(Do=Jl(vi.verticalIconBox)).box.length>0:(Do=Jl(vi.iconBox)).box.length>0,Ai=Ai&&Do.offscreen}var $u=nt||wn.numHorizontalGlyphVertices===0&&wn.numVerticalGlyphVertices===0,Bo=Ne||wn.numIconVertices===0;if($u||Bo?Bo?$u||(ai=ai&&mi):mi=ai&&mi:ai=mi=ai&&mi,mi&&wi&&wi.box&&g.collisionIndex.insertCollisionBox(wi.box,I.get("text-ignore-placement"),M.bucketInstanceId,go&&go.box&&Ya?Ya:bo,je.ID),ai&&Do&&g.collisionIndex.insertCollisionBox(Do.box,I.get("icon-ignore-placement"),M.bucketInstanceId,lo,je.ID),to&&(mi&&g.collisionIndex.insertCollisionCircles(to.circles,I.get("text-ignore-placement"),M.bucketInstanceId,bo,je.ID),h)){var ku=M.bucketInstanceId,Yu=g.collisionCircleArrays[ku];Yu===void 0&&(Yu=g.collisionCircleArrays[ku]=new Ao);for(var wl=0;wl<to.circles.length;wl+=4)Yu.circles.push(to.circles[wl+0]),Yu.circles.push(to.circles[wl+1]),Yu.circles.push(to.circles[wl+2]),Yu.circles.push(to.collisionDetected?1:0)}g.placements[wn.crossTileID]=new Su(mi||Tr,ai||rn,Ai||M.justReloaded),d[wn.crossTileID]=!0}};if(ur)for(var Sn=M.getSortedSymbolIndexes(this.transform.angle),Jn=Sn.length-1;Jn>=0;--Jn){var ei=Sn[Jn];Qr(M.symbolInstances.get(ei),M.collisionArrays[ei])}else for(var ni=f.symbolInstanceStart;ni<f.symbolInstanceEnd;ni++)Qr(M.symbolInstances.get(ni),M.collisionArrays[ni]);if(h&&M.bucketInstanceId in this.collisionCircleArrays){var ji=this.collisionCircleArrays[M.bucketInstanceId];y.invert(ji.invProjMatrix,F),ji.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1},Wa.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];M<I.length;M+=1){var F=I[M];F>=0&&(f.text.placedSymbolArray.get(F).crossTileID=w>=0&&F!==w?0:h.crossTileID)}},Wa.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];M<I.length;M+=1)f.text.placedSymbolArray.get(I[M]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},Wa.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},M=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(var F in this.placements){var j=this.placements[F],J=w[F];J?(this.opacities[F]=new Ko(J,g,j.text,j.icon),h=h||j.text!==J.text.placed||j.icon!==J.icon.placed):(this.opacities[F]=new Ko(null,g,j.text,j.icon,j.skipFade),h=h||j.text||j.icon)}for(var ye in w){var le=w[ye];if(!this.opacities[ye]){var Ee=new Ko(le,g,!1,!1);Ee.isHidden()||(this.opacities[ye]=Ee,h=h||le.text.placed||le.icon.placed)}}for(var Ue in M)this.variableOffsets[Ue]||!this.opacities[Ue]||this.opacities[Ue].isHidden()||(this.variableOffsets[Ue]=M[Ue]);for(var je in I)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=I[je]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Wa.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var M=w[g],I=M.getBucket(f);I&&M.latestFeatureIndex&&f.id===I.layerIds[0]&&this.updateBucketOpacities(I,h,M.collisionBoxArray)}},Wa.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,M=new Ko(null,0,!1,!1,!0),I=w.get("text-allow-overlap"),F=w.get("icon-allow-overlap"),j=w.get("text-variable-anchor"),J=w.get("text-rotation-alignment")==="map",ye=w.get("text-pitch-alignment")==="map",le=w.get("icon-text-fit")!=="none",Ee=new Ko(null,0,I&&(F||!f.hasIconData()||w.get("icon-optional")),F&&(I||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var Ue=function(at,rt,be){for(var or=0;or<rt/4;or++)at.opacityVertexArray.emplaceBack(be)},je=function(at){var rt=f.symbolInstances.get(at),be=rt.numHorizontalGlyphVertices,or=rt.numVerticalGlyphVertices,$=rt.crossTileID,ur=g.opacities[$];d[$]?ur=M:ur||(g.opacities[$]=ur=Ee),d[$]=!0;var Tr=rt.numIconVertices>0,rn=g.placedOrientations[rt.crossTileID],Qr=rn===y.WritingMode.vertical,Sn=rn===y.WritingMode.horizontal||rn===y.WritingMode.horizontalOnly;if(be>0||or>0){var Jn=jn(ur.text);Ue(f.text,be,Qr?Di:Jn),Ue(f.text,or,Sn?Di:Jn);var ei=ur.text.isHidden();[rt.rightJustifiedTextSymbolIndex,rt.centerJustifiedTextSymbolIndex,rt.leftJustifiedTextSymbolIndex].forEach(function(oi){oi>=0&&(f.text.placedSymbolArray.get(oi).hidden=ei||Qr?1:0)}),rt.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(rt.verticalPlacedTextSymbolIndex).hidden=ei||Sn?1:0);var ni=g.variableOffsets[rt.crossTileID];ni&&g.markUsedJustification(f,ni.anchor,rt,rn);var ji=g.placedOrientations[rt.crossTileID];ji&&(g.markUsedJustification(f,"left",rt,ji),g.markUsedOrientation(f,ji,rt))}if(Tr){var wn=jn(ur.icon),vi=!(le&&rt.verticalPlacedIconSymbolIndex&&Qr);rt.placedIconSymbolIndex>=0&&(Ue(f.icon,rt.numIconVertices,vi?wn:Di),f.icon.placedSymbolArray.get(rt.placedIconSymbolIndex).hidden=ur.icon.isHidden()),rt.verticalPlacedIconSymbolIndex>=0&&(Ue(f.icon,rt.numVerticalIconVertices,vi?Di:wn),f.icon.placedSymbolArray.get(rt.verticalPlacedIconSymbolIndex).hidden=ur.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var wi=f.collisionArrays[at];if(wi){var mi=new y.Point(0,0);if(wi.textBox||wi.verticalTextBox){var ai=!0;if(j){var Ai=g.variableOffsets[$];Ai?(mi=eo(Ai.anchor,Ai.width,Ai.height,Ai.textOffset,Ai.textBoxScale),J&&mi._rotate(ye?g.transform.angle:-g.transform.angle)):ai=!1}wi.textBox&&Ys(f.textCollisionBox.collisionVertexArray,ur.text.placed,!ai||Qr,mi.x,mi.y),wi.verticalTextBox&&Ys(f.textCollisionBox.collisionVertexArray,ur.text.placed,!ai||Sn,mi.x,mi.y)}var si=Boolean(!Sn&&wi.verticalIconBox);wi.iconBox&&Ys(f.iconCollisionBox.collisionVertexArray,ur.icon.placed,si,le?mi.x:0,le?mi.y:0),wi.verticalIconBox&&Ys(f.iconCollisionBox.collisionVertexArray,ur.icon.placed,!si,le?mi.x:0,le?mi.y:0)}}},nt=0;nt<f.symbolInstances.length;nt++)je(nt);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Ne=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Ne.invProjMatrix,f.placementViewportMatrix=Ne.viewportMatrix,f.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Wa.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wa.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Wa.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Wa.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Wa.prototype.setStale=function(){this.stale=!0};var Dl=Math.pow(2,25),Qo=Math.pow(2,24),ce=Math.pow(2,17),Ie=Math.pow(2,16),ft=Math.pow(2,9),Xt=Math.pow(2,8),Yr=Math.pow(2,1);function jn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Dl+d*Qo+h*ce+d*Ie+h*ft+d*Xt+h*Yr+d}var Di=0,so=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};so.prototype.continuePlacement=function(f,d,h,g,w){for(var M=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(M,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(function(I,F){return I.sortKey-F.sortKey}));this._currentPartIndex<M.length;)if(d.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var za=function(f,d,h,g,w,M,I){this.placement=new Wa(f,w,M,I),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};za.prototype.isDone=function(){return this._done},za.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),M=function(){var j=y.browser.now()-w;return!g._forceFullPlacement&&j>2};this._currentPlacementIndex>=0;){var I=d[f[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=F)&&(!I.maxzoom||I.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new so(I)),this._inProgressLayer.continuePlacement(h[I.source],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},za.prototype.commit=function(f){return this.placement.commit(f),this.placement};var Xa=512/y.EXTENT/2,Jo=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),M=w.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};Jo.prototype.getScaledCoordinates=function(f,d){var h=Xa/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},Jo.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var M=f.get(w);if(!M.crossTileID){var I=this.indexedSymbolInstances[M.key];if(I)for(var F=this.getScaledCoordinates(M,d),j=0,J=I;j<J.length;j+=1){var ye=J[j];if(Math.abs(ye.coord.x-F.x)<=g&&Math.abs(ye.coord.y-F.y)<=g&&!h[ye.crossTileID]){h[ye.crossTileID]=!0,M.crossTileID=ye.crossTileID;break}}}}};var Oo=function(){this.maxCrossTileID=0};Oo.prototype.generate=function(){return++this.maxCrossTileID};var vo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};vo.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var M in g){var I=g[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),w[I.tileID.key]=I}this.indexes[h]=w}this.lng=f},vo.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var M in this.indexes){var I=this.indexes[M];if(Number(M)>f.overscaledZ)for(var F in I){var j=I[F];j.tileID.isChildOf(f)&&j.findMatches(d.symbolInstances,f,w)}else{var J=I[f.scaledTo(Number(M)).key];J&&J.findMatches(d.symbolInstances,f,w)}}for(var ye=0;ye<d.symbolInstances.length;ye++){var le=d.symbolInstances.get(ye);le.crossTileID||(le.crossTileID=h.generate(),w[le.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new Jo(f,d.symbolInstances,d.bucketInstanceId),!0},vo.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},vo.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var Cs=function(){this.layerIndexes={},this.crossTileIDs=new Oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Cs.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new vo);var w=!1,M={};g.handleWrapJump(h);for(var I=0,F=d;I<F.length;I+=1){var j=F[I],J=j.getBucket(f);J&&f.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(j.tileID,J,this.crossTileIDs)&&(w=!0),M[J.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(w=!0),w},Cs.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var As=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},Ts=y.pick(yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),qs=y.pick(yt,["setCenter","setZoom","setBearing","setPitch"]),hu=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),ds=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new lr(Gt(),this),this.imageManager=new Nt,this.imageManager.setEventedParent(this),this.glyphManager=new sr(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new dt(256,512),this.crossTileSymbolIndex=new Cs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var M=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(I){M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},function(F,j){if(y.triggerPluginCompletionEvent(F),j&&j.every(function(ye){return ye}))for(var J in M.sourceCaches)M.sourceCaches[J].reload()})}),this.on("data",function(I){if(I.dataType==="source"&&I.sourceDataType==="metadata"){var F=w.sourceCaches[I.sourceId];if(F){var j=F.getSource();if(j&&j.vectorLayerIds)for(var J in w._layers){var ye=w._layers[J];ye.source===j.id&&w._validateLayer(ye)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var M=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var I=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(I,function(F,j){w._request=null,F?w.fire(new y.ErrorEvent(F)):j&&w._load(j,M)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(hu,!1)},d.prototype._load=function(h,g){if(!g||!As(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var M=nr(this.stylesheet.layers);this._order=M.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var I=0,F=M;I<F.length;I+=1){var j=F[I];(j=y.createStyleLayer(j)).setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j,this._serializedLayers[j.id]=j.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new jt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,M,I){var F,j,J,ye=y.browser.devicePixelRatio>1?"@2x":"",le=y.getJSON(M.transformRequest(M.normalizeSpriteURL(w,ye,".json"),y.ResourceType.SpriteJSON),function(je,nt){le=null,J||(J=je,F=nt,Ue())}),Ee=y.getImage(M.transformRequest(M.normalizeSpriteURL(w,ye,".png"),y.ResourceType.SpriteImage),function(je,nt){Ee=null,J||(J=je,j=nt,Ue())});function Ue(){if(J)I(J);else if(F&&j){var je=y.browser.getImageData(j),nt={};for(var Ne in F){var at=F[Ne],rt=at.width,be=at.height,or=at.x,$=at.y,ur=at.sdf,Tr=at.pixelRatio,rn=at.stretchX,Qr=at.stretchY,Sn=at.content,Jn=new y.RGBAImage({width:rt,height:be});y.RGBAImage.copy(je,Jn,{x:or,y:$},{x:0,y:0},{width:rt,height:be}),nt[Ne]={data:Jn,pixelRatio:Tr,sdf:ur,stretchX:rn,stretchY:Qr,content:Sn}}I(null,nt)}}return{cancel:function(){le&&(le.cancel(),le=null),Ee&&(Ee.cancel(),Ee=null)}}}(h,this.map._requestManager,function(w,M){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(M)for(var I in M)g.imageManager.addImage(I,M[I]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var M=g.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+M.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,M=h;w<M.length;w+=1){var I=this._layers[M[w]];I.type!=="custom"&&g.push(I.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);for(var I in(w.length||M.length)&&this._updateWorkerLayers(w,M),this._updatedSources){var F=this._updatedSources[I];F==="reload"?this._reloadSource(I):F==="clear"&&this._clearSource(I)}for(var j in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[j].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var J={};for(var ye in this.sourceCaches){var le=this.sourceCaches[ye];J[ye]=le.used,le.used=!1}for(var Ee=0,Ue=this._order;Ee<Ue.length;Ee+=1){var je=this._layers[Ue[Ee]];je.recalculate(h,this._availableImages),!je.isHidden(h.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var nt in J){var Ne=this.sourceCaches[nt];J[nt]!==Ne.used&&Ne.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),As(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=nr(h.layers);var w=function(I,F){if(!I)return[{command:yt.setStyle,args:[F]}];var j=[];try{if(!y.deepEqual(I.version,F.version))return[{command:yt.setStyle,args:[F]}];y.deepEqual(I.center,F.center)||j.push({command:yt.setCenter,args:[F.center]}),y.deepEqual(I.zoom,F.zoom)||j.push({command:yt.setZoom,args:[F.zoom]}),y.deepEqual(I.bearing,F.bearing)||j.push({command:yt.setBearing,args:[F.bearing]}),y.deepEqual(I.pitch,F.pitch)||j.push({command:yt.setPitch,args:[F.pitch]}),y.deepEqual(I.sprite,F.sprite)||j.push({command:yt.setSprite,args:[F.sprite]}),y.deepEqual(I.glyphs,F.glyphs)||j.push({command:yt.setGlyphs,args:[F.glyphs]}),y.deepEqual(I.transition,F.transition)||j.push({command:yt.setTransition,args:[F.transition]}),y.deepEqual(I.light,F.light)||j.push({command:yt.setLight,args:[F.light]});var J={},ye=[];(function(Ee,Ue,je,nt){var Ne;for(Ne in Ue=Ue||{},Ee=Ee||{})Ee.hasOwnProperty(Ne)&&(Ue.hasOwnProperty(Ne)||dn(Ne,je,nt));for(Ne in Ue)Ue.hasOwnProperty(Ne)&&(Ee.hasOwnProperty(Ne)?y.deepEqual(Ee[Ne],Ue[Ne])||(Ee[Ne].type==="geojson"&&Ue[Ne].type==="geojson"&&ua(Ee,Ue,Ne)?je.push({command:yt.setGeoJSONSourceData,args:[Ne,Ue[Ne].data]}):Pi(Ne,Ue,je,nt)):xi(Ne,Ue,je))})(I.sources,F.sources,ye,J);var le=[];I.layers&&I.layers.forEach(function(Ee){J[Ee.source]?j.push({command:yt.removeLayer,args:[Ee.id]}):le.push(Ee)}),j=j.concat(ye),function(Ee,Ue,je){Ue=Ue||[];var nt,Ne,at,rt,be,or,$,ur=(Ee=Ee||[]).map(_t),Tr=Ue.map(_t),rn=Ee.reduce(Ii,{}),Qr=Ue.reduce(Ii,{}),Sn=ur.slice(),Jn=Object.create(null);for(nt=0,Ne=0;nt<ur.length;nt++)Qr.hasOwnProperty(at=ur[nt])?Ne++:(je.push({command:yt.removeLayer,args:[at]}),Sn.splice(Sn.indexOf(at,Ne),1));for(nt=0,Ne=0;nt<Tr.length;nt++)Sn[Sn.length-1-nt]!==(at=Tr[Tr.length-1-nt])&&(rn.hasOwnProperty(at)?(je.push({command:yt.removeLayer,args:[at]}),Sn.splice(Sn.lastIndexOf(at,Sn.length-Ne),1)):Ne++,je.push({command:yt.addLayer,args:[Qr[at],or=Sn[Sn.length-nt]]}),Sn.splice(Sn.length-nt,0,at),Jn[at]=!0);for(nt=0;nt<Tr.length;nt++)if(rt=rn[at=Tr[nt]],be=Qr[at],!Jn[at]&&!y.deepEqual(rt,be))if(y.deepEqual(rt.source,be.source)&&y.deepEqual(rt["source-layer"],be["source-layer"])&&y.deepEqual(rt.type,be.type)){for($ in vt(rt.layout,be.layout,je,at,null,yt.setLayoutProperty),vt(rt.paint,be.paint,je,at,null,yt.setPaintProperty),y.deepEqual(rt.filter,be.filter)||je.push({command:yt.setFilter,args:[at,be.filter]}),y.deepEqual(rt.minzoom,be.minzoom)&&y.deepEqual(rt.maxzoom,be.maxzoom)||je.push({command:yt.setLayerZoomRange,args:[at,be.minzoom,be.maxzoom]}),rt)rt.hasOwnProperty($)&&$!=="layout"&&$!=="paint"&&$!=="filter"&&$!=="metadata"&&$!=="minzoom"&&$!=="maxzoom"&&($.indexOf("paint.")===0?vt(rt[$],be[$],je,at,$.slice(6),yt.setPaintProperty):y.deepEqual(rt[$],be[$])||je.push({command:yt.setLayerProperty,args:[at,$,be[$]]}));for($ in be)be.hasOwnProperty($)&&!rt.hasOwnProperty($)&&$!=="layout"&&$!=="paint"&&$!=="filter"&&$!=="metadata"&&$!=="minzoom"&&$!=="maxzoom"&&($.indexOf("paint.")===0?vt(rt[$],be[$],je,at,$.slice(6),yt.setPaintProperty):y.deepEqual(rt[$],be[$])||je.push({command:yt.setLayerProperty,args:[at,$,be[$]]}))}else je.push({command:yt.removeLayer,args:[at]}),or=Sn[Sn.lastIndexOf(at)+1],je.push({command:yt.addLayer,args:[be,or]})}(le,F.layers,j)}catch(Ee){console.warn("Unable to compute style diff:",Ee),j=[{command:yt.setStyle,args:[F]}]}return j}(this.serialize(),h).filter(function(I){return!(I.command in qs)});if(w.length===0)return!1;var M=w.filter(function(I){return!(I.command in Ts)});if(M.length>0)throw new Error("Unimplemented: "+M.map(function(I){return I.command}).join(", ")+".");return w.forEach(function(I){I.command!=="setTransition"&&g[I.command].apply(g,I.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var M=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var I=this.sourceCaches[h]=new We(h,g,this.dispatcher);I.style=this,I.setEventedParent(this,function(){return{isSourceLoaded:M.loaded(),source:I.serialize(),sourceId:h}}),I.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=h.id;if(this.getLayer(M))this.fire(new y.ErrorEvent(new Error('Layer with id "'+M+'" already exists on this map')));else{var I;if(h.type==="custom"){if(As(this,y.validateCustomStyleLayer(h)))return;I=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(M,h.source),h=y.clone$1(h),h=y.extend(h,{source:M})),this._validate(y.validateStyle.layer,"layers."+M,h,{arrayIndex:-1},w))return;I=y.createStyleLayer(h),this._validateLayer(I),I.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[I.id]=I.serialize()}var F=g?this._order.indexOf(g):this._order.length;if(g&&F===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(F,0,M),this._layerOrderChanged=!0,this._layers[M]=I,this._removedLayers[M]&&I.source&&I.type!=="custom"){var j=this._removedLayers[M];delete this._removedLayers[M],j.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var M=g?this._order.indexOf(g):this._order.length;g&&M===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(M,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var M=this.getLayer(h);M?M.minzoom===g&&M.maxzoom===w||(g!=null&&(M.minzoom=g),w!=null&&(M.maxzoom=w),this._updateLayer(M)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(h);if(M){if(!y.deepEqual(M.filter,g))return g==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(y.validateStyle.filter,"layers."+M.id+".filter",g,null,w)||(M.filter=y.clone$1(g),this._updateLayer(M)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getLayoutProperty(g),w)||(I.setLayoutProperty(g,w,M),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getPaintProperty(g),w)||(I.setPaintProperty(g,w,M)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=h.sourceLayer,I=this.sourceCaches[w];if(I!==void 0){var F=I.getSource().type;F==="geojson"&&M?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||M?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.setFeatureState(M,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=this.sourceCaches[w];if(M!==void 0){var I=M.getSource().type,F=I==="vector"?h.sourceLayer:void 0;I!=="vector"||F?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(F,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,M=this.sourceCaches[g];if(M!==void 0){if(M.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),M.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(rn){return g._layers[rn].type==="fill-extrusion"},M={},I=[],F=this._order.length-1;F>=0;F--){var j=this._order[F];if(w(j)){M[j]=F;for(var J=0,ye=h;J<ye.length;J+=1){var le=ye[J][j];if(le)for(var Ee=0,Ue=le;Ee<Ue.length;Ee+=1)I.push(Ue[Ee])}}}I.sort(function(rn,Qr){return Qr.intersectionZ-rn.intersectionZ});for(var je=[],nt=this._order.length-1;nt>=0;nt--){var Ne=this._order[nt];if(w(Ne))for(var at=I.length-1;at>=0;at--){var rt=I[at].feature;if(M[rt.layer.id]<nt)break;je.push(rt),I.pop()}else for(var be=0,or=h;be<or.length;be+=1){var $=or[be][Ne];if($)for(var ur=0,Tr=$;ur<Tr.length;ur+=1)je.push(Tr[ur].feature)}}return je},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var I=0,F=g.layers;I<F.length;I+=1){var j=F[I],J=this._layers[j];if(!J)return this.fire(new y.ErrorEvent(new Error("The layer '"+j+"' does not exist in the map's style and cannot be queried for features."))),[];M[J.source]=!0}}var ye=[];for(var le in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!M[le]||ye.push(en(this.sourceCaches[le],this._layers,this._serializedLayers,h,g,w));return this.placement&&ye.push(function(Ee,Ue,je,nt,Ne,at,rt){for(var be={},or=at.queryRenderedSymbols(nt),$=[],ur=0,Tr=Object.keys(or).map(Number);ur<Tr.length;ur+=1)$.push(rt[Tr[ur]]);$.sort(Ci);for(var rn=function(){var ni=Sn[Qr],ji=ni.featureIndex.lookupSymbolFeatures(or[ni.bucketInstanceId],Ue,ni.bucketIndex,ni.sourceLayerIndex,Ne.filter,Ne.layers,Ne.availableImages,Ee);for(var wn in ji){var vi=be[wn]=be[wn]||[],wi=ji[wn];wi.sort(function(Ai,si){var oi=ni.featureSortOrder;if(oi){var go=oi.indexOf(Ai.featureIndex);return oi.indexOf(si.featureIndex)-go}return si.featureIndex-Ai.featureIndex});for(var mi=0,ai=wi;mi<ai.length;mi+=1)vi.push(ai[mi])}},Qr=0,Sn=$;Qr<Sn.length;Qr+=1)rn();var Jn=function(ni){be[ni].forEach(function(ji){var wn=ji.feature,vi=je[Ee[ni].source].getFeatureState(wn.layer["source-layer"],wn.id);wn.source=wn.layer.source,wn.layer["source-layer"]&&(wn.sourceLayer=wn.layer["source-layer"]),wn.state=vi})};for(var ei in be)Jn(ei);return be}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ye)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(M,I){for(var F=M.getRenderableIds().map(function(Ue){return M.getTileByID(Ue)}),j=[],J={},ye=0;ye<F.length;ye++){var le=F[ye],Ee=le.tileID.canonical.key;J[Ee]||(J[Ee]=!0,le.querySourceFeatures(j,I))}return j}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),M=!1;for(var I in h)if(!y.deepEqual(h[I],w[I])){M=!0;break}if(M){var F={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(F)}},d.prototype._validate=function(h,g,w,M,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&As(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},M)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,M,I){I===void 0&&(I=!1);for(var F=!1,j=!1,J={},ye=0,le=this._order;ye<le.length;ye+=1){var Ee=this._layers[le[ye]];if(Ee.type==="symbol"){if(!J[Ee.source]){var Ue=this.sourceCaches[Ee.source];J[Ee.source]=Ue.getRenderableIds(!0).map(function(rt){return Ue.getTileByID(rt)}).sort(function(rt,be){return be.tileID.overscaledZ-rt.tileID.overscaledZ||(rt.tileID.isLessThan(be.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Ee,J[Ee.source],h.center.lng);F=F||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new za(h,this._order,I,g,w,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),j=!0),F&&this.pauseablePlacement.placement.setStale()),j||F)for(var nt=0,Ne=this._order;nt<Ne.length;nt+=1){var at=this._layers[Ne[nt]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,J[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var M=this.sourceCaches[g.source];M&&M.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);ds.getSourceType=function(f){return br[f]},ds.setSourceType=function(f,d){br[f]=d},ds.registerForPluginStateChange=y.registerForPluginStateChange;var Zi=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ia=Yi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Bc=Yi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hf=Yi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ms=Yi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),pf=Yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hl=Yi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Qu=Yi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=Yi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Bl=Yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=Yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=Yi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),z=Yi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Yi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),te=Yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Me=Yi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),st=Yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Rt=Yi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ot=Yi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),yr=Yi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Lr=Yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Gn=Yi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Qn=Yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),pi=Yi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),$i=Yi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ca=Yi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ra=Yi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Yi(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=M?M.concat(w):w,F={};return{fragmentSource:f=f.replace(h,function(j,J,ye,le,Ee){return F[Ee]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ye+" "+le+" "+Ee+`;
#else
uniform `+ye+" "+le+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ye+" "+le+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:d=d.replace(h,function(j,J,ye,le,Ee){var Ue=le==="float"?"vec2":"vec4",je=Ee.match(/color/)?"color":Ue;return F[Ee]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ye+" "+Ue+" a_"+Ee+`;
varying `+ye+" "+le+" "+Ee+`;
#else
uniform `+ye+" "+le+" u_"+Ee+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ye+" "+le+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+je+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ye+" "+le+" "+Ee+" = u_"+Ee+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ye+" "+Ue+" a_"+Ee+`;
#else
uniform `+ye+" "+le+" u_"+Ee+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ye+" "+le+" "+Ee+" = a_"+Ee+`;
#else
    `+ye+" "+le+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ye+" "+le+" "+Ee+" = unpack_mix_"+je+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ye+" "+le+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:g,staticUniforms:I}}var vs=Object.freeze({__proto__:null,prelude:Ia,background:Bc,backgroundPattern:hf,circle:Ms,clippingMask:pf,heatmap:hl,heatmapTexture:Qu,collisionBox:Ks,collisionCircle:Bl,debug:b,fill:k,fillOutline:z,fillOutlinePattern:R,fillPattern:te,fillExtrusion:Me,fillExtrusionPattern:st,hillshadePrepare:Rt,hillshade:Ot,line:yr,lineGradient:Lr,linePattern:Gn,lineSDF:Qn,raster:pi,symbolIcon:$i,symbolSDF:Ca,symbolTextAndIcon:Ra}),pu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function pl(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}pu.prototype.bind=function(f,d,h,g,w,M,I,F){this.context=f;for(var j=this.boundPaintVertexBuffers.length!==g.length,J=0;!j&&J<g.length;J++)this.boundPaintVertexBuffers[J]!==g[J]&&(j=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!j&&this.boundIndexBuffer===w&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===F?(f.bindVertexArrayOES.set(this.vao),I&&I.bind(),w&&w.dynamicDraw&&w.bind(),F&&F.bind()):this.freshBind(d,h,g,w,M,I,F)},pu.prototype.freshBind=function(f,d,h,g,w,M,I){var F,j=f.numAttributes,J=this.context,ye=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=I;else{F=J.currentNumAttributes||0;for(var le=j;le<F;le++)ye.disableVertexAttribArray(le)}d.enableAttributes(ye,f);for(var Ee=0,Ue=h;Ee<Ue.length;Ee+=1)Ue[Ee].enableAttributes(ye,f);M&&M.enableAttributes(ye,f),I&&I.enableAttributes(ye,f),d.bind(),d.setVertexAttribPointers(ye,f,w);for(var je=0,nt=h;je<nt.length;je+=1){var Ne=nt[je];Ne.bind(),Ne.setVertexAttribPointers(ye,f,w)}M&&(M.bind(),M.setVertexAttribPointers(ye,f,w)),g&&g.bind(),I&&(I.bind(),I.setVertexAttribPointers(ye,f,w)),J.currentNumAttributes=j},pu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var df=function(f,d,h,g,w,M){var I=f.gl;this.program=I.createProgram();for(var F=pl(h.staticAttributes),j=g?g.getBinderAttributes():[],J=F.concat(j),ye=h.staticUniforms?pl(h.staticUniforms):[],le=g?g.getBinderUniforms():[],Ee=[],Ue=0,je=ye.concat(le);Ue<je.length;Ue+=1){var nt=je[Ue];Ee.indexOf(nt)<0&&Ee.push(nt)}var Ne=g?g.defines():[];M&&Ne.push("#define OVERDRAW_INSPECTOR;");var at=Ne.concat(Ia.fragmentSource,h.fragmentSource).join(`
`),rt=Ne.concat(Ia.vertexSource,h.vertexSource).join(`
`),be=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(be,at),I.compileShader(be),I.attachShader(this.program,be);var or=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(or,rt),I.compileShader(or),I.attachShader(this.program,or),this.attributes={};var $={};this.numAttributes=J.length;for(var ur=0;ur<this.numAttributes;ur++)J[ur]&&(I.bindAttribLocation(this.program,ur,J[ur]),this.attributes[J[ur]]=ur);I.linkProgram(this.program),I.deleteShader(or),I.deleteShader(be);for(var Tr=0;Tr<Ee.length;Tr++){var rn=Ee[Tr];if(rn&&!$[rn]){var Qr=I.getUniformLocation(this.program,rn);Qr&&($[rn]=Qr)}}this.fixedUniforms=w(f,$),this.binderUniforms=g?g.getUniforms(f,$):[]}}};function dl(f,d,h){var g=1/ca(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),M=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,I=M*(h.tileID.canonical.x+h.tileID.wrap*w),F=M*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[I>>16,F>>16],u_pixel_coord_lower:[65535&I,65535&F]}}df.prototype.draw=function(f,d,h,g,w,M,I,F,j,J,ye,le,Ee,Ue,je,nt){var Ne,at=f.gl;if(!this.failedToCreate){for(var rt in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(M),this.fixedUniforms)this.fixedUniforms[rt].set(I[rt]);Ue&&Ue.setUniforms(f,this.binderUniforms,le,{zoom:Ee});for(var be=(Ne={},Ne[at.LINES]=2,Ne[at.TRIANGLES]=3,Ne[at.LINE_STRIP]=1,Ne)[d],or=0,$=ye.get();or<$.length;or+=1){var ur=$[or],Tr=ur.vaos||(ur.vaos={});(Tr[F]||(Tr[F]=new pu)).bind(f,this,j,Ue?Ue.getPaintVertexBuffers():[],J,ur.vertexOffset,je,nt),at.drawElements(d,ur.primitiveLength*be,at.UNSIGNED_SHORT,ur.primitiveOffset*be*2)}}};var Nc=function(f,d,h,g){var w=d.style.light,M=w.properties.get("position"),I=[M.x,M.y,M.z],F=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(F,-d.transform.angle),y.transformMat3(I,I,F);var j=w.properties.get("color");return{u_matrix:f,u_lightpos:I,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+h,u_opacity:g}},Nu=function(f,d,h,g,w,M,I){return y.extend(Nc(f,d,h,g),dl(M,d,I),{u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8})},zu=function(f){return{u_matrix:f}},Zu=function(f,d,h,g){return y.extend(zu(f),dl(h,d,g))},mo=function(f,d){return{u_matrix:f,u_world:d}},Xf=function(f,d,h,g,w){return y.extend(Zu(f,d,h,g),{u_world:w})},zc=function(f,d,h,g){var w,M,I=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var F=ca(h,1,I.zoom);w=!0,M=[F,F]}else w=!1,M=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:M}},ms=function(f,d,h){var g=ca(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),M=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:M}},vf=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Ju=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},Qs=function(f){return{u_matrix:f}},$f=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:ca(d,1,h),u_intensity:g}},Ns=function(f,d,h){var g=f.transform;return{u_matrix:Zc(f,d,h),u_ratio:1/ca(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ka=function(f,d,h,g){return y.extend(Ns(f,d,h),{u_image:0,u_image_height:g})},Nl=function(f,d,h,g){var w=f.transform,M=Uu(d,w);return{u_matrix:Zc(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/ca(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[M,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Ah=function(f,d,h,g,w){var M=f.lineAtlas,I=Uu(d,f.transform),F=h.layout.get("line-cap")==="round",j=M.getDash(g.from,F),J=M.getDash(g.to,F),ye=j.width*w.fromScale,le=J.width*w.toScale;return y.extend(Ns(f,d,h),{u_patternscale_a:[I/ye,-j.height/2],u_patternscale_b:[I/le,-J.height/2],u_sdfgamma:M.width/(256*Math.min(ye,le)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:J.y,u_mix:w.t})};function Uu(f,d){return 1/ca(f,1,d.tileZoom)}function Zc(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var up=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(I=w.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(M=w.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:lp(w.paint.get("raster-hue-rotate"))};var M,I};function lp(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var Yf,Uc=function(f,d,h,g,w,M,I,F,j,J){var ye=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ye.width/ye.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:I,u_coord_matrix:F,u_is_text:+j,u_pitch_with_map:+g,u_texsize:J,u_texture:0}},fc=function(f,d,h,g,w,M,I,F,j,J,ye){var le=w.transform;return y.extend(Uc(f,d,h,g,w,M,I,F,j,J),{u_gamma_scale:g?Math.cos(le._pitch)*le.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+ye})},zl=function(f,d,h,g,w,M,I,F,j,J){return y.extend(fc(f,d,h,g,w,M,I,F,!0,j,!0),{u_texsize_icon:J,u_texture_icon:1})},Zl=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},vl=function(f,d,h,g,w,M){return y.extend(function(I,F,j,J){var ye=j.imageManager.getPattern(I.from.toString()),le=j.imageManager.getPattern(I.to.toString()),Ee=j.imageManager.getPixelSize(),Ue=Ee.width,je=Ee.height,nt=Math.pow(2,J.tileID.overscaledZ),Ne=J.tileSize*Math.pow(2,j.transform.tileZoom)/nt,at=Ne*(J.tileID.canonical.x+J.tileID.wrap*nt),rt=Ne*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:le.tl,u_pattern_br_b:le.br,u_texsize:[Ue,je],u_mix:F.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:le.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/ca(J,1,j.transform.tileZoom),u_pixel_coord_upper:[at>>16,rt>>16],u_pixel_coord_lower:[65535&at,65535&rt]}}(g,M,h,w),{u_matrix:f,u_opacity:d})},ml={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function gl(f,d,h,g,w,M,I){for(var F=f.context,j=F.gl,J=f.useProgram("collisionBox"),ye=[],le=0,Ee=0,Ue=0;Ue<g.length;Ue++){var je=g[Ue],nt=d.getTile(je),Ne=nt.getBucket(h);if(Ne){var at=je.posMatrix;w[0]===0&&w[1]===0||(at=f.translatePosMatrix(je.posMatrix,nt,w,M));var rt=I?Ne.textCollisionBox:Ne.iconCollisionBox,be=Ne.collisionCircleArray;if(be.length>0){var or=y.create(),$=at;y.mul(or,Ne.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(or,or,Ne.placementViewportMatrix),ye.push({circleArray:be,circleOffset:Ee,transform:$,invTransform:or}),Ee=le+=be.length/4}rt&&J.draw(F,j.LINES,we.disabled,Ze.disabled,f.colorModeForRenderPass(),pt.disabled,ms(at,f.transform,nt),h.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,f.transform.zoom,null,null,rt.collisionVertexBuffer)}}if(I&&ye.length){var ur=f.useProgram("collisionCircle"),Tr=new y.StructArrayLayout2f1f2i16;Tr.resize(4*le),Tr._trim();for(var rn=0,Qr=0,Sn=ye;Qr<Sn.length;Qr+=1)for(var Jn=Sn[Qr],ei=0;ei<Jn.circleArray.length/4;ei++){var ni=4*ei,ji=Jn.circleArray[ni+0],wn=Jn.circleArray[ni+1],vi=Jn.circleArray[ni+2],wi=Jn.circleArray[ni+3];Tr.emplace(rn++,ji,wn,vi,wi,0),Tr.emplace(rn++,ji,wn,vi,wi,1),Tr.emplace(rn++,ji,wn,vi,wi,2),Tr.emplace(rn++,ji,wn,vi,wi,3)}(!Yf||Yf.length<2*le)&&(Yf=function(to){var Do=2*to,bo=new y.StructArrayLayout3ui6;bo.resize(Do),bo._trim();for(var Ya=0;Ya<Do;Ya++){var lo=6*Ya;bo.uint16[lo+0]=4*Ya+0,bo.uint16[lo+1]=4*Ya+1,bo.uint16[lo+2]=4*Ya+2,bo.uint16[lo+3]=4*Ya+2,bo.uint16[lo+4]=4*Ya+3,bo.uint16[lo+5]=4*Ya+0}return bo}(le));for(var mi=F.createIndexBuffer(Yf,!0),ai=F.createVertexBuffer(Tr,y.collisionCircleLayout.members,!0),Ai=0,si=ye;Ai<si.length;Ai+=1){var oi=si[Ai],go=vf(oi.transform,oi.invTransform,f.transform);ur.draw(F,j.TRIANGLES,we.disabled,Ze.disabled,f.colorModeForRenderPass(),pt.disabled,go,h.id,ai,mi,y.SegmentVector.simpleSegment(0,2*oi.circleOffset,oi.circleArray.length,oi.circleArray.length/2),null,f.transform.zoom,null,null,null)}ai.destroy(),mi.destroy()}}var Js=y.identity(new Float32Array(16));function mf(f,d,h,g,w,M){var I=y.getAnchorAlignment(f),F=-(I.horizontalAlign-.5)*d,j=-(I.verticalAlign-.5)*h,J=y.evaluateVariableOffset(f,g);return new y.Point((F/w+J[0])*M,(j/w+J[1])*M)}function gf(f,d,h,g,w,M,I,F,j,J,ye){var le=f.text.placedSymbolArray,Ee=f.text.dynamicLayoutVertexArray,Ue=f.icon.dynamicLayoutVertexArray,je={};Ee.clear();for(var nt=0;nt<le.length;nt++){var Ne=le.get(nt),at=Ne.hidden||!Ne.crossTileID||f.allowVerticalPlacement&&!Ne.placedOrientation?null:g[Ne.crossTileID];if(at){var rt=new y.Point(Ne.anchorX,Ne.anchorY),be=Fi(rt,h?F:I),or=pr(M.cameraToCenterDistance,be.signedDistanceFromCamera),$=w.evaluateSizeForFeature(f.textSizeData,J,Ne)*or/y.ONE_EM;h&&($*=f.tilePixelRatio/j);for(var ur=mf(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,$),Tr=h?Fi(rt.add(ur),I).point:be.point.add(d?ur.rotate(-M.angle):ur),rn=f.allowVerticalPlacement&&Ne.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<Ne.numGlyphs;Qr++)y.addDynamicAttributes(Ee,Tr,rn);ye&&Ne.associatedIconIndex>=0&&(je[Ne.associatedIconIndex]={shiftedAnchor:Tr,angle:rn})}else Qa(Ne.numGlyphs,Ee)}if(ye){Ue.clear();for(var Sn=f.icon.placedSymbolArray,Jn=0;Jn<Sn.length;Jn++){var ei=Sn.get(Jn);if(ei.hidden)Qa(ei.numGlyphs,Ue);else{var ni=je[Jn];if(ni)for(var ji=0;ji<ei.numGlyphs;ji++)y.addDynamicAttributes(Ue,ni.shiftedAnchor,ni.angle);else Qa(ei.numGlyphs,Ue)}}f.icon.dynamicLayoutVertexBuffer.updateData(Ue)}f.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Ul(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function yl(f,d,h,g,w,M,I,F,j,J,ye,le){for(var Ee=f.context,Ue=Ee.gl,je=f.transform,nt=F==="map",Ne=j==="map",at=nt&&h.layout.get("symbol-placement")!=="point",rt=nt&&!Ne&&!at,be=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,or=!1,$=f.depthModeForSublayer(0,we.ReadOnly),ur=h.layout.get("text-variable-anchor"),Tr=[],rn=0,Qr=g;rn<Qr.length;rn+=1){var Sn=Qr[rn],Jn=d.getTile(Sn),ei=Jn.getBucket(h);if(ei){var ni=w?ei.text:ei.icon;if(ni&&ni.segments.get().length){var ji=ni.programConfigurations.get(h.id),wn=w||ei.sdfIcons,vi=w?ei.textSizeData:ei.iconSizeData,wi=Ne||je.pitch!==0,mi=f.useProgram(Ul(wn,w,ei),ji),ai=y.evaluateSizeForZoom(vi,je.zoom),Ai=void 0,si=[0,0],oi=void 0,go=void 0,to=null,Do=void 0;if(w)oi=Jn.glyphAtlasTexture,go=Ue.LINEAR,Ai=Jn.glyphAtlasTexture.size,ei.iconsInText&&(si=Jn.imageAtlasTexture.size,to=Jn.imageAtlasTexture,Do=wi||f.options.rotating||f.options.zooming||vi.kind==="composite"||vi.kind==="camera"?Ue.LINEAR:Ue.NEAREST);else{var bo=h.layout.get("icon-size").constantOr(0)!==1||ei.iconsNeedLinear;oi=Jn.imageAtlasTexture,go=wn||f.options.rotating||f.options.zooming||bo||wi?Ue.LINEAR:Ue.NEAREST,Ai=Jn.imageAtlasTexture.size}var Ya=ca(Jn,1,f.transform.zoom),lo=Qi(Sn.posMatrix,Ne,nt,f.transform,Ya),Ls=la(Sn.posMatrix,Ne,nt,f.transform,Ya),ys=ur&&ei.hasTextData(),Vs=h.layout.get("icon-text-fit")!=="none"&&ys&&ei.hasIconData();at&&Ye(ei,Sn.posMatrix,f,w,lo,Ls,Ne,J);var ss=f.translatePosMatrix(Sn.posMatrix,Jn,M,I),yu=at||w&&ur||Vs?Js:lo,iu=f.translatePosMatrix(Ls,Jn,M,I,!0),bc=wn&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,il={program:mi,buffers:ni,uniformValues:wn?ei.iconsInText?zl(vi.kind,ai,rt,Ne,f,ss,yu,iu,Ai,si):fc(vi.kind,ai,rt,Ne,f,ss,yu,iu,w,Ai,!0):Uc(vi.kind,ai,rt,Ne,f,ss,yu,iu,w,Ai),atlasTexture:oi,atlasTextureIcon:to,atlasInterpolation:go,atlasInterpolationIcon:Do,isSDF:wn,hasHalo:bc};if(be&&ei.canOverlap){or=!0;for(var Xu=0,Fs=ni.segments.get();Xu<Fs.length;Xu+=1){var Ql=Fs[Xu];Tr.push({segments:new y.SegmentVector([Ql]),sortKey:Ql.sortKey,state:il})}}else Tr.push({segments:ni.segments,sortKey:0,state:il})}}}or&&Tr.sort(function(Yu,wl){return Yu.sortKey-wl.sortKey});for(var Mu=0,Jl=Tr;Mu<Jl.length;Mu+=1){var $u=Jl[Mu],Bo=$u.state;if(Ee.activeTexture.set(Ue.TEXTURE0),Bo.atlasTexture.bind(Bo.atlasInterpolation,Ue.CLAMP_TO_EDGE),Bo.atlasTextureIcon&&(Ee.activeTexture.set(Ue.TEXTURE1),Bo.atlasTextureIcon&&Bo.atlasTextureIcon.bind(Bo.atlasInterpolationIcon,Ue.CLAMP_TO_EDGE)),Bo.isSDF){var ku=Bo.uniformValues;Bo.hasHalo&&(ku.u_is_halo=1,hc(Bo.buffers,$u.segments,h,f,Bo.program,$,ye,le,ku)),ku.u_is_halo=0}hc(Bo.buffers,$u.segments,h,f,Bo.program,$,ye,le,Bo.uniformValues)}}function hc(f,d,h,g,w,M,I,F,j){var J=g.context;w.draw(J,J.gl.TRIANGLES,M,I,F,pt.disabled,j,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Vc(f,d,h,g,w,M,I){var F,j,J,ye,le,Ee=f.context.gl,Ue=h.paint.get("fill-pattern"),je=Ue&&Ue.constantOr(1),nt=h.getCrossfadeParameters();I?(j=je&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=Ee.LINES):(j=je?"fillPattern":"fill",F=Ee.TRIANGLES);for(var Ne=0,at=g;Ne<at.length;Ne+=1){var rt=at[Ne],be=d.getTile(rt);if(!je||be.patternsLoaded()){var or=be.getBucket(h);if(or){var $=or.programConfigurations.get(h.id),ur=f.useProgram(j,$);je&&(f.context.activeTexture.set(Ee.TEXTURE0),be.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),$.updatePaintBuffers(nt));var Tr=Ue.constantOr(null);if(Tr&&be.imageAtlas){var rn=be.imageAtlas,Qr=rn.patternPositions[Tr.to.toString()],Sn=rn.patternPositions[Tr.from.toString()];Qr&&Sn&&$.setConstantPatternPositions(Qr,Sn)}var Jn=f.translatePosMatrix(rt.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ye=or.indexBuffer2,le=or.segments2;var ei=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];J=j==="fillOutlinePattern"&&je?Xf(Jn,f,nt,be,ei):mo(Jn,ei)}else ye=or.indexBuffer,le=or.segments,J=je?Zu(Jn,f,nt,be):zu(Jn);ur.draw(f.context,F,w,f.stencilModeForClipping(rt),M,pt.disabled,J,h.id,or.layoutVertexBuffer,ye,le,h.paint,f.transform.zoom,$)}}}}function pc(f,d,h,g,w,M,I){for(var F=f.context,j=F.gl,J=h.paint.get("fill-extrusion-pattern"),ye=J.constantOr(1),le=h.getCrossfadeParameters(),Ee=h.paint.get("fill-extrusion-opacity"),Ue=0,je=g;Ue<je.length;Ue+=1){var nt=je[Ue],Ne=d.getTile(nt),at=Ne.getBucket(h);if(at){var rt=at.programConfigurations.get(h.id),be=f.useProgram(ye?"fillExtrusionPattern":"fillExtrusion",rt);ye&&(f.context.activeTexture.set(j.TEXTURE0),Ne.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),rt.updatePaintBuffers(le));var or=J.constantOr(null);if(or&&Ne.imageAtlas){var $=Ne.imageAtlas,ur=$.patternPositions[or.to.toString()],Tr=$.patternPositions[or.from.toString()];ur&&Tr&&rt.setConstantPatternPositions(ur,Tr)}var rn=f.translatePosMatrix(nt.posMatrix,Ne,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Qr=h.paint.get("fill-extrusion-vertical-gradient"),Sn=ye?Nu(rn,f,Qr,Ee,nt,le,Ne):Nc(rn,f,Qr,Ee);be.draw(F,F.gl.TRIANGLES,w,M,I,pt.backCCW,Sn,h.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,h.paint,f.transform.zoom,rt)}}}function yf(f,d,h,g,w,M){var I=f.context,F=I.gl,j=d.fbo;if(j){var J=f.useProgram("hillshade");I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,j.colorAttachment.get());var ye=function(le,Ee,Ue){var je=Ue.paint.get("hillshade-shadow-color"),nt=Ue.paint.get("hillshade-highlight-color"),Ne=Ue.paint.get("hillshade-accent-color"),at=Ue.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ue.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=le.transform.angle);var rt,be,or,$=!le.options.moving;return{u_matrix:le.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),$),u_image:0,u_latrange:(rt=Ee.tileID,be=Math.pow(2,rt.canonical.z),or=rt.canonical.y,[new y.MercatorCoordinate(0,or/be).toLngLat().lat,new y.MercatorCoordinate(0,(or+1)/be).toLngLat().lat]),u_light:[Ue.paint.get("hillshade-exaggeration"),at],u_shadow:je,u_highlight:nt,u_accent:Ne}}(f,d,h);J.draw(I,F.TRIANGLES,g,w,M,pt.disabled,ye,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function cp(f,d,h,g,w,M){var I=f.context,F=I.gl,j=d.dem;if(j&&j.data){var J=j.dim,ye=j.stride,le=j.getPixels();if(I.activeTexture.set(F.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(ye),d.demTexture){var Ee=d.demTexture;Ee.update(le,{premultiply:!1}),Ee.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(I,le,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);I.activeTexture.set(F.TEXTURE0);var Ue=d.fbo;if(!Ue){var je=new y.Texture(I,{width:J,height:J,data:null},F.RGBA);je.bind(F.LINEAR,F.CLAMP_TO_EDGE),(Ue=d.fbo=I.createFramebuffer(J,J,!0)).colorAttachment.set(je.texture)}I.bindFramebuffer.set(Ue.framebuffer),I.viewport.set([0,0,J,J]),f.useProgram("hillshadePrepare").draw(I,F.TRIANGLES,g,w,M,pt.disabled,function(nt,Ne){var at=Ne.stride,rt=y.create();return y.ortho(rt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(rt,rt,[0,-y.EXTENT,0]),{u_matrix:rt,u_image:1,u_dimension:[at,at],u_zoom:nt.overscaledZ,u_unpack:Ne.getUnpackVector()}}(d.tileID,j),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function _f(f,d,h,g,w){var M=g.paint.get("raster-fade-duration");if(M>0){var I=y.browser.now(),F=(I-f.timeAdded)/M,j=d?(I-d.timeAdded)/M:-1,J=h.getSource(),ye=w.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),le=!d||Math.abs(d.tileID.overscaledZ-ye)>Math.abs(f.tileID.overscaledZ-ye),Ee=le&&f.refreshedUponExpiration?1:y.clamp(le?F:1-j,0,1);return f.refreshedUponExpiration&&F>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var _l=new y.Color(1,0,0,1),xf=new y.Color(0,1,0,1),qf=new y.Color(0,0,1,1),Vu=new y.Color(1,0,1,1),Th=new y.Color(0,1,1,1);function Mh(f,d,h,g){Vl(f,0,d+h/2,f.transform.width,h,g)}function kh(f,d,h,g){Vl(f,d-h/2,0,h,f.transform.height,g)}function Vl(f,d,h,g,w,M){var I=f.context,F=I.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),I.clear({color:M}),F.disable(F.SCISSOR_TEST)}function Ih(f,d,h){var g=f.context,w=g.gl,M=h.posMatrix,I=f.useProgram("debug"),F=we.disabled,j=Ze.disabled,J=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),I.draw(g,w.LINE_STRIP,F,j,J,pt.disabled,Ju(M,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var ye=d.getTileByID(h.key).latestRawTileData,le=Math.floor((ye&&ye.byteLength||0)/1024),Ee=d.getTile(h).tileSize,Ue=512/Math.min(Ee,512)*(h.overscaledZ/f.transform.zoom)*.5,je=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(je+=" => "+h.overscaledZ),function(nt,Ne){nt.initDebugOverlayCanvas();var at=nt.debugOverlayCanvas,rt=nt.context.gl,be=nt.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,at.width,at.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(Ne,5,5),be.strokeText(Ne,5,5),nt.debugOverlayTexture.update(at),nt.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}(f,je+" "+le+"kb"),I.draw(g,w.TRIANGLES,F,j,tt.alphaBlended,pt.disabled,Ju(M,y.Color.transparent,Ue),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var es={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var M=Ze.disabled,I=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(F,j,J,ye,le,Ee,Ue){for(var je=j.transform,nt=le==="map",Ne=Ee==="map",at=0,rt=F;at<rt.length;at+=1){var be=rt[at],or=ye.getTile(be),$=or.getBucket(J);if($&&$.text&&$.text.segments.get().length){var ur=y.evaluateSizeForZoom($.textSizeData,je.zoom),Tr=ca(or,1,j.transform.zoom),rn=Qi(be.posMatrix,Ne,nt,j.transform,Tr),Qr=J.layout.get("icon-text-fit")!=="none"&&$.hasIconData();if(ur){var Sn=Math.pow(2,je.zoom-or.tileID.overscaledZ);gf($,nt,Ne,Ue,y.symbolSize,je,rn,be.posMatrix,Sn,ur,Qr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&yl(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),M,I),h.paint.get("text-opacity").constantOr(1)!==0&&yl(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),M,I),d.map.showCollisionBoxes&&(gl(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),gl(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),F=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||M.constantOr(1)!==0&&I.constantOr(1)!==0){for(var j=f.context,J=j.gl,ye=f.depthModeForSublayer(0,we.ReadOnly),le=Ze.disabled,Ee=f.colorModeForRenderPass(),Ue=[],je=0;je<g.length;je++){var nt=g[je],Ne=d.getTile(nt),at=Ne.getBucket(h);if(at){var rt=at.programConfigurations.get(h.id),be={programConfiguration:rt,program:f.useProgram("circle",rt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:zc(f,nt,Ne,h)};if(F)for(var or=0,$=at.segments.get();or<$.length;or+=1){var ur=$[or];Ue.push({segments:new y.SegmentVector([ur]),sortKey:ur.sortKey,state:be})}else Ue.push({segments:at.segments,sortKey:0,state:be})}}F&&Ue.sort(function(Jn,ei){return Jn.sortKey-ei.sortKey});for(var Tr=0,rn=Ue;Tr<rn.length;Tr+=1){var Qr=rn[Tr],Sn=Qr.state;Sn.program.draw(j,J.TRIANGLES,ye,le,Ee,pt.disabled,Sn.uniformValues,h.id,Sn.layoutVertexBuffer,Sn.indexBuffer,Qr.segments,h.paint,f.transform.zoom,Sn.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,M=w.gl,I=Ze.disabled,F=new tt([M.ONE,M.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Ue,je,nt){var Ne=Ue.gl;Ue.activeTexture.set(Ne.TEXTURE1),Ue.viewport.set([0,0,je.width/4,je.height/4]);var at=nt.heatmapFbo;if(at)Ne.bindTexture(Ne.TEXTURE_2D,at.colorAttachment.get()),Ue.bindFramebuffer.set(at.framebuffer);else{var rt=Ne.createTexture();Ne.bindTexture(Ne.TEXTURE_2D,rt),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_2D,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR),at=nt.heatmapFbo=Ue.createFramebuffer(je.width/4,je.height/4,!1),function(be,or,$,ur){var Tr=be.gl;Tr.texImage2D(Tr.TEXTURE_2D,0,Tr.RGBA,or.width/4,or.height/4,0,Tr.RGBA,be.extRenderToTextureHalfFloat?be.extTextureHalfFloat.HALF_FLOAT_OES:Tr.UNSIGNED_BYTE,null),ur.colorAttachment.set($)}(Ue,je,rt,at)}})(w,f,h),w.clear({color:y.Color.transparent});for(var j=0;j<g.length;j++){var J=g[j];if(!d.hasRenderableParent(J)){var ye=d.getTile(J),le=ye.getBucket(h);if(le){var Ee=le.programConfigurations.get(h.id);f.useProgram("heatmap",Ee).draw(w,M.TRIANGLES,we.disabled,I,F,pt.disabled,$f(J.posMatrix,ye,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,h.paint,f.transform.zoom,Ee)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(Ue,je){var nt=Ue.context,Ne=nt.gl,at=je.heatmapFbo;if(at){nt.activeTexture.set(Ne.TEXTURE0),Ne.bindTexture(Ne.TEXTURE_2D,at.colorAttachment.get()),nt.activeTexture.set(Ne.TEXTURE1);var rt=je.colorRampTexture;rt||(rt=je.colorRampTexture=new y.Texture(nt,je.colorRamp,Ne.RGBA)),rt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ue.useProgram("heatmapTexture").draw(nt,Ne.TRIANGLES,we.disabled,Ze.disabled,Ue.colorModeForRenderPass(),pt.disabled,function(be,or,$,ur){var Tr=y.create();y.ortho(Tr,0,be.width,be.height,0,0,1);var rn=be.context.gl;return{u_matrix:Tr,u_world:[rn.drawingBufferWidth,rn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:or.paint.get("heatmap-opacity")}}(Ue,je),je.id,Ue.viewportBuffer,Ue.quadTriangleIndexBuffer,Ue.viewportSegments,je.paint,Ue.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(w.constantOr(1)!==0&&M.constantOr(1)!==0)for(var I=f.depthModeForSublayer(0,we.ReadOnly),F=f.colorModeForRenderPass(),j=h.paint.get("line-dasharray"),J=h.paint.get("line-pattern"),ye=J.constantOr(1),le=h.paint.get("line-gradient"),Ee=h.getCrossfadeParameters(),Ue=ye?"linePattern":j?"lineSDF":le?"lineGradient":"line",je=f.context,nt=je.gl,Ne=!0,at=0,rt=g;at<rt.length;at+=1){var be=rt[at],or=d.getTile(be);if(!ye||or.patternsLoaded()){var $=or.getBucket(h);if($){var ur=$.programConfigurations.get(h.id),Tr=f.context.program.get(),rn=f.useProgram(Ue,ur),Qr=Ne||rn.program!==Tr,Sn=J.constantOr(null);if(Sn&&or.imageAtlas){var Jn=or.imageAtlas,ei=Jn.patternPositions[Sn.to.toString()],ni=Jn.patternPositions[Sn.from.toString()];ei&&ni&&ur.setConstantPatternPositions(ei,ni)}var ji=ye?Nl(f,or,h,Ee):j?Ah(f,or,h,j,Ee):le?ka(f,or,h,$.lineClipsArray.length):Ns(f,or,h);if(ye)je.activeTexture.set(nt.TEXTURE0),or.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),ur.updatePaintBuffers(Ee);else if(j&&(Qr||f.lineAtlas.dirty))je.activeTexture.set(nt.TEXTURE0),f.lineAtlas.bind(je);else if(le){var wn=$.gradients[h.id],vi=wn.texture;if(h.gradientVersion!==wn.version){var wi=256;if(h.stepInterpolant){var mi=d.getSource().maxzoom,ai=be.canonical.z===mi?Math.ceil(1<<f.transform.maxZoom-be.canonical.z):1;wi=y.clamp(y.nextPowerOfTwo($.maxLineLength/y.EXTENT*1024*ai),256,je.maxTextureSize)}wn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:wi,image:wn.gradient||void 0,clips:$.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new y.Texture(je,wn.gradient,nt.RGBA),wn.version=h.gradientVersion,vi=wn.texture}je.activeTexture.set(nt.TEXTURE0),vi.bind(h.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}rn.draw(je,nt.TRIANGLES,I,f.stencilModeForClipping(be),F,pt.disabled,ji,h.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,h.paint,f.transform.zoom,ur,$.layoutVertexBuffer2),Ne=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)!==0){var I=f.colorModeForRenderPass(),F=h.paint.get("fill-pattern"),j=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===j){var J=f.depthModeForSublayer(1,f.renderPass==="opaque"?we.ReadWrite:we.ReadOnly);Vc(f,d,h,g,J,I,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var ye=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,we.ReadOnly);Vc(f,d,h,g,ye,I,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var M=new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))pc(f,d,h,g,M,Ze.disabled,tt.disabled),pc(f,d,h,g,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var I=f.colorModeForRenderPass();pc(f,d,h,g,M,Ze.disabled,I)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,M=f.depthModeForSublayer(0,we.ReadOnly),I=f.colorModeForRenderPass(),F=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],j=F[0],J=0,ye=F[1];J<ye.length;J+=1){var le=ye[J],Ee=d.getTile(le);Ee.needsHillshadePrepare&&f.renderPass==="offscreen"?cp(f,Ee,h,M,Ze.disabled,I):f.renderPass==="translucent"&&yf(f,Ee,h,M,j[le.overscaledZ],I)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,M=w.gl,I=d.getSource(),F=f.useProgram("raster"),j=f.colorModeForRenderPass(),J=I instanceof wt?[{},g]:f.stencilConfigForOverlap(g),ye=J[0],le=J[1],Ee=le[le.length-1].overscaledZ,Ue=!f.options.moving,je=0,nt=le;je<nt.length;je+=1){var Ne=nt[je],at=f.depthModeForSublayer(Ne.overscaledZ-Ee,h.paint.get("raster-opacity")===1?we.ReadWrite:we.ReadOnly,M.LESS),rt=d.getTile(Ne),be=f.transform.calculatePosMatrix(Ne.toUnwrapped(),Ue);rt.registerFadeDuration(h.paint.get("raster-fade-duration"));var or=d.findLoadedParent(Ne,0),$=_f(rt,or,d,h,f.transform),ur=void 0,Tr=void 0,rn=h.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;w.activeTexture.set(M.TEXTURE0),rt.texture.bind(rn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(M.TEXTURE1),or?(or.texture.bind(rn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ur=Math.pow(2,or.tileID.overscaledZ-rt.tileID.overscaledZ),Tr=[rt.tileID.canonical.x*ur%1,rt.tileID.canonical.y*ur%1]):rt.texture.bind(rn,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var Qr=up(be,Tr||[0,0],ur||1,$,h);I instanceof wt?F.draw(w,M.TRIANGLES,at,Ze.disabled,j,pt.disabled,Qr,h.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments):F.draw(w,M.TRIANGLES,at,ye[Ne.overscaledZ],j,pt.disabled,Qr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var M=f.context,I=M.gl,F=f.transform,j=F.tileSize,J=h.paint.get("background-pattern");if(!f.isPatternMissing(J)){var ye=!J&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===ye){var le=Ze.disabled,Ee=f.depthModeForSublayer(0,ye==="opaque"?we.ReadWrite:we.ReadOnly),Ue=f.colorModeForRenderPass(),je=f.useProgram(J?"backgroundPattern":"background"),nt=F.coveringTiles({tileSize:j});J&&(M.activeTexture.set(I.TEXTURE0),f.imageManager.bind(f.context));for(var Ne=h.getCrossfadeParameters(),at=0,rt=nt;at<rt.length;at+=1){var be=rt[at],or=f.transform.calculatePosMatrix(be.toUnwrapped()),$=J?vl(or,w,f,J,{tileID:be,tileSize:j},Ne):Zl(or,w,g);je.draw(M,I.TRIANGLES,Ee,le,Ue,pt.disabled,$,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Ih(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var M=w.prerender;M&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),M.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Ze.disabled);var I=w.renderingMode==="3d"?new we(f.context.gl.LEQUAL,we.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,we.ReadOnly);g.setDepthMode(I),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},$a=function(f,d){this.context=new _e(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=We.maxUnderzooming+We.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cs,this.gpuTimers={}};$a.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},$a.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,Zi.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,Zi.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,gt.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,Zi.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var M=new y.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(M);var I=new y.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(I),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Ze({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},$a.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,we.disabled,this.stencilClearMode,tt.disabled,pt.disabled,Qs(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$a.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(tt.disabled),h.setDepthMode(we.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var M=0,I=d;M<I.length;M+=1){var F=I[M],j=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,we.disabled,new Ze({func:g.ALWAYS,mask:0},j,255,g.KEEP,g.KEEP,g.REPLACE),tt.disabled,pt.disabled,Qs(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$a.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Ze({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},$a.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Ze({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},$a.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(j,J){return J.overscaledZ-j.overscaledZ}),w=g[g.length-1].overscaledZ,M=g[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();for(var I={},F=0;F<M;F++)I[F+w]=new Ze({func:h.GEQUAL,mask:255},F+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[I,g]}return[(d={},d[w]=Ze.disabled,d),g]},$a.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new tt([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?tt.unblended:tt.alphaBlended},$a.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return we.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new we(h||this.context.gl.LEQUAL,d,[g,g])},$a.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$a.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var M in w){var I=w[M];I.used&&I.prepare(this.context)}var F,j,J={},ye={},le={};for(var Ee in w){var Ue=w[Ee];J[Ee]=Ue.getVisibleCoordinates(),ye[Ee]=J[Ee].slice().reverse(),le[Ee]=Ue.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<g.length;je++)if(this.style._layers[g[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var nt=0,Ne=g;nt<Ne.length;nt+=1){var at=this.style._layers[Ne[nt]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var rt=ye[at.source];(at.type==="custom"||rt.length)&&this.renderLayer(this,w[at.source],at,rt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var be=this.style._layers[g[this.currentLayer]],or=w[be.source],$=J[be.source];this._renderTileClippingMasks(be,$),this.renderLayer(this,or,be,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var ur=this.style._layers[g[this.currentLayer]],Tr=w[ur.source],rn=(ur.type==="symbol"?le:ye)[ur.source];this._renderTileClippingMasks(ur,J[ur.source]),this.renderLayer(this,Tr,ur,rn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(h.transform.zoom)&&(Qr.source!==(j&&j.id)&&(j=h.style.sourceCaches[Qr.source]),(!F||F.getSource().maxzoom<j.getSource().maxzoom)&&(F=j))}),F&&es.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var Sn=Qr.transform.padding;Mh(Qr,Qr.transform.height-(Sn.top||0),3,_l),Mh(Qr,Sn.bottom||0,3,xf),kh(Qr,Sn.left||0,3,qf),kh(Qr,Qr.transform.width-(Sn.right||0),3,Vu);var Jn=Qr.transform.centerPoint;(function(ei,ni,ji,wn){Vl(ei,ni-1,ji-10,2,20,wn),Vl(ei,ni-10,ji-1,20,2,wn)})(Qr,Jn.x,Qr.transform.height-Jn.y,Th)}(this),this.context.setDefault()},$a.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),es[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},$a.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},$a.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},$a.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},$a.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,M=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=M}return d},$a.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var M=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){var I=Math.sin(M),F=Math.cos(M);h=[h[0]*F-h[1]*I,h[0]*I+h[1]*F]}var j=[w?h[0]:ca(d,h[0],this.transform.zoom),w?h[1]:ca(d,h[1],this.transform.zoom),0],J=new Float32Array(16);return y.translate(J,f,j),J},$a.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},$a.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},$a.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},$a.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new df(this.context,f,vs[f],d,ml[f],this._showOverdrawInspector)),this.cache[h]},$a.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$a.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},$a.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$a.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ha=function(f,d){this.points=f,this.planes=d};ha.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(I){return y.transformMat4([],I,f)}).map(function(I){return y.scale$1([],I,1/I[3]/d*g)}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(I){var F=y.sub([],w[I[0]],w[I[1]]),j=y.sub([],w[I[2]],w[I[1]]),J=y.normalize([],y.cross([],F,j)),ye=-y.dot(J,w[I[1]]);return J.concat(ye)});return new ha(w,M)};var jl=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};jl.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new jl(h,g)},jl.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},jl.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},jl.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],M=0,I=0;I<d.length;I++)M+=y.dot$1(w,d[I])>=0;if(M===0)return 0;M!==d.length&&(h=!1)}if(h)return 2;for(var F=0;F<3;F++){for(var j=Number.MAX_VALUE,J=-Number.MAX_VALUE,ye=0;ye<f.points.length;ye++){var le=f.points[ye][F]-this.min[F];j=Math.min(j,le),J=Math.max(J,le)}if(J<0||j>this.max[F]-this.min[F])return 0}return 1};var el=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};el.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},el.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},el.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},el.prototype.clone=function(){return new el(this.top,this.bottom,this.left,this.right)},el.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Hi=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new el,this._posMatrixCache={},this._alignedPosMatrixCache={}},Oa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Hi.prototype.clone=function(){var f=new Hi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},Oa.minZoom.get=function(){return this._minZoom},Oa.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},Oa.maxZoom.get=function(){return this._maxZoom},Oa.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},Oa.minPitch.get=function(){return this._minPitch},Oa.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},Oa.maxPitch.get=function(){return this._maxPitch},Oa.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},Oa.renderWorldCopies.get=function(){return this._renderWorldCopies},Oa.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},Oa.worldSize.get=function(){return this.tileSize*this.scale},Oa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Oa.size.get=function(){return new y.Point(this.width,this.height)},Oa.bearing.get=function(){return-this.angle/Math.PI*180},Oa.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Oa.pitch.get=function(){return this._pitch/Math.PI*180},Oa.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Oa.fov.get=function(){return this._fov/Math.PI*180},Oa.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},Oa.zoom.get=function(){return this._zoom},Oa.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Oa.center.get=function(){return this._center},Oa.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},Oa.padding.get=function(){return this._edgeInsets.toJSON()},Oa.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},Oa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Hi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},Hi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},Hi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},Hi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),M=this.pointCoordinate(new y.Point(0,this.height)),I=Math.floor(Math.min(h.x,g.x,w.x,M.x)),F=Math.floor(Math.max(h.x,g.x,w.x,M.x)),j=I-1;j<=F+1;j++)j!==0&&d.push(new y.UnwrappedTileID(j,f));return d},Hi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),M=[w*g.x,w*g.y,0],I=ha.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var j=function(Qr){return{aabb:new jl([Qr*w,0,0],[(Qr+1)*w,w,0]),zoom:0,x:0,y:0,wrap:Qr,fullyVisible:!1}},J=[],ye=[],le=d,Ee=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var Ue=1;Ue<=3;Ue++)J.push(j(-Ue)),J.push(j(Ue));for(J.push(j(0));J.length>0;){var je=J.pop(),nt=je.x,Ne=je.y,at=je.fullyVisible;if(!at){var rt=je.aabb.intersects(I);if(rt===0)continue;at=rt===2}var be=je.aabb.distanceX(M),or=je.aabb.distanceY(M),$=Math.max(Math.abs(be),Math.abs(or));if(je.zoom===le||$>3+(1<<le-je.zoom)-2&&je.zoom>=F)ye.push({tileID:new y.OverscaledTileID(je.zoom===le?Ee:je.zoom,je.wrap,je.zoom,nt,Ne),distanceSq:y.sqrLen([M[0]-.5-nt,M[1]-.5-Ne])});else for(var ur=0;ur<4;ur++){var Tr=(nt<<1)+ur%2,rn=(Ne<<1)+(ur>>1);J.push({aabb:je.aabb.quadrant(ur),zoom:je.zoom+1,x:Tr,y:rn,wrap:je.wrap,fullyVisible:at})}}return ye.sort(function(Qr,Sn){return Qr.distanceSq-Sn.distanceSq}).map(function(Qr){return Qr.tileID})},Hi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},Oa.unmodified.get=function(){return this._unmodified},Hi.prototype.zoomScale=function(f){return Math.pow(2,f)},Hi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},Hi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},Hi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},Oa.point.get=function(){return this.project(this.center)},Hi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),M=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())},Hi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},Hi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},Hi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},Hi.prototype.coordinateLocation=function(f){return f.toLngLat()},Hi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],M=d[1]/g,I=h[1]/w,F=d[2]/g,j=h[2]/w,J=F===j?0:(0-F)/(j-F);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,J)/this.worldSize,y.number(M,I,J)/this.worldSize)},Hi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},Hi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Hi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Hi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Hi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,M=this.worldSize/this.zoomScale(w.z),I=w.x+Math.pow(2,w.z)*f.wrap,F=y.identity(new Float64Array(16));return y.translate(F,F,[I*M,w.y*M,0]),y.scale(F,F,[M/y.EXTENT,M/y.EXTENT,1]),y.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),g[h]=new Float32Array(F),g[h]},Hi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Hi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,M=90,I=-180,F=180,j=this.size,J=this._unmodified;if(this.latRange){var ye=this.latRange;w=y.mercatorYfromLat(ye[1])*this.worldSize,f=(M=y.mercatorYfromLat(ye[0])*this.worldSize)-w<j.y?j.y/(M-w):0}if(this.lngRange){var le=this.lngRange;I=y.mercatorXfromLng(le[0])*this.worldSize,d=(F=y.mercatorXfromLng(le[1])*this.worldSize)-I<j.x?j.x/(F-I):0}var Ee=this.point,Ue=Math.max(d||0,f||0);if(Ue)return this.center=this.unproject(new y.Point(d?(F+I)/2:Ee.x,f?(M+w)/2:Ee.y)),this.zoom+=this.scaleZoom(Ue),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var je=Ee.y,nt=j.y/2;je-nt<w&&(g=w+nt),je+nt>M&&(g=M-nt)}if(this.lngRange){var Ne=Ee.x,at=j.x/2;Ne-at<I&&(h=I+at),Ne+at>F&&(h=F-at)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:Ee.x,g!==void 0?g:Ee.y))),this._unmodified=J,this._constraining=!1}},Hi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,M=w.x,I=w.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),j=this.height/50,J=new Float64Array(16);y.perspective(J,this._fov,this.width/this.height,j,F),J[8]=2*-f.x/this.width,J[9]=2*f.y/this.height,y.scale(J,J,[1,-1,1]),y.translate(J,J,[0,0,-this.cameraToCenterDistance]),y.rotateX(J,J,this._pitch),y.rotateZ(J,J,this.angle),y.translate(J,J,[-M,-I,0]),this.mercatorMatrix=y.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),y.scale(J,J,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=y.invert([],this.projMatrix);var ye=this.width%2/2,le=this.height%2/2,Ee=Math.cos(this.angle),Ue=Math.sin(this.angle),je=M-Math.round(M)+Ee*ye+Ue*le,nt=I-Math.round(I)+Ee*le+Ue*ye,Ne=new Float64Array(J);if(y.translate(Ne,Ne,[je>.5?je-1:je,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Ne,J=y.create(),y.scale(J,J,[this.width/2,-this.height/2,1]),y.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=y.create(),y.scale(J,J,[1,-1,1]),y.translate(J,J,[-1,-1,0]),y.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Hi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Hi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},Hi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,M=d.y,I=0,F=f;I<F.length;I+=1){var j=F[I];h=Math.min(h,j.x),g=Math.min(g,j.y),w=Math.max(w,j.x),M=Math.max(M,j.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,M),new y.Point(h,M),new y.Point(h,g)]},Object.defineProperties(Hi.prototype,Oa);var Ps=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};Ps.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ps.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ps.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),M=Math.round(d.lng*w)/w,I=Math.round(d.lat*w)/w,F=this._map.getBearing(),j=this._map.getPitch(),J="";if(J+=f?"/"+M+"/"+I+"/"+h:h+"/"+I+"/"+M,(F||j)&&(J+="/"+Math.round(10*F)/10),j&&(J+="/"+Math.round(j)),this._hashName){var ye=this._hashName,le=!1,Ee=y.window.location.hash.slice(1).split("&").map(function(Ue){var je=Ue.split("=")[0];return je===ye?(le=!0,je+"="+J):Ue}).filter(function(Ue){return Ue});return le||Ee.push(ye+"="+J),"#"+Ee.join("&")}return"#"+J},Ps.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},Ps.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},Ps.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var jc={linearity:.3,easing:y.bezier(0,0,.3,1)},Ri=y.extend({deceleration:2500,maxSpeed:1400},jc),gs=y.extend({deceleration:20,maxSpeed:1400},jc),wu=y.extend({deceleration:1e3,maxSpeed:360},jc),Gl=y.extend({deceleration:1e3,maxSpeed:90},jc),Gc=function(f){this._map=f,this.clear()};function dc(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Cu(f,d,h){var g=h.maxSpeed,w=h.linearity,M=h.deceleration,I=y.clamp(f*w/(d/1e3),-g,g),F=Math.abs(I)/(M*w);return{easing:h.easing,duration:1e3*F,amount:I*(F/2)}}Gc.prototype.clear=function(){this._inertiaBuffer=[]},Gc.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},Gc.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},Gc.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(d.pan.mag()){var F=Cu(d.pan.mag(),M,y.extend({},Ri,f||{}));I.offset=d.pan.mult(F.amount/d.pan.mag()),I.center=this._map.transform.center,dc(I,F)}if(d.zoom){var j=Cu(d.zoom,M,gs);I.zoom=this._map.transform.zoom+j.amount,dc(I,j)}if(d.bearing){var J=Cu(d.bearing,M,wu);I.bearing=this._map.transform.bearing+y.clamp(J.amount,-179,179),dc(I,J)}if(d.pitch){var ye=Cu(d.pitch,M,Gl);I.pitch=this._map.transform.pitch+ye.amount,dc(I,ye)}if(I.zoom||I.bearing){var le=d.pinchAround===void 0?d.around:d.pinchAround;I.around=le?this._map.unproject(le):this._map.getCenter()}return this.clear(),y.extend(I,{noMoveStart:!0})}};var Ho=function(f){function d(g,w,M,I){I===void 0&&(I={});var F=q.mousePos(w.getCanvasContainer(),M),j=w.unproject(F);f.call(this,g,y.extend({point:F,lngLat:j,originalEvent:M},I)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),vc=function(f){function d(g,w,M){var I=g==="touchend"?M.changedTouches:M.touches,F=q.touchPos(w.getCanvasContainer(),I),j=F.map(function(le){return w.unproject(le)}),J=F.reduce(function(le,Ee,Ue,je){return le.add(Ee.div(je.length))},new y.Point(0,0)),ye=w.unproject(J);f.call(this,g,{points:F,point:J,lngLats:j,lngLat:ye,originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Hl=function(f){function d(g,w,M){f.call(this,g,{originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Mo=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};Mo.prototype.reset=function(){delete this._mousedownPos},Mo.prototype.wheel=function(f){return this._firePreventable(new Hl(f.type,this._map,f))},Mo.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Ho(f.type,this._map,f))},Mo.prototype.mouseup=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.dblclick=function(f){return this._firePreventable(new Ho(f.type,this._map,f))},Mo.prototype.mouseover=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.mouseout=function(f){this._map.fire(new Ho(f.type,this._map,f))},Mo.prototype.touchstart=function(f){return this._firePreventable(new vc(f.type,this._map,f))},Mo.prototype.touchmove=function(f){this._map.fire(new vc(f.type,this._map,f))},Mo.prototype.touchend=function(f){this._map.fire(new vc(f.type,this._map,f))},Mo.prototype.touchcancel=function(f){this._map.fire(new vc(f.type,this._map,f))},Mo.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},Mo.prototype.isEnabled=function(){return!0},Mo.prototype.isActive=function(){return!1},Mo.prototype.enable=function(){},Mo.prototype.disable=function(){};var Ln=function(f){this._map=f};Ln.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ln.prototype.mousemove=function(f){this._map.fire(new Ho(f.type,this._map,f))},Ln.prototype.mousedown=function(){this._delayContextMenu=!0},Ln.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ln.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Ho(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Ln.prototype.isEnabled=function(){return!0},Ln.prototype.isActive=function(){return!1},Ln.prototype.enable=function(){},Ln.prototype.disable=function(){};var uo=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function La(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}uo.prototype.isEnabled=function(){return!!this._enabled},uo.prototype.isActive=function(){return!!this._active},uo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},uo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},uo.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(q.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},uo.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),M=Math.max(g.x,h.x),I=Math.min(g.y,h.y),F=Math.max(g.y,h.y);q.setTransform(this._box,"translate("+w+"px,"+I+"px)"),this._box.style.width=M-w+"px",this._box.style.height=F-I+"px"}}},uo.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),q.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(M){return M.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},uo.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},uo.prototype.blur=function(){this.reset()},uo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos},uo.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var xl=function(f){this.reset(),this.numTouches=f.numTouches};xl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},xl.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),M=0,I=g;M<I.length;M+=1)w._add(I[M]);return w.div(g.length)}(d),this.touches=La(h,d)))},xl.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=La(h,d);for(var w in this.touches){var M=g[w];(!M||M.dist(this.touches[w])>30)&&(this.aborted=!0)}}},xl.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var eu=function(f){this.singleTap=new xl(f),this.numTaps=f.numTaps,this.reset()};eu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},eu.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},eu.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},eu.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(w&&M||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var zs=function(){this._zoomIn=new eu({numTouches:1,numTaps:2}),this._zoomOut=new eu({numTouches:2,numTaps:1}),this.reset()};zs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},zs.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},zs.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},zs.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),M=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:f})}}):M?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(M)},{originalEvent:f})}}):void 0},zs.prototype.touchcancel=function(){this.reset()},zs.prototype.enable=function(){this._enabled=!0},zs.prototype.disable=function(){this._enabled=!1,this.reset()},zs.prototype.isEnabled=function(){return this._enabled},zs.prototype.isActive=function(){return this._active};var bf={0:1,2:2},hn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};hn.prototype.blur=function(){this.reset()},hn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},hn.prototype._correctButton=function(f,d){return!1},hn.prototype._move=function(f,d){return{}},hn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=q.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},hn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var M=bf[w];return g.buttons===void 0||(g.buttons&M)!==M}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},hn.prototype.mouseupWindow=function(f){this._lastPoint&&q.mouseButton(f)===this._eventButton&&(this._moved&&q.suppressClick(),this.reset())},hn.prototype.enable=function(){this._enabled=!0},hn.prototype.disable=function(){this._enabled=!1,this.reset()},hn.prototype.isEnabled=function(){return this._enabled},hn.prototype.isActive=function(){return this._active};var mc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(hn),bl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(hn),tl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(hn),xa=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};xa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},xa.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},xa.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},xa.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},xa.prototype.touchcancel=function(){this.reset()},xa.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=La(h,d),w=new y.Point(0,0),M=new y.Point(0,0),I=0;for(var F in g){var j=g[F],J=this._touches[F];J&&(w._add(j),M._add(j.sub(J)),I++,g[F]=j)}if(this._touches=g,!(I<this._minTouches)&&M.mag()){var ye=M.div(I);if(this._sum._add(ye),!(this._sum.mag()<this._clickTolerance))return{around:w.div(I),panDelta:ye}}},xa.prototype.enable=function(){this._enabled=!0},xa.prototype.disable=function(){this._enabled=!1,this.reset()},xa.prototype.isEnabled=function(){return this._enabled},xa.prototype.isActive=function(){return this._active};var Rs=function(){this.reset()};function Hc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function Au(f,d){return Math.log(f/d)/Math.LN2}Rs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Rs.prototype._start=function(f){},Rs.prototype._move=function(f,d,h){return{}},Rs.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Rs.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],M=Hc(h,d,g[0]),I=Hc(h,d,w);if(M&&I){var F=this._aroundCenter?null:M.add(I).div(2);return this._move([M,I],F,f)}}},Rs.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],M=Hc(h,d,g[0]),I=Hc(h,d,w);M&&I||(this._active&&q.suppressClick(),this.reset())}},Rs.prototype.touchcancel=function(){this.reset()},Rs.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},Rs.prototype.disable=function(){this._enabled=!1,this.reset()},Rs.prototype.isEnabled=function(){return this._enabled},Rs.prototype.isActive=function(){return this._active};var Os=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,w),pinchAround:g}},d}(Rs);function ju(f,d){return 180*f.angleWith(d)/Math.PI}var Ef=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ju(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=ju(h,this._startVector);return Math.abs(w)<g},d}(Rs);function Wl(f){return Math.abs(f.y)>Math.abs(f.x)}var Kf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Wl(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var M=h[0].sub(this._lastPoints[0]),I=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(M,I,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(M.y+I.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var M=h.mag()>=2,I=g.mag()>=2;if(M||I){if(!M||!I)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var F=h.y>0==g.y>0;return Wl(h)&&Wl(g)&&F}},d}(Rs),Sf={panStep:100,bearingStep:15,pitchStep:10},tu=function(){var f=Sf;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function Zs(f){return f*(2-f)}tu.prototype.blur=function(){this.reset()},tu.prototype.reset=function(){this._active=!1},tu.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,M=0,I=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),M=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),M=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),I=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(F){var j=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:Zs,zoom:h?Math.round(j)+h*(f.shiftKey?2:1):j,bearing:F.getBearing()+g*d._bearingStep,pitch:F.getPitch()+w*d._pitchStep,offset:[-M*d._panStep,-I*d._panStep],center:F.getCenter()},{originalEvent:f})}}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active},tu.prototype.disableRotation=function(){this._rotationDisabled=!0},tu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Oi.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Oi.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Oi.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=q.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var M,I=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,j=this._easing,J=!1;if(this._type==="wheel"&&F&&j){var ye=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),le=j(ye);M=y.number(F,I,le),ye<1?this._frameId||(this._frameId=!0):J=!0}else M=I,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:M-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),M=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-M*M);d=y.bezier(M,I,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var ru=function(f,d){this._clickZoom=f,this._tapZoom=d};ru.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ru.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ru.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ru.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var du=function(){this.reset()};du.prototype.reset=function(){this._active=!1},du.prototype.blur=function(){this.reset()},du.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},du.prototype.enable=function(){this._enabled=!0},du.prototype.disable=function(){this._enabled=!1,this.reset()},du.prototype.isEnabled=function(){return this._enabled},du.prototype.isActive=function(){return this._active};var ts=function(){this._tap=new eu({numTouches:1,numTaps:1}),this.reset()};ts.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ts.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},ts.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},ts.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},ts.prototype.touchcancel=function(){this.reset()},ts.prototype.enable=function(){this._enabled=!0},ts.prototype.disable=function(){this._enabled=!1,this.reset()},ts.prototype.isEnabled=function(){return this._enabled},ts.prototype.isActive=function(){return this._active};var El=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};El.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},El.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},El.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},El.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var rl=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};rl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},rl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},rl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},rl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Us=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Us.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Us.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Us.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Us.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Us.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Us.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var as=function(f){return f.zoom||f.drag||f.pitch||f.rotate},vu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function Xn(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var Un=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gc(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var M=w[g],I=M[0];q.addEventListener(I,M[1],I===y.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};Un.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];q.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Un.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new Mo(d,f));var g=d.boxZoom=new uo(d,f);this._add("boxZoom",g);var w=new zs,M=new du;d.doubleClickZoom=new ru(M,w),this._add("tapZoom",w),this._add("clickZoom",M);var I=new ts;this._add("tapDragZoom",I);var F=d.touchPitch=new Kf;this._add("touchPitch",F);var j=new bl(f),J=new tl(f);d.dragRotate=new rl(f,j,J),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var ye=new mc(f),le=new xa(f);d.dragPan=new El(h,ye,le),this._add("mousePan",ye),this._add("touchPan",le,["touchZoom","touchRotate"]);var Ee=new Ef,Ue=new Os;d.touchZoomRotate=new Us(h,Ue,Ee,I),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Ue,["touchPan","touchRotate"]);var je=d.scrollZoom=new Oi(d,this);this._add("scrollZoom",je,["mousePan"]);var nt=d.keyboard=new tu;this._add("keyboard",nt),this._add("blockableMapEvent",new Ln(d));for(var Ne=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ne<at.length;Ne+=1){var rt=at[Ne];f.interactive&&f[rt]&&d[rt].enable(f[rt])}},Un.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},Un.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},Un.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},Un.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Un.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Un.prototype.isMoving=function(){return Boolean(as(this._eventsInProgress))||this.isZooming()},Un.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},Un.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},Un.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},Un.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},M={},I=f.touches?this._getMapTouches(f.touches):void 0,F=I?q.touchPos(this._el,I):q.mousePos(this._el,f),j=0,J=this._handlers;j<J.length;j+=1){var ye=J[j],le=ye.handlerName,Ee=ye.handler,Ue=ye.allowed;if(Ee.isEnabled()){var je=void 0;this._blockedByActive(M,Ue,le)?Ee.reset():Ee[d||f.type]&&(je=Ee[d||f.type](f,F,I),this.mergeHandlerResult(g,w,je,le,h),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Ee.isActive())&&(M[le]=Ee)}}var nt={};for(var Ne in this._previousActiveHandlers)M[Ne]||(nt[Ne]=h);this._previousActiveHandlers=M,(Object.keys(nt).length||Xn(g))&&(this._changes.push([g,w,nt]),this._triggerRenderFrame()),(Object.keys(M).length||Xn(g))&&this._map._stop(!0),this._updatingCamera=!1;var at=g.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},Un.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var M={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=M),h.panDelta!==void 0&&(d.drag=M),h.pitchDelta!==void 0&&(d.pitch=M),h.bearingDelta!==void 0&&(d.rotate=M)}},Un.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var M=w[g],I=M[0],F=M[1],j=M[2];I.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(f.around=I.around),I.pinchAround!==void 0&&(f.pinchAround=I.pinchAround),I.noInertia&&(f.noInertia=I.noInertia),y.extend(d,F),y.extend(h,j)}this._updateMapTransform(f,d,h),this._changes=[]},Un.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!Xn(f))return this._fireEvents(d,h,!0);var M=f.panDelta,I=f.zoomDelta,F=f.bearingDelta,j=f.pitchDelta,J=f.around,ye=f.pinchAround;ye!==void 0&&(J=ye),g._stop(!0),J=J||g.transform.centerPoint;var le=w.pointLocation(M?J.sub(M):J);F&&(w.bearing+=F),j&&(w.pitch+=j),I&&(w.zoom+=I),w.setLocationAtPoint(le,J),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},Un.prototype._fireEvents=function(f,d,h){var g=this,w=as(this._eventsInProgress),M=as(f),I={};for(var F in f)this._eventsInProgress[F]||(I[F+"start"]=f[F].originalEvent),this._eventsInProgress[F]=f[F];for(var j in!w&&M&&this._fireEvent("movestart",M.originalEvent),I)this._fireEvent(j,I[j]);for(var J in M&&this._fireEvent("move",M.originalEvent),f)this._fireEvent(J,f[J].originalEvent);var ye,le={};for(var Ee in this._eventsInProgress){var Ue=this._eventsInProgress[Ee],je=Ue.handlerName,nt=Ue.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Ee],le[Ee+"end"]=ye=d[je]||nt)}for(var Ne in le)this._fireEvent(Ne,le[Ne]);var at=as(this._eventsInProgress);if(h&&(w||M)&&!at){this._updatingCamera=!0;var rt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),be=function(or){return or!==0&&-g._bearingSnap<or&&or<g._bearingSnap};rt?(be(rt.bearing||this._map.getBearing())&&(rt.bearing=0),this._map.easeTo(rt,{originalEvent:ye})):(this._map.fire(new y.Event("moveend",{originalEvent:ye})),be(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Un.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},Un.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new vu("renderFrame",{timeStamp:d})),f._applyChanges()})},Un.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var wf=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,M){var I={top:0,bottom:0,right:0,left:0};if(typeof(M=y.extend({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){var F=M.padding;M.padding={top:F,bottom:F,right:F,left:F}}M.padding=y.extend(I,M.padding);var j=this.transform,J=j.padding,ye=j.project(y.LngLat.convert(h)),le=j.project(y.LngLat.convert(g)),Ee=ye.rotate(-w*Math.PI/180),Ue=le.rotate(-w*Math.PI/180),je=new y.Point(Math.max(Ee.x,Ue.x),Math.max(Ee.y,Ue.y)),nt=new y.Point(Math.min(Ee.x,Ue.x),Math.min(Ee.y,Ue.y)),Ne=je.sub(nt),at=(j.width-(J.left+J.right+M.padding.left+M.padding.right))/Ne.x,rt=(j.height-(J.top+J.bottom+M.padding.top+M.padding.bottom))/Ne.y;if(!(rt<0||at<0)){var be=Math.min(j.scaleZoom(j.scale*Math.min(at,rt)),M.maxZoom),or=typeof M.offset.x=="number"?new y.Point(M.offset.x,M.offset.y):y.Point.convert(M.offset),$=new y.Point((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(w*Math.PI/180),ur=or.add($).mult(j.scale/j.zoomScale(be));return{center:j.unproject(ye.add(le).div(2).sub(ur)),zoom:be,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,M,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,M),M,I)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,M=!1,I=!1,F=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(M=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(I=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(F=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),M&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),I&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),F&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var M=this.transform,I=this.getZoom(),F=this.getBearing(),j=this.getPitch(),J=this.getPadding(),ye="zoom"in h?+h.zoom:I,le="bearing"in h?this._normalizeBearing(h.bearing,F):F,Ee="pitch"in h?+h.pitch:j,Ue="padding"in h?h.padding:M.padding,je=y.Point.convert(h.offset),nt=M.centerPoint.add(je),Ne=M.pointLocation(nt),at=y.LngLat.convert(h.center||Ne);this._normalizeCenter(at);var rt,be,or=M.project(Ne),$=M.project(at).sub(or),ur=M.zoomScale(ye-I);h.around&&(rt=y.LngLat.convert(h.around),be=M.locationPoint(rt));var Tr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==I,this._rotating=this._rotating||F!==le,this._pitching=this._pitching||Ee!==j,this._padding=!M.isPaddingEqual(Ue),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Tr),this._ease(function(rn){if(w._zooming&&(M.zoom=y.number(I,ye,rn)),w._rotating&&(M.bearing=y.number(F,le,rn)),w._pitching&&(M.pitch=y.number(j,Ee,rn)),w._padding&&(M.interpolatePadding(J,Ue,rn),nt=M.centerPoint.add(je)),rt)M.setLocationAtPoint(rt,be);else{var Qr=M.zoomScale(M.zoom-I),Sn=ye>I?Math.min(2,ur):Math.max(.5,ur),Jn=Math.pow(Sn,1-rn),ei=M.unproject(or.add($.mult(rn*Jn)).mult(Qr));M.setLocationAtPoint(M.renderWorldCopies?ei.wrap():ei,nt)}w._fireMoveEvents(g)},function(rn){w._afterEase(g,rn)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,M=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),M&&this.fire(new y.Event("rotateend",h)),I&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var M=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(M,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var I=this.transform,F=this.getZoom(),j=this.getBearing(),J=this.getPitch(),ye=this.getPadding(),le="zoom"in h?y.clamp(+h.zoom,I.minZoom,I.maxZoom):F,Ee="bearing"in h?this._normalizeBearing(h.bearing,j):j,Ue="pitch"in h?+h.pitch:J,je="padding"in h?h.padding:I.padding,nt=I.zoomScale(le-F),Ne=y.Point.convert(h.offset),at=I.centerPoint.add(Ne),rt=I.pointLocation(at),be=y.LngLat.convert(h.center||rt);this._normalizeCenter(be);var or=I.project(rt),$=I.project(be).sub(or),ur=h.curve,Tr=Math.max(I.width,I.height),rn=Tr/nt,Qr=$.mag();if("minZoom"in h){var Sn=y.clamp(Math.min(h.minZoom,F,le),I.minZoom,I.maxZoom),Jn=Tr/I.zoomScale(Sn-F);ur=Math.sqrt(Jn/Qr*2)}var ei=ur*ur;function ni(si){var oi=(rn*rn-Tr*Tr+(si?-1:1)*ei*ei*Qr*Qr)/(2*(si?rn:Tr)*ei*Qr);return Math.log(Math.sqrt(oi*oi+1)-oi)}function ji(si){return(Math.exp(si)-Math.exp(-si))/2}function wn(si){return(Math.exp(si)+Math.exp(-si))/2}var vi=ni(0),wi=function(si){return wn(vi)/wn(vi+ur*si)},mi=function(si){return Tr*((wn(vi)*(ji(oi=vi+ur*si)/wn(oi))-ji(vi))/ei)/Qr;var oi},ai=(ni(1)-vi)/ur;if(Math.abs(Qr)<1e-6||!isFinite(ai)){if(Math.abs(Tr-rn)<1e-6)return this.easeTo(h,g);var Ai=rn<Tr?-1:1;ai=Math.abs(Math.log(rn/Tr))/ur,mi=function(){return 0},wi=function(si){return Math.exp(Ai*ur*si)}}return h.duration="duration"in h?+h.duration:1e3*ai/("screenSpeed"in h?+h.screenSpeed/ur:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=j!==Ee,this._pitching=Ue!==J,this._padding=!I.isPaddingEqual(je),this._prepareEase(g,!1),this._ease(function(si){var oi=si*ai,go=1/wi(oi);I.zoom=si===1?le:F+I.scaleZoom(go),w._rotating&&(I.bearing=y.number(j,Ee,si)),w._pitching&&(I.pitch=y.number(J,Ue,si)),w._padding&&(I.interpolatePadding(ye,je,si),at=I.centerPoint.add(Ne));var to=si===1?be:I.unproject(or.add($.mult(mi(oi))).mult(go));I.setLocationAtPoint(I.renderWorldCopies?to.wrap():to,at),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var M=this.handlers;M&&M.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),os=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};os.prototype.getDefaultPosition=function(){return"bottom-right"},os.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},os.prototype.onRemove=function(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},os.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},os.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,M){return w.value&&(g+=w.key+"="+w.value+(M<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},os.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},os.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var M=w.getSource();M.attribution&&f.indexOf(M.attribution)<0&&f.push(M.attribution)}}f.sort(function(F,j){return F.length-j.length});var I=(f=f.filter(function(F,j){for(var J=j+1;J<f.length;J++)if(f[J].indexOf(F)>=0)return!1;return!0})).join(" | ");I!==this._attribHTML&&(this._attribHTML=I,f.length?(this._innerContainer.innerHTML=I,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var mu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};mu.prototype.onAdd=function(f){this._map=f,this._container=q.create("div","mapboxgl-ctrl");var d=q.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},mu.prototype.onRemove=function(){q.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},mu.prototype.getDefaultPosition=function(){return"bottom-left"},mu.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},mu.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},mu.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var rs=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};rs.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},rs.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},rs.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},rs.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},gc=y.window.HTMLImageElement,Xl=y.window.HTMLElement,ba=y.window.ImageBitmap,Pa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Qf=function(f){function d(g){var w=this;if((g=y.extend({},Pa,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var M=new Hi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,M,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new rs,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},nu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Xl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Un(this,g),this._hash=g.hash&&new Ps(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new os({customAttribution:g.customAttribution})),this.addControl(new mu,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(I){w._update(I.dataType==="style"),w.fire(new y.Event(I.dataType+"data",I))}),this.on("dataloading",function(I){w.fire(new y.Event(I.dataType+"dataloading",I))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var M=g.onAdd(this);this._controls.push(g);var I=this._controlPositions[w];return w.indexOf("bottom")!==-1?I.insertBefore(M,I.firstChild):I.appendChild(M),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),M=w[0],I=w[1];if(M===this.transform.width&&I===this.transform.height)return this;this._resizeCanvas(M,I),this.transform.resize(M,I),this.painter.resize(M,I);var F=!this._moving;return F&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),F&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,M){var I,F=this;if(g==="mouseenter"||g==="mouseover"){var j=!1;return{layer:w,listener:M,delegates:{mousemove:function(ye){var le=F.getLayer(w)?F.queryRenderedFeatures(ye.point,{layers:[w]}):[];le.length?j||(j=!0,M.call(F,new Ho(g,F,ye.originalEvent,{features:le}))):j=!1},mouseout:function(){j=!1}}}}if(g==="mouseleave"||g==="mouseout"){var J=!1;return{layer:w,listener:M,delegates:{mousemove:function(ye){(F.getLayer(w)?F.queryRenderedFeatures(ye.point,{layers:[w]}):[]).length?J=!0:J&&(J=!1,M.call(F,new Ho(g,F,ye.originalEvent)))},mouseout:function(ye){J&&(J=!1,M.call(F,new Ho(g,F,ye.originalEvent)))}}}}return{layer:w,listener:M,delegates:(I={},I[g]=function(ye){var le=F.getLayer(w)?F.queryRenderedFeatures(ye.point,{layers:[w]}):[];le.length&&(ye.features=le,M.call(F,ye),delete ye.features)},I)}},d.prototype.on=function(g,w,M){if(M===void 0)return f.prototype.on.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(I),I.delegates)this.on(F,I.delegates[F]);return this},d.prototype.once=function(g,w,M){if(M===void 0)return f.prototype.once.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var F in I.delegates)this.once(F,I.delegates[F]);return this},d.prototype.off=function(g,w,M){var I=this;return M===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(F){for(var j=F[g],J=0;J<j.length;J++){var ye=j[J];if(ye.layer===w&&ye.listener===M){for(var le in ye.delegates)I.off(le,ye.delegates[le]);return j.splice(J,1),I}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var M;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")M=[y.Point.convert(g)];else{var I=y.Point.convert(g[0]),F=y.Point.convert(g[1]);M=[I,new y.Point(F.x,I.y),F,new y.Point(I.x,F.y),I]}return this.style.queryRenderedFeatures(M,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new ds(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var M=this;if(typeof g=="string"){var I=this._requestManager.normalizeStyleURL(g),F=this._requestManager.transformRequest(I,y.ResourceType.Style);y.getJSON(F,function(j,J){j?M.fire(new y.ErrorEvent(j)):J&&M._updateDiff(J,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(M){y.warnOnce("Unable to perform style diff: "+(M.message||M.error||M)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var M=g[w]._tiles;for(var I in M){var F=M[I];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,M){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,M)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,M){M===void 0&&(M={});var I=M.pixelRatio;I===void 0&&(I=1);var F=M.sdf;F===void 0&&(F=!1);var j=M.stretchX,J=M.stretchY,ye=M.content;if(this._lazyInitEmptyStyle(),w instanceof gc||ba&&w instanceof ba){var le=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:le.width,height:le.height},le.data),pixelRatio:I,stretchX:j,stretchY:J,content:ye,sdf:F,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:I,stretchX:j,stretchY:J,content:ye,sdf:F,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var M=this.style.getImage(g);if(!M)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var I=w instanceof gc||ba&&w instanceof ba?y.browser.getImageData(w):w,F=I.width,j=I.height,J=I.data;return F===void 0||j===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==M.data.width||j!==M.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(M.data.replace(J,!(w instanceof gc||ba&&w instanceof ba)),void this.style.updateImage(g,M))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,M){return this.style.setLayerZoomRange(g,w,M),this._update(!0)},d.prototype.setFilter=function(g,w,M){return M===void 0&&(M={}),this.style.setFilter(g,w,M),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setPaintProperty(g,w,M,I),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setLayoutProperty(g,w,M,I),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=q.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=q.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=q.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var M=this._containerDimensions();this._resizeCanvas(M[0],M[1]);var I=this._controlContainer=q.create("div","mapboxgl-control-container",g),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(j){F[j]=q.create("div","mapboxgl-ctrl-"+j,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var M=y.browser.devicePixelRatio||1;this._canvas.width=M*g,this._canvas.height=M*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},Pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new $a(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,M=this,I=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,w),I=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,ye=y.browser.now();this.style.zoomHistory.update(J,ye);var le=new y.EvaluationParameters(J,{now:ye,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=le.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(j=!0,this._crossFadingFactor=Ee),this.style.update(le)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ue=y.browser.now()-I;F.endQueryEXT(F.TIME_ELAPSED_EXT,w),setTimeout(function(){var Ne=F.getQueryObjectEXT(w,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(w),M.fire(new y.Event("gpu-timing-frame",{cpuTime:Ue,gpuTime:Ne}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var Ne=M.painter.queryGpuTimers(je);M.fire(new y.Event("gpu-timing-layer",{layerTimes:Ne}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var M=this.painter.context.gl.getExtension("WEBGL_lose_context");M&&M.loseContext(),$l(this._canvasContainer),$l(this._controlContainer),$l(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(wf);function $l(f){f.parentNode&&f.parentNode.removeChild(f)}var gu={showCompass:!0,showZoom:!0,visualizePitch:!1},Gu=function(f){var d=this;this.options=y.extend({},gu,f),this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Gu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},Gu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},Gu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lo(this._map,this._compass,this.options.visualizePitch)),this._container},Gu.prototype.onRemove=function(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Gu.prototype._createButton=function(f,d){var h=q.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},Gu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Lo=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new bl({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new tl({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),q.addEventListener(d,"mousedown",this.mousedown),q.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(d,"touchmove",this.touchmove),q.addEventListener(d,"touchend",this.touchend),q.addEventListener(d,"touchcancel",this.reset)};function Tu(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),M=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<M?f=g:h.locationPoint(w).distSqr(d)<M&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var I=h.locationPoint(f);if(I.x>=0&&I.y>=0&&I.x<=h.width&&I.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Lo.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),q.disableDrag()},Lo.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Lo.prototype.off=function(){var f=this.element;q.removeEventListener(f,"mousedown",this.mousedown),q.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(f,"touchmove",this.touchmove),q.removeEventListener(f,"touchend",this.touchend),q.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Lo.prototype.offTemp=function(){q.enableDrag(),q.removeEventListener(y.window,"mousemove",this.mousemove),q.removeEventListener(y.window,"mouseup",this.mouseup)},Lo.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),q.mousePos(this.element,f)),q.addEventListener(y.window,"mousemove",this.mousemove),q.addEventListener(y.window,"mouseup",this.mouseup)},Lo.prototype.mousemove=function(f){this.move(f,q.mousePos(this.element,f))},Lo.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Lo.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Lo.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Lo.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Lo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Hu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Wc(f,d,h){var g=f.classList;for(var w in Hu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Yl,yc=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div"),this._element.setAttribute("aria-label","Map marker");var w=q.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var M=q.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");var I=q.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");var F=q.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var j=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];j<J.length;j+=1){var ye=J[j],le=q.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",ye.rx),le.setAttributeNS(null,"ry",ye.ry),F.appendChild(le)}var Ee=q.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var Ue=q.createNS("http://www.w3.org/2000/svg","path");Ue.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(Ue);var je=q.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var nt=q.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(nt);var Ne=q.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");var at=q.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var rt=q.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#000000"),rt.setAttributeNS(null,"opacity","0.25"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962");var be=q.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),at.appendChild(rt),at.appendChild(be),I.appendChild(F),I.appendChild(Ee),I.appendChild(je),I.appendChild(Ne),I.appendChild(at),w.appendChild(I),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(or){or.preventDefault()}),this._element.addEventListener("mousedown",function(or){or.preventDefault()}),Wc(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Tu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,Hu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Fo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Xc=0,_c=!1,Ph=function(f){function d(h){f.call(this),this.options=y.extend({},Fo,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Yl!==void 0?g(Yl):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Yl=w.state!=="denied")}):g(Yl=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xc=0,_c=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,M=this._map.getBearing(),I=y.extend({bearing:M},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),I,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),M=g.distanceTo(w),I=Math.ceil(2*this._accuracy/M);this._circleElement.style.width=I+"px",this._circleElement.style.height=I+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&_c)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(I){return I.preventDefault()}),this._geolocateButton=q.create("button","mapboxgl-ctrl-geolocate",this._container),q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var M=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=M,this._geolocateButton.setAttribute("aria-label",M)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new yc(this._dotElement),this._circleElement=q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(I){I.geolocateSource||g._watchState!=="ACTIVE_LOCK"||I.originalEvent&&I.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xc--,_c=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Xc>1?(h={maximumAge:6e5,timeout:0},_c=!0):(h=this.options.positionOptions,_c=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),Sl={maxWidth:100,unit:"metric"},ql=function(f){this.options=y.extend({},Sl,f),y.bindAll(["_onMove","setUnit"],this)};function nl(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,M=f.unproject([0,w]),I=f.unproject([g,w]),F=M.distanceTo(I);if(h&&h.unit==="imperial"){var j=3.2808*F;j>5280?Wu(d,g,j/5280,f._getUIString("ScaleControl.Miles")):Wu(d,g,j,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Wu(d,g,F/1852,f._getUIString("ScaleControl.NauticalMiles")):F>=1e3?Wu(d,g,F/1e3,f._getUIString("ScaleControl.Kilometers")):Wu(d,g,F,f._getUIString("ScaleControl.Meters"))}function Wu(f,d,h,g){var w,M,I,F=(w=h,(M=Math.pow(10,(""+Math.floor(w)).length-1))*(I=(I=w/M)>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(j){var J=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*J)/J}(I)));f.style.width=d*(F/h)+"px",f.innerHTML=F+"&nbsp;"+g}ql.prototype.getDefaultPosition=function(){return"bottom-left"},ql.prototype._onMove=function(){nl(this._map,this._container,this.options)},ql.prototype.onAdd=function(f){return this._map=f,this._container=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ql.prototype.onRemove=function(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ql.prototype.setUnit=function(f){this.options.unit=f,nl(this._map,this._container,this.options)};var ks=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};ks.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ks.prototype.onRemove=function(){q.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ks.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},ks.prototype._setupUI=function(){var f=this._fullscreenButton=q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ks.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},ks.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ks.prototype._isFullscreen=function(){return this._fullscreen},ks.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ks.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var $c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Jf=function(f){function d(h){f.call(this),this.options=y.extend(Object.create($c),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),M=y.window.document.createElement("body");for(M.innerHTML=h;g=M.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(le){return g._container.classList.add(le)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),M=this.options.anchor,I=function le(Ee){if(Ee){if(typeof Ee=="number"){var Ue=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ee),"top-left":new y.Point(Ue,Ue),"top-right":new y.Point(-Ue,Ue),bottom:new y.Point(0,-Ee),"bottom-left":new y.Point(Ue,-Ue),"bottom-right":new y.Point(-Ue,-Ue),left:new y.Point(Ee,0),right:new y.Point(-Ee,0)}}if(Ee instanceof y.Point||Array.isArray(Ee)){var je=y.Point.convert(Ee);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:y.Point.convert(Ee.center||[0,0]),top:y.Point.convert(Ee.top||[0,0]),"top-left":y.Point.convert(Ee["top-left"]||[0,0]),"top-right":y.Point.convert(Ee["top-right"]||[0,0]),bottom:y.Point.convert(Ee.bottom||[0,0]),"bottom-left":y.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ee["bottom-right"]||[0,0]),left:y.Point.convert(Ee.left||[0,0]),right:y.Point.convert(Ee.right||[0,0])}}return le(new y.Point(0,0))}(this.options.offset);if(!M){var F,j=this._container.offsetWidth,J=this._container.offsetHeight;F=w.y+I.bottom.y<J?["top"]:w.y>this._map.transform.height-J?["bottom"]:[],w.x<j/2?F.push("left"):w.x>this._map.transform.width-j/2&&F.push("right"),M=F.length===0?"bottom":F.join("-")}var ye=w.add(I[M]).round();q.setTransform(this._container,Hu[M]+" translate("+ye.x+"px,"+ye.y+"px)"),Wc(this._container,M,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(xc);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),Kl={version:y.version,supported:Pe,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Qf,NavigationControl:Gu,GeolocateControl:Ph,AttributionControl:os,ScaleControl:ql,FullscreenControl:ks,Popup:Jf,Marker:yc,Style:ds,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Gt().acquire(er)},clearPrewarmedResources:function(){var f=On;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(er),On=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return Or.workerCount},set workerCount(f){Or.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return Kl}),De})},3614:function(Tn,me,se){"use strict";Tn.exports=he;var De=se(80645);function he(ue){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ue)?ue:new Uint8Array(ue||0),this.pos=0,this.type=0,this.length=this.buf.length}he.Varint=0,he.Fixed64=1,he.Bytes=2,he.Fixed32=5;var y=(1<<16)*(1<<16),Pe=1/y,q=12,Ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");he.prototype={destroy:function(){this.buf=null},readFields:function(ue,He,W){for(W=W||this.length;this.pos<W;){var Y=this.readVarint(),Re=Y>>3,gt=this.pos;this.type=Y&7,ue(Re,He,this),this.pos===gt&&this.skip(Y)}return He},readMessage:function(ue,He){return this.readFields(ue,He,this.readVarint()+this.pos)},readFixed32:function(){var ue=Tt(this.buf,this.pos);return this.pos+=4,ue},readSFixed32:function(){var ue=jt(this.buf,this.pos);return this.pos+=4,ue},readFixed64:function(){var ue=Tt(this.buf,this.pos)+Tt(this.buf,this.pos+4)*y;return this.pos+=8,ue},readSFixed64:function(){var ue=Tt(this.buf,this.pos)+jt(this.buf,this.pos+4)*y;return this.pos+=8,ue},readFloat:function(){var ue=De.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ue},readDouble:function(){var ue=De.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ue},readVarint:function(ue){var He=this.buf,W,Y;return Y=He[this.pos++],W=Y&127,Y<128||(Y=He[this.pos++],W|=(Y&127)<<7,Y<128)||(Y=He[this.pos++],W|=(Y&127)<<14,Y<128)||(Y=He[this.pos++],W|=(Y&127)<<21,Y<128)?W:(Y=He[this.pos],W|=(Y&15)<<28,pe(W,ue,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ue=this.readVarint();return ue%2==1?(ue+1)/-2:ue/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ue=this.readVarint()+this.pos,He=this.pos;return this.pos=ue,ue-He>=q&&Ce?lr(this.buf,He,ue):dt(this.buf,He,ue)},readBytes:function(){var ue=this.readVarint()+this.pos,He=this.buf.subarray(this.pos,ue);return this.pos=ue,He},readPackedVarint:function(ue,He){if(this.type!==he.Bytes)return ue.push(this.readVarint(He));var W=Ke(this);for(ue=ue||[];this.pos<W;)ue.push(this.readVarint(He));return ue},readPackedSVarint:function(ue){if(this.type!==he.Bytes)return ue.push(this.readSVarint());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readSVarint());return ue},readPackedBoolean:function(ue){if(this.type!==he.Bytes)return ue.push(this.readBoolean());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readBoolean());return ue},readPackedFloat:function(ue){if(this.type!==he.Bytes)return ue.push(this.readFloat());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readFloat());return ue},readPackedDouble:function(ue){if(this.type!==he.Bytes)return ue.push(this.readDouble());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readDouble());return ue},readPackedFixed32:function(ue){if(this.type!==he.Bytes)return ue.push(this.readFixed32());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readFixed32());return ue},readPackedSFixed32:function(ue){if(this.type!==he.Bytes)return ue.push(this.readSFixed32());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readSFixed32());return ue},readPackedFixed64:function(ue){if(this.type!==he.Bytes)return ue.push(this.readFixed64());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readFixed64());return ue},readPackedSFixed64:function(ue){if(this.type!==he.Bytes)return ue.push(this.readSFixed64());var He=Ke(this);for(ue=ue||[];this.pos<He;)ue.push(this.readSFixed64());return ue},skip:function(ue){var He=ue&7;if(He===he.Varint)for(;this.buf[this.pos++]>127;);else if(He===he.Bytes)this.pos=this.readVarint()+this.pos;else if(He===he.Fixed32)this.pos+=4;else if(He===he.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+He)},writeTag:function(ue,He){this.writeVarint(ue<<3|He)},realloc:function(ue){for(var He=this.length||16;He<this.pos+ue;)He*=2;if(He!==this.length){var W=new Uint8Array(He);W.set(this.buf),this.buf=W,this.length=He}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ue){this.realloc(4),ht(this.buf,ue,this.pos),this.pos+=4},writeSFixed32:function(ue){this.realloc(4),ht(this.buf,ue,this.pos),this.pos+=4},writeFixed64:function(ue){this.realloc(8),ht(this.buf,ue&-1,this.pos),ht(this.buf,Math.floor(ue*Pe),this.pos+4),this.pos+=8},writeSFixed64:function(ue){this.realloc(8),ht(this.buf,ue&-1,this.pos),ht(this.buf,Math.floor(ue*Pe),this.pos+4),this.pos+=8},writeVarint:function(ue){if(ue=+ue||0,ue>268435455||ue<0){ot(ue,this);return}this.realloc(4),this.buf[this.pos++]=ue&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=ue>>>7&127)))},writeSVarint:function(ue){this.writeVarint(ue<0?-ue*2-1:ue*2)},writeBoolean:function(ue){this.writeVarint(Boolean(ue))},writeString:function(ue){ue=String(ue),this.realloc(ue.length*4),this.pos++;var He=this.pos;this.pos=jr(this.buf,ue,this.pos);var W=this.pos-He;W>=128&&Dt(He,W,this),this.pos=He-1,this.writeVarint(W),this.pos+=W},writeFloat:function(ue){this.realloc(4),De.write(this.buf,ue,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ue){this.realloc(8),De.write(this.buf,ue,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ue){var He=ue.length;this.writeVarint(He),this.realloc(He);for(var W=0;W<He;W++)this.buf[this.pos++]=ue[W]},writeRawMessage:function(ue,He){this.pos++;var W=this.pos;ue(He,this);var Y=this.pos-W;Y>=128&&Dt(W,Y,this),this.pos=W-1,this.writeVarint(Y),this.pos+=Y},writeMessage:function(ue,He,W){this.writeTag(ue,he.Bytes),this.writeRawMessage(He,W)},writePackedVarint:function(ue,He){He.length&&this.writeMessage(ue,_r,He)},writePackedSVarint:function(ue,He){He.length&&this.writeMessage(ue,Nt,He)},writePackedBoolean:function(ue,He){He.length&&this.writeMessage(ue,Pt,He)},writePackedFloat:function(ue,He){He.length&&this.writeMessage(ue,gr,He)},writePackedDouble:function(ue,He){He.length&&this.writeMessage(ue,Qt,He)},writePackedFixed32:function(ue,He){He.length&&this.writeMessage(ue,Ft,He)},writePackedSFixed32:function(ue,He){He.length&&this.writeMessage(ue,xr,He)},writePackedFixed64:function(ue,He){He.length&&this.writeMessage(ue,ee,He)},writePackedSFixed64:function(ue,He){He.length&&this.writeMessage(ue,sr,He)},writeBytesField:function(ue,He){this.writeTag(ue,he.Bytes),this.writeBytes(He)},writeFixed32Field:function(ue,He){this.writeTag(ue,he.Fixed32),this.writeFixed32(He)},writeSFixed32Field:function(ue,He){this.writeTag(ue,he.Fixed32),this.writeSFixed32(He)},writeFixed64Field:function(ue,He){this.writeTag(ue,he.Fixed64),this.writeFixed64(He)},writeSFixed64Field:function(ue,He){this.writeTag(ue,he.Fixed64),this.writeSFixed64(He)},writeVarintField:function(ue,He){this.writeTag(ue,he.Varint),this.writeVarint(He)},writeSVarintField:function(ue,He){this.writeTag(ue,he.Varint),this.writeSVarint(He)},writeStringField:function(ue,He){this.writeTag(ue,he.Bytes),this.writeString(He)},writeFloatField:function(ue,He){this.writeTag(ue,he.Fixed32),this.writeFloat(He)},writeDoubleField:function(ue,He){this.writeTag(ue,he.Fixed64),this.writeDouble(He)},writeBooleanField:function(ue,He){this.writeVarintField(ue,Boolean(He))}};function pe(ue,He,W){var Y=W.buf,Re,gt;if(gt=Y[W.pos++],Re=(gt&112)>>4,gt<128||(gt=Y[W.pos++],Re|=(gt&127)<<3,gt<128)||(gt=Y[W.pos++],Re|=(gt&127)<<10,gt<128)||(gt=Y[W.pos++],Re|=(gt&127)<<17,gt<128)||(gt=Y[W.pos++],Re|=(gt&127)<<24,gt<128)||(gt=Y[W.pos++],Re|=(gt&1)<<31,gt<128))return Se(ue,Re,He);throw new Error("Expected varint not more than 10 bytes")}function Ke(ue){return ue.type===he.Bytes?ue.readVarint()+ue.pos:ue.pos+1}function Se(ue,He,W){return W?He*4294967296+(ue>>>0):(He>>>0)*4294967296+(ue>>>0)}function ot(ue,He){var W,Y;if(ue>=0?(W=ue%4294967296|0,Y=ue/4294967296|0):(W=~(-ue%4294967296),Y=~(-ue/4294967296),W^4294967295?W=W+1|0:(W=0,Y=Y+1|0)),ue>=18446744073709552e3||ue<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");He.realloc(10),mt(W,Y,He),bt(Y,He)}function mt(ue,He,W){W.buf[W.pos++]=ue&127|128,ue>>>=7,W.buf[W.pos++]=ue&127|128,ue>>>=7,W.buf[W.pos++]=ue&127|128,ue>>>=7,W.buf[W.pos++]=ue&127|128,ue>>>=7,W.buf[W.pos]=ue&127}function bt(ue,He){var W=(ue&7)<<4;He.buf[He.pos++]|=W|((ue>>>=3)?128:0),!!ue&&(He.buf[He.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(He.buf[He.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(He.buf[He.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(He.buf[He.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(He.buf[He.pos++]=ue&127)))))}function Dt(ue,He,W){var Y=He<=16383?1:He<=2097151?2:He<=268435455?3:Math.floor(Math.log(He)/(Math.LN2*7));W.realloc(Y);for(var Re=W.pos-1;Re>=ue;Re--)W.buf[Re+Y]=W.buf[Re]}function _r(ue,He){for(var W=0;W<ue.length;W++)He.writeVarint(ue[W])}function Nt(ue,He){for(var W=0;W<ue.length;W++)He.writeSVarint(ue[W])}function gr(ue,He){for(var W=0;W<ue.length;W++)He.writeFloat(ue[W])}function Qt(ue,He){for(var W=0;W<ue.length;W++)He.writeDouble(ue[W])}function Pt(ue,He){for(var W=0;W<ue.length;W++)He.writeBoolean(ue[W])}function Ft(ue,He){for(var W=0;W<ue.length;W++)He.writeFixed32(ue[W])}function xr(ue,He){for(var W=0;W<ue.length;W++)He.writeSFixed32(ue[W])}function ee(ue,He){for(var W=0;W<ue.length;W++)He.writeFixed64(ue[W])}function sr(ue,He){for(var W=0;W<ue.length;W++)He.writeSFixed64(ue[W])}function Tt(ue,He){return(ue[He]|ue[He+1]<<8|ue[He+2]<<16)+ue[He+3]*16777216}function ht(ue,He,W){ue[W]=He,ue[W+1]=He>>>8,ue[W+2]=He>>>16,ue[W+3]=He>>>24}function jt(ue,He){return(ue[He]|ue[He+1]<<8|ue[He+2]<<16)+(ue[He+3]<<24)}function dt(ue,He,W){for(var Y="",Re=He;Re<W;){var gt=ue[Re],wt=null,qt=gt>239?4:gt>223?3:gt>191?2:1;if(Re+qt>W)break;var fr,br,bn;qt===1?gt<128&&(wt=gt):qt===2?(fr=ue[Re+1],(fr&192)==128&&(wt=(gt&31)<<6|fr&63,wt<=127&&(wt=null))):qt===3?(fr=ue[Re+1],br=ue[Re+2],(fr&192)==128&&(br&192)==128&&(wt=(gt&15)<<12|(fr&63)<<6|br&63,(wt<=2047||wt>=55296&&wt<=57343)&&(wt=null))):qt===4&&(fr=ue[Re+1],br=ue[Re+2],bn=ue[Re+3],(fr&192)==128&&(br&192)==128&&(bn&192)==128&&(wt=(gt&15)<<18|(fr&63)<<12|(br&63)<<6|bn&63,(wt<=65535||wt>=1114112)&&(wt=null))),wt===null?(wt=65533,qt=1):wt>65535&&(wt-=65536,Y+=String.fromCharCode(wt>>>10&1023|55296),wt=56320|wt&1023),Y+=String.fromCharCode(wt),Re+=qt}return Y}function lr(ue,He,W){return Ce.decode(ue.subarray(He,W))}function jr(ue,He,W){for(var Y=0,Re,gt;Y<He.length;Y++){if(Re=He.charCodeAt(Y),Re>55295&&Re<57344)if(gt)if(Re<56320){ue[W++]=239,ue[W++]=191,ue[W++]=189,gt=Re;continue}else Re=gt-55296<<10|Re-56320|65536,gt=null;else{Re>56319||Y+1===He.length?(ue[W++]=239,ue[W++]=191,ue[W++]=189):gt=Re;continue}else gt&&(ue[W++]=239,ue[W++]=191,ue[W++]=189,gt=null);Re<128?ue[W++]=Re:(Re<2048?ue[W++]=Re>>6|192:(Re<65536?ue[W++]=Re>>12|224:(ue[W++]=Re>>18|240,ue[W++]=Re>>12&63|128),ue[W++]=Re>>6&63|128),ue[W++]=Re&63|128)}return W}},32676:function(Tn,me,se){var De=se(34155);(function(he,y){Tn.exports=y()})(this,function(){"use strict";function he(Et,de){if(!(Et instanceof de))throw new TypeError("Cannot call a class as a function")}function y(Et,de){for(var ae=0;ae<de.length;ae++){var xe=de[ae];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(Et,xe.key,xe)}}function Pe(Et,de,ae){return de&&y(Et.prototype,de),ae&&y(Et,ae),Et}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var q=function(){function Et(de,ae){this.next=null,this.key=de,this.data=ae,this.left=null,this.right=null}return Et}();function Ce(Et,de){return Et>de?1:Et<de?-1:0}function pe(Et,de,ae){for(var xe=new q(null,null),N=xe,Qe=xe;;){var Wt=ae(Et,de.key);if(Wt<0){if(de.left===null)break;if(ae(Et,de.left.key)<0){var Dr=de.left;if(de.left=Dr.right,Dr.right=de,de=Dr,de.left===null)break}Qe.left=de,Qe=de,de=de.left}else if(Wt>0){if(de.right===null)break;if(ae(Et,de.right.key)>0){var Dr=de.right;if(de.right=Dr.left,Dr.left=de,de=Dr,de.right===null)break}N.right=de,N=de,de=de.right}else break}return N.right=de.left,Qe.left=de.right,de.left=xe.right,de.right=xe.left,de}function Ke(Et,de,ae,xe){var N=new q(Et,de);if(ae===null)return N.left=N.right=null,N;ae=pe(Et,ae,xe);var Qe=xe(Et,ae.key);return Qe<0?(N.left=ae.left,N.right=ae,ae.left=null):Qe>=0&&(N.right=ae.right,N.left=ae,ae.right=null),N}function Se(Et,de,ae){var xe=null,N=null;if(de){de=pe(Et,de,ae);var Qe=ae(de.key,Et);Qe===0?(xe=de.left,N=de.right):Qe<0?(N=de.right,de.right=null,xe=de):(xe=de.left,de.left=null,N=de)}return{left:xe,right:N}}function ot(Et,de,ae){return de===null?Et:(Et===null||(de=pe(Et.key,de,ae),de.left=Et),de)}function mt(Et,de,ae,xe,N){if(Et){xe(""+de+(ae?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+N(Et)+`
`);var Qe=de+(ae?"    ":"\u2502   ");Et.left&&mt(Et.left,Qe,!1,xe,N),Et.right&&mt(Et.right,Qe,!0,xe,N)}}var bt=function(){function Et(de){de===void 0&&(de=Ce),this._root=null,this._size=0,this._comparator=de}return Et.prototype.insert=function(de,ae){return this._size++,this._root=Ke(de,ae,this._root,this._comparator)},Et.prototype.add=function(de,ae){var xe=new q(de,ae);this._root===null&&(xe.left=xe.right=null,this._size++,this._root=xe);var N=this._comparator,Qe=pe(de,this._root,N),Wt=N(de,Qe.key);return Wt===0?this._root=Qe:(Wt<0?(xe.left=Qe.left,xe.right=Qe,Qe.left=null):Wt>0&&(xe.right=Qe.right,xe.left=Qe,Qe.right=null),this._size++,this._root=xe),this._root},Et.prototype.remove=function(de){this._root=this._remove(de,this._root,this._comparator)},Et.prototype._remove=function(de,ae,xe){var N;if(ae===null)return null;ae=pe(de,ae,xe);var Qe=xe(de,ae.key);return Qe===0?(ae.left===null?N=ae.right:(N=pe(de,ae.left,xe),N.right=ae.right),this._size--,N):ae},Et.prototype.pop=function(){var de=this._root;if(de){for(;de.left;)de=de.left;return this._root=pe(de.key,this._root,this._comparator),this._root=this._remove(de.key,this._root,this._comparator),{key:de.key,data:de.data}}return null},Et.prototype.findStatic=function(de){for(var ae=this._root,xe=this._comparator;ae;){var N=xe(de,ae.key);if(N===0)return ae;N<0?ae=ae.left:ae=ae.right}return null},Et.prototype.find=function(de){return this._root&&(this._root=pe(de,this._root,this._comparator),this._comparator(de,this._root.key)!==0)?null:this._root},Et.prototype.contains=function(de){for(var ae=this._root,xe=this._comparator;ae;){var N=xe(de,ae.key);if(N===0)return!0;N<0?ae=ae.left:ae=ae.right}return!1},Et.prototype.forEach=function(de,ae){for(var xe=this._root,N=[],Qe=!1;!Qe;)xe!==null?(N.push(xe),xe=xe.left):N.length!==0?(xe=N.pop(),de.call(ae,xe),xe=xe.right):Qe=!0;return this},Et.prototype.range=function(de,ae,xe,N){for(var Qe=[],Wt=this._comparator,Dr=this._root,qe;Qe.length!==0||Dr;)if(Dr)Qe.push(Dr),Dr=Dr.left;else{if(Dr=Qe.pop(),qe=Wt(Dr.key,ae),qe>0)break;if(Wt(Dr.key,de)>=0&&xe.call(N,Dr))return this;Dr=Dr.right}return this},Et.prototype.keys=function(){var de=[];return this.forEach(function(ae){var xe=ae.key;return de.push(xe)}),de},Et.prototype.values=function(){var de=[];return this.forEach(function(ae){var xe=ae.data;return de.push(xe)}),de},Et.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Et.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Et.prototype.minNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.left;)de=de.left;return de},Et.prototype.maxNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.right;)de=de.right;return de},Et.prototype.at=function(de){for(var ae=this._root,xe=!1,N=0,Qe=[];!xe;)if(ae)Qe.push(ae),ae=ae.left;else if(Qe.length>0){if(ae=Qe.pop(),N===de)return ae;N++,ae=ae.right}else xe=!0;return null},Et.prototype.next=function(de){var ae=this._root,xe=null;if(de.right){for(xe=de.right;xe.left;)xe=xe.left;return xe}for(var N=this._comparator;ae;){var Qe=N(de.key,ae.key);if(Qe===0)break;Qe<0?(xe=ae,ae=ae.left):ae=ae.right}return xe},Et.prototype.prev=function(de){var ae=this._root,xe=null;if(de.left!==null){for(xe=de.left;xe.right;)xe=xe.right;return xe}for(var N=this._comparator;ae;){var Qe=N(de.key,ae.key);if(Qe===0)break;Qe<0?ae=ae.left:(xe=ae,ae=ae.right)}return xe},Et.prototype.clear=function(){return this._root=null,this._size=0,this},Et.prototype.toList=function(){return Nt(this._root)},Et.prototype.load=function(de,ae,xe){ae===void 0&&(ae=[]),xe===void 0&&(xe=!1);var N=de.length,Qe=this._comparator;if(xe&&Pt(de,ae,0,N-1,Qe),this._root===null)this._root=Dt(de,ae,0,N),this._size=N;else{var Wt=Qt(this.toList(),_r(de,ae),Qe);N=this._size+N,this._root=gr({head:Wt},0,N)}return this},Et.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Et.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Et.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Et.prototype.toString=function(de){de===void 0&&(de=function(N){return String(N.key)});var ae=[];return mt(this._root,"",!0,function(xe){return ae.push(xe)},de),ae.join("")},Et.prototype.update=function(de,ae,xe){var N=this._comparator,Qe=Se(de,this._root,N),Wt=Qe.left,Dr=Qe.right;N(de,ae)<0?Dr=Ke(ae,xe,Dr,N):Wt=Ke(ae,xe,Wt,N),this._root=ot(Wt,Dr,N)},Et.prototype.split=function(de){return Se(de,this._root,this._comparator)},Et}();function Dt(Et,de,ae,xe){var N=xe-ae;if(N>0){var Qe=ae+Math.floor(N/2),Wt=Et[Qe],Dr=de[Qe],qe=new q(Wt,Dr);return qe.left=Dt(Et,de,ae,Qe),qe.right=Dt(Et,de,Qe+1,xe),qe}return null}function _r(Et,de){for(var ae=new q(null,null),xe=ae,N=0;N<Et.length;N++)xe=xe.next=new q(Et[N],de[N]);return xe.next=null,ae.next}function Nt(Et){for(var de=Et,ae=[],xe=!1,N=new q(null,null),Qe=N;!xe;)de?(ae.push(de),de=de.left):ae.length>0?(de=Qe=Qe.next=ae.pop(),de=de.right):xe=!0;return Qe.next=null,N.next}function gr(Et,de,ae){var xe=ae-de;if(xe>0){var N=de+Math.floor(xe/2),Qe=gr(Et,de,N),Wt=Et.head;return Wt.left=Qe,Et.head=Et.head.next,Wt.right=gr(Et,N+1,ae),Wt}return null}function Qt(Et,de,ae){for(var xe=new q(null,null),N=xe,Qe=Et,Wt=de;Qe!==null&&Wt!==null;)ae(Qe.key,Wt.key)<0?(N.next=Qe,Qe=Qe.next):(N.next=Wt,Wt=Wt.next),N=N.next;return Qe!==null?N.next=Qe:Wt!==null&&(N.next=Wt),xe.next}function Pt(Et,de,ae,xe,N){if(!(ae>=xe)){for(var Qe=Et[ae+xe>>1],Wt=ae-1,Dr=xe+1;;){do Wt++;while(N(Et[Wt],Qe)<0);do Dr--;while(N(Et[Dr],Qe)>0);if(Wt>=Dr)break;var qe=Et[Wt];Et[Wt]=Et[Dr],Et[Dr]=qe,qe=de[Wt],de[Wt]=de[Dr],de[Dr]=qe}Pt(Et,de,ae,Dr,N),Pt(Et,de,Dr+1,xe,N)}}var Ft=function(de,ae){return de.ll.x<=ae.x&&ae.x<=de.ur.x&&de.ll.y<=ae.y&&ae.y<=de.ur.y},xr=function(de,ae){if(ae.ur.x<de.ll.x||de.ur.x<ae.ll.x||ae.ur.y<de.ll.y||de.ur.y<ae.ll.y)return null;var xe=de.ll.x<ae.ll.x?ae.ll.x:de.ll.x,N=de.ur.x<ae.ur.x?de.ur.x:ae.ur.x,Qe=de.ll.y<ae.ll.y?ae.ll.y:de.ll.y,Wt=de.ur.y<ae.ur.y?de.ur.y:ae.ur.y;return{ll:{x:xe,y:Qe},ur:{x:N,y:Wt}}},ee=Number.EPSILON;ee===void 0&&(ee=Math.pow(2,-52));var sr=ee*ee,Tt=function(de,ae){if(-ee<de&&de<ee&&-ee<ae&&ae<ee)return 0;var xe=de-ae;return xe*xe<sr*de*ae?0:de<ae?-1:1},ht=function(){function Et(){he(this,Et),this.reset()}return Pe(Et,[{key:"reset",value:function(){this.xRounder=new jt,this.yRounder=new jt}},{key:"round",value:function(ae,xe){return{x:this.xRounder.round(ae),y:this.yRounder.round(xe)}}}]),Et}(),jt=function(){function Et(){he(this,Et),this.tree=new bt,this.round(0)}return Pe(Et,[{key:"round",value:function(ae){var xe=this.tree.add(ae),N=this.tree.prev(xe);if(N!==null&&Tt(xe.key,N.key)===0)return this.tree.remove(ae),N.key;var Qe=this.tree.next(xe);return Qe!==null&&Tt(xe.key,Qe.key)===0?(this.tree.remove(ae),Qe.key):ae}}]),Et}(),dt=new ht,lr=function(de,ae){return de.x*ae.y-de.y*ae.x},jr=function(de,ae){return de.x*ae.x+de.y*ae.y},ue=function(de,ae,xe){var N={x:ae.x-de.x,y:ae.y-de.y},Qe={x:xe.x-de.x,y:xe.y-de.y},Wt=lr(N,Qe);return Tt(Wt,0)},He=function(de){return Math.sqrt(jr(de,de))},W=function(de,ae,xe){var N={x:ae.x-de.x,y:ae.y-de.y},Qe={x:xe.x-de.x,y:xe.y-de.y};return lr(Qe,N)/He(Qe)/He(N)},Y=function(de,ae,xe){var N={x:ae.x-de.x,y:ae.y-de.y},Qe={x:xe.x-de.x,y:xe.y-de.y};return jr(Qe,N)/He(Qe)/He(N)},Re=function(de,ae,xe){return ae.y===0?null:{x:de.x+ae.x/ae.y*(xe-de.y),y:xe}},gt=function(de,ae,xe){return ae.x===0?null:{x:xe,y:de.y+ae.y/ae.x*(xe-de.x)}},wt=function(de,ae,xe,N){if(ae.x===0)return gt(xe,N,de.x);if(N.x===0)return gt(de,ae,xe.x);if(ae.y===0)return Re(xe,N,de.y);if(N.y===0)return Re(de,ae,xe.y);var Qe=lr(ae,N);if(Qe==0)return null;var Wt={x:xe.x-de.x,y:xe.y-de.y},Dr=lr(Wt,ae)/Qe,qe=lr(Wt,N)/Qe,kt=de.x+qe*ae.x,hr=xe.x+Dr*N.x,kr=de.y+qe*ae.y,Hr=xe.y+Dr*N.y,qr=(kt+hr)/2,Hn=(kr+Hr)/2;return{x:qr,y:Hn}},qt=function(){Pe(Et,null,[{key:"compare",value:function(ae,xe){var N=Et.comparePoints(ae.point,xe.point);return N!==0?N:(ae.point!==xe.point&&ae.link(xe),ae.isLeft!==xe.isLeft?ae.isLeft?1:-1:br.compare(ae.segment,xe.segment))}},{key:"comparePoints",value:function(ae,xe){return ae.x<xe.x?-1:ae.x>xe.x?1:ae.y<xe.y?-1:ae.y>xe.y?1:0}}]);function Et(de,ae){he(this,Et),de.events===void 0?de.events=[this]:de.events.push(this),this.point=de,this.isLeft=ae}return Pe(Et,[{key:"link",value:function(ae){if(ae.point===this.point)throw new Error("Tried to link already linked events");for(var xe=ae.point.events,N=0,Qe=xe.length;N<Qe;N++){var Wt=xe[N];this.point.events.push(Wt),Wt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ae=this.point.events.length,xe=0;xe<ae;xe++){var N=this.point.events[xe];if(N.segment.consumedBy===void 0)for(var Qe=xe+1;Qe<ae;Qe++){var Wt=this.point.events[Qe];Wt.consumedBy===void 0&&N.otherSE.point.events===Wt.otherSE.point.events&&N.segment.consume(Wt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ae=[],xe=0,N=this.point.events.length;xe<N;xe++){var Qe=this.point.events[xe];Qe!==this&&!Qe.segment.ringOut&&Qe.segment.isInResult()&&ae.push(Qe)}return ae}},{key:"getLeftmostComparator",value:function(ae){var xe=this,N=new Map,Qe=function(Dr){var qe=Dr.otherSE;N.set(Dr,{sine:W(xe.point,ae.point,qe.point),cosine:Y(xe.point,ae.point,qe.point)})};return function(Wt,Dr){N.has(Wt)||Qe(Wt),N.has(Dr)||Qe(Dr);var qe=N.get(Wt),kt=qe.sine,hr=qe.cosine,kr=N.get(Dr),Hr=kr.sine,qr=kr.cosine;return kt>=0&&Hr>=0?hr<qr?1:hr>qr?-1:0:kt<0&&Hr<0?hr<qr?-1:hr>qr?1:0:Hr<kt?-1:Hr>kt?1:0}}}]),Et}(),fr=0,br=function(){Pe(Et,null,[{key:"compare",value:function(ae,xe){var N=ae.leftSE.point.x,Qe=xe.leftSE.point.x,Wt=ae.rightSE.point.x,Dr=xe.rightSE.point.x;if(Dr<N)return 1;if(Wt<Qe)return-1;var qe=ae.leftSE.point.y,kt=xe.leftSE.point.y,hr=ae.rightSE.point.y,kr=xe.rightSE.point.y;if(N<Qe){if(kt<qe&&kt<hr)return 1;if(kt>qe&&kt>hr)return-1;var Hr=ae.comparePoint(xe.leftSE.point);if(Hr<0)return 1;if(Hr>0)return-1;var qr=xe.comparePoint(ae.rightSE.point);return qr!==0?qr:-1}if(N>Qe){if(qe<kt&&qe<kr)return-1;if(qe>kt&&qe>kr)return 1;var Hn=xe.comparePoint(ae.leftSE.point);if(Hn!==0)return Hn;var Bn=ae.comparePoint(xe.rightSE.point);return Bn<0?1:Bn>0?-1:1}if(qe<kt)return-1;if(qe>kt)return 1;if(Wt<Dr){var Kr=xe.comparePoint(ae.rightSE.point);if(Kr!==0)return Kr}if(Wt>Dr){var fi=ae.comparePoint(xe.rightSE.point);if(fi<0)return 1;if(fi>0)return-1}if(Wt!==Dr){var ri=hr-qe,sa=Wt-N,wa=kr-kt,Na=Dr-Qe;if(ri>sa&&wa<Na)return 1;if(ri<sa&&wa>Na)return-1}return Wt>Dr?1:Wt<Dr||hr<kr?-1:hr>kr?1:ae.id<xe.id?-1:ae.id>xe.id?1:0}}]);function Et(de,ae,xe,N){he(this,Et),this.id=++fr,this.leftSE=de,de.segment=this,de.otherSE=ae,this.rightSE=ae,ae.segment=this,ae.otherSE=de,this.rings=xe,this.windings=N}return Pe(Et,[{key:"replaceRightSE",value:function(ae){this.rightSE=ae,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ae=this.leftSE.point.y,xe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ae<xe?ae:xe},ur:{x:this.rightSE.point.x,y:ae>xe?ae:xe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ae){return ae.x===this.leftSE.point.x&&ae.y===this.leftSE.point.y||ae.x===this.rightSE.point.x&&ae.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ae){if(this.isAnEndpoint(ae))return 0;var xe=this.leftSE.point,N=this.rightSE.point,Qe=this.vector();if(xe.x===N.x)return ae.x===xe.x?0:ae.x<xe.x?1:-1;var Wt=(ae.y-xe.y)/Qe.y,Dr=xe.x+Wt*Qe.x;if(ae.x===Dr)return 0;var qe=(ae.x-xe.x)/Qe.x,kt=xe.y+qe*Qe.y;return ae.y===kt?0:ae.y<kt?-1:1}},{key:"getIntersection",value:function(ae){var xe=this.bbox(),N=ae.bbox(),Qe=xr(xe,N);if(Qe===null)return null;var Wt=this.leftSE.point,Dr=this.rightSE.point,qe=ae.leftSE.point,kt=ae.rightSE.point,hr=Ft(xe,qe)&&this.comparePoint(qe)===0,kr=Ft(N,Wt)&&ae.comparePoint(Wt)===0,Hr=Ft(xe,kt)&&this.comparePoint(kt)===0,qr=Ft(N,Dr)&&ae.comparePoint(Dr)===0;if(kr&&hr)return qr&&!Hr?Dr:!qr&&Hr?kt:null;if(kr)return Hr&&Wt.x===kt.x&&Wt.y===kt.y?null:Wt;if(hr)return qr&&Dr.x===qe.x&&Dr.y===qe.y?null:qe;if(qr&&Hr)return null;if(qr)return Dr;if(Hr)return kt;var Hn=wt(Wt,this.vector(),qe,ae.vector());return Hn===null||!Ft(Qe,Hn)?null:dt.round(Hn.x,Hn.y)}},{key:"split",value:function(ae){var xe=[],N=ae.events!==void 0,Qe=new qt(ae,!0),Wt=new qt(ae,!1),Dr=this.rightSE;this.replaceRightSE(Wt),xe.push(Wt),xe.push(Qe);var qe=new Et(Qe,Dr,this.rings.slice(),this.windings.slice());return qt.comparePoints(qe.leftSE.point,qe.rightSE.point)>0&&qe.swapEvents(),qt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),N&&(Qe.checkForConsuming(),Wt.checkForConsuming()),xe}},{key:"swapEvents",value:function(){var ae=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ae,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var xe=0,N=this.windings.length;xe<N;xe++)this.windings[xe]*=-1}},{key:"consume",value:function(ae){for(var xe=this,N=ae;xe.consumedBy;)xe=xe.consumedBy;for(;N.consumedBy;)N=N.consumedBy;var Qe=Et.compare(xe,N);if(Qe!==0){if(Qe>0){var Wt=xe;xe=N,N=Wt}if(xe.prev===N){var Dr=xe;xe=N,N=Dr}for(var qe=0,kt=N.rings.length;qe<kt;qe++){var hr=N.rings[qe],kr=N.windings[qe],Hr=xe.rings.indexOf(hr);Hr===-1?(xe.rings.push(hr),xe.windings.push(kr)):xe.windings[Hr]+=kr}N.rings=null,N.windings=null,N.consumedBy=xe,N.leftSE.consumedBy=xe.leftSE,N.rightSE.consumedBy=xe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ae=this.prev.consumedBy||this.prev;this._beforeState=ae.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ae=this.beforeState();this._afterState={rings:ae.rings.slice(0),windings:ae.windings.slice(0),multiPolys:[]};for(var xe=this._afterState.rings,N=this._afterState.windings,Qe=this._afterState.multiPolys,Wt=0,Dr=this.rings.length;Wt<Dr;Wt++){var qe=this.rings[Wt],kt=this.windings[Wt],hr=xe.indexOf(qe);hr===-1?(xe.push(qe),N.push(kt)):N[hr]+=kt}for(var kr=[],Hr=[],qr=0,Hn=xe.length;qr<Hn;qr++)if(N[qr]!==0){var Bn=xe[qr],Kr=Bn.poly;if(Hr.indexOf(Kr)===-1)if(Bn.isExterior)kr.push(Kr);else{Hr.indexOf(Kr)===-1&&Hr.push(Kr);var fi=kr.indexOf(Bn.poly);fi!==-1&&kr.splice(fi,1)}}for(var ri=0,sa=kr.length;ri<sa;ri++){var wa=kr[ri].multiPoly;Qe.indexOf(wa)===-1&&Qe.push(wa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ae=this.beforeState().multiPolys,xe=this.afterState().multiPolys;switch(_i.type){case"union":{var N=ae.length===0,Qe=xe.length===0;this._isInResult=N!==Qe;break}case"intersection":{var Wt,Dr;ae.length<xe.length?(Wt=ae.length,Dr=xe.length):(Wt=xe.length,Dr=ae.length),this._isInResult=Dr===_i.numMultiPolys&&Wt<Dr;break}case"xor":{var qe=Math.abs(ae.length-xe.length);this._isInResult=qe%2==1;break}case"difference":{var kt=function(kr){return kr.length===1&&kr[0].isSubject};this._isInResult=kt(ae)!==kt(xe);break}default:throw new Error("Unrecognized operation type found ".concat(_i.type))}return this._isInResult}}],[{key:"fromRing",value:function(ae,xe,N){var Qe,Wt,Dr,qe=qt.comparePoints(ae,xe);if(qe<0)Qe=ae,Wt=xe,Dr=1;else if(qe>0)Qe=xe,Wt=ae,Dr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ae.x,", ").concat(ae.y,"]"));var kt=new qt(Qe,!0),hr=new qt(Wt,!1);return new Et(kt,hr,[N],[Dr])}}]),Et}(),bn=function(){function Et(de,ae,xe){if(he(this,Et),!Array.isArray(de)||de.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ae,this.isExterior=xe,this.segments=[],typeof de[0][0]!="number"||typeof de[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var N=dt.round(de[0][0],de[0][1]);this.bbox={ll:{x:N.x,y:N.y},ur:{x:N.x,y:N.y}};for(var Qe=N,Wt=1,Dr=de.length;Wt<Dr;Wt++){if(typeof de[Wt][0]!="number"||typeof de[Wt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var qe=dt.round(de[Wt][0],de[Wt][1]);qe.x===Qe.x&&qe.y===Qe.y||(this.segments.push(br.fromRing(Qe,qe,this)),qe.x<this.bbox.ll.x&&(this.bbox.ll.x=qe.x),qe.y<this.bbox.ll.y&&(this.bbox.ll.y=qe.y),qe.x>this.bbox.ur.x&&(this.bbox.ur.x=qe.x),qe.y>this.bbox.ur.y&&(this.bbox.ur.y=qe.y),Qe=qe)}(N.x!==Qe.x||N.y!==Qe.y)&&this.segments.push(br.fromRing(Qe,N,this))}return Pe(Et,[{key:"getSweepEvents",value:function(){for(var ae=[],xe=0,N=this.segments.length;xe<N;xe++){var Qe=this.segments[xe];ae.push(Qe.leftSE),ae.push(Qe.rightSE)}return ae}}]),Et}(),en=function(){function Et(de,ae){if(he(this,Et),!Array.isArray(de))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new bn(de[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var xe=1,N=de.length;xe<N;xe++){var Qe=new bn(de[xe],this,!1);Qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Qe.bbox.ll.x),Qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Qe.bbox.ll.y),Qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Qe.bbox.ur.x),Qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Qe.bbox.ur.y),this.interiorRings.push(Qe)}this.multiPoly=ae}return Pe(Et,[{key:"getSweepEvents",value:function(){for(var ae=this.exteriorRing.getSweepEvents(),xe=0,N=this.interiorRings.length;xe<N;xe++)for(var Qe=this.interiorRings[xe].getSweepEvents(),Wt=0,Dr=Qe.length;Wt<Dr;Wt++)ae.push(Qe[Wt]);return ae}}]),Et}(),Ci=function(){function Et(de,ae){if(he(this,Et),!Array.isArray(de))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof de[0][0][0]=="number"&&(de=[de])}catch(Wt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var xe=0,N=de.length;xe<N;xe++){var Qe=new en(de[xe],this);Qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Qe.bbox.ll.x),Qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Qe.bbox.ll.y),Qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Qe.bbox.ur.x),Qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Qe.bbox.ur.y),this.polys.push(Qe)}this.isSubject=ae}return Pe(Et,[{key:"getSweepEvents",value:function(){for(var ae=[],xe=0,N=this.polys.length;xe<N;xe++)for(var Qe=this.polys[xe].getSweepEvents(),Wt=0,Dr=Qe.length;Wt<Dr;Wt++)ae.push(Qe[Wt]);return ae}}]),Et}(),Wn=function(){Pe(Et,null,[{key:"factory",value:function(ae){for(var xe=[],N=0,Qe=ae.length;N<Qe;N++){var Wt=ae[N];if(!(!Wt.isInResult()||Wt.ringOut)){for(var Dr=null,qe=Wt.leftSE,kt=Wt.rightSE,hr=[qe],kr=qe.point,Hr=[];Dr=qe,qe=kt,hr.push(qe),qe.point!==kr;)for(;;){var qr=qe.getAvailableLinkedEvents();if(qr.length===0){var Hn=hr[0].point,Bn=hr[hr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Hn.x,",")+" ".concat(Hn.y,"]. Last matching segment found ends at")+" [".concat(Bn.x,", ").concat(Bn.y,"]."))}if(qr.length===1){kt=qr[0].otherSE;break}for(var Kr=null,fi=0,ri=Hr.length;fi<ri;fi++)if(Hr[fi].point===qe.point){Kr=fi;break}if(Kr!==null){var sa=Hr.splice(Kr)[0],wa=hr.splice(sa.index);wa.unshift(wa[0].otherSE),xe.push(new Et(wa.reverse()));continue}Hr.push({index:hr.length,point:qe.point});var Na=qe.getLeftmostComparator(Dr);kt=qr.sort(Na)[0].otherSE;break}xe.push(new Et(hr))}}return xe}}]);function Et(de){he(this,Et),this.events=de;for(var ae=0,xe=de.length;ae<xe;ae++)de[ae].segment.ringOut=this;this.poly=null}return Pe(Et,[{key:"getGeom",value:function(){for(var ae=this.events[0].point,xe=[ae],N=1,Qe=this.events.length-1;N<Qe;N++){var Wt=this.events[N].point,Dr=this.events[N+1].point;ue(Wt,ae,Dr)!==0&&(xe.push(Wt),ae=Wt)}if(xe.length===1)return null;var qe=xe[0],kt=xe[1];ue(qe,ae,kt)===0&&xe.shift(),xe.push(xe[0]);for(var hr=this.isExteriorRing()?1:-1,kr=this.isExteriorRing()?0:xe.length-1,Hr=this.isExteriorRing()?xe.length:-1,qr=[],Hn=kr;Hn!=Hr;Hn+=hr)qr.push([xe[Hn].x,xe[Hn].y]);return qr}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ae=this.enclosingRing();this._isExteriorRing=ae?!ae.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ae=this.events[0],xe=1,N=this.events.length;xe<N;xe++){var Qe=this.events[xe];qt.compare(ae,Qe)>0&&(ae=Qe)}for(var Wt=ae.segment.prevInResult(),Dr=Wt?Wt.prevInResult():null;;){if(!Wt)return null;if(!Dr)return Wt.ringOut;if(Dr.ringOut!==Wt.ringOut)return Dr.ringOut.enclosingRing()!==Wt.ringOut?Wt.ringOut:Wt.ringOut.enclosingRing();Wt=Dr.prevInResult(),Dr=Wt?Wt.prevInResult():null}}}]),Et}(),Vn=function(){function Et(de){he(this,Et),this.exteriorRing=de,de.poly=this,this.interiorRings=[]}return Pe(Et,[{key:"addInterior",value:function(ae){this.interiorRings.push(ae),ae.poly=this}},{key:"getGeom",value:function(){var ae=[this.exteriorRing.getGeom()];if(ae[0]===null)return null;for(var xe=0,N=this.interiorRings.length;xe<N;xe++){var Qe=this.interiorRings[xe].getGeom();Qe!==null&&ae.push(Qe)}return ae}}]),Et}(),va=function(){function Et(de){he(this,Et),this.rings=de,this.polys=this._composePolys(de)}return Pe(Et,[{key:"getGeom",value:function(){for(var ae=[],xe=0,N=this.polys.length;xe<N;xe++){var Qe=this.polys[xe].getGeom();Qe!==null&&ae.push(Qe)}return ae}},{key:"_composePolys",value:function(ae){for(var xe=[],N=0,Qe=ae.length;N<Qe;N++){var Wt=ae[N];if(!Wt.poly)if(Wt.isExteriorRing())xe.push(new Vn(Wt));else{var Dr=Wt.enclosingRing();Dr.poly||xe.push(new Vn(Dr)),Dr.poly.addInterior(Wt)}}return xe}}]),Et}(),Si=function(){function Et(de){var ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:br.compare;he(this,Et),this.queue=de,this.tree=new bt(ae),this.segments=[]}return Pe(Et,[{key:"process",value:function(ae){var xe=ae.segment,N=[];if(ae.consumedBy)return ae.isLeft?this.queue.remove(ae.otherSE):this.tree.remove(xe),N;var Qe=ae.isLeft?this.tree.insert(xe):this.tree.find(xe);if(!Qe)throw new Error("Unable to find segment #".concat(xe.id," ")+"[".concat(xe.leftSE.point.x,", ").concat(xe.leftSE.point.y,"] -> ")+"[".concat(xe.rightSE.point.x,", ").concat(xe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Wt=Qe,Dr=Qe,qe=void 0,kt=void 0;qe===void 0;)Wt=this.tree.prev(Wt),Wt===null?qe=null:Wt.key.consumedBy===void 0&&(qe=Wt.key);for(;kt===void 0;)Dr=this.tree.next(Dr),Dr===null?kt=null:Dr.key.consumedBy===void 0&&(kt=Dr.key);if(ae.isLeft){var hr=null;if(qe){var kr=qe.getIntersection(xe);if(kr!==null&&(xe.isAnEndpoint(kr)||(hr=kr),!qe.isAnEndpoint(kr)))for(var Hr=this._splitSafely(qe,kr),qr=0,Hn=Hr.length;qr<Hn;qr++)N.push(Hr[qr])}var Bn=null;if(kt){var Kr=kt.getIntersection(xe);if(Kr!==null&&(xe.isAnEndpoint(Kr)||(Bn=Kr),!kt.isAnEndpoint(Kr)))for(var fi=this._splitSafely(kt,Kr),ri=0,sa=fi.length;ri<sa;ri++)N.push(fi[ri])}if(hr!==null||Bn!==null){var wa=null;if(hr===null)wa=Bn;else if(Bn===null)wa=hr;else{var Na=qt.comparePoints(hr,Bn);wa=Na<=0?hr:Bn}this.queue.remove(xe.rightSE),N.push(xe.rightSE);for(var _a=xe.split(wa),ra=0,K=_a.length;ra<K;ra++)N.push(_a[ra])}N.length>0?(this.tree.remove(xe),N.push(ae)):(this.segments.push(xe),xe.prev=qe)}else{if(qe&&kt){var re=qe.getIntersection(kt);if(re!==null){if(!qe.isAnEndpoint(re))for(var fe=this._splitSafely(qe,re),we=0,Ze=fe.length;we<Ze;we++)N.push(fe[we]);if(!kt.isAnEndpoint(re))for(var tt=this._splitSafely(kt,re),pt=0,_e=tt.length;pt<_e;pt++)N.push(tt[pt])}}this.tree.remove(xe)}return N}},{key:"_splitSafely",value:function(ae,xe){this.tree.remove(ae);var N=ae.rightSE;this.queue.remove(N);var Qe=ae.split(xe);return Qe.push(N),ae.consumedBy===void 0&&this.tree.insert(ae),Qe}}]),Et}(),ci=typeof De!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Vi=typeof De!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,zi=function(){function Et(){he(this,Et)}return Pe(Et,[{key:"run",value:function(ae,xe,N){_i.type=ae,dt.reset();for(var Qe=[new Ci(xe,!0)],Wt=0,Dr=N.length;Wt<Dr;Wt++)Qe.push(new Ci(N[Wt],!1));if(_i.numMultiPolys=Qe.length,_i.type==="difference")for(var qe=Qe[0],kt=1;kt<Qe.length;)xr(Qe[kt].bbox,qe.bbox)!==null?kt++:Qe.splice(kt,1);if(_i.type==="intersection"){for(var hr=0,kr=Qe.length;hr<kr;hr++)for(var Hr=Qe[hr],qr=hr+1,Hn=Qe.length;qr<Hn;qr++)if(xr(Hr.bbox,Qe[qr].bbox)===null)return[]}for(var Bn=new bt(qt.compare),Kr=0,fi=Qe.length;Kr<fi;Kr++)for(var ri=Qe[Kr].getSweepEvents(),sa=0,wa=ri.length;sa<wa;sa++)if(Bn.insert(ri[sa]),Bn.size>ci)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Na=new Si(Bn),_a=Bn.size,ra=Bn.pop();ra;){var K=ra.key;if(Bn.size===_a){var re=K.segment;throw new Error("Unable to pop() ".concat(K.isLeft?"left":"right"," SweepEvent ")+"[".concat(K.point.x,", ").concat(K.point.y,"] from segment #").concat(re.id," ")+"[".concat(re.leftSE.point.x,", ").concat(re.leftSE.point.y,"] -> ")+"[".concat(re.rightSE.point.x,", ").concat(re.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Bn.size>ci)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Na.segments.length>Vi)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var fe=Na.process(K),we=0,Ze=fe.length;we<Ze;we++){var tt=fe[we];tt.consumedBy===void 0&&Bn.insert(tt)}_a=Bn.size,ra=Bn.pop()}dt.reset();var pt=Wn.factory(Na.segments),_e=new va(pt);return _e.getGeom()}}]),Et}(),_i=new zi,$n=function(de){for(var ae=arguments.length,xe=new Array(ae>1?ae-1:0),N=1;N<ae;N++)xe[N-1]=arguments[N];return _i.run("union",de,xe)},ii=function(de){for(var ae=arguments.length,xe=new Array(ae>1?ae-1:0),N=1;N<ae;N++)xe[N-1]=arguments[N];return _i.run("intersection",de,xe)},Co=function(de){for(var ae=arguments.length,xe=new Array(ae>1?ae-1:0),N=1;N<ae;N++)xe[N-1]=arguments[N];return _i.run("xor",de,xe)},Ba=function(de){for(var ae=arguments.length,xe=new Array(ae>1?ae-1:0),N=1;N<ae;N++)xe[N-1]=arguments[N];return _i.run("difference",de,xe)},ya={union:$n,intersection:ii,xor:Co,difference:Ba};return ya})},28660:function(Tn,me,se){var De=se(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var he;(function(y){(function(Pe){var q=typeof se.g=="object"?se.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Ce=pe(y);typeof q.Reflect=="undefined"?q.Reflect=y:Ce=pe(q.Reflect,Ce),Pe(Ce);function pe(Ke,Se){return function(ot,mt){typeof Ke[ot]!="function"&&Object.defineProperty(Ke,ot,{configurable:!0,writable:!0,value:mt}),Se&&Se(ot,mt)}}})(function(Pe){var q=Object.prototype.hasOwnProperty,Ce=typeof Symbol=="function",pe=Ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ke=Ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",Se=typeof Object.create=="function",ot={__proto__:[]}instanceof Array,mt=!Se&&!ot,bt={create:Se?function(){return Dr(Object.create(null))}:ot?function(){return Dr({__proto__:null})}:function(){return Dr({})},has:mt?function(qe,kt){return q.call(qe,kt)}:function(qe,kt){return kt in qe},get:mt?function(qe,kt){return q.call(qe,kt)?qe[kt]:void 0}:function(qe,kt){return qe[kt]}},Dt=Object.getPrototypeOf(Function),_r=typeof De=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Nt=!_r&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:N(),gr=!_r&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Qe(),Qt=!_r&&typeof WeakMap=="function"?WeakMap:Wt(),Pt=new Qt;function Ft(qe,kt,hr,kr){if(en(hr)){if(!_i(qe))throw new TypeError;if(!ii(kt))throw new TypeError;return ue(qe,kt)}else{if(!_i(qe))throw new TypeError;if(!Vn(kt))throw new TypeError;if(!Vn(kr)&&!en(kr)&&!Ci(kr))throw new TypeError;return Ci(kr)&&(kr=void 0),hr=zi(hr),He(qe,kt,hr,kr)}}Pe("decorate",Ft);function xr(qe,kt){function hr(kr,Hr){if(!Vn(kr))throw new TypeError;if(!en(Hr)&&!Co(Hr))throw new TypeError;qt(qe,kt,kr,Hr)}return hr}Pe("metadata",xr);function ee(qe,kt,hr,kr){if(!Vn(hr))throw new TypeError;return en(kr)||(kr=zi(kr)),qt(qe,kt,hr,kr)}Pe("defineMetadata",ee);function sr(qe,kt,hr){if(!Vn(kt))throw new TypeError;return en(hr)||(hr=zi(hr)),Y(qe,kt,hr)}Pe("hasMetadata",sr);function Tt(qe,kt,hr){if(!Vn(kt))throw new TypeError;return en(hr)||(hr=zi(hr)),Re(qe,kt,hr)}Pe("hasOwnMetadata",Tt);function ht(qe,kt,hr){if(!Vn(kt))throw new TypeError;return en(hr)||(hr=zi(hr)),gt(qe,kt,hr)}Pe("getMetadata",ht);function jt(qe,kt,hr){if(!Vn(kt))throw new TypeError;return en(hr)||(hr=zi(hr)),wt(qe,kt,hr)}Pe("getOwnMetadata",jt);function dt(qe,kt){if(!Vn(qe))throw new TypeError;return en(kt)||(kt=zi(kt)),fr(qe,kt)}Pe("getMetadataKeys",dt);function lr(qe,kt){if(!Vn(qe))throw new TypeError;return en(kt)||(kt=zi(kt)),br(qe,kt)}Pe("getOwnMetadataKeys",lr);function jr(qe,kt,hr){if(!Vn(kt))throw new TypeError;en(hr)||(hr=zi(hr));var kr=W(kt,hr,!1);if(en(kr)||!kr.delete(qe))return!1;if(kr.size>0)return!0;var Hr=Pt.get(kt);return Hr.delete(hr),Hr.size>0||Pt.delete(kt),!0}Pe("deleteMetadata",jr);function ue(qe,kt){for(var hr=qe.length-1;hr>=0;--hr){var kr=qe[hr],Hr=kr(kt);if(!en(Hr)&&!Ci(Hr)){if(!ii(Hr))throw new TypeError;kt=Hr}}return kt}function He(qe,kt,hr,kr){for(var Hr=qe.length-1;Hr>=0;--Hr){var qr=qe[Hr],Hn=qr(kt,hr,kr);if(!en(Hn)&&!Ci(Hn)){if(!Vn(Hn))throw new TypeError;kr=Hn}}return kr}function W(qe,kt,hr){var kr=Pt.get(qe);if(en(kr)){if(!hr)return;kr=new Nt,Pt.set(qe,kr)}var Hr=kr.get(kt);if(en(Hr)){if(!hr)return;Hr=new Nt,kr.set(kt,Hr)}return Hr}function Y(qe,kt,hr){var kr=Re(qe,kt,hr);if(kr)return!0;var Hr=xe(kt);return Ci(Hr)?!1:Y(qe,Hr,hr)}function Re(qe,kt,hr){var kr=W(kt,hr,!1);return en(kr)?!1:ci(kr.has(qe))}function gt(qe,kt,hr){var kr=Re(qe,kt,hr);if(kr)return wt(qe,kt,hr);var Hr=xe(kt);if(!Ci(Hr))return gt(qe,Hr,hr)}function wt(qe,kt,hr){var kr=W(kt,hr,!1);if(!en(kr))return kr.get(qe)}function qt(qe,kt,hr,kr){var Hr=W(hr,kr,!0);Hr.set(qe,kt)}function fr(qe,kt){var hr=br(qe,kt),kr=xe(qe);if(kr===null)return hr;var Hr=fr(kr,kt);if(Hr.length<=0)return hr;if(hr.length<=0)return Hr;for(var qr=new gr,Hn=[],Bn=0,Kr=hr;Bn<Kr.length;Bn++){var fi=Kr[Bn],ri=qr.has(fi);ri||(qr.add(fi),Hn.push(fi))}for(var sa=0,wa=Hr;sa<wa.length;sa++){var fi=wa[sa],ri=qr.has(fi);ri||(qr.add(fi),Hn.push(fi))}return Hn}function br(qe,kt){var hr=[],kr=W(qe,kt,!1);if(en(kr))return hr;for(var Hr=kr.keys(),qr=ya(Hr),Hn=0;;){var Bn=de(qr);if(!Bn)return hr.length=Hn,hr;var Kr=Et(Bn);try{hr[Hn]=Kr}catch(fi){try{ae(qr)}finally{throw fi}}Hn++}}function bn(qe){if(qe===null)return 1;switch(typeof qe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return qe===null?1:6;default:return 6}}function en(qe){return qe===void 0}function Ci(qe){return qe===null}function Wn(qe){return typeof qe=="symbol"}function Vn(qe){return typeof qe=="object"?qe!==null:typeof qe=="function"}function va(qe,kt){switch(bn(qe)){case 0:return qe;case 1:return qe;case 2:return qe;case 3:return qe;case 4:return qe;case 5:return qe}var hr=kt===3?"string":kt===5?"number":"default",kr=Ba(qe,pe);if(kr!==void 0){var Hr=kr.call(qe,hr);if(Vn(Hr))throw new TypeError;return Hr}return Si(qe,hr==="default"?"number":hr)}function Si(qe,kt){if(kt==="string"){var hr=qe.toString;if($n(hr)){var kr=hr.call(qe);if(!Vn(kr))return kr}var Hr=qe.valueOf;if($n(Hr)){var kr=Hr.call(qe);if(!Vn(kr))return kr}}else{var Hr=qe.valueOf;if($n(Hr)){var kr=Hr.call(qe);if(!Vn(kr))return kr}var qr=qe.toString;if($n(qr)){var kr=qr.call(qe);if(!Vn(kr))return kr}}throw new TypeError}function ci(qe){return!!qe}function Vi(qe){return""+qe}function zi(qe){var kt=va(qe,3);return Wn(kt)?kt:Vi(kt)}function _i(qe){return Array.isArray?Array.isArray(qe):qe instanceof Object?qe instanceof Array:Object.prototype.toString.call(qe)==="[object Array]"}function $n(qe){return typeof qe=="function"}function ii(qe){return typeof qe=="function"}function Co(qe){switch(bn(qe)){case 3:return!0;case 4:return!0;default:return!1}}function Ba(qe,kt){var hr=qe[kt];if(hr!=null){if(!$n(hr))throw new TypeError;return hr}}function ya(qe){var kt=Ba(qe,Ke);if(!$n(kt))throw new TypeError;var hr=kt.call(qe);if(!Vn(hr))throw new TypeError;return hr}function Et(qe){return qe.value}function de(qe){var kt=qe.next();return kt.done?!1:kt}function ae(qe){var kt=qe.return;kt&&kt.call(qe)}function xe(qe){var kt=Object.getPrototypeOf(qe);if(typeof qe!="function"||qe===Dt||kt!==Dt)return kt;var hr=qe.prototype,kr=hr&&Object.getPrototypeOf(hr);if(kr==null||kr===Object.prototype)return kt;var Hr=kr.constructor;return typeof Hr!="function"||Hr===qe?kt:Hr}function N(){var qe={},kt=[],hr=function(){function Hn(Bn,Kr,fi){this._index=0,this._keys=Bn,this._values=Kr,this._selector=fi}return Hn.prototype["@@iterator"]=function(){return this},Hn.prototype[Ke]=function(){return this},Hn.prototype.next=function(){var Bn=this._index;if(Bn>=0&&Bn<this._keys.length){var Kr=this._selector(this._keys[Bn],this._values[Bn]);return Bn+1>=this._keys.length?(this._index=-1,this._keys=kt,this._values=kt):this._index++,{value:Kr,done:!1}}return{value:void 0,done:!0}},Hn.prototype.throw=function(Bn){throw this._index>=0&&(this._index=-1,this._keys=kt,this._values=kt),Bn},Hn.prototype.return=function(Bn){return this._index>=0&&(this._index=-1,this._keys=kt,this._values=kt),{value:Bn,done:!0}},Hn}();return function(){function Hn(){this._keys=[],this._values=[],this._cacheKey=qe,this._cacheIndex=-2}return Object.defineProperty(Hn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Hn.prototype.has=function(Bn){return this._find(Bn,!1)>=0},Hn.prototype.get=function(Bn){var Kr=this._find(Bn,!1);return Kr>=0?this._values[Kr]:void 0},Hn.prototype.set=function(Bn,Kr){var fi=this._find(Bn,!0);return this._values[fi]=Kr,this},Hn.prototype.delete=function(Bn){var Kr=this._find(Bn,!1);if(Kr>=0){for(var fi=this._keys.length,ri=Kr+1;ri<fi;ri++)this._keys[ri-1]=this._keys[ri],this._values[ri-1]=this._values[ri];return this._keys.length--,this._values.length--,Bn===this._cacheKey&&(this._cacheKey=qe,this._cacheIndex=-2),!0}return!1},Hn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=qe,this._cacheIndex=-2},Hn.prototype.keys=function(){return new hr(this._keys,this._values,kr)},Hn.prototype.values=function(){return new hr(this._keys,this._values,Hr)},Hn.prototype.entries=function(){return new hr(this._keys,this._values,qr)},Hn.prototype["@@iterator"]=function(){return this.entries()},Hn.prototype[Ke]=function(){return this.entries()},Hn.prototype._find=function(Bn,Kr){return this._cacheKey!==Bn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Bn)),this._cacheIndex<0&&Kr&&(this._cacheIndex=this._keys.length,this._keys.push(Bn),this._values.push(void 0)),this._cacheIndex},Hn}();function kr(Hn,Bn){return Hn}function Hr(Hn,Bn){return Bn}function qr(Hn,Bn){return[Hn,Bn]}}function Qe(){return function(){function qe(){this._map=new Nt}return Object.defineProperty(qe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),qe.prototype.has=function(kt){return this._map.has(kt)},qe.prototype.add=function(kt){return this._map.set(kt,kt),this},qe.prototype.delete=function(kt){return this._map.delete(kt)},qe.prototype.clear=function(){this._map.clear()},qe.prototype.keys=function(){return this._map.keys()},qe.prototype.values=function(){return this._map.values()},qe.prototype.entries=function(){return this._map.entries()},qe.prototype["@@iterator"]=function(){return this.keys()},qe.prototype[Ke]=function(){return this.keys()},qe}()}function Wt(){var qe=16,kt=bt.create(),hr=kr();return function(){function Kr(){this._key=kr()}return Kr.prototype.has=function(fi){var ri=Hr(fi,!1);return ri!==void 0?bt.has(ri,this._key):!1},Kr.prototype.get=function(fi){var ri=Hr(fi,!1);return ri!==void 0?bt.get(ri,this._key):void 0},Kr.prototype.set=function(fi,ri){var sa=Hr(fi,!0);return sa[this._key]=ri,this},Kr.prototype.delete=function(fi){var ri=Hr(fi,!1);return ri!==void 0?delete ri[this._key]:!1},Kr.prototype.clear=function(){this._key=kr()},Kr}();function kr(){var Kr;do Kr="@@WeakMap@@"+Bn();while(bt.has(kt,Kr));return kt[Kr]=!0,Kr}function Hr(Kr,fi){if(!q.call(Kr,hr)){if(!fi)return;Object.defineProperty(Kr,hr,{value:bt.create()})}return Kr[hr]}function qr(Kr,fi){for(var ri=0;ri<fi;++ri)Kr[ri]=Math.random()*255|0;return Kr}function Hn(Kr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Kr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Kr)):qr(new Uint8Array(Kr),Kr):qr(new Array(Kr),Kr)}function Bn(){var Kr=Hn(qe);Kr[6]=Kr[6]&79|64,Kr[8]=Kr[8]&191|128;for(var fi="",ri=0;ri<qe;++ri){var sa=Kr[ri];(ri===4||ri===6||ri===8)&&(fi+="-"),sa<16&&(fi+="0"),fi+=sa.toString(16).toLowerCase()}return fi}}function Dr(qe){return qe.__=void 0,delete qe.__,qe}})})(he||(he={}))},69848:function(Tn){(function(me,se){Tn.exports=se()})(this,function(){"use strict";function me(Tt,ht,jt,dt,lr,jr){if(!(lr-dt<=jt)){var ue=dt+lr>>1;se(Tt,ht,ue,dt,lr,jr%2),me(Tt,ht,jt,dt,ue-1,jr+1),me(Tt,ht,jt,ue+1,lr,jr+1)}}function se(Tt,ht,jt,dt,lr,jr){for(;lr>dt;){if(lr-dt>600){var ue=lr-dt+1,He=jt-dt+1,W=Math.log(ue),Y=.5*Math.exp(2*W/3),Re=.5*Math.sqrt(W*Y*(ue-Y)/ue)*(He-ue/2<0?-1:1),gt=Math.max(dt,Math.floor(jt-He*Y/ue+Re)),wt=Math.min(lr,Math.floor(jt+(ue-He)*Y/ue+Re));se(Tt,ht,jt,gt,wt,jr)}var qt=ht[2*jt+jr],fr=dt,br=lr;for(De(Tt,ht,dt,jt),ht[2*lr+jr]>qt&&De(Tt,ht,dt,lr);fr<br;){for(De(Tt,ht,fr,br),fr++,br--;ht[2*fr+jr]<qt;)fr++;for(;ht[2*br+jr]>qt;)br--}ht[2*dt+jr]===qt?De(Tt,ht,dt,br):(br++,De(Tt,ht,br,lr)),br<=jt&&(dt=br+1),jt<=br&&(lr=br-1)}}function De(Tt,ht,jt,dt){he(Tt,jt,dt),he(ht,2*jt,2*dt),he(ht,2*jt+1,2*dt+1)}function he(Tt,ht,jt){var dt=Tt[ht];Tt[ht]=Tt[jt],Tt[jt]=dt}function y(Tt,ht,jt,dt,lr,jr,ue){for(var He=[0,Tt.length-1,0],W=[],Y,Re;He.length;){var gt=He.pop(),wt=He.pop(),qt=He.pop();if(wt-qt<=ue){for(var fr=qt;fr<=wt;fr++)Y=ht[2*fr],Re=ht[2*fr+1],Y>=jt&&Y<=lr&&Re>=dt&&Re<=jr&&W.push(Tt[fr]);continue}var br=Math.floor((qt+wt)/2);Y=ht[2*br],Re=ht[2*br+1],Y>=jt&&Y<=lr&&Re>=dt&&Re<=jr&&W.push(Tt[br]);var bn=(gt+1)%2;(gt===0?jt<=Y:dt<=Re)&&(He.push(qt),He.push(br-1),He.push(bn)),(gt===0?lr>=Y:jr>=Re)&&(He.push(br+1),He.push(wt),He.push(bn))}return W}function Pe(Tt,ht,jt,dt,lr,jr){for(var ue=[0,Tt.length-1,0],He=[],W=lr*lr;ue.length;){var Y=ue.pop(),Re=ue.pop(),gt=ue.pop();if(Re-gt<=jr){for(var wt=gt;wt<=Re;wt++)q(ht[2*wt],ht[2*wt+1],jt,dt)<=W&&He.push(Tt[wt]);continue}var qt=Math.floor((gt+Re)/2),fr=ht[2*qt],br=ht[2*qt+1];q(fr,br,jt,dt)<=W&&He.push(Tt[qt]);var bn=(Y+1)%2;(Y===0?jt-lr<=fr:dt-lr<=br)&&(ue.push(gt),ue.push(qt-1),ue.push(bn)),(Y===0?jt+lr>=fr:dt+lr>=br)&&(ue.push(qt+1),ue.push(Re),ue.push(bn))}return He}function q(Tt,ht,jt,dt){var lr=Tt-jt,jr=ht-dt;return lr*lr+jr*jr}var Ce=function(Tt){return Tt[0]},pe=function(Tt){return Tt[1]},Ke=function(ht,jt,dt,lr,jr){jt===void 0&&(jt=Ce),dt===void 0&&(dt=pe),lr===void 0&&(lr=64),jr===void 0&&(jr=Float64Array),this.nodeSize=lr,this.points=ht;for(var ue=ht.length<65536?Uint16Array:Uint32Array,He=this.ids=new ue(ht.length),W=this.coords=new jr(ht.length*2),Y=0;Y<ht.length;Y++)He[Y]=Y,W[2*Y]=jt(ht[Y]),W[2*Y+1]=dt(ht[Y]);me(He,W,lr,0,He.length-1,0)};Ke.prototype.range=function(ht,jt,dt,lr){return y(this.ids,this.coords,ht,jt,dt,lr,this.nodeSize)},Ke.prototype.within=function(ht,jt,dt){return Pe(this.ids,this.coords,ht,jt,dt,this.nodeSize)};var Se={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Tt){return Tt}},ot=Math.fround||function(Tt){return function(ht){return Tt[0]=+ht,Tt[0]}}(new Float32Array(1)),mt=function(ht){this.options=xr(Object.create(Se),ht),this.trees=new Array(this.options.maxZoom+1)};mt.prototype.load=function(ht){var jt=this.options,dt=jt.log,lr=jt.minZoom,jr=jt.maxZoom,ue=jt.nodeSize;dt&&console.time("total time");var He="prepare "+ht.length+" points";dt&&console.time(He),this.points=ht;for(var W=[],Y=0;Y<ht.length;Y++)!ht[Y].geometry||W.push(Dt(ht[Y],Y));this.trees[jr+1]=new Ke(W,ee,sr,ue,Float32Array),dt&&console.timeEnd(He);for(var Re=jr;Re>=lr;Re--){var gt=+Date.now();W=this._cluster(W,Re),this.trees[Re]=new Ke(W,ee,sr,ue,Float32Array),dt&&console.log("z%d: %d clusters in %dms",Re,W.length,+Date.now()-gt)}return dt&&console.timeEnd("total time"),this},mt.prototype.getClusters=function(ht,jt){var dt=((ht[0]+180)%360+360)%360-180,lr=Math.max(-90,Math.min(90,ht[1])),jr=ht[2]===180?180:((ht[2]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,ht[3]));if(ht[2]-ht[0]>=360)dt=-180,jr=180;else if(dt>jr){var He=this.getClusters([dt,lr,180,ue],jt),W=this.getClusters([-180,lr,jr,ue],jt);return He.concat(W)}for(var Y=this.trees[this._limitZoom(jt)],Re=Y.range(gr(dt),Qt(ue),gr(jr),Qt(lr)),gt=[],wt=0,qt=Re;wt<qt.length;wt+=1){var fr=qt[wt],br=Y.points[fr];gt.push(br.numPoints?_r(br):this.points[br.index])}return gt},mt.prototype.getChildren=function(ht){var jt=this._getOriginId(ht),dt=this._getOriginZoom(ht),lr="No cluster with the specified id.",jr=this.trees[dt];if(!jr)throw new Error(lr);var ue=jr.points[jt];if(!ue)throw new Error(lr);for(var He=this.options.radius/(this.options.extent*Math.pow(2,dt-1)),W=jr.within(ue.x,ue.y,He),Y=[],Re=0,gt=W;Re<gt.length;Re+=1){var wt=gt[Re],qt=jr.points[wt];qt.parentId===ht&&Y.push(qt.numPoints?_r(qt):this.points[qt.index])}if(Y.length===0)throw new Error(lr);return Y},mt.prototype.getLeaves=function(ht,jt,dt){jt=jt||10,dt=dt||0;var lr=[];return this._appendLeaves(lr,ht,jt,dt,0),lr},mt.prototype.getTile=function(ht,jt,dt){var lr=this.trees[this._limitZoom(ht)],jr=Math.pow(2,ht),ue=this.options,He=ue.extent,W=ue.radius,Y=W/He,Re=(dt-Y)/jr,gt=(dt+1+Y)/jr,wt={features:[]};return this._addTileFeatures(lr.range((jt-Y)/jr,Re,(jt+1+Y)/jr,gt),lr.points,jt,dt,jr,wt),jt===0&&this._addTileFeatures(lr.range(1-Y/jr,Re,1,gt),lr.points,jr,dt,jr,wt),jt===jr-1&&this._addTileFeatures(lr.range(0,Re,Y/jr,gt),lr.points,-1,dt,jr,wt),wt.features.length?wt:null},mt.prototype.getClusterExpansionZoom=function(ht){for(var jt=this._getOriginZoom(ht)-1;jt<=this.options.maxZoom;){var dt=this.getChildren(ht);if(jt++,dt.length!==1)break;ht=dt[0].properties.cluster_id}return jt},mt.prototype._appendLeaves=function(ht,jt,dt,lr,jr){for(var ue=this.getChildren(jt),He=0,W=ue;He<W.length;He+=1){var Y=W[He],Re=Y.properties;if(Re&&Re.cluster?jr+Re.point_count<=lr?jr+=Re.point_count:jr=this._appendLeaves(ht,Re.cluster_id,dt,lr,jr):jr<lr?jr++:ht.push(Y),ht.length===dt)break}return jr},mt.prototype._addTileFeatures=function(ht,jt,dt,lr,jr,ue){for(var He=0,W=ht;He<W.length;He+=1){var Y=W[He],Re=jt[Y],gt=Re.numPoints,wt=void 0,qt=void 0,fr=void 0;if(gt)wt=Nt(Re),qt=Re.x,fr=Re.y;else{var br=this.points[Re.index];wt=br.properties,qt=gr(br.geometry.coordinates[0]),fr=Qt(br.geometry.coordinates[1])}var bn={type:1,geometry:[[Math.round(this.options.extent*(qt*jr-dt)),Math.round(this.options.extent*(fr*jr-lr))]],tags:wt},en=void 0;gt?en=Re.id:this.options.generateId?en=Re.index:this.points[Re.index].id&&(en=this.points[Re.index].id),en!==void 0&&(bn.id=en),ue.features.push(bn)}},mt.prototype._limitZoom=function(ht){return Math.max(this.options.minZoom,Math.min(Math.floor(+ht),this.options.maxZoom+1))},mt.prototype._cluster=function(ht,jt){for(var dt=[],lr=this.options,jr=lr.radius,ue=lr.extent,He=lr.reduce,W=lr.minPoints,Y=jr/(ue*Math.pow(2,jt)),Re=0;Re<ht.length;Re++){var gt=ht[Re];if(!(gt.zoom<=jt)){gt.zoom=jt;for(var wt=this.trees[jt+1],qt=wt.within(gt.x,gt.y,Y),fr=gt.numPoints||1,br=fr,bn=0,en=qt;bn<en.length;bn+=1){var Ci=en[bn],Wn=wt.points[Ci];Wn.zoom>jt&&(br+=Wn.numPoints||1)}if(br>fr&&br>=W){for(var Vn=gt.x*fr,va=gt.y*fr,Si=He&&fr>1?this._map(gt,!0):null,ci=(Re<<5)+(jt+1)+this.points.length,Vi=0,zi=qt;Vi<zi.length;Vi+=1){var _i=zi[Vi],$n=wt.points[_i];if(!($n.zoom<=jt)){$n.zoom=jt;var ii=$n.numPoints||1;Vn+=$n.x*ii,va+=$n.y*ii,$n.parentId=ci,He&&(Si||(Si=this._map(gt,!0)),He(Si,this._map($n)))}}gt.parentId=ci,dt.push(bt(Vn/br,va/br,ci,br,Si))}else if(dt.push(gt),br>1)for(var Co=0,Ba=qt;Co<Ba.length;Co+=1){var ya=Ba[Co],Et=wt.points[ya];Et.zoom<=jt||(Et.zoom=jt,dt.push(Et))}}}return dt},mt.prototype._getOriginId=function(ht){return ht-this.points.length>>5},mt.prototype._getOriginZoom=function(ht){return(ht-this.points.length)%32},mt.prototype._map=function(ht,jt){if(ht.numPoints)return jt?xr({},ht.properties):ht.properties;var dt=this.points[ht.index].properties,lr=this.options.map(dt);return jt&&lr===dt?xr({},lr):lr};function bt(Tt,ht,jt,dt,lr){return{x:ot(Tt),y:ot(ht),zoom:Infinity,id:jt,parentId:-1,numPoints:dt,properties:lr}}function Dt(Tt,ht){var jt=Tt.geometry.coordinates,dt=jt[0],lr=jt[1];return{x:ot(gr(dt)),y:ot(Qt(lr)),zoom:Infinity,index:ht,parentId:-1}}function _r(Tt){return{type:"Feature",id:Tt.id,properties:Nt(Tt),geometry:{type:"Point",coordinates:[Pt(Tt.x),Ft(Tt.y)]}}}function Nt(Tt){var ht=Tt.numPoints,jt=ht>=1e4?Math.round(ht/1e3)+"k":ht>=1e3?Math.round(ht/100)/10+"k":ht;return xr(xr({},Tt.properties),{cluster:!0,cluster_id:Tt.id,point_count:ht,point_count_abbreviated:jt})}function gr(Tt){return Tt/360+.5}function Qt(Tt){var ht=Math.sin(Tt*Math.PI/180),jt=.5-.25*Math.log((1+ht)/(1-ht))/Math.PI;return jt<0?0:jt>1?1:jt}function Pt(Tt){return(Tt-.5)*360}function Ft(Tt){var ht=(180-Tt*360)*Math.PI/180;return 360*Math.atan(Math.exp(ht))/Math.PI-90}function xr(Tt,ht){for(var jt in ht)Tt[jt]=ht[jt];return Tt}function ee(Tt){return Tt.x}function sr(Tt){return Tt.y}return mt})}}]);
