(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6968],{64335:function(pi,Se,fe){"use strict";var We=fe(67294),de=(0,We.createContext)({});Se.Z=de},21349:function(pi,Se,fe){"use strict";var We=fe(84305),de=fe(75901),y=fe(85893),Be=fe(94184),K=fe.n(Be),ke=fe(67294),he=fe(64335),ut=fe(53645),Ae=fe.n(ut),Xe=function(Lt){var tr=(0,ke.useContext)(he.Z),Yt=Lt.children,Xt=Lt.contentWidth,Er=Lt.className,cr=Lt.style,Rt=(0,ke.useContext)(de.ZP.ConfigContext),Zt=Rt.getPrefixCls,Rr=Lt.prefixCls||Zt("pro"),re=Xt||tr.contentWidth,_r="".concat(Rr,"-grid-content");return(0,y.jsx)("div",{className:K()(_r,Er,{wide:re==="Fixed"}),style:cr,children:(0,y.jsx)("div",{className:"".concat(Rr,"-grid-content-children"),children:Yt})})};Se.Z=Xe},65681:function(pi,Se,fe){"use strict";fe.d(Se,{zP:function(){return fk},JE:function(){return EI},ns:function(){return ck}});var We={};fe.r(We),fe.d(We,{add:function(){return th},adjoint:function(){return ri},clone:function(){return yr},copy:function(){return zr},create:function(){return lr},determinant:function(){return Ca},equals:function(){return lc},exactEquals:function(){return rd},frob:function(){return Ps},fromQuat:function(){return Mo},fromQuat2:function(){return Uu},fromRotation:function(){return ds},fromRotationTranslation:function(){return is},fromRotationTranslationScale:function(){return pu},fromRotationTranslationScaleOrigin:function(){return Ba},fromScaling:function(){return ns},fromTranslation:function(){return Yo},fromValues:function(){return hn},fromXRotation:function(){return Jo},fromYRotation:function(){return Es},fromZRotation:function(){return hu},frustum:function(){return xo},getRotation:function(){return Is},getScaling:function(){return Pu},getTranslation:function(){return bu},identity:function(){return wi},invert:function(){return Ci},lookAt:function(){return _l},mul:function(){return Pp},multiply:function(){return ki},multiplyScalar:function(){return td},multiplyScalarAndAdd:function(){return kp},ortho:function(){return ks},orthoNO:function(){return as},orthoZO:function(){return ao},perspective:function(){return Zu},perspectiveFromFieldOfView:function(){return zo},perspectiveNO:function(){return ja},perspectiveZO:function(){return Vu},rotate:function(){return da},rotateX:function(){return Da},rotateY:function(){return Mi},rotateZ:function(){return Ha},scale:function(){return ga},set:function(){return Bn},str:function(){return Ic},sub:function(){return nd},subtract:function(){return kc},targetTo:function(){return Yl},translate:function(){return hi},transpose:function(){return $n}});var de=fe(67294),y=(0,de.createContext)({});function Be(){return(0,de.useContext)(y)}var K={},ke={},he=function(a){return ke[a]},ut=function(a,t){ke[a]=t},Ae=function(a){return K[a]},Xe=function(a,t){K[a]=t},Ct={},Lt={},tr=34,Yt=10,Xt=13;function Er(e){return new Function("d","return {"+e.map(function(a,t){return JSON.stringify(a)+": d["+t+'] || ""'}).join(",")+"}")}function cr(e,a){var t=Er(e);return function(i,r){return a(t(i),r,e)}}function Rt(e){var a=Object.create(null),t=[];return e.forEach(function(i){for(var r in i)r in a||t.push(a[r]=r)}),t}function Zt(e,a){var t=e+"",i=t.length;return i<a?new Array(a-i+1).join(0)+t:t}function Rr(e){return e<0?"-"+Zt(-e,6):e>9999?"+"+Zt(e,6):Zt(e,4)}function re(e){var a=e.getUTCHours(),t=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Rr(e.getUTCFullYear(),4)+"-"+Zt(e.getUTCMonth()+1,2)+"-"+Zt(e.getUTCDate(),2)+(r?"T"+Zt(a,2)+":"+Zt(t,2)+":"+Zt(i,2)+"."+Zt(r,3)+"Z":i?"T"+Zt(a,2)+":"+Zt(t,2)+":"+Zt(i,2)+"Z":t||a?"T"+Zt(a,2)+":"+Zt(t,2)+"Z":"")}function _r(e){var a=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function i(w,L){var F,U,j=r(w,function(q,ae){if(F)return F(q,ae-1);U=q,F=L?cr(q,L):Er(q)});return j.columns=U||[],j}function r(w,L){var F=[],U=w.length,j=0,q=0,ae,pe=U<=0,Fe=!1;w.charCodeAt(U-1)===Yt&&--U,w.charCodeAt(U-1)===Xt&&--U;function Qe(){if(pe)return Lt;if(Fe)return Fe=!1,Ct;var vt,Bt=j,Qt;if(w.charCodeAt(Bt)===tr){for(;j++<U&&w.charCodeAt(j)!==tr||w.charCodeAt(++j)===tr;);return(vt=j)>=U?pe=!0:(Qt=w.charCodeAt(j++))===Yt?Fe=!0:Qt===Xt&&(Fe=!0,w.charCodeAt(j)===Yt&&++j),w.slice(Bt+1,vt-1).replace(/""/g,'"')}for(;j<U;){if((Qt=w.charCodeAt(vt=j++))===Yt)Fe=!0;else if(Qt===Xt)Fe=!0,w.charCodeAt(j)===Yt&&++j;else if(Qt!==t)continue;return w.slice(Bt,vt)}return pe=!0,w.slice(Bt,U)}for(;(ae=Qe())!==Lt;){for(var yt=[];ae!==Ct&&ae!==Lt;)yt.push(ae),ae=Qe();L&&(yt=L(yt,q++))==null||F.push(yt)}return F}function o(w,L){return w.map(function(F){return L.map(function(U){return E(F[U])}).join(e)})}function u(w,L){return L==null&&(L=Rt(w)),[L.map(E).join(e)].concat(o(w,L)).join(`
`)}function p(w,L){return L==null&&(L=Rt(w)),o(w,L).join(`
`)}function v(w){return w.map(g).join(`
`)}function g(w){return w.map(E).join(e)}function E(w){return w==null?"":w instanceof Date?re(w):a.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:i,parseRows:r,format:u,formatBody:p,formatRows:v,formatRow:g,formatValue:E}}var Ot=_r(","),_t=Ot.parse,Kt=Ot.parseRows,Ue=Ot.format,Cr=Ot.formatBody,nn=Ot.formatRows,ue=Ot.formatRow,tt=Ot.formatValue,Z=fe(28991),_e=fe(85061),ze=fe(38163),wt=fe.n(ze);function Vt(e,a){var t=a.x,i=a.y,r=a.x1,o=a.y1,u=a.coordinates,p=[];return Array.isArray(e)?(e.forEach(function(v,g){var E=[];if(t&&i&&(E=[parseFloat(v[t]),parseFloat(v[i])]),t&&i&&r&&o){var w=[parseFloat(v[t]),parseFloat(v[i])],L=[parseFloat(v[r]),parseFloat(v[o])];E=[w,L]}if(u){var F="Polygon";Array.isArray(u[0])||(F="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(F="LineString");var U={type:F,coordinates:(0,_e.Z)(v[u])};wt()(U,!0),E=U.coordinates}var j=(0,Z.Z)((0,Z.Z)({},v),{},{_id:g,coordinates:E});p.push(j)}),{dataArray:p}):{dataArray:[]}}var fr={PointLayer:{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}},LineLayer:{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}},Mt=[{lng1:100,lat1:30,lng2:130,lat2:30}],Fr={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function Xn(e,a){var t=_t(e);return Vt(t,a)}var Jr=63710088e-1,Ri={centimeters:Jr*100,centimetres:Jr*100,degrees:Jr/111325,feet:Jr*3.28084,inches:Jr*39.37,kilometers:Jr/1e3,kilometres:Jr/1e3,meters:Jr,metres:Jr,miles:Jr/1609.344,millimeters:Jr*1e3,millimetres:Jr*1e3,nauticalmiles:Jr/1852,radians:1,yards:Jr*1.0936},yi={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Jr,yards:1.0936133},ln={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Sa(e,a,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=a||{},i.geometry=e,i}function fa(e,a,t){switch(t===void 0&&(t={}),e){case"Point":return Di(a).geometry;case"LineString":return di(a).geometry;case"Polygon":return ui(a).geometry;case"MultiPoint":return to(a).geometry;case"MultiLineString":return Eo(a).geometry;case"MultiPolygon":return Pt(a).geometry;default:throw new Error(e+" is invalid")}}function Di(e,a,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xr(e[0])||!xr(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Sa(i,a,t)}function Ia(e,a,t){return t===void 0&&(t={}),Uo(e.map(function(i){return Di(i,a)}),t)}function ui(e,a,t){t===void 0&&(t={});for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var p={type:"Polygon",coordinates:e};return Sa(p,a,t)}function Ji(e,a,t){return t===void 0&&(t={}),Uo(e.map(function(i){return ui(i,a)}),t)}function di(e,a,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Sa(i,a,t)}function _i(e,a,t){return t===void 0&&(t={}),Uo(e.map(function(i){return di(i,a)}),t)}function Uo(e,a){a===void 0&&(a={});var t={type:"FeatureCollection"};return a.id&&(t.id=a.id),a.bbox&&(t.bbox=a.bbox),t.features=e,t}function Eo(e,a,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:e};return Sa(i,a,t)}function to(e,a,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:e};return Sa(i,a,t)}function Pt(e,a,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:e};return Sa(i,a,t)}function ge(e,a,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:e};return Sa(i,a,t)}function oe(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,a||0);return Math.round(e*t)/t}function we(e,a){a===void 0&&(a="kilometers");var t=Ri[a];if(!t)throw new Error(a+" units is invalid");return e*t}function V(e,a){a===void 0&&(a="kilometers");var t=Ri[a];if(!t)throw new Error(a+" units is invalid");return e/t}function at(e,a){return $r(V(e,a))}function sr(e){var a=e%360;return a<0&&(a+=360),a}function $r(e){var a=e%(2*Math.PI);return a*180/Math.PI}function Ke(e){var a=e%360;return a*Math.PI/180}function Nt(e,a,t){if(a===void 0&&(a="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return we(V(e,a),t)}function Sr(e,a,t){if(a===void 0&&(a="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=ln[a];if(!i)throw new Error("invalid original units");var r=ln[t];if(!r)throw new Error("invalid final units");return e/i*r}function xr(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Lr(e){return!!e&&e.constructor===Object}function gn(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!xr(a))throw new Error("bbox must only contain numbers")})}function mi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ii(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Sn(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Bi(e[0]);throw new Error("coordinates must only contain numbers")}function Vi(e,a,t){if(!a||!t)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.type)}function Ga(e,a,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.geometry.type)}function oa(e,a,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var i=0,r=e.features;i<r.length;i++){var o=r[i];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+o.geometry.type)}}function ro(e){return e.type==="Feature"?e.geometry:e}function Si(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ha(e,a,t){if(e!==null)for(var i,r,o,u,p,v,g,E=0,w=0,L,F=e.type,U=F==="FeatureCollection",j=F==="Feature",q=U?e.features.length:1,ae=0;ae<q;ae++){g=U?e.features[ae].geometry:j?e.geometry:e,L=g?g.type==="GeometryCollection":!1,p=L?g.geometries.length:1;for(var pe=0;pe<p;pe++){var Fe=0,Qe=0;if(u=L?g.geometries[pe]:g,u!==null){v=u.coordinates;var yt=u.type;switch(E=t&&(yt==="Polygon"||yt==="MultiPolygon")?1:0,yt){case null:break;case"Point":if(a(v,w,ae,Fe,Qe)===!1)return!1;w++,Fe++;break;case"LineString":case"MultiPoint":for(i=0;i<v.length;i++){if(a(v[i],w,ae,Fe,Qe)===!1)return!1;w++,yt==="MultiPoint"&&Fe++}yt==="LineString"&&Fe++;break;case"Polygon":case"MultiLineString":for(i=0;i<v.length;i++){for(r=0;r<v[i].length-E;r++){if(a(v[i][r],w,ae,Fe,Qe)===!1)return!1;w++}yt==="MultiLineString"&&Fe++,yt==="Polygon"&&Qe++}yt==="Polygon"&&Fe++;break;case"MultiPolygon":for(i=0;i<v.length;i++){for(Qe=0,r=0;r<v[i].length;r++){for(o=0;o<v[i][r].length-E;o++){if(a(v[i][r][o],w,ae,Fe,Qe)===!1)return!1;w++}Qe++}Fe++}break;case"GeometryCollection":for(i=0;i<u.geometries.length;i++)if(ha(u.geometries[i],a,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,a,t,i){var r=t;return ha(e,function(o,u,p,v,g){u===0&&t===void 0?r=o:r=a(r,o,u,p,v,g)},i),r}function ie(e,a){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&a(e.features[t].properties,t)!==!1;t++);break;case"Feature":a(e.properties,0);break}}function me(e,a,t){var i=t;return ie(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function Ie(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&a(e.features[t],t)!==!1;t++);}function qe(e,a,t){var i=t;return Ie(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function ot(e){var a=[];return ha(e,function(t){a.push(t)}),a}function xt(e,a){var t,i,r,o,u,p,v,g,E,w,L=0,F=e.type==="FeatureCollection",U=e.type==="Feature",j=F?e.features.length:1;for(t=0;t<j;t++){for(p=F?e.features[t].geometry:U?e.geometry:e,g=F?e.features[t].properties:U?e.properties:{},E=F?e.features[t].bbox:U?e.bbox:void 0,w=F?e.features[t].id:U?e.id:void 0,v=p?p.type==="GeometryCollection":!1,u=v?p.geometries.length:1,r=0;r<u;r++){if(o=v?p.geometries[r]:p,o===null){if(a(null,L,g,E,w)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,L,g,E,w)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(a(o.geometries[i],L,g,E,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}L++}}function Te(e,a,t){var i=t;return xt(e,function(r,o,u,p,v){o===0&&t===void 0?i=r:i=a(i,r,o,u,p,v)}),i}function rt(e,a){xt(e,function(t,i,r,o,u){var p=t===null?null:t.type;switch(p){case null:case"Point":case"LineString":case"Polygon":return a(Sa(t,r,{bbox:o,id:u}),i,0)===!1?!1:void 0}var v;switch(p){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon";break}for(var g=0;g<t.coordinates.length;g++){var E=t.coordinates[g],w={type:v,coordinates:E};if(a(Sa(w,r),i,g)===!1)return!1}})}function Ht(e,a,t){var i=t;return rt(e,function(r,o,u){o===0&&u===0&&t===void 0?i=r:i=a(i,r,o,u)}),i}function Zr(e,a){rt(e,function(t,i,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var p,v=0,g=0,E=0;if(ha(t,function(w,L,F,U,j){if(p===void 0||i>v||U>g||j>E){p=w,v=i,g=U,E=j,o=0;return}var q=lineString([p,w],t.properties);if(a(q,i,r,j,o)===!1)return!1;o++,p=w})===!1)return!1}}})}function ar(e,a,t){var i=t,r=!1;return Zr(e,function(o,u,p,v,g){r===!1&&t===void 0?i=o:i=a(i,o,u,p,v,g),r=!0}),i}function pr(e,a){if(!e)throw new Error("geojson is required");rt(e,function(t,i,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(a(t,i,r,0,0)===!1)return!1;break;case"Polygon":for(var p=0;p<u.length;p++)if(a(lineString(u[p],t.properties),i,r,p)===!1)return!1;break}}})}function Hr(e,a,t){var i=t;return pr(e,function(r,o,u,p){o===0&&t===void 0?i=r:i=a(i,r,o,u,p)}),i}function li(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=v.length+o-1),lineString([v[o],v[o+1]],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o-1),lineString([v[r][o],v[r][o+1]],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o-1),lineString([v[i][o],v[i][o+1]],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o-1),lineString([v[i][r][o],v[i][r][o+1]],u,a)}throw new Error("geojson is invalid")}function wn(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":return point(v,u,a);case"MultiPoint":return i<0&&(i=v.length+i),point(v[i],u,a);case"LineString":return o<0&&(o=v.length+o),point(v[o],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o),point(v[r][o],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o),point(v[i][o],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o),point(v[i][r][o],u,a)}throw new Error("geojson is invalid")}function er(e){for(var a=e.toString(),t=5381,i=a.length;i;)t=t*33^a.charCodeAt(--i);return t>>>0}function Hn(e,a){return a===void 0?null:a==="id"&&e.id?e.id:e[a]?e[a]:e.properties&&e.properties[a]?er(e.properties[a]+"")%1000019:null}function Tn(e,a){var t=[],i={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),wt()(e,!0),e.features.length===0?{dataArray:[],featureKeys:i}:(rt(e,function(r,o){var u=Hn(r,a==null?void 0:a.featureId);u===null&&(u=o);var p=u,v=Sn(r),g=(0,Z.Z)((0,Z.Z)({},r.properties),{},{coordinates:v,_id:p});t.push(g)}),{dataArray:t,featureKeys:i})):(e.features=[],{dataArray:[]})}function Mn(e){var a=131,t=137,i=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)i>r&&(i=Math.floor(i/t)),i=i*a+e.charCodeAt(o);return i}function sa(e){e=e.toString();for(var a=5381,t=e.length;t;)a=a*33^e.charCodeAt(--t);return a>>>0}var Pr=fe(28481),$i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function La(e){this.message=e}La.prototype=new Error,La.prototype.name="InvalidCharacterError";function ra(e){var a=String(e).replace(/=+$/,"");if(a.length%4==1)throw new La("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",i=0,r,o,u=0;o=a.charAt(u++);~o&&(r=i%4?r*64+o:o,i++%4)?t+=String.fromCharCode(255&r>>(-2*i&6)):0)o=$i.indexOf(o);return t}function ma(e){e=String(e);for(var a,t,i,r,o="",u=0,p=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(i=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|i<<8|r,o+=$i.charAt(a>>18&63)+$i.charAt(a>>12&63)+$i.charAt(a>>6&63)+$i.charAt(a&63)}return p?o.slice(0,p-3)+"===".substring(p):o}var Ft=fe(6610),Tt=fe(5991),ea=function(){function e(a,t){(0,Ft.Z)(this,e),this.buffers=a,this.type=t}return(0,Tt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,i,r){throw new Error("not implemented")}}]),e}(),lo,Na=function(){return lo||(lo=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof fe.g!="undefined"?fe.g:{})};lo=Na();var ji;typeof window=="undefined"?ji={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:ji=window;var Aa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Co=Aa?my.getSystemInfoSync().pixelRatio:ji.devicePixelRatio,an=fe(10379),Yr=fe(46070),bt=fe(77608),Ls=(0,Tt.Z)(function e(a,t){(0,Ft.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),Gt=fe(63349);function qi(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Kl(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Kl(e,a){if(!!e){if(typeof e=="string")return Oa(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Oa(e,a)}}function Oa(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var mo=new WeakMap,Io=function(){function e(){(0,Ft.Z)(this,e),mo.set(this,{})}return(0,Tt.Z)(e,[{key:"addEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=mo.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(i),mo.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=mo.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var p=u.length;p--;p>0)if(u[p]===i){u.splice(p,1);break}}}}},{key:"dispatchEvent",value:function(t){var i=mo.get(this)[t.type];if(i){var r=qi(i),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(p){r.e(p)}finally{r.f()}}}}]),e}();function xa(e){var a=Os();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,an.Z)(t,e);var a=xa(t);function t(){var i;return(0,Ft.Z)(this,t),i=a.call(this),i.childNodes=[],i}return(0,Tt.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(Io);function Ql(e){var a=So();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var As=function(e){(0,an.Z)(t,e);var a=Ql(t);function t(){var i;return(0,Ft.Z)(this,t),i=a.call(this),i.className="",i.children=[],i}return(0,Tt.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(Fs),Ka=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Oo,ws,ko,Yu;if(Ka){var ul=my.getSystemInfoSync();Oo=ul.screenWidth,ws=ul.screenHeight,ko=ul.windowWidth,Yu=ul.windowHeight}else{var rs=ji.innerWidth,ve=ji.innerHeight;Oo=rs,ws=ve,ko=rs,Yu=ve}var De={width:Oo,height:ws,availWidth:ko,availHeight:Yu,availLeft:0,availTop:0},mt=De.availWidth,ir=De.availHeight,yn={style:[]};function Qn(e,a){if(!("parentNode"in e)){var t;a===0?t=function(){return null}:a===1?t=function(){return yn}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var i;a===0?i=function(){return null}:a===1?i=function(){return yn}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function ya(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:mt+"px",height:ir+"px",margin:"0px",padding:"0px"})}function qo(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=mt,e.clientHeight=ir),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function Fa(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=mt,e.offsetHeight=ir)}function Fo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=mt,e.scrollHeight=ir)}function Zo(e){var a=function(){return!0};e.classList=[],e.classList.add=a,e.classList.remove=a,e.classList.contains=a,e.classList.toggle=a}function To(e){var a=Ds();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Ds(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function cs(){}var Ts=function(e){(0,an.Z)(t,e);var a=To(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,Ft.Z)(this,t),i=a.call(this),i.className="",i.children=[],i.focus=cs,i.blur=cs,i.insertBefore=cs,i.appendChild=cs,i.removeChild=cs,i.remove=cs,i.innerHTML="",i.tagName=r.toUpperCase(),Qn((0,Gt.Z)(i),o),ya((0,Gt.Z)(i)),Zo((0,Gt.Z)(i)),qo((0,Gt.Z)(i)),Fa((0,Gt.Z)(i)),Fo((0,Gt.Z)(i)),i}return(0,Tt.Z)(t)}(As);function Eu(e){var a=qu();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function qu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cu=function(e){(0,an.Z)(t,e);var a=Eu(t);function t(i){return(0,Ft.Z)(this,t),a.call(this,i)}return(0,Tt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(Ts);function Su(e){var a=za();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function za(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fs=function(e){(0,an.Z)(t,e);var a=Su(t);function t(){return(0,Ft.Z)(this,t),a.call(this,"video")}return(0,Tt.Z)(t)}(Cu),nu={},Au={};function uf(e,a){nu=e,nu.id=a,"tagName"in nu||(nu.tagName="CANVAS"),nu.type="canvas",Mixin.parentNode(nu),Mixin.style(nu),Mixin.classList(nu),Mixin.clientRegion(nu),Mixin.offsetRegion(nu),nu.focus=function(){},nu.blur=function(){}}function Vh(e,a){var t=1024,i=1024;Au={width:t,height:i,clientWidth:t/devicePixelRatio,clientHeight:i/devicePixelRatio,id:a,type:"canvas"},"tagName"in Au||(Au.tagName="CANVAS"),Mixin.parentNode(Au),Mixin.style(Au),Mixin.classList(Au),Mixin.clientRegion(Au),Mixin.offsetRegion(Au),Au.getContext=function(r){if(r==="2d")return e},Au.focus=function(){},Au.blur=function(){}}function Xs(){return nu}function lf(){return Au}var ll=(0,Tt.Z)(function e(){(0,Ft.Z)(this,e);var a=Xs(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Qn(t),Zo(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),Fc={href:"",protocol:"",host:""};function b(e){var a=k();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G=function(e){(0,an.Z)(t,e);var a=b(t);function t(){return(0,Ft.Z)(this,t),a.call(this,"body",0)}return(0,Tt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(Ts),D=function(e){(0,an.Z)(t,e);var a=b(t);function t(){return(0,Ft.Z)(this,t),a.call(this,"html",0)}return(0,Tt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(Ts),ne={},Re={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Fc,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new ll:a==="video"?new fs:new Ts(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,i){ne[a]||(ne[a]=[]),ne[a].push(t)},removeEventListener:function(a,t){var i=ne[a];if(i&&i.length>0){for(var r=i.length;r--;r>0)if(i[r]===t){i.splice(r,1);break}}},dispatchEvent:function(a){var t=a.type,i=ne[t];if(i)for(var r=0;r<i.length;r++)i[r](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new Ls(a)}};Re.documentElement=new D,Re.head=new Ts("head"),Re.body=new G;var pt=Object,It=fe(90484),jt=function(){function e(){(0,Ft.Z)(this,e);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,It.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Tt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Nr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wr,Kn,Hi;if(Nr){var Gi=my.getSystemInfoSync();Wr=Gi.system,Kn=Gi.platform,Hi=Gi.language}else{var Ni={versions:function(){var e=ji.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(ji.navigator.browserLanguage||ji.navigator.language).toLowerCase()};Ni.versions.android?Kn="android":Ni.versions.trident?Kn="IE":Ni.versions.presto?Kn="Opera":Ni.versions.webKit?Kn="webKit":Ni.versions.gecko?Kn="Firefox":Ni.versions.mobile?Kn="mobile":Ni.versions.ios?Kn="ios":Ni.versions.iPhone?Kn="iPhone":Ni.versions.iPad?Kn="ipad":Ni.versions.webApp?Kn="webApp":Ni.versions.weixin?Kn="weixin":Ni.versions.qq&&(Kn="qq"),Wr=ji.navigator.userAgent,Hi=Ni.language}var no=Wr.toLowerCase().indexOf("android")!==-1,go=no?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ka="Mozilla/5.0 (".concat(go,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Hi),iu={platform:Kn,language:Hi,appVersion:"5.0 (".concat(go,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ka},Ol={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){}},fc=0,hc=0;function pc(e){var a=Date.now(),t=Math.max(fc+23,a);return hc=setTimeout(function(){e(fc=t)},t-a),hc}function dc(e){var a=Xs();return a.requestAnimationFrame?a.requestAnimationFrame(e):pc(e)}function Ru(e){var a=Xs();return a.cancelAnimationFrame?a.cancelAnimationFrame(e):clearTimeout(e)}var Fl=function(){function e(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Ft.Z)(this,e),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,Tt.Z)(e,null,[{key:"createObjectURL",value:function(t){var i=t.buffers[0],r=t.type,o=El(i),u="data:".concat(r,";base64, ");return u+o}}]),e}();function El(e){for(var a="",t=new Uint8Array(e),i=t.byteLength,r=0;r<i;r++)a+=String.fromCharCode(t[r]);return ma(a)}var Vo={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},vp={};function jh(e){var a=wu();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cf=new Map,Cl=new Map,$u=new Map,Gh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Sl(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,a)}function yo(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Sl.call(this,"readystatechange",a)}var Ys=function(e){(0,an.Z)(t,e);var a=jh(t);function t(){var i;return(0,Ft.Z)(this,t),i=a.call(this),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,cf.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,Tt.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=$u.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=Cl.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return Cl.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=cf.get("requestHeader");u[r]=o,cf.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};p.target=p.target||u,o.call(u,p)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(Io);Ys.UNSEND=0,Ys.OPENED=1,Ys.HEADERS_RECEIVED=2,Ys.LOADING=3,Ys.DONE=4;function Hh(e){var a=Al();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mp=function(e){(0,an.Z)(t,e);var a=Hh(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Xs(),r.currentTarget=Xs(),r}return(0,Tt.Z)(t)}(Ls);function gp(e){var a=e||{},t=a.x,i=t===void 0?0:t,r=a.y,o=r===void 0?0:r,u=a.clientX,p=u===void 0?0:u,v=a.clientY,g=v===void 0?0:v;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=o):(e.x=p,e.y=g)}function lh(e){return function(a){var t=new mp(e);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(i){return gp(i)}),t.touches.forEach(function(i){return gp(i)}),t.targetTouches.forEach(function(i){return gp(i)}),Re.dispatchEvent(t)}}function Nf(e){return function(a){a.type=e,Re.dispatchEvent(a)}}var ff=lh("touchstart"),zf=lh("touchmove"),Dc=lh("touchend"),Uf=Nf("mapCameaParams");function vc(e){var a=hf();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jl=function(e){(0,an.Z)(t,e);var a=vc(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.target=Xs(),r.currentTarget=Xs(),r}return(0,Tt.Z)(t)}(Ls),au=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Zf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Vf="touch";function Wh(e,a,t){for(var i=new Jl(e),r=0;r<au.length;r++){var o=au[r];i[o]=a[o]||Zf[r]}return i.type=e,i.target=Xs(),i.currentTarget=Xs(),i.buttons=mc(e),i.which=i.buttons,i.pointerId=(a.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(a.radiusX||.5)*2,i.height=(a.radiusY||.5)*2,i.pressure=a.force||.5,i.isPrimary=Dl(a),i.pointerType=Vf,i.altKey=t.altKey,i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.shiftKey=t.shiftKey,t.preventDefault&&(i.preventDefault=function(){t.preventDefault()}),i}function mc(e){var a=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(a=1),a}var Ku=null;function Dl(e){return Ku===e.identifier}function Bc(e){Ku===null&&(Ku=e.identifier)}function ec(e){Ku===e.identifier&&(Ku=null)}function jf(e){return function(a){for(var t=a.changedTouches,i=0;i<t.length;i++){var r=t[i];i===0&&e==="pointerdown"?Bc(r):(e==="pointerup"||e==="pointercancel")&&ec(r);var o=Wh(e,r,a);Re.dispatchEvent(o)}}}var Gf=jf("pointerdown"),gc=jf("pointermove"),Xh=jf("pointerup");function ch(e){var a=Nc();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xp=function(e){(0,an.Z)(t,e);var a=ch(t);function t(i){return(0,Ft.Z)(this,t),a.call(this,i)}return(0,Tt.Z)(t)}(Ls);function fh(e){return function(a){a.type=e,Re.dispatchEvent(a)}}var Yh=fh("mousedown"),pf=fh("mousemove"),Yp=fh("mouseup"),zc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ao=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Bs=zc||Ao,Uc={atob:ra,btoa:ma,devicePixelRatio:Co,Blob:ea,document:Re,Element:As,Event:Ls,EventTarget:Io,HTMLCanvasElement:pt,HTMLElement:Ts,HTMLMediaElement:Cu,HTMLVideoElement:fs,Image:ll,ImageData:jt,navigator:iu,Node:Fs,requestAnimationFrame:dc,cancelAnimationFrame:Ru,screen:De,XMLHttpRequest:Ys,performance:Ol,URL:Fl,WebGLRenderingContext:Vo,WebGL2RenderingContext:vp,addEventListener:function(a,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Re.addEventListener(a,t,i)},removeEventListener:function(a,t,i){Re.removeEventListener(a,t)},dispatchEvent:function(a){Re.dispatchEvent(a)},innerWidth:De.availWidth,innerHeight:De.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Pa=Bs?Uc:ji,Ta=Bs?Ys:ji.XMLHttpRequest,wo=Bs?Fc:ji.location;function vu(e){var a=e;return typeof e=="string"&&(a=Pa.document.getElementById(e)),a}function df(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function tc(e){return df(e).split(/\s+/)}function hh(e){var a,t,i=Pa==null||(a=Pa.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!i)return e[0];for(var r in e)if(e[r]&&e[r]in i)return e[r];return e[0]}function Qa(e,a,t){var i=Pa.document.createElement(e);return i.className=a||"",t&&t.appendChild(i),i}function vf(e){var a=e.parentNode;a&&a.removeChild(e)}function Bl(e,a){if(e.classList!==void 0)for(var t=tc(a),i=0,r=t.length;i<r;i++)e.classList.add(t[i]);else if(!rc(e,a)){var o=Qu(e);hs(e,(o?o+" ":"")+a)}}function yc(e,a){e.classList!==void 0?e.classList.remove(a):hs(e,df((" "+Qu(e)+" ").replace(" "+a+" "," ")))}function rc(e,a){if(e.classList!==void 0)return e.classList.contains(a);var t=Qu(e);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function hs(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Qu(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function mf(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Do=hh(["transform","WebkitTransform"]);function Jn(e,a){e.style[Do]=a}function jo(){if(typeof Event=="function")Pa.dispatchEvent(new Event("resize"));else{var e=Pa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Pa,0),Pa.dispatchEvent(e)}}function Zc(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function gf(){var e,a=Pa.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(e=a.content)===null||e===void 0?void 0:e.split(","),i=t.find(function(r){var o=r.split("="),u=(0,Pr.Z)(o,2),p=u[0],v=u[1];return p==="initial-scale"});return i?i.split("=")[1]*1:1}var Ja=gf()<1?1:Pa.devicePixelRatio;function Lu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a*1}function _c(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a*1}function In(e){if(e.length===0)return 0;for(var a=e[0]*1,t=1;t<e.length;t++)a+=e[t]*1;return a}function yf(e){if(e.length===0)throw new Error("mean requires at least one data point");return In(e)/e.length}function ph(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],t=NaN,i=0,r=1,o=1;o<e.length+1;o++)e[o]!==a?(r>i&&(i=r,t=a),r=1,a=e[o]):r++;return t*1}var wl={min:_c,max:Lu,mean:yf,sum:In,mode:ph};function co(e,a){return e.map(function(t){return t[a]})}function mu(e,a){return wl[e](a)}var Ua=fe(92137),Nl=fe(14665);function Tu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var zl=fe(51814);function Hf(e,a,t){return(0,zl.Z)()?Hf=Reflect.construct.bind():Hf=function(r,o,u){var p=[null];p.push.apply(p,o);var v=Function.bind.apply(r,p),g=new v;return u&&(0,Nl.Z)(g,u.prototype),g},Hf.apply(null,arguments)}function Vc(e){var a=typeof Map=="function"?new Map:void 0;return Vc=function(i){if(i===null||!Tu(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(i))return a.get(i);a.set(i,r)}function r(){return Hf(i,arguments,(0,bt.Z)(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Nl.Z)(r,i)},Vc(e)}var yp=fe(87757),xi=fe.n(yp);function cl(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function qs(){return typeof importScripts=="function"}var pa=qs()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function fl(e){var a=gu();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function gu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ns=function(e){(0,an.Z)(t,e);var a=fl(t);function t(i,r,o,u){var p;return(0,Ft.Z)(this,t),p=a.call(this,"AJAXError: ".concat(r," (").concat(i,"): ").concat(o)),p.status=i,p.statusText=r,p.url=o,p.body=u,p}return(0,Tt.Z)(t)}(Vc(Error));function _f(e,a){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(i){return i.ok?(e.type==="arrayBuffer"?i.arrayBuffer():e.type==="json"?i.json():i.text()).then(function(r){a(null,r,i.headers.get("Cache-Control"),i.headers.get("Expires"))}).catch(function(r){a(new Error(r.message))}):i.blob().then(function(r){return a(new Ns(i.status,i.statusText,e.url,r))})}).catch(function(i){a(new Error(i.message))})}function xc(e,a){var t=new Ta;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var r=t.response;if(e.type==="json")try{r=JSON.parse(t.response)}catch(u){return a(u)}a(null,r,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new Ns(t.status,t.statusText,e.url,o))}},t.send(e.body),t}function Mu(e,a){return xc(e,a)}var yu=function(a,t){return Mu(_objectSpread(_objectSpread({},a),{},{type:"json"}),t)},Ju=function(a,t){return Mu((0,Z.Z)((0,Z.Z)({},a),{},{type:"arrayBuffer"}),t)},Ei=function(a,t){return Mu(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function vi(e){var a=$window.document.createElement("a");return a.href=e,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var Wf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zs(e,a){var t=new Pa.Image,i=Pa.URL||Pa.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),i.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Wf})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?i.createObjectURL(r):Wf}function hl(e,a){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(i){a(null,i)}).catch(function(i){a(new Error("Could not load image because of ".concat(i.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var $o=function(a,t){return Ju(a,function(i,r){if(i)t(i);else if(r){var o=typeof createImageBitmap=="function";o?hl(r,t):zs(r,t)}})},Tl=function(){var e=(0,Ua.Z)(xi().mark(function a(t,i,r){var o,u,p,v,g,E;return xi().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.prev=0,L.next=3,r(t);case 3:o=L.sent,u=o.rasterData,p=o.width,v=o.height,g=0,E=8e3,i(null,{data:u,width:p,height:v,min:g,max:E}),L.next=15;break;case 12:L.prev=12,L.t0=L.catch(0),i(null,new Error(""+L.t0));case 15:case"end":return L.stop()}},a,null,[[0,12]])}));return function(t,i,r){return e.apply(this,arguments)}}(),dh=function(a,t,i){return Ju(a,function(r,o){r?t(r):o&&Tl(o,t,i)})};function xf(e){return typeof e=="number"}var Za=2*Math.PI*6378137/2;function _o(e){var a=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var i=t.coordinates;vh(a,i)}),a}function vh(e,a){return Array.isArray(a[0])?a.forEach(function(t){vh(e,t)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Xf(e,a){return pl(e,a)}function pl(e,a){return Array.isArray(e[0])?e.map(function(t){return pl(t,a)}):a(e)}function el(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=mh(e,a);var i=e[0],r=e[1],o=i*Za/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*Za/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function $s(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],i=e[1],r=t/Za*180,o=i/Za*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(r=Number(r.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[r,o,e[2]]:[r,o]}function dl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Ul(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function mh(e,a){if(a===!1)return e;var t=dl(e[0]),i=Ul(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[t,i,e[2]]:[t,i]}function Go(e){var a=85.0511287798,t=Math.max(Math.min(a,e[1]),-a),i=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var p=.5/Math.PI,v=.5,g=-.5/Math.PI;return r=.5,o=i*(p*o+v),u=i*(g*u+r),[Math.floor(o),Math.floor(u)]}function gh(e){var a=.5/Math.PI,t=.5,i=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),p=u[0],v=u[1];p=(p/o-t)/a,v=(v/o-r)/i,v=(Math.atan(Math.pow(Math.E,v))-Math.PI/4)*2,r=Math.PI/180;var g=v/r,E=p/r;return[E,g]}function qh(e,a){var t=85.0511287798,i=Math.PI/180,r=6378137;return a=Math.max(Math.min(t,a),-t),e*=i,a*=i,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*r,a*r]}function jc(e,a,t){var i=Ke(a[1]-e[1]),r=Ke(a[0]-e[0]),o=Ke(e[1]),u=Ke(a[1]),p=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return we(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t="meters")}function bf(e){var a=Math.PI/180,t=85.0511287798,i=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*a),u=i*e[0]*a,p=i*Math.log((1+o)/(1-o))/2;return[u,p]}function bc(e,a){var t=Math.abs(e[1][1]-e[0][1])*a,i=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-i,e[0][1]-t],[e[1][0]+i,e[1][1]+t]]}function Zl(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function vl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Yf(e){var a=nc(e,[0,0]);return[e[0]/a,e[1]/a]}function nc(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function ml(e,a){return e[0]*a[0]+e[1]*a[1]}function Gc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function yh(e,a){return Math.acos(ml(e,a)/(Gc(e)*Gc(a)))*180/Math.PI}function _p(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function Ef(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],i=0,r=[],o=0;o<e.length-1;o++){var u=e[o],p=e[o+1],v=nc(u,p);i+=v;var g=[u[0]-p[0],u[1]-p[1]],E=_p(t,g);if(o>0){var w=r[o-1].rotation;w-E>360-w+E&&(E=E+360)}r.push({start:u,end:p,dis:v,rotation:E,duration:0})}return r.map(function(L){L.duration=a*(L.dis/i)}),r}}function c(e){if(xf(e[0]))return e;if(xf(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(xf(e[0][0][0])){var a=e,t=0,i=0,r=0;return a.forEach(function(o){o.forEach(function(u){t+=u[0],i+=u[1],r++})}),[t/r,i/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function h(e){for(var a=e[0],t=e[1],i=e[0],r=e[1],o=0,u=0,p=0,v=0;v<e.length;v+=2){var g=e[v],E=e[v+1];g&&E&&(a=Math.max(g,a),t=Math.max(E,t),i=Math.min(g,i),r=Math.min(E,r),o+=g,u+=E,p++)}return{center:[o/p,u/p],radius:Math.sqrt(Math.pow(a-i,2)+Math.pow(t-r,2))/2}}var f=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Ft.Z)(this,e),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,Tt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(i){t.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var i=this.cache[t];return i&&(this.deleteOrder(t),this.appendOrder(t)),i}},{key:"set",value:function(t,i){this.cache[t]?(this.delete(t),this.cache[t]=i,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=i,this.appendOrder(t))}},{key:"delete",value:function(t){var i=this.cache[t];i&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(i,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var i=this.order.findIndex(function(r){return r===t});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,i){return null}}]),e}();function m(e,a){e.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var S=null,I=fe(2650);function P(e){return typeof e=="string"?!!I.ZP(e):!1}function B(e){var a=I.ZP(e),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function Y(e){var a=e&&e[0],t=e&&e[1],i=e&&e[2],r=a+t*256+i*65536-1;return r}function te(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function xe(e){var a=Pa.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;for(var i=t.createLinearGradient(0,0,256,1),r=null,o=e.positions[0],u=e.positions[e.positions.length-1],p=0;p<e.colors.length;++p){var v=(e.positions[p]-o)/(u-o);i.addColorStop(v,e.colors[p])}if(t.fillStyle=i,t.fillRect(0,0,256,1),Bs)return r=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:r,width:256,height:1};r=t.getImageData(0,0,256,1).data;for(var g=t.createImageData(256,1),E=0;E<g.data.length;E+=4)g.data[E+0]=r[E+0],g.data[E+1]=r[E+1],g.data[E+2]=r[E+2],g.data[E+3]=r[E+3];return a=null,t=null,g}var Ce;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Ce||(Ce={}));var Me={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function et(e,a,t){var i=e.classList;for(var r in Me)Me.hasOwnProperty(r)&&i.remove("l7-".concat(t,"-anchor-").concat(r));i.add("l7-".concat(t,"-anchor-").concat(a))}function Ne(e,a){return{enable:e,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}function ct(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var je={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},ht=je.self||je.window||{},Et=je.window||je.self||{},Wt=je.self||je.window||{},vr=je.document||{},rr=typeof importScripts=="function",Ar=typeof window!="undefined"&&typeof window.orientation!="undefined",Xr=function(){function e(a,t){var i=this;this.name=a,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){i.resolve=r,i.reject=o})}return e.prototype.postMessage=function(a,t){this.workerThread.postMessage({source:"Main thread",type:a,payload:t})},e.prototype.done=function(a){ct(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){ct(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),bn=Xr,pn=new Map;function Vn(e){ct(e.source&&!e.url||!e.source&&e.url);var a=pn.get(e.source||e.url);return a||(e.url&&(a=bi(e.url),pn.set(e.url,a)),e.source&&(a=Ti(e.source),pn.set(e.source,a))),ct(a),a}function bi(e){if(!e.startsWith("http"))return e;var a=Ai(e);return Ti(a)}function Ti(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function Ai(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function ba(e,a,t){a===void 0&&(a=!0);var i=t||new Set;if(e){if(Wn(e))i.add(e);else if(Wn(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var r in e)ba(e[r],a,i)}}return t===void 0?Array.from(i):[]}function Wn(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Wi=function(){},na=function(){function e(a){this.terminated=!1,this.loadableURL="";var t=a.name,i=a.source,r=a.url;ct(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=Wi,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Wi,this.onError=Wi,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,t){t=t||ba(a),this.worker.postMessage(a,t)},e.prototype.getErrorFromErrorEvent=function(a){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",a.message&&(t+=a.message+" in "),a.lineno&&(t+=":"+a.lineno+":"+a.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=Vn({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(i){i.data?a.onMessage(i.data):a.onError(new Error("No data received"))},t.onerror=function(i){a.onError(a.getErrorFromErrorEvent(i)),a.terminated=!0},t.onmessageerror=function(i){return console.error("worker "+a.name+", message error: "+i)},t},e}(),Xi=na,Pi=function(){return Pi=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Pi.apply(this,arguments)},ia=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(w){u(w)}}function v(E){try{g(i.throw(E))}catch(w){u(w)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},zi=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Li=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=Pi(Pi({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,t,i){return t===void 0&&(t=function(r,o,u){return r.done(u)}),i===void 0&&(i=function(r,o){return r.error(o)}),ia(this,void 0,void 0,function(){var r,o=this;return zi(this,function(u){switch(u.label){case 0:return r=new Promise(function(p){return o.jobQueue.push({name:a,onMessage:t,onError:i,onStart:p}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return ia(this,void 0,void 0,function(){var a,t,i;return zi(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:a}),i=new bn(t.name,a),a.onMessage=function(o){return t.onMessage(i,o.type,o.payload)},a.onError=function(o){return t.onError(i,o)},t.onStart(i),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,i.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Xi({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Ar?this.maxMobileConcurrency:this.maxConcurrency},e}(),vs=Li,fo=function(){return fo=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},fo.apply(this,arguments)},Ho=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,t=a&&e[a],i=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},Us={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Bo=function(){function e(a){this.workerPools=new Map,this.props=fo({},Us),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Xi.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,t;try{for(var i=Ho(this.workerPools.values()),r=i.next();!r.done;r=i.next()){var o=r.value;o.destroy()}}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var t,i;this.props=fo(fo({},this.props),a);try{for(var r=Ho(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(p){t={error:p}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(a){var t=a.name,i=a.source,r=a.url,o=this.workerPools.get(t);return o||(o=new vs({name:t,source:i,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Wo=Bo,ou=new Map,su=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(t){if(!!ms(t)){var i=t.data,r=i.type,o=i.payload;a(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var t=ou.get(a);t||(t=function(i){if(!!ms(i)){var r=i.data,o=r.type,u=r.payload;a(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(a){var t=ou.get(a);ou.delete(a),self.removeEventListener("message",t)},e.postMessage=function(a,t){if(self){var i={source:"Worker thread",type:a,payload:t},r=ba(t);self.postMessage(i,r)}},e}(),Ms=su;function ms(e){var a=e.type,t=e.data;return a==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function Vl(e){return JSON.parse(Ou(e))}function Ou(e){var a=new Set;return JSON.stringify(e,function(t,i){if(typeof i=="object"&&i!==null){if(a.has(i))try{return JSON.parse(JSON.stringify(i))}catch(r){return}a.add(i)}return i})}function Cf(e){return""+e.name}function Ml(e,a){a===void 0&&(a={});var t=a[e.id]||{},i=e.name+".worker.js",r=t.workerUrl;return a._workerType==="test"&&(r=e.module+"/dist/"+i),r||(r="https://unpkg.com/"+e.module+"/dist/"+i),assert(r),r}var Il=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(w){u(w)}}function v(E){try{g(i.throw(E))}catch(w){u(w)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},Ec=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};function Hc(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function jl(e,a,t,i){return t===void 0&&(t={}),i===void 0&&(i={}),Il(this,void 0,void 0,function(){var r,o,u,p,v,g,E,w;return Ec(this,function(L){switch(L.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),p=u.getWorkerPool({name:r,url:o}),v=t.jobName||e.name,[4,p.startJob(v,Wc.bind(null,i))];case 1:return g=L.sent(),E=removeNontransferableOptions(t),g.postMessage("process",{input:a,options:E}),[4,g.result];case 2:return w=L.sent(),[2,w.result]}})})}function Wc(e,a,t,i){return Il(this,void 0,void 0,function(){var r,o,u,p,v,g,E;return Ec(this,function(w){switch(w.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(i),[3,9];case 2:return a.error(new Error(i.error)),[3,9];case 3:o=i.id,u=i.input,p=i.options,w.label=4;case 4:return w.trys.push([4,6,,7]),e.process?[4,e.process(u,p)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return v=w.sent(),a.postMessage("done",{id:o,result:v}),[3,7];case 6:return g=w.sent(),E=g instanceof Error?g.message:"unknown error",a.postMessage("error",{id:o,error:E}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),w.label=9;case 9:return[2]}})})}var gl=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();a instanceof Error?t.reject(a):t.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(i,r){a._settlers.push({resolve:i,reject:r})})},e}(),gs=gl,uu=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(w){u(w)}}function v(E){try{g(i.throw(E))}catch(w){u(w)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},Gl=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},ic=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],t;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=e[o]&&function(u){return new Promise(function(p,v){u=e[o](u),r(p,v,u.done,u.value)})}}function r(o,u,p,v){Promise.resolve(v).then(function(g){o({value:g,done:p})},u)}},Va=0,_u,lu;function Cc(e,a){var t=this;if(typeof self!="undefined"){var i={process:_h};Ms.onmessage=function(r,o){return uu(t,void 0,void 0,function(){var u,p,v,g,E,w,L,F,U,j,q;return Gl(this,function(ae){switch(ae.label){case 0:switch(ae.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},i)];case 2:return p=ae.sent(),Ms.postMessage("done",{result:p}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");_u=new gs,lu=o.options||{},v=a(_u,lu,i),ae.label=4;case 4:ae.trys.push([4,9,10,15]),g=ic(v),ae.label=5;case 5:return[4,g.next()];case 6:if(E=ae.sent(),!!E.done)return[3,8];w=E.value,Ms.postMessage("output-batch",{result:w}),ae.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return L=ae.sent(),j={error:L},[3,15];case 10:return ae.trys.push([10,,13,14]),E&&!E.done&&(q=g.return)?[4,q.call(g)]:[3,12];case 11:ae.sent(),ae.label=12;case 12:return[3,14];case 13:if(j)throw j.error;return[7];case 14:return[7];case 15:return Ms.postMessage("done",{}),[3,18];case 16:return _u.push(o.input),[3,18];case 17:return _u.close(),[3,18];case 18:return[3,20];case 19:return F=ae.sent(),U=F instanceof Error?F.message:"",Ms.postMessage("error",{error:U}),[3,20];case 20:return[2]}})})}}}function _h(e,a){return a===void 0&&(a={}),new Promise(function(t,i){var r=Va++,o=function(p,v){if(v.id===r)switch(p){case"done":Ms.removeEventListener(o),t(v.result);break;case"error":Ms.removeEventListener(o),i(v.error);break;default:}};Ms.addEventListener(o);var u={id:r,input:e,options:a};Ms.postMessage("process",u)})}var Sf=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(w){u(w)}}function v(E){try{g(i.throw(E))}catch(w){u(w)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},Xc=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Ks={};function xh(e,a,t){return a===void 0&&(a=null),t===void 0&&(t={}),Sf(this,void 0,void 0,function(){return Xc(this,function(i){switch(i.label){case 0:return a&&(e=tl(e,a,t)),Ks[e]=Ks[e]||Yc(e),[4,Ks[e]];case 1:return[2,i.sent()]}})})}function tl(e,a,t){if(e.startsWith("http"))return e;var i=t.modules||{};return i[e]?i[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Yc(e){return Sf(this,void 0,void 0,function(){var a,t,i;return Xc(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=r.sent(),[4,a.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return i=r.sent(),[2,bh(i,e)]}})})}function bh(e,a){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=a;try{t.appendChild(document.createTextNode(e))}catch(i){t.text=e}return document.body.appendChild(t),null}var ac="0.0.3",Xo={id:"null",name:"null",module:"web-worker-helper",options:{}},qf=fe(75174),Iu=fe.n(qf);function Sc(e,a){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function qc(e,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function $h(e,a){var t=e.filter;return t?[1]:[0]}function xp(e,a,t,i){return[a]}var Af=fe(9187),Fu=fe.n(Af),ye=fe(96156),cn=fe(31437),Hl=cn.create(),Kh=cn.create(),Po=cn.create(),ku=cn.create(),Ac=cn.create();function Eh(e,a,t,i,r){cn.add(e,t,i),cn.normalize(e,e),a=cn.fromValues(-e[1],e[0]);var o=cn.fromValues(-t[1],t[0]);return[r/cn.dot(a,o),a]}function wf(e,a){return cn.set(e,-a[1],a[0])}function $f(e,a,t){return cn.sub(e,a,t),cn.normalize(e,e),e}function oc(e,a){return e[0]===a[0]&&e[1]===a[1]}function yd(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var Tf=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ft.Z)(this,e),(0,ye.Z)(this,"lastFlip",-1),(0,ye.Z)(this,"miter",cn.fromValues(0,0)),(0,ye.Z)(this,"started",!1),(0,ye.Z)(this,"dash",!1),(0,ye.Z)(this,"totalDistance",0),(0,ye.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Tt.Z)(e,[{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,w=t[p-1];w.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var L=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,q=p<i.length-1?i[p+1]:null,ae=this.segment_gaode2(r,u,w,F,j,L,U,q);u+=ae}if(this.dash)for(var pe=0;pe<r.positions.length/6;pe++)r.positions[pe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,w=t[p-1];w.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var L=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,q=p<i.length-1?i[p+1]:null,ae=this.simpleSegment(r,u,w,F,j,L,U,q);u+=ae}if(this.dash)for(var pe=0;pe<r.positions.length/6;pe++)r.positions[pe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var w=0;w<i.positions.length/6;w++)i.positions[w*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var w=0;w<i.positions.length/6;w++)i.positions[w*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,w=t.indices,L=t.positions,F=t.normals,U=this.cap==="square",j=this.join==="bevel",q=Go([v[0],v[1]]),ae=Go([p[0],p[1]]);$f(Po,o,r);var pe=0;if(this.dash&&(pe=this.lineSegmentDistance(q,ae),this.totalDistance+=pe),this.normal||(this.normal=cn.create(),wf(this.normal,Po)),!this.started)if(this.started=!0,U){var Fe=cn.create(),Qe=cn.create();cn.add(Fe,this.normal,Po),cn.add(Qe,this.normal,Po),F.push(Qe[0],Qe[1],0),F.push(Fe[0],Fe[1],0),L.push(r[0],r[1],r[2]|0,this.totalDistance-pe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),L.push(r[0],r[1],r[2]|0,this.totalDistance-pe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(L,F,r,this.normal,this.thickness,this.totalDistance-pe);if(w.push(i+0,i+1,i+2),u){oc(o,u)&&cn.add(u,o,cn.normalize(u,cn.subtract(u,o,r))),$f(ku,u,o);var Bt=Eh(Ac,cn.create(),Po,ku,this.thickness),Qt=(0,Pr.Z)(Bt,2),Ir=Qt[0],Or=Qt[1],Tr=cn.dot(Ac,this.normal)<0?-1:1,on=j;if(!on&&this.join==="miter"){var kn=Ir;kn>this.miterLimit&&(on=!0)}on?(F.push(this.normal[0],this.normal[1],0),F.push(Or[0],Or[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,_e.Z)(this.lastFlip!==-Tr?[i,i+2,i+3]:[i+2,i+1,i+3])),w.push(i+2,i+3,i+4),wf(Hl,ku),cn.copy(this.normal,Hl),F.push(this.normal[0],this.normal[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(L,F,o,Or,Ir,this.totalDistance),w.push.apply(w,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Tr=-1,cn.copy(this.normal,Or),E+=2),this.lastFlip=Tr}else{if(wf(this.normal,Po),U){var yt=cn.create(),vt=cn.create();cn.sub(vt,Po,this.normal),cn.add(yt,Po,this.normal),F.push(vt[0],vt[1],0),F.push(yt[0],yt[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(L,F,o,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,w=Go([o[0],o[1]]),L=Go([r[0],r[1]]);$f(Po,w,L);var F=0;if(this.dash&&(F=this.lineSegmentDistance(w,L),this.totalDistance+=F),this.normal||(this.normal=cn.create(),wf(this.normal,Po)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)wf(this.normal,Po),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var U=Go([u[0],u[1]]);oc(w,U)&&cn.add(U,w,cn.normalize(U,cn.subtract(U,w,L))),$f(ku,U,w);var j=Eh(Ac,cn.create(),Po,ku,this.thickness),q=(0,Pr.Z)(j,2),ae=q[0],pe=q[1],Fe=cn.dot(Ac,this.normal)<0?-1:1;this.extrusions(g,E,o,pe,ae,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Fe=-1,cn.copy(this.normal,pe),p+=2,this.lastFlip=Fe}return p}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,w=this.cap==="square",L=this.join==="bevel",F=Go([o[0],o[1]]),U=Go([r[0],r[1]]);$f(Po,F,U);var j=0;if(this.dash&&(j=this.lineSegmentDistance(F,U),this.totalDistance+=j),this.normal||(this.normal=cn.create(),wf(this.normal,Po)),!this.started)if(this.started=!0,w){var q=cn.create(),ae=cn.create();cn.add(q,this.normal,Po),cn.add(ae,this.normal,Po),E.push(ae[0],ae[1],0),E.push(q[0],q[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-j);if(v.push(i+0,i+1,i+2),u){var Qe=Go([u[0],u[1]]);oc(F,Qe)&&cn.add(Qe,F,cn.normalize(Qe,cn.subtract(Qe,F,U))),$f(ku,Qe,F);var yt=Eh(Ac,cn.create(),Po,ku,this.thickness),vt=(0,Pr.Z)(yt,2),Bt=vt[0],Qt=vt[1],Ir=cn.dot(Ac,this.normal)<0?-1:1,Or=L;if(!Or&&this.join==="miter"){var Tr=Bt;Tr>this.miterLimit&&(Or=!0)}Or?(E.push(this.normal[0],this.normal[1],0),E.push(Qt[0],Qt[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,_e.Z)(this.lastFlip!==-Ir?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),wf(Hl,ku),cn.copy(this.normal,Hl),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,Qt,Bt,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Ir=-1,cn.copy(this.normal,Qt),p+=2),this.lastFlip=Ir}else{if(wf(this.normal,Po),w){var pe=cn.create(),Fe=cn.create();cn.sub(Fe,Po,this.normal),cn.add(pe,Po,this.normal),E.push(Fe[0],Fe[1],0),E.push(pe[0],pe[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}();function $c(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new Tf({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(L){r.extrude(L)})}var w=r.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function bp(e){var a=c(e.coordinates);return{vertices:[].concat((0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function ps(e){var a=e.coordinates,t=Fu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(i,o,r),vertices:i,size:r}}var Ki=function(){var e=(0,Ua.Z)(xi().mark(function a(t){var i,r,o,u,p,v,g,E,w;return xi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,p={a_Color:Sc,a_Position:qc,filter:$h,a_vertexId:xp,a_PickingColor:function(j,q){var ae=j.id;return o?te(ae):[0,0,0]},a_DistanceAndIndex:function(j,q,ae,pe,Fe,Qe){return Qe===void 0?[ae[3],10]:[ae[3],Qe]},a_Total_Distance:function(j,q,ae,pe){return[ae[5]]},a_Size:function(j,q,ae,pe){var Fe=j.size,Qe=Fe===void 0?1:Fe;return Array.isArray(Qe)?[Qe[0],Qe[1]]:[Qe,0]},a_Normal:function(j,q,ae,pe,Fe){return Fe},a_Miter:function(j,q,ae,pe){return[ae[4]]},a_iconMapUV:function(j,q,ae,pe){var Fe=j.texture,Qe=u[Fe]||{x:0,y:0},yt=Qe.x,vt=Qe.y;return[yt,vt]}},v={sizePerElement:0,elements:[]},g=0,E=[],w=3,r.forEach(function(U,j){var q=$c(U),ae=q.indices,pe=q.vertices,Fe=q.normals,Qe=q.size,yt=q.indexes;ae.forEach(function(Ir){E.push(Ir+g)}),w=Qe;var vt=pe.length/Qe;v.sizePerElement=w,v.elements.push({featureIdx:j,vertices:pe,normals:Fe,offset:g}),g+=vt;for(var Bt=function(Or){var Tr=(Fe==null?void 0:Fe.slice(Or*3,Or*3+3))||[],on=pe.slice(Or*Qe,Or*Qe+Qe),kn=0;yt&&yt[Or]!==void 0&&(kn=yt[Or]),i.forEach(function(si,Xa){if(si&&p[si.name]){var bo;(bo=si.buffer.data).push.apply(bo,(0,_e.Z)(p[si.name](U,j,on,Or,Tr,kn)))}})},Qt=0;Qt<vt;Qt++)Bt(Qt)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),qd=function(){var e=(0,Ua.Z)(xi().mark(function a(t){var i,r,o,u,p,v,g,E,w;return xi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,p={a_Color:Sc,a_Position:qc,filter:$h,a_vertexId:xp,a_PickingColor:function(j,q){var ae=j.id;return o?te(ae):[0,0,0]},a_Shape:function(j,q,ae,pe){var Fe=j.shape,Qe=Fe===void 0?2:Fe,yt=u.indexOf(Qe);return[yt]},a_Extrude:function(j,q,ae,pe){var Fe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Qe=pe%4*3;return[Fe[Qe],Fe[Qe+1],Fe[Qe+2]]},a_Size:function(j,q,ae,pe){var Fe=j.size,Qe=Fe===void 0?5:Fe;return Array.isArray(Qe)?[Qe[0]]:[Qe]}},v={sizePerElement:0,elements:[]},g=0,E=[],w=3,r.forEach(function(U,j){var q=bp(U),ae=q.indices,pe=q.vertices,Fe=q.normals,Qe=q.size,yt=q.indexes;ae.forEach(function(Ir){E.push(Ir+g)}),w=Qe;var vt=pe.length/Qe;v.sizePerElement=w,v.elements.push({featureIdx:j,vertices:pe,normals:Fe,offset:g}),g+=vt;for(var Bt=function(Or){var Tr=(Fe==null?void 0:Fe.slice(Or*3,Or*3+3))||[],on=pe.slice(Or*Qe,Or*Qe+Qe),kn=0;yt&&yt[Or]!==void 0&&(kn=yt[Or]),i.forEach(function(si,Xa){if(si&&p[si.name]){var bo;(bo=si.buffer.data).push.apply(bo,(0,_e.Z)(p[si.name](U,j,on,Or,Tr,kn)))}})},Qt=0;Qt<vt;Qt++)Bt(Qt)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),qp=function(){var e=(0,Ua.Z)(xi().mark(function a(t){var i,r,o,u,p,v,g,E;return xi().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:Sc,a_Position:qc,filter:$h,a_vertexId:xp,a_PickingColor:function(U,j){var q=U.id;return o?te(q):[0,0,0]}},p={sizePerElement:0,elements:[]},v=0,g=[],E=3,r.forEach(function(F,U){var j=ps(F),q=j.indices,ae=j.vertices,pe=j.normals,Fe=j.size,Qe=j.indexes;q.forEach(function(Qt){g.push(Qt+v)}),E=Fe;var yt=ae.length/Fe;p.sizePerElement=E,p.elements.push({featureIdx:U,vertices:ae,normals:pe,offset:v}),v+=yt;for(var vt=function(Ir){var Or=(pe==null?void 0:pe.slice(Ir*3,Ir*3+3))||[],Tr=ae.slice(Ir*Fe,Ir*Fe+Fe),on=0;Qe&&Qe[Ir]!==void 0&&(on=Qe[Ir]),i.forEach(function(kn,si){if(kn&&u[kn.name]){var Xa;(Xa=kn.buffer.data).push.apply(Xa,(0,_e.Z)(u[kn.name](F,U,Tr,Ir,Or,on)))}})},Bt=0;Bt<yt;Bt++)vt(Bt)}),L.abrupt("return",{descriptors:i,featureLayout:p,indices:g});case 8:case"end":return L.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),wc={pointFill:qd,line:Ki,polygonFill:qp},Qh=(0,Z.Z)({},wc);function Kc(e){return Ch.apply(this,arguments)}function Ch(){return Ch=(0,Ua.Z)(xi().mark(function e(a){var t,i;return xi().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.workerType,i=a.data,!Qh[t]){o.next=3;break}return o.abrupt("return",Qh[t](i));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Ch.apply(this,arguments)}Cc(Kc);var kl=new Map;function Jh(e,a){kl.set(e,a)}function Ep(e){var a=kl.get(e);return a}var rl="l7-worker",Kf=3,$p=!0;function Cp(e){Jh(rl,e)}function Kp(){var e=Ep(rl);if(!e)throw new Error("get worker failed by workerName: ".concat(rl,"."));return e}function ep(e,a){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,Ua.Z)(xi().mark(function e(a,t){var i,r,o,u,p;return xi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return i=Kp(),r=Wo.getWorkerFarm({maxConcurrency:Kf,reuseWorkers:$p}),o=r.getWorkerPool({name:rl,source:i}),g.next=5,o.startJob(rl,function(E,w,L){return E.done(L)});case 5:return u=g.sent,u.postMessage("process",{input:{workerType:a,data:t}}),g.next=9,u.result;case 9:return p=g.sent,g.abrupt("return",p.result);case 11:case"end":return g.stop()}},e)})),Mf.apply(this,arguments)}Cp(Iu());var Qs={BACK:1029,FRONT:1028};function If(e){switch(e){case"GAODE1.x":return Qs.BACK;case"GAODE2.x":return Qs.BACK;case"MAPBOX":return Qs.FRONT;case"SIMPLE":return Qs.FRONT;case"GLOBEL":return Qs.BACK;case"L7MAP":return Qs.FRONT;default:return Qs.FRONT}}function Sh(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Ah(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=a.x,i=a.y,r=a.z;if(Array.isArray(e)){var o=Math.abs(t+i)%e.length;e=e[o]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,r.toString()).replace(/\{-y\}/g,(Math.pow(2,r)-i-1).toString())}var Qc;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Qc||(Qc={}));var nl;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(nl||(nl={}));function Tc(e,a){a===void 0&&(a={});var t=Number(e[0]),i=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,i],p=[t,o],v=[r,o],g=[r,i];return ui([[u,g,v,p,u]],a.properties,{bbox:e,id:a.id})}var Wl=0,Qp=1,Du=2;function sc(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function tp(e){e.forEach(function(a){a.properties.state=Wl}),e.forEach(function(a){a.isCurrent&&!cu(a)&&Sp(a)}),e.forEach(function(a){a.isVisible=Boolean(a.properties.state&Du)})}function kf(e){e.forEach(function(t){t.properties.state=Wl}),e.forEach(function(t){t.isCurrent&&cu(t)});var a=e.slice().sort(function(t,i){return t.z-i.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&Du),t.children.length&&(t.isVisible||t.properties.state&Qp)?t.children.forEach(function(i){i.properties.state=Qp}):t.isCurrent&&Sp(t)})}function cu(e){for(;e;){if(e.isLoaded)return e.properties.state|=Du,!0;e=e.parent}return!1}function Sp(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=Du:Sp(a)})}var Qf,Jf=256,uc=[-Infinity,-Infinity,Infinity,Infinity],$d=.2,Kd=5,Mc=(Qf={},(0,ye.Z)(Qf,Qc.Realtime,sc),(0,ye.Z)(Qf,Qc.Overlap,tp),(0,ye.Z)(Qf,Qc.Replace,kf),Qf),wh=function(){};function Jc(e,a,t){var i=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[i,r]}function ef(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}var _d=function(a,t,i){var r=ef(a,t,i),o=(0,Pr.Z)(r,2),u=o[0],p=o[1],v=ef(a+1,t+1,i),g=(0,Pr.Z)(v,2),E=g[0],w=g[1];return[u,w,E,p]};function xd(e){var a=e.zoom,t=e.latLonBounds,i=e.maxZoom,r=i===void 0?Infinity:i,o=e.minZoom,u=o===void 0?0:o,p=e.zoomOffset,v=p===void 0?0:p,g=e.extent,E=g===void 0?uc:g,w=Math.ceil(a)+v;if(Number.isFinite(u)&&w<u)return[];Number.isFinite(r)&&w>r&&(w=r);for(var L=(0,Pr.Z)(t,4),F=L[0],U=L[1],j=L[2],q=L[3],ae=[Math.max(F,E[0]),Math.max(U,E[1]),Math.min(j,E[2]),Math.min(q,E[3])],pe=[],Fe=Jc(ae[0],ae[1],w),Qe=(0,Pr.Z)(Fe,2),yt=Qe[0],vt=Qe[1],Bt=Jc(ae[2],ae[3],w),Qt=(0,Pr.Z)(Bt,2),Ir=Qt[0],Or=Qt[1],Tr=yt;Tr<=Ir;Tr++)for(var on=Or;on<=vt;on++)pe.push({x:Tr,y:on,z:w});var kn=(Ir+yt)/2,si=(vt+Or)/2,Xa=function(Ss,ru){return Math.abs(Ss-kn)+Math.abs(ru-si)};return pe.sort(function(bo,Ss){return Xa(bo.x,bo.y)-Xa(Ss.x,Ss.y)}),pe}var Jp=function(a,t,i){var r=Math.pow(2,i),o=r-1,u=r,p=a,v=t;return p<0?p=p+u:p>o&&(p=p%u),{warpX:p,warpY:v}},rp=function(){function e(a){(0,Ft.Z)(this,e),(0,ye.Z)(this,"tileSize",256),(0,ye.Z)(this,"isVisible",!1),(0,ye.Z)(this,"isCurrent",!1),(0,ye.Z)(this,"isVisibleChange",!1),(0,ye.Z)(this,"parentLayerIDList",[]),(0,ye.Z)(this,"layerIDList",[]),(0,ye.Z)(this,"parent",null),(0,ye.Z)(this,"children",[]),(0,ye.Z)(this,"data",null),(0,ye.Z)(this,"properties",{}),(0,ye.Z)(this,"loadDataId",0);var t=a.x,i=a.y,r=a.z,o=a.tileSize;this.x=t,this.y=i,this.z=r,this.tileSize=o}return(0,Tt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===nl.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===nl.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===nl.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===nl.Cancelled}},{key:"isDone",get:function(){return[nl.Loaded,nl.Cancelled,nl.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return _d(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Pr.Z)(this.bounds,4),i=t[0],r=t[1],o=t[2],u=t[3],p=[(o-i)/2,(u-r)/2],v=Tc(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return v}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r){var o,u,p,v,g,E,w,L,F,U,j,q,ae,pe,Fe,Qe;return xi().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:return o=r.getData,u=r.onLoad,p=r.onError,this.loadDataId++,v=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=nl.Loading,g=null,vt.prev=7,w=this.x,L=this.y,F=this.z,U=this.bounds,j=this.tileSize,q=Jp(w,L,F),ae=q.warpX,pe=q.warpY,Fe=this.abortController.signal,Qe={x:ae,y:pe,z:F,bounds:U,tileSize:j,signal:Fe},vt.next=14,o(Qe,this);case 14:g=vt.sent,vt.next=20;break;case 17:vt.prev=17,vt.t0=vt.catch(7),E=vt.t0;case 20:if(v===this.loadDataId){vt.next=22;break}return vt.abrupt("return");case 22:if(!(this.isCancelled&&!g)){vt.next=24;break}return vt.abrupt("return");case 24:if(!(E||!g)){vt.next=28;break}return this.loadStatus=nl.Failure,p(E,this),vt.abrupt("return");case 28:this.loadStatus=nl.Loaded,this.data=g,u(this);case 31:case"end":return vt.stop()}},i,this,[[7,17]])}));function t(i){return a.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=nl.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),ua=fe(26729),Bu=fe.n(ua),ys=function(a,t){var i=vl(a),r=bc(i,t),o=360*3-180,u=85.0511287798065,p=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return p},Nu=function(a,t){var i=vl(a),r=vl(t),o=Zl(i,r);return o};function tf(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=bd(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function bd(e,a){if(!!e){if(typeof e=="string")return Ap(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ap(e,a)}}function Ap(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Qd(e){var a=Jd();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Jd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ed=function(e){(0,an.Z)(t,e);var a=Qd(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this),(0,ye.Z)((0,Gt.Z)(r),"currentTiles",[]),(0,ye.Z)((0,Gt.Z)(r),"cacheTiles",new Map),(0,ye.Z)((0,Gt.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,ye.Z)((0,Gt.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,ye.Z)((0,Gt.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:uc,getTileData:wh,updateStrategy:Qc.Replace},r.updateOptions(i),r}return(0,Tt.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,p=Math.ceil(r);if(!(this.lastViewStates&&this.lastViewStates.zoom===p&&Nu(this.lastViewStates.latLonBoundsBuffer,o))){var v=ys(o,$d);this.lastViewStates={zoom:p,latLonBounds:o,latLonBoundsBuffer:v};var g=!1,E=this.getTileIndices(p,v);this.currentTiles=E.map(function(w){var L=w.x,F=w.y,U=w.z,j=u.getTile(L,F,U);if(j){var q,ae,pe=((q=j)===null||q===void 0?void 0:q.isFailure)||((ae=j)===null||ae===void 0?void 0:ae.isCancelled);return pe&&j.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),j}return j=u.createTile(L,F,U),g=!0,j}),g&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=tf(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,Pr.Z)(o.value,2),p=u[0],v=u[1];this.currentTiles.includes(v)||(this.cacheTiles.delete(p),this.onTileUnload(v)),this.onTileUnload(v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(g){r.e(g)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=tf(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;p.isLoading&&!p.isCurrent&&!p.isVisible&&r.push(p)}}catch(g){o.e(g)}finally{o.f()}for(;r.length>0;){var v=r.shift();v.abortLoad()}}},{key:"destroy",value:function(){var r=tf(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(p){r.e(p)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=tf(this.cacheTiles.values()),p;try{for(u.s();!(p=u.n()).done;){var v=p.value;o.set(v.key,v.isVisible),v.isCurrent=!1,v.isVisible=!1}}catch(U){u.e(U)}finally{u.f()}var g=tf(this.currentTiles),E;try{for(g.s();!(E=g.n()).done;){var w=E.value;w.isCurrent=!0,w.isVisible=!0}}catch(U){g.e(U)}finally{g.f()}var L=Array.from(this.cacheTiles.values());typeof r=="function"?r(L):Mc[r](L);var F=!1;Array.from(this.cacheTiles.values()).forEach(function(U){U.isVisible!==o.get(U.key)?(U.isVisibleChange=!0,F=!0):U.isVisibleChange=!1}),F&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,p=u.tileSize,v=u.extent,g=u.zoomOffset,E=Math.floor(this.options.maxZoom),w=Math.ceil(this.options.minZoom),L=xd({maxZoom:E,minZoom:w,zoomOffset:g,tileSize:p,zoom:r,latLonBounds:o,extent:v});return L}},{key:"getTileId",value:function(r,o,u){var p="".concat(r,",").concat(o,",").concat(u);return p}},{key:"getTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=this.cacheTiles.get(p);return v}},{key:"createTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=new rp({x:r,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(p,v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),v}},{key:"resizeCacheTiles",value:function(){var r=Kd*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=tf(this.cacheTiles),p;try{for(u.s();!(p=u.n()).done;){var v=(0,Pr.Z)(p.value,2),g=v[0],E=v[1];if(!E.isVisible&&!this.currentTiles.includes(E)&&(this.cacheTiles.delete(g),this.onTileUnload(E)),this.cacheTiles.size<=r)break}}catch(w){u.e(w)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var r=tf(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(w){r.e(w)}finally{r.f()}var p=tf(this.cacheTiles.values()),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,E=this.getNearestAncestor(g.x,g.y,g.z);g.parent=E,E!=null&&E.children&&E.children.push(g)}}catch(w){p.e(w)}finally{p.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var p=this.getTile(r,o,u);if(p)return p}return null}}]),t}(Bu());function e0(e,a){var t=a.extent,i=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||cl(e)?u([e]):C0(e,function(p){u(p)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return o}function C0(e,a){var t=e,i=[];if(typeof t=="string")$o({url:t},function(u,p){p&&(i.push(p),a(i))});else{var r=t.length,o=0;t.forEach(function(u){$o({url:u},function(p,v){o++,v&&i.push(v),o===r&&a(i)})})}return e0}var wp=fe(38929),Tp=fe(3614),t0=fe.n(Tp),np={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},ho=512;function ed(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}function Pf(e){for(var a=0,t=0,i=e.length,r=i-1,o,u;t<i;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function Rf(e){var a=e.length;if(a<=1)return[e];for(var t=[],i,r,o=0;o<a;o++){var u=Pf(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(i&&t.push(i),i=[e[o]]):i.push(e[o]))}return i&&t.push(i),t}var Cd=["Unknown","Point","LineString","Polygon"];function S0(e,a){var t=a.extent,i=a.loadGeometry(),r=a.type,o=a.properties,u=a.id,p=t*Math.pow(2,e),v=Cd[r],g,E;function w(U){for(var j=0;j<U.length;j++){var q=U[j];U[j]=[q.x/p*ho,q.y/p*ho]}}switch(r){case 1:var L=[];for(g=0;g<i.length;g++)L[g]=i[g][0];i=L,w(i);break;case 2:for(g=0;g<i.length;g++)w(i[g]);break;case 3:for(i=Rf(i),g=0;g<i.length;g++)for(E=0;E<i[g].length;E++)w(i[g][E]);break}i.length===1?i=i[0]:v="Multi"+v;var F={type:"Feature",geometry:{type:v,coordinates:i},properties:o,id:u,tileOrigin:[0,0],coord:""};return F}var H=function(){var e=(0,Ua.Z)(xi().mark(function a(t,i,r,o){var u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=Ah(t,i),v.abrupt("return",new Promise(function(g){var E=Ju({url:u},function(w,L){if(w||!L)g({layers:{}});else{for(var F=new wp.VectorTile(new(t0())(L)),U=ed(i.x,i.y,i.z),j=i.z,q=0,ae=Object.keys(F.layers);q<ae.length;q++){for(var pe=ae[q],Fe=[],Qe=F.layers[pe],yt=0;yt<F.layers[pe].length;yt++){var vt=F.layers[pe].feature(yt),Bt=void 0;o==="lnglat"?Bt=vt.toGeoJSON(i.x,i.y,i.z):(Bt=S0(j,vt),Qe.l7TileOrigin=U,Qe.l7TileCoord=o),Fe.push(Bt)}Qe.features=Fe}g(F)}});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}();function Pe(e,a){var t=(a==null?void 0:a.coord)||"lnglat",i=function(u,p){return H(e,u,p,t)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},np),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function it(e,a){var t=a.extent,i=a.width,r=a.height,o=a.min,u=a.max,p={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:r,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return p}var or;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(or||(or={}));var Br=function(){var e=(0,Ua.Z)(xi().mark(function a(t,i,r,o){var u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=Ah(t,i),v.abrupt("return",new Promise(function(g,E){var w=dh({url:u},function(L,F){L?E(L):F&&g(F)},o);r.xhrCancel=function(){return w.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}(),ur=function(){var e=(0,Ua.Z)(xi().mark(function a(t,i,r){var o;return xi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=Ah(t,i),p.abrupt("return",new Promise(function(v,g){var E=$o({url:o},function(w,L){w?g(w):L&&v(L)});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return p.stop()}},a)}));return function(t,i,r){return e.apply(this,arguments)}}(),kr=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Gr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Kr(e,a){var t=(a==null?void 0:a.dataType)||or.IMAGE,i=function(u,p){return t===or.IMAGE?ur(e,u,p):Br(e,u,p,(a==null?void 0:a.format)||kr)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},Gr),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var en=fe(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function sn(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(w){u(w)}}function v(E){try{g(i.throw(E))}catch(w){u(w)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})}function dn(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function Fn(e,a){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var i=t.call(e),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(p){u={error:p}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return o}function tn(){for(var e=[],a=0;a<arguments.length;a++)e=e.concat(Fn(arguments[a]));return e}function Ur(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function St(e,a){return a={exports:{}},e(a,a.exports),a.exports}var mr=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=a.default});Ur(mr);var rn=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];var o=i.pop();return t.call(this,i,o)}},e.exports=a.default});Ur(rn);var En=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.fallback=r,a.wrap=o;var t=a.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=a.hasNextTick=typeof en=="object"&&typeof en.nextTick=="function";function r(p){setTimeout(p,0)}function o(p){return function(v){for(var g=[],E=arguments.length-1;E-- >0;)g[E]=arguments[E+1];return p(function(){return v.apply(void 0,g)})}}var u;t?u=setImmediate:i?u=en.nextTick:u=r,a.default=o(u)});Ur(En);var Vr=En.fallback,Cn=En.wrap,Zn=En.hasSetImmediate,Ii=En.hasNextTick,Mr=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(rn),i=r(En);function r(v){return v&&v.__esModule?v:{default:v}}function o(v){return(0,wr.isAsync)(v)?function(){for(var g=[],E=arguments.length;E--;)g[E]=arguments[E];var w=g.pop(),L=v.apply(this,g);return u(L,w)}:(0,t.default)(function(g,E){var w;try{w=v.apply(this,g)}catch(L){return E(L)}if(w&&typeof w.then=="function")return u(w,E);E(null,w)})}function u(v,g){return v.then(function(E){p(g,null,E)},function(E){p(g,E&&E.message?E:new Error(E))})}function p(v,g,E){try{v(g,E)}catch(w){(0,i.default)(function(L){throw L},w)}}e.exports=a.default});Ur(Mr);var wr=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isAsyncIterable=a.isAsyncGenerator=a.isAsync=void 0;var t=i(Mr);function i(v){return v&&v.__esModule?v:{default:v}}function r(v){return v[Symbol.toStringTag]==="AsyncFunction"}function o(v){return v[Symbol.toStringTag]==="AsyncGenerator"}function u(v){return typeof v[Symbol.asyncIterator]=="function"}function p(v){if(typeof v!="function")throw new Error("expected a function");return r(v)?(0,t.default)(v):v}a.default=p,a.isAsync=r,a.isAsyncGenerator=o,a.isAsyncIterable=u});Ur(wr);var ci=wr.isAsyncIterable,Nn=wr.isAsyncGenerator,un=wr.isAsync,Pn=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i,r){if(r===void 0&&(r=i.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,p=[],v=arguments.length;v--;)p[v]=arguments[v];return typeof p[r-1]=="function"?i.apply(this,p):new Promise(function(g,E){p[r-1]=function(w){for(var L=[],F=arguments.length-1;F-- >0;)L[F]=arguments[F+1];if(w)return E(w);g(L.length>1?L:L[0])},i.apply(u,p)})}return Object.defineProperty(o,"name",{configurable:!0,value:"awaitable("+i.name+")"}),o}e.exports=a.default});Ur(Pn);var Dn=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(mr),i=o(wr),r=o(Pn);function o(u){return u&&u.__esModule?u:{default:u}}a.default=(0,r.default)(function(u,p,v){var g=(0,t.default)(p)?[]:{};u(p,function(E,w,L){(0,i.default)(E)(function(F){for(var U,j=[],q=arguments.length-1;q-- >0;)j[q]=arguments[q+1];j.length<2&&(U=j,j=U[0]),g[w]=j,L(F)})},function(E){return v(E,g)})},3),e.exports=a.default});Ur(Dn);var Qi=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i!==null){var p=i;i=null,p.apply(this,o)}}return Object.assign(r,i),r}e.exports=a.default});Ur(Qi);var Fi=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=a.default});Ur(Fi);var Rn=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=v;var t=r(mr),i=r(Fi);function r(g){return g&&g.__esModule?g:{default:g}}function o(g){var E=-1,w=g.length;return function(){return++E<w?{value:g[E],key:E}:null}}function u(g){var E=-1;return function(){var L=g.next();return L.done?null:(E++,{value:L.value,key:E})}}function p(g){var E=g?Object.keys(g):[],w=-1,L=E.length;return function(){var U=E[++w];return w<L?{value:g[U],key:U}:null}}function v(g){if((0,t.default)(g))return o(g);var E=(0,i.default)(g);return E?u(E):p(g)}e.exports=a.default});Ur(Rn);var Un=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(i===null)throw new Error("Callback was already called.");var u=i;i=null,u.apply(this,r)}}e.exports=a.default});Ur(Un);var Oi=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t={};a.default=t,e.exports=a.default});Ur(Oi);var ta=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;var t=i(Oi);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,u,p,v){var g=!1,E=!1,w=!1,L=0,F=0;function U(){L>=u||w||g||(w=!0,o.next().then(function(ae){var pe=ae.value,Fe=ae.done;if(!(E||g)){if(w=!1,Fe){g=!0,L<=0&&v(null);return}L++,p(pe,F,j),F++,U()}}).catch(q))}function j(ae,pe){if(L-=1,!E){if(ae)return q(ae);if(ae===!1){g=!0,E=!0;return}if(pe===t.default||g&&L<=0)return g=!0,v(null);U()}}function q(ae){E||(w=!1,g=!0,v(ae))}U()}e.exports=a.default});Ur(ta);var Ma=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=p(Qi),i=p(Rn),r=p(Un),o=p(ta),u=p(Oi);function p(v){return v&&v.__esModule?v:{default:v}}a.default=function(v){return function(g,E,w){if(w=(0,t.default)(w),v<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!g)return w(null);if((0,wr.isAsyncGenerator)(g))return(0,o.default)(g,v,E,w);if((0,wr.isAsyncIterable)(g))return(0,o.default)(g[Symbol.asyncIterator](),v,E,w);var L=(0,i.default)(g),F=!1,U=!1,j=0,q=!1;function ae(Fe,Qe){if(!U)if(j-=1,Fe)F=!0,w(Fe);else if(Fe===!1)F=!0,U=!0;else{if(Qe===u.default||F&&j<=0)return F=!0,w(null);q||pe()}}function pe(){for(q=!0;j<v&&!F;){var Fe=L();if(Fe===null){F=!0,j<=0&&w(null);return}j+=1,E(Fe.value,Fe.key,(0,r.default)(ae))}q=!1}pe()}},e.exports=a.default});Ur(Ma);var No=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(Ma),i=o(wr),r=o(Pn);function o(p){return p&&p.__esModule?p:{default:p}}function u(p,v,g,E){return(0,t.default)(v)(p,(0,i.default)(g),E)}a.default=(0,r.default)(u,4),e.exports=a.default});Ur(No);var Ko=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=r(No),i=r(Pn);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p,v){return(0,t.default)(u,1,p,v)}a.default=(0,i.default)(o,3),e.exports=a.default});Ur(Ko);var Ea=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(Dn),i=r(Ko);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,t.default)(i.default,u,p)}e.exports=a.default}),Zs=Ur(Ea),eo=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return this.args=t,Zs(this.tasks)},e.prototype.tap=function(a,t){var i=this;this.tasks.push(function(r){t.apply(void 0,tn(i.args)),r(null,a)})},e}(),Vs=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=g(mr),i=g(Oi),r=g(No),o=g(Qi),u=g(Un),p=g(wr),v=g(Pn);function g(F){return F&&F.__esModule?F:{default:F}}function E(F,U,j){j=(0,o.default)(j);var q=0,ae=0,pe=F.length,Fe=!1;pe===0&&j(null);function Qe(yt,vt){yt===!1&&(Fe=!0),Fe!==!0&&(yt?j(yt):(++ae===pe||vt===i.default)&&j(null))}for(;q<pe;q++)U(F[q],q,(0,u.default)(Qe))}function w(F,U,j){return(0,r.default)(F,Infinity,U,j)}function L(F,U,j){var q=(0,t.default)(F)?E:w;return q(F,(0,p.default)(U),j)}a.default=(0,v.default)(L,3),e.exports=a.default});Ur(Vs);var _s=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(Vs),i=r(Dn);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,i.default)(t.default,u,p)}e.exports=a.default}),Js=Ur(_s),js=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Js(this.tasks)},e.prototype.tapPromise=function(a,t){var i=this;this.tasks.push(function(r){return sn(i,void 0,void 0,function(){return dn(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),xu=St(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=u(Qi),i=u(Un),r=u(wr),o=u(Pn);function u(v){return v&&v.__esModule?v:{default:v}}function p(v,g){if(g=(0,t.default)(g),!Array.isArray(v))return g(new Error("First argument to waterfall must be an array of functions"));if(!v.length)return g();var E=0;function w(F){var U=(0,r.default)(v[E++]);U.apply(void 0,F.concat([(0,i.default)(L)]))}function L(F){for(var U=[],j=arguments.length-1;j-- >0;)U[j]=arguments[j+1];if(F!==!1){if(F||E===v.length)return g.apply(void 0,[F].concat(U));w(U)}}w([])}a.default=(0,o.default)(p),e.exports=a.default}),Qo=Ur(xu),la=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Qo(this.tasks)},e.prototype.tap=function(a,t){this.tasks.length===0?this.tasks.push(function(i){var r=t();i(r?null:!1,r)}):this.tasks.push(function(i,r){var o=t();r(o?null:!1,a)})},e}(),xs=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Zs(this.tasks)},e.prototype.tap=function(a,t){this.tasks.push(function(i){var r=t();i(r,a)})},e}(),gr=fe(96486),fu=fe(69848),Yi=fe.n(fu);function wa(e,a){var t=a.radius,i=t===void 0?40:t,r=a.maxZoom,o=r===void 0?18:r,u=a.minZoom,p=u===void 0?0:u,v=a.zoom,g=v===void 0?2:v;if(e.pointIndex){var E=e.pointIndex.getClusters(e.extent,Math.floor(g));return e.dataArray=io(E),e}var w=new(Yi())({radius:i,minZoom:p,maxZoom:o}),L={type:"FeatureCollection",features:[]};return L.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:(0,Z.Z)({},F)}}),w.load(L.features),w}function io(e){return e.map(function(a,t){return(0,Z.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function bs(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a}function rf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a}function Ye(e){if(e.length===0)return 0;for(var a=e[0],t=0,i,r=1;r<e.length;r++)i=a+e[r]*1,Math.abs(a)>=Math.abs(e[r])?t+=a-i+e[r]:t+=e[r]-i+a,a=i;return a+t*1}function dr(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ye(e)/e.length}var qt={min:rf,max:bs,mean:dr,sum:Ye};function ei(e,a){return e.map(function(t){return t[a]*1})}function Ra(e){var a=Ze();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Ze(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ee(e,a){if(Array.isArray(a))return a}var ft=function(e){(0,an.Z)(t,e);var a=Ra(t);function t(i,r){var o;return(0,Ft.Z)(this,t),o=a.call(this),(0,ye.Z)((0,Gt.Z)(o),"inited",!1),(0,ye.Z)((0,Gt.Z)(o),"hooks",{init:new eo}),(0,ye.Z)((0,Gt.Z)(o),"parser",{type:"geojson"}),(0,ye.Z)((0,Gt.Z)(o),"transforms",[]),(0,ye.Z)((0,Gt.Z)(o),"cluster",!1),(0,ye.Z)((0,Gt.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,ye.Z)((0,Gt.Z)(o),"invalidExtent",!1),(0,ye.Z)((0,Gt.Z)(o),"dataArrayChanged",!1),(0,ye.Z)((0,Gt.Z)(o),"cfg",{}),o.originData=i,o.initCfg(r),o.init(),o}return(0,Tt.Z)(t,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,p=u.method,v=p===void 0?"sum":p,g=u.field,E=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,E.forEach(function(w){w.id||(w.properties.point_count=1)}),(g||(0,gr.isFunction)(v))&&(E=E.map(function(w){var L=w.id;if(L){var F=o.clusterIndex.getLeaves(L,Infinity),U=F.map(function(ae){return ae.properties}),j;if((0,gr.isString)(v)&&g){var q=ei(U,g);j=qt[v](q)}(0,gr.isFunction)(v)&&(j=v(U)),w.properties.stat=j}else w.properties.point_count=1;return w})),this.data=he("geojson")({type:"FeatureCollection",features:E}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser.type,u=o===void 0?"geojson":o;if(u==="geojson"&&!this.cluster){var p=r<this.originData.features.length?this.originData.features[r]:"null",v=(0,gr.cloneDeep)(p);if(this.transforms.length!==0||this.dataArrayChanged){var g=this.data.dataArray.find(function(E){return E._id===r});v.properties=g}return v}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,Z.Z)((0,Z.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(p){return p[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"handleData",value:function(){var r=this;return new Promise(function(o,u){try{r.excuteParser(),r.initCluster(),r.executeTrans(),o({})}catch(p){u(p)}})}},{key:"initCfg",value:function(r){this.cfg=(0,gr.mergeWith)(this.cfg,r,Ee);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Z.Z)((0,Z.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var r=this;this.inited=!1,this.handleData().then(function(){r.inited=!0,r.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=he(o);this.data=u(this.originData,r),this.extent=_o(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new Ed((0,Z.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var p=u.type,v=Ae(p)(r.data,u);Object.assign(r.data,v)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=wa(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=bc(vl(this.extent),r)),o[0].concat(o[1])}}]),t}(ua.EventEmitter);function Ut(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function nr(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=gt(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function gt(e,a){if(!!e){if(typeof e=="string")return nt(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nt(e,a)}}function nt(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var At=6378e3;function Le(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=r/(2*Math.PI*At)*(256<<20)/2,u=lt(t,r),p=u.gridHash,v=u.gridOffset,g=jr(p,v,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:g}}function lt(e,a){var t=Infinity,i=-Infinity,r,o=nr(e),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;r=p.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,i=r>i?r:i)}}catch(Fe){o.e(Fe)}finally{o.f()}var v=(t+i)/2,g=Ge(a,v);if(g.xOffset<=0||g.yOffset<=0)return{gridHash:{},gridOffset:g};var E={},w=nr(e),L;try{for(w.s();!(L=w.n()).done;){var F=L.value,U=F.coordinates[1],j=F.coordinates[0];if(Number.isFinite(U)&&Number.isFinite(j)){var q=Math.floor((U+90)/g.yOffset),ae=Math.floor((j+180)/g.xOffset),pe="".concat(q,"-").concat(ae);E[pe]=E[pe]||{count:0,points:[]},E[pe].count+=1,E[pe].points.push(F)}}}catch(Fe){w.e(Fe)}finally{w.f()}return{gridHash:E,gridOffset:g}}function Ge(e,a){var t=zt(e),i=$t(a,e);return{yOffset:t,xOffset:i}}function zt(e){return e/At*(180/Math.PI)}function $t(e,a){return a/At*(180/Math.PI)/Math.cos(e*Math.PI/180)}function jr(e,a,t){return Object.keys(e).reduce(function(i,r,o){var u=r.split("-"),p=parseInt(u[0],10),v=parseInt(u[1],10),g={};if(t.field&&t.method){var E=co(e[r].points,t.field);g[t.method]=wl[t.method](E)}return Object.assign(g,{_id:o,coordinates:Go([-180+a.xOffset*(v+.5),-90+a.yOffset*(p+.5)]),rawData:e[r].points,count:e[r].count}),i.push(g),i},[])}var _n=Math.PI/3,Ln=[0,_n,2*_n,3*_n,4*_n,5*_n];function jn(e){return e[0]}function vn(e){return e[1]}function ti(){var e=0,a=0,t=1,i=1,r=jn,o=vn,u,p,v;function g(w){var L={},F=[],U,j=w.length;for(U=0;U<j;++U)if(!(isNaN(ae=+r.call(null,q=w[U],U,w))||isNaN(pe=+o.call(null,q,U,w)))){var q,ae,pe,Fe=Math.round(pe=pe/v),Qe=Math.round(ae=ae/p-(Fe&1)/2),yt=pe-Fe;if(Math.abs(yt)*3>1){var vt=ae-Qe,Bt=Qe+(ae<Qe?-1:1)/2,Qt=Fe+(pe<Fe?-1:1),Ir=ae-Bt,Or=pe-Qt;vt*vt+yt*yt>Ir*Ir+Or*Or&&(Qe=Bt+(Fe&1?1:-1)/2,Fe=Qt)}var Tr=Qe+"-"+Fe,on=L[Tr];on?on.push(q):(F.push(on=L[Tr]=[q]),on.x=(Qe+(Fe&1)/2)*p,on.y=Fe*v)}return F}function E(w){var L=0,F=0;return Ln.map(function(U){var j=Math.sin(U)*w,q=-Math.cos(U)*w,ae=j-L,pe=q-F;return L=j,F=q,[ae,pe]})}return g.hexagon=function(w){return"m"+E(w==null?u:+w).join("l")+"z"},g.centers=function(){for(var w=[],L=Math.round(a/v),F=Math.round(e/p),U=L*v;U<i+u;U+=v,++L)for(var j=F*p+(L&1)*p/2;j<t+p/2;j+=p)w.push([j,U]);return w},g.mesh=function(){var w=E(u).slice(0,4).join("l");return g.centers().map(function(L){return"M"+L+"m"+w}).join("")},g.x=function(w){return arguments.length?(r=w,g):r},g.y=function(w){return arguments.length?(o=w,g):o},g.radius=function(w){return arguments.length?(u=+w,p=u*2*Math.sin(_n),v=u*1.5,g):u},g.size=function(w){return arguments.length?(e=a=0,t=+w[0],i=+w[1],g):[t-e,i-a]},g.extent=function(w){return arguments.length?(e=+w[0][0],a=+w[0][1],t=+w[1][0],i=+w[1][1],g):[[e,a],[t,i]]},g.radius(1)}var Yn=6378e3;function ai(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=a.method,u=o===void 0?"sum":o,p=r/(2*Math.PI*Yn)*(256<<20)/2,v=t.map(function(L){var F=Go(L.coordinates),U=(0,Pr.Z)(F,2),j=U[0],q=U[1];return(0,Z.Z)((0,Z.Z)({},L),{},{coordinates:[j,q]})}),g=ti().radius(p).x(function(L){return L.coordinates[0]}).y(function(L){return L.coordinates[1]}),E=g(v),w={dataArray:E.map(function(L,F){var U;if(a.field&&u){var j=co(L,a.field);L[u]=wl[u](j)}return U={},(0,ye.Z)(U,a.method,L[u]),(0,ye.Z)(U,"count",L.length),(0,ye.Z)(U,"rawData",L),(0,ye.Z)(U,"coordinates",[L.x,L.y]),(0,ye.Z)(U,"_id",F),U}),radius:p,xOffset:p,yOffset:p,type:"hexagon"};return w}function oi(e,a){var t=a.sourceField,i=a.targetField,r=a.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var p=u[i];return(0,Z.Z)((0,Z.Z)({},u),o[p])}),e}function qn(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}ut("rasterTile",Kr),ut("mvt",Pe),ut("geojson",Tn),ut("image",e0),ut("csv",Xn),ut("json",Vt),ut("raster",it),Xe("cluster",wa),Xe("filter",Ut),Xe("join",oi),Xe("map",qn),Xe("grid",Le),Xe("hexagon",ai);var Ui=fr,po=Mt,eu=Fr,vo=ft,uo=fe(28660),xn=fe(86700),zu=fe(84879),hr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Xl=fe(31745),Sd=fe.n(Xl);function yl(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nf(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function nf(e,a){if(!!e){if(typeof e=="string")return ip(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ip(e,a)}}function ip(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var tu=30;function Gs(e){var a=e.characterSet,t=e.getFontWidth,i=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,p=u===void 0?{}:u,v=e.xOffset,g=v===void 0?0:v,E=e.yOffset,w=E===void 0?0:E,L=0,F=g;Array.from(a).forEach(function(j,q){if(!p[j]){var ae=t(j,q);F+tu>o&&(F=0,L++),p[j]={x:F,y:w+L*tu,width:tu,height:tu,advance:ae},F+=tu}});var U=i+r*2;return{mapping:p,xOffset:F,yOffset:w+L*U,canvasHeight:Ad(w+(L+1)*U)}}function Mp(e,a,t){var i=0,r=0,o=0,u=[],p={},v=yl(e),g;try{for(v.s();!(g=v.n()).done;){var E=g.value;if(!p[E.id]){var w=E.size;i+w+a>t&&(af(p,u,r),i=0,r=o+r+a,o=0,u=[]),u.push({icon:E,xOffset:i}),i=i+w+a,o=Math.max(o,w)}}}catch(F){v.e(F)}finally{v.f()}u.length>0&&af(p,u,r);var L=Ad(o+r+a);return{mapping:p,canvasHeight:L}}function af(e,a,t){var i=yl(a),r;try{for(i.s();!(r=i.n()).done;){var o=r.value,u=o.icon,p=o.xOffset;e[u.id]=(0,Z.Z)((0,Z.Z)({},u),{},{x:p,y:t,image:u.image,width:u.width,height:u.height})}}catch(v){i.e(v)}finally{i.f()}}function Ad(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var wd,r0;function Ip(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Th(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Th(e,a){if(!!e){if(typeof e=="string")return A0(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A0(e,a)}}function A0(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var sv=R(),Zv="sans-serif",Hs="normal",eh=24,uv=3,n=.25,s=8,l=1024,d=1,x=1,C=3,T=null;function R(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function z(e,a,t,i){e.font="".concat(i," ").concat(t,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function W(e,a){for(var t=0;t<e.length;t++)a.data[4*t+3]=e[t]}var $=(wd=(0,xn.b2)(),wd(r0=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"iconFontGlyphs",{}),(0,ye.Z)(this,"cache",new f(C))}return(0,Tt.Z)(e,[{key:"scale",get:function(){return x}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Zv,fontWeight:Hs,characterSet:sv,fontSize:eh,buffer:uv,sdf:!0,cutoff:n,radius:s,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var i=this;t.forEach(function(r){i.iconFontGlyphs[r.name]=r.unicode})}},{key:"addIconFont",value:function(t,i){this.iconFontMap.set(t,i)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Z.Z)((0,Z.Z)({},this.fontOptions),t),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(!(r&&i.length===0)){var o=this.generateFontAtlas(this.key,i,r);this.fontAtlas=o,this.cache.set(this.key,o)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,i,r){var o=this.fontOptions,u=o.fontFamily,p=o.fontWeight,v=o.fontSize,g=o.buffer,E=o.sdf,w=o.radius,L=o.cutoff,F=o.iconfont,U=r&&r.data;U||(U=Pa.document.createElement("canvas"),U.width=l);var j=U.getContext("2d");z(j,u,v,p);var q=Gs((0,Z.Z)({getFontWidth:function(Ss){return j.measureText(Ss).width},fontHeight:v*x,buffer:g,characterSet:i,maxCanvasWidth:l},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),ae=q.mapping,pe=q.canvasHeight,Fe=q.xOffset,Qe=q.yOffset,yt=j.getImageData(0,0,U.width,U.height);if(U.height=pe,j.putImageData(yt,0,0),z(j,u,v,p),E){var vt=new(Sd())(v,g,w,L,u,p),Bt=j.getImageData(0,0,vt.size,vt.size),Qt=Ip(i),Ir;try{for(Qt.s();!(Ir=Qt.n()).done;){var Or=Ir.value;if(F){var Tr=String.fromCharCode(parseInt(Or.replace("&#x","").replace(";",""),16)),on=vt.draw(Tr);W(on,Bt)}else W(vt.draw(Or),Bt);j.putImageData(Bt,ae[Or].x,ae[Or].y)}}catch(bo){Qt.e(bo)}finally{Qt.f()}}else{var kn=Ip(i),si;try{for(kn.s();!(si=kn.n()).done;){var Xa=si.value;j.fillText(Xa,ae[Xa].x,ae[Xa].y+v*d)}}catch(bo){kn.e(bo)}finally{kn.f()}}return{xOffset:Fe,yOffset:Qe,mapping:ae,data:U,width:U.width,height:U.height}}},{key:"getKey",value:function(){return"key";var t,i,r,o,u,p,v,g}},{key:"getNewChars",value:function(t,i){var r=this.cache.get(t);if(!r)return i;var o=[],u=r.mapping,p=new Set(Object.keys(u)),v=new Set(i);return v.forEach(function(g){p.has(g)||o.push(g)}),o}}]),e}())||r0),ee,le;function be(e){var a=$e();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function $e(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Je=3,dt=1024,st=64,Dt=(ee=(0,xn.b2)(),ee(le=function(e){(0,an.Z)(t,e);var a=be(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"canvasHeight",128),(0,ye.Z)((0,Gt.Z)(i),"loadingImageCount",0),i}return(0,Tt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Pa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(r,o){var u=this,p=new Image;if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:st}),this.updateIconMap(),this.loadImage(o).then(function(v){p=v;var g=u.iconData.find(function(E){return E.id===r});g&&(g.image=p,g.width=p.width,g.height=p.height),u.update()})}},{key:"addImageMini",value:function(r,o,u){var p=this,v=u.getSceneConfig().canvas,g=v.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:st}),this.updateIconMap(),this.loadImageMini(o,v).then(function(E){g=E;var w=p.iconData.find(function(L){return L.id===r});w&&(w.image=g,w.width=g.width,w.height=g.height),p.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var p=new Image;p.crossOrigin="anonymous",p.onload=function(){o(p)},p.onerror=function(){u(new Error("Could not load image at "+r))},p.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=dt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],p=u.x,v=u.y,g=u.image,E=u.width,w=E===void 0?64:E,L=u.height,F=L===void 0?64:L,U=Math.max(w,F),j=U/st,q=F/j,ae=w/j;g&&r.ctx.drawImage(g,p+(st-ae)/2,v+(st-q)/2,ae,q)})}},{key:"updateIconMap",value:function(){var r=Mp(this.iconData,Je,dt),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,p){var v=o.createImage();v.crossOrigin="anonymous",v.onload=function(){u(v)},v.onerror=function(){p(new Error("Could not load image at "+r))},v.src=r})}}]),t}(ua.EventEmitter))||le),kt=fe(49685);function lr(){var e=new kt.WT(16);return kt.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function yr(e){var a=new kt.WT(16);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function zr(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function hn(e,a,t,i,r,o,u,p,v,g,E,w,L,F,U,j){var q=new kt.WT(16);return q[0]=e,q[1]=a,q[2]=t,q[3]=i,q[4]=r,q[5]=o,q[6]=u,q[7]=p,q[8]=v,q[9]=g,q[10]=E,q[11]=w,q[12]=L,q[13]=F,q[14]=U,q[15]=j,q}function Bn(e,a,t,i,r,o,u,p,v,g,E,w,L,F,U,j,q){return e[0]=a,e[1]=t,e[2]=i,e[3]=r,e[4]=o,e[5]=u,e[6]=p,e[7]=v,e[8]=g,e[9]=E,e[10]=w,e[11]=L,e[12]=F,e[13]=U,e[14]=j,e[15]=q,e}function wi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $n(e,a){if(e===a){var t=a[1],i=a[2],r=a[3],o=a[6],u=a[7],p=a[11];e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=t,e[6]=a[9],e[7]=a[13],e[8]=i,e[9]=o,e[11]=a[14],e[12]=r,e[13]=u,e[14]=p}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e}function Ci(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=a[4],p=a[5],v=a[6],g=a[7],E=a[8],w=a[9],L=a[10],F=a[11],U=a[12],j=a[13],q=a[14],ae=a[15],pe=t*p-i*u,Fe=t*v-r*u,Qe=t*g-o*u,yt=i*v-r*p,vt=i*g-o*p,Bt=r*g-o*v,Qt=E*j-w*U,Ir=E*q-L*U,Or=E*ae-F*U,Tr=w*q-L*j,on=w*ae-F*j,kn=L*ae-F*q,si=pe*kn-Fe*on+Qe*Tr+yt*Or-vt*Ir+Bt*Qt;return si?(si=1/si,e[0]=(p*kn-v*on+g*Tr)*si,e[1]=(r*on-i*kn-o*Tr)*si,e[2]=(j*Bt-q*vt+ae*yt)*si,e[3]=(L*vt-w*Bt-F*yt)*si,e[4]=(v*Or-u*kn-g*Ir)*si,e[5]=(t*kn-r*Or+o*Ir)*si,e[6]=(q*Qe-U*Bt-ae*Fe)*si,e[7]=(E*Bt-L*Qe+F*Fe)*si,e[8]=(u*on-p*Or+g*Qt)*si,e[9]=(i*Or-t*on-o*Qt)*si,e[10]=(U*vt-j*Qe+ae*pe)*si,e[11]=(w*Qe-E*vt-F*pe)*si,e[12]=(p*Ir-u*Tr-v*Qt)*si,e[13]=(t*Tr-i*Ir+r*Qt)*si,e[14]=(j*Fe-U*yt-q*pe)*si,e[15]=(E*yt-w*Fe+L*pe)*si,e):null}function ri(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=a[4],p=a[5],v=a[6],g=a[7],E=a[8],w=a[9],L=a[10],F=a[11],U=a[12],j=a[13],q=a[14],ae=a[15];return e[0]=p*(L*ae-F*q)-w*(v*ae-g*q)+j*(v*F-g*L),e[1]=-(i*(L*ae-F*q)-w*(r*ae-o*q)+j*(r*F-o*L)),e[2]=i*(v*ae-g*q)-p*(r*ae-o*q)+j*(r*g-o*v),e[3]=-(i*(v*F-g*L)-p*(r*F-o*L)+w*(r*g-o*v)),e[4]=-(u*(L*ae-F*q)-E*(v*ae-g*q)+U*(v*F-g*L)),e[5]=t*(L*ae-F*q)-E*(r*ae-o*q)+U*(r*F-o*L),e[6]=-(t*(v*ae-g*q)-u*(r*ae-o*q)+U*(r*g-o*v)),e[7]=t*(v*F-g*L)-u*(r*F-o*L)+E*(r*g-o*v),e[8]=u*(w*ae-F*j)-E*(p*ae-g*j)+U*(p*F-g*w),e[9]=-(t*(w*ae-F*j)-E*(i*ae-o*j)+U*(i*F-o*w)),e[10]=t*(p*ae-g*j)-u*(i*ae-o*j)+U*(i*g-o*p),e[11]=-(t*(p*F-g*w)-u*(i*F-o*w)+E*(i*g-o*p)),e[12]=-(u*(w*q-L*j)-E*(p*q-v*j)+U*(p*L-v*w)),e[13]=t*(w*q-L*j)-E*(i*q-r*j)+U*(i*L-r*w),e[14]=-(t*(p*q-v*j)-u*(i*q-r*j)+U*(i*v-r*p)),e[15]=t*(p*L-v*w)-u*(i*L-r*w)+E*(i*v-r*p),e}function Ca(e){var a=e[0],t=e[1],i=e[2],r=e[3],o=e[4],u=e[5],p=e[6],v=e[7],g=e[8],E=e[9],w=e[10],L=e[11],F=e[12],U=e[13],j=e[14],q=e[15],ae=a*u-t*o,pe=a*p-i*o,Fe=a*v-r*o,Qe=t*p-i*u,yt=t*v-r*u,vt=i*v-r*p,Bt=g*U-E*F,Qt=g*j-w*F,Ir=g*q-L*F,Or=E*j-w*U,Tr=E*q-L*U,on=w*q-L*j;return ae*on-pe*Tr+Fe*Or+Qe*Ir-yt*Qt+vt*Bt}function ki(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3],p=a[4],v=a[5],g=a[6],E=a[7],w=a[8],L=a[9],F=a[10],U=a[11],j=a[12],q=a[13],ae=a[14],pe=a[15],Fe=t[0],Qe=t[1],yt=t[2],vt=t[3];return e[0]=Fe*i+Qe*p+yt*w+vt*j,e[1]=Fe*r+Qe*v+yt*L+vt*q,e[2]=Fe*o+Qe*g+yt*F+vt*ae,e[3]=Fe*u+Qe*E+yt*U+vt*pe,Fe=t[4],Qe=t[5],yt=t[6],vt=t[7],e[4]=Fe*i+Qe*p+yt*w+vt*j,e[5]=Fe*r+Qe*v+yt*L+vt*q,e[6]=Fe*o+Qe*g+yt*F+vt*ae,e[7]=Fe*u+Qe*E+yt*U+vt*pe,Fe=t[8],Qe=t[9],yt=t[10],vt=t[11],e[8]=Fe*i+Qe*p+yt*w+vt*j,e[9]=Fe*r+Qe*v+yt*L+vt*q,e[10]=Fe*o+Qe*g+yt*F+vt*ae,e[11]=Fe*u+Qe*E+yt*U+vt*pe,Fe=t[12],Qe=t[13],yt=t[14],vt=t[15],e[12]=Fe*i+Qe*p+yt*w+vt*j,e[13]=Fe*r+Qe*v+yt*L+vt*q,e[14]=Fe*o+Qe*g+yt*F+vt*ae,e[15]=Fe*u+Qe*E+yt*U+vt*pe,e}function hi(e,a,t){var i=t[0],r=t[1],o=t[2],u,p,v,g,E,w,L,F,U,j,q,ae;return a===e?(e[12]=a[0]*i+a[4]*r+a[8]*o+a[12],e[13]=a[1]*i+a[5]*r+a[9]*o+a[13],e[14]=a[2]*i+a[6]*r+a[10]*o+a[14],e[15]=a[3]*i+a[7]*r+a[11]*o+a[15]):(u=a[0],p=a[1],v=a[2],g=a[3],E=a[4],w=a[5],L=a[6],F=a[7],U=a[8],j=a[9],q=a[10],ae=a[11],e[0]=u,e[1]=p,e[2]=v,e[3]=g,e[4]=E,e[5]=w,e[6]=L,e[7]=F,e[8]=U,e[9]=j,e[10]=q,e[11]=ae,e[12]=u*i+E*r+U*o+a[12],e[13]=p*i+w*r+j*o+a[13],e[14]=v*i+L*r+q*o+a[14],e[15]=g*i+F*r+ae*o+a[15]),e}function ga(e,a,t){var i=t[0],r=t[1],o=t[2];return e[0]=a[0]*i,e[1]=a[1]*i,e[2]=a[2]*i,e[3]=a[3]*i,e[4]=a[4]*r,e[5]=a[5]*r,e[6]=a[6]*r,e[7]=a[7]*r,e[8]=a[8]*o,e[9]=a[9]*o,e[10]=a[10]*o,e[11]=a[11]*o,e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function da(e,a,t,i){var r=i[0],o=i[1],u=i[2],p=Math.hypot(r,o,u),v,g,E,w,L,F,U,j,q,ae,pe,Fe,Qe,yt,vt,Bt,Qt,Ir,Or,Tr,on,kn,si,Xa;return p<kt.Ib?null:(p=1/p,r*=p,o*=p,u*=p,v=Math.sin(t),g=Math.cos(t),E=1-g,w=a[0],L=a[1],F=a[2],U=a[3],j=a[4],q=a[5],ae=a[6],pe=a[7],Fe=a[8],Qe=a[9],yt=a[10],vt=a[11],Bt=r*r*E+g,Qt=o*r*E+u*v,Ir=u*r*E-o*v,Or=r*o*E-u*v,Tr=o*o*E+g,on=u*o*E+r*v,kn=r*u*E+o*v,si=o*u*E-r*v,Xa=u*u*E+g,e[0]=w*Bt+j*Qt+Fe*Ir,e[1]=L*Bt+q*Qt+Qe*Ir,e[2]=F*Bt+ae*Qt+yt*Ir,e[3]=U*Bt+pe*Qt+vt*Ir,e[4]=w*Or+j*Tr+Fe*on,e[5]=L*Or+q*Tr+Qe*on,e[6]=F*Or+ae*Tr+yt*on,e[7]=U*Or+pe*Tr+vt*on,e[8]=w*kn+j*si+Fe*Xa,e[9]=L*kn+q*si+Qe*Xa,e[10]=F*kn+ae*si+yt*Xa,e[11]=U*kn+pe*si+vt*Xa,a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e)}function Da(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[4],u=a[5],p=a[6],v=a[7],g=a[8],E=a[9],w=a[10],L=a[11];return a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[4]=o*r+g*i,e[5]=u*r+E*i,e[6]=p*r+w*i,e[7]=v*r+L*i,e[8]=g*r-o*i,e[9]=E*r-u*i,e[10]=w*r-p*i,e[11]=L*r-v*i,e}function Mi(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],p=a[2],v=a[3],g=a[8],E=a[9],w=a[10],L=a[11];return a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r-g*i,e[1]=u*r-E*i,e[2]=p*r-w*i,e[3]=v*r-L*i,e[8]=o*i+g*r,e[9]=u*i+E*r,e[10]=p*i+w*r,e[11]=v*i+L*r,e}function Ha(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],p=a[2],v=a[3],g=a[4],E=a[5],w=a[6],L=a[7];return a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r+g*i,e[1]=u*r+E*i,e[2]=p*r+w*i,e[3]=v*r+L*i,e[4]=g*r-o*i,e[5]=E*r-u*i,e[6]=w*r-p*i,e[7]=L*r-v*i,e}function Yo(e,a){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e}function ns(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ds(e,a,t){var i=t[0],r=t[1],o=t[2],u=Math.hypot(i,r,o),p,v,g;return u<kt.Ib?null:(u=1/u,i*=u,r*=u,o*=u,p=Math.sin(a),v=Math.cos(a),g=1-v,e[0]=i*i*g+v,e[1]=r*i*g+o*p,e[2]=o*i*g-r*p,e[3]=0,e[4]=i*r*g-o*p,e[5]=r*r*g+v,e[6]=o*r*g+i*p,e[7]=0,e[8]=i*o*g+r*p,e[9]=r*o*g-i*p,e[10]=o*o*g+v,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Jo(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Es(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=i,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hu(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=i,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function is(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3],p=i+i,v=r+r,g=o+o,E=i*p,w=i*v,L=i*g,F=r*v,U=r*g,j=o*g,q=u*p,ae=u*v,pe=u*g;return e[0]=1-(F+j),e[1]=w+pe,e[2]=L-ae,e[3]=0,e[4]=w-pe,e[5]=1-(E+j),e[6]=U+q,e[7]=0,e[8]=L+ae,e[9]=U-q,e[10]=1-(E+F),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Uu(e,a){var t=new kt.WT(3),i=-a[0],r=-a[1],o=-a[2],u=a[3],p=a[4],v=a[5],g=a[6],E=a[7],w=i*i+r*r+o*o+u*u;return w>0?(t[0]=(p*u+E*i+v*o-g*r)*2/w,t[1]=(v*u+E*r+g*i-p*o)*2/w,t[2]=(g*u+E*o+p*r-v*i)*2/w):(t[0]=(p*u+E*i+v*o-g*r)*2,t[1]=(v*u+E*r+g*i-p*o)*2,t[2]=(g*u+E*o+p*r-v*i)*2),is(e,a,t),e}function bu(e,a){return e[0]=a[12],e[1]=a[13],e[2]=a[14],e}function Pu(e,a){var t=a[0],i=a[1],r=a[2],o=a[4],u=a[5],p=a[6],v=a[8],g=a[9],E=a[10];return e[0]=Math.hypot(t,i,r),e[1]=Math.hypot(o,u,p),e[2]=Math.hypot(v,g,E),e}function Is(e,a){var t=new kt.WT(3);Pu(t,a);var i=1/t[0],r=1/t[1],o=1/t[2],u=a[0]*i,p=a[1]*r,v=a[2]*o,g=a[4]*i,E=a[5]*r,w=a[6]*o,L=a[8]*i,F=a[9]*r,U=a[10]*o,j=u+E+U,q=0;return j>0?(q=Math.sqrt(j+1)*2,e[3]=.25*q,e[0]=(w-F)/q,e[1]=(L-v)/q,e[2]=(p-g)/q):u>E&&u>U?(q=Math.sqrt(1+u-E-U)*2,e[3]=(w-F)/q,e[0]=.25*q,e[1]=(p+g)/q,e[2]=(L+v)/q):E>U?(q=Math.sqrt(1+E-u-U)*2,e[3]=(L-v)/q,e[0]=(p+g)/q,e[1]=.25*q,e[2]=(w+F)/q):(q=Math.sqrt(1+U-u-E)*2,e[3]=(p-g)/q,e[0]=(L+v)/q,e[1]=(w+F)/q,e[2]=.25*q),e}function pu(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=a[3],v=r+r,g=o+o,E=u+u,w=r*v,L=r*g,F=r*E,U=o*g,j=o*E,q=u*E,ae=p*v,pe=p*g,Fe=p*E,Qe=i[0],yt=i[1],vt=i[2];return e[0]=(1-(U+q))*Qe,e[1]=(L+Fe)*Qe,e[2]=(F-pe)*Qe,e[3]=0,e[4]=(L-Fe)*yt,e[5]=(1-(w+q))*yt,e[6]=(j+ae)*yt,e[7]=0,e[8]=(F+pe)*vt,e[9]=(j-ae)*vt,e[10]=(1-(w+U))*vt,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ba(e,a,t,i,r){var o=a[0],u=a[1],p=a[2],v=a[3],g=o+o,E=u+u,w=p+p,L=o*g,F=o*E,U=o*w,j=u*E,q=u*w,ae=p*w,pe=v*g,Fe=v*E,Qe=v*w,yt=i[0],vt=i[1],Bt=i[2],Qt=r[0],Ir=r[1],Or=r[2],Tr=(1-(j+ae))*yt,on=(F+Qe)*yt,kn=(U-Fe)*yt,si=(F-Qe)*vt,Xa=(1-(L+ae))*vt,bo=(q+pe)*vt,Ss=(U+Fe)*Bt,ru=(q-pe)*Bt,Xu=(1-(L+j))*Bt;return e[0]=Tr,e[1]=on,e[2]=kn,e[3]=0,e[4]=si,e[5]=Xa,e[6]=bo,e[7]=0,e[8]=Ss,e[9]=ru,e[10]=Xu,e[11]=0,e[12]=t[0]+Qt-(Tr*Qt+si*Ir+Ss*Or),e[13]=t[1]+Ir-(on*Qt+Xa*Ir+ru*Or),e[14]=t[2]+Or-(kn*Qt+bo*Ir+Xu*Or),e[15]=1,e}function Mo(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=t+t,p=i+i,v=r+r,g=t*u,E=i*u,w=i*p,L=r*u,F=r*p,U=r*v,j=o*u,q=o*p,ae=o*v;return e[0]=1-w-U,e[1]=E+ae,e[2]=L-q,e[3]=0,e[4]=E-ae,e[5]=1-g-U,e[6]=F+j,e[7]=0,e[8]=L+q,e[9]=F-j,e[10]=1-g-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xo(e,a,t,i,r,o,u){var p=1/(t-a),v=1/(r-i),g=1/(o-u);return e[0]=o*2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*v,e[6]=0,e[7]=0,e[8]=(t+a)*p,e[9]=(r+i)*v,e[10]=(u+o)*g,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*g,e[15]=0,e}function ja(e,a,t,i,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(i-r),e[10]=(r+i)*u,e[14]=2*r*i*u):(e[10]=-1,e[14]=-2*i),e}var Zu=ja;function Vu(e,a,t,i,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(i-r),e[10]=r*u,e[14]=r*i*u):(e[10]=-1,e[14]=-i),e}function zo(e,a,t,i){var r=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),u=Math.tan(a.leftDegrees*Math.PI/180),p=Math.tan(a.rightDegrees*Math.PI/180),v=2/(u+p),g=2/(r+o);return e[0]=v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=-((u-p)*v*.5),e[9]=(r-o)*g*.5,e[10]=i/(t-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*t/(t-i),e[15]=0,e}function as(e,a,t,i,r,o,u){var p=1/(a-t),v=1/(i-r),g=1/(o-u);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*g,e[11]=0,e[12]=(a+t)*p,e[13]=(r+i)*v,e[14]=(u+o)*g,e[15]=1,e}var ks=as;function ao(e,a,t,i,r,o,u){var p=1/(a-t),v=1/(i-r),g=1/(o-u);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=g,e[11]=0,e[12]=(a+t)*p,e[13]=(r+i)*v,e[14]=o*g,e[15]=1,e}function _l(e,a,t,i){var r,o,u,p,v,g,E,w,L,F,U=a[0],j=a[1],q=a[2],ae=i[0],pe=i[1],Fe=i[2],Qe=t[0],yt=t[1],vt=t[2];return Math.abs(U-Qe)<kt.Ib&&Math.abs(j-yt)<kt.Ib&&Math.abs(q-vt)<kt.Ib?wi(e):(E=U-Qe,w=j-yt,L=q-vt,F=1/Math.hypot(E,w,L),E*=F,w*=F,L*=F,r=pe*L-Fe*w,o=Fe*E-ae*L,u=ae*w-pe*E,F=Math.hypot(r,o,u),F?(F=1/F,r*=F,o*=F,u*=F):(r=0,o=0,u=0),p=w*u-L*o,v=L*r-E*u,g=E*o-w*r,F=Math.hypot(p,v,g),F?(F=1/F,p*=F,v*=F,g*=F):(p=0,v=0,g=0),e[0]=r,e[1]=p,e[2]=E,e[3]=0,e[4]=o,e[5]=v,e[6]=w,e[7]=0,e[8]=u,e[9]=g,e[10]=L,e[11]=0,e[12]=-(r*U+o*j+u*q),e[13]=-(p*U+v*j+g*q),e[14]=-(E*U+w*j+L*q),e[15]=1,e)}function Yl(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=i[0],v=i[1],g=i[2],E=r-t[0],w=o-t[1],L=u-t[2],F=E*E+w*w+L*L;F>0&&(F=1/Math.sqrt(F),E*=F,w*=F,L*=F);var U=v*L-g*w,j=g*E-p*L,q=p*w-v*E;return F=U*U+j*j+q*q,F>0&&(F=1/Math.sqrt(F),U*=F,j*=F,q*=F),e[0]=U,e[1]=j,e[2]=q,e[3]=0,e[4]=w*q-L*j,e[5]=L*U-E*q,e[6]=E*j-w*U,e[7]=0,e[8]=E,e[9]=w,e[10]=L,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function Ic(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ps(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function th(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e[4]=a[4]+t[4],e[5]=a[5]+t[5],e[6]=a[6]+t[6],e[7]=a[7]+t[7],e[8]=a[8]+t[8],e[9]=a[9]+t[9],e[10]=a[10]+t[10],e[11]=a[11]+t[11],e[12]=a[12]+t[12],e[13]=a[13]+t[13],e[14]=a[14]+t[14],e[15]=a[15]+t[15],e}function kc(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e[4]=a[4]-t[4],e[5]=a[5]-t[5],e[6]=a[6]-t[6],e[7]=a[7]-t[7],e[8]=a[8]-t[8],e[9]=a[9]-t[9],e[10]=a[10]-t[10],e[11]=a[11]-t[11],e[12]=a[12]-t[12],e[13]=a[13]-t[13],e[14]=a[14]-t[14],e[15]=a[15]-t[15],e}function td(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e[4]=a[4]*t,e[5]=a[5]*t,e[6]=a[6]*t,e[7]=a[7]*t,e[8]=a[8]*t,e[9]=a[9]*t,e[10]=a[10]*t,e[11]=a[11]*t,e[12]=a[12]*t,e[13]=a[13]*t,e[14]=a[14]*t,e[15]=a[15]*t,e}function kp(e,a,t,i){return e[0]=a[0]+t[0]*i,e[1]=a[1]+t[1]*i,e[2]=a[2]+t[2]*i,e[3]=a[3]+t[3]*i,e[4]=a[4]+t[4]*i,e[5]=a[5]+t[5]*i,e[6]=a[6]+t[6]*i,e[7]=a[7]+t[7]*i,e[8]=a[8]+t[8]*i,e[9]=a[9]+t[9]*i,e[10]=a[10]+t[10]*i,e[11]=a[11]+t[11]*i,e[12]=a[12]+t[12]*i,e[13]=a[13]+t[13]*i,e[14]=a[14]+t[14]*i,e[15]=a[15]+t[15]*i,e}function rd(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]}function lc(e,a){var t=e[0],i=e[1],r=e[2],o=e[3],u=e[4],p=e[5],v=e[6],g=e[7],E=e[8],w=e[9],L=e[10],F=e[11],U=e[12],j=e[13],q=e[14],ae=e[15],pe=a[0],Fe=a[1],Qe=a[2],yt=a[3],vt=a[4],Bt=a[5],Qt=a[6],Ir=a[7],Or=a[8],Tr=a[9],on=a[10],kn=a[11],si=a[12],Xa=a[13],bo=a[14],Ss=a[15];return Math.abs(t-pe)<=kt.Ib*Math.max(1,Math.abs(t),Math.abs(pe))&&Math.abs(i-Fe)<=kt.Ib*Math.max(1,Math.abs(i),Math.abs(Fe))&&Math.abs(r-Qe)<=kt.Ib*Math.max(1,Math.abs(r),Math.abs(Qe))&&Math.abs(o-yt)<=kt.Ib*Math.max(1,Math.abs(o),Math.abs(yt))&&Math.abs(u-vt)<=kt.Ib*Math.max(1,Math.abs(u),Math.abs(vt))&&Math.abs(p-Bt)<=kt.Ib*Math.max(1,Math.abs(p),Math.abs(Bt))&&Math.abs(v-Qt)<=kt.Ib*Math.max(1,Math.abs(v),Math.abs(Qt))&&Math.abs(g-Ir)<=kt.Ib*Math.max(1,Math.abs(g),Math.abs(Ir))&&Math.abs(E-Or)<=kt.Ib*Math.max(1,Math.abs(E),Math.abs(Or))&&Math.abs(w-Tr)<=kt.Ib*Math.max(1,Math.abs(w),Math.abs(Tr))&&Math.abs(L-on)<=kt.Ib*Math.max(1,Math.abs(L),Math.abs(on))&&Math.abs(F-kn)<=kt.Ib*Math.max(1,Math.abs(F),Math.abs(kn))&&Math.abs(U-si)<=kt.Ib*Math.max(1,Math.abs(U),Math.abs(si))&&Math.abs(j-Xa)<=kt.Ib*Math.max(1,Math.abs(j),Math.abs(Xa))&&Math.abs(q-bo)<=kt.Ib*Math.max(1,Math.abs(q),Math.abs(bo))&&Math.abs(ae-Ss)<=kt.Ib*Math.max(1,Math.abs(ae),Math.abs(Ss))}var Pp=ki,nd=kc,Lf,Rp,Lp=(Lf=(0,xn.b2)(),Lf(Rp=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=lr(),Ci(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),i=(0,Pr.Z)(t,2),r=i[0],o=i[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,i){var r=Yo(lr(),[t,i,0]);this.jitteredProjectionMatrix=ki(lr(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ki(lr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Rp),Td,Of;function Md(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=rh(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function rh(e,a){if(!!e){if(typeof e=="string")return nh(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nh(e,a)}}function nh(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Mh=(Td=(0,xn.b2)(),Td(Of=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"controls",[]),(0,ye.Z)(this,"unAddControls",[])}return(0,Tt.Z)(e,[{key:"init",value:function(t,i){this.container=t.container,this.scene=i,this.mapsService=i.get(hr.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,i){var r=i.get(hr.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(i){return i.controlOption.name===t})}},{key:"removeControl",value:function(t){var i=this.controls.indexOf(t);return i>-1&&this.controls.splice(i,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(i){i.addTo(t.scene),t.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Md(this.controls),i;try{for(t.s();!(i=t.n()).done;){var r=i.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},i="l7-",r=this.controlContainer=Qa("div",i+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=u.map(function(v){return i+v}).join(" ");t[u.join("")]=Qa("div",p,r)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&vf(this.controlCorners[t]);this.controlContainer&&vf(this.controlContainer)}}]),e}())||Of),id,ad,Op=(id=(0,xn.b2)(),id(ad=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"markers",[]),(0,ye.Z)(this,"markerLayers",[]),(0,ye.Z)(this,"unAddMarkers",[]),(0,ye.Z)(this,"unAddMarkerLayers",[])}return(0,Tt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var i=this.markerLayers.indexOf(t);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(i){i.addTo(t.scene),t.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(i){t.markerLayers.push(i),i.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var i=this.markers.indexOf(t);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(hr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||ad),Fp,Dp,od=(Fp=(0,xn.b2)(),Fp(Dp=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(hr.IMapService)}}]),e}())||Dp),Bp={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Np=Bp,zp,Ih,sd={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ih={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ud=(zp=(0,xn.b2)(),zp(Ih=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"sceneConfigCache",{}),(0,ye.Z)(this,"layerConfigCache",{})}return(0,Tt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Np[t]}},{key:"setSceneConfig",value:function(t,i){this.sceneConfigCache[t]=(0,Z.Z)((0,Z.Z)({},sd),i)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,i,r){this.layerConfigCache[i]=(0,Z.Z)({},(0,gr.merge)({},this.sceneConfigCache[t],ih,r))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ih);function va(e,a,t,i){!t||Object.defineProperty(e,a,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(i):void 0})}function ca(e,a,t,i,r){var o={};return Object.keys(i).forEach(function(u){o[u]=i[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,p){return p(e,a,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,a,o),o=null),o}function ap(){var e=new kt.WT(4);return kt.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function w0(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function T0(e,a,t,i){var r=new kt.WT(4);return r[0]=e,r[1]=a,r[2]=t,r[3]=i,r}function Id(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function n0(e,a,t,i,r){return e[0]=a,e[1]=t,e[2]=i,e[3]=r,e}function M0(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e}function Vv(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e}function i0(e,a,t){return e[0]=a[0]*t[0],e[1]=a[1]*t[1],e[2]=a[2]*t[2],e[3]=a[3]*t[3],e}function Ws(e,a,t){return e[0]=a[0]/t[0],e[1]=a[1]/t[1],e[2]=a[2]/t[2],e[3]=a[3]/t[3],e}function ah(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e[3]=Math.ceil(a[3]),e}function Lm(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e[3]=Math.floor(a[3]),e}function op(e,a,t){return e[0]=Math.min(a[0],t[0]),e[1]=Math.min(a[1],t[1]),e[2]=Math.min(a[2],t[2]),e[3]=Math.min(a[3],t[3]),e}function Up(e,a,t){return e[0]=Math.max(a[0],t[0]),e[1]=Math.max(a[1],t[1]),e[2]=Math.max(a[2],t[2]),e[3]=Math.max(a[3],t[3]),e}function kd(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e[3]=Math.round(a[3]),e}function a0(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e}function kh(e,a,t,i){return e[0]=a[0]+t[0]*i,e[1]=a[1]+t[1]*i,e[2]=a[2]+t[2]*i,e[3]=a[3]+t[3]*i,e}function I0(e,a){var t=a[0]-e[0],i=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return Math.hypot(t,i,r,o)}function o0(e,a){var t=a[0]-e[0],i=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return t*t+i*i+r*r+o*o}function k0(e){var a=e[0],t=e[1],i=e[2],r=e[3];return Math.hypot(a,t,i,r)}function P0(e){var a=e[0],t=e[1],i=e[2],r=e[3];return a*a+t*t+i*i+r*r}function lv(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e[3]=-a[3],e}function Pd(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e[3]=1/a[3],e}function ld(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=t*t+i*i+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=i*u,e[2]=r*u,e[3]=o*u,e}function R0(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3]}function ql(e,a,t,i){var r=t[0]*i[1]-t[1]*i[0],o=t[0]*i[2]-t[2]*i[0],u=t[0]*i[3]-t[3]*i[0],p=t[1]*i[2]-t[2]*i[1],v=t[1]*i[3]-t[3]*i[1],g=t[2]*i[3]-t[3]*i[2],E=a[0],w=a[1],L=a[2],F=a[3];return e[0]=w*g-L*v+F*p,e[1]=-(E*g)+L*u-F*o,e[2]=E*v-w*u+F*r,e[3]=-(E*p)+w*o-L*r,e}function cv(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=a[3];return e[0]=r+i*(t[0]-r),e[1]=o+i*(t[1]-o),e[2]=u+i*(t[2]-u),e[3]=p+i*(t[3]-p),e}function jv(e,a){a=a||1;var t,i,r,o,u,p;do t=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,u=t*t+i*i;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,p=r*r+o*o;while(p>=1);var v=Math.sqrt((1-u)/p);return e[0]=a*t,e[1]=a*i,e[2]=a*r*v,e[3]=a*o*v,e}function s0(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3];return e[0]=t[0]*i+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*i+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*i+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*i+t[7]*r+t[11]*o+t[15]*u,e}function Pc(e,a,t){var i=a[0],r=a[1],o=a[2],u=t[0],p=t[1],v=t[2],g=t[3],E=g*i+p*o-v*r,w=g*r+v*i-u*o,L=g*o+u*r-p*i,F=-u*i-p*r-v*o;return e[0]=E*g+F*-u+w*-v-L*-p,e[1]=w*g+F*-p+L*-u-E*-v,e[2]=L*g+F*-v+E*-p-w*-u,e[3]=a[3],e}function Rd(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Rc(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ph(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function Gv(e,a){var t=e[0],i=e[1],r=e[2],o=e[3],u=a[0],p=a[1],v=a[2],g=a[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(i-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(o-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))}var fv=null,sp=null,Ld=null,Od=null,Fd=null,Dd=null,Hv=null,Wv=function(){var e=ap();return function(a,t,i,r,o,u){var p,v;for(t||(t=4),i||(i=0),r?v=Math.min(r*t+i,a.length):v=a.length,p=i;p<v;p+=t)e[0]=a[p],e[1]=a[p+1],e[2]=a[p+2],e[3]=a[p+3],o(e,e,u),a[p]=e[0],a[p+1]=e[1],a[p+2]=e[2],a[p+3]=e[3];return a}}(),cd=Math.PI/180,L0=512,u0=4003e4;function Lc(e){var a=e.latitude,t=a===void 0?0:a,i=e.zoom,r=i===void 0?0:i,o=e.scale,u=e.highPrecision,p=u===void 0?!1:u,v=e.flipY,g=v===void 0?!1:v;o=o!==void 0?o:Math.pow(2,r);var E={},w=L0*o,L=Math.cos(t*cd),F=w/360,U=F/L,j=w/u0/L;if(E.pixelsPerMeter=[j,-j,j],E.metersPerPixel=[1/j,-1/j,1/j],E.pixelsPerDegree=[F,-U,j],E.degreesPerPixel=[1/F,-1/U,1/j],p){var q=cd*Math.tan(t*cd)/L,ae=F*q/2,pe=w/u0*q,Fe=pe/U*j;E.pixelsPerDegree2=[0,-ae,pe],E.pixelsPerMeter2=[Fe,0,Fe],g&&(E.pixelsPerDegree2[1]=-E.pixelsPerDegree2[1],E.pixelsPerMeter2[1]=-E.pixelsPerMeter2[1])}return g&&(E.pixelsPerMeter[1]=-E.pixelsPerMeter[1],E.metersPerPixel[1]=-E.metersPerPixel[1],E.pixelsPerDegree[1]=-E.pixelsPerDegree[1],E.degreesPerPixel[1]=-E.degreesPerPixel[1]),E}var Pl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Pl||(Pl={}));var up={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Bd,fd,O0,Nd,zd,l0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Ud=(Bd=(0,xn.b2)(),fd=(0,xn.f3)(hr.ICameraService),Bd(O0=(Nd=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"needRefresh",!0),va(this,"cameraService",zd,this)}return(0,Tt.Z)(e,[{key:"refresh",value:function(t){var i=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=Lc({latitude:o[1],zoom:i}),p=u.pixelsPerMeter,v=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Pl.LNGLAT||this.coordinateSystem===Pl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Pl.LNGLAT_OFFSET?this.calculateLnglatOffset(o,i):this.coordinateSystem===Pl.P20_OFFSET&&this.calculateLnglatOffset(o,i,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,i,r,o){var u=Lc({latitude:t[1],zoom:i,scale:r,flipY:o,highPrecision:!0}),p=u.pixelsPerMeter,v=u.pixelsPerDegree,g=u.pixelsPerDegree2,E=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),L=ki([],w,E),F=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,i));this.viewportCenterProjection=s0([],[F[0],F[1],0,1],L),E=this.cameraService.getViewMatrixUncentered()||E,L=ki([],w,E),L=ki([],L,l0),this.cameraService.setViewProjectionMatrix(L),this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=g}}]),e}(),zd=ca(Nd.prototype,"cameraService",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd))||O0),c0=fe(20396),Ff=fe.n(c0),il;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(il||(il={}));var lp,F0,Rh,Zp,hv;function Xv(e){var a=Yv();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Yv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qv={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},$v=(lp=(0,xn.b2)(),F0=(0,xn.f3)(hr.IMapService),lp(Rh=(Zp=function(e){(0,an.Z)(t,e);var a=Xv(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"indragging",!1),va((0,Gt.Z)(i),"mapService",hv,(0,Gt.Z)(i)),(0,ye.Z)((0,Gt.Z)(i),"lastClickTime",0),(0,ye.Z)((0,Gt.Z)(i),"lastClickXY",[-1,-1]),(0,ye.Z)((0,Gt.Z)(i),"onDrag",function(p){var v=i.interactionEvent(p);v.type=qv[v.type],v.type==="dragging"?i.indragging=!0:i.indragging=!1,i.emit(il.Drag,v)}),(0,ye.Z)((0,Gt.Z)(i),"onHammer",function(p){p.srcEvent.stopPropagation();var v=i.interactionEvent(p);i.emit(il.Hover,v)}),(0,ye.Z)((0,Gt.Z)(i),"onTouch",function(p){var v=p.touches[0];i.onHover({x:v.pageX,y:v.pageY,type:"touch"})}),(0,ye.Z)((0,Gt.Z)(i),"onHover",function(p){var v=p.clientX,g=p.clientY,E=v,w=g,L=p.type,F=i.mapService.getMapContainer();if(F)if(Bs)E=E-F.left-0,w=w-F.top-0;else{var U=F.getBoundingClientRect(),j=U.top,q=U.left;E=E-q-F.clientLeft,w=w-j-F.clientTop}var ae=i.mapService.containerToLngLat([E,w]);if(L==="click"){if(!Bs&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(E,w,ae);return}if(L==="touch"){i.isDoubleTap(E,w,ae);return}L!=="click"&&L!=="dblclick"&&i.emit(il.Hover,{x:E,y:w,lngLat:ae,type:L,target:p})}),i}return(0,Tt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(il.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(il.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(il.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(il.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Bs)Pa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(Ff()).Manager(r);o.add(new(Ff()).Tap({event:"dblclick",taps:2})),o.add(new(Ff()).Tap({event:"click"})),o.add(new(Ff()).Pan({threshold:0,pointers:0})),o.add(new(Ff()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Bs)Pa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,p,v;u==="touch"?(v=Math.floor(r.pointers[0].clientY),p=Math.floor(r.pointers[0].clientX)):(v=Math.floor(r.srcEvent.y),p=Math.floor(r.srcEvent.x));var g=this.mapService.getMapContainer();if(g){var E=g.getBoundingClientRect(),w=E.top,L=E.left;p-=L,v-=w}var F=this.mapService.containerToLngLat([p,v]);return{x:p,y:v,lngLat:F,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var p=this,v=new Date().getTime(),g="click";v-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),g="dblclick",this.emit(il.Hover,{x:r,y:o,lngLat:u,type:g})):(this.lastClickTime=v,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){g="click",p.emit(il.Hover,{x:r,y:o,lngLat:u,type:g})},400))}}]),t}(Bu()),hv=ca(Zp.prototype,"mapService",[F0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zp))||Rh),Kv=0;function Qv(e){if(Bs)return null;var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Kv++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function of(e){var a,t,i=!0;return e==null||(a=e.target)===null||a===void 0||(t=a.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(i=!1)})}}),i}var X;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(X||(X={}));var cp,hd,Rs,D0,Jv,B0,N0,Lh,em,tm,f0,pv,dv,Om=(cp=(0,xn.b2)(),hd=(0,xn.f3)(hr.IMapService),Rs=(0,xn.f3)(hr.IRendererService),D0=(0,xn.f3)(hr.IGlobalConfigService),Jv=(0,xn.f3)(hr.IInteractionService),B0=(0,xn.f3)(hr.ILayerService),cp(N0=(Lh=function(){function e(){var a=this;(0,Ft.Z)(this,e),(0,ye.Z)(this,"pickedTileLayers",[]),va(this,"mapService",em,this),va(this,"rendererService",tm,this),va(this,"configService",f0,this),va(this,"interactionService",pv,this),va(this,"layerService",dv,this),(0,ye.Z)(this,"width",0),(0,ye.Z)(this,"height",0),(0,ye.Z)(this,"alreadyInPicking",!1),(0,ye.Z)(this,"pickBufferScale",1),(0,ye.Z)(this,"pickedLayers",[]),(0,ye.Z)(this,"pickFromPickingFBO",function(t,i){var r,o=i.x,u=i.y,p=i.lngLat,v=i.type,g=i.target,E=!1,w=a.rendererService,L=w.getViewportSize,F=w.readPixels,U=w.getContainer,j=a.getContainerSize(U()),q=j.width,ae=j.height;q*=Ja,ae*=Ja;var pe=t.getLayerConfig(),Fe=pe.enableHighlight,Qe=pe.enableSelect,yt=o*Ja,vt=u*Ja;if(yt>q-1*Ja||yt<0||vt>ae-1*Ja||vt<0)return!1;var Bt;if(Bt=F({x:Math.floor(yt/a.pickBufferScale),y:Math.floor((ae-(u+1)*Ja)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO}),a.pickedColors=Bt,Bt[0]!==0||Bt[1]!==0||Bt[2]!==0){var Qt=Y(Bt),Ir=t.getSource().getFeatureById(Qt);Qt!==t.getCurrentPickId()&&v==="mousemove"&&(v="mouseenter");var Or={x:o,y:u,type:v,lngLat:p,featureId:Qt,feature:Ir,target:g};Ir&&(E=!0,t.setCurrentPickId(Qt),a.pickedLayers=[t],a.triggerHoverOnLayer(t,Or))}else{var Tr={x:o,y:u,lngLat:p,type:t.getCurrentPickId()!==null&&v==="mousemove"?"mouseout":"un"+v,featureId:null,target:g,feature:null};a.triggerHoverOnLayer(t,(0,Z.Z)((0,Z.Z)({},Tr),{},{type:"unpick"})),a.triggerHoverOnLayer(t,Tr),t.setCurrentPickId(null),a.pickedLayers=[]}if(Fe&&a.highlightPickedFeature(t,Bt),Qe&&v==="click"&&((r=Bt)===null||r===void 0?void 0:r.toString())!==[0,0,0,0].toString()){var on=Y(Bt);t.getCurrentSelectedId()===null||on!==t.getCurrentSelectedId()?(a.selectFeature(t,Bt),t.setCurrentSelectedId(on)):(a.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||a.layerService.getLayers().filter(function(kn){return kn.tileLayer}).map(function(kn){kn.tileLayer.clearPickState()})}return E})}return(0,Tt.Z)(e,[{key:"init",value:function(t){var i=this.rendererService,r=i.createTexture2D,o=i.createFramebuffer,u=i.getViewportSize,p=i.getContainer,v=this.getContainerSize(p()),g=v.width,E=v.height;g*=Ja,E*=Ja,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(g/this.pickBufferScale),height:Math.round(E/this.pickBufferScale),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(il.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r,o,u){var p=this,v,g,E,w;return xi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:v=this.rendererService,g=v.useFramebuffer,E=v.clear,w=v.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){E({framebuffer:p.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var U=p.pickBox(r,o);u(U)});case 3:case"end":return F.stop()}},i,this)}));function t(i,r,o){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,i){var r=this,o=i.map(function(Tr){var on=Tr<0?0:Tr;return Math.floor(on*Ja/r.pickBufferScale)}),u=(0,Pr.Z)(o,4),p=u[0],v=u[1],g=u[2],E=u[3],w=this.rendererService,L=w.getViewportSize,F=w.readPixels,U=w.getContainer,j=this.getContainerSize(U()),q=j.width,ae=j.height;if(q*=Ja,ae*=Ja,p>(q-1)*Ja/this.pickBufferScale||g<0||v>(ae-1)*Ja/this.pickBufferScale||E<0)return[];var pe,Fe=Math.min(q/this.pickBufferScale,g)-p,Qe=Math.min(ae/this.pickBufferScale,E)-v;pe=F({x:p,y:Math.floor(ae/this.pickBufferScale-(E+1)),width:Fe,height:Qe,data:new Uint8Array(Fe*Qe*4),framebuffer:this.pickingFBO});for(var yt=[],vt={},Bt=0;Bt<pe.length/4;Bt=Bt+1){var Qt=pe.slice(Bt*4,Bt*4+4),Ir=Y(Qt);if(Ir!==-1&&!vt[Ir]){var Or=t.getSource().getFeatureById(Ir);yt.push((0,Z.Z)((0,Z.Z)({},Or),{},{pickedFeatureIdx:Ir})),vt[Ir]=!0}}return yt}},{key:"handleCursor",value:function(t,i){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,p=r.cursorEnabled;if(p){var v=this.mapService.version,g=v==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),E=g==null?void 0:g.style.getPropertyValue("cursor");i==="unmousemove"&&E!==""?g==null||g.style.setProperty("cursor",""):i==="mousemove"&&(g==null||g.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Ja,height:t.height/Ja}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r){return xi().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,i=this.getContainerSize(t()),r=i.width,o=i.height;r*=Ja,o*=Ja,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r){var o=this,u,p,v,g,E;return xi().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=u.getContainer,this.resizePickingFBO(),v(this.pickingFBO,function(){var F=o.layerService.getRenderList();F.filter(function(U){return U.needPick(r.type)}).reverse().some(function(U){if(g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedLayers.filter(function(q){return!q.isVector}).map(function(q){o.selectFeature(q,new Uint8Array([0,0,0,0]))}),o.pickedTileLayers.map(function(q){var ae;return(ae=q.tileLayer)===null||ae===void 0?void 0:ae.clearPick(r.type)}),U.tileLayer)return U.tileLayer.pickLayers(r);U.hooks.beforePickingEncode.call(),U.masks.length>0&&U.masks.map(function(q){q.hooks.beforeRenderData.call(),q.hooks.beforeRender.call(),q.render(),q.hooks.afterRender.call()}),U.renderModels(!0),U.hooks.afterPickingEncode.call();var j=o.pickFromPickingFBO(U,r);return o.layerService.pickedLayerId=j?+U.id:-1,j&&!U.getLayerConfig().enablePropagation})});case 3:case"end":return L.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,i){of(i)&&(this.handleCursor(t,i.type),t.emit(i.type,i))}},{key:"highlightPickedFeature",value:function(t,i){var r=(0,Pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeHighlight.call([o,u,p])}},{key:"selectFeature",value:function(t,i){var r=(0,Pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}}]),e}(),em=ca(Lh.prototype,"mapService",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=ca(Lh.prototype,"rendererService",[Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f0=ca(Lh.prototype,"configService",[D0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv=ca(Lh.prototype,"interactionService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dv=ca(Lh.prototype,"layerService",[B0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh))||N0),Fm=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Ft.Z)(this,e),(0,ye.Z)(this,"startTime",0),(0,ye.Z)(this,"oldTime",0),(0,ye.Z)(this,"running",!1),(0,ye.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,Tt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}]),e}(),z0,Dm,Bm,vv,Nm,U0,zm,Um,Zm;function pd(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=rm(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function rm(e,a){if(!!e){if(typeof e=="string")return Vm(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vm(e,a)}}function Vm(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Vg=(z0=(0,xn.b2)(),Dm=(0,xn.f3)(hr.IRendererService),Bm=(0,xn.f3)(hr.IMapService),vv=(0,xn.f3)(hr.IGlobalConfigService),z0(Nm=(U0=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"pickedLayerId",-1),(0,ye.Z)(this,"clock",new Fm),(0,ye.Z)(this,"alreadyInRendering",!1),(0,ye.Z)(this,"layers",[]),(0,ye.Z)(this,"layerList",[]),(0,ye.Z)(this,"sceneInited",!1),(0,ye.Z)(this,"animateInstanceCount",0),(0,ye.Z)(this,"shaderPicking",!0),(0,ye.Z)(this,"enableRender",!0),va(this,"renderService",zm,this),va(this,"mapService",Um,this),va(this,"configService",Zm,this)}return(0,Tt.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(i){return i.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(i){return i.name===t})}},{key:"cleanRemove",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1),i&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,i){if(i){var r=i.layerChildren.indexOf(t);r>-1&&i.layerChildren.splice(r,1)}else{var o=this.layers.indexOf(t);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var a=(0,Ua.Z)(xi().mark(function i(){var r,o,u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){v.next=2;break}return v.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),r=pd(this.layerList),v.prev=5,r.s();case 7:if((o=r.n()).done){v.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(g){g.hooks.beforeRenderData.call(),g.hooks.beforeRender.call(),g.render(),g.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){v.next=17;break}return v.next=15,u.renderMultiPass();case 15:v.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:v.next=7;break;case 21:v.next=26;break;case 23:v.prev=23,v.t0=v.catch(5),r.e(v.t0);case 26:return v.prev=26,r.f(),v.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return v.stop()}},i,this,[[5,23,26,29]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).sort(function(i,r){return i.zIndex-r.zIndex}).forEach(function(i){t.layerList.push(i)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=B(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Pa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Pa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),zm=ca(U0.prototype,"renderService",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=ca(U0.prototype,"mapService",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zm=ca(U0.prototype,"configService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U0))||Nm),Oh=fe(81253),jg=function(){function e(a){var t=this;(0,Ft.Z)(this,e),(0,ye.Z)(this,"featureBufferLayout",[]),(0,ye.Z)(this,"needRescale",!1),(0,ye.Z)(this,"needRemapping",!1),(0,ye.Z)(this,"needRegenerateVertices",!1),(0,ye.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,ye.Z)(this,"defaultCallback",function(i){if(i.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return i.map(function(o,u){var p,v=(p=t.scale)===null||p===void 0?void 0:p.scalers[u].func,g=v(o);return g})}),this.setProps(a)}return(0,Tt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,_e.Z)(t));if(!(0,gr.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Gg=["modelType"],mv=["buffer","update","name"],h0=["buffer","update","name"],jm=["buffer","update","name"],Zd,Gm,Hm,nm,gv,yv;function Hg(e){return new Promise(function(a){return setTimeout(a,e)})}var Z0=(Zd={},(0,ye.Z)(Zd,X.FLOAT,4),(0,ye.Z)(Zd,X.UNSIGNED_BYTE,1),(0,ye.Z)(Zd,X.UNSIGNED_SHORT,2),Zd),p0=(Gm=(0,xn.b2)(),Hm=(0,xn.f3)(hr.IRendererService),Gm(nm=(gv=function(){function e(){(0,Ft.Z)(this,e),va(this,"rendererService",yv,this),(0,ye.Z)(this,"attributes",[]),(0,ye.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Tt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var i=this.getLayerStyleAttribute(t.name||"");return i?i.setProps(t):(i=new jg(t),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(t,i,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,Z.Z)((0,Z.Z)({},i),{},{name:t})));var u=i.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(i){return i.name===t})}},{key:"getLayerAttributeScale",value:function(t){var i,r=this.getLayerStyleAttribute(t),o=r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=this.attributes.find(function(Qe){return Qe.name===t});if(u&&u.descriptor){var p=u.descriptor,v=p.update,g=p.buffer,E=p.size,w=E===void 0?0:E,L=Z0[g.type||X.FLOAT];if(v){var F=this.featureLayout,U=F.elements,j=F.sizePerElement,q=U.slice(r,o);if(!q.length)return;var ae=q[0].offset,pe=ae*w*L,Fe=q.map(function(Qe,yt){for(var vt=Qe.featureIdx,Bt=Qe.vertices,Qt=Qe.normals,Ir=Bt.length/j,Or=[],Tr=0;Tr<Ir;Tr++){var on=Qt?Qt.slice(Tr*3,Tr*3+3):[];Or.push.apply(Or,(0,_e.Z)(v(i[vt],vt,Bt.slice(Tr*j,Tr*j+j),yt,on)))}return Or}).reduce(function(Qe,yt){return Qe.push.apply(Qe,(0,_e.Z)(yt)),Qe},[]);u.vertexAttribute.updateBuffer({data:Fe,offset:pe})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(U){return U.resetDescriptor(),U.descriptor}).filter(function(U){return U}),p=r.modelType,v=(0,Oh.Z)(r,Gg),g=this.rendererService,E=g.createAttribute,w=g.createBuffer,L=g.createElements,F={};return new Promise(function(U,j){ep(p,(0,Z.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:i},v)).then(function(q){q.descriptors.forEach(function(pe,Fe){if(pe){var Qe=pe.buffer,yt=pe.update,vt=pe.name,Bt=(0,Oh.Z)(pe,mv),Qt=E((0,Z.Z)({buffer:w(Qe)},Bt));F[pe.name||""]=Qt,o.attributes[Fe].vertexAttribute=Qt}}),o.featureLayout=q.featureLayout;var ae=L({data:q.indices,type:X.UNSIGNED_INT,count:q.indices.length});o.attributesAndIndices={attributes:F,elements:ae},U(o.attributesAndIndices)}).catch(function(q){console.warn(q),j(q)})})}},{key:"createAttributesAndIndices",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var u=this.attributes.map(function(pe){return pe.resetDescriptor(),pe.descriptor}),p=0,v=[],g=[],E=[],w=3;t.forEach(function(pe,Fe){var Qe=o.triangulation(pe,r),yt=Qe.indices,vt=Qe.vertices,Bt=Qe.normals,Qt=Qe.size,Ir=Qe.indexes;yt.forEach(function(kn){g.push(kn+p)}),w=Qt;var Or=vt.length/Qt;o.featureLayout.sizePerElement=w,o.featureLayout.elements.push({featureIdx:Fe,vertices:vt,normals:Bt,offset:p}),p+=Or;for(var Tr=function(si){var Xa=(Bt==null?void 0:Bt.slice(si*3,si*3+3))||[],bo=vt.slice(si*Qt,si*Qt+Qt),Ss=0;Ir&&Ir[si]!==void 0&&(Ss=Ir[si]),u.forEach(function(ru,Xu){if(ru&&ru.update){var sh;(sh=ru.buffer.data).push.apply(sh,(0,_e.Z)(ru.update(pe,Fe,bo,si,Xa,Ss)))}})},on=0;on<Or;on++)Tr(on)});var L=this.rendererService,F=L.createAttribute,U=L.createBuffer,j=L.createElements,q={};u.forEach(function(pe,Fe){if(pe){var Qe=pe.buffer,yt=pe.update,vt=pe.name,Bt=(0,Oh.Z)(pe,h0),Qt=F((0,Z.Z)({buffer:U(Qe)},Bt));q[pe.name||""]=Qt,o.attributes[Fe].vertexAttribute=Qt}});var ae=j({data:g,type:X.UNSIGNED_INT,count:g.length});return this.attributesAndIndices={attributes:q,elements:ae},this.attributesAndIndices}},{key:"createAttributes",value:function(t,i){var r=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var o=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),u=0,p=[],v=3;t.forEach(function(F,U){var j=r.triangulation(F),q=j.indices,ae=j.vertices,pe=j.normals,Fe=j.size,Qe=j.indexes;q.forEach(function(Qt){p.push(Qt+u)}),v=Fe;var yt=ae.length/Fe;r.featureLayout.sizePerElement=v,r.featureLayout.elements.push({featureIdx:U,vertices:ae,normals:pe,offset:u}),u+=yt;for(var vt=function(Ir){var Or=(pe==null?void 0:pe.slice(Ir*3,Ir*3+3))||[],Tr=ae.slice(Ir*Fe,Ir*Fe+Fe),on=0;Qe&&Qe[Ir]!==void 0&&(on=Qe[Ir]),o.forEach(function(kn,si){if(kn&&kn.update){var Xa;(Xa=kn.buffer.data).push.apply(Xa,(0,_e.Z)(kn.update(F,U,Tr,Ir,Or,on)))}})},Bt=0;Bt<yt;Bt++)vt(Bt)});var g=this.rendererService,E=g.createAttribute,w=g.createBuffer,L={};return o.forEach(function(F,U){if(F){var j=F.buffer,q=F.update,ae=F.name,pe=(0,Oh.Z)(F,jm),Fe=E((0,Z.Z)({buffer:w(j)},pe));L[F.name||""]=Fe,r.attributes[U].vertexAttribute=Fe}}),{attributes:L}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(i){return{buffer:i.buffer,name:i.name,size:i.size}})}}]),e}(),yv=ca(gv.prototype,"rendererService",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv))||nm),Vd=fe(67709),im=fe.n(Vd),am,Wm,_v,Vp,om,Xm,Ym,sm,qm,um,$m,Km,xv,ju,bv,d0,Fh,al,v0,V0,Qm,Ev,j0,Gu,jp,jd,Cv,Gp,Gd,Sv,Jm,eg,tg;function Wg(e){var a=Xg();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Xg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rg=(am=(0,xn.b2)(),Wm=(0,xn.f3)(hr.SceneID),_v=(0,xn.f3)(hr.IIconService),Vp=(0,xn.f3)(hr.IFontService),om=(0,xn.f3)(hr.IControlService),Xm=(0,xn.f3)(hr.IGlobalConfigService),Ym=(0,xn.f3)(hr.IMapService),sm=(0,xn.f3)(hr.ICoordinateSystemService),qm=(0,xn.f3)(hr.IRendererService),um=(0,xn.f3)(hr.ILayerService),$m=(0,xn.f3)(hr.ICameraService),Km=(0,xn.f3)(hr.IInteractionService),xv=(0,xn.f3)(hr.IPickingService),ju=(0,xn.f3)(hr.IShaderModuleService),bv=(0,xn.f3)(hr.IMarkerService),d0=(0,xn.f3)(hr.IPopupService),am(Fh=(al=function(e){(0,an.Z)(t,e);var a=Wg(t);function t(){var i;return(0,Ft.Z)(this,t),i=a.call(this),(0,ye.Z)((0,Gt.Z)(i),"destroyed",!1),(0,ye.Z)((0,Gt.Z)(i),"loaded",!1),(0,ye.Z)((0,Gt.Z)(i),"loadFont",!1),(0,ye.Z)((0,Gt.Z)(i),"fontFamily",""),va((0,Gt.Z)(i),"id",v0,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"iconService",V0,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"fontService",Qm,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"controlService",Ev,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"configService",j0,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"map",Gu,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"coordinateSystemService",jp,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"rendererService",jd,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"layerService",Cv,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"cameraService",Gp,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"interactionService",Gd,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"pickingService",Sv,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"shaderModuleService",Jm,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"markerService",eg,(0,Gt.Z)(i)),va((0,Gt.Z)(i),"popupService",tg,(0,Gt.Z)(i)),(0,ye.Z)((0,Gt.Z)(i),"inited",!1),(0,ye.Z)((0,Gt.Z)(i),"rendering",!1),(0,ye.Z)((0,Gt.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),jo(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,ye.Z)((0,Gt.Z)(i),"handleMapCameraChanged",function(r){i.cameraService.update(r),i.render()}),i.hooks={init:new js},i}return(0,Tt.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ua.Z)(xi().mark(function u(){return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.version!=="GAODE2.x"?o.map.init():g()});case 2:if(!(o.map.version==="GAODE2.x"&&o.map.initViewPort)){v.next=6;break}return v.next=5,o.map.init();case 5:o.map.initViewPort();case 6:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(il.Drag,o.addSceneEvent.bind(o));case 13:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Ua.Z)(xi().mark(function u(){var p,v;return xi().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=Qv(o.configService.getSceneConfig(o.id).id||""),o.$container=p,!p){E.next=11;break}return o.canvas=Qa("canvas","",p),o.setCanvas(),E.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id));case 7:im()(o.$container,o.handleWindowResized),Pa.matchMedia&&((v=Pa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),E.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:o.pickingService.init(o.id);case 13:case"end":return E.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ua.Z)(xi().mark(function u(){return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(il.Drag,o.addSceneEvent.bind(o));case 5:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Ua.Z)(xi().mark(function u(){var p;return xi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(p=r.canvas,o.$container=p||null,!o.$container){g.next=7;break}return g.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id));case 5:g.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return g.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var i=(0,Ua.Z)(xi().mark(function o(){return xi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.rendering||this.destroyed)){p.next=2;break}return p.abrupt("return");case 2:if(this.rendering=!0,this.inited){p.next=23;break}return p.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){p.next=18;break}return p.prev=8,p.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:p.next=18;break;case 13:p.prev=13,p.t0=p.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return p.stop()}},o,this,[[8,13]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontFamily=r;var u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(u),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(r){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var p=r==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return p}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=Qa("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var v;(v=r.$container)===null||v===void 0||v.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Vd.unbind)(this.$container,this.handleWindowResized),Pa.matchMedia){var p;(p=Pa.matchMedia("screen and (min-resolution: 2dppx)"))===null||p===void 0||p.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var r,o,u=Ja,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g&&(g.width=p*u,g.height=v*u),this.rendererService.viewport({x:0,y:0,width:u*p,height:u*v})}},{key:"setCanvas",value:function(){var r,o,u=Ja,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g.width=p*u,g.height=v*u,g.style.width="100%",g.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(ua.EventEmitter),v0=ca(al.prototype,"id",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V0=ca(al.prototype,"iconService",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm=ca(al.prototype,"fontService",[Vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=ca(al.prototype,"controlService",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0=ca(al.prototype,"configService",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=ca(al.prototype,"map",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jp=ca(al.prototype,"coordinateSystemService",[sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=ca(al.prototype,"rendererService",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=ca(al.prototype,"layerService",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=ca(al.prototype,"cameraService",[$m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=ca(al.prototype,"interactionService",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=ca(al.prototype,"pickingService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jm=ca(al.prototype,"shaderModuleService",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eg=ca(al.prototype,"markerService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tg=ca(al.prototype,"popupService",[d0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),al))||Fh);function ng(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var ig=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function lm(e){var a={};return e=e.replace(ig,function(t,i,r){var o=r.split(":"),u=o[0].trim(),p="";switch(o.length>1&&(p=o[1].trim()),i){case"bool":p=p==="true";break;case"float":case"int":p=Number(p);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":p?p=p.replace("[","").replace("]","").split(",").reduce(function(v,g){return v.push(Number(g.trim())),v},[]):p=new Array(ng(i)).fill(0);break;default:}return a[u]=p,"uniform ".concat(i," ").concat(u,`;
`)}),{content:e,uniforms:a}}var _,A,M="#define PI 3.14159265359",O=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,N=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,J=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,ce=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,se=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Oe=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,He=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Ve=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Jt=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,br=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Dr=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,qr=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,On=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,An=/precision\s+(high|low|medium)p\s+float/,zn=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,mn=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ni=(_=(0,xn.b2)(),_(A=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"moduleCache",{}),(0,ye.Z)(this,"rawContentCache",{})}return(0,Tt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:M,fs:M}),this.registerModule("decode",{vs:O,fs:""}),this.registerModule("projection",{vs:He,fs:""}),this.registerModule("project",{vs:Oe,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Ve}),this.registerModule("lighting",{vs:J,fs:""}),this.registerModule("light",{vs:N,fs:""}),this.registerModule("picking",{vs:se,fs:ce}),this.registerModule("styleMapping",{vs:Jt,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:On,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:br,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Dr,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:qr,fs:""})}},{key:"registerModule",value:function(t,i){if(!this.rawContentCache[t]){var r=i.vs,o=i.fs,u=i.uniforms,p=lm(r),v=p.content,g=p.uniforms,E=lm(o),w=E.content,L=E.uniforms;this.rawContentCache[t]={fs:w,uniforms:(0,Z.Z)((0,Z.Z)((0,Z.Z)({},g),L),u),vs:v}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var i=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),p=u.content,v=u.includeList,g=this.processModule(o,[],"fs"),E=g.content,w=g.includeList,L=E,F=(0,gr.uniq)(v.concat(w).concat(t)).reduce(function(U,j){return(0,Z.Z)((0,Z.Z)({},U),i.rawContentCache[j].uniforms)},{});return An.test(E)||(L=zn+E),this.moduleCache[t]={fs:L.trim(),uniforms:F,vs:p.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,i,r){var o=this,u=t.replace(mn,function(p,v){var g=v.split(" "),E=g[0].replace(/"/g,"");if(i.indexOf(E)>-1)return"";var w=o.rawContentCache[E][r];i.push(E);var L=o.processModule(w,i,r),F=L.content;return F});return{content:u,includeList:i}}}]),e}())||A),gi=fe(66213),Wa;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Wa||(Wa={}));var oo,Ya,qa=(oo=(0,xn.b2)(),oo(Ya=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Wa.Normal}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(hr.IRendererService),this.cameraService=t.getContainer().get(hr.ICameraService),this.mapService=t.getContainer().get(hr.IMapService),this.interactionService=t.getContainer().get(hr.IInteractionService),this.layerService=t.getContainer().get(hr.ILayerService),this.shaderModuleService=t.getContainer().get(hr.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||Ya),so,Qr;function fn(e){var a=Zi();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $a=(so=(0,xn.b2)(),so(Qr=function(e){(0,an.Z)(t,e);var a=fn(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){(0,gi.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(qa))||Qr),_a,ol,xl,es,bl;function Cs(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Dh(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Dh(e,a){if(!!e){if(typeof e=="string")return fp(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fp(e,a)}}function fp(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var sl=(_a=(0,xn.b2)(),ol=(0,xn.f3)(hr.IPostProcessor),_a(xl=(es=function(){function e(){(0,Ft.Z)(this,e),(0,ye.Z)(this,"passes",[]),va(this,"postProcessor",bl,this),(0,ye.Z)(this,"width",0),(0,ye.Z)(this,"height",0)}return(0,Tt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,Ua.Z)(xi().mark(function i(){var r,o,u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=Cs(this.passes),v.prev=1,r.s();case 3:if((o=r.n()).done){v.next=9;break}return u=o.value,v.next=7,u.render(this.layer);case 7:v.next=3;break;case 9:v.next=14;break;case 11:v.prev=11,v.t0=v.catch(1),r.e(v.t0);case 14:return v.prev=14,r.f(),v.finish(14);case 17:return v.next=19,this.postProcessor.render(this.layer);case 19:case"end":return v.stop()}},i,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){(this.width!==t||this.height!==i)&&(this.postProcessor.resize(t,i),this.width=t,this.height=i)}},{key:"add",value:function(t,i){t.getType()===Wa.PostProcessing?this.postProcessor.add(t,this.layer,i):(t.init(this.layer,i),this.passes.push(t))}},{key:"insert",value:function(t,i,r){t.init(this.layer,i),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),bl=ca(es.prototype,"postProcessor",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es))||xl),os,Rl;function Hu(e){var a=$l();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function $l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oh=(os=(0,xn.b2)(),os(Rl=function(e){(0,an.Z)(t,e);var a=Hu(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"width",0),(0,ye.Z)((0,Gt.Z)(i),"height",0),(0,ye.Z)((0,Gt.Z)(i),"alreadyInRendering",!1),(0,ye.Z)((0,Gt.Z)(i),"pickFromPickingFBO",function(p){var v=p.x,g=p.y,E=p.lngLat,w=p.type;if(!(!i.layer.isVisible()||!i.layer.needPick(w))){var L=i.rendererService,F=L.getViewportSize,U=L.readPixels,j=L.useFramebuffer,q=F(),ae=q.width,pe=q.height,Fe=i.layer.getLayerConfig(),Qe=Fe.enableHighlight,yt=Fe.enableSelect,vt=v*Ja,Bt=g*Ja;if(!(vt>ae||vt<0||Bt>pe||Bt<0)){var Qt;j(i.pickingFBO,function(){var Ir;if(Qt=U({x:Math.round(vt),y:Math.round(pe-(g+1)*Ja),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Qt[0]!==0||Qt[1]!==0||Qt[2]!==0){var Or=Y(Qt),Tr=i.layer.getSource().getFeatureById(Or),on={x:v,y:g,type:w,lngLat:E,featureId:Or,feature:Tr};Tr&&(i.layer.setCurrentPickId(Or),i.triggerHoverOnLayer(on))}else{var kn={x:v,y:g,lngLat:E,type:i.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer((0,Z.Z)((0,Z.Z)({},kn),{},{type:"unpick"})),i.triggerHoverOnLayer(kn),i.layer.setCurrentPickId(null)}Qe&&i.highlightPickedFeature(Qt),yt&&w==="click"&&((Ir=Qt)===null||Ir===void 0?void 0:Ir.toString())!==[0,0,0,0].toString()&&i.selectFeature(Qt)})}}}),i}return(0,Tt.Z)(t,[{key:"getType",value:function(){return Wa.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){(0,gi.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,p=u.createTexture2D,v=u.createFramebuffer,g=u.getViewportSize,E=g(),w=E.width,L=E.height;this.pickingFBO=v({color:p({width:w,height:L,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(il.Hover,this.pickFromPickingFBO),this.interactionService.on(il.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(il.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=p(),w=E.width,L=E.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==L)&&(this.pickingFBO.resize({width:w,height:L}),this.width=w,this.height=L),v(this.pickingFBO,function(){g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(F),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,Pr.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeHighlight.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,Pr.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeSelect.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=te(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=te(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(qa))||Rl),Hp,cm,G0,H0,jy,F2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hd=(Hp=(0,xn.b2)(),cm=(0,xn.f3)(hr.IShaderModuleService),Hp(G0=(H0=function(){function e(){(0,Ft.Z)(this,e),va(this,"shaderModuleService",jy,this),(0,ye.Z)(this,"quad",F2),(0,ye.Z)(this,"enabled",!0),(0,ye.Z)(this,"renderToScreen",!1),(0,ye.Z)(this,"optionsToUpdate",{})}return(0,Tt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Wa.PostProcessing}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(hr.IRendererService),this.shaderModuleService=t.getContainer().get(hr.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,p=r.createModel,v=this.setupShaders(),g=v.vs,E=v.fs,w=v.uniforms;this.model=p({vs:g,fs:E,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)((0,Z.Z)({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,i){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,p=u.useFramebuffer,v=u.getViewportSize,g=u.clear,E=v(),w=E.width,L=E.height;p(this.renderToScreen?null:o.getWriteFBO(),function(){g({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=(0,Z.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[w,L]},r.convertOptionsToUniforms(r.optionsToUpdate));i&&(F.u_BloomFinal=1,F.u_Texture2=i),r.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,Z.Z)((0,Z.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var i={};return Object.keys(t).forEach(function(r){(0,gr.isNil)(t[r])||(i["u_".concat((0,gr.upperFirst)((0,gr.camelCase)(r)))]=t[r])}),i}}]),e}(),jy=ca(H0.prototype,"shaderModuleService",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H0))||G0),Gy,Hy;function D2(e){var a=B2();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,z2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,U2=(Gy=(0,xn.b2)(),Gy(Hy=function(e){(0,an.Z)(t,e);var a=D2(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:z2,fs:N2});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,gr.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,gr.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,gr.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(Hd))||Hy),Wy,Xy;function Z2(e){var a=V2();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,G2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,H2=(Wy=(0,xn.b2)(),Wy(Xy=function(e){(0,an.Z)(t,e);var a=Z2(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:G2,fs:j2});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,gr.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(Hd))||Xy),Yy,qy;function W2(e){var a=X2();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$2=(Yy=(0,xn.b2)(),Yy(qy=function(e){(0,an.Z)(t,e);var a=W2(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:q2,fs:Y2});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,gr.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(Hd))||qy),$y,Ky;function K2(e){var a=Q2();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,eE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tE=($y=(0,xn.b2)(),$y(Ky=function(e){(0,an.Z)(t,e);var a=K2(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:eE,fs:J2});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Hd))||Ky),Qy,Jy;function rE(e){var a=nE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function nE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,aE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,oE=(Qy=(0,xn.b2)(),Qy(Jy=function(e){(0,an.Z)(t,e);var a=rE(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:aE,fs:iE}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Hd))||Jy),e_,t_;function sE(e){var a=uE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function uE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,cE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fE=(e_=(0,xn.b2)(),e_(t_=function(e){(0,an.Z)(t,e);var a=sE(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:cE,fs:lE});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Hd))||t_),r_,n_;function hE(e){var a=pE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function pE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,vE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mE=(r_=(0,xn.b2)(),r_(n_=function(e){(0,an.Z)(t,e);var a=hE(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:vE,fs:dE});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Hd))||n_),i_,a_;function gE(e){var a=yE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function yE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _E=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,xE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bE=(i_=(0,xn.b2)(),i_(a_=function(e){(0,an.Z)(t,e);var a=gE(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:xE,fs:_E}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Hd))||a_),o_,s_;function EE(e){var a=CE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function CE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,AE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,wE=(o_=(0,xn.b2)(),o_(s_=function(e){(0,an.Z)(t,e);var a=EE(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:SE,fs:AE}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Hd))||s_),u_,l_,c_,f_,Av,h_,TE=(u_=(0,xn.b2)(),l_=(0,xn.f3)(hr.IRendererService),c_=(0,xn.zY)(),u_(f_=(Av=function(){function e(){(0,Ft.Z)(this,e),va(this,"rendererService",h_,this),(0,ye.Z)(this,"passes",[])}return(0,Tt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,i=t.getViewportSize,r=t.createTexture2D,o=i(),u=o.width,p=o.height;return r({x:0,y:0,width:u,height:p,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,i=this.rendererService.useFramebuffer;return new Promise(function(r,o){i(t.readFBO,(0,Ua.Z)(xi().mark(function u(){return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return v.stop()}},u)})))})}},{key:"renderBloomPass",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r,o){var u,p;return xi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.getReadFBOTex();case 2:u=g.sent,p=0;case 4:if(!(p<4)){g.next=11;break}return g.next=7,o.render(r,u);case 7:this.swap(),p++,g.next=4;break;case 11:case"end":return g.stop()}},i,this)}));function t(i,r){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r){var o,u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=0;case 1:if(!(o<this.passes.length)){v.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){v.next=9;break}return v.next=7,this.renderBloomPass(r,u);case 7:v.next=12;break;case 9:return v.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,v.next=1;break;case 15:case"end":return v.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){this.readFBO.resize({width:t,height:i}),this.writeFBO.resize({width:t,height:i})}},{key:"add",value:function(t,i,r){t.init(i,r),this.passes.push(t)}},{key:"insert",value:function(t,i,r,o){t.init(r,o),this.passes.splice(i,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(i){return i.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,i=t.createFramebuffer,r=t.createTexture2D;this.readFBO=i({color:r({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.writeFBO=i({color:r({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var i=t+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),h_=ca(Av.prototype,"rendererService",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca(Av.prototype,"init",[c_],Object.getOwnPropertyDescriptor(Av.prototype,"init"),Av.prototype),Av))||f_),p_,d_;function ME(e){var a=IE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=(p_=(0,xn.b2)(),p_(d_=function(e){(0,an.Z)(t,e);var a=ME(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getType",value:function(){return Wa.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){(0,gi.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,p=o.clear,v=r.multiPassRenderer.getPostProcessor().getReadFBO();u(v,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:v}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(g){g.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(qa))||d_),v_,m_,g_,Yg,y_;function PE(e){var a=RE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function RE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LE=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,__=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,OE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function x_(e,a){for(var t=0,i=1/a,r=e;r>0;)t=t+i*(r%a),r=Math.floor(r/a),i=i/a;return t}var FE=1,DE=(v_=(0,xn.b2)(),m_=(0,xn.f3)(hr.IShaderModuleService),v_(g_=(Yg=function(e){(0,an.Z)(t,e);var a=PE(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),va((0,Gt.Z)(i),"shaderModuleService",y_,(0,Gt.Z)(i)),(0,ye.Z)((0,Gt.Z)(i),"haltonSequence",[]),(0,ye.Z)((0,Gt.Z)(i),"accumulatingId",0),(0,ye.Z)((0,Gt.Z)(i),"frame",0),(0,ye.Z)((0,Gt.Z)(i),"timer",void 0),i}return(0,Tt.Z)(t,[{key:"getType",value:function(){return Wa.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){(0,gi.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,p=u.createFramebuffer,v=u.createTexture2D;this.sampleRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.prevRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.outputRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.copyRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})});for(var g=0;g<30;g++)this.haltonSequence.push([x_(g,2),x_(g,3)]);this.blendModel=this.createTriangleModel("blend-pass",LE),this.outputModel=this.createTriangleModel("copy-pass",__,{blend:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:X.ONE,dstAlpha:X.ONE_MINUS_SRC_ALPHA},equation:{rgb:X.FUNC_ADD,alpha:X.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",__)}},{key:"render",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),w=E.width,L=E.height;this.sampleRenderTarget.resize({width:w,height:L}),this.prevRenderTarget.resize({width:w,height:L}),this.outputRenderTarget.resize({width:w,height:L}),this.copyRenderTarget.resize({width:w,height:L}),this.resetFrame(),this.stopAccumulating();var F=r.multiPassRenderer.getPostProcessor().getReadFBO();g(F,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var U=function j(q){!o.accumulatingId||q!==o.accumulatingId||o.isFinished()||(o.doRender(r),Pa.requestAnimationFrame(function(){j(q)}))};this.accumulatingId=FE++,this.timer=Pa.setTimeout(function(){U(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),w=E.width,L=E.height,F=r.getLayerConfig(),U=F.jitterScale,j=U===void 0?1:U,q=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((q[0]*2-1)/w*j,(q[1]*2-1)/L*j),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),g(this.sampleRenderTarget,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var ae=r.getLayerConfig();g(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:ae.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(g(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),g(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var pe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=pe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Pa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:OE,fs:o});var p=this.shaderModuleService.getModule(r),v=p.vs,g=p.fs,E=p.uniforms,w=this.rendererService,L=w.createAttribute,F=w.createBuffer,U=w.createModel;return U((0,Z.Z)({vs:v,fs:g,attributes:{a_Position:L({buffer:F({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)({},E),depth:{enable:!1},count:3},u))}}]),t}(qa),y_=ca(Yg.prototype,"shaderModuleService",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg))||g_),fm=new xn.W2;fm.bind(hr.IGlobalConfigService).to(ud).inSingletonScope(),(0,xn.GW)((0,xn.b2)(),ua.EventEmitter),fm.bind(hr.IEventEmitter).to(ua.EventEmitter);var b_=(0,zu.Z)(fm,!1),qg=function(a){var t=b_.lazyInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},Tk=function(a){var t=b_.lazyMultiInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},Bh=fm,BE=0;function NE(){var e=new xn.W2;return e.parent=fm,e.bind(hr.SceneID).toConstantValue("".concat(BE++)),e.bind(hr.IShaderModuleService).to(ni).inSingletonScope(),e.bind(hr.ILayerService).to(Vg).inSingletonScope(),e.bind(hr.ISceneService).to(rg).inSingletonScope(),e.bind(hr.ICameraService).to(Lp).inSingletonScope(),e.bind(hr.ICoordinateSystemService).to(Ud).inSingletonScope(),e.bind(hr.IInteractionService).to($v).inSingletonScope(),e.bind(hr.IPickingService).to(Om).inSingletonScope(),e.bind(hr.IControlService).to(Mh).inSingletonScope(),e.bind(hr.IMarkerService).to(Op).inSingletonScope(),e.bind(hr.IIconService).to(Dt).inSingletonScope(),e.bind(hr.IFontService).to($).inSingletonScope(),e.bind(hr.IPopupService).to(od).inSingletonScope(),e.bind(hr.INormalPass).to($a).whenTargetNamed("clear"),e.bind(hr.INormalPass).to(oh).whenTargetNamed("pixelPicking"),e.bind(hr.INormalPass).to(kE).whenTargetNamed("render"),e.bind(hr.INormalPass).to(DE).whenTargetNamed("taa"),e.bind(hr.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(hr.INormalPass,t)}}),e.bind(hr.IPostProcessingPass).to(oE).whenTargetNamed("copy"),e.bind(hr.IPostProcessingPass).to(U2).whenTargetNamed("bloom"),e.bind(hr.IPostProcessingPass).to(H2).whenTargetNamed("blurH"),e.bind(hr.IPostProcessingPass).to($2).whenTargetNamed("blurV"),e.bind(hr.IPostProcessingPass).to(bE).whenTargetNamed("noise"),e.bind(hr.IPostProcessingPass).to(wE).whenTargetNamed("sepia"),e.bind(hr.IPostProcessingPass).to(tE).whenTargetNamed("colorHalftone"),e.bind(hr.IPostProcessingPass).to(fE).whenTargetNamed("hexagonalPixelate"),e.bind(hr.IPostProcessingPass).to(mE).whenTargetNamed("ink"),e.bind(hr.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var i=a.container.getNamed(hr.IPostProcessingPass,t);return i.setName(t),i}}),e}function $g(e){var a=new xn.W2;return a.parent=e,a.bind(hr.IStyleAttributeService).to(p0).inSingletonScope(),a.bind(hr.IMultiPassRenderer).to(sl).inSingletonScope(),a.bind(hr.IPostProcessor).to(TE).inSingletonScope(),a}var zE=null;function Mk(e){return zE.indexOf(e)}var UE=2,Ik=4,ZE=64,kk=128,VE=256,jE=512,Pk=8192,Rk=16384,Lk=32768,GE=null,E_=131072,Ok=262144,HE=524288,Fk=1048576,WE=2097152,Dk=4194304,XE=8388608,YE=16777216,qE=null;function ag(e,a){return e=clamp(Math.floor(e),0,255),a=clamp(Math.floor(a),0,255),256*e+a}function Bk(e){var a=e.color,t=e.radius,i=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,p=e.stroke,v=e.strokeWidth,g=e.strokeOpacity,E=[],w=[],L=[],F=[ag(a[0],a[1]),ag(a[2],a[3])],U=[ag(p[0],p[1]),ag(p[2],p[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(j){var q=_slicedToArray(j,2),ae=q[0],pe=q[1];E.push([].concat(F,[(ae+1)*XE+(pe+1)*WE+getShapeIndex(o)*E_+t,(i+512)*HE+(r+512)*ZE])),w.push([].concat(U,[v,g])),L.push([u,0,0,0])}),{packedBuffer:E,packedBuffer2:w,packedBuffer3:L}}function Nk(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var t=a?1:0,i=Math.floor(e*127);return i*qE+t*YE+i*E_+t*GE+i*jE+t*VE+i*UE+t}var Nh;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Nh||(Nh={}));var ss;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(ss||(ss={}));var m0;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(m0||(m0={}));var Gn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Gn||(Gn={}));var $E=["mapload","mapchange","mapAfterFrameChange"],W0={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Kg=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],g0;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(g0||(g0={}));function KE(e){var a=QE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=0,og=function(e){(0,an.Z)(t,e);var a=KE(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this),r.controlOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i||{}),r}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{position:g0.TOPRIGHT,name:"".concat(JE++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g0.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(hr.IMapService),this.renderService=r.get(hr.IRendererService),this.layerService=r.get(hr.ILayerService),this.controlService=r.get(hr.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,p=this.controlService.controlCorners[u];return Bl(o,"l7-control"),u.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;Bl(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;yc(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;vf(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),t}(ua.EventEmitter);function eC(e){var a=tC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zk=function(e){(0,an.Z)(t,e);var a=eC(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),m(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,Gt.Z)(r)),r}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:g0.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",r.onLayerChange),o.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,o){return this.addLayer(r,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),o=r.height;Bl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(Bl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):yc(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return yc(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",r.onLayerChange),o.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",o=this.container=Qa("div",r),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var p=this.form=Qa("form",r+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=Qa("a",r+"-toggle",o);var v=this.layersLink;v.title="Layers",u||this.expand(),this.baseLayersList=Qa("div",r+"-base",p),this.separator=Qa("div",r+"-separator",p),this.overlaysList=Qa("div",r+"-overlays",p),o.appendChild(p)}},{key:"initLayers",value:function(){var r=this,o=this.controlOption,u=o.baseLayers,p=u===void 0?{}:u,v=o.overlayers,g=v===void 0?{}:v;Object.keys(p).forEach(function(E,w){r.addLayer(p[E],E,!1)}),Object.keys(g).forEach(function(E,w){r.addLayer(g[E],E,!0)})}},{key:"update",value:function(){if(!this.container)return this;mf(this.baseLayersList),mf(this.overlaysList),this.layerControlInputs=[];var r,o,u,p,v=0;for(u=0;u<this.layers.length;u++)p=this.layers[u],this.addItem(p),o=o||p.overlay,r=r||!p.overlay,v+=p.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&v>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=o&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,o,u,p=this.mapsService.getZoom(),v=r.length-1;v>=0;v--)if(o=r[v],u=this.layerService.getLayer(o.layerId),u&&u.inited){var g=u.getMinZoom(),E=u.getMaxZoom();o.disabled=p<g||p>E}}},{key:"addLayer",value:function(r,o,u){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:o,overlay:u});var p=this.controlOption,v=p.sortLayers,g=p.sortFunction,E=p.autoZIndex;v&&this.layers.sort(function(w,L){return g(w.layer,L.layer,w.name,L.name)}),E&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var o=this.layerService.getLayer(r.target.layerId),u=o!=null&&o.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(r,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(o?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=u,p.firstChild}},{key:"addItem",value:function(r){var o=document.createElement("label"),u=this.layerService.getLayer(r.layer.id),p=u&&u.inited&&r.layer.isVisible(),v;r.overlay?(v=document.createElement("input"),v.type="checkbox",v.className="l7-control-layers-selector",v.defaultChecked=p):v=this.createRadioElement("l7-base-layers",p),this.layerControlInputs.push(v),v.layerId=r.layer.id,v.addEventListener("click",this.onInputClick);var g=document.createElement("span");g.innerHTML=" "+r.name;var E=document.createElement("div");o.appendChild(E),E.appendChild(v),E.appendChild(g);var w=r.overlay?this.overlaysList:this.baseLayersList;return w.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,o,u,p=[],v=[];this.handlingClick=!0;for(var g=r.length-1;g>=0;g--)o=r[g],u=this.layerService.getLayer(o.layerId),o.checked?p.push(u):o.checked||v.push(u);v.forEach(function(E){E.hide()}),p.forEach(function(E){E.show()}),this.handlingClick=!1}}]),t}(og);function rC(e){var a=nC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iC=function(e){(0,an.Z)(t,e);var a=rC(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{position:g0.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",o=Qa("div",r),u=Qa("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),t}(og);function aC(e){var a=oC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uk=function(e){(0,an.Z)(t,e);var a=aC(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),m(["update"],(0,Gt.Z)(r)),r}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{position:g0.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",o=Qa("div",r);this.addScales(r+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,o=this.controlOption.maxWidth,u=r.getSize()[1]/2,p=r.containerToLngLat([0,u]),v=r.containerToLngLat([o,u]),g=jc([p.lng,p.lat],[v.lng,v.lat]);this.updateScales(g)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,p=o.imperial;u&&r&&this.updateMetric(r),p&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,p,v;o>5280?(u=o/5280,p=this.getRoundNum(u),this.updateScale(this.iScale,p+" mi",p/u)):(v=this.getRoundNum(o),this.updateScale(this.iScale,v+" ft",v/o))}},{key:"updateScale",value:function(r,o,u){var p=this.controlOption.maxWidth;r.style.width=Math.round(p*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(r,o){var u=this.controlOption,p=u.metric,v=u.imperial;p&&(this.mScale=Qa("div",r,o)),v&&(this.iScale=Qa("div",r,o))}}]),t}(og);function sC(e){var a=uC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zk=function(e){(0,an.Z)(t,e);var a=sC(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),m(["updateDisabled","zoomIn","zoomOut"],(0,Gt.Z)(r)),r}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{position:g0.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",o=Qa("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,o,u,p,v){var g=Qa("a",u,p);return g.innerHTML=r,g.title=o,g.href="javascript:void(0)",g.addEventListener("click",v),g}},{key:"updateDisabled",value:function(){var r=this.mapsService,o="l7-disabled";yc(this.zoomInButton,o),yc(this.zoomOutButton,o),(this.disabled||r.getZoom()<=r.getMinZoom())&&Bl(this.zoomOutButton,o),(this.disabled||r.getZoom()>=r.getMaxZoom())&&Bl(this.zoomInButton,o)}}]),t}(og);function lC(e){var a=cC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C_=function(e){(0,an.Z)(t,e);var a=lC(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this),(0,ye.Z)((0,Gt.Z)(r),"added",!1),(0,ye.Z)((0,Gt.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i),m(["update","onMove","onUp","addDragHandler","onMapClick"],(0,Gt.Z)(r)),r.init(),r}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ce.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(hr.IMapService),this.sceneSerive=r.get(hr.ISceneService);var o=this.markerOption,u=o.element,p=o.draggable;return this.mapsService.getMarkerContainer().appendChild(u),this.registerMarkerEvent(u),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&vf(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&vf(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),Jn(o,"".concat(Me[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,p=this.lngLat,v=p.lng,g=p.lat,E=this.mapsService.getBounds(),w=this.mapsService.lngLatToContainer([v,g]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var L=this.mapsService.getContainer(),F=0,U=0;if(L&&(F=L.scrollWidth,U=L.scrollHeight),Math.abs(E[0][0])>180||Math.abs(E[1][0])>180){if(w.x>F){var j=this.mapsService.lngLatToContainer([v-360,g]);w.x=j.x}if(w.x<0){var q=this.mapsService.lngLatToContainer([v+360,g]);w.x=q.x}}(w.x>F||w.x<0||w.y>U||w.y<0)&&(o.style.display="none"),o.style.left=w.x+u[0]+"px",o.style.top=w.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,p=u.color,v=u.anchor;if(!o){this.defaultMarker=!0,o=Qa("div"),this.markerOption.element=o;var g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","48px"),g.setAttributeNS(null,"width","48px"),g.setAttributeNS(null,"viewBox","0 0 1024 1024");var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),E.setAttributeNS(null,"fill",p),g.appendChild(E),o.appendChild(g)}Bl(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var L,F,U=((L=r.markerOption)===null||L===void 0?void 0:L.style)&&((F=r.markerOption)===null||F===void 0?void 0:F.style[w]);o&&(o.style[w]=U)}),o.addEventListener("click",function(w){r.onMapClick(w)}),o.addEventListener("click",this.eventHandle),et(o,v,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(ua.EventEmitter);function fC(e){var a=hC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function hC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vk=function(e){(0,an.Z)(t,e);var a=fC(t);function t(i){var r,o;return(0,Ft.Z)(this,t),o=a.call(this),(0,ye.Z)((0,Gt.Z)(o),"markers",[]),(0,ye.Z)((0,Gt.Z)(o),"points",[]),(0,ye.Z)((0,Gt.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,gr.merge)(o.getDefault(),i),m(["update"],(0,Gt.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,Tt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(hr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),p=this.mapsService.getBounds();this.bbox=bc(p,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),p=u.lng,v=u.lat,g={geometry:{type:"Point",coordinates:[p,v]},properties:(0,Z.Z)((0,Z.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(g),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,p=u===void 0?0:u,v=r.maxZoom;this.clusterIndex=new(Yi())({radius:o,minZoom:p,maxZoom:v}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,p=r[0].concat(r[1]),v=this.clusterIndex.getClusters(p,o);this.clusterMarkers.forEach(function(g){g.remove()}),this.clusterMarkers=[],v.forEach(function(g){var E,w=u.markerLayerOption.clusterOption,L=w.field,F=w.method;if(g.properties&&(E=g.properties)!==null&&E!==void 0&&E.cluster_id){var U,j=u.getLeaves((U=g.properties)===null||U===void 0?void 0:U.cluster_id);if(g.properties.clusterData=j,L&&F){var q=j==null?void 0:j.map(function(yt){var vt=(0,ye.Z)({},L,yt.properties[L]);return vt}),ae=co(q,L),pe=mu(F,ae),Fe="point_"+F;g.properties[Fe]=pe.toFixed(2)}}var Qe=u.clusterMarker(g);u.clusterMarkers.push(Qe),Qe.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,p=u.element,v=p===void 0?this.generateElement.bind(this):p,g=new C_({element:v(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return g}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!Zl(this.bbox,o))&&(this.bbox=bc(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=Qa("div","l7-marker-cluster"),u=Qa("div","",o),p=Qa("span","",u),v=this.markerLayerOption.clusterOption,g=v.field,E=v.method;r.properties.point_count=r.properties.point_count||1;var w=g&&E?r.properties["point_"+E]||r.properties[g]:r.properties.point_count;return p.textContent=w,o}}]),t}(ua.EventEmitter);function pC(e){var a=dC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S_=function(e){(0,an.Z)(t,e);var a=pC(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this),r.popupOption=(0,Z.Z)((0,Z.Z)({},r.getdefault()),i),m(["update","onClickClose","remove"],(0,Gt.Z)(r)),r}return(0,Tt.Z)(t,[{key:"addTo",value:function(r){var o=this;return this.mapsService=r.get(hr.IMapService),this.sceneSerive=r.get(hr.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),p;for(u.innerHTML=r;p=u.firstChild,!!p;)o.appendChild(p);return this.setDOMContent(o)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&vf(this.content),this.content=Qa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Qa("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,o,u){var p=window.document.createElement(r);return o!==void 0&&(p.className=o),u&&u.appendChild(p),p}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ce.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,o=this.lngLat,u=this.popupOption,p=u.className,v=u.maxWidth,g=u.anchor;if(!(!this.mapsService||!o||!this.content)){var E=this.mapsService.getMarkerContainer();if(!this.container&&E){this.container=this.creatDom("div","l7-popup",E),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),p&&p.split(" ").forEach(function(L){return r.container.classList.add(L)});var w=this.popupOption.stopPropagation;w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(L){r.container.addEventListener(L,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}v&&this.container.style.maxWidth!==v&&(this.container.style.maxWidth=v),this.updatePosition(),Jn(this.container,"".concat(Me[g])),et(this.container,g,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,o=r.lng,u=r.lat,p=this.popupOption.offsets,v=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=v.x+p[0]+"px",this.container.style.top=v.y-p[1]+"px"}}}]),t}(ua.EventEmitter);function vC(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}vC(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var y0,Qg=(y0={},(0,ye.Z)(y0,Nh.additive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:1,dstAlpha:1}}),(0,ye.Z)(y0,Nh.none,{enable:!1}),(0,ye.Z)(y0,Nh.normal,{enable:!0,func:{srcRGB:X.SRC_ALPHA,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,ye.Z)(y0,Nh.subtractive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:X.ZERO,dstAlpha:X.ONE_MINUS_SRC_COLOR},equation:{rgb:X.FUNC_SUBTRACT,alpha:X.FUNC_SUBTRACT}}),(0,ye.Z)(y0,Nh.max,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MAX_EXT}}),(0,ye.Z)(y0,Nh.min,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MIN_EXT}}),y0),jk=1024;function Df(e,a,t,i,r){a.updateStyleAttribute(e,t,i,r)}function mC(e,a){e.opacity&&sg("opacity",a,e.opacity),e.strokeWidth&&sg("strokeWidth",a,e.strokeWidth),e.strokeOpacity&&sg("strokeOpacity",a,e.strokeOpacity),e.stroke&&gC("stroke",a,e.stroke),e.offsets&&A_("offsets",a,e.offsets),e.textOffset&&A_("textOffset",a,e.textOffset),e.thetaOffset&&sg("thetaOffset",a,e.thetaOffset)}function sg(e,a,t){(0,gr.isString)(t)?Df(e,a,t,function(i){return i}):(0,gr.isNumber)(t)?Df(e,a,[t],void 0):Array.isArray(t)&&t.length===2?(0,gr.isString)(t[0])&&(0,gr.isFunction)(t[1])||(0,gr.isString)(t[0])&&Array.isArray(t[1])&&(0,gr.isNumber)(t[1][0])&&(0,gr.isNumber)(t[1][1])?Df(e,a,t[0],t[1]):Df(e,a,[1],void 0):Df(e,a,[1],void 0)}function A_(e,a,t){(0,gr.isString)(t)?Df(e,a,t,function(i){return i}):Array.isArray(t)&&t.length===2&&(0,gr.isString)(t[0])&&(0,gr.isFunction)(t[1])?Df(e,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,gr.isNumber)(t[0])&&(0,gr.isNumber)(t[1])?Df(e,a,t,void 0):Df(e,a,[0,0],void 0)}function gC(e,a,t){(0,gr.isString)(t)?Df(e,a,t,void 0):Array.isArray(t)&&t.length===2&&((0,gr.isString)(t[0])&&(0,gr.isFunction)(t[1])||(0,gr.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Df(e,a,t[0],t[1]):Df(e,a,"#fff",void 0)}var Wu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Wu||(Wu={}));function yC(e,a){var t=[a[0]-e[0],a[1]-e[1]],i=Yf(t),r=[e[0]+i[0]*1e-4,e[1]+i[1]*1e-4];return r}function _C(e,a){var t=this;e.length>0&&a.version===Wu["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Wu["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoord(i.coordinates)}):e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Wu["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoords(i.coordinates)}))}function xC(e,a){e.length>0&&a.version===Wu.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=bC(t.coordinates,a),t.simpleCoordinate=!0)})}function bC(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var i=[];return e.map(function(r){i.push(a.simpleMapCoord.unproject(r))}),i}}function EC(e,a,t){var i;if(!e.scale)return[];var r=(e==null||(i=e.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];r.forEach(function(p){var v,g=p.field;(a.hasOwnProperty(g)||((v=e.scale)===null||v===void 0?void 0:v.type)==="variable")&&o.push(a[g])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!P(u[0])?[t]:u}function CC(e,a,t,i,r,o){var u=o==null?void 0:o.getLayerConfig(),p=u.arrow,v=p===void 0?{enable:!1}:p,g=a.map(function(E){var w={id:E._id,coordinates:E.coordinates};if(e.filter(function(U){return U.scale!==void 0}).forEach(function(U){var j=EC(U,E,r);U.needRemapping=!1,U.name==="color"&&(j=j.map(function(q){return B(q)})),w[U.name]=Array.isArray(j)&&j.length===1?j[0]:j,U.name==="shape"&&(w.shape=t.getIconFontKey(w[U.name]))}),w.shape==="line"&&v.enable){var L=w.coordinates,F=yC(L[0],L[1]);w.coordinates.splice(1,0,F,F)}return w});return _C(g,i),xC(g,i),g}function SC(e,a,t,i,r,o){var u=new vo(r,o),p=e.getBottomColor(),v=i.getLayerStyleAttributes()||[],g=u.data.dataArray,E=g,w=CC(v,E,a,t,p,e);return u.destroy(),w}function w_(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function T_(e,a,t,i){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enablePicking,p=o.enableTAA;return p?r.add(i("taa")):r.add(i("render")),w_(a).forEach(function(v){var g=(0,Pr.Z)(v,2),E=g[0],w=g[1];r.add(t(E),w)}),r.add(t("copy")),r}var AC=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function wC(e,a,t){if(typeof a=="string"&&typeof t=="string"&&a!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}AC.map(function(i){if(i.includes(a)&&i.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var TC=["passes"],MC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],M_,Jg,I_;function IC(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kC(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function kC(e,a){if(!!e){if(typeof e=="string")return k_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return k_(e,a)}}function k_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function PC(e){var a=RC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P_=0,dd=(M_=qg(hr.IGlobalConfigService),Jg=function(e){(0,an.Z)(t,e);var a=PC(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Ft.Z)(this,t),i=a.call(this),(0,ye.Z)((0,Gt.Z)(i),"id","".concat(P_++)),(0,ye.Z)((0,Gt.Z)(i),"name","".concat(P_)),(0,ye.Z)((0,Gt.Z)(i),"visible",!0),(0,ye.Z)((0,Gt.Z)(i),"zIndex",0),(0,ye.Z)((0,Gt.Z)(i),"inited",!1),(0,ye.Z)((0,Gt.Z)(i),"layerModelNeedUpdate",!1),(0,ye.Z)((0,Gt.Z)(i),"pickedFeatureID",null),(0,ye.Z)((0,Gt.Z)(i),"selectedFeatureID",null),(0,ye.Z)((0,Gt.Z)(i),"styleNeedUpdate",!1),(0,ye.Z)((0,Gt.Z)(i),"clusterZoom",0),(0,ye.Z)((0,Gt.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,ye.Z)((0,Gt.Z)(i),"hooks",{init:new xs,afterInit:new xs,beforeRender:new xs,beforeRenderData:new la,afterRender:new eo,beforePickingEncode:new eo,afterPickingEncode:new eo,beforeHighlight:new eo(["pickedColor"]),afterHighlight:new eo,beforeSelect:new eo(["pickedColor"]),afterSelect:new eo,beforeDestroy:new eo,afterDestroy:new eo}),(0,ye.Z)((0,Gt.Z)(i),"models",[]),(0,ye.Z)((0,Gt.Z)(i),"layerChildren",[]),(0,ye.Z)((0,Gt.Z)(i),"masks",[]),(0,ye.Z)((0,Gt.Z)(i),"isVector",!1),va((0,Gt.Z)(i),"configService",I_,(0,Gt.Z)(i)),(0,ye.Z)((0,Gt.Z)(i),"animateOptions",{enable:!1}),(0,ye.Z)((0,Gt.Z)(i),"currentPickId",null),(0,ye.Z)((0,Gt.Z)(i),"pendingStyleAttributes",[]),(0,ye.Z)((0,Gt.Z)(i),"scaleOptions",{}),(0,ye.Z)((0,Gt.Z)(i),"aniamateStatus",!1),(0,ye.Z)((0,Gt.Z)(i),"bottomColor","rgba(0, 0, 0, 0)"),(0,ye.Z)((0,Gt.Z)(i),"isDestroied",!1),(0,ye.Z)((0,Gt.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var o=i.getLayerConfig();o&&o.autoFit&&i.fitBounds(o.fitBoundsOptions),i.reRender()}),i.name=r.name||i.id,i.zIndex=r.zIndex||0,i.rawConfig=r,i}return(0,Tt.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(p){p in o.rawConfig&&(o.rawConfig[p]=r[p])}),!this.inited)this.needUpdateConfig=(0,Z.Z)((0,Z.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(hr.SceneID);mC(r,this),this.configService.setLayerConfig(u,this.id,(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,o=this.container.get(hr.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(hr.IIconService),this.fontService=this.container.get(hr.IFontService),this.rendererService=this.container.get(hr.IRendererService),this.layerService=this.container.get(hr.ILayerService),this.interactionService=this.container.get(hr.IInteractionService),this.pickingService=this.container.get(hr.IPickingService),this.mapService=this.container.get(hr.IMapService);var u=this.getLayerConfig(),p=u.enableMultiPassRenderer,v=u.passes;p&&v!==null&&v!==void 0&&v.length&&v.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(hr.ICameraService),this.coordinateService=this.container.get(hr.ICoordinateSystemService),this.shaderModuleService=this.container.get(hr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(hr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(hr.IFactoryNormalPass),this.styleAttributeService=this.container.get(hr.IStyleAttributeService),this.multiPassRenderer=this.container.get(hr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(L){var F=L.attributeName,U=L.attributeField,j=L.attributeValues,q=L.updateOptions;r.styleAttributeService.updateStyleAttribute(F,{scale:(0,Z.Z)({field:U},r.splitValuesAndCallbackInAttribute(j,r.getLayerConfig()[F]))},q)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(hr.ILayerPlugin);var g=IC(this.plugins),E;try{for(g.s();!(E=g.n()).done;){var w=E.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(L){g.e(L)}finally{g.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var p=this.calculateEncodeData(r,o),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,o){return this.inited?SC(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,Z.Z)((0,Z.Z)({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){return this.updateStyleAttribute("filter",r,o,u),this}},{key:"shape",value:function(r,o,u){var p,v,g,E=(p=this.styleAttributeService)===null||p===void 0||(v=p.getLayerStyleAttribute("shape"))===null||v===void 0||(g=v.scale)===null||g===void 0?void 0:g.field,w=r;return this.shapeOption={field:r,values:o},this.updateStyleAttribute("shape",r,o,u),this.tileLayer||wC(this,E,w),this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,gr.isObject)(r)?(o.enable=!0,o=(0,Z.Z)((0,Z.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var p=u.getSource();p?u.layerSource.setData(r,o):(u.source(new vo(r,o)),u.sourceEvent())}),this}},{key:"style",value:function(r){var o=this,u=this.getLayerConfig(),p=r.passes,v=(0,Oh.Z)(r,TC);return p&&w_(p).forEach(function(g){var E=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(g[0]);E&&E.updateOptions(g[1])}),this.rawConfig=(0,Z.Z)((0,Z.Z)({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&r.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(g){o.models=g})),this}},{key:"scale",value:function(r,o){return(0,gr.isObject)(r)?this.scaleOptions=(0,Z.Z)((0,Z.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var i=(0,Ua.Z)(xi().mark(function o(){return xi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){p.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){p.next=6;break}return p.next=4,this.multiPassRenderer.render();case 4:p.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return p.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,gr.isObject)(r)?!0:r,(0,gr.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,gr.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({highlightColor:(0,gr.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,gr.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,gr.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,gr.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(te(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,gr.isObject)(r)?!0:r,(0,gr.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,gr.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({selectColor:(0,gr.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,gr.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,gr.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,gr.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(te(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,p=o.minZoom,v=p===void 0?-Infinity:p,g=o.maxZoom,E=g===void 0?Infinity:g;return!!u&&r>=v&&r<=E}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),p=u.passes,v=p===void 0?[]:p;this.multiPassRenderer=T_(this,v,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var g=this.rendererService.getViewportSize(),E=g.width,w=g.height;this.multiPassRenderer.resize(E,w)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,p=u.some(function(v){return Math.abs(v)===Infinity});return p?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(u){return u.destroy()}),this.layerChildren=[],this.masks.map(function(u){return u.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,o),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(g){return(0,ye.Z)({value:o.invertExtent(g)},r,g)});return u}else if(o.ticks){var p=o.ticks().map(function(g){return(0,ye.Z)({value:g},r,o(g))});return p}else if(o!=null&&o.domain){var v=o.domain().filter(function(g){return!(0,gr.isUndefined)(g)}).map(function(g){return(0,ye.Z)({value:g},r,o(g))});return v}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(r){var o=this,u=r.moduleName,p=r.vertexShader,v=r.fragmentShader,g=r.triangulation,E=r.segmentNumber,w=r.workerEnabled,L=w===void 0?!1:w,F=r.workerOptions,U=(0,Oh.Z)(r,MC);this.shaderModuleService.registerModule(u,{vs:p,fs:v});var j=this.shaderModuleService.getModule(u),q=j.vs,ae=j.fs,pe=j.uniforms,Fe=this.rendererService.createModel;return new Promise(function(Qe,yt){if(F&&F.modelType in wc&&L)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,E,F).then(function(Or){var Tr=Or.attributes,on=Or.elements,kn=Fe((0,Z.Z)({attributes:Tr,uniforms:pe,fs:ae,vs:q,elements:on,blend:Qg[Nh.normal]},U));Qe(kn)}).catch(function(Or){return yt(Or)});else{var vt=o.styleAttributeService.createAttributesAndIndices(o.encodedData,g,E),Bt=vt.attributes,Qt=vt.elements,Ir=Fe((0,Z.Z)({attributes:Bt,uniforms:pe,fs:ae,vs:q,elements:Qt,blend:Qg[Nh.normal]},U));Qe(Ir)}})}},{key:"createAttrubutes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),p=u.attributes;return p}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,p=u===void 0?!0:u,v=o.enableSelect,g=v===void 0?!0:v,E=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&g&&(E=!0),r==="mousemove"&&(p||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(E=!0),this.isVisible()&&E}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.render();case 2:case"end":return v.stop()}},o)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var u;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(p){o.models=p,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(u=this.layerModel)!==null&&u!==void 0&&u.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:o.layerModel.getUninforms()},r)})}return this}},{key:"updateStyleAttribute",value:function(r,o,u,p){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,Z.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},p):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:p})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,gr.isFunction)(r)?void 0:r||o,callback:(0,gr.isFunction)(r)?r:void 0}}}]),t}(ua.EventEmitter),I_=ca(Jg.prototype,"configService",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg),R_,ey,L_;function LC(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=OC(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function OC(e,a){if(!!e){if(typeof e=="string")return O_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return O_(e,a)}}function O_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Ro=(R_=qg(hr.IGlobalConfigService),ey=function(){function e(a){(0,Ft.Z)(this,e),va(this,"configService",L_,this),this.layer=a,this.rendererService=a.getContainer().get(hr.IRendererService),this.pickingService=a.getContainer().get(hr.IPickingService),this.shaderModuleService=a.getContainer().get(hr.IShaderModuleService),this.styleAttributeService=a.getContainer().get(hr.IStyleAttributeService),this.mapService=a.getContainer().get(hr.IMapService),this.iconService=a.getContainer().get(hr.IIconService),this.fontService=a.getContainer().get(hr.IFontService),this.cameraService=a.getContainer().get(hr.ICameraService),this.layerService=a.getContainer().get(hr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:X.NEAREST,min:X.NEAREST,width:1,height:1}))}return(0,Tt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var i=!1;return(0,gr.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,gr.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=t.opacity),(0,gr.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,gr.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,gr.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=t.stroke),(0,gr.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,gr.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,gr.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,gr.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,gr.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,gr.isString)(t)?!!(0,I.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var i=B(t);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,gr.isNumber)(t[0])&&(0,gr.isNumber)(t[1]))}},{key:"patchMod",value:function(t,i){for(var r=0;r<i;r++)t.push(-1)}},{key:"patchData",value:function(t,i,r){var o=LC(r),u;try{for(o.s();!(u=o.n()).done;){var p=u.value,v=p.attr,g=p.count,E=i[v];E!==void 0?v==="stroke"?t.push.apply(t,(0,_e.Z)(B(E))):v==="offsets"?this.isOffsetStatic(E)?t.push(-E[0],E[1]):t.push(0,0):t.push((0,gr.isNumber)(E)?E:1):this.patchMod(t,g)}}catch(w){o.e(w)}finally{o.f()}}},{key:"calDataFrame",value:function(t,i,r){for(var o=i.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),p=u*this.DATA_TEXTURE_WIDTH,v=[],g=0;g<o;g++){var E=i[g];this.patchData(v,E,r)}for(var w=v.length;w<p;w++)v.push(-1);return{data:v,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),i=t.blend,r=i===void 0?"normal":i;return Qg[Nh[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),i=t.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),L_=ca(ey.prototype,"configService",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ey),ty=100,Gk=36,Hk=40;function F_(e){return e/180*Math.acos(-1)}function D_(e){var a=F_(e[0])+Math.PI/2,t=F_(e[1]),i=ty+Math.random()*.4,r=i*Math.cos(t)*Math.cos(a),o=i*Math.cos(t)*Math.sin(a),u=i*Math.sin(t);return[o,u,r]}function Wk(e,a){var t=mat4.create(),i=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);a=a||{},e=typeof e!="undefined"?e:1;for(var u=typeof a.segments!="undefined"?a.segments:32,p=2+u,v=2*p,g=[],E=[],w=[],L=[],F=[],U=[],j=0;j<=p;j++){for(var q=j/p,ae=q*Math.PI,pe=0;pe<=v;pe++){var Fe=pe/v,Qe=Fe*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ae),mat4.identity(t),mat4.rotateY(t,t,Qe),vec3.transformMat4(o,r,i),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),w.push(o.slice()),L.push.apply(L,_toConsumableArray(o.slice())),vec3.normalize(o,o),F.push.apply(F,_toConsumableArray(o.slice())),U.push([Fe,1-q]),L.push(Fe,1-q)}if(j>0)for(var yt=w.length,vt=yt-2*(v+1);vt+v+2<yt;vt++)g.push([vt,vt+1,vt+v+1]),E.push(vt,vt+1,vt+v+1),g.push([vt+v+1,vt+1,vt+v+2]),E.push(vt+v+1,vt+1,vt+v+2)}return{cells:g,positions:w,uvs:U,positionsArr:L,indicesArr:E,normalArr:F}}var ug=cn.create(),Xk=cn.create(),Ll=cn.create(),_0=cn.create(),wv=cn.create();function ry(e,a,t,i,r){cn.add(e,t,i),cn.normalize(e,e),a=cn.fromValues(-e[1],e[0]);var o=cn.fromValues(-t[1],t[0]);return[r/cn.dot(a,o),a]}function x0(e,a){return cn.set(e,-a[1],a[0])}function Tv(e,a,t){return cn.sub(e,a,t),cn.normalize(e,e),e}function ny(e,a){return e[0]===a[0]&&e[1]===a[1]}function Yk(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var B_=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ft.Z)(this,e),(0,ye.Z)(this,"lastFlip",-1),(0,ye.Z)(this,"miter",cn.fromValues(0,0)),(0,ye.Z)(this,"started",!1),(0,ye.Z)(this,"dash",!1),(0,ye.Z)(this,"totalDistance",0),(0,ye.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Tt.Z)(e,[{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var w=0;w<i.positions.length/6;w++)i.positions[w*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,w=t[p-1];w.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var L=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,q=p<i.length-1?i[p+1]:null,ae=this.simpleSegment(r,u,w,F,j,L,U,q);u+=ae}if(this.dash)for(var pe=0;pe<r.positions.length/6;pe++)r.positions[pe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,w=t[p-1];w.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var L=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,q=p<i.length-1?i[p+1]:null,ae=this.segment_gaode2(r,u,w,F,j,L,U,q);u+=ae}if(this.dash)for(var pe=0;pe<r.positions.length/6;pe++)r.positions[pe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var w=0;w<i.positions.length/6;w++)i.positions[w*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,w=Go([o[0],o[1]]),L=Go([r[0],r[1]]);Tv(Ll,w,L);var F=0;if(this.dash&&(F=this.lineSegmentDistance(w,L),this.totalDistance+=F),this.normal||(this.normal=cn.create(),x0(this.normal,Ll)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)x0(this.normal,Ll),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var U=Go([u[0],u[1]]);ny(w,U)&&cn.add(U,w,cn.normalize(U,cn.subtract(U,w,L))),Tv(_0,U,w);var j=ry(wv,cn.create(),Ll,_0,this.thickness),q=(0,Pr.Z)(j,2),ae=q[0],pe=q[1],Fe=cn.dot(wv,this.normal)<0?-1:1;this.extrusions(g,E,o,pe,ae,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Fe=-1,cn.copy(this.normal,pe),p+=2,this.lastFlip=Fe}return p}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,w=t.indices,L=t.positions,F=t.normals,U=this.cap==="square",j=this.join==="bevel",q=Go([v[0],v[1]]),ae=Go([p[0],p[1]]);Tv(Ll,o,r);var pe=0;if(this.dash&&(pe=this.lineSegmentDistance(q,ae),this.totalDistance+=pe),this.normal||(this.normal=cn.create(),x0(this.normal,Ll)),!this.started)if(this.started=!0,U){var Fe=cn.create(),Qe=cn.create();cn.add(Fe,this.normal,Ll),cn.add(Qe,this.normal,Ll),F.push(Qe[0],Qe[1],0),F.push(Fe[0],Fe[1],0),L.push(r[0],r[1],r[2]|0,this.totalDistance-pe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),L.push(r[0],r[1],r[2]|0,this.totalDistance-pe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(L,F,r,this.normal,this.thickness,this.totalDistance-pe);if(w.push(i+0,i+1,i+2),u){ny(o,u)&&cn.add(u,o,cn.normalize(u,cn.subtract(u,o,r))),Tv(_0,u,o);var Bt=ry(wv,cn.create(),Ll,_0,this.thickness),Qt=(0,Pr.Z)(Bt,2),Ir=Qt[0],Or=Qt[1],Tr=cn.dot(wv,this.normal)<0?-1:1,on=j;if(!on&&this.join==="miter"){var kn=Ir;kn>this.miterLimit&&(on=!0)}on?(F.push(this.normal[0],this.normal[1],0),F.push(Or[0],Or[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,_e.Z)(this.lastFlip!==-Tr?[i,i+2,i+3]:[i+2,i+1,i+3])),w.push(i+2,i+3,i+4),x0(ug,_0),cn.copy(this.normal,ug),F.push(this.normal[0],this.normal[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Tr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(L,F,o,Or,Ir,this.totalDistance),w.push.apply(w,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Tr=-1,cn.copy(this.normal,Or),E+=2),this.lastFlip=Tr}else{if(x0(this.normal,Ll),U){var yt=cn.create(),vt=cn.create();cn.sub(vt,Ll,this.normal),cn.add(yt,Ll,this.normal),F.push(vt[0],vt[1],0),F.push(yt[0],yt[1],0),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),L.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(L,F,o,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,w=this.cap==="square",L=this.join==="bevel",F=Go([o[0],o[1]]),U=Go([r[0],r[1]]);Tv(Ll,F,U);var j=0;if(this.dash&&(j=this.lineSegmentDistance(F,U),this.totalDistance+=j),this.normal||(this.normal=cn.create(),x0(this.normal,Ll)),!this.started)if(this.started=!0,w){var q=cn.create(),ae=cn.create();cn.add(q,this.normal,Ll),cn.add(ae,this.normal,Ll),E.push(ae[0],ae[1],0),E.push(q[0],q[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-j);if(v.push(i+0,i+1,i+2),u){var Qe=Go([u[0],u[1]]);ny(F,Qe)&&cn.add(Qe,F,cn.normalize(Qe,cn.subtract(Qe,F,U))),Tv(_0,Qe,F);var yt=ry(wv,cn.create(),Ll,_0,this.thickness),vt=(0,Pr.Z)(yt,2),Bt=vt[0],Qt=vt[1],Ir=cn.dot(wv,this.normal)<0?-1:1,Or=L;if(!Or&&this.join==="miter"){var Tr=Bt;Tr>this.miterLimit&&(Or=!0)}Or?(E.push(this.normal[0],this.normal[1],0),E.push(Qt[0],Qt[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,_e.Z)(this.lastFlip!==-Ir?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),x0(ug,_0),cn.copy(this.normal,ug),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Ir,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,Qt,Bt,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Ir=-1,cn.copy(this.normal,Qt),p+=2),this.lastFlip=Ir}else{if(x0(this.normal,Ll),w){var pe=cn.create(),Fe=cn.create();cn.sub(Fe,Ll,this.normal),cn.add(pe,Ll,this.normal),E.push(Fe[0],Fe[1],0),E.push(pe[0],pe[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),ts=fe(77160);function FC(e){var a=e[0][0],t=e[0][e[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,r=Fu().flatten(e),o=r.vertices,u=r.dimensions,p=[],v=[],g=0;g<o.length/u;g++)u===2?p.push(o[g*2],o[g*2+1],1):p.push(o[g*3],o[g*3+1],1);var E=Fu()(r.vertices,r.holes,r.dimensions);v.push.apply(v,(0,_e.Z)(E));for(var w=function(U){var j=r.vertices.slice(U*u,(U+1)*u),q=r.vertices.slice((U+1)*u,(U+2)*u);q.length===0&&(q=r.vertices.slice(0,u));var ae=p.length/3;p.push(j[0],j[1],1,q[0],q[1],1,j[0],j[1],0,q[0],q[1],0),v.push.apply(v,(0,_e.Z)([0,2,1,2,3,1].map(function(pe){return pe+ae})))},L=0;L<i;L++)w(L);return{positions:p,index:v}}function DC(e){var a=Fu().flatten(e),t=Fu()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function N_(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],i=e[0][e[0].length-1];t[0]===i[0]&&t[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=Fu().flatten(e),u=o.vertices,p=o.dimensions,v=[],g=[],E=[],w=0;w<u.length/p;w++)p===2?v.push(u[w*2],u[w*2+1],1,-1,-1):v.push(u[w*3],u[w*3+1],1,-1,-1),E.push(0,0,1);var L=Fu()(o.vertices,o.holes,o.dimensions);g.push.apply(g,(0,_e.Z)(L));for(var F=function(q){var ae=o.vertices.slice(q*p,(q+1)*p),pe=o.vertices.slice((q+1)*p,(q+2)*p);pe.length===0&&(pe=o.vertices.slice(0,p));var Fe=v.length/5;v.push(ae[0],ae[1],1,0,0,pe[0],pe[1],1,.1,0,ae[0],ae[1],0,0,.8,pe[0],pe[1],0,.1,.8);var Qe=BC([pe[0],pe[1],1],[ae[0],ae[1],0],[ae[0],ae[1],1],a);E.push.apply(E,(0,_e.Z)(Qe).concat((0,_e.Z)(Qe),(0,_e.Z)(Qe),(0,_e.Z)(Qe))),g.push.apply(g,(0,_e.Z)([1,2,0,3,2,1].map(function(yt){return yt+Fe})))},U=0;U<r;U++)F(U);return{positions:v,index:g,normals:E}}function BC(e,a,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=ts.create(),o=ts.create(),u=ts.create();i&&(e=el(e),a=el(a),t=el(t));var p=ts.fromValues.apply(ts,(0,_e.Z)(e)),v=ts.fromValues.apply(ts,(0,_e.Z)(a)),g=ts.fromValues.apply(ts,(0,_e.Z)(t));ts.sub(r,g,v),ts.sub(o,p,v),ts.cross(u,r,o);var E=ts.create();return ts.normalize(E,u),E}var hp,X0;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(X0||(X0={}));var Y0;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Y0||(Y0={}));function hm(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,i=[],r=0;r<e;r++)i.push(t*r+a*Math.PI/12);var o=i.map(function(u){var p=Math.sin(u+Math.PI/4),v=Math.cos(u+Math.PI/4);return[p,v,0]});return o}function z_(){return hm(30)}function U_(){return hm(4)}function Z_(){return hm(3)}function V_(){return hm(6,1)}function j_(){return hm(5)}var Mv=(hp={},(0,ye.Z)(hp,Y0.CIRCLE,z_),(0,ye.Z)(hp,Y0.HEXAGON,V_),(0,ye.Z)(hp,Y0.TRIANGLE,Z_),(0,ye.Z)(hp,Y0.SQUARE,U_),(0,ye.Z)(hp,Y0.PENTAGON,j_),(0,ye.Z)(hp,X0.CYLINDER,z_),(0,ye.Z)(hp,X0.HEXAGONCOLUMN,V_),(0,ye.Z)(hp,X0.TRIANGLECOLUMN,Z_),(0,ye.Z)(hp,X0.SQUARECOLUMN,U_),(0,ye.Z)(hp,X0.PENTAGONCOLUMN,j_),hp),lg={};function q0(e){var a=c(e.coordinates);return{vertices:[].concat((0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function G_(e){var a=c(e.coordinates),t=D_(a);return{vertices:[].concat((0,_e.Z)(t),(0,_e.Z)(t),(0,_e.Z)(t),(0,_e.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function iy(e){var a=e.shape,t=VC(a,!1),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function NC(e){var a=c(e.coordinates);return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}function $0(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new B_({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(L){r.extrude(L)})}var w=r.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function zC(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new B_({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.simpleExtrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(L){r.simpleExtrude(L)})}var w=r.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function pm(e){var a=e.coordinates,t=Fu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(i,o,r),vertices:i,size:r}}function UC(e){var a=e.coordinates,t=Fu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(i,o,r),vertices:ZC(i),size:r+4}}function ZC(e){for(var a=[],t=h(e),i=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],p=e[o+1];a.push.apply(a,[u,p,0].concat((0,_e.Z)(i),[r]))}return a}function H_(e){var a=e.coordinates,t=N_(a,!0),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function W_(e){var a=e.shape,t=GC(a),i=t.positions,r=t.index;return{vertices:i,indices:r,size:3}}function ay(e){var a=e.coordinates,t=[].concat((0,_e.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,_e.Z)(a[1]),[0,1,0],(0,_e.Z)(a[0]),[0,0,1],(0,_e.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:t,indices:i,size:5}}function cg(e,a){for(var t=a||30,i=e.coordinates,r=[],o=[],u=function(g){r.push(g,1,g,i[0][0],i[0][1],i[1][0],i[1][1],g,-1,g,i[0][0],i[0][1],i[1][0],i[1][1]),g!==t-1&&o.push.apply(o,(0,_e.Z)([0,1,2,1,3,2].map(function(E){return g*2+E})))},p=0;p<t;p++)u(p);return{vertices:r,indices:o,size:7}}function X_(e){var a=e.coordinates;a.length===2&&a.push(0);var t=e.size,i=fg(-1,1),r=fg(1,1),o=fg(-1,-1),u=fg(1,-1),p=[].concat((0,_e.Z)(a),(0,_e.Z)(i),(0,_e.Z)(a),(0,_e.Z)(o),(0,_e.Z)(a),(0,_e.Z)(u),(0,_e.Z)(a),(0,_e.Z)(r)),v=[0,1,2,3,0,2];return{vertices:p,indices:v,size:5}}function VC(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(lg&&lg[e])return lg[e];var t=Mv[e]?Mv[e]():Mv.cylinder(),i=N_([t],a);return lg[e]=i,i}function qk(e,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,p,v=vec3.create(),g=vec3.create(),E=vec3.create(),w=0,L=a.length;w<L;w+=3){o=a[w+0]*3,u=a[w+1]*3,p=a[w+2]*3;var F=[e[o],e[o+1]],U=[e[u],e[u+1]],j=[e[p],e[p+1]];i&&(F=lngLatToMeters(F),U=lngLatToMeters(U),j=lngLatToMeters(j));var q=F,ae=_slicedToArray(q,2),pe=ae[0],Fe=ae[1],Qe=vec3.fromValues(pe,Fe,e[o+2]),yt=U,vt=_slicedToArray(yt,2),Bt=vt[0],Qt=vt[1],Ir=vec3.fromValues(Bt,Qt,e[u+2]),Or=j,Tr=_slicedToArray(Or,2),on=Tr[0],kn=Tr[1],si=vec3.fromValues(on,kn,e[p+2]);vec3.sub(v,si,Ir),vec3.sub(g,Qe,Ir),vec3.cross(E,v,g),r[o]+=v[0],r[o+1]+=v[1],r[o+2]+=v[2],r[u]+=v[0],r[u+1]+=v[1],r[u+2]+=v[2],r[p]+=v[0],r[p+1]+=v[1],r[p+2]+=v[2]}return jC(r),r}function jC(e){for(var a=0,t=e.length;a<t;a+=3){var i=vec3.fromValues(e[a],e[a+1],e[a+2]),r=vec3.create();vec3.normalize(r,i),e.set(r,a)}}function $k(e){var a=e[0][0],t=e[0][e[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function GC(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Mv[e]?Mv[e]():Mv.circle(),i=a.indexOf(e)===-1?DC([t]):FC([t]);return i}function fg(e,a){var t=(e+1)/2,i=(a+1)/2;return[t,i]}function Kk(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function Qk(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function HC(e){var a=WC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,YC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,qC=function(e){(0,an.Z)(t,e);var a=HC(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.baseColor,v=p===void 0?"rgb(16,16,16)":p,g=r.brightColor,E=g===void 0?"rgb(255,176,38)":g,w=r.windowColor,L=w===void 0?"rgb(30,60,89)":w,F=r.time,U=F===void 0?0:F,j=r.sweep,q=j===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:j;return{u_cityCenter:q.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*q.sweepRadius,u_circleSweep:q.enable?1:0,u_circleSweepColor:B(q.sweepColor).slice(0,3),u_circleSweepSpeed:q.sweepSpeed,u_opacity:u,u_baseColor:B(v),u_brightColor:B(E),u_windowColor:B(L),u_time:this.layer.getLayerAnimateTime()||U}}},{key:"calCityGeo",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(p+o)/2,(v+u)/2]);var g=this.mapService.lngLatToCoord([p,v]),E=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(g[0]-E[0],2)+Math.pow(g[1]-E[1],2))/4}else{var w=p-o,L=v-u;this.cityCenter=[(p+o)/2,(v+u)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(L,2))/4}}},{key:"initModels",value:function(r){this.calCityGeo(),this.startModelAnimate(),this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:YC,fragmentShader:XC,triangulation:H_,depth:{enable:!0},cull:{enable:!0,face:X.BACK}}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?10:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size;return[p[3],p[4]]}}})}}]),t}(Ro);function $C(e){var a=KC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=function(e){(0,an.Z)(t,e);var a=$C(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","PolygonLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this;this.layerModel=new qC(this),this.layerModel.initModels(function(o){r.models=o,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(dd);function JC(e){var a=eS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function eS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,rS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,nS=function(e){(0,an.Z)(t,e);var a=JC(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:tS,fragmentShader:rS,triangulation:W_,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Ro);function iS(e){var a=aS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,sS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,uS=function(e){(0,an.Z)(t,e);var a=iS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:oS,fragmentShader:sS,triangulation:iy,primitive:X.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Ro);function lS(e,a){for(var t=[],i=[],r=[],o=e+1,u=a+1,p=e/2,v=a/2,g=0;g<u;g++)for(var E=g-v,w=0;w<o;w++){var L=w-p;i.push(L/p,-E/v,0),r.push(w/e),r.push(1-g/a)}for(var F=0;F<a;F++)for(var U=0;U<e;U++){var j=U+o*F,q=U+o*(F+1),ae=U+1+o*(F+1),pe=U+1+o*F;t.push(j,q,pe),t.push(q,ae,pe)}return{vertices:i,indices:t,uvs:r}}var Y_,q_;function cS(e){var a=fS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,pS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,dS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,vS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,mS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,gS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,$_=(Y_=(0,xn.b2)(),Y_(q_=function(e){(0,an.Z)(t,e);var a=cS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,p=o.useFramebuffer;p(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){var p,v,g,E,w,L,F,U,j,q,ae,pe;return xi().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return v=this.rendererService,g=v.createFramebuffer,E=v.clear,w=v.getViewportSize,L=v.createTexture2D,F=v.useFramebuffer,U=this.styleAttributeService.getLayerStyleAttribute("shape"),j=(U==null||(p=U.scale)===null||p===void 0?void 0:p.field)||"heatmap",this.shapeType=j,Qe.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=Qe.sent,this.colorModel=j==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),q=w(),ae=q.width,pe=q.height,this.heatmapFramerBuffer=g({color:L({width:Math.floor(ae/4),height:Math.floor(pe/4),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return Qe.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Gn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return[E]}}})}},{key:"buildHeatMapIntensity",value:function(){var i=(0,Ua.Z)(xi().mark(function o(){var u;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.layer.triangulation=X_,v.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:gS,fragmentShader:mS,triangulation:X_,depth:{enable:!1},cull:{enable:!0,face:If(this.mapService.version)},blend:{enable:!0,func:{srcRGB:X.ONE,srcAlpha:1,dstRGB:X.ONE,dstAlpha:1}}});case 3:return u=v.sent,v.abrupt("return",u);case 5:case"end":return v.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p;this.shaderModuleService.registerModule("heatmapColor",{vs:vS,fs:dS});var g=this.shaderModuleService.getModule("heatmapColor"),E=g.vs,w=g.fs,L=g.uniforms,F=this.rendererService,U=F.createAttribute,j=F.createElements,q=F.createBuffer,ae=F.createModel;return ae({vs:E,fs:w,attributes:{a_Position:U({buffer:q({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:X.FLOAT}),size:3}),a_Uv:U({buffer:q({data:[0,1,1,1,0,0,1,0],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)({},L),depth:{enable:!1},blend:this.getBlend(),count:6,elements:j({data:[0,2,1,2,3,1],type:X.UNSIGNED_INT,count:6}),stencil:Ne(u,v)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=o.intensity,v=p===void 0?10:p,g=o.radius,E=g===void 0?5:g;(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:v}})}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=lr();Ci(p,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,_e.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p,g=this.rendererService.getViewportSize,E=g(),w=E.width,L=E.height,F=lS(w/4,L/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:pS,fs:hS});var U=this.shaderModuleService.getModule("heatmap3dColor"),j=U.vs,q=U.fs,ae=U.uniforms,pe=this.rendererService,Fe=pe.createAttribute,Qe=pe.createElements,yt=pe.createBuffer,vt=pe.createModel;return vt({vs:j,fs:q,attributes:{a_Position:Fe({buffer:yt({data:F.vertices,type:X.FLOAT}),size:3}),a_Uv:Fe({buffer:yt({data:F.uvs,type:X.FLOAT}),size:2})},primitive:X.TRIANGLES,uniforms:(0,Z.Z)({},ae),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:X.SRC_ALPHA,srcAlpha:1,dstRGB:X.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Qe({data:F.indices,type:X.UNSIGNED_INT,count:F.indices.length}),stencil:Ne(u,v)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,p=xe(u);this.colorTexture=r({data:new Uint8Array(p.data),width:p.width,height:p.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}}]),t}(Ro))||q_);function yS(e){var a=_S();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,bS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ES=function(e){(0,an.Z)(t,e);var a=yS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:bS,fragmentShader:xS,triangulation:W_,depth:{enable:!1},primitive:X.TRIANGLES,blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Ro),CS={heatmap:$_,heatmap3d:$_,grid:nS,grid3d:uS,hexagon:ES},SS=CS;function AS(e){var a=wS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=function(e){(0,an.Z)(t,e);var a=AS(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","HeatMapLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new SS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return r.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),p=u.shape3d,v=this.getSource(),g=v.data.type,E=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return E==="heatmap"||E==="heatmap3d"?"heatmap":g==="hexagon"?(p==null?void 0:p.indexOf(E))===-1?"hexagon":"grid3d":g==="grid"?(p==null?void 0:p.indexOf(E))===-1?"grid":"grid3d":"heatmap"}}]),t}(dd);function MS(e){var a=IS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kS=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,PS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,RS=function(e){(0,an.Z)(t,e);var a=MS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,p=u===void 0?!0:u,v=r.clampHigh,g=v===void 0?!0:v,E=r.noDataValue,w=E===void 0?-9999999:E,L=r.domain,F=L===void 0?[0,1]:L,U=r.rampColors,j=r.pixelConstant,q=j===void 0?0:j,ae=r.pixelConstantR,pe=ae===void 0?256*256:ae,Fe=r.pixelConstantG,Qe=Fe===void 0?256:Fe,yt=r.pixelConstantB,vt=yt===void 0?1:yt,Bt=r.pixelConstantRGB,Qt=Bt===void 0?.1:Bt;return(0,gr.isEqual)(this.rampColors,U)||(this.updateColorTexure(),this.rampColors=U),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:q,u_pixelConstantR:pe,u_pixelConstantG:Qe,u_pixelConstantB:vt,u_pixelConstantRGB:Qt,u_domain:F,u_clampLow:p,u_clampHigh:typeof g!="undefined"?g:p,u_noDataValue:w,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,w=u.rampColorsData,L=u.rampColors,F=this.layer.getSource(),U=this.rendererService.createTexture2D;if(this.texture=U({height:0,width:0}),Bs){var j=this.layerService.sceneService.getSceneConfig().canvas,q=j.createImage();q.crossOrigin="anonymous",q.src=F.data.originData,q.onload=function(){o.texture=U({data:q,width:q.width,height:q.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else F.data.images.then(function(pe){o.texture=U({data:pe[0],width:pe[0].width,height:pe[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});var ae=w||xe(L);this.colorTexture=U({data:ae.data,width:ae.width,height:ae.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:PS,fragmentShader:kS,triangulation:ay,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(v,E)}).then(function(pe){r([pe])}).catch(function(pe){console.warn(pe),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=xe(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(Ro);function LS(e){var a=OS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,DS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,BS=function(e){(0,an.Z)(t,e);var a=LS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,w=this.layer.getSource(),L=this.rendererService.createTexture2D;if(this.texture=L({height:0,width:0}),Bs){var F=this.layerService.sceneService.getSceneConfig().canvas,U=F.createImage();U.crossOrigin="anonymous",U.src=w.data.originData,U.onload=function(){o.texture=L({data:U,width:U.width,height:U.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else w.data.images.then(function(j){o.texture=L({data:j[0],width:j[0].width,height:j[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:DS,fragmentShader:FS,triangulation:ay,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Ne(v,E)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}}]),t}(Ro),NS={image:BS,dataImage:RS},zS=NS;function US(e){var a=ZS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K_=function(e){(0,an.Z)(t,e);var a=US(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","ImageLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new zS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{},dataImage:{}};return o[r]}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="dataImage"?"dataImage":(u==="image","image")}}]),t}(dd);function VS(e){var a=jS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function jS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,HS=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,WS=function(e){(0,an.Z)(t,e);var a=VS(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o;return{u_opacity:(0,gr.isNumber)(u)?u:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:HS,fragmentShader:GS,triangulation:pm,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:X.ALWAYS,ref:1,mask:255},opFront:{fail:X.REPLACE,zfail:X.REPLACE,zpass:X.REPLACE}}}).then(function(g){u([g])}).catch(function(g){console.warn(g),u([])});case 1:case"end":return v.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Ro),XS={fill:WS},YS=XS;function qS(e){var a=$S();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q_=function(e){(0,an.Z)(t,e);var a=qS(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","MaskLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new YS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(dd);function J_(e,a){a.map(function(t){var i=$g(e.sceneContainer);t.setContainer(i,e.sceneContainer),t.init()})}function e1(e,a){var t,i=a.getAttribute("shape");if(i&&(t=i.scale)!==null&&t!==void 0&&t.field){var r;return((r=i.scale)===null||r===void 0?void 0:r.values)==="text"?[i.scale.field,i.scale.values]:i.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function KS(e,a){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function QS(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function JS(e,a,t,i){var r,o,u,p,v=(e==null||(r=e.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],g=(0,Pr.Z)(v,4),E=g[0],w=E===void 0?0:E,L=g[1],F=L===void 0?0:L,U=g[2],j=U===void 0?10:U,q=g[3],ae=q===void 0?-10:q,pe=a.lngLatToContainer([w,F]),Fe=a.lngLatToContainer([j,ae]),Qe=Fe.x-pe.x,yt=pe.y-Fe.y,vt=[(t-pe.x)/Qe,(i-Fe.y)/yt],Bt=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,Qt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,Ir=Math.floor(vt[0]*Bt),Or=Math.floor(vt[1]*Qt),Tr=Math.max(0,Or-1)*Bt+Ir,on=e==null||(p=e.data)===null||p===void 0?void 0:p.data[Tr];return on}function Jk(e,a,t){var i=t.readPixels,r=t.getContainer,o=e*DOM.DPR,u=a*DOM.DPR,p=QS(r()),v=p.width,g=p.height;if(v*=DOM.DPR,g*=DOM.DPR,o>v-1*DOM.DPR||o<0||u>g-1*DOM.DPR||u<0)return!1;var E=i({x:Math.floor(o),y:Math.floor(g-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return E}function eA(e){var a=tA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,nA=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,t1=function(e){(0,an.Z)(t,e);var a=eA(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.textureBlend,v=p===void 0?"normal":p,g=r.lineTexture,E=g===void 0?!1:g,w=r.iconStep,L=w===void 0?100:w,F=r.vertexHeightScale,U=F===void 0?20:F,j=r.borderWidth,q=j===void 0?0:j,ae=r.borderColor,pe=ae===void 0?"#ccc":ae,Fe=r.heightfixed,Qe=Fe===void 0?!1:Fe,yt=r.arrow,vt=yt===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:yt,Bt=r.coord,Qt=Bt===void 0?"lnglat":Bt,Ir=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Or=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,Or,this.cellProperties),on=Tr.data,kn=Tr.width,si=Tr.height;this.rowCount=si,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:X.LUMINANCE,type:X.FLOAT,width:kn,height:si}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:Ir||[0,0],u_coord:Qt==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_textureBlend:v==="normal"?0:1,u_texture:this.texture,u_line_texture:E?1:0,u_icon_step:L,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:q,u_borderColor:B(pe),u_heightfixed:Number(Qe),u_vertexScale:U,u_arrow:Number(vt.enable),u_arrowHeight:vt.arrowHeight||3,u_arrowWidth:vt.arrowWidth||2,u_tailWidth:vt.tailWidth===void 0?1:vt.tailWidth}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){var p,v,g,E,w,L,F;return xi().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,w=E===void 0?!0:E,L=p.depth,F=L===void 0?!1:L,this.layer.triangulation=$0,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:nA,fragmentShader:rA,triangulation:$0,blend:this.getBlend(),depth:{enable:F},stencil:Ne(g,w)}).then(function(q){u([q])}).catch(function(q){console.warn(q),u([])});case 3:case"end":return j.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g,E,w){return w===void 0?[v[3],10]:[v[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function iA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=aA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function aA(e,a){if(!!e){if(typeof e=="string")return r1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r1(e,a)}}function r1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var oA=function(){function e(a,t,i){(0,Ft.Z)(this,e),(0,ye.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(a/i),this.yCellCount=Math.ceil(t/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,Tt.Z)(e,[{key:"insert",value:function(t,i,r,o,u){this.forEachCell(i,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!1,u)}},{key:"hitTest",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,i,r,o,u,p){this.boxCells[u].push(p)}},{key:"queryHitTest",value:function(t,i,r,o,u,p){if(r<0||t>this.width||o<0||i>this.height)return u?!1:[];var v=[];if(t<=0&&i<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var g=0;g<this.boxKeys.length;g++)v.push({key:this.boxKeys[g],x1:this.bboxes[g*4],y1:this.bboxes[g*4+1],x2:this.bboxes[g*4+2],y2:this.bboxes[g*4+3]});return p?v.filter(p):v}var E={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,i,r,o,this.queryCell,v,E,p),u?v.length>0:v}},{key:"queryCell",value:function(t,i,r,o,u,p,v,g){var E=v.seenUids,w=this.boxCells[u];if(w!==null){var L=this.bboxes,F=iA(w),U;try{for(F.s();!(U=F.n()).done;){var j=U.value;if(!E.box[j]){E.box[j]=!0;var q=j*4;if(t<=L[q+2]&&i<=L[q+3]&&r>=L[q+0]&&o>=L[q+1]&&(!g||g(this.boxKeys[j]))){if(v.hitTest)return p.push(!0),!0;p.push({key:this.boxKeys[j],x1:L[q],y1:L[q+1],x2:L[q+2],y2:L[q+3]})}}}}catch(ae){F.e(ae)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(t,i,r,o,u,p,v,g){for(var E=this.convertToXCellCoord(t),w=this.convertToYCellCoord(i),L=this.convertToXCellCoord(r),F=this.convertToYCellCoord(o),U=E;U<=L;U++)for(var j=w;j<=F;j++){var q=this.xCellCount*j+U;if(u.call(this,t,i,r,o,q,p,v,g))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),sA=oA,uA=function(){function e(a,t){(0,Ft.Z)(this,e),(0,ye.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new sA(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,Tt.Z)(e,[{key:"placeCollisionBox",value:function(t){var i=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,r,o,u)||this.grid.hitTest(i,r,o,u)?{box:[]}:{box:[i,r,o,u]}}},{key:"insertCollisionBox",value:function(t,i){var r={featureIndex:i};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,i,r){var o=T0(i,r,0,1),u=ap(),p=hn.apply(We,(0,_e.Z)(t));return s0(u,o,p),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,i,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&i<this.gridBottomBoundary}}]),e}();function n1(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function lA(e,a){if(!!e){if(typeof e=="string")return i1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i1(e,a)}}function i1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function a1(e){var a=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function o1(e,a,t,i,r){if(!!r){var o=e[i],u=o.glyph;if(u)for(var p=a[u].advance*o.scale,v=(e[i].x+p)*r,g=t;g<=i;g++)e[g].x-=v}}function s1(e,a,t,i,r,o,u){var p=(a-t)*r,v=(-i*u+.5)*o,g=n1(e),E;try{for(g.s();!(E=g.n()).done;){var w=E.value;w.x+=p,w.y+=v}}catch(L){g.e(L)}finally{g.f()}}function cA(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,w=e.positionedGlyphs,L=o==="right"?1:o==="left"?0:.5,F=w.length;t.forEach(function(pe){if(pe.split("").forEach(function(Qe){var yt=a[Qe],vt=0;yt&&(w.push({glyph:Qe,x:v,y:g+vt,vertical:!1,scale:1,metrics:yt}),v+=yt.advance+u)}),w.length!==F){var Fe=v-u;E=Math.max(Fe,E),o1(w,a,F,w.length-1,L)}v=0,g-=i+5});var U=a1(r),j=U.horizontalAlign,q=U.verticalAlign;s1(w,L,j,q,E,i,t.length);var ae=g-p;e.top+=-q*ae,e.bottom=e.top-ae,e.left+=-j*E,e.right=e.left+E}function fA(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,w=e.positionedGlyphs,L=o==="right"?1:o==="left"?0:.5,F=w.length;t.forEach(function(pe){var Fe=a[pe],Qe=0;if(Fe&&(w.push({glyph:pe,x:Fe.advance/2,y:g+Qe,vertical:!1,scale:1,metrics:Fe}),v+=Fe.advance+u),w.length!==F){var yt=v-u;E=Math.max(yt,E),o1(w,a,F,w.length-1,L)}v=0,g-=i+5});var U=a1(r),j=U.horizontalAlign,q=U.verticalAlign;s1(w,L,j,q,E,i,t.length);var ae=g-p;e.top+=-q*ae,e.bottom=e.top-ae,e.left+=-j*E,e.right=e.left+E}function hA(e,a,t,i,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],p=arguments.length>7?arguments[7]:void 0,v=e.split(`
`),g=[],E={positionedGlyphs:g,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:v.length,text:e};return p?fA(E,a,v,t,i,r,o):cA(E,a,v,t,i,r,o),g.length?E:!1}function pA(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,r=i===void 0?[]:i,o=[],u=n1(r),p;try{for(u.s();!(p=u.n()).done;){var v=p.value,g=v.metrics,E=4,w=g.advance*v.scale/2,L=t?[v.x+w,v.y]:[0,0],F=t?[0,0]:[v.x+w+a[0],v.y+a[1]],U=(0-E)*v.scale-w+F[0],j=(0-E)*v.scale+F[1],q=U+g.width*v.scale,ae=j+g.height*v.scale,pe={x:U,y:j},Fe={x:q,y:j},Qe={x:U,y:ae},yt={x:q,y:ae};o.push({tl:pe,tr:Fe,bl:Qe,br:yt,tex:g,glyphOffset:L})}}catch(vt){u.e(vt)}finally{u.f()}return o}function dA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function vA(e,a){if(!!e){if(typeof e=="string")return u1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u1(e,a)}}function u1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function mA(e){var a=gA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,c1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function f1(e){var a=this,t=e.id,i=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(p,v){i.push.apply(i,(0,_e.Z)(u).concat([p.tex.x,p.tex.y+p.tex.height,p.tl.x,p.tl.y],(0,_e.Z)(u),[p.tex.x+p.tex.width,p.tex.y+p.tex.height,p.tr.x,p.tr.y],(0,_e.Z)(u),[p.tex.x+p.tex.width,p.tex.y,p.br.x,p.br.y],(0,_e.Z)(u),[p.tex.x,p.tex.y,p.bl.x,p.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:i,indices:r,size:7}}var oy=function(e){(0,an.Z)(t,e);var a=mA(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"glyphInfoMap",{}),(0,ye.Z)((0,Gt.Z)(i),"currentZoom",-1),(0,ye.Z)((0,Gt.Z)(i),"textureHeight",0),(0,ye.Z)((0,Gt.Z)(i),"textCount",0),(0,ye.Z)((0,Gt.Z)(i),"preTextStyle",{}),(0,ye.Z)((0,Gt.Z)(i),"buildModels",function(){var p=(0,Ua.Z)(xi().mark(function v(g){var E,w,L,F,U;return xi().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:E=i.layer.getLayerConfig(),w=E.mask,L=w===void 0?!1:w,F=E.maskInside,U=F===void 0?!0:F,i.mapping(),i.layer.buildLayerModel({moduleName:"pointText",vertexShader:c1,fragmentShader:l1,triangulation:f1.bind((0,Gt.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:Ne(L,U)}).then(function(ae){g([ae])}).catch(function(ae){console.warn(ae),g([])});case 3:case"end":return q.stop()}},v)}));return function(v){return p.apply(this,arguments)}}()),(0,ye.Z)((0,Gt.Z)(i),"mapping",function(){i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel()}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.stroke,v=p===void 0?"#fff":p,g=r.strokeWidth,E=g===void 0?0:g,w=r.textAnchor,L=w===void 0?"center":w,F=r.textAllowOverlap,U=F===void 0?!1:F,j=r.halo,q=j===void 0?.5:j,ae=r.gamma,pe=ae===void 0?2:ae,Fe=r.raisingHeight,Qe=Fe===void 0?0:Fe,yt=this.fontService,vt=yt.canvas,Bt=yt.mapping;if(Object.keys(Bt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Bt).length),this.preTextStyle={textAnchor:L,textAllowOverlap:U},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:E,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:E,stroke:v});var Qt=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,Qt,this.cellProperties),Or=Ir.data,Tr=Ir.width,on=Ir.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Or.length>0?this.createTexture2D({flipY:!0,data:Or,format:X.LUMINANCE,type:X.FLOAT,width:Tr,height:on}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Qe),u_opacity:(0,gr.isNumber)(u)?u:1,u_stroke_width:(0,gr.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:q,u_gamma_scale:pe,u_sdf_map_size:[vt.width,vt.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,p=u===void 0?"center":u,v=o.textAllowOverlap,g=v===void 0?!0:v;this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels(r)}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),o=r.textAllowOverlap,u=o===void 0?!1:o,p=this.mapService.getZoom(),v=this.mapService.getBounds(),g=Zl(this.extent,v);return!u&&(Math.abs(this.currentZoom-p)>1||!g)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.rotate,E=g===void 0?0:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Gn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?12:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Gn.Attribute,descriptor:{name:"a_tex",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return bc(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(w){var L=w.shape,F=L===void 0?"":L;F=F.toString();var U=dA(F),j;try{for(U.s();!(j=U.n()).done;){var q=j.value;E.indexOf(q)===-1&&E.push(q)}}catch(ae){U.e(ae)}finally{U.f()}}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(w){var L=w.shape,F=L===void 0?"":L;F="".concat(F),E.indexOf(F)===-1&&E.push(F)}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,p=this.layer.getLayerConfig(),v=p.spacing,g=v===void 0?2:v,E=p.textAnchor,w=E===void 0?"center":E,L=this.layer.getEncodedData();this.glyphInfo=L.map(function(F){var U=F.shape,j=U===void 0?"":U,q=F.id,ae=F.size,pe=ae===void 0?1:ae,Fe=F.textOffset,Qe=Fe===void 0?[0,0]:Fe,yt=hA(j.toString(),u,pe,w,"left",g,Qe,r),vt=pA(yt,Qe,!1);return F.shaping=yt,F.glyphQuads=vt,F.centroid=c(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?c(F.originCoordinates):F.originCentroid=F.centroid,o.glyphInfoMap[q]={shaping:yt,glyphQuads:vt,centroid:c(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,p=u===void 0?[4,4]:u,v=o.textAllowOverlap,g=v===void 0?!1:v;if(!g){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var E=this.rendererService.getViewportSize(),w=E.width,L=E.height,F=new uA(w,L),U=this.glyphInfo.filter(function(j){var q=j.shaping,ae=j.id,pe=ae===void 0?0:ae,Fe=j.version==="GAODE2.x"?j.originCentroid:j.centroid,Qe=j.size,yt=Qe/24,vt=r.mapService.lngLatToContainer(Fe),Bt=F.placeCollisionBox({x1:q.left*yt-p[0],x2:q.right*yt+p[0],y1:q.top*yt-p[1],y2:q.bottom*yt+p[1],anchorPointX:vt.x,anchorPointY:vt.y}),Qt=Bt.box;return Qt&&Qt.length?(F.insertCollisionBox(Qt,pe),!0):!1});U.forEach(function(j){r.glyphInfoMap[j.id]=j})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:X.LINEAR,min:X.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:c1,fragmentShader:l1,triangulation:f1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r.layer.models=[E],r.layer.renderLayers()}).catch(function(E){console.warn(E),r.layer.models=[]})}}]),t}(Ro);function yA(e){var a=_A();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,bA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,hg=function(e){(0,an.Z)(t,e);var a=yA(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"meter2coord",1),(0,ye.Z)((0,Gt.Z)(i),"isMeter",!1),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,w=r.stroke,L=w===void 0?"rgba(0,0,0,0)":w,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,q=r.blur,ae=q===void 0?0:q,pe=r.coord,Fe=pe===void 0?"lnglat":pe,Qe=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U});var yt=this.layer.getEncodedData(),vt=this.calDataFrame(this.cellLength,yt,this.cellProperties),Bt=vt.data,Qt=vt.width,Ir=vt.height;this.rowCount=Ir,this.dataTexture=this.cellLength>0&&Bt.length>0?this.createTexture2D({flipY:!0,data:Bt,format:X.LUMINANCE,type:X.FLOAT,width:Qt,height:Ir}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:Qe||[0,0],u_coord:Fe==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_stroke_opacity:Number(v),u_stroke_width:Number(E),u_stroke_color:this.getStrokeColor(L),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),q0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),L=1,F=L*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var q=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(q+ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.workerEnabled,w=E===void 0?!1:E;this.layer.triangulation=q0,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:bA,fragmentShader:xA,triangulation:q0,depth:{enable:!1},cull:{enable:!0,face:If(this.mapService.version)},blend:this.getBlend(),stencil:Ne(p,g),workerEnabled:w,workerOptions:{modelType:"pointTile"}}).then(function(L){r([L])}).catch(function(L){console.warn(L),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=g%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]*r.meter2coord]:[w*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,w=E===void 0?2:E,L=r.layer.getLayerConfig().shape2d,F=L.indexOf(w);return[F]}}})}}]),t}(Ro);function EA(e){var a=CA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function CA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,AA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,h1=function(e){(0,an.Z)(t,e);var a=EA(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.tileOrigin,v=r.coord,g=v===void 0?"lnglat":v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var E=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,E,this.cellProperties),L=w.data,F=w.width,U=w.height;this.rowCount=U,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:X.LUMINANCE,type:X.FLOAT,width:F,height:U}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:p||[0,0],u_coord:g==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:u}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=pm,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:AA,fragmentShader:SA,triangulation:pm,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Ro);function wA(e){var a=TA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MA=function(e){(0,an.Z)(t,e);var a=wA(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"isVector",!0),(0,ye.Z)((0,Gt.Z)(i),"type",i.layerType),(0,ye.Z)((0,Gt.Z)(i),"pickedID",null),i}return(0,Tt.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return h1;case"LineLayer":return t1;case"PointLayer":return this.getPointModel();default:return hg}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=r.find(function(g){return g.hasOwnProperty("shape")});if(p){var v=p.shape;return(u==null?void 0:u.indexOf(v))!==-1?hg:oy}else return hg}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(dd),IA=fe(32676);function kA(e,a,t){t===void 0&&(t={});var i=ro(e),r=ro(a),o=IA.union(i.coordinates,r.coordinates);return o.length===0?null:o.length===1?ui(o[0],t.properties):Pt(o,t.properties)}var PA=kA,dm=function(){function e(a){(0,Ft.Z)(this,e),(0,ye.Z)(this,"outSideEventTimer",null),(0,ye.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,Tt.Z)(e,[{key:"createTile",value:function(t,i){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,i){var r={features:[],featureId:null,vectorTileLayer:null,source:null},o=i.sourceLayer,u=i.featureId;if(!o)return r;var p=t.data.layers[o],v=p==null?void 0:p.features;if(Array.isArray(v)&&v.length>0){var g=new vo({type:"FeatureCollection",features:v},{parser:{type:"geojson",featureId:u}});return{features:v,featureId:u,vectorTileLayer:p,source:g}}else return r}},{key:"createLayer",value:function(t){var i=t.L7Layer,r=t.tile,o=t.initOptions,u=t.vectorTileLayer,p=t.source,v=o.mask,g=o.color,E=o.layerType,w=o.size,L=o.shape,F=i||MA,U=new F((0,Z.Z)({visible:r.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord},this.getLayerInitOption(o)));U.isVector&&(this.emitEvent([U]),U.type=E,U.select(!0)),U.source(p),this.setScale(U),this.setStyleAttributeField(U,"shape",L),this.setStyleAttributeField(U,"color",g),this.setStyleAttributeField(U,"size",w);var j=[U];if(v&&U.isVector){var q=new Q_().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");j.push(q),U.addMaskLayer(q)}return J_(this.parentLayer,j),this.layers=[U],U}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,i){switch(i){case"size":return 2;case"color":return"#fff";case"shape":return e1(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,i,r){if(Array.isArray(r)){t[i].apply(t,(0,_e.Z)(r));return}if(typeof r=="string"){t[i](r);return}var o=this.getDefautStyleAttributeField(t,i);if(!r)return t[i](o),t;var u=this.parseScaleValue(r,i);u.length===0?t[i](o):t[i].apply(t,(0,_e.Z)(u))}},{key:"parseScaleValue",value:function(t,i){if(i==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var r=t,o=r.field,u=r.values,p=r.callback;return o&&u&&Array.isArray(u)?[o,u]:o&&p?[o,p]:o?[o]:[]}},{key:"getTile",value:function(t,i){var r=this.mapService.getZoom(),o=Math.ceil(r)+this.zoomOffset,u=Jc(t,i,o),p=this.tilesetManager.tiles.filter(function(g){return g.key==="".concat(u[0],",").concat(u[1],",").concat(o)}),v=p[0];return v}},{key:"emitEvent",value:function(t,i){var r=this;t.map(function(o){o.once("inited",function(){o.on("click",function(u){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerClick",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerClick",u)}),o.on("mousemove",function(u){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u)}),o.on("mouseup",function(u){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(o,"subLayerMouseUp",u)}),o.on("mouseenter",function(u){if(r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseEnter",u)}),o.on("mouseout",function(u){r.getFeatureAndEmitEvent(o,"subLayerMouseOut",u)}),o.on("mousedown",function(u){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(o,"subLayerMouseDown",u)}),o.on("contextmenu",function(u){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(o,"subLayerContextmenu",u)}),o.on("unclick",function(u){return r.handleOutsideEvent("click","subLayerUnClick",o,u)}),o.on("unmouseup",function(u){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",o,u)}),o.on("unmousedown",function(u){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",o,u)}),o.on("uncontextmenu",function(u){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",o,u)})})})}},{key:"getCombineFeature",value:function(t){var i=null,r=t[0];return t.map(function(o){var u=ui(o.coordinates);i===null&&(i=u),i=PA(i,u)}),r&&(i.properties=(0,Z.Z)({},r)),i}},{key:"getFeatureAndEmitEvent",value:function(t,i,r,o,u){if(o===!1)r.value=JS(u,this.mapService,r.x,r.y);else{var p=r.featureId,v=this.getAllFeatures(p);try{r.feature=this.getCombineFeature(v)}catch(g){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=v[0]}}this.parentLayer.emit(i,r)}},{key:"setScale",value:function(t){var i=this.parentLayer.tileLayer.scaleField,r=Object.keys(i);r.map(function(o){t.scale(o,i[o])})}},{key:"getAllFeatures",value:function(t){var i=this.parentLayer.tileLayer.children,r=[];return i.map(function(o){var u=o.getSource();u.data.dataArray.map(function(p){p._id===t&&r.push(p)})}),r}},{key:"getLayerInitOption",value:function(t){var i=(0,Z.Z)({},t);return delete i.color,delete i.shape,delete i.size,delete i.coords,delete i.sourceLayer,delete i.coords,i}},{key:"handleOutsideEvent",value:function(t,i,r,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[t]>0?u.eventCache[t]=0:u.getFeatureAndEmitEvent(r,i,o)},64)}}]),e}();function RA(e){var a=LA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=function(e){(0,an.Z)(t,e);var a=RA(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,Tt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(dm);function FA(e){var a=DA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function DA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=function(e){(0,an.Z)(t,e);var a=FA(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,Tt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(dm);function NA(e){var a=zA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function zA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=function(e){(0,an.Z)(t,e);var a=NA(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,Tt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(dm);function ZA(e){var a=VA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p1=function(e){(0,an.Z)(t,e);var a=ZA(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,Tt.Z)(t,[{key:"createTile",value:function(r,o){var u=new vo(r.data,{parser:{type:"image",extent:r.bounds}}),p=this.createLayer({L7Layer:K_,tile:r,initOptions:o,source:u});return{layers:[p],layerIDList:[p.id]}}}]),t}(dm);function jA(e){var a=GA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function GA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,WA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,sy=function(e){(0,an.Z)(t,e);var a=jA(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.clampLow,v=p===void 0?!0:p,g=r.clampHigh,E=g===void 0?!0:g,w=r.noDataValue,L=w===void 0?-9999999:w,F=r.domain,U=F===void 0?[0,1]:F,j=r.rampColors;return(0,gr.isEqual)(this.rampColors,j)||(this.updateColorTexure(),this.rampColors=j),{u_opacity:u||1,u_texture:this.texture,u_domain:U,u_clampLow:v,u_clampHigh:typeof E!="undefined"?E:v,u_noDataValue:L,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.rampColorsData,w=o.rampColors,L=this.layer.getSource(),F=this.rendererService.createTexture2D,U=L.data.dataArray[0];this.texture=F({data:U.data,width:U.width,height:U.height,format:X.LUMINANCE,type:X.FLOAT});var j=E||xe(w);this.colorTexture=F({data:j.data,width:j.width,height:j.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:WA,fragmentShader:HA,triangulation:ay,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Ne(p,g)}).then(function(q){r([q])}).catch(function(q){console.warn(q),r([])})}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=xe(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(Ro);function XA(e){var a=YA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=function(e){(0,an.Z)(t,e);var a=XA(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type",i.layerType),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){return sy}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(dd);function $A(e){var a=KA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QA=function(e){(0,an.Z)(t,e);var a=$A(t);function t(i){var r;return(0,Ft.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,Tt.Z)(t,[{key:"createTile",value:function(r,o){var u=o.opacity,p=o.domain,v=o.clampHigh,g=o.clampLow,E=o.rampColors,w=o.rampColorsData,L=o.mask,F=r.data;if(!F.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var U=new qA({visible:r.isVisible,mask:L}).source(F.data,{parser:{type:"raster",width:F.width,height:F.height,extent:r.bboxPolygon.bbox}}).style({opacity:u,domain:p,clampHigh:v,clampLow:g,rampColors:E,rampColorsData:w});return this.emitEvent([U],!1),J_(this.parentLayer,[U]),{layers:[U],layerIDList:[U.id]}}}]),t}(dm);function JA(e,a){switch(e){case"PolygonLayer":return UA;case"LineLayer":return OA;case"PointLayer":return BA;case"RasterLayer":return a.dataType==="arraybuffer"?QA:p1;default:return console.warn("Current Tile Not Exist!"),p1}}function ew(e){var a=tw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rw=function(e){(0,an.Z)(t,e);var a=ew(t);function t(){var i;return(0,Ft.Z)(this,t),i=a.call(this),(0,ye.Z)((0,Gt.Z)(i),"checkConfigList",[]),i.cacheConfig=new Map,i}return(0,Tt.Z)(t,[{key:"setConfig",value:function(r,o){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,o)}},{key:"removeConfig",value:function(r){var o=this.checkConfigList.indexOf(r);o>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(r){var o=this;if(!!r.inited){var u=r.getLayerConfig(),p=[];this.checkConfigList.map(function(v){var g=o.cacheConfig.get(v),E;if(["color","size","shape"].includes(v)){var w;E=(w=r.getAttribute(v))===null||w===void 0?void 0:w.scale}else{if(!(v in u))return;E=u[v]}(0,gr.isEqual)(g,E)||(p.push(v),o.setConfig(v,E))}),p.length>0&&(console.warn("tile config cache update!",p),this.emit("updateConfig",p))}}},{key:"getAttributeScale",value:function(r,o){var u=r.getAttribute(o),p={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var v=u.scale,g=v.field,E=v.values,w=v.callback;p.field=g,p.values=E,p.callback=w}return p}}]),t}(Bu());function nw(e){var a=iw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=function(e){(0,an.Z)(t,e);var a=nw(t);function t(i,r,o,u,p){var v;return(0,Ft.Z)(this,t),v=a.call(this),(0,ye.Z)((0,Gt.Z)(v),"isLastPicked",!1),v.parent=i,v.rendererService=r,v.pickingService=o,v.layerService=p,v.children=u,v}return(0,Tt.Z)(t,[{key:"normalRender",value:function(r){var o=this;r.filter(function(u){return u.inited}).filter(function(u){return u.isVisible()}).map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(p){p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.render(),p.hooks.afterRender.call()})),u.render(),u.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,o){var u=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var p=r.filter(function(v){return u.parent.needPick(o.type)&&v.inited&&v.isVisible()}).some(function(v){v.hooks.beforePickingEncode.call(),v.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(E){E.hooks.beforeRender.call(),E.render(),E.hooks.afterRender.call()})),v.renderModels(!0),v.hooks.afterPickingEncode.call();var g=u.pickingService.pickFromPickingFBO(v,o);return g&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:v}),u.pickingService.pickedTileLayers=[u.parent]),g});return this.parent.type!=="RasterLayer"&&!p&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=p,p}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(o){o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),t}(ua.EventEmitter),ow=function(){function e(a,t,i,r,o){(0,Ft.Z)(this,e),this.parent=a,this.children=a.layerChildren,this.mapService=t,this.rendererService=i,this.tilePickManager=new aw(a,i,r,this.children,o),this.tileConfigManager=new rw,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,Tt.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,i,r){t.map(function(o){i==="mask"?o.style({mask:r}):o.updateLayerConfig((0,ye.Z)({},i,r))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var i;(i=this.children).push.apply(i,(0,_e.Z)(t))}},{key:"removeChilds",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],o=[];this.children.filter(function(u){t.includes(u.id)?r.push(u):o.push(u)}),r.map(function(u){return u.destroy(i)}),this.children=o}},{key:"removeChild",value:function(t){var i=this.children.indexOf(t);i>-1&&this.children.splice(i,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(i){return t.includes(i.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(i){return i.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,i;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(i=this.tilePickManager)===null||i===void 0||i.normalRender(this.children)}},{key:"pickLayers",value:function(t){var i;return(i=this.tilePickManager)===null||i===void 0?void 0:i.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,i=this.parent.getLayerConfig(),r=i.zIndex,o=r===void 0?0:r,u=i.opacity,p=u===void 0?1:u,v=i.mask,g=v===void 0?!1:v,E=i.stroke,w=E===void 0?"#fff":E,L=i.strokeWidth,F=L===void 0?0:L,U=i.strokeOpacity,j=U===void 0?1:U,q=i.clampLow,ae=q===void 0?!0:q,pe=i.clampHigh,Fe=pe===void 0?!0:pe,Qe=i.domain,yt=Qe===void 0?[0,1]:Qe,vt=i.rampColors,Bt=vt===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:vt,Qt=i.featureId,Ir=Qt===void 0?"id":Qt,Or=i.workerEnabled,Tr=Or===void 0?!1:Or,on=i.sourceLayer,kn=i.pixelConstant,si=kn===void 0?0:kn,Xa=i.pixelConstantR,bo=Xa===void 0?256*256:Xa,Ss=i.pixelConstantG,ru=Ss===void 0?256:Ss,Xu=i.pixelConstantB,sh=Xu===void 0?1:Xu,nv=i.pixelConstantRGB,Rm=nv===void 0?.1:nv,iv=this.tileConfigManager.getAttributeScale(this.parent,"color"),zv=this.tileConfigManager.getAttributeScale(this.parent,"size"),av=this.parent.getSource(),Uv=(av==null||(t=av.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Zy=Uv.coords,Vy=e1(this.parent.type,this.parent);Bt&&(this.rampColorsData=xe(Bt)),this.initOptions={layerType:this.parent.type,shape:Vy,zIndex:o,opacity:p,sourceLayer:on,coords:Zy,featureId:Ir,color:iv,size:zv,mask:KS(this.parent.type,g),stroke:w,strokeWidth:F,strokeOpacity:j,clampLow:ae,clampHigh:Fe,domain:yt,rampColors:Bt,rampColorsData:this.rampColorsData,workerEnabled:Tr,pixelConstant:si,pixelConstantR:bo,pixelConstantG:ru,pixelConstantB:sh,pixelConstantRGB:Rm}}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var i,r,o;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(i=this.parent.getAttribute("color"))===null||i===void 0?void 0:i.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(o=this.parent.getAttribute("size"))===null||o===void 0?void 0:o.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(p){return t.updateStyle(p),""})})}},{key:"updateStyle",value:function(t){var i=this,r=null;if(["size","color","shape"].includes(t)){var o,u=(o=this.parent.getAttribute(t))===null||o===void 0?void 0:o.scale;if(!u)return;r=u,this.children.map(function(g){return i.tileFactory.setStyleAttributeField(g,t,u),""})}else{var p=this.parent.getLayerConfig();if(!(t in p))return;var v=p[t];r=v,this.updateLayersConfig(this.children,t,v),t==="rampColors"&&v&&(this.rampColorsData=xe(v))}this.initOptions[t]=r}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),i=JA(this.parent.type,t.parser);this.tileFactory=new i({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),sw=function(){function e(a){var t,i=a.parent,r=a.rendererService,o=a.mapService,u=a.layerService,p=a.pickingService;(0,Ft.Z)(this,e),(0,ye.Z)(this,"type","baseTile"),(0,ye.Z)(this,"initedTileset",!1),(0,ye.Z)(this,"pickColors",{select:null,active:null});var v=i.getSource(),g=(v==null||(t=v.data)===null||t===void 0?void 0:t.tilesetOptions)||{},E=g.sourceLayer,w=g.coords,L=g.featureId;this.sourceLayer=E,this.parent=i,this.mapService=o,this.layerService=u,this.tileLayerManager=new ow(i,o,r,p,u),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,Tt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){t.selectFeature(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(i){return i.isLoaded}).map(function(i){if(i.layerIDList.length===0){var r=t.tileLayerManager.createTile(i),o=r.layers,u=r.layerIDList;i.layerIDList=u,t.tileLayerManager.addChilds(o)}else{if(!i.isVisibleChange)return;var p=t.tileLayerManager.getChilds(i.layerIDList);t.tileLayerManager.updateLayersConfig(p,"visible",i.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var i=this;if(this.pickColors.select){var r=Y(this.pickColors.select);t.map(function(u){i.selectFeature(u,i.pickColors.select),u.setCurrentSelectedId(r)})}if(this.pickColors.active){var o=Y(this.pickColors.active);t.filter(function(u){return u.inited&&u.isVisible()}).map(function(u){u.hooks.beforeHighlight.call(i.pickColors.active),u.setCurrentPickId(o)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(i){var r=(0,Pr.Z)(i.pickedColors,3),o=r[0],u=r[1],p=r[2];if(i.type==="click"){var v=t.children.filter(function(g){return g.inited&&g.isVisible()&&g.isVector}).filter(function(g){return g!==i.layer});t.setSelect(v,[o,u,p])}else t.setHighlight([o,u,p])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var i=Y(t);this.pickColors.active=t,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==i}).map(function(r){r.setPickID(i),r.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,i){var r=this,o=Y(i);t.map(function(p){p.getCurrentSelectedId()===null||o!==p.getCurrentSelectedId()?(r.selectFeature(p,i),p.setCurrentSelectedId(o),r.pickColors.select=i):(r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null),r.pickColors.select=null)});var u=this.layerService.getRenderList();u.filter(function(p){return p.inited&&!p.isVector&&p.isVisible()&&p.needPick("click")}).filter(function(p){return p.getCurrentSelectedId()!==null}).map(function(p){r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,i){var r=(0,Pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(i){t.parent.emit("click",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseMove",function(i){return t.parent.emit("mousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseUp",function(i){return t.parent.emit("mouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseEnter",function(i){return t.parent.emit("mouseenter",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseOut",function(i){return t.parent.emit("mouseout",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseDown",function(i){return t.parent.emit("mousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerContextmenu",function(i){return t.parent.emit("contextmenu",(0,Z.Z)({},i))}),this.parent.on("subLayerUnClick",function(i){return t.parent.emit("unclick",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseMove",function(i){return t.parent.emit("unmousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseUp",function(i){return t.parent.emit("unmouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseDown",function(i){return t.parent.emit("unmousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerUnContextmenu",function(i){return t.parent.emit("uncontextmenu",(0,Z.Z)({},i))})}},{key:"initTileSetManager",value:function(){var t,i=this.parent.getSource();this.tilesetManager=i.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,i=this.getCurrentView(),r=i.latLonBounds,o=i.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),p=u.visible;o<3&&p?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):o>=3&&!p&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(o,r))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(i){}),this.tilesetManager.on("tile-unload",function(i){t.tileUnLoad(i)}),this.tilesetManager.on("tile-error",function(i,r){t.tileError(i)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),i=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:i,zoom:r}}}]),e}();function uw(e){var a=lw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cw=function(e){(0,an.Z)(t,e);var a=uw(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","TMS"),i}return(0,Tt.Z)(t,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(o){return o.isLoaded}).map(function(o){var u;if((u=o.data)!==null&&u!==void 0&&u.layers&&r.sourceLayer){var p=o.data.layers[r.sourceLayer],v=p==null?void 0:p.features;if(!(Array.isArray(v)&&v.length>0))return}if(o.parentLayerIDList.includes(r.parent.id)){if(!o.isVisibleChange)return;var F=r.tileLayerManager.getChilds(o.layerIDList);r.tileLayerManager.updateLayersConfig(F,"visible",o.isVisible),r.setPickState(F)}else{var g,E=r.tileLayerManager.createTile(o),w=E.layers,L=E.layerIDList;o.parentLayerIDList.push(r.parent.id),(g=o.layerIDList).push.apply(g,(0,_e.Z)(L)),r.tileLayerManager.addChilds(w),r.setPickState(w)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(sw);function fw(e){var a=hw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pg=function(e){(0,an.Z)(t,e);var a=fw(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r;return(r=this.layer.getSource())!==null&&r!==void 0&&r.data.isTile&&(this.layer.tileLayer=new cw({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Ro);function pw(e){var a=dw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vw=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,mw=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,gw=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,yw=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,_w=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,xw=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,bw={solid:0,dash:1},Ew=function(e){(0,an.Z)(t,e);var a=pw(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.lineType,L=w===void 0?"solid":w,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.forward,q=j===void 0?!0:j,ae=r.lineTexture,pe=ae===void 0?!1:ae,Fe=r.iconStep,Qe=Fe===void 0?100:Fe,yt=r.segmentNumber,vt=yt===void 0?30:yt,Bt=r.thetaOffset,Qt=Bt===void 0?.314:Bt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Qt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Qt});var Ir=this.layer.getEncodedData(),Or=this.calDataFrame(this.cellLength,Ir,this.cellProperties),Tr=Or.data,on=Or.width,kn=Or.height;this.rowCount=kn,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:X.LUMINANCE,type:X.FLOAT,width:on,height:kn}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}U.length===2&&U.push(0,0);var si=0,Xa=[0,0,0,0],bo=[0,0,0,0];return p&&v&&(Xa=B(p),bo=B(v),si=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,gr.isNumber)(Qt)?Qt:0,u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:vt,u_line_type:bw[L||"solid"],u_dash_array:U,u_blur:.9,u_lineDir:q?1:-1,u_texture:this.texture,u_line_texture:pe?1:0,u_icon_step:Qe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:si,u_sourceColor:Xa,u_targetColor:bo}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:vw,vert:mw,type:"Dash"}:o&&u?{frag:_w,vert:xw,type:"Linear"}:{frag:gw,vert:yw,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,w=E===void 0?!0:E,L=this.getShaders(),F=L.frag,U=L.vert,j=L.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+j,vertexShader:U,fragmentShader:F,triangulation:cg,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Ne(g,w)}).then(function(q){r([q])}).catch(function(q){console.warn(q),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function Cw(e){var a=Sw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ww=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Tw=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Mw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Iw={solid:0,dash:1},kw=function(e){(0,an.Z)(t,e);var a=Cw(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.lineType,L=w===void 0?"solid":w,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,q=j===void 0?!1:j,ae=r.iconStep,pe=ae===void 0?100:ae,Fe=r.segmentNumber,Qe=Fe===void 0?30:Fe,yt=r.globalArcHeight,vt=yt===void 0?10:yt;U.length===2&&U.push(0,0);var Bt=0,Qt=[0,0,0,0],Ir=[0,0,0,0];if(p&&v&&(Qt=B(p),Ir=B(v),Bt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Or=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,Or,this.cellProperties),on=Tr.data,kn=Tr.width,si=Tr.height;this.rowCount=si,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:X.LUMINANCE,type:X.FLOAT,width:kn,height:si}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ty,u_global_height:vt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Qe,u_line_type:Iw[L]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bt,u_sourceColor:Qt,u_targetColor:Ir}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:Tw,vert:Mw,type:"Linear"}:{frag:Aw,vert:ww,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,w=E===void 0?!0:E,L=this.getShaders(),F=L.frag,U=L.vert,j=L.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+j,vertexShader:U,fragmentShader:F,triangulation:cg,blend:this.getBlend(),segmentNumber:p,stencil:Ne(g,w)}).then(function(q){r([q])}).catch(function(q){console.warn(q),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function Pw(e){var a=Rw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Ow=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Fw=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Dw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Bw={solid:0,dash:1},Nw=function(e){(0,an.Z)(t,e);var a=Pw(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.lineType,L=w===void 0?"solid":w,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,q=j===void 0?!1:j,ae=r.iconStep,pe=ae===void 0?100:ae,Fe=r.segmentNumber,Qe=Fe===void 0?30:Fe,yt=r.globalArcHeight,vt=yt===void 0?10:yt;U.length===2&&U.push(0,0);var Bt=0,Qt=[0,0,0,0],Ir=[0,0,0,0];if(p&&v&&(Qt=B(p),Ir=B(v),Bt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Or=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,Or,this.cellProperties),on=Tr.data,kn=Tr.width,si=Tr.height;this.rowCount=si,this.dataTexture=this.cellLength>0&&on.length>0?this.createTexture2D({flipY:!0,data:on,format:X.LUMINANCE,type:X.FLOAT,width:kn,height:si}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:ty,u_global_height:vt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Qe,u_line_type:Bw[L]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bt,u_sourceColor:Qt,u_targetColor:Ir}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:Fw,vert:Dw,type:"Linear"}:{frag:Lw,vert:Ow,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,w=E===void 0?!0:E,L=this.getShaders(),F=L.frag,U=L.vert,j=L.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+j,vertexShader:U,fragmentShader:F,triangulation:cg,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:Ne(g,w)}).then(function(q){r([q])}).catch(function(q){console.warn(q),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function zw(e){var a=Uw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Vw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,jw={solid:0,dash:1},Gw=function(e){(0,an.Z)(t,e);var a=zw(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.lineType,L=w===void 0?"solid":w,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,q=j===void 0?!1:j,ae=r.iconStep,pe=ae===void 0?100:ae,Fe=r.segmentNumber,Qe=Fe===void 0?30:Fe;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var yt=0,vt=[0,0,0,0],Bt=[0,0,0,0];if(p&&v&&(vt=B(p),Bt=B(v),yt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Qt=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,Qt,this.cellProperties),Or=Ir.data,Tr=Ir.width,on=Ir.height;this.rowCount=on,this.dataTexture=this.cellLength>0&&Or.length>0?this.createTexture2D({flipY:!0,data:Or,format:X.LUMINANCE,type:X.FLOAT,width:Tr,height:on}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Qe,u_line_type:jw[L]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:yt,u_sourceColor:vt,u_targetColor:Bt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:Vw,fragmentShader:Zw,triangulation:cg,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function Hw(e){var a=Ww();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xw=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Yw=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,qw=function(e){(0,an.Z)(t,e);var a=Hw(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.arrow,E=g===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:g,w=0,L=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(L=B(p),F=B(v),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var U=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,U,this.cellProperties),q=j.data,ae=j.width,pe=j.height;this.rowCount=pe,this.dataTexture=this.cellLength>0&&q.length>0?this.createTexture2D({flipY:!0,data:q,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:pe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_linearColor:w,u_sourceColor:L,u_targetColor:F,u_arrow:Number(E.enable),u_arrowHeight:E.arrowHeight||3,u_arrowWidth:E.arrowWidth||2,u_tailWidth:E.tailWidth===void 0?1:E.tailWidth}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){var p,v,g,E,w,L,F,U,j,q;return xi().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,w=E===void 0?!0:E,L=p.depth,F=L===void 0?!1:L,U=this.getShaders(),j=U.frag,q=U.vert,this.layer.triangulation=$0,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:q,fragmentShader:j,triangulation:$0,depth:{enable:F},blend:this.getBlend(),stencil:Ne(g,w)}).then(function(Fe){u([Fe])}).catch(function(Fe){console.warn(Fe),u([])});case 4:case"end":return pe.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:Xw,vert:Yw,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10,p[5]]:[p[3],E,p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:Gn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(o,u,p,v){var g=o.coordinates[0]||[0,0],E=o.coordinates[3]||[0,0];return[g[0],g[1],E[0],E[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(Ro),d1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(d1||(d1={}));var Iv;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Iv||(Iv={}));var uy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(uy||(uy={}));var v1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(v1||(v1={}));function $w(e){var a=Kw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function Kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qw=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,eT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,m1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,tT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,rT={solid:0,dash:1},g1=function(e){(0,an.Z)(t,e);var a=$w(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.lineType,L=w===void 0?"solid":w,F=r.dashArray,U=F===void 0?[10,5,0,0]:F,j=r.lineTexture,q=j===void 0?!1:j,ae=r.iconStep,pe=ae===void 0?100:ae,Fe=r.vertexHeightScale,Qe=Fe===void 0?20:Fe,yt=r.borderWidth,vt=yt===void 0?0:yt,Bt=r.borderColor,Qt=Bt===void 0?"#ccc":Bt,Ir=r.raisingHeight,Or=Ir===void 0?0:Ir,Tr=r.heightfixed,on=Tr===void 0?!1:Tr,kn=r.linearDir,si=kn===void 0?Iv.VERTICAL:kn,Xa=r.blur,bo=Xa===void 0?[1,1,1]:Xa,Ss=r.arrow,ru=Ss===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ss;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Xu=0,sh=[0,0,0,0],nv=[0,0,0,0];if(p&&v&&(sh=B(p),nv=B(v),Xu=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Rm=this.layer.getEncodedData(),iv=this.calDataFrame(this.cellLength,Rm,this.cellProperties),zv=iv.data,av=iv.width,Uv=iv.height;this.rowCount=Uv,this.dataTexture=this.cellLength>0&&zv.length>0?this.createTexture2D({flipY:!0,data:zv,format:X.LUMINANCE,type:X.FLOAT,width:av,height:Uv}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E===uy.NORMAL?0:1,u_line_type:rT[L],u_dash_array:U,u_blur:bo,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:vt,u_borderColor:B(Qt),u_linearDir:si===Iv.VERTICAL?1:0,u_linearColor:Xu,u_sourceColor:sh,u_targetColor:nv,u_heightfixed:Number(on),u_vertexScale:Qe,u_raisingHeight:Number(Or),u_arrow:Number(ru.enable),u_arrowHeight:ru.arrowHeight||3,u_arrowWidth:ru.arrowWidth||2,u_tailWidth:ru.tailWidth===void 0?1:ru.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,w=E===void 0?!1:E,L=o.workerEnabled,F=L===void 0?!1:L,U=o.enablePicking,j=this.getShaders(),q=j.frag,ae=j.vert,pe=j.type;this.layer.triangulation=$c,this.layer.buildLayerModel({moduleName:"line"+pe,vertexShader:ae,fragmentShader:q,triangulation:$c,depth:{enable:w},blend:this.getBlend(),stencil:Ne(p,g),workerEnabled:F,workerOptions:{modelType:"line"+pe,enablePicking:U,iconMap:this.iconService.getIconMap()}}).then(function(Fe){r([Fe])}).catch(function(Fe){console.warn(Fe),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:Qw,vert:Jw,type:"Dash"}:o&&u?{frag:tT,vert:m1,type:"Linear"}:{frag:eT,vert:m1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g,E,w){return w===void 0?[v[3],10]:[v[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function nT(e){var a=iT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function iT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,oT=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,sT=function(e){(0,an.Z)(t,e);var a=nT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;i.colorTexture&&i.colorTexture.destroy();var v=i.layer.getLayerConfig(),g=v.rampColors,E=xe(g);i.colorTexture=p({data:new Uint8Array(E.data),width:E.width,height:E.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.vertexHeightScale,v=p===void 0?20:p,g=r.raisingHeight,E=g===void 0?0:g,w=r.heightfixed,L=w===void 0?!1:w,F=r.linearDir,U=F===void 0?Iv.VERTICAL:F;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var j=this.layer.getEncodedData(),q=this.calDataFrame(this.cellLength,j,this.cellProperties),ae=q.data,pe=q.width,Fe=q.height;this.rowCount=Fe,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:X.LUMINANCE,type:X.FLOAT,width:pe,height:Fe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:U===Iv.VERTICAL?1:0,u_opacity:(0,gr.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(L),u_vertexScale:v,u_raisingHeight:Number(E)}}},{key:"initModels",value:function(r){this.updateTexture(),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,w=E===void 0?!1:E;this.layer.triangulation=$0,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:oT,fragmentShader:aT,triangulation:$0,depth:{enable:w},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(L){r([L])}).catch(function(L){console.warn(L),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(Ro);function uT(e){var a=lT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function lT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cT=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,fT=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,y1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,hT=function(e){(0,an.Z)(t,e);var a=uT(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.vertexHeightScale,E=g===void 0?20:g,w=0,L=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(L=B(p),F=B(v),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var U=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,U,this.cellProperties),q=j.data,ae=j.width,pe=j.height;this.rowCount=pe,this.dataTexture=this.cellLength>0&&q.length>0?this.createTexture2D({flipY:!0,data:q,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:pe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_linearColor:w,u_sourceColor:L,u_targetColor:F,u_vertexScale:E}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:fT,vert:y1,type:"lineSimpleLinear"}:{frag:cT,vert:y1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),w=E.frag,L=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:L,fragmentShader:w,triangulation:zC,primitive:X.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(U){r([U])}).catch(function(U){console.warn(U),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}})}}]),t}(Ro);function pT(e){var a=dT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function dT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vT=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,mT=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,gT=function(e){(0,an.Z)(t,e);var a=pT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,w=r.heightfixed,L=w===void 0?!1:w,F=r.lineTexture,U=F===void 0?!1:F,j=r.iconStep,q=j===void 0?100:j,ae=r.iconStepCount,pe=ae===void 0?1:ae;this.rendererService.getDirty()&&this.texture.bind();var Fe=0,Qe=[0,0,0,0],yt=[0,0,0,0];if(p&&v&&(Qe=B(p),yt=B(v),Fe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var vt=this.layer.getEncodedData(),Bt=this.calDataFrame(this.cellLength,vt,this.cellProperties),Qt=Bt.data,Ir=Bt.width,Or=Bt.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&Qt.length>0?this.createTexture2D({flipY:!0,data:Qt,format:X.LUMINANCE,type:X.FLOAT,width:Ir,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_heightfixed:Number(L),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:U?1:0,u_iconStepCount:pe,u_icon_step:q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:Qe,u_targetColor:yt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:mT,fragmentShader:vT,triangulation:$0,depth:{enable:!1},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,w=E===void 0?1:E;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.texture,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro),yT={arc:Ew,arc3d:kw,greatcircle:Gw,wall:gT,line:g1,halfLine:qw,simple:hT,linearline:sT,vectorline:pg,tileLine:t1,earthArc3d:Nw},_T=yT;function xT(e){var a=bT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=function(e){(0,an.Z)(t,e);var a=xT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","LineLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new _T[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;if(this.layerSource.parser.type==="mvt")return"vectorline";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u||"line"}}]),t}(dd);function CT(e){var a=ST();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function ST(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,wT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,TT=function(e){(0,an.Z)(t,e);var a=CT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"raiseCount",0),(0,ye.Z)((0,Gt.Z)(i),"raiserepeat",0),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,w=r.pickLight,L=w===void 0?!1:w,F=r.heightfixed,U=F===void 0?!1:F,j=r.opacityLinear,q=j===void 0?{enable:!1,dir:"up"}:j,ae=r.lightEnable,pe=ae===void 0?!0:ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Fe=this.layer.getEncodedData(),Qe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),yt=Qe.data,vt=Qe.width,Bt=Qe.height;this.rowCount=Bt,this.dataTexture=this.cellLength>0&&yt.length>0?this.createTexture2D({flipY:!0,data:yt,format:X.LUMINANCE,type:X.FLOAT,width:vt,height:Bt}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var Qt=0,Ir=[0,0,0,0],Or=[0,0,0,0];if(g&&E&&(Ir=B(g),Or=B(E),Qt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Tr=u.speed,on=Tr===void 0?.01:Tr,kn=u.repeat,si=kn===void 0?!1:kn;this.raiseCount+=on,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(L),u_heightfixed:Number(U),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(v)?v:1,u_linearColor:Qt,u_sourceColor:Ir,u_targetColor:Or,u_opacitylinear:Number(q.enable),u_opacitylinear_dir:q.dir==="up"?1:0,u_lightEnable:Number(pe)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,p=u===void 0?1:u;this.raiserepeat=p,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:wT,fragmentShader:AT,triangulation:iy,depth:{enable:!0},cull:{enable:!0,face:If(this.mapService.version)},blend:this.getBlend()}).then(function(v){r([v])}).catch(function(v){console.warn(v),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=c(o.coordinates);return D_([p[0],p[1]])}}})}}]),t}(Ro);function MT(e){var a=IT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function IT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,PT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,RT=function(e){(0,an.Z)(t,e);var a=MT(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,w=r.stroke,L=w===void 0?"rgba(0,0,0,0)":w,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,q=r.blur,ae=q===void 0?0:q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U});var pe=this.layer.getEncodedData(),Fe=this.calDataFrame(this.cellLength,pe,this.cellProperties),Qe=Fe.data,yt=Fe.width,vt=Fe.height;this.rowCount=vt,this.dataTexture=this.cellLength>0&&Qe.length>0?this.createTexture2D({flipY:!0,data:Qe,format:X.LUMINANCE,type:X.FLOAT,width:yt,height:vt}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_stroke_opacity:(0,gr.isNumber)(v)?v:1,u_stroke_width:(0,gr.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(L),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.triangulation=G_,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:PT,fragmentShader:kT,triangulation:G_,depth:{enable:!0},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=(0,Pr.Z)(v,3),w=E[0],L=E[1],F=E[2],U=ts.fromValues(0,0,1),j=ts.fromValues(w,0,F),q=w>=0?ts.angle(U,j):Math.PI*2-ts.angle(U,j),ae=Math.PI*2-Math.asin(L/100),pe=lr();Mi(pe,pe,q),Da(pe,pe,ae);var Fe=ts.fromValues(1,1,0);ts.transformMat4(Fe,Fe,pe),ts.normalize(Fe,Fe);var Qe=ts.fromValues(-1,1,0);ts.transformMat4(Qe,Qe,pe),ts.normalize(Qe,Qe);var yt=ts.fromValues(-1,-1,0);ts.transformMat4(yt,yt,pe),ts.normalize(yt,yt);var vt=ts.fromValues(1,-1,0);ts.transformMat4(vt,vt,pe),ts.normalize(vt,vt);var Bt=[].concat((0,_e.Z)(Fe),(0,_e.Z)(Qe),(0,_e.Z)(yt),(0,_e.Z)(vt)),Qt=g%4*3;return[Bt[Qt],Bt[Qt+1],Bt[Qt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,w=E===void 0?2:E,L=r.layer.getLayerConfig().shape2d,F=L.indexOf(w);return[F]}}})}}]),t}(Ro);function LT(e){var a=OT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,DT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,_1=function(e){(0,an.Z)(t,e);var a=LT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"raiseCount",0),(0,ye.Z)((0,Gt.Z)(i),"raiserepeat",0),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,w=r.pickLight,L=w===void 0?!1:w,F=r.heightfixed,U=F===void 0?!1:F,j=r.opacityLinear,q=j===void 0?{enable:!1,dir:"up"}:j,ae=r.lightEnable,pe=ae===void 0?!0:ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Fe=this.layer.getEncodedData(),Qe=this.calDataFrame(this.cellLength,Fe,this.cellProperties),yt=Qe.data,vt=Qe.width,Bt=Qe.height;this.rowCount=Bt,this.dataTexture=this.cellLength>0&&yt.length>0?this.createTexture2D({flipY:!0,data:yt,format:X.LUMINANCE,type:X.FLOAT,width:vt,height:Bt}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var Qt=0,Ir=[0,0,0,0],Or=[0,0,0,0];if(g&&E&&(Ir=B(g),Or=B(E),Qt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Tr=u.speed,on=Tr===void 0?.01:Tr,kn=u.repeat,si=kn===void 0?!1:kn;this.raiseCount+=on,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(L),u_heightfixed:Number(U),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(v)?v:1,u_linearColor:Qt,u_sourceColor:Ir,u_targetColor:Or,u_opacitylinear:Number(q.enable),u_opacitylinear_dir:q.dir==="up"?1:0,u_lightEnable:Number(pe)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){var p,v,g,E,w;return xi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:p=this.layer.getLayerConfig(),v=p.depth,g=v===void 0?!0:v,E=p.animateOption.repeat,w=E===void 0?1:E,this.raiserepeat=w,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:DT,fragmentShader:FT,triangulation:iy,blend:this.getBlend(),cull:{enable:!0,face:If(this.mapService.version)},depth:{enable:g}}).then(function(U){u([U])}).catch(function(U){console.warn(U),u([])});case 3:case"end":return F.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=c(o.coordinates);return[p[0],p[1],0]}}})}}]),t}(Ro);function BT(e){var a=NT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function NT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,zT=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ly=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,b1=function(e){(0,an.Z)(t,e);var a=BT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"meter2coord",1),(0,ye.Z)((0,Gt.Z)(i),"meteryScale",1),(0,ye.Z)((0,Gt.Z)(i),"isMeter",!1),(0,ye.Z)((0,Gt.Z)(i),"unit","l7size"),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,w=r.stroke,L=w===void 0?"rgba(0,0,0,0)":w,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,q=r.blur,ae=q===void 0?0:q,pe=r.raisingHeight,Fe=pe===void 0?0:pe,Qe=r.unit,yt=Qe===void 0?"l7size":Qe;if(this.updateUnit(yt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:L,offsets:U});var vt=this.layer.getEncodedData(),Bt=this.calDataFrame(this.cellLength,vt,this.cellProperties),Qt=Bt.data,Ir=Bt.width,Or=Bt.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&Qt.length>0?this.createTexture2D({flipY:!0,data:Qt,format:X.LUMINANCE,type:X.FLOAT,width:Ir,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Fe),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_stroke_opacity:(0,gr.isNumber)(v)?v:1,u_stroke_width:(0,gr.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(L),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),bp)}},{key:"initModels",value:function(r){this.updateUnit("l7size"),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version,w=Pa==null?void 0:Pa.mapboxgl;if(E===Wu.MAPBOX&&w!==null&&w!==void 0&&w.MercatorCoordinate){var L=w.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),F=L.meterInMercatorCoordinateUnits(),U=new w.MercatorCoordinate(L.x-F,L.y,L.z),j=U.toLngLat(),q=new w.MercatorCoordinate(L.x,L.y-F,L.z),ae=q.toLngLat();this.meter2coord=g[0]-j.lng,this.meteryScale=(ae.lat-g[1])/this.meter2coord;return}var pe=this.mapService.meterToCoord(g,[o,u]),Fe=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(pe+Fe)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=(0,Ua.Z)(xi().mark(function o(u){var p,v,g,E,w,L,F,U,j,q,ae,pe,Fe,Qe,yt;return xi().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,w=E===void 0?!0:E,L=p.animateOption,F=L===void 0?{enable:!1}:L,U=p.workerEnabled,j=U===void 0?!1:U,q=p.enablePicking,ae=p.shape2d,pe=this.getShaders(F),Fe=pe.frag,Qe=pe.vert,yt=pe.type,this.layer.triangulation=bp,this.layer.buildLayerModel({moduleName:yt,vertexShader:Qe,fragmentShader:Fe,triangulation:bp,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(g,w),workerEnabled:j,workerOptions:{modelType:yt,enablePicking:q,shape2d:ae}}).then(function(Qt){u([Qt])}).catch(function(Qt){console.warn(Qt),u([])});case 4:case"end":return Bt.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:x1,vert:ly,type:"pointWave"};default:return{frag:x1,vert:ly,type:"pointWave"}}else return{frag:zT,vert:ly,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=g%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,w=E===void 0?2:E,L=r.indexOf(w);return[L]}}})}},{key:"updateUnit",value:function(r){var o=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&o!==Wu.L7MAP&&o!==Wu.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),t}(Ro);function UT(e){var a=ZT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VT=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,jT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,GT=function(e){(0,an.Z)(t,e);var a=UT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"meter2coord",1),(0,ye.Z)((0,Gt.Z)(i),"isMeter",!1),(0,ye.Z)((0,Gt.Z)(i),"radian",0),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.rotation;this.rendererService.getDirty()&&this.texture.bind();var E=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(E=-1),this.radian=g!==void 0?E*Math.PI*g/180:E*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var w=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,w,this.cellProperties),F=L.data,U=L.width,j=L.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:X.LUMINANCE,type:X.FLOAT,width:U,height:j}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,gr.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),q0)}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),L=1,F=L*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var q=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(q+ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:jT,fragmentShader:VT,triangulation:q0,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g),cull:{enable:!0,face:If(this.mapService.version)}}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.rotate,w=E===void 0?0:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.shape,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=g%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]*r.meter2coord]:[w*r.meter2coord]}}})}}]),t}(Ro);function HT(e){var a=WT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,YT=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,E1=function(e){(0,an.Z)(t,e);var a=HT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),w=E.data,L=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:X.LUMINANCE,type:X.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,gr.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:YT,fragmentShader:XT,triangulation:NC,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),w=u.shape,L=E[w]||{x:0,y:0},F=L.x,U=L.y;return[F,U]}}})}}]),t}(Ro);function qT(e){var a=$T();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function $T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,QT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function C1(e){var a=e.coordinates;return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}var S1=function(e){(0,an.Z)(t,e);var a=qT(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),w=E.data,L=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:X.LUMINANCE,type:X.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=C1,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:QT,fragmentShader:KT,triangulation:C1,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Nh.additive}}}]),t}(Ro);function JT(e){var a=e5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t5=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,r5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,n5=function(e){(0,an.Z)(t,e);var a=JT(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"meter2coord",1),(0,ye.Z)((0,Gt.Z)(i),"isMeter",!1),i}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.speed,w=E===void 0?1:E;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var L=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,L,this.cellProperties),U=F.data,j=F.width,q=F.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&U.length>0?this.createTexture2D({flipY:!0,data:U,format:X.LUMINANCE,type:X.FLOAT,width:j,height:q}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:w,u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),q0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),L=1,F=L*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-F,w.y,w.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var q=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(q+ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:r5,fragmentShader:t5,triangulation:q0,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E;E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var w=g%4*3;return[E[w],E[w+1],E[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,w=E===void 0?5:E;return Array.isArray(w)?[w[0]*r.meter2coord]:[w*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,w=E===void 0?2:E,L=r.layer.getLayerConfig().shape2d,F=L.indexOf(w);return[F]}}})}}]),t}(Ro);function i5(e){var a=a5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,s5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function A1(e){var a=e.coordinates;return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}var u5=function(e){(0,an.Z)(t,e);var a=i5(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.strokeOpacity,w=E===void 0?1:E,L=r.strokeWidth,F=L===void 0?0:L,U=r.stroke,j=U===void 0?"#fff":U;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var q=this.layer.getEncodedData(),ae=this.calDataFrame(this.cellLength,q,this.cellProperties),pe=ae.data,Fe=ae.width,Qe=ae.height;this.rowCount=Qe,this.dataTexture=this.cellLength>0&&pe.length>0?this.createTexture2D({flipY:!0,data:pe,format:X.LUMINANCE,type:X.FLOAT,width:Fe,height:Qe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0],u_stroke_opacity:(0,gr.isNumber)(w)?w:1,u_stroke_width:(0,gr.isNumber)(F)?F:1,u_stroke_color:this.getStrokeColor(j)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=A1,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:s5,fragmentShader:o5,triangulation:A1,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Nh.additive}}}]),t}(Ro),l5={fillImage:GT,fill:b1,radar:n5,image:E1,normal:S1,simplePoint:u5,extrude:_1,text:oy,vectorpoint:pg,tile:hg,earthFill:RT,earthExtrude:TT},c5=l5;function f5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=h5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function h5(e,a){if(!!e){if(typeof e=="string")return w1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w1(e,a)}}function w1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function p5(e){var a=d5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function d5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v5=function(e){(0,an.Z)(t,e);var a=p5(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","PointLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new c5[o](this),this.layerModel.initModels(function(u){r.models=u,r.layerService.updateLayerRenderList(),r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,E=this.iconService.getIconMap();if(o&&(v==null?void 0:v.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var w=f5(u),L;try{for(w.s();!(L=w.n()).done;){var F=L.value;if(typeof F=="string"&&E.hasOwnProperty(F))return"image"}}catch(U){w.e(U)}finally{w.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","vectorpoint","tile","earthFill","earthExtrude"];if(this.layerSource.parser.type==="mvt")return"vectorpoint";var o=this.getEncodedData(),u=this.getLayerConfig(),p=u.shape2d,v=u.shape3d,g=this.iconService.getIconMap(),E=o.find(function(L){return L.hasOwnProperty("shape")});if(E){var w=E.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":w==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(p==null?void 0:p.indexOf(w))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(v==null?void 0:v.indexOf(w))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":g.hasOwnProperty(w)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(dd);function m5(e){var a=g5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function g5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,_5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,x5=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,b5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,E5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,C5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,S5=function(e){(0,an.Z)(t,e);var a=m5(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.heightfixed,v=p===void 0?!1:p,g=r.raisingHeight,E=g===void 0?0:g,w=r.topsurface,L=w===void 0?!0:w,F=r.sidesurface,U=F===void 0?!0:F,j=r.sourceColor,q=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var ae=this.layer.getEncodedData(),pe=this.calDataFrame(this.cellLength,ae,this.cellProperties),Fe=pe.data,Qe=pe.width,yt=pe.height;this.rowCount=yt,this.dataTexture=this.cellLength>0&&Fe.length>0?this.createTexture2D({flipY:!0,data:Fe,format:X.LUMINANCE,type:X.FLOAT,width:Qe,height:yt}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var vt=0,Bt=[1,1,1,1],Qt=[1,1,1,1];return j&&q&&(Bt=B(j),Qt=B(q),vt=1),{u_topsurface:Number(L),u_sidesurface:Number(U),u_heightfixed:Number(v),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(E),u_opacity:(0,gr.isNumber)(u)?u:1,u_linearColor:vt,u_sourceColor:Bt,u_targetColor:Qt,u_texture:this.texture}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),w=E.frag,L=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:L,fragmentShader:w,triangulation:H_,stencil:Ne(p,g)}).then(function(U){r([U])}).catch(function(U){console.warn(U),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:x5,vert:b5,type:"polygonExtrudeTexture"}:o?{frag:E5,vert:C5,type:"polygonExtrudePickLight"}:{frag:y5,vert:_5,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,w=g-p;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Gn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(F,U,j,q,ae){var pe=j[0],Fe=j[1];return[(pe-u)/E,(Fe-p)/w,j[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(F,U,j,q,ae){return ae}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(F,U,j,q){var ae=F.size,pe=ae===void 0?10:ae;return Array.isArray(pe)?[pe[0]]:[pe]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,p=this.rendererService.createTexture2D;if(this.texture=p({height:0,width:0}),u){var v=new Image;v.crossOrigin="",v.src=u,v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),t}(Ro);function A5(e){var a=w5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function w5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,M5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,I5=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,k5=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,P5=function(e){(0,an.Z)(t,e);var a=A5(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,p=r.opacity,v=p===void 0?1:p,g=r.opacityLinear,E=g===void 0?{enable:!1,dir:"in"}:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var w=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,w,this.cellProperties),F=L.data,U=L.width,j=L.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:X.LUMINANCE,type:X.FLOAT,width:U,height:j}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,gr.isNumber)(v)?v:1,u_opacitylinear:Number(E.enable),u_dir:E.dir==="in"?1:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.getModelParams(),u=o.frag,p=o.vert,v=o.triangulation,g=o.type,E=this.layer.getLayerConfig(),w=E.mask,L=w===void 0?!1:w,F=E.maskInside,U=F===void 0?!0:F,j=E.workerEnabled,q=j===void 0?!1:j,ae=E.enablePicking;this.layer.triangulation=v,this.layer.buildLayerModel({moduleName:g,vertexShader:p,fragmentShader:u,triangulation:v,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ne(L,U),workerEnabled:q,workerOptions:{modelType:g,enablePicking:ae}}).then(function(pe){r([pe])}).catch(function(pe){console.warn(pe),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Gn.Attribute,descriptor:{name:"a_linear",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(v,g,E,w,L){return[E[3],E[4],E[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:M5,vert:I5,type:"polygonLinear",triangulation:UC}:{frag:T5,vert:k5,type:"polygonFill",triangulation:ps}}}]),t}(Ro);function R5(e){var a=L5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function L5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O5=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,F5=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,D5=function(e){(0,an.Z)(t,e);var a=R5(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.watercolor,v=p===void 0?"#6D99A8":p,g=r.watercolor2,E=g===void 0?"#0F121C":g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var w=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,w,this.cellProperties),F=L.data,U=L.width,j=L.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:X.LUMINANCE,type:X.FLOAT,width:U,height:j}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:B(v),u_watercolor2:B(E),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,gr.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:F5,fragmentShader:O5,triangulation:pm,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o,u,p;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,w=g-p;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(F,U,j,q,ae){var pe=(0,Pr.Z)(j,2),Fe=pe[0],Qe=pe[1];return[(Fe-u)/E,(Qe-p)/w]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),p(function(g){r.texture1=v(g[0]),r.texture2=v(g[1]),r.texture3=v(g[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function p(g){var E=0,w=[],L=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];L.map(function(F){var U=new Image;U.crossOrigin="",U.src=F,w.push(U),U.onload=function(){E++,E===3&&g(w)}})}function v(g){return o({data:g,width:g.width,height:g.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR})}}}]),t}(Ro);function B5(e){var a=N5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function N5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z5=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,U5=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Z5=function(e){(0,an.Z)(t,e);var a=B5(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.speed,v=p===void 0?.5:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),w=E.data,L=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:X.LUMINANCE,type:X.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:v,u_opacity:(0,gr.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:U5,fragmentShader:z5,triangulation:pm,primitive:X.TRIANGLES,depth:{enable:!1},stencil:Ne(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,w=g-p;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(F,U,j,q,ae){var pe=(0,Pr.Z)(j,2),Fe=pe[0],Qe=pe[1];return[(Fe-u)/E,(Qe-p)/w]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,p=this.rendererService.createTexture2D;this.texture=p({height:0,width:0});var v=new Image;v.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),v.src=u):v.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),t}(Ro),V5={fill:P5,line:g1,extrude:S5,text:oy,point_fill:b1,point_image:E1,point_normal:S1,point_extrude:_1,water:Z5,ocean:D5,vectorpolygon:pg,tile:h1},j5=V5;function G5(e){var a=H5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function H5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T1=function(e){(0,an.Z)(t,e);var a=G5(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","PolygonLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new j5[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r;if(this.layerSource.parser.type==="mvt")return"vectorpolygon";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":u==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=o.shape3d,v=this.iconService.getIconMap(),g=r.find(function(w){return w.hasOwnProperty("shape")});if(g){var E=g.shape;return E==="dot"?"point_normal":(u==null?void 0:u.indexOf(E))!==-1?"point_fill":(p==null?void 0:p.indexOf(E))!==-1?"point_extrude":v.hasOwnProperty(E)?"point_image":"text"}else return"fill"}}]),t}(dd),W5={raster:sy,raster3d:sy,rasterTile:pg},X5=W5;function Y5(e){var a=q5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function q5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $5=function(e){(0,an.Z)(t,e);var a=Y5(t);function t(){var i;(0,Ft.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ye.Z)((0,Gt.Z)(i),"type","RasterLayer"),i}return(0,Tt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new X5[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},raster3d:{},rasterTile:{}};return o[r]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(dd),M1,I1,k1,P1,R1,vm,L1,O1,F1,K5=(M1=(0,xn.b2)(),I1=(0,xn.f3)(hr.IGlobalConfigService),k1=(0,xn.f3)(hr.IMapService),P1=(0,xn.f3)(hr.IFontService),M1(R1=(vm=function(){function e(){(0,Ft.Z)(this,e),va(this,"configService",L1,this),va(this,"mapService",O1,this),va(this,"fontService",F1,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var u=t.getSource();u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var u=t.getSource();return u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var p=t.getBottomColor(),v=o.getLayerStyleAttributes()||[],g=o.getLayerStyleAttribute("filter"),E=u.data.dataArray,w=v.filter(function(F){return F.needRemapping}),L=E;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(L=E.filter(function(F){return r.applyAttributeMapping(g,F,p)[0]})),w.length&&(g!=null&&g.needRemapping?(t.setEncodedData(r.mapping(t,v,L,void 0,p)),g.needRemapping=!1):t.setEncodedData(r.mapping(t,w,L,t.getEncodedData(),p)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,i){var r=this,o=i.styleAttributeService,u=t.getBottomColor(),p=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),g=t.getSource().data.dataArray,E=g;v!=null&&v.scale&&(E=g.filter(function(w){return r.applyAttributeMapping(v,w,u)[0]})),t.setEncodedData(this.mapping(t,p,E,void 0,u)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,i){var r=[i[0]-t[0],i[1]-t[1]],o=Yf(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}},{key:"mapping",value:function(t,i,r,o,u){var p=this,v=t.getLayerConfig(),g=v.arrow,E=g===void 0?{enable:!1}:g,w=r.map(function(L,F){var U=o?o[F]:{},j=(0,Z.Z)({id:L._id,coordinates:L.coordinates},U);if(i.filter(function(pe){return pe.scale!==void 0}).forEach(function(pe){var Fe=p.applyAttributeMapping(pe,L,u);pe.needRemapping=!1,pe.name==="color"&&(Fe=Fe.map(function(Qe){return B(Qe)})),j[pe.name]=Array.isArray(Fe)&&Fe.length===1?Fe[0]:Fe,pe.name==="shape"&&(j.shape=p.fontService.getIconFontKey(j[pe.name]))}),E.enable&&(j.shape==="line"||j.shape==="halfLine")){var q=j.coordinates,ae=p.getArrowPoints(q[0],q[1]);j.coordinates.splice(1,0,ae,ae)}return j});return this.adjustData2Amap2Coordinates(w,t),this.adjustData2SimpleCoordinates(w),w}},{key:"adjustData2Amap2Coordinates",value:function(t,i){var r=this;if(t.length>0&&this.mapService.version===Wu["GAODE2.x"]){var o=this.getLayerCenter(i);typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Wu["GAODE2.x"],u.originCoordinates=(0,gr.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Wu["GAODE2.x"],u.originCoordinates=(0,gr.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var i=this;t.length>0&&this.mapService.version===Wu.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=i.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var i=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var p=[];u.map(function(v){p.push(i.mapService.simpleMapCoord.unproject(v))}),r.push(p)}),r}else{var o=[];return t.map(function(u){o.push(i.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,i,r){var o;if(!t.scale)return[];var u=(t==null||(o=t.scale)===null||o===void 0?void 0:o.scalers)||[],p=[];u.forEach(function(g){var E,w=g.field;(i.hasOwnProperty(w)||((E=t.scale)===null||E===void 0?void 0:E.type)==="variable")&&p.push(i[w])});var v=t.mapping?t.mapping(p):[];return t.name==="color"&&!P(v[0])?[r]:v}}]),e}(),L1=ca(vm.prototype,"configService",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O1=ca(vm.prototype,"mapService",[k1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=ca(vm.prototype,"fontService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm))||R1),D1,B1,Q5=(D1=(0,xn.b2)(),D1(B1=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){var i=this;this.mapService=t.getContainer().get(hr.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var r=t.getSource();if(!r){var o=Ui[t.type]||{data:po,options:eu},u=t.sourceOption||o,p=u.data,v=u.options;r=new vo(p,v),t.setSource(r)}r.inited?i.updateClusterData(t):r.once("sourceUpdate",function(){i.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=i.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,r||o})}},{key:"updateClusterData",value:function(t){var i=t.getSource(),r=i.cluster,o=i.clusterOptions.zoom,u=o===void 0?0:o,p=this.mapService.getZoom()-1,v=t.dataState.dataSourceNeedUpdate;return r&&v&&i.updateClusterData(Math.floor(p)),r&&Math.abs(t.clusterZoom-p)>=1?(u!==Math.floor(p)&&i.updateClusterData(Math.floor(p)),t.clusterZoom=p,!0):!1}}]),e}())||B1);function cy(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function N1(e){return e.length===1&&(e=J5(e)),{left:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)<0?i=o+1:r=o}return i},right:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)>0?r=o:i=o+1}return i}}}function J5(e){return function(a,t){return cy(e(a),t)}}var z1=N1(cy),eM=z1.right,eP=z1.left,dg=eM;function U1(e,a){var t=e.length,i=-1,r,o,u;if(a==null){for(;++i<t;)if((r=e[i])!=null&&r>=r)for(o=u=r;++i<t;)(r=e[i])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++i<t;)if((r=a(e[i],i,e))!=null&&r>=r)for(o=u=r;++i<t;)(r=a(e[i],i,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var Z1=Array.prototype,tP=Z1.slice,rP=Z1.map,fy=Math.sqrt(50),hy=Math.sqrt(10),py=Math.sqrt(2);function V1(e,a,t){var i,r=-1,o,u,p;if(a=+a,e=+e,t=+t,e===a&&t>0)return[e];if((i=a<e)&&(o=e,e=a,a=o),(p=vg(e,a,t))===0||!isFinite(p))return[];if(p>0)for(e=Math.ceil(e/p),a=Math.floor(a/p),u=new Array(o=Math.ceil(a-e+1));++r<o;)u[r]=(e+r)*p;else for(e=Math.floor(e*p),a=Math.ceil(a*p),u=new Array(o=Math.ceil(e-a+1));++r<o;)u[r]=(e-r)/p;return i&&u.reverse(),u}function vg(e,a,t){var i=(a-e)/Math.max(0,t),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=fy?10:o>=hy?5:o>=py?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=fy?10:o>=hy?5:o>=py?2:1)}function dy(e,a,t){var i=Math.abs(a-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=fy?r*=10:o>=hy?r*=5:o>=py&&(r*=2),a<e?-r:r}function nP(){var e=identity,a=extent,t=sturges;function i(r){var o,u=r.length,p,v=new Array(u);for(o=0;o<u;++o)v[o]=e(r[o],o,r);var g=a(v),E=g[0],w=g[1],L=t(v,E,w);Array.isArray(L)||(L=tickStep(E,w,L),L=range(Math.ceil(E/L)*L,w,L));for(var F=L.length;L[0]<=E;)L.shift(),--F;for(;L[F-1]>w;)L.pop(),--F;var U=new Array(F+1),j;for(o=0;o<=F;++o)j=U[o]=[],j.x0=o>0?L[o-1]:E,j.x1=o<F?L[o]:w;for(o=0;o<u;++o)p=v[o],E<=p&&p<=w&&U[bisect(L,p,0,F)].push(r[o]);return U}return i.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),i):e},i.domain=function(r){return arguments.length?(a=typeof r=="function"?r:constant([r[0],r[1]]),i):a},i.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),i):t},i}function iP(e,a,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function tM(e){return e===null?NaN:+e}function rM(e,a,t){if(t==null&&(t=tM),!!(i=e.length)){if((a=+a)<=0||i<2)return+t(e[0],0,e);if(a>=1)return+t(e[i-1],i-1,e);var i,r=(i-1)*a,o=Math.floor(r),u=+t(e[o],o,e),p=+t(e[o+1],o+1,e);return u+(p-u)*(r-o)}}var nM=fe(87765),pp="$";function mg(){}mg.prototype=j1.prototype={constructor:mg,has:function(e){return pp+e in this},get:function(e){return this[pp+e]},set:function(e,a){return this[pp+e]=a,this},remove:function(e){var a=pp+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===pp&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===pp&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===pp&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===pp&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===pp&&++e;return e},empty:function(){for(var e in this)if(e[0]===pp)return!1;return!0},each:function(e){for(var a in this)a[0]===pp&&e(this[a],a.slice(1),this)}};function j1(e,a){var t=new mg;if(e instanceof mg)e.each(function(p,v){t.set(v,p)});else if(Array.isArray(e)){var i=-1,r=e.length,o;if(a==null)for(;++i<r;)t.set(i,e[i]);else for(;++i<r;)t.set(a(o=e[i],i,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var vy=j1;function aP(){var e=[],a=[],t,i,r;function o(p,v,g,E){if(v>=e.length)return t!=null&&p.sort(t),i!=null?i(p):p;for(var w=-1,L=p.length,F=e[v++],U,j,q=map(),ae,pe=g();++w<L;)(ae=q.get(U=F(j=p[w])+""))?ae.push(j):q.set(U,[j]);return q.each(function(Fe,Qe){E(pe,Qe,o(Fe,v,g,E))}),pe}function u(p,v){if(++v>e.length)return p;var g,E=a[v-1];return i!=null&&v>=e.length?g=p.entries():(g=[],p.each(function(w,L){g.push({key:L,values:u(w,v)})})),E!=null?g.sort(function(w,L){return E(w.key,L.key)}):g}return r={object:function(p){return o(p,0,iM,aM)},map:function(p){return o(p,0,G1,H1)},entries:function(p){return u(o(p,0,G1,H1),0)},key:function(p){return e.push(p),r},sortKeys:function(p){return a[e.length-1]=p,r},sortValues:function(p){return t=p,r},rollup:function(p){return i=p,r}}}function iM(){return{}}function aM(e,a,t){e[a]=t}function G1(){return map()}function H1(e,a,t){e.set(a,t)}function gg(){}var K0=vy.prototype;gg.prototype=oM.prototype={constructor:gg,has:K0.has,add:function(e){return e+="",this[pp+e]=e,this},remove:K0.remove,clear:K0.clear,values:K0.keys,size:K0.size,empty:K0.empty,each:K0.each};function oM(e,a){var t=new gg;if(e instanceof gg)e.each(function(o){t.add(o)});else if(e){var i=-1,r=e.length;if(a==null)for(;++i<r;)t.add(e[i]);else for(;++i<r;)t.add(a(e[i],i,e))}return t}var oP=null,W1=Array.prototype,yg=W1.map,Q0=W1.slice;function b0(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function X1(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var Y1={name:"implicit"};function _g(){var e=vy(),a=[],t=[],i=Y1;function r(o){var u=o+"",p=e.get(u);if(!p){if(i!==Y1)return i;e.set(u,p=a.push(o))}return t[(p-1)%t.length]}return r.domain=function(o){if(!arguments.length)return a.slice();a=[],e=vy();for(var u=-1,p=o.length,v,g;++u<p;)e.has(g=(v=o[u])+"")||e.set(g,a.push(v));return r},r.range=function(o){return arguments.length?(t=Q0.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return _g(a,t).unknown(i)},b0.apply(r,arguments),r}function q1(){var e=ordinal().unknown(void 0),a=e.domain,t=e.range,i=[0,1],r,o,u=!1,p=0,v=0,g=.5;delete e.unknown;function E(){var w=a().length,L=i[1]<i[0],F=i[L-0],U=i[1-L];r=(U-F)/Math.max(1,w-p+v*2),u&&(r=Math.floor(r)),F+=(U-F-r*(w-p))*g,o=r*(1-p),u&&(F=Math.round(F),o=Math.round(o));var j=sequence(w).map(function(q){return F+r*q});return t(L?j.reverse():j)}return e.domain=function(w){return arguments.length?(a(w),E()):a()},e.range=function(w){return arguments.length?(i=[+w[0],+w[1]],E()):i.slice()},e.rangeRound=function(w){return i=[+w[0],+w[1]],u=!0,E()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(w){return arguments.length?(u=!!w,E()):u},e.padding=function(w){return arguments.length?(p=Math.min(1,v=+w),E()):p},e.paddingInner=function(w){return arguments.length?(p=Math.min(1,w),E()):p},e.paddingOuter=function(w){return arguments.length?(v=+w,E()):v},e.align=function(w){return arguments.length?(g=Math.max(0,Math.min(1,w)),E()):g},e.copy=function(){return q1(a(),i).round(u).paddingInner(p).paddingOuter(v).align(g)},initRange.apply(E(),arguments)}function $1(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return $1(a())},e}function sP(){return $1(q1.apply(null,arguments).paddingInner(1))}var sM=fe(21775),uM=fe(73626);function lM(e,a){return e=+e,a=+a,function(t){return Math.round(e*(1-t)+a*t)}}function cM(e){return function(){return e}}function gy(e){return+e}var K1=[0,1];function sf(e){return e}function yy(e,a){return(a-=e=+e)?function(t){return(t-e)/a}:cM(isNaN(a)?NaN:.5)}function Q1(e){var a=e[0],t=e[e.length-1],i;return a>t&&(i=a,a=t,t=i),function(r){return Math.max(a,Math.min(t,r))}}function fM(e,a,t){var i=e[0],r=e[1],o=a[0],u=a[1];return r<i?(i=yy(r,i),o=t(u,o)):(i=yy(i,r),o=t(o,u)),function(p){return o(i(p))}}function hM(e,a,t){var i=Math.min(e.length,a.length)-1,r=new Array(i),o=new Array(i),u=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<i;)r[u]=yy(e[u],e[u+1]),o[u]=t(a[u],a[u+1]);return function(p){var v=dg(e,p,1,i)-1;return o[v](r[v](p))}}function xg(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function _y(){var e=K1,a=K1,t=sM.Z,i,r,o,u=sf,p,v,g;function E(){return p=Math.min(e.length,a.length)>2?hM:fM,v=g=null,w}function w(L){return isNaN(L=+L)?o:(v||(v=p(e.map(i),a,t)))(i(u(L)))}return w.invert=function(L){return u(r((g||(g=p(a,e.map(i),uM.Z)))(L)))},w.domain=function(L){return arguments.length?(e=yg.call(L,gy),u===sf||(u=Q1(e)),E()):e.slice()},w.range=function(L){return arguments.length?(a=Q0.call(L),E()):a.slice()},w.rangeRound=function(L){return a=Q0.call(L),t=lM,E()},w.clamp=function(L){return arguments.length?(u=L?Q1(e):sf,w):u!==sf},w.interpolate=function(L){return arguments.length?(t=L,E()):t},w.unknown=function(L){return arguments.length?(o=L,w):o},function(L,F){return i=L,r=F,E()}}function J1(e,a){return _y()(e,a)}var pM=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bg(e){if(!(a=pM.exec(e)))throw new Error("invalid format: "+e);var a;return new xy({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}bg.prototype=xy.prototype;function xy(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}xy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function dM(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Eg(e,a){if((t=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var t,i=e.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+e.slice(t+1)]}function kv(e){return e=Eg(Math.abs(e)),e?e[1]:NaN}function vM(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kv(a)/3)))*3-kv(Math.abs(e)))}function mM(e,a){return function(t,i){for(var r=t.length,o=[],u=0,p=e[0],v=0;r>0&&p>0&&(v+p+1>i&&(p=Math.max(1,i-v)),o.push(t.substring(r-=p,r+p)),!((v+=p+1)>i));)p=e[u=(u+1)%e.length];return o.reverse().join(a)}}function gM(e){return function(a){return a.replace(/[0-9]/g,function(t){return e[+t]})}}function yM(e){e:for(var a=e.length,t=1,i=-1,r;t<a;++t)switch(e[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+e[t])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var ex;function _M(e,a){var t=Eg(e,a);if(!t)return e+"";var i=t[0],r=t[1],o=r-(ex=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Eg(e,Math.max(0,a+o-1))[0]}function tx(e,a){var t=Eg(e,a);if(!t)return e+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var rx={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:dM,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return tx(e*100,a)},r:tx,s:_M,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function nx(e){return e}var ix=Array.prototype.map,ax=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function xM(e){var a=e.grouping===void 0||e.thousands===void 0?nx:mM(ix.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?nx:gM(ix.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",p=e.minus===void 0?"-":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function g(w){w=bg(w);var L=w.fill,F=w.align,U=w.sign,j=w.symbol,q=w.zero,ae=w.width,pe=w.comma,Fe=w.precision,Qe=w.trim,yt=w.type;yt==="n"?(pe=!0,yt="g"):rx[yt]||(Fe===void 0&&(Fe=12),Qe=!0,yt="g"),(q||L==="0"&&F==="=")&&(q=!0,L="0",F="=");var vt=j==="$"?t:j==="#"&&/[boxX]/.test(yt)?"0"+yt.toLowerCase():"",Bt=j==="$"?i:/[%p]/.test(yt)?u:"",Qt=rx[yt],Ir=/[defgprs%]/.test(yt);Fe=Fe===void 0?6:/[gprs]/.test(yt)?Math.max(1,Math.min(21,Fe)):Math.max(0,Math.min(20,Fe));function Or(Tr){var on=vt,kn=Bt,si,Xa,bo;if(yt==="c")kn=Qt(Tr)+kn,Tr="";else{Tr=+Tr;var Ss=Tr<0||1/Tr<0;if(Tr=isNaN(Tr)?v:Qt(Math.abs(Tr),Fe),Qe&&(Tr=yM(Tr)),Ss&&+Tr==0&&U!=="+"&&(Ss=!1),on=(Ss?U==="("?U:p:U==="-"||U==="("?"":U)+on,kn=(yt==="s"?ax[8+ex/3]:"")+kn+(Ss&&U==="("?")":""),Ir){for(si=-1,Xa=Tr.length;++si<Xa;)if(bo=Tr.charCodeAt(si),48>bo||bo>57){kn=(bo===46?r+Tr.slice(si+1):Tr.slice(si))+kn,Tr=Tr.slice(0,si);break}}}pe&&!q&&(Tr=a(Tr,Infinity));var ru=on.length+Tr.length+kn.length,Xu=ru<ae?new Array(ae-ru+1).join(L):"";switch(pe&&q&&(Tr=a(Xu+Tr,Xu.length?ae-kn.length:Infinity),Xu=""),F){case"<":Tr=on+Tr+kn+Xu;break;case"=":Tr=on+Xu+Tr+kn;break;case"^":Tr=Xu.slice(0,ru=Xu.length>>1)+on+Tr+kn+Xu.slice(ru);break;default:Tr=Xu+on+Tr+kn;break}return o(Tr)}return Or.toString=function(){return w+""},Or}function E(w,L){var F=g((w=bg(w),w.type="f",w)),U=Math.max(-8,Math.min(8,Math.floor(kv(L)/3)))*3,j=Math.pow(10,-U),q=ax[8+U/3];return function(ae){return F(j*ae)+q}}return{format:g,formatPrefix:E}}var Cg,by,ox;bM({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function bM(e){return Cg=xM(e),by=Cg.format,ox=Cg.formatPrefix,Cg}function EM(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,kv(a)-kv(e))+1}function CM(e){return Math.max(0,-kv(Math.abs(e)))}function SM(e,a,t,i){var r=dy(e,a,t),o;switch(i=bg(i==null?",f":i),i.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return i.precision==null&&!isNaN(o=vM(r,u))&&(i.precision=o),ox(i,u)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=EM(r,Math.max(Math.abs(e),Math.abs(a))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=CM(r))&&(i.precision=o-(i.type==="%")*2);break}}return by(i)}function Pv(e){var a=e.domain;return e.ticks=function(t){var i=a();return V1(i[0],i[i.length-1],t==null?10:t)},e.tickFormat=function(t,i){var r=a();return SM(r[0],r[r.length-1],t==null?10:t,i)},e.nice=function(t){t==null&&(t=10);var i=a(),r=0,o=i.length-1,u=i[r],p=i[o],v;return p<u&&(v=u,u=p,p=v,v=r,r=o,o=v),v=vg(u,p,t),v>0?(u=Math.floor(u/v)*v,p=Math.ceil(p/v)*v,v=vg(u,p,t)):v<0&&(u=Math.ceil(u*v)/v,p=Math.floor(p*v)/v,v=vg(u,p,t)),v>0?(i[r]=Math.floor(u/v)*v,i[o]=Math.ceil(p/v)*v,a(i)):v<0&&(i[r]=Math.ceil(u*v)/v,i[o]=Math.floor(p*v)/v,a(i)),e},e}function sx(){var e=J1(sf,sf);return e.copy=function(){return xg(e,sx())},b0.apply(e,arguments),Pv(e)}function ux(e){var a;function t(i){return isNaN(i=+i)?a:i}return t.invert=t,t.domain=t.range=function(i){return arguments.length?(e=yg.call(i,gy),t):e.slice()},t.unknown=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return ux(e).unknown(a)},e=arguments.length?yg.call(e,gy):[0,1],Pv(t)}function lx(e,a){e=e.slice();var t=0,i=e.length-1,r=e[t],o=e[i],u;return o<r&&(u=t,t=i,i=u,u=r,r=o,o=u),e[t]=a.floor(r),e[i]=a.ceil(o),e}function cx(e){return Math.log(e)}function fx(e){return Math.exp(e)}function AM(e){return-Math.log(-e)}function wM(e){return-Math.exp(-e)}function TM(e){return isFinite(e)?+("1e"+e):e<0?0:e}function MM(e){return e===10?TM:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function IM(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function hx(e){return function(a){return-e(-a)}}function kM(e){var a=e(cx,fx),t=a.domain,i=10,r,o;function u(){return r=IM(i),o=MM(i),t()[0]<0?(r=hx(r),o=hx(o),e(AM,wM)):e(cx,fx),a}return a.base=function(p){return arguments.length?(i=+p,u()):i},a.domain=function(p){return arguments.length?(t(p),u()):t()},a.ticks=function(p){var v=t(),g=v[0],E=v[v.length-1],w;(w=E<g)&&(L=g,g=E,E=L);var L=r(g),F=r(E),U,j,q,ae=p==null?10:+p,pe=[];if(!(i%1)&&F-L<ae){if(L=Math.round(L)-1,F=Math.round(F)+1,g>0){for(;L<F;++L)for(j=1,U=o(L);j<i;++j)if(q=U*j,!(q<g)){if(q>E)break;pe.push(q)}}else for(;L<F;++L)for(j=i-1,U=o(L);j>=1;--j)if(q=U*j,!(q<g)){if(q>E)break;pe.push(q)}}else pe=V1(L,F,Math.min(F-L,ae)).map(o);return w?pe.reverse():pe},a.tickFormat=function(p,v){if(v==null&&(v=i===10?".0e":","),typeof v!="function"&&(v=by(v)),p===Infinity)return v;p==null&&(p=10);var g=Math.max(1,i*p/a.ticks().length);return function(E){var w=E/o(Math.round(r(E)));return w*i<i-.5&&(w*=i),w<=g?v(E):""}},a.nice=function(){return t(lx(t(),{floor:function(p){return o(Math.floor(r(p)))},ceil:function(p){return o(Math.ceil(r(p)))}}))},a}function px(){var e=kM(_y()).domain([1,10]);return e.copy=function(){return xg(e,px()).base(e.base())},b0.apply(e,arguments),e}function dx(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function vx(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function PM(e){var a=1,t=e(dx(a),vx(a));return t.constant=function(i){return arguments.length?e(dx(a=+i),vx(a)):a},linearish(t)}function RM(){var e=PM(transformer());return e.copy=function(){return copy(e,RM()).constant(e.constant())},initRange.apply(e,arguments)}function mx(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function LM(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function OM(e){return e<0?-e*e:e*e}function FM(e){var a=e(sf,sf),t=1;function i(){return t===1?e(sf,sf):t===.5?e(LM,OM):e(mx(t),mx(1/t))}return a.exponent=function(r){return arguments.length?(t=+r,i()):t},Pv(a)}function Ey(){var e=FM(_y());return e.copy=function(){return xg(e,Ey()).exponent(e.exponent())},b0.apply(e,arguments),e}function uP(){return Ey.apply(null,arguments).exponent(.5)}function gx(){var e=[],a=[],t=[],i;function r(){var u=0,p=Math.max(1,a.length);for(t=new Array(p-1);++u<p;)t[u-1]=rM(e,u/p);return o}function o(u){return isNaN(u=+u)?i:a[dg(t,u)]}return o.invertExtent=function(u){var p=a.indexOf(u);return p<0?[NaN,NaN]:[p>0?t[p-1]:e[0],p<t.length?t[p]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var p=0,v=u.length,g;p<v;++p)g=u[p],g!=null&&!isNaN(g=+g)&&e.push(g);return e.sort(cy),r()},o.range=function(u){return arguments.length?(a=Q0.call(u),r()):a.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.quantiles=function(){return t.slice()},o.copy=function(){return gx().domain(e).range(a).unknown(i)},b0.apply(o,arguments)}function yx(){var e=0,a=1,t=1,i=[.5],r=[0,1],o;function u(v){return v<=v?r[dg(i,v,0,t)]:o}function p(){var v=-1;for(i=new Array(t);++v<t;)i[v]=((v+1)*a-(v-t)*e)/(t+1);return u}return u.domain=function(v){return arguments.length?(e=+v[0],a=+v[1],p()):[e,a]},u.range=function(v){return arguments.length?(t=(r=Q0.call(v)).length-1,p()):r.slice()},u.invertExtent=function(v){var g=r.indexOf(v);return g<0?[NaN,NaN]:g<1?[e,i[0]]:g>=t?[i[t-1],a]:[i[g-1],i[g]]},u.unknown=function(v){return arguments.length&&(o=v),u},u.thresholds=function(){return i.slice()},u.copy=function(){return yx().domain([e,a]).range(r).unknown(o)},b0.apply(Pv(u),arguments)}function _x(){var e=[.5],a=[0,1],t,i=1;function r(o){return o<=o?a[dg(e,o,0,i)]:t}return r.domain=function(o){return arguments.length?(e=Q0.call(o),i=Math.min(e.length,a.length-1),r):e.slice()},r.range=function(o){return arguments.length?(a=Q0.call(o),i=Math.min(e.length,a.length-1),r):a.slice()},r.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return _x().domain(e).range(a).unknown(t)},b0.apply(r,arguments)}var Cy=new Date,Sy=new Date;function Bf(e,a,t,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},r.round=function(o){var u=r(o),p=r.ceil(o);return o-u<p-o?u:p},r.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,p){var v=[],g;if(o=r.ceil(o),p=p==null?1:Math.floor(p),!(o<u)||!(p>0))return v;do v.push(g=new Date(+o)),a(o,p),e(o);while(g<o&&o<u);return v},r.filter=function(o){return Bf(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,p){if(u>=u)if(p<0)for(;++p<=0;)for(;a(u,-1),!o(u););else for(;--p>=0;)for(;a(u,1),!o(u););})},t&&(r.count=function(o,u){return Cy.setTime(+o),Sy.setTime(+u),e(Cy),e(Sy),Math.floor(t(Cy,Sy))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?function(u){return i(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var Ay=Bf(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ay.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Bf(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,t){a.setFullYear(a.getFullYear()+t*e)})};var Rv=Ay,lP=Ay.range,xx=Bf(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),DM=xx,cP=xx.range,Sg=1e3,mm=6e4,bx=36e5,Ex=864e5,Cx=6048e5;function J0(e){return Bf(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,t){a.setDate(a.getDate()+t*7)},function(a,t){return(t-a-(t.getTimezoneOffset()-a.getTimezoneOffset())*mm)/Cx})}var wy=J0(0),Ag=J0(1),BM=J0(2),NM=J0(3),Lv=J0(4),zM=J0(5),UM=J0(6),fP=wy.range,hP=Ag.range,pP=BM.range,dP=NM.range,vP=Lv.range,mP=zM.range,gP=UM.range,Sx=Bf(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*mm)/Ex},function(e){return e.getDate()-1}),Ty=Sx,yP=Sx.range,Ax=Bf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Sg-e.getMinutes()*mm)},function(e,a){e.setTime(+e+a*bx)},function(e,a){return(a-e)/bx},function(e){return e.getHours()}),ZM=Ax,_P=Ax.range,Tx=Bf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Sg)},function(e,a){e.setTime(+e+a*mm)},function(e,a){return(a-e)/mm},function(e){return e.getMinutes()}),VM=Tx,xP=Tx.range,Mx=Bf(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*Sg)},function(e,a){return(a-e)/Sg},function(e){return e.getUTCSeconds()}),jM=Mx,bP=Mx.range,wg=Bf(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});wg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Bf(function(a){a.setTime(Math.floor(a/e)*e)},function(a,t){a.setTime(+a+t*e)},function(a,t){return(t-a)/e}):wg};var GM=wg,EP=wg.range;function ev(e){return Bf(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCDate(a.getUTCDate()+t*7)},function(a,t){return(t-a)/Cx})}var Ix=ev(0),Tg=ev(1),HM=ev(2),WM=ev(3),Ov=ev(4),XM=ev(5),YM=ev(6),CP=Ix.range,SP=Tg.range,AP=HM.range,wP=WM.range,TP=Ov.range,MP=XM.range,IP=YM.range,kx=Bf(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/Ex},function(e){return e.getUTCDate()-1}),Px=kx,kP=kx.range,My=Bf(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});My.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Bf(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCFullYear(a.getUTCFullYear()+t*e)})};var gm=My,PP=My.range;function Iy(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ky(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ym(e,a,t){return{y:e,m:a,d:t,H:0,M:0,S:0,L:0}}function qM(e){var a=e.dateTime,t=e.date,i=e.time,r=e.periods,o=e.days,u=e.shortDays,p=e.months,v=e.shortMonths,g=_m(r),E=xm(r),w=_m(o),L=xm(o),F=_m(u),U=xm(u),j=_m(p),q=xm(p),ae=_m(v),pe=xm(v),Fe={a:Ss,A:ru,b:Xu,B:sh,c:null,d:Bx,e:Bx,f:y3,g:M3,G:k3,H:v3,I:m3,j:g3,L:Nx,m:_3,M:x3,p:nv,q:Rm,Q:Gx,s:Hx,S:b3,u:E3,U:C3,V:S3,w:A3,W:w3,x:null,X:null,y:T3,Y:I3,Z:P3,"%":jx},Qe={a:iv,A:zv,b:av,B:Uv,c:null,d:Ux,e:Ux,f:F3,g:H3,G:X3,H:R3,I:L3,j:O3,L:Zx,m:D3,M:B3,p:Zy,q:Vy,Q:Gx,s:Hx,S:N3,u:z3,U:U3,V:Z3,w:V3,W:j3,x:null,X:null,y:G3,Y:W3,Z:Y3,"%":jx},yt={a:Or,A:Tr,b:on,B:kn,c:si,d:Fx,e:Fx,f:f3,g:Ox,G:Lx,H:Dx,I:Dx,j:s3,L:c3,m:o3,M:u3,p:Ir,q:a3,Q:p3,s:d3,S:l3,u:e3,U:t3,V:r3,w:JM,W:n3,x:Xa,X:bo,y:Ox,Y:Lx,Z:i3,"%":h3};Fe.x=vt(t,Fe),Fe.X=vt(i,Fe),Fe.c=vt(a,Fe),Qe.x=vt(t,Qe),Qe.X=vt(i,Qe),Qe.c=vt(a,Qe);function vt(aa,Lo){return function(ls){var fi=[],uh=-1,du=0,Uh=aa.length,Zh,ov,O2;for(ls instanceof Date||(ls=new Date(+ls));++uh<Uh;)aa.charCodeAt(uh)===37&&(fi.push(aa.slice(du,uh)),(ov=Rx[Zh=aa.charAt(++uh)])!=null?Zh=aa.charAt(++uh):ov=Zh==="e"?" ":"0",(O2=Lo[Zh])&&(Zh=O2(ls,ov)),fi.push(Zh),du=uh+1);return fi.push(aa.slice(du,uh)),fi.join("")}}function Bt(aa,Lo){return function(ls){var fi=ym(1900,void 0,1),uh=Qt(fi,aa,ls+="",0),du,Uh;if(uh!=ls.length)return null;if("Q"in fi)return new Date(fi.Q);if("s"in fi)return new Date(fi.s*1e3+("L"in fi?fi.L:0));if(Lo&&!("Z"in fi)&&(fi.Z=0),"p"in fi&&(fi.H=fi.H%12+fi.p*12),fi.m===void 0&&(fi.m="q"in fi?fi.q:0),"V"in fi){if(fi.V<1||fi.V>53)return null;"w"in fi||(fi.w=1),"Z"in fi?(du=ky(ym(fi.y,0,1)),Uh=du.getUTCDay(),du=Uh>4||Uh===0?Tg.ceil(du):Tg(du),du=Px.offset(du,(fi.V-1)*7),fi.y=du.getUTCFullYear(),fi.m=du.getUTCMonth(),fi.d=du.getUTCDate()+(fi.w+6)%7):(du=Iy(ym(fi.y,0,1)),Uh=du.getDay(),du=Uh>4||Uh===0?Ag.ceil(du):Ag(du),du=Ty.offset(du,(fi.V-1)*7),fi.y=du.getFullYear(),fi.m=du.getMonth(),fi.d=du.getDate()+(fi.w+6)%7)}else("W"in fi||"U"in fi)&&("w"in fi||(fi.w="u"in fi?fi.u%7:"W"in fi?1:0),Uh="Z"in fi?ky(ym(fi.y,0,1)).getUTCDay():Iy(ym(fi.y,0,1)).getDay(),fi.m=0,fi.d="W"in fi?(fi.w+6)%7+fi.W*7-(Uh+5)%7:fi.w+fi.U*7-(Uh+6)%7);return"Z"in fi?(fi.H+=fi.Z/100|0,fi.M+=fi.Z%100,ky(fi)):Iy(fi)}}function Qt(aa,Lo,ls,fi){for(var uh=0,du=Lo.length,Uh=ls.length,Zh,ov;uh<du;){if(fi>=Uh)return-1;if(Zh=Lo.charCodeAt(uh++),Zh===37){if(Zh=Lo.charAt(uh++),ov=yt[Zh in Rx?Lo.charAt(uh++):Zh],!ov||(fi=ov(aa,ls,fi))<0)return-1}else if(Zh!=ls.charCodeAt(fi++))return-1}return fi}function Ir(aa,Lo,ls){var fi=g.exec(Lo.slice(ls));return fi?(aa.p=E[fi[0].toLowerCase()],ls+fi[0].length):-1}function Or(aa,Lo,ls){var fi=F.exec(Lo.slice(ls));return fi?(aa.w=U[fi[0].toLowerCase()],ls+fi[0].length):-1}function Tr(aa,Lo,ls){var fi=w.exec(Lo.slice(ls));return fi?(aa.w=L[fi[0].toLowerCase()],ls+fi[0].length):-1}function on(aa,Lo,ls){var fi=ae.exec(Lo.slice(ls));return fi?(aa.m=pe[fi[0].toLowerCase()],ls+fi[0].length):-1}function kn(aa,Lo,ls){var fi=j.exec(Lo.slice(ls));return fi?(aa.m=q[fi[0].toLowerCase()],ls+fi[0].length):-1}function si(aa,Lo,ls){return Qt(aa,a,Lo,ls)}function Xa(aa,Lo,ls){return Qt(aa,t,Lo,ls)}function bo(aa,Lo,ls){return Qt(aa,i,Lo,ls)}function Ss(aa){return u[aa.getDay()]}function ru(aa){return o[aa.getDay()]}function Xu(aa){return v[aa.getMonth()]}function sh(aa){return p[aa.getMonth()]}function nv(aa){return r[+(aa.getHours()>=12)]}function Rm(aa){return 1+~~(aa.getMonth()/3)}function iv(aa){return u[aa.getUTCDay()]}function zv(aa){return o[aa.getUTCDay()]}function av(aa){return v[aa.getUTCMonth()]}function Uv(aa){return p[aa.getUTCMonth()]}function Zy(aa){return r[+(aa.getUTCHours()>=12)]}function Vy(aa){return 1+~~(aa.getUTCMonth()/3)}return{format:function(aa){var Lo=vt(aa+="",Fe);return Lo.toString=function(){return aa},Lo},parse:function(aa){var Lo=Bt(aa+="",!1);return Lo.toString=function(){return aa},Lo},utcFormat:function(aa){var Lo=vt(aa+="",Qe);return Lo.toString=function(){return aa},Lo},utcParse:function(aa){var Lo=Bt(aa+="",!0);return Lo.toString=function(){return aa},Lo}}}var Rx={"-":"",_:" ","0":"0"},cc=/^\s*\d+/,$M=/^%/,KM=/[\\^$*+?|[\]().{}]/g;function us(e,a,t){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<t?new Array(t-o+1).join(a)+r:r)}function QM(e){return e.replace(KM,"\\$&")}function _m(e){return new RegExp("^(?:"+e.map(QM).join("|")+")","i")}function xm(e){for(var a={},t=-1,i=e.length;++t<i;)a[e[t].toLowerCase()]=t;return a}function JM(e,a,t){var i=cc.exec(a.slice(t,t+1));return i?(e.w=+i[0],t+i[0].length):-1}function e3(e,a,t){var i=cc.exec(a.slice(t,t+1));return i?(e.u=+i[0],t+i[0].length):-1}function t3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.U=+i[0],t+i[0].length):-1}function r3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.V=+i[0],t+i[0].length):-1}function n3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.W=+i[0],t+i[0].length):-1}function Lx(e,a,t){var i=cc.exec(a.slice(t,t+4));return i?(e.y=+i[0],t+i[0].length):-1}function Ox(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),t+i[0].length):-1}function i3(e,a,t){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(t,t+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),t+i[0].length):-1}function a3(e,a,t){var i=cc.exec(a.slice(t,t+1));return i?(e.q=i[0]*3-3,t+i[0].length):-1}function o3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.m=i[0]-1,t+i[0].length):-1}function Fx(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.d=+i[0],t+i[0].length):-1}function s3(e,a,t){var i=cc.exec(a.slice(t,t+3));return i?(e.m=0,e.d=+i[0],t+i[0].length):-1}function Dx(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.H=+i[0],t+i[0].length):-1}function u3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.M=+i[0],t+i[0].length):-1}function l3(e,a,t){var i=cc.exec(a.slice(t,t+2));return i?(e.S=+i[0],t+i[0].length):-1}function c3(e,a,t){var i=cc.exec(a.slice(t,t+3));return i?(e.L=+i[0],t+i[0].length):-1}function f3(e,a,t){var i=cc.exec(a.slice(t,t+6));return i?(e.L=Math.floor(i[0]/1e3),t+i[0].length):-1}function h3(e,a,t){var i=$M.exec(a.slice(t,t+1));return i?t+i[0].length:-1}function p3(e,a,t){var i=cc.exec(a.slice(t));return i?(e.Q=+i[0],t+i[0].length):-1}function d3(e,a,t){var i=cc.exec(a.slice(t));return i?(e.s=+i[0],t+i[0].length):-1}function Bx(e,a){return us(e.getDate(),a,2)}function v3(e,a){return us(e.getHours(),a,2)}function m3(e,a){return us(e.getHours()%12||12,a,2)}function g3(e,a){return us(1+Ty.count(Rv(e),e),a,3)}function Nx(e,a){return us(e.getMilliseconds(),a,3)}function y3(e,a){return Nx(e,a)+"000"}function _3(e,a){return us(e.getMonth()+1,a,2)}function x3(e,a){return us(e.getMinutes(),a,2)}function b3(e,a){return us(e.getSeconds(),a,2)}function E3(e){var a=e.getDay();return a===0?7:a}function C3(e,a){return us(wy.count(Rv(e)-1,e),a,2)}function zx(e){var a=e.getDay();return a>=4||a===0?Lv(e):Lv.ceil(e)}function S3(e,a){return e=zx(e),us(Lv.count(Rv(e),e)+(Rv(e).getDay()===4),a,2)}function A3(e){return e.getDay()}function w3(e,a){return us(Ag.count(Rv(e)-1,e),a,2)}function T3(e,a){return us(e.getFullYear()%100,a,2)}function M3(e,a){return e=zx(e),us(e.getFullYear()%100,a,2)}function I3(e,a){return us(e.getFullYear()%1e4,a,4)}function k3(e,a){var t=e.getDay();return e=t>=4||t===0?Lv(e):Lv.ceil(e),us(e.getFullYear()%1e4,a,4)}function P3(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+us(a/60|0,"0",2)+us(a%60,"0",2)}function Ux(e,a){return us(e.getUTCDate(),a,2)}function R3(e,a){return us(e.getUTCHours(),a,2)}function L3(e,a){return us(e.getUTCHours()%12||12,a,2)}function O3(e,a){return us(1+Px.count(gm(e),e),a,3)}function Zx(e,a){return us(e.getUTCMilliseconds(),a,3)}function F3(e,a){return Zx(e,a)+"000"}function D3(e,a){return us(e.getUTCMonth()+1,a,2)}function B3(e,a){return us(e.getUTCMinutes(),a,2)}function N3(e,a){return us(e.getUTCSeconds(),a,2)}function z3(e){var a=e.getUTCDay();return a===0?7:a}function U3(e,a){return us(Ix.count(gm(e)-1,e),a,2)}function Vx(e){var a=e.getUTCDay();return a>=4||a===0?Ov(e):Ov.ceil(e)}function Z3(e,a){return e=Vx(e),us(Ov.count(gm(e),e)+(gm(e).getUTCDay()===4),a,2)}function V3(e){return e.getUTCDay()}function j3(e,a){return us(Tg.count(gm(e)-1,e),a,2)}function G3(e,a){return us(e.getUTCFullYear()%100,a,2)}function H3(e,a){return e=Vx(e),us(e.getUTCFullYear()%100,a,2)}function W3(e,a){return us(e.getUTCFullYear()%1e4,a,4)}function X3(e,a){var t=e.getUTCDay();return e=t>=4||t===0?Ov(e):Ov.ceil(e),us(e.getUTCFullYear()%1e4,a,4)}function Y3(){return"+0000"}function jx(){return"%"}function Gx(e){return+e}function Hx(e){return Math.floor(+e/1e3)}var Fv,Wx,q3,$3,K3;Q3({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Q3(e){return Fv=qM(e),Wx=Fv.format,q3=Fv.parse,$3=Fv.utcFormat,K3=Fv.utcParse,Fv}var bm=1e3,Em=bm*60,Cm=Em*60,Sm=Cm*24,J3=Sm*7,Xx=Sm*30,Py=Sm*365;function e4(e){return new Date(e)}function t4(e){return e instanceof Date?+e:+new Date(+e)}function Yx(e,a,t,i,r,o,u,p,v){var g=J1(sf,sf),E=g.invert,w=g.domain,L=v(".%L"),F=v(":%S"),U=v("%I:%M"),j=v("%I %p"),q=v("%a %d"),ae=v("%b %d"),pe=v("%B"),Fe=v("%Y"),Qe=[[u,1,bm],[u,5,5*bm],[u,15,15*bm],[u,30,30*bm],[o,1,Em],[o,5,5*Em],[o,15,15*Em],[o,30,30*Em],[r,1,Cm],[r,3,3*Cm],[r,6,6*Cm],[r,12,12*Cm],[i,1,Sm],[i,2,2*Sm],[t,1,J3],[a,1,Xx],[a,3,3*Xx],[e,1,Py]];function yt(Bt){return(u(Bt)<Bt?L:o(Bt)<Bt?F:r(Bt)<Bt?U:i(Bt)<Bt?j:a(Bt)<Bt?t(Bt)<Bt?q:ae:e(Bt)<Bt?pe:Fe)(Bt)}function vt(Bt,Qt,Ir,Or){if(Bt==null&&(Bt=10),typeof Bt=="number"){var Tr=Math.abs(Ir-Qt)/Bt,on=N1(function(kn){return kn[2]}).right(Qe,Tr);on===Qe.length?(Or=dy(Qt/Py,Ir/Py,Bt),Bt=e):on?(on=Qe[Tr/Qe[on-1][2]<Qe[on][2]/Tr?on-1:on],Or=on[1],Bt=on[0]):(Or=Math.max(dy(Qt,Ir,Bt),1),Bt=p)}return Or==null?Bt:Bt.every(Or)}return g.invert=function(Bt){return new Date(E(Bt))},g.domain=function(Bt){return arguments.length?w(yg.call(Bt,t4)):w().map(e4)},g.ticks=function(Bt,Qt){var Ir=w(),Or=Ir[0],Tr=Ir[Ir.length-1],on=Tr<Or,kn;return on&&(kn=Or,Or=Tr,Tr=kn),kn=vt(Bt,Or,Tr,Qt),kn=kn?kn.range(Or,Tr+1):[],on?kn.reverse():kn},g.tickFormat=function(Bt,Qt){return Qt==null?yt:v(Qt)},g.nice=function(Bt,Qt){var Ir=w();return(Bt=vt(Bt,Ir[0],Ir[Ir.length-1],Qt))?w(lx(Ir,Bt)):g},g.copy=function(){return xg(g,Yx(e,a,t,i,r,o,u,p,v))},g}function r4(){return b0.apply(Yx(Rv,DM,wy,Ty,ZM,VM,jM,GM,Wx).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function RP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Mg(){var e=0,a=1,t,i,r,o,u=sf,p=!1,v;function g(E){return isNaN(E=+E)?v:u(r===0?.5:(E=(o(E)-t)*r,p?Math.max(0,Math.min(1,E)):E))}return g.domain=function(E){return arguments.length?(t=o(e=+E[0]),i=o(a=+E[1]),r=t===i?0:1/(i-t),g):[e,a]},g.clamp=function(E){return arguments.length?(p=!!E,g):p},g.interpolator=function(E){return arguments.length?(u=E,g):u},g.unknown=function(E){return arguments.length?(v=E,g):v},function(E){return o=E,t=E(e),i=E(a),r=t===i?0:1/(i-t),g}}function Am(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function qx(){var e=Pv(Mg()(sf));return e.copy=function(){return Am(e,qx())},X1.apply(e,arguments)}function n4(){var e=loggish(Mg()).domain([1,10]);return e.copy=function(){return Am(e,n4()).base(e.base())},initInterpolator.apply(e,arguments)}function i4(){var e=symlogish(Mg());return e.copy=function(){return Am(e,i4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function $x(){var e=powish(Mg());return e.copy=function(){return Am(e,$x()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function LP(){return $x.apply(null,arguments).exponent(.5)}function a4(){var e=[],a=identity;function t(i){if(!isNaN(i=+i))return a((bisect(e,i)-1)/(e.length-1))}return t.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var r=0,o=i.length,u;r<o;++r)u=i[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return a4(a).domain(e)},initInterpolator.apply(t,arguments)}function Ig(){var e=0,a=.5,t=1,i,r,o,u,p,v=sf,g,E=!1,w;function L(F){return isNaN(F=+F)?w:(F=.5+((F=+g(F))-r)*(F<r?u:p),v(E?Math.max(0,Math.min(1,F)):F))}return L.domain=function(F){return arguments.length?(i=g(e=+F[0]),r=g(a=+F[1]),o=g(t=+F[2]),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),L):[e,a,t]},L.clamp=function(F){return arguments.length?(E=!!F,L):E},L.interpolator=function(F){return arguments.length?(v=F,L):v},L.unknown=function(F){return arguments.length?(w=F,L):w},function(F){return g=F,i=F(e),r=F(a),o=F(t),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),L}}function Kx(){var e=Pv(Ig()(sf));return e.copy=function(){return Am(e,Kx())},X1.apply(e,arguments)}function o4(){var e=loggish(Ig()).domain([.1,1,10]);return e.copy=function(){return copy(e,o4()).base(e.base())},initInterpolator.apply(e,arguments)}function s4(){var e=symlogish(Ig());return e.copy=function(){return copy(e,s4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Qx(){var e=powish(Ig());return e.copy=function(){return copy(e,Qx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function OP(){return Qx.apply(null,arguments).exponent(.5)}var zh,Jx,eb,tb,Ry,rb,u4=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,l4=(zh={},(0,ye.Z)(zh,ss.LINEAR,sx),(0,ye.Z)(zh,ss.POWER,Ey),(0,ye.Z)(zh,ss.LOG,px),(0,ye.Z)(zh,ss.IDENTITY,ux),(0,ye.Z)(zh,ss.SEQUENTIAL,qx),(0,ye.Z)(zh,ss.TIME,r4),(0,ye.Z)(zh,ss.QUANTILE,gx),(0,ye.Z)(zh,ss.QUANTIZE,yx),(0,ye.Z)(zh,ss.THRESHOLD,_x),(0,ye.Z)(zh,ss.CAT,_g),(0,ye.Z)(zh,ss.DIVERGING,Kx),zh),c4=(Jx=(0,xn.b2)(),eb=(0,xn.f3)(hr.IGlobalConfigService),Jx(tb=(Ry=function(){function e(){(0,Ft.Z)(this,e),va(this,"configService",rb,this),(0,ye.Z)(this,"scaleCache",{}),(0,ye.Z)(this,"scaleOptions",{})}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),p=t.getSource().data.dataArray;p.length!==0&&r.caculateScalesForAttributes(u||[],p)}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),p=t.getSource().data.dataArray;return r.caculateScalesForAttributes(u||[],p),t.layerModelNeedUpdate=!0,!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();if(u){var p=t.getSource().data.dataArray;if(p.length===0)return;var v=u.filter(function(g){return g.needRescale});v.length&&r.caculateScalesForAttributes(v,p)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,i){var r=this;this.scaleCache={},t.forEach(function(o){if(o.scale){var u=o.scale,p=o.name;u.names=r.parseFields(o.scale.field||[]);var v=[];u.names.forEach(function(g){var E;v.push(r.createScale(g,o.name,(E=o.scale)===null||E===void 0?void 0:E.values,i))}),v.some(function(g){return g.type===m0.VARIABLE})?(u.type=m0.VARIABLE,v.forEach(function(g){var E;if(!u.callback&&u.values!=="text")switch((E=g.option)===null||E===void 0?void 0:E.type){case ss.LOG:case ss.LINEAR:case ss.POWER:if(u.values&&u.values.length>2){var w=g.scale.ticks(u.values.length);g.scale.domain(w)}u.values?g.scale.range(u.values):g.scale.range(g.option.domain);break;case ss.QUANTILE:case ss.QUANTIZE:case ss.THRESHOLD:g.scale.range(u.values);break;case ss.CAT:u.values?g.scale.range(u.values):g.scale.range(g.option.domain);break;case ss.DIVERGING:case ss.SEQUENTIAL:g.scale.interpolator(nM.hD(u.values));break}if(u.values==="text"){var L;g.scale.range((L=g.option)===null||L===void 0?void 0:L.domain)}})):(u.type=m0.CONSTANT,u.defaultValues=v.map(function(g,E){return g.scale(u.names[E])})),u.scalers=v.map(function(g){return{field:g.field,func:g.scale,option:g.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,gr.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,i,r,o){var u,p,v=this.scaleOptions[i]&&((u=this.scaleOptions[i])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[i]:this.scaleOptions[t],g={field:t,scale:void 0,type:m0.VARIABLE,option:v};if(!o||!o.length)return v&&v.type?g.scale=this.createDefaultScale(v):(g.scale=_g([t]),g.type=m0.CONSTANT),g;var E=(p=o.find(function(F){return!(0,gr.isNil)(F[t])}))===null||p===void 0?void 0:p[t];if(this.isNumber(t)||(0,gr.isNil)(E)&&!v)g.scale=_g([t]),g.type=m0.CONSTANT;else{var w=v&&v.type||this.getDefaultType(E);r==="text"&&(w=ss.CAT);var L=this.createScaleConfig(w,t,v,o);g.scale=this.createDefaultScale(L),g.option=L}return g}},{key:"getDefaultType",value:function(t){var i=ss.LINEAR;return typeof t=="string"&&(i=u4.test(t)?ss.TIME:ss.CAT),i}},{key:"createScaleConfig",value:function(t,i,r,o){var u={type:t},p=(o==null?void 0:o.map(function(E){return E[i]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t!==ss.CAT&&t!==ss.QUANTILE&&t!==ss.DIVERGING)u.domain=U1(p);else if(t===ss.CAT)u.domain=(0,gr.uniq)(p);else if(t===ss.QUANTILE)u.domain=p;else if(t===ss.DIVERGING){var v=U1(p),g=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(v[0]+v[1])/2;u.domain=[v[0],g,v[1]]}return(0,Z.Z)((0,Z.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var i=t.type,r=t.domain,o=t.unknown,u=t.clamp,p=t.nice,v=l4[i]();return r&&v.domain&&v.domain(r),o&&v.unknown(o),u!==void 0&&v.clamp&&v.clamp(u),p!==void 0&&v.nice&&v.nice(p),v}}]),e}(),rb=ca(Ry.prototype,"configService",[eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry))||tb),nb,ib,ab,ob,kg,sb,ub,f4=(nb=(0,xn.b2)(),ib=(0,xn.f3)(hr.ICameraService),ab=(0,xn.f3)(hr.IRendererService),nb(ob=(kg=function(){function e(){(0,Ft.Z)(this,e),va(this,"cameraService",sb,this),va(this,"rendererService",ub,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(i){i.addUniforms((0,Z.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),sb=ca(kg.prototype,"cameraService",[ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ub=ca(kg.prototype,"rendererService",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg))||ob),lb,cb,h4=(lb=(0,xn.b2)(),lb(cb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var i=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var r=t.getSource();r.inited&&i.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=t.getSource();return r.inited?i.prepareLayerModel(t):r.once("sourceUpdate",function(){i.prepareLayerModel(t)}),!1})}}]),e}())||cb),fb,hb,p4=(fb=(0,xn.b2)(),fb(hb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var i=t.getLayerConfig(),r=i.autoFit,o=i.fitBoundsOptions;r&&setTimeout(function(){t.fitBounds(o)},100)})}}]),e}())||hb),pb,db,d4=["type"],vb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},v4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},m4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},g4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},FP=null;function y4(e){var a={u_DirectionalLights:new Array(3).fill((0,Z.Z)({},m4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Z.Z)({},g4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[v4]),e.forEach(function(t,i){var r=t.type,o=r===void 0?"directional":r,u=(0,Oh.Z)(t,d4),p=vb[o].lights,v=vb[o].num,g=a[v];a[p][g]=(0,Z.Z)((0,Z.Z)({},a[p][g]),u),a[v]++}),a}var _4=(pb=(0,xn.b2)(),pb(db=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var i=t.getLayerConfig(),r=i.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,Z.Z)({},y4()))})})}}]),e}())||db),mb,gb,yb,Ly,_b,x4=(mb=(0,xn.b2)(),gb=(0,xn.f3)(hr.IGlobalConfigService),mb(yb=(Ly=function(){function e(){(0,Ft.Z)(this,e),va(this,"configService",_b,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.rendererService,u=i.postProcessingPassFactory,p=i.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var v=t.getLayerConfig(),g=v.enableMultiPassRenderer,E=v.passes,w=E===void 0?[]:E;r.enabled=!!g&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=T_(t,w,u,p),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var v=o.getViewportSize(),g=v.width,E=v.height;t.multiPassRenderer.resize(g,E)}})}}]),e}(),_b=ca(Ly.prototype,"configService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly))||yb),xb,bb,Pg={NONE:0,ENCODE:1,HIGHLIGHT:2},b4=(xb=(0,xn.b2)(),xb(bb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=i.rendererService,o=i.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking,v=u.enableMultiPassRenderer;o.registerStyleAttribute({name:"pickingColor",type:Gn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:X.FLOAT},size:3,update:function(E,w){var L=E.id;return p?te(L):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Pg.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Pg.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.highlightColor,g=p.activeMix,E=g===void 0?0:g,w=typeof v=="string"?B(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Y(new Uint8Array(u))}),t.models.forEach(function(L){return L.addUniforms({u_PickingStage:Pg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:w.map(function(F){return F*255}),u_activeMix:E})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.selectColor,g=p.selectMix,E=g===void 0?0:g,w=typeof v=="string"?B(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Y(new Uint8Array(u))}),t.models.forEach(function(L){return L.addUniforms({u_PickingStage:Pg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:w.map(function(F){return F*255}),u_activeMix:E,u_CurrentSelectedId:u,u_SelectColor:w.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||bb),Eb,Cb,E4=(Eb=(0,xn.b2)(),Eb(Cb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(o)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Gn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:X.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}}),t.registerStyleAttribute({name:"filter",type:Gn.Attribute,descriptor:{name:"filter",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(r,o){var u=r.filter;return u?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Gn.Attribute,descriptor:{name:"a_Color",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(r,o){var u=r.color;return!u||!u.length?[1,1,1,1]:u}}}),t.registerStyleAttribute({name:"vertexId",type:Gn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(r,o,u,p){return[o]}}})}}]),e}())||Cb),Sb,Ab,wb,Tb,Mb,Ib,Dv,kb,Pb,Rb,Lb,C4=(Sb=(0,xn.b2)(),Ab=(0,xn.f3)(hr.ICameraService),wb=(0,xn.f3)(hr.ICoordinateSystemService),Tb=(0,xn.f3)(hr.IRendererService),Mb=(0,xn.f3)(hr.IMapService),Sb(Ib=(Dv=function(){function e(){(0,Ft.Z)(this,e),va(this,"cameraService",kb,this),va(this,"coordinateSystemService",Pb,this),va(this,"rendererService",Rb,this),va(this,"mapService",Lb,this)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){var i=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var p=t.getLayerConfig().tileOrigin;if(i.coordinateSystemService.refresh(p),r==="GAODE2.x"){var v=i.getLayerCenter(t);i.mapService.map.customCoords.setCenter(v),i.mapService.setCustomCoordCenter(v),o=i.mapService.map.customCoords.getMVPMatrix(),u=i.mapService.getCustomCoordCenter()}var g=i.rendererService.getViewportSize(),E=g.width,w=g.height;t.models.forEach(function(L){var F;L.addUniforms((F={},(0,ye.Z)(F,W0.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,ye.Z)(F,W0.ViewMatrix,i.cameraService.getViewMatrix()),(0,ye.Z)(F,W0.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,ye.Z)(F,W0.Zoom,i.cameraService.getZoom()),(0,ye.Z)(F,W0.ZoomScale,i.cameraService.getZoomScale()),(0,ye.Z)(F,W0.FocalDistance,i.cameraService.getFocalDistance()),(0,ye.Z)(F,W0.CameraPosition,i.cameraService.getCameraPosition()),(0,ye.Z)(F,up.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,ye.Z)(F,up.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,ye.Z)(F,up.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,ye.Z)(F,up.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,ye.Z)(F,up.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,ye.Z)(F,up.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,ye.Z)(F,up.Mvp,o),(0,ye.Z)(F,"u_SceneCenterMKT",u),(0,ye.Z)(F,"u_ViewportSize",[E,w]),(0,ye.Z)(F,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,ye.Z)(F,"u_DevicePixelRatio",Pa.devicePixelRatio),(0,ye.Z)(F,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,ye.Z)(F,"u_shaderPick",Number(t.getShaderPickStat())),F))})})}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}}]),e}(),kb=ca(Dv.prototype,"cameraService",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=ca(Dv.prototype,"coordinateSystemService",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=ca(Dv.prototype,"rendererService",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lb=ca(Dv.prototype,"mapService",[Mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv))||Ib),Ob,Fb,S4=(Ob=(0,xn.b2)(),Ob(Fb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||Fb),Db,Bb,A4=(Db=(0,xn.b2)(),Db(Bb=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||r.updateStyleAtrribute(t,{styleAttributeService:o})})}},{key:"updateStyleAtrribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),p=r.getLayerStyleAttribute("shape");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(v){return v.needRegenerateVertices=!1});return}o.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){r.updateAttributeByFeatureRange(v.name,t.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||Bb);Bh.bind(hr.ILayerPlugin).to(Q5).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(E4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(c4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(K5).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(p4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(A4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(S4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(x4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(C4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(f4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(_4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(b4).inRequestScope(),Bh.bind(hr.ILayerPlugin).to(h4).inRequestScope();var w4=fe(88307),T4=fe.n(w4),M4=function(){function e(a,t){(0,Ft.Z)(this,e);var i=t.buffer,r=t.offset,o=t.stride,u=t.normalized,p=t.size,v=t.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:v||0},p&&(this.attribute.size=p)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Wd,wm,Xd,dp,Tm,E0,Mm,Rg,vd,tv,Oc,md,gd,Lg,I4=(Wd={},(0,ye.Z)(Wd,X.POINTS,"points"),(0,ye.Z)(Wd,X.LINES,"lines"),(0,ye.Z)(Wd,X.LINE_LOOP,"line loop"),(0,ye.Z)(Wd,X.LINE_STRIP,"line strip"),(0,ye.Z)(Wd,X.TRIANGLES,"triangles"),(0,ye.Z)(Wd,X.TRIANGLE_FAN,"triangle fan"),(0,ye.Z)(Wd,X.TRIANGLE_STRIP,"triangle strip"),Wd),Nb=(wm={},(0,ye.Z)(wm,X.STATIC_DRAW,"static"),(0,ye.Z)(wm,X.DYNAMIC_DRAW,"dynamic"),(0,ye.Z)(wm,X.STREAM_DRAW,"stream"),wm),Oy=(Xd={},(0,ye.Z)(Xd,X.BYTE,"int8"),(0,ye.Z)(Xd,X.UNSIGNED_INT,"int16"),(0,ye.Z)(Xd,X.INT,"int32"),(0,ye.Z)(Xd,X.UNSIGNED_BYTE,"uint8"),(0,ye.Z)(Xd,X.UNSIGNED_SHORT,"uint16"),(0,ye.Z)(Xd,X.UNSIGNED_INT,"uint32"),(0,ye.Z)(Xd,X.FLOAT,"float"),Xd),k4=(dp={},(0,ye.Z)(dp,X.ALPHA,"alpha"),(0,ye.Z)(dp,X.LUMINANCE,"luminance"),(0,ye.Z)(dp,X.LUMINANCE_ALPHA,"luminance alpha"),(0,ye.Z)(dp,X.RGB,"rgb"),(0,ye.Z)(dp,X.RGBA,"rgba"),(0,ye.Z)(dp,X.RGBA4,"rgba4"),(0,ye.Z)(dp,X.RGB5_A1,"rgb5 a1"),(0,ye.Z)(dp,X.RGB565,"rgb565"),(0,ye.Z)(dp,X.DEPTH_COMPONENT,"depth"),(0,ye.Z)(dp,X.DEPTH_STENCIL,"depth stencil"),dp),P4=(Tm={},(0,ye.Z)(Tm,X.DONT_CARE,"dont care"),(0,ye.Z)(Tm,X.NICEST,"nice"),(0,ye.Z)(Tm,X.FASTEST,"fast"),Tm),zb=(E0={},(0,ye.Z)(E0,X.NEAREST,"nearest"),(0,ye.Z)(E0,X.LINEAR,"linear"),(0,ye.Z)(E0,X.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,ye.Z)(E0,X.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,ye.Z)(E0,X.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,ye.Z)(E0,X.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),E0),Ub=(Mm={},(0,ye.Z)(Mm,X.REPEAT,"repeat"),(0,ye.Z)(Mm,X.CLAMP_TO_EDGE,"clamp"),(0,ye.Z)(Mm,X.MIRRORED_REPEAT,"mirror"),Mm),R4=(Rg={},(0,ye.Z)(Rg,X.NONE,"none"),(0,ye.Z)(Rg,X.BROWSER_DEFAULT_WEBGL,"browser"),Rg),L4=(vd={},(0,ye.Z)(vd,X.NEVER,"never"),(0,ye.Z)(vd,X.ALWAYS,"always"),(0,ye.Z)(vd,X.LESS,"less"),(0,ye.Z)(vd,X.LEQUAL,"lequal"),(0,ye.Z)(vd,X.GREATER,"greater"),(0,ye.Z)(vd,X.GEQUAL,"gequal"),(0,ye.Z)(vd,X.EQUAL,"equal"),(0,ye.Z)(vd,X.NOTEQUAL,"notequal"),vd),Zb=(tv={},(0,ye.Z)(tv,X.FUNC_ADD,"add"),(0,ye.Z)(tv,X.MIN_EXT,"min"),(0,ye.Z)(tv,X.MAX_EXT,"max"),(0,ye.Z)(tv,X.FUNC_SUBTRACT,"subtract"),(0,ye.Z)(tv,X.FUNC_REVERSE_SUBTRACT,"reverse subtract"),tv),Og=(Oc={},(0,ye.Z)(Oc,X.ZERO,"zero"),(0,ye.Z)(Oc,X.ONE,"one"),(0,ye.Z)(Oc,X.SRC_COLOR,"src color"),(0,ye.Z)(Oc,X.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,ye.Z)(Oc,X.SRC_ALPHA,"src alpha"),(0,ye.Z)(Oc,X.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,ye.Z)(Oc,X.DST_COLOR,"dst color"),(0,ye.Z)(Oc,X.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,ye.Z)(Oc,X.DST_ALPHA,"dst alpha"),(0,ye.Z)(Oc,X.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,ye.Z)(Oc,X.CONSTANT_COLOR,"constant color"),(0,ye.Z)(Oc,X.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,ye.Z)(Oc,X.CONSTANT_ALPHA,"constant alpha"),(0,ye.Z)(Oc,X.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,ye.Z)(Oc,X.SRC_ALPHA_SATURATE,"src alpha saturate"),Oc),O4=(md={},(0,ye.Z)(md,X.NEVER,"never"),(0,ye.Z)(md,X.ALWAYS,"always"),(0,ye.Z)(md,X.LESS,"less"),(0,ye.Z)(md,X.LEQUAL,"lequal"),(0,ye.Z)(md,X.GREATER,"greater"),(0,ye.Z)(md,X.GEQUAL,"gequal"),(0,ye.Z)(md,X.EQUAL,"equal"),(0,ye.Z)(md,X.NOTEQUAL,"notequal"),md),Bv=(gd={},(0,ye.Z)(gd,X.ZERO,"zero"),(0,ye.Z)(gd,X.KEEP,"keep"),(0,ye.Z)(gd,X.REPLACE,"replace"),(0,ye.Z)(gd,X.INVERT,"invert"),(0,ye.Z)(gd,X.INCR,"increment"),(0,ye.Z)(gd,X.DECR,"decrement"),(0,ye.Z)(gd,X.INCR_WRAP,"increment wrap"),(0,ye.Z)(gd,X.DECR_WRAP,"decrement wrap"),gd),F4=(Lg={},(0,ye.Z)(Lg,X.FRONT,"front"),(0,ye.Z)(Lg,X.BACK,"back"),Lg),D4=function(){function e(a,t){(0,Ft.Z)(this,e);var i=t.data,r=t.usage,o=t.type;this.buffer=a.buffer({data:i,usage:Nb[r||X.STATIC_DRAW],type:Oy[o||X.UNSIGNED_BYTE]})}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var i=t.data,r=t.offset;this.buffer.subdata(i,r)}}]),e}(),B4=function(){function e(a,t){(0,Ft.Z)(this,e);var i=t.data,r=t.usage,o=t.type,u=t.count;this.elements=a.elements({data:i,usage:Nb[r||X.STATIC_DRAW],type:Oy[o||X.UNSIGNED_BYTE],count:u})}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var i=t.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),N4=function(){function e(a,t){(0,Ft.Z)(this,e);var i=t.width,r=t.height,o=t.color,u=t.colors,p=t.depth,v=t.stencil,g={width:i,height:r};Array.isArray(u)&&(g.colors=u.map(function(E){return E.get()})),o&&typeof o!="boolean"&&(g.color=o.get()),this.framebuffer=a.framebuffer(g)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.framebuffer.resize(i,r)}}]),e}(),z4=function(){function e(a,t){(0,Ft.Z)(this,e),(0,ye.Z)(this,"destroyed",!1),(0,ye.Z)(this,"uniforms",{}),this.reGl=a;var i=t.vs,r=t.fs,o=t.attributes,u=t.uniforms,p=t.primitive,v=t.count,g=t.elements,E=t.depth,w=t.blend,L=t.stencil,F=t.cull,U=t.instances,j={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Fe){j[Fe]=a.prop(Fe)}));var q={};Object.keys(o).forEach(function(Fe){q[Fe]=o[Fe].get()});var ae={attributes:q,frag:r,uniforms:j,vert:i,blend:{},primitive:I4[p===void 0?X.TRIANGLES:p]};U&&(ae.instances=U),v&&(ae.count=v),g&&(ae.elements=g.get()),this.initDepthDrawParams({depth:E},ae),this.initBlendDrawParams({blend:w},ae),this.initStencilDrawParams({stencil:L},ae),this.initCullDrawParams({cull:F},ae),this.drawCommand=a(ae);var pe=(0,gr.cloneDeep)(ae);pe.blend=(0,Z.Z)((0,Z.Z)({},pe.blend),{},{enable:!1}),this.drawPickCommand=a(pe),this.drawParams=ae}return(0,Tt.Z)(e,[{key:"updateAttributesAndElements",value:function(t,i){var r={};Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=i.get(),this.drawCommand=this.reGl(this.drawParams);var o=(0,gr.cloneDeep)(this.drawParams);o.blend=(0,Z.Z)((0,Z.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}},{key:"updateAttributes",value:function(t){var i={};Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawCommand=this.reGl(this.drawParams);var r=(0,gr.cloneDeep)(this.drawParams);r.blend=(0,Z.Z)((0,Z.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(t){this.uniforms=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var p=(0,It.Z)(r[u]);p==="boolean"||p==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),i?this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,i){var r=t.depth;r&&(i.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:L4[r.func||X.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,i){var r=t.blend;if(r){var o=r.enable,u=r.func,p=r.equation,v=r.color,g=v===void 0?[0,0,0,0]:v;i.blend={enable:!!o,func:{srcRGB:Og[u&&u.srcRGB||X.SRC_ALPHA],srcAlpha:Og[u&&u.srcAlpha||X.SRC_ALPHA],dstRGB:Og[u&&u.dstRGB||X.ONE_MINUS_SRC_ALPHA],dstAlpha:Og[u&&u.dstAlpha||X.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Zb[p&&p.rgb||X.FUNC_ADD],alpha:Zb[p&&p.alpha||X.FUNC_ADD]},color:g}}}},{key:"initStencilDrawParams",value:function(t,i){var r=t.stencil;if(r){var o=r.enable,u=r.mask,p=u===void 0?-1:u,v=r.func,g=v===void 0?{cmp:X.ALWAYS,ref:0,mask:-1}:v,E=r.opFront,w=E===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:E,L=r.opBack,F=L===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:L;i.stencil={enable:!!o,mask:p,func:(0,Z.Z)((0,Z.Z)({},g),{},{cmp:O4[g.cmp]}),opFront:{fail:Bv[w.fail],zfail:Bv[w.zfail],zpass:Bv[w.zpass]},opBack:{fail:Bv[F.fail],zfail:Bv[F.zfail],zpass:Bv[F.zpass]}}}}},{key:"initCullDrawParams",value:function(t,i){var r=t.cull;if(r){var o=r.enable,u=r.face,p=u===void 0?X.BACK:u;i.cull={enable:!!o,face:F4[p]}}}},{key:"extractUniforms",value:function(t){var i=this,r={};return Object.keys(t).forEach(function(o){i.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,i,r,o){var u=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||(0,gr.isTypedArray)(i)||i===""||"resize"in i){r["".concat(o&&o+".").concat(t)]=i;return}(0,gr.isPlainObject)(i)&&Object.keys(i).forEach(function(p){u.extractUniformsRecursively(p,i[p],r,"".concat(o&&o+".").concat(t))}),Array.isArray(i)&&i.forEach(function(p,v){Object.keys(p).forEach(function(g){u.extractUniformsRecursively(g,p[g],r,"".concat(o&&o+".").concat(t,"[").concat(v,"]"))})})}}]),e}(),U4=function(){function e(a,t){(0,Ft.Z)(this,e),(0,ye.Z)(this,"isDistroy",!1);var i=t.data,r=t.type,o=r===void 0?X.UNSIGNED_BYTE:r,u=t.width,p=t.height,v=t.flipY,g=v===void 0?!1:v,E=t.format,w=E===void 0?X.RGBA:E,L=t.mipmap,F=L===void 0?!1:L,U=t.wrapS,j=U===void 0?X.CLAMP_TO_EDGE:U,q=t.wrapT,ae=q===void 0?X.CLAMP_TO_EDGE:q,pe=t.aniso,Fe=pe===void 0?0:pe,Qe=t.alignment,yt=Qe===void 0?1:Qe,vt=t.premultiplyAlpha,Bt=vt===void 0?!1:vt,Qt=t.mag,Ir=Qt===void 0?X.NEAREST:Qt,Or=t.min,Tr=Or===void 0?X.NEAREST:Or,on=t.colorSpace,kn=on===void 0?X.BROWSER_DEFAULT_WEBGL:on,si=t.x,Xa=si===void 0?0:si,bo=t.y,Ss=bo===void 0?0:bo,ru=t.copy,Xu=ru===void 0?!1:ru;this.width=u,this.height=p;var sh={width:u,height:p,type:Oy[o],format:k4[w],wrapS:Ub[j],wrapT:Ub[ae],mag:zb[Ir],min:zb[Tr],alignment:yt,flipY:g,colorSpace:R4[kn],premultiplyAlpha:Bt,aniso:Fe,x:Xa,y:Ss,copy:Xu};i&&(sh.data=i),typeof F=="number"?sh.mipmap=P4[F]:typeof F=="boolean"&&(sh.mipmap=F),this.texture=a.texture(sh)}return(0,Tt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.texture.resize(i,r),this.width=i,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),Vb,jb,Z4=(Vb=(0,xn.b2)(),Vb(jb=function(){function e(){var a=this;(0,Ft.Z)(this,e),(0,ye.Z)(this,"createModel",function(t){return new z4(a.gl,t)}),(0,ye.Z)(this,"createAttribute",function(t){return new M4(a.gl,t)}),(0,ye.Z)(this,"createBuffer",function(t){return new D4(a.gl,t)}),(0,ye.Z)(this,"createElements",function(t){return new B4(a.gl,t)}),(0,ye.Z)(this,"createTexture2D",function(t){return new U4(a.gl,t)}),(0,ye.Z)(this,"createFramebuffer",function(t){return new N4(a.gl,t)}),(0,ye.Z)(this,"useFramebuffer",function(t,i){a.gl({framebuffer:t?t.get():null})(i)}),(0,ye.Z)(this,"clear",function(t){var i,r=t.color,o=t.depth,u=t.stencil,p=t.framebuffer,v=p===void 0?null:p,g={color:r,depth:o,stencil:u};g.framebuffer=v===null?v:v.get(),(i=a.gl)===null||i===void 0||i.clear(g)}),(0,ye.Z)(this,"viewport",function(t){var i=t.x,r=t.y,o=t.width,u=t.height;a.gl._gl.viewport(i,r,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,ye.Z)(this,"readPixels",function(t){var i=t.framebuffer,r=t.x,o=t.y,u=t.width,p=t.height,v={x:r,y:o,width:u,height:p};return i&&(v.framebuffer=i.get()),a.gl.read(v)}),(0,ye.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,ye.Z)(this,"getContainer",function(){if(Bs)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,ye.Z)(this,"getCanvas",function(){return a.canvas}),(0,ye.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,ye.Z)(this,"destroy",function(){var t,i,r;a.canvas=null,(t=a.gl)===null||t===void 0||(i=t._gl)===null||i===void 0||(r=i.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),a.gl.destroy(),a.gl=null})}return(0,Tt.Z)(e,[{key:"init",value:function(){var a=(0,Ua.Z)(xi().mark(function i(r,o){var u=this;return xi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.canvas=r,v.next=3,new Promise(function(g,E){T4()({canvas:u.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(L,F){(L||!F)&&E(L),g(F)}})});case 3:this.gl=v.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return v.stop()}},i,this)}));function t(i,r){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||jb),V4=function(){function e(a){(0,Ft.Z)(this,e);var t=a.id,i=a.map,r=a.canvas,o=a.hasBaseMap,u=NE();this.container=u,i.setContainer(u,t,r,o),u.bind(hr.IRendererService).to(Z4).inSingletonScope(),this.sceneService=u.get(hr.ISceneService),this.mapService=u.get(hr.IMapService),this.iconService=u.get(hr.IIconService),this.fontService=u.get(hr.IFontService),this.controlService=u.get(hr.IControlService),this.layerService=u.get(hr.ILayerService),this.markerService=u.get(hr.IMarkerService),this.interactionService=u.get(hr.IInteractionService),this.popupService=u.get(hr.IPopupService),Bs?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,Tt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var i=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(i);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var i=$g(this.container);t.setContainer(i,this.container),this.sceneService.addLayer(t);var r=t.getLayerConfig();if(r){var o=r.mask,u=r.maskfence,p=r.maskColor,v=p===void 0?"#000":p,g=r.maskOpacity,E=g===void 0?0:g;if(o&&u){var w=new Q_().source(u).shape("fill").color(v).style({opacity:E});this.addMask(w,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,i){var r=this.getLayer(i);if(r){var o=$g(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,i){this.layerService.remove(t,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,i){this.fontService.addIconFont(t,i)}},{key:"addIconFonts",value:function(t){var i=this;t.forEach(function(r){var o=(0,Pr.Z)(r,2),u=o[0],p=o[1];i.fontService.addIconFont(u,p)})}},{key:"addFontFace",value:function(t,i){this.sceneService.addFontFace(t,i)}},{key:"addImage",value:function(t,i){Bs?this.iconService.addImageMini(t,i,this.sceneService):this.iconService.addImage(t,i)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,i){Kg.indexOf(t)===-1?this.mapService.on(t,i):this.sceneService.on(t,i)}},{key:"once",value:function(t,i){Kg.indexOf(t)===-1?this.mapService.once(t,i):this.sceneService.once(t,i)}},{key:"off",value:function(t,i){Kg.indexOf(t)===-1?this.mapService.off(t,i):this.sceneService.off(t,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,i){return this.mapService.setCenter(t,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,i){this.mapService.panBy(t,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,i){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,i||(0,Z.Z)((0,Z.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,i){this.mapService.setZoomAndCenter(t,i)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,i){this.container.bind(hr.IPostProcessingPass).to(t).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:vu(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),i=t.logoVisible,r=t.logoPosition;i&&this.addControl(new iC({position:r}))}}]),e}(),DP="2.9.23";function Gb(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function BP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Gb(Object(t),!0).forEach(function(i){j4(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Gb(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function j4(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function NP(e,a){return X4(e)||W4(e,a)||H4(e,a)||G4()}function G4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H4(e,a){if(!!e){if(typeof e=="string")return Hb(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hb(e,a)}}function Hb(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function W4(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function X4(e){if(Array.isArray(e))return e}var zP=null,UP=null,Wb,Fy,Xb,Y4=(Wb=qg(hr.IGlobalConfigService),Fy=function(){function e(a){(0,Ft.Z)(this,e),va(this,"configService",Xb,this),this.config=a}return(0,Tt.Z)(e,[{key:"setContainer",value:function(t,i,r,o){t.bind(hr.MapConfig).toConstantValue((0,Z.Z)((0,Z.Z)({},this.config),{},{id:i,canvas:r,hasBaseMap:o})),t.bind(hr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Xb=ca(Fy.prototype,"configService",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy),q4=fe(6158),Im=fe.n(q4);function km(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fg(e,a){var t=s0([],a,e);return a0(t,t,1/t[3]),t}function ZP(e,a){var t=e%a;return t<0?a+t:t}function VP(e,a,t){return t*a+(1-t)*e}function rv(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var Wp=Math.PI,Yb=Wp/4,Yd=Wp/180,qb=180/Wp,Dy=512,By=4003e4,$4=1.5;function $b(e){return Math.pow(2,e)}function K4(e){return Math.log2(e)}function Dg(e,a){var t=(0,Pr.Z)(e,2),i=t[0],r=t[1];rv(Number.isFinite(i)&&Number.isFinite(a)),rv(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),a*=Dy;var o=i*Yd,u=r*Yd,p=a*(o+Wp)/(2*Wp),v=a*(Wp-Math.log(Math.tan(Yb+u*.5)))/(2*Wp);return[p,v]}function Ny(e,a){var t=(0,Pr.Z)(e,2),i=t[0],r=t[1];a*=Dy;var o=i/a*(2*Wp)-Wp,u=2*(Math.atan(Math.exp(Wp-r/a*(2*Wp)))-Yb);return[o*qb,u*qb]}function jP(e){var a=e.latitude;assert(Number.isFinite(a));var t=Math.cos(a*Yd);return K4(By*t)-9}function Kb(e){var a=e.latitude,t=e.longitude,i=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:$b(i),rv(Number.isFinite(a)&&Number.isFinite(t)&&Number.isFinite(r));var p={},v=Dy*r,g=Math.cos(a*Yd),E=v/360,w=E/g,L=v/By/g;if(p.pixelsPerMeter=[L,-L,L],p.metersPerPixel=[1/L,-1/L,1/L],p.pixelsPerDegree=[E,-w,L],p.degreesPerPixel=[1/E,-1/w,1/L],u){var F=Yd*Math.tan(a*Yd)/g,U=E*F/2,j=v/By*F,q=j/w*L;p.pixelsPerDegree2=[0,-U,j],p.pixelsPerMeter2=[q,0,q]}return p}function GP(e,a){var t=_slicedToArray(e,3),i=t[0],r=t[1],o=t[2],u=_slicedToArray(a,3),p=u[0],v=u[1],g=u[2],E=1,w=Kb({longitude:i,latitude:r,scale:E,highPrecision:!0}),L=w.pixelsPerMeter,F=w.pixelsPerMeter2,U=Dg(e,E);U[0]+=p*(L[0]+F[0]*v),U[1]+=v*(L[1]+F[1]*v);var j=Ny(U,E),q=(o||0)+(g||0);return Number.isFinite(o)||Number.isFinite(g)?[j[0],j[1],q]:j}function Q4(e){var a=e.height,t=e.pitch,i=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,p=e.flipY,v=p===void 0?!1:p,g=km();return hi(g,g,[0,0,-r]),ga(g,g,[1,1,1/a]),Da(g,g,-t*Yd),Ha(g,g,i*Yd),v&&ga(g,g,[1,-1,1]),u&&hi(g,g,ts.negate([],u)),g}function J4(e){var a=e.width,t=e.height,i=e.altitude,r=i===void 0?$4:i,o=e.pitch,u=o===void 0?0:o,p=e.nearZMultiplier,v=p===void 0?1:p,g=e.farZMultiplier,E=g===void 0?1:g,w=u*Yd,L=Math.atan(.5/r),F=Math.sin(L)*r/Math.sin(Math.PI/2-w-L),U=Math.cos(Math.PI/2-w)*F+r;return{fov:2*Math.atan(t/2/r),aspect:a/t,focalDistance:r,near:v,far:U*E}}function eI(e){var a=e.width,t=e.height,i=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,p=J4({width:a,height:t,altitude:r,pitch:i,nearZMultiplier:o,farZMultiplier:u}),v=p.fov,g=p.aspect,E=p.near,w=p.far,L=Zu([],v,g,E,w);return L}function tI(e,a){var t=(0,Pr.Z)(e,3),i=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return rv(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(u)),Fg(a,[i,r,u,1])}function Qb(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Pr.Z)(e,3),r=i[0],o=i[1],u=i[2];if(rv(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var p=Fg(a,[r,o,u,1]);return p}var v=Fg(a,[r,o,0,1]),g=Fg(a,[r,o,1,1]),E=v[2],w=g[2],L=E===w?0:((t||0)-E)/(w-E);return cn.lerp([],v,g,L)}var Jb=km(),rI=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a.width,i=a.height,r=a.viewMatrix,o=r===void 0?Jb:r,u=a.projectionMatrix,p=u===void 0?Jb:u;(0,Ft.Z)(this,e),this.width=t||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=p;var v=km();ki(v,v,this.projectionMatrix),ki(v,v,this.viewMatrix),this.viewProjectionMatrix=v;var g=km();ga(g,g,[this.width/2,-this.height/2,1]),hi(g,g,[1,-1,0]),ki(g,g,this.viewProjectionMatrix);var E=Ci(km(),g);if(!E)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=E,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Tt.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&lc(t.projectionMatrix,this.projectionMatrix)&&lc(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),p=tI(u,this.pixelProjectionMatrix),v=(0,Pr.Z)(p,2),g=v[0],E=v[1],w=o?E:this.height-E;return t.length===2?[g,w]:[g,w,p[2]]}},{key:"unproject",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=i.targetZ,p=(0,Pr.Z)(t,3),v=p[0],g=p[1],E=p[2],w=o?g:this.height-g,L=u&&u*this.pixelsPerMeter,F=Qb([v,w,E],this.pixelUnprojectionMatrix,L),U=this.unprojectPosition(F),j=(0,Pr.Z)(U,3),q=j[0],ae=j[1],pe=j[2];return Number.isFinite(E)?[q,ae,pe]:Number.isFinite(u)?[q,ae,u]:[q,ae]}},{key:"projectPosition",value:function(t){var i=this.projectFlat(t),r=(0,Pr.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)*this.pixelsPerMeter;return[o,u,p]}},{key:"unprojectPosition",value:function(t){var i=this.unprojectFlat(t),r=(0,Pr.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)/this.pixelsPerMeter;return[o,u,p]}},{key:"projectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function nI(e){var a=e.width,t=e.height,i=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,p=u===void 0?24:u,v=e.padding,g=v===void 0?0:v,E=e.offset,w=E===void 0?[0,0]:E,L=(0,Pr.Z)(i,2),F=(0,Pr.Z)(L[0],2),U=F[0],j=F[1],q=(0,Pr.Z)(L[1],2),ae=q[0],pe=q[1];if(Number.isFinite(g)){var Fe=g;g={top:Fe,bottom:Fe,left:Fe,right:Fe}}else rv(Number.isFinite(g.top)&&Number.isFinite(g.bottom)&&Number.isFinite(g.left)&&Number.isFinite(g.right));var Qe=new e2({width:a,height:t,longitude:0,latitude:0,zoom:0}),yt=Qe.project([U,pe]),vt=Qe.project([ae,j]),Bt=[Math.max(Math.abs(vt[0]-yt[0]),o),Math.max(Math.abs(vt[1]-yt[1]),o)],Qt=[a-g.left-g.right-Math.abs(w[0])*2,t-g.top-g.bottom-Math.abs(w[1])*2];rv(Qt[0]>0&&Qt[1]>0);var Ir=Qt[0]/Bt[0],Or=Qt[1]/Bt[1],Tr=(g.right-g.left)/2/Ir,on=(g.bottom-g.top)/2/Or,kn=[(vt[0]+yt[0])/2+Tr,(vt[1]+yt[1])/2+on],si=Qe.unproject(kn),Xa=Qe.zoom+Math.log2(Math.abs(Math.min(Ir,Or)));return{longitude:si[0],latitude:si[1],zoom:Math.min(Xa,p)}}var e2=function(e){(0,an.Z)(a,e);function a(){var t,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,o=i.height,u=i.latitude,p=u===void 0?0:u,v=i.longitude,g=v===void 0?0:v,E=i.zoom,w=E===void 0?0:E,L=i.pitch,F=L===void 0?0:L,U=i.bearing,j=U===void 0?0:U,q=i.altitude,ae=q===void 0?1.5:q,pe=i.nearZMultiplier,Fe=i.farZMultiplier;(0,Ft.Z)(this,a),r=r||1,o=o||1;var Qe=$b(w);ae=Math.max(.75,ae);var yt=Dg([g,p],Qe);yt[2]=0;var vt=eI({width:r,height:o,pitch:F,bearing:j,altitude:ae,nearZMultiplier:pe||1/o,farZMultiplier:Fe||1.01}),Bt=Q4({height:o,center:yt,pitch:F,bearing:j,altitude:ae,flipY:!0});return t=(0,Yr.Z)(this,(0,bt.Z)(a).call(this,{width:r,height:o,viewMatrix:Bt,projectionMatrix:vt})),t.latitude=p,t.longitude=g,t.zoom=w,t.pitch=F,t.bearing=j,t.altitude=ae,t.scale=Qe,t.center=yt,t.pixelsPerMeter=Kb((0,Gt.Z)((0,Gt.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Gt.Z)((0,Gt.Z)(t))),t}return(0,Tt.Z)(a,[{key:"projectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Dg(i,r)}},{key:"unprojectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Ny(i,r)}},{key:"getMapCenterByLngLatPosition",value:function(i){var r=i.lngLat,o=i.pos,u=Qb(o,this.pixelUnprojectionMatrix),p=Dg(r,this.scale),v=cn.add([],p,cn.negate([],u)),g=cn.add([],this.center,v);return Ny(g,this.scale)}},{key:"getLocationAtPoint",value:function(i){var r=i.lngLat,o=i.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,p=nI(Object.assign({width:o,height:u,bounds:i},r)),v=p.longitude,g=p.latitude,E=p.zoom;return new a({width:o,height:u,longitude:v,latitude:g,zoom:E})}}]),a}(rI),iI=function(){function e(){(0,Ft.Z)(this,e)}return(0,Tt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var i=t.center,r=t.zoom,o=t.pitch,u=t.bearing,p=t.viewportHeight,v=t.viewportWidth;this.viewport=new e2({width:v,height:p,longitude:i&&i[0],latitude:i&&i[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}}]),e}(),aI=function(){function e(a){(0,Ft.Z)(this,e),(0,ye.Z)(this,"size",1e4),this.size=a||1e4}return(0,Tt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var i=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90}},{key:"project",value:function(t){var i=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[i,r]}},{key:"unproject",value:function(t){var i=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[i,r]}}]),e}(),t2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},oI=["id","attributionControl","style","token","rotation","mapInstance"],r2,n2,i2,a2,o2,s2,Nv,u2,l2,c2,f2;function sI(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}sI(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Im();var h2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},uI=0,lI=12,p2="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",cI=(r2=(0,xn.b2)(),n2=(0,xn.f3)(hr.MapConfig),i2=(0,xn.f3)(hr.IGlobalConfigService),a2=(0,xn.f3)(hr.ICoordinateSystemService),o2=(0,xn.f3)(hr.IEventEmitter),r2(s2=(Nv=function(){function e(){var a=this;(0,Ft.Z)(this,e),(0,ye.Z)(this,"version",Wu.MAPBOX),(0,ye.Z)(this,"simpleMapCoord",new aI),(0,ye.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),va(this,"config",u2,this),va(this,"configService",l2,this),va(this,"coordinateSystemService",c2,this),va(this,"eventEmitter",f2,this),(0,ye.Z)(this,"handleCameraChanged",function(){var t=a.map.getCenter().wrap(),i=t.lat,r=t.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[r,i],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0});var o=a.config.offsetZoom,u=o===void 0?lI:o;a.viewport.getZoom()>u?a.coordinateSystemService.setCoordinateSystem(Pl.LNGLAT_OFFSET):a.coordinateSystemService.setCoordinateSystem(Pl.LNGLAT),a.cameraChangedCallback(a.viewport)})}return(0,Tt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Qa("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,i){$E.indexOf(t)!==-1?this.eventEmitter.on(t,i):this.map.on(h2[t]||t,i)}},{key:"off",value:function(t,i){this.map.off(h2[t]||t,i),this.eventEmitter.off(t,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,i){this.map.zoomIn(t,i)}},{key:"zoomOut",value:function(t,i){this.map.zoomOut(t,i)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,i){this.panTo([t,i])}},{key:"fitBounds",value:function(t,i){this.map.fitBounds(t,i)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,i){this.map.flyTo({zoom:t,center:i})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},r=this.lngLatToMercator(t,0),o=r.x,u=r.y;return[o-i.x,u-i.y]}},{key:"lngLatToMercator",value:function(t,i){var r=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),o=r.x,u=o===void 0?0:o,p=r.y,v=p===void 0?0:p,g=r.z,E=g===void 0?0:g;return{x:u,y:v,z:E}}},{key:"getModelMatrix",value:function(t,i,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},p=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),v=p.meterInMercatorCoordinateUnits(),g=lr();return hi(g,g,ts.fromValues(p.x-u.x,p.y-u.y,p.z||0-u.z)),ga(g,g,ts.fromValues(v*o[0],-v*o[1],v*o[2])),Da(g,g,r[0]),Mi(g,g,r[1]),Ha(g,g,r[2]),g}},{key:"init",value:function(){var a=(0,Ua.Z)(xi().mark(function i(){var r,o,u,p,v,g,E,w,L,F,U,j,q;return xi().wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:r=this.config,o=r.id,u=o===void 0?"map":o,p=r.attributionControl,v=p===void 0?!1:p,g=r.style,E=g===void 0?"light":g,w=r.token,L=w===void 0?p2:w,F=r.rotation,U=F===void 0?0:F,j=r.mapInstance,q=(0,Oh.Z)(r,oI),this.viewport=new iI,!j&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),L===p2&&E!=="blank"&&!window.mapboxgl.accessToken&&!j&&console.warn(this.configService.getSceneWarninfo("MapToken")),!j&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=L),j?(this.map=j,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(u),this.map=new window.mapboxgl.Map((0,Z.Z)({container:this.$mapContainer,style:this.getMapStyle(E),attributionControl:v,bearing:U},q))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return pe.stop()}},i,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,i;(t=this.$mapContainer)===null||t===void 0||(i=t.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).emit.apply(i,[t].concat(o))}},{key:"once",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).once.apply(i,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,i){var r=new(Im()).LngLat(t[0],t[1]),o=new(Im()).LngLat(i[0],i[1]),u=r.distanceTo(o),p=Im().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),v=Im().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),g=p.x,E=p.y,w=v.x,L=v.y,F=Math.sqrt(Math.pow(g-w,2)+Math.pow(E-L,2))*4194304*2;return F/u}},{key:"exportMap",value:function(t){var i=this.map.getCanvas(),r=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var i=t;typeof t=="string"&&(i=document.getElementById(t));var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.id="l7_mapbox_div"+uI++,i.appendChild(r),r}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:t2[t]?t2[t]:t}}]),e}(),u2=ca(Nv.prototype,"config",[n2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l2=ca(Nv.prototype,"configService",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c2=ca(Nv.prototype,"coordinateSystemService",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f2=ca(Nv.prototype,"eventEmitter",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||s2);function fI(e){var a=hI();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Yr.Z)(this,r)}}function hI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function pI(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}pI(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var dI=function(e){(0,an.Z)(t,e);var a=fI(t);function t(){return(0,Ft.Z)(this,t),a.apply(this,arguments)}return(0,Tt.Z)(t,[{key:"getServiceConstructor",value:function(){return cI}}]),t}(Y4);function d2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function v2(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?d2(Object(t),!0).forEach(function(i){vI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function vI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function mI(e,a){return xI(e)||_I(e,a)||yI(e,a)||gI()}function gI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yI(e,a){if(!!e){if(typeof e=="string")return m2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return m2(e,a)}}function m2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function _I(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function xI(e){if(Array.isArray(e))return e}var bI=de.memo(function(e){var a=e.style,t=e.className,i=e.map,r=e.option,o=e.onSceneLoaded,u=(0,de.createRef)(),p=(0,de.useState)(),v=mI(p,2),g=v[0],E=v[1];return(0,de.useEffect)(function(){var w=new V4(v2(v2({id:u.current},r),{},{map:new dI(i)}));return w.on("loaded",function(){E(w),o&&o(w)}),function(){w.destroy()}},[]),(0,de.useEffect)(function(){g&&i.style&&g.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,de.useEffect)(function(){g&&i.zoom&&g.setZoom(i.zoom)},[i.zoom]),(0,de.useEffect)(function(){g&&i.center&&g.setCenter(i.center)},[JSON.stringify(i.center)]),(0,de.useEffect)(function(){g&&i.pitch!==void 0&&g.setPitch(i.pitch||0)},[i.pitch]),(0,de.useEffect)(function(){g&&i.rotation&&g.setRotation(i.rotation)},[i.rotation]),de.createElement(y.Provider,{value:g},(0,de.createElement)("div",{ref:u,style:a,className:t},g&&e.children))}),EI=bI;function g2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function HP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?g2(Object(t),!0).forEach(function(i){CI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function CI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function WP(e,a){return TI(e)||wI(e,a)||AI(e,a)||SI()}function SI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AI(e,a){if(!!e){if(typeof e=="string")return y2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y2(e,a)}}function y2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function wI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function TI(e){if(Array.isArray(e))return e}var XP=null,YP=null;function _2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function qP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?_2(Object(t),!0).forEach(function(i){MI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function MI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function $P(e,a){return RI(e)||PI(e,a)||kI(e,a)||II()}function II(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kI(e,a){if(!!e){if(typeof e=="string")return x2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return x2(e,a)}}function x2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function PI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function RI(e){if(Array.isArray(e))return e}var KP=null,QP=null;function JP(e,a){return DI(e)||FI(e,a)||OI(e,a)||LI()}function LI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OI(e,a){if(!!e){if(typeof e=="string")return b2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b2(e,a)}}function b2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function FI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function DI(e){if(Array.isArray(e))return e}var eR=null,tR=null;function E2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function rR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?E2(Object(t),!0).forEach(function(i){BI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function BI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function nR(e,a){if(e==null)return{};var t=NI(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function NI(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var iR=null,C2=fe(73935);function S2(e,a){return VI(e)||ZI(e,a)||UI(e,a)||zI()}function zI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UI(e,a){if(!!e){if(typeof e=="string")return A2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A2(e,a)}}function A2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function ZI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function VI(e){if(Array.isArray(e))return e}var w2=de.useEffect,T2=de.useState,jI=/\B([A-Z])/g,GI=function(a){return a.replace(jI,"-$1").toLowerCase()};function aR(e){var a=e.className,t=e.style,i=e.children,r=e.position,o=T2(),u=S2(o,2),p=u[0],v=u[1],g=useSceneValue(),E=T2(function(){return document.createElement("div")}),w=S2(E,1),L=w[0];return w2(function(){var F=new Control({position:r});return F.onAdd=function(){if(a&&(L.className=a),t){var U=Object.keys(t).map(function(j){return"".concat(GI(j),":").concat(t[j])}).join(";");L.style.cssText=U}return L},F.onRemove=function(){},v(F),g.addControl(F),function(){g.removeControl(F)}},[]),w2(function(){p&&p.setPosition(r||"bottomleft")},[r]),createPortal(i,L)}var M2=(0,de.createContext)({});function oR(){return useContext(M2)}var sR=de.useEffect,HI=de.memo(function(a){var t=a.layer,i=a.active;return t.active(i.option),null},gr.isEqual),uR=de.useEffect,WI=de.memo(function(a){var t=a.layer,i=a.animate;return t.animate(i),null},gr.isEqual),lR=de.useEffect,XI=de.memo(function(a){var t=a.layer,i=a.color;return i.field?t.color(i.field,i.values):t.color(i.values),null},gr.isEqual),YI=de.memo(function(a){var t=a.layer,i=a.filter;return i.field&&t.filter(i.field,i.values),null},gr.isEqual),qI=de.memo(function(a){var t=a.layer,i=a.scale;return t.scale(i.values),null},gr.isEqual),cR=de.useEffect,$I=de.memo(function(a){var t=a.layer,i=a.select;return t.select(i.option),null},gr.isEqual),KI=de.memo(function(a){var t=a.layer,i=a.shape;return i.field?t.shape(i.field,i.values):t.shape(i.values),null},gr.isEqual),QI=de.memo(function(a){var t=a.layer,i=a.size;return i.field?t.size(i.field,i.values):t.size(i.values),null},gr.isEqual),JI=["data"];function ek(e,a){if(e==null)return{};var t=tk(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function tk(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var rk=de.memo(function(a){var t=a.layer,i=a.source,r=i.data,o=ek(i,JI);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},gr.isEqual),fR=de.useEffect,nk=de.memo(function(a){var t=a.layer,i=a.style;return t.style(i),null},gr.isEqual);function ik(e,a){return uk(e)||sk(e,a)||ok(e,a)||ak()}function ak(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ok(e,a){if(!!e){if(typeof e=="string")return I2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return I2(e,a)}}function I2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function sk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function uk(e){if(Array.isArray(e))return e}var Pm=de.useEffect,lk=de.useState;function k2(e,a){var t=a.source,i=a.color,r=a.shape,o=a.style,u=a.size,p=a.scale,v=a.active,g=a.select,E=a.filter,w=a.animate,L=a.options,F=a.onLayerLoaded,U=Be(),j=lk(function(){var pe;switch(e){case"polygonLayer":pe=new T1(L);break;case"lineLayer":pe=new ET(L);break;case"pointLayer":pe=new v5(L);break;case"heatmapLayer":pe=new TS(L);break;case"rasterLayer":pe=new $5(L);break;case"imageLayer":pe=new K_(L);break;case"citybuildingLayer":pe=new QC(L);break;default:pe=new T1(L)}return pe.on("inited",function(){F&&F(pe,U)}),pe}),q=ik(j,1),ae=q[0];return Pm(function(){return U.addLayer(ae),function(){U.removeLayer(ae)}},[]),Pm(function(){ae.inited&&L&&ae.updateLayerConfig(L)},[L==null?void 0:L.minZoom,L==null?void 0:L.maxZoom,L==null?void 0:L.visible]),Pm(function(){ae.inited&&(L==null?void 0:L.zIndex)&&ae.setIndex(L.zIndex)},[L==null?void 0:L.zIndex]),Pm(function(){ae.inited&&(L==null?void 0:L.blend)&&ae.setBlend(L.blend)},[L==null?void 0:L.blend]),Pm(function(){U.render()}),de.createElement(M2.Provider,{value:ae},de.createElement(rk,{layer:ae,source:t}),p&&de.createElement(qI,{layer:ae,scale:p}),i&&de.createElement(XI,{layer:ae,color:i}),u&&de.createElement(QI,{layer:ae,size:u}),r&&de.createElement(KI,{layer:ae,shape:r}),o&&de.createElement(nk,{layer:ae,style:o}),v&&de.createElement(HI,{layer:ae,active:v}),g&&de.createElement($I,{layer:ae,select:g}),E&&de.createElement(YI,{layer:ae,filter:E}),w&&de.createElement(WI,{layer:ae,animate:w}),a.children)}var hR=null,pR=null,ck=de.memo(function(a){return k2("pointLayer",a)}),fk=de.memo(function(a){return k2("heatmapLayer",a)}),dR=null,vR=null,mR=null,gR=de.useEffect,yR=null,_R=null;function Bg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Bg=function(t){return typeof t}:Bg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bg(e)}function P2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function Ng(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?P2(Object(t),!0).forEach(function(i){hk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function hk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function pk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function R2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dk(e,a,t){return a&&R2(e.prototype,a),t&&R2(e,t),e}function vk(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&zy(e,a)}function zy(e,a){return zy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},zy(e,a)}function mk(e){var a=_k();return function(){var i=zg(e),r;if(a){var o=zg(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return gk(this,r)}}function gk(e,a){if(a&&(Bg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yk(e)}function yk(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zg(e){return zg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zg(e)}var xR=function(e){vk(t,e);var a=mk(t);function t(i){var r;return pk(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return dk(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,p=o.children,v=o.option,g=o.lngLat,E=new S_(Ng(Ng({},v),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&E.setLnglat(u),g&&E.setLnglat(g),p&&E.setDOMContent(this.el),this.popup=E,this.scene.addPopup(E)}},{key:"componentDidUpdate",value:function(r){var o,u,p,v,g,E,w=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],L=Array.isArray(this.props.lnglat)?this.props.lnglat:[(p=this.props)===null||p===void 0||(v=p.lnglat)===null||v===void 0?void 0:v.lng,(g=this.props)===null||g===void 0||(E=g.lnglat)===null||E===void 0?void 0:E.lat],F=w.toString()!==L.toString();if(F){var U;this.popup.remove(),this.popup=new S_(Ng(Ng({},this.props.option),{},{stopPropagation:(U=this.props.option)===null||U===void 0?void 0:U.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return de.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,C2.createPortal)(r.props.children,r.el)})}}]),t}(de.PureComponent);function Ug(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ug=function(t){return typeof t}:Ug=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ug(e)}function xk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function L2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bk(e,a,t){return a&&L2(e.prototype,a),t&&L2(e,t),e}function Ek(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&Uy(e,a)}function Uy(e,a){return Uy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Uy(e,a)}function Ck(e){var a=wk();return function(){var i=Zg(e),r;if(a){var o=Zg(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Sk(this,r)}}function Sk(e,a){if(a&&(Ug(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ak(e)}function Ak(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Zg(e){return Zg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Zg(e)}var bR=function(e){Ek(t,e);var a=Ck(t);function t(i){var r;return xk(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return bk(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,p=r.option,v=r.onMarkerLoaded,g=new C_(p);o&&g.setLnglat(o),u&&g.setElement(this.el),this.marker=g,v&&v(g),this.scene.addMarker(g)}},{key:"componentDidUpdate",value:function(r){var o,u=(r==null?void 0:r.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return de.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,C2.createPortal)(r.props.children,r.el)})}}]),t}(de.PureComponent),ER=de.useEffect,CR=null,SR=null,AR=de.useEffect,wR=null},75174:function(pi,Se,fe){var We=function(de){"use strict";function y(_,A){var M=Object.keys(_);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(_);A&&(O=O.filter(function(N){return Object.getOwnPropertyDescriptor(_,N).enumerable})),M.push.apply(M,O)}return M}function Be(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Be=function(){return _};var _={},A=Object.prototype,M=A.hasOwnProperty,O=typeof Symbol=="function"?Symbol:{},N=O.iterator||"@@iterator",J=O.asyncIterator||"@@asyncIterator",ce=O.toStringTag||"@@toStringTag";function se(Qr,fn,Zi){return Object.defineProperty(Qr,fn,{value:Zi,enumerable:!0,configurable:!0,writable:!0}),Qr[fn]}try{se({},"")}catch(Qr){se=function(fn,Zi,$a){return fn[Zi]=$a}}function Oe(Qr,fn,Zi,$a){var _a=fn&&fn.prototype instanceof Jt?fn:Jt,ol=Object.create(_a.prototype),xl=new Ya($a||[]);return ol._invoke=function(es,bl,Cs){var Dh="suspendedStart";return function(fp,sl){if(Dh==="executing")throw new Error("Generator is already running");if(Dh==="completed"){if(fp==="throw")throw sl;return so()}for(Cs.method=fp,Cs.arg=sl;;){var os=Cs.delegate;if(os){var Rl=gi(os,Cs);if(Rl){if(Rl===Ve)continue;return Rl}}if(Cs.method==="next")Cs.sent=Cs._sent=Cs.arg;else if(Cs.method==="throw"){if(Dh==="suspendedStart")throw Dh="completed",Cs.arg;Cs.dispatchException(Cs.arg)}else Cs.method==="return"&&Cs.abrupt("return",Cs.arg);Dh="executing";var Hu=He(es,bl,Cs);if(Hu.type==="normal"){if(Dh=Cs.done?"completed":"suspendedYield",Hu.arg===Ve)continue;return{value:Hu.arg,done:Cs.done}}Hu.type==="throw"&&(Dh="completed",Cs.method="throw",Cs.arg=Hu.arg)}}}(Qr,Zi,xl),ol}function He(Qr,fn,Zi){try{return{type:"normal",arg:Qr.call(fn,Zi)}}catch($a){return{type:"throw",arg:$a}}}_.wrap=Oe;var Ve={};function Jt(){}function br(){}function Dr(){}var qr={};se(qr,N,function(){return this});var On=Object.getPrototypeOf,An=On&&On(On(qa([])));An&&An!==A&&M.call(An,N)&&(qr=An);var zn=Dr.prototype=Jt.prototype=Object.create(qr);function mn(Qr){["next","throw","return"].forEach(function(fn){se(Qr,fn,function(Zi){return this._invoke(fn,Zi)})})}function ni(Qr,fn){var Zi;this._invoke=function($a,_a){function ol(){return new fn(function(xl,es){(function bl(Cs,Dh,fp,sl){var os=He(Qr[Cs],Qr,Dh);if(os.type!=="throw"){var Rl=os.arg,Hu=Rl.value;return Hu&&typeof Hu=="object"&&M.call(Hu,"__await")?fn.resolve(Hu.__await).then(function($l){bl("next",$l,fp,sl)},function($l){bl("throw",$l,fp,sl)}):fn.resolve(Hu).then(function($l){Rl.value=$l,fp(Rl)},function($l){return bl("throw",$l,fp,sl)})}sl(os.arg)})($a,_a,xl,es)})}return Zi=Zi?Zi.then(ol,ol):ol()}}function gi(Qr,fn){var Zi=Qr.iterator[fn.method];if(Zi===void 0){if(fn.delegate=null,fn.method==="throw"){if(Qr.iterator.return&&(fn.method="return",fn.arg=void 0,gi(Qr,fn),fn.method==="throw"))return Ve;fn.method="throw",fn.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ve}var $a=He(Zi,Qr.iterator,fn.arg);if($a.type==="throw")return fn.method="throw",fn.arg=$a.arg,fn.delegate=null,Ve;var _a=$a.arg;return _a?_a.done?(fn[Qr.resultName]=_a.value,fn.next=Qr.nextLoc,fn.method!=="return"&&(fn.method="next",fn.arg=void 0),fn.delegate=null,Ve):_a:(fn.method="throw",fn.arg=new TypeError("iterator result is not an object"),fn.delegate=null,Ve)}function Wa(Qr){var fn={tryLoc:Qr[0]};1 in Qr&&(fn.catchLoc=Qr[1]),2 in Qr&&(fn.finallyLoc=Qr[2],fn.afterLoc=Qr[3]),this.tryEntries.push(fn)}function oo(Qr){var fn=Qr.completion||{};fn.type="normal",delete fn.arg,Qr.completion=fn}function Ya(Qr){this.tryEntries=[{tryLoc:"root"}],Qr.forEach(Wa,this),this.reset(!0)}function qa(Qr){if(Qr){var fn=Qr[N];if(fn)return fn.call(Qr);if(typeof Qr.next=="function")return Qr;if(!isNaN(Qr.length)){var Zi=-1,$a=function _a(){for(;++Zi<Qr.length;)if(M.call(Qr,Zi))return _a.value=Qr[Zi],_a.done=!1,_a;return _a.value=void 0,_a.done=!0,_a};return $a.next=$a}}return{next:so}}function so(){return{value:void 0,done:!0}}return br.prototype=Dr,se(zn,"constructor",Dr),se(Dr,"constructor",br),br.displayName=se(Dr,ce,"GeneratorFunction"),_.isGeneratorFunction=function(Qr){var fn=typeof Qr=="function"&&Qr.constructor;return!!fn&&(fn===br||(fn.displayName||fn.name)==="GeneratorFunction")},_.mark=function(Qr){return Object.setPrototypeOf?Object.setPrototypeOf(Qr,Dr):(Qr.__proto__=Dr,se(Qr,ce,"GeneratorFunction")),Qr.prototype=Object.create(zn),Qr},_.awrap=function(Qr){return{__await:Qr}},mn(ni.prototype),se(ni.prototype,J,function(){return this}),_.AsyncIterator=ni,_.async=function(Qr,fn,Zi,$a,_a){_a===void 0&&(_a=Promise);var ol=new ni(Oe(Qr,fn,Zi,$a),_a);return _.isGeneratorFunction(fn)?ol:ol.next().then(function(xl){return xl.done?xl.value:ol.next()})},mn(zn),se(zn,ce,"Generator"),se(zn,N,function(){return this}),se(zn,"toString",function(){return"[object Generator]"}),_.keys=function(Qr){var fn=[];for(var Zi in Qr)fn.push(Zi);return fn.reverse(),function $a(){for(;fn.length;){var _a=fn.pop();if(_a in Qr)return $a.value=_a,$a.done=!1,$a}return $a.done=!0,$a}},_.values=qa,Ya.prototype={constructor:Ya,reset:function(Qr){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(oo),!Qr)for(var fn in this)fn.charAt(0)==="t"&&M.call(this,fn)&&!isNaN(+fn.slice(1))&&(this[fn]=void 0)},stop:function(){this.done=!0;var Qr=this.tryEntries[0].completion;if(Qr.type==="throw")throw Qr.arg;return this.rval},dispatchException:function(Qr){if(this.done)throw Qr;var fn=this;function Zi(bl,Cs){return ol.type="throw",ol.arg=Qr,fn.next=bl,Cs&&(fn.method="next",fn.arg=void 0),!!Cs}for(var $a=this.tryEntries.length-1;$a>=0;--$a){var _a=this.tryEntries[$a],ol=_a.completion;if(_a.tryLoc==="root")return Zi("end");if(_a.tryLoc<=this.prev){var xl=M.call(_a,"catchLoc"),es=M.call(_a,"finallyLoc");if(xl&&es){if(this.prev<_a.catchLoc)return Zi(_a.catchLoc,!0);if(this.prev<_a.finallyLoc)return Zi(_a.finallyLoc)}else if(xl){if(this.prev<_a.catchLoc)return Zi(_a.catchLoc,!0)}else{if(!es)throw new Error("try statement without catch or finally");if(this.prev<_a.finallyLoc)return Zi(_a.finallyLoc)}}}},abrupt:function(Qr,fn){for(var Zi=this.tryEntries.length-1;Zi>=0;--Zi){var $a=this.tryEntries[Zi];if($a.tryLoc<=this.prev&&M.call($a,"finallyLoc")&&this.prev<$a.finallyLoc){var _a=$a;break}}_a&&(Qr==="break"||Qr==="continue")&&_a.tryLoc<=fn&&fn<=_a.finallyLoc&&(_a=null);var ol=_a?_a.completion:{};return ol.type=Qr,ol.arg=fn,_a?(this.method="next",this.next=_a.finallyLoc,Ve):this.complete(ol)},complete:function(Qr,fn){if(Qr.type==="throw")throw Qr.arg;return Qr.type==="break"||Qr.type==="continue"?this.next=Qr.arg:Qr.type==="return"?(this.rval=this.arg=Qr.arg,this.method="return",this.next="end"):Qr.type==="normal"&&fn&&(this.next=fn),Ve},finish:function(Qr){for(var fn=this.tryEntries.length-1;fn>=0;--fn){var Zi=this.tryEntries[fn];if(Zi.finallyLoc===Qr)return this.complete(Zi.completion,Zi.afterLoc),oo(Zi),Ve}},catch:function(Qr){for(var fn=this.tryEntries.length-1;fn>=0;--fn){var Zi=this.tryEntries[fn];if(Zi.tryLoc===Qr){var $a=Zi.completion;if($a.type==="throw"){var _a=$a.arg;oo(Zi)}return _a}}throw new Error("illegal catch attempt")},delegateYield:function(Qr,fn,Zi){return this.delegate={iterator:qa(Qr),resultName:fn,nextLoc:Zi},this.method==="next"&&(this.arg=void 0),Ve}},_}function K(_,A,M,O,N,J,ce){try{var se=_[J](ce),Oe=se.value}catch(He){return void M(He)}se.done?A(Oe):Promise.resolve(Oe).then(O,N)}function ke(_){return function(){var A=this,M=arguments;return new Promise(function(O,N){var J=_.apply(A,M);function ce(Oe){K(J,O,N,ce,se,"next",Oe)}function se(Oe){K(J,O,N,ce,se,"throw",Oe)}ce(void 0)})}}function he(_,A){if(!(_ instanceof A))throw new TypeError("Cannot call a class as a function")}function ut(_,A){for(var M=0;M<A.length;M++){var O=A[M];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(_,O.key,O)}}function Ae(_,A,M){return A&&ut(_.prototype,A),M&&ut(_,M),Object.defineProperty(_,"prototype",{writable:!1}),_}function Xe(_,A,M){return A in _?Object.defineProperty(_,A,{value:M,enumerable:!0,configurable:!0,writable:!0}):_[A]=M,_}function Ct(_,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(A&&A.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),A&&tr(_,A)}function Lt(_){return(Lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(A){return A.__proto__||Object.getPrototypeOf(A)})(_)}function tr(_,A){return(tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,O){return M.__proto__=O,M})(_,A)}function Yt(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function Xt(_,A){if(A&&(typeof A=="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yt(_)}function Er(_){var A=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}();return function(){var M,O=Lt(_);if(A){var N=Lt(this).constructor;M=Reflect.construct(O,arguments,N)}else M=O.apply(this,arguments);return Xt(this,M)}}function cr(_,A){return function(M){if(Array.isArray(M))return M}(_)||function(M,O){var N=M==null?null:typeof Symbol!="undefined"&&M[Symbol.iterator]||M["@@iterator"];if(N!=null){var J,ce,se=[],Oe=!0,He=!1;try{for(N=N.call(M);!(Oe=(J=N.next()).done)&&(se.push(J.value),!O||se.length!==O);Oe=!0);}catch(Ve){He=!0,ce=Ve}finally{try{Oe||N.return==null||N.return()}finally{if(He)throw ce}}return se}}(_,A)||Zt(_,A)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Rt(_){return function(A){if(Array.isArray(A))return Rr(A)}(_)||function(A){if(typeof Symbol!="undefined"&&A[Symbol.iterator]!=null||A["@@iterator"]!=null)return Array.from(A)}(_)||Zt(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Zt(_,A){if(_){if(typeof _=="string")return Rr(_,A);var M=Object.prototype.toString.call(_).slice(8,-1);return M==="Object"&&_.constructor&&(M=_.constructor.name),M==="Map"||M==="Set"?Array.from(_):M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M)?Rr(_,A):void 0}}function Rr(_,A){(A==null||A>_.length)&&(A=_.length);for(var M=0,O=new Array(A);M<A;M++)O[M]=_[M];return O}var re=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof fe.g!="undefined"?fe.g:typeof self!="undefined"?self:{};function _r(_,A){return _(A={exports:{}},A.exports),A.exports}var Ot,_t,Kt=function(_){return _&&_.Math==Math&&_},Ue=Kt(typeof globalThis=="object"&&globalThis)||Kt(typeof window=="object"&&window)||Kt(typeof self=="object"&&self)||Kt(typeof re=="object"&&re)||function(){return this}()||Function("return this")(),Cr=Object.defineProperty,nn=function(_,A){try{Cr(Ue,_,{value:A,configurable:!0,writable:!0})}catch(M){Ue[_]=A}return A},ue=Ue["__core-js_shared__"]||nn("__core-js_shared__",{}),tt=_r(function(_){(_.exports=function(A,M){return ue[A]||(ue[A]=M!==void 0?M:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),Z=function(_){try{return!!_()}catch(A){return!0}},_e=!Z(function(){var _=function(){}.bind();return typeof _!="function"||_.hasOwnProperty("prototype")}),ze=Function.prototype,wt=ze.bind,Vt=ze.call,fr=_e&&wt.bind(Vt,Vt),Mt=_e?function(_){return _&&fr(_)}:function(_){return _&&function(){return Vt.apply(_,arguments)}},Fr=TypeError,Xn=function(_){if(_==null)throw Fr("Can't call method on "+_);return _},Jr=Object,Ri=function(_){return Jr(Xn(_))},yi=Mt({}.hasOwnProperty),ln=Object.hasOwn||function(_,A){return yi(Ri(_),A)},Sa=0,fa=Math.random(),Di=Mt(1 .toString),Ia=function(_){return"Symbol("+(_===void 0?"":_)+")_"+Di(++Sa+fa,36)},ui=function(_){return typeof _=="function"},Ji=function(_){return ui(_)?_:void 0},di=function(_,A){return arguments.length<2?Ji(Ue[_]):Ue[_]&&Ue[_][A]},_i=di("navigator","userAgent")||"",Uo=Ue.process,Eo=Ue.Deno,to=Uo&&Uo.versions||Eo&&Eo.version,Pt=to&&to.v8;Pt&&(_t=(Ot=Pt.split("."))[0]>0&&Ot[0]<4?1:+(Ot[0]+Ot[1])),!_t&&_i&&(!(Ot=_i.match(/Edge\/(\d+)/))||Ot[1]>=74)&&(Ot=_i.match(/Chrome\/(\d+)/))&&(_t=+Ot[1]);var ge=_t,oe=!!Object.getOwnPropertySymbols&&!Z(function(){var _=Symbol();return!String(_)||!(Object(_)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),we=oe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",V=tt("wks"),at=Ue.Symbol,sr=at&&at.for,$r=we?at:at&&at.withoutSetter||Ia,Ke=function(_){if(!ln(V,_)||!oe&&typeof V[_]!="string"){var A="Symbol."+_;oe&&ln(at,_)?V[_]=at[_]:V[_]=we&&sr?sr(A):$r(A)}return V[_]},Nt={};Nt[Ke("toStringTag")]="z";var Sr=String(Nt)==="[object z]",xr=!Z(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Lr=function(_){return typeof _=="object"?_!==null:ui(_)},gn=Ue.document,mi=Lr(gn)&&Lr(gn.createElement),ii=function(_){return mi?gn.createElement(_):{}},Sn=!xr&&!Z(function(){return Object.defineProperty(ii("div"),"a",{get:function(){return 7}}).a!=7}),Bi=xr&&Z(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Vi=String,Ga=TypeError,oa=function(_){if(Lr(_))return _;throw Ga(Vi(_)+" is not an object")},ro=Function.prototype.call,Si=_e?ro.bind(ro):function(){return ro.apply(ro,arguments)},ha=Mt({}.isPrototypeOf),Q=Object,ie=we?function(_){return typeof _=="symbol"}:function(_){var A=di("Symbol");return ui(A)&&ha(A.prototype,Q(_))},me=String,Ie=function(_){try{return me(_)}catch(A){return"Object"}},qe=TypeError,ot=function(_){if(ui(_))return _;throw qe(Ie(_)+" is not a function")},xt=function(_,A){var M=_[A];return M==null?void 0:ot(M)},Te=TypeError,rt=TypeError,Ht=Ke("toPrimitive"),Zr=function(_,A){if(!Lr(_)||ie(_))return _;var M,O=xt(_,Ht);if(O){if(A===void 0&&(A="default"),M=Si(O,_,A),!Lr(M)||ie(M))return M;throw rt("Can't convert object to primitive value")}return A===void 0&&(A="number"),function(N,J){var ce,se;if(J==="string"&&ui(ce=N.toString)&&!Lr(se=Si(ce,N))||ui(ce=N.valueOf)&&!Lr(se=Si(ce,N))||J!=="string"&&ui(ce=N.toString)&&!Lr(se=Si(ce,N)))return se;throw Te("Can't convert object to primitive value")}(_,A)},ar=function(_){var A=Zr(_,"string");return ie(A)?A:A+""},pr=TypeError,Hr=Object.defineProperty,li=Object.getOwnPropertyDescriptor,wn={f:xr?Bi?function(_,A,M){if(oa(_),A=ar(A),oa(M),typeof _=="function"&&A==="prototype"&&"value"in M&&"writable"in M&&!M.writable){var O=li(_,A);O&&O.writable&&(_[A]=M.value,M={configurable:"configurable"in M?M.configurable:O.configurable,enumerable:"enumerable"in M?M.enumerable:O.enumerable,writable:!1})}return Hr(_,A,M)}:Hr:function(_,A,M){if(oa(_),A=ar(A),oa(M),Sn)try{return Hr(_,A,M)}catch(O){}if("get"in M||"set"in M)throw pr("Accessors not supported");return"value"in M&&(_[A]=M.value),_}},er=Function.prototype,Hn=xr&&Object.getOwnPropertyDescriptor,Tn=ln(er,"name"),Mn={EXISTS:Tn,PROPER:Tn&&function(){}.name==="something",CONFIGURABLE:Tn&&(!xr||xr&&Hn(er,"name").configurable)},sa=Mt(Function.toString);ui(ue.inspectSource)||(ue.inspectSource=function(_){return sa(_)});var Pr,$i,La,ra=ue.inspectSource,ma=Ue.WeakMap,Ft=ui(ma)&&/native code/.test(ra(ma)),Tt=function(_,A){return{enumerable:!(1&_),configurable:!(2&_),writable:!(4&_),value:A}},ea=xr?function(_,A,M){return wn.f(_,A,Tt(1,M))}:function(_,A,M){return _[A]=M,_},lo=tt("keys"),Na=function(_){return lo[_]||(lo[_]=Ia(_))},ji={},Aa=Ue.TypeError,Co=Ue.WeakMap;if(Ft||ue.state){var an=ue.state||(ue.state=new Co),Yr=Mt(an.get),bt=Mt(an.has),Ls=Mt(an.set);Pr=function(_,A){if(bt(an,_))throw new Aa("Object already initialized");return A.facade=_,Ls(an,_,A),A},$i=function(_){return Yr(an,_)||{}},La=function(_){return bt(an,_)}}else{var Gt=Na("state");ji[Gt]=!0,Pr=function(_,A){if(ln(_,Gt))throw new Aa("Object already initialized");return A.facade=_,ea(_,Gt,A),A},$i=function(_){return ln(_,Gt)?_[Gt]:{}},La=function(_){return ln(_,Gt)}}var qi={set:Pr,get:$i,has:La,enforce:function(_){return La(_)?$i(_):Pr(_,{})},getterFor:function(_){return function(A){var M;if(!Lr(A)||(M=$i(A)).type!==_)throw Aa("Incompatible receiver, "+_+" required");return M}}},Kl=_r(function(_){var A=Mn.CONFIGURABLE,M=qi.enforce,O=qi.get,N=Object.defineProperty,J=xr&&!Z(function(){return N(function(){},"length",{value:8}).length!==8}),ce=String(String).split("String"),se=_.exports=function(Oe,He,Ve){String(He).slice(0,7)==="Symbol("&&(He="["+String(He).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),Ve&&Ve.getter&&(He="get "+He),Ve&&Ve.setter&&(He="set "+He),(!ln(Oe,"name")||A&&Oe.name!==He)&&(xr?N(Oe,"name",{value:He,configurable:!0}):Oe.name=He),J&&Ve&&ln(Ve,"arity")&&Oe.length!==Ve.arity&&N(Oe,"length",{value:Ve.arity});try{Ve&&ln(Ve,"constructor")&&Ve.constructor?xr&&N(Oe,"prototype",{writable:!1}):Oe.prototype&&(Oe.prototype=void 0)}catch(br){}var Jt=M(Oe);return ln(Jt,"source")||(Jt.source=ce.join(typeof He=="string"?He:"")),Oe};Function.prototype.toString=se(function(){return ui(this)&&O(this).source||ra(this)},"toString")}),Oa=function(_,A,M,O){O||(O={});var N=O.enumerable,J=O.name!==void 0?O.name:A;if(ui(M)&&Kl(M,J,O),O.global)N?_[A]=M:nn(A,M);else{try{O.unsafe?_[A]&&(N=!0):delete _[A]}catch(ce){}N?_[A]=M:wn.f(_,A,{value:M,enumerable:!1,configurable:!O.nonConfigurable,writable:!O.nonWritable})}return _},mo=Mt({}.toString),Io=Mt("".slice),xa=function(_){return Io(mo(_),8,-1)},Os=Ke("toStringTag"),Fs=Object,Ql=xa(function(){return arguments}())=="Arguments",So=Sr?xa:function(_){var A,M,O;return _===void 0?"Undefined":_===null?"Null":typeof(M=function(N,J){try{return N[J]}catch(ce){}}(A=Fs(_),Os))=="string"?M:Ql?xa(A):(O=xa(A))=="Object"&&ui(A.callee)?"Arguments":O},As=Sr?{}.toString:function(){return"[object "+So(this)+"]"};Sr||Oa(Object.prototype,"toString",As,{unsafe:!0});var Ka={}.propertyIsEnumerable,Oo=Object.getOwnPropertyDescriptor,ws={f:Oo&&!Ka.call({1:2},1)?function(_){var A=Oo(this,_);return!!A&&A.enumerable}:Ka},ko=Object,Yu=Mt("".split),ul=Z(function(){return!ko("z").propertyIsEnumerable(0)})?function(_){return xa(_)=="String"?Yu(_,""):ko(_)}:ko,rs=function(_){return ul(Xn(_))},ve=Object.getOwnPropertyDescriptor,De={f:xr?ve:function(_,A){if(_=rs(_),A=ar(A),Sn)try{return ve(_,A)}catch(M){}if(ln(_,A))return Tt(!Si(ws.f,_,A),_[A])}},mt=Math.ceil,ir=Math.floor,yn=Math.trunc||function(_){var A=+_;return(A>0?ir:mt)(A)},Qn=function(_){var A=+_;return A!=A||A===0?0:yn(A)},ya=Math.max,qo=Math.min,Fa=function(_,A){var M=Qn(_);return M<0?ya(M+A,0):qo(M,A)},Fo=Math.min,Zo=function(_){return _>0?Fo(Qn(_),9007199254740991):0},To=function(_){return Zo(_.length)},Ds=function(_){return function(A,M,O){var N,J=rs(A),ce=To(J),se=Fa(O,ce);if(_&&M!=M){for(;ce>se;)if((N=J[se++])!=N)return!0}else for(;ce>se;se++)if((_||se in J)&&J[se]===M)return _||se||0;return!_&&-1}},cs={includes:Ds(!0),indexOf:Ds(!1)},Ts=cs.indexOf,Eu=Mt([].push),qu=function(_,A){var M,O=rs(_),N=0,J=[];for(M in O)!ln(ji,M)&&ln(O,M)&&Eu(J,M);for(;A.length>N;)ln(O,M=A[N++])&&(~Ts(J,M)||Eu(J,M));return J},Cu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Su=Cu.concat("length","prototype"),za={f:Object.getOwnPropertyNames||function(_){return qu(_,Su)}},fs={f:Object.getOwnPropertySymbols},nu=Mt([].concat),Au=di("Reflect","ownKeys")||function(_){var A=za.f(oa(_)),M=fs.f;return M?nu(A,M(_)):A},uf=function(_,A,M){for(var O=Au(A),N=wn.f,J=De.f,ce=0;ce<O.length;ce++){var se=O[ce];ln(_,se)||M&&ln(M,se)||N(_,se,J(A,se))}},Vh=/#|\.prototype\./,Xs=function(_,A){var M=ll[lf(_)];return M==b||M!=Fc&&(ui(A)?Z(A):!!A)},lf=Xs.normalize=function(_){return String(_).replace(Vh,".").toLowerCase()},ll=Xs.data={},Fc=Xs.NATIVE="N",b=Xs.POLYFILL="P",k=Xs,G=De.f,D=function(_,A){var M,O,N,J,ce,se=_.target,Oe=_.global,He=_.stat;if(M=Oe?Ue:He?Ue[se]||nn(se,{}):(Ue[se]||{}).prototype)for(O in A){if(J=A[O],N=_.dontCallGetSet?(ce=G(M,O))&&ce.value:M[O],!k(Oe?O:se+(He?".":"#")+O,_.forced)&&N!==void 0){if(typeof J==typeof N)continue;uf(J,N)}(_.sham||N&&N.sham)&&ea(J,"sham",!0),Oa(M,O,J,_)}},ne=xa(Ue.process)=="process",Re=String,pt=TypeError,It=Object.setPrototypeOf||("__proto__"in{}?function(){var _,A=!1,M={};try{(_=Mt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),A=M instanceof Array}catch(O){}return function(O,N){return oa(O),function(J){if(typeof J=="object"||ui(J))return J;throw pt("Can't set "+Re(J)+" as a prototype")}(N),A?_(O,N):O.__proto__=N,O}}():void 0),jt=wn.f,Nr=Ke("toStringTag"),Wr=function(_,A,M){_&&!M&&(_=_.prototype),_&&!ln(_,Nr)&&jt(_,Nr,{configurable:!0,value:A})},Kn=Ke("species"),Hi=function(_){var A=di(_),M=wn.f;xr&&A&&!A[Kn]&&M(A,Kn,{configurable:!0,get:function(){return this}})},Gi=TypeError,Ni=function(_,A){if(ha(A,_))return _;throw Gi("Incorrect invocation")},no=function(){},go=[],ka=di("Reflect","construct"),iu=/^\s*(?:class|function)\b/,Ol=Mt(iu.exec),fc=!iu.exec(no),hc=function(_){if(!ui(_))return!1;try{return ka(no,go,_),!0}catch(A){return!1}},pc=function(_){if(!ui(_))return!1;switch(So(_)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fc||!!Ol(iu,ra(_))}catch(A){return!0}};pc.sham=!0;var dc,Ru,Fl,El,Vo=!ka||Z(function(){var _;return hc(hc.call)||!hc(Object)||!hc(function(){_=!0})||_})?pc:hc,vp=TypeError,jh=function(_){if(Vo(_))return _;throw vp(Ie(_)+" is not a constructor")},wu=Ke("species"),cf=function(_,A){var M,O=oa(_).constructor;return O===void 0||(M=oa(O)[wu])==null?A:jh(M)},Cl=Function.prototype,$u=Cl.apply,Gh=Cl.call,Sl=typeof Reflect=="object"&&Reflect.apply||(_e?Gh.bind($u):function(){return Gh.apply($u,arguments)}),yo=Mt(Mt.bind),Ys=function(_,A){return ot(_),A===void 0?_:_e?yo(_,A):function(){return _.apply(A,arguments)}},Hh=di("document","documentElement"),Al=Mt([].slice),mp=TypeError,gp=function(_,A){if(_<A)throw mp("Not enough arguments");return _},lh=/(?:ipad|iphone|ipod).*applewebkit/i.test(_i),Nf=Ue.setImmediate,ff=Ue.clearImmediate,zf=Ue.process,Dc=Ue.Dispatch,Uf=Ue.Function,vc=Ue.MessageChannel,hf=Ue.String,Jl=0,au={};try{dc=Ue.location}catch(_){}var Zf=function(_){if(ln(au,_)){var A=au[_];delete au[_],A()}},Vf=function(_){return function(){Zf(_)}},Wh=function(_){Zf(_.data)},mc=function(_){Ue.postMessage(hf(_),dc.protocol+"//"+dc.host)};Nf&&ff||(Nf=function(_){gp(arguments.length,1);var A=ui(_)?_:Uf(_),M=Al(arguments,1);return au[++Jl]=function(){Sl(A,void 0,M)},Ru(Jl),Jl},ff=function(_){delete au[_]},ne?Ru=function(_){zf.nextTick(Vf(_))}:Dc&&Dc.now?Ru=function(_){Dc.now(Vf(_))}:vc&&!lh?(El=(Fl=new vc).port2,Fl.port1.onmessage=Wh,Ru=Ys(El.postMessage,El)):Ue.addEventListener&&ui(Ue.postMessage)&&!Ue.importScripts&&dc&&dc.protocol!=="file:"&&!Z(mc)?(Ru=mc,Ue.addEventListener("message",Wh,!1)):Ru="onreadystatechange"in ii("script")?function(_){Hh.appendChild(ii("script")).onreadystatechange=function(){Hh.removeChild(this),Zf(_)}}:function(_){setTimeout(Vf(_),0)});var Ku,Dl,Bc,ec,jf,Gf,gc,Xh,ch={set:Nf,clear:ff},Nc=/ipad|iphone|ipod/i.test(_i)&&Ue.Pebble!==void 0,Xp=/web0s(?!.*chrome)/i.test(_i),fh=De.f,Yh=ch.set,pf=Ue.MutationObserver||Ue.WebKitMutationObserver,Yp=Ue.document,zc=Ue.process,Ao=Ue.Promise,Bs=fh(Ue,"queueMicrotask"),Uc=Bs&&Bs.value;Uc||(Ku=function(){var _,A;for(ne&&(_=zc.domain)&&_.exit();Dl;){A=Dl.fn,Dl=Dl.next;try{A()}catch(M){throw Dl?ec():Bc=void 0,M}}Bc=void 0,_&&_.enter()},lh||ne||Xp||!pf||!Yp?!Nc&&Ao&&Ao.resolve?((gc=Ao.resolve(void 0)).constructor=Ao,Xh=Ys(gc.then,gc),ec=function(){Xh(Ku)}):ne?ec=function(){zc.nextTick(Ku)}:(Yh=Ys(Yh,Ue),ec=function(){Yh(Ku)}):(jf=!0,Gf=Yp.createTextNode(""),new pf(Ku).observe(Gf,{characterData:!0}),ec=function(){Gf.data=jf=!jf}));var Pa=Uc||function(_){var A={fn:_,next:void 0};Bc&&(Bc.next=A),Dl||(Dl=A,ec()),Bc=A},Ta=function(_){try{return{error:!1,value:_()}}catch(A){return{error:!0,value:A}}},wo=function(){this.head=null,this.tail=null};wo.prototype={add:function(_){var A={item:_,next:null};this.head?this.tail.next=A:this.head=A,this.tail=A},get:function(){var _=this.head;if(_)return this.head=_.next,this.tail===_&&(this.tail=null),_.item}};var vu,df,tc,hh=wo,Qa=Ue.Promise,vf=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Bl=!vf&&!ne&&typeof window=="object"&&typeof document=="object",yc=(Qa&&Qa.prototype,Ke("species")),rc=!1,hs=ui(Ue.PromiseRejectionEvent),Qu={CONSTRUCTOR:k("Promise",function(){var _=ra(Qa),A=_!==String(Qa);if(!A&&ge===66)return!0;if(!ge||ge<51||!/native code/.test(_)){var M=new Qa(function(N){N(1)}),O=function(N){N(function(){},function(){})};if((M.constructor={})[yc]=O,!(rc=M.then(function(){})instanceof O))return!0}return!A&&(Bl||vf)&&!hs}),REJECTION_EVENT:hs,SUBCLASSING:rc},mf=function(_){var A,M;this.promise=new _(function(O,N){if(A!==void 0||M!==void 0)throw TypeError("Bad Promise constructor");A=O,M=N}),this.resolve=ot(A),this.reject=ot(M)},Do={f:function(_){return new mf(_)}},Jn=ch.set,jo=Qu.CONSTRUCTOR,Zc=Qu.REJECTION_EVENT,gf=Qu.SUBCLASSING,Ja=qi.getterFor("Promise"),Lu=qi.set,_c=Qa&&Qa.prototype,In=Qa,yf=_c,ph=Ue.TypeError,wl=Ue.document,co=Ue.process,mu=Do.f,Ua=mu,Nl=!!(wl&&wl.createEvent&&Ue.dispatchEvent),Tu=function(_){var A;return!(!Lr(_)||!ui(A=_.then))&&A},zl=function(_,A){var M,O,N,J=A.value,ce=A.state==1,se=ce?_.ok:_.fail,Oe=_.resolve,He=_.reject,Ve=_.domain;try{se?(ce||(A.rejection===2&&cl(A),A.rejection=1),se===!0?M=J:(Ve&&Ve.enter(),M=se(J),Ve&&(Ve.exit(),N=!0)),M===_.promise?He(ph("Promise-chain cycle")):(O=Tu(M))?Si(O,M,Oe,He):Oe(M)):He(J)}catch(Jt){Ve&&!N&&Ve.exit(),He(Jt)}},Hf=function(_,A){_.notified||(_.notified=!0,Pa(function(){for(var M,O=_.reactions;M=O.get();)zl(M,_);_.notified=!1,A&&!_.rejection&&yp(_)}))},Vc=function(_,A,M){var O,N;Nl?((O=wl.createEvent("Event")).promise=A,O.reason=M,O.initEvent(_,!1,!0),Ue.dispatchEvent(O)):O={promise:A,reason:M},!Zc&&(N=Ue["on"+_])?N(O):_==="unhandledrejection"&&function(J,ce){var se=Ue.console;se&&se.error&&(arguments.length==1?se.error(J):se.error(J,ce))}("Unhandled promise rejection",M)},yp=function(_){Si(Jn,Ue,function(){var A,M=_.facade,O=_.value;if(xi(_)&&(A=Ta(function(){ne?co.emit("unhandledRejection",O,M):Vc("unhandledrejection",M,O)}),_.rejection=ne||xi(_)?2:1,A.error))throw A.value})},xi=function(_){return _.rejection!==1&&!_.parent},cl=function(_){Si(Jn,Ue,function(){var A=_.facade;ne?co.emit("rejectionHandled",A):Vc("rejectionhandled",A,_.value)})},qs=function(_,A,M){return function(O){_(A,O,M)}},pa=function(_,A,M){_.done||(_.done=!0,M&&(_=M),_.value=A,_.state=2,Hf(_,!0))},fl=function(_,A,M){if(!_.done){_.done=!0,M&&(_=M);try{if(_.facade===A)throw ph("Promise can't be resolved itself");var O=Tu(A);O?Pa(function(){var N={done:!1};try{Si(O,A,qs(fl,N,_),qs(pa,N,_))}catch(J){pa(N,J,_)}}):(_.value=A,_.state=1,Hf(_,!1))}catch(N){pa({done:!1},N,_)}}};if(jo&&(yf=(In=function(_){Ni(this,yf),ot(_),Si(vu,this);var A=Ja(this);try{_(qs(fl,A),qs(pa,A))}catch(M){pa(A,M)}}).prototype,(vu=function(_){Lu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new hh,rejection:!1,state:0,value:void 0})}).prototype=Oa(yf,"then",function(_,A){var M=Ja(this),O=mu(cf(this,In));return M.parent=!0,O.ok=!ui(_)||_,O.fail=ui(A)&&A,O.domain=ne?co.domain:void 0,M.state==0?M.reactions.add(O):Pa(function(){zl(O,M)}),O.promise}),df=function(){var _=new vu,A=Ja(_);this.promise=_,this.resolve=qs(fl,A),this.reject=qs(pa,A)},Do.f=mu=function(_){return _===In||_===void 0?new df(_):Ua(_)},ui(Qa)&&_c!==Object.prototype)){tc=_c.then,gf||Oa(_c,"then",function(_,A){var M=this;return new In(function(O,N){Si(tc,M,O,N)}).then(_,A)},{unsafe:!0});try{delete _c.constructor}catch(_){}It&&It(_c,yf)}D({global:!0,constructor:!0,wrap:!0,forced:jo},{Promise:In}),Wr(In,"Promise",!1),Hi("Promise");var gu={},Ns=Ke("iterator"),_f=Array.prototype,xc=function(_){return _!==void 0&&(gu.Array===_||_f[Ns]===_)},Mu=Ke("iterator"),yu=function(_){if(_!=null)return xt(_,Mu)||xt(_,"@@iterator")||gu[So(_)]},Ju=TypeError,Ei=function(_,A){var M=arguments.length<2?yu(_):A;if(ot(M))return oa(Si(M,_));throw Ju(Ie(_)+" is not iterable")},vi=function(_,A,M){var O,N;oa(_);try{if(!(O=xt(_,"return"))){if(A==="throw")throw M;return M}O=Si(O,_)}catch(J){N=!0,O=J}if(A==="throw")throw M;if(N)throw O;return oa(O),M},Wf=TypeError,zs=function(_,A){this.stopped=_,this.result=A},hl=zs.prototype,$o=function(_,A,M){var O,N,J,ce,se,Oe,He,Ve=M&&M.that,Jt=!(!M||!M.AS_ENTRIES),br=!(!M||!M.IS_RECORD),Dr=!(!M||!M.IS_ITERATOR),qr=!(!M||!M.INTERRUPTED),On=Ys(A,Ve),An=function(mn){return O&&vi(O,"normal",mn),new zs(!0,mn)},zn=function(mn){return Jt?(oa(mn),qr?On(mn[0],mn[1],An):On(mn[0],mn[1])):qr?On(mn,An):On(mn)};if(br)O=_.iterator;else if(Dr)O=_;else{if(!(N=yu(_)))throw Wf(Ie(_)+" is not iterable");if(xc(N)){for(J=0,ce=To(_);ce>J;J++)if((se=zn(_[J]))&&ha(hl,se))return se;return new zs(!1)}O=Ei(_,N)}for(Oe=br?_.next:O.next;!(He=Si(Oe,O)).done;){try{se=zn(He.value)}catch(mn){vi(O,"throw",mn)}if(typeof se=="object"&&se&&ha(hl,se))return se}return new zs(!1)},Tl=Ke("iterator"),dh=!1;try{var xf=0,Za={next:function(){return{done:!!xf++}},return:function(){dh=!0}};Za[Tl]=function(){return this},Array.from(Za,function(){throw 2})}catch(_){}var _o=function(_,A){if(!A&&!dh)return!1;var M=!1;try{var O={};O[Tl]=function(){return{next:function(){return{done:M=!0}}}},_(O)}catch(N){}return M},vh=Qu.CONSTRUCTOR||!_o(function(_){Qa.all(_).then(void 0,function(){})});D({target:"Promise",stat:!0,forced:vh},{all:function(_){var A=this,M=Do.f(A),O=M.resolve,N=M.reject,J=Ta(function(){var ce=ot(A.resolve),se=[],Oe=0,He=1;$o(_,function(Ve){var Jt=Oe++,br=!1;He++,Si(ce,A,Ve).then(function(Dr){br||(br=!0,se[Jt]=Dr,--He||O(se))},N)}),--He||O(se)});return J.error&&N(J.value),M.promise}});var Xf=Qu.CONSTRUCTOR,pl=Qa&&Qa.prototype;if(D({target:"Promise",proto:!0,forced:Xf,real:!0},{catch:function(_){return this.then(void 0,_)}}),ui(Qa)){var el=di("Promise").prototype.catch;pl.catch!==el&&Oa(pl,"catch",el,{unsafe:!0})}D({target:"Promise",stat:!0,forced:vh},{race:function(_){var A=this,M=Do.f(A),O=M.reject,N=Ta(function(){var J=ot(A.resolve);$o(_,function(ce){Si(J,A,ce).then(M.resolve,O)})});return N.error&&O(N.value),M.promise}}),D({target:"Promise",stat:!0,forced:Qu.CONSTRUCTOR},{reject:function(_){var A=Do.f(this);return Si(A.reject,void 0,_),A.promise}});var $s=Qu.CONSTRUCTOR;di("Promise");function dl(_,A){if(!_)throw new Error(A||"web worker helper assertion failed.")}D({target:"Promise",stat:!0,forced:$s},{resolve:function(_){return function(A,M){if(oa(A),Lr(M)&&M.constructor===A)return M;var O=Do.f(A);return(0,O.resolve)(M),O.promise}(this,_)}});var Ul=typeof window!="undefined"&&window.orientation!==void 0,mh=function(){function _(A,M){var O=this;this.name=A,this.workerThread=M,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(N,J){O.resolve=N,O.reject=J})}return _.prototype.postMessage=function(A,M){this.workerThread.postMessage({source:"Main thread",type:A,payload:M})},_.prototype.done=function(A){dl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(A)},_.prototype.error=function(A){dl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(A)},_}(),Go=new Map;function gh(_){dl(_.source&&!_.url||!_.source&&_.url);var A=Go.get(_.source||_.url);return A||(_.url&&(A=function(M){if(!M.startsWith("http"))return M;return qh((O=M,`try {
  importScripts('`+O+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var O}(_.url),Go.set(_.url,A)),_.source&&(A=qh(_.source),Go.set(_.source,A))),dl(A),A}function qh(_){var A=new Blob([_],{type:"application/javascript"});return URL.createObjectURL(A)}function jc(_,A,M){A===void 0&&(A=!0);var O=M||new Set;if(_){if(bf(_))O.add(_);else if(bf(_.buffer))O.add(_.buffer);else if(!ArrayBuffer.isView(_)){if(A&&typeof _=="object")for(var N in _)jc(_[N],A,O)}}return M===void 0?Array.from(O):[]}function bf(_){return!!_&&(_ instanceof ArrayBuffer||typeof MessagePort!="undefined"&&_ instanceof MessagePort||typeof ImageBitmap!="undefined"&&_ instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&_ instanceof OffscreenCanvas)}var bc=function(){},Zl=function(){function _(A){this.terminated=!1,this.loadableURL="";var M=A.name,O=A.source,N=A.url;dl(O||N),this.name=M,this.source=O,this.url=N,this.onMessage=bc,this.onError=function(J){return console.log(J)},this.worker=this.createBrowserWorker()}return _.isSupported=function(){return typeof Worker!="undefined"},_.prototype.destroy=function(){this.onMessage=bc,this.onError=bc,this.worker.terminate(),this.terminated=!0},Object.defineProperty(_.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),_.prototype.postMessage=function(A,M){M=M||jc(A),this.worker.postMessage(A,M)},_.prototype.getErrorFromErrorEvent=function(A){var M="Failed to load ";return M+="worker "+this.name+" from "+this.url+". ",A.message&&(M+=A.message+" in "),A.lineno&&(M+=":"+A.lineno+":"+A.colno),new Error(M)},_.prototype.createBrowserWorker=function(){var A=this;this.loadableURL=gh({source:this.source,url:this.url});var M=new Worker(this.loadableURL,{name:this.name});return M.onmessage=function(O){O.data?A.onMessage(O.data):A.onError(new Error("No data received"))},M.onerror=function(O){A.onError(A.getErrorFromErrorEvent(O)),A.terminated=!0},M.onmessageerror=function(O){return console.error("worker "+A.name+", message error: "+O)},M},_}(),vl=self&&self.__assign||function(){return(vl=Object.assign||function(_){for(var A,M=1,O=arguments.length;M<O;M++)for(var N in A=arguments[M])Object.prototype.hasOwnProperty.call(A,N)&&(_[N]=A[N]);return _}).apply(this,arguments)},Yf=self&&self.__awaiter||function(_,A,M,O){return new(M||(M=Promise))(function(N,J){function ce(He){try{Oe(O.next(He))}catch(Ve){J(Ve)}}function se(He){try{Oe(O.throw(He))}catch(Ve){J(Ve)}}function Oe(He){var Ve;He.done?N(He.value):(Ve=He.value,Ve instanceof M?Ve:new M(function(Jt){Jt(Ve)})).then(ce,se)}Oe((O=O.apply(_,A||[])).next())})},nc=self&&self.__generator||function(_,A){var M,O,N,J,ce={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return J={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function se(Oe){return function(He){return function(Ve){if(M)throw new TypeError("Generator is already executing.");for(;ce;)try{if(M=1,O&&(N=2&Ve[0]?O.return:Ve[0]?O.throw||((N=O.return)&&N.call(O),0):O.next)&&!(N=N.call(O,Ve[1])).done)return N;switch(O=0,N&&(Ve=[2&Ve[0],N.value]),Ve[0]){case 0:case 1:N=Ve;break;case 4:return ce.label++,{value:Ve[1],done:!1};case 5:ce.label++,O=Ve[1],Ve=[0];continue;case 7:Ve=ce.ops.pop(),ce.trys.pop();continue;default:if(N=ce.trys,!((N=N.length>0&&N[N.length-1])||Ve[0]!==6&&Ve[0]!==2)){ce=0;continue}if(Ve[0]===3&&(!N||Ve[1]>N[0]&&Ve[1]<N[3])){ce.label=Ve[1];break}if(Ve[0]===6&&ce.label<N[1]){ce.label=N[1],N=Ve;break}if(N&&ce.label<N[2]){ce.label=N[2],ce.ops.push(Ve);break}N[2]&&ce.ops.pop(),ce.trys.pop();continue}Ve=A.call(_,ce)}catch(Jt){Ve=[6,Jt],O=0}finally{M=N=0}if(5&Ve[0])throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}([Oe,He])}}},ml=function(){function _(A){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=A.source,this.url=A.url,this.setProps(A)}return _.prototype.destroy=function(){this.idleQueue.forEach(function(A){return A.destroy()}),this.isDestroyed=!0},_.prototype.setProps=function(A){this.props=vl(vl({},this.props),A),A.name!==void 0&&(this.name=A.name),A.maxConcurrency!==void 0&&(this.maxConcurrency=A.maxConcurrency),A.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=A.maxMobileConcurrency),A.reuseWorkers!==void 0&&(this.reuseWorkers=A.reuseWorkers),A.onDebug!==void 0&&(this.onDebug=A.onDebug)},_.prototype.startJob=function(A,M,O){return M===void 0&&(M=function(N,J,ce){return N.done(ce)}),O===void 0&&(O=function(N,J){return N.error(J)}),Yf(this,void 0,void 0,function(){var N,J=this;return nc(this,function(ce){switch(ce.label){case 0:return N=new Promise(function(se){return J.jobQueue.push({name:A,onMessage:M,onError:O,onStart:se}),J}),this.startQueuedJob(),[4,N];case 1:return[2,ce.sent()]}})})},_.prototype.startQueuedJob=function(){return Yf(this,void 0,void 0,function(){var A,M,O;return nc(this,function(N){switch(N.label){case 0:if(!this.jobQueue.length)return[2];if(!(A=this.getAvailableWorker()))return[2];if(!(M=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:M.name,backlog:this.jobQueue.length,workerThread:A}),O=new mh(M.name,A),A.onMessage=function(J){return M.onMessage(O,J.type,J.payload)},A.onError=function(J){return M.onError(O,J)},M.onStart(O),N.label=1;case 1:return N.trys.push([1,,3,4]),[4,O.result];case 2:return N.sent(),[3,4];case 3:return this.returnWorkerToQueue(A),[7];case 4:return[2]}})})},_.prototype.returnWorkerToQueue=function(A){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(A.destroy(),this.count--):this.idleQueue.push(A),this.isDestroyed||this.startQueuedJob()},_.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var A=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zl({name:A,source:this.source,url:this.url})}return null},_.prototype.getMaxConcurrency=function(){return Ul?this.maxMobileConcurrency:this.maxConcurrency},_}(),Gc=self&&self.__assign||function(){return(Gc=Object.assign||function(_){for(var A,M=1,O=arguments.length;M<O;M++)for(var N in A=arguments[M])Object.prototype.hasOwnProperty.call(A,N)&&(_[N]=A[N]);return _}).apply(this,arguments)},yh=self&&self.__values||function(_){var A=typeof Symbol=="function"&&Symbol.iterator,M=A&&_[A],O=0;if(M)return M.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&O>=_.length&&(_=void 0),{value:_&&_[O++],done:!_}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")},_p={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Ef=(function(){function _(A){this.workerPools=new Map,this.props=Gc({},_p),this.setProps(A),this.workerPools=new Map}_.isSupported=function(){return Zl.isSupported()},_.getWorkerFarm=function(A){return A===void 0&&(A={}),_.workerFarm=_.workerFarm||new _({}),_.workerFarm.setProps(A),_.workerFarm},_.prototype.destroy=function(){var A,M;try{for(var O=yh(this.workerPools.values()),N=O.next();!N.done;N=O.next())N.value.destroy()}catch(J){A={error:J}}finally{try{N&&!N.done&&(M=O.return)&&M.call(O)}finally{if(A)throw A.error}}},_.prototype.setProps=function(A){var M,O;this.props=Gc(Gc({},this.props),A);try{for(var N=yh(this.workerPools.values()),J=N.next();!J.done;J=N.next())J.value.setProps(this.getWorkerPoolProps())}catch(ce){M={error:ce}}finally{try{J&&!J.done&&(O=N.return)&&O.call(N)}finally{if(M)throw M.error}}},_.prototype.getWorkerPool=function(A){var M=A.name,O=A.source,N=A.url,J=this.workerPools.get(M);return J||((J=new ml({name:M,source:O,url:N})).setProps(this.getWorkerPoolProps()),this.workerPools.set(M,J)),J},_.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),c=function(){function _(){}return Object.defineProperty(_,"onmessage",{set:function(A){self.onmessage=function(M){if(h(M)){var O=M.data,N=O.type,J=O.payload;A(N,J)}}},enumerable:!1,configurable:!0}),_.addEventListener=function(A){var M=Ef.get(A);M||(M=function(O){if(h(O)){var N=O.data,J=N.type,ce=N.payload;A(J,ce)}}),self.addEventListener("message",M)},_.removeEventListener=function(A){var M=Ef.get(A);Ef.delete(A),self.removeEventListener("message",M)},_.postMessage=function(A,M){if(self){var O={source:"Worker thread",type:A,payload:M},N=jc(M);self.postMessage(O,N)}},_}();function h(_){var A=_.type,M=_.data;return A==="message"&&M&&typeof M.source=="string"&&M.source==="Main thread"}self&&self.__awaiter,self&&self.__generator;var f,m,S=function(){function _(){this._values=[],this._settlers=[],this._closed=!1}return _.prototype[Symbol.asyncIterator]=function(){return this},_.prototype.push=function(A){return this.enqueue(A)},_.prototype.enqueue=function(A){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var M=this._settlers.shift();A instanceof Error?M.reject(A):M.resolve({value:A})}else this._values.push(A)},_.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},_.prototype.next=function(){var A=this;if(this._values.length>0){var M=this._values.shift();return M instanceof Error?Promise.reject(M):Promise.resolve({done:!1,value:M})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(O,N){A._settlers.push({resolve:O,reject:N})})},_}(),I=self&&self.__awaiter||function(_,A,M,O){return new(M||(M=Promise))(function(N,J){function ce(He){try{Oe(O.next(He))}catch(Ve){J(Ve)}}function se(He){try{Oe(O.throw(He))}catch(Ve){J(Ve)}}function Oe(He){var Ve;He.done?N(He.value):(Ve=He.value,Ve instanceof M?Ve:new M(function(Jt){Jt(Ve)})).then(ce,se)}Oe((O=O.apply(_,A||[])).next())})},P=self&&self.__generator||function(_,A){var M,O,N,J,ce={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return J={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function se(Oe){return function(He){return function(Ve){if(M)throw new TypeError("Generator is already executing.");for(;ce;)try{if(M=1,O&&(N=2&Ve[0]?O.return:Ve[0]?O.throw||((N=O.return)&&N.call(O),0):O.next)&&!(N=N.call(O,Ve[1])).done)return N;switch(O=0,N&&(Ve=[2&Ve[0],N.value]),Ve[0]){case 0:case 1:N=Ve;break;case 4:return ce.label++,{value:Ve[1],done:!1};case 5:ce.label++,O=Ve[1],Ve=[0];continue;case 7:Ve=ce.ops.pop(),ce.trys.pop();continue;default:if(N=ce.trys,!((N=N.length>0&&N[N.length-1])||Ve[0]!==6&&Ve[0]!==2)){ce=0;continue}if(Ve[0]===3&&(!N||Ve[1]>N[0]&&Ve[1]<N[3])){ce.label=Ve[1];break}if(Ve[0]===6&&ce.label<N[1]){ce.label=N[1],N=Ve;break}if(N&&ce.label<N[2]){ce.label=N[2],ce.ops.push(Ve);break}N[2]&&ce.ops.pop(),ce.trys.pop();continue}Ve=A.call(_,ce)}catch(Jt){Ve=[6,Jt],O=0}finally{M=N=0}if(5&Ve[0])throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}([Oe,He])}}},B=self&&self.__asyncValues||function(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A,M=_[Symbol.asyncIterator];return M?M.call(_):(_=typeof __values=="function"?__values(_):_[Symbol.iterator](),A={},O("next"),O("throw"),O("return"),A[Symbol.asyncIterator]=function(){return this},A);function O(N){A[N]=_[N]&&function(J){return new Promise(function(ce,se){(function(Oe,He,Ve,Jt){Promise.resolve(Jt).then(function(br){Oe({value:br,done:Ve})},He)})(ce,se,(J=_[N](J)).done,J.value)})}}},Y=0;function te(_,A){var M=this;if(typeof self!="undefined"){var O={process:xe};c.onmessage=function(N,J){return I(M,void 0,void 0,function(){var ce,se,Oe,He,Ve,Jt,br,Dr,qr,On;return P(this,function(An){switch(An.label){case 0:switch(An.trys.push([0,19,,20]),N){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!_)throw new Error("Worker does not support atomic processing");return[4,_(J.input,J.options||{},O)];case 2:return ce=An.sent(),c.postMessage("done",{result:ce}),[3,18];case 3:if(!A)throw new Error("Worker does not support batched processing");f=new S,m=J.options||{},se=A(f,m,O),An.label=4;case 4:An.trys.push([4,9,10,15]),Oe=B(se),An.label=5;case 5:return[4,Oe.next()];case 6:if((He=An.sent()).done)return[3,8];Ve=He.value,c.postMessage("output-batch",{result:Ve}),An.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return Jt=An.sent(),qr={error:Jt},[3,15];case 10:return An.trys.push([10,,13,14]),He&&!He.done&&(On=Oe.return)?[4,On.call(Oe)]:[3,12];case 11:An.sent(),An.label=12;case 12:return[3,14];case 13:if(qr)throw qr.error;return[7];case 14:return[7];case 15:return c.postMessage("done",{}),[3,18];case 16:return f.push(J.input),[3,18];case 17:return f.close(),[3,18];case 18:return[3,20];case 19:return br=An.sent(),Dr=br instanceof Error?br.message:"",c.postMessage("error",{error:Dr}),[3,20];case 20:return[2]}})})}}}function xe(_,A){return A===void 0&&(A={}),new Promise(function(M,O){var N=Y++,J=function(se,Oe){if(Oe.id===N)switch(se){case"done":c.removeEventListener(J),M(Oe.result);break;case"error":c.removeEventListener(J),O(Oe.error)}};c.addEventListener(J);var ce={id:N,input:_,options:A};c.postMessage("process",ce)})}self&&self.__awaiter,self&&self.__generator;var Ce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Me=ii("span").classList,et=Me&&Me.constructor&&Me.constructor.prototype,Ne=et===Object.prototype?void 0:et,ct=Array.isArray||function(_){return xa(_)=="Array"},je=Ke("species"),ht=Array,Et=function(_,A){return new(function(M){var O;return ct(M)&&(O=M.constructor,(Vo(O)&&(O===ht||ct(O.prototype))||Lr(O)&&(O=O[je])===null)&&(O=void 0)),O===void 0?ht:O}(_))(A===0?0:A)},Wt=Mt([].push),vr=function(_){var A=_==1,M=_==2,O=_==3,N=_==4,J=_==6,ce=_==7,se=_==5||J;return function(Oe,He,Ve,Jt){for(var br,Dr,qr=Ri(Oe),On=ul(qr),An=Ys(He,Ve),zn=To(On),mn=0,ni=Jt||Et,gi=A?ni(Oe,zn):M||ce?ni(Oe,0):void 0;zn>mn;mn++)if((se||mn in On)&&(Dr=An(br=On[mn],mn,qr),_))if(A)gi[mn]=Dr;else if(Dr)switch(_){case 3:return!0;case 5:return br;case 6:return mn;case 2:Wt(gi,br)}else switch(_){case 4:return!1;case 7:Wt(gi,br)}return J?-1:O||N?N:gi}},rr={forEach:vr(0),map:vr(1),filter:vr(2),some:vr(3),every:vr(4),find:vr(5),findIndex:vr(6),filterReject:vr(7)},Ar=function(_,A){var M=[][_];return!!M&&Z(function(){M.call(null,A||function(){return 1},1)})},Xr=rr.forEach,bn=Ar("forEach")?[].forEach:function(_){return Xr(this,_,arguments.length>1?arguments[1]:void 0)},pn=function(_){if(_&&_.forEach!==bn)try{ea(_,"forEach",bn)}catch(A){_.forEach=bn}};for(var Vn in Ce)Ce[Vn]&&pn(Ue[Vn]&&Ue[Vn].prototype);pn(Ne);var bi=function(_,A,M){var O=ar(A);O in _?wn.f(_,O,Tt(0,M)):_[O]=M},Ti=Ke("species"),Ai=function(_){return ge>=51||!Z(function(){var A=[];return(A.constructor={})[Ti]=function(){return{foo:1}},A[_](Boolean).foo!==1})},ba=Ai("slice"),Wn=Ke("species"),Wi=Array,na=Math.max;D({target:"Array",proto:!0,forced:!ba},{slice:function(_,A){var M,O,N,J=rs(this),ce=To(J),se=Fa(_,ce),Oe=Fa(A===void 0?ce:A,ce);if(ct(J)&&(M=J.constructor,(Vo(M)&&(M===Wi||ct(M.prototype))||Lr(M)&&(M=M[Wn])===null)&&(M=void 0),M===Wi||M===void 0))return Al(J,se,Oe);for(O=new(M===void 0?Wi:M)(na(Oe-se,0)),N=0;se<Oe;se++,N++)se in J&&bi(O,N,J[se]);return O.length=N,O}});var Xi=Mn.EXISTS,Pi=wn.f,ia=Function.prototype,zi=Mt(ia.toString),Li=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,vs=Mt(Li.exec);xr&&!Xi&&Pi(ia,"name",{configurable:!0,get:function(){try{return vs(Li,zi(this))[1]}catch(_){return""}}});var fo,Ho=Object.keys||function(_){return qu(_,Cu)},Us={f:xr&&!Bi?Object.defineProperties:function(_,A){oa(_);for(var M,O=rs(A),N=Ho(A),J=N.length,ce=0;J>ce;)wn.f(_,M=N[ce++],O[M]);return _}},Bo=Na("IE_PROTO"),Wo=function(){},ou=function(_){return"<script>"+_+"</script>"},su=function(_){_.write(ou("")),_.close();var A=_.parentWindow.Object;return _=null,A},Ms=function(){try{fo=new ActiveXObject("htmlfile")}catch(O){}var _,A;Ms=typeof document!="undefined"?document.domain&&fo?su(fo):((A=ii("iframe")).style.display="none",Hh.appendChild(A),A.src=String("javascript:"),(_=A.contentWindow.document).open(),_.write(ou("document.F=Object")),_.close(),_.F):su(fo);for(var M=Cu.length;M--;)delete Ms.prototype[Cu[M]];return Ms()};ji[Bo]=!0;var ms=Object.create||function(_,A){var M;return _!==null?(Wo.prototype=oa(_),M=new Wo,Wo.prototype=null,M[Bo]=_):M=Ms(),A===void 0?M:Us.f(M,A)},Vl=wn.f,Ou=Ke("unscopables"),Cf=Array.prototype;Cf[Ou]==null&&Vl(Cf,Ou,{configurable:!0,value:ms(null)});var Ml,Il,Ec,Hc=function(_){Cf[Ou][_]=!0},jl=!Z(function(){function _(){}return _.prototype.constructor=null,Object.getPrototypeOf(new _)!==_.prototype}),Wc=Na("IE_PROTO"),gl=Object,gs=gl.prototype,uu=jl?gl.getPrototypeOf:function(_){var A=Ri(_);if(ln(A,Wc))return A[Wc];var M=A.constructor;return ui(M)&&A instanceof M?M.prototype:A instanceof gl?gs:null},Gl=Ke("iterator"),ic=!1;[].keys&&("next"in(Ec=[].keys())?(Il=uu(uu(Ec)))!==Object.prototype&&(Ml=Il):ic=!0),(Ml==null||Z(function(){var _={};return Ml[Gl].call(_)!==_}))&&(Ml={}),ui(Ml[Gl])||Oa(Ml,Gl,function(){return this});var Va={IteratorPrototype:Ml,BUGGY_SAFARI_ITERATORS:ic},_u=Va.IteratorPrototype,lu=function(){return this},Cc=Mn.PROPER,_h=Mn.CONFIGURABLE,Sf=Va.IteratorPrototype,Xc=Va.BUGGY_SAFARI_ITERATORS,Ks=Ke("iterator"),xh=function(){return this},tl=function(_,A,M,O,N,J,ce){(function(zn,mn,ni,gi){var Wa=mn+" Iterator";zn.prototype=ms(_u,{next:Tt(+!gi,ni)}),Wr(zn,Wa,!1),gu[Wa]=lu})(M,A,O);var se,Oe,He,Ve=function(zn){if(zn===N&&On)return On;if(!Xc&&zn in Dr)return Dr[zn];switch(zn){case"keys":case"values":case"entries":return function(){return new M(this,zn)}}return function(){return new M(this)}},Jt=A+" Iterator",br=!1,Dr=_.prototype,qr=Dr[Ks]||Dr["@@iterator"]||N&&Dr[N],On=!Xc&&qr||Ve(N),An=A=="Array"&&Dr.entries||qr;if(An&&(se=uu(An.call(new _)))!==Object.prototype&&se.next&&(uu(se)!==Sf&&(It?It(se,Sf):ui(se[Ks])||Oa(se,Ks,xh)),Wr(se,Jt,!0)),Cc&&N=="values"&&qr&&qr.name!=="values"&&(_h?ea(Dr,"name","values"):(br=!0,On=function(){return Si(qr,this)})),N)if(Oe={values:Ve("values"),keys:J?On:Ve("keys"),entries:Ve("entries")},ce)for(He in Oe)(Xc||br||!(He in Dr))&&Oa(Dr,He,Oe[He]);else D({target:A,proto:!0,forced:Xc||br},Oe);return Dr[Ks]!==On&&Oa(Dr,Ks,On,{name:N}),gu[A]=On,Oe},Yc=wn.f,bh=qi.set,ac=qi.getterFor("Array Iterator"),Xo=tl(Array,"Array",function(_,A){bh(this,{type:"Array Iterator",target:rs(_),index:0,kind:A})},function(){var _=ac(this),A=_.target,M=_.kind,O=_.index++;return!A||O>=A.length?(_.target=void 0,{value:void 0,done:!0}):M=="keys"?{value:O,done:!1}:M=="values"?{value:A[O],done:!1}:{value:[O,A[O]],done:!1}},"values"),qf=gu.Arguments=gu.Array;if(Hc("keys"),Hc("values"),Hc("entries"),xr&&qf.name!=="values")try{Yc(qf,"name",{value:"values"})}catch(_){}var Iu,Sc,qc,$h=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined",xp=wn.f,Af=qi.enforce,Fu=qi.get,ye=Ue.Int8Array,cn=ye&&ye.prototype,Hl=Ue.Uint8ClampedArray,Kh=Hl&&Hl.prototype,Po=ye&&uu(ye),ku=cn&&uu(cn),Ac=Object.prototype,Eh=Ue.TypeError,wf=Ke("toStringTag"),$f=Ia("TYPED_ARRAY_TAG"),oc=$h&&!!It&&So(Ue.opera)!=="Opera",yd=!1,Tf={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},$c={BigInt64Array:8,BigUint64Array:8},bp=function(_){var A=uu(_);if(Lr(A)){var M=Fu(A);return M&&ln(M,"TypedArrayConstructor")?M.TypedArrayConstructor:bp(A)}},ps=function(_){if(!Lr(_))return!1;var A=So(_);return ln(Tf,A)||ln($c,A)};for(Iu in Tf)(qc=(Sc=Ue[Iu])&&Sc.prototype)?Af(qc).TypedArrayConstructor=Sc:oc=!1;for(Iu in $c)(qc=(Sc=Ue[Iu])&&Sc.prototype)&&(Af(qc).TypedArrayConstructor=Sc);if((!oc||!ui(Po)||Po===Function.prototype)&&(Po=function(){throw Eh("Incorrect invocation")},oc))for(Iu in Tf)Ue[Iu]&&It(Ue[Iu],Po);if((!oc||!ku||ku===Ac)&&(ku=Po.prototype,oc))for(Iu in Tf)Ue[Iu]&&It(Ue[Iu].prototype,ku);if(oc&&uu(Kh)!==ku&&It(Kh,ku),xr&&!ln(ku,wf))for(Iu in yd=!0,xp(ku,wf,{get:function(){return Lr(this)?this[$f]:void 0}}),Tf)Ue[Iu]&&ea(Ue[Iu],$f,Iu);var Ki={NATIVE_ARRAY_BUFFER_VIEWS:oc,TYPED_ARRAY_TAG:yd&&$f,aTypedArray:function(_){if(ps(_))return _;throw Eh("Target is not a typed array")},aTypedArrayConstructor:function(_){if(ui(_)&&(!It||ha(Po,_)))return _;throw Eh(Ie(_)+" is not a typed array constructor")},exportTypedArrayMethod:function(_,A,M,O){if(xr){if(M)for(var N in Tf){var J=Ue[N];if(J&&ln(J.prototype,_))try{delete J.prototype[_]}catch(ce){try{J.prototype[_]=A}catch(se){}}}ku[_]&&!M||Oa(ku,_,M?A:oc&&cn[_]||A,O)}},exportTypedArrayStaticMethod:function(_,A,M){var O,N;if(xr){if(It){if(M){for(O in Tf)if((N=Ue[O])&&ln(N,_))try{delete N[_]}catch(J){}}if(Po[_]&&!M)return;try{return Oa(Po,_,M?A:oc&&Po[_]||A)}catch(J){}}for(O in Tf)!(N=Ue[O])||N[_]&&!M||Oa(N,_,A)}},getTypedArrayConstructor:bp,isView:function(_){if(!Lr(_))return!1;var A=So(_);return A==="DataView"||ln(Tf,A)||ln($c,A)},isTypedArray:ps,TypedArray:Po,TypedArrayPrototype:ku},qd=Ki.NATIVE_ARRAY_BUFFER_VIEWS,qp=Ue.ArrayBuffer,wc=Ue.Int8Array,Qh=!qd||!Z(function(){wc(1)})||!Z(function(){new wc(-1)})||!_o(function(_){new wc,new wc(null),new wc(1.5),new wc(_)},!0)||Z(function(){return new wc(new qp(2),1,void 0).length!==1}),Kc=function(_,A,M){for(var O in A)Oa(_,O,A[O],M);return _},Ch=RangeError,kl=function(_){if(_===void 0)return 0;var A=Qn(_),M=Zo(A);if(A!==M)throw Ch("Wrong length or index");return M},Jh=Array,Ep=Math.abs,rl=Math.pow,Kf=Math.floor,$p=Math.log,Cp=Math.LN2,Kp=function(_,A,M){var O,N,J,ce=Jh(M),se=8*M-A-1,Oe=(1<<se)-1,He=Oe>>1,Ve=A===23?rl(2,-24)-rl(2,-77):0,Jt=_<0||_===0&&1/_<0?1:0,br=0;for((_=Ep(_))!=_||_===1/0?(N=_!=_?1:0,O=Oe):(O=Kf($p(_)/Cp),_*(J=rl(2,-O))<1&&(O--,J*=2),(_+=O+He>=1?Ve/J:Ve*rl(2,1-He))*J>=2&&(O++,J/=2),O+He>=Oe?(N=0,O=Oe):O+He>=1?(N=(_*J-1)*rl(2,A),O+=He):(N=_*rl(2,He-1)*rl(2,A),O=0));A>=8;)ce[br++]=255&N,N/=256,A-=8;for(O=O<<A|N,se+=A;se>0;)ce[br++]=255&O,O/=256,se-=8;return ce[--br]|=128*Jt,ce},ep=function(_,A){var M,O=_.length,N=8*O-A-1,J=(1<<N)-1,ce=J>>1,se=N-7,Oe=O-1,He=_[Oe--],Ve=127&He;for(He>>=7;se>0;)Ve=256*Ve+_[Oe--],se-=8;for(M=Ve&(1<<-se)-1,Ve>>=-se,se+=A;se>0;)M=256*M+_[Oe--],se-=8;if(Ve===0)Ve=1-ce;else{if(Ve===J)return M?NaN:He?-1/0:1/0;M+=rl(2,A),Ve-=ce}return(He?-1:1)*M*rl(2,Ve-A)},Mf=function(_){for(var A=Ri(this),M=To(A),O=arguments.length,N=Fa(O>1?arguments[1]:void 0,M),J=O>2?arguments[2]:void 0,ce=J===void 0?M:Fa(J,M);ce>N;)A[N++]=_;return A},Qs=Array,If=Math.max,Sh=function(_,A,M){for(var O=To(_),N=Fa(A,O),J=Fa(M===void 0?O:M,O),ce=Qs(If(J-N,0)),se=0;N<J;N++,se++)bi(ce,se,_[N]);return ce.length=se,ce},Ah=za.f,Qc=wn.f,nl=Mn.PROPER,Tc=Mn.CONFIGURABLE,Wl=qi.get,Qp=qi.set,Du=Ue.ArrayBuffer,sc=Du,tp=sc&&sc.prototype,kf=Ue.DataView,cu=kf&&kf.prototype,Sp=Object.prototype,Qf=Ue.Array,Jf=Ue.RangeError,uc=Mt(Mf),$d=Mt([].reverse),Kd=Kp,Mc=ep,wh=function(_){return[255&_]},Jc=function(_){return[255&_,_>>8&255]},ef=function(_){return[255&_,_>>8&255,_>>16&255,_>>24&255]},_d=function(_){return _[3]<<24|_[2]<<16|_[1]<<8|_[0]},xd=function(_){return Kd(_,23,4)},Jp=function(_){return Kd(_,52,8)},rp=function(_,A){Qc(_.prototype,A,{get:function(){return Wl(this)[A]}})},ua=function(_,A,M,O){var N=kl(M),J=Wl(_);if(N+A>J.byteLength)throw Jf("Wrong index");var ce=Wl(J.buffer).bytes,se=N+J.byteOffset,Oe=Sh(ce,se,se+A);return O?Oe:$d(Oe)},Bu=function(_,A,M,O,N,J){var ce=kl(M),se=Wl(_);if(ce+A>se.byteLength)throw Jf("Wrong index");for(var Oe=Wl(se.buffer).bytes,He=ce+se.byteOffset,Ve=O(+N),Jt=0;Jt<A;Jt++)Oe[He+Jt]=Ve[J?Jt:A-Jt-1]};if($h){var ys=nl&&Du.name!=="ArrayBuffer";if(Z(function(){Du(1)})&&Z(function(){new Du(-1)})&&!Z(function(){return new Du,new Du(1.5),new Du(NaN),ys&&!Tc}))ys&&Tc&&ea(Du,"name","ArrayBuffer");else{(sc=function(_){return Ni(this,tp),new Du(kl(_))}).prototype=tp;for(var Nu,tf=Ah(Du),bd=0;tf.length>bd;)(Nu=tf[bd++])in sc||ea(sc,Nu,Du[Nu]);tp.constructor=sc}It&&uu(cu)!==Sp&&It(cu,Sp);var Ap=new kf(new sc(2)),Qd=Mt(cu.setInt8);Ap.setInt8(0,2147483648),Ap.setInt8(1,2147483649),!Ap.getInt8(0)&&Ap.getInt8(1)||Kc(cu,{setInt8:function(_,A){Qd(this,_,A<<24>>24)},setUint8:function(_,A){Qd(this,_,A<<24>>24)}},{unsafe:!0})}else tp=(sc=function(_){Ni(this,tp);var A=kl(_);Qp(this,{bytes:uc(Qf(A),0),byteLength:A}),xr||(this.byteLength=A)}).prototype,cu=(kf=function(_,A,M){Ni(this,cu),Ni(_,tp);var O=Wl(_).byteLength,N=Qn(A);if(N<0||N>O)throw Jf("Wrong offset");if(N+(M=M===void 0?O-N:Zo(M))>O)throw Jf("Wrong length");Qp(this,{buffer:_,byteLength:M,byteOffset:N}),xr||(this.buffer=_,this.byteLength=M,this.byteOffset=N)}).prototype,xr&&(rp(sc,"byteLength"),rp(kf,"buffer"),rp(kf,"byteLength"),rp(kf,"byteOffset")),Kc(cu,{getInt8:function(_){return ua(this,1,_)[0]<<24>>24},getUint8:function(_){return ua(this,1,_)[0]},getInt16:function(_){var A=ua(this,2,_,arguments.length>1?arguments[1]:void 0);return(A[1]<<8|A[0])<<16>>16},getUint16:function(_){var A=ua(this,2,_,arguments.length>1?arguments[1]:void 0);return A[1]<<8|A[0]},getInt32:function(_){return _d(ua(this,4,_,arguments.length>1?arguments[1]:void 0))},getUint32:function(_){return _d(ua(this,4,_,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(_){return Mc(ua(this,4,_,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(_){return Mc(ua(this,8,_,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(_,A){Bu(this,1,_,wh,A)},setUint8:function(_,A){Bu(this,1,_,wh,A)},setInt16:function(_,A){Bu(this,2,_,Jc,A,arguments.length>2?arguments[2]:void 0)},setUint16:function(_,A){Bu(this,2,_,Jc,A,arguments.length>2?arguments[2]:void 0)},setInt32:function(_,A){Bu(this,4,_,ef,A,arguments.length>2?arguments[2]:void 0)},setUint32:function(_,A){Bu(this,4,_,ef,A,arguments.length>2?arguments[2]:void 0)},setFloat32:function(_,A){Bu(this,4,_,xd,A,arguments.length>2?arguments[2]:void 0)},setFloat64:function(_,A){Bu(this,8,_,Jp,A,arguments.length>2?arguments[2]:void 0)}});Wr(sc,"ArrayBuffer"),Wr(kf,"DataView");var Jd={ArrayBuffer:sc,DataView:kf},Ed=Math.floor,e0=Number.isInteger||function(_){return!Lr(_)&&isFinite(_)&&Ed(_)===_},C0=RangeError,wp=RangeError,Tp=function(_,A){var M=function(O){var N=Qn(O);if(N<0)throw C0("The argument can't be less than 0");return N}(_);if(M%A)throw wp("Wrong offset");return M},t0=Ki.aTypedArrayConstructor,np=function(_){var A,M,O,N,J,ce,se=jh(this),Oe=Ri(_),He=arguments.length,Ve=He>1?arguments[1]:void 0,Jt=Ve!==void 0,br=yu(Oe);if(br&&!xc(br))for(ce=(J=Ei(Oe,br)).next,Oe=[];!(N=Si(ce,J)).done;)Oe.push(N.value);for(Jt&&He>2&&(Ve=Ys(Ve,arguments[2])),M=To(Oe),O=new(t0(se))(M),A=0;M>A;A++)O[A]=Jt?Ve(Oe[A],A):Oe[A];return O},ho=function(_,A,M){var O,N;return It&&ui(O=A.constructor)&&O!==M&&Lr(N=O.prototype)&&N!==M.prototype&&It(_,N),_},ed=_r(function(_){var A=za.f,M=rr.forEach,O=qi.get,N=qi.set,J=qi.enforce,ce=wn.f,se=De.f,Oe=Math.round,He=Ue.RangeError,Ve=Jd.ArrayBuffer,Jt=Ve.prototype,br=Jd.DataView,Dr=Ki.NATIVE_ARRAY_BUFFER_VIEWS,qr=Ki.TYPED_ARRAY_TAG,On=Ki.TypedArray,An=Ki.TypedArrayPrototype,zn=Ki.aTypedArrayConstructor,mn=Ki.isTypedArray,ni=function(so,Qr){zn(so);for(var fn=0,Zi=Qr.length,$a=new so(Zi);Zi>fn;)$a[fn]=Qr[fn++];return $a},gi=function(so,Qr){ce(so,Qr,{get:function(){return O(this)[Qr]}})},Wa=function(so){var Qr;return ha(Jt,so)||(Qr=So(so))=="ArrayBuffer"||Qr=="SharedArrayBuffer"},oo=function(so,Qr){return mn(so)&&!ie(Qr)&&Qr in so&&e0(+Qr)&&Qr>=0},Ya=function(so,Qr){return Qr=ar(Qr),oo(so,Qr)?Tt(2,so[Qr]):se(so,Qr)},qa=function(so,Qr,fn){return Qr=ar(Qr),!(oo(so,Qr)&&Lr(fn)&&ln(fn,"value"))||ln(fn,"get")||ln(fn,"set")||fn.configurable||ln(fn,"writable")&&!fn.writable||ln(fn,"enumerable")&&!fn.enumerable?ce(so,Qr,fn):(so[Qr]=fn.value,so)};xr?(Dr||(De.f=Ya,wn.f=qa,gi(An,"buffer"),gi(An,"byteOffset"),gi(An,"byteLength"),gi(An,"length")),D({target:"Object",stat:!0,forced:!Dr},{getOwnPropertyDescriptor:Ya,defineProperty:qa}),_.exports=function(so,Qr,fn){var Zi=so.match(/\d+$/)[0]/8,$a=so+(fn?"Clamped":"")+"Array",_a="get"+so,ol="set"+so,xl=Ue[$a],es=xl,bl=es&&es.prototype,Cs={},Dh=function(sl,os){ce(sl,os,{get:function(){return function(Rl,Hu){var $l=O(Rl);return $l.view[_a](Hu*Zi+$l.byteOffset,!0)}(this,os)},set:function(Rl){return function(Hu,$l,oh){var Hp=O(Hu);fn&&(oh=(oh=Oe(oh))<0?0:oh>255?255:255&oh),Hp.view[ol]($l*Zi+Hp.byteOffset,oh,!0)}(this,os,Rl)},enumerable:!0})};Dr?Qh&&(es=Qr(function(sl,os,Rl,Hu){return Ni(sl,bl),ho(Lr(os)?Wa(os)?Hu!==void 0?new xl(os,Tp(Rl,Zi),Hu):Rl!==void 0?new xl(os,Tp(Rl,Zi)):new xl(os):mn(os)?ni(es,os):Si(np,es,os):new xl(kl(os)),sl,es)}),It&&It(es,On),M(A(xl),function(sl){sl in es||ea(es,sl,xl[sl])}),es.prototype=bl):(es=Qr(function(sl,os,Rl,Hu){Ni(sl,bl);var $l,oh,Hp,cm=0,G0=0;if(Lr(os)){if(!Wa(os))return mn(os)?ni(es,os):Si(np,es,os);$l=os,G0=Tp(Rl,Zi);var H0=os.byteLength;if(Hu===void 0){if(H0%Zi||(oh=H0-G0)<0)throw He("Wrong length")}else if((oh=Zo(Hu)*Zi)+G0>H0)throw He("Wrong length");Hp=oh/Zi}else Hp=kl(os),$l=new Ve(oh=Hp*Zi);for(N(sl,{buffer:$l,byteOffset:G0,byteLength:oh,length:Hp,view:new br($l)});cm<Hp;)Dh(sl,cm++)}),It&&It(es,On),bl=es.prototype=ms(An)),bl.constructor!==es&&ea(bl,"constructor",es),J(bl).TypedArrayConstructor=es,qr&&ea(bl,qr,$a);var fp=es!=xl;Cs[$a]=es,D({global:!0,constructor:!0,forced:fp,sham:!Dr},Cs),"BYTES_PER_ELEMENT"in es||ea(es,"BYTES_PER_ELEMENT",Zi),"BYTES_PER_ELEMENT"in bl||ea(bl,"BYTES_PER_ELEMENT",Zi),Hi($a)}):_.exports=function(){}});ed("Uint8",function(_){return function(A,M,O){return _(this,A,M,O)}},!0);var Pf=TypeError,Rf=function(_,A){if(!delete _[A])throw Pf("Cannot delete property "+Ie(A)+" of "+Ie(_))},Cd=Math.min,S0=Mt([].copyWithin||function(_,A){var M=Ri(this),O=To(M),N=Fa(_,O),J=Fa(A,O),ce=arguments.length>2?arguments[2]:void 0,se=Cd((ce===void 0?O:Fa(ce,O))-J,O-N),Oe=1;for(J<N&&N<J+se&&(Oe=-1,J+=se-1,N+=se-1);se-- >0;)J in M?M[N]=M[J]:Rf(M,N),N+=Oe,J+=Oe;return M}),H=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("copyWithin",function(_,A){return S0(H(this),_,A,arguments.length>2?arguments[2]:void 0)});var Pe=rr.every,it=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("every",function(_){return Pe(it(this),_,arguments.length>1?arguments[1]:void 0)});var or=TypeError,Br=function(_){var A=Zr(_,"number");if(typeof A=="number")throw or("Can't convert number to bigint");return BigInt(A)},ur=Ki.aTypedArray,kr=Ki.exportTypedArrayMethod,Gr=Mt("".slice);kr("fill",function(_){var A=arguments.length;ur(this);var M=Gr(So(this),0,3)==="Big"?Br(_):+_;return Si(Mf,this,M,A>1?arguments[1]:void 0,A>2?arguments[2]:void 0)},Z(function(){var _=0;return new Int8Array(2).fill({valueOf:function(){return _++}}),_!==1}));var Kr=Ki.aTypedArrayConstructor,en=Ki.getTypedArrayConstructor,sn=function(_){return Kr(cf(_,en(_)))},dn=function(_,A){return function(M,O){for(var N=0,J=To(O),ce=new M(J);J>N;)ce[N]=O[N++];return ce}(sn(_),A)},Fn=rr.filter,tn=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("filter",function(_){var A=Fn(tn(this),_,arguments.length>1?arguments[1]:void 0);return dn(this,A)});var Ur=rr.find,St=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("find",function(_){return Ur(St(this),_,arguments.length>1?arguments[1]:void 0)});var mr=rr.findIndex,rn=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("findIndex",function(_){return mr(rn(this),_,arguments.length>1?arguments[1]:void 0)});var En=rr.forEach,Vr=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("forEach",function(_){En(Vr(this),_,arguments.length>1?arguments[1]:void 0)});var Cn=cs.includes,Zn=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("includes",function(_){return Cn(Zn(this),_,arguments.length>1?arguments[1]:void 0)});var Ii=cs.indexOf,Mr=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("indexOf",function(_){return Ii(Mr(this),_,arguments.length>1?arguments[1]:void 0)});var wr=Ke("iterator"),ci=Ue.Uint8Array,Nn=Mt(Xo.values),un=Mt(Xo.keys),Pn=Mt(Xo.entries),Dn=Ki.aTypedArray,Qi=Ki.exportTypedArrayMethod,Fi=ci&&ci.prototype,Rn=!Z(function(){Fi[wr].call([1])}),Un=!!Fi&&Fi.values&&Fi[wr]===Fi.values&&Fi.values.name==="values",Oi=function(){return Nn(Dn(this))};Qi("entries",function(){return Pn(Dn(this))},Rn),Qi("keys",function(){return un(Dn(this))},Rn),Qi("values",Oi,Rn||!Un,{name:"values"}),Qi(wr,Oi,Rn||!Un,{name:"values"});var ta=Ki.aTypedArray,Ma=Ki.exportTypedArrayMethod,No=Mt([].join);Ma("join",function(_){return No(ta(this),_)});var Ko=Math.min,Ea=[].lastIndexOf,Zs=!!Ea&&1/[1].lastIndexOf(1,-0)<0,eo=Ar("lastIndexOf"),Vs=Zs||!eo?function(_){if(Zs)return Sl(Ea,this,arguments)||0;var A=rs(this),M=To(A),O=M-1;for(arguments.length>1&&(O=Ko(O,Qn(arguments[1]))),O<0&&(O=M+O);O>=0;O--)if(O in A&&A[O]===_)return O||0;return-1}:Ea,_s=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("lastIndexOf",function(_){var A=arguments.length;return Sl(Vs,_s(this),A>1?[_,arguments[1]]:[_])});var Js=rr.map,js=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("map",function(_){return Js(js(this),_,arguments.length>1?arguments[1]:void 0,function(A,M){return new(sn(A))(M)})});var xu=TypeError,Qo=function(_){return function(A,M,O,N){ot(M);var J=Ri(A),ce=ul(J),se=To(J),Oe=_?se-1:0,He=_?-1:1;if(O<2)for(;;){if(Oe in ce){N=ce[Oe],Oe+=He;break}if(Oe+=He,_?Oe<0:se<=Oe)throw xu("Reduce of empty array with no initial value")}for(;_?Oe>=0:se>Oe;Oe+=He)Oe in ce&&(N=M(N,ce[Oe],Oe,J));return N}},la={left:Qo(!1),right:Qo(!0)},xs=la.left,gr=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("reduce",function(_){var A=arguments.length;return xs(gr(this),_,A,A>1?arguments[1]:void 0)});var fu=la.right,Yi=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("reduceRight",function(_){var A=arguments.length;return fu(Yi(this),_,A,A>1?arguments[1]:void 0)});var wa=Ki.aTypedArray,io=Ki.exportTypedArrayMethod,bs=Math.floor;io("reverse",function(){for(var _,A=wa(this).length,M=bs(A/2),O=0;O<M;)_=this[O],this[O++]=this[--A],this[A]=_;return this});var rf=Ue.RangeError,Ye=Ue.Int8Array,dr=Ye&&Ye.prototype,qt=dr&&dr.set,ei=Ki.aTypedArray,Ra=Ki.exportTypedArrayMethod,Ze=!Z(function(){var _=new Uint8ClampedArray(2);return Si(qt,_,{length:1,0:3},1),_[1]!==3}),Ee=Ze&&Ki.NATIVE_ARRAY_BUFFER_VIEWS&&Z(function(){var _=new Ye(2);return _.set(1),_.set("2",1),_[0]!==0||_[1]!==2});Ra("set",function(_){ei(this);var A=Tp(arguments.length>1?arguments[1]:void 0,1),M=Ri(_);if(Ze)return Si(qt,this,M,A);var O=this.length,N=To(M),J=0;if(N+A>O)throw rf("Wrong length");for(;J<N;)this[A+J]=M[J++]},!Ze||Ee);var ft=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("slice",function(_,A){for(var M=Al(ft(this),_,A),O=sn(this),N=0,J=M.length,ce=new O(J);J>N;)ce[N]=M[N++];return ce},Z(function(){new Int8Array(1).slice()}));var Ut=rr.some,nr=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("some",function(_){return Ut(nr(this),_,arguments.length>1?arguments[1]:void 0)});var gt=Math.floor,nt=function(_,A){var M=_.length,O=gt(M/2);return M<8?At(_,A):Le(_,nt(Sh(_,0,O),A),nt(Sh(_,O),A),A)},At=function(_,A){for(var M,O,N=_.length,J=1;J<N;){for(O=J,M=_[J];O&&A(_[O-1],M)>0;)_[O]=_[--O];O!==J++&&(_[O]=M)}return _},Le=function(_,A,M,O){for(var N=A.length,J=M.length,ce=0,se=0;ce<N||se<J;)_[ce+se]=ce<N&&se<J?O(A[ce],M[se])<=0?A[ce++]:M[se++]:ce<N?A[ce++]:M[se++];return _},lt=nt,Ge=_i.match(/firefox\/(\d+)/i),zt=!!Ge&&+Ge[1],$t=/MSIE|Trident/.test(_i),jr=_i.match(/AppleWebKit\/(\d+)\./),_n=!!jr&&+jr[1],Ln=Ki.aTypedArray,jn=Ki.exportTypedArrayMethod,vn=Ue.Uint16Array,ti=vn&&Mt(vn.prototype.sort),Yn=!(!ti||Z(function(){ti(new vn(2),null)})&&Z(function(){ti(new vn(2),{})})),ai=!!ti&&!Z(function(){if(ge)return ge<74;if(zt)return zt<67;if($t)return!0;if(_n)return _n<602;var _,A,M=new vn(516),O=Array(516);for(_=0;_<516;_++)A=_%4,M[_]=515-_,O[_]=_-2*A+3;for(ti(M,function(N,J){return(N/4|0)-(J/4|0)}),_=0;_<516;_++)if(M[_]!==O[_])return!0});jn("sort",function(_){return _!==void 0&&ot(_),ai?ti(this,_):lt(Ln(this),function(A){return function(M,O){return A!==void 0?+A(M,O)||0:O!=O?-1:M!=M?1:M===0&&O===0?1/M>0&&1/O<0?1:-1:M>O}}(_))},!ai||Yn);var oi=Ki.aTypedArray;(0,Ki.exportTypedArrayMethod)("subarray",function(_,A){var M=oi(this),O=M.length,N=Fa(_,O);return new(sn(M))(M.buffer,M.byteOffset+N*M.BYTES_PER_ELEMENT,Zo((A===void 0?O:Fa(A,O))-N))});var qn=Ue.Int8Array,Ui=Ki.aTypedArray,po=Ki.exportTypedArrayMethod,eu=[].toLocaleString,vo=!!qn&&Z(function(){eu.call(new qn(1))});po("toLocaleString",function(){return Sl(eu,vo?Al(Ui(this)):Ui(this),Al(arguments))},Z(function(){return[1,2].toLocaleString()!=new qn([1,2]).toLocaleString()})||!Z(function(){qn.prototype.toLocaleString.call([1,2])}));var uo=Ki.exportTypedArrayMethod,xn=Ue.Uint8Array,zu=xn&&xn.prototype||{},hr=[].toString,Xl=Mt([].join);Z(function(){hr.call({})})&&(hr=function(){return Xl(this)});var Sd=zu.toString!=hr;uo("toString",hr,Sd);var yl,nf,ip=String,tu=function(_){if(So(_)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return ip(_)},Gs=function(){var _=oa(this),A="";return _.hasIndices&&(A+="d"),_.global&&(A+="g"),_.ignoreCase&&(A+="i"),_.multiline&&(A+="m"),_.dotAll&&(A+="s"),_.unicode&&(A+="u"),_.unicodeSets&&(A+="v"),_.sticky&&(A+="y"),A},Mp=Ue.RegExp,af=Z(function(){var _=Mp("a","y");return _.lastIndex=2,_.exec("abcd")!=null}),Ad=af||Z(function(){return!Mp("a","y").sticky}),wd={BROKEN_CARET:af||Z(function(){var _=Mp("^r","gy");return _.lastIndex=2,_.exec("str")!=null}),MISSED_STICKY:Ad,UNSUPPORTED_Y:af},r0=Ue.RegExp,Ip=Z(function(){var _=r0(".","s");return!(_.dotAll&&_.exec(`
`)&&_.flags==="s")}),Th=Ue.RegExp,A0=Z(function(){var _=Th("(?<a>b)","g");return _.exec("b").groups.a!=="b"||"b".replace(_,"$<a>c")!=="bc"}),sv=qi.get,Zv=tt("native-string-replace",String.prototype.replace),Hs=RegExp.prototype.exec,eh=Hs,uv=Mt("".charAt),n=Mt("".indexOf),s=Mt("".replace),l=Mt("".slice),d=(nf=/b*/g,Si(Hs,yl=/a/,"a"),Si(Hs,nf,"a"),yl.lastIndex!==0||nf.lastIndex!==0),x=wd.BROKEN_CARET,C=/()??/.exec("")[1]!==void 0;(d||C||x||Ip||A0)&&(eh=function(_){var A,M,O,N,J,ce,se,Oe=this,He=sv(Oe),Ve=tu(_),Jt=He.raw;if(Jt)return Jt.lastIndex=Oe.lastIndex,A=Si(eh,Jt,Ve),Oe.lastIndex=Jt.lastIndex,A;var br=He.groups,Dr=x&&Oe.sticky,qr=Si(Gs,Oe),On=Oe.source,An=0,zn=Ve;if(Dr&&(qr=s(qr,"y",""),n(qr,"g")===-1&&(qr+="g"),zn=l(Ve,Oe.lastIndex),Oe.lastIndex>0&&(!Oe.multiline||Oe.multiline&&uv(Ve,Oe.lastIndex-1)!==`
`)&&(On="(?: "+On+")",zn=" "+zn,An++),M=new RegExp("^(?:"+On+")",qr)),C&&(M=new RegExp("^"+On+"$(?!\\s)",qr)),d&&(O=Oe.lastIndex),N=Si(Hs,Dr?M:Oe,zn),Dr?N?(N.input=l(N.input,An),N[0]=l(N[0],An),N.index=Oe.lastIndex,Oe.lastIndex+=N[0].length):Oe.lastIndex=0:d&&N&&(Oe.lastIndex=Oe.global?N.index+N[0].length:O),C&&N&&N.length>1&&Si(Zv,N[0],M,function(){for(J=1;J<arguments.length-2;J++)arguments[J]===void 0&&(N[J]=void 0)}),N&&br)for(N.groups=ce=ms(null),J=0;J<br.length;J++)ce[(se=br[J])[0]]=N[se[1]];return N});var T=eh;D({target:"RegExp",proto:!0,forced:/./.exec!==T},{exec:T});var R,z=Ke("species"),W=RegExp.prototype,$=function(_,A,M,O){var N=Ke(_),J=!Z(function(){var He={};return He[N]=function(){return 7},""[_](He)!=7}),ce=J&&!Z(function(){var He=!1,Ve=/a/;return _==="split"&&((Ve={}).constructor={},Ve.constructor[z]=function(){return Ve},Ve.flags="",Ve[N]=/./[N]),Ve.exec=function(){return He=!0,null},Ve[N](""),!He});if(!J||!ce||M){var se=Mt(/./[N]),Oe=A(N,""[_],function(He,Ve,Jt,br,Dr){var qr=Mt(He),On=Ve.exec;return On===T||On===W.exec?J&&!Dr?{done:!0,value:se(Ve,Jt,br)}:{done:!0,value:qr(Jt,Ve,br)}:{done:!1}});Oa(String.prototype,_,Oe[0]),Oa(W,N,Oe[1])}O&&ea(W[N],"sham",!0)},ee=Mt("".charAt),le=Mt("".charCodeAt),be=Mt("".slice),$e=function(_){return function(A,M){var O,N,J=tu(Xn(A)),ce=Qn(M),se=J.length;return ce<0||ce>=se?_?"":void 0:(O=le(J,ce))<55296||O>56319||ce+1===se||(N=le(J,ce+1))<56320||N>57343?_?ee(J,ce):O:_?be(J,ce,ce+2):N-56320+(O-55296<<10)+65536}},Je={codeAt:$e(!1),charAt:$e(!0)},dt=Je.charAt,st=function(_,A,M){return A+(M?dt(_,A).length:1)},Dt=Math.floor,kt=Mt("".charAt),lr=Mt("".replace),yr=Mt("".slice),zr=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,hn=/\$([$&'`]|\d{1,2})/g,Bn=function(_,A,M,O,N,J){var ce=M+_.length,se=O.length,Oe=hn;return N!==void 0&&(N=Ri(N),Oe=zr),lr(J,Oe,function(He,Ve){var Jt;switch(kt(Ve,0)){case"$":return"$";case"&":return _;case"`":return yr(A,0,M);case"'":return yr(A,ce);case"<":Jt=N[yr(Ve,1,-1)];break;default:var br=+Ve;if(br===0)return He;if(br>se){var Dr=Dt(br/10);return Dr===0?He:Dr<=se?O[Dr-1]===void 0?kt(Ve,1):O[Dr-1]+kt(Ve,1):He}Jt=O[br-1]}return Jt===void 0?"":Jt})},wi=TypeError,$n=function(_,A){var M=_.exec;if(ui(M)){var O=Si(M,_,A);return O!==null&&oa(O),O}if(xa(_)==="RegExp")return Si(T,_,A);throw wi("RegExp#exec called on incompatible receiver")},Ci=Ke("replace"),ri=Math.max,Ca=Math.min,ki=Mt([].concat),hi=Mt([].push),ga=Mt("".indexOf),da=Mt("".slice),Da="a".replace(/./,"$0")==="$0",Mi=!!/./[Ci]&&/./[Ci]("a","$0")==="";function Ha(_){this.message=_}$("replace",function(_,A,M){var O=Mi?"$":"$0";return[function(N,J){var ce=Xn(this),se=N==null?void 0:xt(N,Ci);return se?Si(se,N,ce,J):Si(A,tu(ce),N,J)},function(N,J){var ce=oa(this),se=tu(N);if(typeof J=="string"&&ga(J,O)===-1&&ga(J,"$<")===-1){var Oe=M(A,ce,se,J);if(Oe.done)return Oe.value}var He=ui(J);He||(J=tu(J));var Ve=ce.global;if(Ve){var Jt=ce.unicode;ce.lastIndex=0}for(var br=[];;){var Dr=$n(ce,se);if(Dr===null||(hi(br,Dr),!Ve))break;tu(Dr[0])===""&&(ce.lastIndex=st(se,Zo(ce.lastIndex),Jt))}for(var qr,On="",An=0,zn=0;zn<br.length;zn++){for(var mn=tu((Dr=br[zn])[0]),ni=ri(Ca(Qn(Dr.index),se.length),0),gi=[],Wa=1;Wa<Dr.length;Wa++)hi(gi,(qr=Dr[Wa])===void 0?qr:String(qr));var oo=Dr.groups;if(He){var Ya=ki([mn],gi,ni,se);oo!==void 0&&hi(Ya,oo);var qa=tu(Sl(J,void 0,Ya))}else qa=Bn(mn,se,ni,gi,oo,J);ni>=An&&(On+=da(se,An,ni)+qa,An=ni+mn.length)}return On+da(se,An)}]},!!Z(function(){var _=/./;return _.exec=function(){var A=[];return A.groups={a:"7"},A},"".replace(_,"$<a>")!=="7"})||!Da||Mi),Ha.prototype=new Error,Ha.prototype.name="InvalidCharacterError",D({global:!0},{globalThis:Ue}),R=typeof window=="undefined"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(_){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(_){return null},clearMeasures:function(_){return null},clearMarks:function(_){return null},measure:function(_,A,M){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(_){return!0},Event:function(_,A){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:R.devicePixelRatio;var Yo=TypeError,ns=function(_){if(_>9007199254740991)throw Yo("Maximum allowed index exceeded");return _},ds=Ai("splice"),Jo=Math.max,Es=Math.min;D({target:"Array",proto:!0,forced:!ds},{splice:function(_,A){var M,O,N,J,ce,se,Oe=Ri(this),He=To(Oe),Ve=Fa(_,He),Jt=arguments.length;for(Jt===0?M=O=0:Jt===1?(M=0,O=He-Ve):(M=Jt-2,O=Es(Jo(Qn(A),0),He-Ve)),ns(He+M-O),N=Et(Oe,O),J=0;J<O;J++)(ce=Ve+J)in Oe&&bi(N,J,Oe[ce]);if(N.length=O,M<O){for(J=Ve;J<He-O;J++)se=J+M,(ce=J+O)in Oe?Oe[se]=Oe[ce]:Rf(Oe,se);for(J=He;J>He-O+M;J--)Rf(Oe,J-1)}else if(M>O)for(J=He-O;J>Ve;J--)se=J+M-1,(ce=J+O-1)in Oe?Oe[se]=Oe[ce]:Rf(Oe,se);for(J=0;J<M;J++)Oe[J+Ve]=arguments[J+2];return Oe.length=He-O+M,N}});var hu=Ae(function _(A,M){he(this,_),Xe(this,"cancelBubble",void 0),Xe(this,"cancelable",void 0),Xe(this,"target",void 0),Xe(this,"currentTarget",void 0),Xe(this,"preventDefault",void 0),Xe(this,"stopPropagation",void 0),Xe(this,"type",void 0),Xe(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=A,this.timeStamp=Date.now()}),is=Object.assign,Uu=Object.defineProperty,bu=Mt([].concat),Pu=!is||Z(function(){if(xr&&is({b:1},is(Uu({},"a",{enumerable:!0,get:function(){Uu(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var _={},A={},M=Symbol();return _[M]=7,"abcdefghijklmnopqrst".split("").forEach(function(O){A[O]=O}),is({},_)[M]!=7||Ho(is({},A)).join("")!="abcdefghijklmnopqrst"})?function(_,A){for(var M=Ri(_),O=arguments.length,N=1,J=fs.f,ce=ws.f;O>N;)for(var se,Oe=ul(arguments[N++]),He=J?bu(Ho(Oe),J(Oe)):Ho(Oe),Ve=He.length,Jt=0;Ve>Jt;)se=He[Jt++],xr&&!Si(ce,Oe,se)||(M[se]=Oe[se]);return M}:is;D({target:"Object",stat:!0,arity:2,forced:Object.assign!==Pu},{assign:Pu});var Is=rr.findIndex,pu=!0;"findIndex"in[]&&Array(1).findIndex(function(){pu=!1}),D({target:"Array",proto:!0,forced:pu},{findIndex:function(_){return Is(this,_,arguments.length>1?arguments[1]:void 0)}}),Hc("findIndex");var Ba=Je.charAt,Mo=qi.set,xo=qi.getterFor("String Iterator");tl(String,"String",function(_){Mo(this,{type:"String Iterator",string:tu(_),index:0})},function(){var _,A=xo(this),M=A.string,O=A.index;return O>=M.length?{value:void 0,done:!0}:(_=Ba(M,O),A.index+=_.length,{value:_,done:!1})});var ja=za.f,Zu=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Vu={f:function(_){return Zu&&xa(_)=="Window"?function(A){try{return ja(A)}catch(M){return Sh(Zu)}}(_):ja(rs(_))}},zo=Z(function(){if(typeof ArrayBuffer=="function"){var _=new ArrayBuffer(8);Object.isExtensible(_)&&Object.defineProperty(_,"a",{value:8})}}),as=Object.isExtensible,ks=Z(function(){as(1)})||zo?function(_){return!!Lr(_)&&(!zo||xa(_)!="ArrayBuffer")&&(!as||as(_))}:as,ao=!Z(function(){return Object.isExtensible(Object.preventExtensions({}))}),_l=_r(function(_){var A=wn.f,M=!1,O=Ia("meta"),N=0,J=function(se){A(se,O,{value:{objectID:"O"+N++,weakData:{}}})},ce=_.exports={enable:function(){ce.enable=function(){},M=!0;var se=za.f,Oe=Mt([].splice),He={};He[O]=1,se(He).length&&(za.f=function(Ve){for(var Jt=se(Ve),br=0,Dr=Jt.length;br<Dr;br++)if(Jt[br]===O){Oe(Jt,br,1);break}return Jt},D({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Vu.f}))},fastKey:function(se,Oe){if(!Lr(se))return typeof se=="symbol"?se:(typeof se=="string"?"S":"P")+se;if(!ln(se,O)){if(!ks(se))return"F";if(!Oe)return"E";J(se)}return se[O].objectID},getWeakData:function(se,Oe){if(!ln(se,O)){if(!ks(se))return!0;if(!Oe)return!1;J(se)}return se[O].weakData},onFreeze:function(se){return ao&&M&&ks(se)&&!ln(se,O)&&J(se),se}};ji[O]=!0}),Yl=(_l.enable,_l.fastKey,_l.getWeakData,_l.onFreeze,function(_,A,M){var O=_.indexOf("Map")!==-1,N=_.indexOf("Weak")!==-1,J=O?"set":"add",ce=Ue[_],se=ce&&ce.prototype,Oe=ce,He={},Ve=function(An){var zn=Mt(se[An]);Oa(se,An,An=="add"?function(mn){return zn(this,mn===0?0:mn),this}:An=="delete"?function(mn){return!(N&&!Lr(mn))&&zn(this,mn===0?0:mn)}:An=="get"?function(mn){return N&&!Lr(mn)?void 0:zn(this,mn===0?0:mn)}:An=="has"?function(mn){return!(N&&!Lr(mn))&&zn(this,mn===0?0:mn)}:function(mn,ni){return zn(this,mn===0?0:mn,ni),this})};if(k(_,!ui(ce)||!(N||se.forEach&&!Z(function(){new ce().entries().next()}))))Oe=M.getConstructor(A,_,O,J),_l.enable();else if(k(_,!0)){var Jt=new Oe,br=Jt[J](N?{}:-0,1)!=Jt,Dr=Z(function(){Jt.has(1)}),qr=_o(function(An){new ce(An)}),On=!N&&Z(function(){for(var An=new ce,zn=5;zn--;)An[J](zn,zn);return!An.has(-0)});qr||((Oe=A(function(An,zn){Ni(An,se);var mn=ho(new ce,An,Oe);return zn!=null&&$o(zn,mn[J],{that:mn,AS_ENTRIES:O}),mn})).prototype=se,se.constructor=Oe),(Dr||On)&&(Ve("delete"),Ve("has"),O&&Ve("get")),(On||br)&&Ve(J),N&&se.clear&&delete se.clear}return He[_]=Oe,D({global:!0,constructor:!0,forced:Oe!=ce},He),Wr(Oe,_),N||M.setStrong(Oe,_,O),Oe}),Ic=_l.getWeakData,Ps=qi.set,th=qi.getterFor,kc=rr.find,td=rr.findIndex,kp=Mt([].splice),rd=0,lc=function(_){return _.frozen||(_.frozen=new Pp)},Pp=function(){this.entries=[]},nd=function(_,A){return kc(_.entries,function(M){return M[0]===A})};Pp.prototype={get:function(_){var A=nd(this,_);if(A)return A[1]},has:function(_){return!!nd(this,_)},set:function(_,A){var M=nd(this,_);M?M[1]=A:this.entries.push([_,A])},delete:function(_){var A=td(this.entries,function(M){return M[0]===_});return~A&&kp(this.entries,A,1),!!~A}};var Lf,Rp={getConstructor:function(_,A,M,O){var N=_(function(Oe,He){Ni(Oe,J),Ps(Oe,{type:A,id:rd++,frozen:void 0}),He!=null&&$o(He,Oe[O],{that:Oe,AS_ENTRIES:M})}),J=N.prototype,ce=th(A),se=function(Oe,He,Ve){var Jt=ce(Oe),br=Ic(oa(He),!0);return br===!0?lc(Jt).set(He,Ve):br[Jt.id]=Ve,Oe};return Kc(J,{delete:function(Oe){var He=ce(this);if(!Lr(Oe))return!1;var Ve=Ic(Oe);return Ve===!0?lc(He).delete(Oe):Ve&&ln(Ve,He.id)&&delete Ve[He.id]},has:function(Oe){var He=ce(this);if(!Lr(Oe))return!1;var Ve=Ic(Oe);return Ve===!0?lc(He).has(Oe):Ve&&ln(Ve,He.id)}}),Kc(J,M?{get:function(Oe){var He=ce(this);if(Lr(Oe)){var Ve=Ic(Oe);return Ve===!0?lc(He).get(Oe):Ve?Ve[He.id]:void 0}},set:function(Oe,He){return se(this,Oe,He)}}:{add:function(Oe){return se(this,Oe,!0)}}),N}},Lp=qi.enforce,Td=!Ue.ActiveXObject&&"ActiveXObject"in Ue,Of=function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},Md=Yl("WeakMap",Of,Rp);if(Ft&&Td){Lf=Rp.getConstructor(Of,"WeakMap",!0),_l.enable();var rh=Md.prototype,nh=Mt(rh.delete),Mh=Mt(rh.has),id=Mt(rh.get),ad=Mt(rh.set);Kc(rh,{delete:function(_){if(Lr(_)&&!ks(_)){var A=Lp(this);return A.frozen||(A.frozen=new Lf),nh(this,_)||A.frozen.delete(_)}return nh(this,_)},has:function(_){if(Lr(_)&&!ks(_)){var A=Lp(this);return A.frozen||(A.frozen=new Lf),Mh(this,_)||A.frozen.has(_)}return Mh(this,_)},get:function(_){if(Lr(_)&&!ks(_)){var A=Lp(this);return A.frozen||(A.frozen=new Lf),Mh(this,_)?id(this,_):A.frozen.get(_)}return id(this,_)},set:function(_,A){if(Lr(_)&&!ks(_)){var M=Lp(this);M.frozen||(M.frozen=new Lf),Mh(this,_)?ad(this,_,A):M.frozen.set(_,A)}else ad(this,_,A);return this}})}var Op=Ke("iterator"),Fp=Ke("toStringTag"),Dp=Xo.values,od=function(_,A){if(_){if(_[Op]!==Dp)try{ea(_,Op,Dp)}catch(O){_[Op]=Dp}if(_[Fp]||ea(_,Fp,A),Ce[A]){for(var M in Xo)if(_[M]!==Xo[M])try{ea(_,M,Xo[M])}catch(O){_[M]=Xo[M]}}}};for(var Bp in Ce)od(Ue[Bp]&&Ue[Bp].prototype,Bp);od(Ne,"DOMTokenList");var Np,zp,Ih,sd,ih=new WeakMap,ud=function(){function _(){he(this,_),ih.set(this,{})}return Ae(_,[{key:"addEventListener",value:function(A,M){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},N=ih.get(this);N||(N={}),N[A]||(N[A]=[]),N[A].push(M),ih.set(this,N),O.capture,O.once,O.passive}},{key:"removeEventListener",value:function(A,M){var O=ih.get(this);if(O){var N=O[A];if(N&&N.length>0){for(var J=N.length;J--;J>0)if(N[J]===M){N.splice(J,1);break}}}}},{key:"dispatchEvent",value:function(A){var M=ih.get(this)[A.type];if(M){var O,N=function(J,ce){var se=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!se){if(Array.isArray(J)||(se=Zt(J))||ce&&J&&typeof J.length=="number"){se&&(J=se);var Oe=0,He=function(){};return{s:He,n:function(){return Oe>=J.length?{done:!0}:{done:!1,value:J[Oe++]}},e:function(Dr){throw Dr},f:He}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ve,Jt=!0,br=!1;return{s:function(){se=se.call(J)},n:function(){var Dr=se.next();return Jt=Dr.done,Dr},e:function(Dr){br=!0,Ve=Dr},f:function(){try{Jt||se.return==null||se.return()}finally{if(br)throw Ve}}}}(M);try{for(N.s();!(O=N.n()).done;)(0,O.value)(A)}catch(J){N.e(J)}finally{N.f()}}}}]),_}(),va=function(_){Ct(M,_);var A=Er(M);function M(){var O;return he(this,M),Xe(Yt(O=A.call(this)),"className",void 0),Xe(Yt(O),"children",void 0),O.className="",O.children=[],O}return Ae(M,[{key:"setAttribute",value:function(O,N){this[O]=N}},{key:"getAttribute",value:function(O){return this[O]}},{key:"setAttributeNS",value:function(O,N){this[O]=N}},{key:"getAttributeNS",value:function(O){return this[O]}}]),M}(function(_){Ct(M,_);var A=Er(M);function M(){var O;return he(this,M),Xe(Yt(O=A.call(this)),"childNodes",void 0),O.childNodes=[],O}return Ae(M,[{key:"appendChild",value:function(O){this.childNodes.push(O)}},{key:"cloneNode",value:function(){var O=Object.create(this);return Object.assign(O,this),O}},{key:"removeChild",value:function(O){var N=this.childNodes.findIndex(function(J){return J===O});return N>-1?this.childNodes.splice(N,1):null}}]),M}(ud));if(typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var ca=my.getSystemInfoSync();Np=ca.screenWidth,zp=ca.screenHeight,Ih=ca.windowWidth,sd=ca.windowHeight}else{var ap=R.innerWidth,w0=R.innerHeight;Np=ap,zp=w0,Ih=ap,sd=w0}var T0={width:Np,height:zp,availWidth:Ih,availHeight:sd,availLeft:0,availTop:0},Id=T0.availWidth,n0=T0.availHeight,M0={style:[]};function Vv(_,A){var M,O;"parentNode"in _||(M=A===0?function(){return null}:A===1?function(){return M0}:function(){return null},Object.defineProperty(_,"parentNode",{enumerable:!0,get:M})),"parentElement"in _||(O=A===0?function(){return null}:A===1?function(){return M0}:function(){return null},Object.defineProperty(_,"parentElement",{enumerable:!0,get:O}))}function i0(_){_.style=_.style||{},Object.assign(_.style,{top:"0px",left:"0px",width:Id+"px",height:n0+"px",margin:"0px",padding:"0px"})}function Ws(_){"clientLeft"in _||(_.clientLeft=0,_.clientTop=0),"clientWidth"in _||(_.clientWidth=Id,_.clientHeight=n0),"getBoundingClientRect"in _||(_.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function ah(_){"offsetLeft"in _||(_.offsetLeft=0,_.offsetTop=0),"offsetWidth"in _||(_.offsetWidth=Id,_.offsetHeight=n0)}function Lm(_){"scrollLeft"in _||(_.scrollLeft=0,_.scrollTop=0),"scrollWidth"in _||(_.scrollWidth=Id,_.scrollHeight=n0)}function op(_){var A=function(){return!0};_.classList=[],_.classList.add=A,_.classList.remove=A,_.classList.contains=A,_.classList.toggle=A}function Up(){}var kd=function(_){Ct(M,_);var A=Er(M);function M(){var O,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",J=arguments.length>1?arguments[1]:void 0;return he(this,M),Xe(Yt(O=A.call(this)),"className",void 0),Xe(Yt(O),"children",void 0),Xe(Yt(O),"focus",void 0),Xe(Yt(O),"blur",void 0),Xe(Yt(O),"insertBefore",void 0),Xe(Yt(O),"appendChild",void 0),Xe(Yt(O),"removeChild",void 0),Xe(Yt(O),"remove",void 0),Xe(Yt(O),"innerHTML",void 0),Xe(Yt(O),"tagName",void 0),O.className="",O.children=[],O.focus=Up,O.blur=Up,O.insertBefore=Up,O.appendChild=Up,O.removeChild=Up,O.remove=Up,O.innerHTML="",O.tagName=N.toUpperCase(),Vv(Yt(O),J),i0(Yt(O)),op(Yt(O)),Ws(Yt(O)),ah(Yt(O)),Lm(Yt(O)),O}return Ae(M)}(va),a0=function(_){Ct(M,_);var A=Er(M);function M(){return he(this,M),A.call(this,"video")}return Ae(M)}(function(_){Ct(M,_);var A=Er(M);function M(O){return he(this,M),A.call(this,O)}return Ae(M,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),M}(kd)),kh={};function I0(){return kh}var o0=Ae(function _(){he(this,_);var A=I0(),M=A.createImage&&A.createImage()||{};return"tagName"in M||(M.tagName="IMG",M.__proto__=_.prototype),Vv(M),op(M),Object.assign(M,{addEventListener:function(O,N){M["on".concat(O)]=N.bind(M)},removeEventListener:function(O){M["on".concat(O)]=null}}),M}),k0={href:"",protocol:"",host:""},P0=function(_){Ct(M,_);var A=Er(M);function M(){return he(this,M),A.call(this,"body",0)}return Ae(M,[{key:"addEventListener",value:function(O,N){}},{key:"removeEventListener",value:function(O,N,J){}},{key:"dispatchEvent",value:function(O){}}]),M}(kd),lv=function(_){Ct(M,_);var A=Er(M);function M(){return he(this,M),A.call(this,"html",0)}return Ae(M,[{key:"addEventListener",value:function(O,N){}},{key:"removeEventListener",value:function(O,N){}},{key:"dispatchEvent",value:function(O){}}]),M}(kd),Pd={},ld={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:k0,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(_){return(_=_.toLowerCase())==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):_==="img"?new o0:_==="video"?new a0:new kd(_)},createElementNS:function(_,A){return this.createElement(A)},createTextNode:function(_){return _},getElementById:function(_){return null},getElementsByTagName:function(_){return _=_.toLowerCase(),[]},getElementsByTagNameNS:function(_,A){return this.getElementsByTagName(A)},getElementsByName:function(_){return[]},querySelector:function(_){return null},querySelectorAll:function(_){return[]},addEventListener:function(_,A,M){Pd[_]||(Pd[_]=[]),Pd[_].push(A)},removeEventListener:function(_,A){var M=Pd[_];if(M&&M.length>0){for(var O=M.length;O--;O>0)if(M[O]===A){M.splice(O,1);break}}},dispatchEvent:function(_){var A=_.type,M=Pd[A];if(M)for(var O=0;O<M.length;O++)M[O](_);_.target&&typeof _.target["on"+A]=="function"&&_.target["on"+A](_)},createEvent:function(_){return new hu(_)}};ld.documentElement=new lv,ld.head=new kd("head"),ld.body=new P0,$("match",function(_,A,M){return[function(O){var N=Xn(this),J=O==null?void 0:xt(O,_);return J?Si(J,O,N):new RegExp(O)[_](tu(N))},function(O){var N=oa(this),J=tu(O),ce=M(A,N,J);if(ce.done)return ce.value;if(!N.global)return $n(N,J);var se=N.unicode;N.lastIndex=0;for(var Oe,He=[],Ve=0;(Oe=$n(N,J))!==null;){var Jt=tu(Oe[0]);He[Ve]=Jt,Jt===""&&(N.lastIndex=st(J,Zo(N.lastIndex),se)),Ve++}return Ve===0?null:He}]});var R0,ql,cv=Ke("isConcatSpreadable"),jv=ge>=51||!Z(function(){var _=[];return _[cv]=!1,_.concat()[0]!==_}),s0=Ai("concat"),Pc=function(_){if(!Lr(_))return!1;var A=_[cv];return A!==void 0?!!A:ct(_)};if(D({target:"Array",proto:!0,arity:1,forced:!jv||!s0},{concat:function(_){var A,M,O,N,J,ce=Ri(this),se=Et(ce,0),Oe=0;for(A=-1,O=arguments.length;A<O;A++)if(Pc(J=A===-1?ce:arguments[A]))for(N=To(J),ns(Oe+N),M=0;M<N;M++,Oe++)M in J&&bi(se,Oe,J[M]);else ns(Oe+1),bi(se,Oe++,J);return se.length=Oe,se}}),typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Rd=my.getSystemInfoSync();R0=Rd.system,Rd.platform,Rd.language}else{var Rc={versions:(ql=R.navigator.userAgent,{trident:ql.indexOf("Trident")>-1,presto:ql.indexOf("Presto")>-1,webKit:ql.indexOf("AppleWebKit")>-1,gecko:ql.indexOf("Gecko")>-1&&ql.indexOf("KHTML")===-1,mobile:!!ql.match(/AppleWebKit.*Mobile.*/),ios:!!ql.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:ql.indexOf("Android")>-1||ql.indexOf("Linux")>-1,iPhone:ql.indexOf("iPhone")>-1,iPad:ql.indexOf("iPad")>-1,webApp:ql.indexOf("Safari")===-1,weixin:ql.indexOf("MicroMessenger")>-1,qq:ql.match(/\sQQ/i)===" qq"}),language:(R.navigator.browserLanguage||R.navigator.language).toLowerCase()};Rc.versions.android||Rc.versions.trident||Rc.versions.presto||Rc.versions.webKit||Rc.versions.gecko||Rc.versions.mobile||Rc.versions.ios||Rc.versions.iPhone||Rc.versions.iPad||Rc.versions.webApp||Rc.versions.weixin||Rc.versions.qq,R0=R.navigator.userAgent,Rc.language}R0.toLowerCase().indexOf("android"),ed("Uint8",function(_){return function(A,M,O){return _(this,A,M,O)}});var Ph=wn.f,Gv=_l.fastKey,fv=qi.set,sp=qi.getterFor;Yl("Map",function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(_,A,M,O){var N=_(function(He,Ve){Ni(He,J),fv(He,{type:A,index:ms(null),first:void 0,last:void 0,size:0}),xr||(He.size=0),Ve!=null&&$o(Ve,He[O],{that:He,AS_ENTRIES:M})}),J=N.prototype,ce=sp(A),se=function(He,Ve,Jt){var br,Dr,qr=ce(He),On=Oe(He,Ve);return On?On.value=Jt:(qr.last=On={index:Dr=Gv(Ve,!0),key:Ve,value:Jt,previous:br=qr.last,next:void 0,removed:!1},qr.first||(qr.first=On),br&&(br.next=On),xr?qr.size++:He.size++,Dr!=="F"&&(qr.index[Dr]=On)),He},Oe=function(He,Ve){var Jt,br=ce(He),Dr=Gv(Ve);if(Dr!=="F")return br.index[Dr];for(Jt=br.first;Jt;Jt=Jt.next)if(Jt.key==Ve)return Jt};return Kc(J,{clear:function(){for(var He=ce(this),Ve=He.index,Jt=He.first;Jt;)Jt.removed=!0,Jt.previous&&(Jt.previous=Jt.previous.next=void 0),delete Ve[Jt.index],Jt=Jt.next;He.first=He.last=void 0,xr?He.size=0:this.size=0},delete:function(He){var Ve=ce(this),Jt=Oe(this,He);if(Jt){var br=Jt.next,Dr=Jt.previous;delete Ve.index[Jt.index],Jt.removed=!0,Dr&&(Dr.next=br),br&&(br.previous=Dr),Ve.first==Jt&&(Ve.first=br),Ve.last==Jt&&(Ve.last=Dr),xr?Ve.size--:this.size--}return!!Jt},forEach:function(He){for(var Ve,Jt=ce(this),br=Ys(He,arguments.length>1?arguments[1]:void 0);Ve=Ve?Ve.next:Jt.first;)for(br(Ve.value,Ve.key,this);Ve&&Ve.removed;)Ve=Ve.previous},has:function(He){return!!Oe(this,He)}}),Kc(J,M?{get:function(He){var Ve=Oe(this,He);return Ve&&Ve.value},set:function(He,Ve){return se(this,He===0?0:He,Ve)}}:{add:function(He){return se(this,He=He===0?0:He,He)}}),xr&&Ph(J,"size",{get:function(){return ce(this).size}}),N},setStrong:function(_,A,M){var O=A+" Iterator",N=sp(A),J=sp(O);tl(_,A,function(ce,se){fv(this,{type:O,target:ce,state:N(ce),kind:se,last:void 0})},function(){for(var ce=J(this),se=ce.kind,Oe=ce.last;Oe&&Oe.removed;)Oe=Oe.previous;return ce.target&&(ce.last=Oe=Oe?Oe.next:ce.state.first)?se=="keys"?{value:Oe.key,done:!1}:se=="values"?{value:Oe.value,done:!1}:{value:[Oe.key,Oe.value],done:!1}:(ce.target=void 0,{value:void 0,done:!0})},M?"entries":"values",!M,!0),Hi(A)}});var Ld=Mt([].join),Od=ul!=Object,Fd=Ar("join",",");D({target:"Array",proto:!0,forced:Od||!Fd},{join:function(_){return Ld(rs(this),_===void 0?",":_)}});var Dd=rr.map,Hv=Ai("map");D({target:"Array",proto:!0,forced:!Hv},{map:function(_){return Dd(this,_,arguments.length>1?arguments[1]:void 0)}});var Wv=Z(function(){Ho(1)});D({target:"Object",stat:!0,forced:Wv},{keys:function(_){return Ho(Ri(_))}});var cd=new Map,L0=new Map,u0=new Map,Lc=function(_){Ct(M,_);var A=Er(M);function M(){var O;return he(this,M),Xe(Yt(O=A.call(this)),"onabort",void 0),Xe(Yt(O),"onerror",void 0),Xe(Yt(O),"onload",void 0),Xe(Yt(O),"onloadstart",void 0),Xe(Yt(O),"onprogress",void 0),Xe(Yt(O),"ontimeout",void 0),Xe(Yt(O),"onloadend",void 0),Xe(Yt(O),"onreadystatechange",void 0),Xe(Yt(O),"readyState",void 0),Xe(Yt(O),"response",void 0),Xe(Yt(O),"responseText",void 0),Xe(Yt(O),"_responseType",void 0),Xe(Yt(O),"responseXML",void 0),Xe(Yt(O),"status",void 0),Xe(Yt(O),"statusText",void 0),Xe(Yt(O),"upload",void 0),Xe(Yt(O),"withCredentials",void 0),Xe(Yt(O),"timeout",void 0),Xe(Yt(O),"_url",void 0),Xe(Yt(O),"_method",void 0),O.onabort=null,O.onerror=null,O.onload=null,O.onloadstart=null,O.onprogress=null,O.ontimeout=null,O.onloadend=null,O.onreadystatechange=null,O.readyState=0,O.response=null,O.responseText=null,O._responseType="text",O.responseXML=null,O.status=0,O.statusText="",O.upload={},O.withCredentials=!1,cd.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),O}return Ae(M,[{key:"responseType",set:function(O){this._responseType=O}},{key:"abort",value:function(){var O=u0.get("requestTask");O&&O.abort()}},{key:"getAllResponseHeaders",value:function(){var O=L0.get("responseHeader");return Object.keys(O).map(function(N){return"".concat(N,": ").concat(O[N])}).join(`
`)}},{key:"getResponseHeader",value:function(O){return L0.get("responseHeader")[O]}},{key:"open",value:function(O,N,J){this._method=O,this._url=N}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(O,N){var J=cd.get("requestHeader");J[O]=N,cd.set("requestHeader",J)}},{key:"addEventListener",value:function(O,N){var J=this;typeof N=="function"&&(this["on"+O]=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ce.target=ce.target||J,N.call(J,ce)})}},{key:"removeEventListener",value:function(O,N){this["on"+O]===N&&(this["on"+O]=null)}}]),M}(ud);Xe(Lc,"UNSEND",void 0),Xe(Lc,"OPENED",void 0),Xe(Lc,"HEADERS_RECEIVED",void 0),Xe(Lc,"LOADING",void 0),Xe(Lc,"DONE",void 0),Lc.UNSEND=0,Lc.OPENED=1,Lc.HEADERS_RECEIVED=2,Lc.LOADING=3,Lc.DONE=4;var Pl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,up=typeof wx!="undefined"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),Bd=Pl||up;Bd||R.XMLHttpRequest,Bd||R.location;function fd(_){return[_+1&255,_+1>>8&255,_+1>>8>>8&255]}var O0=rr.filter,Nd=Ai("filter");function zd(_,A){var M=_.color;return M&&M.length?M:[1,1,1,1]}function l0(_,A,M){return M.length===2?[M[0],M[1],0]:[M[0],M[1],M[2]]}function Ud(_,A){return _.filter?[1]:[0]}function c0(_,A,M,O){return[A]}D({target:"Array",proto:!0,forced:!Nd},{filter:function(_){return O0(this,_,arguments.length>1?arguments[1]:void 0)}});var Ff=lp,il=lp;function lp(_,A,M){M=M||2;var O,N,J,ce,se,Oe,He,Ve=A&&A.length,Jt=Ve?A[0]*M:_.length,br=F0(_,0,Jt,M,!0),Dr=[];if(!br||br.next===br.prev)return Dr;if(Ve&&(br=function(On,An,zn,mn){var ni,gi,Wa,oo,Ya,qa=[];for(ni=0,gi=An.length;ni<gi;ni++)Wa=An[ni]*mn,oo=ni<gi-1?An[ni+1]*mn:On.length,(Ya=F0(On,Wa,oo,mn,!1))===Ya.next&&(Ya.steiner=!0),qa.push(X(Ya));for(qa.sort($v),ni=0;ni<qa.length;ni++)zn=Kv(qa[ni],zn);return zn}(_,A,br,M)),_.length>80*M){O=J=_[0],N=ce=_[1];for(var qr=M;qr<Jt;qr+=M)(se=_[qr])<O&&(O=se),(Oe=_[qr+1])<N&&(N=Oe),se>J&&(J=se),Oe>ce&&(ce=Oe);He=(He=Math.max(J-O,ce-N))!==0?32767/He:0}return Zp(br,Dr,M,O,N,He,0),Dr}function F0(_,A,M,O,N){var J,ce;if(N===dv(_,A,M,O)>0)for(J=A;J<M;J+=O)ce=tm(J,_[J],_[J+1],ce);else for(J=M-O;J>=A;J-=O)ce=tm(J,_[J],_[J+1],ce);return ce&&D0(ce,ce.next)&&(f0(ce),ce=ce.next),ce}function Rh(_,A){if(!_)return _;A||(A=_);var M,O=_;do if(M=!1,O.steiner||!D0(O,O.next)&&Rs(O.prev,O,O.next)!==0)O=O.next;else{if(f0(O),(O=A=O.prev)===O.next)break;M=!0}while(M||O!==A);return A}function Zp(_,A,M,O,N,J,ce){if(_){!ce&&J&&function(Ve,Jt,br,Dr){var qr=Ve;do qr.z===0&&(qr.z=of(qr.x,qr.y,Jt,br,Dr)),qr.prevZ=qr.prev,qr.nextZ=qr.next,qr=qr.next;while(qr!==Ve);qr.prevZ.nextZ=null,qr.prevZ=null,function(On){var An,zn,mn,ni,gi,Wa,oo,Ya,qa=1;do{for(zn=On,On=null,gi=null,Wa=0;zn;){for(Wa++,mn=zn,oo=0,An=0;An<qa&&(oo++,mn=mn.nextZ);An++);for(Ya=qa;oo>0||Ya>0&&mn;)oo!==0&&(Ya===0||!mn||zn.z<=mn.z)?(ni=zn,zn=zn.nextZ,oo--):(ni=mn,mn=mn.nextZ,Ya--),gi?gi.nextZ=ni:On=ni,ni.prevZ=gi,gi=ni;zn=mn}gi.nextZ=null,qa*=2}while(Wa>1)}(qr)}(_,O,N,J);for(var se,Oe,He=_;_.prev!==_.next;)if(se=_.prev,Oe=_.next,J?Xv(_,O,N,J):hv(_))A.push(se.i/M|0),A.push(_.i/M|0),A.push(Oe.i/M|0),f0(_),_=Oe.next,He=Oe.next;else if((_=Oe)===He){ce?ce===1?Zp(_=Yv(Rh(_),A,M),A,M,O,N,J,2):ce===2&&qv(_,A,M,O,N,J):Zp(Rh(_),A,M,O,N,J,1);break}}}function hv(_){var A=_.prev,M=_,O=_.next;if(Rs(A,M,O)>=0)return!1;for(var N=A.x,J=M.x,ce=O.x,se=A.y,Oe=M.y,He=O.y,Ve=N<J?N<ce?N:ce:J<ce?J:ce,Jt=se<Oe?se<He?se:He:Oe<He?Oe:He,br=N>J?N>ce?N:ce:J>ce?J:ce,Dr=se>Oe?se>He?se:He:Oe>He?Oe:He,qr=O.next;qr!==A;){if(qr.x>=Ve&&qr.x<=br&&qr.y>=Jt&&qr.y<=Dr&&cp(N,se,J,Oe,ce,He,qr.x,qr.y)&&Rs(qr.prev,qr,qr.next)>=0)return!1;qr=qr.next}return!0}function Xv(_,A,M,O){var N=_.prev,J=_,ce=_.next;if(Rs(N,J,ce)>=0)return!1;for(var se=N.x,Oe=J.x,He=ce.x,Ve=N.y,Jt=J.y,br=ce.y,Dr=se<Oe?se<He?se:He:Oe<He?Oe:He,qr=Ve<Jt?Ve<br?Ve:br:Jt<br?Jt:br,On=se>Oe?se>He?se:He:Oe>He?Oe:He,An=Ve>Jt?Ve>br?Ve:br:Jt>br?Jt:br,zn=of(Dr,qr,A,M,O),mn=of(On,An,A,M,O),ni=_.prevZ,gi=_.nextZ;ni&&ni.z>=zn&&gi&&gi.z<=mn;){if(ni.x>=Dr&&ni.x<=On&&ni.y>=qr&&ni.y<=An&&ni!==N&&ni!==ce&&cp(se,Ve,Oe,Jt,He,br,ni.x,ni.y)&&Rs(ni.prev,ni,ni.next)>=0||(ni=ni.prevZ,gi.x>=Dr&&gi.x<=On&&gi.y>=qr&&gi.y<=An&&gi!==N&&gi!==ce&&cp(se,Ve,Oe,Jt,He,br,gi.x,gi.y)&&Rs(gi.prev,gi,gi.next)>=0))return!1;gi=gi.nextZ}for(;ni&&ni.z>=zn;){if(ni.x>=Dr&&ni.x<=On&&ni.y>=qr&&ni.y<=An&&ni!==N&&ni!==ce&&cp(se,Ve,Oe,Jt,He,br,ni.x,ni.y)&&Rs(ni.prev,ni,ni.next)>=0)return!1;ni=ni.prevZ}for(;gi&&gi.z<=mn;){if(gi.x>=Dr&&gi.x<=On&&gi.y>=qr&&gi.y<=An&&gi!==N&&gi!==ce&&cp(se,Ve,Oe,Jt,He,br,gi.x,gi.y)&&Rs(gi.prev,gi,gi.next)>=0)return!1;gi=gi.nextZ}return!0}function Yv(_,A,M){var O=_;do{var N=O.prev,J=O.next.next;!D0(N,J)&&Jv(N,O,O.next,J)&&Lh(N,J)&&Lh(J,N)&&(A.push(N.i/M|0),A.push(O.i/M|0),A.push(J.i/M|0),f0(O),f0(O.next),O=_=J),O=O.next}while(O!==_);return Rh(O)}function qv(_,A,M,O,N,J){var ce=_;do{for(var se=ce.next.next;se!==ce.prev;){if(ce.i!==se.i&&hd(ce,se)){var Oe=em(ce,se);return ce=Rh(ce,ce.next),Oe=Rh(Oe,Oe.next),Zp(ce,A,M,O,N,J,0),void Zp(Oe,A,M,O,N,J,0)}se=se.next}ce=ce.next}while(ce!==_)}function $v(_,A){return _.x-A.x}function Kv(_,A){var M=function(N,J){var ce,se=J,Oe=N.x,He=N.y,Ve=-1/0;do{if(He<=se.y&&He>=se.next.y&&se.next.y!==se.y){var Jt=se.x+(He-se.y)*(se.next.x-se.x)/(se.next.y-se.y);if(Jt<=Oe&&Jt>Ve&&(Ve=Jt,ce=se.x<se.next.x?se:se.next,Jt===Oe))return ce}se=se.next}while(se!==J);if(!ce)return null;var br,Dr=ce,qr=ce.x,On=ce.y,An=1/0;se=ce;do Oe>=se.x&&se.x>=qr&&Oe!==se.x&&cp(He<On?Oe:Ve,He,qr,On,He<On?Ve:Oe,He,se.x,se.y)&&(br=Math.abs(He-se.y)/(Oe-se.x),Lh(se,N)&&(br<An||br===An&&(se.x>ce.x||se.x===ce.x&&Qv(ce,se)))&&(ce=se,An=br)),se=se.next;while(se!==Dr);return ce}(_,A);if(!M)return A;var O=em(M,_);return Rh(O,O.next),Rh(M,M.next)}function Qv(_,A){return Rs(_.prev,_,A.prev)<0&&Rs(A.next,_,_.next)<0}function of(_,A,M,O,N){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-M)*N|0)|_<<8))|_<<4))|_<<2))|_<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-O)*N|0)|A<<8))|A<<4))|A<<2))|A<<1))<<1}function X(_){var A=_,M=_;do(A.x<M.x||A.x===M.x&&A.y<M.y)&&(M=A),A=A.next;while(A!==_);return M}function cp(_,A,M,O,N,J,ce,se){return(N-ce)*(A-se)>=(_-ce)*(J-se)&&(_-ce)*(O-se)>=(M-ce)*(A-se)&&(M-ce)*(J-se)>=(N-ce)*(O-se)}function hd(_,A){return _.next.i!==A.i&&_.prev.i!==A.i&&!function(M,O){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==O.i&&N.next.i!==O.i&&Jv(N,N.next,M,O))return!0;N=N.next}while(N!==M);return!1}(_,A)&&(Lh(_,A)&&Lh(A,_)&&function(M,O){var N=M,J=!1,ce=(M.x+O.x)/2,se=(M.y+O.y)/2;do N.y>se!=N.next.y>se&&N.next.y!==N.y&&ce<(N.next.x-N.x)*(se-N.y)/(N.next.y-N.y)+N.x&&(J=!J),N=N.next;while(N!==M);return J}(_,A)&&(Rs(_.prev,_,A.prev)||Rs(_,A.prev,A))||D0(_,A)&&Rs(_.prev,_,_.next)>0&&Rs(A.prev,A,A.next)>0)}function Rs(_,A,M){return(A.y-_.y)*(M.x-A.x)-(A.x-_.x)*(M.y-A.y)}function D0(_,A){return _.x===A.x&&_.y===A.y}function Jv(_,A,M,O){var N=N0(Rs(_,A,M)),J=N0(Rs(_,A,O)),ce=N0(Rs(M,O,_)),se=N0(Rs(M,O,A));return N!==J&&ce!==se||!(N!==0||!B0(_,M,A))||!(J!==0||!B0(_,O,A))||!(ce!==0||!B0(M,_,O))||!(se!==0||!B0(M,A,O))}function B0(_,A,M){return A.x<=Math.max(_.x,M.x)&&A.x>=Math.min(_.x,M.x)&&A.y<=Math.max(_.y,M.y)&&A.y>=Math.min(_.y,M.y)}function N0(_){return _>0?1:_<0?-1:0}function Lh(_,A){return Rs(_.prev,_,_.next)<0?Rs(_,A,_.next)>=0&&Rs(_,_.prev,A)>=0:Rs(_,A,_.prev)<0||Rs(_,_.next,A)<0}function em(_,A){var M=new pv(_.i,_.x,_.y),O=new pv(A.i,A.x,A.y),N=_.next,J=A.prev;return _.next=A,A.prev=_,M.next=N,N.prev=M,O.next=M,M.prev=O,J.next=O,O.prev=J,O}function tm(_,A,M,O){var N=new pv(_,A,M);return O?(N.next=O.next,N.prev=O,O.next.prev=N,O.next=N):(N.prev=N,N.next=N),N}function f0(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function pv(_,A,M){this.i=_,this.x=A,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dv(_,A,M,O){for(var N=0,J=A,ce=M-O;J<M;J+=O)N+=(_[ce]-_[J])*(_[J+1]+_[ce+1]),ce=J;return N}lp.deviation=function(_,A,M,O){var N=A&&A.length,J=N?A[0]*M:_.length,ce=Math.abs(dv(_,0,J,M));if(N)for(var se=0,Oe=A.length;se<Oe;se++){var He=A[se]*M,Ve=se<Oe-1?A[se+1]*M:_.length;ce-=Math.abs(dv(_,He,Ve,M))}var Jt=0;for(se=0;se<O.length;se+=3){var br=O[se]*M,Dr=O[se+1]*M,qr=O[se+2]*M;Jt+=Math.abs((_[br]-_[qr])*(_[Dr+1]-_[br+1])-(_[br]-_[Dr])*(_[qr+1]-_[br+1]))}return ce===0&&Jt===0?0:Math.abs((Jt-ce)/ce)},lp.flatten=function(_){for(var A=_[0][0].length,M={vertices:[],holes:[],dimensions:A},O=0,N=0;N<_.length;N++){for(var J=0;J<_[N].length;J++)for(var ce=0;ce<A;ce++)M.vertices.push(_[N][J][ce]);N>0&&(O+=_[N-1].length,M.holes.push(O))}return M},Ff.default=il;var Om=Mt(1 .valueOf),Fm=Mt("".replace),z0=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,Dm=RegExp("^"+z0+z0+"*"),Bm=RegExp(z0+z0+"*$"),vv=function(_){return function(A){var M=tu(Xn(A));return 1&_&&(M=Fm(M,Dm,"")),2&_&&(M=Fm(M,Bm,"")),M}},Nm={start:vv(1),end:vv(2),trim:vv(3)},U0=za.f,zm=De.f,Um=wn.f,Zm=Nm.trim,pd=Ue.Number,rm=pd.prototype,Vm=Ue.TypeError,Vg=Mt("".slice),Oh=Mt("".charCodeAt),jg=function(_){var A=Zr(_,"number");return typeof A=="bigint"?A:Gg(A)},Gg=function(_){var A,M,O,N,J,ce,se,Oe,He=Zr(_,"number");if(ie(He))throw Vm("Cannot convert a Symbol value to a number");if(typeof He=="string"&&He.length>2){if(He=Zm(He),(A=Oh(He,0))===43||A===45){if((M=Oh(He,2))===88||M===120)return NaN}else if(A===48){switch(Oh(He,1)){case 66:case 98:O=2,N=49;break;case 79:case 111:O=8,N=55;break;default:return+He}for(ce=(J=Vg(He,2)).length,se=0;se<ce;se++)if((Oe=Oh(J,se))<48||Oe>N)return NaN;return parseInt(J,O)}}return+He};if(k("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var mv,h0=function(_){var A=arguments.length<1?0:pd(jg(_)),M=this;return ha(rm,M)&&Z(function(){Om(M)})?ho(Object(A),M,h0):A},jm=xr?U0(pd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),Zd=0;jm.length>Zd;Zd++)ln(pd,mv=jm[Zd])&&!ln(h0,mv)&&Um(h0,mv,zm(pd,mv));h0.prototype=rm,rm.constructor=h0,Oa(Ue,"Number",h0,{constructor:!0})}var Gm=RangeError,Hm=RangeError,nm=String,gv=Math.floor,yv=Mt(function(_){var A=tu(Xn(this)),M="",O=Qn(_);if(O<0||O==1/0)throw Gm("Wrong number of repetitions");for(;O>0;(O>>>=1)&&(A+=A))1&O&&(M+=A);return M}),Hg=Mt("".slice),Z0=Mt(1 .toFixed),p0=function(_,A,M){return A===0?M:A%2==1?p0(_,A-1,M*_):p0(_*_,A/2,M)},Vd=function(_,A,M){for(var O=-1,N=M;++O<6;)N+=A*_[O],_[O]=N%1e7,N=gv(N/1e7)},im=function(_,A){for(var M=6,O=0;--M>=0;)O+=_[M],_[M]=gv(O/A),O=O%A*1e7},am=function(_){for(var A=6,M="";--A>=0;)if(M!==""||A===0||_[A]!==0){var O=nm(_[A]);M=M===""?O:M+yv("0",7-O.length)+O}return M},Wm=Z(function(){return Z0(8e-5,3)!=="0.000"||Z0(.9,0)!=="1"||Z0(1.255,2)!=="1.25"||Z0(1000000000000000100,0)!=="1000000000000000128"})||!Z(function(){Z0({})});function _v(_){return typeof _=="number"}function Vp(_){var A=Math.max(Math.min(85.0511287798,_[1]),-85.0511287798),M=Math.PI/180,O=_[0]*M,N=A*M;return N=Math.log(Math.tan(Math.PI/4+N/2)),O=(256<<20)*(.5/Math.PI*O+.5),N=(256<<20)*(-.5/Math.PI*N+(M=.5)),[Math.floor(O),Math.floor(N)]}D({target:"Number",proto:!0,forced:Wm},{toFixed:function(_){var A,M,O,N,J=Om(this),ce=Qn(_),se=[0,0,0,0,0,0],Oe="",He="0";if(ce<0||ce>20)throw Hm("Incorrect fraction digits");if(J!=J)return"NaN";if(J<=-1e21||J>=1e21)return nm(J);if(J<0&&(Oe="-",J=-J),J>1e-21)if(M=(A=function(Ve){for(var Jt=0,br=Ve;br>=4096;)Jt+=12,br/=4096;for(;br>=2;)Jt+=1,br/=2;return Jt}(J*p0(2,69,1))-69)<0?J*p0(2,-A,1):J/p0(2,A,1),M*=4503599627370496,(A=52-A)>0){for(Vd(se,0,M),O=ce;O>=7;)Vd(se,1e7,0),O-=7;for(Vd(se,p0(10,O,1),0),O=A-1;O>=23;)im(se,1<<23),O-=23;im(se,1<<O),Vd(se,1,1),im(se,2),He=am(se)}else Vd(se,0,M),Vd(se,1<<-A,0),He=am(se)+yv("0",ce);return He=ce>0?Oe+((N=He.length)<=ce?"0."+yv("0",ce-N)+He:Hg(He,0,N-ce)+"."+Hg(He,N-ce)):Oe+He}});var om,Xm=/"/g,Ym=Mt("".replace);D({target:"String",proto:!0,forced:(om="sub",Z(function(){var _=""[om]('"');return _!==_.toLowerCase()||_.split('"').length>3}))},{sub:function(){return _="sub",A="",M="",O=tu(Xn(this)),N="<"+_,A!==""&&(N+=" "+A+'="'+Ym(tu(M),Xm,"&quot;")+'"'),N+">"+O+"</"+_+">";var _,A,M,O,N}});var sm=RegExp.prototype,qm=Mn.PROPER,um=RegExp.prototype.toString,$m=Z(function(){return um.call({source:"a",flags:"b"})!="/a/b"}),Km=qm&&um.name!="toString";($m||Km)&&Oa(RegExp.prototype,"toString",function(){var _=oa(this);return"/"+tu(_.source)+"/"+tu(function(A){var M=A.flags;return M!==void 0||"flags"in sm||ln(A,"flags")||!ha(sm,A)?M:Si(Gs,A)}(_))},{unsafe:!0});var xv=typeof Float32Array!="undefined"?Float32Array:Array;function ju(){var _=new xv(2);return xv!=Float32Array&&(_[0]=0,_[1]=0),_}function bv(_,A){var M=new xv(2);return M[0]=_,M[1]=A,M}function d0(_,A){return _[0]=A[0],_[1]=A[1],_}function Fh(_,A,M){return _[0]=A[0]+M[0],_[1]=A[1]+M[1],_}function al(_,A,M){return _[0]=A[0]-M[0],_[1]=A[1]-M[1],_}function v0(_,A){var M=A[0],O=A[1],N=M*M+O*O;return N>0&&(N=1/Math.sqrt(N)),_[0]=A[0]*N,_[1]=A[1]*N,_}function V0(_,A){return _[0]*A[0]+_[1]*A[1]}Math.hypot||(Math.hypot=function(){for(var _=0,A=arguments.length;A--;)_+=arguments[A]*arguments[A];return Math.sqrt(_)});var Qm,Ev=al,j0=(Qm=ju(),ju()),Gu=(ju(),ju()),jp=ju(),jd=ju();function Cv(_,A,M,O,N){return Fh(_,M,O),v0(_,_),[N/V0(A=bv(-_[1],_[0]),bv(-M[1],M[0])),A]}function Gp(_,A){return function(M,O,N){return M[0]=O,M[1]=N,M}(_,-A[1],A[0])}function Gd(_,A,M){return Ev(_,A,M),v0(_,_),_}function Sv(_,A){return _[0]===A[0]&&_[1]===A[1]}var Jm=function(){function _(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};he(this,_),Xe(this,"complex",void 0),Xe(this,"join",void 0),Xe(this,"cap",void 0),Xe(this,"miterLimit",void 0),Xe(this,"thickness",void 0),Xe(this,"normal",void 0),Xe(this,"lastFlip",-1),Xe(this,"miter",bv(0,0)),Xe(this,"started",!1),Xe(this,"dash",!1),Xe(this,"totalDistance",0),Xe(this,"currentIndex",0),this.join=A.join||"miter",this.cap=A.cap||"butt",this.miterLimit=A.miterLimit||10,this.thickness=A.thickness||1,this.dash=A.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Ae(_,[{key:"extrude_gaode2",value:function(A,M){var O=this.complex;if(A.length<=1)return O;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=A.length,J=O.startIndex,ce=1;ce<N;ce++){var se,Oe,He,Ve=A[ce-1];Ve.push((se=M[ce-1][2])!==null&&se!==void 0?se:0);var Jt=M[ce-1],br=A[ce];br.push((Oe=M[ce][2])!==null&&Oe!==void 0?Oe:0);var Dr=M[ce],qr=ce<A.length-1?[].concat(Rt(A[ce+1]),[(He=M[ce+1][2])!==null&&He!==void 0?He:0]):null,On=ce<M.length-1?M[ce+1]:null;J+=this.segment_gaode2(O,J,Ve,br,qr,Jt,Dr,On)}if(this.dash)for(var An=0;An<O.positions.length/6;An++)O.positions[6*An+5]=this.totalDistance;return O.startIndex=O.positions.length/6,O}},{key:"simpleExtrude_gaode2",value:function(A,M){var O=this.complex;if(A.length<=1)return O;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=A.length,J=O.startIndex,ce=1;ce<N;ce++){var se,Oe,He,Ve=A[ce-1];Ve.push((se=M[ce-1][2])!==null&&se!==void 0?se:0);var Jt=M[ce-1],br=A[ce];br.push((Oe=M[ce][2])!==null&&Oe!==void 0?Oe:0);var Dr=M[ce],qr=ce<A.length-1?[].concat(Rt(A[ce+1]),[(He=M[ce+1][2])!==null&&He!==void 0?He:0]):null,On=ce<M.length-1?M[ce+1]:null;J+=this.simpleSegment(O,J,Ve,br,qr,Jt,Dr,On)}if(this.dash)for(var An=0;An<O.positions.length/6;An++)O.positions[6*An+5]=this.totalDistance;return O.startIndex=O.positions.length/6,O}},{key:"extrude",value:function(A){var M=this.complex;if(A.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var O=A.length,N=M.startIndex,J=1;J<O;J++){var ce=A[J-1],se=A[J],Oe=J<A.length-1?A[J+1]:null;N+=this.segment(M,N,ce,se,Oe)}if(this.dash)for(var He=0;He<M.positions.length/6;He++)M.positions[6*He+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"simpleExtrude",value:function(A){var M=this.complex;if(A.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var O=A.length,N=M.startIndex,J=1;J<O;J++){var ce=A[J-1],se=A[J],Oe=J<A.length-1?A[J+1]:null;N+=this.simpleSegment(M,N,ce,se,Oe)}if(this.dash)for(var He=0;He<M.positions.length/6;He++)M.positions[6*He+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"segment_gaode2",value:function(A,M,O,N,J,ce,se,Oe){var He=0,Ve=A.indices,Jt=A.positions,br=A.normals,Dr=this.cap==="square",qr=this.join==="bevel",On=Vp([se[0],se[1]]),An=Vp([ce[0],ce[1]]);Gd(Gu,N,O);var zn=0;if(this.dash&&(zn=this.lineSegmentDistance(On,An),this.totalDistance+=zn),this.normal||(this.normal=ju(),Gp(this.normal,Gu)),!this.started)if(this.started=!0,Dr){var mn=ju(),ni=ju();Fh(mn,this.normal,Gu),Fh(ni,this.normal,Gu),br.push(ni[0],ni[1],0),br.push(mn[0],mn[1],0),Jt.push(O[0],O[1],0|O[2],this.totalDistance-zn,-this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),Jt.push(O[0],O[1],0|O[2],this.totalDistance-zn,this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Jt,br,O,this.normal,this.thickness,this.totalDistance-zn);if(Ve.push(M+0,M+1,M+2),J){Sv(N,J)&&Fh(J,N,v0(J,al(J,N,O))),Gd(jp,J,N);var gi=cr(Cv(jd,ju(),Gu,jp,this.thickness),2),Wa=gi[0],oo=gi[1],Ya=V0(jd,this.normal)<0?-1:1,qa=qr;!qa&&this.join==="miter"&&Wa>this.miterLimit&&(qa=!0),qa?(br.push(this.normal[0],this.normal[1],0),br.push(oo[0],oo[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Ya,0|N[2]),this.complex.indexes.push(this.currentIndex),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*Ya,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Ve.push.apply(Ve,Rt(this.lastFlip!==-Ya?[M,M+2,M+3]:[M+2,M+1,M+3])),Ve.push(M+2,M+3,M+4),Gp(j0,jp),d0(this.normal,j0),br.push(this.normal[0],this.normal[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Ya,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,He+=3):(this.extrusions(Jt,br,N,oo,Wa,this.totalDistance),Ve.push.apply(Ve,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Ya=-1,d0(this.normal,oo),He+=2),this.lastFlip=Ya}else{if(Gp(this.normal,Gu),Dr){var so=ju(),Qr=ju();Ev(Qr,Gu,this.normal),Fh(so,Gu,this.normal),br.push(Qr[0],Qr[1],0),br.push(so[0],so[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Jt,br,N,this.normal,this.thickness,this.totalDistance);Ve.push.apply(Ve,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),He+=2}return He}},{key:"simpleSegment",value:function(A,M,O,N,J){var ce=0,se=A.indices,Oe=A.positions,He=A.normals,Ve=Vp([N[0],N[1]]),Jt=Vp([O[0],O[1]]);Gd(Gu,Ve,Jt);var br=0;if(this.dash&&(br=this.lineSegmentDistance(Ve,Jt),this.totalDistance+=br),this.normal||(this.normal=ju(),Gp(this.normal,Gu)),this.started||(this.started=!0,this.extrusions(Oe,He,O,this.normal,this.thickness,this.totalDistance-br)),se.push(M+0,M+1,M+2),J){var Dr=Vp([J[0],J[1]]);Sv(Ve,Dr)&&Fh(Dr,Ve,v0(Dr,al(Dr,Ve,Jt))),Gd(jp,Dr,Ve);var qr=cr(Cv(jd,ju(),Gu,jp,this.thickness),2),On=qr[0],An=qr[1];V0(jd,this.normal),this.extrusions(Oe,He,N,An,On,this.totalDistance),se.push.apply(se,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),d0(this.normal,An),ce+=2,this.lastFlip=-1}else Gp(this.normal,Gu),this.extrusions(Oe,He,N,this.normal,this.thickness,this.totalDistance),se.push.apply(se,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ce+=2;return ce}},{key:"segment",value:function(A,M,O,N,J){var ce=0,se=A.indices,Oe=A.positions,He=A.normals,Ve=this.cap==="square",Jt=this.join==="bevel",br=Vp([N[0],N[1]]),Dr=Vp([O[0],O[1]]);Gd(Gu,br,Dr);var qr=0;if(this.dash&&(qr=this.lineSegmentDistance(br,Dr),this.totalDistance+=qr),this.normal||(this.normal=ju(),Gp(this.normal,Gu)),!this.started)if(this.started=!0,Ve){var On=ju(),An=ju();Fh(On,this.normal,Gu),Fh(An,this.normal,Gu),He.push(An[0],An[1],0),He.push(On[0],On[1],0),Oe.push(O[0],O[1],0|O[2],this.totalDistance-qr,-this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),Oe.push(O[0],O[1],0|O[2],this.totalDistance-qr,this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Oe,He,O,this.normal,this.thickness,this.totalDistance-qr);if(se.push(M+0,M+1,M+2),J){var zn=Vp([J[0],J[1]]);Sv(br,zn)&&Fh(zn,br,v0(zn,al(zn,br,Dr))),Gd(jp,zn,br);var mn=cr(Cv(jd,ju(),Gu,jp,this.thickness),2),ni=mn[0],gi=mn[1],Wa=V0(jd,this.normal)<0?-1:1,oo=Jt;!oo&&this.join==="miter"&&ni>this.miterLimit&&(oo=!0),oo?(He.push(this.normal[0],this.normal[1],0),He.push(gi[0],gi[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Wa,0|N[2]),this.complex.indexes.push(this.currentIndex),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*Wa,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,se.push.apply(se,Rt(this.lastFlip!==-Wa?[M,M+2,M+3]:[M+2,M+1,M+3])),se.push(M+2,M+3,M+4),Gp(j0,jp),d0(this.normal,j0),He.push(this.normal[0],this.normal[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Wa,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,ce+=3):(this.extrusions(Oe,He,N,gi,ni,this.totalDistance),se.push.apply(se,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Wa=-1,d0(this.normal,gi),ce+=2),this.lastFlip=Wa}else{if(Gp(this.normal,Gu),Ve){var Ya=ju(),qa=ju();Ev(qa,Gu,this.normal),Fh(Ya,Gu,this.normal),He.push(qa[0],qa[1],0),He.push(Ya[0],Ya[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Oe,He,N,this.normal,this.thickness,this.totalDistance);se.push.apply(se,Rt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ce+=2}return ce}},{key:"extrusions",value:function(A,M,O,N,J,ce){M.push(N[0],N[1],0),M.push(N[0],N[1],0),A.push(O[0],O[1],0|O[2],ce,-J,0|O[2]),this.complex.indexes.push(this.currentIndex),A.push(O[0],O[1],0|O[2],ce,J,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(A,M){var O=M[0]-A[0],N=M[1]-A[1];return Math.sqrt(O*O+N*N)}}]),_}();function eg(_){var A=_.coordinates,M=_.originCoordinates,O=_.version,N=new Jm({dash:!0,join:"bevel"});if(O==="GAODE2.x"){var J=A;Array.isArray(J[0][0])||(J=[A]);var ce=M;Array.isArray(ce[0][0])||(ce=[M]);for(var se=0;se<J.length;se++){var Oe=J[se],He=ce[se];N.extrude_gaode2(Oe,He)}}else{var Ve=A;Ve[0]&&!Array.isArray(Ve[0][0])&&(Ve=[A]),Ve.forEach(function(br){N.extrude(br)})}var Jt=N.complex;return{vertices:Jt.positions,indices:Jt.indices,normals:Jt.normals,indexes:Jt.indexes,size:6}}function tg(_){var A=function(M){if(_v(M[0]))return M;if(_v(M[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(_v(M[0][0][0])){var O=0,N=0,J=0;return M.forEach(function(ce){ce.forEach(function(se){O+=se[0],N+=se[1],J++})}),[O/J,N/J,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(_.coordinates);return{vertices:[].concat(Rt(A),Rt(A),Rt(A),Rt(A)),indices:[0,1,2,2,3,0],size:A.length}}function Wg(_){var A=_.coordinates,M=Ff.flatten(A),O=M.vertices,N=M.dimensions,J=M.holes;return{indices:Ff(O,J,N),vertices:O,size:N}}var Xg=function(){var _=ke(Be().mark(function A(M){var O,N,J,ce,se,Oe,He,Ve,Jt;return Be().wrap(function(br){for(;;)switch(br.prev=br.next){case 0:return O=M.descriptors,N=M.features,J=M.enablePicking,ce=M.iconMap,se={a_Color:zd,a_Position:l0,filter:Ud,a_vertexId:c0,a_PickingColor:function(Dr,qr){var On=Dr.id;return J?fd(On):[0,0,0]},a_DistanceAndIndex:function(Dr,qr,On,An,zn,mn){return mn===void 0?[On[3],10]:[On[3],mn]},a_Total_Distance:function(Dr,qr,On,An){return[On[5]]},a_Size:function(Dr,qr,On,An){var zn=Dr.size,mn=zn===void 0?1:zn;return Array.isArray(mn)?[mn[0],mn[1]]:[mn,0]},a_Normal:function(Dr,qr,On,An,zn){return zn},a_Miter:function(Dr,qr,On,An){return[On[4]]},a_iconMapUV:function(Dr,qr,On,An){var zn=Dr.texture,mn=ce[zn]||{x:0,y:0};return[mn.x,mn.y]}},Oe={sizePerElement:0,elements:[]},He=0,Ve=[],Jt=3,N.forEach(function(Dr,qr){var On=eg(Dr),An=On.indices,zn=On.vertices,mn=On.normals,ni=On.size,gi=On.indexes;An.forEach(function(qa){Ve.push(qa+He)}),Jt=ni;var Wa=zn.length/ni;Oe.sizePerElement=Jt,Oe.elements.push({featureIdx:qr,vertices:zn,normals:mn,offset:He}),He+=Wa;for(var oo=function(qa){var so=(mn==null?void 0:mn.slice(3*qa,3*qa+3))||[],Qr=zn.slice(qa*ni,qa*ni+ni),fn=0;gi&&gi[qa]!==void 0&&(fn=gi[qa]),O.forEach(function(Zi,$a){var _a;Zi&&se[Zi.name]&&(_a=Zi.buffer.data).push.apply(_a,Rt(se[Zi.name](Dr,qr,Qr,qa,so,fn)))})},Ya=0;Ya<Wa;Ya++)oo(Ya)}),br.abrupt("return",{descriptors:O,featureLayout:Oe,indices:Ve});case 8:case"end":return br.stop()}},A)}));return function(A){return _.apply(this,arguments)}}(),rg={pointFill:function(){var _=ke(Be().mark(function A(M){var O,N,J,ce,se,Oe,He,Ve,Jt;return Be().wrap(function(br){for(;;)switch(br.prev=br.next){case 0:return O=M.descriptors,N=M.features,J=M.enablePicking,ce=M.shape2d,se={a_Color:zd,a_Position:l0,filter:Ud,a_vertexId:c0,a_PickingColor:function(Dr,qr){var On=Dr.id;return J?fd(On):[0,0,0]},a_Shape:function(Dr,qr,On,An){var zn=Dr.shape,mn=zn===void 0?2:zn;return[ce.indexOf(mn)]},a_Extrude:function(Dr,qr,On,An){var zn=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],mn=An%4*3;return[zn[mn],zn[mn+1],zn[mn+2]]},a_Size:function(Dr,qr,On,An){var zn=Dr.size,mn=zn===void 0?5:zn;return Array.isArray(mn)?[mn[0]]:[mn]}},Oe={sizePerElement:0,elements:[]},He=0,Ve=[],Jt=3,N.forEach(function(Dr,qr){var On=tg(Dr),An=On.indices,zn=On.vertices,mn=On.normals,ni=On.size;An.forEach(function(Ya){Ve.push(Ya+He)}),Jt=ni;var gi=zn.length/ni;Oe.sizePerElement=Jt,Oe.elements.push({featureIdx:qr,vertices:zn,normals:mn,offset:He}),He+=gi;for(var Wa=function(Ya){var qa=[],so=zn.slice(Ya*ni,Ya*ni+ni);O.forEach(function(Qr,fn){var Zi;Qr&&se[Qr.name]&&(Zi=Qr.buffer.data).push.apply(Zi,Rt(se[Qr.name](Dr,qr,so,Ya,qa,0)))})},oo=0;oo<gi;oo++)Wa(oo)}),br.abrupt("return",{descriptors:O,featureLayout:Oe,indices:Ve});case 8:case"end":return br.stop()}},A)}));return function(A){return _.apply(this,arguments)}}(),line:Xg,polygonFill:function(){var _=ke(Be().mark(function A(M){var O,N,J,ce,se,Oe,He,Ve;return Be().wrap(function(Jt){for(;;)switch(Jt.prev=Jt.next){case 0:return O=M.descriptors,N=M.features,J=M.enablePicking,ce={a_Color:zd,a_Position:l0,filter:Ud,a_vertexId:c0,a_PickingColor:function(br,Dr){var qr=br.id;return J?fd(qr):[0,0,0]}},se={sizePerElement:0,elements:[]},Oe=0,He=[],Ve=3,N.forEach(function(br,Dr){var qr=Wg(br),On=qr.indices,An=qr.vertices,zn=qr.normals,mn=qr.size;On.forEach(function(oo){He.push(oo+Oe)}),Ve=mn;var ni=An.length/mn;se.sizePerElement=Ve,se.elements.push({featureIdx:Dr,vertices:An,normals:zn,offset:Oe}),Oe+=ni;for(var gi=function(oo){var Ya=[],qa=An.slice(oo*mn,oo*mn+mn);O.forEach(function(so,Qr){var fn;so&&ce[so.name]&&(fn=so.buffer.data).push.apply(fn,Rt(ce[so.name](br,Dr,qa,oo,Ya,0)))})},Wa=0;Wa<ni;Wa++)gi(Wa)}),Jt.abrupt("return",{descriptors:O,featureLayout:se,indices:He});case 8:case"end":return Jt.stop()}},A)}));return function(A){return _.apply(this,arguments)}}()},ng=function(_){for(var A=1;A<arguments.length;A++){var M=arguments[A]!=null?arguments[A]:{};A%2?y(Object(M),!0).forEach(function(O){Xe(_,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(M)):y(Object(M)).forEach(function(O){Object.defineProperty(_,O,Object.getOwnPropertyDescriptor(M,O))})}return _}({},rg);function ig(_){return lm.apply(this,arguments)}function lm(){return(lm=ke(Be().mark(function _(A){var M,O;return Be().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(M=A.workerType,O=A.data,!ng[M]){N.next=3;break}return N.abrupt("return",ng[M](O));case 3:return N.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(M,'" non-existent.'))));case 4:case"end":return N.stop()}},_)}))).apply(this,arguments)}return te(ig),de.WorkerSourceMap=rg,de.createWorker=te,de.worker=ig,de}({})},66213:function(pi,Se,fe){"use strict";fe.d(Se,{Z:function(){return y}});var We=fe(77608);function de(Be,K){for(;!Object.prototype.hasOwnProperty.call(Be,K)&&(Be=(0,We.Z)(Be),Be!==null););return Be}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(K,ke,he){var ut=de(K,ke);if(!!ut){var Ae=Object.getOwnPropertyDescriptor(ut,ke);return Ae.get?Ae.get.call(arguments.length<3?K:he):Ae.value}},y.apply(this,arguments)}},38163:function(pi){pi.exports=Se;function Se(de,y){var Be=de&&de.type,K;if(Be==="FeatureCollection")for(K=0;K<de.features.length;K++)Se(de.features[K],y);else if(Be==="GeometryCollection")for(K=0;K<de.geometries.length;K++)Se(de.geometries[K],y);else if(Be==="Feature")Se(de.geometry,y);else if(Be==="Polygon")fe(de.coordinates,y);else if(Be==="MultiPolygon")for(K=0;K<de.coordinates.length;K++)fe(de.coordinates[K],y);return de}function fe(de,y){if(de.length!==0){We(de[0],y);for(var Be=1;Be<de.length;Be++)We(de[Be],!y)}}function We(de,y){for(var Be=0,K=0,ke=0,he=de.length,ut=he-1;ke<he;ut=ke++){var Ae=(de[ke][0]-de[ut][0])*(de[ut][1]+de[ke][1]),Xe=Be+Ae;K+=Math.abs(Be)>=Math.abs(Ae)?Be-Xe+Ae:Ae-Xe+Be,Be=Xe}Be+K>=0!=!!y&&de.reverse()}},75550:function(pi){"use strict";pi.exports=Se;function Se(fe,We){this.x=fe,this.y=We}Se.prototype={clone:function(){return new Se(this.x,this.y)},add:function(fe){return this.clone()._add(fe)},sub:function(fe){return this.clone()._sub(fe)},multByPoint:function(fe){return this.clone()._multByPoint(fe)},divByPoint:function(fe){return this.clone()._divByPoint(fe)},mult:function(fe){return this.clone()._mult(fe)},div:function(fe){return this.clone()._div(fe)},rotate:function(fe){return this.clone()._rotate(fe)},rotateAround:function(fe,We){return this.clone()._rotateAround(fe,We)},matMult:function(fe){return this.clone()._matMult(fe)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(fe){return this.x===fe.x&&this.y===fe.y},dist:function(fe){return Math.sqrt(this.distSqr(fe))},distSqr:function(fe){var We=fe.x-this.x,de=fe.y-this.y;return We*We+de*de},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(fe){return Math.atan2(this.y-fe.y,this.x-fe.x)},angleWith:function(fe){return this.angleWithSep(fe.x,fe.y)},angleWithSep:function(fe,We){return Math.atan2(this.x*We-this.y*fe,this.x*fe+this.y*We)},_matMult:function(fe){var We=fe[0]*this.x+fe[1]*this.y,de=fe[2]*this.x+fe[3]*this.y;return this.x=We,this.y=de,this},_add:function(fe){return this.x+=fe.x,this.y+=fe.y,this},_sub:function(fe){return this.x-=fe.x,this.y-=fe.y,this},_mult:function(fe){return this.x*=fe,this.y*=fe,this},_div:function(fe){return this.x/=fe,this.y/=fe,this},_multByPoint:function(fe){return this.x*=fe.x,this.y*=fe.y,this},_divByPoint:function(fe){return this.x/=fe.x,this.y/=fe.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var fe=this.y;return this.y=this.x,this.x=-fe,this},_rotate:function(fe){var We=Math.cos(fe),de=Math.sin(fe),y=We*this.x-de*this.y,Be=de*this.x+We*this.y;return this.x=y,this.y=Be,this},_rotateAround:function(fe,We){var de=Math.cos(fe),y=Math.sin(fe),Be=We.x+de*(this.x-We.x)-y*(this.y-We.y),K=We.y+y*(this.x-We.x)+de*(this.y-We.y);return this.x=Be,this.y=K,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Se.convert=function(fe){return fe instanceof Se?fe:Array.isArray(fe)?new Se(fe[0],fe[1]):fe}},38929:function(pi,Se,fe){pi.exports.VectorTile=fe(22779),fe(66024),fe(59701)},22779:function(pi,Se,fe){"use strict";var We=fe(59701);pi.exports=de;function de(Be,K){this.layers=Be.readFields(y,{},K)}function y(Be,K,ke){if(Be===3){var he=new We(ke,ke.readVarint()+ke.pos);he.length&&(K[he.name]=he)}}},66024:function(pi,Se,fe){"use strict";var We=fe(75550);pi.exports=de;function de(he,ut,Ae,Xe,Ct){this.properties={},this.extent=Ae,this.type=0,this._pbf=he,this._geometry=-1,this._keys=Xe,this._values=Ct,he.readFields(y,this,ut)}function y(he,ut,Ae){he==1?ut.id=Ae.readVarint():he==2?Be(Ae,ut):he==3?ut.type=Ae.readVarint():he==4&&(ut._geometry=Ae.pos)}function Be(he,ut){for(var Ae=he.readVarint()+he.pos;he.pos<Ae;){var Xe=ut._keys[he.readVarint()],Ct=ut._values[he.readVarint()];ut.properties[Xe]=Ct}}de.types=["Unknown","Point","LineString","Polygon"],de.prototype.loadGeometry=function(){var he=this._pbf;he.pos=this._geometry;for(var ut=he.readVarint()+he.pos,Ae=1,Xe=0,Ct=0,Lt=0,tr=[],Yt;he.pos<ut;){if(Xe<=0){var Xt=he.readVarint();Ae=Xt&7,Xe=Xt>>3}if(Xe--,Ae===1||Ae===2)Ct+=he.readSVarint(),Lt+=he.readSVarint(),Ae===1&&(Yt&&tr.push(Yt),Yt=[]),Yt.push(new We(Ct,Lt));else if(Ae===7)Yt&&Yt.push(Yt[0].clone());else throw new Error("unknown command "+Ae)}return Yt&&tr.push(Yt),tr},de.prototype.bbox=function(){var he=this._pbf;he.pos=this._geometry;for(var ut=he.readVarint()+he.pos,Ae=1,Xe=0,Ct=0,Lt=0,tr=Infinity,Yt=-Infinity,Xt=Infinity,Er=-Infinity;he.pos<ut;){if(Xe<=0){var cr=he.readVarint();Ae=cr&7,Xe=cr>>3}if(Xe--,Ae===1||Ae===2)Ct+=he.readSVarint(),Lt+=he.readSVarint(),Ct<tr&&(tr=Ct),Ct>Yt&&(Yt=Ct),Lt<Xt&&(Xt=Lt),Lt>Er&&(Er=Lt);else if(Ae!==7)throw new Error("unknown command "+Ae)}return[tr,Xt,Yt,Er]},de.prototype.toGeoJSON=function(he,ut,Ae){var Xe=this.extent*Math.pow(2,Ae),Ct=this.extent*he,Lt=this.extent*ut,tr=this.loadGeometry(),Yt=de.types[this.type],Xt,Er;function cr(Rr){for(var re=0;re<Rr.length;re++){var _r=Rr[re],Ot=180-(_r.y+Lt)*360/Xe;Rr[re]=[(_r.x+Ct)*360/Xe-180,360/Math.PI*Math.atan(Math.exp(Ot*Math.PI/180))-90]}}switch(this.type){case 1:var Rt=[];for(Xt=0;Xt<tr.length;Xt++)Rt[Xt]=tr[Xt][0];tr=Rt,cr(tr);break;case 2:for(Xt=0;Xt<tr.length;Xt++)cr(tr[Xt]);break;case 3:for(tr=K(tr),Xt=0;Xt<tr.length;Xt++)for(Er=0;Er<tr[Xt].length;Er++)cr(tr[Xt][Er]);break}tr.length===1?tr=tr[0]:Yt="Multi"+Yt;var Zt={type:"Feature",geometry:{type:Yt,coordinates:tr},properties:this.properties};return"id"in this&&(Zt.id=this.id),Zt};function K(he){var ut=he.length;if(ut<=1)return[he];for(var Ae=[],Xe,Ct,Lt=0;Lt<ut;Lt++){var tr=ke(he[Lt]);tr!==0&&(Ct===void 0&&(Ct=tr<0),Ct===tr<0?(Xe&&Ae.push(Xe),Xe=[he[Lt]]):Xe.push(he[Lt]))}return Xe&&Ae.push(Xe),Ae}function ke(he){for(var ut=0,Ae=0,Xe=he.length,Ct=Xe-1,Lt,tr;Ae<Xe;Ct=Ae++)Lt=he[Ae],tr=he[Ct],ut+=(tr.x-Lt.x)*(Lt.y+tr.y);return ut}},59701:function(pi,Se,fe){"use strict";var We=fe(66024);pi.exports=de;function de(K,ke){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=K,this._keys=[],this._values=[],this._features=[],K.readFields(y,this,ke),this.length=this._features.length}function y(K,ke,he){K===15?ke.version=he.readVarint():K===1?ke.name=he.readString():K===5?ke.extent=he.readVarint():K===2?ke._features.push(he.pos):K===3?ke._keys.push(he.readString()):K===4&&ke._values.push(Be(he))}function Be(K){for(var ke=null,he=K.readVarint()+K.pos;K.pos<he;){var ut=K.readVarint()>>3;ke=ut===1?K.readString():ut===2?K.readFloat():ut===3?K.readDouble():ut===4?K.readVarint64():ut===5?K.readVarint():ut===6?K.readSVarint():ut===7?K.readBoolean():null}return ke}de.prototype.feature=function(K){if(K<0||K>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[K];var ke=this._pbf.readVarint()+this._pbf.pos;return new We(this._pbf,ke,this.extent,this._keys,this._values)}},53645:function(){},9187:function(pi){"use strict";pi.exports=Se,pi.exports.default=Se;function Se(Z,_e,ze){ze=ze||2;var wt=_e&&_e.length,Vt=wt?_e[0]*ze:Z.length,fr=fe(Z,0,Vt,ze,!0),Mt=[];if(!fr||fr.next===fr.prev)return Mt;var Fr,Xn,Jr,Ri,yi,ln,Sa;if(wt&&(fr=he(Z,_e,fr,ze)),Z.length>80*ze){Fr=Jr=Z[0],Xn=Ri=Z[1];for(var fa=ze;fa<Vt;fa+=ze)yi=Z[fa],ln=Z[fa+1],yi<Fr&&(Fr=yi),ln<Xn&&(Xn=ln),yi>Jr&&(Jr=yi),ln>Ri&&(Ri=ln);Sa=Math.max(Jr-Fr,Ri-Xn),Sa=Sa!==0?32767/Sa:0}return de(fr,Mt,ze,Fr,Xn,Sa,0),Mt}function fe(Z,_e,ze,wt,Vt){var fr,Mt;if(Vt===tt(Z,_e,ze,wt)>0)for(fr=_e;fr<ze;fr+=wt)Mt=Cr(fr,Z[fr],Z[fr+1],Mt);else for(fr=ze-wt;fr>=_e;fr-=wt)Mt=Cr(fr,Z[fr],Z[fr+1],Mt);return Mt&&Zt(Mt,Mt.next)&&(nn(Mt),Mt=Mt.next),Mt}function We(Z,_e){if(!Z)return Z;_e||(_e=Z);var ze=Z,wt;do if(wt=!1,!ze.steiner&&(Zt(ze,ze.next)||Rt(ze.prev,ze,ze.next)===0)){if(nn(ze),ze=_e=ze.prev,ze===ze.next)break;wt=!0}else ze=ze.next;while(wt||ze!==_e);return _e}function de(Z,_e,ze,wt,Vt,fr,Mt){if(!!Z){!Mt&&fr&&Lt(Z,wt,Vt,fr);for(var Fr=Z,Xn,Jr;Z.prev!==Z.next;){if(Xn=Z.prev,Jr=Z.next,fr?Be(Z,wt,Vt,fr):y(Z)){_e.push(Xn.i/ze|0),_e.push(Z.i/ze|0),_e.push(Jr.i/ze|0),nn(Z),Z=Jr.next,Fr=Jr.next;continue}if(Z=Jr,Z===Fr){Mt?Mt===1?(Z=K(We(Z),_e,ze),de(Z,_e,ze,wt,Vt,fr,2)):Mt===2&&ke(Z,_e,ze,wt,Vt,fr):de(We(Z),_e,ze,wt,Vt,fr,1);break}}}}function y(Z){var _e=Z.prev,ze=Z,wt=Z.next;if(Rt(_e,ze,wt)>=0)return!1;for(var Vt=_e.x,fr=ze.x,Mt=wt.x,Fr=_e.y,Xn=ze.y,Jr=wt.y,Ri=Vt<fr?Vt<Mt?Vt:Mt:fr<Mt?fr:Mt,yi=Fr<Xn?Fr<Jr?Fr:Jr:Xn<Jr?Xn:Jr,ln=Vt>fr?Vt>Mt?Vt:Mt:fr>Mt?fr:Mt,Sa=Fr>Xn?Fr>Jr?Fr:Jr:Xn>Jr?Xn:Jr,fa=wt.next;fa!==_e;){if(fa.x>=Ri&&fa.x<=ln&&fa.y>=yi&&fa.y<=Sa&&Er(Vt,Fr,fr,Xn,Mt,Jr,fa.x,fa.y)&&Rt(fa.prev,fa,fa.next)>=0)return!1;fa=fa.next}return!0}function Be(Z,_e,ze,wt){var Vt=Z.prev,fr=Z,Mt=Z.next;if(Rt(Vt,fr,Mt)>=0)return!1;for(var Fr=Vt.x,Xn=fr.x,Jr=Mt.x,Ri=Vt.y,yi=fr.y,ln=Mt.y,Sa=Fr<Xn?Fr<Jr?Fr:Jr:Xn<Jr?Xn:Jr,fa=Ri<yi?Ri<ln?Ri:ln:yi<ln?yi:ln,Di=Fr>Xn?Fr>Jr?Fr:Jr:Xn>Jr?Xn:Jr,Ia=Ri>yi?Ri>ln?Ri:ln:yi>ln?yi:ln,ui=Yt(Sa,fa,_e,ze,wt),Ji=Yt(Di,Ia,_e,ze,wt),di=Z.prevZ,_i=Z.nextZ;di&&di.z>=ui&&_i&&_i.z<=Ji;){if(di.x>=Sa&&di.x<=Di&&di.y>=fa&&di.y<=Ia&&di!==Vt&&di!==Mt&&Er(Fr,Ri,Xn,yi,Jr,ln,di.x,di.y)&&Rt(di.prev,di,di.next)>=0||(di=di.prevZ,_i.x>=Sa&&_i.x<=Di&&_i.y>=fa&&_i.y<=Ia&&_i!==Vt&&_i!==Mt&&Er(Fr,Ri,Xn,yi,Jr,ln,_i.x,_i.y)&&Rt(_i.prev,_i,_i.next)>=0))return!1;_i=_i.nextZ}for(;di&&di.z>=ui;){if(di.x>=Sa&&di.x<=Di&&di.y>=fa&&di.y<=Ia&&di!==Vt&&di!==Mt&&Er(Fr,Ri,Xn,yi,Jr,ln,di.x,di.y)&&Rt(di.prev,di,di.next)>=0)return!1;di=di.prevZ}for(;_i&&_i.z<=Ji;){if(_i.x>=Sa&&_i.x<=Di&&_i.y>=fa&&_i.y<=Ia&&_i!==Vt&&_i!==Mt&&Er(Fr,Ri,Xn,yi,Jr,ln,_i.x,_i.y)&&Rt(_i.prev,_i,_i.next)>=0)return!1;_i=_i.nextZ}return!0}function K(Z,_e,ze){var wt=Z;do{var Vt=wt.prev,fr=wt.next.next;!Zt(Vt,fr)&&Rr(Vt,wt,wt.next,fr)&&_t(Vt,fr)&&_t(fr,Vt)&&(_e.push(Vt.i/ze|0),_e.push(wt.i/ze|0),_e.push(fr.i/ze|0),nn(wt),nn(wt.next),wt=Z=fr),wt=wt.next}while(wt!==Z);return We(wt)}function ke(Z,_e,ze,wt,Vt,fr){var Mt=Z;do{for(var Fr=Mt.next.next;Fr!==Mt.prev;){if(Mt.i!==Fr.i&&cr(Mt,Fr)){var Xn=Ue(Mt,Fr);Mt=We(Mt,Mt.next),Xn=We(Xn,Xn.next),de(Mt,_e,ze,wt,Vt,fr,0),de(Xn,_e,ze,wt,Vt,fr,0);return}Fr=Fr.next}Mt=Mt.next}while(Mt!==Z)}function he(Z,_e,ze,wt){var Vt=[],fr,Mt,Fr,Xn,Jr;for(fr=0,Mt=_e.length;fr<Mt;fr++)Fr=_e[fr]*wt,Xn=fr<Mt-1?_e[fr+1]*wt:Z.length,Jr=fe(Z,Fr,Xn,wt,!1),Jr===Jr.next&&(Jr.steiner=!0),Vt.push(Xt(Jr));for(Vt.sort(ut),fr=0;fr<Vt.length;fr++)ze=Ae(Vt[fr],ze);return ze}function ut(Z,_e){return Z.x-_e.x}function Ae(Z,_e){var ze=Xe(Z,_e);if(!ze)return _e;var wt=Ue(ze,Z);return We(wt,wt.next),We(ze,ze.next)}function Xe(Z,_e){var ze=_e,wt=Z.x,Vt=Z.y,fr=-Infinity,Mt;do{if(Vt<=ze.y&&Vt>=ze.next.y&&ze.next.y!==ze.y){var Fr=ze.x+(Vt-ze.y)*(ze.next.x-ze.x)/(ze.next.y-ze.y);if(Fr<=wt&&Fr>fr&&(fr=Fr,Mt=ze.x<ze.next.x?ze:ze.next,Fr===wt))return Mt}ze=ze.next}while(ze!==_e);if(!Mt)return null;var Xn=Mt,Jr=Mt.x,Ri=Mt.y,yi=Infinity,ln;ze=Mt;do wt>=ze.x&&ze.x>=Jr&&wt!==ze.x&&Er(Vt<Ri?wt:fr,Vt,Jr,Ri,Vt<Ri?fr:wt,Vt,ze.x,ze.y)&&(ln=Math.abs(Vt-ze.y)/(wt-ze.x),_t(ze,Z)&&(ln<yi||ln===yi&&(ze.x>Mt.x||ze.x===Mt.x&&Ct(Mt,ze)))&&(Mt=ze,yi=ln)),ze=ze.next;while(ze!==Xn);return Mt}function Ct(Z,_e){return Rt(Z.prev,Z,_e.prev)<0&&Rt(_e.next,Z,Z.next)<0}function Lt(Z,_e,ze,wt){var Vt=Z;do Vt.z===0&&(Vt.z=Yt(Vt.x,Vt.y,_e,ze,wt)),Vt.prevZ=Vt.prev,Vt.nextZ=Vt.next,Vt=Vt.next;while(Vt!==Z);Vt.prevZ.nextZ=null,Vt.prevZ=null,tr(Vt)}function tr(Z){var _e,ze,wt,Vt,fr,Mt,Fr,Xn,Jr=1;do{for(ze=Z,Z=null,fr=null,Mt=0;ze;){for(Mt++,wt=ze,Fr=0,_e=0;_e<Jr&&(Fr++,wt=wt.nextZ,!!wt);_e++);for(Xn=Jr;Fr>0||Xn>0&&wt;)Fr!==0&&(Xn===0||!wt||ze.z<=wt.z)?(Vt=ze,ze=ze.nextZ,Fr--):(Vt=wt,wt=wt.nextZ,Xn--),fr?fr.nextZ=Vt:Z=Vt,Vt.prevZ=fr,fr=Vt;ze=wt}fr.nextZ=null,Jr*=2}while(Mt>1);return Z}function Yt(Z,_e,ze,wt,Vt){return Z=(Z-ze)*Vt|0,_e=(_e-wt)*Vt|0,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,_e=(_e|_e<<8)&16711935,_e=(_e|_e<<4)&252645135,_e=(_e|_e<<2)&858993459,_e=(_e|_e<<1)&1431655765,Z|_e<<1}function Xt(Z){var _e=Z,ze=Z;do(_e.x<ze.x||_e.x===ze.x&&_e.y<ze.y)&&(ze=_e),_e=_e.next;while(_e!==Z);return ze}function Er(Z,_e,ze,wt,Vt,fr,Mt,Fr){return(Vt-Mt)*(_e-Fr)>=(Z-Mt)*(fr-Fr)&&(Z-Mt)*(wt-Fr)>=(ze-Mt)*(_e-Fr)&&(ze-Mt)*(fr-Fr)>=(Vt-Mt)*(wt-Fr)}function cr(Z,_e){return Z.next.i!==_e.i&&Z.prev.i!==_e.i&&!Ot(Z,_e)&&(_t(Z,_e)&&_t(_e,Z)&&Kt(Z,_e)&&(Rt(Z.prev,Z,_e.prev)||Rt(Z,_e.prev,_e))||Zt(Z,_e)&&Rt(Z.prev,Z,Z.next)>0&&Rt(_e.prev,_e,_e.next)>0)}function Rt(Z,_e,ze){return(_e.y-Z.y)*(ze.x-_e.x)-(_e.x-Z.x)*(ze.y-_e.y)}function Zt(Z,_e){return Z.x===_e.x&&Z.y===_e.y}function Rr(Z,_e,ze,wt){var Vt=_r(Rt(Z,_e,ze)),fr=_r(Rt(Z,_e,wt)),Mt=_r(Rt(ze,wt,Z)),Fr=_r(Rt(ze,wt,_e));return!!(Vt!==fr&&Mt!==Fr||Vt===0&&re(Z,ze,_e)||fr===0&&re(Z,wt,_e)||Mt===0&&re(ze,Z,wt)||Fr===0&&re(ze,_e,wt))}function re(Z,_e,ze){return _e.x<=Math.max(Z.x,ze.x)&&_e.x>=Math.min(Z.x,ze.x)&&_e.y<=Math.max(Z.y,ze.y)&&_e.y>=Math.min(Z.y,ze.y)}function _r(Z){return Z>0?1:Z<0?-1:0}function Ot(Z,_e){var ze=Z;do{if(ze.i!==Z.i&&ze.next.i!==Z.i&&ze.i!==_e.i&&ze.next.i!==_e.i&&Rr(ze,ze.next,Z,_e))return!0;ze=ze.next}while(ze!==Z);return!1}function _t(Z,_e){return Rt(Z.prev,Z,Z.next)<0?Rt(Z,_e,Z.next)>=0&&Rt(Z,Z.prev,_e)>=0:Rt(Z,_e,Z.prev)<0||Rt(Z,Z.next,_e)<0}function Kt(Z,_e){var ze=Z,wt=!1,Vt=(Z.x+_e.x)/2,fr=(Z.y+_e.y)/2;do ze.y>fr!=ze.next.y>fr&&ze.next.y!==ze.y&&Vt<(ze.next.x-ze.x)*(fr-ze.y)/(ze.next.y-ze.y)+ze.x&&(wt=!wt),ze=ze.next;while(ze!==Z);return wt}function Ue(Z,_e){var ze=new ue(Z.i,Z.x,Z.y),wt=new ue(_e.i,_e.x,_e.y),Vt=Z.next,fr=_e.prev;return Z.next=_e,_e.prev=Z,ze.next=Vt,Vt.prev=ze,wt.next=ze,ze.prev=wt,fr.next=wt,wt.prev=fr,wt}function Cr(Z,_e,ze,wt){var Vt=new ue(Z,_e,ze);return wt?(Vt.next=wt.next,Vt.prev=wt,wt.next.prev=Vt,wt.next=Vt):(Vt.prev=Vt,Vt.next=Vt),Vt}function nn(Z){Z.next.prev=Z.prev,Z.prev.next=Z.next,Z.prevZ&&(Z.prevZ.nextZ=Z.nextZ),Z.nextZ&&(Z.nextZ.prevZ=Z.prevZ)}function ue(Z,_e,ze){this.i=Z,this.x=_e,this.y=ze,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Se.deviation=function(Z,_e,ze,wt){var Vt=_e&&_e.length,fr=Vt?_e[0]*ze:Z.length,Mt=Math.abs(tt(Z,0,fr,ze));if(Vt)for(var Fr=0,Xn=_e.length;Fr<Xn;Fr++){var Jr=_e[Fr]*ze,Ri=Fr<Xn-1?_e[Fr+1]*ze:Z.length;Mt-=Math.abs(tt(Z,Jr,Ri,ze))}var yi=0;for(Fr=0;Fr<wt.length;Fr+=3){var ln=wt[Fr]*ze,Sa=wt[Fr+1]*ze,fa=wt[Fr+2]*ze;yi+=Math.abs((Z[ln]-Z[fa])*(Z[Sa+1]-Z[ln+1])-(Z[ln]-Z[Sa])*(Z[fa+1]-Z[ln+1]))}return Mt===0&&yi===0?0:Math.abs((yi-Mt)/Mt)};function tt(Z,_e,ze,wt){for(var Vt=0,fr=_e,Mt=ze-wt;fr<ze;fr+=wt)Vt+=(Z[Mt]-Z[fr])*(Z[fr+1]+Z[Mt+1]),Mt=fr;return Vt}Se.flatten=function(Z){for(var _e=Z[0][0].length,ze={vertices:[],holes:[],dimensions:_e},wt=0,Vt=0;Vt<Z.length;Vt++){for(var fr=0;fr<Z[Vt].length;fr++)for(var Mt=0;Mt<_e;Mt++)ze.vertices.push(Z[Vt][fr][Mt]);Vt>0&&(wt+=Z[Vt-1].length,ze.holes.push(wt))}return ze}},67709:function(pi){function Se(We){var de=We.target||We.srcElement;de.__resizeRAF__&&cancelAnimationFrame(de.__resizeRAF__),de.__resizeRAF__=requestAnimationFrame(function(){var y=de.__resizeTrigger__,Be=y&&y.__resizeListeners__;Be&&Be.forEach(function(K){K.call(y,We)})})}var fe=function(de,y){var Be=this,K=Be.document,ke,he=K.attachEvent;typeof navigator!="undefined"&&(ke=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ut(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Se)}if(!de.__resizeListeners__)if(de.__resizeListeners__=[],he)de.__resizeTrigger__=de,de.attachEvent("onresize",Se);else{getComputedStyle(de).position==="static"&&(de.style.position="relative");var Ae=de.__resizeTrigger__=K.createElement("object");Ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Ae.setAttribute("class","resize-sensor"),Ae.setAttribute("tabindex","-1"),Ae.setAttribute("title",""),Ae.__resizeElement__=de,Ae.onload=ut,Ae.type="text/html",ke&&de.appendChild(Ae),Ae.data="about:blank",ke||de.appendChild(Ae)}de.__resizeListeners__.push(y)};pi.exports=typeof window=="undefined"?fe:fe.bind(window),pi.exports.unbind=function(We,de){var y=document.attachEvent,Be=We.__resizeListeners__||[];if(de){var K=Be.indexOf(de);K!==-1&&Be.splice(K,1)}else Be=We.__resizeListeners__=[];if(!Be.length){if(y)We.detachEvent("onresize",Se);else if(We.__resizeTrigger__){var ke=We.__resizeTrigger__.contentDocument,he=ke&&ke.defaultView;he&&(he.removeEventListener("resize",Se),delete he.__resizeTrigger__),We.__resizeTrigger__=!We.removeChild(We.__resizeTrigger__)}delete We.__resizeListeners__}}},26729:function(pi){"use strict";var Se=Object.prototype.hasOwnProperty,fe="~";function We(){}Object.create&&(We.prototype=Object.create(null),new We().__proto__||(fe=!1));function de(ke,he,ut){this.fn=ke,this.context=he,this.once=ut||!1}function y(ke,he,ut,Ae,Xe){if(typeof ut!="function")throw new TypeError("The listener must be a function");var Ct=new de(ut,Ae||ke,Xe),Lt=fe?fe+he:he;return ke._events[Lt]?ke._events[Lt].fn?ke._events[Lt]=[ke._events[Lt],Ct]:ke._events[Lt].push(Ct):(ke._events[Lt]=Ct,ke._eventsCount++),ke}function Be(ke,he){--ke._eventsCount==0?ke._events=new We:delete ke._events[he]}function K(){this._events=new We,this._eventsCount=0}K.prototype.eventNames=function(){var he=[],ut,Ae;if(this._eventsCount===0)return he;for(Ae in ut=this._events)Se.call(ut,Ae)&&he.push(fe?Ae.slice(1):Ae);return Object.getOwnPropertySymbols?he.concat(Object.getOwnPropertySymbols(ut)):he},K.prototype.listeners=function(he){var ut=fe?fe+he:he,Ae=this._events[ut];if(!Ae)return[];if(Ae.fn)return[Ae.fn];for(var Xe=0,Ct=Ae.length,Lt=new Array(Ct);Xe<Ct;Xe++)Lt[Xe]=Ae[Xe].fn;return Lt},K.prototype.listenerCount=function(he){var ut=fe?fe+he:he,Ae=this._events[ut];return Ae?Ae.fn?1:Ae.length:0},K.prototype.emit=function(he,ut,Ae,Xe,Ct,Lt){var tr=fe?fe+he:he;if(!this._events[tr])return!1;var Yt=this._events[tr],Xt=arguments.length,Er,cr;if(Yt.fn){switch(Yt.once&&this.removeListener(he,Yt.fn,void 0,!0),Xt){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,ut),!0;case 3:return Yt.fn.call(Yt.context,ut,Ae),!0;case 4:return Yt.fn.call(Yt.context,ut,Ae,Xe),!0;case 5:return Yt.fn.call(Yt.context,ut,Ae,Xe,Ct),!0;case 6:return Yt.fn.call(Yt.context,ut,Ae,Xe,Ct,Lt),!0}for(cr=1,Er=new Array(Xt-1);cr<Xt;cr++)Er[cr-1]=arguments[cr];Yt.fn.apply(Yt.context,Er)}else{var Rt=Yt.length,Zt;for(cr=0;cr<Rt;cr++)switch(Yt[cr].once&&this.removeListener(he,Yt[cr].fn,void 0,!0),Xt){case 1:Yt[cr].fn.call(Yt[cr].context);break;case 2:Yt[cr].fn.call(Yt[cr].context,ut);break;case 3:Yt[cr].fn.call(Yt[cr].context,ut,Ae);break;case 4:Yt[cr].fn.call(Yt[cr].context,ut,Ae,Xe);break;default:if(!Er)for(Zt=1,Er=new Array(Xt-1);Zt<Xt;Zt++)Er[Zt-1]=arguments[Zt];Yt[cr].fn.apply(Yt[cr].context,Er)}}return!0},K.prototype.on=function(he,ut,Ae){return y(this,he,ut,Ae,!1)},K.prototype.once=function(he,ut,Ae){return y(this,he,ut,Ae,!0)},K.prototype.removeListener=function(he,ut,Ae,Xe){var Ct=fe?fe+he:he;if(!this._events[Ct])return this;if(!ut)return Be(this,Ct),this;var Lt=this._events[Ct];if(Lt.fn)Lt.fn===ut&&(!Xe||Lt.once)&&(!Ae||Lt.context===Ae)&&Be(this,Ct);else{for(var tr=0,Yt=[],Xt=Lt.length;tr<Xt;tr++)(Lt[tr].fn!==ut||Xe&&!Lt[tr].once||Ae&&Lt[tr].context!==Ae)&&Yt.push(Lt[tr]);Yt.length?this._events[Ct]=Yt.length===1?Yt[0]:Yt:Be(this,Ct)}return this},K.prototype.removeAllListeners=function(he){var ut;return he?(ut=fe?fe+he:he,this._events[ut]&&Be(this,ut)):(this._events=new We,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=fe,K.EventEmitter=K,pi.exports=K},80645:function(pi,Se){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Se.read=function(fe,We,de,y,Be){var K,ke,he=Be*8-y-1,ut=(1<<he)-1,Ae=ut>>1,Xe=-7,Ct=de?Be-1:0,Lt=de?-1:1,tr=fe[We+Ct];for(Ct+=Lt,K=tr&(1<<-Xe)-1,tr>>=-Xe,Xe+=he;Xe>0;K=K*256+fe[We+Ct],Ct+=Lt,Xe-=8);for(ke=K&(1<<-Xe)-1,K>>=-Xe,Xe+=y;Xe>0;ke=ke*256+fe[We+Ct],Ct+=Lt,Xe-=8);if(K===0)K=1-Ae;else{if(K===ut)return ke?NaN:(tr?-1:1)*Infinity;ke=ke+Math.pow(2,y),K=K-Ae}return(tr?-1:1)*ke*Math.pow(2,K-y)},Se.write=function(fe,We,de,y,Be,K){var ke,he,ut,Ae=K*8-Be-1,Xe=(1<<Ae)-1,Ct=Xe>>1,Lt=Be===23?Math.pow(2,-24)-Math.pow(2,-77):0,tr=y?0:K-1,Yt=y?1:-1,Xt=We<0||We===0&&1/We<0?1:0;for(We=Math.abs(We),isNaN(We)||We===Infinity?(he=isNaN(We)?1:0,ke=Xe):(ke=Math.floor(Math.log(We)/Math.LN2),We*(ut=Math.pow(2,-ke))<1&&(ke--,ut*=2),ke+Ct>=1?We+=Lt/ut:We+=Lt*Math.pow(2,1-Ct),We*ut>=2&&(ke++,ut/=2),ke+Ct>=Xe?(he=0,ke=Xe):ke+Ct>=1?(he=(We*ut-1)*Math.pow(2,Be),ke=ke+Ct):(he=We*Math.pow(2,Ct-1)*Math.pow(2,Be),ke=0));Be>=8;fe[de+tr]=he&255,tr+=Yt,he/=256,Be-=8);for(ke=ke<<Be|he,Ae+=Be;Ae>0;fe[de+tr]=ke&255,tr+=Yt,ke/=256,Ae-=8);fe[de+tr-Yt]|=Xt*128}},7375:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0});var fe=Symbol.for("INJECTION");function We(ke,he,ut,Ae){function Xe(){return Ae&&!Reflect.hasMetadata(fe,this,he)&&Reflect.defineMetadata(fe,ut(),this,he),Reflect.hasMetadata(fe,this,he)?Reflect.getMetadata(fe,this,he):ut()}function Ct(Lt){Reflect.defineMetadata(fe,Lt,this,he)}Object.defineProperty(ke,he,{configurable:!0,enumerable:!0,get:Xe,set:Ct})}function de(ke,he){return function(ut){return function(Ae,Xe){var Ct=function(){return ke.get(ut)};We(Ae,Xe,Ct,he)}}}Se.makePropertyInjectDecorator=de;function y(ke,he){return function(ut,Ae){return function(Xe,Ct){var Lt=function(){return ke.getNamed(ut,Ae)};We(Xe,Ct,Lt,he)}}}Se.makePropertyInjectNamedDecorator=y;function Be(ke,he){return function(ut,Ae,Xe){return function(Ct,Lt){var tr=function(){return ke.getTagged(ut,Ae,Xe)};We(Ct,Lt,tr,he)}}}Se.makePropertyInjectTaggedDecorator=Be;function K(ke,he){return function(ut){return function(Ae,Xe){var Ct=function(){return ke.getAll(ut)};We(Ae,Xe,Ct,he)}}}Se.makePropertyMultiInjectDecorator=K},84879:function(pi,Se,fe){"use strict";var We;We={value:!0};var de=fe(7375);function y(Be,K){K===void 0&&(K=!0);var ke=de.makePropertyInjectDecorator(Be,K),he=de.makePropertyInjectNamedDecorator(Be,K),ut=de.makePropertyInjectTaggedDecorator(Be,K),Ae=de.makePropertyMultiInjectDecorator(Be,K);return{lazyInject:ke,lazyInjectNamed:he,lazyInjectTagged:ut,lazyMultiInject:Ae}}Se.Z=y},99934:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.tagProperty=Se.tagParameter=Se.decorate=void 0;var We=fe(16674),de=fe(6867);function y(Ae,Xe,Ct,Lt){var tr=de.TAGGED;K(tr,Ae,Xe,Lt,Ct)}Se.tagParameter=y;function Be(Ae,Xe,Ct){var Lt=de.TAGGED_PROP;K(Lt,Ae.constructor,Xe,Ct)}Se.tagProperty=Be;function K(Ae,Xe,Ct,Lt,tr){var Yt={},Xt=typeof tr=="number",Er=tr!==void 0&&Xt?tr.toString():Ct;if(Xt&&Ct!==void 0)throw new Error(We.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(Ae,Xe)&&(Yt=Reflect.getMetadata(Ae,Xe));var cr=Yt[Er];if(!Array.isArray(cr))cr=[];else for(var Rt=0,Zt=cr;Rt<Zt.length;Rt++){var Rr=Zt[Rt];if(Rr.key===Lt.key)throw new Error(We.DUPLICATED_METADATA+" "+Rr.key.toString())}cr.push(Lt),Yt[Er]=cr,Reflect.defineMetadata(Ae,Yt,Xe)}function ke(Ae,Xe){Reflect.decorate(Ae,Xe)}function he(Ae,Xe){return function(Ct,Lt){Xe(Ct,Lt,Ae)}}function ut(Ae,Xe,Ct){typeof Ct=="number"?ke([he(Ct,Ae)],Xe):typeof Ct=="string"?Reflect.decorate([Ae],Xe,Ct):ke([Ae],Xe)}Se.decorate=ut},5744:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.inject=Se.LazyServiceIdentifer=void 0;var We=fe(16674),de=fe(6867),y=fe(47738),Be=fe(99934),K=function(){function he(ut){this._cb=ut}return he.prototype.unwrap=function(){return this._cb()},he}();Se.LazyServiceIdentifer=K;function ke(he){return function(ut,Ae,Xe){if(he===void 0)throw new Error(We.UNDEFINED_INJECT_ANNOTATION(ut.name));var Ct=new y.Metadata(de.INJECT_TAG,he);typeof Xe=="number"?Be.tagParameter(ut,Ae,Xe,Ct):Be.tagProperty(ut,Ae,Ct)}}Se.inject=ke},64315:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.injectable=void 0;var We=fe(16674),de=fe(6867);function y(){return function(Be){if(Reflect.hasOwnMetadata(de.PARAM_TYPES,Be))throw new Error(We.DUPLICATED_INJECTABLE_DECORATOR);var K=Reflect.getMetadata(de.DESIGN_PARAM_TYPES,Be)||[];return Reflect.defineMetadata(de.PARAM_TYPES,K,Be),Be}}Se.injectable=y},71693:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.multiInject=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Be(K){return function(ke,he,ut){var Ae=new de.Metadata(We.MULTI_INJECT_TAG,K);typeof ut=="number"?y.tagParameter(ke,he,ut,Ae):y.tagProperty(ke,he,Ae)}}Se.multiInject=Be},38085:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.named=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Be(K){return function(ke,he,ut){var Ae=new de.Metadata(We.NAMED_TAG,K);typeof ut=="number"?y.tagParameter(ke,he,ut,Ae):y.tagProperty(ke,he,Ae)}}Se.named=Be},6515:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.optional=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Be(){return function(K,ke,he){var ut=new de.Metadata(We.OPTIONAL_TAG,!0);typeof he=="number"?y.tagParameter(K,ke,he,ut):y.tagProperty(K,ke,ut)}}Se.optional=Be},7014:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.postConstruct=void 0;var We=fe(16674),de=fe(6867),y=fe(47738);function Be(){return function(K,ke,he){var ut=new y.Metadata(de.POST_CONSTRUCT,ke);if(Reflect.hasOwnMetadata(de.POST_CONSTRUCT,K.constructor))throw new Error(We.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(de.POST_CONSTRUCT,ut,K.constructor)}}Se.postConstruct=Be},32052:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.tagged=void 0;var We=fe(47738),de=fe(99934);function y(Be,K){return function(ke,he,ut){var Ae=new We.Metadata(Be,K);typeof ut=="number"?de.tagParameter(ke,he,ut,Ae):de.tagProperty(ke,he,Ae)}}Se.tagged=y},55638:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.targetName=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Be(K){return function(ke,he,ut){var Ae=new de.Metadata(We.NAME_TAG,K);y.tagParameter(ke,he,ut,Ae)}}Se.targetName=Be},86757:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.unmanaged=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Be(){return function(K,ke,he){var ut=new de.Metadata(We.UNMANAGED_TAG,!0);y.tagParameter(K,ke,he,ut)}}Se.unmanaged=Be},44290:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Binding=void 0;var We=fe(28421),de=fe(37791),y=function(){function Be(K,ke){this.id=de.id(),this.activated=!1,this.serviceIdentifier=K,this.scope=ke,this.type=We.BindingTypeEnum.Invalid,this.constraint=function(he){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Be.prototype.clone=function(){var K=new Be(this.serviceIdentifier,this.scope);return K.activated=K.scope===We.BindingScopeEnum.Singleton?this.activated:!1,K.implementationType=this.implementationType,K.dynamicValue=this.dynamicValue,K.scope=this.scope,K.type=this.type,K.factory=this.factory,K.provider=this.provider,K.constraint=this.constraint,K.onActivation=this.onActivation,K.cache=this.cache,K},Be}();Se.Binding=y},23184:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingCount=void 0;var fe={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Se.BindingCount=fe},16674:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.STACK_OVERFLOW=Se.CIRCULAR_DEPENDENCY_IN_FACTORY=Se.POST_CONSTRUCT_ERROR=Se.MULTIPLE_POST_CONSTRUCT_METHODS=Se.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Se.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Se.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Se.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Se.ARGUMENTS_LENGTH_MISMATCH=Se.INVALID_DECORATOR_OPERATION=Se.INVALID_TO_SELF_VALUE=Se.INVALID_FUNCTION_BINDING=Se.INVALID_MIDDLEWARE_RETURN=Se.NO_MORE_SNAPSHOTS_AVAILABLE=Se.INVALID_BINDING_TYPE=Se.NOT_IMPLEMENTED=Se.CIRCULAR_DEPENDENCY=Se.UNDEFINED_INJECT_ANNOTATION=Se.MISSING_INJECT_ANNOTATION=Se.MISSING_INJECTABLE_ANNOTATION=Se.NOT_REGISTERED=Se.CANNOT_UNBIND=Se.AMBIGUOUS_MATCH=Se.KEY_NOT_FOUND=Se.NULL_ARGUMENT=Se.DUPLICATED_METADATA=Se.DUPLICATED_INJECTABLE_DECORATOR=void 0,Se.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Se.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Se.NULL_ARGUMENT="NULL argument",Se.KEY_NOT_FOUND="Key Not Found",Se.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Se.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Se.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Se.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Se.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var fe=function(Be){return"@inject called with undefined this could mean that the class "+Be+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Se.UNDEFINED_INJECT_ANNOTATION=fe,Se.CIRCULAR_DEPENDENCY="Circular dependency found:",Se.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Se.INVALID_BINDING_TYPE="Invalid binding type:",Se.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Se.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Se.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Se.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Se.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var We=function(){for(var Be=[],K=0;K<arguments.length;K++)Be[K]=arguments[K];return"The number of constructor arguments in the derived class "+(Be[0]+" must be >= than the number of constructor arguments of its base class.")};Se.ARGUMENTS_LENGTH_MISMATCH=We,Se.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Se.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Se.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Se.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Se.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var de=function(){for(var Be=[],K=0;K<arguments.length;K++)Be[K]=arguments[K];return"@postConstruct error in class "+Be[0]+": "+Be[1]};Se.POST_CONSTRUCT_ERROR=de;var y=function(){for(var Be=[],K=0;K<arguments.length;K++)Be[K]=arguments[K];return"It looks like there is a circular dependency "+("in one of the '"+Be[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Be[1]+"'.")};Se.CIRCULAR_DEPENDENCY_IN_FACTORY=y,Se.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.TargetTypeEnum=Se.BindingTypeEnum=Se.BindingScopeEnum=void 0;var fe={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Se.BindingScopeEnum=fe;var We={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Se.BindingTypeEnum=We;var de={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Se.TargetTypeEnum=de},6867:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.NON_CUSTOM_TAG_KEYS=Se.POST_CONSTRUCT=Se.DESIGN_PARAM_TYPES=Se.PARAM_TYPES=Se.TAGGED_PROP=Se.TAGGED=Se.MULTI_INJECT_TAG=Se.INJECT_TAG=Se.OPTIONAL_TAG=Se.UNMANAGED_TAG=Se.NAME_TAG=Se.NAMED_TAG=void 0,Se.NAMED_TAG="named",Se.NAME_TAG="name",Se.UNMANAGED_TAG="unmanaged",Se.OPTIONAL_TAG="optional",Se.INJECT_TAG="inject",Se.MULTI_INJECT_TAG="multi_inject",Se.TAGGED="inversify:tagged",Se.TAGGED_PROP="inversify:tagged_props",Se.PARAM_TYPES="inversify:paramtypes",Se.DESIGN_PARAM_TYPES="design:paramtypes",Se.POST_CONSTRUCT="post_construct";function fe(){return[Se.INJECT_TAG,Se.MULTI_INJECT_TAG,Se.NAME_TAG,Se.UNMANAGED_TAG,Se.NAMED_TAG,Se.OPTIONAL_TAG]}Se.NON_CUSTOM_TAG_KEYS=fe()},51389:function(pi,Se,fe){"use strict";var We=this&&this.__awaiter||function(cr,Rt,Zt,Rr){function re(_r){return _r instanceof Zt?_r:new Zt(function(Ot){Ot(_r)})}return new(Zt||(Zt=Promise))(function(_r,Ot){function _t(Cr){try{Ue(Rr.next(Cr))}catch(nn){Ot(nn)}}function Kt(Cr){try{Ue(Rr.throw(Cr))}catch(nn){Ot(nn)}}function Ue(Cr){Cr.done?_r(Cr.value):re(Cr.value).then(_t,Kt)}Ue((Rr=Rr.apply(cr,Rt||[])).next())})},de=this&&this.__generator||function(cr,Rt){var Zt={label:0,sent:function(){if(_r[0]&1)throw _r[1];return _r[1]},trys:[],ops:[]},Rr,re,_r,Ot;return Ot={next:_t(0),throw:_t(1),return:_t(2)},typeof Symbol=="function"&&(Ot[Symbol.iterator]=function(){return this}),Ot;function _t(Ue){return function(Cr){return Kt([Ue,Cr])}}function Kt(Ue){if(Rr)throw new TypeError("Generator is already executing.");for(;Zt;)try{if(Rr=1,re&&(_r=Ue[0]&2?re.return:Ue[0]?re.throw||((_r=re.return)&&_r.call(re),0):re.next)&&!(_r=_r.call(re,Ue[1])).done)return _r;switch(re=0,_r&&(Ue=[Ue[0]&2,_r.value]),Ue[0]){case 0:case 1:_r=Ue;break;case 4:return Zt.label++,{value:Ue[1],done:!1};case 5:Zt.label++,re=Ue[1],Ue=[0];continue;case 7:Ue=Zt.ops.pop(),Zt.trys.pop();continue;default:if(_r=Zt.trys,!(_r=_r.length>0&&_r[_r.length-1])&&(Ue[0]===6||Ue[0]===2)){Zt=0;continue}if(Ue[0]===3&&(!_r||Ue[1]>_r[0]&&Ue[1]<_r[3])){Zt.label=Ue[1];break}if(Ue[0]===6&&Zt.label<_r[1]){Zt.label=_r[1],_r=Ue;break}if(_r&&Zt.label<_r[2]){Zt.label=_r[2],Zt.ops.push(Ue);break}_r[2]&&Zt.ops.pop(),Zt.trys.pop();continue}Ue=Rt.call(cr,Zt)}catch(Cr){Ue=[6,Cr],re=0}finally{Rr=_r=0}if(Ue[0]&5)throw Ue[1];return{value:Ue[0]?Ue[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(cr,Rt){for(var Zt=0,Rr=Rt.length,re=cr.length;Zt<Rr;Zt++,re++)cr[re]=Rt[Zt];return cr};Object.defineProperty(Se,"__esModule",{value:!0}),Se.Container=void 0;var Be=fe(44290),K=fe(16674),ke=fe(28421),he=fe(6867),ut=fe(51377),Ae=fe(86311),Xe=fe(31927),Ct=fe(15451),Lt=fe(37791),tr=fe(55800),Yt=fe(85700),Xt=fe(80175),Er=function(){function cr(Rt){this._appliedMiddleware=[];var Zt=Rt||{};if(typeof Zt!="object")throw new Error(""+K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Zt.defaultScope===void 0)Zt.defaultScope=ke.BindingScopeEnum.Transient;else if(Zt.defaultScope!==ke.BindingScopeEnum.Singleton&&Zt.defaultScope!==ke.BindingScopeEnum.Transient&&Zt.defaultScope!==ke.BindingScopeEnum.Request)throw new Error(""+K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Zt.autoBindInjectable===void 0)Zt.autoBindInjectable=!1;else if(typeof Zt.autoBindInjectable!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Zt.skipBaseClassChecks===void 0)Zt.skipBaseClassChecks=!1;else if(typeof Zt.skipBaseClassChecks!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Zt.autoBindInjectable,defaultScope:Zt.defaultScope,skipBaseClassChecks:Zt.skipBaseClassChecks},this.id=Lt.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ut.MetadataReader}return cr.merge=function(Rt,Zt){for(var Rr=[],re=2;re<arguments.length;re++)Rr[re-2]=arguments[re];var _r=new cr,Ot=y([Rt,Zt],Rr).map(function(Ue){return Ae.getBindingDictionary(Ue)}),_t=Ae.getBindingDictionary(_r);function Kt(Ue,Cr){Ue.traverse(function(nn,ue){ue.forEach(function(tt){Cr.add(tt.serviceIdentifier,tt.clone())})})}return Ot.forEach(function(Ue){Kt(Ue,_t)}),_r},cr.prototype.load=function(){for(var Rt=[],Zt=0;Zt<arguments.length;Zt++)Rt[Zt]=arguments[Zt];for(var Rr=this._getContainerModuleHelpersFactory(),re=0,_r=Rt;re<_r.length;re++){var Ot=_r[re],_t=Rr(Ot.id);Ot.registry(_t.bindFunction,_t.unbindFunction,_t.isboundFunction,_t.rebindFunction)}},cr.prototype.loadAsync=function(){for(var Rt=[],Zt=0;Zt<arguments.length;Zt++)Rt[Zt]=arguments[Zt];return We(this,void 0,void 0,function(){var Rr,re,_r,Ot,_t;return de(this,function(Kt){switch(Kt.label){case 0:Rr=this._getContainerModuleHelpersFactory(),re=0,_r=Rt,Kt.label=1;case 1:return re<_r.length?(Ot=_r[re],_t=Rr(Ot.id),[4,Ot.registry(_t.bindFunction,_t.unbindFunction,_t.isboundFunction,_t.rebindFunction)]):[3,4];case 2:Kt.sent(),Kt.label=3;case 3:return re++,[3,1];case 4:return[2]}})})},cr.prototype.unload=function(){for(var Rt=this,Zt=[],Rr=0;Rr<arguments.length;Rr++)Zt[Rr]=arguments[Rr];var re=function(_r){return function(Ot){return Ot.moduleId===_r}};Zt.forEach(function(_r){var Ot=re(_r.id);Rt._bindingDictionary.removeByCondition(Ot)})},cr.prototype.bind=function(Rt){var Zt=this.options.defaultScope||ke.BindingScopeEnum.Transient,Rr=new Be.Binding(Rt,Zt);return this._bindingDictionary.add(Rt,Rr),new Ct.BindingToSyntax(Rr)},cr.prototype.rebind=function(Rt){return this.unbind(Rt),this.bind(Rt)},cr.prototype.unbind=function(Rt){try{this._bindingDictionary.remove(Rt)}catch(Zt){throw new Error(K.CANNOT_UNBIND+" "+tr.getServiceIdentifierAsString(Rt))}},cr.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},cr.prototype.isBound=function(Rt){var Zt=this._bindingDictionary.hasKey(Rt);return!Zt&&this.parent&&(Zt=this.parent.isBound(Rt)),Zt},cr.prototype.isBoundNamed=function(Rt,Zt){return this.isBoundTagged(Rt,he.NAMED_TAG,Zt)},cr.prototype.isBoundTagged=function(Rt,Zt,Rr){var re=!1;if(this._bindingDictionary.hasKey(Rt)){var _r=this._bindingDictionary.get(Rt),Ot=Ae.createMockRequest(this,Rt,Zt,Rr);re=_r.some(function(_t){return _t.constraint(Ot)})}return!re&&this.parent&&(re=this.parent.isBoundTagged(Rt,Zt,Rr)),re},cr.prototype.snapshot=function(){this._snapshots.push(Yt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},cr.prototype.restore=function(){var Rt=this._snapshots.pop();if(Rt===void 0)throw new Error(K.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Rt.bindings,this._middleware=Rt.middleware},cr.prototype.createChild=function(Rt){var Zt=new cr(Rt||this.options);return Zt.parent=this,Zt},cr.prototype.applyMiddleware=function(){for(var Rt=[],Zt=0;Zt<arguments.length;Zt++)Rt[Zt]=arguments[Zt];this._appliedMiddleware=this._appliedMiddleware.concat(Rt);var Rr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Rt.reduce(function(re,_r){return _r(re)},Rr)},cr.prototype.applyCustomMetadataReader=function(Rt){this._metadataReader=Rt},cr.prototype.get=function(Rt){return this._get(!1,!1,ke.TargetTypeEnum.Variable,Rt)},cr.prototype.getTagged=function(Rt,Zt,Rr){return this._get(!1,!1,ke.TargetTypeEnum.Variable,Rt,Zt,Rr)},cr.prototype.getNamed=function(Rt,Zt){return this.getTagged(Rt,he.NAMED_TAG,Zt)},cr.prototype.getAll=function(Rt){return this._get(!0,!0,ke.TargetTypeEnum.Variable,Rt)},cr.prototype.getAllTagged=function(Rt,Zt,Rr){return this._get(!1,!0,ke.TargetTypeEnum.Variable,Rt,Zt,Rr)},cr.prototype.getAllNamed=function(Rt,Zt){return this.getAllTagged(Rt,he.NAMED_TAG,Zt)},cr.prototype.resolve=function(Rt){var Zt=this.createChild();return Zt.bind(Rt).toSelf(),this._appliedMiddleware.forEach(function(Rr){Zt.applyMiddleware(Rr)}),Zt.get(Rt)},cr.prototype._getContainerModuleHelpersFactory=function(){var Rt=this,Zt=function(_t,Kt){_t._binding.moduleId=Kt},Rr=function(_t){return function(Kt){var Ue=Rt.bind.bind(Rt),Cr=Ue(Kt);return Zt(Cr,_t),Cr}},re=function(_t){return function(Kt){var Ue=Rt.unbind.bind(Rt);Ue(Kt)}},_r=function(_t){return function(Kt){var Ue=Rt.isBound.bind(Rt);return Ue(Kt)}},Ot=function(_t){return function(Kt){var Ue=Rt.rebind.bind(Rt),Cr=Ue(Kt);return Zt(Cr,_t),Cr}};return function(_t){return{bindFunction:Rr(_t),isboundFunction:_r(_t),rebindFunction:Ot(_t),unbindFunction:re(_t)}}},cr.prototype._get=function(Rt,Zt,Rr,re,_r,Ot){var _t=null,Kt={avoidConstraints:Rt,contextInterceptor:function(Ue){return Ue},isMultiInject:Zt,key:_r,serviceIdentifier:re,targetType:Rr,value:Ot};if(this._middleware){if(_t=this._middleware(Kt),_t==null)throw new Error(K.INVALID_MIDDLEWARE_RETURN)}else _t=this._planAndResolve()(Kt);return _t},cr.prototype._planAndResolve=function(){var Rt=this;return function(Zt){var Rr=Ae.plan(Rt._metadataReader,Rt,Zt.isMultiInject,Zt.targetType,Zt.serviceIdentifier,Zt.key,Zt.value,Zt.avoidConstraints);Rr=Zt.contextInterceptor(Rr);var re=Xe.resolve(Rr);return re}},cr}();Se.Container=Er},33244:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.AsyncContainerModule=Se.ContainerModule=void 0;var We=fe(37791),de=function(){function Be(K){this.id=We.id(),this.registry=K}return Be}();Se.ContainerModule=de;var y=function(){function Be(K){this.id=We.id(),this.registry=K}return Be}();Se.AsyncContainerModule=y},85700:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.ContainerSnapshot=void 0;var fe=function(){function We(){}return We.of=function(de,y){var Be=new We;return Be.bindings=de,Be.middleware=y,Be},We}();Se.ContainerSnapshot=fe},80175:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Lookup=void 0;var We=fe(16674),de=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Be,K){if(Be==null)throw new Error(We.NULL_ARGUMENT);if(K==null)throw new Error(We.NULL_ARGUMENT);var ke=this._map.get(Be);ke!==void 0?(ke.push(K),this._map.set(Be,ke)):this._map.set(Be,[K])},y.prototype.get=function(Be){if(Be==null)throw new Error(We.NULL_ARGUMENT);var K=this._map.get(Be);if(K!==void 0)return K;throw new Error(We.KEY_NOT_FOUND)},y.prototype.remove=function(Be){if(Be==null)throw new Error(We.NULL_ARGUMENT);if(!this._map.delete(Be))throw new Error(We.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Be){var K=this;this._map.forEach(function(ke,he){var ut=ke.filter(function(Ae){return!Be(Ae)});ut.length>0?K._map.set(he,ut):K._map.delete(he)})},y.prototype.hasKey=function(Be){if(Be==null)throw new Error(We.NULL_ARGUMENT);return this._map.has(Be)},y.prototype.clone=function(){var Be=new y;return this._map.forEach(function(K,ke){K.forEach(function(he){return Be.add(ke,he.clone())})}),Be},y.prototype.traverse=function(Be){this._map.forEach(function(K,ke){Be(ke,K)})},y}();Se.Lookup=de},86700:function(pi,Se,fe){"use strict";var We;We={value:!0},We=We=We=We=We=We=Se.GW=We=We=Se.zY=We=We=We=We=We=Se.f3=We=We=Se.b2=We=We=We=We=We=Se.W2=We=void 0;var de=fe(6867);We=de;var y=fe(51389);Object.defineProperty(Se,"W2",{enumerable:!0,get:function(){return y.Container}});var Be=fe(28421);We={enumerable:!0,get:function(){return Be.BindingScopeEnum}},We={enumerable:!0,get:function(){return Be.BindingTypeEnum}},We={enumerable:!0,get:function(){return Be.TargetTypeEnum}};var K=fe(33244);We={enumerable:!0,get:function(){return K.AsyncContainerModule}},We={enumerable:!0,get:function(){return K.ContainerModule}};var ke=fe(64315);Object.defineProperty(Se,"b2",{enumerable:!0,get:function(){return ke.injectable}});var he=fe(32052);We={enumerable:!0,get:function(){return he.tagged}};var ut=fe(38085);We={enumerable:!0,get:function(){return ut.named}};var Ae=fe(5744);Object.defineProperty(Se,"f3",{enumerable:!0,get:function(){return Ae.inject}}),We={enumerable:!0,get:function(){return Ae.LazyServiceIdentifer}};var Xe=fe(6515);We={enumerable:!0,get:function(){return Xe.optional}};var Ct=fe(86757);We={enumerable:!0,get:function(){return Ct.unmanaged}};var Lt=fe(71693);We={enumerable:!0,get:function(){return Lt.multiInject}};var tr=fe(55638);We={enumerable:!0,get:function(){return tr.targetName}};var Yt=fe(7014);Object.defineProperty(Se,"zY",{enumerable:!0,get:function(){return Yt.postConstruct}});var Xt=fe(51377);We={enumerable:!0,get:function(){return Xt.MetadataReader}};var Er=fe(37791);We={enumerable:!0,get:function(){return Er.id}};var cr=fe(99934);Object.defineProperty(Se,"GW",{enumerable:!0,get:function(){return cr.decorate}});var Rt=fe(80758);We={enumerable:!0,get:function(){return Rt.traverseAncerstors}},We={enumerable:!0,get:function(){return Rt.taggedConstraint}},We={enumerable:!0,get:function(){return Rt.namedConstraint}},We={enumerable:!0,get:function(){return Rt.typeConstraint}};var Zt=fe(55800);We={enumerable:!0,get:function(){return Zt.getServiceIdentifierAsString}};var Rr=fe(70600);We={enumerable:!0,get:function(){return Rr.multiBindToService}}},95228:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Context=void 0;var We=fe(37791),de=function(){function y(Be){this.id=We.id(),this.container=Be}return y.prototype.addPlan=function(Be){this.plan=Be},y.prototype.setCurrentRequest=function(Be){this.currentRequest=Be},y}();Se.Context=de},47738:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Metadata=void 0;var We=fe(6867),de=function(){function y(Be,K){this.key=Be,this.value=K}return y.prototype.toString=function(){return this.key===We.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();Se.Metadata=de},51377:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.MetadataReader=void 0;var We=fe(6867),de=function(){function y(){}return y.prototype.getConstructorMetadata=function(Be){var K=Reflect.getMetadata(We.PARAM_TYPES,Be),ke=Reflect.getMetadata(We.TAGGED,Be);return{compilerGeneratedMetadata:K,userGeneratedMetadata:ke||{}}},y.prototype.getPropertiesMetadata=function(Be){var K=Reflect.getMetadata(We.TAGGED_PROP,Be)||[];return K},y}();Se.MetadataReader=de},55314:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Plan=void 0;var fe=function(){function We(de,y){this.parentContext=de,this.rootRequest=y}return We}();Se.Plan=fe},86311:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.getBindingDictionary=Se.createMockRequest=Se.plan=void 0;var We=fe(23184),de=fe(16674),y=fe(28421),Be=fe(6867),K=fe(85265),ke=fe(55800),he=fe(95228),ut=fe(47738),Ae=fe(55314),Xe=fe(6e3),Ct=fe(6748),Lt=fe(18924);function tr(re){return re._bindingDictionary}Se.getBindingDictionary=tr;function Yt(re,_r,Ot,_t,Kt,Ue){var Cr=re?Be.MULTI_INJECT_TAG:Be.INJECT_TAG,nn=new ut.Metadata(Cr,Ot),ue=new Lt.Target(_r,_t,Ot,nn);if(Kt!==void 0){var tt=new ut.Metadata(Kt,Ue);ue.metadata.push(tt)}return ue}function Xt(re,_r,Ot,_t,Kt){var Ue=Rt(Ot.container,Kt.serviceIdentifier),Cr=[];return Ue.length===We.BindingCount.NoBindingsAvailable&&Ot.container.options.autoBindInjectable&&typeof Kt.serviceIdentifier=="function"&&re.getConstructorMetadata(Kt.serviceIdentifier).compilerGeneratedMetadata&&(Ot.container.bind(Kt.serviceIdentifier).toSelf(),Ue=Rt(Ot.container,Kt.serviceIdentifier)),_r?Cr=Ue:Cr=Ue.filter(function(nn){var ue=new Ct.Request(nn.serviceIdentifier,Ot,_t,nn,Kt);return nn.constraint(ue)}),Er(Kt.serviceIdentifier,Cr,Kt,Ot.container),Cr}function Er(re,_r,Ot,_t){switch(_r.length){case We.BindingCount.NoBindingsAvailable:if(Ot.isOptional())return _r;var Kt=ke.getServiceIdentifierAsString(re),Ue=de.NOT_REGISTERED;throw Ue+=ke.listMetadataForTarget(Kt,Ot),Ue+=ke.listRegisteredBindingsForServiceIdentifier(_t,Kt,Rt),new Error(Ue);case We.BindingCount.OnlyOneBindingAvailable:if(!Ot.isArray())return _r;case We.BindingCount.MultipleBindingsAvailable:default:if(Ot.isArray())return _r;var Kt=ke.getServiceIdentifierAsString(re),Ue=de.AMBIGUOUS_MATCH+" "+Kt;throw Ue+=ke.listRegisteredBindingsForServiceIdentifier(_t,Kt,Rt),new Error(Ue)}}function cr(re,_r,Ot,_t,Kt,Ue){var Cr,nn;if(Kt===null){Cr=Xt(re,_r,_t,null,Ue),nn=new Ct.Request(Ot,_t,null,Cr,Ue);var ue=new Ae.Plan(_t,nn);_t.addPlan(ue)}else Cr=Xt(re,_r,_t,Kt,Ue),nn=Kt.addChildRequest(Ue.serviceIdentifier,Cr,Ue);Cr.forEach(function(tt){var Z=null;if(Ue.isArray())Z=nn.addChildRequest(tt.serviceIdentifier,tt,Ue);else{if(tt.cache)return;Z=nn}if(tt.type===y.BindingTypeEnum.Instance&&tt.implementationType!==null){var _e=Xe.getDependencies(re,tt.implementationType);if(!_t.container.options.skipBaseClassChecks){var ze=Xe.getBaseClassDependencyCount(re,tt.implementationType);if(_e.length<ze){var wt=de.ARGUMENTS_LENGTH_MISMATCH(Xe.getFunctionName(tt.implementationType));throw new Error(wt)}}_e.forEach(function(Vt){cr(re,!1,Vt.serviceIdentifier,_t,Z,Vt)})}})}function Rt(re,_r){var Ot=[],_t=tr(re);return _t.hasKey(_r)?Ot=_t.get(_r):re.parent!==null&&(Ot=Rt(re.parent,_r)),Ot}function Zt(re,_r,Ot,_t,Kt,Ue,Cr,nn){nn===void 0&&(nn=!1);var ue=new he.Context(_r),tt=Yt(Ot,_t,Kt,"",Ue,Cr);try{return cr(re,nn,Kt,ue,null,tt),ue}catch(Z){throw K.isStackOverflowExeption(Z)&&ue.plan&&ke.circularDependencyToException(ue.plan.rootRequest),Z}}Se.plan=Zt;function Rr(re,_r,Ot,_t){var Kt=new Lt.Target(y.TargetTypeEnum.Variable,"",_r,new ut.Metadata(Ot,_t)),Ue=new he.Context(re),Cr=new Ct.Request(_r,Ue,null,[],Kt);return Cr}Se.createMockRequest=Rr},88460:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.QueryableString=void 0;var fe=function(){function We(de){this.str=de}return We.prototype.startsWith=function(de){return this.str.indexOf(de)===0},We.prototype.endsWith=function(de){var y="",Be=de.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Be)},We.prototype.contains=function(de){return this.str.indexOf(de)!==-1},We.prototype.equals=function(de){return this.str===de},We.prototype.value=function(){return this.str},We}();Se.QueryableString=fe},6e3:function(pi,Se,fe){"use strict";var We=this&&this.__spreadArray||function(Xt,Er){for(var cr=0,Rt=Er.length,Zt=Xt.length;cr<Rt;cr++,Zt++)Xt[Zt]=Er[cr];return Xt};Object.defineProperty(Se,"__esModule",{value:!0}),Se.getFunctionName=Se.getBaseClassDependencyCount=Se.getDependencies=void 0;var de=fe(5744),y=fe(16674),Be=fe(28421),K=fe(6867),ke=fe(55800);Object.defineProperty(Se,"getFunctionName",{enumerable:!0,get:function(){return ke.getFunctionName}});var he=fe(18924);function ut(Xt,Er){var cr=ke.getFunctionName(Er),Rt=Ae(Xt,cr,Er,!1);return Rt}Se.getDependencies=ut;function Ae(Xt,Er,cr,Rt){var Zt=Xt.getConstructorMetadata(cr),Rr=Zt.compilerGeneratedMetadata;if(Rr===void 0){var re=y.MISSING_INJECTABLE_ANNOTATION+" "+Er+".";throw new Error(re)}var _r=Zt.userGeneratedMetadata,Ot=Object.keys(_r),_t=cr.length===0&&Ot.length>0,Kt=Ot.length>cr.length,Ue=_t||Kt?Ot.length:cr.length,Cr=Ct(Rt,Er,Rr,_r,Ue),nn=Lt(Xt,cr),ue=We(We([],Cr),nn);return ue}function Xe(Xt,Er,cr,Rt,Zt){var Rr=Zt[Xt.toString()]||[],re=Yt(Rr),_r=re.unmanaged!==!0,Ot=Rt[Xt],_t=re.inject||re.multiInject;if(Ot=_t||Ot,Ot instanceof de.LazyServiceIdentifer&&(Ot=Ot.unwrap()),_r){var Kt=Ot===Object,Ue=Ot===Function,Cr=Ot===void 0,nn=Kt||Ue||Cr;if(!Er&&nn){var ue=y.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+cr+".";throw new Error(ue)}var tt=new he.Target(Be.TargetTypeEnum.ConstructorArgument,re.targetName,Ot);return tt.metadata=Rr,tt}return null}function Ct(Xt,Er,cr,Rt,Zt){for(var Rr=[],re=0;re<Zt;re++){var _r=re,Ot=Xe(_r,Xt,Er,cr,Rt);Ot!==null&&Rr.push(Ot)}return Rr}function Lt(Xt,Er){for(var cr=Xt.getPropertiesMetadata(Er),Rt=[],Zt=Object.keys(cr),Rr=0,re=Zt;Rr<re.length;Rr++){var _r=re[Rr],Ot=cr[_r],_t=Yt(cr[_r]),Kt=_t.targetName||_r,Ue=_t.inject||_t.multiInject,Cr=new he.Target(Be.TargetTypeEnum.ClassProperty,Kt,Ue);Cr.metadata=Ot,Rt.push(Cr)}var nn=Object.getPrototypeOf(Er.prototype).constructor;if(nn!==Object){var ue=Lt(Xt,nn);Rt=We(We([],Rt),ue)}return Rt}function tr(Xt,Er){var cr=Object.getPrototypeOf(Er.prototype).constructor;if(cr!==Object){var Rt=ke.getFunctionName(cr),Zt=Ae(Xt,Rt,cr,!0),Rr=Zt.map(function(Ot){return Ot.metadata.filter(function(_t){return _t.key===K.UNMANAGED_TAG})}),re=[].concat.apply([],Rr).length,_r=Zt.length-re;return _r>0?_r:tr(Xt,cr)}else return 0}Se.getBaseClassDependencyCount=tr;function Yt(Xt){var Er={};return Xt.forEach(function(cr){Er[cr.key.toString()]=cr.value}),{inject:Er[K.INJECT_TAG],multiInject:Er[K.MULTI_INJECT_TAG],targetName:Er[K.NAME_TAG],unmanaged:Er[K.UNMANAGED_TAG]}}},6748:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Request=void 0;var We=fe(37791),de=function(){function y(Be,K,ke,he,ut){this.id=We.id(),this.serviceIdentifier=Be,this.parentContext=K,this.parentRequest=ke,this.target=ut,this.childRequests=[],this.bindings=Array.isArray(he)?he:[he],this.requestScope=ke===null?new Map:null}return y.prototype.addChildRequest=function(Be,K,ke){var he=new y(Be,this.parentContext,this,K,ke);return this.childRequests.push(he),he},y}();Se.Request=de},18924:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.Target=void 0;var We=fe(6867),de=fe(37791),y=fe(47738),Be=fe(88460),K=function(){function ke(he,ut,Ae,Xe){this.id=de.id(),this.type=he,this.serviceIdentifier=Ae,this.name=new Be.QueryableString(ut||""),this.metadata=new Array;var Ct=null;typeof Xe=="string"?Ct=new y.Metadata(We.NAMED_TAG,Xe):Xe instanceof y.Metadata&&(Ct=Xe),Ct!==null&&this.metadata.push(Ct)}return ke.prototype.hasTag=function(he){for(var ut=0,Ae=this.metadata;ut<Ae.length;ut++){var Xe=Ae[ut];if(Xe.key===he)return!0}return!1},ke.prototype.isArray=function(){return this.hasTag(We.MULTI_INJECT_TAG)},ke.prototype.matchesArray=function(he){return this.matchesTag(We.MULTI_INJECT_TAG)(he)},ke.prototype.isNamed=function(){return this.hasTag(We.NAMED_TAG)},ke.prototype.isTagged=function(){return this.metadata.some(function(he){return We.NON_CUSTOM_TAG_KEYS.every(function(ut){return he.key!==ut})})},ke.prototype.isOptional=function(){return this.matchesTag(We.OPTIONAL_TAG)(!0)},ke.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(he){return he.key===We.NAMED_TAG})[0]:null},ke.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(he){return We.NON_CUSTOM_TAG_KEYS.every(function(ut){return he.key!==ut})}):null},ke.prototype.matchesNamedTag=function(he){return this.matchesTag(We.NAMED_TAG)(he)},ke.prototype.matchesTag=function(he){var ut=this;return function(Ae){for(var Xe=0,Ct=ut.metadata;Xe<Ct.length;Xe++){var Lt=Ct[Xe];if(Lt.key===he&&Lt.value===Ae)return!0}return!1}},ke}();Se.Target=K},52279:function(pi,Se,fe){"use strict";var We=this&&this.__spreadArray||function(Ae,Xe){for(var Ct=0,Lt=Xe.length,tr=Ae.length;Ct<Lt;Ct++,tr++)Ae[tr]=Xe[Ct];return Ae};Object.defineProperty(Se,"__esModule",{value:!0}),Se.resolveInstance=void 0;var de=fe(16674),y=fe(28421),Be=fe(6867);function K(Ae,Xe,Ct){var Lt=Xe.filter(function(Yt){return Yt.target!==null&&Yt.target.type===y.TargetTypeEnum.ClassProperty}),tr=Lt.map(Ct);return Lt.forEach(function(Yt,Xt){var Er="";Er=Yt.target.name.value();var cr=tr[Xt];Ae[Er]=cr}),Ae}function ke(Ae,Xe){return new(Ae.bind.apply(Ae,We([void 0],Xe)))}function he(Ae,Xe){if(Reflect.hasMetadata(Be.POST_CONSTRUCT,Ae)){var Ct=Reflect.getMetadata(Be.POST_CONSTRUCT,Ae);try{Xe[Ct.value]()}catch(Lt){throw new Error(de.POST_CONSTRUCT_ERROR(Ae.name,Lt.message))}}}function ut(Ae,Xe,Ct){var Lt=null;if(Xe.length>0){var tr=Xe.filter(function(Xt){return Xt.target!==null&&Xt.target.type===y.TargetTypeEnum.ConstructorArgument}),Yt=tr.map(Ct);Lt=ke(Ae,Yt),Lt=K(Lt,Xe,Ct)}else Lt=new Ae;return he(Ae,Lt),Lt}Se.resolveInstance=ut},31927:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.resolve=void 0;var We=fe(16674),de=fe(28421),y=fe(85265),Be=fe(55800),K=fe(52279),ke=function(Ae,Xe,Ct){try{return Ct()}catch(Lt){throw y.isStackOverflowExeption(Lt)?new Error(We.CIRCULAR_DEPENDENCY_IN_FACTORY(Ae,Xe.toString())):Lt}},he=function(Ae){return function(Xe){Xe.parentContext.setCurrentRequest(Xe);var Ct=Xe.bindings,Lt=Xe.childRequests,tr=Xe.target&&Xe.target.isArray(),Yt=!Xe.parentRequest||!Xe.parentRequest.target||!Xe.target||!Xe.parentRequest.target.matchesArray(Xe.target.serviceIdentifier);if(tr&&Yt)return Lt.map(function(Rr){var re=he(Ae);return re(Rr)});var Xt=null;if(Xe.target.isOptional()&&Ct.length===0)return;var Er=Ct[0],cr=Er.scope===de.BindingScopeEnum.Singleton,Rt=Er.scope===de.BindingScopeEnum.Request;if(cr&&Er.activated)return Er.cache;if(Rt&&Ae!==null&&Ae.has(Er.id))return Ae.get(Er.id);if(Er.type===de.BindingTypeEnum.ConstantValue)Xt=Er.cache,Er.activated=!0;else if(Er.type===de.BindingTypeEnum.Function)Xt=Er.cache,Er.activated=!0;else if(Er.type===de.BindingTypeEnum.Constructor)Xt=Er.implementationType;else if(Er.type===de.BindingTypeEnum.DynamicValue&&Er.dynamicValue!==null)Xt=ke("toDynamicValue",Er.serviceIdentifier,function(){return Er.dynamicValue(Xe.parentContext)});else if(Er.type===de.BindingTypeEnum.Factory&&Er.factory!==null)Xt=ke("toFactory",Er.serviceIdentifier,function(){return Er.factory(Xe.parentContext)});else if(Er.type===de.BindingTypeEnum.Provider&&Er.provider!==null)Xt=ke("toProvider",Er.serviceIdentifier,function(){return Er.provider(Xe.parentContext)});else if(Er.type===de.BindingTypeEnum.Instance&&Er.implementationType!==null)Xt=K.resolveInstance(Er.implementationType,Lt,he(Ae));else{var Zt=Be.getServiceIdentifierAsString(Xe.serviceIdentifier);throw new Error(We.INVALID_BINDING_TYPE+" "+Zt)}return typeof Er.onActivation=="function"&&(Xt=Er.onActivation(Xe.parentContext,Xt)),cr&&(Er.cache=Xt,Er.activated=!0),Rt&&Ae!==null&&!Ae.has(Er.id)&&Ae.set(Er.id,Xt),Xt}};function ut(Ae){var Xe=he(Ae.plan.rootRequest.requestScope);return Xe(Ae.plan.rootRequest)}Se.resolve=ut},83366:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingInSyntax=void 0;var We=fe(28421),de=fe(71325),y=function(){function Be(K){this._binding=K}return Be.prototype.inRequestScope=function(){return this._binding.scope=We.BindingScopeEnum.Request,new de.BindingWhenOnSyntax(this._binding)},Be.prototype.inSingletonScope=function(){return this._binding.scope=We.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},Be.prototype.inTransientScope=function(){return this._binding.scope=We.BindingScopeEnum.Transient,new de.BindingWhenOnSyntax(this._binding)},Be}();Se.BindingInSyntax=y},74889:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingInWhenOnSyntax=void 0;var We=fe(83366),de=fe(51811),y=fe(98370),Be=function(){function K(ke){this._binding=ke,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new de.BindingOnSyntax(this._binding),this._bindingInSyntax=new We.BindingInSyntax(ke)}return K.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},K.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},K.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},K.prototype.when=function(ke){return this._bindingWhenSyntax.when(ke)},K.prototype.whenTargetNamed=function(ke){return this._bindingWhenSyntax.whenTargetNamed(ke)},K.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},K.prototype.whenTargetTagged=function(ke,he){return this._bindingWhenSyntax.whenTargetTagged(ke,he)},K.prototype.whenInjectedInto=function(ke){return this._bindingWhenSyntax.whenInjectedInto(ke)},K.prototype.whenParentNamed=function(ke){return this._bindingWhenSyntax.whenParentNamed(ke)},K.prototype.whenParentTagged=function(ke,he){return this._bindingWhenSyntax.whenParentTagged(ke,he)},K.prototype.whenAnyAncestorIs=function(ke){return this._bindingWhenSyntax.whenAnyAncestorIs(ke)},K.prototype.whenNoAncestorIs=function(ke){return this._bindingWhenSyntax.whenNoAncestorIs(ke)},K.prototype.whenAnyAncestorNamed=function(ke){return this._bindingWhenSyntax.whenAnyAncestorNamed(ke)},K.prototype.whenAnyAncestorTagged=function(ke,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(ke,he)},K.prototype.whenNoAncestorNamed=function(ke){return this._bindingWhenSyntax.whenNoAncestorNamed(ke)},K.prototype.whenNoAncestorTagged=function(ke,he){return this._bindingWhenSyntax.whenNoAncestorTagged(ke,he)},K.prototype.whenAnyAncestorMatches=function(ke){return this._bindingWhenSyntax.whenAnyAncestorMatches(ke)},K.prototype.whenNoAncestorMatches=function(ke){return this._bindingWhenSyntax.whenNoAncestorMatches(ke)},K.prototype.onActivation=function(ke){return this._bindingOnSyntax.onActivation(ke)},K}();Se.BindingInWhenOnSyntax=Be},51811:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingOnSyntax=void 0;var We=fe(98370),de=function(){function y(Be){this._binding=Be}return y.prototype.onActivation=function(Be){return this._binding.onActivation=Be,new We.BindingWhenSyntax(this._binding)},y}();Se.BindingOnSyntax=de},15451:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingToSyntax=void 0;var We=fe(16674),de=fe(28421),y=fe(74889),Be=fe(71325),K=function(){function ke(he){this._binding=he}return ke.prototype.to=function(he){return this._binding.type=de.BindingTypeEnum.Instance,this._binding.implementationType=he,new y.BindingInWhenOnSyntax(this._binding)},ke.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+We.INVALID_TO_SELF_VALUE);var he=this._binding.serviceIdentifier;return this.to(he)},ke.prototype.toConstantValue=function(he){return this._binding.type=de.BindingTypeEnum.ConstantValue,this._binding.cache=he,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=de.BindingScopeEnum.Singleton,new Be.BindingWhenOnSyntax(this._binding)},ke.prototype.toDynamicValue=function(he){return this._binding.type=de.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=he,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ke.prototype.toConstructor=function(he){return this._binding.type=de.BindingTypeEnum.Constructor,this._binding.implementationType=he,this._binding.scope=de.BindingScopeEnum.Singleton,new Be.BindingWhenOnSyntax(this._binding)},ke.prototype.toFactory=function(he){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=he,this._binding.scope=de.BindingScopeEnum.Singleton,new Be.BindingWhenOnSyntax(this._binding)},ke.prototype.toFunction=function(he){if(typeof he!="function")throw new Error(We.INVALID_FUNCTION_BINDING);var ut=this.toConstantValue(he);return this._binding.type=de.BindingTypeEnum.Function,this._binding.scope=de.BindingScopeEnum.Singleton,ut},ke.prototype.toAutoFactory=function(he){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=function(ut){var Ae=function(){return ut.container.get(he)};return Ae},this._binding.scope=de.BindingScopeEnum.Singleton,new Be.BindingWhenOnSyntax(this._binding)},ke.prototype.toProvider=function(he){return this._binding.type=de.BindingTypeEnum.Provider,this._binding.provider=he,this._binding.scope=de.BindingScopeEnum.Singleton,new Be.BindingWhenOnSyntax(this._binding)},ke.prototype.toService=function(he){this.toDynamicValue(function(ut){return ut.container.get(he)})},ke}();Se.BindingToSyntax=K},71325:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingWhenOnSyntax=void 0;var We=fe(51811),de=fe(98370),y=function(){function Be(K){this._binding=K,this._bindingWhenSyntax=new de.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new We.BindingOnSyntax(this._binding)}return Be.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},Be.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},Be.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Be.prototype.whenTargetTagged=function(K,ke){return this._bindingWhenSyntax.whenTargetTagged(K,ke)},Be.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},Be.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},Be.prototype.whenParentTagged=function(K,ke){return this._bindingWhenSyntax.whenParentTagged(K,ke)},Be.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},Be.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},Be.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},Be.prototype.whenAnyAncestorTagged=function(K,ke){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,ke)},Be.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},Be.prototype.whenNoAncestorTagged=function(K,ke){return this._bindingWhenSyntax.whenNoAncestorTagged(K,ke)},Be.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},Be.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},Be.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},Be}();Se.BindingWhenOnSyntax=y},98370:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.BindingWhenSyntax=void 0;var We=fe(51811),de=fe(80758),y=function(){function Be(K){this._binding=K}return Be.prototype.when=function(K){return this._binding.constraint=K,new We.BindingOnSyntax(this._binding)},Be.prototype.whenTargetNamed=function(K){return this._binding.constraint=de.namedConstraint(K),new We.BindingOnSyntax(this._binding)},Be.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(K){var ke=K.target!==null&&!K.target.isNamed()&&!K.target.isTagged();return ke},new We.BindingOnSyntax(this._binding)},Be.prototype.whenTargetTagged=function(K,ke){return this._binding.constraint=de.taggedConstraint(K)(ke),new We.BindingOnSyntax(this._binding)},Be.prototype.whenInjectedInto=function(K){return this._binding.constraint=function(ke){return de.typeConstraint(K)(ke.parentRequest)},new We.BindingOnSyntax(this._binding)},Be.prototype.whenParentNamed=function(K){return this._binding.constraint=function(ke){return de.namedConstraint(K)(ke.parentRequest)},new We.BindingOnSyntax(this._binding)},Be.prototype.whenParentTagged=function(K,ke){return this._binding.constraint=function(he){return de.taggedConstraint(K)(ke)(he.parentRequest)},new We.BindingOnSyntax(this._binding)},Be.prototype.whenAnyAncestorIs=function(K){return this._binding.constraint=function(ke){return de.traverseAncerstors(ke,de.typeConstraint(K))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenNoAncestorIs=function(K){return this._binding.constraint=function(ke){return!de.traverseAncerstors(ke,de.typeConstraint(K))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenAnyAncestorNamed=function(K){return this._binding.constraint=function(ke){return de.traverseAncerstors(ke,de.namedConstraint(K))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenNoAncestorNamed=function(K){return this._binding.constraint=function(ke){return!de.traverseAncerstors(ke,de.namedConstraint(K))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenAnyAncestorTagged=function(K,ke){return this._binding.constraint=function(he){return de.traverseAncerstors(he,de.taggedConstraint(K)(ke))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenNoAncestorTagged=function(K,ke){return this._binding.constraint=function(he){return!de.traverseAncerstors(he,de.taggedConstraint(K)(ke))},new We.BindingOnSyntax(this._binding)},Be.prototype.whenAnyAncestorMatches=function(K){return this._binding.constraint=function(ke){return de.traverseAncerstors(ke,K)},new We.BindingOnSyntax(this._binding)},Be.prototype.whenNoAncestorMatches=function(K){return this._binding.constraint=function(ke){return!de.traverseAncerstors(ke,K)},new We.BindingOnSyntax(this._binding)},Be}();Se.BindingWhenSyntax=y},80758:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.typeConstraint=Se.namedConstraint=Se.taggedConstraint=Se.traverseAncerstors=void 0;var We=fe(6867),de=fe(47738),y=function(he,ut){var Ae=he.parentRequest;return Ae!==null?ut(Ae)?!0:y(Ae,ut):!1};Se.traverseAncerstors=y;var Be=function(he){return function(ut){var Ae=function(Xe){return Xe!==null&&Xe.target!==null&&Xe.target.matchesTag(he)(ut)};return Ae.metaData=new de.Metadata(he,ut),Ae}};Se.taggedConstraint=Be;var K=Be(We.NAMED_TAG);Se.namedConstraint=K;var ke=function(he){return function(ut){var Ae=null;if(ut!==null)if(Ae=ut.bindings[0],typeof he=="string"){var Xe=Ae.serviceIdentifier;return Xe===he}else{var Ct=ut.bindings[0].implementationType;return he===Ct}return!1}};Se.typeConstraint=ke},70600:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.multiBindToService=void 0;var fe=function(We){return function(de){return function(){for(var y=[],Be=0;Be<arguments.length;Be++)y[Be]=arguments[Be];return y.forEach(function(K){return We.bind(K).toService(de)})}}};Se.multiBindToService=fe},85265:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.isStackOverflowExeption=void 0;var We=fe(16674);function de(y){return y instanceof RangeError||y.message===We.STACK_OVERFLOW}Se.isStackOverflowExeption=de},37791:function(pi,Se){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.id=void 0;var fe=0;function We(){return fe++}Se.id=We},55800:function(pi,Se,fe){"use strict";Object.defineProperty(Se,"__esModule",{value:!0}),Se.circularDependencyToException=Se.listMetadataForTarget=Se.listRegisteredBindingsForServiceIdentifier=Se.getServiceIdentifierAsString=Se.getFunctionName=void 0;var We=fe(16674);function de(Ae){if(typeof Ae=="function"){var Xe=Ae;return Xe.name}else{if(typeof Ae=="symbol")return Ae.toString();var Xe=Ae;return Xe}}Se.getServiceIdentifierAsString=de;function y(Ae,Xe,Ct){var Lt="",tr=Ct(Ae,Xe);return tr.length!==0&&(Lt=`
Registered bindings:`,tr.forEach(function(Yt){var Xt="Object";Yt.implementationType!==null&&(Xt=ut(Yt.implementationType)),Lt=Lt+`
 `+Xt,Yt.constraint.metaData&&(Lt=Lt+" - "+Yt.constraint.metaData)})),Lt}Se.listRegisteredBindingsForServiceIdentifier=y;function Be(Ae,Xe){return Ae.parentRequest===null?!1:Ae.parentRequest.serviceIdentifier===Xe?!0:Be(Ae.parentRequest,Xe)}function K(Ae){function Xe(Lt,tr){tr===void 0&&(tr=[]);var Yt=de(Lt.serviceIdentifier);return tr.push(Yt),Lt.parentRequest!==null?Xe(Lt.parentRequest,tr):tr}var Ct=Xe(Ae);return Ct.reverse().join(" --> ")}function ke(Ae){Ae.childRequests.forEach(function(Xe){if(Be(Xe,Xe.serviceIdentifier)){var Ct=K(Xe);throw new Error(We.CIRCULAR_DEPENDENCY+" "+Ct)}else ke(Xe)})}Se.circularDependencyToException=ke;function he(Ae,Xe){if(Xe.isTagged()||Xe.isNamed()){var Ct="",Lt=Xe.getNamedTag(),tr=Xe.getCustomTags();return Lt!==null&&(Ct+=Lt.toString()+`
`),tr!==null&&tr.forEach(function(Yt){Ct+=Yt.toString()+`
`})," "+Ae+`
 `+Ae+" - "+Ct}else return" "+Ae}Se.listMetadataForTarget=he;function ut(Ae){if(Ae.name)return Ae.name;var Xe=Ae.toString(),Ct=Xe.match(/^function\s*([^\s(]+)/);return Ct?Ct[1]:"Anonymous function: "+Xe}Se.getFunctionName=ut},31745:function(pi){"use strict";pi.exports=fe,pi.exports.default=fe;var Se=1e20;function fe(K,ke,he,ut,Ae,Xe){this.fontSize=K||24,this.buffer=ke===void 0?3:ke,this.cutoff=ut||.25,this.fontFamily=Ae||"sans-serif",this.fontWeight=Xe||"normal",this.radius=he||8;var Ct=this.size=this.fontSize+this.buffer*2,Lt=Ct+this.buffer*2,tr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;tr?this.canvas=my.createOffscreenCanvas(Ct,Ct,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ct),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Lt*Lt),this.gridInner=new Float64Array(Lt*Lt),this.f=new Float64Array(Lt),this.z=new Float64Array(Lt+1),this.v=new Uint16Array(Lt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,tr?this.middle=Math.round(Ct/2*1):this.middle=Math.round(Ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function We(K,ke,he,ut,Ae,Xe,Ct){Xe.fill(Se,0,ke*he),Ct.fill(0,0,ke*he);for(var Lt=(ke-ut)/2,tr=0;tr<Ae;tr++)for(var Yt=0;Yt<ut;Yt++){var Xt=(tr+Lt)*ke+Yt+Lt,Er=K.data[4*(tr*ut+Yt)+3]/255;if(Er===1)Xe[Xt]=0,Ct[Xt]=Se;else if(Er===0)Xe[Xt]=Se,Ct[Xt]=0;else{var cr=Math.max(0,.5-Er),Rt=Math.max(0,Er-.5);Xe[Xt]=cr*cr,Ct[Xt]=Rt*Rt}}}function de(K,ke,he,ut,Ae,Xe,Ct){for(var Lt=0;Lt<ke*he;Lt++){var tr=Math.sqrt(ut[Lt])-Math.sqrt(Ae[Lt]);K[Lt]=Math.round(255-255*(tr/Xe+Ct))}}fe.prototype._draw=function(K,ke){var he=this.ctx.measureText(K),ut=he.width,Ae=2*this.buffer,Xe,Ct,Lt,tr,Yt,Xt,Er,cr;ke&&this.useMetrics?(Yt=Math.floor(he.actualBoundingBoxAscent),cr=this.buffer+Math.ceil(he.actualBoundingBoxAscent),Xt=this.buffer,Er=this.buffer,Ct=Math.min(this.size,Math.ceil(he.actualBoundingBoxRight-he.actualBoundingBoxLeft)),tr=Math.min(this.size-Xt,Math.ceil(he.actualBoundingBoxAscent+he.actualBoundingBoxDescent)),Xe=Ct+Ae,Lt=tr+Ae,this.ctx.textBaseline="alphabetic"):(Xe=Ct=this.size,Lt=tr=this.size,Yt=19*this.fontSize/24,Xt=Er=0,cr=this.middle,this.ctx.textBaseline="middle");var Rt;Ct&&tr&&(this.ctx.clearRect(Er,Xt,Ct,tr),this.ctx.fillText(K,this.buffer,cr),Rt=this.ctx.getImageData(Er,Xt,Ct,tr));var Zt=new Uint8ClampedArray(Xe*Lt);return We(Rt,Xe,Lt,Ct,tr,this.gridOuter,this.gridInner),y(this.gridOuter,Xe,Lt,this.f,this.v,this.z),y(this.gridInner,Xe,Lt,this.f,this.v,this.z),de(Zt,Xe,Lt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Zt,metrics:{width:Ct,height:tr,sdfWidth:Xe,sdfHeight:Lt,top:Yt,left:0,advance:ut}}},fe.prototype.draw=function(K){return this._draw(K,!1).data},fe.prototype.drawWithMetrics=function(K){return this._draw(K,!0)};function y(K,ke,he,ut,Ae,Xe){for(var Ct=0;Ct<ke;Ct++)Be(K,Ct,ke,he,ut,Ae,Xe);for(var Lt=0;Lt<he;Lt++)Be(K,Lt*ke,1,ke,ut,Ae,Xe)}function Be(K,ke,he,ut,Ae,Xe,Ct){var Lt,tr,Yt,Xt;for(Xe[0]=0,Ct[0]=-Se,Ct[1]=Se,Lt=0;Lt<ut;Lt++)Ae[Lt]=K[ke+Lt*he];for(Lt=1,tr=0,Yt=0;Lt<ut;Lt++){do Xt=Xe[tr],Yt=(Ae[Lt]-Ae[Xt]+Lt*Lt-Xt*Xt)/(Lt-Xt)/2;while(Yt<=Ct[tr]&&--tr>-1);tr++,Xe[tr]=Lt,Ct[tr]=Yt,Ct[tr+1]=Se}for(Lt=0,tr=0;Lt<ut;Lt++){for(;Ct[tr+1]<Lt;)tr++;Xt=Xe[tr],K[ke+Lt*he]=Ae[Xt]+(Lt-Xt)*(Lt-Xt)}}},18857:function(pi,Se,fe){"use strict";fe.r(Se),fe.d(Se,{Function:function(){return ll},Interpreter:function(){return fs},default:function(){return Fc},evaluate:function(){return lf},vm:function(){return We}});var We={};fe.r(We),fe.d(We,{Script:function(){return Xs},compileFunction:function(){return Au},createContext:function(){return nu},runInContext:function(){return uf},runInNewContext:function(){return Vh}});var de={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Be={5:y,"5module":y+" export import",6:y+" const class extends export import super"},K=/^in(stanceof)?$/,ke="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",he="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ut=new RegExp("["+ke+"]"),Ae=new RegExp("["+ke+he+"]");ke=he=null;var Xe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ct=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Lt(b,k){for(var G=65536,D=0;D<k.length;D+=2){if(G+=k[D],G>b)return!1;if(G+=k[D+1],G>=b)return!0}}function tr(b,k){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&ut.test(String.fromCharCode(b)):k===!1?!1:Lt(b,Xe)}function Yt(b,k){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Ae.test(String.fromCharCode(b)):k===!1?!1:Lt(b,Xe)||Lt(b,Ct)}var Xt=function(k,G){G===void 0&&(G={}),this.label=k,this.keyword=G.keyword,this.beforeExpr=!!G.beforeExpr,this.startsExpr=!!G.startsExpr,this.isLoop=!!G.isLoop,this.isAssign=!!G.isAssign,this.prefix=!!G.prefix,this.postfix=!!G.postfix,this.binop=G.binop||null,this.updateContext=null};function Er(b,k){return new Xt(b,{beforeExpr:!0,binop:k})}var cr={beforeExpr:!0},Rt={startsExpr:!0},Zt={};function Rr(b,k){return k===void 0&&(k={}),k.keyword=b,Zt[b]=new Xt(b,k)}var re={num:new Xt("num",Rt),regexp:new Xt("regexp",Rt),string:new Xt("string",Rt),name:new Xt("name",Rt),eof:new Xt("eof"),bracketL:new Xt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Xt("]"),braceL:new Xt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Xt("}"),parenL:new Xt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Xt(")"),comma:new Xt(",",cr),semi:new Xt(";",cr),colon:new Xt(":",cr),dot:new Xt("."),question:new Xt("?",cr),questionDot:new Xt("?."),arrow:new Xt("=>",cr),template:new Xt("template"),invalidTemplate:new Xt("invalidTemplate"),ellipsis:new Xt("...",cr),backQuote:new Xt("`",Rt),dollarBraceL:new Xt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Xt("=",{beforeExpr:!0,isAssign:!0}),assign:new Xt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Xt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Xt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Er("||",1),logicalAND:Er("&&",2),bitwiseOR:Er("|",3),bitwiseXOR:Er("^",4),bitwiseAND:Er("&",5),equality:Er("==/!=/===/!==",6),relational:Er("</>/<=/>=",7),bitShift:Er("<</>>/>>>",8),plusMin:new Xt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Er("%",10),star:Er("*",10),slash:Er("/",10),starstar:new Xt("**",{beforeExpr:!0}),coalesce:Er("??",1),_break:Rr("break"),_case:Rr("case",cr),_catch:Rr("catch"),_continue:Rr("continue"),_debugger:Rr("debugger"),_default:Rr("default",cr),_do:Rr("do",{isLoop:!0,beforeExpr:!0}),_else:Rr("else",cr),_finally:Rr("finally"),_for:Rr("for",{isLoop:!0}),_function:Rr("function",Rt),_if:Rr("if"),_return:Rr("return",cr),_switch:Rr("switch"),_throw:Rr("throw",cr),_try:Rr("try"),_var:Rr("var"),_const:Rr("const"),_while:Rr("while",{isLoop:!0}),_with:Rr("with"),_new:Rr("new",{beforeExpr:!0,startsExpr:!0}),_this:Rr("this",Rt),_super:Rr("super",Rt),_class:Rr("class",Rt),_extends:Rr("extends",cr),_export:Rr("export"),_import:Rr("import",Rt),_null:Rr("null",Rt),_true:Rr("true",Rt),_false:Rr("false",Rt),_in:Rr("in",{beforeExpr:!0,binop:7}),_instanceof:Rr("instanceof",{beforeExpr:!0,binop:7}),_typeof:Rr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Rr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Rr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},_r=/\r\n?|\n|\u2028|\u2029/,Ot=new RegExp(_r.source,"g");function _t(b,k){return b===10||b===13||!k&&(b===8232||b===8233)}var Kt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ue=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Cr=Object.prototype,nn=Cr.hasOwnProperty,ue=Cr.toString;function tt(b,k){return nn.call(b,k)}var Z=Array.isArray||function(b){return ue.call(b)==="[object Array]"};function _e(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var ze=function(k,G){this.line=k,this.column=G};ze.prototype.offset=function(k){return new ze(this.line,this.column+k)};var wt=function(k,G,D){this.start=G,this.end=D,k.sourceFile!==null&&(this.source=k.sourceFile)};function Vt(b,k){for(var G=1,D=0;;){Ot.lastIndex=D;var ne=Ot.exec(b);if(ne&&ne.index<k)++G,D=ne.index+ne[0].length;else return new ze(G,k-D)}}var fr={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Mt(b){var k={};for(var G in fr)k[G]=b&&tt(b,G)?b[G]:fr[G];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),Z(k.onToken)){var D=k.onToken;k.onToken=function(ne){return D.push(ne)}}return Z(k.onComment)&&(k.onComment=Fr(k,k.onComment)),k}function Fr(b,k){return function(G,D,ne,Re,pt,It){var jt={type:G?"Block":"Line",value:D,start:ne,end:Re};b.locations&&(jt.loc=new wt(this,pt,It)),b.ranges&&(jt.range=[ne,Re]),k.push(jt)}}var Xn=1,Jr=2,Ri=Xn|Jr,yi=4,ln=8,Sa=16,fa=32,Di=64,Ia=128;function ui(b,k){return Jr|(b?yi:0)|(k?ln:0)}var Ji=0,di=1,_i=2,Uo=3,Eo=4,to=5,Pt=function(k,G,D){this.options=k=Mt(k),this.sourceFile=k.sourceFile,this.keywords=_e(Be[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var ne="";if(k.allowReserved!==!0){for(var Re=k.ecmaVersion;!(ne=de[Re]);Re--);k.sourceType==="module"&&(ne+=" await")}this.reservedWords=_e(ne);var pt=(ne?ne+" ":"")+de.strict;this.reservedWordsStrict=_e(pt),this.reservedWordsStrictBind=_e(pt+" "+de.strictBind),this.input=String(G),this.containsEsc=!1,D?(this.pos=D,this.lineStart=this.input.lastIndexOf(`
`,D-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(_r).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=re.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Xn),this.regexpState=null},ge={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Pt.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},ge.inFunction.get=function(){return(this.currentVarScope().flags&Jr)>0},ge.inGenerator.get=function(){return(this.currentVarScope().flags&ln)>0},ge.inAsync.get=function(){return(this.currentVarScope().flags&yi)>0},ge.allowSuper.get=function(){return(this.currentThisScope().flags&Di)>0},ge.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ia)>0},ge.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Pt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Jr)>0},Pt.extend=function(){for(var k=[],G=arguments.length;G--;)k[G]=arguments[G];for(var D=this,ne=0;ne<k.length;ne++)D=k[ne](D);return D},Pt.parse=function(k,G){return new this(G,k).parse()},Pt.parseExpressionAt=function(k,G,D){var ne=new this(D,k,G);return ne.nextToken(),ne.parseExpression()},Pt.tokenizer=function(k,G){return new this(G,k)},Object.defineProperties(Pt.prototype,ge);var oe=Pt.prototype,we=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;oe.strictDirective=function(b){for(;;){Ue.lastIndex=b,b+=Ue.exec(this.input)[0].length;var k=we.exec(this.input.slice(b));if(!k)return!1;if((k[1]||k[2])==="use strict"){Ue.lastIndex=b+k[0].length;var G=Ue.exec(this.input),D=G.index+G[0].length,ne=this.input.charAt(D);return ne===";"||ne==="}"||_r.test(G[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ne)||ne==="!"&&this.input.charAt(D+1)==="=")}b+=k[0].length,Ue.lastIndex=b,b+=Ue.exec(this.input)[0].length,this.input[b]===";"&&b++}},oe.eat=function(b){return this.type===b?(this.next(),!0):!1},oe.isContextual=function(b){return this.type===re.name&&this.value===b&&!this.containsEsc},oe.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},oe.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},oe.canInsertSemicolon=function(){return this.type===re.eof||this.type===re.braceR||_r.test(this.input.slice(this.lastTokEnd,this.start))},oe.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},oe.semicolon=function(){!this.eat(re.semi)&&!this.insertSemicolon()&&this.unexpected()},oe.afterTrailingComma=function(b,k){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},oe.expect=function(b){this.eat(b)||this.unexpected()},oe.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function V(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}oe.checkPatternErrors=function(b,k){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var G=k?b.parenthesizedAssign:b.parenthesizedBind;G>-1&&this.raiseRecoverable(G,"Parenthesized pattern")}},oe.checkExpressionErrors=function(b,k){if(!b)return!1;var G=b.shorthandAssign,D=b.doubleProto;if(!k)return G>=0||D>=0;G>=0&&this.raise(G,"Shorthand property assignments are valid only in destructuring patterns"),D>=0&&this.raiseRecoverable(D,"Redefinition of __proto__ property")},oe.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},oe.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var at=Pt.prototype;at.parseTopLevel=function(b){var k={};for(b.body||(b.body=[]);this.type!==re.eof;){var G=this.parseStatement(null,!0,k);b.body.push(G)}if(this.inModule)for(var D=0,ne=Object.keys(this.undefinedExports);D<ne.length;D+=1){var Re=ne[D];this.raiseRecoverable(this.undefinedExports[Re].start,"Export '"+Re+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var sr={kind:"loop"},$r={kind:"switch"};at.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ue.lastIndex=this.pos;var k=Ue.exec(this.input),G=this.pos+k[0].length,D=this.input.charCodeAt(G);if(D===91)return!0;if(b)return!1;if(D===123)return!0;if(tr(D,!0)){for(var ne=G+1;Yt(this.input.charCodeAt(ne),!0);)++ne;var Re=this.input.slice(G,ne);if(!K.test(Re))return!0}return!1},at.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ue.lastIndex=this.pos;var b=Ue.exec(this.input),k=this.pos+b[0].length;return!_r.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!Yt(this.input.charAt(k+8)))},at.parseStatement=function(b,k,G){var D=this.type,ne=this.startNode(),Re;switch(this.isLet(b)&&(D=re._var,Re="let"),D){case re._break:case re._continue:return this.parseBreakContinueStatement(ne,D.keyword);case re._debugger:return this.parseDebuggerStatement(ne);case re._do:return this.parseDoStatement(ne);case re._for:return this.parseForStatement(ne);case re._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ne,!1,!b);case re._class:return b&&this.unexpected(),this.parseClass(ne,!0);case re._if:return this.parseIfStatement(ne);case re._return:return this.parseReturnStatement(ne);case re._switch:return this.parseSwitchStatement(ne);case re._throw:return this.parseThrowStatement(ne);case re._try:return this.parseTryStatement(ne);case re._const:case re._var:return Re=Re||this.value,b&&Re!=="var"&&this.unexpected(),this.parseVarStatement(ne,Re);case re._while:return this.parseWhileStatement(ne);case re._with:return this.parseWithStatement(ne);case re.braceL:return this.parseBlock(!0,ne);case re.semi:return this.parseEmptyStatement(ne);case re._export:case re._import:if(this.options.ecmaVersion>10&&D===re._import){Ue.lastIndex=this.pos;var pt=Ue.exec(this.input),It=this.pos+pt[0].length,jt=this.input.charCodeAt(It);if(jt===40||jt===46)return this.parseExpressionStatement(ne,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),D===re._import?this.parseImport(ne):this.parseExport(ne,G);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(ne,!0,!b);var Nr=this.value,Wr=this.parseExpression();return D===re.name&&Wr.type==="Identifier"&&this.eat(re.colon)?this.parseLabeledStatement(ne,Nr,Wr,b):this.parseExpressionStatement(ne,Wr)}},at.parseBreakContinueStatement=function(b,k){var G=k==="break";this.next(),this.eat(re.semi)||this.insertSemicolon()?b.label=null:this.type!==re.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var D=0;D<this.labels.length;++D){var ne=this.labels[D];if((b.label==null||ne.name===b.label.name)&&(ne.kind!=null&&(G||ne.kind==="loop")||b.label&&G))break}return D===this.labels.length&&this.raise(b.start,"Unsyntactic "+k),this.finishNode(b,G?"BreakStatement":"ContinueStatement")},at.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},at.parseDoStatement=function(b){return this.next(),this.labels.push(sr),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(re._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(re.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},at.parseForStatement=function(b){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(sr),this.enterScope(0),this.expect(re.parenL),this.type===re.semi)return k>-1&&this.unexpected(k),this.parseFor(b,null);var G=this.isLet();if(this.type===re._var||this.type===re._const||G){var D=this.startNode(),ne=G?"let":this.value;return this.next(),this.parseVar(D,!0,ne),this.finishNode(D,"VariableDeclaration"),(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&D.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===re._in?k>-1&&this.unexpected(k):b.await=k>-1),this.parseForIn(b,D)):(k>-1&&this.unexpected(k),this.parseFor(b,D))}var Re=new V,pt=this.parseExpression(!0,Re);return this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===re._in?k>-1&&this.unexpected(k):b.await=k>-1),this.toAssignable(pt,!1,Re),this.checkLVal(pt),this.parseForIn(b,pt)):(this.checkExpressionErrors(Re,!0),k>-1&&this.unexpected(k),this.parseFor(b,pt))},at.parseFunctionStatement=function(b,k,G){return this.next(),this.parseFunction(b,Nt|(G?0:Sr),!1,k)},at.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(re._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},at.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(re.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},at.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(re.braceL),this.labels.push($r),this.enterScope(0);for(var k,G=!1;this.type!==re.braceR;)if(this.type===re._case||this.type===re._default){var D=this.type===re._case;k&&this.finishNode(k,"SwitchCase"),b.cases.push(k=this.startNode()),k.consequent=[],this.next(),D?k.test=this.parseExpression():(G&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),G=!0,k.test=null),this.expect(re.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},at.parseThrowStatement=function(b){return this.next(),_r.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var Ke=[];at.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===re._catch){var k=this.startNode();if(this.next(),this.eat(re.parenL)){k.param=this.parseBindingAtom();var G=k.param.type==="Identifier";this.enterScope(G?fa:0),this.checkLVal(k.param,G?Eo:_i),this.expect(re.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(k,"CatchClause")}return b.finalizer=this.eat(re._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},at.parseVarStatement=function(b,k){return this.next(),this.parseVar(b,!1,k),this.semicolon(),this.finishNode(b,"VariableDeclaration")},at.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(sr),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},at.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},at.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},at.parseLabeledStatement=function(b,k,G,D){for(var ne=0,Re=this.labels;ne<Re.length;ne+=1){var pt=Re[ne];pt.name===k&&this.raise(G.start,"Label '"+k+"' is already declared")}for(var It=this.type.isLoop?"loop":this.type===re._switch?"switch":null,jt=this.labels.length-1;jt>=0;jt--){var Nr=this.labels[jt];if(Nr.statementStart===b.start)Nr.statementStart=this.start,Nr.kind=It;else break}return this.labels.push({name:k,kind:It,statementStart:this.start}),b.body=this.parseStatement(D?D.indexOf("label")===-1?D+"label":D:"label"),this.labels.pop(),b.label=G,this.finishNode(b,"LabeledStatement")},at.parseExpressionStatement=function(b,k){return b.expression=k,this.semicolon(),this.finishNode(b,"ExpressionStatement")},at.parseBlock=function(b,k,G){for(b===void 0&&(b=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(re.braceL),b&&this.enterScope(0);this.type!==re.braceR;){var D=this.parseStatement(null);k.body.push(D)}return G&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(k,"BlockStatement")},at.parseFor=function(b,k){return b.init=k,this.expect(re.semi),b.test=this.type===re.semi?null:this.parseExpression(),this.expect(re.semi),b.update=this.type===re.parenR?null:this.parseExpression(),this.expect(re.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},at.parseForIn=function(b,k){var G=this.type===re._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!G||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(G?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),b.left=k,b.right=G?this.parseExpression():this.parseMaybeAssign(),this.expect(re.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,G?"ForInStatement":"ForOfStatement")},at.parseVar=function(b,k,G){for(b.declarations=[],b.kind=G;;){var D=this.startNode();if(this.parseVarId(D,G),this.eat(re.eq)?D.init=this.parseMaybeAssign(k):G==="const"&&!(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():D.id.type!=="Identifier"&&!(k&&(this.type===re._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):D.init=null,b.declarations.push(this.finishNode(D,"VariableDeclarator")),!this.eat(re.comma))break}return b},at.parseVarId=function(b,k){b.id=this.parseBindingAtom(),this.checkLVal(b.id,k==="var"?di:_i,!1)};var Nt=1,Sr=2,xr=4;at.parseFunction=function(b,k,G,D){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!D)&&(this.type===re.star&&k&Sr&&this.unexpected(),b.generator=this.eat(re.star)),this.options.ecmaVersion>=8&&(b.async=!!D),k&Nt&&(b.id=k&xr&&this.type!==re.name?null:this.parseIdent(),b.id&&!(k&Sr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?di:_i:Uo));var ne=this.yieldPos,Re=this.awaitPos,pt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ui(b.async,b.generator)),k&Nt||(b.id=this.type===re.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,G,!1),this.yieldPos=ne,this.awaitPos=Re,this.awaitIdentPos=pt,this.finishNode(b,k&Nt?"FunctionDeclaration":"FunctionExpression")},at.parseFunctionParams=function(b){this.expect(re.parenL),b.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},at.parseClass=function(b,k){this.next();var G=this.strict;this.strict=!0,this.parseClassId(b,k),this.parseClassSuper(b);var D=this.startNode(),ne=!1;for(D.body=[],this.expect(re.braceL);this.type!==re.braceR;){var Re=this.parseClassElement(b.superClass!==null);Re&&(D.body.push(Re),Re.type==="MethodDefinition"&&Re.kind==="constructor"&&(ne&&this.raise(Re.start,"Duplicate constructor in the same class"),ne=!0))}return this.strict=G,this.next(),b.body=this.finishNode(D,"ClassBody"),this.finishNode(b,k?"ClassDeclaration":"ClassExpression")},at.parseClassElement=function(b){var k=this;if(this.eat(re.semi))return null;var G=this.startNode(),D=function(jt,Nr){Nr===void 0&&(Nr=!1);var Wr=k.start,Kn=k.startLoc;return k.eatContextual(jt)?k.type!==re.parenL&&(!Nr||!k.canInsertSemicolon())?!0:(G.key&&k.unexpected(),G.computed=!1,G.key=k.startNodeAt(Wr,Kn),G.key.name=jt,k.finishNode(G.key,"Identifier"),!1):!1};G.kind="method",G.static=D("static");var ne=this.eat(re.star),Re=!1;ne||(this.options.ecmaVersion>=8&&D("async",!0)?(Re=!0,ne=this.options.ecmaVersion>=9&&this.eat(re.star)):D("get")?G.kind="get":D("set")&&(G.kind="set")),G.key||this.parsePropertyName(G);var pt=G.key,It=!1;return!G.computed&&!G.static&&(pt.type==="Identifier"&&pt.name==="constructor"||pt.type==="Literal"&&pt.value==="constructor")?(G.kind!=="method"&&this.raise(pt.start,"Constructor can't have get/set modifier"),ne&&this.raise(pt.start,"Constructor can't be a generator"),Re&&this.raise(pt.start,"Constructor can't be an async method"),G.kind="constructor",It=b):G.static&&pt.type==="Identifier"&&pt.name==="prototype"&&this.raise(pt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(G,ne,Re,It),G.kind==="get"&&G.value.params.length!==0&&this.raiseRecoverable(G.value.start,"getter should have no params"),G.kind==="set"&&G.value.params.length!==1&&this.raiseRecoverable(G.value.start,"setter should have exactly one param"),G.kind==="set"&&G.value.params[0].type==="RestElement"&&this.raiseRecoverable(G.value.params[0].start,"Setter cannot use rest params"),G},at.parseClassMethod=function(b,k,G,D){return b.value=this.parseMethod(k,G,D),this.finishNode(b,"MethodDefinition")},at.parseClassId=function(b,k){this.type===re.name?(b.id=this.parseIdent(),k&&this.checkLVal(b.id,_i,!1)):(k===!0&&this.unexpected(),b.id=null)},at.parseClassSuper=function(b){b.superClass=this.eat(re._extends)?this.parseExprSubscripts():null},at.parseExport=function(b,k){if(this.next(),this.eat(re.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(k,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==re.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(re._default)){this.checkExport(k,"default",this.lastTokStart);var G;if(this.type===re._function||(G=this.isAsyncFunction())){var D=this.startNode();this.next(),G&&this.next(),b.declaration=this.parseFunction(D,Nt|xr,!1,G)}else if(this.type===re._class){var ne=this.startNode();b.declaration=this.parseClass(ne,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,b.declaration.declarations):this.checkExport(k,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==re.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Re=0,pt=b.specifiers;Re<pt.length;Re+=1){var It=pt[Re];this.checkUnreserved(It.local),this.checkLocalExport(It.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},at.checkExport=function(b,k,G){!b||(tt(b,k)&&this.raiseRecoverable(G,"Duplicate export '"+k+"'"),b[k]=!0)},at.checkPatternExport=function(b,k){var G=k.type;if(G==="Identifier")this.checkExport(b,k.name,k.start);else if(G==="ObjectPattern")for(var D=0,ne=k.properties;D<ne.length;D+=1){var Re=ne[D];this.checkPatternExport(b,Re)}else if(G==="ArrayPattern")for(var pt=0,It=k.elements;pt<It.length;pt+=1){var jt=It[pt];jt&&this.checkPatternExport(b,jt)}else G==="Property"?this.checkPatternExport(b,k.value):G==="AssignmentPattern"?this.checkPatternExport(b,k.left):G==="RestElement"?this.checkPatternExport(b,k.argument):G==="ParenthesizedExpression"&&this.checkPatternExport(b,k.expression)},at.checkVariableExport=function(b,k){if(!!b)for(var G=0,D=k;G<D.length;G+=1){var ne=D[G];this.checkPatternExport(b,ne.id)}},at.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},at.parseExportSpecifiers=function(b){var k=[],G=!0;for(this.expect(re.braceL);!this.eat(re.braceR);){if(G)G=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var D=this.startNode();D.local=this.parseIdent(!0),D.exported=this.eatContextual("as")?this.parseIdent(!0):D.local,this.checkExport(b,D.exported.name,D.exported.start),k.push(this.finishNode(D,"ExportSpecifier"))}return k},at.parseImport=function(b){return this.next(),this.type===re.string?(b.specifiers=Ke,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===re.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},at.parseImportSpecifiers=function(){var b=[],k=!0;if(this.type===re.name){var G=this.startNode();if(G.local=this.parseIdent(),this.checkLVal(G.local,_i),b.push(this.finishNode(G,"ImportDefaultSpecifier")),!this.eat(re.comma))return b}if(this.type===re.star){var D=this.startNode();return this.next(),this.expectContextual("as"),D.local=this.parseIdent(),this.checkLVal(D.local,_i),b.push(this.finishNode(D,"ImportNamespaceSpecifier")),b}for(this.expect(re.braceL);!this.eat(re.braceR);){if(k)k=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var ne=this.startNode();ne.imported=this.parseIdent(!0),this.eatContextual("as")?ne.local=this.parseIdent():(this.checkUnreserved(ne.imported),ne.local=ne.imported),this.checkLVal(ne.local,_i),b.push(this.finishNode(ne,"ImportSpecifier"))}return b},at.adaptDirectivePrologue=function(b){for(var k=0;k<b.length&&this.isDirectiveCandidate(b[k]);++k)b[k].directive=b[k].expression.raw.slice(1,-1)},at.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Lr=Pt.prototype;Lr.toAssignable=function(b,k,G){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",G&&this.checkPatternErrors(G,!0);for(var D=0,ne=b.properties;D<ne.length;D+=1){var Re=ne[D];this.toAssignable(Re,k),Re.type==="RestElement"&&(Re.argument.type==="ArrayPattern"||Re.argument.type==="ObjectPattern")&&this.raise(Re.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,k);break;case"ArrayExpression":b.type="ArrayPattern",G&&this.checkPatternErrors(G,!0),this.toAssignableList(b.elements,k);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,k),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,k,G);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(b.start,"Assigning to rvalue")}else G&&this.checkPatternErrors(G,!0);return b},Lr.toAssignableList=function(b,k){for(var G=b.length,D=0;D<G;D++){var ne=b[D];ne&&this.toAssignable(ne,k)}if(G){var Re=b[G-1];this.options.ecmaVersion===6&&k&&Re&&Re.type==="RestElement"&&Re.argument.type!=="Identifier"&&this.unexpected(Re.argument.start)}return b},Lr.parseSpread=function(b){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,b),this.finishNode(k,"SpreadElement")},Lr.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==re.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Lr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case re.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(re.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case re.braceL:return this.parseObj(!0)}return this.parseIdent()},Lr.parseBindingList=function(b,k,G){for(var D=[],ne=!0;!this.eat(b);)if(ne?ne=!1:this.expect(re.comma),k&&this.type===re.comma)D.push(null);else{if(G&&this.afterTrailingComma(b))break;if(this.type===re.ellipsis){var Re=this.parseRestBinding();this.parseBindingListItem(Re),D.push(Re),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var pt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(pt),D.push(pt)}}return D},Lr.parseBindingListItem=function(b){return b},Lr.parseMaybeDefault=function(b,k,G){if(G=G||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(re.eq))return G;var D=this.startNodeAt(b,k);return D.left=G,D.right=this.parseMaybeAssign(),this.finishNode(D,"AssignmentPattern")},Lr.checkLVal=function(b,k,G){switch(k===void 0&&(k=Ji),b.type){case"Identifier":k===_i&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(k?"Binding ":"Assigning to ")+b.name+" in strict mode"),G&&(tt(G,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),G[b.name]=!0),k!==Ji&&k!==to&&this.declareName(b.name,k,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var D=0,ne=b.properties;D<ne.length;D+=1){var Re=ne[D];this.checkLVal(Re,k,G)}break;case"Property":this.checkLVal(b.value,k,G);break;case"ArrayPattern":for(var pt=0,It=b.elements;pt<It.length;pt+=1){var jt=It[pt];jt&&this.checkLVal(jt,k,G)}break;case"AssignmentPattern":this.checkLVal(b.left,k,G);break;case"RestElement":this.checkLVal(b.argument,k,G);break;case"ParenthesizedExpression":this.checkLVal(b.expression,k,G);break;default:this.raise(b.start,(k?"Binding":"Assigning to")+" rvalue")}};var gn=Pt.prototype;gn.checkPropClash=function(b,k,G){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var D=b.key,ne;switch(D.type){case"Identifier":ne=D.name;break;case"Literal":ne=String(D.value);break;default:return}var Re=b.kind;if(this.options.ecmaVersion>=6){ne==="__proto__"&&Re==="init"&&(k.proto&&(G?G.doubleProto<0&&(G.doubleProto=D.start):this.raiseRecoverable(D.start,"Redefinition of __proto__ property")),k.proto=!0);return}ne="$"+ne;var pt=k[ne];if(pt){var It;Re==="init"?It=this.strict&&pt.init||pt.get||pt.set:It=pt.init||pt[Re],It&&this.raiseRecoverable(D.start,"Redefinition of property")}else pt=k[ne]={init:!1,get:!1,set:!1};pt[Re]=!0}},gn.parseExpression=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseMaybeAssign(b,k);if(this.type===re.comma){var Re=this.startNodeAt(G,D);for(Re.expressions=[ne];this.eat(re.comma);)Re.expressions.push(this.parseMaybeAssign(b,k));return this.finishNode(Re,"SequenceExpression")}return ne},gn.parseMaybeAssign=function(b,k,G){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var D=!1,ne=-1,Re=-1;k?(ne=k.parenthesizedAssign,Re=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new V,D=!0);var pt=this.start,It=this.startLoc;(this.type===re.parenL||this.type===re.name)&&(this.potentialArrowAt=this.start);var jt=this.parseMaybeConditional(b,k);if(G&&(jt=G.call(this,jt,pt,It)),this.type.isAssign){var Nr=this.startNodeAt(pt,It);return Nr.operator=this.value,Nr.left=this.type===re.eq?this.toAssignable(jt,!1,k):jt,D||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=Nr.left.start&&(k.shorthandAssign=-1),this.checkLVal(jt),this.next(),Nr.right=this.parseMaybeAssign(b),this.finishNode(Nr,"AssignmentExpression")}else D&&this.checkExpressionErrors(k,!0);return ne>-1&&(k.parenthesizedAssign=ne),Re>-1&&(k.trailingComma=Re),jt},gn.parseMaybeConditional=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseExprOps(b,k);if(this.checkExpressionErrors(k))return ne;if(this.eat(re.question)){var Re=this.startNodeAt(G,D);return Re.test=ne,Re.consequent=this.parseMaybeAssign(),this.expect(re.colon),Re.alternate=this.parseMaybeAssign(b),this.finishNode(Re,"ConditionalExpression")}return ne},gn.parseExprOps=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||ne.start===G&&ne.type==="ArrowFunctionExpression"?ne:this.parseExprOp(ne,G,D,-1,b)},gn.parseExprOp=function(b,k,G,D,ne){var Re=this.type.binop;if(Re!=null&&(!ne||this.type!==re._in)&&Re>D){var pt=this.type===re.logicalOR||this.type===re.logicalAND,It=this.type===re.coalesce;It&&(Re=re.logicalAND.binop);var jt=this.value;this.next();var Nr=this.start,Wr=this.startLoc,Kn=this.parseExprOp(this.parseMaybeUnary(null,!1),Nr,Wr,Re,ne),Hi=this.buildBinary(k,G,b,Kn,jt,pt||It);return(pt&&this.type===re.coalesce||It&&(this.type===re.logicalOR||this.type===re.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Hi,k,G,D,ne)}return b},gn.buildBinary=function(b,k,G,D,ne,Re){var pt=this.startNodeAt(b,k);return pt.left=G,pt.operator=ne,pt.right=D,this.finishNode(pt,Re?"LogicalExpression":"BinaryExpression")},gn.parseMaybeUnary=function(b,k){var G=this.start,D=this.startLoc,ne;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ne=this.parseAwait(),k=!0;else if(this.type.prefix){var Re=this.startNode(),pt=this.type===re.incDec;Re.operator=this.value,Re.prefix=!0,this.next(),Re.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),pt?this.checkLVal(Re.argument):this.strict&&Re.operator==="delete"&&Re.argument.type==="Identifier"?this.raiseRecoverable(Re.start,"Deleting local variable in strict mode"):k=!0,ne=this.finishNode(Re,pt?"UpdateExpression":"UnaryExpression")}else{if(ne=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return ne;for(;this.type.postfix&&!this.canInsertSemicolon();){var It=this.startNodeAt(G,D);It.operator=this.value,It.prefix=!1,It.argument=ne,this.checkLVal(ne),this.next(),ne=this.finishNode(It,"UpdateExpression")}}return!k&&this.eat(re.starstar)?this.buildBinary(G,D,ne,this.parseMaybeUnary(null,!1),"**",!1):ne},gn.parseExprSubscripts=function(b){var k=this.start,G=this.startLoc,D=this.parseExprAtom(b);if(D.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return D;var ne=this.parseSubscripts(D,k,G);return b&&ne.type==="MemberExpression"&&(b.parenthesizedAssign>=ne.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=ne.start&&(b.parenthesizedBind=-1)),ne},gn.parseSubscripts=function(b,k,G,D){for(var ne=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,Re=!1;;){var pt=this.parseSubscript(b,k,G,D,ne,Re);if(pt.optional&&(Re=!0),pt===b||pt.type==="ArrowFunctionExpression"){if(Re){var It=this.startNodeAt(k,G);It.expression=pt,pt=this.finishNode(It,"ChainExpression")}return pt}b=pt}},gn.parseSubscript=function(b,k,G,D,ne,Re){var pt=this.options.ecmaVersion>=11,It=pt&&this.eat(re.questionDot);D&&It&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var jt=this.eat(re.bracketL);if(jt||It&&this.type!==re.parenL&&this.type!==re.backQuote||this.eat(re.dot)){var Nr=this.startNodeAt(k,G);Nr.object=b,Nr.property=jt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Nr.computed=!!jt,jt&&this.expect(re.bracketR),pt&&(Nr.optional=It),b=this.finishNode(Nr,"MemberExpression")}else if(!D&&this.eat(re.parenL)){var Wr=new V,Kn=this.yieldPos,Hi=this.awaitPos,Gi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Ni=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1,Wr);if(ne&&!It&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Kn,this.awaitPos=Hi,this.awaitIdentPos=Gi,this.parseArrowExpression(this.startNodeAt(k,G),Ni,!0);this.checkExpressionErrors(Wr,!0),this.yieldPos=Kn||this.yieldPos,this.awaitPos=Hi||this.awaitPos,this.awaitIdentPos=Gi||this.awaitIdentPos;var no=this.startNodeAt(k,G);no.callee=b,no.arguments=Ni,pt&&(no.optional=It),b=this.finishNode(no,"CallExpression")}else if(this.type===re.backQuote){(It||Re)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var go=this.startNodeAt(k,G);go.tag=b,go.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(go,"TaggedTemplateExpression")}return b},gn.parseExprAtom=function(b){this.type===re.slash&&this.readRegexp();var k,G=this.potentialArrowAt===this.start;switch(this.type){case re._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===re.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==re.dot&&this.type!==re.bracketL&&this.type!==re.parenL&&this.unexpected(),this.finishNode(k,"Super");case re._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case re.name:var D=this.start,ne=this.startLoc,Re=this.containsEsc,pt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Re&&pt.name==="async"&&!this.canInsertSemicolon()&&this.eat(re._function))return this.parseFunction(this.startNodeAt(D,ne),0,!1,!0);if(G&&!this.canInsertSemicolon()){if(this.eat(re.arrow))return this.parseArrowExpression(this.startNodeAt(D,ne),[pt],!1);if(this.options.ecmaVersion>=8&&pt.name==="async"&&this.type===re.name&&!Re)return pt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(re.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(D,ne),[pt],!0)}return pt;case re.regexp:var It=this.value;return k=this.parseLiteral(It.value),k.regex={pattern:It.pattern,flags:It.flags},k;case re.num:case re.string:return this.parseLiteral(this.value);case re._null:case re._true:case re._false:return k=this.startNode(),k.value=this.type===re._null?null:this.type===re._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case re.parenL:var jt=this.start,Nr=this.parseParenAndDistinguishExpression(G);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Nr)&&(b.parenthesizedAssign=jt),b.parenthesizedBind<0&&(b.parenthesizedBind=jt)),Nr;case re.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(re.bracketR,!0,!0,b),this.finishNode(k,"ArrayExpression");case re.braceL:return this.parseObj(!1,b);case re._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case re._class:return this.parseClass(this.startNode(),!1);case re._new:return this.parseNew();case re.backQuote:return this.parseTemplate();case re._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},gn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case re.parenL:return this.parseDynamicImport(b);case re.dot:return b.meta=k,this.parseImportMeta(b);default:this.unexpected()}},gn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(re.parenR)){var k=this.start;this.eat(re.comma)&&this.eat(re.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(b,"ImportExpression")},gn.parseImportMeta=function(b){this.next();var k=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},gn.parseLiteral=function(b){var k=this.startNode();return k.value=b,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},gn.parseParenExpression=function(){this.expect(re.parenL);var b=this.parseExpression();return this.expect(re.parenR),b},gn.parseParenAndDistinguishExpression=function(b){var k=this.start,G=this.startLoc,D,ne=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Re=this.start,pt=this.startLoc,It=[],jt=!0,Nr=!1,Wr=new V,Kn=this.yieldPos,Hi=this.awaitPos,Gi;for(this.yieldPos=0,this.awaitPos=0;this.type!==re.parenR;)if(jt?jt=!1:this.expect(re.comma),ne&&this.afterTrailingComma(re.parenR,!0)){Nr=!0;break}else if(this.type===re.ellipsis){Gi=this.start,It.push(this.parseParenItem(this.parseRestBinding())),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else It.push(this.parseMaybeAssign(!1,Wr,this.parseParenItem));var Ni=this.start,no=this.startLoc;if(this.expect(re.parenR),b&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Wr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Kn,this.awaitPos=Hi,this.parseParenArrowList(k,G,It);(!It.length||Nr)&&this.unexpected(this.lastTokStart),Gi&&this.unexpected(Gi),this.checkExpressionErrors(Wr,!0),this.yieldPos=Kn||this.yieldPos,this.awaitPos=Hi||this.awaitPos,It.length>1?(D=this.startNodeAt(Re,pt),D.expressions=It,this.finishNodeAt(D,"SequenceExpression",Ni,no)):D=It[0]}else D=this.parseParenExpression();if(this.options.preserveParens){var go=this.startNodeAt(k,G);return go.expression=D,this.finishNode(go,"ParenthesizedExpression")}else return D},gn.parseParenItem=function(b){return b},gn.parseParenArrowList=function(b,k,G){return this.parseArrowExpression(this.startNodeAt(b,k),G)};var mi=[];gn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(re.dot)){b.meta=k;var G=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),G&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var D=this.start,ne=this.startLoc,Re=this.type===re._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),D,ne,!0),Re&&b.callee.type==="ImportExpression"&&this.raise(D,"Cannot use new with import()"),this.eat(re.parenL)?b.arguments=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1):b.arguments=mi,this.finishNode(b,"NewExpression")},gn.parseTemplateElement=function(b){var k=b.isTagged,G=this.startNode();return this.type===re.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),G.value={raw:this.value,cooked:null}):G.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),G.tail=this.type===re.backQuote,this.finishNode(G,"TemplateElement")},gn.parseTemplate=function(b){b===void 0&&(b={});var k=b.isTagged;k===void 0&&(k=!1);var G=this.startNode();this.next(),G.expressions=[];var D=this.parseTemplateElement({isTagged:k});for(G.quasis=[D];!D.tail;)this.type===re.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(re.dollarBraceL),G.expressions.push(this.parseExpression()),this.expect(re.braceR),G.quasis.push(D=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(G,"TemplateLiteral")},gn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===re.name||this.type===re.num||this.type===re.string||this.type===re.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===re.star)&&!_r.test(this.input.slice(this.lastTokEnd,this.start))},gn.parseObj=function(b,k){var G=this.startNode(),D=!0,ne={};for(G.properties=[],this.next();!this.eat(re.braceR);){if(D)D=!1;else if(this.expect(re.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(re.braceR))break;var Re=this.parseProperty(b,k);b||this.checkPropClash(Re,ne,k),G.properties.push(Re)}return this.finishNode(G,b?"ObjectPattern":"ObjectExpression")},gn.parseProperty=function(b,k){var G=this.startNode(),D,ne,Re,pt;if(this.options.ecmaVersion>=9&&this.eat(re.ellipsis))return b?(G.argument=this.parseIdent(!1),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(G,"RestElement")):(this.type===re.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),G.argument=this.parseMaybeAssign(!1,k),this.type===re.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(G,"SpreadElement"));this.options.ecmaVersion>=6&&(G.method=!1,G.shorthand=!1,(b||k)&&(Re=this.start,pt=this.startLoc),b||(D=this.eat(re.star)));var It=this.containsEsc;return this.parsePropertyName(G),!b&&!It&&this.options.ecmaVersion>=8&&!D&&this.isAsyncProp(G)?(ne=!0,D=this.options.ecmaVersion>=9&&this.eat(re.star),this.parsePropertyName(G,k)):ne=!1,this.parsePropertyValue(G,b,D,ne,Re,pt,k,It),this.finishNode(G,"Property")},gn.parsePropertyValue=function(b,k,G,D,ne,Re,pt,It){if((G||D)&&this.type===re.colon&&this.unexpected(),this.eat(re.colon))b.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,pt),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===re.parenL)k&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(G,D);else if(!k&&!It&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==re.comma&&this.type!==re.braceR&&this.type!==re.eq){(G||D)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var jt=b.kind==="get"?0:1;if(b.value.params.length!==jt){var Nr=b.value.start;b.kind==="get"?this.raiseRecoverable(Nr,"getter should have no params"):this.raiseRecoverable(Nr,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((G||D)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ne),b.kind="init",k?b.value=this.parseMaybeDefault(ne,Re,b.key):this.type===re.eq&&pt?(pt.shorthandAssign<0&&(pt.shorthandAssign=this.start),b.value=this.parseMaybeDefault(ne,Re,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},gn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(re.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(re.bracketR),b.key;b.computed=!1}return b.key=this.type===re.num||this.type===re.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},gn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},gn.parseMethod=function(b,k,G){var D=this.startNode(),ne=this.yieldPos,Re=this.awaitPos,pt=this.awaitIdentPos;return this.initFunction(D),this.options.ecmaVersion>=6&&(D.generator=b),this.options.ecmaVersion>=8&&(D.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ui(k,D.generator)|Di|(G?Ia:0)),this.expect(re.parenL),D.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(D,!1,!0),this.yieldPos=ne,this.awaitPos=Re,this.awaitIdentPos=pt,this.finishNode(D,"FunctionExpression")},gn.parseArrowExpression=function(b,k,G){var D=this.yieldPos,ne=this.awaitPos,Re=this.awaitIdentPos;return this.enterScope(ui(G,!1)|Sa),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!G),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(k,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=D,this.awaitPos=ne,this.awaitIdentPos=Re,this.finishNode(b,"ArrowFunctionExpression")},gn.parseFunctionBody=function(b,k,G){var D=k&&this.type!==re.braceL,ne=this.strict,Re=!1;if(D)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var pt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!ne||pt)&&(Re=this.strictDirective(this.end),Re&&pt&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var It=this.labels;this.labels=[],Re&&(this.strict=!0),this.checkParams(b,!ne&&!Re&&!k&&!G&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,to),b.body=this.parseBlock(!1,void 0,Re&&!ne),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=It}this.exitScope()},gn.isSimpleParamList=function(b){for(var k=0,G=b;k<G.length;k+=1){var D=G[k];if(D.type!=="Identifier")return!1}return!0},gn.checkParams=function(b,k){for(var G={},D=0,ne=b.params;D<ne.length;D+=1){var Re=ne[D];this.checkLVal(Re,di,k?null:G)}},gn.parseExprList=function(b,k,G,D){for(var ne=[],Re=!0;!this.eat(b);){if(Re)Re=!1;else if(this.expect(re.comma),k&&this.afterTrailingComma(b))break;var pt=void 0;G&&this.type===re.comma?pt=null:this.type===re.ellipsis?(pt=this.parseSpread(D),D&&this.type===re.comma&&D.trailingComma<0&&(D.trailingComma=this.start)):pt=this.parseMaybeAssign(!1,D),ne.push(pt)}return ne},gn.checkUnreserved=function(b){var k=b.start,G=b.end,D=b.name;if(this.inGenerator&&D==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&D==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(D)&&this.raise(k,"Unexpected keyword '"+D+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,G).indexOf("\\")!==-1)){var ne=this.strict?this.reservedWordsStrict:this.reservedWords;ne.test(D)&&(!this.inAsync&&D==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+D+"' is reserved"))}},gn.parseIdent=function(b,k){var G=this.startNode();return this.type===re.name?G.name=this.value:this.type.keyword?(G.name=this.type.keyword,(G.name==="class"||G.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(G,"Identifier"),b||(this.checkUnreserved(G),G.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=G.start)),G},gn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===re.semi||this.canInsertSemicolon()||this.type!==re.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(re.star),k.argument=this.parseMaybeAssign(b)),this.finishNode(k,"YieldExpression")},gn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var ii=Pt.prototype;ii.raise=function(b,k){var G=Vt(this.input,b);k+=" ("+G.line+":"+G.column+")";var D=new SyntaxError(k);throw D.pos=b,D.loc=G,D.raisedAt=this.pos,D},ii.raiseRecoverable=ii.raise,ii.curPosition=function(){if(this.options.locations)return new ze(this.curLine,this.pos-this.lineStart)};var Sn=Pt.prototype,Bi=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};Sn.enterScope=function(b){this.scopeStack.push(new Bi(b))},Sn.exitScope=function(){this.scopeStack.pop()},Sn.treatFunctionsAsVarInScope=function(b){return b.flags&Jr||!this.inModule&&b.flags&Xn},Sn.declareName=function(b,k,G){var D=!1;if(k===_i){var ne=this.currentScope();D=ne.lexical.indexOf(b)>-1||ne.functions.indexOf(b)>-1||ne.var.indexOf(b)>-1,ne.lexical.push(b),this.inModule&&ne.flags&Xn&&delete this.undefinedExports[b]}else if(k===Eo){var Re=this.currentScope();Re.lexical.push(b)}else if(k===Uo){var pt=this.currentScope();this.treatFunctionsAsVar?D=pt.lexical.indexOf(b)>-1:D=pt.lexical.indexOf(b)>-1||pt.var.indexOf(b)>-1,pt.functions.push(b)}else for(var It=this.scopeStack.length-1;It>=0;--It){var jt=this.scopeStack[It];if(jt.lexical.indexOf(b)>-1&&!(jt.flags&fa&&jt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(jt)&&jt.functions.indexOf(b)>-1){D=!0;break}if(jt.var.push(b),this.inModule&&jt.flags&Xn&&delete this.undefinedExports[b],jt.flags&Ri)break}D&&this.raiseRecoverable(G,"Identifier '"+b+"' has already been declared")},Sn.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},Sn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Sn.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Ri)return k}},Sn.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Ri&&!(k.flags&Sa))return k}};var Vi=function(k,G,D){this.type="",this.start=G,this.end=0,k.options.locations&&(this.loc=new wt(k,D)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[G,0])},Ga=Pt.prototype;Ga.startNode=function(){return new Vi(this,this.start,this.startLoc)},Ga.startNodeAt=function(b,k){return new Vi(this,b,k)};function oa(b,k,G,D){return b.type=k,b.end=G,this.options.locations&&(b.loc.end=D),this.options.ranges&&(b.range[1]=G),b}Ga.finishNode=function(b,k){return oa.call(this,b,k,this.lastTokEnd,this.lastTokEndLoc)},Ga.finishNodeAt=function(b,k,G,D){return oa.call(this,b,k,G,D)};var ro=function(k,G,D,ne,Re){this.token=k,this.isExpr=!!G,this.preserveSpace=!!D,this.override=ne,this.generator=!!Re},Si={b_stat:new ro("{",!1),b_expr:new ro("{",!0),b_tmpl:new ro("${",!1),p_stat:new ro("(",!1),p_expr:new ro("(",!0),q_tmpl:new ro("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new ro("function",!1),f_expr:new ro("function",!0),f_expr_gen:new ro("function",!0,!1,null,!0),f_gen:new ro("function",!1,!1,null,!0)},ha=Pt.prototype;ha.initialContext=function(){return[Si.b_stat]},ha.braceIsBlock=function(b){var k=this.curContext();return k===Si.f_expr||k===Si.f_stat?!0:b===re.colon&&(k===Si.b_stat||k===Si.b_expr)?!k.isExpr:b===re._return||b===re.name&&this.exprAllowed?_r.test(this.input.slice(this.lastTokEnd,this.start)):b===re._else||b===re.semi||b===re.eof||b===re.parenR||b===re.arrow?!0:b===re.braceL?k===Si.b_stat:b===re._var||b===re._const||b===re.name?!1:!this.exprAllowed},ha.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var k=this.context[b];if(k.token==="function")return k.generator}return!1},ha.updateContext=function(b){var k,G=this.type;G.keyword&&b===re.dot?this.exprAllowed=!1:(k=G.updateContext)?k.call(this,b):this.exprAllowed=G.beforeExpr},re.parenR.updateContext=re.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===Si.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},re.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?Si.b_stat:Si.b_expr),this.exprAllowed=!0},re.dollarBraceL.updateContext=function(){this.context.push(Si.b_tmpl),this.exprAllowed=!0},re.parenL.updateContext=function(b){var k=b===re._if||b===re._for||b===re._with||b===re._while;this.context.push(k?Si.p_stat:Si.p_expr),this.exprAllowed=!0},re.incDec.updateContext=function(){},re._function.updateContext=re._class.updateContext=function(b){b.beforeExpr&&b!==re.semi&&b!==re._else&&!(b===re._return&&_r.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===re.colon||b===re.braceL)&&this.curContext()===Si.b_stat)?this.context.push(Si.f_expr):this.context.push(Si.f_stat),this.exprAllowed=!1},re.backQuote.updateContext=function(){this.curContext()===Si.q_tmpl?this.context.pop():this.context.push(Si.q_tmpl),this.exprAllowed=!1},re.star.updateContext=function(b){if(b===re._function){var k=this.context.length-1;this.context[k]===Si.f_expr?this.context[k]=Si.f_expr_gen:this.context[k]=Si.f_gen}this.exprAllowed=!0},re.name.updateContext=function(b){var k=!1;this.options.ecmaVersion>=6&&b!==re.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var Q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ie=Q+" Extended_Pictographic",me=ie,Ie={9:Q,10:ie,11:me},qe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ot="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",xt=ot+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Te=xt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",rt={9:ot,10:xt,11:Te},Ht={};function Zr(b){var k=Ht[b]={binary:_e(Ie[b]+" "+qe),nonBinary:{General_Category:_e(qe),Script:_e(rt[b])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}Zr(9),Zr(10),Zr(11);var ar=Pt.prototype,pr=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Ht[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};pr.prototype.reset=function(k,G,D){var ne=D.indexOf("u")!==-1;this.start=k|0,this.source=G+"",this.flags=D,this.switchU=ne&&this.parser.options.ecmaVersion>=6,this.switchN=ne&&this.parser.options.ecmaVersion>=9},pr.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},pr.prototype.at=function(k,G){G===void 0&&(G=!1);var D=this.source,ne=D.length;if(k>=ne)return-1;var Re=D.charCodeAt(k);if(!(G||this.switchU)||Re<=55295||Re>=57344||k+1>=ne)return Re;var pt=D.charCodeAt(k+1);return pt>=56320&&pt<=57343?(Re<<10)+pt-56613888:Re},pr.prototype.nextIndex=function(k,G){G===void 0&&(G=!1);var D=this.source,ne=D.length;if(k>=ne)return ne;var Re=D.charCodeAt(k),pt;return!(G||this.switchU)||Re<=55295||Re>=57344||k+1>=ne||(pt=D.charCodeAt(k+1))<56320||pt>57343?k+1:k+2},pr.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},pr.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},pr.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},pr.prototype.eat=function(k,G){return G===void 0&&(G=!1),this.current(G)===k?(this.advance(G),!0):!1};function Hr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}ar.validateRegExpFlags=function(b){for(var k=b.validFlags,G=b.flags,D=0;D<G.length;D++){var ne=G.charAt(D);k.indexOf(ne)===-1&&this.raise(b.start,"Invalid regular expression flag"),G.indexOf(ne,D+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},ar.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},ar.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var k=0,G=b.backReferenceNames;k<G.length;k+=1){var D=G[k];b.groupNames.indexOf(D)===-1&&b.raise("Invalid named capture referenced")}},ar.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},ar.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},ar.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},ar.regexp_eatAssertion=function(b){var k=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=k}if(b.eat(40)&&b.eat(63)){var G=!1;if(this.options.ecmaVersion>=9&&(G=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!G,!0}return b.pos=k,!1},ar.regexp_eatQuantifier=function(b,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(b,k)?(b.eat(63),!0):!1},ar.regexp_eatQuantifierPrefix=function(b,k){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,k)},ar.regexp_eatBracedQuantifier=function(b,k){var G=b.pos;if(b.eat(123)){var D=0,ne=-1;if(this.regexp_eatDecimalDigits(b)&&(D=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(ne=b.lastIntValue),b.eat(125)))return ne!==-1&&ne<D&&!k&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!k&&b.raise("Incomplete quantifier"),b.pos=G}return!1},ar.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},ar.regexp_eatReverseSolidusAtomEscape=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=k}return!1},ar.regexp_eatUncapturingGroup=function(b){var k=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=k}return!1},ar.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},ar.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},ar.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},ar.regexp_eatSyntaxCharacter=function(b){var k=b.current();return li(k)?(b.lastIntValue=k,b.advance(),!0):!1};function li(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}ar.regexp_eatPatternCharacters=function(b){for(var k=b.pos,G=0;(G=b.current())!==-1&&!li(G);)b.advance();return b.pos!==k},ar.regexp_eatExtendedPatternCharacter=function(b){var k=b.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(b.advance(),!0):!1},ar.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},ar.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},ar.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Hr(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Hr(b.lastIntValue);return!0}return!1},ar.regexp_eatRegExpIdentifierStart=function(b){var k=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),wn(D)?(b.lastIntValue=D,!0):(b.pos=k,!1)};function wn(b){return tr(b,!0)||b===36||b===95}ar.regexp_eatRegExpIdentifierPart=function(b){var k=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),er(D)?(b.lastIntValue=D,!0):(b.pos=k,!1)};function er(b){return Yt(b,!0)||b===36||b===95||b===8204||b===8205}ar.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},ar.regexp_eatBackReference=function(b){var k=b.pos;if(this.regexp_eatDecimalEscape(b)){var G=b.lastIntValue;if(b.switchU)return G>b.maxBackReference&&(b.maxBackReference=G),!0;if(G<=b.numCapturingParens)return!0;b.pos=k}return!1},ar.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},ar.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},ar.regexp_eatCControlLetter=function(b){var k=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=k}return!1},ar.regexp_eatZero=function(b){return b.current()===48&&!$i(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},ar.regexp_eatControlEscape=function(b){var k=b.current();return k===116?(b.lastIntValue=9,b.advance(),!0):k===110?(b.lastIntValue=10,b.advance(),!0):k===118?(b.lastIntValue=11,b.advance(),!0):k===102?(b.lastIntValue=12,b.advance(),!0):k===114?(b.lastIntValue=13,b.advance(),!0):!1},ar.regexp_eatControlLetter=function(b){var k=b.current();return Hn(k)?(b.lastIntValue=k%32,b.advance(),!0):!1};function Hn(b){return b>=65&&b<=90||b>=97&&b<=122}ar.regexp_eatRegExpUnicodeEscapeSequence=function(b,k){k===void 0&&(k=!1);var G=b.pos,D=k||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var ne=b.lastIntValue;if(D&&ne>=55296&&ne<=56319){var Re=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var pt=b.lastIntValue;if(pt>=56320&&pt<=57343)return b.lastIntValue=(ne-55296)*1024+(pt-56320)+65536,!0}b.pos=Re,b.lastIntValue=ne}return!0}if(D&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&Tn(b.lastIntValue))return!0;D&&b.raise("Invalid unicode escape"),b.pos=G}return!1};function Tn(b){return b>=0&&b<=1114111}ar.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var k=b.current();return k!==99&&(!b.switchN||k!==107)?(b.lastIntValue=k,b.advance(),!0):!1},ar.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var k=b.current();if(k>=49&&k<=57){do b.lastIntValue=10*b.lastIntValue+(k-48),b.advance();while((k=b.current())>=48&&k<=57);return!0}return!1},ar.regexp_eatCharacterClassEscape=function(b){var k=b.current();if(Mn(k))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function Mn(b){return b===100||b===68||b===115||b===83||b===119||b===87}ar.regexp_eatUnicodePropertyValueExpression=function(b){var k=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var G=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var D=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,G,D),!0}}if(b.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var ne=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,ne),!0}return!1},ar.regexp_validateUnicodePropertyNameAndValue=function(b,k,G){tt(b.unicodeProperties.nonBinary,k)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[k].test(G)||b.raise("Invalid property value")},ar.regexp_validateUnicodePropertyNameOrValue=function(b,k){b.unicodeProperties.binary.test(k)||b.raise("Invalid property name")},ar.regexp_eatUnicodePropertyName=function(b){var k=0;for(b.lastStringValue="";sa(k=b.current());)b.lastStringValue+=Hr(k),b.advance();return b.lastStringValue!==""};function sa(b){return Hn(b)||b===95}ar.regexp_eatUnicodePropertyValue=function(b){var k=0;for(b.lastStringValue="";Pr(k=b.current());)b.lastStringValue+=Hr(k),b.advance();return b.lastStringValue!==""};function Pr(b){return sa(b)||$i(b)}ar.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},ar.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},ar.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var k=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var G=b.lastIntValue;b.switchU&&(k===-1||G===-1)&&b.raise("Invalid character class"),k!==-1&&G!==-1&&k>G&&b.raise("Range out of order in character class")}}},ar.regexp_eatClassAtom=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var G=b.current();(G===99||ma(G))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=k}var D=b.current();return D!==93?(b.lastIntValue=D,b.advance(),!0):!1},ar.regexp_eatClassEscape=function(b){var k=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=k}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},ar.regexp_eatClassControlLetter=function(b){var k=b.current();return $i(k)||k===95?(b.lastIntValue=k%32,b.advance(),!0):!1},ar.regexp_eatHexEscapeSequence=function(b){var k=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=k}return!1},ar.regexp_eatDecimalDigits=function(b){var k=b.pos,G=0;for(b.lastIntValue=0;$i(G=b.current());)b.lastIntValue=10*b.lastIntValue+(G-48),b.advance();return b.pos!==k};function $i(b){return b>=48&&b<=57}ar.regexp_eatHexDigits=function(b){var k=b.pos,G=0;for(b.lastIntValue=0;La(G=b.current());)b.lastIntValue=16*b.lastIntValue+ra(G),b.advance();return b.pos!==k};function La(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function ra(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}ar.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var k=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var G=b.lastIntValue;k<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=k*64+G*8+b.lastIntValue:b.lastIntValue=k*8+G}else b.lastIntValue=k;return!0}return!1},ar.regexp_eatOctalDigit=function(b){var k=b.current();return ma(k)?(b.lastIntValue=k-48,b.advance(),!0):(b.lastIntValue=0,!1)};function ma(b){return b>=48&&b<=55}ar.regexp_eatFixedHexDigits=function(b,k){var G=b.pos;b.lastIntValue=0;for(var D=0;D<k;++D){var ne=b.current();if(!La(ne))return b.pos=G,!1;b.lastIntValue=16*b.lastIntValue+ra(ne),b.advance()}return!0};var Ft=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new wt(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},Tt=Pt.prototype;Tt.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ft(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Tt.getToken=function(){return this.next(),new Ft(this)},typeof Symbol!="undefined"&&(Tt[Symbol.iterator]=function(){var b=this;return{next:function(){var k=b.getToken();return{done:k.type===re.eof,value:k}}}}),Tt.curContext=function(){return this.context[this.context.length-1]},Tt.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(re.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},Tt.readToken=function(b){return tr(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},Tt.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var k=this.input.charCodeAt(this.pos+1);return(b<<10)+k-56613888},Tt.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),k=this.pos,G=this.input.indexOf("*/",this.pos+=2);if(G===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=G+2,this.options.locations){Ot.lastIndex=k;for(var D;(D=Ot.exec(this.input))&&D.index<this.pos;)++this.curLine,this.lineStart=D.index+D[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,G),k,this.pos,b,this.curPosition())},Tt.skipLineComment=function(b){for(var k=this.pos,G=this.options.onComment&&this.curPosition(),D=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!_t(D);)D=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+b,this.pos),k,this.pos,G,this.curPosition())},Tt.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&Kt.test(String.fromCharCode(b)))++this.pos;else break e}}},Tt.finishToken=function(b,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var G=this.type;this.type=b,this.value=k,this.updateContext(G)},Tt.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&k===46?(this.pos+=3,this.finishToken(re.ellipsis)):(++this.pos,this.finishToken(re.dot))},Tt.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(re.assign,2):this.finishOp(re.slash,1)},Tt.readToken_mult_modulo_exp=function(b){var k=this.input.charCodeAt(this.pos+1),G=1,D=b===42?re.star:re.modulo;return this.options.ecmaVersion>=7&&b===42&&k===42&&(++G,D=re.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(re.assign,G+1):this.finishOp(D,G)},Tt.readToken_pipe_amp=function(b){var k=this.input.charCodeAt(this.pos+1);if(k===b){if(this.options.ecmaVersion>=12){var G=this.input.charCodeAt(this.pos+2);if(G===61)return this.finishOp(re.assign,3)}return this.finishOp(b===124?re.logicalOR:re.logicalAND,2)}return k===61?this.finishOp(re.assign,2):this.finishOp(b===124?re.bitwiseOR:re.bitwiseAND,1)},Tt.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(re.assign,2):this.finishOp(re.bitwiseXOR,1)},Tt.readToken_plus_min=function(b){var k=this.input.charCodeAt(this.pos+1);return k===b?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||_r.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(re.incDec,2):k===61?this.finishOp(re.assign,2):this.finishOp(re.plusMin,1)},Tt.readToken_lt_gt=function(b){var k=this.input.charCodeAt(this.pos+1),G=1;return k===b?(G=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+G)===61?this.finishOp(re.assign,G+1):this.finishOp(re.bitShift,G)):k===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(G=2),this.finishOp(re.relational,G))},Tt.readToken_eq_excl=function(b){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(re.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(re.arrow)):this.finishOp(b===61?re.eq:re.prefix,1)},Tt.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var G=this.input.charCodeAt(this.pos+2);if(G<48||G>57)return this.finishOp(re.questionDot,2)}if(k===63){if(b>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(re.assign,3)}return this.finishOp(re.coalesce,2)}}return this.finishOp(re.question,1)},Tt.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(re.parenL);case 41:return++this.pos,this.finishToken(re.parenR);case 59:return++this.pos,this.finishToken(re.semi);case 44:return++this.pos,this.finishToken(re.comma);case 91:return++this.pos,this.finishToken(re.bracketL);case 93:return++this.pos,this.finishToken(re.bracketR);case 123:return++this.pos,this.finishToken(re.braceL);case 125:return++this.pos,this.finishToken(re.braceR);case 58:return++this.pos,this.finishToken(re.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(re.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(re.prefix,1)}this.raise(this.pos,"Unexpected character '"+Na(b)+"'")},Tt.finishOp=function(b,k){var G=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(b,G)},Tt.readRegexp=function(){for(var b,k,G=this.pos;;){this.pos>=this.input.length&&this.raise(G,"Unterminated regular expression");var D=this.input.charAt(this.pos);if(_r.test(D)&&this.raise(G,"Unterminated regular expression"),b)b=!1;else{if(D==="[")k=!0;else if(D==="]"&&k)k=!1;else if(D==="/"&&!k)break;b=D==="\\"}++this.pos}var ne=this.input.slice(G,this.pos);++this.pos;var Re=this.pos,pt=this.readWord1();this.containsEsc&&this.unexpected(Re);var It=this.regexpState||(this.regexpState=new pr(this));It.reset(G,ne,pt),this.validateRegExpFlags(It),this.validateRegExpPattern(It);var jt=null;try{jt=new RegExp(ne,pt)}catch(Nr){}return this.finishToken(re.regexp,{pattern:ne,flags:pt,value:jt})},Tt.readInt=function(b,k,G){for(var D=this.options.ecmaVersion>=12&&k===void 0,ne=G&&this.input.charCodeAt(this.pos)===48,Re=this.pos,pt=0,It=0,jt=0,Nr=k==null?Infinity:k;jt<Nr;++jt,++this.pos){var Wr=this.input.charCodeAt(this.pos),Kn=void 0;if(D&&Wr===95){ne&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),It===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),jt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),It=Wr;continue}if(Wr>=97?Kn=Wr-97+10:Wr>=65?Kn=Wr-65+10:Wr>=48&&Wr<=57?Kn=Wr-48:Kn=Infinity,Kn>=b)break;It=Wr,pt=pt*b+Kn}return D&&It===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Re||k!=null&&this.pos-Re!==k?null:pt};function ea(b,k){return k?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function lo(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}Tt.readRadixNumber=function(b){var k=this.pos;this.pos+=2;var G=this.readInt(b);return G==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(G=lo(this.input.slice(k,this.pos)),++this.pos):tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,G)},Tt.readNumber=function(b){var k=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var G=this.pos-k>=2&&this.input.charCodeAt(k)===48;G&&this.strict&&this.raise(k,"Invalid number");var D=this.input.charCodeAt(this.pos);if(!G&&!b&&this.options.ecmaVersion>=11&&D===110){var ne=lo(this.input.slice(k,this.pos));return++this.pos,tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,ne)}G&&/[89]/.test(this.input.slice(k,this.pos))&&(G=!1),D===46&&!G&&(++this.pos,this.readInt(10),D=this.input.charCodeAt(this.pos)),(D===69||D===101)&&!G&&(D=this.input.charCodeAt(++this.pos),(D===43||D===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Re=ea(this.input.slice(k,this.pos),G);return this.finishToken(re.num,Re)},Tt.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),k;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var G=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(G,"Code point out of bounds")}else k=this.readHexChar(4);return k};function Na(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}Tt.readString=function(b){for(var k="",G=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var D=this.input.charCodeAt(this.pos);if(D===b)break;D===92?(k+=this.input.slice(G,this.pos),k+=this.readEscapedChar(!1),G=this.pos):(_t(D,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(G,this.pos++),this.finishToken(re.string,k)};var ji={};Tt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===ji)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},Tt.invalidStringToken=function(b,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ji;this.raise(b,k)},Tt.readTmplToken=function(){for(var b="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var G=this.input.charCodeAt(this.pos);if(G===96||G===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===re.template||this.type===re.invalidTemplate)?G===36?(this.pos+=2,this.finishToken(re.dollarBraceL)):(++this.pos,this.finishToken(re.backQuote)):(b+=this.input.slice(k,this.pos),this.finishToken(re.template,b));if(G===92)b+=this.input.slice(k,this.pos),b+=this.readEscapedChar(!0),k=this.pos;else if(_t(G)){switch(b+=this.input.slice(k,this.pos),++this.pos,G){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(G);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},Tt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(re.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Tt.readEscapedChar=function(b){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Na(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var G=this.pos-1;return this.invalidStringToken(G,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var D=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ne=parseInt(D,8);return ne>255&&(D=D.slice(0,-1),ne=parseInt(D,8)),this.pos+=D.length-1,k=this.input.charCodeAt(this.pos),(D!=="0"||k===56||k===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-D.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ne)}return _t(k)?"":String.fromCharCode(k)}},Tt.readHexChar=function(b){var k=this.pos,G=this.readInt(16,b);return G===null&&this.invalidStringToken(k,"Bad character escape sequence"),G},Tt.readWord1=function(){this.containsEsc=!1;for(var b="",k=!0,G=this.pos,D=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ne=this.fullCharCodeAtPos();if(Yt(ne,D))this.pos+=ne<=65535?1:2;else if(ne===92){this.containsEsc=!0,b+=this.input.slice(G,this.pos);var Re=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var pt=this.readCodePoint();(k?tr:Yt)(pt,D)||this.invalidStringToken(Re,"Invalid Unicode escape"),b+=Na(pt),G=this.pos}else break;k=!1}return b+this.input.slice(G,this.pos)},Tt.readWord=function(){var b=this.readWord1(),k=re.name;return this.keywords.test(b)&&(k=Zt[b]),this.finishToken(k,b)};var Aa="7.4.1";Pt.acorn={Parser:Pt,version:Aa,defaultOptions:fr,Position:ze,SourceLocation:wt,getLineInfo:Vt,Node:Vi,TokenType:Xt,tokTypes:re,keywordTypes:Zt,TokContext:ro,tokContexts:Si,isIdentifierChar:Yt,isIdentifierStart:tr,Token:Ft,isNewLine:_t,lineBreak:_r,lineBreakG:Ot,nonASCIIwhitespace:Kt};function Co(b,k){return Pt.parse(b,k)}function an(b,k,G){return Pt.parseExpressionAt(b,k,G)}function Yr(b,k){return Pt.tokenizer(b,k)}function bt(b,k){b.prototype=Object.create(k.prototype),b.prototype.constructor=b,b.__proto__=k}function Ls(b){var k=typeof Map=="function"?new Map:void 0;return Ls=function(D){if(D===null||!Kl(D))return D;if(typeof D!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(D))return k.get(D);k.set(D,ne)}function ne(){return qi(D,arguments,mo(this).constructor)}return ne.prototype=Object.create(D.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),Oa(ne,D)},Ls(b)}function Gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function qi(b,k,G){return Gt()?qi=Reflect.construct:qi=function(ne,Re,pt){var It=[null];It.push.apply(It,Re);var jt=Function.bind.apply(ne,It),Nr=new jt;return pt&&Oa(Nr,pt.prototype),Nr},qi.apply(null,arguments)}function Kl(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function Oa(b,k){return Oa=Object.setPrototypeOf||function(D,ne){return D.__proto__=ne,D},Oa(b,k)}function mo(b){return mo=Object.setPrototypeOf?Object.getPrototypeOf:function(G){return G.__proto__||Object.getPrototypeOf(G)},mo(b)}var Io=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ls(Error)),xa=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ls(SyntaxError)),Os=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ls(ReferenceError)),Fs=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ls(TypeError)),Ql=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Io),So=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(xa),As=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Os),Ka={UnknownError:[3001,"%0",Ql],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ql],NodeTypeSyntaxError:[1001,"Unknown node type: %0",As],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",As],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",As],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",As],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",As],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",As],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",As],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",As],ParamTypeSyntaxError:[1009,"Unknown param type: %0",As],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",As],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Os],VariableUndefinedReferenceError:[2002,"%0 is not defined",Os],IsNotConstructor:[2003,"%0 is not a constructor",Fs]};function Oo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function ws(b,k,G){return Oo()?ws=Reflect.construct:ws=function(ne,Re,pt){var It=[null];It.push.apply(It,Re);var jt=Function.bind.apply(ne,It),Nr=new jt;return pt&&ko(Nr,pt.prototype),Nr},ws.apply(null,arguments)}function ko(b,k){return ko=Object.setPrototypeOf||function(D,ne){return D.__proto__=ne,D},ko(b,k)}var Yu="0.0.3";function ul(b,k){Object.defineProperty(b,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var rs=Object.prototype.hasOwnProperty,ve=Symbol("Break"),De=Symbol("Continue"),mt=Symbol("DefaultCase"),ir=Symbol("EmptyStatementReturn"),yn=Symbol("WithScopeName"),Qn=Symbol("SuperScopeName"),ya=Symbol("RootScopeName"),qo=Symbol("GlobalScopeName");function Fa(b){return typeof b=="function"}var Fo=function(){function b(G){this.interpreter=G}var k=b.prototype;return k.generator=function(){var D=this.interpreter;function ne(){return this.getCurrentScope()}function Re(){return this.getGlobalScope()}function pt(){return this.getCurrentContext()}return{getOptions:D.getOptions.bind(D),getCurrentScope:ne.bind(D),getGlobalScope:Re.bind(D),getCurrentContext:pt.bind(D),getExecStartTime:D.getExecStartTime.bind(D)}},b}();function Zo(b,k,G){if(G===void 0&&(G=!0),!(b instanceof Fo))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var D=b.generator(),ne=D.getOptions(),Re={timeout:ne.timeout,_initEnv:function(){G||this.setCurrentContext(D.getCurrentContext()),this.execStartTime=D.getExecStartTime(),this.execEndTime=this.execStartTime}},pt=G?D.getGlobalScope():D.getCurrentScope(),It=new fs(pt,Re);return It.evaluate(k)}}Object.defineProperty(Zo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function To(b){if(!(b instanceof Fo))throw new Error("Illegal call");for(var k=b.generator(),G=arguments.length,D=new Array(G>1?G-1:0),ne=1;ne<G;ne++)D[ne-1]=arguments[ne];var Re=D.pop(),pt=new fs(k.getGlobalScope(),k.getOptions()),It=`
		    (function anonymous(`+D.join(",")+`){
		        `+Re+`
		    });
		    `;return pt.evaluate(It)}Object.defineProperty(To,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ds=function(k){this.value=k},cs=function(k){this.value=k},Ts=function(k){this.value=k},Eu=function(k,G,D){G===void 0&&(G=null),this.name=D,this.parent=G,this.data=k,this.labelStack=[]};function qu(){}function Cu(b,k){return b===void 0&&(b=null),new Eu(Object.create(null),b,k)}function Su(b){return Object.create(b)}var za={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Zo,Function:To};typeof JSON!="undefined"&&(za.JSON=JSON),typeof Promise!="undefined"&&(za.Promise=Promise),typeof Set!="undefined"&&(za.Set=Set),typeof Map!="undefined"&&(za.Map=Map),typeof Symbol!="undefined"&&(za.Symbol=Symbol),typeof Proxy!="undefined"&&(za.Proxy=Proxy),typeof WeakMap!="undefined"&&(za.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(za.WeakSet=WeakSet),typeof Reflect!="undefined"&&(za.Reflect=Reflect);var fs=function(){function b(G,D){G===void 0&&(G=b.global),D===void 0&&(D={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:D.ecmaVersion||b.ecmaVersion,timeout:D.timeout||0,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction===void 0?b.globalContextInFunction:D.globalContextInFunction,_initEnv:D._initEnv},this.context=G||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=b.prototype;return k.initEnvironment=function(D){var ne;if(D instanceof Eu)ne=D;else{var Re=null,pt=this.createSuperScope(D);this.options.rootContext&&(Re=new Eu(Su(this.options.rootContext),pt,ya)),ne=new Eu(D,Re||pt,qo)}this.globalScope=ne,this.currentScope=this.globalScope,this.globalContext=ne.data,this.currentContext=ne.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var It=this.options._initEnv;It&&It.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(D){D===void 0&&(D=0),this.options.timeout=D},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(D){return D instanceof Ql||D instanceof As||D instanceof So},k.createSuperScope=function(D){var ne=Object.assign({},za),Re=Object.keys(ne);return Re.forEach(function(pt){pt in D&&delete ne[pt]}),new Eu(ne,null,Qn)},k.setCurrentContext=function(D){this.currentContext=D},k.setCurrentScope=function(D){this.currentScope=D},k.evaluate=function(D){D===void 0&&(D="");var ne;if(!!D)return ne=Co(D,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(ne,D)},k.appendCode=function(D){return this.evaluate(D)},k.evaluateNode=function(D,ne){var Re=this;ne===void 0&&(ne=""),this.value=void 0,this.source=ne,this.sourceList.push(ne),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var pt=this.getCurrentScope(),It=this.getCurrentContext(),jt=pt.labelStack.concat([]),Nr=this.callStack.concat([]),Wr=function(){Re.setCurrentScope(pt),Re.setCurrentContext(It),pt.labelStack=jt,Re.callStack=Nr};try{var Kn=this.createClosure(D);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Kn()}catch(Hi){throw Hi}finally{Wr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(D,ne,Re){var pt=D[1].replace("%0",String(ne));return Re!==null&&(pt+=this.getNodePosition(Re||this.lastExecNode)),pt},k.createError=function(D,ne){return new ne(D)},k.createThrowError=function(D,ne){return this.createError(D,ne)},k.createInternalThrowError=function(D,ne,Re){return this.createError(this.createErrorMessage(D,ne,Re),D[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var D=this.options.timeout||0,ne=Date.now();return ne-this.execStartTime>D},k.getNodePosition=function(D){if(D){var ne="";return D.loc?" ["+D.loc.start.line+":"+D.loc.start.column+"]"+ne:""}return""},k.createClosure=function(D){var ne=this,Re;switch(D.type){case"BinaryExpression":Re=this.binaryExpressionHandler(D);break;case"LogicalExpression":Re=this.logicalExpressionHandler(D);break;case"UnaryExpression":Re=this.unaryExpressionHandler(D);break;case"UpdateExpression":Re=this.updateExpressionHandler(D);break;case"ObjectExpression":Re=this.objectExpressionHandler(D);break;case"ArrayExpression":Re=this.arrayExpressionHandler(D);break;case"CallExpression":Re=this.callExpressionHandler(D);break;case"NewExpression":Re=this.newExpressionHandler(D);break;case"MemberExpression":Re=this.memberExpressionHandler(D);break;case"ThisExpression":Re=this.thisExpressionHandler(D);break;case"SequenceExpression":Re=this.sequenceExpressionHandler(D);break;case"Literal":Re=this.literalHandler(D);break;case"Identifier":Re=this.identifierHandler(D);break;case"AssignmentExpression":Re=this.assignmentExpressionHandler(D);break;case"FunctionDeclaration":Re=this.functionDeclarationHandler(D);break;case"VariableDeclaration":Re=this.variableDeclarationHandler(D);break;case"BlockStatement":case"Program":Re=this.programHandler(D);break;case"ExpressionStatement":Re=this.expressionStatementHandler(D);break;case"EmptyStatement":Re=this.emptyStatementHandler(D);break;case"ReturnStatement":Re=this.returnStatementHandler(D);break;case"FunctionExpression":Re=this.functionExpressionHandler(D);break;case"IfStatement":Re=this.ifStatementHandler(D);break;case"ConditionalExpression":Re=this.conditionalExpressionHandler(D);break;case"ForStatement":Re=this.forStatementHandler(D);break;case"WhileStatement":Re=this.whileStatementHandler(D);break;case"DoWhileStatement":Re=this.doWhileStatementHandler(D);break;case"ForInStatement":Re=this.forInStatementHandler(D);break;case"WithStatement":Re=this.withStatementHandler(D);break;case"ThrowStatement":Re=this.throwStatementHandler(D);break;case"TryStatement":Re=this.tryStatementHandler(D);break;case"ContinueStatement":Re=this.continueStatementHandler(D);break;case"BreakStatement":Re=this.breakStatementHandler(D);break;case"SwitchStatement":Re=this.switchStatementHandler(D);break;case"LabeledStatement":Re=this.labeledStatementHandler(D);break;case"DebuggerStatement":Re=this.debuggerStatementHandler(D);break;default:throw this.createInternalThrowError(Ka.NodeTypeSyntaxError,D.type,D)}return function(){var pt=ne.options.timeout;if(pt&&pt>0&&ne.checkTimeout())throw ne.createInternalThrowError(Ka.ExecutionTimeOutError,pt,null);return ne.lastExecNode=D,Re.apply(void 0,arguments)}},k.binaryExpressionHandler=function(D){var ne=this,Re=this.createClosure(D.left),pt=this.createClosure(D.right);return function(){var It=Re(),jt=pt();switch(D.operator){case"==":return It==jt;case"!=":return It!=jt;case"===":return It===jt;case"!==":return It!==jt;case"<":return It<jt;case"<=":return It<=jt;case">":return It>jt;case">=":return It>=jt;case"<<":return It<<jt;case">>":return It>>jt;case">>>":return It>>>jt;case"+":return It+jt;case"-":return It-jt;case"*":return It*jt;case"**":return Math.pow(It,jt);case"/":return It/jt;case"%":return It%jt;case"|":return It|jt;case"^":return It^jt;case"&":return It&jt;case"in":return It in jt;case"instanceof":return It instanceof jt;default:throw ne.createInternalThrowError(Ka.BinaryOperatorSyntaxError,D.operator,D)}}},k.logicalExpressionHandler=function(D){var ne=this,Re=this.createClosure(D.left),pt=this.createClosure(D.right);return function(){switch(D.operator){case"||":return Re()||pt();case"&&":return Re()&&pt();default:throw ne.createInternalThrowError(Ka.LogicalOperatorSyntaxError,D.operator,D)}}},k.unaryExpressionHandler=function(D){var ne=this;switch(D.operator){case"delete":var Re=this.createObjectGetter(D.argument),pt=this.createNameGetter(D.argument);return function(){var Wr=Re(),Kn=pt();return delete Wr[Kn]};default:var It;if(D.operator==="typeof"&&D.argument.type==="Identifier"){var jt=this.createObjectGetter(D.argument),Nr=this.createNameGetter(D.argument);It=function(){return jt()[Nr()]}}else It=this.createClosure(D.argument);return function(){var Wr=It();switch(D.operator){case"-":return-Wr;case"+":return+Wr;case"!":return!Wr;case"~":return~Wr;case"void":return;case"typeof":return typeof Wr;default:throw ne.createInternalThrowError(Ka.UnaryOperatorSyntaxError,D.operator,D)}}}},k.updateExpressionHandler=function(D){var ne=this,Re=this.createObjectGetter(D.argument),pt=this.createNameGetter(D.argument);return function(){var It=Re(),jt=pt();switch(ne.assertVariable(It,jt,D),D.operator){case"++":return D.prefix?++It[jt]:It[jt]++;case"--":return D.prefix?--It[jt]:It[jt]--;default:throw ne.createInternalThrowError(Ka.UpdateOperatorSyntaxError,D.operator,D)}}},k.objectExpressionHandler=function(D){var ne=this,Re=[];function pt(jt){return jt.type==="Identifier"?jt.name:jt.type==="Literal"?jt.value:this.throwError(Ka.ObjectStructureSyntaxError,jt.type,jt)}var It=Object.create(null);return D.properties.forEach(function(jt){var Nr=jt.kind,Wr=pt(jt.key);(!It[Wr]||Nr==="init")&&(It[Wr]={}),It[Wr][Nr]=ne.createClosure(jt.value),Re.push({key:Wr,property:jt})}),function(){for(var jt={},Nr=Re.length,Wr=0;Wr<Nr;Wr++){var Kn=Re[Wr],Hi=Kn.key,Gi=It[Hi],Ni=Gi.init?Gi.init():void 0,no=Gi.get?Gi.get():function(){},go=Gi.set?Gi.set():function(fc){};if("set"in Gi||"get"in Gi){var ka={configurable:!0,enumerable:!0,get:no,set:go};Object.defineProperty(jt,Hi,ka)}else{var iu=Kn.property,Ol=iu.kind;iu.key.type==="Identifier"&&iu.value.type==="FunctionExpression"&&Ol==="init"&&!iu.value.id&&ul(Ni,iu.key.name),jt[Hi]=Ni}}return jt}},k.arrayExpressionHandler=function(D){var ne=this,Re=D.elements.map(function(pt){return pt&&ne.createClosure(pt)});return function(){for(var pt=Re.length,It=Array(pt),jt=0;jt<pt;jt++){var Nr=Re[jt];Nr&&(It[jt]=Nr())}return It}},k.safeObjectGet=function(D,ne,Re){return D[ne]},k.createCallFunctionGetter=function(D){var ne=this;switch(D.type){case"MemberExpression":var Re=this.createClosure(D.object),pt=this.createMemberKeyGetter(D),It=this.source;return function(){var Nr=Re(),Wr=pt(),Kn=ne.safeObjectGet(Nr,Wr,D);if(!Kn||!Fa(Kn)){var Hi=It.slice(D.start,D.end);throw ne.createInternalThrowError(Ka.FunctionUndefinedReferenceError,Hi,D)}return Kn.__IS_EVAL_FUNC?function(Gi){return Kn(new Fo(ne),Gi,!0)}:Kn.__IS_FUNCTION_FUNC?function(){for(var Gi=arguments.length,Ni=new Array(Gi),no=0;no<Gi;no++)Ni[no]=arguments[no];return Kn.apply(void 0,[new Fo(ne)].concat(Ni))}:Kn.bind(Nr)};default:var jt=this.createClosure(D);return function(){var Nr="";D.type==="Identifier"&&(Nr=D.name);var Wr=jt();if(!Wr||!Fa(Wr))throw ne.createInternalThrowError(Ka.FunctionUndefinedReferenceError,Nr,D);if(D.type==="Identifier"&&Wr.__IS_EVAL_FUNC&&Nr==="eval")return function(Gi){var Ni=ne.getScopeFromName(Nr,ne.getCurrentScope()),no=Ni.name===Qn||Ni.name===qo||Ni.name===ya;return Wr(new Fo(ne),Gi,!no)};if(Wr.__IS_EVAL_FUNC)return function(Gi){return Wr(new Fo(ne),Gi,!0)};if(Wr.__IS_FUNCTION_FUNC)return function(){for(var Gi=arguments.length,Ni=new Array(Gi),no=0;no<Gi;no++)Ni[no]=arguments[no];return Wr.apply(void 0,[new Fo(ne)].concat(Ni))};var Kn=ne.options.globalContextInFunction;if(D.type==="Identifier"){var Hi=ne.getIdentifierScope(D);Hi.name===yn&&(Kn=Hi.data)}return Wr.bind(Kn)}}},k.callExpressionHandler=function(D){var ne=this,Re=this.createCallFunctionGetter(D.callee),pt=D.arguments.map(function(It){return ne.createClosure(It)});return function(){return Re().apply(void 0,pt.map(function(It){return It()}))}},k.functionExpressionHandler=function(D){var ne=this,Re=this,pt=this.source,It=this.collectDeclVars,jt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Nr=D.id?D.id.name:"",Wr=D.params.length,Kn=D.params.map(function(no){return ne.createParamNameGetter(no)}),Hi=this.createClosure(D.body),Gi=this.collectDeclVars,Ni=this.collectDeclFuncs;return this.collectDeclVars=It,this.collectDeclFuncs=jt,function(){var no=Re.getCurrentScope(),go=function ka(){for(var iu=arguments.length,Ol=new Array(iu),fc=0;fc<iu;fc++)Ol[fc]=arguments[fc];Re.callStack.push(""+Nr);var hc=Re.getCurrentScope(),pc=Cu(no,"FunctionScope("+Nr+")");Re.setCurrentScope(pc),Re.addDeclarationsToScope(Gi,Ni,pc),Nr&&(pc.data[Nr]=ka),pc.data.arguments=arguments,Kn.forEach(function(Fl,El){pc.data[Fl()]=Ol[El]});var dc=Re.getCurrentContext();Re.setCurrentContext(this);var Ru=Hi();if(Re.setCurrentContext(dc),Re.setCurrentScope(hc),Re.callStack.pop(),Ru instanceof Ds)return Ru.value};return ul(go,Nr),Object.defineProperty(go,"length",{value:Wr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(go,"toString",{value:function(){return pt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(go,"valueOf",{value:function(){return pt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),go}},k.newExpressionHandler=function(D){var ne=this,Re=this.source,pt=this.createClosure(D.callee),It=D.arguments.map(function(jt){return ne.createClosure(jt)});return function(){var jt=pt();if(!Fa(jt)||jt.__IS_EVAL_FUNC){var Nr=D.callee,Wr=Re.slice(Nr.start,Nr.end);throw ne.createInternalThrowError(Ka.IsNotConstructor,Wr,D)}return jt.__IS_FUNCTION_FUNC?jt.apply(void 0,[new Fo(ne)].concat(It.map(function(Kn){return Kn()}))):ws(jt,It.map(function(Kn){return Kn()}))}},k.memberExpressionHandler=function(D){var ne=this.createClosure(D.object),Re=this.createMemberKeyGetter(D);return function(){var pt=ne(),It=Re();return pt[It]}},k.thisExpressionHandler=function(D){var ne=this;return function(){return ne.getCurrentContext()}},k.sequenceExpressionHandler=function(D){var ne=this,Re=D.expressions.map(function(pt){return ne.createClosure(pt)});return function(){for(var pt,It=Re.length,jt=0;jt<It;jt++){var Nr=Re[jt];pt=Nr()}return pt}},k.literalHandler=function(D){return function(){return D.regex?new RegExp(D.regex.pattern,D.regex.flags):D.value}},k.identifierHandler=function(D){var ne=this;return function(){var Re=ne.getCurrentScope(),pt=ne.getScopeDataFromName(D.name,Re);return ne.assertVariable(pt,D.name,D),pt[D.name]}},k.getIdentifierScope=function(D){var ne=this.getCurrentScope(),Re=this.getScopeFromName(D.name,ne);return Re},k.assignmentExpressionHandler=function(D){var ne=this;D.left.type==="Identifier"&&D.right.type==="FunctionExpression"&&!D.right.id&&(D.right.id={type:"Identifier",name:D.left.name});var Re=this.createObjectGetter(D.left),pt=this.createNameGetter(D.left),It=this.createClosure(D.right);return function(){var jt=Re(),Nr=pt(),Wr=It();switch(D.operator!=="="&&ne.assertVariable(jt,Nr,D),D.operator){case"=":return jt[Nr]=Wr;case"+=":return jt[Nr]+=Wr;case"-=":return jt[Nr]-=Wr;case"*=":return jt[Nr]*=Wr;case"**=":return jt[Nr]=Math.pow(jt[Nr],Wr);case"/=":return jt[Nr]/=Wr;case"%=":return jt[Nr]%=Wr;case"<<=":return jt[Nr]<<=Wr;case">>=":return jt[Nr]>>=Wr;case">>>=":return jt[Nr]>>>=Wr;case"&=":return jt[Nr]&=Wr;case"^=":return jt[Nr]^=Wr;case"|=":return jt[Nr]|=Wr;default:throw ne.createInternalThrowError(Ka.AssignmentExpressionSyntaxError,D.type,D)}}},k.functionDeclarationHandler=function(D){if(D.id){var ne=this.functionExpressionHandler(D);Object.defineProperty(ne,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(D.id.name,ne)}return function(){return ir}},k.getVariableName=function(D){if(D.type==="Identifier")return D.name;throw this.createInternalThrowError(Ka.VariableTypeSyntaxError,D.type,D)},k.variableDeclarationHandler=function(D){for(var ne=this,Re,pt=[],It=0;It<D.declarations.length;It++){var jt=D.declarations[It];this.varDeclaration(this.getVariableName(jt.id)),jt.init&&pt.push({type:"AssignmentExpression",operator:"=",left:jt.id,right:jt.init})}return pt.length&&(Re=this.createClosure({type:"BlockStatement",body:pt})),function(){if(Re){var Nr=ne.isVarDeclMode;ne.isVarDeclMode=!0,Re(),ne.isVarDeclMode=Nr}return ir}},k.assertVariable=function(D,ne,Re){if(D===this.globalScope.data&&!(ne in D))throw this.createInternalThrowError(Ka.VariableUndefinedReferenceError,ne,Re)},k.programHandler=function(D){var ne=this,Re=D.body.map(function(pt){return ne.createClosure(pt)});return function(){for(var pt=ir,It=0;It<Re.length;It++){var jt=Re[It],Nr=ne.setValue(jt());if(Nr!==ir&&(pt=Nr,pt instanceof Ds||pt instanceof cs||pt instanceof Ts||pt===ve||pt===De))break}return pt}},k.expressionStatementHandler=function(D){return this.createClosure(D.expression)},k.emptyStatementHandler=function(D){return function(){return ir}},k.returnStatementHandler=function(D){var ne=D.argument?this.createClosure(D.argument):qu;return function(){return new Ds(ne())}},k.ifStatementHandler=function(D){var ne=this.createClosure(D.test),Re=this.createClosure(D.consequent),pt=D.alternate?this.createClosure(D.alternate):function(){return ir};return function(){return ne()?Re():pt()}},k.conditionalExpressionHandler=function(D){return this.ifStatementHandler(D)},k.forStatementHandler=function(D){var ne=this,Re=qu,pt=D.test?this.createClosure(D.test):function(){return!0},It=qu,jt=this.createClosure(D.body);return D.type==="ForStatement"&&(Re=D.init?this.createClosure(D.init):Re,It=D.update?this.createClosure(D.update):qu),function(Nr){var Wr,Kn=ir,Hi=D.type==="DoWhileStatement";for(Nr&&Nr.type==="LabeledStatement"&&(Wr=Nr.label.name),Re();Hi||pt();It()){Hi=!1;var Gi=ne.setValue(jt());if(!(Gi===ir||Gi===De)){if(Gi===ve)break;if(Kn=Gi,Kn instanceof Ts&&Kn.value===Wr){Kn=ir;continue}if(Kn instanceof Ds||Kn instanceof cs||Kn instanceof Ts)break}}return Kn}},k.whileStatementHandler=function(D){return this.forStatementHandler(D)},k.doWhileStatementHandler=function(D){return this.forStatementHandler(D)},k.forInStatementHandler=function(D){var ne=this,Re=D.left,pt=this.createClosure(D.right),It=this.createClosure(D.body);return D.left.type==="VariableDeclaration"&&(this.createClosure(D.left)(),Re=D.left.declarations[0].id),function(jt){var Nr,Wr=ir,Kn;jt&&jt.type==="LabeledStatement"&&(Nr=jt.label.name);var Hi=pt();for(Kn in Hi){ne.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Re,right:{type:"Literal",value:Kn}})();var Gi=ne.setValue(It());if(!(Gi===ir||Gi===De)){if(Gi===ve)break;if(Wr=Gi,Wr instanceof Ts&&Wr.value===Nr){Wr=ir;continue}if(Wr instanceof Ds||Wr instanceof cs||Wr instanceof Ts)break}}return Wr}},k.withStatementHandler=function(D){var ne=this,Re=this.createClosure(D.object),pt=this.createClosure(D.body);return function(){var It=Re(),jt=ne.getCurrentScope(),Nr=new Eu(It,jt,yn);ne.setCurrentScope(Nr);var Wr=ne.setValue(pt());return ne.setCurrentScope(jt),Wr}},k.throwStatementHandler=function(D){var ne=this,Re=this.createClosure(D.argument);return function(){throw ne.setValue(void 0),Re()}},k.tryStatementHandler=function(D){var ne=this,Re=this.createClosure(D.block),pt=D.handler?this.catchClauseHandler(D.handler):null,It=D.finalizer?this.createClosure(D.finalizer):null;return function(){var jt=ne.getCurrentScope(),Nr=ne.getCurrentContext(),Wr=jt.labelStack.concat([]),Kn=ne.callStack.concat([]),Hi=ir,Gi,Ni,no=function(){ne.setCurrentScope(jt),ne.setCurrentContext(Nr),jt.labelStack=Wr,ne.callStack=Kn};try{Hi=ne.setValue(Re()),Hi instanceof Ds&&(Gi=Hi)}catch(go){if(no(),ne.isInterruptThrow(go))throw go;if(pt)try{Hi=ne.setValue(pt(go)),Hi instanceof Ds&&(Gi=Hi)}catch(ka){if(no(),ne.isInterruptThrow(ka))throw ka;Ni=ka}}if(It)try{Hi=It(),Hi instanceof Ds&&(Gi=Hi)}catch(go){if(no(),ne.isInterruptThrow(go))throw go;Ni=go}if(Ni)throw Ni;return Gi||Hi}},k.catchClauseHandler=function(D){var ne=this,Re=this.createParamNameGetter(D.param),pt=this.createClosure(D.body);return function(It){var jt,Nr=ne.getCurrentScope(),Wr=Nr.data,Kn=Re(),Hi=rs.call(Wr,Kn),Gi=Wr[Kn];return Wr[Kn]=It,jt=pt(),Hi?Wr[Kn]=Gi:delete Wr[Kn],jt}},k.continueStatementHandler=function(D){return function(){return D.label?new Ts(D.label.name):De}},k.breakStatementHandler=function(D){return function(){return D.label?new cs(D.label.name):ve}},k.switchStatementHandler=function(D){var ne=this,Re=this.createClosure(D.discriminant),pt=D.cases.map(function(It){return ne.switchCaseHandler(It)});return function(){for(var It=Re(),jt=!1,Nr,Wr,Kn,Hi=0;Hi<pt.length;Hi++){var Gi=pt[Hi](),Ni=Gi.testClosure();if(Ni===mt){Kn=Gi;continue}if(jt||Ni===It){if(jt=!0,Wr=ne.setValue(Gi.bodyClosure()),Wr===ir)continue;if(Wr===ve||(Nr=Wr,Nr instanceof Ds||Nr instanceof cs||Nr instanceof Ts||Nr===De))break}}if(!jt&&Kn){Wr=ne.setValue(Kn.bodyClosure());var no=Wr===ir||Wr===ve||Wr===De;no||(Nr=Wr)}return Nr}},k.switchCaseHandler=function(D){var ne=D.test?this.createClosure(D.test):function(){return mt},Re=this.createClosure({type:"BlockStatement",body:D.consequent});return function(){return{testClosure:ne,bodyClosure:Re}}},k.labeledStatementHandler=function(D){var ne=this,Re=D.label.name,pt=this.createClosure(D.body);return function(){var It,jt=ne.getCurrentScope();return jt.labelStack.push(Re),It=pt(D),It instanceof cs&&It.value===Re&&(It=ir),jt.labelStack.pop(),It}},k.debuggerStatementHandler=function(D){return function(){debugger;return ir}},k.createParamNameGetter=function(D){if(D.type==="Identifier")return function(){return D.name};throw this.createInternalThrowError(Ka.ParamTypeSyntaxError,D.type,D)},k.createObjectKeyGetter=function(D){var ne;return D.type==="Identifier"?ne=function(){return D.name}:ne=this.createClosure(D),function(){return ne()}},k.createMemberKeyGetter=function(D){return D.computed?this.createClosure(D.property):this.createObjectKeyGetter(D.property)},k.createObjectGetter=function(D){var ne=this;switch(D.type){case"Identifier":return function(){return ne.getScopeDataFromName(D.name,ne.getCurrentScope())};case"MemberExpression":return this.createClosure(D.object);default:throw this.createInternalThrowError(Ka.AssignmentTypeSyntaxError,D.type,D)}},k.createNameGetter=function(D){switch(D.type){case"Identifier":return function(){return D.name};case"MemberExpression":return this.createMemberKeyGetter(D);default:throw this.createInternalThrowError(Ka.AssignmentTypeSyntaxError,D.type,D)}},k.varDeclaration=function(D){var ne=this.collectDeclVars;ne[D]=void 0},k.funcDeclaration=function(D,ne){var Re=this.collectDeclFuncs;Re[D]=ne},k.addDeclarationsToScope=function(D,ne,Re){var pt=Re.data;for(var It in ne){var jt=ne[It];pt[It]=jt&&jt()}for(var Nr in D)Nr in pt||(pt[Nr]=void 0)},k.getScopeValue=function(D,ne){var Re=this.getScopeFromName(D,ne);return Re.data[D]},k.getScopeDataFromName=function(D,ne){return this.getScopeFromName(D,ne).data},k.getScopeFromName=function(D,ne){var Re=ne;do if(D in Re.data)return Re;while(Re=Re.parent);return this.globalScope},k.setValue=function(D){var ne=this.callStack.length;return this.isVarDeclMode||ne||D===ir||D===ve||D===De||D instanceof cs||D instanceof Ts||(this.value=D instanceof Ds?D.value:D),D},k.getValue=function(){return this.value},b}();fs.version=Yu,fs.eval=Zo,fs.Function=To,fs.ecmaVersion=5,fs.globalContextInFunction=void 0,fs.global=Object.create(null);function nu(b){return b===void 0&&(b=Object.create(null)),b}function Au(b,k,G){k===void 0&&(k=[]),G===void 0&&(G={});var D=G.parsingContext,ne=G.timeout===void 0?0:G.timeout,Re=`
    (function anonymous(`+k.join(",")+`){
         `+b+`
    });
    `,pt=new fs(D,{ecmaVersion:G.ecmaVersion,timeout:ne,rootContext:G.rootContext,globalContextInFunction:G.globalContextInFunction});return pt.evaluate(Re)}function uf(b,k,G){var D=new fs(k,G);return D.evaluate(b)}var Vh=uf,Xs=function(){function b(G){this._code=G}var k=b.prototype;return k.runInContext=function(D){return uf(this._code,D)},k.runInNewContext=function(D){return uf(this._code,D)},b}(),lf=function(b,k,G){return uf(b,k,G)};function ll(){for(var b=arguments.length,k=new Array(b),G=0;G<b;G++)k[G]=arguments[G];var D=k.pop();return Au(D||"",k)}var Fc=lf},20396:function(pi,Se,fe){var We;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(de,y,Be,K){"use strict";var ke=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,he=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ut=ke||he,Ae=["","webkit","Moz","MS","ms","o"],Xe=ut?"":y.createElement("div"),Ct="function",Lt=Math.round,tr=Math.abs,Yt=Date.now;function Xt(ve,De,mt){return setTimeout(Ot(ve,mt),De)}function Er(ve,De,mt){return Array.isArray(ve)?(cr(ve,mt[De],mt),!0):!1}function cr(ve,De,mt){var ir;if(!!ve)if(ve.forEach)ve.forEach(De,mt);else if(ve.length!==K)for(ir=0;ir<ve.length;)De.call(mt,ve[ir],ir,ve),ir++;else for(ir in ve)ve.hasOwnProperty(ir)&&De.call(mt,ve[ir],ir,ve)}function Rt(ve,De,mt){var ir="DEPRECATED METHOD: "+De+`
`+mt+` AT 
`;return function(){var yn=new Error("get-stack-trace"),Qn=yn&&yn.stack?yn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ya=de.console&&(de.console.warn||de.console.log);return ya&&ya.call(de.console,ir,Qn),ve.apply(this,arguments)}}var Zt;typeof Object.assign!="function"?Zt=function(De){if(De===K||De===null)throw new TypeError("Cannot convert undefined or null to object");for(var mt=Object(De),ir=1;ir<arguments.length;ir++){var yn=arguments[ir];if(yn!==K&&yn!==null)for(var Qn in yn)yn.hasOwnProperty(Qn)&&(mt[Qn]=yn[Qn])}return mt}:Zt=Object.assign;var Rr=Rt(function(De,mt,ir){for(var yn=Object.keys(mt),Qn=0;Qn<yn.length;)(!ir||ir&&De[yn[Qn]]===K)&&(De[yn[Qn]]=mt[yn[Qn]]),Qn++;return De},"extend","Use `assign`."),re=Rt(function(De,mt){return Rr(De,mt,!0)},"merge","Use `assign`.");function _r(ve,De,mt){var ir=De.prototype,yn;yn=ve.prototype=Object.create(ir),yn.constructor=ve,yn._super=ir,mt&&Zt(yn,mt)}function Ot(ve,De){return function(){return ve.apply(De,arguments)}}function _t(ve,De){return typeof ve==Ct?ve.apply(De&&De[0]||K,De):ve}function Kt(ve,De){return ve===K?De:ve}function Ue(ve,De,mt){cr(tt(De),function(ir){ve.addEventListener(ir,mt,!1)})}function Cr(ve,De,mt){cr(tt(De),function(ir){ve.removeEventListener(ir,mt,!1)})}function nn(ve,De){for(;ve;){if(ve==De)return!0;ve=ve.parentNode}return!1}function ue(ve,De){return ve.indexOf(De)>-1}function tt(ve){return ve.trim().split(/\s+/g)}function Z(ve,De,mt){if(ve.indexOf&&!mt)return ve.indexOf(De);for(var ir=0;ir<ve.length;){if(mt&&ve[ir][mt]==De||!mt&&ve[ir]===De)return ir;ir++}return-1}function _e(ve){return Array.prototype.slice.call(ve,0)}function ze(ve,De,mt){for(var ir=[],yn=[],Qn=0;Qn<ve.length;){var ya=De?ve[Qn][De]:ve[Qn];Z(yn,ya)<0&&ir.push(ve[Qn]),yn[Qn]=ya,Qn++}return mt&&(De?ir=ir.sort(function(Fa,Fo){return Fa[De]>Fo[De]}):ir=ir.sort()),ir}function wt(ve,De){for(var mt,ir,yn=De[0].toUpperCase()+De.slice(1),Qn=0;Qn<Ae.length;){if(mt=Ae[Qn],ir=mt?mt+yn:De,ir in ve)return ir;Qn++}return K}var Vt=1;function fr(){return Vt++}function Mt(ve){var De=ve.ownerDocument||ve;return De.defaultView||De.parentWindow||de}var Fr=/mobile|tablet|ip(ad|hone|od)|android/i,Xn="ontouchstart"in de,Jr=wt(de,"PointerEvent")!==K,Ri=Xn&&Fr.test(navigator.userAgent),yi="touch",ln="pen",Sa="mouse",fa="kinect",Di=25,Ia=1,ui=2,Ji=4,di=8,_i=1,Uo=2,Eo=4,to=8,Pt=16,ge=Uo|Eo,oe=to|Pt,we=ge|oe,V=["x","y"],at=["clientX","clientY"];function sr(ve,De){var mt=this;this.manager=ve,this.callback=De,this.element=ve.element,this.target=ve.options.inputTarget,this.domHandler=function(ir){_t(ve.options.enable,[ve])&&mt.handler(ir)},this.init()}sr.prototype={handler:function(){},init:function(){this.evEl&&Ue(this.element,this.evEl,this.domHandler),this.evTarget&&Ue(this.target,this.evTarget,this.domHandler),this.evWin&&Ue(Mt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Cr(this.element,this.evEl,this.domHandler),this.evTarget&&Cr(this.target,this.evTarget,this.domHandler),this.evWin&&Cr(Mt(this.element),this.evWin,this.domHandler)}};function $r(ve){var De,mt=ve.options.inputClass;return mt?De=mt:Jr?De=qe:Ri?De=pr:Xn?De=er:De=ha,new De(ve,Ke)}function Ke(ve,De,mt){var ir=mt.pointers.length,yn=mt.changedPointers.length,Qn=De&Ia&&ir-yn==0,ya=De&(Ji|di)&&ir-yn==0;mt.isFirst=!!Qn,mt.isFinal=!!ya,Qn&&(ve.session={}),mt.eventType=De,Nt(ve,mt),ve.emit("hammer.input",mt),ve.recognize(mt),ve.session.prevInput=mt}function Nt(ve,De){var mt=ve.session,ir=De.pointers,yn=ir.length;mt.firstInput||(mt.firstInput=Lr(De)),yn>1&&!mt.firstMultiple?mt.firstMultiple=Lr(De):yn===1&&(mt.firstMultiple=!1);var Qn=mt.firstInput,ya=mt.firstMultiple,qo=ya?ya.center:Qn.center,Fa=De.center=gn(ir);De.timeStamp=Yt(),De.deltaTime=De.timeStamp-Qn.timeStamp,De.angle=Bi(qo,Fa),De.distance=Sn(qo,Fa),Sr(mt,De),De.offsetDirection=ii(De.deltaX,De.deltaY);var Fo=mi(De.deltaTime,De.deltaX,De.deltaY);De.overallVelocityX=Fo.x,De.overallVelocityY=Fo.y,De.overallVelocity=tr(Fo.x)>tr(Fo.y)?Fo.x:Fo.y,De.scale=ya?Ga(ya.pointers,ir):1,De.rotation=ya?Vi(ya.pointers,ir):0,De.maxPointers=mt.prevInput?De.pointers.length>mt.prevInput.maxPointers?De.pointers.length:mt.prevInput.maxPointers:De.pointers.length,xr(mt,De);var Zo=ve.element;nn(De.srcEvent.target,Zo)&&(Zo=De.srcEvent.target),De.target=Zo}function Sr(ve,De){var mt=De.center,ir=ve.offsetDelta||{},yn=ve.prevDelta||{},Qn=ve.prevInput||{};(De.eventType===Ia||Qn.eventType===Ji)&&(yn=ve.prevDelta={x:Qn.deltaX||0,y:Qn.deltaY||0},ir=ve.offsetDelta={x:mt.x,y:mt.y}),De.deltaX=yn.x+(mt.x-ir.x),De.deltaY=yn.y+(mt.y-ir.y)}function xr(ve,De){var mt=ve.lastInterval||De,ir=De.timeStamp-mt.timeStamp,yn,Qn,ya,qo;if(De.eventType!=di&&(ir>Di||mt.velocity===K)){var Fa=De.deltaX-mt.deltaX,Fo=De.deltaY-mt.deltaY,Zo=mi(ir,Fa,Fo);Qn=Zo.x,ya=Zo.y,yn=tr(Zo.x)>tr(Zo.y)?Zo.x:Zo.y,qo=ii(Fa,Fo),ve.lastInterval=De}else yn=mt.velocity,Qn=mt.velocityX,ya=mt.velocityY,qo=mt.direction;De.velocity=yn,De.velocityX=Qn,De.velocityY=ya,De.direction=qo}function Lr(ve){for(var De=[],mt=0;mt<ve.pointers.length;)De[mt]={clientX:Lt(ve.pointers[mt].clientX),clientY:Lt(ve.pointers[mt].clientY)},mt++;return{timeStamp:Yt(),pointers:De,center:gn(De),deltaX:ve.deltaX,deltaY:ve.deltaY}}function gn(ve){var De=ve.length;if(De===1)return{x:Lt(ve[0].clientX),y:Lt(ve[0].clientY)};for(var mt=0,ir=0,yn=0;yn<De;)mt+=ve[yn].clientX,ir+=ve[yn].clientY,yn++;return{x:Lt(mt/De),y:Lt(ir/De)}}function mi(ve,De,mt){return{x:De/ve||0,y:mt/ve||0}}function ii(ve,De){return ve===De?_i:tr(ve)>=tr(De)?ve<0?Uo:Eo:De<0?to:Pt}function Sn(ve,De,mt){mt||(mt=V);var ir=De[mt[0]]-ve[mt[0]],yn=De[mt[1]]-ve[mt[1]];return Math.sqrt(ir*ir+yn*yn)}function Bi(ve,De,mt){mt||(mt=V);var ir=De[mt[0]]-ve[mt[0]],yn=De[mt[1]]-ve[mt[1]];return Math.atan2(yn,ir)*180/Math.PI}function Vi(ve,De){return Bi(De[1],De[0],at)+Bi(ve[1],ve[0],at)}function Ga(ve,De){return Sn(De[0],De[1],at)/Sn(ve[0],ve[1],at)}var oa={mousedown:Ia,mousemove:ui,mouseup:Ji},ro="mousedown",Si="mousemove mouseup";function ha(){this.evEl=ro,this.evWin=Si,this.pressed=!1,sr.apply(this,arguments)}_r(ha,sr,{handler:function(De){var mt=oa[De.type];mt&Ia&&De.button===0&&(this.pressed=!0),mt&ui&&De.which!==1&&(mt=Ji),!!this.pressed&&(mt&Ji&&(this.pressed=!1),this.callback(this.manager,mt,{pointers:[De],changedPointers:[De],pointerType:Sa,srcEvent:De}))}});var Q={pointerdown:Ia,pointermove:ui,pointerup:Ji,pointercancel:di,pointerout:di},ie={2:yi,3:ln,4:Sa,5:fa},me="pointerdown",Ie="pointermove pointerup pointercancel";!ut&&de.MSPointerEvent&&!de.PointerEvent&&(me="MSPointerDown",Ie="MSPointerMove MSPointerUp MSPointerCancel");function qe(){this.evEl=me,this.evWin=Ie,sr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_r(qe,sr,{handler:function(De){var mt=this.store,ir=!1,yn=De.type.toLowerCase().replace("ms",""),Qn=Q[yn],ya=ie[De.pointerType]||De.pointerType,qo=ya==yi,Fa=Z(mt,De.pointerId,"pointerId");Qn&Ia&&(De.button===0||qo)?Fa<0&&(mt.push(De),Fa=mt.length-1):Qn&(Ji|di)&&(ir=!0),!(Fa<0)&&(mt[Fa]=De,this.callback(this.manager,Qn,{pointers:mt,changedPointers:[De],pointerType:ya,srcEvent:De}),ir&&mt.splice(Fa,1))}});var ot={touchstart:Ia,touchmove:ui,touchend:Ji,touchcancel:di},xt="touchstart",Te="touchstart touchmove touchend touchcancel";function rt(){this.evTarget=xt,this.evWin=Te,this.started=!1,sr.apply(this,arguments)}_r(rt,sr,{handler:function(De){var mt=ot[De.type];if(mt===Ia&&(this.started=!0),!!this.started){var ir=Ht.call(this,De,mt);mt&(Ji|di)&&ir[0].length-ir[1].length==0&&(this.started=!1),this.callback(this.manager,mt,{pointers:ir[0],changedPointers:ir[1],pointerType:yi,srcEvent:De})}}});function Ht(ve,De){var mt=_e(ve.touches),ir=_e(ve.changedTouches);return De&(Ji|di)&&(mt=ze(mt.concat(ir),"identifier",!0)),[mt,ir]}var Zr={touchstart:Ia,touchmove:ui,touchend:Ji,touchcancel:di},ar="touchstart touchmove touchend touchcancel";function pr(){this.evTarget=ar,this.targetIds={},sr.apply(this,arguments)}_r(pr,sr,{handler:function(De){var mt=Zr[De.type],ir=Hr.call(this,De,mt);!ir||this.callback(this.manager,mt,{pointers:ir[0],changedPointers:ir[1],pointerType:yi,srcEvent:De})}});function Hr(ve,De){var mt=_e(ve.touches),ir=this.targetIds;if(De&(Ia|ui)&&mt.length===1)return ir[mt[0].identifier]=!0,[mt,mt];var yn,Qn,ya=_e(ve.changedTouches),qo=[],Fa=this.target;if(Qn=mt.filter(function(Fo){return nn(Fo.target,Fa)}),De===Ia)for(yn=0;yn<Qn.length;)ir[Qn[yn].identifier]=!0,yn++;for(yn=0;yn<ya.length;)ir[ya[yn].identifier]&&qo.push(ya[yn]),De&(Ji|di)&&delete ir[ya[yn].identifier],yn++;if(!!qo.length)return[ze(Qn.concat(qo),"identifier",!0),qo]}var li=2500,wn=25;function er(){sr.apply(this,arguments);var ve=Ot(this.handler,this);this.touch=new pr(this.manager,ve),this.mouse=new ha(this.manager,ve),this.primaryTouch=null,this.lastTouches=[]}_r(er,sr,{handler:function(De,mt,ir){var yn=ir.pointerType==yi,Qn=ir.pointerType==Sa;if(!(Qn&&ir.sourceCapabilities&&ir.sourceCapabilities.firesTouchEvents)){if(yn)Hn.call(this,mt,ir);else if(Qn&&Mn.call(this,ir))return;this.callback(De,mt,ir)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Hn(ve,De){ve&Ia?(this.primaryTouch=De.changedPointers[0].identifier,Tn.call(this,De)):ve&(Ji|di)&&Tn.call(this,De)}function Tn(ve){var De=ve.changedPointers[0];if(De.identifier===this.primaryTouch){var mt={x:De.clientX,y:De.clientY};this.lastTouches.push(mt);var ir=this.lastTouches,yn=function(){var Qn=ir.indexOf(mt);Qn>-1&&ir.splice(Qn,1)};setTimeout(yn,li)}}function Mn(ve){for(var De=ve.srcEvent.clientX,mt=ve.srcEvent.clientY,ir=0;ir<this.lastTouches.length;ir++){var yn=this.lastTouches[ir],Qn=Math.abs(De-yn.x),ya=Math.abs(mt-yn.y);if(Qn<=wn&&ya<=wn)return!0}return!1}var sa=ut?K:wt(Xe.style,"touchAction"),Pr=sa!==K,$i="compute",La="auto",ra="manipulation",ma="none",Ft="pan-x",Tt="pan-y",ea=ji();function lo(ve,De){this.manager=ve,this.set(De)}lo.prototype={set:function(ve){ve==$i&&(ve=this.compute()),Pr&&this.manager.element.style&&ea[ve]&&(this.manager.element.style[sa]=ve),this.actions=ve.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ve=[];return cr(this.manager.recognizers,function(De){_t(De.options.enable,[De])&&(ve=ve.concat(De.getTouchAction()))}),Na(ve.join(" "))},preventDefaults:function(ve){var De=ve.srcEvent,mt=ve.offsetDirection;if(this.manager.session.prevented){De.preventDefault();return}var ir=this.actions,yn=ue(ir,ma)&&!ea[ma],Qn=ue(ir,Tt)&&!ea[Tt],ya=ue(ir,Ft)&&!ea[Ft];if(yn){var qo=ve.pointers.length===1,Fa=ve.distance<2,Fo=ve.deltaTime<250;if(qo&&Fa&&Fo)return}if(!(ya&&Qn)&&(yn||Qn&&mt&ge||ya&&mt&oe))return this.preventSrc(De)},preventSrc:function(ve){this.manager.session.prevented=!0,ve.preventDefault()}};function Na(ve){if(ue(ve,ma))return ma;var De=ue(ve,Ft),mt=ue(ve,Tt);return De&&mt?ma:De||mt?De?Ft:Tt:ue(ve,ra)?ra:La}function ji(){if(!Pr)return!1;var ve={};if(ut)return ve;var De=de.CSS&&de.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(mt){ve[mt]=De?de.CSS.supports("touch-action",mt):!0}),ve}var Aa=1,Co=2,an=4,Yr=8,bt=Yr,Ls=16,Gt=32;function qi(ve){this.options=Zt({},this.defaults,ve||{}),this.id=fr(),this.manager=null,this.options.enable=Kt(this.options.enable,!0),this.state=Aa,this.simultaneous={},this.requireFail=[]}qi.prototype={defaults:{},set:function(ve){return Zt(this.options,ve),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ve){if(Er(ve,"recognizeWith",this))return this;var De=this.simultaneous;return ve=mo(ve,this),De[ve.id]||(De[ve.id]=ve,ve.recognizeWith(this)),this},dropRecognizeWith:function(ve){return Er(ve,"dropRecognizeWith",this)?this:(ve=mo(ve,this),delete this.simultaneous[ve.id],this)},requireFailure:function(ve){if(Er(ve,"requireFailure",this))return this;var De=this.requireFail;return ve=mo(ve,this),Z(De,ve)===-1&&(De.push(ve),ve.requireFailure(this)),this},dropRequireFailure:function(ve){if(Er(ve,"dropRequireFailure",this))return this;ve=mo(ve,this);var De=Z(this.requireFail,ve);return De>-1&&this.requireFail.splice(De,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ve){return!!this.simultaneous[ve.id]},emit:function(ve){var De=this,mt=this.state;function ir(yn){De.manager.emit(yn,ve)}mt<Yr&&ir(De.options.event+Kl(mt)),ir(De.options.event),ve.additionalEvent&&ir(ve.additionalEvent),mt>=Yr&&ir(De.options.event+Kl(mt))},tryEmit:function(ve){if(this.canEmit())return this.emit(ve);this.state=Gt},canEmit:function(){for(var ve=0;ve<this.requireFail.length;){if(!(this.requireFail[ve].state&(Gt|Aa)))return!1;ve++}return!0},recognize:function(ve){var De=Zt({},ve);if(!_t(this.options.enable,[this,De])){this.reset(),this.state=Gt;return}this.state&(bt|Ls|Gt)&&(this.state=Aa),this.state=this.process(De),this.state&(Co|an|Yr|Ls)&&this.tryEmit(De)},process:function(ve){},getTouchAction:function(){},reset:function(){}};function Kl(ve){return ve&Ls?"cancel":ve&Yr?"end":ve&an?"move":ve&Co?"start":""}function Oa(ve){return ve==Pt?"down":ve==to?"up":ve==Uo?"left":ve==Eo?"right":""}function mo(ve,De){var mt=De.manager;return mt?mt.get(ve):ve}function Io(){qi.apply(this,arguments)}_r(Io,qi,{defaults:{pointers:1},attrTest:function(ve){var De=this.options.pointers;return De===0||ve.pointers.length===De},process:function(ve){var De=this.state,mt=ve.eventType,ir=De&(Co|an),yn=this.attrTest(ve);return ir&&(mt&di||!yn)?De|Ls:ir||yn?mt&Ji?De|Yr:De&Co?De|an:Co:Gt}});function xa(){Io.apply(this,arguments),this.pX=null,this.pY=null}_r(xa,Io,{defaults:{event:"pan",threshold:10,pointers:1,direction:we},getTouchAction:function(){var ve=this.options.direction,De=[];return ve&ge&&De.push(Tt),ve&oe&&De.push(Ft),De},directionTest:function(ve){var De=this.options,mt=!0,ir=ve.distance,yn=ve.direction,Qn=ve.deltaX,ya=ve.deltaY;return yn&De.direction||(De.direction&ge?(yn=Qn===0?_i:Qn<0?Uo:Eo,mt=Qn!=this.pX,ir=Math.abs(ve.deltaX)):(yn=ya===0?_i:ya<0?to:Pt,mt=ya!=this.pY,ir=Math.abs(ve.deltaY))),ve.direction=yn,mt&&ir>De.threshold&&yn&De.direction},attrTest:function(ve){return Io.prototype.attrTest.call(this,ve)&&(this.state&Co||!(this.state&Co)&&this.directionTest(ve))},emit:function(ve){this.pX=ve.deltaX,this.pY=ve.deltaY;var De=Oa(ve.direction);De&&(ve.additionalEvent=this.options.event+De),this._super.emit.call(this,ve)}});function Os(){Io.apply(this,arguments)}_r(Os,Io,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ma]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.scale-1)>this.options.threshold||this.state&Co)},emit:function(ve){if(ve.scale!==1){var De=ve.scale<1?"in":"out";ve.additionalEvent=this.options.event+De}this._super.emit.call(this,ve)}});function Fs(){qi.apply(this,arguments),this._timer=null,this._input=null}_r(Fs,qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[La]},process:function(ve){var De=this.options,mt=ve.pointers.length===De.pointers,ir=ve.distance<De.threshold,yn=ve.deltaTime>De.time;if(this._input=ve,!ir||!mt||ve.eventType&(Ji|di)&&!yn)this.reset();else if(ve.eventType&Ia)this.reset(),this._timer=Xt(function(){this.state=bt,this.tryEmit()},De.time,this);else if(ve.eventType&Ji)return bt;return Gt},reset:function(){clearTimeout(this._timer)},emit:function(ve){this.state===bt&&(ve&&ve.eventType&Ji?this.manager.emit(this.options.event+"up",ve):(this._input.timeStamp=Yt(),this.manager.emit(this.options.event,this._input)))}});function Ql(){Io.apply(this,arguments)}_r(Ql,Io,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ma]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.rotation)>this.options.threshold||this.state&Co)}});function So(){Io.apply(this,arguments)}_r(So,Io,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ge|oe,pointers:1},getTouchAction:function(){return xa.prototype.getTouchAction.call(this)},attrTest:function(ve){var De=this.options.direction,mt;return De&(ge|oe)?mt=ve.overallVelocity:De&ge?mt=ve.overallVelocityX:De&oe&&(mt=ve.overallVelocityY),this._super.attrTest.call(this,ve)&&De&ve.offsetDirection&&ve.distance>this.options.threshold&&ve.maxPointers==this.options.pointers&&tr(mt)>this.options.velocity&&ve.eventType&Ji},emit:function(ve){var De=Oa(ve.offsetDirection);De&&this.manager.emit(this.options.event+De,ve),this.manager.emit(this.options.event,ve)}});function As(){qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_r(As,qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ra]},process:function(ve){var De=this.options,mt=ve.pointers.length===De.pointers,ir=ve.distance<De.threshold,yn=ve.deltaTime<De.time;if(this.reset(),ve.eventType&Ia&&this.count===0)return this.failTimeout();if(ir&&yn&&mt){if(ve.eventType!=Ji)return this.failTimeout();var Qn=this.pTime?ve.timeStamp-this.pTime<De.interval:!0,ya=!this.pCenter||Sn(this.pCenter,ve.center)<De.posThreshold;this.pTime=ve.timeStamp,this.pCenter=ve.center,!ya||!Qn?this.count=1:this.count+=1,this._input=ve;var qo=this.count%De.taps;if(qo===0)return this.hasRequireFailures()?(this._timer=Xt(function(){this.state=bt,this.tryEmit()},De.interval,this),Co):bt}return Gt},failTimeout:function(){return this._timer=Xt(function(){this.state=Gt},this.options.interval,this),Gt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==bt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ka(ve,De){return De=De||{},De.recognizers=Kt(De.recognizers,Ka.defaults.preset),new ko(ve,De)}Ka.VERSION="2.0.7",Ka.defaults={domEvents:!1,touchAction:$i,enable:!0,inputTarget:null,inputClass:null,preset:[[Ql,{enable:!1}],[Os,{enable:!1},["rotate"]],[So,{direction:ge}],[xa,{direction:ge},["swipe"]],[As],[As,{event:"doubletap",taps:2},["tap"]],[Fs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Oo=1,ws=2;function ko(ve,De){this.options=Zt({},Ka.defaults,De||{}),this.options.inputTarget=this.options.inputTarget||ve,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ve,this.input=$r(this),this.touchAction=new lo(this,this.options.touchAction),Yu(this,!0),cr(this.options.recognizers,function(mt){var ir=this.add(new mt[0](mt[1]));mt[2]&&ir.recognizeWith(mt[2]),mt[3]&&ir.requireFailure(mt[3])},this)}ko.prototype={set:function(ve){return Zt(this.options,ve),ve.touchAction&&this.touchAction.update(),ve.inputTarget&&(this.input.destroy(),this.input.target=ve.inputTarget,this.input.init()),this},stop:function(ve){this.session.stopped=ve?ws:Oo},recognize:function(ve){var De=this.session;if(!De.stopped){this.touchAction.preventDefaults(ve);var mt,ir=this.recognizers,yn=De.curRecognizer;(!yn||yn&&yn.state&bt)&&(yn=De.curRecognizer=null);for(var Qn=0;Qn<ir.length;)mt=ir[Qn],De.stopped!==ws&&(!yn||mt==yn||mt.canRecognizeWith(yn))?mt.recognize(ve):mt.reset(),!yn&&mt.state&(Co|an|Yr)&&(yn=De.curRecognizer=mt),Qn++}},get:function(ve){if(ve instanceof qi)return ve;for(var De=this.recognizers,mt=0;mt<De.length;mt++)if(De[mt].options.event==ve)return De[mt];return null},add:function(ve){if(Er(ve,"add",this))return this;var De=this.get(ve.options.event);return De&&this.remove(De),this.recognizers.push(ve),ve.manager=this,this.touchAction.update(),ve},remove:function(ve){if(Er(ve,"remove",this))return this;if(ve=this.get(ve),ve){var De=this.recognizers,mt=Z(De,ve);mt!==-1&&(De.splice(mt,1),this.touchAction.update())}return this},on:function(ve,De){if(ve!==K&&De!==K){var mt=this.handlers;return cr(tt(ve),function(ir){mt[ir]=mt[ir]||[],mt[ir].push(De)}),this}},off:function(ve,De){if(ve!==K){var mt=this.handlers;return cr(tt(ve),function(ir){De?mt[ir]&&mt[ir].splice(Z(mt[ir],De),1):delete mt[ir]}),this}},emit:function(ve,De){this.options.domEvents&&ul(ve,De);var mt=this.handlers[ve]&&this.handlers[ve].slice();if(!(!mt||!mt.length)){De.type=ve,De.preventDefault=function(){De.srcEvent.preventDefault()};for(var ir=0;ir<mt.length;)mt[ir](De),ir++}},destroy:function(){this.element&&Yu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Yu(ve,De){var mt=ve.element;if(!!mt.style){var ir;cr(ve.options.cssProps,function(yn,Qn){ir=wt(mt.style,Qn),De?(ve.oldCssProps[ir]=mt.style[ir],mt.style[ir]=yn):mt.style[ir]=ve.oldCssProps[ir]||""}),De||(ve.oldCssProps={})}}function ul(ve,De){if(!ut){var mt=y.createEvent("Event");mt.initEvent(ve,!0,!0),mt.gesture=De,De.target.dispatchEvent(mt)}}if(!ut){Zt(Ka,{INPUT_START:Ia,INPUT_MOVE:ui,INPUT_END:Ji,INPUT_CANCEL:di,STATE_POSSIBLE:Aa,STATE_BEGAN:Co,STATE_CHANGED:an,STATE_ENDED:Yr,STATE_RECOGNIZED:bt,STATE_CANCELLED:Ls,STATE_FAILED:Gt,DIRECTION_NONE:_i,DIRECTION_LEFT:Uo,DIRECTION_RIGHT:Eo,DIRECTION_UP:to,DIRECTION_DOWN:Pt,DIRECTION_HORIZONTAL:ge,DIRECTION_VERTICAL:oe,DIRECTION_ALL:we,Manager:ko,Input:sr,TouchAction:lo,TouchInput:pr,MouseInput:ha,PointerEventInput:qe,TouchMouseInput:er,SingleTouchInput:rt,Recognizer:qi,AttrRecognizer:Io,Tap:As,Pan:xa,Swipe:So,Pinch:Os,Rotate:Ql,Press:Fs,on:Ue,off:Cr,each:cr,merge:re,extend:Rr,assign:Zt,inherit:_r,bindFn:Ot,prefixed:wt});var rs=typeof window!="undefined"?window:typeof self!="undefined"?self:{};rs.Hammer=Ka,We=function(){return Ka}.call(Se,fe,Se,pi),We!==K&&(pi.exports=We)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(pi,Se,fe){(function(We,de){pi.exports=de(fe(18857))})(this,function(We){"use strict";var de=function(H){return H instanceof Uint8Array||H instanceof Uint16Array||H instanceof Uint32Array||H instanceof Int8Array||H instanceof Int16Array||H instanceof Int32Array||H instanceof Float32Array||H instanceof Float64Array||H instanceof Uint8ClampedArray},y=function(H,Pe){for(var it=Object.keys(Pe),or=0;or<it.length;++or)H[it[or]]=Pe[it[or]];return H},Be=`
`;function K(H){return typeof atob!="undefined"?atob(H):"base64:"+H}function ke(H){var Pe=new Error("(regl) "+H);throw console.error(Pe),Pe}function he(H,Pe){H||ke(Pe)}function ut(H){return H?": "+H:""}function Ae(H,Pe,it){H in Pe||ke("unknown parameter ("+H+")"+ut(it)+". possible values: "+Object.keys(Pe).join())}function Xe(H,Pe){de(H)||ke("invalid parameter type"+ut(Pe)+". must be a typed array")}function Ct(H,Pe){switch(Pe){case"number":return typeof H=="number";case"object":return typeof H=="object";case"string":return typeof H=="string";case"boolean":return typeof H=="boolean";case"function":return typeof H=="function";case"undefined":return typeof H=="undefined";case"symbol":return typeof H=="symbol"}}function Lt(H,Pe,it){Ct(H,Pe)||ke("invalid parameter type"+ut(it)+". expected "+Pe+", got "+typeof H)}function tr(H,Pe){H>=0&&(H|0)===H||ke("invalid parameter type, ("+H+")"+ut(Pe)+". must be a nonnegative integer")}function Yt(H,Pe,it){Pe.indexOf(H)<0&&ke("invalid value"+ut(it)+". must be one of: "+Pe)}var Xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Er(H){Object.keys(H).forEach(function(Pe){Xt.indexOf(Pe)<0&&ke('invalid regl constructor argument "'+Pe+'". must be one of '+Xt)})}function cr(H,Pe){for(H=H+"";H.length<Pe;)H=" "+H;return H}function Rt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Zt(H,Pe){this.number=H,this.line=Pe,this.errors=[]}function Rr(H,Pe,it){this.file=H,this.line=Pe,this.message=it}function re(){var H=new Error,Pe=(H.stack||H).toString(),it=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Pe);if(it)return it[1];var or=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Pe);return or?or[1]:"unknown"}function _r(){var H=new Error,Pe=(H.stack||H).toString(),it=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Pe);if(it)return it[1];var or=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Pe);return or?or[1]:"unknown"}function Ot(H,Pe){var it=H.split(`
`),or=1,Br=0,ur={unknown:new Rt,0:new Rt};ur.unknown.name=ur[0].name=Pe||re(),ur.unknown.lines.push(new Zt(0,""));for(var kr=0;kr<it.length;++kr){var Gr=it[kr],Kr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Gr);if(Kr)switch(Kr[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec(Kr[2]);en&&(or=en[1]|0,en[2]&&(Br=en[2]|0,Br in ur||(ur[Br]=new Rt)));break;case"define":var sn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Kr[2]);sn&&(ur[Br].name=sn[1]?K(sn[2]):sn[2]);break}ur[Br].lines.push(new Zt(or++,Gr))}return Object.keys(ur).forEach(function(dn){var Fn=ur[dn];Fn.lines.forEach(function(tn){Fn.index[tn.number]=tn})}),ur}function _t(H){var Pe=[];return H.split(`
`).forEach(function(it){if(!(it.length<5)){var or=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(it);or?Pe.push(new Rr(or[1]|0,or[2]|0,or[3].trim())):it.length>0&&Pe.push(new Rr("unknown",0,it))}}),Pe}function Kt(H,Pe){Pe.forEach(function(it){var or=H[it.file];if(or){var Br=or.index[it.line];if(Br){Br.errors.push(it),or.hasErrors=!0;return}}H.unknown.hasErrors=!0,H.unknown.lines[0].errors.push(it)})}function Ue(H,Pe,it,or,Br){if(!H.getShaderParameter(Pe,H.COMPILE_STATUS)){var ur=H.getShaderInfoLog(Pe),kr=or===H.FRAGMENT_SHADER?"fragment":"vertex";ze(it,"string",kr+" shader source must be a string",Br);var Gr=Ot(it,Br),Kr=_t(ur);Kt(Gr,Kr),Object.keys(Gr).forEach(function(en){var sn=Gr[en];if(!sn.hasErrors)return;var dn=[""],Fn=[""];function tn(Ur,St){dn.push(Ur),Fn.push(St||"")}tn("file number "+en+": "+sn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),sn.lines.forEach(function(Ur){if(Ur.errors.length>0){tn(cr(Ur.number,4)+"|  ","background-color:yellow; font-weight:bold"),tn(Ur.line+Be,"color:red; background-color:yellow; font-weight:bold");var St=0;Ur.errors.forEach(function(mr){var rn=mr.message,En=/^\s*'(.*)'\s*:\s*(.*)$/.exec(rn);if(En){var Vr=En[1];switch(rn=En[2],Vr){case"assign":Vr="=";break}St=Math.max(Ur.line.indexOf(Vr,St),0)}else St=0;tn(cr("| ",6)),tn(cr("^^^",St+3)+Be,"font-weight:bold"),tn(cr("| ",6)),tn(rn+Be,"font-weight:bold")}),tn(cr("| ",6)+Be)}else tn(cr(Ur.number,4)+"|  "),tn(Ur.line+Be,"color:red")}),typeof document!="undefined"&&!window.chrome?(Fn[0]=dn.join("%c"),console.log.apply(console,Fn)):console.log(dn.join(""))}),he.raise("Error compiling "+kr+" shader, "+Gr[0].name)}}function Cr(H,Pe,it,or,Br){if(!H.getProgramParameter(Pe,H.LINK_STATUS)){var ur=H.getProgramInfoLog(Pe),kr=Ot(it,Br),Gr=Ot(or,Br),Kr='Error linking program with vertex shader, "'+Gr[0].name+'", and fragment shader "'+kr[0].name+'"';typeof document!="undefined"?console.log("%c"+Kr+Be+"%c"+ur,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Kr+Be+ur),he.raise(Kr)}}function nn(H){H._commandRef=re()}function ue(H,Pe,it,or){nn(H);function Br(Kr){return Kr?or.id(Kr):0}H._fragId=Br(H.static.frag),H._vertId=Br(H.static.vert);function ur(Kr,en){Object.keys(en).forEach(function(sn){Kr[or.id(sn)]=!0})}var kr=H._uniformSet={};ur(kr,Pe.static),ur(kr,Pe.dynamic);var Gr=H._attributeSet={};ur(Gr,it.static),ur(Gr,it.dynamic),H._hasCount="count"in H.static||"count"in H.dynamic||"elements"in H.static||"elements"in H.dynamic}function tt(H,Pe){var it=_r();ke(H+" in command "+(Pe||re())+(it==="unknown"?"":" called from "+it))}function Z(H,Pe,it){H||tt(Pe,it||re())}function _e(H,Pe,it,or){H in Pe||tt("unknown parameter ("+H+")"+ut(it)+". possible values: "+Object.keys(Pe).join(),or||re())}function ze(H,Pe,it,or){Ct(H,Pe)||tt("invalid parameter type"+ut(it)+". expected "+Pe+", got "+typeof H,or||re())}function wt(H){H()}function Vt(H,Pe,it){H.texture?Yt(H.texture._texture.internalformat,Pe,"unsupported texture format for attachment"):Yt(H.renderbuffer._renderbuffer.format,it,"unsupported renderbuffer format for attachment")}var fr=33071,Mt=9728,Fr=9984,Xn=9985,Jr=9986,Ri=9987,yi=5120,ln=5121,Sa=5122,fa=5123,Di=5124,Ia=5125,ui=5126,Ji=32819,di=32820,_i=33635,Uo=34042,Eo=36193,to={};to[yi]=to[ln]=1,to[Sa]=to[fa]=to[Eo]=to[_i]=to[Ji]=to[di]=2,to[Di]=to[Ia]=to[ui]=to[Uo]=4;function Pt(H,Pe){return H===di||H===Ji||H===_i?2:H===Uo?4:to[H]*Pe}function ge(H){return!(H&H-1)&&!!H}function oe(H,Pe,it){var or,Br=Pe.width,ur=Pe.height,kr=Pe.channels;he(Br>0&&Br<=it.maxTextureSize&&ur>0&&ur<=it.maxTextureSize,"invalid texture shape"),(H.wrapS!==fr||H.wrapT!==fr)&&he(ge(Br)&&ge(ur),"incompatible wrap mode for texture, both width and height must be power of 2"),Pe.mipmask===1?Br!==1&&ur!==1&&he(H.minFilter!==Fr&&H.minFilter!==Jr&&H.minFilter!==Xn&&H.minFilter!==Ri,"min filter requires mipmap"):(he(ge(Br)&&ge(ur),"texture must be a square power of 2 to support mipmapping"),he(Pe.mipmask===(Br<<1)-1,"missing or incomplete mipmap data")),Pe.type===ui&&(it.extensions.indexOf("oes_texture_float_linear")<0&&he(H.minFilter===Mt&&H.magFilter===Mt,"filter not supported, must enable oes_texture_float_linear"),he(!H.genMipmaps,"mipmap generation not supported with float textures"));var Gr=Pe.images;for(or=0;or<16;++or)if(Gr[or]){var Kr=Br>>or,en=ur>>or;he(Pe.mipmask&1<<or,"missing mipmap data");var sn=Gr[or];if(he(sn.width===Kr&&sn.height===en,"invalid shape for mip images"),he(sn.format===Pe.format&&sn.internalformat===Pe.internalformat&&sn.type===Pe.type,"incompatible type for mip image"),!sn.compressed)if(sn.data){var dn=Math.ceil(Pt(sn.type,kr)*Kr/sn.unpackAlignment)*sn.unpackAlignment;he(sn.data.byteLength===dn*en,"invalid data for image, buffer size is inconsistent with image format")}else sn.element||sn.copy}else H.genMipmaps||he((Pe.mipmask&1<<or)==0,"extra mipmap data");Pe.compressed&&he(!H.genMipmaps,"mipmap generation for compressed images not supported")}function we(H,Pe,it,or){var Br=H.width,ur=H.height,kr=H.channels;he(Br>0&&Br<=or.maxTextureSize&&ur>0&&ur<=or.maxTextureSize,"invalid texture shape"),he(Br===ur,"cube map must be square"),he(Pe.wrapS===fr&&Pe.wrapT===fr,"wrap mode not supported by cube map");for(var Gr=0;Gr<it.length;++Gr){var Kr=it[Gr];he(Kr.width===Br&&Kr.height===ur,"inconsistent cube map face shape"),Pe.genMipmaps&&(he(!Kr.compressed,"can not generate mipmap for compressed textures"),he(Kr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=Kr.images,sn=0;sn<16;++sn){var dn=en[sn];if(dn){var Fn=Br>>sn,tn=ur>>sn;he(Kr.mipmask&1<<sn,"missing mipmap data"),he(dn.width===Fn&&dn.height===tn,"invalid shape for mip images"),he(dn.format===H.format&&dn.internalformat===H.internalformat&&dn.type===H.type,"incompatible type for mip image"),dn.compressed||(dn.data?he(dn.data.byteLength===Fn*tn*Math.max(Pt(dn.type,kr),dn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):dn.element||dn.copy)}}}}var V=y(he,{optional:wt,raise:ke,commandRaise:tt,command:Z,parameter:Ae,commandParameter:_e,constructor:Er,type:Lt,commandType:ze,isTypedArray:Xe,nni:tr,oneOf:Yt,shaderError:Ue,linkError:Cr,callSite:_r,saveCommandRef:nn,saveDrawInfo:ue,framebufferFormat:Vt,guessCommand:re,texture2D:oe,textureCube:we}),at=0,sr=0,$r=5,Ke=6;function Nt(H,Pe){this.id=at++,this.type=H,this.data=Pe}function Sr(H){return H.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function xr(H){if(H.length===0)return[];var Pe=H.charAt(0),it=H.charAt(H.length-1);if(H.length>1&&Pe===it&&(Pe==='"'||Pe==="'"))return['"'+Sr(H.substr(1,H.length-2))+'"'];var or=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(H);if(or)return xr(H.substr(0,or.index)).concat(xr(or[1])).concat(xr(H.substr(or.index+or[0].length)));var Br=H.split(".");if(Br.length===1)return['"'+Sr(H)+'"'];for(var ur=[],kr=0;kr<Br.length;++kr)ur=ur.concat(xr(Br[kr]));return ur}function Lr(H){return"["+xr(H).join("][")+"]"}function gn(H,Pe){return new Nt(H,Lr(Pe+""))}function mi(H){return typeof H=="function"&&!H._reglType||H instanceof Nt}function ii(H,Pe){if(typeof H=="function")return new Nt(sr,H);if(typeof H=="number"||typeof H=="boolean")return new Nt($r,H);if(Array.isArray(H))return new Nt(Ke,H.map(function(it,or){return ii(it,Pe+"["+or+"]")}));if(H instanceof Nt)return H;V(!1,"invalid option type in uniform "+Pe)}var Sn={DynamicVariable:Nt,define:gn,isDynamic:mi,unbox:ii,accessor:Lr},Bi={next:typeof requestAnimationFrame=="function"?function(H){return requestAnimationFrame(H)}:function(H){return setTimeout(H,16)},cancel:typeof cancelAnimationFrame=="function"?function(H){return cancelAnimationFrame(H)}:clearTimeout},Vi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ga=Vi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function oa(){var H={"":0},Pe=[""];return{id:function(it){var or=H[it];return or||(or=H[it]=Pe.length,Pe.push(it),or)},str:function(it){return Pe[it]}}}function ro(H,Pe,it){var or=document.createElement("canvas");y(or.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),H.appendChild(or),H===document.body&&(or.style.position="absolute",y(H.style,{margin:0,padding:0}));function Br(){var Gr=window.innerWidth,Kr=window.innerHeight;if(H!==document.body){var en=or.getBoundingClientRect();Gr=en.right-en.left,Kr=en.bottom-en.top}or.width=it*Gr,or.height=it*Kr}var ur;H!==document.body&&typeof ResizeObserver=="function"?(ur=new ResizeObserver(function(){setTimeout(Br)}),ur.observe(H)):window.addEventListener("resize",Br,!1);function kr(){ur?ur.disconnect():window.removeEventListener("resize",Br),H.removeChild(or)}return Br(),{canvas:or,onDestroy:kr}}function Si(H,Pe){function it(or){try{return H.getContext(or,Pe)}catch(Br){return null}}return it("webgl")||it("experimental-webgl")||it("webgl-experimental")}function ha(H){return typeof H.nodeName=="string"&&typeof H.appendChild=="function"&&typeof H.getBoundingClientRect=="function"}function Q(H){return typeof H.drawArrays=="function"||typeof H.drawElements=="function"}function ie(H){return typeof H=="string"?H.split():(V(Array.isArray(H),"invalid extension array"),H)}function me(H){return typeof H=="string"?(V(typeof document!="undefined","not supported outside of DOM"),document.querySelector(H)):H}function Ie(H){var Pe=H||{},it,or,Br,ur,kr={},Gr=[],Kr=[],en=typeof window=="undefined"?1:window.devicePixelRatio,sn=!1,dn=function(Ur){Ur&&V.raise(Ur)},Fn=function(){};if(typeof Pe=="string"?(V(typeof document!="undefined","selector queries only supported in DOM environments"),it=document.querySelector(Pe),V(it,"invalid query string for element")):typeof Pe=="object"?ha(Pe)?it=Pe:Q(Pe)?(ur=Pe,Br=ur.canvas):(V.constructor(Pe),"gl"in Pe?ur=Pe.gl:"canvas"in Pe?Br=me(Pe.canvas):"container"in Pe&&(or=me(Pe.container)),"attributes"in Pe&&(kr=Pe.attributes,V.type(kr,"object","invalid context attributes")),"extensions"in Pe&&(Gr=ie(Pe.extensions)),"optionalExtensions"in Pe&&(Kr=ie(Pe.optionalExtensions)),"onDone"in Pe&&(V.type(Pe.onDone,"function","invalid or missing onDone callback"),dn=Pe.onDone),"profile"in Pe&&(sn=!!Pe.profile),"pixelRatio"in Pe&&(en=+Pe.pixelRatio,V(en>0,"invalid pixel ratio"))):V.raise("invalid arguments to regl"),it&&(it.nodeName.toLowerCase()==="canvas"?Br=it:or=it),!ur){if(!Br){V(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var tn=ro(or||document.body,dn,en);if(!tn)return null;Br=tn.canvas,Fn=tn.onDestroy}kr.premultipliedAlpha===void 0&&(kr.premultipliedAlpha=!0),ur=Si(Br,kr)}return ur?{gl:ur,canvas:Br,container:or,extensions:Gr,optionalExtensions:Kr,pixelRatio:en,profile:sn,onDone:dn,onDestroy:Fn}:(Fn(),dn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function qe(H,Pe){var it={};function or(Gr){V.type(Gr,"string","extension name must be string");var Kr=Gr.toLowerCase(),en;try{en=it[Kr]=Br(Gr)}catch(sn){}return!!en}function Br(Gr){return H.getExtension(Gr)?H.getExtension(Gr):H.getExtension(Gr.toLowerCase())?H.getExtension(Gr.toLowerCase()):null}for(var ur=0;ur<Pe.extensions.length;++ur){var kr=Pe.extensions[ur];if(!or(kr))return Pe.onDestroy(),Pe.onDone('"'+kr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Pe.optionalExtensions.forEach(or),{extensions:it,restore:function(){Object.keys(it).forEach(function(Gr){if(it[Gr]&&!or(Gr))throw new Error("(regl): error restoring extension "+Gr)})}}}function ot(H,Pe){for(var it=Array(H),or=0;or<H;++or)it[or]=Pe(or);return it}var xt=5120,Te=5121,rt=5122,Ht=5123,Zr=5124,ar=5125,pr=5126;function Hr(H){for(var Pe=16;Pe<=1<<28;Pe*=16)if(H<=Pe)return Pe;return 0}function li(H){var Pe,it;return Pe=(H>65535)<<4,H>>>=Pe,it=(H>255)<<3,H>>>=it,Pe|=it,it=(H>15)<<2,H>>>=it,Pe|=it,it=(H>3)<<1,H>>>=it,Pe|=it,Pe|H>>1}function wn(){var H=ot(8,function(){return[]});function Pe(ur){var kr=Hr(ur),Gr=H[li(kr)>>2];return Gr.length>0?Gr.pop():new ArrayBuffer(kr)}function it(ur){H[li(ur.byteLength)>>2].push(ur)}function or(ur,kr){var Gr=null;switch(ur){case xt:Gr=new Int8Array(Pe(kr),0,kr);break;case Te:Gr=new Uint8Array(Pe(kr),0,kr);break;case rt:Gr=new Int16Array(Pe(2*kr),0,kr);break;case Ht:Gr=new Uint16Array(Pe(2*kr),0,kr);break;case Zr:Gr=new Int32Array(Pe(4*kr),0,kr);break;case ar:Gr=new Uint32Array(Pe(4*kr),0,kr);break;case pr:Gr=new Float32Array(Pe(4*kr),0,kr);break;default:return null}return Gr.length!==kr?Gr.subarray(0,kr):Gr}function Br(ur){it(ur.buffer)}return{alloc:Pe,free:it,allocType:or,freeType:Br}}var er=wn();er.zero=wn();var Hn=3408,Tn=3410,Mn=3411,sa=3412,Pr=3413,$i=3414,La=3415,ra=33901,ma=33902,Ft=3379,Tt=3386,ea=34921,lo=36347,Na=36348,ji=35661,Aa=35660,Co=34930,an=36349,Yr=34076,bt=34024,Ls=7936,Gt=7937,qi=7938,Kl=35724,Oa=34047,mo=36063,Io=34852,xa=3553,Os=34067,Fs=34069,Ql=33984,So=6408,As=5126,Ka=5121,Oo=36160,ws=36053,ko=36064,Yu=16384,ul=function(H,Pe){var it=1;Pe.ext_texture_filter_anisotropic&&(it=H.getParameter(Oa));var or=1,Br=1;Pe.webgl_draw_buffers&&(or=H.getParameter(Io),Br=H.getParameter(mo));var ur=!!Pe.oes_texture_float;if(ur){var kr=H.createTexture();H.bindTexture(xa,kr),H.texImage2D(xa,0,So,1,1,0,So,As,null);var Gr=H.createFramebuffer();if(H.bindFramebuffer(Oo,Gr),H.framebufferTexture2D(Oo,ko,xa,kr,0),H.bindTexture(xa,null),H.checkFramebufferStatus(Oo)!==ws)ur=!1;else{H.viewport(0,0,1,1),H.clearColor(1,0,0,1),H.clear(Yu);var Kr=er.allocType(As,4);H.readPixels(0,0,1,1,So,As,Kr),H.getError()?ur=!1:(H.deleteFramebuffer(Gr),H.deleteTexture(kr),ur=Kr[0]===1),er.freeType(Kr)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),sn=!0;if(!en){var dn=H.createTexture(),Fn=er.allocType(Ka,36);H.activeTexture(Ql),H.bindTexture(Os,dn),H.texImage2D(Fs,0,So,3,3,0,So,Ka,Fn),er.freeType(Fn),H.bindTexture(Os,null),H.deleteTexture(dn),sn=!H.getError()}return{colorBits:[H.getParameter(Tn),H.getParameter(Mn),H.getParameter(sa),H.getParameter(Pr)],depthBits:H.getParameter($i),stencilBits:H.getParameter(La),subpixelBits:H.getParameter(Hn),extensions:Object.keys(Pe).filter(function(tn){return!!Pe[tn]}),maxAnisotropic:it,maxDrawbuffers:or,maxColorAttachments:Br,pointSizeDims:H.getParameter(ra),lineWidthDims:H.getParameter(ma),maxViewportDims:H.getParameter(Tt),maxCombinedTextureUnits:H.getParameter(ji),maxCubeMapSize:H.getParameter(Yr),maxRenderbufferSize:H.getParameter(bt),maxTextureUnits:H.getParameter(Co),maxTextureSize:H.getParameter(Ft),maxAttributes:H.getParameter(ea),maxVertexUniforms:H.getParameter(lo),maxVertexTextureUnits:H.getParameter(Aa),maxVaryingVectors:H.getParameter(Na),maxFragmentUniforms:H.getParameter(an),glsl:H.getParameter(Kl),renderer:H.getParameter(Gt),vendor:H.getParameter(Ls),version:H.getParameter(qi),readFloat:ur,npotTextureCube:sn}};function rs(H){return!!H&&typeof H=="object"&&Array.isArray(H.shape)&&Array.isArray(H.stride)&&typeof H.offset=="number"&&H.shape.length===H.stride.length&&(Array.isArray(H.data)||de(H.data))}var ve=function(H){return Object.keys(H).map(function(Pe){return H[Pe]})},De={shape:qo,flatten:ya};function mt(H,Pe,it){for(var or=0;or<Pe;++or)it[or]=H[or]}function ir(H,Pe,it,or){for(var Br=0,ur=0;ur<Pe;++ur)for(var kr=H[ur],Gr=0;Gr<it;++Gr)or[Br++]=kr[Gr]}function yn(H,Pe,it,or,Br,ur){for(var kr=ur,Gr=0;Gr<Pe;++Gr)for(var Kr=H[Gr],en=0;en<it;++en)for(var sn=Kr[en],dn=0;dn<or;++dn)Br[kr++]=sn[dn]}function Qn(H,Pe,it,or,Br){for(var ur=1,kr=it+1;kr<Pe.length;++kr)ur*=Pe[kr];var Gr=Pe[it];if(Pe.length-it==4){var Kr=Pe[it+1],en=Pe[it+2],sn=Pe[it+3];for(kr=0;kr<Gr;++kr)yn(H[kr],Kr,en,sn,or,Br),Br+=ur}else for(kr=0;kr<Gr;++kr)Qn(H[kr],Pe,it+1,or,Br),Br+=ur}function ya(H,Pe,it,or){var Br=1;if(Pe.length)for(var ur=0;ur<Pe.length;++ur)Br*=Pe[ur];else Br=0;var kr=or||er.allocType(it,Br);switch(Pe.length){case 0:break;case 1:mt(H,Pe[0],kr);break;case 2:ir(H,Pe[0],Pe[1],kr);break;case 3:yn(H,Pe[0],Pe[1],Pe[2],kr,0);break;default:Qn(H,Pe,0,kr,0)}return kr}function qo(H){for(var Pe=[],it=H;it.length;it=it[0])Pe.push(it.length);return Pe}var Fa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Fo=5120,Zo=5122,To=5124,Ds=5121,cs=5123,Ts=5125,Eu=5126,qu=5126,Cu={int8:Fo,int16:Zo,int32:To,uint8:Ds,uint16:cs,uint32:Ts,float:Eu,float32:qu},Su=35048,za=35040,fs={dynamic:Su,stream:za,static:35044},nu=De.flatten,Au=De.shape,uf=35044,Vh=35040,Xs=5121,lf=5126,ll=[];ll[5120]=1,ll[5122]=2,ll[5124]=4,ll[5121]=1,ll[5123]=2,ll[5125]=4,ll[5126]=4;function Fc(H){return Fa[Object.prototype.toString.call(H)]|0}function b(H,Pe){for(var it=0;it<Pe.length;++it)H[it]=Pe[it]}function k(H,Pe,it,or,Br,ur,kr){for(var Gr=0,Kr=0;Kr<it;++Kr)for(var en=0;en<or;++en)H[Gr++]=Pe[Br*Kr+ur*en+kr]}function G(H,Pe,it,or){var Br=0,ur={};function kr(St){this.id=Br++,this.buffer=H.createBuffer(),this.type=St,this.usage=uf,this.byteLength=0,this.dimension=1,this.dtype=Xs,this.persistentData=null,it.profile&&(this.stats={size:0})}kr.prototype.bind=function(){H.bindBuffer(this.type,this.buffer)},kr.prototype.destroy=function(){Fn(this)};var Gr=[];function Kr(St,mr){var rn=Gr.pop();return rn||(rn=new kr(St)),rn.bind(),dn(rn,mr,Vh,0,1,!1),rn}function en(St){Gr.push(St)}function sn(St,mr,rn){St.byteLength=mr.byteLength,H.bufferData(St.type,mr,rn)}function dn(St,mr,rn,En,Vr,Cn){var Zn;if(St.usage=rn,Array.isArray(mr)){if(St.dtype=En||lf,mr.length>0){var Ii;if(Array.isArray(mr[0])){Zn=Au(mr);for(var Mr=1,wr=1;wr<Zn.length;++wr)Mr*=Zn[wr];St.dimension=Mr,Ii=nu(mr,Zn,St.dtype),sn(St,Ii,rn),Cn?St.persistentData=Ii:er.freeType(Ii)}else if(typeof mr[0]=="number"){St.dimension=Vr;var ci=er.allocType(St.dtype,mr.length);b(ci,mr),sn(St,ci,rn),Cn?St.persistentData=ci:er.freeType(ci)}else de(mr[0])?(St.dimension=mr[0].length,St.dtype=En||Fc(mr[0])||lf,Ii=nu(mr,[mr.length,mr[0].length],St.dtype),sn(St,Ii,rn),Cn?St.persistentData=Ii:er.freeType(Ii)):V.raise("invalid buffer data")}}else if(de(mr))St.dtype=En||Fc(mr),St.dimension=Vr,sn(St,mr,rn),Cn&&(St.persistentData=new Uint8Array(new Uint8Array(mr.buffer)));else if(rs(mr)){Zn=mr.shape;var Nn=mr.stride,un=mr.offset,Pn=0,Dn=0,Qi=0,Fi=0;Zn.length===1?(Pn=Zn[0],Dn=1,Qi=Nn[0],Fi=0):Zn.length===2?(Pn=Zn[0],Dn=Zn[1],Qi=Nn[0],Fi=Nn[1]):V.raise("invalid shape"),St.dtype=En||Fc(mr.data)||lf,St.dimension=Dn;var Rn=er.allocType(St.dtype,Pn*Dn);k(Rn,mr.data,Pn,Dn,Qi,Fi,un),sn(St,Rn,rn),Cn?St.persistentData=Rn:er.freeType(Rn)}else mr instanceof ArrayBuffer?(St.dtype=Xs,St.dimension=Vr,sn(St,mr,rn),Cn&&(St.persistentData=new Uint8Array(new Uint8Array(mr)))):V.raise("invalid buffer data")}function Fn(St){Pe.bufferCount--,or(St);var mr=St.buffer;V(mr,"buffer must not be deleted already"),H.deleteBuffer(mr),St.buffer=null,delete ur[St.id]}function tn(St,mr,rn,En){Pe.bufferCount++;var Vr=new kr(mr);ur[Vr.id]=Vr;function Cn(Mr){var wr=uf,ci=null,Nn=0,un=0,Pn=1;return Array.isArray(Mr)||de(Mr)||rs(Mr)||Mr instanceof ArrayBuffer?ci=Mr:typeof Mr=="number"?Nn=Mr|0:Mr&&(V.type(Mr,"object","buffer arguments must be an object, a number or an array"),"data"in Mr&&(V(ci===null||Array.isArray(ci)||de(ci)||rs(ci),"invalid data for buffer"),ci=Mr.data),"usage"in Mr&&(V.parameter(Mr.usage,fs,"invalid buffer usage"),wr=fs[Mr.usage]),"type"in Mr&&(V.parameter(Mr.type,Cu,"invalid buffer type"),un=Cu[Mr.type]),"dimension"in Mr&&(V.type(Mr.dimension,"number","invalid dimension"),Pn=Mr.dimension|0),"length"in Mr&&(V.nni(Nn,"buffer length must be a nonnegative integer"),Nn=Mr.length|0)),Vr.bind(),ci?dn(Vr,ci,wr,un,Pn,En):(Nn&&H.bufferData(Vr.type,Nn,wr),Vr.dtype=un||Xs,Vr.usage=wr,Vr.dimension=Pn,Vr.byteLength=Nn),it.profile&&(Vr.stats.size=Vr.byteLength*ll[Vr.dtype]),Cn}function Zn(Mr,wr){V(wr+Mr.byteLength<=Vr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Mr.byteLength+" starting from offset "+wr+" to a buffer of size "+Vr.byteLength),H.bufferSubData(Vr.type,wr,Mr)}function Ii(Mr,wr){var ci=(wr||0)|0,Nn;if(Vr.bind(),de(Mr)||Mr instanceof ArrayBuffer)Zn(Mr,ci);else if(Array.isArray(Mr)){if(Mr.length>0)if(typeof Mr[0]=="number"){var un=er.allocType(Vr.dtype,Mr.length);b(un,Mr),Zn(un,ci),er.freeType(un)}else if(Array.isArray(Mr[0])||de(Mr[0])){Nn=Au(Mr);var Pn=nu(Mr,Nn,Vr.dtype);Zn(Pn,ci),er.freeType(Pn)}else V.raise("invalid buffer data")}else if(rs(Mr)){Nn=Mr.shape;var Dn=Mr.stride,Qi=0,Fi=0,Rn=0,Un=0;Nn.length===1?(Qi=Nn[0],Fi=1,Rn=Dn[0],Un=0):Nn.length===2?(Qi=Nn[0],Fi=Nn[1],Rn=Dn[0],Un=Dn[1]):V.raise("invalid shape");var Oi=Array.isArray(Mr.data)?Vr.dtype:Fc(Mr.data),ta=er.allocType(Oi,Qi*Fi);k(ta,Mr.data,Qi,Fi,Rn,Un,Mr.offset),Zn(ta,ci),er.freeType(ta)}else V.raise("invalid data for buffer subdata");return Cn}return rn||Cn(St),Cn._reglType="buffer",Cn._buffer=Vr,Cn.subdata=Ii,it.profile&&(Cn.stats=Vr.stats),Cn.destroy=function(){Fn(Vr)},Cn}function Ur(){ve(ur).forEach(function(St){St.buffer=H.createBuffer(),H.bindBuffer(St.type,St.buffer),H.bufferData(St.type,St.persistentData||St.byteLength,St.usage)})}return it.profile&&(Pe.getTotalBufferSize=function(){var St=0;return Object.keys(ur).forEach(function(mr){St+=ur[mr].stats.size}),St}),{create:tn,createStream:Kr,destroyStream:en,clear:function(){ve(ur).forEach(Fn),Gr.forEach(Fn)},getBuffer:function(St){return St&&St._buffer instanceof kr?St._buffer:null},restore:Ur,_initBuffer:dn}}var D=0,ne=0,Re=1,pt=1,It=4,jt=4,Nr={points:D,point:ne,lines:Re,line:pt,triangles:It,triangle:jt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wr=0,Kn=1,Hi=4,Gi=5120,Ni=5121,no=5122,go=5123,ka=5124,iu=5125,Ol=34963,fc=35040,hc=35044;function pc(H,Pe,it,or){var Br={},ur=0,kr={uint8:Ni,uint16:go};Pe.oes_element_index_uint&&(kr.uint32=iu);function Gr(Ur){this.id=ur++,Br[this.id]=this,this.buffer=Ur,this.primType=Hi,this.vertCount=0,this.type=0}Gr.prototype.bind=function(){this.buffer.bind()};var Kr=[];function en(Ur){var St=Kr.pop();return St||(St=new Gr(it.create(null,Ol,!0,!1)._buffer)),dn(St,Ur,fc,-1,-1,0,0),St}function sn(Ur){Kr.push(Ur)}function dn(Ur,St,mr,rn,En,Vr,Cn){Ur.buffer.bind();var Zn;if(St){var Ii=Cn;!Cn&&(!de(St)||rs(St)&&!de(St.data))&&(Ii=Pe.oes_element_index_uint?iu:go),it._initBuffer(Ur.buffer,St,mr,Ii,3)}else H.bufferData(Ol,Vr,mr),Ur.buffer.dtype=Zn||Ni,Ur.buffer.usage=mr,Ur.buffer.dimension=3,Ur.buffer.byteLength=Vr;if(Zn=Cn,!Cn){switch(Ur.buffer.dtype){case Ni:case Gi:Zn=Ni;break;case go:case no:Zn=go;break;case iu:case ka:Zn=iu;break;default:V.raise("unsupported type for element array")}Ur.buffer.dtype=Zn}Ur.type=Zn,V(Zn!==iu||!!Pe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Mr=En;Mr<0&&(Mr=Ur.buffer.byteLength,Zn===go?Mr>>=1:Zn===iu&&(Mr>>=2)),Ur.vertCount=Mr;var wr=rn;if(rn<0){wr=Hi;var ci=Ur.buffer.dimension;ci===1&&(wr=Wr),ci===2&&(wr=Kn),ci===3&&(wr=Hi)}Ur.primType=wr}function Fn(Ur){or.elementsCount--,V(Ur.buffer!==null,"must not double destroy elements"),delete Br[Ur.id],Ur.buffer.destroy(),Ur.buffer=null}function tn(Ur,St){var mr=it.create(null,Ol,!0),rn=new Gr(mr._buffer);or.elementsCount++;function En(Vr){if(!Vr)mr(),rn.primType=Hi,rn.vertCount=0,rn.type=Ni;else if(typeof Vr=="number")mr(Vr),rn.primType=Hi,rn.vertCount=Vr|0,rn.type=Ni;else{var Cn=null,Zn=hc,Ii=-1,Mr=-1,wr=0,ci=0;Array.isArray(Vr)||de(Vr)||rs(Vr)?Cn=Vr:(V.type(Vr,"object","invalid arguments for elements"),"data"in Vr&&(Cn=Vr.data,V(Array.isArray(Cn)||de(Cn)||rs(Cn),"invalid data for element buffer")),"usage"in Vr&&(V.parameter(Vr.usage,fs,"invalid element buffer usage"),Zn=fs[Vr.usage]),"primitive"in Vr&&(V.parameter(Vr.primitive,Nr,"invalid element buffer primitive"),Ii=Nr[Vr.primitive]),"count"in Vr&&(V(typeof Vr.count=="number"&&Vr.count>=0,"invalid vertex count for elements"),Mr=Vr.count|0),"type"in Vr&&(V.parameter(Vr.type,kr,"invalid buffer type"),ci=kr[Vr.type]),"length"in Vr?wr=Vr.length|0:(wr=Mr,ci===go||ci===no?wr*=2:(ci===iu||ci===ka)&&(wr*=4))),dn(rn,Cn,Zn,Ii,Mr,wr,ci)}return En}return En(Ur),En._reglType="elements",En._elements=rn,En.subdata=function(Vr,Cn){return mr.subdata(Vr,Cn),En},En.destroy=function(){Fn(rn)},En}return{create:tn,createStream:en,destroyStream:sn,getElements:function(Ur){return typeof Ur=="function"&&Ur._elements instanceof Gr?Ur._elements:null},clear:function(){ve(Br).forEach(Fn)}}}var dc=new Float32Array(1),Ru=new Uint32Array(dc.buffer),Fl=5123;function El(H){for(var Pe=er.allocType(Fl,H.length),it=0;it<H.length;++it)if(isNaN(H[it]))Pe[it]=65535;else if(H[it]===Infinity)Pe[it]=31744;else if(H[it]===-Infinity)Pe[it]=64512;else{dc[0]=H[it];var or=Ru[0],Br=or>>>31<<15,ur=(or<<1>>>24)-127,kr=or>>13&(1<<10)-1;if(ur<-24)Pe[it]=Br;else if(ur<-14){var Gr=-14-ur;Pe[it]=Br+(kr+(1<<10)>>Gr)}else ur>15?Pe[it]=Br+31744:Pe[it]=Br+(ur+15<<10)+kr}return Pe}function Vo(H){return Array.isArray(H)||de(H)}var vp=function(H){return!(H&H-1)&&!!H},jh=34467,wu=3553,cf=34067,Cl=34069,$u=6408,Gh=6406,Sl=6407,yo=6409,Ys=6410,Hh=32854,Al=32855,mp=36194,gp=32819,lh=32820,Nf=33635,ff=34042,zf=6402,Dc=34041,Uf=35904,vc=35906,hf=36193,Jl=33776,au=33777,Zf=33778,Vf=33779,Wh=35986,mc=35987,Ku=34798,Dl=35840,Bc=35841,ec=35842,jf=35843,Gf=36196,gc=5121,Xh=5123,ch=5125,Nc=5126,Xp=10242,fh=10243,Yh=10497,pf=33071,Yp=33648,zc=10240,Ao=10241,Bs=9728,Uc=9729,Pa=9984,Ta=9985,wo=9986,vu=9987,df=33170,tc=4352,hh=4353,Qa=4354,vf=34046,Bl=3317,yc=37440,rc=37441,hs=37443,Qu=37444,mf=33984,Do=[Pa,wo,Ta,vu],Jn=[0,yo,Ys,Sl,$u],jo={};jo[yo]=jo[Gh]=jo[zf]=1,jo[Dc]=jo[Ys]=2,jo[Sl]=jo[Uf]=3,jo[$u]=jo[vc]=4;function Zc(H){return"[object "+H+"]"}var gf=Zc("HTMLCanvasElement"),Ja=Zc("OffscreenCanvas"),Lu=Zc("CanvasRenderingContext2D"),_c=Zc("ImageBitmap"),In=Zc("HTMLImageElement"),yf=Zc("HTMLVideoElement"),ph=Object.keys(Fa).concat([gf,Ja,Lu,_c,In,yf]),wl=[];wl[gc]=1,wl[Nc]=4,wl[hf]=2,wl[Xh]=2,wl[ch]=4;var co=[];co[Hh]=2,co[Al]=2,co[mp]=2,co[Dc]=4,co[Jl]=.5,co[au]=.5,co[Zf]=1,co[Vf]=1,co[Wh]=.5,co[mc]=1,co[Ku]=1,co[Dl]=.5,co[Bc]=.25,co[ec]=.5,co[jf]=.25,co[Gf]=.5;function mu(H){return Array.isArray(H)&&(H.length===0||typeof H[0]=="number")}function Ua(H){if(!Array.isArray(H))return!1;var Pe=H.length;return!(Pe===0||!Vo(H[0]))}function Nl(H){return Object.prototype.toString.call(H)}function Tu(H){return Nl(H)===gf}function zl(H){return Nl(H)===Ja}function Hf(H){return Nl(H)===Lu}function Vc(H){return Nl(H)===_c}function yp(H){return Nl(H)===In}function xi(H){return Nl(H)===yf}function cl(H){var Pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Pe&&H&&H.getContext)}function qs(H){var Pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Pe&&H&&"src"in H&&"crossOrigin"in H)}function pa(H){if(!H)return!1;if(cl(H)||qs(H))return!0;var Pe=Nl(H);return ph.indexOf(Pe)>=0?!0:mu(H)||Ua(H)||rs(H)}function fl(H){return Fa[Object.prototype.toString.call(H)]|0}function gu(H,Pe){var it=Pe.length;switch(H.type){case gc:case Xh:case ch:case Nc:var or=er.allocType(H.type,it);or.set(Pe),H.data=or;break;case hf:H.data=El(Pe);break;default:V.raise("unsupported texture type, must specify a typed array")}}function Ns(H,Pe){return er.allocType(H.type===hf?Nc:H.type,Pe)}function _f(H,Pe){H.type===hf?(H.data=El(Pe),er.freeType(Pe)):H.data=Pe}function xc(H,Pe,it,or,Br,ur){for(var kr=H.width,Gr=H.height,Kr=H.channels,en=kr*Gr*Kr,sn=Ns(H,en),dn=0,Fn=0;Fn<Gr;++Fn)for(var tn=0;tn<kr;++tn)for(var Ur=0;Ur<Kr;++Ur)sn[dn++]=Pe[it*tn+or*Fn+Br*Ur+ur];_f(H,sn)}function Mu(H,Pe,it,or,Br,ur){var kr;if(typeof co[H]!="undefined"?kr=co[H]:kr=jo[H]*wl[Pe],ur&&(kr*=6),Br){for(var Gr=0,Kr=it;Kr>=1;)Gr+=kr*Kr*Kr,Kr/=2;return Gr}else return kr*it*or}function yu(H,Pe,it,or,Br,ur,kr){var Gr={"don't care":tc,"dont care":tc,nice:Qa,fast:hh},Kr={repeat:Yh,clamp:pf,mirror:Yp},en={nearest:Bs,linear:Uc},sn=y({mipmap:vu,"nearest mipmap nearest":Pa,"linear mipmap nearest":Ta,"nearest mipmap linear":wo,"linear mipmap linear":vu},en),dn={none:0,browser:Qu},Fn={uint8:gc,rgba4:gp,rgb565:Nf,"rgb5 a1":lh},tn={alpha:Gh,luminance:yo,"luminance alpha":Ys,rgb:Sl,rgba:$u,rgba4:Hh,"rgb5 a1":Al,rgb565:mp},Ur={};Pe.ext_srgb&&(tn.srgb=Uf,tn.srgba=vc),Pe.oes_texture_float&&(Fn.float32=Fn.float=Nc),Pe.oes_texture_half_float&&(Fn.float16=Fn["half float"]=hf),Pe.webgl_depth_texture&&(y(tn,{depth:zf,"depth stencil":Dc}),y(Fn,{uint16:Xh,uint32:ch,"depth stencil":ff})),Pe.webgl_compressed_texture_s3tc&&y(Ur,{"rgb s3tc dxt1":Jl,"rgba s3tc dxt1":au,"rgba s3tc dxt3":Zf,"rgba s3tc dxt5":Vf}),Pe.webgl_compressed_texture_atc&&y(Ur,{"rgb atc":Wh,"rgba atc explicit alpha":mc,"rgba atc interpolated alpha":Ku}),Pe.webgl_compressed_texture_pvrtc&&y(Ur,{"rgb pvrtc 4bppv1":Dl,"rgb pvrtc 2bppv1":Bc,"rgba pvrtc 4bppv1":ec,"rgba pvrtc 2bppv1":jf}),Pe.webgl_compressed_texture_etc1&&(Ur["rgb etc1"]=Gf);var St=Array.prototype.slice.call(H.getParameter(jh)||new Uint32Array(0));Object.keys(Ur).forEach(function(Ye){var dr=Ur[Ye];St.indexOf(dr)>=0&&(tn[Ye]=dr)});var mr=Object.keys(tn);it.textureFormats=mr;var rn=[];Object.keys(tn).forEach(function(Ye){var dr=tn[Ye];rn[dr]=Ye});var En=[];Object.keys(Fn).forEach(function(Ye){var dr=Fn[Ye];En[dr]=Ye});var Vr=[];Object.keys(en).forEach(function(Ye){var dr=en[Ye];Vr[dr]=Ye});var Cn=[];Object.keys(sn).forEach(function(Ye){var dr=sn[Ye];Cn[dr]=Ye});var Zn=[];Object.keys(Kr).forEach(function(Ye){var dr=Kr[Ye];Zn[dr]=Ye});var Ii=mr.reduce(function(Ye,dr){var qt=tn[dr];return qt===yo||qt===Gh||qt===yo||qt===Ys||qt===zf||qt===Dc||Pe.ext_srgb&&(qt===Uf||qt===vc)?Ye[qt]=qt:qt===Al||dr.indexOf("rgba")>=0?Ye[qt]=$u:Ye[qt]=Sl,Ye},{});function Mr(){this.internalformat=$u,this.format=$u,this.type=gc,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Qu,this.width=0,this.height=0,this.channels=0}function wr(Ye,dr){Ye.internalformat=dr.internalformat,Ye.format=dr.format,Ye.type=dr.type,Ye.compressed=dr.compressed,Ye.premultiplyAlpha=dr.premultiplyAlpha,Ye.flipY=dr.flipY,Ye.unpackAlignment=dr.unpackAlignment,Ye.colorSpace=dr.colorSpace,Ye.width=dr.width,Ye.height=dr.height,Ye.channels=dr.channels}function ci(Ye,dr){if(!(typeof dr!="object"||!dr)){if("premultiplyAlpha"in dr&&(V.type(dr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ye.premultiplyAlpha=dr.premultiplyAlpha),"flipY"in dr&&(V.type(dr.flipY,"boolean","invalid texture flip"),Ye.flipY=dr.flipY),"alignment"in dr&&(V.oneOf(dr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ye.unpackAlignment=dr.alignment),"colorSpace"in dr&&(V.parameter(dr.colorSpace,dn,"invalid colorSpace"),Ye.colorSpace=dn[dr.colorSpace]),"type"in dr){var qt=dr.type;V(Pe.oes_texture_float||!(qt==="float"||qt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),V(Pe.oes_texture_half_float||!(qt==="half float"||qt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),V(Pe.webgl_depth_texture||!(qt==="uint16"||qt==="uint32"||qt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(qt,Fn,"invalid texture type"),Ye.type=Fn[qt]}var ei=Ye.width,Ra=Ye.height,Ze=Ye.channels,Ee=!1;"shape"in dr?(V(Array.isArray(dr.shape)&&dr.shape.length>=2,"shape must be an array"),ei=dr.shape[0],Ra=dr.shape[1],dr.shape.length===3&&(Ze=dr.shape[2],V(Ze>0&&Ze<=4,"invalid number of channels"),Ee=!0),V(ei>=0&&ei<=it.maxTextureSize,"invalid width"),V(Ra>=0&&Ra<=it.maxTextureSize,"invalid height")):("radius"in dr&&(ei=Ra=dr.radius,V(ei>=0&&ei<=it.maxTextureSize,"invalid radius")),"width"in dr&&(ei=dr.width,V(ei>=0&&ei<=it.maxTextureSize,"invalid width")),"height"in dr&&(Ra=dr.height,V(Ra>=0&&Ra<=it.maxTextureSize,"invalid height")),"channels"in dr&&(Ze=dr.channels,V(Ze>0&&Ze<=4,"invalid number of channels"),Ee=!0)),Ye.width=ei|0,Ye.height=Ra|0,Ye.channels=Ze|0;var ft=!1;if("format"in dr){var Ut=dr.format;V(Pe.webgl_depth_texture||!(Ut==="depth"||Ut==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(Ut,tn,"invalid texture format");var nr=Ye.internalformat=tn[Ut];Ye.format=Ii[nr],Ut in Fn&&("type"in dr||(Ye.type=Fn[Ut])),Ut in Ur&&(Ye.compressed=!0),ft=!0}!Ee&&ft?Ye.channels=jo[Ye.format]:Ee&&!ft?Ye.channels!==Jn[Ye.format]&&(Ye.format=Ye.internalformat=Jn[Ye.channels]):ft&&Ee&&V(Ye.channels===jo[Ye.format],"number of channels inconsistent with specified format")}}function Nn(Ye){H.pixelStorei(yc,Ye.flipY),H.pixelStorei(rc,Ye.premultiplyAlpha),H.pixelStorei(hs,Ye.colorSpace),H.pixelStorei(Bl,Ye.unpackAlignment)}function un(){Mr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Pn(Ye,dr){var qt=null;if(pa(dr)?qt=dr:dr&&(V.type(dr,"object","invalid pixel data type"),ci(Ye,dr),"x"in dr&&(Ye.xOffset=dr.x|0),"y"in dr&&(Ye.yOffset=dr.y|0),pa(dr.data)&&(qt=dr.data)),V(!Ye.compressed||qt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),dr.copy){V(!qt,"can not specify copy and data field for the same texture");var ei=Br.viewportWidth,Ra=Br.viewportHeight;Ye.width=Ye.width||ei-Ye.xOffset,Ye.height=Ye.height||Ra-Ye.yOffset,Ye.needsCopy=!0,V(Ye.xOffset>=0&&Ye.xOffset<ei&&Ye.yOffset>=0&&Ye.yOffset<Ra&&Ye.width>0&&Ye.width<=ei&&Ye.height>0&&Ye.height<=Ra,"copy texture read out of bounds")}else if(!qt)Ye.width=Ye.width||1,Ye.height=Ye.height||1,Ye.channels=Ye.channels||4;else if(de(qt))Ye.channels=Ye.channels||4,Ye.data=qt,!("type"in dr)&&Ye.type===gc&&(Ye.type=fl(qt));else if(mu(qt))Ye.channels=Ye.channels||4,gu(Ye,qt),Ye.alignment=1,Ye.needsFree=!0;else if(rs(qt)){var Ze=qt.data;!Array.isArray(Ze)&&Ye.type===gc&&(Ye.type=fl(Ze));var Ee=qt.shape,ft=qt.stride,Ut,nr,gt,nt,At,Le;Ee.length===3?(gt=Ee[2],Le=ft[2]):(V(Ee.length===2,"invalid ndarray pixel data, must be 2 or 3D"),gt=1,Le=1),Ut=Ee[0],nr=Ee[1],nt=ft[0],At=ft[1],Ye.alignment=1,Ye.width=Ut,Ye.height=nr,Ye.channels=gt,Ye.format=Ye.internalformat=Jn[gt],Ye.needsFree=!0,xc(Ye,Ze,nt,At,Le,qt.offset)}else if(cl(qt)||Tu(qt)||zl(qt)||Hf(qt))cl(qt)||Tu(qt)||zl(qt)?Ye.element=qt:Ye.element=qt.canvas,Ye.width=Ye.element.width,Ye.height=Ye.element.height,Ye.channels=4;else if(Vc(qt))Ye.element=qt,Ye.width=qt.width,Ye.height=qt.height,Ye.channels=4;else if(yp(qt))Ye.element=qt,Ye.width=qt.naturalWidth,Ye.height=qt.naturalHeight,Ye.channels=4;else if(qs(qt))Ye.element=qt,Ye.width=qt.width,Ye.height=qt.height,Ye.channels=4;else if(xi(qt))Ye.element=qt,Ye.width=qt.videoWidth,Ye.height=qt.videoHeight,Ye.channels=4;else if(Ua(qt)){var lt=Ye.width||qt[0].length,Ge=Ye.height||qt.length,zt=Ye.channels;Vo(qt[0][0])?zt=zt||qt[0][0].length:zt=zt||1;for(var $t=De.shape(qt),jr=1,_n=0;_n<$t.length;++_n)jr*=$t[_n];var Ln=Ns(Ye,jr);De.flatten(qt,$t,"",Ln),_f(Ye,Ln),Ye.alignment=1,Ye.width=lt,Ye.height=Ge,Ye.channels=zt,Ye.format=Ye.internalformat=Jn[zt],Ye.needsFree=!0}Ye.type===Nc?V(it.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ye.type===hf&&V(it.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Dn(Ye,dr,qt){var ei=Ye.element,Ra=Ye.data,Ze=Ye.internalformat,Ee=Ye.format,ft=Ye.type,Ut=Ye.width,nr=Ye.height;Nn(Ye),ei?H.texImage2D(dr,qt,Ee,Ee,ft,ei):Ye.compressed?H.compressedTexImage2D(dr,qt,Ze,Ut,nr,0,Ra):Ye.needsCopy?(or(),H.copyTexImage2D(dr,qt,Ee,Ye.xOffset,Ye.yOffset,Ut,nr,0)):H.texImage2D(dr,qt,Ee,Ut,nr,0,Ee,ft,Ra||null)}function Qi(Ye,dr,qt,ei,Ra){var Ze=Ye.element,Ee=Ye.data,ft=Ye.internalformat,Ut=Ye.format,nr=Ye.type,gt=Ye.width,nt=Ye.height;Nn(Ye),Ze?H.texSubImage2D(dr,Ra,qt,ei,Ut,nr,Ze):Ye.compressed?H.compressedTexSubImage2D(dr,Ra,qt,ei,ft,gt,nt,Ee):Ye.needsCopy?(or(),H.copyTexSubImage2D(dr,Ra,qt,ei,Ye.xOffset,Ye.yOffset,gt,nt)):H.texSubImage2D(dr,Ra,qt,ei,gt,nt,Ut,nr,Ee)}var Fi=[];function Rn(){return Fi.pop()||new un}function Un(Ye){Ye.needsFree&&er.freeType(Ye.data),un.call(Ye),Fi.push(Ye)}function Oi(){Mr.call(this),this.genMipmaps=!1,this.mipmapHint=tc,this.mipmask=0,this.images=Array(16)}function ta(Ye,dr,qt){var ei=Ye.images[0]=Rn();Ye.mipmask=1,ei.width=Ye.width=dr,ei.height=Ye.height=qt,ei.channels=Ye.channels=4}function Ma(Ye,dr){var qt=null;if(pa(dr))qt=Ye.images[0]=Rn(),wr(qt,Ye),Pn(qt,dr),Ye.mipmask=1;else if(ci(Ye,dr),Array.isArray(dr.mipmap))for(var ei=dr.mipmap,Ra=0;Ra<ei.length;++Ra)qt=Ye.images[Ra]=Rn(),wr(qt,Ye),qt.width>>=Ra,qt.height>>=Ra,Pn(qt,ei[Ra]),Ye.mipmask|=1<<Ra;else qt=Ye.images[0]=Rn(),wr(qt,Ye),Pn(qt,dr),Ye.mipmask=1;wr(Ye,Ye.images[0]),Ye.compressed&&(Ye.internalformat===Jl||Ye.internalformat===au||Ye.internalformat===Zf||Ye.internalformat===Vf)&&V(Ye.width%4==0&&Ye.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function No(Ye,dr){for(var qt=Ye.images,ei=0;ei<qt.length;++ei){if(!qt[ei])return;Dn(qt[ei],dr,ei)}}var Ko=[];function Ea(){var Ye=Ko.pop()||new Oi;Mr.call(Ye),Ye.mipmask=0;for(var dr=0;dr<16;++dr)Ye.images[dr]=null;return Ye}function Zs(Ye){for(var dr=Ye.images,qt=0;qt<dr.length;++qt)dr[qt]&&Un(dr[qt]),dr[qt]=null;Ko.push(Ye)}function eo(){this.minFilter=Bs,this.magFilter=Bs,this.wrapS=pf,this.wrapT=pf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=tc}function Vs(Ye,dr){if("min"in dr){var qt=dr.min;V.parameter(qt,sn),Ye.minFilter=sn[qt],Do.indexOf(Ye.minFilter)>=0&&!("faces"in dr)&&(Ye.genMipmaps=!0)}if("mag"in dr){var ei=dr.mag;V.parameter(ei,en),Ye.magFilter=en[ei]}var Ra=Ye.wrapS,Ze=Ye.wrapT;if("wrap"in dr){var Ee=dr.wrap;typeof Ee=="string"?(V.parameter(Ee,Kr),Ra=Ze=Kr[Ee]):Array.isArray(Ee)&&(V.parameter(Ee[0],Kr),V.parameter(Ee[1],Kr),Ra=Kr[Ee[0]],Ze=Kr[Ee[1]])}else{if("wrapS"in dr){var ft=dr.wrapS;V.parameter(ft,Kr),Ra=Kr[ft]}if("wrapT"in dr){var Ut=dr.wrapT;V.parameter(Ut,Kr),Ze=Kr[Ut]}}if(Ye.wrapS=Ra,Ye.wrapT=Ze,"anisotropic"in dr){var nr=dr.anisotropic;V(typeof nr=="number"&&nr>=1&&nr<=it.maxAnisotropic,"aniso samples must be between 1 and "),Ye.anisotropic=dr.anisotropic}if("mipmap"in dr){var gt=!1;switch(typeof dr.mipmap){case"string":V.parameter(dr.mipmap,Gr,"invalid mipmap hint"),Ye.mipmapHint=Gr[dr.mipmap],Ye.genMipmaps=!0,gt=!0;break;case"boolean":gt=Ye.genMipmaps=dr.mipmap;break;case"object":V(Array.isArray(dr.mipmap),"invalid mipmap type"),Ye.genMipmaps=!1,gt=!0;break;default:V.raise("invalid mipmap type")}gt&&!("min"in dr)&&(Ye.minFilter=Pa)}}function _s(Ye,dr){H.texParameteri(dr,Ao,Ye.minFilter),H.texParameteri(dr,zc,Ye.magFilter),H.texParameteri(dr,Xp,Ye.wrapS),H.texParameteri(dr,fh,Ye.wrapT),Pe.ext_texture_filter_anisotropic&&H.texParameteri(dr,vf,Ye.anisotropic),Ye.genMipmaps&&(H.hint(df,Ye.mipmapHint),H.generateMipmap(dr))}var Js=0,js={},xu=it.maxTextureUnits,Qo=Array(xu).map(function(){return null});function la(Ye){Mr.call(this),this.mipmask=0,this.internalformat=$u,this.id=Js++,this.refCount=1,this.target=Ye,this.texture=H.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new eo,kr.profile&&(this.stats={size:0})}function xs(Ye){H.activeTexture(mf),H.bindTexture(Ye.target,Ye.texture)}function gr(){var Ye=Qo[0];Ye?H.bindTexture(Ye.target,Ye.texture):H.bindTexture(wu,null)}function fu(Ye){var dr=Ye.texture;V(dr,"must not double destroy texture");var qt=Ye.unit,ei=Ye.target;qt>=0&&(H.activeTexture(mf+qt),H.bindTexture(ei,null),Qo[qt]=null),H.deleteTexture(dr),Ye.texture=null,Ye.params=null,Ye.pixels=null,Ye.refCount=0,delete js[Ye.id],ur.textureCount--}y(la.prototype,{bind:function(){var Ye=this;Ye.bindCount+=1;var dr=Ye.unit;if(dr<0){for(var qt=0;qt<xu;++qt){var ei=Qo[qt];if(ei){if(ei.bindCount>0)continue;ei.unit=-1}Qo[qt]=Ye,dr=qt;break}dr>=xu&&V.raise("insufficient number of texture units"),kr.profile&&ur.maxTextureUnits<dr+1&&(ur.maxTextureUnits=dr+1),Ye.unit=dr,H.activeTexture(mf+dr),H.bindTexture(Ye.target,Ye.texture)}return dr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&fu(this)}});function Yi(Ye,dr){var qt=new la(wu);js[qt.id]=qt,ur.textureCount++;function ei(Ee,ft){var Ut=qt.texInfo;eo.call(Ut);var nr=Ea();return typeof Ee=="number"?typeof ft=="number"?ta(nr,Ee|0,ft|0):ta(nr,Ee|0,Ee|0):Ee?(V.type(Ee,"object","invalid arguments to regl.texture"),Vs(Ut,Ee),Ma(nr,Ee)):ta(nr,1,1),Ut.genMipmaps&&(nr.mipmask=(nr.width<<1)-1),qt.mipmask=nr.mipmask,wr(qt,nr),V.texture2D(Ut,nr,it),qt.internalformat=nr.internalformat,ei.width=nr.width,ei.height=nr.height,xs(qt),No(nr,wu),_s(Ut,wu),gr(),Zs(nr),kr.profile&&(qt.stats.size=Mu(qt.internalformat,qt.type,nr.width,nr.height,Ut.genMipmaps,!1)),ei.format=rn[qt.internalformat],ei.type=En[qt.type],ei.mag=Vr[Ut.magFilter],ei.min=Cn[Ut.minFilter],ei.wrapS=Zn[Ut.wrapS],ei.wrapT=Zn[Ut.wrapT],ei}function Ra(Ee,ft,Ut,nr){V(!!Ee,"must specify image data");var gt=ft|0,nt=Ut|0,At=nr|0,Le=Rn();return wr(Le,qt),Le.width=0,Le.height=0,Pn(Le,Ee),Le.width=Le.width||(qt.width>>At)-gt,Le.height=Le.height||(qt.height>>At)-nt,V(qt.type===Le.type&&qt.format===Le.format&&qt.internalformat===Le.internalformat,"incompatible format for texture.subimage"),V(gt>=0&&nt>=0&&gt+Le.width<=qt.width&&nt+Le.height<=qt.height,"texture.subimage write out of bounds"),V(qt.mipmask&1<<At,"missing mipmap data"),V(Le.data||Le.element||Le.needsCopy,"missing image data"),xs(qt),Qi(Le,wu,gt,nt,At),gr(),Un(Le),ei}function Ze(Ee,ft){var Ut=Ee|0,nr=ft|0||Ut;if(Ut===qt.width&&nr===qt.height)return ei;ei.width=qt.width=Ut,ei.height=qt.height=nr,xs(qt);for(var gt=0;qt.mipmask>>gt;++gt){var nt=Ut>>gt,At=nr>>gt;if(!nt||!At)break;H.texImage2D(wu,gt,qt.format,nt,At,0,qt.format,qt.type,null)}return gr(),kr.profile&&(qt.stats.size=Mu(qt.internalformat,qt.type,Ut,nr,!1,!1)),ei}return ei(Ye,dr),ei.subimage=Ra,ei.resize=Ze,ei._reglType="texture2d",ei._texture=qt,kr.profile&&(ei.stats=qt.stats),ei.destroy=function(){qt.decRef()},ei}function wa(Ye,dr,qt,ei,Ra,Ze){var Ee=new la(cf);js[Ee.id]=Ee,ur.cubeCount++;var ft=new Array(6);function Ut(nt,At,Le,lt,Ge,zt){var $t,jr=Ee.texInfo;for(eo.call(jr),$t=0;$t<6;++$t)ft[$t]=Ea();if(typeof nt=="number"||!nt){var _n=nt|0||1;for($t=0;$t<6;++$t)ta(ft[$t],_n,_n)}else if(typeof nt=="object")if(At)Ma(ft[0],nt),Ma(ft[1],At),Ma(ft[2],Le),Ma(ft[3],lt),Ma(ft[4],Ge),Ma(ft[5],zt);else if(Vs(jr,nt),ci(Ee,nt),"faces"in nt){var Ln=nt.faces;for(V(Array.isArray(Ln)&&Ln.length===6,"cube faces must be a length 6 array"),$t=0;$t<6;++$t)V(typeof Ln[$t]=="object"&&!!Ln[$t],"invalid input for cube map face"),wr(ft[$t],Ee),Ma(ft[$t],Ln[$t])}else for($t=0;$t<6;++$t)Ma(ft[$t],nt);else V.raise("invalid arguments to cube map");for(wr(Ee,ft[0]),V.optional(function(){it.npotTextureCube||V(vp(Ee.width)&&vp(Ee.height),"your browser does not support non power or two texture dimensions")}),jr.genMipmaps?Ee.mipmask=(ft[0].width<<1)-1:Ee.mipmask=ft[0].mipmask,V.textureCube(Ee,jr,ft,it),Ee.internalformat=ft[0].internalformat,Ut.width=ft[0].width,Ut.height=ft[0].height,xs(Ee),$t=0;$t<6;++$t)No(ft[$t],Cl+$t);for(_s(jr,cf),gr(),kr.profile&&(Ee.stats.size=Mu(Ee.internalformat,Ee.type,Ut.width,Ut.height,jr.genMipmaps,!0)),Ut.format=rn[Ee.internalformat],Ut.type=En[Ee.type],Ut.mag=Vr[jr.magFilter],Ut.min=Cn[jr.minFilter],Ut.wrapS=Zn[jr.wrapS],Ut.wrapT=Zn[jr.wrapT],$t=0;$t<6;++$t)Zs(ft[$t]);return Ut}function nr(nt,At,Le,lt,Ge){V(!!At,"must specify image data"),V(typeof nt=="number"&&nt===(nt|0)&&nt>=0&&nt<6,"invalid face");var zt=Le|0,$t=lt|0,jr=Ge|0,_n=Rn();return wr(_n,Ee),_n.width=0,_n.height=0,Pn(_n,At),_n.width=_n.width||(Ee.width>>jr)-zt,_n.height=_n.height||(Ee.height>>jr)-$t,V(Ee.type===_n.type&&Ee.format===_n.format&&Ee.internalformat===_n.internalformat,"incompatible format for texture.subimage"),V(zt>=0&&$t>=0&&zt+_n.width<=Ee.width&&$t+_n.height<=Ee.height,"texture.subimage write out of bounds"),V(Ee.mipmask&1<<jr,"missing mipmap data"),V(_n.data||_n.element||_n.needsCopy,"missing image data"),xs(Ee),Qi(_n,Cl+nt,zt,$t,jr),gr(),Un(_n),Ut}function gt(nt){var At=nt|0;if(At!==Ee.width){Ut.width=Ee.width=At,Ut.height=Ee.height=At,xs(Ee);for(var Le=0;Le<6;++Le)for(var lt=0;Ee.mipmask>>lt;++lt)H.texImage2D(Cl+Le,lt,Ee.format,At>>lt,At>>lt,0,Ee.format,Ee.type,null);return gr(),kr.profile&&(Ee.stats.size=Mu(Ee.internalformat,Ee.type,Ut.width,Ut.height,!1,!0)),Ut}}return Ut(Ye,dr,qt,ei,Ra,Ze),Ut.subimage=nr,Ut.resize=gt,Ut._reglType="textureCube",Ut._texture=Ee,kr.profile&&(Ut.stats=Ee.stats),Ut.destroy=function(){Ee.decRef()},Ut}function io(){for(var Ye=0;Ye<xu;++Ye)H.activeTexture(mf+Ye),H.bindTexture(wu,null),Qo[Ye]=null;ve(js).forEach(fu),ur.cubeCount=0,ur.textureCount=0}kr.profile&&(ur.getTotalTextureSize=function(){var Ye=0;return Object.keys(js).forEach(function(dr){Ye+=js[dr].stats.size}),Ye});function bs(){for(var Ye=0;Ye<xu;++Ye){var dr=Qo[Ye];dr&&(dr.bindCount=0,dr.unit=-1,Qo[Ye]=null)}ve(js).forEach(function(qt){qt.texture=H.createTexture(),H.bindTexture(qt.target,qt.texture);for(var ei=0;ei<32;++ei)if((qt.mipmask&1<<ei)!=0)if(qt.target===wu)H.texImage2D(wu,ei,qt.internalformat,qt.width>>ei,qt.height>>ei,0,qt.internalformat,qt.type,null);else for(var Ra=0;Ra<6;++Ra)H.texImage2D(Cl+Ra,ei,qt.internalformat,qt.width>>ei,qt.height>>ei,0,qt.internalformat,qt.type,null);_s(qt.texInfo,qt.target)})}function rf(){for(var Ye=0;Ye<xu;++Ye){var dr=Qo[Ye];dr&&(dr.bindCount=0,dr.unit=-1,Qo[Ye]=null),H.activeTexture(mf+Ye),H.bindTexture(wu,null),H.bindTexture(cf,null)}}return{create2D:Yi,createCube:wa,clear:io,getTexture:function(Ye){return null},restore:bs,refresh:rf}}var Ju=36161,Ei=32854,vi=32855,Wf=36194,zs=33189,hl=36168,$o=34041,Tl=35907,dh=34836,xf=34842,Za=34843,_o=[];_o[Ei]=2,_o[vi]=2,_o[Wf]=2,_o[zs]=2,_o[hl]=1,_o[$o]=4,_o[Tl]=4,_o[dh]=16,_o[xf]=8,_o[Za]=6;function vh(H,Pe,it){return _o[H]*Pe*it}var Xf=function(H,Pe,it,or,Br){var ur={rgba4:Ei,rgb565:Wf,"rgb5 a1":vi,depth:zs,stencil:hl,"depth stencil":$o};Pe.ext_srgb&&(ur.srgba=Tl),Pe.ext_color_buffer_half_float&&(ur.rgba16f=xf,ur.rgb16f=Za),Pe.webgl_color_buffer_float&&(ur.rgba32f=dh);var kr=[];Object.keys(ur).forEach(function(tn){var Ur=ur[tn];kr[Ur]=tn});var Gr=0,Kr={};function en(tn){this.id=Gr++,this.refCount=1,this.renderbuffer=tn,this.format=Ei,this.width=0,this.height=0,Br.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&sn(this)};function sn(tn){var Ur=tn.renderbuffer;V(Ur,"must not double destroy renderbuffer"),H.bindRenderbuffer(Ju,null),H.deleteRenderbuffer(Ur),tn.renderbuffer=null,tn.refCount=0,delete Kr[tn.id],or.renderbufferCount--}function dn(tn,Ur){var St=new en(H.createRenderbuffer());Kr[St.id]=St,or.renderbufferCount++;function mr(En,Vr){var Cn=0,Zn=0,Ii=Ei;if(typeof En=="object"&&En){var Mr=En;if("shape"in Mr){var wr=Mr.shape;V(Array.isArray(wr)&&wr.length>=2,"invalid renderbuffer shape"),Cn=wr[0]|0,Zn=wr[1]|0}else"radius"in Mr&&(Cn=Zn=Mr.radius|0),"width"in Mr&&(Cn=Mr.width|0),"height"in Mr&&(Zn=Mr.height|0);"format"in Mr&&(V.parameter(Mr.format,ur,"invalid renderbuffer format"),Ii=ur[Mr.format])}else typeof En=="number"?(Cn=En|0,typeof Vr=="number"?Zn=Vr|0:Zn=Cn):En?V.raise("invalid arguments to renderbuffer constructor"):Cn=Zn=1;if(V(Cn>0&&Zn>0&&Cn<=it.maxRenderbufferSize&&Zn<=it.maxRenderbufferSize,"invalid renderbuffer size"),!(Cn===St.width&&Zn===St.height&&Ii===St.format))return mr.width=St.width=Cn,mr.height=St.height=Zn,St.format=Ii,H.bindRenderbuffer(Ju,St.renderbuffer),H.renderbufferStorage(Ju,Ii,Cn,Zn),V(H.getError()===0,"invalid render buffer format"),Br.profile&&(St.stats.size=vh(St.format,St.width,St.height)),mr.format=kr[St.format],mr}function rn(En,Vr){var Cn=En|0,Zn=Vr|0||Cn;return Cn===St.width&&Zn===St.height||(V(Cn>0&&Zn>0&&Cn<=it.maxRenderbufferSize&&Zn<=it.maxRenderbufferSize,"invalid renderbuffer size"),mr.width=St.width=Cn,mr.height=St.height=Zn,H.bindRenderbuffer(Ju,St.renderbuffer),H.renderbufferStorage(Ju,St.format,Cn,Zn),V(H.getError()===0,"invalid render buffer format"),Br.profile&&(St.stats.size=vh(St.format,St.width,St.height))),mr}return mr(tn,Ur),mr.resize=rn,mr._reglType="renderbuffer",mr._renderbuffer=St,Br.profile&&(mr.stats=St.stats),mr.destroy=function(){St.decRef()},mr}Br.profile&&(or.getTotalRenderbufferSize=function(){var tn=0;return Object.keys(Kr).forEach(function(Ur){tn+=Kr[Ur].stats.size}),tn});function Fn(){ve(Kr).forEach(function(tn){tn.renderbuffer=H.createRenderbuffer(),H.bindRenderbuffer(Ju,tn.renderbuffer),H.renderbufferStorage(Ju,tn.format,tn.width,tn.height)}),H.bindRenderbuffer(Ju,null)}return{create:dn,clear:function(){ve(Kr).forEach(sn)},restore:Fn}},pl=36160,el=36161,$s=3553,dl=34069,Ul=36064,mh=36096,Go=36128,gh=33306,qh=36053,jc=36054,bf=36055,bc=36057,Zl=36061,vl=36193,Yf=5121,nc=5126,ml=6407,Gc=6408,yh=6402,_p=[ml,Gc],Ef=[];Ef[Gc]=4,Ef[ml]=3;var c=[];c[Yf]=1,c[nc]=4,c[vl]=2;var h=32854,f=32855,m=36194,S=33189,I=36168,P=34041,B=35907,Y=34836,te=34842,xe=34843,Ce=[h,f,m,B,te,xe,Y],Me={};Me[qh]="complete",Me[jc]="incomplete attachment",Me[bc]="incomplete dimensions",Me[bf]="incomplete, missing attachment",Me[Zl]="unsupported";function et(H,Pe,it,or,Br,ur){var kr={cur:null,next:null,dirty:!1,setFBO:null},Gr=["rgba"],Kr=["rgba4","rgb565","rgb5 a1"];Pe.ext_srgb&&Kr.push("srgba"),Pe.ext_color_buffer_half_float&&Kr.push("rgba16f","rgb16f"),Pe.webgl_color_buffer_float&&Kr.push("rgba32f");var en=["uint8"];Pe.oes_texture_half_float&&en.push("half float","float16"),Pe.oes_texture_float&&en.push("float","float32");function sn(un,Pn,Dn){this.target=un,this.texture=Pn,this.renderbuffer=Dn;var Qi=0,Fi=0;Pn?(Qi=Pn.width,Fi=Pn.height):Dn&&(Qi=Dn.width,Fi=Dn.height),this.width=Qi,this.height=Fi}function dn(un){un&&(un.texture&&un.texture._texture.decRef(),un.renderbuffer&&un.renderbuffer._renderbuffer.decRef())}function Fn(un,Pn,Dn){if(!!un)if(un.texture){var Qi=un.texture._texture,Fi=Math.max(1,Qi.width),Rn=Math.max(1,Qi.height);V(Fi===Pn&&Rn===Dn,"inconsistent width/height for supplied texture"),Qi.refCount+=1}else{var Un=un.renderbuffer._renderbuffer;V(Un.width===Pn&&Un.height===Dn,"inconsistent width/height for renderbuffer"),Un.refCount+=1}}function tn(un,Pn){Pn&&(Pn.texture?H.framebufferTexture2D(pl,un,Pn.target,Pn.texture._texture.texture,0):H.framebufferRenderbuffer(pl,un,el,Pn.renderbuffer._renderbuffer.renderbuffer))}function Ur(un){var Pn=$s,Dn=null,Qi=null,Fi=un;typeof un=="object"&&(Fi=un.data,"target"in un&&(Pn=un.target|0)),V.type(Fi,"function","invalid attachment data");var Rn=Fi._reglType;return Rn==="texture2d"?(Dn=Fi,V(Pn===$s)):Rn==="textureCube"?(Dn=Fi,V(Pn>=dl&&Pn<dl+6,"invalid cube map target")):Rn==="renderbuffer"?(Qi=Fi,Pn=el):V.raise("invalid regl object for attachment"),new sn(Pn,Dn,Qi)}function St(un,Pn,Dn,Qi,Fi){if(Dn){var Rn=or.create2D({width:un,height:Pn,format:Qi,type:Fi});return Rn._texture.refCount=0,new sn($s,Rn,null)}else{var Un=Br.create({width:un,height:Pn,format:Qi});return Un._renderbuffer.refCount=0,new sn(el,null,Un)}}function mr(un){return un&&(un.texture||un.renderbuffer)}function rn(un,Pn,Dn){un&&(un.texture?un.texture.resize(Pn,Dn):un.renderbuffer&&un.renderbuffer.resize(Pn,Dn),un.width=Pn,un.height=Dn)}var En=0,Vr={};function Cn(){this.id=En++,Vr[this.id]=this,this.framebuffer=H.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Zn(un){un.colorAttachments.forEach(dn),dn(un.depthAttachment),dn(un.stencilAttachment),dn(un.depthStencilAttachment)}function Ii(un){var Pn=un.framebuffer;V(Pn,"must not double destroy framebuffer"),H.deleteFramebuffer(Pn),un.framebuffer=null,ur.framebufferCount--,delete Vr[un.id]}function Mr(un){var Pn;H.bindFramebuffer(pl,un.framebuffer);var Dn=un.colorAttachments;for(Pn=0;Pn<Dn.length;++Pn)tn(Ul+Pn,Dn[Pn]);for(Pn=Dn.length;Pn<it.maxColorAttachments;++Pn)H.framebufferTexture2D(pl,Ul+Pn,$s,null,0);H.framebufferTexture2D(pl,gh,$s,null,0),H.framebufferTexture2D(pl,mh,$s,null,0),H.framebufferTexture2D(pl,Go,$s,null,0),tn(mh,un.depthAttachment),tn(Go,un.stencilAttachment),tn(gh,un.depthStencilAttachment);var Qi=H.checkFramebufferStatus(pl);!H.isContextLost()&&Qi!==qh&&V.raise("framebuffer configuration not supported, status = "+Me[Qi]),H.bindFramebuffer(pl,kr.next?kr.next.framebuffer:null),kr.cur=kr.next,H.getError()}function wr(un,Pn){var Dn=new Cn;ur.framebufferCount++;function Qi(Rn,Un){var Oi;V(kr.next!==Dn,"can not update framebuffer which is currently in use");var ta=0,Ma=0,No=!0,Ko=!0,Ea=null,Zs=!0,eo="rgba",Vs="uint8",_s=1,Js=null,js=null,xu=null,Qo=!1;if(typeof Rn=="number")ta=Rn|0,Ma=Un|0||ta;else if(!Rn)ta=Ma=1;else{V.type(Rn,"object","invalid arguments for framebuffer");var la=Rn;if("shape"in la){var xs=la.shape;V(Array.isArray(xs)&&xs.length>=2,"invalid shape for framebuffer"),ta=xs[0],Ma=xs[1]}else"radius"in la&&(ta=Ma=la.radius),"width"in la&&(ta=la.width),"height"in la&&(Ma=la.height);("color"in la||"colors"in la)&&(Ea=la.color||la.colors,Array.isArray(Ea)&&V(Ea.length===1||Pe.webgl_draw_buffers,"multiple render targets not supported")),Ea||("colorCount"in la&&(_s=la.colorCount|0,V(_s>0,"invalid color buffer count")),"colorTexture"in la&&(Zs=!!la.colorTexture,eo="rgba4"),"colorType"in la&&(Vs=la.colorType,Zs?(V(Pe.oes_texture_float||!(Vs==="float"||Vs==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),V(Pe.oes_texture_half_float||!(Vs==="half float"||Vs==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Vs==="half float"||Vs==="float16"?(V(Pe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),eo="rgba16f"):(Vs==="float"||Vs==="float32")&&(V(Pe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),eo="rgba32f"),V.oneOf(Vs,en,"invalid color type")),"colorFormat"in la&&(eo=la.colorFormat,Gr.indexOf(eo)>=0?Zs=!0:Kr.indexOf(eo)>=0?Zs=!1:V.optional(function(){Zs?V.oneOf(la.colorFormat,Gr,"invalid color format for texture"):V.oneOf(la.colorFormat,Kr,"invalid color format for renderbuffer")}))),("depthTexture"in la||"depthStencilTexture"in la)&&(Qo=!!(la.depthTexture||la.depthStencilTexture),V(!Qo||Pe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in la&&(typeof la.depth=="boolean"?No=la.depth:(Js=la.depth,Ko=!1)),"stencil"in la&&(typeof la.stencil=="boolean"?Ko=la.stencil:(js=la.stencil,No=!1)),"depthStencil"in la&&(typeof la.depthStencil=="boolean"?No=Ko=la.depthStencil:(xu=la.depthStencil,No=!1,Ko=!1))}var gr=null,fu=null,Yi=null,wa=null;if(Array.isArray(Ea))gr=Ea.map(Ur);else if(Ea)gr=[Ur(Ea)];else for(gr=new Array(_s),Oi=0;Oi<_s;++Oi)gr[Oi]=St(ta,Ma,Zs,eo,Vs);V(Pe.webgl_draw_buffers||gr.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),V(gr.length<=it.maxColorAttachments,"too many color attachments, not supported"),ta=ta||gr[0].width,Ma=Ma||gr[0].height,Js?fu=Ur(Js):No&&!Ko&&(fu=St(ta,Ma,Qo,"depth","uint32")),js?Yi=Ur(js):Ko&&!No&&(Yi=St(ta,Ma,!1,"stencil","uint8")),xu?wa=Ur(xu):!Js&&!js&&Ko&&No&&(wa=St(ta,Ma,Qo,"depth stencil","depth stencil")),V(!!Js+!!js+!!xu<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var io=null;for(Oi=0;Oi<gr.length;++Oi)if(Fn(gr[Oi],ta,Ma),V(!gr[Oi]||gr[Oi].texture&&_p.indexOf(gr[Oi].texture._texture.format)>=0||gr[Oi].renderbuffer&&Ce.indexOf(gr[Oi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Oi+" is invalid"),gr[Oi]&&gr[Oi].texture){var bs=Ef[gr[Oi].texture._texture.format]*c[gr[Oi].texture._texture.type];io===null?io=bs:V(io===bs,"all color attachments much have the same number of bits per pixel.")}return Fn(fu,ta,Ma),V(!fu||fu.texture&&fu.texture._texture.format===yh||fu.renderbuffer&&fu.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),Fn(Yi,ta,Ma),V(!Yi||Yi.renderbuffer&&Yi.renderbuffer._renderbuffer.format===I,"invalid stencil attachment for framebuffer object"),Fn(wa,ta,Ma),V(!wa||wa.texture&&wa.texture._texture.format===P||wa.renderbuffer&&wa.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),Zn(Dn),Dn.width=ta,Dn.height=Ma,Dn.colorAttachments=gr,Dn.depthAttachment=fu,Dn.stencilAttachment=Yi,Dn.depthStencilAttachment=wa,Qi.color=gr.map(mr),Qi.depth=mr(fu),Qi.stencil=mr(Yi),Qi.depthStencil=mr(wa),Qi.width=Dn.width,Qi.height=Dn.height,Mr(Dn),Qi}function Fi(Rn,Un){V(kr.next!==Dn,"can not resize a framebuffer which is currently in use");var Oi=Math.max(Rn|0,1),ta=Math.max(Un|0||Oi,1);if(Oi===Dn.width&&ta===Dn.height)return Qi;for(var Ma=Dn.colorAttachments,No=0;No<Ma.length;++No)rn(Ma[No],Oi,ta);return rn(Dn.depthAttachment,Oi,ta),rn(Dn.stencilAttachment,Oi,ta),rn(Dn.depthStencilAttachment,Oi,ta),Dn.width=Qi.width=Oi,Dn.height=Qi.height=ta,Mr(Dn),Qi}return Qi(un,Pn),y(Qi,{resize:Fi,_reglType:"framebuffer",_framebuffer:Dn,destroy:function(){Ii(Dn),Zn(Dn)},use:function(Rn){kr.setFBO({framebuffer:Qi},Rn)}})}function ci(un){var Pn=Array(6);function Dn(Fi){var Rn;V(Pn.indexOf(kr.next)<0,"can not update framebuffer which is currently in use");var Un={color:null},Oi=0,ta=null,Ma="rgba",No="uint8",Ko=1;if(typeof Fi=="number")Oi=Fi|0;else if(!Fi)Oi=1;else{V.type(Fi,"object","invalid arguments for framebuffer");var Ea=Fi;if("shape"in Ea){var Zs=Ea.shape;V(Array.isArray(Zs)&&Zs.length>=2,"invalid shape for framebuffer"),V(Zs[0]===Zs[1],"cube framebuffer must be square"),Oi=Zs[0]}else"radius"in Ea&&(Oi=Ea.radius|0),"width"in Ea?(Oi=Ea.width|0,"height"in Ea&&V(Ea.height===Oi,"must be square")):"height"in Ea&&(Oi=Ea.height|0);("color"in Ea||"colors"in Ea)&&(ta=Ea.color||Ea.colors,Array.isArray(ta)&&V(ta.length===1||Pe.webgl_draw_buffers,"multiple render targets not supported")),ta||("colorCount"in Ea&&(Ko=Ea.colorCount|0,V(Ko>0,"invalid color buffer count")),"colorType"in Ea&&(V.oneOf(Ea.colorType,en,"invalid color type"),No=Ea.colorType),"colorFormat"in Ea&&(Ma=Ea.colorFormat,V.oneOf(Ea.colorFormat,Gr,"invalid color format for texture"))),"depth"in Ea&&(Un.depth=Ea.depth),"stencil"in Ea&&(Un.stencil=Ea.stencil),"depthStencil"in Ea&&(Un.depthStencil=Ea.depthStencil)}var eo;if(ta)if(Array.isArray(ta))for(eo=[],Rn=0;Rn<ta.length;++Rn)eo[Rn]=ta[Rn];else eo=[ta];else{eo=Array(Ko);var Vs={radius:Oi,format:Ma,type:No};for(Rn=0;Rn<Ko;++Rn)eo[Rn]=or.createCube(Vs)}for(Un.color=Array(eo.length),Rn=0;Rn<eo.length;++Rn){var _s=eo[Rn];V(typeof _s=="function"&&_s._reglType==="textureCube","invalid cube map"),Oi=Oi||_s.width,V(_s.width===Oi&&_s.height===Oi,"invalid cube map shape"),Un.color[Rn]={target:dl,data:eo[Rn]}}for(Rn=0;Rn<6;++Rn){for(var Js=0;Js<eo.length;++Js)Un.color[Js].target=dl+Rn;Rn>0&&(Un.depth=Pn[0].depth,Un.stencil=Pn[0].stencil,Un.depthStencil=Pn[0].depthStencil),Pn[Rn]?Pn[Rn](Un):Pn[Rn]=wr(Un)}return y(Dn,{width:Oi,height:Oi,color:eo})}function Qi(Fi){var Rn,Un=Fi|0;if(V(Un>0&&Un<=it.maxCubeMapSize,"invalid radius for cube fbo"),Un===Dn.width)return Dn;var Oi=Dn.color;for(Rn=0;Rn<Oi.length;++Rn)Oi[Rn].resize(Un);for(Rn=0;Rn<6;++Rn)Pn[Rn].resize(Un);return Dn.width=Dn.height=Un,Dn}return Dn(un),y(Dn,{faces:Pn,resize:Qi,_reglType:"framebufferCube",destroy:function(){Pn.forEach(function(Fi){Fi.destroy()})}})}function Nn(){kr.cur=null,kr.next=null,kr.dirty=!0,ve(Vr).forEach(function(un){un.framebuffer=H.createFramebuffer(),Mr(un)})}return y(kr,{getFramebuffer:function(un){if(typeof un=="function"&&un._reglType==="framebuffer"){var Pn=un._framebuffer;if(Pn instanceof Cn)return Pn}return null},create:wr,createCube:ci,clear:function(){ve(Vr).forEach(Ii)},restore:Nn})}var Ne=5126,ct=34962,je=34963,ht=["attributes","elements","offset","count","primitive","instances"];function Et(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ne,this.offset=0,this.stride=0,this.divisor=0}function Wt(H,Pe,it,or,Br,ur,kr){for(var Gr=it.maxAttributes,Kr=new Array(Gr),en=0;en<Gr;++en)Kr[en]=new Et;var sn=0,dn={},Fn={Record:Et,scope:{},state:Kr,currentVAO:null,targetVAO:null,restore:Ur()?Zn:function(){},createVAO:Ii,getVAO:mr,destroyBuffer:tn,setVAO:Ur()?rn:En,clear:Ur()?Vr:function(){}};function tn(Mr){for(var wr=0;wr<Kr.length;++wr){var ci=Kr[wr];ci.buffer===Mr&&(H.disableVertexAttribArray(wr),ci.buffer=null)}}function Ur(){return Pe.oes_vertex_array_object}function St(){return Pe.angle_instanced_arrays}function mr(Mr){return typeof Mr=="function"&&Mr._vao?Mr._vao:null}function rn(Mr){if(Mr!==Fn.currentVAO){var wr=Ur();Mr?wr.bindVertexArrayOES(Mr.vao):wr.bindVertexArrayOES(null),Fn.currentVAO=Mr}}function En(Mr){if(Mr!==Fn.currentVAO){if(Mr)Mr.bindAttrs();else{for(var wr=St(),ci=0;ci<Kr.length;++ci){var Nn=Kr[ci];Nn.buffer?(H.enableVertexAttribArray(ci),Nn.buffer.bind(),H.vertexAttribPointer(ci,Nn.size,Nn.type,Nn.normalized,Nn.stride,Nn.offfset),wr&&Nn.divisor&&wr.vertexAttribDivisorANGLE(ci,Nn.divisor)):(H.disableVertexAttribArray(ci),H.vertexAttrib4f(ci,Nn.x,Nn.y,Nn.z,Nn.w))}kr.elements?H.bindBuffer(je,kr.elements.buffer.buffer):H.bindBuffer(je,null)}Fn.currentVAO=Mr}}function Vr(){ve(dn).forEach(function(Mr){Mr.destroy()})}function Cn(){this.id=++sn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Mr=Ur();Mr?this.vao=Mr.createVertexArrayOES():this.vao=null,dn[this.id]=this,this.buffers=[]}Cn.prototype.bindAttrs=function(){for(var Mr=St(),wr=this.attributes,ci=0;ci<wr.length;++ci){var Nn=wr[ci];Nn.buffer?(H.enableVertexAttribArray(ci),H.bindBuffer(ct,Nn.buffer.buffer),H.vertexAttribPointer(ci,Nn.size,Nn.type,Nn.normalized,Nn.stride,Nn.offset),Mr&&Nn.divisor&&Mr.vertexAttribDivisorANGLE(ci,Nn.divisor)):(H.disableVertexAttribArray(ci),H.vertexAttrib4f(ci,Nn.x,Nn.y,Nn.z,Nn.w))}for(var un=wr.length;un<Gr;++un)H.disableVertexAttribArray(un);var Pn=ur.getElements(this.elements);Pn?H.bindBuffer(je,Pn.buffer.buffer):H.bindBuffer(je,null)},Cn.prototype.refresh=function(){var Mr=Ur();Mr&&(Mr.bindVertexArrayOES(this.vao),this.bindAttrs(),Fn.currentVAO=null,Mr.bindVertexArrayOES(null))},Cn.prototype.destroy=function(){if(this.vao){var Mr=Ur();this===Fn.currentVAO&&(Fn.currentVAO=null,Mr.bindVertexArrayOES(null)),Mr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),dn[this.id]&&(delete dn[this.id],or.vaoCount-=1)};function Zn(){var Mr=Ur();Mr&&ve(dn).forEach(function(wr){wr.refresh()})}function Ii(Mr){var wr=new Cn;or.vaoCount+=1;function ci(Nn){var un;if(Array.isArray(Nn))un=Nn,wr.elements&&wr.ownsElements&&wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1,wr.offset=0,wr.count=0,wr.instances=-1,wr.primitive=4;else{if(V(typeof Nn=="object","invalid arguments for create vao"),V("attributes"in Nn,"must specify attributes for vao"),Nn.elements){var Pn=Nn.elements;wr.ownsElements?typeof Pn=="function"&&Pn._reglType==="elements"?(wr.elements.destroy(),wr.ownsElements=!1):(wr.elements(Pn),wr.ownsElements=!1):ur.getElements(Nn.elements)?(wr.elements=Nn.elements,wr.ownsElements=!1):(wr.elements=ur.create(Nn.elements),wr.ownsElements=!0)}else wr.elements=null,wr.ownsElements=!1;un=Nn.attributes,wr.offset=0,wr.count=-1,wr.instances=-1,wr.primitive=4,wr.elements&&(wr.count=wr.elements._elements.vertCount,wr.primitive=wr.elements._elements.primType),"offset"in Nn&&(wr.offset=Nn.offset|0),"count"in Nn&&(wr.count=Nn.count|0),"instances"in Nn&&(wr.instances=Nn.instances|0),"primitive"in Nn&&(V(Nn.primitive in Nr,"bad primitive type: "+Nn.primitive),wr.primitive=Nr[Nn.primitive]),V.optional(function(){for(var No=Object.keys(Nn),Ko=0;Ko<No.length;++Ko)V(ht.indexOf(No[Ko])>=0,'invalid option for vao: "'+No[Ko]+'" valid options are '+ht)}),V(Array.isArray(un),"attributes must be an array")}V(un.length<Gr,"too many attributes"),V(un.length>0,"must specify at least one attribute");var Dn={},Qi=wr.attributes;Qi.length=un.length;for(var Fi=0;Fi<un.length;++Fi){var Rn=un[Fi],Un=Qi[Fi]=new Et,Oi=Rn.data||Rn;if(Array.isArray(Oi)||de(Oi)||rs(Oi)){var ta;wr.buffers[Fi]&&(ta=wr.buffers[Fi],de(Oi)&&ta._buffer.byteLength>=Oi.byteLength?ta.subdata(Oi):(ta.destroy(),wr.buffers[Fi]=null)),wr.buffers[Fi]||(ta=wr.buffers[Fi]=Br.create(Rn,ct,!1,!0)),Un.buffer=Br.getBuffer(ta),Un.size=Un.buffer.dimension|0,Un.normalized=!1,Un.type=Un.buffer.dtype,Un.offset=0,Un.stride=0,Un.divisor=0,Un.state=1,Dn[Fi]=1}else Br.getBuffer(Rn)?(Un.buffer=Br.getBuffer(Rn),Un.size=Un.buffer.dimension|0,Un.normalized=!1,Un.type=Un.buffer.dtype,Un.offset=0,Un.stride=0,Un.divisor=0,Un.state=1):Br.getBuffer(Rn.buffer)?(Un.buffer=Br.getBuffer(Rn.buffer),Un.size=(+Rn.size||Un.buffer.dimension)|0,Un.normalized=!!Rn.normalized||!1,"type"in Rn?(V.parameter(Rn.type,Cu,"invalid buffer type"),Un.type=Cu[Rn.type]):Un.type=Un.buffer.dtype,Un.offset=(Rn.offset||0)|0,Un.stride=(Rn.stride||0)|0,Un.divisor=(Rn.divisor||0)|0,Un.state=1,V(Un.size>=1&&Un.size<=4,"size must be between 1 and 4"),V(Un.offset>=0,"invalid offset"),V(Un.stride>=0&&Un.stride<=255,"stride must be between 0 and 255"),V(Un.divisor>=0,"divisor must be positive"),V(!Un.divisor||!!Pe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Rn?(V(Fi>0,"first attribute must not be a constant"),Un.x=+Rn.x||0,Un.y=+Rn.y||0,Un.z=+Rn.z||0,Un.w=+Rn.w||0,Un.state=2):V(!1,"invalid attribute spec for location "+Fi)}for(var Ma=0;Ma<wr.buffers.length;++Ma)!Dn[Ma]&&wr.buffers[Ma]&&(wr.buffers[Ma].destroy(),wr.buffers[Ma]=null);return wr.refresh(),ci}return ci.destroy=function(){for(var Nn=0;Nn<wr.buffers.length;++Nn)wr.buffers[Nn]&&wr.buffers[Nn].destroy();wr.buffers.length=0,wr.ownsElements&&(wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1),wr.destroy()},ci._vao=wr,ci._reglType="vao",ci(Mr)}return Fn}var vr=35632,rr=35633,Ar=35718,Xr=35721;function bn(H,Pe,it,or){var Br={},ur={};function kr(St,mr,rn,En){this.name=St,this.id=mr,this.location=rn,this.info=En}function Gr(St,mr){for(var rn=0;rn<St.length;++rn)if(St[rn].id===mr.id){St[rn].location=mr.location;return}St.push(mr)}function Kr(St,mr,rn){var En=St===vr?Br:ur,Vr=En[mr];if(!Vr){var Cn=Pe.str(mr);Vr=H.createShader(St),H.shaderSource(Vr,Cn),H.compileShader(Vr),V.shaderError(H,Vr,Cn,St,rn),En[mr]=Vr}return Vr}var en={},sn=[],dn=0;function Fn(St,mr){this.id=dn++,this.fragId=St,this.vertId=mr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,or.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function tn(St,mr,rn){var En,Vr,Cn=Kr(vr,St.fragId),Zn=Kr(rr,St.vertId),Ii=St.program=H.createProgram();if(H.attachShader(Ii,Cn),H.attachShader(Ii,Zn),rn)for(En=0;En<rn.length;++En){var Mr=rn[En];H.bindAttribLocation(Ii,Mr[0],Mr[1])}H.linkProgram(Ii),V.linkError(H,Ii,Pe.str(St.fragId),Pe.str(St.vertId),mr);var wr=H.getProgramParameter(Ii,Ar);or.profile&&(St.stats.uniformsCount=wr);var ci=St.uniforms;for(En=0;En<wr;++En)if(Vr=H.getActiveUniform(Ii,En),Vr)if(Vr.size>1)for(var Nn=0;Nn<Vr.size;++Nn){var un=Vr.name.replace("[0]","["+Nn+"]");Gr(ci,new kr(un,Pe.id(un),H.getUniformLocation(Ii,un),Vr))}else Gr(ci,new kr(Vr.name,Pe.id(Vr.name),H.getUniformLocation(Ii,Vr.name),Vr));var Pn=H.getProgramParameter(Ii,Xr);or.profile&&(St.stats.attributesCount=Pn);var Dn=St.attributes;for(En=0;En<Pn;++En)Vr=H.getActiveAttrib(Ii,En),Vr&&Gr(Dn,new kr(Vr.name,Pe.id(Vr.name),H.getAttribLocation(Ii,Vr.name),Vr))}or.profile&&(it.getMaxUniformsCount=function(){var St=0;return sn.forEach(function(mr){mr.stats.uniformsCount>St&&(St=mr.stats.uniformsCount)}),St},it.getMaxAttributesCount=function(){var St=0;return sn.forEach(function(mr){mr.stats.attributesCount>St&&(St=mr.stats.attributesCount)}),St});function Ur(){Br={},ur={};for(var St=0;St<sn.length;++St)tn(sn[St],null,sn[St].attributes.map(function(mr){return[mr.location,mr.name]}))}return{clear:function(){var St=H.deleteShader.bind(H);ve(Br).forEach(St),Br={},ve(ur).forEach(St),ur={},sn.forEach(function(mr){H.deleteProgram(mr.program)}),sn.length=0,en={},it.shaderCount=0},program:function(St,mr,rn,En){V.command(St>=0,"missing vertex shader",rn),V.command(mr>=0,"missing fragment shader",rn);var Vr=en[mr];Vr||(Vr=en[mr]={});var Cn=Vr[St];if(Cn&&(Cn.refCount++,!En))return Cn;var Zn=new Fn(mr,St);return it.shaderCount++,tn(Zn,rn,En),Cn||(Vr[St]=Zn),sn.push(Zn),y(Zn,{destroy:function(){if(Zn.refCount--,Zn.refCount<=0){H.deleteProgram(Zn.program);var Ii=sn.indexOf(Zn);sn.splice(Ii,1),it.shaderCount--}Vr[Zn.vertId].refCount<=0&&(H.deleteShader(ur[Zn.vertId]),delete ur[Zn.vertId],delete en[Zn.fragId][Zn.vertId]),Object.keys(en[Zn.fragId]).length||(H.deleteShader(Br[Zn.fragId]),delete Br[Zn.fragId],delete en[Zn.fragId])}})},restore:Ur,shader:Kr,frag:-1,vert:-1}}var pn=6408,Vn=5121,bi=3333,Ti=5126;function Ai(H,Pe,it,or,Br,ur,kr){function Gr(sn){var dn;Pe.next===null?(V(Br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),dn=Vn):(V(Pe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),dn=Pe.next.colorAttachments[0].texture._texture.type,V.optional(function(){ur.oes_texture_float?(V(dn===Vn||dn===Ti,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),dn===Ti&&V(kr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):V(dn===Vn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Fn=0,tn=0,Ur=or.framebufferWidth,St=or.framebufferHeight,mr=null;de(sn)?mr=sn:sn&&(V.type(sn,"object","invalid arguments to regl.read()"),Fn=sn.x|0,tn=sn.y|0,V(Fn>=0&&Fn<or.framebufferWidth,"invalid x offset for regl.read"),V(tn>=0&&tn<or.framebufferHeight,"invalid y offset for regl.read"),Ur=(sn.width||or.framebufferWidth-Fn)|0,St=(sn.height||or.framebufferHeight-tn)|0,mr=sn.data||null),mr&&(dn===Vn?V(mr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):dn===Ti&&V(mr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),V(Ur>0&&Ur+Fn<=or.framebufferWidth,"invalid width for read pixels"),V(St>0&&St+tn<=or.framebufferHeight,"invalid height for read pixels"),it();var rn=Ur*St*4;return mr||(dn===Vn?mr=new Uint8Array(rn):dn===Ti&&(mr=mr||new Float32Array(rn))),V.isTypedArray(mr,"data buffer for regl.read() must be a typedarray"),V(mr.byteLength>=rn,"data buffer for regl.read() too small"),H.pixelStorei(bi,4),H.readPixels(Fn,tn,Ur,St,pn,dn,mr),mr}function Kr(sn){var dn;return Pe.setFBO({framebuffer:sn.framebuffer},function(){dn=Gr(sn)}),dn}function en(sn){return!sn||!("framebuffer"in sn)?Gr(sn):Kr(sn)}return en}function ba(H){return Array.prototype.slice.call(H)}function Wn(H){return ba(H).join("")}function Wi(){var H=0,Pe=[],it=[];function or(dn){for(var Fn=0;Fn<it.length;++Fn)if(it[Fn]===dn)return Pe[Fn];var tn="g"+H++;return Pe.push(tn),it.push(dn),tn}function Br(){var dn=[];function Fn(){dn.push.apply(dn,ba(arguments))}var tn=[];function Ur(){var St="v"+H++;return tn.push(St),arguments.length>0&&(dn.push(St,"="),dn.push.apply(dn,ba(arguments)),dn.push(";")),St}return y(Fn,{def:Ur,toString:function(){return Wn([tn.length>0?"var "+tn.join(",")+";":"",Wn(dn)])}})}function ur(){var dn=Br(),Fn=Br(),tn=dn.toString,Ur=Fn.toString;function St(mr,rn){Fn(mr,rn,"=",dn.def(mr,rn),";")}return y(function(){dn.apply(dn,ba(arguments))},{def:dn.def,entry:dn,exit:Fn,save:St,set:function(mr,rn,En){St(mr,rn),dn(mr,rn,"=",En,";")},toString:function(){return tn()+Ur()}})}function kr(){var dn=Wn(arguments),Fn=ur(),tn=ur(),Ur=Fn.toString,St=tn.toString;return y(Fn,{then:function(){return Fn.apply(Fn,ba(arguments)),this},else:function(){return tn.apply(tn,ba(arguments)),this},toString:function(){var mr=St();return mr&&(mr="else{"+mr+"}"),Wn(["if(",dn,"){",Ur(),"}",mr])}})}var Gr=Br(),Kr={};function en(dn,Fn){var tn=[];function Ur(){var Vr="a"+tn.length;return tn.push(Vr),Vr}Fn=Fn||0;for(var St=0;St<Fn;++St)Ur();var mr=ur(),rn=mr.toString,En=Kr[dn]=y(mr,{arg:Ur,toString:function(){return Wn(["function(",tn.join(),"){",rn(),"}"])}});return En}function sn(){var dn=['"use strict";',Gr,"return {"];Object.keys(Kr).forEach(function(St){dn.push('"',St,'":',Kr[St].toString(),",")}),dn.push("}");var Fn=Wn(dn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),tn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ur=tn?We.Function.apply(null,Pe.concat(Fn)):Function.apply(null,Pe.concat(Fn));return Ur.apply(null,it)}return{global:Gr,link:or,block:Br,proc:en,scope:ur,cond:kr,compile:sn}}var na="xyzw".split(""),Xi=5121,Pi=1,ia=2,zi=0,Li=1,vs=2,fo=3,Ho=4,Us=5,Bo=6,Wo="dither",ou="blend.enable",su="blend.color",Ms="blend.equation",ms="blend.func",Vl="depth.enable",Ou="depth.func",Cf="depth.range",Ml="depth.mask",Il="colorMask",Ec="cull.enable",Hc="cull.face",jl="frontFace",Wc="lineWidth",gl="polygonOffset.enable",gs="polygonOffset.offset",uu="sample.alpha",Gl="sample.enable",ic="sample.coverage",Va="stencil.enable",_u="stencil.mask",lu="stencil.func",Cc="stencil.opFront",_h="stencil.opBack",Sf="scissor.enable",Xc="scissor.box",Ks="viewport",xh="profile",tl="framebuffer",Yc="vert",bh="frag",ac="elements",Xo="primitive",qf="count",Iu="offset",Sc="instances",qc="vao",$h="Width",xp="Height",Af=tl+$h,Fu=tl+xp,ye=Ks+$h,cn=Ks+xp,Hl="drawingBuffer",Kh=Hl+$h,Po=Hl+xp,ku=[ms,Ms,lu,Cc,_h,ic,Ks,Xc,gs],Ac=34962,Eh=34963,wf=35632,$f=35633,oc=3553,yd=34067,Tf=2884,$c=3042,bp=3024,ps=2960,Ki=2929,qd=3089,qp=32823,wc=32926,Qh=32928,Kc=5126,Ch=35664,kl=35665,Jh=35666,Ep=5124,rl=35667,Kf=35668,$p=35669,Cp=35670,Kp=35671,ep=35672,Mf=35673,Qs=35674,If=35675,Sh=35676,Ah=35678,Qc=35680,nl=4,Tc=1028,Wl=1029,Qp=2304,Du=2305,sc=32775,tp=32776,kf=519,cu=7680,Sp=0,Qf=1,Jf=32774,uc=513,$d=36160,Kd=36064,Mc={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},wh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Jc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ef={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},_d={frag:wf,vert:$f},xd={cw:Qp,ccw:Du};function Jp(H){return Array.isArray(H)||de(H)||rs(H)}function rp(H){return H.sort(function(Pe,it){return Pe===Ks?-1:it===Ks?1:Pe<it?-1:1})}function ua(H,Pe,it,or){this.thisDep=H,this.contextDep=Pe,this.propDep=it,this.append=or}function Bu(H){return H&&!(H.thisDep||H.contextDep||H.propDep)}function ys(H){return new ua(!1,!1,!1,H)}function Nu(H,Pe){var it=H.type;if(it===zi){var or=H.data.length;return new ua(!0,or>=1,or>=2,Pe)}else if(it===Ho){var Br=H.data;return new ua(Br.thisDep,Br.contextDep,Br.propDep,Pe)}else{if(it===Us)return new ua(!1,!1,!1,Pe);if(it===Bo){for(var ur=!1,kr=!1,Gr=!1,Kr=0;Kr<H.data.length;++Kr){var en=H.data[Kr];if(en.type===Li)Gr=!0;else if(en.type===vs)kr=!0;else if(en.type===fo)ur=!0;else if(en.type===zi){ur=!0;var sn=en.data;sn>=1&&(kr=!0),sn>=2&&(Gr=!0)}else en.type===Ho&&(ur=ur||en.data.thisDep,kr=kr||en.data.contextDep,Gr=Gr||en.data.propDep)}return new ua(ur,kr,Gr,Pe)}else return new ua(it===fo,it===vs,it===Li,Pe)}}var tf=new ua(!1,!1,!1,function(){});function bd(H,Pe,it,or,Br,ur,kr,Gr,Kr,en,sn,dn,Fn,tn,Ur){var St=en.Record,mr={add:32774,subtract:32778,"reverse subtract":32779};it.ext_blend_minmax&&(mr.min=sc,mr.max=tp);var rn=it.angle_instanced_arrays,En=it.webgl_draw_buffers,Vr=it.oes_vertex_array_object,Cn={dirty:!0,profile:Ur.profile},Zn={},Ii=[],Mr={},wr={};function ci(Ze){return Ze.replace(".","_")}function Nn(Ze,Ee,ft){var Ut=ci(Ze);Ii.push(Ze),Zn[Ut]=Cn[Ut]=!!ft,Mr[Ut]=Ee}function un(Ze,Ee,ft){var Ut=ci(Ze);Ii.push(Ze),Array.isArray(ft)?(Cn[Ut]=ft.slice(),Zn[Ut]=ft.slice()):Cn[Ut]=Zn[Ut]=ft,wr[Ut]=Ee}Nn(Wo,bp),Nn(ou,$c),un(su,"blendColor",[0,0,0,0]),un(Ms,"blendEquationSeparate",[Jf,Jf]),un(ms,"blendFuncSeparate",[Qf,Sp,Qf,Sp]),Nn(Vl,Ki,!0),un(Ou,"depthFunc",uc),un(Cf,"depthRange",[0,1]),un(Ml,"depthMask",!0),un(Il,Il,[!0,!0,!0,!0]),Nn(Ec,Tf),un(Hc,"cullFace",Wl),un(jl,jl,Du),un(Wc,Wc,1),Nn(gl,qp),un(gs,"polygonOffset",[0,0]),Nn(uu,wc),Nn(Gl,Qh),un(ic,"sampleCoverage",[1,!1]),Nn(Va,ps),un(_u,"stencilMask",-1),un(lu,"stencilFunc",[kf,0,-1]),un(Cc,"stencilOpSeparate",[Tc,cu,cu,cu]),un(_h,"stencilOpSeparate",[Wl,cu,cu,cu]),Nn(Sf,qd),un(Xc,"scissor",[0,0,H.drawingBufferWidth,H.drawingBufferHeight]),un(Ks,Ks,[0,0,H.drawingBufferWidth,H.drawingBufferHeight]);var Pn={gl:H,context:Fn,strings:Pe,next:Zn,current:Cn,draw:dn,elements:ur,buffer:Br,shader:sn,attributes:en.state,vao:en,uniforms:Kr,framebuffer:Gr,extensions:it,timer:tn,isBufferArgs:Jp},Dn={primTypes:Nr,compareFuncs:Jc,blendFuncs:Mc,blendEquations:mr,stencilOps:ef,glTypes:Cu,orientationType:xd};V.optional(function(){Pn.isArrayLike=Vo}),En&&(Dn.backBuffer=[Wl],Dn.drawBuffer=ot(or.maxDrawbuffers,function(Ze){return Ze===0?[0]:ot(Ze,function(Ee){return Kd+Ee})}));var Qi=0;function Fi(){var Ze=Wi(),Ee=Ze.link,ft=Ze.global;Ze.id=Qi++,Ze.batchId="0";var Ut=Ee(Pn),nr=Ze.shared={props:"a0"};Object.keys(Pn).forEach(function(lt){nr[lt]=ft.def(Ut,".",lt)}),V.optional(function(){Ze.CHECK=Ee(V),Ze.commandStr=V.guessCommand(),Ze.command=Ee(Ze.commandStr),Ze.assert=function(lt,Ge,zt){lt("if(!(",Ge,"))",this.CHECK,".commandRaise(",Ee(zt),",",this.command,");")},Dn.invalidBlendCombinations=wh});var gt=Ze.next={},nt=Ze.current={};Object.keys(wr).forEach(function(lt){Array.isArray(Cn[lt])&&(gt[lt]=ft.def(nr.next,".",lt),nt[lt]=ft.def(nr.current,".",lt))});var At=Ze.constants={};Object.keys(Dn).forEach(function(lt){At[lt]=ft.def(JSON.stringify(Dn[lt]))}),Ze.invoke=function(lt,Ge){switch(Ge.type){case zi:var zt=["this",nr.context,nr.props,Ze.batchId];return lt.def(Ee(Ge.data),".call(",zt.slice(0,Math.max(Ge.data.length+1,4)),")");case Li:return lt.def(nr.props,Ge.data);case vs:return lt.def(nr.context,Ge.data);case fo:return lt.def("this",Ge.data);case Ho:return Ge.data.append(Ze,lt),Ge.data.ref;case Us:return Ge.data.toString();case Bo:return Ge.data.map(function($t){return Ze.invoke(lt,$t)})}},Ze.attribCache={};var Le={};return Ze.scopeAttrib=function(lt){var Ge=Pe.id(lt);if(Ge in Le)return Le[Ge];var zt=en.scope[Ge];zt||(zt=en.scope[Ge]=new St);var $t=Le[Ge]=Ee(zt);return $t},Ze}function Rn(Ze){var Ee=Ze.static,ft=Ze.dynamic,Ut;if(xh in Ee){var nr=!!Ee[xh];Ut=ys(function(nt,At){return nr}),Ut.enable=nr}else if(xh in ft){var gt=ft[xh];Ut=Nu(gt,function(nt,At){return nt.invoke(At,gt)})}return Ut}function Un(Ze,Ee){var ft=Ze.static,Ut=Ze.dynamic;if(tl in ft){var nr=ft[tl];return nr?(nr=Gr.getFramebuffer(nr),V.command(nr,"invalid framebuffer object"),ys(function(nt,At){var Le=nt.link(nr),lt=nt.shared;At.set(lt.framebuffer,".next",Le);var Ge=lt.context;return At.set(Ge,"."+Af,Le+".width"),At.set(Ge,"."+Fu,Le+".height"),Le})):ys(function(nt,At){var Le=nt.shared;At.set(Le.framebuffer,".next","null");var lt=Le.context;return At.set(lt,"."+Af,lt+"."+Kh),At.set(lt,"."+Fu,lt+"."+Po),"null"})}else if(tl in Ut){var gt=Ut[tl];return Nu(gt,function(nt,At){var Le=nt.invoke(At,gt),lt=nt.shared,Ge=lt.framebuffer,zt=At.def(Ge,".getFramebuffer(",Le,")");V.optional(function(){nt.assert(At,"!"+Le+"||"+zt,"invalid framebuffer object")}),At.set(Ge,".next",zt);var $t=lt.context;return At.set($t,"."+Af,zt+"?"+zt+".width:"+$t+"."+Kh),At.set($t,"."+Fu,zt+"?"+zt+".height:"+$t+"."+Po),zt})}else return null}function Oi(Ze,Ee,ft){var Ut=Ze.static,nr=Ze.dynamic;function gt(Le){if(Le in Ut){var lt=Ut[Le];V.commandType(lt,"object","invalid "+Le,ft.commandStr);var Ge=!0,zt=lt.x|0,$t=lt.y|0,jr,_n;return"width"in lt?(jr=lt.width|0,V.command(jr>=0,"invalid "+Le,ft.commandStr)):Ge=!1,"height"in lt?(_n=lt.height|0,V.command(_n>=0,"invalid "+Le,ft.commandStr)):Ge=!1,new ua(!Ge&&Ee&&Ee.thisDep,!Ge&&Ee&&Ee.contextDep,!Ge&&Ee&&Ee.propDep,function(vn,ti){var Yn=vn.shared.context,ai=jr;"width"in lt||(ai=ti.def(Yn,".",Af,"-",zt));var oi=_n;return"height"in lt||(oi=ti.def(Yn,".",Fu,"-",$t)),[zt,$t,ai,oi]})}else if(Le in nr){var Ln=nr[Le],jn=Nu(Ln,function(vn,ti){var Yn=vn.invoke(ti,Ln);V.optional(function(){vn.assert(ti,Yn+"&&typeof "+Yn+'==="object"',"invalid "+Le)});var ai=vn.shared.context,oi=ti.def(Yn,".x|0"),qn=ti.def(Yn,".y|0"),Ui=ti.def('"width" in ',Yn,"?",Yn,".width|0:","(",ai,".",Af,"-",oi,")"),po=ti.def('"height" in ',Yn,"?",Yn,".height|0:","(",ai,".",Fu,"-",qn,")");return V.optional(function(){vn.assert(ti,Ui+">=0&&"+po+">=0","invalid "+Le)}),[oi,qn,Ui,po]});return Ee&&(jn.thisDep=jn.thisDep||Ee.thisDep,jn.contextDep=jn.contextDep||Ee.contextDep,jn.propDep=jn.propDep||Ee.propDep),jn}else return Ee?new ua(Ee.thisDep,Ee.contextDep,Ee.propDep,function(vn,ti){var Yn=vn.shared.context;return[0,0,ti.def(Yn,".",Af),ti.def(Yn,".",Fu)]}):null}var nt=gt(Ks);if(nt){var At=nt;nt=new ua(nt.thisDep,nt.contextDep,nt.propDep,function(Le,lt){var Ge=At.append(Le,lt),zt=Le.shared.context;return lt.set(zt,"."+ye,Ge[2]),lt.set(zt,"."+cn,Ge[3]),Ge})}return{viewport:nt,scissor_box:gt(Xc)}}function ta(Ze,Ee){var ft=Ze.static,Ut=typeof ft[bh]=="string"&&typeof ft[Yc]=="string";if(Ut){if(Object.keys(Ee.dynamic).length>0)return null;var nr=Ee.static,gt=Object.keys(nr);if(gt.length>0&&typeof nr[gt[0]]=="number"){for(var nt=[],At=0;At<gt.length;++At)V(typeof nr[gt[At]]=="number","must specify all vertex attribute locations when using vaos"),nt.push([nr[gt[At]]|0,gt[At]]);return nt}}return null}function Ma(Ze,Ee,ft){var Ut=Ze.static,nr=Ze.dynamic;function gt(Ge){if(Ge in Ut){var zt=Pe.id(Ut[Ge]);V.optional(function(){sn.shader(_d[Ge],zt,V.guessCommand())});var $t=ys(function(){return zt});return $t.id=zt,$t}else if(Ge in nr){var jr=nr[Ge];return Nu(jr,function(_n,Ln){var jn=_n.invoke(Ln,jr),vn=Ln.def(_n.shared.strings,".id(",jn,")");return V.optional(function(){Ln(_n.shared.shader,".shader(",_d[Ge],",",vn,",",_n.command,");")}),vn})}return null}var nt=gt(bh),At=gt(Yc),Le=null,lt;return Bu(nt)&&Bu(At)?(Le=sn.program(At.id,nt.id,null,ft),lt=ys(function(Ge,zt){return Ge.link(Le)})):lt=new ua(nt&&nt.thisDep||At&&At.thisDep,nt&&nt.contextDep||At&&At.contextDep,nt&&nt.propDep||At&&At.propDep,function(Ge,zt){var $t=Ge.shared.shader,jr;nt?jr=nt.append(Ge,zt):jr=zt.def($t,".",bh);var _n;At?_n=At.append(Ge,zt):_n=zt.def($t,".",Yc);var Ln=$t+".program("+_n+","+jr;return V.optional(function(){Ln+=","+Ge.command}),zt.def(Ln+")")}),{frag:nt,vert:At,progVar:lt,program:Le}}function No(Ze,Ee){var ft=Ze.static,Ut=Ze.dynamic,nr={},gt=!1;function nt(){if(qc in ft){var ti=ft[qc];return ti!==null&&en.getVAO(ti)===null&&(ti=en.createVAO(ti)),gt=!0,nr.vao=ti,ys(function(ai){var oi=en.getVAO(ti);return oi?ai.link(oi):"null"})}else if(qc in Ut){gt=!0;var Yn=Ut[qc];return Nu(Yn,function(ai,oi){var qn=ai.invoke(oi,Yn);return oi.def(ai.shared.vao+".getVAO("+qn+")")})}return null}var At=nt(),Le=!1;function lt(){if(ac in ft){var ti=ft[ac];if(nr.elements=ti,Jp(ti)){var Yn=nr.elements=ur.create(ti,!0);ti=ur.getElements(Yn),Le=!0}else ti&&(ti=ur.getElements(ti),Le=!0,V.command(ti,"invalid elements",Ee.commandStr));var ai=ys(function(qn,Ui){if(ti){var po=qn.link(ti);return qn.ELEMENTS=po,po}return qn.ELEMENTS=null,null});return ai.value=ti,ai}else if(ac in Ut){Le=!0;var oi=Ut[ac];return Nu(oi,function(qn,Ui){var po=qn.shared,eu=po.isBufferArgs,vo=po.elements,uo=qn.invoke(Ui,oi),xn=Ui.def("null"),zu=Ui.def(eu,"(",uo,")"),hr=qn.cond(zu).then(xn,"=",vo,".createStream(",uo,");").else(xn,"=",vo,".getElements(",uo,");");return V.optional(function(){qn.assert(hr.else,"!"+uo+"||"+xn,"invalid elements")}),Ui.entry(hr),Ui.exit(qn.cond(zu).then(vo,".destroyStream(",xn,");")),qn.ELEMENTS=xn,xn})}else if(gt)return new ua(At.thisDep,At.contextDep,At.propDep,function(qn,Ui){return Ui.def(qn.shared.vao+".currentVAO?"+qn.shared.elements+".getElements("+qn.shared.vao+".currentVAO.elements):null")});return null}var Ge=lt();function zt(){if(Xo in ft){var ti=ft[Xo];return nr.primitive=ti,V.commandParameter(ti,Nr,"invalid primitve",Ee.commandStr),ys(function(ai,oi){return Nr[ti]})}else if(Xo in Ut){var Yn=Ut[Xo];return Nu(Yn,function(ai,oi){var qn=ai.constants.primTypes,Ui=ai.invoke(oi,Yn);return V.optional(function(){ai.assert(oi,Ui+" in "+qn,"invalid primitive, must be one of "+Object.keys(Nr))}),oi.def(qn,"[",Ui,"]")})}else{if(Le)return Bu(Ge)?Ge.value?ys(function(ai,oi){return oi.def(ai.ELEMENTS,".primType")}):ys(function(){return nl}):new ua(Ge.thisDep,Ge.contextDep,Ge.propDep,function(ai,oi){var qn=ai.ELEMENTS;return oi.def(qn,"?",qn,".primType:",nl)});if(gt)return new ua(At.thisDep,At.contextDep,At.propDep,function(ai,oi){return oi.def(ai.shared.vao+".currentVAO?"+ai.shared.vao+".currentVAO.primitive:"+nl)})}return null}function $t(ti,Yn){if(ti in ft){var ai=ft[ti]|0;return Yn?nr.offset=ai:nr.instances=ai,V.command(!Yn||ai>=0,"invalid "+ti,Ee.commandStr),ys(function(qn,Ui){return Yn&&(qn.OFFSET=ai),ai})}else if(ti in Ut){var oi=Ut[ti];return Nu(oi,function(qn,Ui){var po=qn.invoke(Ui,oi);return Yn&&(qn.OFFSET=po,V.optional(function(){qn.assert(Ui,po+">=0","invalid "+ti)})),po})}else if(Yn){if(Le)return ys(function(qn,Ui){return qn.OFFSET=0,0});if(gt)return new ua(At.thisDep,At.contextDep,At.propDep,function(qn,Ui){return Ui.def(qn.shared.vao+".currentVAO?"+qn.shared.vao+".currentVAO.offset:0")})}else if(gt)return new ua(At.thisDep,At.contextDep,At.propDep,function(qn,Ui){return Ui.def(qn.shared.vao+".currentVAO?"+qn.shared.vao+".currentVAO.instances:-1")});return null}var jr=$t(Iu,!0);function _n(){if(qf in ft){var ti=ft[qf]|0;return nr.count=ti,V.command(typeof ti=="number"&&ti>=0,"invalid vertex count",Ee.commandStr),ys(function(){return ti})}else if(qf in Ut){var Yn=Ut[qf];return Nu(Yn,function(Ui,po){var eu=Ui.invoke(po,Yn);return V.optional(function(){Ui.assert(po,"typeof "+eu+'==="number"&&'+eu+">=0&&"+eu+"===("+eu+"|0)","invalid vertex count")}),eu})}else if(Le)if(Bu(Ge)){if(Ge)return jr?new ua(jr.thisDep,jr.contextDep,jr.propDep,function(Ui,po){var eu=po.def(Ui.ELEMENTS,".vertCount-",Ui.OFFSET);return V.optional(function(){Ui.assert(po,eu+">=0","invalid vertex offset/element buffer too small")}),eu}):ys(function(Ui,po){return po.def(Ui.ELEMENTS,".vertCount")});var ai=ys(function(){return-1});return V.optional(function(){ai.MISSING=!0}),ai}else{var oi=new ua(Ge.thisDep||jr.thisDep,Ge.contextDep||jr.contextDep,Ge.propDep||jr.propDep,function(Ui,po){var eu=Ui.ELEMENTS;return Ui.OFFSET?po.def(eu,"?",eu,".vertCount-",Ui.OFFSET,":-1"):po.def(eu,"?",eu,".vertCount:-1")});return V.optional(function(){oi.DYNAMIC=!0}),oi}else if(gt){var qn=new ua(At.thisDep,At.contextDep,At.propDep,function(Ui,po){return po.def(Ui.shared.vao,".currentVAO?",Ui.shared.vao,".currentVAO.count:-1")});return qn}return null}var Ln=zt(),jn=_n(),vn=$t(Sc,!1);return{elements:Ge,primitive:Ln,count:jn,instances:vn,offset:jr,vao:At,vaoActive:gt,elementsActive:Le,static:nr}}function Ko(Ze,Ee){var ft=Ze.static,Ut=Ze.dynamic,nr={};return Ii.forEach(function(gt){var nt=ci(gt);function At(Le,lt){if(gt in ft){var Ge=Le(ft[gt]);nr[nt]=ys(function(){return Ge})}else if(gt in Ut){var zt=Ut[gt];nr[nt]=Nu(zt,function($t,jr){return lt($t,jr,$t.invoke(jr,zt))})}}switch(gt){case Ec:case ou:case Wo:case Va:case Vl:case Sf:case gl:case uu:case Gl:case Ml:return At(function(Le){return V.commandType(Le,"boolean",gt,Ee.commandStr),Le},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,"typeof "+Ge+'==="boolean"',"invalid flag "+gt,Le.commandStr)}),Ge});case Ou:return At(function(Le){return V.commandParameter(Le,Jc,"invalid "+gt,Ee.commandStr),Jc[Le]},function(Le,lt,Ge){var zt=Le.constants.compareFuncs;return V.optional(function(){Le.assert(lt,Ge+" in "+zt,"invalid "+gt+", must be one of "+Object.keys(Jc))}),lt.def(zt,"[",Ge,"]")});case Cf:return At(function(Le){return V.command(Vo(Le)&&Le.length===2&&typeof Le[0]=="number"&&typeof Le[1]=="number"&&Le[0]<=Le[1],"depth range is 2d array",Ee.commandStr),Le},function(Le,lt,Ge){V.optional(function(){Le.assert(lt,Le.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===2&&typeof "+Ge+'[0]==="number"&&typeof '+Ge+'[1]==="number"&&'+Ge+"[0]<="+Ge+"[1]","depth range must be a 2d array")});var zt=lt.def("+",Ge,"[0]"),$t=lt.def("+",Ge,"[1]");return[zt,$t]});case ms:return At(function(Le){V.commandType(Le,"object","blend.func",Ee.commandStr);var lt="srcRGB"in Le?Le.srcRGB:Le.src,Ge="srcAlpha"in Le?Le.srcAlpha:Le.src,zt="dstRGB"in Le?Le.dstRGB:Le.dst,$t="dstAlpha"in Le?Le.dstAlpha:Le.dst;return V.commandParameter(lt,Mc,nt+".srcRGB",Ee.commandStr),V.commandParameter(Ge,Mc,nt+".srcAlpha",Ee.commandStr),V.commandParameter(zt,Mc,nt+".dstRGB",Ee.commandStr),V.commandParameter($t,Mc,nt+".dstAlpha",Ee.commandStr),V.command(wh.indexOf(lt+", "+zt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+lt+", "+zt+")",Ee.commandStr),[Mc[lt],Mc[zt],Mc[Ge],Mc[$t]]},function(Le,lt,Ge){var zt=Le.constants.blendFuncs;V.optional(function(){Le.assert(lt,Ge+"&&typeof "+Ge+'==="object"',"invalid blend func, must be an object")});function $t(Yn,ai){var oi=lt.def('"',Yn,ai,'" in ',Ge,"?",Ge,".",Yn,ai,":",Ge,".",Yn);return V.optional(function(){Le.assert(lt,oi+" in "+zt,"invalid "+gt+"."+Yn+ai+", must be one of "+Object.keys(Mc))}),oi}var jr=$t("src","RGB"),_n=$t("dst","RGB");V.optional(function(){var Yn=Le.constants.invalidBlendCombinations;Le.assert(lt,Yn+".indexOf("+jr+'+", "+'+_n+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ln=lt.def(zt,"[",jr,"]"),jn=lt.def(zt,"[",$t("src","Alpha"),"]"),vn=lt.def(zt,"[",_n,"]"),ti=lt.def(zt,"[",$t("dst","Alpha"),"]");return[Ln,vn,jn,ti]});case Ms:return At(function(Le){if(typeof Le=="string")return V.commandParameter(Le,mr,"invalid "+gt,Ee.commandStr),[mr[Le],mr[Le]];if(typeof Le=="object")return V.commandParameter(Le.rgb,mr,gt+".rgb",Ee.commandStr),V.commandParameter(Le.alpha,mr,gt+".alpha",Ee.commandStr),[mr[Le.rgb],mr[Le.alpha]];V.commandRaise("invalid blend.equation",Ee.commandStr)},function(Le,lt,Ge){var zt=Le.constants.blendEquations,$t=lt.def(),jr=lt.def(),_n=Le.cond("typeof ",Ge,'==="string"');return V.optional(function(){function Ln(jn,vn,ti){Le.assert(jn,ti+" in "+zt,"invalid "+vn+", must be one of "+Object.keys(mr))}Ln(_n.then,gt,Ge),Le.assert(_n.else,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt),Ln(_n.else,gt+".rgb",Ge+".rgb"),Ln(_n.else,gt+".alpha",Ge+".alpha")}),_n.then($t,"=",jr,"=",zt,"[",Ge,"];"),_n.else($t,"=",zt,"[",Ge,".rgb];",jr,"=",zt,"[",Ge,".alpha];"),lt(_n),[$t,jr]});case su:return At(function(Le){return V.command(Vo(Le)&&Le.length===4,"blend.color must be a 4d array",Ee.commandStr),ot(4,function(lt){return+Le[lt]})},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,Le.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===4","blend.color must be a 4d array")}),ot(4,function(zt){return lt.def("+",Ge,"[",zt,"]")})});case _u:return At(function(Le){return V.commandType(Le,"number",nt,Ee.commandStr),Le|0},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,"typeof "+Ge+'==="number"',"invalid stencil.mask")}),lt.def(Ge,"|0")});case lu:return At(function(Le){V.commandType(Le,"object",nt,Ee.commandStr);var lt=Le.cmp||"keep",Ge=Le.ref||0,zt="mask"in Le?Le.mask:-1;return V.commandParameter(lt,Jc,gt+".cmp",Ee.commandStr),V.commandType(Ge,"number",gt+".ref",Ee.commandStr),V.commandType(zt,"number",gt+".mask",Ee.commandStr),[Jc[lt],Ge,zt]},function(Le,lt,Ge){var zt=Le.constants.compareFuncs;V.optional(function(){function Ln(){Le.assert(lt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ln(Ge+"&&typeof ",Ge,'==="object"'),Ln('!("cmp" in ',Ge,")||(",Ge,".cmp in ",zt,")")});var $t=lt.def('"cmp" in ',Ge,"?",zt,"[",Ge,".cmp]",":",cu),jr=lt.def(Ge,".ref|0"),_n=lt.def('"mask" in ',Ge,"?",Ge,".mask|0:-1");return[$t,jr,_n]});case Cc:case _h:return At(function(Le){V.commandType(Le,"object",nt,Ee.commandStr);var lt=Le.fail||"keep",Ge=Le.zfail||"keep",zt=Le.zpass||"keep";return V.commandParameter(lt,ef,gt+".fail",Ee.commandStr),V.commandParameter(Ge,ef,gt+".zfail",Ee.commandStr),V.commandParameter(zt,ef,gt+".zpass",Ee.commandStr),[gt===_h?Wl:Tc,ef[lt],ef[Ge],ef[zt]]},function(Le,lt,Ge){var zt=Le.constants.stencilOps;V.optional(function(){Le.assert(lt,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt)});function $t(jr){return V.optional(function(){Le.assert(lt,'!("'+jr+'" in '+Ge+")||("+Ge+"."+jr+" in "+zt+")","invalid "+gt+"."+jr+", must be one of "+Object.keys(ef))}),lt.def('"',jr,'" in ',Ge,"?",zt,"[",Ge,".",jr,"]:",cu)}return[gt===_h?Wl:Tc,$t("fail"),$t("zfail"),$t("zpass")]});case gs:return At(function(Le){V.commandType(Le,"object",nt,Ee.commandStr);var lt=Le.factor|0,Ge=Le.units|0;return V.commandType(lt,"number",nt+".factor",Ee.commandStr),V.commandType(Ge,"number",nt+".units",Ee.commandStr),[lt,Ge]},function(Le,lt,Ge){V.optional(function(){Le.assert(lt,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt)});var zt=lt.def(Ge,".factor|0"),$t=lt.def(Ge,".units|0");return[zt,$t]});case Hc:return At(function(Le){var lt=0;return Le==="front"?lt=Tc:Le==="back"&&(lt=Wl),V.command(!!lt,nt,Ee.commandStr),lt},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,Ge+'==="front"||'+Ge+'==="back"',"invalid cull.face")}),lt.def(Ge,'==="front"?',Tc,":",Wl)});case Wc:return At(function(Le){return V.command(typeof Le=="number"&&Le>=or.lineWidthDims[0]&&Le<=or.lineWidthDims[1],"invalid line width, must be a positive number between "+or.lineWidthDims[0]+" and "+or.lineWidthDims[1],Ee.commandStr),Le},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,"typeof "+Ge+'==="number"&&'+Ge+">="+or.lineWidthDims[0]+"&&"+Ge+"<="+or.lineWidthDims[1],"invalid line width")}),Ge});case jl:return At(function(Le){return V.commandParameter(Le,xd,nt,Ee.commandStr),xd[Le]},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,Ge+'==="cw"||'+Ge+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),lt.def(Ge+'==="cw"?'+Qp+":"+Du)});case Il:return At(function(Le){return V.command(Vo(Le)&&Le.length===4,"color.mask must be length 4 array",Ee.commandStr),Le.map(function(lt){return!!lt})},function(Le,lt,Ge){return V.optional(function(){Le.assert(lt,Le.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===4","invalid color.mask")}),ot(4,function(zt){return"!!"+Ge+"["+zt+"]"})});case ic:return At(function(Le){V.command(typeof Le=="object"&&Le,nt,Ee.commandStr);var lt="value"in Le?Le.value:1,Ge=!!Le.invert;return V.command(typeof lt=="number"&&lt>=0&&lt<=1,"sample.coverage.value must be a number between 0 and 1",Ee.commandStr),[lt,Ge]},function(Le,lt,Ge){V.optional(function(){Le.assert(lt,Ge+"&&typeof "+Ge+'==="object"',"invalid sample.coverage")});var zt=lt.def('"value" in ',Ge,"?+",Ge,".value:1"),$t=lt.def("!!",Ge,".invert");return[zt,$t]})}}),nr}function Ea(Ze,Ee){var ft=Ze.static,Ut=Ze.dynamic,nr={};return Object.keys(ft).forEach(function(gt){var nt=ft[gt],At;if(typeof nt=="number"||typeof nt=="boolean")At=ys(function(){return nt});else if(typeof nt=="function"){var Le=nt._reglType;Le==="texture2d"||Le==="textureCube"?At=ys(function(lt){return lt.link(nt)}):Le==="framebuffer"||Le==="framebufferCube"?(V.command(nt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',Ee.commandStr),At=ys(function(lt){return lt.link(nt.color[0])})):V.commandRaise('invalid data for uniform "'+gt+'"',Ee.commandStr)}else Vo(nt)?At=ys(function(lt){var Ge=lt.global.def("[",ot(nt.length,function(zt){return V.command(typeof nt[zt]=="number"||typeof nt[zt]=="boolean","invalid uniform "+gt,lt.commandStr),nt[zt]}),"]");return Ge}):V.commandRaise('invalid or missing data for uniform "'+gt+'"',Ee.commandStr);At.value=nt,nr[gt]=At}),Object.keys(Ut).forEach(function(gt){var nt=Ut[gt];nr[gt]=Nu(nt,function(At,Le){return At.invoke(Le,nt)})}),nr}function Zs(Ze,Ee){var ft=Ze.static,Ut=Ze.dynamic,nr={};return Object.keys(ft).forEach(function(gt){var nt=ft[gt],At=Pe.id(gt),Le=new St;if(Jp(nt))Le.state=Pi,Le.buffer=Br.getBuffer(Br.create(nt,Ac,!1,!0)),Le.type=0;else{var lt=Br.getBuffer(nt);if(lt)Le.state=Pi,Le.buffer=lt,Le.type=0;else if(V.command(typeof nt=="object"&&nt,"invalid data for attribute "+gt,Ee.commandStr),"constant"in nt){var Ge=nt.constant;Le.buffer="null",Le.state=ia,typeof Ge=="number"?Le.x=Ge:(V.command(Vo(Ge)&&Ge.length>0&&Ge.length<=4,"invalid constant for attribute "+gt,Ee.commandStr),na.forEach(function(vn,ti){ti<Ge.length&&(Le[vn]=Ge[ti])}))}else{Jp(nt.buffer)?lt=Br.getBuffer(Br.create(nt.buffer,Ac,!1,!0)):lt=Br.getBuffer(nt.buffer),V.command(!!lt,'missing buffer for attribute "'+gt+'"',Ee.commandStr);var zt=nt.offset|0;V.command(zt>=0,'invalid offset for attribute "'+gt+'"',Ee.commandStr);var $t=nt.stride|0;V.command($t>=0&&$t<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',Ee.commandStr);var jr=nt.size|0;V.command(!("size"in nt)||jr>0&&jr<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',Ee.commandStr);var _n=!!nt.normalized,Ln=0;"type"in nt&&(V.commandParameter(nt.type,Cu,"invalid type for attribute "+gt,Ee.commandStr),Ln=Cu[nt.type]);var jn=nt.divisor|0;V.optional(function(){"divisor"in nt&&(V.command(jn===0||rn,'cannot specify divisor for attribute "'+gt+'", instancing not supported',Ee.commandStr),V.command(jn>=0,'invalid divisor for attribute "'+gt+'"',Ee.commandStr));var vn=Ee.commandStr,ti=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(nt).forEach(function(Yn){V.command(ti.indexOf(Yn)>=0,'unknown parameter "'+Yn+'" for attribute pointer "'+gt+'" (valid parameters are '+ti+")",vn)})}),Le.buffer=lt,Le.state=Pi,Le.size=jr,Le.normalized=_n,Le.type=Ln||lt.dtype,Le.offset=zt,Le.stride=$t,Le.divisor=jn}}nr[gt]=ys(function(vn,ti){var Yn=vn.attribCache;if(At in Yn)return Yn[At];var ai={isStream:!1};return Object.keys(Le).forEach(function(oi){ai[oi]=Le[oi]}),Le.buffer&&(ai.buffer=vn.link(Le.buffer),ai.type=ai.type||ai.buffer+".dtype"),Yn[At]=ai,ai})}),Object.keys(Ut).forEach(function(gt){var nt=Ut[gt];function At(Le,lt){var Ge=Le.invoke(lt,nt),zt=Le.shared,$t=Le.constants,jr=zt.isBufferArgs,_n=zt.buffer;V.optional(function(){Le.assert(lt,Ge+"&&(typeof "+Ge+'==="object"||typeof '+Ge+'==="function")&&('+jr+"("+Ge+")||"+_n+".getBuffer("+Ge+")||"+_n+".getBuffer("+Ge+".buffer)||"+jr+"("+Ge+'.buffer)||("constant" in '+Ge+"&&(typeof "+Ge+'.constant==="number"||'+zt.isArrayLike+"("+Ge+".constant))))",'invalid dynamic attribute "'+gt+'"')});var Ln={isStream:lt.def(!1)},jn=new St;jn.state=Pi,Object.keys(jn).forEach(function(ai){Ln[ai]=lt.def(""+jn[ai])});var vn=Ln.buffer,ti=Ln.type;lt("if(",jr,"(",Ge,")){",Ln.isStream,"=true;",vn,"=",_n,".createStream(",Ac,",",Ge,");",ti,"=",vn,".dtype;","}else{",vn,"=",_n,".getBuffer(",Ge,");","if(",vn,"){",ti,"=",vn,".dtype;",'}else if("constant" in ',Ge,"){",Ln.state,"=",ia,";","if(typeof "+Ge+'.constant === "number"){',Ln[na[0]],"=",Ge,".constant;",na.slice(1).map(function(ai){return Ln[ai]}).join("="),"=0;","}else{",na.map(function(ai,oi){return Ln[ai]+"="+Ge+".constant.length>"+oi+"?"+Ge+".constant["+oi+"]:0;"}).join(""),"}}else{","if(",jr,"(",Ge,".buffer)){",vn,"=",_n,".createStream(",Ac,",",Ge,".buffer);","}else{",vn,"=",_n,".getBuffer(",Ge,".buffer);","}",ti,'="type" in ',Ge,"?",$t.glTypes,"[",Ge,".type]:",vn,".dtype;",Ln.normalized,"=!!",Ge,".normalized;");function Yn(ai){lt(Ln[ai],"=",Ge,".",ai,"|0;")}return Yn("size"),Yn("offset"),Yn("stride"),Yn("divisor"),lt("}}"),lt.exit("if(",Ln.isStream,"){",_n,".destroyStream(",vn,");","}"),Ln}nr[gt]=Nu(nt,At)}),nr}function eo(Ze){var Ee=Ze.static,ft=Ze.dynamic,Ut={};return Object.keys(Ee).forEach(function(nr){var gt=Ee[nr];Ut[nr]=ys(function(nt,At){return typeof gt=="number"||typeof gt=="boolean"?""+gt:nt.link(gt)})}),Object.keys(ft).forEach(function(nr){var gt=ft[nr];Ut[nr]=Nu(gt,function(nt,At){return nt.invoke(At,gt)})}),Ut}function Vs(Ze,Ee,ft,Ut,nr){var gt=Ze.static,nt=Ze.dynamic;V.optional(function(){var Yn=[tl,Yc,bh,ac,Xo,Iu,qf,Sc,xh,qc].concat(Ii);function ai(oi){Object.keys(oi).forEach(function(qn){V.command(Yn.indexOf(qn)>=0,'unknown parameter "'+qn+'"',nr.commandStr)})}ai(gt),ai(nt)});var At=ta(Ze,Ee),Le=Un(Ze,nr),lt=Oi(Ze,Le,nr),Ge=No(Ze,nr),zt=Ko(Ze,nr),$t=Ma(Ze,nr,At);function jr(Yn){var ai=lt[Yn];ai&&(zt[Yn]=ai)}jr(Ks),jr(ci(Xc));var _n=Object.keys(zt).length>0,Ln={framebuffer:Le,draw:Ge,shader:$t,state:zt,dirty:_n,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ln.profile=Rn(Ze,nr),Ln.uniforms=Ea(ft,nr),Ln.drawVAO=Ln.scopeVAO=Ge.vao,!Ln.drawVAO&&$t.program&&!At&&it.angle_instanced_arrays&&Ge.static.elements){var jn=!0,vn=$t.program.attributes.map(function(Yn){var ai=Ee.static[Yn];return jn=jn&&!!ai,ai});if(jn&&vn.length>0){var ti=en.getVAO(en.createVAO({attributes:vn,elements:Ge.static.elements}));Ln.drawVAO=new ua(null,null,null,function(Yn,ai){return Yn.link(ti)}),Ln.useVAO=!0}}return At?Ln.useVAO=!0:Ln.attributes=Zs(Ee,nr),Ln.context=eo(Ut,nr),Ln}function _s(Ze,Ee,ft){var Ut=Ze.shared,nr=Ut.context,gt=Ze.scope();Object.keys(ft).forEach(function(nt){Ee.save(nr,"."+nt);var At=ft[nt],Le=At.append(Ze,Ee);Array.isArray(Le)?gt(nr,".",nt,"=[",Le.join(),"];"):gt(nr,".",nt,"=",Le,";")}),Ee(gt)}function Js(Ze,Ee,ft,Ut){var nr=Ze.shared,gt=nr.gl,nt=nr.framebuffer,At;En&&(At=Ee.def(nr.extensions,".webgl_draw_buffers"));var Le=Ze.constants,lt=Le.drawBuffer,Ge=Le.backBuffer,zt;ft?zt=ft.append(Ze,Ee):zt=Ee.def(nt,".next"),Ut||Ee("if(",zt,"!==",nt,".cur){"),Ee("if(",zt,"){",gt,".bindFramebuffer(",$d,",",zt,".framebuffer);"),En&&Ee(At,".drawBuffersWEBGL(",lt,"[",zt,".colorAttachments.length]);"),Ee("}else{",gt,".bindFramebuffer(",$d,",null);"),En&&Ee(At,".drawBuffersWEBGL(",Ge,");"),Ee("}",nt,".cur=",zt,";"),Ut||Ee("}")}function js(Ze,Ee,ft){var Ut=Ze.shared,nr=Ut.gl,gt=Ze.current,nt=Ze.next,At=Ut.current,Le=Ut.next,lt=Ze.cond(At,".dirty");Ii.forEach(function(Ge){var zt=ci(Ge);if(!(zt in ft.state)){var $t,jr;if(zt in nt){$t=nt[zt],jr=gt[zt];var _n=ot(Cn[zt].length,function(jn){return lt.def($t,"[",jn,"]")});lt(Ze.cond(_n.map(function(jn,vn){return jn+"!=="+jr+"["+vn+"]"}).join("||")).then(nr,".",wr[zt],"(",_n,");",_n.map(function(jn,vn){return jr+"["+vn+"]="+jn}).join(";"),";"))}else{$t=lt.def(Le,".",zt);var Ln=Ze.cond($t,"!==",At,".",zt);lt(Ln),zt in Mr?Ln(Ze.cond($t).then(nr,".enable(",Mr[zt],");").else(nr,".disable(",Mr[zt],");"),At,".",zt,"=",$t,";"):Ln(nr,".",wr[zt],"(",$t,");",At,".",zt,"=",$t,";")}}}),Object.keys(ft.state).length===0&&lt(At,".dirty=false;"),Ee(lt)}function xu(Ze,Ee,ft,Ut){var nr=Ze.shared,gt=Ze.current,nt=nr.current,At=nr.gl;rp(Object.keys(ft)).forEach(function(Le){var lt=ft[Le];if(!(Ut&&!Ut(lt))){var Ge=lt.append(Ze,Ee);if(Mr[Le]){var zt=Mr[Le];Bu(lt)?Ge?Ee(At,".enable(",zt,");"):Ee(At,".disable(",zt,");"):Ee(Ze.cond(Ge).then(At,".enable(",zt,");").else(At,".disable(",zt,");")),Ee(nt,".",Le,"=",Ge,";")}else if(Vo(Ge)){var $t=gt[Le];Ee(At,".",wr[Le],"(",Ge,");",Ge.map(function(jr,_n){return $t+"["+_n+"]="+jr}).join(";"),";")}else Ee(At,".",wr[Le],"(",Ge,");",nt,".",Le,"=",Ge,";")}})}function Qo(Ze,Ee){rn&&(Ze.instancing=Ee.def(Ze.shared.extensions,".angle_instanced_arrays"))}function la(Ze,Ee,ft,Ut,nr){var gt=Ze.shared,nt=Ze.stats,At=gt.current,Le=gt.timer,lt=ft.profile;function Ge(){var Yn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Yn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var zt,$t;function jr(Yn){zt=Ee.def(),Yn(zt,"=",Ge(),";"),typeof nr=="string"?Yn(nt,".count+=",nr,";"):Yn(nt,".count++;"),tn&&(Ut?($t=Ee.def(),Yn($t,"=",Le,".getNumPendingQueries();")):Yn(Le,".beginQuery(",nt,");"))}function _n(Yn){Yn(nt,".cpuTime+=",Ge(),"-",zt,";"),tn&&(Ut?Yn(Le,".pushScopeStats(",$t,",",Le,".getNumPendingQueries(),",nt,");"):Yn(Le,".endQuery();"))}function Ln(Yn){var ai=Ee.def(At,".profile");Ee(At,".profile=",Yn,";"),Ee.exit(At,".profile=",ai,";")}var jn;if(lt){if(Bu(lt)){lt.enable?(jr(Ee),_n(Ee.exit),Ln("true")):Ln("false");return}jn=lt.append(Ze,Ee),Ln(jn)}else jn=Ee.def(At,".profile");var vn=Ze.block();jr(vn),Ee("if(",jn,"){",vn,"}");var ti=Ze.block();_n(ti),Ee.exit("if(",jn,"){",ti,"}")}function xs(Ze,Ee,ft,Ut,nr){var gt=Ze.shared;function nt(Le){switch(Le){case Ch:case rl:case Kp:return 2;case kl:case Kf:case ep:return 3;case Jh:case $p:case Mf:return 4;default:return 1}}function At(Le,lt,Ge){var zt=gt.gl,$t=Ee.def(Le,".location"),jr=Ee.def(gt.attributes,"[",$t,"]"),_n=Ge.state,Ln=Ge.buffer,jn=[Ge.x,Ge.y,Ge.z,Ge.w],vn=["buffer","normalized","offset","stride"];function ti(){Ee("if(!",jr,".buffer){",zt,".enableVertexAttribArray(",$t,");}");var ai=Ge.type,oi;if(Ge.size?oi=Ee.def(Ge.size,"||",lt):oi=lt,Ee("if(",jr,".type!==",ai,"||",jr,".size!==",oi,"||",vn.map(function(Ui){return jr+"."+Ui+"!=="+Ge[Ui]}).join("||"),"){",zt,".bindBuffer(",Ac,",",Ln,".buffer);",zt,".vertexAttribPointer(",[$t,oi,ai,Ge.normalized,Ge.stride,Ge.offset],");",jr,".type=",ai,";",jr,".size=",oi,";",vn.map(function(Ui){return jr+"."+Ui+"="+Ge[Ui]+";"}).join(""),"}"),rn){var qn=Ge.divisor;Ee("if(",jr,".divisor!==",qn,"){",Ze.instancing,".vertexAttribDivisorANGLE(",[$t,qn],");",jr,".divisor=",qn,";}")}}function Yn(){Ee("if(",jr,".buffer){",zt,".disableVertexAttribArray(",$t,");",jr,".buffer=null;","}if(",na.map(function(ai,oi){return jr+"."+ai+"!=="+jn[oi]}).join("||"),"){",zt,".vertexAttrib4f(",$t,",",jn,");",na.map(function(ai,oi){return jr+"."+ai+"="+jn[oi]+";"}).join(""),"}")}_n===Pi?ti():_n===ia?Yn():(Ee("if(",_n,"===",Pi,"){"),ti(),Ee("}else{"),Yn(),Ee("}"))}Ut.forEach(function(Le){var lt=Le.name,Ge=ft.attributes[lt],zt;if(Ge){if(!nr(Ge))return;zt=Ge.append(Ze,Ee)}else{if(!nr(tf))return;var $t=Ze.scopeAttrib(lt);V.optional(function(){Ze.assert(Ee,$t+".state","missing attribute "+lt)}),zt={},Object.keys(new St).forEach(function(jr){zt[jr]=Ee.def($t,".",jr)})}At(Ze.link(Le),nt(Le.info.type),zt)})}function gr(Ze,Ee,ft,Ut,nr,gt){for(var nt=Ze.shared,At=nt.gl,Le,lt=0;lt<Ut.length;++lt){var Ge=Ut[lt],zt=Ge.name,$t=Ge.info.type,jr=ft.uniforms[zt],_n=Ze.link(Ge),Ln=_n+".location",jn;if(jr){if(!nr(jr))continue;if(Bu(jr)){var vn=jr.value;if(V.command(vn!==null&&typeof vn!="undefined",'missing uniform "'+zt+'"',Ze.commandStr),$t===Ah||$t===Qc){V.command(typeof vn=="function"&&($t===Ah&&(vn._reglType==="texture2d"||vn._reglType==="framebuffer")||$t===Qc&&(vn._reglType==="textureCube"||vn._reglType==="framebufferCube")),"invalid texture for uniform "+zt,Ze.commandStr);var ti=Ze.link(vn._texture||vn.color[0]._texture);Ee(At,".uniform1i(",Ln,",",ti+".bind());"),Ee.exit(ti,".unbind();")}else if($t===Qs||$t===If||$t===Sh){V.optional(function(){V.command(Vo(vn),"invalid matrix for uniform "+zt,Ze.commandStr),V.command($t===Qs&&vn.length===4||$t===If&&vn.length===9||$t===Sh&&vn.length===16,"invalid length for matrix uniform "+zt,Ze.commandStr)});var Yn=Ze.global.def("new Float32Array(["+Array.prototype.slice.call(vn)+"])"),ai=2;$t===If?ai=3:$t===Sh&&(ai=4),Ee(At,".uniformMatrix",ai,"fv(",Ln,",false,",Yn,");")}else{switch($t){case Kc:V.commandType(vn,"number","uniform "+zt,Ze.commandStr),Le="1f";break;case Ch:V.command(Vo(vn)&&vn.length===2,"uniform "+zt,Ze.commandStr),Le="2f";break;case kl:V.command(Vo(vn)&&vn.length===3,"uniform "+zt,Ze.commandStr),Le="3f";break;case Jh:V.command(Vo(vn)&&vn.length===4,"uniform "+zt,Ze.commandStr),Le="4f";break;case Cp:V.commandType(vn,"boolean","uniform "+zt,Ze.commandStr),Le="1i";break;case Ep:V.commandType(vn,"number","uniform "+zt,Ze.commandStr),Le="1i";break;case Kp:V.command(Vo(vn)&&vn.length===2,"uniform "+zt,Ze.commandStr),Le="2i";break;case rl:V.command(Vo(vn)&&vn.length===2,"uniform "+zt,Ze.commandStr),Le="2i";break;case ep:V.command(Vo(vn)&&vn.length===3,"uniform "+zt,Ze.commandStr),Le="3i";break;case Kf:V.command(Vo(vn)&&vn.length===3,"uniform "+zt,Ze.commandStr),Le="3i";break;case Mf:V.command(Vo(vn)&&vn.length===4,"uniform "+zt,Ze.commandStr),Le="4i";break;case $p:V.command(Vo(vn)&&vn.length===4,"uniform "+zt,Ze.commandStr),Le="4i";break}Ee(At,".uniform",Le,"(",Ln,",",Vo(vn)?Array.prototype.slice.call(vn):vn,");")}continue}else jn=jr.append(Ze,Ee)}else{if(!nr(tf))continue;jn=Ee.def(nt.uniforms,"[",Pe.id(zt),"]")}$t===Ah?(V(!Array.isArray(jn),"must specify a scalar prop for textures"),Ee("if(",jn,"&&",jn,'._reglType==="framebuffer"){',jn,"=",jn,".color[0];","}")):$t===Qc&&(V(!Array.isArray(jn),"must specify a scalar prop for cube maps"),Ee("if(",jn,"&&",jn,'._reglType==="framebufferCube"){',jn,"=",jn,".color[0];","}")),V.optional(function(){function zu(yl,nf){Ze.assert(Ee,yl,'bad data or missing for uniform "'+zt+'".  '+nf)}function hr(yl){V(!Array.isArray(jn),"must not specify an array type for uniform"),zu("typeof "+jn+'==="'+yl+'"',"invalid type, expected "+yl)}function Xl(yl,nf){Array.isArray(jn)?V(jn.length===yl,"must have length "+yl):zu(nt.isArrayLike+"("+jn+")&&"+jn+".length==="+yl,"invalid vector, should have length "+yl,Ze.commandStr)}function Sd(yl){V(!Array.isArray(jn),"must not specify a value type"),zu("typeof "+jn+'==="function"&&'+jn+'._reglType==="texture'+(yl===oc?"2d":"Cube")+'"',"invalid texture type",Ze.commandStr)}switch($t){case Ep:hr("number");break;case rl:Xl(2,"number");break;case Kf:Xl(3,"number");break;case $p:Xl(4,"number");break;case Kc:hr("number");break;case Ch:Xl(2,"number");break;case kl:Xl(3,"number");break;case Jh:Xl(4,"number");break;case Cp:hr("boolean");break;case Kp:Xl(2,"boolean");break;case ep:Xl(3,"boolean");break;case Mf:Xl(4,"boolean");break;case Qs:Xl(4,"number");break;case If:Xl(9,"number");break;case Sh:Xl(16,"number");break;case Ah:Sd(oc);break;case Qc:Sd(yd);break}});var oi=1;switch($t){case Ah:case Qc:var qn=Ee.def(jn,"._texture");Ee(At,".uniform1i(",Ln,",",qn,".bind());"),Ee.exit(qn,".unbind();");continue;case Ep:case Cp:Le="1i";break;case rl:case Kp:Le="2i",oi=2;break;case Kf:case ep:Le="3i",oi=3;break;case $p:case Mf:Le="4i",oi=4;break;case Kc:Le="1f";break;case Ch:Le="2f",oi=2;break;case kl:Le="3f",oi=3;break;case Jh:Le="4f",oi=4;break;case Qs:Le="Matrix2fv";break;case If:Le="Matrix3fv";break;case Sh:Le="Matrix4fv";break}if(Le.charAt(0)==="M"){Ee(At,".uniform",Le,"(",Ln,",");var Ui=Math.pow($t-Qs+2,2),po=Ze.global.def("new Float32Array(",Ui,")");Array.isArray(jn)?Ee("false,(",ot(Ui,function(zu){return po+"["+zu+"]="+jn[zu]}),",",po,")"):Ee("false,(Array.isArray(",jn,")||",jn," instanceof Float32Array)?",jn,":(",ot(Ui,function(zu){return po+"["+zu+"]="+jn+"["+zu+"]"}),",",po,")"),Ee(");")}else if(oi>1){for(var eu=[],vo=[],uo=0;uo<oi;++uo)Array.isArray(jn)?vo.push(jn[uo]):vo.push(Ee.def(jn+"["+uo+"]")),gt&&eu.push(Ee.def());gt&&Ee("if(!",Ze.batchId,"||",eu.map(function(zu,hr){return zu+"!=="+vo[hr]}).join("||"),"){",eu.map(function(zu,hr){return zu+"="+vo[hr]+";"}).join("")),Ee(At,".uniform",Le,"(",Ln,",",vo.join(","),");"),gt&&Ee("}")}else{if(V(!Array.isArray(jn),"uniform value must not be an array"),gt){var xn=Ee.def();Ee("if(!",Ze.batchId,"||",xn,"!==",jn,"){",xn,"=",jn,";")}Ee(At,".uniform",Le,"(",Ln,",",jn,");"),gt&&Ee("}")}}}function fu(Ze,Ee,ft,Ut){var nr=Ze.shared,gt=nr.gl,nt=nr.draw,At=Ut.draw;function Le(){var oi=At.elements,qn,Ui=Ee;return oi?((oi.contextDep&&Ut.contextDynamic||oi.propDep)&&(Ui=ft),qn=oi.append(Ze,Ui),At.elementsActive&&Ui("if("+qn+")"+gt+".bindBuffer("+Eh+","+qn+".buffer.buffer);")):(qn=Ui.def(),Ui(qn,"=",nt,".",ac,";","if(",qn,"){",gt,".bindBuffer(",Eh,",",qn,".buffer.buffer);}","else if(",nr.vao,".currentVAO){",qn,"=",Ze.shared.elements+".getElements("+nr.vao,".currentVAO.elements);",Vr?"":"if("+qn+")"+gt+".bindBuffer("+Eh+","+qn+".buffer.buffer);","}")),qn}function lt(){var oi=At.count,qn,Ui=Ee;return oi?((oi.contextDep&&Ut.contextDynamic||oi.propDep)&&(Ui=ft),qn=oi.append(Ze,Ui),V.optional(function(){oi.MISSING&&Ze.assert(Ee,"false","missing vertex count"),oi.DYNAMIC&&Ze.assert(Ui,qn+">=0","missing vertex count")})):(qn=Ui.def(nt,".",qf),V.optional(function(){Ze.assert(Ui,qn+">=0","missing vertex count")})),qn}var Ge=Le();function zt(oi){var qn=At[oi];return qn?qn.contextDep&&Ut.contextDynamic||qn.propDep?qn.append(Ze,ft):qn.append(Ze,Ee):Ee.def(nt,".",oi)}var $t=zt(Xo),jr=zt(Iu),_n=lt();if(typeof _n=="number"){if(_n===0)return}else ft("if(",_n,"){"),ft.exit("}");var Ln,jn;rn&&(Ln=zt(Sc),jn=Ze.instancing);var vn=Ge+".type",ti=At.elements&&Bu(At.elements)&&!At.vaoActive;function Yn(){function oi(){ft(jn,".drawElementsInstancedANGLE(",[$t,_n,vn,jr+"<<(("+vn+"-"+Xi+")>>1)",Ln],");")}function qn(){ft(jn,".drawArraysInstancedANGLE(",[$t,jr,_n,Ln],");")}Ge&&Ge!=="null"?ti?oi():(ft("if(",Ge,"){"),oi(),ft("}else{"),qn(),ft("}")):qn()}function ai(){function oi(){ft(gt+".drawElements("+[$t,_n,vn,jr+"<<(("+vn+"-"+Xi+")>>1)"]+");")}function qn(){ft(gt+".drawArrays("+[$t,jr,_n]+");")}Ge&&Ge!=="null"?ti?oi():(ft("if(",Ge,"){"),oi(),ft("}else{"),qn(),ft("}")):qn()}rn&&(typeof Ln!="number"||Ln>=0)?typeof Ln=="string"?(ft("if(",Ln,">0){"),Yn(),ft("}else if(",Ln,"<0){"),ai(),ft("}")):Yn():ai()}function Yi(Ze,Ee,ft,Ut,nr){var gt=Fi(),nt=gt.proc("body",nr);return V.optional(function(){gt.commandStr=Ee.commandStr,gt.command=gt.link(Ee.commandStr)}),rn&&(gt.instancing=nt.def(gt.shared.extensions,".angle_instanced_arrays")),Ze(gt,nt,ft,Ut),gt.compile().body}function wa(Ze,Ee,ft,Ut){Qo(Ze,Ee),ft.useVAO?ft.drawVAO?Ee(Ze.shared.vao,".setVAO(",ft.drawVAO.append(Ze,Ee),");"):Ee(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(Ee(Ze.shared.vao,".setVAO(null);"),xs(Ze,Ee,ft,Ut.attributes,function(){return!0})),gr(Ze,Ee,ft,Ut.uniforms,function(){return!0},!1),fu(Ze,Ee,Ee,ft)}function io(Ze,Ee){var ft=Ze.proc("draw",1);Qo(Ze,ft),_s(Ze,ft,Ee.context),Js(Ze,ft,Ee.framebuffer),js(Ze,ft,Ee),xu(Ze,ft,Ee.state),la(Ze,ft,Ee,!1,!0);var Ut=Ee.shader.progVar.append(Ze,ft);if(ft(Ze.shared.gl,".useProgram(",Ut,".program);"),Ee.shader.program)wa(Ze,ft,Ee,Ee.shader.program);else{ft(Ze.shared.vao,".setVAO(null);");var nr=Ze.global.def("{}"),gt=ft.def(Ut,".id"),nt=ft.def(nr,"[",gt,"]");ft(Ze.cond(nt).then(nt,".call(this,a0);").else(nt,"=",nr,"[",gt,"]=",Ze.link(function(At){return Yi(wa,Ze,Ee,At,1)}),"(",Ut,");",nt,".call(this,a0);"))}Object.keys(Ee.state).length>0&&ft(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&ft(Ze.shared.vao,".setVAO(null);")}function bs(Ze,Ee,ft,Ut){Ze.batchId="a1",Qo(Ze,Ee);function nr(){return!0}xs(Ze,Ee,ft,Ut.attributes,nr),gr(Ze,Ee,ft,Ut.uniforms,nr,!1),fu(Ze,Ee,Ee,ft)}function rf(Ze,Ee,ft,Ut){Qo(Ze,Ee);var nr=ft.contextDep,gt=Ee.def(),nt="a0",At="a1",Le=Ee.def();Ze.shared.props=Le,Ze.batchId=gt;var lt=Ze.scope(),Ge=Ze.scope();Ee(lt.entry,"for(",gt,"=0;",gt,"<",At,";++",gt,"){",Le,"=",nt,"[",gt,"];",Ge,"}",lt.exit);function zt(vn){return vn.contextDep&&nr||vn.propDep}function $t(vn){return!zt(vn)}if(ft.needsContext&&_s(Ze,Ge,ft.context),ft.needsFramebuffer&&Js(Ze,Ge,ft.framebuffer),xu(Ze,Ge,ft.state,zt),ft.profile&&zt(ft.profile)&&la(Ze,Ge,ft,!1,!0),Ut)ft.useVAO?ft.drawVAO?zt(ft.drawVAO)?Ge(Ze.shared.vao,".setVAO(",ft.drawVAO.append(Ze,Ge),");"):lt(Ze.shared.vao,".setVAO(",ft.drawVAO.append(Ze,lt),");"):lt(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(lt(Ze.shared.vao,".setVAO(null);"),xs(Ze,lt,ft,Ut.attributes,$t),xs(Ze,Ge,ft,Ut.attributes,zt)),gr(Ze,lt,ft,Ut.uniforms,$t,!1),gr(Ze,Ge,ft,Ut.uniforms,zt,!0),fu(Ze,lt,Ge,ft);else{var jr=Ze.global.def("{}"),_n=ft.shader.progVar.append(Ze,Ge),Ln=Ge.def(_n,".id"),jn=Ge.def(jr,"[",Ln,"]");Ge(Ze.shared.gl,".useProgram(",_n,".program);","if(!",jn,"){",jn,"=",jr,"[",Ln,"]=",Ze.link(function(vn){return Yi(bs,Ze,ft,vn,2)}),"(",_n,");}",jn,".call(this,a0[",gt,"],",gt,");")}}function Ye(Ze,Ee){var ft=Ze.proc("batch",2);Ze.batchId="0",Qo(Ze,ft);var Ut=!1,nr=!0;Object.keys(Ee.context).forEach(function(jr){Ut=Ut||Ee.context[jr].propDep}),Ut||(_s(Ze,ft,Ee.context),nr=!1);var gt=Ee.framebuffer,nt=!1;gt?(gt.propDep?Ut=nt=!0:gt.contextDep&&Ut&&(nt=!0),nt||Js(Ze,ft,gt)):Js(Ze,ft,null),Ee.state.viewport&&Ee.state.viewport.propDep&&(Ut=!0);function At(jr){return jr.contextDep&&Ut||jr.propDep}js(Ze,ft,Ee),xu(Ze,ft,Ee.state,function(jr){return!At(jr)}),(!Ee.profile||!At(Ee.profile))&&la(Ze,ft,Ee,!1,"a1"),Ee.contextDep=Ut,Ee.needsContext=nr,Ee.needsFramebuffer=nt;var Le=Ee.shader.progVar;if(Le.contextDep&&Ut||Le.propDep)rf(Ze,ft,Ee,null);else{var lt=Le.append(Ze,ft);if(ft(Ze.shared.gl,".useProgram(",lt,".program);"),Ee.shader.program)rf(Ze,ft,Ee,Ee.shader.program);else{ft(Ze.shared.vao,".setVAO(null);");var Ge=Ze.global.def("{}"),zt=ft.def(lt,".id"),$t=ft.def(Ge,"[",zt,"]");ft(Ze.cond($t).then($t,".call(this,a0,a1);").else($t,"=",Ge,"[",zt,"]=",Ze.link(function(jr){return Yi(rf,Ze,Ee,jr,2)}),"(",lt,");",$t,".call(this,a0,a1);"))}}Object.keys(Ee.state).length>0&&ft(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&ft(Ze.shared.vao,".setVAO(null);")}function dr(Ze,Ee){var ft=Ze.proc("scope",3);Ze.batchId="a2";var Ut=Ze.shared,nr=Ut.current;_s(Ze,ft,Ee.context),Ee.framebuffer&&Ee.framebuffer.append(Ze,ft),rp(Object.keys(Ee.state)).forEach(function(nt){var At=Ee.state[nt],Le=At.append(Ze,ft);Vo(Le)?Le.forEach(function(lt,Ge){ft.set(Ze.next[nt],"["+Ge+"]",lt)}):ft.set(Ut.next,"."+nt,Le)}),la(Ze,ft,Ee,!0,!0),[ac,Iu,qf,Sc,Xo].forEach(function(nt){var At=Ee.draw[nt];!At||ft.set(Ut.draw,"."+nt,""+At.append(Ze,ft))}),Object.keys(Ee.uniforms).forEach(function(nt){var At=Ee.uniforms[nt].append(Ze,ft);Array.isArray(At)&&(At="["+At.join()+"]"),ft.set(Ut.uniforms,"["+Pe.id(nt)+"]",At)}),Object.keys(Ee.attributes).forEach(function(nt){var At=Ee.attributes[nt].append(Ze,ft),Le=Ze.scopeAttrib(nt);Object.keys(new St).forEach(function(lt){ft.set(Le,"."+lt,At[lt])})}),Ee.scopeVAO&&ft.set(Ut.vao,".targetVAO",Ee.scopeVAO.append(Ze,ft));function gt(nt){var At=Ee.shader[nt];At&&ft.set(Ut.shader,"."+nt,At.append(Ze,ft))}gt(Yc),gt(bh),Object.keys(Ee.state).length>0&&(ft(nr,".dirty=true;"),ft.exit(nr,".dirty=true;")),ft("a1(",Ze.shared.context,",a0,",Ze.batchId,");")}function qt(Ze){if(!(typeof Ze!="object"||Vo(Ze))){for(var Ee=Object.keys(Ze),ft=0;ft<Ee.length;++ft)if(Sn.isDynamic(Ze[Ee[ft]]))return!0;return!1}}function ei(Ze,Ee,ft){var Ut=Ee.static[ft];if(!Ut||!qt(Ut))return;var nr=Ze.global,gt=Object.keys(Ut),nt=!1,At=!1,Le=!1,lt=Ze.global.def("{}");gt.forEach(function(zt){var $t=Ut[zt];if(Sn.isDynamic($t)){typeof $t=="function"&&($t=Ut[zt]=Sn.unbox($t));var jr=Nu($t,null);nt=nt||jr.thisDep,Le=Le||jr.propDep,At=At||jr.contextDep}else{switch(nr(lt,".",zt,"="),typeof $t){case"number":nr($t);break;case"string":nr('"',$t,'"');break;case"object":Array.isArray($t)&&nr("[",$t.join(),"]");break;default:nr(Ze.link($t));break}nr(";")}});function Ge(zt,$t){gt.forEach(function(jr){var _n=Ut[jr];if(!!Sn.isDynamic(_n)){var Ln=zt.invoke($t,_n);$t(lt,".",jr,"=",Ln,";")}})}Ee.dynamic[ft]=new Sn.DynamicVariable(Ho,{thisDep:nt,contextDep:At,propDep:Le,ref:lt,append:Ge}),delete Ee.static[ft]}function Ra(Ze,Ee,ft,Ut,nr){var gt=Fi();gt.stats=gt.link(nr),Object.keys(Ee.static).forEach(function(At){ei(gt,Ee,At)}),ku.forEach(function(At){ei(gt,Ze,At)});var nt=Vs(Ze,Ee,ft,Ut,gt);return io(gt,nt),dr(gt,nt),Ye(gt,nt),y(gt.compile(),{destroy:function(){nt.shader.program.destroy()}})}return{next:Zn,current:Cn,procs:function(){var Ze=Fi(),Ee=Ze.proc("poll"),ft=Ze.proc("refresh"),Ut=Ze.block();Ee(Ut),ft(Ut);var nr=Ze.shared,gt=nr.gl,nt=nr.next,At=nr.current;Ut(At,".dirty=false;"),Js(Ze,Ee),Js(Ze,ft,null,!0);var Le;rn&&(Le=Ze.link(rn)),it.oes_vertex_array_object&&ft(Ze.link(it.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var lt=0;lt<or.maxAttributes;++lt){var Ge=ft.def(nr.attributes,"[",lt,"]"),zt=Ze.cond(Ge,".buffer");zt.then(gt,".enableVertexAttribArray(",lt,");",gt,".bindBuffer(",Ac,",",Ge,".buffer.buffer);",gt,".vertexAttribPointer(",lt,",",Ge,".size,",Ge,".type,",Ge,".normalized,",Ge,".stride,",Ge,".offset);").else(gt,".disableVertexAttribArray(",lt,");",gt,".vertexAttrib4f(",lt,",",Ge,".x,",Ge,".y,",Ge,".z,",Ge,".w);",Ge,".buffer=null;"),ft(zt),rn&&ft(Le,".vertexAttribDivisorANGLE(",lt,",",Ge,".divisor);")}return ft(Ze.shared.vao,".currentVAO=null;",Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"),Object.keys(Mr).forEach(function($t){var jr=Mr[$t],_n=Ut.def(nt,".",$t),Ln=Ze.block();Ln("if(",_n,"){",gt,".enable(",jr,")}else{",gt,".disable(",jr,")}",At,".",$t,"=",_n,";"),ft(Ln),Ee("if(",_n,"!==",At,".",$t,"){",Ln,"}")}),Object.keys(wr).forEach(function($t){var jr=wr[$t],_n=Cn[$t],Ln,jn,vn=Ze.block();if(vn(gt,".",jr,"("),Vo(_n)){var ti=_n.length;Ln=Ze.global.def(nt,".",$t),jn=Ze.global.def(At,".",$t),vn(ot(ti,function(Yn){return Ln+"["+Yn+"]"}),");",ot(ti,function(Yn){return jn+"["+Yn+"]="+Ln+"["+Yn+"];"}).join("")),Ee("if(",ot(ti,function(Yn){return Ln+"["+Yn+"]!=="+jn+"["+Yn+"]"}).join("||"),"){",vn,"}")}else Ln=Ut.def(nt,".",$t),jn=Ut.def(At,".",$t),vn(Ln,");",At,".",$t,"=",Ln,";"),Ee("if(",Ln,"!==",jn,"){",vn,"}");ft(vn)}),Ze.compile()}(),compile:Ra}}function Ap(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Qd=34918,Jd=34919,Ed=35007,e0=function(H,Pe){if(!Pe.ext_disjoint_timer_query)return null;var it=[];function or(){return it.pop()||Pe.ext_disjoint_timer_query.createQueryEXT()}function Br(rn){it.push(rn)}var ur=[];function kr(rn){var En=or();Pe.ext_disjoint_timer_query.beginQueryEXT(Ed,En),ur.push(En),tn(ur.length-1,ur.length,rn)}function Gr(){Pe.ext_disjoint_timer_query.endQueryEXT(Ed)}function Kr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function sn(){return en.pop()||new Kr}function dn(rn){en.push(rn)}var Fn=[];function tn(rn,En,Vr){var Cn=sn();Cn.startQueryIndex=rn,Cn.endQueryIndex=En,Cn.sum=0,Cn.stats=Vr,Fn.push(Cn)}var Ur=[],St=[];function mr(){var rn,En,Vr=ur.length;if(Vr!==0){St.length=Math.max(St.length,Vr+1),Ur.length=Math.max(Ur.length,Vr+1),Ur[0]=0,St[0]=0;var Cn=0;for(rn=0,En=0;En<ur.length;++En){var Zn=ur[En];Pe.ext_disjoint_timer_query.getQueryObjectEXT(Zn,Jd)?(Cn+=Pe.ext_disjoint_timer_query.getQueryObjectEXT(Zn,Qd),Br(Zn)):ur[rn++]=Zn,Ur[En+1]=Cn,St[En+1]=rn}for(ur.length=rn,rn=0,En=0;En<Fn.length;++En){var Ii=Fn[En],Mr=Ii.startQueryIndex,wr=Ii.endQueryIndex;Ii.sum+=Ur[wr]-Ur[Mr];var ci=St[Mr],Nn=St[wr];Nn===ci?(Ii.stats.gpuTime+=Ii.sum/1e6,dn(Ii)):(Ii.startQueryIndex=ci,Ii.endQueryIndex=Nn,Fn[rn++]=Ii)}Fn.length=rn}}return{beginQuery:kr,endQuery:Gr,pushScopeStats:tn,update:mr,getNumPendingQueries:function(){return ur.length},clear:function(){it.push.apply(it,ur);for(var rn=0;rn<it.length;rn++)Pe.ext_disjoint_timer_query.deleteQueryEXT(it[rn]);ur.length=0,it.length=0},restore:function(){ur.length=0,it.length=0}}},C0=16384,wp=256,Tp=1024,t0=34962,np="webglcontextlost",ho="webglcontextrestored",ed=1,Pf=2,Rf=3;function Cd(H,Pe){for(var it=0;it<H.length;++it)if(H[it]===Pe)return it;return-1}function S0(H){var Pe=Ie(H);if(!Pe)return null;var it=Pe.gl,or=it.getContextAttributes(),Br=it.isContextLost(),ur=qe(it,Pe);if(!ur)return null;var kr=oa(),Gr=Ap(),Kr=ur.extensions,en=e0(it,Kr),sn=Ga(),dn=it.drawingBufferWidth,Fn=it.drawingBufferHeight,tn={tick:0,time:0,viewportWidth:dn,viewportHeight:Fn,framebufferWidth:dn,framebufferHeight:Fn,drawingBufferWidth:dn,drawingBufferHeight:Fn,pixelRatio:Pe.pixelRatio},Ur={},St={elements:null,primitive:4,count:-1,offset:0,instances:-1},mr=ul(it,Kr),rn=G(it,Gr,Pe,Cn),En=pc(it,Kr,rn,Gr),Vr=Wt(it,Kr,mr,Gr,rn,En,St);function Cn(Yi){return Vr.destroyBuffer(Yi)}var Zn=bn(it,kr,Gr,Pe),Ii=yu(it,Kr,mr,function(){ci.procs.poll()},tn,Gr,Pe),Mr=Xf(it,Kr,mr,Gr,Pe),wr=et(it,Kr,mr,Ii,Mr,Gr),ci=bd(it,kr,Kr,mr,rn,En,Ii,wr,Ur,Vr,Zn,St,tn,en,Pe),Nn=Ai(it,wr,ci.procs.poll,tn,or,Kr,mr),un=ci.next,Pn=it.canvas,Dn=[],Qi=[],Fi=[],Rn=[Pe.onDestroy],Un=null;function Oi(){if(Dn.length===0){en&&en.update(),Un=null;return}Un=Bi.next(Oi),Qo();for(var Yi=Dn.length-1;Yi>=0;--Yi){var wa=Dn[Yi];wa&&wa(tn,null,0)}it.flush(),en&&en.update()}function ta(){!Un&&Dn.length>0&&(Un=Bi.next(Oi))}function Ma(){Un&&(Bi.cancel(Oi),Un=null)}function No(Yi){Yi.preventDefault(),Br=!0,Ma(),Qi.forEach(function(wa){wa()})}function Ko(Yi){it.getError(),Br=!1,ur.restore(),Zn.restore(),rn.restore(),Ii.restore(),Mr.restore(),wr.restore(),Vr.restore(),en&&en.restore(),ci.procs.refresh(),ta(),Fi.forEach(function(wa){wa()})}var Ea=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ea&&Pn&&(Pn.addEventListener(np,No,!1),Pn.addEventListener(ho,Ko,!1));function Zs(){Dn.length=0,Ma(),!Ea&&Pn&&(Pn.removeEventListener(np,No),Pn.removeEventListener(ho,Ko)),Zn.clear(),wr.clear(),Mr.clear(),Vr.clear(),Ii.clear(),En.clear(),rn.clear(),en&&en.clear(),Rn.forEach(function(Yi){Yi()})}function eo(Yi){V(!!Yi,"invalid args to regl({...})"),V.type(Yi,"object","invalid args to regl({...})");function wa(gt){var nt=y({},gt);delete nt.uniforms,delete nt.attributes,delete nt.context,delete nt.vao,"stencil"in nt&&nt.stencil.op&&(nt.stencil.opBack=nt.stencil.opFront=nt.stencil.op,delete nt.stencil.op);function At(Le){if(Le in nt){var lt=nt[Le];delete nt[Le],Object.keys(lt).forEach(function(Ge){nt[Le+"."+Ge]=lt[Ge]})}}return At("blend"),At("depth"),At("cull"),At("stencil"),At("polygonOffset"),At("scissor"),At("sample"),"vao"in gt&&(nt.vao=gt.vao),nt}function io(gt,nt){var At={},Le={};return Object.keys(gt).forEach(function(lt){var Ge=gt[lt];if(Sn.isDynamic(Ge)){Le[lt]=Sn.unbox(Ge,lt);return}else if(nt&&Array.isArray(Ge)){for(var zt=0;zt<Ge.length;++zt)if(Sn.isDynamic(Ge[zt])){Le[lt]=Sn.unbox(Ge,lt);return}}At[lt]=Ge}),{dynamic:Le,static:At}}var bs=io(Yi.context||{},!0),rf=io(Yi.uniforms||{},!0),Ye=io(Yi.attributes||{},!1),dr=io(wa(Yi),!1),qt={gpuTime:0,cpuTime:0,count:0},ei=ci.compile(dr,Ye,rf,bs,qt),Ra=ei.draw,Ze=ei.batch,Ee=ei.scope,ft=[];function Ut(gt){for(;ft.length<gt;)ft.push(null);return ft}function nr(gt,nt){var At;if(Br&&V.raise("context lost"),typeof gt=="function")return Ee.call(this,null,gt,0);if(typeof nt=="function")if(typeof gt=="number")for(At=0;At<gt;++At)Ee.call(this,null,nt,At);else if(Array.isArray(gt))for(At=0;At<gt.length;++At)Ee.call(this,gt[At],nt,At);else return Ee.call(this,gt,nt,0);else if(typeof gt=="number"){if(gt>0)return Ze.call(this,Ut(gt|0),gt|0)}else if(Array.isArray(gt)){if(gt.length)return Ze.call(this,gt,gt.length)}else return Ra.call(this,gt)}return y(nr,{stats:qt,destroy:function(){ei.destroy()}})}var Vs=wr.setFBO=eo({framebuffer:Sn.define.call(null,ed,"framebuffer")});function _s(Yi,wa){var io=0;ci.procs.poll();var bs=wa.color;bs&&(it.clearColor(+bs[0]||0,+bs[1]||0,+bs[2]||0,+bs[3]||0),io|=C0),"depth"in wa&&(it.clearDepth(+wa.depth),io|=wp),"stencil"in wa&&(it.clearStencil(wa.stencil|0),io|=Tp),V(!!io,"called regl.clear with no buffer specified"),it.clear(io)}function Js(Yi){if(V(typeof Yi=="object"&&Yi,"regl.clear() takes an object as input"),"framebuffer"in Yi)if(Yi.framebuffer&&Yi.framebuffer_reglType==="framebufferCube")for(var wa=0;wa<6;++wa)Vs(y({framebuffer:Yi.framebuffer.faces[wa]},Yi),_s);else Vs(Yi,_s);else _s(null,Yi)}function js(Yi){V.type(Yi,"function","regl.frame() callback must be a function"),Dn.push(Yi);function wa(){var io=Cd(Dn,Yi);V(io>=0,"cannot cancel a frame twice");function bs(){var rf=Cd(Dn,bs);Dn[rf]=Dn[Dn.length-1],Dn.length-=1,Dn.length<=0&&Ma()}Dn[io]=bs}return ta(),{cancel:wa}}function xu(){var Yi=un.viewport,wa=un.scissor_box;Yi[0]=Yi[1]=wa[0]=wa[1]=0,tn.viewportWidth=tn.framebufferWidth=tn.drawingBufferWidth=Yi[2]=wa[2]=it.drawingBufferWidth,tn.viewportHeight=tn.framebufferHeight=tn.drawingBufferHeight=Yi[3]=wa[3]=it.drawingBufferHeight}function Qo(){tn.tick+=1,tn.time=xs(),xu(),ci.procs.poll()}function la(){Ii.refresh(),xu(),ci.procs.refresh(),en&&en.update()}function xs(){return(Ga()-sn)/1e3}la();function gr(Yi,wa){V.type(wa,"function","listener callback must be a function");var io;switch(Yi){case"frame":return js(wa);case"lost":io=Qi;break;case"restore":io=Fi;break;case"destroy":io=Rn;break;default:V.raise("invalid event, must be one of frame,lost,restore,destroy")}return io.push(wa),{cancel:function(){for(var bs=0;bs<io.length;++bs)if(io[bs]===wa){io[bs]=io[io.length-1],io.pop();return}}}}var fu=y(eo,{clear:Js,prop:Sn.define.bind(null,ed),context:Sn.define.bind(null,Pf),this:Sn.define.bind(null,Rf),draw:eo({}),buffer:function(Yi){return rn.create(Yi,t0,!1,!1)},elements:function(Yi){return En.create(Yi,!1)},texture:Ii.create2D,cube:Ii.createCube,renderbuffer:Mr.create,framebuffer:wr.create,framebufferCube:wr.createCube,vao:Vr.createVAO,attributes:or,frame:js,on:gr,limits:mr,hasExtension:function(Yi){return mr.extensions.indexOf(Yi.toLowerCase())>=0},read:Nn,destroy:Zs,_gl:it,_refresh:la,poll:function(){Qo(),en&&en.update()},now:xs,stats:Gr});return Pe.onDone(null,fu),fu}return S0})},6158:function(pi){(function(Se,fe){pi.exports=fe()})(this,function(){"use strict";var Se,fe,We;function de(y,Be){if(!Se)Se=Be;else if(!fe)fe=Be;else{var K="var sharedChunk = {}; ("+Se+")(sharedChunk); ("+fe+")(sharedChunk);",ke={};Se(ke),We=Be(ke),typeof window!="undefined"&&(We.workerUrl=window.URL.createObjectURL(new Blob([K],{type:"text/javascript"})))}}return de(["exports"],function(y){"use strict";function Be(n,s){return n(s={exports:{}},s.exports),s.exports}var K=ke;function ke(n,s,l,d){this.cx=3*n,this.bx=3*(l-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=d,this.p2x=l,this.p2y=d}ke.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},ke.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},ke.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},ke.prototype.solveCurveX=function(n,s){var l,d,x,C,T;for(s===void 0&&(s=1e-6),x=n,T=0;T<8;T++){if(C=this.sampleCurveX(x)-n,Math.abs(C)<s)return x;var R=this.sampleCurveDerivativeX(x);if(Math.abs(R)<1e-6)break;x-=C/R}if((x=n)<(l=0))return l;if(x>(d=1))return d;for(;l<d;){if(C=this.sampleCurveX(x),Math.abs(C-n)<s)return x;n>C?l=x:d=x,x=.5*(d-l)+l}return x},ke.prototype.solve=function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))};var he=ut;function ut(n,s){this.x=n,this.y=s}ut.prototype={clone:function(){return new ut(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,s){return this.clone()._rotateAround(n,s)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var s=n.x-this.x,l=n.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,s){return Math.atan2(this.x*s-this.y*n,this.x*n+this.y*s)},_matMult:function(n){var s=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var s=Math.cos(n),l=Math.sin(n),d=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=d,this},_rotateAround:function(n,s){var l=Math.cos(n),d=Math.sin(n),x=s.y+d*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-d*(this.y-s.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ut.convert=function(n){return n instanceof ut?n:Array.isArray(n)?new ut(n[0],n[1]):n};var Ae=typeof self!="undefined"?self:{},Xe=Math.pow(2,53)-1;function Ct(n,s,l,d){var x=new K(n,s,l,d);return function(C){return x.solve(C)}}var Lt=Ct(.25,.1,.25,1);function tr(n,s,l){return Math.min(l,Math.max(s,n))}function Yt(n,s,l){var d=l-s,x=((n-s)%d+d)%d+s;return x===s?l:x}function Xt(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)n[T]=C[T]}return n}var Er=1;function cr(){return Er++}function Rt(){return function n(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Zt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Rr(n,s){n.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function re(n,s){return n.indexOf(s,n.length-s.length)!==-1}function _r(n,s,l){var d={};for(var x in n)d[x]=s.call(l||this,n[x],x,n);return d}function Ot(n,s,l){var d={};for(var x in n)s.call(l||this,n[x],x,n)&&(d[x]=n[x]);return d}function _t(n){return Array.isArray(n)?n.map(_t):typeof n=="object"&&n?_r(n,_t):n}var Kt={};function Ue(n){Kt[n]||(typeof console!="undefined"&&console.warn(n),Kt[n]=!0)}function Cr(n,s,l){return(l.y-n.y)*(s.x-n.x)>(s.y-n.y)*(l.x-n.x)}function nn(n){for(var s=0,l=0,d=n.length,x=d-1,C=void 0,T=void 0;l<d;x=l++)s+=((T=n[x]).x-(C=n[l]).x)*(C.y+T.y);return s}function ue(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tt(n){var s={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,x,C,T){var R=C||T;return s[x]=!R||R.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var Z=null;function _e(n){if(Z==null){var s=n.navigator?n.navigator.userAgent:null;Z=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Z}function ze(n){try{var s=Ae[n];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var wt,Vt,fr,Mt,Fr=Ae.performance&&Ae.performance.now?Ae.performance.now.bind(Ae.performance):Date.now.bind(Date),Xn=Ae.requestAnimationFrame||Ae.mozRequestAnimationFrame||Ae.webkitRequestAnimationFrame||Ae.msRequestAnimationFrame,Jr=Ae.cancelAnimationFrame||Ae.mozCancelAnimationFrame||Ae.webkitCancelAnimationFrame||Ae.msCancelAnimationFrame,Ri={now:Fr,frame:function(n){var s=Xn(n);return{cancel:function(){return Jr(s)}}},getImageData:function(n,s){s===void 0&&(s=0);var l=Ae.document.createElement("canvas"),d=l.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return l.width=n.width,l.height=n.height,d.drawImage(n,0,0,n.width,n.height),d.getImageData(-s,-s,n.width+2*s,n.height+2*s)},resolveURL:function(n){return wt||(wt=Ae.document.createElement("a")),wt.href=n,wt.href},hardwareConcurrency:Ae.navigator&&Ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Ae.devicePixelRatio},get prefersReducedMotion(){return!!Ae.matchMedia&&(Vt==null&&(Vt=Ae.matchMedia("(prefers-reduced-motion: reduce)")),Vt.matches)}},yi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ln={supported:!1,testSupport:function(n){!Sa&&Mt&&(fa?Di(n):fr=n)}},Sa=!1,fa=!1;function Di(n){var s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Mt),n.isContextLost())return;ln.supported=!0}catch(l){}n.deleteTexture(s),Sa=!0}Ae.document&&((Mt=Ae.document.createElement("img")).onload=function(){fr&&Di(fr),fr=null,fa=!0},Mt.onerror=function(){Sa=!0,fr=null},Mt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ia="01",ui=function(n,s){this._transformRequestFn=n,this._customAccessToken=s,this._createSkuToken()};function Ji(n){return n.indexOf("mapbox:")===0}ui.prototype._createSkuToken=function(){var n=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ia,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},ui.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ui.prototype.transformRequest=function(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}},ui.prototype.normalizeStyleURL=function(n,s){if(!Ji(n))return n;var l=Eo(n);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ui.prototype.normalizeGlyphsURL=function(n,s){if(!Ji(n))return n;var l=Eo(n);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ui.prototype.normalizeSourceURL=function(n,s){if(!Ji(n))return n;var l=Eo(n);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},ui.prototype.normalizeSpriteURL=function(n,s,l,d){var x=Eo(n);return Ji(n)?(x.path="/styles/v1"+x.path+"/sprite"+s+l,this._makeAPIURL(x,this._customAccessToken||d)):(x.path+=""+s+l,to(x))},ui.prototype.normalizeTileURL=function(n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ji(n))return n;var l=Eo(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ri.devicePixelRatio>=2||s===512?"@2x":"")+(ln.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var d=this._customAccessToken||function(x){for(var C=0,T=x;C<T.length;C+=1){var R=T[C].match(/^access_token=(.*)$/);if(R)return R[1]}return null}(l.params)||yi.ACCESS_TOKEN;return yi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,d)},ui.prototype.canonicalizeTileURL=function(n,s){var l=Eo(n);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return n;var d="mapbox://tiles/";d+=l.path.replace("/v4/","");var x=l.params;return s&&(x=x.filter(function(C){return!C.match(/^access_token=/)})),x.length&&(d+="?"+x.join("&")),d},ui.prototype.canonicalizeTileset=function(n,s){for(var l=!!s&&Ji(s),d=[],x=0,C=n.tiles||[];x<C.length;x+=1){var T=C[x];_i(T)?d.push(this.canonicalizeTileURL(T,l)):d.push(T)}return d},ui.prototype._makeAPIURL=function(n,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Eo(yi.API_URL);if(n.protocol=d.protocol,n.authority=d.authority,n.protocol==="http"){var x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(d.path!=="/"&&(n.path=""+d.path+n.path),!yi.REQUIRE_ACCESS_TOKEN)return to(n);if(!(s=s||yi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return n.params=n.params.filter(function(C){return C.indexOf("access_token")===-1}),n.params.push("access_token="+s),to(n)};var di=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function _i(n){return di.test(n)}var Uo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Eo(n){var s=n.match(Uo);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function to(n){var s=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+s}function Pt(n){if(!n)return null;var s=n.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(Ae.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var ge=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ge.prototype.getStorageKey=function(n){var s,l=Pt(yi.ACCESS_TOKEN);return s=l&&l.u?Ae.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(d,x){return String.fromCharCode(Number("0x"+x))})):yi.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+s:"mapbox.eventData:"+s},ge.prototype.fetchEventData=function(){var n=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{var d=Ae.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));var x=Ae.localStorage.getItem(l);x&&(this.anonId=x)}catch(C){Ue("Unable to read from LocalStorage")}},ge.prototype.saveEventData=function(){var n=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{Ae.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(d){Ue("Unable to write to LocalStorage")}},ge.prototype.processRequests=function(n){},ge.prototype.postEvent=function(n,s,l,d){var x=this;if(yi.EVENTS_URL){var C=Eo(yi.EVENTS_URL);C.params.push("access_token="+(d||yi.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ia,userId:this.anonId},R=s?Xt(T,s):T,z={url:to(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=ha(z,function(W){x.pendingRequest=null,l(W),x.saveEventData(),x.processRequests(d)})}},ge.prototype.queueRequest=function(n,s){this.queue.push(n),this.processRequests(s)};var oe,we,V=function(n){function s(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,d,x,C){this.skuToken=x,(yi.EVENTS_URL&&C||yi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(T){return Ji(T)||_i(T)}))&&this.queueRequest({id:d,timestamp:Date.now()},C)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),C=x.id,T=x.timestamp;C&&this.success[C]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=Rt()),this.postEvent(T,{skuToken:this.skuToken},function(R){R||C&&(d.success[C]=!0)},l))}},s}(ge),at=new(function(n){function s(l){n.call(this,"appUserTurnstile"),this._customAccessToken=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,d){yi.EVENTS_URL&&yi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(x){return Ji(x)||_i(x)})&&this.queueRequest(Date.now(),d)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Pt(yi.ACCESS_TOKEN),C=x?x.u:yi.ACCESS_TOKEN,T=C!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=Rt(),T=!0);var R=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),W=new Date(R),$=(R-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||z.getDate()!==W.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(R,{"enabled.telemetry":!1},function(ee){ee||(d.eventData.lastSuccess=R,d.eventData.tokenU=C)},l)}},s}(ge)),sr=at.postTurnstileEvent.bind(at),$r=new V,Ke=$r.postMapLoadEvent.bind($r),Nt=500,Sr=50;function xr(){Ae.caches&&!oe&&(oe=Ae.caches.open("mapbox-tiles"))}function Lr(n){var s=n.indexOf("?");return s<0?n:n.slice(0,s)}var gn,mi=1/0;function ii(){return gn==null&&(gn=Ae.OffscreenCanvas&&new Ae.OffscreenCanvas(1,1).getContext("2d")&&typeof Ae.createImageBitmap=="function"),gn}var Sn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Sn);var Bi=function(n){function s(l,d,x){d===401&&_i(x)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,l),this.status=d,this.url=x,this.name=this.constructor.name,this.message=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Vi=ue()?function(){return self.worker&&self.worker.referrer}:function(){return(Ae.location.protocol==="blob:"?Ae.parent:Ae).location.href},Ga,oa,ro=function(n,s){if(!(/^file:/.test(l=n.url)||/^file:/.test(Vi())&&!/^\w+:/.test(l))){if(Ae.fetch&&Ae.Request&&Ae.AbortController&&Ae.Request.prototype.hasOwnProperty("signal"))return function(d,x){var C,T=new Ae.AbortController,R=new Ae.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Vi(),signal:T.signal}),z=!1,W=!1,$=(C=R.url).indexOf("sku=")>0&&_i(C);d.type==="json"&&R.headers.set("Accept","application/json");var ee=function(be,$e,Je){if(!W){if(be&&be.message!=="SecurityError"&&Ue(be),$e&&Je)return le($e);var dt=Date.now();Ae.fetch(R).then(function(st){if(st.ok){var Dt=$?st.clone():null;return le(st,Dt,dt)}return x(new Bi(st.statusText,st.status,d.url))}).catch(function(st){st.code!==20&&x(new Error(st.message))})}},le=function(be,$e,Je){(d.type==="arrayBuffer"?be.arrayBuffer():d.type==="json"?be.json():be.text()).then(function(dt){W||($e&&Je&&function(st,Dt,kt){if(xr(),oe){var lr={status:Dt.status,statusText:Dt.statusText,headers:new Ae.Headers};Dt.headers.forEach(function(zr,hn){return lr.headers.set(hn,zr)});var yr=tt(Dt.headers.get("Cache-Control")||"");yr["no-store"]||(yr["max-age"]&&lr.headers.set("Expires",new Date(kt+1e3*yr["max-age"]).toUTCString()),new Date(lr.headers.get("Expires")).getTime()-kt<42e4||function(zr,hn){if(we===void 0)try{new Response(new ReadableStream),we=!0}catch(Bn){we=!1}we?hn(zr.body):zr.blob().then(hn)}(Dt,function(zr){var hn=new Ae.Response(zr,lr);xr(),oe&&oe.then(function(Bn){return Bn.put(Lr(st.url),hn)}).catch(function(Bn){return Ue(Bn.message)})}))}}(R,$e,Je),z=!0,x(null,dt,be.headers.get("Cache-Control"),be.headers.get("Expires")))}).catch(function(dt){W||x(new Error(dt.message))})};return $?function(be,$e){if(xr(),!oe)return $e(null);var Je=Lr(be.url);oe.then(function(dt){dt.match(Je).then(function(st){var Dt=function(kt){if(!kt)return!1;var lr=new Date(kt.headers.get("Expires")||0),yr=tt(kt.headers.get("Cache-Control")||"");return lr>Date.now()&&!yr["no-cache"]}(st);dt.delete(Je),Dt&&dt.put(Je,st.clone()),$e(null,st,Dt)}).catch($e)}).catch($e)}(R,ee):ee(null,null),{cancel:function(){W=!0,z||T.abort()}}}(n,s);if(ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,s,void 0,!0)}var l;return function(d,x){var C=new Ae.XMLHttpRequest;for(var T in C.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(C.responseType="arraybuffer"),d.headers)C.setRequestHeader(T,d.headers[T]);return d.type==="json"&&(C.responseType="text",C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=function(){x(new Error(C.statusText))},C.onload=function(){if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){var R=C.response;if(d.type==="json")try{R=JSON.parse(C.response)}catch(z){return x(z)}x(null,R,C.getResponseHeader("Cache-Control"),C.getResponseHeader("Expires"))}else x(new Bi(C.statusText,C.status,d.url))},C.send(d.body),{cancel:function(){return C.abort()}}}(n,s)},Si=function(n,s){return ro(Xt(n,{type:"arrayBuffer"}),s)},ha=function(n,s){return ro(Xt(n,{method:"POST"}),s)},Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ga=[],oa=0;var ie=function(n,s){if(ln.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),oa>=yi.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:n,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ga.push(l),l}oa++;var d=!1,x=function(){if(!d)for(d=!0,oa--;Ga.length&&oa<yi.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Ga.shift();T.cancelled||(T.cancel=ie(T.requestParameters,T.callback).cancel)}},C=Si(n,function(T,R,z,W){x(),T?s(T):R&&(ii()?function($,ee){var le=new Ae.Blob([new Uint8Array($)],{type:"image/png"});Ae.createImageBitmap(le).then(function(be){ee(null,be)}).catch(function(be){ee(new Error("Could not load image because of "+be.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(R,s):function($,ee,le,be){var $e=new Ae.Image,Je=Ae.URL;$e.onload=function(){ee(null,$e),Je.revokeObjectURL($e.src),$e.onload=null,Ae.requestAnimationFrame(function(){$e.src=Q})},$e.onerror=function(){return ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var dt=new Ae.Blob([new Uint8Array($)],{type:"image/png"});$e.cacheControl=le,$e.expires=be,$e.src=$.byteLength?Je.createObjectURL(dt):Q}(R,s,z,W))});return{cancel:function(){C.cancel(),x()}}};function me(n,s,l){l[n]&&l[n].indexOf(s)!==-1||(l[n]=l[n]||[],l[n].push(s))}function Ie(n,s,l){if(l&&l[n]){var d=l[n].indexOf(s);d!==-1&&l[n].splice(d,1)}}var qe=function(n,s){s===void 0&&(s={}),Xt(this,s),this.type=n},ot=function(n){function s(l,d){d===void 0&&(d={}),n.call(this,"error",Xt({error:l},d))}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(qe),xt=function(){};xt.prototype.on=function(n,s){return this._listeners=this._listeners||{},me(n,s,this._listeners),this},xt.prototype.off=function(n,s){return Ie(n,s,this._listeners),Ie(n,s,this._oneTimeListeners),this},xt.prototype.once=function(n,s){return this._oneTimeListeners=this._oneTimeListeners||{},me(n,s,this._oneTimeListeners),this},xt.prototype.fire=function(n,s){typeof n=="string"&&(n=new qe(n,s||{}));var l=n.type;if(this.listens(l)){n.target=this;for(var d=0,x=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];d<x.length;d+=1)x[d].call(this,n);for(var C=0,T=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];C<T.length;C+=1){var R=T[C];Ie(l,R,this._oneTimeListeners),R.call(this,n)}var z=this._eventedParent;z&&(Xt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(n))}else n instanceof ot&&console.error(n.error);return this},xt.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},xt.prototype.setEventedParent=function(n,s){return this._eventedParent=n,this._eventedParentData=s,this};var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},rt=function(n,s,l,d){this.message=(n?n+": ":"")+l,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)};function Ht(n){var s=n.value;return s?[new rt(n.key,s,"constants have been deprecated as of v8")]:[]}function Zr(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)n[T]=C[T]}return n}function ar(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function pr(n){if(Array.isArray(n))return n.map(pr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var s={};for(var l in n)s[l]=pr(n[l]);return s}return ar(n)}var Hr=function(n){function s(l,d){n.call(this,d),this.message=d,this.key=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Error),li=function(n,s){s===void 0&&(s=[]),this.parent=n,this.bindings={};for(var l=0,d=s;l<d.length;l+=1){var x=d[l];this.bindings[x[0]]=x[1]}};li.prototype.concat=function(n){return new li(this,n)},li.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},li.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var wn={kind:"null"},er={kind:"number"},Hn={kind:"string"},Tn={kind:"boolean"},Mn={kind:"color"},sa={kind:"object"},Pr={kind:"value"},$i={kind:"collator"},La={kind:"formatted"},ra={kind:"resolvedImage"};function ma(n,s){return{kind:"array",itemType:n,N:s}}function Ft(n){if(n.kind==="array"){var s=Ft(n.itemType);return typeof n.N=="number"?"array<"+s+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+s+">"}return n.kind}var Tt=[wn,er,Hn,Tn,Mn,La,sa,ma(Pr),ra];function ea(n,s){if(s.kind==="error")return null;if(n.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ea(n.itemType,s.itemType))&&(typeof n.N!="number"||n.N===s.N))return null}else{if(n.kind===s.kind)return null;if(n.kind==="value"){for(var l=0,d=Tt;l<d.length;l+=1)if(!ea(d[l],s))return null}}return"Expected "+Ft(n)+" but found "+Ft(s)+" instead."}function lo(n,s){return s.some(function(l){return l.kind===n.kind})}function Na(n,s){return s.some(function(l){return l==="null"?n===null:l==="array"?Array.isArray(n):l==="object"?n&&!Array.isArray(n)&&typeof n=="object":l===typeof n})}var ji=Be(function(n,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(R){return(R=Math.round(R))<0?0:R>255?255:R}function x(R){return d(R[R.length-1]==="%"?parseFloat(R)/100*255:parseInt(R))}function C(R){return(z=R[R.length-1]==="%"?parseFloat(R)/100:parseFloat(R))<0?0:z>1?1:z;var z}function T(R,z,W){return W<0?W+=1:W>1&&(W-=1),6*W<1?R+(z-R)*W*6:2*W<1?z:3*W<2?R+(z-R)*(2/3-W)*6:R}try{s.parseCSSColor=function(R){var z,W=R.replace(/ /g,"").toLowerCase();if(W in l)return l[W].slice();if(W[0]==="#")return W.length===4?(z=parseInt(W.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:W.length===7&&(z=parseInt(W.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var $=W.indexOf("("),ee=W.indexOf(")");if($!==-1&&ee+1===W.length){var le=W.substr(0,$),be=W.substr($+1,ee-($+1)).split(","),$e=1;switch(le){case"rgba":if(be.length!==4)return null;$e=C(be.pop());case"rgb":return be.length!==3?null:[x(be[0]),x(be[1]),x(be[2]),$e];case"hsla":if(be.length!==4)return null;$e=C(be.pop());case"hsl":if(be.length!==3)return null;var Je=(parseFloat(be[0])%360+360)%360/360,dt=C(be[1]),st=C(be[2]),Dt=st<=.5?st*(dt+1):st+dt-st*dt,kt=2*st-Dt;return[d(255*T(kt,Dt,Je+1/3)),d(255*T(kt,Dt,Je)),d(255*T(kt,Dt,Je-1/3)),$e];default:return null}}return null}}catch(R){}}).parseCSSColor,Aa=function(n,s,l,d){d===void 0&&(d=1),this.r=n,this.g=s,this.b=l,this.a=d};Aa.parse=function(n){if(n){if(n instanceof Aa)return n;if(typeof n=="string"){var s=ji(n);if(s)return new Aa(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Aa.prototype.toString=function(){var n=this.toArray(),s=n[1],l=n[2],d=n[3];return"rgba("+Math.round(n[0])+","+Math.round(s)+","+Math.round(l)+","+d+")"},Aa.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},Aa.black=new Aa(0,0,0,1),Aa.white=new Aa(1,1,1,1),Aa.transparent=new Aa(0,0,0,0),Aa.red=new Aa(1,0,0,1);var Co=function(n,s,l){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Co.prototype.compare=function(n,s){return this.collator.compare(n,s)},Co.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var an=function(n,s,l,d,x){this.text=n,this.image=s,this.scale=l,this.fontStack=d,this.textColor=x},Yr=function(n){this.sections=n};Yr.fromString=function(n){return new Yr([new an(n,null,null,null,null)])},Yr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},Yr.factory=function(n){return n instanceof Yr?n:Yr.fromString(n)},Yr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},Yr.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];if(d.image)n.push(["image",d.image.name]);else{n.push(d.text);var x={};d.fontStack&&(x["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(x["font-scale"]=d.scale),d.textColor&&(x["text-color"]=["rgba"].concat(d.textColor.toArray())),n.push(x)}}return n};var bt=function(n){this.name=n.name,this.available=n.available};function Ls(n,s,l,d){return typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[n,s,l,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[n,s,l,d]:[n,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Gt(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Aa||n instanceof Co||n instanceof Yr||n instanceof bt)return!0;if(Array.isArray(n)){for(var s=0,l=n;s<l.length;s+=1)if(!Gt(l[s]))return!1;return!0}if(typeof n=="object"){for(var d in n)if(!Gt(n[d]))return!1;return!0}return!1}function qi(n){if(n===null)return wn;if(typeof n=="string")return Hn;if(typeof n=="boolean")return Tn;if(typeof n=="number")return er;if(n instanceof Aa)return Mn;if(n instanceof Co)return $i;if(n instanceof Yr)return La;if(n instanceof bt)return ra;if(Array.isArray(n)){for(var s,l=n.length,d=0,x=n;d<x.length;d+=1){var C=qi(x[d]);if(s){if(s===C)continue;s=Pr;break}s=C}return ma(s||Pr,l)}return sa}function Kl(n){var s=typeof n;return n===null?"":s==="string"||s==="number"||s==="boolean"?String(n):n instanceof Aa||n instanceof Yr||n instanceof bt?n.toString():JSON.stringify(n)}bt.prototype.toString=function(){return this.name},bt.fromString=function(n){return n?new bt({name:n,available:!1}):null},bt.prototype.serialize=function(){return["image",this.name]};var Oa=function(n,s){this.type=n,this.value=s};Oa.parse=function(n,s){if(n.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!Gt(n[1]))return s.error("invalid value");var l=n[1],d=qi(l),x=s.expectedType;return d.kind!=="array"||d.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(d=x),new Oa(d,l)},Oa.prototype.evaluate=function(){return this.value},Oa.prototype.eachChild=function(){},Oa.prototype.outputDefined=function(){return!0},Oa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Aa?["rgba"].concat(this.value.toArray()):this.value instanceof Yr?this.value.serialize():this.value};var mo=function(n){this.name="ExpressionEvaluationError",this.message=n};mo.prototype.toJSON=function(){return this.message};var Io={string:Hn,number:er,boolean:Tn,object:sa},xa=function(n,s){this.type=n,this.args=s};xa.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l,d=1,x=n[0];if(x==="array"){var C,T;if(n.length>2){var R=n[1];if(typeof R!="string"||!(R in Io)||R==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=Io[R],d++}else C=Pr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=n[2],d++}l=ma(C,T)}else l=Io[x];for(var z=[];d<n.length;d++){var W=s.parse(n[d],d,Pr);if(!W)return null;z.push(W)}return new xa(l,z)},xa.prototype.evaluate=function(n){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(n);if(!ea(this.type,qi(l)))return l;if(s===this.args.length-1)throw new mo("Expected value to be of type "+Ft(this.type)+", but found "+Ft(qi(l))+" instead.")}return null},xa.prototype.eachChild=function(n){this.args.forEach(n)},xa.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},xa.prototype.serialize=function(){var n=this.type,s=[n.kind];if(n.kind==="array"){var l=n.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var d=n.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(function(x){return x.serialize()}))};var Os=function(n){this.type=La,this.sections=n};Os.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var d=[],x=!1,C=1;C<=n.length-1;++C){var T=n[C];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var R=null;if(T["font-scale"]&&!(R=s.parse(T["font-scale"],1,er)))return null;var z=null;if(T["text-font"]&&!(z=s.parse(T["text-font"],1,ma(Hn))))return null;var W=null;if(T["text-color"]&&!(W=s.parse(T["text-color"],1,Mn)))return null;var $=d[d.length-1];$.scale=R,$.font=z,$.textColor=W}else{var ee=s.parse(n[C],1,Pr);if(!ee)return null;var le=ee.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,d.push({content:ee,scale:null,font:null,textColor:null})}}return new Os(d)},Os.prototype.evaluate=function(n){return new Yr(this.sections.map(function(s){var l=s.content.evaluate(n);return qi(l)===ra?new an("",l,null,null,null):new an(Kl(l),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))},Os.prototype.eachChild=function(n){for(var s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n(d.content),d.scale&&n(d.scale),d.font&&n(d.font),d.textColor&&n(d.textColor)}},Os.prototype.outputDefined=function(){return!1},Os.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n.push(d.content.serialize());var x={};d.scale&&(x["font-scale"]=d.scale.serialize()),d.font&&(x["text-font"]=d.font.serialize()),d.textColor&&(x["text-color"]=d.textColor.serialize()),n.push(x)}return n};var Fs=function(n){this.type=ra,this.input=n};Fs.parse=function(n,s){if(n.length!==2)return s.error("Expected two arguments.");var l=s.parse(n[1],1,Hn);return l?new Fs(l):s.error("No image name provided.")},Fs.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=bt.fromString(s);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(s)>-1),l},Fs.prototype.eachChild=function(n){n(this.input)},Fs.prototype.outputDefined=function(){return!1},Fs.prototype.serialize=function(){return["image",this.input.serialize()]};var Ql={"to-boolean":Tn,"to-color":Mn,"to-number":er,"to-string":Hn},So=function(n,s){this.type=n,this.args=s};So.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[0];if((l==="to-boolean"||l==="to-string")&&n.length!==2)return s.error("Expected one argument.");for(var d=Ql[l],x=[],C=1;C<n.length;C++){var T=s.parse(n[C],C,Pr);if(!T)return null;x.push(T)}return new So(d,x)},So.prototype.evaluate=function(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){for(var s,l,d=0,x=this.args;d<x.length;d+=1){if(l=null,(s=x[d].evaluate(n))instanceof Aa)return s;if(typeof s=="string"){var C=n.parseColor(s);if(C)return C}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":Ls(s[0],s[1],s[2],s[3])))return new Aa(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new mo(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var T=null,R=0,z=this.args;R<z.length;R+=1){if((T=z[R].evaluate(n))===null)return 0;var W=Number(T);if(!isNaN(W))return W}throw new mo("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?Yr.fromString(Kl(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?bt.fromString(Kl(this.args[0].evaluate(n))):Kl(this.args[0].evaluate(n))},So.prototype.eachChild=function(n){this.args.forEach(n)},So.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},So.prototype.serialize=function(){if(this.type.kind==="formatted")return new Os([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Fs(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(s){n.push(s.serialize())}),n};var As=["Unknown","Point","LineString","Polygon"],Ka=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ka.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ka.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?As[this.feature.type]:this.feature.type:null},Ka.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ka.prototype.canonicalID=function(){return this.canonical},Ka.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ka.prototype.parseColor=function(n){var s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Aa.parse(n)),s};var Oo=function(n,s,l,d){this.name=n,this.type=s,this._evaluate=l,this.args=d};Oo.prototype.evaluate=function(n){return this._evaluate(n,this.args)},Oo.prototype.eachChild=function(n){this.args.forEach(n)},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},Oo.parse=function(n,s){var l,d=n[0],x=Oo.definitions[d];if(!x)return s.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var C=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,R=T.filter(function(Ci){var ri=Ci[0];return!Array.isArray(ri)||ri.length===n.length-1}),z=null,W=0,$=R;W<$.length;W+=1){var ee=$[W],le=ee[0],be=ee[1];z=new qu(s.registry,s.path,null,s.scope);for(var $e=[],Je=!1,dt=1;dt<n.length;dt++){var st=n[dt],Dt=Array.isArray(le)?le[dt-1]:le.type,kt=z.parse(st,1+$e.length,Dt);if(!kt){Je=!0;break}$e.push(kt)}if(!Je)if(Array.isArray(le)&&le.length!==$e.length)z.error("Expected "+le.length+" arguments, but found "+$e.length+" instead.");else{for(var lr=0;lr<$e.length;lr++){var yr=Array.isArray(le)?le[lr]:le.type,zr=$e[lr];z.concat(lr+1).checkSubtype(yr,zr.type)}if(z.errors.length===0)return new Oo(d,C,be,$e)}}if(R.length===1)(l=s.errors).push.apply(l,z.errors);else{for(var hn=(R.length?R:T).map(function(Ci){var ri;return ri=Ci[0],Array.isArray(ri)?"("+ri.map(Ft).join(", ")+")":"("+Ft(ri.type)+"...)"}).join(" | "),Bn=[],wi=1;wi<n.length;wi++){var $n=s.parse(n[wi],1+Bn.length);if(!$n)return null;Bn.push(Ft($n.type))}s.error("Expected arguments of type "+hn+", but found ("+Bn.join(", ")+") instead.")}return null},Oo.register=function(n,s){for(var l in Oo.definitions=s,s)n[l]=Oo};var ws=function(n,s,l){this.type=$i,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=s};function ko(n,s){n[0]=Math.min(n[0],s[0]),n[1]=Math.min(n[1],s[1]),n[2]=Math.max(n[2],s[0]),n[3]=Math.max(n[3],s[1])}function Yu(n,s){return!(n[0]<=s[0]||n[2]>=s[2]||n[1]<=s[1]||n[3]>=s[3])}function ul(n,s){var l=(180+n[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,x=Math.pow(2,s.z);return[Math.round(l*x*8192),Math.round(d*x*8192)]}function rs(n,s,l){return s[1]>n[1]!=l[1]>n[1]&&n[0]<(l[0]-s[0])*(n[1]-s[1])/(l[1]-s[1])+s[0]}function ve(n,s){for(var l,d,x,C,T,R,z,W=!1,$=0,ee=s.length;$<ee;$++)for(var le=s[$],be=0,$e=le.length;be<$e-1;be++){if((C=(l=n)[0]-(d=le[be])[0])*(z=l[1]-(x=le[be+1])[1])-(R=l[0]-x[0])*(T=l[1]-d[1])==0&&C*R<=0&&T*z<=0)return!1;rs(n,le[be],le[be+1])&&(W=!W)}return W}function De(n,s){for(var l=0;l<s.length;l++)if(ve(n,s[l]))return!0;return!1}function mt(n,s,l,d){var x=d[0]-l[0],C=d[1]-l[1],T=(n[0]-l[0])*C-x*(n[1]-l[1]),R=(s[0]-l[0])*C-x*(s[1]-l[1]);return T>0&&R<0||T<0&&R>0}function ir(n,s,l){for(var d=0,x=l;d<x.length;d+=1)for(var C=x[d],T=0;T<C.length-1;++T)if((ee=[($=C[T+1])[0]-(W=C[T])[0],$[1]-W[1]])[0]*(le=[(z=s)[0]-(R=n)[0],z[1]-R[1]])[1]-ee[1]*le[0]!=0&&mt(R,z,W,$)&&mt(W,$,R,z))return!0;var R,z,W,$,ee,le;return!1}function yn(n,s){for(var l=0;l<n.length;++l)if(!ve(n[l],s))return!1;for(var d=0;d<n.length-1;++d)if(ir(n[d],n[d+1],s))return!1;return!0}function Qn(n,s){for(var l=0;l<s.length;l++)if(yn(n,s[l]))return!0;return!1}function ya(n,s,l){for(var d=[],x=0;x<n.length;x++){for(var C=[],T=0;T<n[x].length;T++){var R=ul(n[x][T],l);ko(s,R),C.push(R)}d.push(C)}return d}function qo(n,s,l){for(var d=[],x=0;x<n.length;x++){var C=ya(n[x],s,l);d.push(C)}return d}function Fa(n,s,l,d){if(n[0]<l[0]||n[0]>l[2]){var x=.5*d,C=n[0]-l[0]>x?-d:l[0]-n[0]>x?d:0;C===0&&(C=n[0]-l[2]>x?-d:l[2]-n[0]>x?d:0),n[0]+=C}ko(s,n)}function Fo(n,s,l,d){for(var x=8192*Math.pow(2,d.z),C=[8192*d.x,8192*d.y],T=[],R=0,z=n;R<z.length;R+=1)for(var W=0,$=z[R];W<$.length;W+=1){var ee=$[W],le=[ee.x+C[0],ee.y+C[1]];Fa(le,s,l,x),T.push(le)}return T}function Zo(n,s,l,d){for(var x,C=8192*Math.pow(2,d.z),T=[8192*d.x,8192*d.y],R=[],z=0,W=n;z<W.length;z+=1){for(var $=[],ee=0,le=W[z];ee<le.length;ee+=1){var be=le[ee],$e=[be.x+T[0],be.y+T[1]];ko(s,$e),$.push($e)}R.push($)}if(s[2]-s[0]<=C/2){(x=s)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var Je=0,dt=R;Je<dt.length;Je+=1)for(var st=0,Dt=dt[Je];st<Dt.length;st+=1)Fa(Dt[st],s,l,C)}return R}ws.parse=function(n,s){if(n.length!==2)return s.error("Expected one argument.");var l=n[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var d=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Tn);if(!d)return null;var x=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Tn);if(!x)return null;var C=null;return l.locale&&!(C=s.parse(l.locale,1,Hn))?null:new ws(d,x,C)},ws.prototype.evaluate=function(n){return new Co(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},ws.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},ws.prototype.outputDefined=function(){return!1},ws.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var To=function(n,s){this.type=Tn,this.geojson=n,this.geometries=s};function Ds(n){if(n instanceof Oo&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof To)return!1;var s=!0;return n.eachChild(function(l){s&&!Ds(l)&&(s=!1)}),s}function cs(n){if(n instanceof Oo&&n.name==="feature-state")return!1;var s=!0;return n.eachChild(function(l){s&&!cs(l)&&(s=!1)}),s}function Ts(n,s){if(n instanceof Oo&&s.indexOf(n.name)>=0)return!1;var l=!0;return n.eachChild(function(d){l&&!Ts(d,s)&&(l=!1)}),l}To.parse=function(n,s){if(n.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(Gt(n[1])){var l=n[1];if(l.type==="FeatureCollection")for(var d=0;d<l.features.length;++d){var x=l.features[d].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new To(l,l.features[d].geometry)}else if(l.type==="Feature"){var C=l.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new To(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new To(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},To.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ya(l.coordinates,x,C),R=Fo(s.geometry(),d,x,C);if(!Yu(d,x))return!1;for(var z=0,W=R;z<W.length;z+=1)if(!ve(W[z],T))return!1}if(l.type==="MultiPolygon"){var $=qo(l.coordinates,x,C),ee=Fo(s.geometry(),d,x,C);if(!Yu(d,x))return!1;for(var le=0,be=ee;le<be.length;le+=1)if(!De(be[le],$))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ya(l.coordinates,x,C),R=Zo(s.geometry(),d,x,C);if(!Yu(d,x))return!1;for(var z=0,W=R;z<W.length;z+=1)if(!yn(W[z],T))return!1}if(l.type==="MultiPolygon"){var $=qo(l.coordinates,x,C),ee=Zo(s.geometry(),d,x,C);if(!Yu(d,x))return!1;for(var le=0,be=ee;le<be.length;le+=1)if(!Qn(be[le],$))return!1}return!0}(n,this.geometries)}return!1},To.prototype.eachChild=function(){},To.prototype.outputDefined=function(){return!0},To.prototype.serialize=function(){return["within",this.geojson]};var Eu=function(n,s){this.type=s.type,this.name=n,this.boundExpression=s};Eu.parse=function(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=n[1];return s.scope.has(l)?new Eu(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},Eu.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},Eu.prototype.eachChild=function(){},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){return["var",this.name]};var qu=function(n,s,l,d,x){s===void 0&&(s=[]),d===void 0&&(d=new li),x===void 0&&(x=[]),this.registry=n,this.path=s,this.key=s.map(function(C){return"["+C+"]"}).join(""),this.scope=d,this.errors=x,this.expectedType=l};function Cu(n,s){for(var l,d=n.length-1,x=0,C=d,T=0;x<=C;)if((l=n[T=Math.floor((x+C)/2)])<=s){if(T===d||s<n[T+1])return T;x=T+1}else{if(!(l>s))throw new mo("Input is not a number.");C=T-1}return 0}qu.prototype.parse=function(n,s,l,d,x){return x===void 0&&(x={}),s?this.concat(s,l,d)._parse(n,x):this._parse(n,x)},qu.prototype._parse=function(n,s){function l(W,$,ee){return ee==="assert"?new xa($,[W]):ee==="coerce"?new So($,[W]):W}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=n[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[d];if(x){var C=x.parse(n,this);if(!C)return null;if(this.expectedType){var T=this.expectedType,R=C.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(T,R))return null}else C=l(C,T,s.typeAnnotation||"coerce");else C=l(C,T,s.typeAnnotation||"assert")}if(!(C instanceof Oa)&&C.type.kind!=="resolvedImage"&&function W($){if($ instanceof Eu)return W($.boundExpression);if($ instanceof Oo&&$.name==="error"||$ instanceof ws||$ instanceof To)return!1;var ee=$ instanceof So||$ instanceof xa,le=!0;return $.eachChild(function(be){le=ee?le&&W(be):le&&be instanceof Oa}),!!le&&Ds($)&&Ts($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(C)){var z=new Ka;try{C=new Oa(C.type,C.evaluate(z))}catch(W){return this.error(W.message),null}}return C}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},qu.prototype.concat=function(n,s,l){var d=typeof n=="number"?this.path.concat(n):this.path,x=l?this.scope.concat(l):this.scope;return new qu(this.registry,d,s||null,x,this.errors)},qu.prototype.error=function(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var d=""+this.key+s.map(function(x){return"["+x+"]"}).join("");this.errors.push(new Hr(d,n))},qu.prototype.checkSubtype=function(n,s){var l=ea(n,s);return l&&this.error(l),l};var Su=function(n,s,l){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(var d=0,x=l;d<x.length;d+=1){var C=x[d],T=C[1];this.labels.push(C[0]),this.outputs.push(T)}};function za(n,s,l){return n*(1-l)+s*l}Su.parse=function(n,s){if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(n[1],1,er);if(!l)return null;var d=[],x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(var C=1;C<n.length;C+=2){var T=C===1?-1/0:n[C],R=n[C+1],z=C,W=C+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(d.length&&d[d.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var $=s.parse(R,W,x);if(!$)return null;x=x||$.type,d.push([T,$])}return new Su(x,l,d)},Su.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var x=s.length;return d>=s[x-1]?l[x-1].evaluate(n):l[Cu(s,d)].evaluate(n)},Su.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Su.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Su.prototype.serialize=function(){for(var n=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n};var fs=Object.freeze({__proto__:null,number:za,color:function(n,s,l){return new Aa(za(n.r,s.r,l),za(n.g,s.g,l),za(n.b,s.b,l),za(n.a,s.a,l))},array:function(n,s,l){return n.map(function(d,x){return za(d,s[x],l)})}}),nu=6/29*3*(6/29),Au=Math.PI/180,uf=180/Math.PI;function Vh(n){return n>.008856451679035631?Math.pow(n,1/3):n/nu+4/29}function Xs(n){return n>6/29?n*n*n:nu*(n-4/29)}function lf(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function ll(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Fc(n){var s=ll(n.r),l=ll(n.g),d=ll(n.b),x=Vh((.4124564*s+.3575761*l+.1804375*d)/.95047),C=Vh((.2126729*s+.7151522*l+.072175*d)/1);return{l:116*C-16,a:500*(x-C),b:200*(C-Vh((.0193339*s+.119192*l+.9503041*d)/1.08883)),alpha:n.a}}function b(n){var s=(n.l+16)/116,l=isNaN(n.a)?s:s+n.a/500,d=isNaN(n.b)?s:s-n.b/200;return s=1*Xs(s),l=.95047*Xs(l),d=1.08883*Xs(d),new Aa(lf(3.2404542*l-1.5371385*s-.4985314*d),lf(-.969266*l+1.8760108*s+.041556*d),lf(.0556434*l-.2040259*s+1.0572252*d),n.alpha)}function k(n,s,l){var d=s-n;return n+l*(d>180||d<-180?d-360*Math.round(d/360):d)}var G={forward:Fc,reverse:b,interpolate:function(n,s,l){return{l:za(n.l,s.l,l),a:za(n.a,s.a,l),b:za(n.b,s.b,l),alpha:za(n.alpha,s.alpha,l)}}},D={forward:function(n){var s=Fc(n),l=s.l,d=s.a,x=s.b,C=Math.atan2(x,d)*uf;return{h:C<0?C+360:C,c:Math.sqrt(d*d+x*x),l,alpha:n.a}},reverse:function(n){var s=n.h*Au,l=n.c;return b({l:n.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:n.alpha})},interpolate:function(n,s,l){return{h:k(n.h,s.h,l),c:za(n.c,s.c,l),l:za(n.l,s.l,l),alpha:za(n.alpha,s.alpha,l)}}},ne=Object.freeze({__proto__:null,lab:G,hcl:D}),Re=function(n,s,l,d,x){this.type=n,this.operator=s,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(var C=0,T=x;C<T.length;C+=1){var R=T[C],z=R[1];this.labels.push(R[0]),this.outputs.push(z)}};function pt(n,s,l,d){var x=d-l,C=n-l;return x===0?0:s===1?C/x:(Math.pow(s,C)-1)/(Math.pow(s,x)-1)}Re.interpolationFactor=function(n,s,l,d){var x=0;if(n.name==="exponential")x=pt(s,n.base,l,d);else if(n.name==="linear")x=pt(s,1,l,d);else if(n.name==="cubic-bezier"){var C=n.controlPoints;x=new K(C[0],C[1],C[2],C[3]).solve(pt(s,1,l,d))}return x},Re.parse=function(n,s){var l=n[0],d=n[1],x=n[2],C=n.slice(3);if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var T=d[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(d[0]),1,0);var R=d.slice(1);if(R.length!==4||R.some(function(dt){return typeof dt!="number"||dt<0||dt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(x=s.parse(x,2,er)))return null;var z=[],W=null;l==="interpolate-hcl"||l==="interpolate-lab"?W=Mn:s.expectedType&&s.expectedType.kind!=="value"&&(W=s.expectedType);for(var $=0;$<C.length;$+=2){var ee=C[$],le=C[$+1],be=$+3,$e=$+4;if(typeof ee!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',be);if(z.length&&z[z.length-1][0]>=ee)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',be);var Je=s.parse(le,$e,W);if(!Je)return null;W=W||Je.type,z.push([ee,Je])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new Re(W,l,d,x,z):s.error("Type "+Ft(W)+" is not interpolatable.")},Re.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var x=s.length;if(d>=s[x-1])return l[x-1].evaluate(n);var C=Cu(s,d),T=Re.interpolationFactor(this.interpolation,d,s[C],s[C+1]),R=l[C].evaluate(n),z=l[C+1].evaluate(n);return this.operator==="interpolate"?fs[this.type.kind.toLowerCase()](R,z,T):this.operator==="interpolate-hcl"?D.reverse(D.interpolate(D.forward(R),D.forward(z),T)):G.reverse(G.interpolate(G.forward(R),G.forward(z),T))},Re.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Re.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Re.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,n,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var It=function(n,s){this.type=n,this.args=s};It.parse=function(n,s){if(n.length<2)return s.error("Expectected at least one argument.");var l=null,d=s.expectedType;d&&d.kind!=="value"&&(l=d);for(var x=[],C=0,T=n.slice(1);C<T.length;C+=1){var R=s.parse(T[C],1+x.length,l,void 0,{typeAnnotation:"omit"});if(!R)return null;l=l||R.type,x.push(R)}var z=d&&x.some(function(W){return ea(d,W.type)});return new It(z?Pr:l,x)},It.prototype.evaluate=function(n){for(var s,l=null,d=0,x=0,C=this.args;x<C.length&&(d++,(l=C[x].evaluate(n))&&l instanceof bt&&!l.available&&(s||(s=l.name),l=null,d===this.args.length&&(l=s)),l===null);x+=1);return l},It.prototype.eachChild=function(n){this.args.forEach(n)},It.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},It.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(s){n.push(s.serialize())}),n};var jt=function(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s};jt.prototype.evaluate=function(n){return this.result.evaluate(n)},jt.prototype.eachChild=function(n){for(var s=0,l=this.bindings;s<l.length;s+=1)n(l[s][1]);n(this.result)},jt.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var l=[],d=1;d<n.length-1;d+=2){var x=n[d];if(typeof x!="string")return s.error("Expected string, but found "+typeof x+" instead.",d);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",d);var C=s.parse(n[d+1],d+1);if(!C)return null;l.push([x,C])}var T=s.parse(n[n.length-1],n.length-1,s.expectedType,l);return T?new jt(l,T):null},jt.prototype.outputDefined=function(){return this.result.outputDefined()},jt.prototype.serialize=function(){for(var n=["let"],s=0,l=this.bindings;s<l.length;s+=1){var d=l[s];n.push(d[0],d[1].serialize())}return n.push(this.result.serialize()),n};var Nr=function(n,s,l){this.type=n,this.index=s,this.input=l};Nr.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,er),d=s.parse(n[2],2,ma(s.expectedType||Pr));return l&&d?new Nr(d.type.itemType,l,d):null},Nr.prototype.evaluate=function(n){var s=this.index.evaluate(n),l=this.input.evaluate(n);if(s<0)throw new mo("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new mo("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new mo("Array index must be an integer, but found "+s+" instead.");return l[s]},Nr.prototype.eachChild=function(n){n(this.index),n(this.input)},Nr.prototype.outputDefined=function(){return!1},Nr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Wr=function(n,s){this.type=Tn,this.needle=n,this.haystack=s};Wr.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Pr),d=s.parse(n[2],2,Pr);return l&&d?lo(l.type,[Tn,Hn,er,wn,Pr])?new Wr(l,d):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ft(l.type)+" instead"):null},Wr.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!l)return!1;if(!Na(s,["boolean","string","number","null"]))throw new mo("Expected first argument to be of type boolean, string, number or null, but found "+Ft(qi(s))+" instead.");if(!Na(l,["string","array"]))throw new mo("Expected second argument to be of type array or string, but found "+Ft(qi(l))+" instead.");return l.indexOf(s)>=0},Wr.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},Wr.prototype.outputDefined=function(){return!0},Wr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Kn=function(n,s,l){this.type=er,this.needle=n,this.haystack=s,this.fromIndex=l};Kn.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Pr),d=s.parse(n[2],2,Pr);if(!l||!d)return null;if(!lo(l.type,[Tn,Hn,er,wn,Pr]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Ft(l.type)+" instead");if(n.length===4){var x=s.parse(n[3],3,er);return x?new Kn(l,d,x):null}return new Kn(l,d)},Kn.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!Na(s,["boolean","string","number","null"]))throw new mo("Expected first argument to be of type boolean, string, number or null, but found "+Ft(qi(s))+" instead.");if(!Na(l,["string","array"]))throw new mo("Expected second argument to be of type array or string, but found "+Ft(qi(l))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(n);return l.indexOf(s,d)}return l.indexOf(s)},Kn.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},Kn.prototype.outputDefined=function(){return!1},Kn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Hi=function(n,s,l,d,x,C){this.inputType=n,this.type=s,this.input=l,this.cases=d,this.outputs=x,this.otherwise=C};Hi.parse=function(n,s){if(n.length<5)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return s.error("Expected an even number of arguments.");var l,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);for(var x={},C=[],T=2;T<n.length-1;T+=2){var R=n[T],z=n[T+1];Array.isArray(R)||(R=[R]);var W=s.concat(T);if(R.length===0)return W.error("Expected at least one branch label.");for(var $=0,ee=R;$<ee.length;$+=1){var le=ee[$];if(typeof le!="number"&&typeof le!="string")return W.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return W.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return W.error("Numeric branch labels must be integer values.");if(l){if(W.checkSubtype(l,qi(le)))return null}else l=qi(le);if(x[String(le)]!==void 0)return W.error("Branch labels must be unique.");x[String(le)]=C.length}var be=s.parse(z,T,d);if(!be)return null;d=d||be.type,C.push(be)}var $e=s.parse(n[1],1,Pr);if(!$e)return null;var Je=s.parse(n[n.length-1],n.length-1,d);return Je?$e.type.kind!=="value"&&s.concat(1).checkSubtype(l,$e.type)?null:new Hi(l,d,$e,x,C,Je):null},Hi.prototype.evaluate=function(n){var s=this.input.evaluate(n);return(qi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)},Hi.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},Hi.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},Hi.prototype.serialize=function(){for(var n=this,s=["match",this.input.serialize()],l=[],d={},x=0,C=Object.keys(this.cases).sort();x<C.length;x+=1){var T=C[x];(ee=d[this.cases[T]])===void 0?(d[this.cases[T]]=l.length,l.push([this.cases[T],[T]])):l[ee][1].push(T)}for(var R=function(be){return n.inputType.kind==="number"?Number(be):be},z=0,W=l;z<W.length;z+=1){var $=W[z],ee=$[0],le=$[1];s.push(le.length===1?R(le[0]):le.map(R)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var Gi=function(n,s,l){this.type=n,this.branches=s,this.otherwise=l};Gi.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var d=[],x=1;x<n.length-1;x+=2){var C=s.parse(n[x],x,Tn);if(!C)return null;var T=s.parse(n[x+1],x+1,l);if(!T)return null;d.push([C,T]),l=l||T.type}var R=s.parse(n[n.length-1],n.length-1,l);return R?new Gi(l,d,R):null},Gi.prototype.evaluate=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];if(d[0].evaluate(n))return x.evaluate(n)}return this.otherwise.evaluate(n)},Gi.prototype.eachChild=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];n(d[0]),n(x)}n(this.otherwise)},Gi.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},Gi.prototype.serialize=function(){var n=["case"];return this.eachChild(function(s){n.push(s.serialize())}),n};var Ni=function(n,s,l,d){this.type=n,this.input=s,this.beginIndex=l,this.endIndex=d};function no(n,s){return n==="=="||n==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function go(n,s,l,d){return d.compare(s,l)===0}function ka(n,s,l){var d=n!=="=="&&n!=="!=";return function(){function x(C,T,R){this.type=Tn,this.lhs=C,this.rhs=T,this.collator=R,this.hasUntypedArgument=C.type.kind==="value"||T.type.kind==="value"}return x.parse=function(C,T){if(C.length!==3&&C.length!==4)return T.error("Expected two or three arguments.");var R=C[0],z=T.parse(C[1],1,Pr);if(!z)return null;if(!no(R,z.type))return T.concat(1).error('"'+R+`" comparisons are not supported for type '`+Ft(z.type)+"'.");var W=T.parse(C[2],2,Pr);if(!W)return null;if(!no(R,W.type))return T.concat(2).error('"'+R+`" comparisons are not supported for type '`+Ft(W.type)+"'.");if(z.type.kind!==W.type.kind&&z.type.kind!=="value"&&W.type.kind!=="value")return T.error("Cannot compare types '"+Ft(z.type)+"' and '"+Ft(W.type)+"'.");d&&(z.type.kind==="value"&&W.type.kind!=="value"?z=new xa(W.type,[z]):z.type.kind!=="value"&&W.type.kind==="value"&&(W=new xa(z.type,[W])));var $=null;if(C.length===4){if(z.type.kind!=="string"&&W.type.kind!=="string"&&z.type.kind!=="value"&&W.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(C[3],3,$i)))return null}return new x(z,W,$)},x.prototype.evaluate=function(C){var T=this.lhs.evaluate(C),R=this.rhs.evaluate(C);if(d&&this.hasUntypedArgument){var z=qi(T),W=qi(R);if(z.kind!==W.kind||z.kind!=="string"&&z.kind!=="number")throw new mo('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+z.kind+", "+W.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var $=qi(T),ee=qi(R);if($.kind!=="string"||ee.kind!=="string")return s(C,T,R)}return this.collator?l(C,T,R,this.collator.evaluate(C)):s(C,T,R)},x.prototype.eachChild=function(C){C(this.lhs),C(this.rhs),this.collator&&C(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var C=[n];return this.eachChild(function(T){C.push(T.serialize())}),C},x}()}Ni.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Pr),d=s.parse(n[2],2,er);if(!l||!d)return null;if(!lo(l.type,[ma(Pr),Hn,Pr]))return s.error("Expected first argument to be of type array or string, but found "+Ft(l.type)+" instead");if(n.length===4){var x=s.parse(n[3],3,er);return x?new Ni(l.type,l,d,x):null}return new Ni(l.type,l,d)},Ni.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!Na(s,["string","array"]))throw new mo("Expected first argument to be of type array or string, but found "+Ft(qi(s))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(n);return s.slice(l,d)}return s.slice(l)},Ni.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},Ni.prototype.outputDefined=function(){return!1},Ni.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var iu=ka("==",function(n,s,l){return s===l},go),Ol=ka("!=",function(n,s,l){return s!==l},function(n,s,l,d){return!go(0,s,l,d)}),fc=ka("<",function(n,s,l){return s<l},function(n,s,l,d){return d.compare(s,l)<0}),hc=ka(">",function(n,s,l){return s>l},function(n,s,l,d){return d.compare(s,l)>0}),pc=ka("<=",function(n,s,l){return s<=l},function(n,s,l,d){return d.compare(s,l)<=0}),dc=ka(">=",function(n,s,l){return s>=l},function(n,s,l,d){return d.compare(s,l)>=0}),Ru=function(n,s,l,d,x){this.type=Hn,this.number=n,this.locale=s,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=x};Ru.parse=function(n,s){if(n.length!==3)return s.error("Expected two arguments.");var l=s.parse(n[1],1,er);if(!l)return null;var d=n[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");var x=null;if(d.locale&&!(x=s.parse(d.locale,1,Hn)))return null;var C=null;if(d.currency&&!(C=s.parse(d.currency,1,Hn)))return null;var T=null;if(d["min-fraction-digits"]&&!(T=s.parse(d["min-fraction-digits"],1,er)))return null;var R=null;return d["max-fraction-digits"]&&!(R=s.parse(d["max-fraction-digits"],1,er))?null:new Ru(l,x,C,T,R)},Ru.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},Ru.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},Ru.prototype.outputDefined=function(){return!1},Ru.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var Fl=function(n){this.type=er,this.input=n};Fl.parse=function(n,s){if(n.length!==2)return s.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Ft(l.type)+" instead."):new Fl(l):null},Fl.prototype.evaluate=function(n){var s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new mo("Expected value to be of type string or array, but found "+Ft(qi(s))+" instead.")},Fl.prototype.eachChild=function(n){n(this.input)},Fl.prototype.outputDefined=function(){return!1},Fl.prototype.serialize=function(){var n=["length"];return this.eachChild(function(s){n.push(s.serialize())}),n};var El={"==":iu,"!=":Ol,">":hc,"<":fc,">=":dc,"<=":pc,array:xa,at:Nr,boolean:xa,case:Gi,coalesce:It,collator:ws,format:Os,image:Fs,in:Wr,"index-of":Kn,interpolate:Re,"interpolate-hcl":Re,"interpolate-lab":Re,length:Fl,let:jt,literal:Oa,match:Hi,number:xa,"number-format":Ru,object:xa,slice:Ni,step:Su,string:xa,"to-boolean":So,"to-color":So,"to-number":So,"to-string":So,var:Eu,within:To};function Vo(n,s){var l=s[0],d=s[1],x=s[2],C=s[3];l=l.evaluate(n),d=d.evaluate(n),x=x.evaluate(n);var T=C?C.evaluate(n):1,R=Ls(l,d,x,T);if(R)throw new mo(R);return new Aa(l/255*T,d/255*T,x/255*T,T)}function vp(n,s){return n in s}function jh(n,s){var l=s[n];return l===void 0?null:l}function wu(n){return{type:n}}function cf(n){return{result:"success",value:n}}function Cl(n){return{result:"error",value:n}}function $u(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Gh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Sl(n){return!!n.expression&&n.expression.interpolated}function yo(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ys(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Hh(n){return n}function Al(n,s,l){return n!==void 0?n:s!==void 0?s:l!==void 0?l:void 0}function mp(n,s,l,d,x){return Al(typeof l===x?d[l]:void 0,n.default,s.default)}function gp(n,s,l){if(yo(l)!=="number")return Al(n.default,s.default);var d=n.stops.length;if(d===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[d-1][0])return n.stops[d-1][1];var x=Cu(n.stops.map(function(C){return C[0]}),l);return n.stops[x][1]}function lh(n,s,l){var d=n.base!==void 0?n.base:1;if(yo(l)!=="number")return Al(n.default,s.default);var x=n.stops.length;if(x===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[x-1][0])return n.stops[x-1][1];var C=Cu(n.stops.map(function(ee){return ee[0]}),l),T=function(ee,le,be,$e){var Je=$e-be,dt=ee-be;return Je===0?0:le===1?dt/Je:(Math.pow(le,dt)-1)/(Math.pow(le,Je)-1)}(l,d,n.stops[C][0],n.stops[C+1][0]),R=n.stops[C][1],z=n.stops[C+1][1],W=fs[s.type]||Hh;if(n.colorSpace&&n.colorSpace!=="rgb"){var $=ne[n.colorSpace];W=function(ee,le){return $.reverse($.interpolate($.forward(ee),$.forward(le),T))}}return typeof R.evaluate=="function"?{evaluate:function(){for(var ee=[],le=arguments.length;le--;)ee[le]=arguments[le];var be=R.evaluate.apply(void 0,ee),$e=z.evaluate.apply(void 0,ee);if(be!==void 0&&$e!==void 0)return W(be,$e,T)}}:W(R,z,T)}function Nf(n,s,l){return s.type==="color"?l=Aa.parse(l):s.type==="formatted"?l=Yr.fromString(l.toString()):s.type==="resolvedImage"?l=bt.fromString(l.toString()):yo(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),Al(l,n.default,s.default)}Oo.register(El,{error:[{kind:"error"},[Hn],function(n,s){throw new mo(s[0].evaluate(n))}],typeof:[Hn,[Pr],function(n,s){return Ft(qi(s[0].evaluate(n)))}],"to-rgba":[ma(er,4),[Mn],function(n,s){return s[0].evaluate(n).toArray()}],rgb:[Mn,[er,er,er],Vo],rgba:[Mn,[er,er,er,er],Vo],has:{type:Tn,overloads:[[[Hn],function(n,s){return vp(s[0].evaluate(n),n.properties())}],[[Hn,sa],function(n,s){var l=s[1];return vp(s[0].evaluate(n),l.evaluate(n))}]]},get:{type:Pr,overloads:[[[Hn],function(n,s){return jh(s[0].evaluate(n),n.properties())}],[[Hn,sa],function(n,s){var l=s[1];return jh(s[0].evaluate(n),l.evaluate(n))}]]},"feature-state":[Pr,[Hn],function(n,s){return jh(s[0].evaluate(n),n.featureState||{})}],properties:[sa,[],function(n){return n.properties()}],"geometry-type":[Hn,[],function(n){return n.geometryType()}],id:[Pr,[],function(n){return n.id()}],zoom:[er,[],function(n){return n.globals.zoom}],"heatmap-density":[er,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[er,[],function(n){return n.globals.lineProgress||0}],accumulated:[Pr,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[er,wu(er),function(n,s){for(var l=0,d=0,x=s;d<x.length;d+=1)l+=x[d].evaluate(n);return l}],"*":[er,wu(er),function(n,s){for(var l=1,d=0,x=s;d<x.length;d+=1)l*=x[d].evaluate(n);return l}],"-":{type:er,overloads:[[[er,er],function(n,s){var l=s[1];return s[0].evaluate(n)-l.evaluate(n)}],[[er],function(n,s){return-s[0].evaluate(n)}]]},"/":[er,[er,er],function(n,s){var l=s[1];return s[0].evaluate(n)/l.evaluate(n)}],"%":[er,[er,er],function(n,s){var l=s[1];return s[0].evaluate(n)%l.evaluate(n)}],ln2:[er,[],function(){return Math.LN2}],pi:[er,[],function(){return Math.PI}],e:[er,[],function(){return Math.E}],"^":[er,[er,er],function(n,s){var l=s[1];return Math.pow(s[0].evaluate(n),l.evaluate(n))}],sqrt:[er,[er],function(n,s){return Math.sqrt(s[0].evaluate(n))}],log10:[er,[er],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN10}],ln:[er,[er],function(n,s){return Math.log(s[0].evaluate(n))}],log2:[er,[er],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN2}],sin:[er,[er],function(n,s){return Math.sin(s[0].evaluate(n))}],cos:[er,[er],function(n,s){return Math.cos(s[0].evaluate(n))}],tan:[er,[er],function(n,s){return Math.tan(s[0].evaluate(n))}],asin:[er,[er],function(n,s){return Math.asin(s[0].evaluate(n))}],acos:[er,[er],function(n,s){return Math.acos(s[0].evaluate(n))}],atan:[er,[er],function(n,s){return Math.atan(s[0].evaluate(n))}],min:[er,wu(er),function(n,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(n)}))}],max:[er,wu(er),function(n,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(n)}))}],abs:[er,[er],function(n,s){return Math.abs(s[0].evaluate(n))}],round:[er,[er],function(n,s){var l=s[0].evaluate(n);return l<0?-Math.round(-l):Math.round(l)}],floor:[er,[er],function(n,s){return Math.floor(s[0].evaluate(n))}],ceil:[er,[er],function(n,s){return Math.ceil(s[0].evaluate(n))}],"filter-==":[Tn,[Hn,Pr],function(n,s){var l=s[0],d=s[1];return n.properties()[l.value]===d.value}],"filter-id-==":[Tn,[Pr],function(n,s){var l=s[0];return n.id()===l.value}],"filter-type-==":[Tn,[Hn],function(n,s){var l=s[0];return n.geometryType()===l.value}],"filter-<":[Tn,[Hn,Pr],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x<C}],"filter-id-<":[Tn,[Pr],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d<x}],"filter->":[Tn,[Hn,Pr],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x>C}],"filter-id->":[Tn,[Pr],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d>x}],"filter-<=":[Tn,[Hn,Pr],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x<=C}],"filter-id-<=":[Tn,[Pr],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d<=x}],"filter->=":[Tn,[Hn,Pr],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x>=C}],"filter-id->=":[Tn,[Pr],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d>=x}],"filter-has":[Tn,[Pr],function(n,s){return s[0].value in n.properties()}],"filter-has-id":[Tn,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[Tn,[ma(Hn)],function(n,s){return s[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[Tn,[ma(Pr)],function(n,s){return s[0].value.indexOf(n.id())>=0}],"filter-in-small":[Tn,[Hn,ma(Pr)],function(n,s){var l=s[0];return s[1].value.indexOf(n.properties()[l.value])>=0}],"filter-in-large":[Tn,[Hn,ma(Pr)],function(n,s){var l=s[0],d=s[1];return function(x,C,T,R){for(;T<=R;){var z=T+R>>1;if(C[z]===x)return!0;C[z]>x?R=z-1:T=z+1}return!1}(n.properties()[l.value],d.value,0,d.value.length-1)}],all:{type:Tn,overloads:[[[Tn,Tn],function(n,s){var l=s[1];return s[0].evaluate(n)&&l.evaluate(n)}],[wu(Tn),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(!d[l].evaluate(n))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],function(n,s){var l=s[1];return s[0].evaluate(n)||l.evaluate(n)}],[wu(Tn),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(d[l].evaluate(n))return!0;return!1}]]},"!":[Tn,[Tn],function(n,s){return!s[0].evaluate(n)}],"is-supported-script":[Tn,[Hn],function(n,s){var l=n.globals&&n.globals.isSupportedScript;return!l||l(s[0].evaluate(n))}],upcase:[Hn,[Hn],function(n,s){return s[0].evaluate(n).toUpperCase()}],downcase:[Hn,[Hn],function(n,s){return s[0].evaluate(n).toLowerCase()}],concat:[Hn,wu(Pr),function(n,s){return s.map(function(l){return Kl(l.evaluate(n))}).join("")}],"resolved-locale":[Hn,[$i],function(n,s){return s[0].evaluate(n).resolvedLocale()}]});var ff=function(n,s){this.expression=n,this._warningHistory={},this._evaluator=new Ka,this._defaultValue=s?function(l){return l.type==="color"&&Ys(l.default)?new Aa(0,0,0,0):l.type==="color"?Aa.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function zf(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in El}function Dc(n,s){var l=new qu(El,[],s?function(x){var C={color:Mn,string:Hn,number:er,enum:Hn,boolean:Tn,formatted:La,resolvedImage:ra};return x.type==="array"?ma(C[x.value]||Pr,x.length):C[x.type]}(s):void 0),d=l.parse(n,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?cf(new ff(d,s)):Cl(l.errors)}ff.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)},ff.prototype.evaluate=function(n,s,l,d,x,C){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new mo("Expected value to be one of "+Object.keys(this._enumValues).map(function(R){return JSON.stringify(R)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console!="undefined"&&console.warn(R.message)),this._defaultValue}};var Uf=function(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!cs(s.expression)};Uf.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,x,C)},Uf.prototype.evaluate=function(n,s,l,d,x,C){return this._styleExpression.evaluate(n,s,l,d,x,C)};var vc=function(n,s,l,d){this.kind=n,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!cs(s.expression),this.interpolationType=d};function hf(n,s){if((n=Dc(n,s)).result==="error")return n;var l=n.value.expression,d=Ds(l);if(!d&&!$u(s))return Cl([new Hr("","data expressions not supported")]);var x=Ts(l,["zoom"]);if(!x&&!Gh(s))return Cl([new Hr("","zoom expressions not supported")]);var C=function T(R){var z=null;if(R instanceof jt)z=T(R.result);else if(R instanceof It)for(var W=0,$=R.args;W<$.length&&!(z=T($[W]));W+=1);else(R instanceof Su||R instanceof Re)&&R.input instanceof Oo&&R.input.name==="zoom"&&(z=R);return z instanceof Hr||R.eachChild(function(ee){var le=T(ee);le instanceof Hr?z=le:!z&&le?z=new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&le&&z!==le&&(z=new Hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(l);return C||x?C instanceof Hr?Cl([C]):C instanceof Re&&!Sl(s)?Cl([new Hr("",'"interpolate" expressions cannot be used with this property')]):cf(C?new vc(d?"camera":"composite",n.value,C.labels,C instanceof Re?C.interpolation:void 0):new Uf(d?"constant":"source",n.value)):Cl([new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}vc.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,x,C)},vc.prototype.evaluate=function(n,s,l,d,x,C){return this._styleExpression.evaluate(n,s,l,d,x,C)},vc.prototype.interpolationFactor=function(n,s,l){return this.interpolationType?Re.interpolationFactor(this.interpolationType,n,s,l):0};var Jl=function(n,s){this._parameters=n,this._specification=s,Zr(this,function l(d,x){var C,T,R,z=x.type==="color",W=d.stops&&typeof d.stops[0][0]=="object",$=W||!(W||d.property!==void 0),ee=d.type||(Sl(x)?"exponential":"interval");if(z&&((d=Zr({},d)).stops&&(d.stops=d.stops.map(function($n){return[$n[0],Aa.parse($n[1])]})),d.default=Aa.parse(d.default?d.default:x.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!ne[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(ee==="exponential")C=lh;else if(ee==="interval")C=gp;else if(ee==="categorical"){C=mp,T=Object.create(null);for(var le=0,be=d.stops;le<be.length;le+=1){var $e=be[le];T[$e[0]]=$e[1]}R=typeof d.stops[0][0]}else{if(ee!=="identity")throw new Error('Unknown function type "'+ee+'"');C=Nf}if(W){for(var Je={},dt=[],st=0;st<d.stops.length;st++){var Dt=d.stops[st],kt=Dt[0].zoom;Je[kt]===void 0&&(Je[kt]={zoom:kt,type:d.type,property:d.property,default:d.default,stops:[]},dt.push(kt)),Je[kt].stops.push([Dt[0].value,Dt[1]])}for(var lr=[],yr=0,zr=dt;yr<zr.length;yr+=1){var hn=zr[yr];lr.push([Je[hn].zoom,l(Je[hn],x)])}var Bn={name:"linear"};return{kind:"composite",interpolationType:Bn,interpolationFactor:Re.interpolationFactor.bind(void 0,Bn),zoomStops:lr.map(function($n){return $n[0]}),evaluate:function($n,Ci){var ri=$n.zoom;return lh({stops:lr,base:d.base},x,ri).evaluate(ri,Ci)}}}if($){var wi=ee==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:wi,interpolationFactor:Re.interpolationFactor.bind(void 0,wi),zoomStops:d.stops.map(function($n){return $n[0]}),evaluate:function($n){return C(d,x,$n.zoom,T,R)}}}return{kind:"source",evaluate:function($n,Ci){var ri=Ci&&Ci.properties?Ci.properties[d.property]:void 0;return ri===void 0?Al(d.default,x.default):C(d,x,ri,T,R)}}}(this._parameters,this._specification))};function au(n){var s=n.key,l=n.value,d=n.valueSpec||{},x=n.objectElementValidators||{},C=n.style,T=n.styleSpec,R=[],z=yo(l);if(z!=="object")return[new rt(s,l,"object expected, "+z+" found")];for(var W in l){var $=W.split(".")[0],ee=d[$]||d["*"],le=void 0;if(x[$])le=x[$];else if(d[$])le=Ta;else if(x["*"])le=x["*"];else{if(!d["*"]){R.push(new rt(s,l[W],'unknown property "'+W+'"'));continue}le=Ta}R=R.concat(le({key:(s&&s+".")+W,value:l[W],valueSpec:ee,style:C,styleSpec:T,object:l,objectKey:W},l))}for(var be in d)x[be]||d[be].required&&d[be].default===void 0&&l[be]===void 0&&R.push(new rt(s,l,'missing required property "'+be+'"'));return R}function Zf(n){var s=n.value,l=n.valueSpec,d=n.style,x=n.styleSpec,C=n.key,T=n.arrayElementValidator||Ta;if(yo(s)!=="array")return[new rt(C,s,"array expected, "+yo(s)+" found")];if(l.length&&s.length!==l.length)return[new rt(C,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new rt(C,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var R={type:l.value,values:l.values};x.$version<7&&(R.function=l.function),yo(l.value)==="object"&&(R=l.value);for(var z=[],W=0;W<s.length;W++)z=z.concat(T({array:s,arrayIndex:W,value:s[W],valueSpec:R,style:d,styleSpec:x,key:C+"["+W+"]"}));return z}function Vf(n){var s=n.key,l=n.value,d=n.valueSpec,x=yo(l);return x==="number"&&l!=l&&(x="NaN"),x!=="number"?[new rt(s,l,"number expected, "+x+" found")]:"minimum"in d&&l<d.minimum?[new rt(s,l,l+" is less than the minimum value "+d.minimum)]:"maximum"in d&&l>d.maximum?[new rt(s,l,l+" is greater than the maximum value "+d.maximum)]:[]}function Wh(n){var s,l,d,x=n.valueSpec,C=ar(n.value.type),T={},R=C!=="categorical"&&n.value.property===void 0,z=!R,W=yo(n.value.stops)==="array"&&yo(n.value.stops[0])==="array"&&yo(n.value.stops[0][0])==="object",$=au({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(be){if(C==="identity")return[new rt(be.key,be.value,'identity function may not have a "stops" property')];var $e=[],Je=be.value;return $e=$e.concat(Zf({key:be.key,value:Je,valueSpec:be.valueSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:ee})),yo(Je)==="array"&&Je.length===0&&$e.push(new rt(be.key,Je,"array must have at least one stop")),$e},default:function(be){return Ta({key:be.key,value:be.value,valueSpec:x,style:be.style,styleSpec:be.styleSpec})}}});return C==="identity"&&R&&$.push(new rt(n.key,n.value,'missing required property "property"')),C==="identity"||n.value.stops||$.push(new rt(n.key,n.value,'missing required property "stops"')),C==="exponential"&&n.valueSpec.expression&&!Sl(n.valueSpec)&&$.push(new rt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(z&&!$u(n.valueSpec)?$.push(new rt(n.key,n.value,"property functions not supported")):R&&!Gh(n.valueSpec)&&$.push(new rt(n.key,n.value,"zoom functions not supported"))),C!=="categorical"&&!W||n.value.property!==void 0||$.push(new rt(n.key,n.value,'"property" property is required')),$;function ee(be){var $e=[],Je=be.value,dt=be.key;if(yo(Je)!=="array")return[new rt(dt,Je,"array expected, "+yo(Je)+" found")];if(Je.length!==2)return[new rt(dt,Je,"array length 2 expected, length "+Je.length+" found")];if(W){if(yo(Je[0])!=="object")return[new rt(dt,Je,"object expected, "+yo(Je[0])+" found")];if(Je[0].zoom===void 0)return[new rt(dt,Je,"object stop key must have zoom")];if(Je[0].value===void 0)return[new rt(dt,Je,"object stop key must have value")];if(d&&d>ar(Je[0].zoom))return[new rt(dt,Je[0].zoom,"stop zoom values must appear in ascending order")];ar(Je[0].zoom)!==d&&(d=ar(Je[0].zoom),l=void 0,T={}),$e=$e.concat(au({key:dt+"[0]",value:Je[0],valueSpec:{zoom:{}},style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:Vf,value:le}}))}else $e=$e.concat(le({key:dt+"[0]",value:Je[0],valueSpec:{},style:be.style,styleSpec:be.styleSpec},Je));return zf(pr(Je[1]))?$e.concat([new rt(dt+"[1]",Je[1],"expressions are not allowed in function stops.")]):$e.concat(Ta({key:dt+"[1]",value:Je[1],valueSpec:x,style:be.style,styleSpec:be.styleSpec}))}function le(be,$e){var Je=yo(be.value),dt=ar(be.value),st=be.value!==null?be.value:$e;if(s){if(Je!==s)return[new rt(be.key,st,Je+" stop domain type must match previous stop domain type "+s)]}else s=Je;if(Je!=="number"&&Je!=="string"&&Je!=="boolean")return[new rt(be.key,st,"stop domain value must be a number, string, or boolean")];if(Je!=="number"&&C!=="categorical"){var Dt="number expected, "+Je+" found";return $u(x)&&C===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(be.key,st,Dt)]}return C!=="categorical"||Je!=="number"||isFinite(dt)&&Math.floor(dt)===dt?C!=="categorical"&&Je==="number"&&l!==void 0&&dt<l?[new rt(be.key,st,"stop domain values must appear in ascending order")]:(l=dt,C==="categorical"&&dt in T?[new rt(be.key,st,"stop domain values must be unique")]:(T[dt]=!0,[])):[new rt(be.key,st,"integer expected, found "+dt)]}}function mc(n){var s=(n.expressionContext==="property"?hf:Dc)(pr(n.value),n.valueSpec);if(s.result==="error")return s.value.map(function(d){return new rt(""+n.key+d.key,n.value,d.message)});var l=s.value.expression||s.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!l.outputDefined())return[new rt(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!cs(l))return[new rt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!cs(l))return[new rt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Ts(l,["zoom","feature-state"]))return[new rt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ds(l))return[new rt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ku(n){var s=n.key,l=n.value,d=n.valueSpec,x=[];return Array.isArray(d.values)?d.values.indexOf(ar(l))===-1&&x.push(new rt(s,l,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(d.values).indexOf(ar(l))===-1&&x.push(new rt(s,l,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(l)+" found")),x}function Dl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var s=0,l=n.slice(1);s<l.length;s+=1){var d=l[s];if(!Dl(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}Jl.deserialize=function(n){return new Jl(n._parameters,n._specification)},Jl.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var Bc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ec(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};Dl(n)||(n=Gf(n));var s=Dc(n,Bc);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,d,x){return s.value.evaluate(l,d,{},x)},needGeometry:function l(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var x=1;x<d.length;x++)if(l(d[x]))return!0;return!1}(n)}}function jf(n,s){return n<s?-1:n>s?1:0}function Gf(n){if(!n)return!0;var s,l=n[0];return n.length<=1?l!=="any":l==="=="?gc(n[1],n[2],"=="):l==="!="?Nc(gc(n[1],n[2],"==")):l==="<"||l===">"||l==="<="||l===">="?gc(n[1],n[2],l):l==="any"?(s=n.slice(1),["any"].concat(s.map(Gf))):l==="all"?["all"].concat(n.slice(1).map(Gf)):l==="none"?["all"].concat(n.slice(1).map(Gf).map(Nc)):l==="in"?Xh(n[1],n.slice(2)):l==="!in"?Nc(Xh(n[1],n.slice(2))):l==="has"?ch(n[1]):l==="!has"?Nc(ch(n[1])):l!=="within"||n}function gc(n,s,l){switch(n){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,n,s]}}function Xh(n,s){if(s.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",n,["literal",s.sort(jf)]]:["filter-in-small",n,["literal",s]]}}function ch(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Nc(n){return["!",n]}function Xp(n){return Dl(pr(n.value))?mc(Zr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var d=l.value,x=l.key;if(yo(d)!=="array")return[new rt(x,d,"array expected, "+yo(d)+" found")];var C,T=l.styleSpec,R=[];if(d.length<1)return[new rt(x,d,"filter array must have at least 1 element")];switch(R=R.concat(Ku({key:x+"[0]",value:d[0],valueSpec:T.filter_operator,style:l.style,styleSpec:l.styleSpec})),ar(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&ar(d[1])==="$type"&&R.push(new rt(x,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&R.push(new rt(x,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(C=yo(d[1]))!=="string"&&R.push(new rt(x+"[1]",d[1],"string expected, "+C+" found"));for(var z=2;z<d.length;z++)C=yo(d[z]),ar(d[1])==="$type"?R=R.concat(Ku({key:x+"["+z+"]",value:d[z],valueSpec:T.geometry_type,style:l.style,styleSpec:l.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&R.push(new rt(x+"["+z+"]",d[z],"string, number, or boolean expected, "+C+" found"));break;case"any":case"all":case"none":for(var W=1;W<d.length;W++)R=R.concat(s({key:x+"["+W+"]",value:d[W],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":C=yo(d[1]),d.length!==2?R.push(new rt(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="string"&&R.push(new rt(x+"[1]",d[1],"string expected, "+C+" found"));break;case"within":C=yo(d[1]),d.length!==2?R.push(new rt(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="object"&&R.push(new rt(x+"[1]",d[1],"object expected, "+C+" found"))}return R}(n)}function fh(n,s){var l=n.key,d=n.style,x=n.styleSpec,C=n.value,T=n.objectKey,R=x[s+"_"+n.layerType];if(!R)return[];var z=T.match(/^(.*)-transition$/);if(s==="paint"&&z&&R[z[1]]&&R[z[1]].transition)return Ta({key:l,value:C,valueSpec:x.transition,style:d,styleSpec:x});var W,$=n.valueSpec||R[T];if(!$)return[new rt(l,C,'unknown property "'+T+'"')];if(yo(C)==="string"&&$u($)&&!$.tokens&&(W=/^{([^}]+)}$/.exec(C)))return[new rt(l,C,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(W[1])+" }`.")];var ee=[];return n.layerType==="symbol"&&(T==="text-field"&&d&&!d.glyphs&&ee.push(new rt(l,C,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Ys(pr(C))&&ar(C.type)==="identity"&&ee.push(new rt(l,C,'"text-font" does not support identity functions'))),ee.concat(Ta({key:n.key,value:C,valueSpec:$,style:d,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function Yh(n){return fh(n,"paint")}function pf(n){return fh(n,"layout")}function Yp(n){var s=[],l=n.value,d=n.key,x=n.style,C=n.styleSpec;l.type||l.ref||s.push(new rt(d,l,'either "type" or "ref" is required'));var T,R=ar(l.type),z=ar(l.ref);if(l.id)for(var W=ar(l.id),$=0;$<n.arrayIndex;$++){var ee=x.layers[$];ar(ee.id)===W&&s.push(new rt(d,l.id,'duplicate layer id "'+l.id+'", previously used at line '+ee.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function($e){$e in l&&s.push(new rt(d,l[$e],'"'+$e+'" is prohibited for ref layers'))}),x.layers.forEach(function($e){ar($e.id)===z&&(T=$e)}),T?T.ref?s.push(new rt(d,l.ref,"ref cannot reference another ref layer")):R=ar(T.type):s.push(new rt(d,l.ref,'ref layer "'+z+'" not found'));else if(R!=="background")if(l.source){var le=x.sources&&x.sources[l.source],be=le&&ar(le.type);le?be==="vector"&&R==="raster"?s.push(new rt(d,l.source,'layer "'+l.id+'" requires a raster source')):be==="raster"&&R!=="raster"?s.push(new rt(d,l.source,'layer "'+l.id+'" requires a vector source')):be!=="vector"||l["source-layer"]?be==="raster-dem"&&R!=="hillshade"?s.push(new rt(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!l.paint||!l.paint["line-gradient"]||be==="geojson"&&le.lineMetrics||s.push(new rt(d,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new rt(d,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new rt(d,l.source,'source "'+l.source+'" not found'))}else s.push(new rt(d,l,'missing required property "source"'));return s=s.concat(au({key:d,value:l,valueSpec:C.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ta({key:d+".type",value:l.type,valueSpec:C.layer.type,style:n.style,styleSpec:n.styleSpec,object:l,objectKey:"type"})},filter:Xp,layout:function($e){return au({layer:l,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(Je){return pf(Zr({layerType:R},Je))}}})},paint:function($e){return au({layer:l,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(Je){return Yh(Zr({layerType:R},Je))}}})}}}))}function zc(n){var s=n.value,l=n.key,d=yo(s);return d!=="string"?[new rt(l,s,"string expected, "+d+" found")]:[]}var Ao={promoteId:function(n){var s=n.key,l=n.value;if(yo(l)==="string")return zc({key:s,value:l});var d=[];for(var x in l)d.push.apply(d,zc({key:s+"."+x,value:l[x]}));return d}};function Bs(n){var s=n.value,l=n.key,d=n.styleSpec,x=n.style;if(!s.type)return[new rt(l,s,'"type" is required')];var C,T=ar(s.type);switch(T){case"vector":case"raster":case"raster-dem":return au({key:l,value:s,valueSpec:d["source_"+T.replace("-","_")],style:n.style,styleSpec:d,objectElementValidators:Ao});case"geojson":if(C=au({key:l,value:s,valueSpec:d.source_geojson,style:x,styleSpec:d,objectElementValidators:Ao}),s.cluster)for(var R in s.clusterProperties){var z=s.clusterProperties[R],W=z[0],$=typeof W=="string"?[W,["accumulated"],["get",R]]:W;C.push.apply(C,mc({key:l+"."+R+".map",value:z[1],expressionContext:"cluster-map"})),C.push.apply(C,mc({key:l+"."+R+".reduce",value:$,expressionContext:"cluster-reduce"}))}return C;case"video":return au({key:l,value:s,valueSpec:d.source_video,style:x,styleSpec:d});case"image":return au({key:l,value:s,valueSpec:d.source_image,style:x,styleSpec:d});case"canvas":return[new rt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ku({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:d})}}function Uc(n){var s=n.value,l=n.styleSpec,d=l.light,x=n.style,C=[],T=yo(s);if(s===void 0)return C;if(T!=="object")return C.concat([new rt("light",s,"object expected, "+T+" found")]);for(var R in s){var z=R.match(/^(.*)-transition$/);C=C.concat(z&&d[z[1]]&&d[z[1]].transition?Ta({key:R,value:s[R],valueSpec:l.transition,style:x,styleSpec:l}):d[R]?Ta({key:R,value:s[R],valueSpec:d[R],style:x,styleSpec:l}):[new rt(R,s[R],'unknown property "'+R+'"')])}return C}var Pa={"*":function(){return[]},array:Zf,boolean:function(n){var s=n.value,l=n.key,d=yo(s);return d!=="boolean"?[new rt(l,s,"boolean expected, "+d+" found")]:[]},number:Vf,color:function(n){var s=n.key,l=n.value,d=yo(l);return d!=="string"?[new rt(s,l,"color expected, "+d+" found")]:ji(l)===null?[new rt(s,l,'color expected, "'+l+'" found')]:[]},constants:Ht,enum:Ku,filter:Xp,function:Wh,layer:Yp,object:au,source:Bs,light:Uc,string:zc,formatted:function(n){return zc(n).length===0?[]:mc(n)},resolvedImage:function(n){return zc(n).length===0?[]:mc(n)}};function Ta(n){var s=n.value,l=n.valueSpec,d=n.styleSpec;return l.expression&&Ys(ar(s))?Wh(n):l.expression&&zf(pr(s))?mc(n):l.type&&Pa[l.type]?Pa[l.type](n):au(Zr({},n,{valueSpec:l.type?d[l.type]:l}))}function wo(n){var s=n.value,l=n.key,d=zc(n);return d.length||(s.indexOf("{fontstack}")===-1&&d.push(new rt(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&d.push(new rt(l,s,'"glyphs" url must include a "{range}" token'))),d}function vu(n,s){s===void 0&&(s=Te);var l=[];return l=l.concat(Ta({key:"",value:n,valueSpec:s.$root,styleSpec:s,style:n,objectElementValidators:{glyphs:wo,"*":function(){return[]}}})),n.constants&&(l=l.concat(Ht({key:"constants",value:n.constants,style:n,styleSpec:s}))),df(l)}function df(n){return[].concat(n).sort(function(s,l){return s.line-l.line})}function tc(n){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return df(n.apply(this,s))}}vu.source=tc(Bs),vu.light=tc(Uc),vu.layer=tc(Yp),vu.filter=tc(Xp),vu.paintProperty=tc(Yh),vu.layoutProperty=tc(pf);var hh=vu,Qa=hh.light,vf=hh.paintProperty,Bl=hh.layoutProperty;function yc(n,s){var l=!1;if(s&&s.length)for(var d=0,x=s;d<x.length;d+=1)n.fire(new ot(new Error(x[d].message))),l=!0;return l}var rc=hs;function hs(n,s,l){var d=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(s=x[1])+2*(l=x[2]);for(var C=0;C<this.d*this.d;C++){var T=x[3+C],R=x[3+C+1];d.push(T===R?null:x.subarray(T,R))}var z=x[3+d.length+1];this.keys=x.subarray(x[3+d.length],z),this.bboxes=x.subarray(z),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var W=0;W<this.d*this.d;W++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=l,this.scale=s/n,this.uid=0;var $=l/s*n;this.min=-$,this.max=n+$}hs.prototype.insert=function(n,s,l,d,x){this._forEachCell(s,l,d,x,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)},hs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},hs.prototype._insertCell=function(n,s,l,d,x,C){this.cells[x].push(C)},hs.prototype.query=function(n,s,l,d,x){var C=this.min,T=this.max;if(n<=C&&s<=C&&T<=l&&T<=d&&!x)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(n,s,l,d,this._queryCell,R,{},x),R},hs.prototype._queryCell=function(n,s,l,d,x,C,T,R){var z=this.cells[x];if(z!==null)for(var W=this.keys,$=this.bboxes,ee=0;ee<z.length;ee++){var le=z[ee];if(T[le]===void 0){var be=4*le;(R?R($[be+0],$[be+1],$[be+2],$[be+3]):n<=$[be+2]&&s<=$[be+3]&&l>=$[be+0]&&d>=$[be+1])?(T[le]=!0,C.push(W[le])):T[le]=!1}}},hs.prototype._forEachCell=function(n,s,l,d,x,C,T,R){for(var z=this._convertToCellCoord(n),W=this._convertToCellCoord(s),$=this._convertToCellCoord(l),ee=this._convertToCellCoord(d),le=z;le<=$;le++)for(var be=W;be<=ee;be++){var $e=this.d*be+le;if((!R||R(this._convertFromCellCoord(le),this._convertFromCellCoord(be),this._convertFromCellCoord(le+1),this._convertFromCellCoord(be+1)))&&x.call(this,n,s,l,d,$e,C,T,R))return}},hs.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},hs.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},hs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,s=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var x=new Int32Array(s+l+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var C=s,T=0;T<n.length;T++){var R=n[T];x[3+T]=C,x.set(R,C),C+=R.length}return x[3+n.length]=C,x.set(this.keys,C),x[3+n.length+1]=C+=this.keys.length,x.set(this.bboxes,C),C+=this.bboxes.length,x.buffer};var Qu=Ae.ImageData,mf=Ae.ImageBitmap,Do={};function Jn(n,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:n,writeable:!1}),Do[n]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var jo in Jn("Object",Object),rc.serialize=function(n,s){var l=n.toArrayBuffer();return s&&s.push(l),{buffer:l}},rc.deserialize=function(n){return new rc(n.buffer)},Jn("Grid",rc),Jn("Color",Aa),Jn("Error",Error),Jn("ResolvedImage",bt),Jn("StylePropertyFunction",Jl),Jn("StyleExpression",ff,{omit:["_evaluator"]}),Jn("ZoomDependentExpression",vc),Jn("ZoomConstantExpression",Uf),Jn("CompoundExpression",Oo,{omit:["_evaluate"]}),El)El[jo]._classRegistryKey||Jn("Expression_"+jo,El[jo]);function Zc(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function gf(n){return mf&&n instanceof mf}function Ja(n,s){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Zc(n)||gf(n))return s&&s.push(n),n;if(ArrayBuffer.isView(n)){var l=n;return s&&s.push(l.buffer),l}if(n instanceof Qu)return s&&s.push(n.data.buffer),n;if(Array.isArray(n)){for(var d=[],x=0,C=n;x<C.length;x+=1)d.push(Ja(C[x],s));return d}if(typeof n=="object"){var T=n.constructor,R=T._classRegistryKey;if(!R)throw new Error("can't serialize object of unregistered class");var z=T.serialize?T.serialize(n,s):{};if(!T.serialize){for(var W in n)if(n.hasOwnProperty(W)&&!(Do[R].omit.indexOf(W)>=0)){var $=n[W];z[W]=Do[R].shallow.indexOf(W)>=0?$:Ja($,s)}n instanceof Error&&(z.message=n.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return R!=="Object"&&(z.$name=R),z}throw new Error("can't serialize object of type "+typeof n)}function Lu(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Zc(n)||gf(n)||ArrayBuffer.isView(n)||n instanceof Qu)return n;if(Array.isArray(n))return n.map(Lu);if(typeof n=="object"){var s=n.$name||"Object",l=Do[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(n);for(var d=Object.create(l.prototype),x=0,C=Object.keys(n);x<C.length;x+=1){var T=C[x];if(T!=="$name"){var R=n[T];d[T]=Do[s].shallow.indexOf(T)>=0?R:Lu(R)}}return d}throw new Error("can't deserialize object of type "+typeof n)}var _c=function(){this.first=!0};_c.prototype.update=function(n,s){var l=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=l,!0))};var In={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function yf(n){for(var s=0,l=n;s<l.length;s+=1)if(ph(l[s].charCodeAt(0)))return!0;return!1}function ph(n){return!(n!==746&&n!==747&&(n<4352||!(In["Bopomofo Extended"](n)||In.Bopomofo(n)||In["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||In["CJK Compatibility Ideographs"](n)||In["CJK Compatibility"](n)||In["CJK Radicals Supplement"](n)||In["CJK Strokes"](n)||!(!In["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||In["CJK Unified Ideographs Extension A"](n)||In["CJK Unified Ideographs"](n)||In["Enclosed CJK Letters and Months"](n)||In["Hangul Compatibility Jamo"](n)||In["Hangul Jamo Extended-A"](n)||In["Hangul Jamo Extended-B"](n)||In["Hangul Jamo"](n)||In["Hangul Syllables"](n)||In.Hiragana(n)||In["Ideographic Description Characters"](n)||In.Kanbun(n)||In["Kangxi Radicals"](n)||In["Katakana Phonetic Extensions"](n)||In.Katakana(n)&&n!==12540||!(!In["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!In["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||In["Unified Canadian Aboriginal Syllabics"](n)||In["Unified Canadian Aboriginal Syllabics Extended"](n)||In["Vertical Forms"](n)||In["Yijing Hexagram Symbols"](n)||In["Yi Syllables"](n)||In["Yi Radicals"](n))))}function wl(n){return!(ph(n)||function(s){return!!(In["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||In["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||In["Letterlike Symbols"](s)||In["Number Forms"](s)||In["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||In["Control Pictures"](s)&&s!==9251||In["Optical Character Recognition"](s)||In["Enclosed Alphanumerics"](s)||In["Geometric Shapes"](s)||In["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||In["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||In["CJK Symbols and Punctuation"](s)||In.Katakana(s)||In["Private Use Area"](s)||In["CJK Compatibility Forms"](s)||In["Small Form Variants"](s)||In["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(n))}function co(n){return n>=1424&&n<=2303||In["Arabic Presentation Forms-A"](n)||In["Arabic Presentation Forms-B"](n)}function mu(n,s){return!(!s&&co(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||In.Khmer(n))}function Ua(n){for(var s=0,l=n;s<l.length;s+=1)if(co(l[s].charCodeAt(0)))return!0;return!1}var Nl=null,Tu="unavailable",zl=null,Hf=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Tu="error"),Nl&&Nl(n)};function Vc(){yp.fire(new qe("pluginStateChange",{pluginStatus:Tu,pluginURL:zl}))}var yp=new xt,xi=function(){return Tu},cl=function(){if(Tu!=="deferred"||!zl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Tu="loading",Vc(),zl&&Si({url:zl},function(n){n?Hf(n):(Tu="loaded",Vc())})},qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Tu==="loaded"||qs.applyArabicShaping!=null},isLoading:function(){return Tu==="loading"},setState:function(n){Tu=n.pluginStatus,zl=n.pluginURL},isParsed:function(){return qs.applyArabicShaping!=null&&qs.processBidirectionalText!=null&&qs.processStyledBidirectionalText!=null},getPluginURL:function(){return zl}},pa=function(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _c,this.transition={})};pa.prototype.isSupportedScript=function(n){return function(s,l){for(var d=0,x=s;d<x.length;d+=1)if(!mu(x[d].charCodeAt(0),l))return!1;return!0}(n,qs.isLoaded())},pa.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},pa.prototype.getCrossfadeParameters=function(){var n=this.zoom,s=n-Math.floor(n),l=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var fl=function(n,s){this.property=n,this.value=s,this.expression=function(l,d){if(Ys(l))return new Jl(l,d);if(zf(l)){var x=hf(l,d);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var C=l;return typeof l=="string"&&d.type==="color"&&(C=Aa.parse(l)),{kind:"constant",evaluate:function(){return C}}}(s===void 0?n.specification.default:s,n.specification)};fl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},fl.prototype.possiblyEvaluate=function(n,s,l){return this.property.possiblyEvaluate(this,n,s,l)};var gu=function(n){this.property=n,this.value=new fl(n,void 0)};gu.prototype.transitioned=function(n,s){return new _f(this.property,this.value,s,Xt({},n.transition,this.transition),n.now)},gu.prototype.untransitioned=function(){return new _f(this.property,this.value,null,{},0)};var Ns=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};Ns.prototype.getValue=function(n){return _t(this._values[n].value.value)},Ns.prototype.setValue=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new gu(this._values[n].property)),this._values[n].value=new fl(this._values[n].property,s===null?void 0:_t(s))},Ns.prototype.getTransition=function(n){return _t(this._values[n].transition)},Ns.prototype.setTransition=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new gu(this._values[n].property)),this._values[n].transition=_t(s)||void 0},Ns.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(n[d]=x);var C=this.getTransition(d);C!==void 0&&(n[d+"-transition"]=C)}return n},Ns.prototype.transitioned=function(n,s){for(var l=new xc(this._properties),d=0,x=Object.keys(this._values);d<x.length;d+=1){var C=x[d];l._values[C]=this._values[C].transitioned(n,s._values[C])}return l},Ns.prototype.untransitioned=function(){for(var n=new xc(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s];n._values[d]=this._values[d].untransitioned()}return n};var _f=function(n,s,l,d,x){this.property=n,this.value=s,this.begin=x+d.delay||0,this.end=this.begin+d.duration||0,n.specification.transition&&(d.delay||d.duration)&&(this.prior=l)};_f.prototype.possiblyEvaluate=function(n,s,l){var d=n.now||0,x=this.value.possiblyEvaluate(n,s,l),C=this.prior;if(C){if(d>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(d<this.begin)return C.possiblyEvaluate(n,s,l);var T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(n,s,l),x,function(R){if(R<=0)return 0;if(R>=1)return 1;var z=R*R,W=z*R;return 4*(R<.5?W:3*(R-z)+W-.75)}(T))}return x};var xc=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};xc.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Ju(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(n,s,l)}return d},xc.prototype.hasTransition=function(){for(var n=0,s=Object.keys(this._values);n<s.length;n+=1)if(this._values[s[n]].prior)return!0;return!1};var Mu=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};Mu.prototype.getValue=function(n){return _t(this._values[n].value)},Mu.prototype.setValue=function(n,s){this._values[n]=new fl(this._values[n].property,s===null?void 0:_t(s))},Mu.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(n[d]=x)}return n},Mu.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Ju(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(n,s,l)}return d};var yu=function(n,s,l){this.property=n,this.value=s,this.parameters=l};yu.prototype.isConstant=function(){return this.value.kind==="constant"},yu.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},yu.prototype.evaluate=function(n,s,l,d){return this.property.evaluate(this.value,this.parameters,n,s,l,d)};var Ju=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};Ju.prototype.get=function(n){return this._values[n]};var Ei=function(n){this.specification=n};Ei.prototype.possiblyEvaluate=function(n,s){return n.expression.evaluate(s)},Ei.prototype.interpolate=function(n,s,l){var d=fs[this.specification.type];return d?d(n,s,l):n};var vi=function(n,s){this.specification=n,this.overrides=s};vi.prototype.possiblyEvaluate=function(n,s,l,d){return new yu(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},l,d)}:n.expression,s)},vi.prototype.interpolate=function(n,s,l){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new yu(this,{kind:"constant",value:void 0},n.parameters);var d=fs[this.specification.type];return d?new yu(this,{kind:"constant",value:d(n.value.value,s.value.value,l)},n.parameters):n},vi.prototype.evaluate=function(n,s,l,d,x,C){return n.kind==="constant"?n.value:n.evaluate(s,l,d,x,C)};var Wf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d,x,C){if(l.value===void 0)return new yu(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){var T=l.expression.evaluate(d,null,{},x,C),R=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,z=this._calculate(R,R,R,d);return new yu(this,{kind:"constant",value:z},d)}if(l.expression.kind==="camera"){var W=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new yu(this,{kind:"constant",value:W},d)}return new yu(this,l.expression,d)},s.prototype.evaluate=function(l,d,x,C,T,R){if(l.kind==="source"){var z=l.evaluate(d,x,C,T,R);return this._calculate(z,z,z,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},x,C),l.evaluate({zoom:Math.floor(d.zoom)},x,C),l.evaluate({zoom:Math.floor(d.zoom)+1},x,C),d):l.value},s.prototype._calculate=function(l,d,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:x,to:d}},s.prototype.interpolate=function(l){return l},s}(vi),zs=function(n){this.specification=n};zs.prototype.possiblyEvaluate=function(n,s,l,d){if(n.value!==void 0){if(n.expression.kind==="constant"){var x=n.expression.evaluate(s,null,{},l,d);return this._calculate(x,x,x,s)}return this._calculate(n.expression.evaluate(new pa(Math.floor(s.zoom-1),s)),n.expression.evaluate(new pa(Math.floor(s.zoom),s)),n.expression.evaluate(new pa(Math.floor(s.zoom+1),s)),s)}},zs.prototype._calculate=function(n,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:l,to:s}},zs.prototype.interpolate=function(n){return n};var hl=function(n){this.specification=n};hl.prototype.possiblyEvaluate=function(n,s,l,d){return!!n.expression.evaluate(s,null,{},l,d)},hl.prototype.interpolate=function(){return!1};var $o=function(n){for(var s in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var l=n[s];l.specification.overridable&&this.overridableProperties.push(s);var d=this.defaultPropertyValues[s]=new fl(l,void 0),x=this.defaultTransitionablePropertyValues[s]=new gu(l);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}};Jn("DataDrivenProperty",vi),Jn("DataConstantProperty",Ei),Jn("CrossFadedDataDrivenProperty",Wf),Jn("CrossFadedProperty",zs),Jn("ColorRampProperty",hl);var Tl=function(n){function s(l,d){if(n.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Mu(d.layout)),d.paint)){for(var x in this._transitionablePaint=new Ns(d.paint),l.paint)this.setPaintProperty(x,l.paint[x],{validate:!1});for(var C in l.layout)this.setLayoutProperty(C,l.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ju(d.paint)}}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,d,x){x===void 0&&(x={}),d!=null&&this._validate(Bl,"layers."+this.id+".layout."+l,l,d,x)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)},s.prototype.getPaintProperty=function(l){return re(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,d,x){if(x===void 0&&(x={}),d!=null&&this._validate(vf,"layers."+this.id+".paint."+l,l,d,x))return!1;if(re(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),d||void 0),!1;var C=this._transitionablePaint._values[l],T=C.property.specification["property-type"]==="cross-faded-data-driven",R=C.value.isDataDriven(),z=C.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);var W=this._transitionablePaint._values[l].value;return W.isDataDriven()||R||T||this._handleOverridablePaintPropertyUpdate(l,z,W)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Ot(l,function(d,x){return!(d===void 0||x==="layout"&&!Object.keys(d).length||x==="paint"&&!Object.keys(d).length)})},s.prototype._validate=function(l,d,x,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&yc(this,l.call(hh,{key:d,layerType:this.type,objectKey:x,value:C,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var d=this.paint.get(l);if(d instanceof yu&&$u(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},s}(xt),dh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},xf=function(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Za=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _o(n,s){s===void 0&&(s=1);var l=0,d=0;return{members:n.map(function(x){var C=dh[x.type].BYTES_PER_ELEMENT,T=l=vh(l,Math.max(s,C)),R=x.components||1;return d=Math.max(d,C),l+=C*R,{name:x.name,type:x.type,components:R,offset:T}}),size:vh(l,Math.max(d,s)),alignment:s}}function vh(n,s){return Math.ceil(n/s)*s}Za.serialize=function(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},Za.deserialize=function(n){var s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Za.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Za.prototype.clear=function(){this.length=0},Za.prototype.resize=function(n){this.reserve(n),this.length=n},Za.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Za.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.int16[C+0]=d,this.int16[C+1]=x,l},s}(Za);Xf.prototype.bytesPerElement=4,Jn("StructArrayLayout2i4",Xf);var pl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var R=4*l;return this.int16[R+0]=d,this.int16[R+1]=x,this.int16[R+2]=C,this.int16[R+3]=T,l},s}(Za);pl.prototype.bytesPerElement=8,Jn("StructArrayLayout4i8",pl);var el=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,x,C,T,R)},s.prototype.emplace=function(l,d,x,C,T,R,z){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.int16[W+2]=C,this.int16[W+3]=T,this.int16[W+4]=R,this.int16[W+5]=z,l},s}(Za);el.prototype.bytesPerElement=12,Jn("StructArrayLayout2i4i12",el);var $s=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,x,C,T,R)},s.prototype.emplace=function(l,d,x,C,T,R,z){var W=4*l,$=8*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.uint8[$+4]=C,this.uint8[$+5]=T,this.uint8[$+6]=R,this.uint8[$+7]=z,l},s}(Za);$s.prototype.bytesPerElement=8,Jn("StructArrayLayout2i4ub8",$s);var dl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.float32[C+0]=d,this.float32[C+1]=x,l},s}(Za);dl.prototype.bytesPerElement=8,Jn("StructArrayLayout2f8",dl);var Ul=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R,z,W,$,ee){var le=this.length;return this.resize(le+1),this.emplace(le,l,d,x,C,T,R,z,W,$,ee)},s.prototype.emplace=function(l,d,x,C,T,R,z,W,$,ee,le){var be=10*l;return this.uint16[be+0]=d,this.uint16[be+1]=x,this.uint16[be+2]=C,this.uint16[be+3]=T,this.uint16[be+4]=R,this.uint16[be+5]=z,this.uint16[be+6]=W,this.uint16[be+7]=$,this.uint16[be+8]=ee,this.uint16[be+9]=le,l},s}(Za);Ul.prototype.bytesPerElement=20,Jn("StructArrayLayout10ui20",Ul);var mh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R,z,W,$,ee,le,be){var $e=this.length;return this.resize($e+1),this.emplace($e,l,d,x,C,T,R,z,W,$,ee,le,be)},s.prototype.emplace=function(l,d,x,C,T,R,z,W,$,ee,le,be,$e){var Je=12*l;return this.int16[Je+0]=d,this.int16[Je+1]=x,this.int16[Je+2]=C,this.int16[Je+3]=T,this.uint16[Je+4]=R,this.uint16[Je+5]=z,this.uint16[Je+6]=W,this.uint16[Je+7]=$,this.int16[Je+8]=ee,this.int16[Je+9]=le,this.int16[Je+10]=be,this.int16[Je+11]=$e,l},s}(Za);mh.prototype.bytesPerElement=24,Jn("StructArrayLayout4i4ui4i24",mh);var Go=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.float32[T+0]=d,this.float32[T+1]=x,this.float32[T+2]=C,l},s}(Za);Go.prototype.bytesPerElement=12,Jn("StructArrayLayout3f12",Go);var gh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint32[1*l+0]=d,l},s}(Za);gh.prototype.bytesPerElement=4,Jn("StructArrayLayout1ul4",gh);var qh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R,z,W,$){var ee=this.length;return this.resize(ee+1),this.emplace(ee,l,d,x,C,T,R,z,W,$)},s.prototype.emplace=function(l,d,x,C,T,R,z,W,$,ee){var le=10*l,be=5*l;return this.int16[le+0]=d,this.int16[le+1]=x,this.int16[le+2]=C,this.int16[le+3]=T,this.int16[le+4]=R,this.int16[le+5]=z,this.uint32[be+3]=W,this.uint16[le+8]=$,this.uint16[le+9]=ee,l},s}(Za);qh.prototype.bytesPerElement=20,Jn("StructArrayLayout6i1ul2ui20",qh);var jc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,x,C,T,R)},s.prototype.emplace=function(l,d,x,C,T,R,z){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.int16[W+2]=C,this.int16[W+3]=T,this.int16[W+4]=R,this.int16[W+5]=z,l},s}(Za);jc.prototype.bytesPerElement=12,Jn("StructArrayLayout2i2i2i12",jc);var bf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T){var R=this.length;return this.resize(R+1),this.emplace(R,l,d,x,C,T)},s.prototype.emplace=function(l,d,x,C,T,R){var z=4*l,W=8*l;return this.float32[z+0]=d,this.float32[z+1]=x,this.float32[z+2]=C,this.int16[W+6]=T,this.int16[W+7]=R,l},s}(Za);bf.prototype.bytesPerElement=16,Jn("StructArrayLayout2f1f2i16",bf);var bc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var R=12*l,z=3*l;return this.uint8[R+0]=d,this.uint8[R+1]=x,this.float32[z+1]=C,this.float32[z+2]=T,l},s}(Za);bc.prototype.bytesPerElement=12,Jn("StructArrayLayout2ub2f12",bc);var Zl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.uint16[T+0]=d,this.uint16[T+1]=x,this.uint16[T+2]=C,l},s}(Za);Zl.prototype.bytesPerElement=6,Jn("StructArrayLayout3ui6",Zl);var vl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt){var kt=this.length;return this.resize(kt+1),this.emplace(kt,l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt)},s.prototype.emplace=function(l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt,kt){var lr=24*l,yr=12*l,zr=48*l;return this.int16[lr+0]=d,this.int16[lr+1]=x,this.uint16[lr+2]=C,this.uint16[lr+3]=T,this.uint32[yr+2]=R,this.uint32[yr+3]=z,this.uint32[yr+4]=W,this.uint16[lr+10]=$,this.uint16[lr+11]=ee,this.uint16[lr+12]=le,this.float32[yr+7]=be,this.float32[yr+8]=$e,this.uint8[zr+36]=Je,this.uint8[zr+37]=dt,this.uint8[zr+38]=st,this.uint32[yr+10]=Dt,this.int16[lr+22]=kt,l},s}(Za);vl.prototype.bytesPerElement=48,Jn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);var Yf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt,kt,lr,yr,zr,hn,Bn,wi,$n,Ci,ri,Ca){var ki=this.length;return this.resize(ki+1),this.emplace(ki,l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt,kt,lr,yr,zr,hn,Bn,wi,$n,Ci,ri,Ca)},s.prototype.emplace=function(l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je,dt,st,Dt,kt,lr,yr,zr,hn,Bn,wi,$n,Ci,ri,Ca,ki){var hi=34*l,ga=17*l;return this.int16[hi+0]=d,this.int16[hi+1]=x,this.int16[hi+2]=C,this.int16[hi+3]=T,this.int16[hi+4]=R,this.int16[hi+5]=z,this.int16[hi+6]=W,this.int16[hi+7]=$,this.uint16[hi+8]=ee,this.uint16[hi+9]=le,this.uint16[hi+10]=be,this.uint16[hi+11]=$e,this.uint16[hi+12]=Je,this.uint16[hi+13]=dt,this.uint16[hi+14]=st,this.uint16[hi+15]=Dt,this.uint16[hi+16]=kt,this.uint16[hi+17]=lr,this.uint16[hi+18]=yr,this.uint16[hi+19]=zr,this.uint16[hi+20]=hn,this.uint16[hi+21]=Bn,this.uint16[hi+22]=wi,this.uint32[ga+12]=$n,this.float32[ga+13]=Ci,this.float32[ga+14]=ri,this.float32[ga+15]=Ca,this.float32[ga+16]=ki,l},s}(Za);Yf.prototype.bytesPerElement=68,Jn("StructArrayLayout8i15ui1ul4f68",Yf);var nc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.float32[1*l+0]=d,l},s}(Za);nc.prototype.bytesPerElement=4,Jn("StructArrayLayout1f4",nc);var ml=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.int16[T+0]=d,this.int16[T+1]=x,this.int16[T+2]=C,l},s}(Za);ml.prototype.bytesPerElement=6,Jn("StructArrayLayout3i6",ml);var Gc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=4*l;return this.uint32[2*l+0]=d,this.uint16[T+2]=x,this.uint16[T+3]=C,l},s}(Za);Gc.prototype.bytesPerElement=8,Jn("StructArrayLayout1ul2ui8",Gc);var yh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.uint16[C+0]=d,this.uint16[C+1]=x,l},s}(Za);yh.prototype.bytesPerElement=4,Jn("StructArrayLayout2ui4",yh);var _p=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint16[1*l+0]=d,l},s}(Za);_p.prototype.bytesPerElement=2,Jn("StructArrayLayout1ui2",_p);var Ef=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var R=4*l;return this.float32[R+0]=d,this.float32[R+1]=x,this.float32[R+2]=C,this.float32[R+3]=T,l},s}(Za);Ef.prototype.bytesPerElement=16,Jn("StructArrayLayout4f16",Ef);var c=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new he(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(xf);c.prototype.size=20;var h=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new c(this,l)},s}(qh);Jn("CollisionBoxArray",h);var f=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(xf);f.prototype.size=48;var m=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(vl);Jn("PlacedSymbolArray",m);var S=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(xf);S.prototype.size=68;var I=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(Yf);Jn("SymbolInstanceArray",I);var P=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(nc);Jn("GlyphOffsetArray",P);var B=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(ml);Jn("SymbolLineVertexArray",B);var Y=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(xf);Y.prototype.size=8;var te=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new Y(this,l)},s}(Gc);Jn("FeatureIndexArray",te);var xe=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,Ce=function(n){n===void 0&&(n=[]),this.segments=n};function Me(n,s){return 256*(n=tr(Math.floor(n),0,255))+tr(Math.floor(s),0,255)}Ce.prototype.prepareSegment=function(n,s,l,d){var x=this.segments[this.segments.length-1];return n>Ce.MAX_VERTEX_ARRAY_LENGTH&&Ue("Max vertices per segment is "+Ce.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!x||x.vertexLength+n>Ce.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==d)&&(x={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(x.sortKey=d),this.segments.push(x)),x},Ce.prototype.get=function(){return this.segments},Ce.prototype.destroy=function(){for(var n=0,s=this.segments;n<s.length;n+=1){var l=s[n];for(var d in l.vaos)l.vaos[d].destroy()}},Ce.simpleSegment=function(n,s,l,d){return new Ce([{vertexOffset:n,primitiveOffset:s,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])},Ce.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jn("SegmentVector",Ce);var et=_o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ne=Be(function(n){n.exports=function(s,l){var d,x,C,T,R,z,W,$;for(x=s.length-(d=3&s.length),C=l,R=3432918353,z=461845907,$=0;$<x;)W=255&s.charCodeAt($)|(255&s.charCodeAt(++$))<<8|(255&s.charCodeAt(++$))<<16|(255&s.charCodeAt(++$))<<24,++$,C=27492+(65535&(T=5*(65535&(C=(C^=W=(65535&(W=(W=(65535&W)*R+(((W>>>16)*R&65535)<<16)&4294967295)<<15|W>>>17))*z+(((W>>>16)*z&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(W=0,d){case 3:W^=(255&s.charCodeAt($+2))<<16;case 2:W^=(255&s.charCodeAt($+1))<<8;case 1:C^=W=(65535&(W=(W=(65535&(W^=255&s.charCodeAt($)))*R+(((W>>>16)*R&65535)<<16)&4294967295)<<15|W>>>17))*z+(((W>>>16)*z&65535)<<16)&4294967295}return C^=s.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}}),ct=Be(function(n){n.exports=function(s,l){for(var d,x=s.length,C=l^x,T=0;x>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:C^=(255&s.charCodeAt(T+2))<<16;case 2:C^=(255&s.charCodeAt(T+1))<<8;case 1:C=1540483477*(65535&(C^=255&s.charCodeAt(T)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}}),je=Ne,ht=ct;je.murmur3=Ne,je.murmur2=ht;var Et=function(){this.ids=[],this.positions=[],this.indexed=!1};Et.prototype.add=function(n,s,l,d){this.ids.push(vr(n)),this.positions.push(s,l,d)},Et.prototype.getPositions=function(n){for(var s=vr(n),l=0,d=this.ids.length-1;l<d;){var x=l+d>>1;this.ids[x]>=s?d=x:l=x+1}for(var C=[];this.ids[l]===s;)C.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return C},Et.serialize=function(n,s){var l=new Float64Array(n.ids),d=new Uint32Array(n.positions);return function x(C,T,R,z){for(;R<z;){for(var W=C[R+z>>1],$=R-1,ee=z+1;;){do $++;while(C[$]<W);do ee--;while(C[ee]>W);if($>=ee)break;rr(C,$,ee),rr(T,3*$,3*ee),rr(T,3*$+1,3*ee+1),rr(T,3*$+2,3*ee+2)}ee-R<z-ee?(x(C,T,R,ee),R=ee+1):(x(C,T,ee+1,z),z=ee)}}(l,d,0,l.length-1),s&&s.push(l.buffer,d.buffer),{ids:l,positions:d}},Et.deserialize=function(n){var s=new Et;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s};var Wt=Math.pow(2,53)-1;function vr(n){var s=+n;return!isNaN(s)&&s<=Wt?s:je(String(n))}function rr(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}Jn("FeaturePositionMap",Et);var Ar=function(n,s){this.gl=n.gl,this.location=s},Xr=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(Ar),bn=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(Ar),pn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(Ar),Vn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(Ar),bi=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(Ar),Ti=function(n){function s(l,d){n.call(this,l,d),this.current=Aa.transparent}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(Ar),Ai=new Float32Array(16),ba=function(n){function s(l,d){n.call(this,l,d),this.current=Ai}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(Ar);function Wn(n){return[Me(255*n.r,255*n.g),Me(255*n.b,255*n.a)]}var Wi=function(n,s,l){this.value=n,this.uniformNames=s.map(function(d){return"u_"+d}),this.type=l};Wi.prototype.setUniform=function(n,s,l){n.set(l.constantOr(this.value))},Wi.prototype.getBinding=function(n,s,l){return this.type==="color"?new Ti(n,s):new bn(n,s)};var na=function(n,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};na.prototype.setConstantPatternPositions=function(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr},na.prototype.setUniform=function(n,s,l,d){var x=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&n.set(x)},na.prototype.getBinding=function(n,s,l){return l.substr(0,9)==="u_pattern"?new bi(n,s):new bn(n,s)};var Xi=function(n,s,l,d){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(x){return{name:"a_"+x,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new d};Xi.prototype.populatePaintArray=function(n,s,l,d,x){var C=this.paintVertexArray.length,T=this.expression.evaluate(new pa(0),s,{},d,[],x);this.paintVertexArray.resize(n),this._setPaintValue(C,n,T)},Xi.prototype.updatePaintArray=function(n,s,l,d){var x=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(n,s,x)},Xi.prototype._setPaintValue=function(n,s,l){if(this.type==="color")for(var d=Wn(l),x=n;x<s;x++)this.paintVertexArray.emplace(x,d[0],d[1]);else{for(var C=n;C<s;C++)this.paintVertexArray.emplace(C,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},Xi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Pi=function(n,s,l,d,x,C){this.expression=n,this.uniformNames=s.map(function(T){return"u_"+T+"_t"}),this.type=l,this.useIntegerZoom=d,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(function(T){return{name:"a_"+T,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new C};Pi.prototype.populatePaintArray=function(n,s,l,d,x){var C=this.expression.evaluate(new pa(this.zoom),s,{},d,[],x),T=this.expression.evaluate(new pa(this.zoom+1),s,{},d,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(R,n,C,T)},Pi.prototype.updatePaintArray=function(n,s,l,d){var x=this.expression.evaluate({zoom:this.zoom},l,d),C=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(n,s,x,C)},Pi.prototype._setPaintValue=function(n,s,l,d){if(this.type==="color")for(var x=Wn(l),C=Wn(d),T=n;T<s;T++)this.paintVertexArray.emplace(T,x[0],x[1],C[0],C[1]);else{for(var R=n;R<s;R++)this.paintVertexArray.emplace(R,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}},Pi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Pi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Pi.prototype.setUniform=function(n,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=tr(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(d)},Pi.prototype.getBinding=function(n,s,l){return new bn(n,s)};var ia=function(n,s,l,d,x,C){this.expression=n,this.type=s,this.useIntegerZoom=l,this.zoom=d,this.layerId=C,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};ia.prototype.populatePaintArray=function(n,s,l){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(d,n,s.patterns&&s.patterns[this.layerId],l)},ia.prototype.updatePaintArray=function(n,s,l,d,x){this._setPaintValues(n,s,l.patterns&&l.patterns[this.layerId],x)},ia.prototype._setPaintValues=function(n,s,l,d){if(d&&l){var x=d[l.min],C=d[l.mid],T=d[l.max];if(x&&C&&T)for(var R=n;R<s;R++)this.zoomInPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],C.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio)}},ia.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,et.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,et.members,this.expression.isStateDependent))},ia.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var zi=function(n,s,l){this.binders={},this._buffers=[];var d=[];for(var x in n.paint._values)if(l(x)){var C=n.paint.get(x);if(C instanceof yu&&$u(C.property.specification)){var T=vs(x,n.type),R=C.value,z=C.property.specification.type,W=C.property.useIntegerZoom,$=C.property.specification["property-type"],ee=$==="cross-faded"||$==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=ee?new na(R.value,T):new Wi(R.value,T,z),d.push("/u_"+x);else if(R.kind==="source"||ee){var le=fo(x,z,"source");this.binders[x]=ee?new ia(R,z,W,s,le,n.id):new Xi(R,T,z,le),d.push("/a_"+x)}else{var be=fo(x,z,"composite");this.binders[x]=new Pi(R,T,z,W,s,be),d.push("/z_"+x)}}}this.cacheKey=d.sort().join("")};zi.prototype.getMaxValue=function(n){var s=this.binders[n];return s instanceof Xi||s instanceof Pi?s.maxValue:0},zi.prototype.populatePaintArrays=function(n,s,l,d,x){for(var C in this.binders){var T=this.binders[C];(T instanceof Xi||T instanceof Pi||T instanceof ia)&&T.populatePaintArray(n,s,l,d,x)}},zi.prototype.setConstantPatternPositions=function(n,s){for(var l in this.binders){var d=this.binders[l];d instanceof na&&d.setConstantPatternPositions(n,s)}},zi.prototype.updatePaintArrays=function(n,s,l,d,x){var C=!1;for(var T in n)for(var R=0,z=s.getPositions(T);R<z.length;R+=1){var W=z[R],$=l.feature(W.index);for(var ee in this.binders){var le=this.binders[ee];if((le instanceof Xi||le instanceof Pi||le instanceof ia)&&le.expression.isStateDependent===!0){var be=d.paint.get(ee);le.expression=be.value,le.updatePaintArray(W.start,W.end,$,n[T],x),C=!0}}}return C},zi.prototype.defines=function(){var n=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Wi||l instanceof na)&&n.push.apply(n,l.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return n},zi.prototype.getBinderAttributes=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Xi||l instanceof Pi)for(var d=0;d<l.paintVertexAttributes.length;d++)n.push(l.paintVertexAttributes[d].name);else if(l instanceof ia)for(var x=0;x<et.members.length;x++)n.push(et.members[x].name)}return n},zi.prototype.getBinderUniforms=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Wi||l instanceof na||l instanceof Pi)for(var d=0,x=l.uniformNames;d<x.length;d+=1)n.push(x[d])}return n},zi.prototype.getPaintVertexBuffers=function(){return this._buffers},zi.prototype.getUniforms=function(n,s){var l=[];for(var d in this.binders){var x=this.binders[d];if(x instanceof Wi||x instanceof na||x instanceof Pi)for(var C=0,T=x.uniformNames;C<T.length;C+=1){var R=T[C];if(s[R]){var z=x.getBinding(n,s[R],R);l.push({name:R,property:d,binding:z})}}}return l},zi.prototype.setUniforms=function(n,s,l,d){for(var x=0,C=s;x<C.length;x+=1){var T=C[x],R=T.name,z=T.property;this.binders[z].setUniform(T.binding,d,l.get(z),R)}},zi.prototype.updatePaintBuffers=function(n){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(n&&l instanceof ia){var d=n.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof Xi||l instanceof Pi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},zi.prototype.upload=function(n){for(var s in this.binders){var l=this.binders[s];(l instanceof Xi||l instanceof Pi||l instanceof ia)&&l.upload(n)}this.updatePaintBuffers()},zi.prototype.destroy=function(){for(var n in this.binders){var s=this.binders[n];(s instanceof Xi||s instanceof Pi||s instanceof ia)&&s.destroy()}};var Li=function(n,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var d=0,x=n;d<x.length;d+=1){var C=x[d];this.programConfigurations[C.id]=new zi(C,s,l)}this.needsUpload=!1,this._featureMap=new Et,this._bufferOffset=0};function vs(n,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(s+"-","").replace(/-/g,"_")]}function fo(n,s,l){var d={color:{source:dl,composite:Ef},number:{source:nc,composite:dl}},x=function(C){return{"line-pattern":{source:Ul,composite:Ul},"fill-pattern":{source:Ul,composite:Ul},"fill-extrusion-pattern":{source:Ul,composite:Ul}}[C]}(n);return x&&x[l]||d[s][l]}Li.prototype.populatePaintArrays=function(n,s,l,d,x,C){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,s,d,x,C);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},Li.prototype.updatePaintArrays=function(n,s,l,d){for(var x=0,C=l;x<C.length;x+=1){var T=C[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,s,T,d)||this.needsUpload}},Li.prototype.get=function(n){return this.programConfigurations[n]},Li.prototype.upload=function(n){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}},Li.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},Jn("ConstantBinder",Wi),Jn("CrossFadedConstantBinder",na),Jn("SourceExpressionBinder",Xi),Jn("CrossFadedCompositeBinder",ia),Jn("CompositeExpressionBinder",Pi),Jn("ProgramConfiguration",zi,{omit:["_buffers"]}),Jn("ProgramConfigurationSet",Li);var Ho=Math.pow(2,14)-1,Us=-Ho-1;function Bo(n){for(var s=8192/n.extent,l=n.loadGeometry(),d=0;d<l.length;d++)for(var x=l[d],C=0;C<x.length;C++){var T=x[C],R=Math.round(T.x*s),z=Math.round(T.y*s);T.x=tr(R,Us,Ho),T.y=tr(z,Us,Ho),(R<T.x||R>T.x+1||z<T.y||z>T.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function Wo(n,s){return{type:n.type,id:n.id,properties:n.properties,geometry:s?Bo(n):[]}}function ou(n,s,l,d,x){n.emplaceBack(2*s+(d+1)/2,2*l+(x+1)/2)}var su=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Xf,this.indexArray=new Zl,this.segments=new Ce,this.programConfigurations=new Li(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Ms(n,s){for(var l=0;l<n.length;l++)if(jl(s,n[l]))return!0;for(var d=0;d<s.length;d++)if(jl(n,s[d]))return!0;return!!Cf(n,s)}function ms(n,s,l){return!!jl(n,s)||!!Il(s,n,l)}function Vl(n,s){if(n.length===1)return Hc(s,n[0]);for(var l=0;l<s.length;l++)for(var d=s[l],x=0;x<d.length;x++)if(jl(n,d[x]))return!0;for(var C=0;C<n.length;C++)if(Hc(s,n[C]))return!0;for(var T=0;T<s.length;T++)if(Cf(n,s[T]))return!0;return!1}function Ou(n,s,l){if(n.length>1){if(Cf(n,s))return!0;for(var d=0;d<s.length;d++)if(Il(s[d],n,l))return!0}for(var x=0;x<n.length;x++)if(Il(n[x],s,l))return!0;return!1}function Cf(n,s){if(n.length===0||s.length===0)return!1;for(var l=0;l<n.length-1;l++)for(var d=n[l],x=n[l+1],C=0;C<s.length-1;C++)if(Ml(d,x,s[C],s[C+1]))return!0;return!1}function Ml(n,s,l,d){return Cr(n,l,d)!==Cr(s,l,d)&&Cr(n,s,l)!==Cr(n,s,d)}function Il(n,s,l){var d=l*l;if(s.length===1)return n.distSqr(s[0])<d;for(var x=1;x<s.length;x++)if(Ec(n,s[x-1],s[x])<d)return!0;return!1}function Ec(n,s,l){var d=s.distSqr(l);if(d===0)return n.distSqr(s);var x=((n.x-s.x)*(l.x-s.x)+(n.y-s.y)*(l.y-s.y))/d;return n.distSqr(x<0?s:x>1?l:l.sub(s)._mult(x)._add(s))}function Hc(n,s){for(var l,d,x,C=!1,T=0;T<n.length;T++)for(var R=0,z=(l=n[T]).length-1;R<l.length;z=R++)(d=l[R]).y>s.y!=(x=l[z]).y>s.y&&s.x<(x.x-d.x)*(s.y-d.y)/(x.y-d.y)+d.x&&(C=!C);return C}function jl(n,s){for(var l=!1,d=0,x=n.length-1;d<n.length;x=d++){var C=n[d],T=n[x];C.y>s.y!=T.y>s.y&&s.x<(T.x-C.x)*(s.y-C.y)/(T.y-C.y)+C.x&&(l=!l)}return l}function Wc(n,s,l){var d=l[0],x=l[2];if(n.x<d.x&&s.x<d.x||n.x>x.x&&s.x>x.x||n.y<d.y&&s.y<d.y||n.y>x.y&&s.y>x.y)return!1;var C=Cr(n,s,l[0]);return C!==Cr(n,s,l[1])||C!==Cr(n,s,l[2])||C!==Cr(n,s,l[3])}function gl(n,s,l){var d=s.paint.get(n).value;return d.kind==="constant"?d.value:l.programConfigurations.get(s.id).getMaxValue(n)}function gs(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function uu(n,s,l,d,x){if(!s[0]&&!s[1])return n;var C=he.convert(s)._mult(x);l==="viewport"&&C._rotate(-d);for(var T=[],R=0;R<n.length;R++)T.push(n[R].sub(C));return T}su.prototype.populate=function(n,s,l){var d=this.layers[0],x=[],C=null;d.type==="circle"&&(C=d.layout.get("circle-sort-key"));for(var T=0,R=n;T<R.length;T+=1){var z=R[T],W=z.feature,$=z.id,ee=z.index,le=z.sourceLayerIndex,be=this.layers[0]._featureFilter.needGeometry,$e=Wo(W,be);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),$e,l)){var Je=C?C.evaluate($e,{},l):void 0,dt={id:$,properties:W.properties,type:W.type,sourceLayerIndex:le,index:ee,geometry:be?$e.geometry:Bo(W),patterns:{},sortKey:Je};x.push(dt)}}C&&x.sort(function(Bn,wi){return Bn.sortKey-wi.sortKey});for(var st=0,Dt=x;st<Dt.length;st+=1){var kt=Dt[st],lr=kt.geometry,yr=kt.index,zr=kt.sourceLayerIndex,hn=n[yr].feature;this.addFeature(kt,lr,yr,l),s.featureIndex.insert(hn,lr,yr,zr,this.index)}},su.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},su.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},su.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xe),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},su.prototype.addFeature=function(n,s,l,d){for(var x=0,C=s;x<C.length;x+=1)for(var T=0,R=C[x];T<R.length;T+=1){var z=R[T],W=z.x,$=z.y;if(!(W<0||W>=8192||$<0||$>=8192)){var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),le=ee.vertexLength;ou(this.layoutVertexArray,W,$,-1,-1),ou(this.layoutVertexArray,W,$,1,-1),ou(this.layoutVertexArray,W,$,1,1),ou(this.layoutVertexArray,W,$,-1,1),this.indexArray.emplaceBack(le,le+1,le+2),this.indexArray.emplaceBack(le,le+3,le+2),ee.vertexLength+=4,ee.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},d)},Jn("CircleBucket",su,{omit:["layers"]});var Gl=new $o({"circle-sort-key":new vi(Te.layout_circle["circle-sort-key"])}),ic={paint:new $o({"circle-radius":new vi(Te.paint_circle["circle-radius"]),"circle-color":new vi(Te.paint_circle["circle-color"]),"circle-blur":new vi(Te.paint_circle["circle-blur"]),"circle-opacity":new vi(Te.paint_circle["circle-opacity"]),"circle-translate":new Ei(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Ei(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ei(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ei(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vi(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vi(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vi(Te.paint_circle["circle-stroke-opacity"])}),layout:Gl},Va=typeof Float32Array!="undefined"?Float32Array:Array;function _u(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function lu(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],R=s[4],z=s[5],W=s[6],$=s[7],ee=s[8],le=s[9],be=s[10],$e=s[11],Je=s[12],dt=s[13],st=s[14],Dt=s[15],kt=l[0],lr=l[1],yr=l[2],zr=l[3];return n[0]=kt*d+lr*R+yr*ee+zr*Je,n[1]=kt*x+lr*z+yr*le+zr*dt,n[2]=kt*C+lr*W+yr*be+zr*st,n[3]=kt*T+lr*$+yr*$e+zr*Dt,n[4]=(kt=l[4])*d+(lr=l[5])*R+(yr=l[6])*ee+(zr=l[7])*Je,n[5]=kt*x+lr*z+yr*le+zr*dt,n[6]=kt*C+lr*W+yr*be+zr*st,n[7]=kt*T+lr*$+yr*$e+zr*Dt,n[8]=(kt=l[8])*d+(lr=l[9])*R+(yr=l[10])*ee+(zr=l[11])*Je,n[9]=kt*x+lr*z+yr*le+zr*dt,n[10]=kt*C+lr*W+yr*be+zr*st,n[11]=kt*T+lr*$+yr*$e+zr*Dt,n[12]=(kt=l[12])*d+(lr=l[13])*R+(yr=l[14])*ee+(zr=l[15])*Je,n[13]=kt*x+lr*z+yr*le+zr*dt,n[14]=kt*C+lr*W+yr*be+zr*st,n[15]=kt*T+lr*$+yr*$e+zr*Dt,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,s=0,l=arguments.length;l--;)s+=n[l]*n[l];return Math.sqrt(s)});var Cc,_h=lu;function Sf(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3];return n[0]=l[0]*d+l[4]*x+l[8]*C+l[12]*T,n[1]=l[1]*d+l[5]*x+l[9]*C+l[13]*T,n[2]=l[2]*d+l[6]*x+l[10]*C+l[14]*T,n[3]=l[3]*d+l[7]*x+l[11]*C+l[15]*T,n}Cc=new Va(3),Va!=Float32Array&&(Cc[0]=0,Cc[1]=0,Cc[2]=0),function(){var n=new Va(4);Va!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var Xc=(function(){var n=new Va(2);Va!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function s(l){n.call(this,l,ic)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new su(l)},s.prototype.queryRadius=function(l){var d=l;return gl("circle-radius",this,d)+gl("circle-stroke-width",this,d)+gs(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,R,z,W){for(var $=uu(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,z),ee=this.paint.get("circle-radius").evaluate(d,x)+this.paint.get("circle-stroke-width").evaluate(d,x),le=this.paint.get("circle-pitch-alignment")==="map",be=le?$:function(hn,Bn){return hn.map(function(wi){return Ks(wi,Bn)})}($,W),$e=le?ee*z:ee,Je=0,dt=C;Je<dt.length;Je+=1)for(var st=0,Dt=dt[Je];st<Dt.length;st+=1){var kt=Dt[st],lr=le?kt:Ks(kt,W),yr=$e,zr=Sf([],[kt.x,kt.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?yr*=zr[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(yr*=R.cameraToCenterDistance/zr[3]),ms(be,lr,yr))return!0}return!1},s}(Tl));function Ks(n,s){var l=Sf([],[n.x,n.y,0,1],s);return new he(l[0]/l[3],l[1]/l[3])}var xh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(su);function tl(n,s,l,d){var x=s.width,C=s.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==x*C*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(x*C*l);return n.width=x,n.height=C,n.data=d,n}function Yc(n,s,l){var d=s.width,x=s.height;if(d!==n.width||x!==n.height){var C=tl({},{width:d,height:x},l);bh(n,C,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,d),height:Math.min(n.height,x)},l),n.width=d,n.height=x,n.data=C.data}}function bh(n,s,l,d,x,C){if(x.width===0||x.height===0)return s;if(x.width>n.width||x.height>n.height||l.x>n.width-x.width||l.y>n.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>s.width||x.height>s.height||d.x>s.width-x.width||d.y>s.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=n.data,R=s.data,z=0;z<x.height;z++)for(var W=((l.y+z)*n.width+l.x)*C,$=((d.y+z)*s.width+d.x)*C,ee=0;ee<x.width*C;ee++)R[$+ee]=T[W+ee];return s}Jn("HeatmapBucket",xh,{omit:["layers"]});var ac=function(n,s){tl(this,n,1,s)};ac.prototype.resize=function(n){Yc(this,n,1)},ac.prototype.clone=function(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))},ac.copy=function(n,s,l,d,x){bh(n,s,l,d,x,1)};var Xo=function(n,s){tl(this,n,4,s)};Xo.prototype.resize=function(n){Yc(this,n,4)},Xo.prototype.replace=function(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},Xo.prototype.clone=function(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))},Xo.copy=function(n,s,l,d,x){bh(n,s,l,d,x,4)},Jn("AlphaImage",ac),Jn("RGBAImage",Xo);var qf={paint:new $o({"heatmap-radius":new vi(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vi(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ei(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hl(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ei(Te.paint_heatmap["heatmap-opacity"])})};function Iu(n){var s={},l=n.resolution||256,d=n.clips?n.clips.length:1,x=n.image||new Xo({width:l,height:d}),C=function($e,Je,dt){s[n.evaluationKey]=dt;var st=n.expression.evaluate(s);x.data[$e+Je+0]=Math.floor(255*st.r/st.a),x.data[$e+Je+1]=Math.floor(255*st.g/st.a),x.data[$e+Je+2]=Math.floor(255*st.b/st.a),x.data[$e+Je+3]=Math.floor(255*st.a)};if(n.clips)for(var T=0,R=0;T<d;++T,R+=4*l)for(var z=0,W=0;z<l;z++,W+=4){var $=z/(l-1),ee=n.clips[T];C(R,W,ee.start*(1-$)+ee.end*$)}else for(var le=0,be=0;le<l;le++,be+=4)C(0,be,le/(l-1));return x}var Sc=function(n){function s(l){n.call(this,l,qf),this._updateColorRamp()}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new xh(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Iu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Tl),qc={paint:new $o({"hillshade-illumination-direction":new Ei(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ei(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ei(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ei(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ei(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ei(Te.paint_hillshade["hillshade-accent-color"])})},$h=function(n){function s(l){n.call(this,l,qc)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Tl),xp=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,Af=ye,Fu=ye;function ye(n,s,l){l=l||2;var d,x,C,T,R,z,W,$=s&&s.length,ee=$?s[0]*l:n.length,le=cn(n,0,ee,l,!0),be=[];if(!le||le.next===le.prev)return be;if($&&(le=function(Je,dt,st,Dt){var kt,lr,yr,zr=[];for(kt=0,lr=dt.length;kt<lr;kt++)(yr=cn(Je,dt[kt]*Dt,kt<lr-1?dt[kt+1]*Dt:Je.length,Dt,!1))===yr.next&&(yr.steiner=!0),zr.push(Tf(yr));for(zr.sort(wf),kt=0;kt<zr.length;kt++)$f(zr[kt],st),st=Hl(st,st.next);return st}(n,s,le,l)),n.length>80*l){d=C=n[0],x=T=n[1];for(var $e=l;$e<ee;$e+=l)(R=n[$e])<d&&(d=R),(z=n[$e+1])<x&&(x=z),R>C&&(C=R),z>T&&(T=z);W=(W=Math.max(C-d,T-x))!==0?1/W:0}return Kh(le,be,l,d,x,W),be}function cn(n,s,l,d,x){var C,T;if(x===Ep(n,s,l,d)>0)for(C=s;C<l;C+=d)T=Ch(C,n[C],n[C+1],T);else for(C=l-d;C>=s;C-=d)T=Ch(C,n[C],n[C+1],T);return T&&Ki(T,T.next)&&(kl(T),T=T.next),T}function Hl(n,s){if(!n)return n;s||(s=n);var l,d=n;do if(l=!1,d.steiner||!Ki(d,d.next)&&ps(d.prev,d,d.next)!==0)d=d.next;else{if(kl(d),(d=s=d.prev)===d.next)break;l=!0}while(l||d!==s);return s}function Kh(n,s,l,d,x,C,T){if(n){!T&&C&&function($,ee,le,be){var $e=$;do $e.z===null&&($e.z=yd($e.x,$e.y,ee,le,be)),$e.prevZ=$e.prev,$e.nextZ=$e.next,$e=$e.next;while($e!==$);$e.prevZ.nextZ=null,$e.prevZ=null,function(Je){var dt,st,Dt,kt,lr,yr,zr,hn,Bn=1;do{for(st=Je,Je=null,lr=null,yr=0;st;){for(yr++,Dt=st,zr=0,dt=0;dt<Bn&&(zr++,Dt=Dt.nextZ);dt++);for(hn=Bn;zr>0||hn>0&&Dt;)zr!==0&&(hn===0||!Dt||st.z<=Dt.z)?(kt=st,st=st.nextZ,zr--):(kt=Dt,Dt=Dt.nextZ,hn--),lr?lr.nextZ=kt:Je=kt,kt.prevZ=lr,lr=kt;st=Dt}lr.nextZ=null,Bn*=2}while(yr>1)}($e)}(n,d,x,C);for(var R,z,W=n;n.prev!==n.next;)if(R=n.prev,z=n.next,C?ku(n,d,x,C):Po(n))s.push(R.i/l),s.push(n.i/l),s.push(z.i/l),kl(n),n=z.next,W=z.next;else if((n=z)===W){T?T===1?Kh(n=Ac(Hl(n),s,l),s,l,d,x,C,2):T===2&&Eh(n,s,l,d,x,C):Kh(Hl(n),s,l,d,x,C,1);break}}}function Po(n){var s=n.prev,l=n,d=n.next;if(ps(s,l,d)>=0)return!1;for(var x=n.next.next;x!==n.prev;){if($c(s.x,s.y,l.x,l.y,d.x,d.y,x.x,x.y)&&ps(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function ku(n,s,l,d){var x=n.prev,C=n,T=n.next;if(ps(x,C,T)>=0)return!1;for(var R=x.x>C.x?x.x>T.x?x.x:T.x:C.x>T.x?C.x:T.x,z=x.y>C.y?x.y>T.y?x.y:T.y:C.y>T.y?C.y:T.y,W=yd(x.x<C.x?x.x<T.x?x.x:T.x:C.x<T.x?C.x:T.x,x.y<C.y?x.y<T.y?x.y:T.y:C.y<T.y?C.y:T.y,s,l,d),$=yd(R,z,s,l,d),ee=n.prevZ,le=n.nextZ;ee&&ee.z>=W&&le&&le.z<=$;){if(ee!==n.prev&&ee!==n.next&&$c(x.x,x.y,C.x,C.y,T.x,T.y,ee.x,ee.y)&&ps(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,le!==n.prev&&le!==n.next&&$c(x.x,x.y,C.x,C.y,T.x,T.y,le.x,le.y)&&ps(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ee&&ee.z>=W;){if(ee!==n.prev&&ee!==n.next&&$c(x.x,x.y,C.x,C.y,T.x,T.y,ee.x,ee.y)&&ps(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;le&&le.z<=$;){if(le!==n.prev&&le!==n.next&&$c(x.x,x.y,C.x,C.y,T.x,T.y,le.x,le.y)&&ps(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function Ac(n,s,l){var d=n;do{var x=d.prev,C=d.next.next;!Ki(x,C)&&qd(x,d,d.next,C)&&Qh(x,C)&&Qh(C,x)&&(s.push(x.i/l),s.push(d.i/l),s.push(C.i/l),kl(d),kl(d.next),d=n=C),d=d.next}while(d!==n);return Hl(d)}function Eh(n,s,l,d,x,C){var T=n;do{for(var R=T.next.next;R!==T.prev;){if(T.i!==R.i&&bp(T,R)){var z=Kc(T,R);return T=Hl(T,T.next),z=Hl(z,z.next),Kh(T,s,l,d,x,C),void Kh(z,s,l,d,x,C)}R=R.next}T=T.next}while(T!==n)}function wf(n,s){return n.x-s.x}function $f(n,s){if(s=function(d,x){var C,T=x,R=d.x,z=d.y,W=-1/0;do{if(z<=T.y&&z>=T.next.y&&T.next.y!==T.y){var $=T.x+(z-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=R&&$>W){if(W=$,$===R){if(z===T.y)return T;if(z===T.next.y)return T.next}C=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!C)return null;if(R===W)return C;var ee,le=C,be=C.x,$e=C.y,Je=1/0;T=C;do R>=T.x&&T.x>=be&&R!==T.x&&$c(z<$e?R:W,z,be,$e,z<$e?W:R,z,T.x,T.y)&&(ee=Math.abs(z-T.y)/(R-T.x),Qh(T,d)&&(ee<Je||ee===Je&&(T.x>C.x||T.x===C.x&&oc(C,T)))&&(C=T,Je=ee)),T=T.next;while(T!==le);return C}(n,s)){var l=Kc(s,n);Hl(s,s.next),Hl(l,l.next)}}function oc(n,s){return ps(n.prev,n,s.prev)<0&&ps(s.next,n,n.next)<0}function yd(n,s,l,d,x){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*x)|n<<8))|n<<4))|n<<2))|n<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-d)*x)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Tf(n){var s=n,l=n;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==n);return l}function $c(n,s,l,d,x,C,T,R){return(x-T)*(s-R)-(n-T)*(C-R)>=0&&(n-T)*(d-R)-(l-T)*(s-R)>=0&&(l-T)*(C-R)-(x-T)*(d-R)>=0}function bp(n,s){return n.next.i!==s.i&&n.prev.i!==s.i&&!function(l,d){var x=l;do{if(x.i!==l.i&&x.next.i!==l.i&&x.i!==d.i&&x.next.i!==d.i&&qd(x,x.next,l,d))return!0;x=x.next}while(x!==l);return!1}(n,s)&&(Qh(n,s)&&Qh(s,n)&&function(l,d){var x=l,C=!1,T=(l.x+d.x)/2,R=(l.y+d.y)/2;do x.y>R!=x.next.y>R&&x.next.y!==x.y&&T<(x.next.x-x.x)*(R-x.y)/(x.next.y-x.y)+x.x&&(C=!C),x=x.next;while(x!==l);return C}(n,s)&&(ps(n.prev,n,s.prev)||ps(n,s.prev,s))||Ki(n,s)&&ps(n.prev,n,n.next)>0&&ps(s.prev,s,s.next)>0)}function ps(n,s,l){return(s.y-n.y)*(l.x-s.x)-(s.x-n.x)*(l.y-s.y)}function Ki(n,s){return n.x===s.x&&n.y===s.y}function qd(n,s,l,d){var x=wc(ps(n,s,l)),C=wc(ps(n,s,d)),T=wc(ps(l,d,n)),R=wc(ps(l,d,s));return x!==C&&T!==R||!(x!==0||!qp(n,l,s))||!(C!==0||!qp(n,d,s))||!(T!==0||!qp(l,n,d))||!(R!==0||!qp(l,s,d))}function qp(n,s,l){return s.x<=Math.max(n.x,l.x)&&s.x>=Math.min(n.x,l.x)&&s.y<=Math.max(n.y,l.y)&&s.y>=Math.min(n.y,l.y)}function wc(n){return n>0?1:n<0?-1:0}function Qh(n,s){return ps(n.prev,n,n.next)<0?ps(n,s,n.next)>=0&&ps(n,n.prev,s)>=0:ps(n,s,n.prev)<0||ps(n,n.next,s)<0}function Kc(n,s){var l=new Jh(n.i,n.x,n.y),d=new Jh(s.i,s.x,s.y),x=n.next,C=s.prev;return n.next=s,s.prev=n,l.next=x,x.prev=l,d.next=l,l.prev=d,C.next=d,d.prev=C,d}function Ch(n,s,l,d){var x=new Jh(n,s,l);return d?(x.next=d.next,x.prev=d,d.next.prev=x,d.next=x):(x.prev=x,x.next=x),x}function kl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Jh(n,s,l){this.i=n,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ep(n,s,l,d){for(var x=0,C=s,T=l-d;C<l;C+=d)x+=(n[T]-n[C])*(n[C+1]+n[T+1]),T=C;return x}function rl(n,s,l,d,x){(function C(T,R,z,W,$){for(;W>z;){if(W-z>600){var ee=W-z+1,le=R-z+1,be=Math.log(ee),$e=.5*Math.exp(2*be/3),Je=.5*Math.sqrt(be*$e*(ee-$e)/ee)*(le-ee/2<0?-1:1);C(T,R,Math.max(z,Math.floor(R-le*$e/ee+Je)),Math.min(W,Math.floor(R+(ee-le)*$e/ee+Je)),$)}var dt=T[R],st=z,Dt=W;for(Kf(T,z,R),$(T[W],dt)>0&&Kf(T,z,W);st<Dt;){for(Kf(T,st,Dt),st++,Dt--;$(T[st],dt)<0;)st++;for(;$(T[Dt],dt)>0;)Dt--}$(T[z],dt)===0?Kf(T,z,Dt):Kf(T,++Dt,W),Dt<=R&&(z=Dt+1),R<=Dt&&(W=Dt-1)}})(n,s,l||0,d||n.length-1,x||$p)}function Kf(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}function $p(n,s){return n<s?-1:n>s?1:0}function Cp(n,s){var l=n.length;if(l<=1)return[n];for(var d,x,C=[],T=0;T<l;T++){var R=nn(n[T]);R!==0&&(n[T].area=Math.abs(R),x===void 0&&(x=R<0),x===R<0?(d&&C.push(d),d=[n[T]]):d.push(n[T]))}if(d&&C.push(d),s>1)for(var z=0;z<C.length;z++)C[z].length<=s||(rl(C[z],s,1,C[z].length-1,Kp),C[z]=C[z].slice(0,s));return C}function Kp(n,s){return s.area-n.area}function ep(n,s,l){for(var d=l.patternDependencies,x=!1,C=0,T=s;C<T.length;C+=1){var R=T[C].paint.get(n+"-pattern");R.isConstant()||(x=!0);var z=R.constantOr(null);z&&(x=!0,d[z.to]=!0,d[z.from]=!0)}return x}function Mf(n,s,l,d,x){for(var C=x.patternDependencies,T=0,R=s;T<R.length;T+=1){var z=R[T],W=z.paint.get(n+"-pattern").value;if(W.kind!=="constant"){var $=W.evaluate({zoom:d-1},l,{},x.availableImages),ee=W.evaluate({zoom:d},l,{},x.availableImages),le=W.evaluate({zoom:d+1},l,{},x.availableImages);ee=ee&&ee.name?ee.name:ee,le=le&&le.name?le.name:le,C[$=$&&$.name?$.name:$]=!0,C[ee]=!0,C[le]=!0,l.patterns[z.id]={min:$,mid:ee,max:le}}}return l}ye.deviation=function(n,s,l,d){var x=s&&s.length,C=Math.abs(Ep(n,0,x?s[0]*l:n.length,l));if(x)for(var T=0,R=s.length;T<R;T++)C-=Math.abs(Ep(n,s[T]*l,T<R-1?s[T+1]*l:n.length,l));var z=0;for(T=0;T<d.length;T+=3){var W=d[T]*l,$=d[T+1]*l,ee=d[T+2]*l;z+=Math.abs((n[W]-n[ee])*(n[$+1]-n[W+1])-(n[W]-n[$])*(n[ee+1]-n[W+1]))}return C===0&&z===0?0:Math.abs((z-C)/C)},ye.flatten=function(n){for(var s=n[0][0].length,l={vertices:[],holes:[],dimensions:s},d=0,x=0;x<n.length;x++){for(var C=0;C<n[x].length;C++)for(var T=0;T<s;T++)l.vertices.push(n[x][C][T]);x>0&&l.holes.push(d+=n[x-1].length)}return l},Af.default=Fu;var Qs=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xf,this.indexArray=new Zl,this.indexArray2=new yh,this.programConfigurations=new Li(n.layers,n.zoom),this.segments=new Ce,this.segments2=new Ce,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Qs.prototype.populate=function(n,s,l){this.hasPattern=ep("fill",this.layers,s);for(var d=this.layers[0].layout.get("fill-sort-key"),x=[],C=0,T=n;C<T.length;C+=1){var R=T[C],z=R.feature,W=R.id,$=R.index,ee=R.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,be=Wo(z,le);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),be,l)){var $e=d?d.evaluate(be,{},l,s.availableImages):void 0,Je={id:W,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:$,geometry:le?be.geometry:Bo(z),patterns:{},sortKey:$e};x.push(Je)}}d&&x.sort(function(hn,Bn){return hn.sortKey-Bn.sortKey});for(var dt=0,st=x;dt<st.length;dt+=1){var Dt=st[dt],kt=Dt.geometry,lr=Dt.index,yr=Dt.sourceLayerIndex;if(this.hasPattern){var zr=Mf("fill",this.layers,Dt,this.zoom,s);this.patternFeatures.push(zr)}else this.addFeature(Dt,kt,lr,l,{});s.featureIndex.insert(n[lr].feature,kt,lr,yr,this.index)}},Qs.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},Qs.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},Qs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qs.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xp),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Qs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Qs.prototype.addFeature=function(n,s,l,d,x){for(var C=0,T=Cp(s,500);C<T.length;C+=1){for(var R=T[C],z=0,W=0,$=R;W<$.length;W+=1)z+=$[W].length;for(var ee=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),le=ee.vertexLength,be=[],$e=[],Je=0,dt=R;Je<dt.length;Je+=1){var st=dt[Je];if(st.length!==0){st!==R[0]&&$e.push(be.length/2);var Dt=this.segments2.prepareSegment(st.length,this.layoutVertexArray,this.indexArray2),kt=Dt.vertexLength;this.layoutVertexArray.emplaceBack(st[0].x,st[0].y),this.indexArray2.emplaceBack(kt+st.length-1,kt),be.push(st[0].x),be.push(st[0].y);for(var lr=1;lr<st.length;lr++)this.layoutVertexArray.emplaceBack(st[lr].x,st[lr].y),this.indexArray2.emplaceBack(kt+lr-1,kt+lr),be.push(st[lr].x),be.push(st[lr].y);Dt.vertexLength+=st.length,Dt.primitiveLength+=st.length}}for(var yr=Af(be,$e),zr=0;zr<yr.length;zr+=3)this.indexArray.emplaceBack(le+yr[zr],le+yr[zr+1],le+yr[zr+2]);ee.vertexLength+=z,ee.primitiveLength+=yr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},Jn("FillBucket",Qs,{omit:["layers","patternFeatures"]});var If=new $o({"fill-sort-key":new vi(Te.layout_fill["fill-sort-key"])}),Sh={paint:new $o({"fill-antialias":new Ei(Te.paint_fill["fill-antialias"]),"fill-opacity":new vi(Te.paint_fill["fill-opacity"]),"fill-color":new vi(Te.paint_fill["fill-color"]),"fill-outline-color":new vi(Te.paint_fill["fill-outline-color"]),"fill-translate":new Ei(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Ei(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wf(Te.paint_fill["fill-pattern"])}),layout:If},Ah=function(n){function s(l){n.call(this,l,Sh)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new Qs(l)},s.prototype.queryRadius=function(){return gs(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,R,z){return Vl(uu(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,z),C)},s.prototype.isTileClipped=function(){return!0},s}(Tl),Qc=_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,nl=Tc;function Tc(n,s,l,d,x){this.properties={},this.extent=l,this.type=0,this._pbf=n,this._geometry=-1,this._keys=d,this._values=x,n.readFields(Wl,this,s)}function Wl(n,s,l){n==1?s.id=l.readVarint():n==2?function(d,x){for(var C=d.readVarint()+d.pos;d.pos<C;){var T=x._keys[d.readVarint()],R=x._values[d.readVarint()];x.properties[T]=R}}(l,s):n==3?s.type=l.readVarint():n==4&&(s._geometry=l.pos)}function Qp(n){for(var s,l,d=0,x=0,C=n.length,T=C-1;x<C;T=x++)d+=((l=n[T]).x-(s=n[x]).x)*(s.y+l.y);return d}Tc.types=["Unknown","Point","LineString","Polygon"],Tc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var s,l=n.readVarint()+n.pos,d=1,x=0,C=0,T=0,R=[];n.pos<l;){if(x<=0){var z=n.readVarint();d=7&z,x=z>>3}if(x--,d===1||d===2)C+=n.readSVarint(),T+=n.readSVarint(),d===1&&(s&&R.push(s),s=[]),s.push(new he(C,T));else{if(d!==7)throw new Error("unknown command "+d);s&&s.push(s[0].clone())}}return s&&R.push(s),R},Tc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var s=n.readVarint()+n.pos,l=1,d=0,x=0,C=0,T=1/0,R=-1/0,z=1/0,W=-1/0;n.pos<s;){if(d<=0){var $=n.readVarint();l=7&$,d=$>>3}if(d--,l===1||l===2)(x+=n.readSVarint())<T&&(T=x),x>R&&(R=x),(C+=n.readSVarint())<z&&(z=C),C>W&&(W=C);else if(l!==7)throw new Error("unknown command "+l)}return[T,z,R,W]},Tc.prototype.toGeoJSON=function(n,s,l){var d,x,C=this.extent*Math.pow(2,l),T=this.extent*n,R=this.extent*s,z=this.loadGeometry(),W=Tc.types[this.type];function $(be){for(var $e=0;$e<be.length;$e++){var Je=be[$e];be[$e]=[360*(Je.x+T)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(Je.y+R)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var ee=[];for(d=0;d<z.length;d++)ee[d]=z[d][0];$(z=ee);break;case 2:for(d=0;d<z.length;d++)$(z[d]);break;case 3:for(z=function(be){var $e=be.length;if($e<=1)return[be];for(var Je,dt,st=[],Dt=0;Dt<$e;Dt++){var kt=Qp(be[Dt]);kt!==0&&(dt===void 0&&(dt=kt<0),dt===kt<0?(Je&&st.push(Je),Je=[be[Dt]]):Je.push(be[Dt]))}return Je&&st.push(Je),st}(z),d=0;d<z.length;d++)for(x=0;x<z[d].length;x++)$(z[d][x])}z.length===1?z=z[0]:W="Multi"+W;var le={type:"Feature",geometry:{type:W,coordinates:z},properties:this.properties};return"id"in this&&(le.id=this.id),le};var Du=sc;function sc(n,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(tp,this,s),this.length=this._features.length}function tp(n,s,l){n===15?s.version=l.readVarint():n===1?s.name=l.readString():n===5?s.extent=l.readVarint():n===2?s._features.push(l.pos):n===3?s._keys.push(l.readString()):n===4&&s._values.push(function(d){for(var x=null,C=d.readVarint()+d.pos;d.pos<C;){var T=d.readVarint()>>3;x=T===1?d.readString():T===2?d.readFloat():T===3?d.readDouble():T===4?d.readVarint64():T===5?d.readVarint():T===6?d.readSVarint():T===7?d.readBoolean():null}return x}(l))}function kf(n,s,l){if(n===3){var d=new Du(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}sc.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var s=this._pbf.readVarint()+this._pbf.pos;return new nl(this._pbf,s,this.extent,this._keys,this._values)};var cu={VectorTile:function(n,s){this.layers=n.readFields(kf,{},s)},VectorTileFeature:nl,VectorTileLayer:Du},Sp=cu.VectorTileFeature.types,Qf=Math.pow(2,13);function Jf(n,s,l,d,x,C,T,R){n.emplaceBack(s,l,2*Math.floor(d*Qf)+T,x*Qf*2,C*Qf*2,Math.round(R))}var uc=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new el,this.indexArray=new Zl,this.programConfigurations=new Li(n.layers,n.zoom),this.segments=new Ce,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function $d(n,s){return n.x===s.x&&(n.x<0||n.x>8192)||n.y===s.y&&(n.y<0||n.y>8192)}uc.prototype.populate=function(n,s,l){this.features=[],this.hasPattern=ep("fill-extrusion",this.layers,s);for(var d=0,x=n;d<x.length;d+=1){var C=x[d],T=C.feature,R=C.id,z=C.index,W=C.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ee=Wo(T,$);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),ee,l)){var le={id:R,sourceLayerIndex:W,index:z,geometry:$?ee.geometry:Bo(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Mf("fill-extrusion",this.layers,le,this.zoom,s)):this.addFeature(le,le.geometry,z,l,{}),s.featureIndex.insert(T,le.geometry,z,W,this.index,!0)}}},uc.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.features;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},uc.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},uc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},uc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},uc.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Qc),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},uc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},uc.prototype.addFeature=function(n,s,l,d,x){for(var C=0,T=Cp(s,500);C<T.length;C+=1){for(var R=T[C],z=0,W=0,$=R;W<$.length;W+=1)z+=$[W].length;for(var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),le=0,be=R;le<be.length;le+=1){var $e=be[le];if($e.length!==0&&!((ga=$e).every(function(da){return da.x<0})||ga.every(function(da){return da.x>8192})||ga.every(function(da){return da.y<0})||ga.every(function(da){return da.y>8192})))for(var Je=0,dt=0;dt<$e.length;dt++){var st=$e[dt];if(dt>=1){var Dt=$e[dt-1];if(!$d(st,Dt)){ee.vertexLength+4>Ce.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var kt=st.sub(Dt)._perp()._unit(),lr=Dt.dist(st);Je+lr>32768&&(Je=0),Jf(this.layoutVertexArray,st.x,st.y,kt.x,kt.y,0,0,Je),Jf(this.layoutVertexArray,st.x,st.y,kt.x,kt.y,0,1,Je),Jf(this.layoutVertexArray,Dt.x,Dt.y,kt.x,kt.y,0,0,Je+=lr),Jf(this.layoutVertexArray,Dt.x,Dt.y,kt.x,kt.y,0,1,Je);var yr=ee.vertexLength;this.indexArray.emplaceBack(yr,yr+2,yr+1),this.indexArray.emplaceBack(yr+1,yr+2,yr+3),ee.vertexLength+=4,ee.primitiveLength+=2}}}}if(ee.vertexLength+z>Ce.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Sp[n.type]==="Polygon"){for(var zr=[],hn=[],Bn=ee.vertexLength,wi=0,$n=R;wi<$n.length;wi+=1){var Ci=$n[wi];if(Ci.length!==0){Ci!==R[0]&&hn.push(zr.length/2);for(var ri=0;ri<Ci.length;ri++){var Ca=Ci[ri];Jf(this.layoutVertexArray,Ca.x,Ca.y,0,0,1,1,0),zr.push(Ca.x),zr.push(Ca.y)}}}for(var ki=Af(zr,hn),hi=0;hi<ki.length;hi+=3)this.indexArray.emplaceBack(Bn+ki[hi],Bn+ki[hi+2],Bn+ki[hi+1]);ee.primitiveLength+=ki.length/3,ee.vertexLength+=z}}var ga;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},Jn("FillExtrusionBucket",uc,{omit:["layers","features"]});var Kd={paint:new $o({"fill-extrusion-opacity":new Ei(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vi(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ei(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ei(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wf(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vi(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vi(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ei(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Mc=function(n){function s(l){n.call(this,l,Kd)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new uc(l)},s.prototype.queryRadius=function(){return gs(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,R,z,W){var $=uu(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,z),ee=this.paint.get("fill-extrusion-height").evaluate(d,x),le=this.paint.get("fill-extrusion-base").evaluate(d,x),be=function(Je,dt,st,Dt){for(var kt=[],lr=0,yr=Je;lr<yr.length;lr+=1){var zr=yr[lr],hn=[zr.x,zr.y,0,1];Sf(hn,hn,dt),kt.push(new he(hn[0]/hn[3],hn[1]/hn[3]))}return kt}($,W),$e=function(Je,dt,st,Dt){for(var kt=[],lr=[],yr=Dt[8]*dt,zr=Dt[9]*dt,hn=Dt[10]*dt,Bn=Dt[11]*dt,wi=Dt[8]*st,$n=Dt[9]*st,Ci=Dt[10]*st,ri=Dt[11]*st,Ca=0,ki=Je;Ca<ki.length;Ca+=1){for(var hi=[],ga=[],da=0,Da=ki[Ca];da<Da.length;da+=1){var Mi=Da[da],Ha=Mi.x,Yo=Mi.y,ns=Dt[0]*Ha+Dt[4]*Yo+Dt[12],ds=Dt[1]*Ha+Dt[5]*Yo+Dt[13],Jo=Dt[2]*Ha+Dt[6]*Yo+Dt[14],Es=Dt[3]*Ha+Dt[7]*Yo+Dt[15],hu=Jo+hn,is=Es+Bn,Uu=ns+wi,bu=ds+$n,Pu=Jo+Ci,Is=Es+ri,pu=new he((ns+yr)/is,(ds+zr)/is);pu.z=hu/is,hi.push(pu);var Ba=new he(Uu/Is,bu/Is);Ba.z=Pu/Is,ga.push(Ba)}kt.push(hi),lr.push(ga)}return[kt,lr]}(C,le,ee,W);return function(Je,dt,st){var Dt=1/0;Vl(st,dt)&&(Dt=Jc(st,dt[0]));for(var kt=0;kt<dt.length;kt++)for(var lr=dt[kt],yr=Je[kt],zr=0;zr<lr.length-1;zr++){var hn=lr[zr],Bn=[hn,lr[zr+1],yr[zr+1],yr[zr],hn];Ms(st,Bn)&&(Dt=Math.min(Dt,Jc(st,Bn)))}return Dt!==1/0&&Dt}($e[0],$e[1],be)},s}(Tl);function wh(n,s){return n.x*s.x+n.y*s.y}function Jc(n,s){if(n.length===1){for(var l,d=0,x=s[d++];!l||x.equals(l);)if(!(l=s[d++]))return 1/0;for(;d<s.length;d++){var C=s[d],T=n[0],R=l.sub(x),z=C.sub(x),W=T.sub(x),$=wh(R,R),ee=wh(R,z),le=wh(z,z),be=wh(W,R),$e=wh(W,z),Je=$*le-ee*ee,dt=(le*be-ee*$e)/Je,st=($*$e-ee*be)/Je,Dt=x.z*(1-dt-st)+l.z*dt+C.z*st;if(isFinite(Dt))return Dt}return 1/0}for(var kt=1/0,lr=0,yr=s;lr<yr.length;lr+=1)kt=Math.min(kt,yr[lr].z);return kt}var ef=_o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,_d=_o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,xd=cu.VectorTileFeature.types,Jp=Math.cos(Math.PI/180*37.5),rp=Math.pow(2,14)/.5,ua=function(n){var s=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new $s,this.layoutVertexArray2=new dl,this.indexArray=new Zl,this.programConfigurations=new Li(n.layers,n.zoom),this.segments=new Ce,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};ua.prototype.populate=function(n,s,l){this.hasPattern=ep("line",this.layers,s);for(var d=this.layers[0].layout.get("line-sort-key"),x=[],C=0,T=n;C<T.length;C+=1){var R=T[C],z=R.feature,W=R.id,$=R.index,ee=R.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,be=Wo(z,le);if(this.layers[0]._featureFilter.filter(new pa(this.zoom),be,l)){var $e=d?d.evaluate(be,{},l):void 0,Je={id:W,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:$,geometry:le?be.geometry:Bo(z),patterns:{},sortKey:$e};x.push(Je)}}d&&x.sort(function(hn,Bn){return hn.sortKey-Bn.sortKey});for(var dt=0,st=x;dt<st.length;dt+=1){var Dt=st[dt],kt=Dt.geometry,lr=Dt.index,yr=Dt.sourceLayerIndex;if(this.hasPattern){var zr=Mf("line",this.layers,Dt,this.zoom,s);this.patternFeatures.push(zr)}else this.addFeature(Dt,kt,lr,l,{});s.featureIndex.insert(n[lr].feature,kt,lr,yr,this.index)}},ua.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},ua.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},ua.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ua.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ua.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,_d)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ua.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ua.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},ua.prototype.addFeature=function(n,s,l,d,x){var C=this.layers[0].layout,T=C.get("line-join").evaluate(n,{}),R=C.get("line-cap"),z=C.get("line-miter-limit"),W=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var $=0,ee=s;$<ee.length;$+=1)this.addLine(ee[$],n,T,R,z,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},ua.prototype.addLine=function(n,s,l,d,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<n.length-1;T++)this.totalDistance+=n[T].dist(n[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var R=xd[s.type]==="Polygon",z=n.length;z>=2&&n[z-1].equals(n[z-2]);)z--;for(var W=0;W<z-1&&n[W].equals(n[W+1]);)W++;if(!(z<(R?3:2))){l==="bevel"&&(x=1.05);var $,ee=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),be=void 0,$e=void 0,Je=void 0,dt=void 0;this.e1=this.e2=-1,R&&(dt=n[W].sub($=n[z-2])._unit()._perp());for(var st=W;st<z;st++)if(!($e=st===z-1?R?n[W+1]:void 0:n[st+1])||!n[st].equals($e)){dt&&(Je=dt),$&&(be=$),$=n[st],dt=$e?$e.sub($)._unit()._perp():Je;var Dt=(Je=Je||dt).add(dt);Dt.x===0&&Dt.y===0||Dt._unit();var kt=Je.x*dt.x+Je.y*dt.y,lr=Dt.x*dt.x+Dt.y*dt.y,yr=lr!==0?1/lr:1/0,zr=2*Math.sqrt(2-2*lr),hn=lr<Jp&&be&&$e,Bn=Je.x*dt.y-Je.y*dt.x>0;if(hn&&st>W){var wi=$.dist(be);if(wi>2*ee){var $n=$.sub($.sub(be)._mult(ee/wi)._round());this.updateDistance(be,$n),this.addCurrentVertex($n,Je,0,0,le),be=$n}}var Ci=be&&$e,ri=Ci?l:R?"butt":d;if(Ci&&ri==="round"&&(yr<C?ri="miter":yr<=2&&(ri="fakeround")),ri==="miter"&&yr>x&&(ri="bevel"),ri==="bevel"&&(yr>2&&(ri="flipbevel"),yr<x&&(ri="miter")),be&&this.updateDistance(be,$),ri==="miter")Dt._mult(yr),this.addCurrentVertex($,Dt,0,0,le);else if(ri==="flipbevel"){if(yr>100)Dt=dt.mult(-1);else{var Ca=yr*Je.add(dt).mag()/Je.sub(dt).mag();Dt._perp()._mult(Ca*(Bn?-1:1))}this.addCurrentVertex($,Dt,0,0,le),this.addCurrentVertex($,Dt.mult(-1),0,0,le)}else if(ri==="bevel"||ri==="fakeround"){var ki=-Math.sqrt(yr*yr-1),hi=Bn?ki:0,ga=Bn?0:ki;if(be&&this.addCurrentVertex($,Je,hi,ga,le),ri==="fakeround")for(var da=Math.round(180*zr/Math.PI/20),Da=1;Da<da;Da++){var Mi=Da/da;if(Mi!==.5){var Ha=Mi-.5;Mi+=Mi*Ha*(Mi-1)*((1.0904+kt*(kt*(3.55645-1.43519*kt)-3.2452))*Ha*Ha+(.848013+kt*(.215638*kt-1.06021)))}var Yo=dt.sub(Je)._mult(Mi)._add(Je)._unit()._mult(Bn?-1:1);this.addHalfVertex($,Yo.x,Yo.y,!1,Bn,0,le)}$e&&this.addCurrentVertex($,dt,-hi,-ga,le)}else if(ri==="butt")this.addCurrentVertex($,Dt,0,0,le);else if(ri==="square"){var ns=be?1:-1;this.addCurrentVertex($,Dt,ns,ns,le)}else ri==="round"&&(be&&(this.addCurrentVertex($,Je,0,0,le),this.addCurrentVertex($,Je,1,1,le,!0)),$e&&(this.addCurrentVertex($,dt,-1,-1,le,!0),this.addCurrentVertex($,dt,0,0,le)));if(hn&&st<z-1){var ds=$.dist($e);if(ds>2*ee){var Jo=$.add($e.sub($)._mult(ee/ds)._round());this.updateDistance($,Jo),this.addCurrentVertex(Jo,dt,0,0,le),$=Jo}}}}},ua.prototype.addCurrentVertex=function(n,s,l,d,x,C){C===void 0&&(C=!1);var T=s.y*d-s.x,R=-s.y-s.x*d;this.addHalfVertex(n,s.x+s.y*l,s.y-s.x*l,C,!1,l,x),this.addHalfVertex(n,T,R,C,!0,-d,x),this.distance>rp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,s,l,d,x,C))},ua.prototype.addHalfVertex=function(n,s,l,d,x,C,T){var R=.5*(this.lineClips?this.scaledDistance*(rp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(d?1:0),(n.y<<1)+(x?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(C===0?0:C<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),T.primitiveLength++),x?this.e2=z:this.e1=z},ua.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ua.prototype.updateDistance=function(n,s){this.distance+=n.dist(s),this.updateScaledDistance()},Jn("LineBucket",ua,{omit:["layers","patternFeatures"]});var Bu=new $o({"line-cap":new Ei(Te.layout_line["line-cap"]),"line-join":new vi(Te.layout_line["line-join"]),"line-miter-limit":new Ei(Te.layout_line["line-miter-limit"]),"line-round-limit":new Ei(Te.layout_line["line-round-limit"]),"line-sort-key":new vi(Te.layout_line["line-sort-key"])}),ys={paint:new $o({"line-opacity":new vi(Te.paint_line["line-opacity"]),"line-color":new vi(Te.paint_line["line-color"]),"line-translate":new Ei(Te.paint_line["line-translate"]),"line-translate-anchor":new Ei(Te.paint_line["line-translate-anchor"]),"line-width":new vi(Te.paint_line["line-width"]),"line-gap-width":new vi(Te.paint_line["line-gap-width"]),"line-offset":new vi(Te.paint_line["line-offset"]),"line-blur":new vi(Te.paint_line["line-blur"]),"line-dasharray":new zs(Te.paint_line["line-dasharray"]),"line-pattern":new Wf(Te.paint_line["line-pattern"]),"line-gradient":new hl(Te.paint_line["line-gradient"])}),layout:Bu},Nu=new(function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d){return d=new pa(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),n.prototype.possiblyEvaluate.call(this,l,d)},s.prototype.evaluate=function(l,d,x,C){return d=Xt({},d,{zoom:Math.floor(d.zoom)}),n.prototype.evaluate.call(this,l,d,x,C)},s}(vi))(ys.paint.properties["line-width"].specification);Nu.useIntegerZoom=!0;var tf=function(n){function s(l){n.call(this,l,ys),this.gradientVersion=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Su,this.gradientVersion=(this.gradientVersion+1)%Xe)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d),this.paint._values["line-floorwidth"]=Nu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new ua(l)},s.prototype.queryRadius=function(l){var d=l,x=bd(gl("line-width",this,d),gl("line-gap-width",this,d)),C=gl("line-offset",this,d);return x/2+Math.abs(C)+gs(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,R,z){var W=uu(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,z),$=z/2*bd(this.paint.get("line-width").evaluate(d,x),this.paint.get("line-gap-width").evaluate(d,x)),ee=this.paint.get("line-offset").evaluate(d,x);return ee&&(C=function(le,be){for(var $e=[],Je=new he(0,0),dt=0;dt<le.length;dt++){for(var st=le[dt],Dt=[],kt=0;kt<st.length;kt++){var lr=st[kt],yr=st[kt+1],zr=kt===0?Je:lr.sub(st[kt-1])._unit()._perp(),hn=kt===st.length-1?Je:yr.sub(lr)._unit()._perp(),Bn=zr._add(hn)._unit();Bn._mult(1/(Bn.x*hn.x+Bn.y*hn.y)),Dt.push(Bn._mult(be)._add(lr))}$e.push(Dt)}return $e}(C,ee*z)),function(le,be,$e){for(var Je=0;Je<be.length;Je++){var dt=be[Je];if(le.length>=3){for(var st=0;st<dt.length;st++)if(jl(le,dt[st]))return!0}if(Ou(le,dt,$e))return!0}return!1}(W,C,$)},s.prototype.isTileClipped=function(){return!0},s}(Tl);function bd(n,s){return s>0?s+2*n:n}var Ap=_o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qd=_o([{name:"a_projected_pos",components:3,type:"Float32"}],4),Jd=(_o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ed=(_o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),e0=_o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function C0(n,s,l){return n.sections.forEach(function(d){d.text=function(x,C,T){var R=C.layout.get("text-transform").evaluate(T,{});return R==="uppercase"?x=x.toLocaleUpperCase():R==="lowercase"&&(x=x.toLocaleLowerCase()),qs.applyArabicShaping&&(x=qs.applyArabicShaping(x)),x}(d.text,s,l)}),n}_o([{name:"triangle",components:3,type:"Uint16"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_o([{type:"Float32",name:"offsetX"}]),_o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Tp=function(n,s,l,d,x){var C,T,R=8*x-d-1,z=(1<<R)-1,W=z>>1,$=-7,ee=l?x-1:0,le=l?-1:1,be=n[s+ee];for(ee+=le,C=be&(1<<-$)-1,be>>=-$,$+=R;$>0;C=256*C+n[s+ee],ee+=le,$-=8);for(T=C&(1<<-$)-1,C>>=-$,$+=d;$>0;T=256*T+n[s+ee],ee+=le,$-=8);if(C===0)C=1-W;else{if(C===z)return T?NaN:1/0*(be?-1:1);T+=Math.pow(2,d),C-=W}return(be?-1:1)*T*Math.pow(2,C-d)},t0=function(n,s,l,d,x,C){var T,R,z,W=8*C-x-1,$=(1<<W)-1,ee=$>>1,le=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,be=d?0:C-1,$e=d?1:-1,Je=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(R=isNaN(s)?1:0,T=$):(T=Math.floor(Math.log(s)/Math.LN2),s*(z=Math.pow(2,-T))<1&&(T--,z*=2),(s+=T+ee>=1?le/z:le*Math.pow(2,1-ee))*z>=2&&(T++,z/=2),T+ee>=$?(R=0,T=$):T+ee>=1?(R=(s*z-1)*Math.pow(2,x),T+=ee):(R=s*Math.pow(2,ee-1)*Math.pow(2,x),T=0));x>=8;n[l+be]=255&R,be+=$e,R/=256,x-=8);for(T=T<<x|R,W+=x;W>0;n[l+be]=255&T,be+=$e,T/=256,W-=8);n[l+be-$e]|=128*Je},np=ho;function ho(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ho.Varint=0,ho.Fixed64=1,ho.Bytes=2,ho.Fixed32=5;var ed=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Pf(n){return n.type===ho.Bytes?n.readVarint()+n.pos:n.pos+1}function Rf(n,s,l){return l?4294967296*s+(n>>>0):4294967296*(s>>>0)+(n>>>0)}function Cd(n,s,l){var d=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(d);for(var x=l.pos-1;x>=n;x--)l.buf[x+d]=l.buf[x]}function S0(n,s){for(var l=0;l<n.length;l++)s.writeVarint(n[l])}function H(n,s){for(var l=0;l<n.length;l++)s.writeSVarint(n[l])}function Pe(n,s){for(var l=0;l<n.length;l++)s.writeFloat(n[l])}function it(n,s){for(var l=0;l<n.length;l++)s.writeDouble(n[l])}function or(n,s){for(var l=0;l<n.length;l++)s.writeBoolean(n[l])}function Br(n,s){for(var l=0;l<n.length;l++)s.writeFixed32(n[l])}function ur(n,s){for(var l=0;l<n.length;l++)s.writeSFixed32(n[l])}function kr(n,s){for(var l=0;l<n.length;l++)s.writeFixed64(n[l])}function Gr(n,s){for(var l=0;l<n.length;l++)s.writeSFixed64(n[l])}function Kr(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+16777216*n[s+3]}function en(n,s,l){n[l]=s,n[l+1]=s>>>8,n[l+2]=s>>>16,n[l+3]=s>>>24}function sn(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+(n[s+3]<<24)}function dn(n,s,l){n===1&&l.readMessage(Fn,s)}function Fn(n,s,l){if(n===3){var d=l.readMessage(tn,{}),x=d.width,C=d.height,T=d.left,R=d.top,z=d.advance;s.push({id:d.id,bitmap:new ac({width:x+6,height:C+6},d.bitmap),metrics:{width:x,height:C,left:T,top:R,advance:z}})}}function tn(n,s,l){n===1?s.id=l.readVarint():n===2?s.bitmap=l.readBytes():n===3?s.width=l.readVarint():n===4?s.height=l.readVarint():n===5?s.left=l.readSVarint():n===6?s.top=l.readSVarint():n===7&&(s.advance=l.readVarint())}function Ur(n){for(var s=0,l=0,d=0,x=n;d<x.length;d+=1){var C=x[d];s+=C.w*C.h,l=Math.max(l,C.w)}n.sort(function(Je,dt){return dt.h-Je.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],R=0,z=0,W=0,$=n;W<$.length;W+=1)for(var ee=$[W],le=T.length-1;le>=0;le--){var be=T[le];if(!(ee.w>be.w||ee.h>be.h)){if(ee.x=be.x,ee.y=be.y,z=Math.max(z,ee.y+ee.h),R=Math.max(R,ee.x+ee.w),ee.w===be.w&&ee.h===be.h){var $e=T.pop();le<T.length&&(T[le]=$e)}else ee.h===be.h?(be.x+=ee.w,be.w-=ee.w):ee.w===be.w?(be.y+=ee.h,be.h-=ee.h):(T.push({x:be.x+ee.w,y:be.y,w:be.w-ee.w,h:ee.h}),be.y+=ee.h,be.h-=ee.h);break}}return{w:R,h:z,fill:s/(R*z)||0}}ho.prototype={destroy:function(){this.buf=null},readFields:function(n,s,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),x=d>>3,C=this.pos;this.type=7&d,n(x,s,this),this.pos===C&&this.skip(d)}return s},readMessage:function(n,s){return this.readFields(n,s,this.readVarint()+this.pos)},readFixed32:function(){var n=Kr(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=sn(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Kr(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=Kr(this.buf,this.pos)+4294967296*sn(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=Tp(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Tp(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var s,l,d=this.buf;return s=127&(l=d[this.pos++]),l<128?s:(s|=(127&(l=d[this.pos++]))<<7,l<128?s:(s|=(127&(l=d[this.pos++]))<<14,l<128?s:(s|=(127&(l=d[this.pos++]))<<21,l<128?s:function(x,C,T){var R,z,W=T.buf;if(R=(112&(z=W[T.pos++]))>>4,z<128||(R|=(127&(z=W[T.pos++]))<<3,z<128)||(R|=(127&(z=W[T.pos++]))<<10,z<128)||(R|=(127&(z=W[T.pos++]))<<17,z<128)||(R|=(127&(z=W[T.pos++]))<<24,z<128)||(R|=(1&(z=W[T.pos++]))<<31,z<128))return Rf(x,R,C);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=d[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,s=this.pos;return this.pos=n,n-s>=12&&ed?function(l,d,x){return ed.decode(l.subarray(d,x))}(this.buf,s,n):function(l,d,x){for(var C="",T=d;T<x;){var R,z,W,$=l[T],ee=null,le=$>239?4:$>223?3:$>191?2:1;if(T+le>x)break;le===1?$<128&&(ee=$):le===2?(192&(R=l[T+1]))==128&&(ee=(31&$)<<6|63&R)<=127&&(ee=null):le===3?(z=l[T+2],(192&(R=l[T+1]))==128&&(192&z)==128&&((ee=(15&$)<<12|(63&R)<<6|63&z)<=2047||ee>=55296&&ee<=57343)&&(ee=null)):le===4&&(z=l[T+2],W=l[T+3],(192&(R=l[T+1]))==128&&(192&z)==128&&(192&W)==128&&((ee=(15&$)<<18|(63&R)<<12|(63&z)<<6|63&W)<=65535||ee>=1114112)&&(ee=null)),ee===null?(ee=65533,le=1):ee>65535&&(ee-=65536,C+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),C+=String.fromCharCode(ee),T+=le}return C}(this.buf,s,n)},readBytes:function(){var n=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,n);return this.pos=n,s},readPackedVarint:function(n,s){if(this.type!==ho.Bytes)return n.push(this.readVarint(s));var l=Pf(this);for(n=n||[];this.pos<l;)n.push(this.readVarint(s));return n},readPackedSVarint:function(n){if(this.type!==ho.Bytes)return n.push(this.readSVarint());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ho.Bytes)return n.push(this.readBoolean());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ho.Bytes)return n.push(this.readFloat());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ho.Bytes)return n.push(this.readDouble());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ho.Bytes)return n.push(this.readFixed32());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ho.Bytes)return n.push(this.readSFixed32());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ho.Bytes)return n.push(this.readFixed64());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ho.Bytes)return n.push(this.readSFixed64());var s=Pf(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed64());return n},skip:function(n){var s=7&n;if(s===ho.Varint)for(;this.buf[this.pos++]>127;);else if(s===ho.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ho.Fixed32)this.pos+=4;else{if(s!==ho.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(n,s){this.writeVarint(n<<3|s)},realloc:function(n){for(var s=this.length||16;s<this.pos+n;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),en(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),en(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),en(this.buf,-1&n,this.pos),en(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),en(this.buf,-1&n,this.pos),en(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(s,l){var d,x;if(s>=0?(d=s%4294967296|0,x=s/4294967296|0):(x=~(-s/4294967296),4294967295^(d=~(-s%4294967296))?d=d+1|0:(d=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(C,T,R){R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,R.buf[R.pos]=127&(C>>>=7)}(d,0,l),function(C,T){var R=(7&C)<<4;T.buf[T.pos++]|=R|((C>>>=3)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C)))))}(x,l)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var s=this.pos;this.pos=function(d,x,C){for(var T,R,z=0;z<x.length;z++){if((T=x.charCodeAt(z))>55295&&T<57344){if(!R){T>56319||z+1===x.length?(d[C++]=239,d[C++]=191,d[C++]=189):R=T;continue}if(T<56320){d[C++]=239,d[C++]=191,d[C++]=189,R=T;continue}T=R-55296<<10|T-56320|65536,R=null}else R&&(d[C++]=239,d[C++]=191,d[C++]=189,R=null);T<128?d[C++]=T:(T<2048?d[C++]=T>>6|192:(T<65536?d[C++]=T>>12|224:(d[C++]=T>>18|240,d[C++]=T>>12&63|128),d[C++]=T>>6&63|128),d[C++]=63&T|128)}return C}(this.buf,n,this.pos);var l=this.pos-s;l>=128&&Cd(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(n){this.realloc(4),t0(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),t0(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var s=n.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=n[l]},writeRawMessage:function(n,s){this.pos++;var l=this.pos;n(s,this);var d=this.pos-l;d>=128&&Cd(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(n,s,l){this.writeTag(n,ho.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(n,s){s.length&&this.writeMessage(n,S0,s)},writePackedSVarint:function(n,s){s.length&&this.writeMessage(n,H,s)},writePackedBoolean:function(n,s){s.length&&this.writeMessage(n,or,s)},writePackedFloat:function(n,s){s.length&&this.writeMessage(n,Pe,s)},writePackedDouble:function(n,s){s.length&&this.writeMessage(n,it,s)},writePackedFixed32:function(n,s){s.length&&this.writeMessage(n,Br,s)},writePackedSFixed32:function(n,s){s.length&&this.writeMessage(n,ur,s)},writePackedFixed64:function(n,s){s.length&&this.writeMessage(n,kr,s)},writePackedSFixed64:function(n,s){s.length&&this.writeMessage(n,Gr,s)},writeBytesField:function(n,s){this.writeTag(n,ho.Bytes),this.writeBytes(s)},writeFixed32Field:function(n,s){this.writeTag(n,ho.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(n,s){this.writeTag(n,ho.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(n,s){this.writeTag(n,ho.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(n,s){this.writeTag(n,ho.Fixed64),this.writeSFixed64(s)},writeVarintField:function(n,s){this.writeTag(n,ho.Varint),this.writeVarint(s)},writeSVarintField:function(n,s){this.writeTag(n,ho.Varint),this.writeSVarint(s)},writeStringField:function(n,s){this.writeTag(n,ho.Bytes),this.writeString(s)},writeFloatField:function(n,s){this.writeTag(n,ho.Fixed32),this.writeFloat(s)},writeDoubleField:function(n,s){this.writeTag(n,ho.Fixed64),this.writeDouble(s)},writeBooleanField:function(n,s){this.writeVarintField(n,Boolean(s))}};var St=function(n,s){var l=s.pixelRatio,d=s.version,x=s.stretchX,C=s.stretchY,T=s.content;this.paddedRect=n,this.pixelRatio=l,this.stretchX=x,this.stretchY=C,this.content=T,this.version=d},mr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};mr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},mr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},mr.tlbr.get=function(){return this.tl.concat(this.br)},mr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(St.prototype,mr);var rn=function(n,s){var l={},d={};this.haveRenderCallbacks=[];var x=[];this.addImages(n,l,x),this.addImages(s,d,x);var C=Ur(x),T=new Xo({width:C.w||1,height:C.h||1});for(var R in n){var z=n[R],W=l[R].paddedRect;Xo.copy(z.data,T,{x:0,y:0},{x:W.x+1,y:W.y+1},z.data)}for(var $ in s){var ee=s[$],le=d[$].paddedRect,be=le.x+1,$e=le.y+1,Je=ee.data.width,dt=ee.data.height;Xo.copy(ee.data,T,{x:0,y:0},{x:be,y:$e},ee.data),Xo.copy(ee.data,T,{x:0,y:dt-1},{x:be,y:$e-1},{width:Je,height:1}),Xo.copy(ee.data,T,{x:0,y:0},{x:be,y:$e+dt},{width:Je,height:1}),Xo.copy(ee.data,T,{x:Je-1,y:0},{x:be-1,y:$e},{width:1,height:dt}),Xo.copy(ee.data,T,{x:0,y:0},{x:be+Je,y:$e},{width:1,height:dt})}this.image=T,this.iconPositions=l,this.patternPositions=d};rn.prototype.addImages=function(n,s,l){for(var d in n){var x=n[d],C={x:0,y:0,w:x.data.width+2,h:x.data.height+2};l.push(C),s[d]=new St(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},rn.prototype.patchUpdatedImages=function(n,s){for(var l in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[l],n.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],n.getImage(l),s)},rn.prototype.patchUpdatedImage=function(n,s,l){if(n&&s&&n.version!==s.version){n.version=s.version;var d=n.tl;l.update(s.data,void 0,{x:d[0],y:d[1]})}},Jn("ImagePosition",St),Jn("ImageAtlas",rn);var En={horizontal:1,vertical:2,horizontalOnly:3},Vr=function(){this.scale=1,this.fontStack="",this.imageName=null};Vr.forText=function(n,s){var l=new Vr;return l.scale=n||1,l.fontStack=s,l},Vr.forImage=function(n){var s=new Vr;return s.imageName=n,s};var Cn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Zn(n,s,l,d,x,C,T,R,z,W,$,ee,le,be,$e,Je){var dt,st=Cn.fromFeature(n,x);ee===En.vertical&&st.verticalizePunctuation();var Dt=qs.processBidirectionalText,kt=qs.processStyledBidirectionalText;if(Dt&&st.sections.length===1){dt=[];for(var lr=0,yr=Dt(st.toString(),Pn(st,W,C,s,d,be,$e));lr<yr.length;lr+=1){var zr=yr[lr],hn=new Cn;hn.text=zr,hn.sections=st.sections;for(var Bn=0;Bn<zr.length;Bn++)hn.sectionIndex.push(0);dt.push(hn)}}else if(kt){dt=[];for(var wi=0,$n=kt(st.text,st.sectionIndex,Pn(st,W,C,s,d,be,$e));wi<$n.length;wi+=1){var Ci=$n[wi],ri=new Cn;ri.text=Ci[0],ri.sectionIndex=Ci[1],ri.sections=st.sections,dt.push(ri)}}else dt=function(hi,ga){for(var da=[],Da=hi.text,Mi=0,Ha=0,Yo=ga;Ha<Yo.length;Ha+=1){var ns=Yo[Ha];da.push(hi.substring(Mi,ns)),Mi=ns}return Mi<Da.length&&da.push(hi.substring(Mi,Da.length)),da}(st,Pn(st,W,C,s,d,be,$e));var Ca=[],ki={positionedLines:Ca,text:st.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ee,iconsInText:!1,verticalizable:!1};return function(hi,ga,da,Da,Mi,Ha,Yo,ns,ds,Jo,Es,hu){for(var is=0,Uu=-17,bu=0,Pu=0,Is=ns==="right"?1:ns==="left"?0:.5,pu=0,Ba=0,Mo=Mi;Ba<Mo.length;Ba+=1){var xo=Mo[Ba];xo.trim();var ja=xo.getMaxScale(),Zu=24*(ja-1),Vu={positionedGlyphs:[],lineOffset:0};hi.positionedLines[pu]=Vu;var zo=Vu.positionedGlyphs,as=0;if(xo.length()){for(var ks=0;ks<xo.length();ks++){var ao=xo.getSection(ks),_l=xo.getSectionIndex(ks),Yl=xo.getCharCode(ks),Ic=0,Ps=null,th=null,kc=null,td=24,kp=!(ds===En.horizontal||!Es&&!ph(Yl)||Es&&(Ii[Yl]||(Of=Yl,In.Arabic(Of)||In["Arabic Supplement"](Of)||In["Arabic Extended-A"](Of)||In["Arabic Presentation Forms-A"](Of)||In["Arabic Presentation Forms-B"](Of))));if(ao.imageName){var rd=Da[ao.imageName];if(!rd)continue;kc=ao.imageName,hi.iconsInText=hi.iconsInText||!0,th=rd.paddedRect;var lc=rd.displaySize;ao.scale=24*ao.scale/hu,Ic=Zu+(24-lc[1]*ao.scale),td=(Ps={width:lc[0],height:lc[1],left:1,top:-3,advance:kp?lc[1]:lc[0]}).advance;var Pp=kp?lc[0]*ao.scale-24*ja:lc[1]*ao.scale-24*ja;Pp>0&&Pp>as&&(as=Pp)}else{var nd=da[ao.fontStack],Lf=nd&&nd[Yl];if(Lf&&Lf.rect)th=Lf.rect,Ps=Lf.metrics;else{var Rp=ga[ao.fontStack],Lp=Rp&&Rp[Yl];if(!Lp)continue;Ps=Lp.metrics}Ic=24*(ja-ao.scale)}kp?(hi.verticalizable=!0,zo.push({glyph:Yl,imageName:kc,x:is,y:Uu+Ic,vertical:kp,scale:ao.scale,fontStack:ao.fontStack,sectionIndex:_l,metrics:Ps,rect:th}),is+=td*ao.scale+Jo):(zo.push({glyph:Yl,imageName:kc,x:is,y:Uu+Ic,vertical:kp,scale:ao.scale,fontStack:ao.fontStack,sectionIndex:_l,metrics:Ps,rect:th}),is+=Ps.advance*ao.scale+Jo)}zo.length!==0&&(bu=Math.max(is-Jo,bu),Qi(zo,0,zo.length-1,Is,as)),is=0;var Td=Ha*ja+as;Vu.lineOffset=Math.max(as,Zu),Uu+=Td,Pu=Math.max(Td,Pu),++pu}else Uu+=Ha,++pu}var Of,Md=Uu- -17,rh=Dn(Yo),nh=rh.horizontalAlign,Mh=rh.verticalAlign;(function(id,ad,Op,Fp,Dp,od,Bp,Np,zp){var Ih,sd=(ad-Op)*Dp;Ih=od!==Bp?-Np*Fp- -17:(-Fp*zp+.5)*Bp;for(var ih=0,ud=id;ih<ud.length;ih+=1)for(var va=0,ca=ud[ih].positionedGlyphs;va<ca.length;va+=1){var ap=ca[va];ap.x+=sd,ap.y+=Ih}})(hi.positionedLines,Is,nh,Mh,bu,Pu,Ha,Md,Mi.length),hi.top+=-Mh*Md,hi.bottom=hi.top+Md,hi.left+=-nh*bu,hi.right=hi.left+bu}(ki,s,l,d,dt,T,R,z,ee,W,le,Je),!function(hi){for(var ga=0,da=hi;ga<da.length;ga+=1)if(da[ga].positionedGlyphs.length!==0)return!1;return!0}(Ca)&&ki}Cn.fromFeature=function(n,s){for(var l=new Cn,d=0;d<n.sections.length;d++){var x=n.sections[d];x.image?l.addImageSection(x):l.addTextSection(x,s)}return l},Cn.prototype.length=function(){return this.text.length},Cn.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},Cn.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},Cn.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},Cn.prototype.verticalizePunctuation=function(){this.text=function(n){for(var s="",l=0;l<n.length;l++){var d=n.charCodeAt(l+1)||null,x=n.charCodeAt(l-1)||null;s+=d&&wl(d)&&!wp[n[l+1]]||x&&wl(x)&&!wp[n[l-1]]||!wp[n[l]]?n[l]:wp[n[l]]}return s}(this.text)},Cn.prototype.trim=function(){for(var n=0,s=0;s<this.text.length&&Ii[this.text.charCodeAt(s)];s++)n++;for(var l=this.text.length,d=this.text.length-1;d>=0&&d>=n&&Ii[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)},Cn.prototype.substring=function(n,s){var l=new Cn;return l.text=this.text.substring(n,s),l.sectionIndex=this.sectionIndex.slice(n,s),l.sections=this.sections,l},Cn.prototype.toString=function(){return this.text},Cn.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,n.sections[l].scale)},0)},Cn.prototype.addTextSection=function(n,s){this.text+=n.text,this.sections.push(Vr.forText(n.scale,n.fontStack||s));for(var l=this.sections.length-1,d=0;d<n.text.length;++d)this.sectionIndex.push(l)},Cn.prototype.addImageSection=function(n){var s=n.image?n.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Vr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}else Ue("Can't add FormattedSection with an empty image.")},Cn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ii={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Mr={};function wr(n,s,l,d,x,C){if(s.imageName){var T=d[s.imageName];return T?T.displaySize[0]*s.scale*24/C+x:0}var R=l[s.fontStack],z=R&&R[n];return z?z.metrics.advance*s.scale+x:0}function ci(n,s,l,d){var x=Math.pow(n-s,2);return d?n<s?x/2:2*x:x+Math.abs(l)*l}function Nn(n,s,l){var d=0;return n===10&&(d-=1e4),l&&(d+=150),n!==40&&n!==65288||(d+=50),s!==41&&s!==65289||(d+=50),d}function un(n,s,l,d,x,C){for(var T=null,R=ci(s,l,x,C),z=0,W=d;z<W.length;z+=1){var $=W[z],ee=ci(s-$.x,l,x,C)+$.badness;ee<=R&&(T=$,R=ee)}return{index:n,x:s,priorBreak:T,badness:R}}function Pn(n,s,l,d,x,C,T){if(C!=="point")return[];if(!n)return[];for(var R,z=[],W=function(dt,st,Dt,kt,lr,yr){for(var zr=0,hn=0;hn<dt.length();hn++){var Bn=dt.getSection(hn);zr+=wr(dt.getCharCode(hn),Bn,kt,lr,st,yr)}return zr/Math.max(1,Math.ceil(zr/Dt))}(n,s,l,d,x,T),$=n.text.indexOf("\u200B")>=0,ee=0,le=0;le<n.length();le++){var be=n.getSection(le),$e=n.getCharCode(le);if(Ii[$e]||(ee+=wr($e,be,d,x,s,T)),le<n.length()-1){var Je=!((R=$e)<11904||!(In["Bopomofo Extended"](R)||In.Bopomofo(R)||In["CJK Compatibility Forms"](R)||In["CJK Compatibility Ideographs"](R)||In["CJK Compatibility"](R)||In["CJK Radicals Supplement"](R)||In["CJK Strokes"](R)||In["CJK Symbols and Punctuation"](R)||In["CJK Unified Ideographs Extension A"](R)||In["CJK Unified Ideographs"](R)||In["Enclosed CJK Letters and Months"](R)||In["Halfwidth and Fullwidth Forms"](R)||In.Hiragana(R)||In["Ideographic Description Characters"](R)||In["Kangxi Radicals"](R)||In["Katakana Phonetic Extensions"](R)||In.Katakana(R)||In["Vertical Forms"](R)||In["Yi Radicals"](R)||In["Yi Syllables"](R)));(Mr[$e]||Je||be.imageName)&&z.push(un(le+1,ee,W,z,Nn($e,n.getCharCode(le+1),Je&&$),!1))}}return function dt(st){return st?dt(st.priorBreak).concat(st.index):[]}(un(n.length(),ee,W,z,0,!0))}function Dn(n){var s=.5,l=.5;switch(n){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Qi(n,s,l,d,x){if(d||x)for(var C=n[l],T=(n[l].x+C.metrics.advance*C.scale)*d,R=s;R<=l;R++)n[R].x-=T,n[R].y+=x}function Fi(n,s,l,d,x,C){var T,R=n.image;if(R.content){var z=R.content,W=R.pixelRatio||1;T=[z[0]/W,z[1]/W,R.displaySize[0]-z[2]/W,R.displaySize[1]-z[3]/W]}var $,ee,le,be,$e=s.left*C,Je=s.right*C;l==="width"||l==="both"?(be=x[0]+$e-d[3],ee=x[0]+Je+d[1]):ee=(be=x[0]+($e+Je-R.displaySize[0])/2)+R.displaySize[0];var dt=s.top*C,st=s.bottom*C;return l==="height"||l==="both"?($=x[1]+dt-d[0],le=x[1]+st+d[2]):le=($=x[1]+(dt+st-R.displaySize[1])/2)+R.displaySize[1],{image:R,top:$,right:ee,bottom:le,left:be,collisionPadding:T}}Mr[10]=!0,Mr[32]=!0,Mr[38]=!0,Mr[40]=!0,Mr[41]=!0,Mr[43]=!0,Mr[45]=!0,Mr[47]=!0,Mr[173]=!0,Mr[183]=!0,Mr[8203]=!0,Mr[8208]=!0,Mr[8211]=!0,Mr[8231]=!0;var Rn=function(n){function s(l,d,x,C){n.call(this,l,d),this.angle=x,C!==void 0&&(this.segment=C)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(he);function Un(n,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new pa(n+1))};if(l.kind==="source")return{kind:"source"};for(var d=l.zoomStops,x=l.interpolationType,C=0;C<d.length&&d[C]<=n;)C++;for(var T=C=Math.max(0,C-1);T<d.length&&d[T]<n+1;)T++;T=Math.min(d.length-1,T);var R=d[C],z=d[T];return l.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:z,interpolationType:x}:{kind:"camera",minZoom:R,maxZoom:z,minSize:l.evaluate(new pa(R)),maxSize:l.evaluate(new pa(z)),interpolationType:x}}function Oi(n,s,l){var d=s.uSize,x=l.lowerSize;return n.kind==="source"?x/128:n.kind==="composite"?za(x/128,l.upperSize/128,s.uSizeT):d}function ta(n,s){var l=0,d=0;if(n.kind==="constant")d=n.layoutSize;else if(n.kind!=="source"){var x=n.interpolationType,C=x?tr(Re.interpolationFactor(x,s,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?d=za(n.minSize,n.maxSize,C):l=C}return{uSizeT:l,uSize:d}}Jn("Anchor",Rn);var Ma=Object.freeze({__proto__:null,getSizeData:Un,evaluateSizeForFeature:Oi,evaluateSizeForZoom:ta,SIZE_PACK_FACTOR:128});function No(n,s,l,d,x){if(s.segment===void 0)return!0;for(var C=s,T=s.segment+1,R=0;R>-l/2;){if(--T<0)return!1;R-=n[T].dist(C),C=n[T]}R+=n[T].dist(n[T+1]),T++;for(var z=[],W=0;R<l/2;){var $=n[T],ee=n[T+1];if(!ee)return!1;var le=n[T-1].angleTo($)-$.angleTo(ee);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:R,angleDelta:le}),W+=le;R-z[0].distance>d;)W-=z.shift().angleDelta;if(W>x)return!1;T++,R+=$.dist(ee)}return!0}function Ko(n){for(var s=0,l=0;l<n.length-1;l++)s+=n[l].dist(n[l+1]);return s}function Ea(n,s,l){return n?.6*s*l:0}function Zs(n,s){return Math.max(n?n.right-n.left:0,s?s.right-s.left:0)}function eo(n,s,l,d,x,C){for(var T=Ea(l,x,C),R=Zs(l,d)*C,z=0,W=Ko(n)/2,$=0;$<n.length-1;$++){var ee=n[$],le=n[$+1],be=ee.dist(le);if(z+be>W){var $e=(W-z)/be,Je=za(ee.x,le.x,$e),dt=za(ee.y,le.y,$e),st=new Rn(Je,dt,le.angleTo(ee),$);return st._round(),!T||No(n,st,R,T,s)?st:void 0}z+=be}}function Vs(n,s,l,d,x,C,T,R,z){var W=Ea(d,C,T),$=Zs(d,x),ee=$*T,le=n[0].x===0||n[0].x===z||n[0].y===0||n[0].y===z;return s-ee<s/4&&(s=ee+s/4),function be($e,Je,dt,st,Dt,kt,lr,yr,zr){for(var hn=kt/2,Bn=Ko($e),wi=0,$n=Je-dt,Ci=[],ri=0;ri<$e.length-1;ri++){for(var Ca=$e[ri],ki=$e[ri+1],hi=Ca.dist(ki),ga=ki.angleTo(Ca);$n+dt<wi+hi;){var da=(($n+=dt)-wi)/hi,Da=za(Ca.x,ki.x,da),Mi=za(Ca.y,ki.y,da);if(Da>=0&&Da<zr&&Mi>=0&&Mi<zr&&$n-hn>=0&&$n+hn<=Bn){var Ha=new Rn(Da,Mi,ga,ri);Ha._round(),st&&!No($e,Ha,kt,st,Dt)||Ci.push(Ha)}}wi+=hi}return yr||Ci.length||lr||(Ci=be($e,wi/2,dt,st,Dt,kt,lr,!0,zr)),Ci}(n,le?s/2*R%s:($/2+2*C)*T*R%s,s,W,l,ee,le,!1,z)}function _s(n,s,l,d,x){for(var C=[],T=0;T<n.length;T++)for(var R=n[T],z=void 0,W=0;W<R.length-1;W++){var $=R[W],ee=R[W+1];$.x<s&&ee.x<s||($.x<s?$=new he(s,$.y+(s-$.x)/(ee.x-$.x)*(ee.y-$.y))._round():ee.x<s&&(ee=new he(s,$.y+(s-$.x)/(ee.x-$.x)*(ee.y-$.y))._round()),$.y<l&&ee.y<l||($.y<l?$=new he($.x+(l-$.y)/(ee.y-$.y)*(ee.x-$.x),l)._round():ee.y<l&&(ee=new he($.x+(l-$.y)/(ee.y-$.y)*(ee.x-$.x),l)._round()),$.x>=d&&ee.x>=d||($.x>=d?$=new he(d,$.y+(d-$.x)/(ee.x-$.x)*(ee.y-$.y))._round():ee.x>=d&&(ee=new he(d,$.y+(d-$.x)/(ee.x-$.x)*(ee.y-$.y))._round()),$.y>=x&&ee.y>=x||($.y>=x?$=new he($.x+(x-$.y)/(ee.y-$.y)*(ee.x-$.x),x)._round():ee.y>=x&&(ee=new he($.x+(x-$.y)/(ee.y-$.y)*(ee.x-$.x),x)._round()),z&&$.equals(z[z.length-1])||C.push(z=[$]),z.push(ee)))))}return C}function Js(n,s,l,d){var x=[],C=n.image,T=C.pixelRatio,R=C.paddedRect.w-2,z=C.paddedRect.h-2,W=n.right-n.left,$=n.bottom-n.top,ee=C.stretchX||[[0,R]],le=C.stretchY||[[0,z]],be=function(Da,Mi){return Da+Mi[1]-Mi[0]},$e=ee.reduce(be,0),Je=le.reduce(be,0),dt=R-$e,st=z-Je,Dt=0,kt=$e,lr=0,yr=Je,zr=0,hn=dt,Bn=0,wi=st;if(C.content&&d){var $n=C.content;Dt=js(ee,0,$n[0]),lr=js(le,0,$n[1]),kt=js(ee,$n[0],$n[2]),yr=js(le,$n[1],$n[3]),zr=$n[0]-Dt,Bn=$n[1]-lr,hn=$n[2]-$n[0]-kt,wi=$n[3]-$n[1]-yr}var Ci=function(Da,Mi,Ha,Yo){var ns=Qo(Da.stretch-Dt,kt,W,n.left),ds=la(Da.fixed-zr,hn,Da.stretch,$e),Jo=Qo(Mi.stretch-lr,yr,$,n.top),Es=la(Mi.fixed-Bn,wi,Mi.stretch,Je),hu=Qo(Ha.stretch-Dt,kt,W,n.left),is=la(Ha.fixed-zr,hn,Ha.stretch,$e),Uu=Qo(Yo.stretch-lr,yr,$,n.top),bu=la(Yo.fixed-Bn,wi,Yo.stretch,Je),Pu=new he(ns,Jo),Is=new he(hu,Jo),pu=new he(hu,Uu),Ba=new he(ns,Uu),Mo=new he(ds/T,Es/T),xo=new he(is/T,bu/T),ja=s*Math.PI/180;if(ja){var Zu=Math.sin(ja),Vu=Math.cos(ja),zo=[Vu,-Zu,Zu,Vu];Pu._matMult(zo),Is._matMult(zo),Ba._matMult(zo),pu._matMult(zo)}var as=Da.stretch+Da.fixed,ks=Mi.stretch+Mi.fixed;return{tl:Pu,tr:Is,bl:Ba,br:pu,tex:{x:C.paddedRect.x+1+as,y:C.paddedRect.y+1+ks,w:Ha.stretch+Ha.fixed-as,h:Yo.stretch+Yo.fixed-ks},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mo,pixelOffsetBR:xo,minFontScaleX:hn/T/W,minFontScaleY:wi/T/$,isSDF:l}};if(d&&(C.stretchX||C.stretchY))for(var ri=xu(ee,dt,$e),Ca=xu(le,st,Je),ki=0;ki<ri.length-1;ki++)for(var hi=ri[ki],ga=ri[ki+1],da=0;da<Ca.length-1;da++)x.push(Ci(hi,Ca[da],ga,Ca[da+1]));else x.push(Ci({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:z+1}));return x}function js(n,s,l){for(var d=0,x=0,C=n;x<C.length;x+=1){var T=C[x];d+=Math.max(s,Math.min(l,T[1]))-Math.max(s,Math.min(l,T[0]))}return d}function xu(n,s,l){for(var d=[{fixed:-1,stretch:0}],x=0,C=n;x<C.length;x+=1){var T=C[x],R=T[0],z=T[1],W=d[d.length-1];d.push({fixed:R-W.stretch,stretch:W.stretch}),d.push({fixed:R-W.stretch,stretch:W.stretch+(z-R)})}return d.push({fixed:s+1,stretch:l}),d}function Qo(n,s,l,d){return n/s*l+d}function la(n,s,l,d){return n-s*l/d}var xs=function(n,s,l,d,x,C,T,R,z,W){if(this.boxStartIndex=n.length,z){var $=C.top,ee=C.bottom,le=C.collisionPadding;le&&($-=le[1],ee+=le[3]);var be=ee-$;be>0&&(be=Math.max(10,be),this.circleDiameter=be)}else{var $e=C.top*T-R,Je=C.bottom*T+R,dt=C.left*T-R,st=C.right*T+R,Dt=C.collisionPadding;if(Dt&&(dt-=Dt[0]*T,$e-=Dt[1]*T,st+=Dt[2]*T,Je+=Dt[3]*T),W){var kt=new he(dt,$e),lr=new he(st,$e),yr=new he(dt,Je),zr=new he(st,Je),hn=W*Math.PI/180;kt._rotate(hn),lr._rotate(hn),yr._rotate(hn),zr._rotate(hn),dt=Math.min(kt.x,lr.x,yr.x,zr.x),st=Math.max(kt.x,lr.x,yr.x,zr.x),$e=Math.min(kt.y,lr.y,yr.y,zr.y),Je=Math.max(kt.y,lr.y,yr.y,zr.y)}n.emplaceBack(s.x,s.y,dt,$e,st,Je,l,d,x)}this.boxEndIndex=n.length},gr=function(n,s){if(n===void 0&&(n=[]),s===void 0&&(s=fu),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function fu(n,s){return n<s?-1:n>s?1:0}function Yi(n,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var d=1/0,x=1/0,C=-1/0,T=-1/0,R=n[0],z=0;z<R.length;z++){var W=R[z];(!z||W.x<d)&&(d=W.x),(!z||W.y<x)&&(x=W.y),(!z||W.x>C)&&(C=W.x),(!z||W.y>T)&&(T=W.y)}var $=Math.min(C-d,T-x),ee=$/2,le=new gr([],wa);if($===0)return new he(d,x);for(var be=d;be<C;be+=$)for(var $e=x;$e<T;$e+=$)le.push(new io(be+ee,$e+ee,ee,n));for(var Je=function(Dt){for(var kt=0,lr=0,yr=0,zr=Dt[0],hn=0,Bn=zr.length,wi=Bn-1;hn<Bn;wi=hn++){var $n=zr[hn],Ci=zr[wi],ri=$n.x*Ci.y-Ci.x*$n.y;lr+=($n.x+Ci.x)*ri,yr+=($n.y+Ci.y)*ri,kt+=3*ri}return new io(lr/kt,yr/kt,0,Dt)}(n),dt=le.length;le.length;){var st=le.pop();(st.d>Je.d||!Je.d)&&(Je=st,l&&console.log("found best %d after %d probes",Math.round(1e4*st.d)/1e4,dt)),st.max-Je.d<=s||(le.push(new io(st.p.x-(ee=st.h/2),st.p.y-ee,ee,n)),le.push(new io(st.p.x+ee,st.p.y-ee,ee,n)),le.push(new io(st.p.x-ee,st.p.y+ee,ee,n)),le.push(new io(st.p.x+ee,st.p.y+ee,ee,n)),dt+=4)}return l&&(console.log("num probes: "+dt),console.log("best distance: "+Je.d)),Je.p}function wa(n,s){return s.max-n.max}function io(n,s,l,d){this.p=new he(n,s),this.h=l,this.d=function(x,C){for(var T=!1,R=1/0,z=0;z<C.length;z++)for(var W=C[z],$=0,ee=W.length,le=ee-1;$<ee;le=$++){var be=W[$],$e=W[le];be.y>x.y!=$e.y>x.y&&x.x<($e.x-be.x)*(x.y-be.y)/($e.y-be.y)+be.x&&(T=!T),R=Math.min(R,Ec(x,be,$e))}return(T?1:-1)*Math.sqrt(R)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}gr.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},gr.prototype.pop=function(){if(this.length!==0){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},gr.prototype.peek=function(){return this.data[0]},gr.prototype._up=function(n){for(var s=this.data,l=this.compare,d=s[n];n>0;){var x=n-1>>1,C=s[x];if(l(d,C)>=0)break;s[n]=C,n=x}s[n]=d},gr.prototype._down=function(n){for(var s=this.data,l=this.compare,d=this.length>>1,x=s[n];n<d;){var C=1+(n<<1),T=s[C],R=C+1;if(R<this.length&&l(s[R],T)<0&&(C=R,T=s[R]),l(T,x)>=0)break;s[n]=T,n=C}s[n]=x};var bs=Number.POSITIVE_INFINITY;function rf(n,s){return s[1]!==bs?function(l,d,x){var C=0,T=0;switch(d=Math.abs(d),x=Math.abs(x),l){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(l){case"top-right":case"bottom-right":case"right":C=-d;break;case"top-left":case"bottom-left":case"left":C=d}return[C,T]}(n,s[0],s[1]):function(l,d){var x=0,C=0;d<0&&(d=0);var T=d/Math.sqrt(2);switch(l){case"top-right":case"top-left":C=T-7;break;case"bottom-right":case"bottom-left":C=7-T;break;case"bottom":C=7-d;break;case"top":C=d-7}switch(l){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=d;break;case"right":x=-d}return[x,C]}(n,s[0])}function Ye(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dr(n,s,l,d,x,C,T,R,z,W,$,ee,le,be,$e){var Je=function(lr,yr,zr,hn,Bn,wi,$n,Ci){for(var ri=hn.layout.get("text-rotate").evaluate(wi,{})*Math.PI/180,Ca=[],ki=0,hi=yr.positionedLines;ki<hi.length;ki+=1)for(var ga=hi[ki],da=0,Da=ga.positionedGlyphs;da<Da.length;da+=1){var Mi=Da[da];if(Mi.rect){var Ha=Mi.rect||{},Yo=4,ns=!0,ds=1,Jo=0,Es=(Bn||Ci)&&Mi.vertical,hu=Mi.metrics.advance*Mi.scale/2;if(Ci&&yr.verticalizable&&(Jo=ga.lineOffset/2-(Mi.imageName?-(24-Mi.metrics.width*Mi.scale)/2:24*(Mi.scale-1))),Mi.imageName){var is=$n[Mi.imageName];ns=is.sdf,Yo=1/(ds=is.pixelRatio)}var Uu=Bn?[Mi.x+hu,Mi.y]:[0,0],bu=Bn?[0,0]:[Mi.x+hu+zr[0],Mi.y+zr[1]-Jo],Pu=[0,0];Es&&(Pu=bu,bu=[0,0]);var Is=(Mi.metrics.left-Yo)*Mi.scale-hu+bu[0],pu=(-Mi.metrics.top-Yo)*Mi.scale+bu[1],Ba=Is+Ha.w*Mi.scale/ds,Mo=pu+Ha.h*Mi.scale/ds,xo=new he(Is,pu),ja=new he(Ba,pu),Zu=new he(Is,Mo),Vu=new he(Ba,Mo);if(Es){var zo=new he(-hu,hu- -17),as=-Math.PI/2,ks=12-hu,ao=new he(22-ks,-(Mi.imageName?ks:0)),_l=new(Function.prototype.bind.apply(he,[null].concat(Pu)));xo._rotateAround(as,zo)._add(ao)._add(_l),ja._rotateAround(as,zo)._add(ao)._add(_l),Zu._rotateAround(as,zo)._add(ao)._add(_l),Vu._rotateAround(as,zo)._add(ao)._add(_l)}if(ri){var Yl=Math.sin(ri),Ic=Math.cos(ri),Ps=[Ic,-Yl,Yl,Ic];xo._matMult(Ps),ja._matMult(Ps),Zu._matMult(Ps),Vu._matMult(Ps)}var th=new he(0,0),kc=new he(0,0);Ca.push({tl:xo,tr:ja,bl:Zu,br:Vu,tex:Ha,writingMode:yr.writingMode,glyphOffset:Uu,sectionIndex:Mi.sectionIndex,isSDF:ns,pixelOffsetTL:th,pixelOffsetBR:kc,minFontScaleX:0,minFontScaleY:0})}}return Ca}(0,l,R,x,C,T,d,n.allowVerticalPlacement),dt=n.textSizeData,st=null;dt.kind==="source"?(st=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ue(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):dt.kind==="composite"&&((st=[128*be.compositeTextSizes[0].evaluate(T,{},$e),128*be.compositeTextSizes[1].evaluate(T,{},$e)])[0]>32640||st[1]>32640)&&Ue(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,Je,st,R,C,T,W,s,z.lineStartIndex,z.lineLength,le,$e);for(var Dt=0,kt=$;Dt<kt.length;Dt+=1)ee[kt[Dt]]=n.text.placedSymbolArray.length-1;return 4*Je.length}function qt(n){for(var s in n)return n[s];return null}function ei(n,s,l,d){var x=n.compareText;if(s in x){for(var C=x[s],T=C.length-1;T>=0;T--)if(d.dist(C[T])<l)return!0}else x[s]=[];return x[s].push(d),!1}var Ra=cu.VectorTileFeature.types,Ze=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ee(n,s,l,d,x,C,T,R,z,W,$,ee,le){var be=R?Math.min(32640,Math.round(R[0])):0,$e=R?Math.min(32640,Math.round(R[1])):0;n.emplaceBack(s,l,Math.round(32*d),Math.round(32*x),C,T,(be<<1)+(z?1:0),$e,16*W,16*$,256*ee,256*le)}function ft(n,s,l){n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l)}function Ut(n){for(var s=0,l=n.sections;s<l.length;s+=1)if(Ua(l[s].text))return!0;return!1}var nr=function(n){this.layoutVertexArray=new mh,this.indexArray=new Zl,this.programConfigurations=n,this.segments=new Ce,this.dynamicLayoutVertexArray=new Go,this.opacityVertexArray=new gh,this.placedSymbolArray=new m};nr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},nr.prototype.upload=function(n,s,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ap.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Qd.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Ze,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(n))},nr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Jn("SymbolBuffers",nr);var gt=function(n,s,l){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Ce,this.collisionVertexArray=new bc};gt.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Jd.members,!0)},gt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Jn("CollisionBuffers",gt);var nt=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(C){return C.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_u([]),this.placementViewportMatrix=_u([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Un(this.zoom,s["text-size"]),this.iconSizeData=Un(this.zoom,s["icon-size"]);var l=this.layers[0].layout,d=l.get("symbol-sort-key"),x=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(C){return En[C]})),this.stateDependentLayerIds=this.layers.filter(function(C){return C.isStateDependent()}).map(function(C){return C.id}),this.sourceID=n.sourceID};nt.prototype.createArrays=function(){this.text=new nr(new Li(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new nr(new Li(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new P,this.lineVertexArray=new B,this.symbolInstances=new I},nt.prototype.calculateGlyphDependencies=function(n,s,l,d,x){for(var C=0;C<n.length;C++)if(s[n.charCodeAt(C)]=!0,(l||d)&&x){var T=wp[n.charAt(C)];T&&(s[T.charCodeAt(0)]=!0)}},nt.prototype.populate=function(n,s,l){var d=this.layers[0],x=d.layout,C=x.get("text-font"),T=x.get("text-field"),R=x.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof Yr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),W=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],z||W){for(var ee=s.iconDependencies,le=s.glyphDependencies,be=s.availableImages,$e=new pa(this.zoom),Je=0,dt=n;Je<dt.length;Je+=1){var st=dt[Je],Dt=st.feature,kt=st.id,lr=st.index,yr=st.sourceLayerIndex,zr=d._featureFilter.needGeometry,hn=Wo(Dt,zr);if(d._featureFilter.filter($e,hn,l)){zr||(hn.geometry=Bo(Dt));var Bn=void 0;if(z){var wi=d.getValueAndResolveTokens("text-field",hn,l,be),$n=Yr.factory(wi);Ut($n)&&(this.hasRTLText=!0),(!this.hasRTLText||xi()==="unavailable"||this.hasRTLText&&qs.isParsed())&&(Bn=C0($n,d,hn))}var Ci=void 0;if(W){var ri=d.getValueAndResolveTokens("icon-image",hn,l,be);Ci=ri instanceof bt?ri:bt.fromString(ri)}if(Bn||Ci){var Ca=this.sortFeaturesByKey?$.evaluate(hn,{},l):void 0;if(this.features.push({id:kt,text:Bn,icon:Ci,index:lr,sourceLayerIndex:yr,geometry:hn.geometry,properties:Dt.properties,type:Ra[Dt.type],sortKey:Ca}),Ci&&(ee[Ci.name]=!0),Bn){var ki=C.evaluate(hn,{},l).join(","),hi=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(En.vertical)>=0;for(var ga=0,da=Bn.sections;ga<da.length;ga+=1){var Da=da[ga];if(Da.image)ee[Da.image.name]=!0;else{var Mi=yf(Bn.toString()),Ha=Da.fontStack||ki,Yo=le[Ha]=le[Ha]||{};this.calculateGlyphDependencies(Da.text,Yo,hi,this.allowVerticalPlacement,Mi)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(ns){var ds={},Jo={},Es=[],hu=0;function is(zo){Es.push(ns[zo]),hu++}function Uu(zo,as,ks){var ao=Jo[zo];return delete Jo[zo],Jo[as]=ao,Es[ao].geometry[0].pop(),Es[ao].geometry[0]=Es[ao].geometry[0].concat(ks[0]),ao}function bu(zo,as,ks){var ao=ds[as];return delete ds[as],ds[zo]=ao,Es[ao].geometry[0].shift(),Es[ao].geometry[0]=ks[0].concat(Es[ao].geometry[0]),ao}function Pu(zo,as,ks){var ao=ks?as[0][as[0].length-1]:as[0][0];return zo+":"+ao.x+":"+ao.y}for(var Is=0;Is<ns.length;Is++){var pu=ns[Is],Ba=pu.geometry,Mo=pu.text?pu.text.toString():null;if(Mo){var xo=Pu(Mo,Ba),ja=Pu(Mo,Ba,!0);if(xo in Jo&&ja in ds&&Jo[xo]!==ds[ja]){var Zu=bu(xo,ja,Ba),Vu=Uu(xo,ja,Es[Zu].geometry);delete ds[xo],delete Jo[ja],Jo[Pu(Mo,Es[Vu].geometry,!0)]=Vu,Es[Zu].geometry=null}else xo in Jo?Uu(xo,ja,Ba):ja in ds?bu(xo,ja,Ba):(is(Is),ds[xo]=hu-1,Jo[ja]=hu-1)}else is(Is)}return Es.filter(function(zo){return zo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ns,ds){return ns.sortKey-ds.sortKey})}},nt.prototype.update=function(n,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,l))},nt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},nt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},nt.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},nt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},nt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},nt.prototype.addToLineVertexArray=function(n,s){var l=this.lineVertexArray.length;if(n.segment!==void 0){for(var d=n.dist(s[n.segment+1]),x=n.dist(s[n.segment]),C={},T=n.segment+1;T<s.length;T++)C[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:d},T<s.length-1&&(d+=s[T+1].dist(s[T]));for(var R=n.segment||0;R>=0;R--)C[R]={x:s[R].x,y:s[R].y,tileUnitDistanceFromAnchor:x},R>0&&(x+=s[R-1].dist(s[R]));for(var z=0;z<s.length;z++){var W=C[z];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},nt.prototype.addSymbols=function(n,s,l,d,x,C,T,R,z,W,$,ee){for(var le=n.indexArray,be=n.layoutVertexArray,$e=n.segments.prepareSegment(4*s.length,be,le,this.canOverlap?C.sortKey:void 0),Je=this.glyphOffsetArray.length,dt=$e.vertexLength,st=this.allowVerticalPlacement&&T===En.vertical?Math.PI/2:0,Dt=C.text&&C.text.sections,kt=0;kt<s.length;kt++){var lr=s[kt],yr=lr.tl,zr=lr.tr,hn=lr.bl,Bn=lr.br,wi=lr.tex,$n=lr.pixelOffsetTL,Ci=lr.pixelOffsetBR,ri=lr.minFontScaleX,Ca=lr.minFontScaleY,ki=lr.glyphOffset,hi=lr.isSDF,ga=lr.sectionIndex,da=$e.vertexLength,Da=ki[1];Ee(be,R.x,R.y,yr.x,Da+yr.y,wi.x,wi.y,l,hi,$n.x,$n.y,ri,Ca),Ee(be,R.x,R.y,zr.x,Da+zr.y,wi.x+wi.w,wi.y,l,hi,Ci.x,$n.y,ri,Ca),Ee(be,R.x,R.y,hn.x,Da+hn.y,wi.x,wi.y+wi.h,l,hi,$n.x,Ci.y,ri,Ca),Ee(be,R.x,R.y,Bn.x,Da+Bn.y,wi.x+wi.w,wi.y+wi.h,l,hi,Ci.x,Ci.y,ri,Ca),ft(n.dynamicLayoutVertexArray,R,st),le.emplaceBack(da,da+1,da+2),le.emplaceBack(da+1,da+2,da+3),$e.vertexLength+=4,$e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ki[0]),kt!==s.length-1&&ga===s[kt+1].sectionIndex||n.programConfigurations.populatePaintArrays(be.length,C,C.index,{},ee,Dt&&Dt[ga])}n.placedSymbolArray.emplaceBack(R.x,R.y,Je,this.glyphOffsetArray.length-Je,dt,z,W,R.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],T,0,!1,0,$)},nt.prototype._addCollisionDebugVertex=function(n,s,l,d,x,C){return s.emplaceBack(0,0),n.emplaceBack(l.x,l.y,d,x,Math.round(C.x),Math.round(C.y))},nt.prototype.addCollisionDebugVertices=function(n,s,l,d,x,C,T){var R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),z=R.vertexLength,W=x.layoutVertexArray,$=x.collisionVertexArray,ee=T.anchorX,le=T.anchorY;this._addCollisionDebugVertex(W,$,C,ee,le,new he(n,s)),this._addCollisionDebugVertex(W,$,C,ee,le,new he(l,s)),this._addCollisionDebugVertex(W,$,C,ee,le,new he(l,d)),this._addCollisionDebugVertex(W,$,C,ee,le,new he(n,d)),R.vertexLength+=4;var be=x.indexArray;be.emplaceBack(z,z+1),be.emplaceBack(z+1,z+2),be.emplaceBack(z+2,z+3),be.emplaceBack(z+3,z),R.primitiveLength+=4},nt.prototype.addDebugCollisionBoxes=function(n,s,l,d){for(var x=n;x<s;x++){var C=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,d?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,l)}},nt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gt(jc,Ed.members,yh),this.iconCollisionBox=new gt(jc,Ed.members,yh);for(var n=0;n<this.symbolInstances.length;n++){var s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},nt.prototype._deserializeCollisionBoxesForSymbol=function(n,s,l,d,x,C,T,R,z){for(var W={},$=s;$<l;$++){var ee=n.get($);W.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},W.textFeatureIndex=ee.featureIndex;break}for(var le=d;le<x;le++){var be=n.get(le);W.verticalTextBox={x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,anchorPointX:be.anchorPointX,anchorPointY:be.anchorPointY},W.verticalTextFeatureIndex=be.featureIndex;break}for(var $e=C;$e<T;$e++){var Je=n.get($e);W.iconBox={x1:Je.x1,y1:Je.y1,x2:Je.x2,y2:Je.y2,anchorPointX:Je.anchorPointX,anchorPointY:Je.anchorPointY},W.iconFeatureIndex=Je.featureIndex;break}for(var dt=R;dt<z;dt++){var st=n.get(dt);W.verticalIconBox={x1:st.x1,y1:st.y1,x2:st.x2,y2:st.y2,anchorPointX:st.anchorPointX,anchorPointY:st.anchorPointY},W.verticalIconFeatureIndex=st.featureIndex;break}return W},nt.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},nt.prototype.hasTextData=function(){return this.text.segments.get().length>0},nt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},nt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},nt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},nt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},nt.prototype.addIndicesForPlacedSymbol=function(n,s){for(var l=n.placedSymbolArray.get(s),d=l.vertexStartIndex+4*l.numGlyphs,x=l.vertexStartIndex;x<d;x+=4)n.indexArray.emplaceBack(x,x+1,x+2),n.indexArray.emplaceBack(x+1,x+2,x+3)},nt.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(n),l=Math.cos(n),d=[],x=[],C=[],T=0;T<this.symbolInstances.length;++T){C.push(T);var R=this.symbolInstances.get(T);d.push(0|Math.round(s*R.anchorX+l*R.anchorY)),x.push(R.featureIndex)}return C.sort(function(z,W){return d[z]-d[W]||x[W]-x[z]}),C},nt.prototype.addToSortKeyRanges=function(n,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})},nt.prototype.sortFeatures=function(n){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,d=this.symbolInstanceIndexes;l<d.length;l+=1){var x=this.symbolInstances.get(d[l]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(C,T,R){C>=0&&R.indexOf(C)===T&&s.addIndicesForPlacedSymbol(s.text,C)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Jn("SymbolBucket",nt,{omit:["layers","collisionBoxArray","features","compareText"]}),nt.MAX_GLYPHS=65535,nt.addDynamicAttributes=ft;var At=new $o({"symbol-placement":new Ei(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Ei(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ei(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vi(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ei(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ei(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ei(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ei(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ei(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new vi(Te.layout_symbol["icon-size"]),"icon-text-fit":new Ei(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ei(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new vi(Te.layout_symbol["icon-image"]),"icon-rotate":new vi(Te.layout_symbol["icon-rotate"]),"icon-padding":new Ei(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Ei(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new vi(Te.layout_symbol["icon-offset"]),"icon-anchor":new vi(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ei(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ei(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ei(Te.layout_symbol["text-rotation-alignment"]),"text-field":new vi(Te.layout_symbol["text-field"]),"text-font":new vi(Te.layout_symbol["text-font"]),"text-size":new vi(Te.layout_symbol["text-size"]),"text-max-width":new vi(Te.layout_symbol["text-max-width"]),"text-line-height":new Ei(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new vi(Te.layout_symbol["text-letter-spacing"]),"text-justify":new vi(Te.layout_symbol["text-justify"]),"text-radial-offset":new vi(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ei(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new vi(Te.layout_symbol["text-anchor"]),"text-max-angle":new Ei(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Ei(Te.layout_symbol["text-writing-mode"]),"text-rotate":new vi(Te.layout_symbol["text-rotate"]),"text-padding":new Ei(Te.layout_symbol["text-padding"]),"text-keep-upright":new Ei(Te.layout_symbol["text-keep-upright"]),"text-transform":new vi(Te.layout_symbol["text-transform"]),"text-offset":new vi(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Ei(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ei(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Ei(Te.layout_symbol["text-optional"])}),Le={paint:new $o({"icon-opacity":new vi(Te.paint_symbol["icon-opacity"]),"icon-color":new vi(Te.paint_symbol["icon-color"]),"icon-halo-color":new vi(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new vi(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vi(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Ei(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ei(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new vi(Te.paint_symbol["text-opacity"]),"text-color":new vi(Te.paint_symbol["text-color"],{runtimeType:Mn,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new vi(Te.paint_symbol["text-halo-color"]),"text-halo-width":new vi(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new vi(Te.paint_symbol["text-halo-blur"]),"text-translate":new Ei(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Ei(Te.paint_symbol["text-translate-anchor"])}),layout:At},lt=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:wn,this.defaultValue=n};lt.prototype.evaluate=function(n){if(n.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},lt.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},lt.prototype.outputDefined=function(){return!1},lt.prototype.serialize=function(){return null},Jn("FormatSectionOverride",lt,{omit:["defaultValue"]});var Ge=function(n){function s(l){n.call(this,l,Le)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){if(n.prototype.recalculate.call(this,l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var C=[],T=0,R=x;T<R.length;T+=1){var z=R[T];C.indexOf(z)<0&&C.push(z)}this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,d,x,C){var T=this.layout.get(l).evaluate(d,{},x,C),R=this._unevaluatedLayout._values[l];return R.isDataDriven()||zf(R.value)||!T?T:function(z,W){return W.replace(/{([^{}]+)}/g,function($,ee){return ee in z?String(z[ee]):""})}(d.properties,T)},s.prototype.createBucket=function(l){return new nt(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,d=Le.paint.overridableProperties;l<d.length;l+=1){var x=d[l];if(s.hasPaintOverride(this.layout,x)){var C,T=this.paint.get(x),R=new lt(T),z=new ff(R,T.property.specification);C=T.value.kind==="constant"||T.value.kind==="source"?new Uf("source",z):new vc("composite",z,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new yu(T.property,C,T.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!(!this.layout||d.isDataDriven()||x.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,d){var x=l.get("text-field"),C=Le.paint.properties[d],T=!1,R=function($){for(var ee=0,le=$;ee<le.length;ee+=1)if(C.overrides&&C.overrides.hasOverride(le[ee]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof Yr)R(x.value.value.sections);else if(x.value.kind==="source"){var z=function($){T||($ instanceof Oa&&qi($.value)===La?R($.value.sections):$ instanceof Os?R($.sections):$.eachChild(z))},W=x.value;W._styleExpression&&z(W._styleExpression.expression)}return T},s}(Tl),zt={paint:new $o({"background-color":new Ei(Te.paint_background["background-color"]),"background-pattern":new zs(Te.paint_background["background-pattern"]),"background-opacity":new Ei(Te.paint_background["background-opacity"])})},$t=function(n){function s(l){n.call(this,l,zt)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Tl),jr={paint:new $o({"raster-opacity":new Ei(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ei(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ei(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ei(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Ei(Te.paint_raster["raster-saturation"]),"raster-contrast":new Ei(Te.paint_raster["raster-contrast"]),"raster-resampling":new Ei(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Ei(Te.paint_raster["raster-fade-duration"])})},_n=function(n){function s(l){n.call(this,l,jr)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Tl),Ln=function(n){function s(l){n.call(this,l,{}),this.implementation=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(Tl),jn={circle:Xc,heatmap:Sc,hillshade:$h,fill:Ah,"fill-extrusion":Mc,line:tf,symbol:Ge,background:$t,raster:_n},vn=Ae.HTMLImageElement,ti=Ae.HTMLCanvasElement,Yn=Ae.HTMLVideoElement,ai=Ae.ImageData,oi=Ae.ImageBitmap,qn=function(n,s,l,d){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(s,d)};qn.prototype.update=function(n,s,l){var d=n.width,x=n.height,C=!(this.size&&this.size[0]===d&&this.size[1]===x||l),T=this.context,R=T.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!s||s.premultiply!==!1)),C)this.size=[d,x],n instanceof vn||n instanceof ti||n instanceof Yn||n instanceof ai||oi&&n instanceof oi?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,n):R.texImage2D(R.TEXTURE_2D,0,this.format,d,x,0,this.format,R.UNSIGNED_BYTE,n.data);else{var z=l||{x:0,y:0},W=z.x,$=z.y;n instanceof vn||n instanceof ti||n instanceof Yn||n instanceof ai||oi&&n instanceof oi?R.texSubImage2D(R.TEXTURE_2D,0,W,$,R.RGBA,R.UNSIGNED_BYTE,n):R.texSubImage2D(R.TEXTURE_2D,0,W,$,d,x,R.RGBA,R.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)},qn.prototype.bind=function(n,s,l){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),n!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||n),this.filter=n),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)},qn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},qn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ui=function(n){var s=this;this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Ui.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},Ui.prototype.remove=function(){delete this._channel,this._callback=function(){}};var po=function(n,s,l){this.target=n,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Rr(["receive","process"],this),this.invoker=new Ui(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ue()?n:Ae};function eu(n,s,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[n*d-2*Math.PI*6378137/2,s*d-2*Math.PI*6378137/2]}po.prototype.send=function(n,s,l,d,x){var C=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[T]=l);var R=_e(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:n,hasCallback:!!l,targetMapId:d,mustQueue:x,sourceMapId:this.mapId,data:Ja(s,R)},R),{cancel:function(){l&&delete C.callbacks[T],C.target.postMessage({id:T,type:"<cancel>",targetMapId:d,sourceMapId:C.mapId})}}},po.prototype.receive=function(n){var s=n.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d()}else ue()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},po.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),s=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(n,s)}},po.prototype.processTask=function(n,s){var l=this;if(s.type==="<response>"){var d=this.callbacks[n];delete this.callbacks[n],d&&(s.error?d(Lu(s.error)):d(null,Lu(s.data)))}else{var x=!1,C=_e(this.globalScope)?void 0:[],T=s.hasCallback?function($,ee){x=!0,delete l.cancelCallbacks[n],l.target.postMessage({id:n,type:"<response>",sourceMapId:l.mapId,error:$?Ja($):null,data:Ja(ee,C)},C)}:function($){x=!0},R=null,z=Lu(s.data);if(this.parent[s.type])R=this.parent[s.type](s.sourceMapId,z,T);else if(this.parent.getWorkerSource){var W=s.type.split(".");R=this.parent.getWorkerSource(s.sourceMapId,W[0],z.source)[W[1]](z,T)}else T(new Error("Could not find function "+s.type));!x&&R&&R.cancel&&(this.cancelCallbacks[n]=R.cancel)}},po.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var vo=function(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};vo.prototype.setNorthEast=function(n){return this._ne=n instanceof uo?new uo(n.lng,n.lat):uo.convert(n),this},vo.prototype.setSouthWest=function(n){return this._sw=n instanceof uo?new uo(n.lng,n.lat):uo.convert(n),this},vo.prototype.extend=function(n){var s,l,d=this._sw,x=this._ne;if(n instanceof uo)s=n,l=n;else{if(!(n instanceof vo))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(vo.convert(n)):this.extend(uo.convert(n)):this;if(l=n._ne,!(s=n._sw)||!l)return this}return d||x?(d.lng=Math.min(s.lng,d.lng),d.lat=Math.min(s.lat,d.lat),x.lng=Math.max(l.lng,x.lng),x.lat=Math.max(l.lat,x.lat)):(this._sw=new uo(s.lng,s.lat),this._ne=new uo(l.lng,l.lat)),this},vo.prototype.getCenter=function(){return new uo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},vo.prototype.getSouthWest=function(){return this._sw},vo.prototype.getNorthEast=function(){return this._ne},vo.prototype.getNorthWest=function(){return new uo(this.getWest(),this.getNorth())},vo.prototype.getSouthEast=function(){return new uo(this.getEast(),this.getSouth())},vo.prototype.getWest=function(){return this._sw.lng},vo.prototype.getSouth=function(){return this._sw.lat},vo.prototype.getEast=function(){return this._ne.lng},vo.prototype.getNorth=function(){return this._ne.lat},vo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},vo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},vo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},vo.prototype.contains=function(n){var s=uo.convert(n),l=s.lng,d=s.lat,x=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&x},vo.convert=function(n){return!n||n instanceof vo?n:new vo(n)};var uo=function(n,s){if(isNaN(n)||isNaN(s))throw new Error("Invalid LngLat object: ("+n+", "+s+")");if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};uo.prototype.wrap=function(){return new uo(Yt(this.lng,-180,180),this.lat)},uo.prototype.toArray=function(){return[this.lng,this.lat]},uo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},uo.prototype.distanceTo=function(n){var s=Math.PI/180,l=this.lat*s,d=n.lat*s,x=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((n.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(x,1))},uo.prototype.toBounds=function(n){n===void 0&&(n=0);var s=360*n/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new vo(new uo(this.lng-l,this.lat-s),new uo(this.lng+l,this.lat+s))},uo.convert=function(n){if(n instanceof uo)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new uo(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new uo(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var xn=2*Math.PI*63710088e-1;function zu(n){return xn*Math.cos(n*Math.PI/180)}function hr(n){return(180+n)/360}function Xl(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Sd(n,s){return n/zu(s)}function yl(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var nf=function(n,s,l){l===void 0&&(l=0),this.x=+n,this.y=+s,this.z=+l};nf.fromLngLat=function(n,s){s===void 0&&(s=0);var l=uo.convert(n);return new nf(hr(l.lng),Xl(l.lat),Sd(s,l.lat))},nf.prototype.toLngLat=function(){return new uo(360*this.x-180,yl(this.y))},nf.prototype.toAltitude=function(){return this.z*zu(yl(this.y))},nf.prototype.meterInMercatorCoordinateUnits=function(){return 1/xn*(n=yl(this.y),1/Math.cos(n*Math.PI/180));var n};var ip=function(n,s,l){this.z=n,this.x=s,this.y=l,this.key=Mp(0,n,n,s,l)};ip.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},ip.prototype.url=function(n,s){var l,d,x,C,T,R=(d=this.y,x=this.z,C=eu(256*(l=this.x),256*(d=Math.pow(2,x)-d-1),x),T=eu(256*(l+1),256*(d+1),x),C[0]+","+C[1]+","+T[0]+","+T[1]),z=function(W,$,ee){for(var le,be="",$e=W;$e>0;$e--)be+=($&(le=1<<$e-1)?1:0)+(ee&le?2:0);return be}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",R)},ip.prototype.getTilePoint=function(n){var s=Math.pow(2,this.z);return new he(8192*(n.x*s-this.x),8192*(n.y*s-this.y))},ip.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var tu=function(n,s){this.wrap=n,this.canonical=s,this.key=Mp(n,s.z,s.z,s.x,s.y)},Gs=function(n,s,l,d,x){this.overscaledZ=n,this.wrap=s,this.canonical=new ip(l,+d,+x),this.key=Mp(s,n,l,d,x)};function Mp(n,s,l,d,x){(n*=2)<0&&(n=-1*n-1);var C=1<<l;return(C*C*n+C*x+d).toString(36)+l.toString(36)+s.toString(36)}Gs.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},Gs.prototype.scaledTo=function(n){var s=this.canonical.z-n;return n>this.canonical.z?new Gs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gs(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)},Gs.prototype.calculateScaledKey=function(n,s){var l=this.canonical.z-n;return n>this.canonical.z?Mp(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):Mp(this.wrap*+s,n,n,this.canonical.x>>l,this.canonical.y>>l)},Gs.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s},Gs.prototype.children=function(n){if(this.overscaledZ>=n)return[new Gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Gs(s,this.wrap,s,l,d),new Gs(s,this.wrap,s,l+1,d),new Gs(s,this.wrap,s,l,d+1),new Gs(s,this.wrap,s,l+1,d+1)]},Gs.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},Gs.prototype.wrapped=function(){return new Gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Gs.prototype.unwrapTo=function(n){return new Gs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},Gs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Gs.prototype.toUnwrapped=function(){return new tu(this.wrap,this.canonical)},Gs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Gs.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new nf(n.x-this.wrap,n.y))},Jn("CanonicalTileID",ip),Jn("OverscaledTileID",Gs,{omit:["posMatrix"]});var af=function(n,s,l){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ue('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var d=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var x=0;x<d;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(d,x)]=this.data[this._idx(d-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,d)]=this.data[this._idx(x,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};af.prototype.get=function(n,s){var l=new Uint8Array(this.data.buffer),d=4*this._idx(n,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[d],l[d+1],l[d+2])},af.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},af.prototype._idx=function(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)},af.prototype._unpackMapbox=function(n,s,l){return(256*n*256+256*s+l)/10-1e4},af.prototype._unpackTerrarium=function(n,s,l){return 256*n+s+l/256-32768},af.prototype.getPixels=function(){return new Xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},af.prototype.backfillBorder=function(n,s,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var d=s*this.dim,x=s*this.dim+this.dim,C=l*this.dim,T=l*this.dim+this.dim;switch(s){case-1:d=x-1;break;case 1:x=d+1}switch(l){case-1:C=T-1;break;case 1:T=C+1}for(var R=-s*this.dim,z=-l*this.dim,W=C;W<T;W++)for(var $=d;$<x;$++)this.data[this._idx($,W)]=n.data[this._idx($+R,W+z)]},Jn("DEMData",af);var Ad=function(n){this._stringToNumber={},this._numberToString=[];for(var s=0;s<n.length;s++){var l=n[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};Ad.prototype.encode=function(n){return this._stringToNumber[n]},Ad.prototype.decode=function(n){return this._numberToString[n]};var wd=function(n,s,l,d,x){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=l,n._y=d,this.properties=n.properties,this.id=x},r0={geometry:{configurable:!0}};r0.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},r0.geometry.set=function(n){this._geometry=n},wd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(n[s]=this[s]);return n},Object.defineProperties(wd.prototype,r0);var Ip=function(){this.state={},this.stateChanges={},this.deletedStates={}};Ip.prototype.updateState=function(n,s,l){var d=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][d]=this.stateChanges[n][d]||{},Xt(this.stateChanges[n][d],l),this.deletedStates[n]===null)for(var x in this.deletedStates[n]={},this.state[n])x!==d&&(this.deletedStates[n][x]=null);else if(this.deletedStates[n]&&this.deletedStates[n][d]===null)for(var C in this.deletedStates[n][d]={},this.state[n][d])l[C]||(this.deletedStates[n][d][C]=null);else for(var T in l)this.deletedStates[n]&&this.deletedStates[n][d]&&this.deletedStates[n][d][T]===null&&delete this.deletedStates[n][d][T]},Ip.prototype.removeFeatureState=function(n,s,l){if(this.deletedStates[n]!==null){var d=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&s!==void 0)this.deletedStates[n][d]!==null&&(this.deletedStates[n][d]=this.deletedStates[n][d]||{},this.deletedStates[n][d][l]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][d])for(l in this.deletedStates[n][d]={},this.stateChanges[n][d])this.deletedStates[n][d][l]=null;else this.deletedStates[n][d]=null;else this.deletedStates[n]=null}},Ip.prototype.getState=function(n,s){var l=String(s),d=Xt({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var x=this.deletedStates[n][s];if(x===null)return{};for(var C in x)delete d[C]}return d},Ip.prototype.initializeTileState=function(n,s){n.setFeatureState(this.state,s)},Ip.prototype.coalesceChanges=function(n,s){var l={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var x={};for(var C in this.stateChanges[d])this.state[d][C]||(this.state[d][C]={}),Xt(this.state[d][C],this.stateChanges[d][C]),x[C]=this.state[d][C];l[d]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var R={};if(this.deletedStates[T]===null)for(var z in this.state[T])R[z]={},this.state[T][z]={};else for(var W in this.deletedStates[T]){if(this.deletedStates[T][W]===null)this.state[T][W]={};else for(var $=0,ee=Object.keys(this.deletedStates[T][W]);$<ee.length;$+=1)delete this.state[T][W][ee[$]];R[W]=this.state[T][W]}l[T]=l[T]||{},Xt(l[T],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var le in n)n[le].setFeatureState(l,s)};var Th=function(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new rc(8192,16,0),this.grid3D=new rc(8192,16,0),this.featureIndexArray=new te,this.promoteId=s};function A0(n,s,l,d,x){return _r(n,function(C,T){var R=s instanceof Ju?s.get(T):null;return R&&R.evaluate?R.evaluate(l,d,x):R})}function sv(n){for(var s=1/0,l=1/0,d=-1/0,x=-1/0,C=0,T=n;C<T.length;C+=1){var R=T[C];s=Math.min(s,R.x),l=Math.min(l,R.y),d=Math.max(d,R.x),x=Math.max(x,R.y)}return{minX:s,minY:l,maxX:d,maxY:x}}function Zv(n,s){return s-n}Th.prototype.insert=function(n,s,l,d,x,C){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,x);for(var R=C?this.grid3D:this.grid,z=0;z<s.length;z++){for(var W=s[z],$=[1/0,1/0,-1/0,-1/0],ee=0;ee<W.length;ee++){var le=W[ee];$[0]=Math.min($[0],le.x),$[1]=Math.min($[1],le.y),$[2]=Math.max($[2],le.x),$[3]=Math.max($[3],le.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&R.insert(T,$[0],$[1],$[2],$[3])}},Th.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new cu.VectorTile(new np(this.rawTileData)).layers,this.sourceLayerCoder=new Ad(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Th.prototype.query=function(n,s,l,d){var x=this;this.loadVTLayers();for(var C=n.params||{},T=8192/n.tileSize/n.scale,R=ec(C.filter),z=n.queryGeometry,W=n.queryPadding*T,$=sv(z),ee=this.grid.query($.minX-W,$.minY-W,$.maxX+W,$.maxY+W),le=sv(n.cameraQueryGeometry),be=this.grid3D.query(le.minX-W,le.minY-W,le.maxX+W,le.maxY+W,function(lr,yr,zr,hn){return function(Bn,wi,$n,Ci,ri){for(var Ca=0,ki=Bn;Ca<ki.length;Ca+=1){var hi=ki[Ca];if(wi<=hi.x&&$n<=hi.y&&Ci>=hi.x&&ri>=hi.y)return!0}var ga=[new he(wi,$n),new he(wi,ri),new he(Ci,ri),new he(Ci,$n)];if(Bn.length>2){for(var da=0,Da=ga;da<Da.length;da+=1)if(jl(Bn,Da[da]))return!0}for(var Mi=0;Mi<Bn.length-1;Mi++)if(Wc(Bn[Mi],Bn[Mi+1],ga))return!0;return!1}(n.cameraQueryGeometry,lr-W,yr-W,zr+W,hn+W)}),$e=0,Je=be;$e<Je.length;$e+=1)ee.push(Je[$e]);ee.sort(Zv);for(var dt,st={},Dt=function(lr){var yr=ee[lr];if(yr!==dt){dt=yr;var zr=x.featureIndexArray.get(yr),hn=null;x.loadMatchingFeature(st,zr.bucketIndex,zr.sourceLayerIndex,zr.featureIndex,R,C.layers,C.availableImages,s,l,d,function(Bn,wi,$n){return hn||(hn=Bo(Bn)),wi.queryIntersectsFeature(z,Bn,$n,hn,x.z,n.transform,T,n.pixelPosMatrix)})}},kt=0;kt<ee.length;kt++)Dt(kt);return st},Th.prototype.loadMatchingFeature=function(n,s,l,d,x,C,T,R,z,W,$){var ee=this.bucketLayerIDs[s];if(!C||function(Bn,wi){for(var $n=0;$n<Bn.length;$n++)if(wi.indexOf(Bn[$n])>=0)return!0;return!1}(C,ee)){var le=this.sourceLayerCoder.decode(l),be=this.vtLayers[le].feature(d);if(x.needGeometry){var $e=Wo(be,!0);if(!x.filter(new pa(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!x.filter(new pa(this.tileID.overscaledZ),be))return;for(var Je=this.getId(be,le),dt=0;dt<ee.length;dt++){var st=ee[dt];if(!(C&&C.indexOf(st)<0)){var Dt=R[st];if(Dt){var kt={};Je!==void 0&&W&&(kt=W.getState(Dt.sourceLayer||"_geojsonTileLayer",Je));var lr=Xt({},z[st]);lr.paint=A0(lr.paint,Dt.paint,be,kt,T),lr.layout=A0(lr.layout,Dt.layout,be,kt,T);var yr=!$||$(be,Dt,kt);if(yr){var zr=new wd(be,this.z,this.x,this.y,Je);zr.layer=lr;var hn=n[st];hn===void 0&&(hn=n[st]=[]),hn.push({featureIndex:d,feature:zr,intersectionZ:yr})}}}}}},Th.prototype.lookupSymbolFeatures=function(n,s,l,d,x,C,T,R){var z={};this.loadVTLayers();for(var W=ec(x),$=0,ee=n;$<ee.length;$+=1)this.loadMatchingFeature(z,l,d,ee[$],W,C,T,R,s);return z},Th.prototype.hasLayer=function(n){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var d=0,x=l[s];d<x.length;d+=1)if(n===x[d])return!0;return!1},Th.prototype.getId=function(n,s){var l=n.id;return this.promoteId&&typeof(l=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},Jn("FeatureIndex",Th,{omit:["rawTileData","sourceLayerCoder"]});var Hs=function(n,s){this.tileID=n,this.uid=cr(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Hs.prototype.registerFadeDuration=function(n){var s=n+this.timeAdded;s<Ri.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Hs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Hs.prototype.loadVectorData=function(n,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var d in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(W,$){var ee={};if(!$)return ee;for(var le=function(){var Je=$e[be],dt=Je.layerIds.map(function(kt){return $.getLayer(kt)}).filter(Boolean);if(dt.length!==0){Je.layers=dt,Je.stateDependentLayerIds&&(Je.stateDependentLayers=Je.stateDependentLayerIds.map(function(kt){return dt.filter(function(lr){return lr.id===kt})[0]}));for(var st=0,Dt=dt;st<Dt.length;st+=1)ee[Dt[st].id]=Je}},be=0,$e=W;be<$e.length;be+=1)le();return ee}(n.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[d];if(x instanceof nt){if(this.hasSymbolBuckets=!0,!l)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var C in this.buckets){var T=this.buckets[C];if(T instanceof nt&&T.hasRTLText){this.hasRTLText=!0,qs.isLoading()||qs.isLoaded()||xi()!=="deferred"||cl();break}}for(var R in this.queryPadding=0,this.buckets){var z=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(R).queryRadius(z))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new h},Hs.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Hs.prototype.getBucket=function(n){return this.buckets[n.id]},Hs.prototype.upload=function(n){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(n)}var d=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qn(n,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qn(n,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},Hs.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},Hs.prototype.queryRenderedFeatures=function(n,s,l,d,x,C,T,R,z,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:W,transform:R,params:T,queryPadding:this.queryPadding*z},n,s,l):{}},Hs.prototype.querySourceFeatures=function(n,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var d=l.loadVTLayers(),x=s?s.sourceLayer:"",C=d._geojsonTileLayer||d[x];if(C)for(var T=ec(s&&s.filter),R=this.tileID.canonical,z=R.z,W=R.x,$=R.y,ee={z,x:W,y:$},le=0;le<C.length;le++){var be=C.feature(le);if(T.needGeometry){var $e=Wo(be,!0);if(!T.filter(new pa(this.tileID.overscaledZ),$e,this.tileID.canonical))continue}else if(!T.filter(new pa(this.tileID.overscaledZ),be))continue;var Je=l.getId(be,x),dt=new wd(be,z,W,$,Je);dt.tile=ee,n.push(dt)}}},Hs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Hs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Hs.prototype.setExpiryData=function(n){var s=this.expirationTime;if(n.cacheControl){var l=tt(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var d=Date.now(),x=!1;if(this.expirationTime>d)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{var C=this.expirationTime-s;C?this.expirationTime=d+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Hs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Hs.prototype.setFeatureState=function(n,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(s.style.hasLayer(d)){var x=this.buckets[d],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=l[C],R=n[C];if(T&&R&&Object.keys(R).length!==0){x.update(R,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=s&&s.style&&s.style.getLayer(d);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(x)))}}}},Hs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Hs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ri.now()},Hs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Hs.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=Ri.now()+n},Hs.prototype.setDependencies=function(n,s){for(var l={},d=0,x=s;d<x.length;d+=1)l[x[d]]=!0;this.dependencies[n]=l},Hs.prototype.hasDependency=function(n,s){for(var l=0,d=n;l<d.length;l+=1){var x=this.dependencies[d[l]];if(x){for(var C=0,T=s;C<T.length;C+=1)if(x[T[C]])return!0}}return!1};var eh=Ae.performance,uv=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},eh.mark(this._marks.start)};uv.prototype.finish=function(){eh.mark(this._marks.end);var n=eh.getEntriesByName(this._marks.measure);return n.length===0&&(eh.measure(this._marks.measure,this._marks.start,this._marks.end),n=eh.getEntriesByName(this._marks.measure),eh.clearMarks(this._marks.start),eh.clearMarks(this._marks.end),eh.clearMeasures(this._marks.measure)),n},y.Actor=po,y.AlphaImage=ac,y.CanonicalTileID=ip,y.CollisionBoxArray=h,y.Color=Aa,y.DEMData=af,y.DataConstantProperty=Ei,y.DictionaryCoder=Ad,y.EXTENT=8192,y.ErrorEvent=ot,y.EvaluationParameters=pa,y.Event=qe,y.Evented=xt,y.FeatureIndex=Th,y.FillBucket=Qs,y.FillExtrusionBucket=uc,y.ImageAtlas=rn,y.ImagePosition=St,y.LineBucket=ua,y.LngLat=uo,y.LngLatBounds=vo,y.MercatorCoordinate=nf,y.ONE_EM=24,y.OverscaledTileID=Gs,y.Point=he,y.Point$1=he,y.Properties=$o,y.Protobuf=np,y.RGBAImage=Xo,y.RequestManager=ui,y.RequestPerformance=uv,y.ResourceType=Sn,y.SegmentVector=Ce,y.SourceFeatureState=Ip,y.StructArrayLayout1ui2=_p,y.StructArrayLayout2f1f2i16=bf,y.StructArrayLayout2i4=Xf,y.StructArrayLayout3ui6=Zl,y.StructArrayLayout4i8=pl,y.SymbolBucket=nt,y.Texture=qn,y.Tile=Hs,y.Transitionable=Ns,y.Uniform1f=bn,y.Uniform1i=Xr,y.Uniform2f=pn,y.Uniform3f=Vn,y.Uniform4f=bi,y.UniformColor=Ti,y.UniformMatrix4f=ba,y.UnwrappedTileID=tu,y.ValidationError=rt,y.WritingMode=En,y.ZoomHistory=_c,y.add=function(n,s,l){return n[0]=s[0]+l[0],n[1]=s[1]+l[1],n[2]=s[2]+l[2],n},y.addDynamicAttributes=ft,y.asyncAll=function(n,s,l){if(!n.length)return l(null,[]);var d=n.length,x=new Array(n.length),C=null;n.forEach(function(T,R){s(T,function(z,W){z&&(C=z),x[R]=W,--d==0&&l(C,x)})})},y.bezier=Ct,y.bindAll=Rr,y.browser=Ri,y.cacheEntryPossiblyAdded=function(n){++mi>Sr&&(n.getActor().send("enforceCacheSizeLimit",Nt),mi=0)},y.clamp=tr,y.clearTileCache=function(n){var s=Ae.caches.delete("mapbox-tiles");n&&s.catch(n).then(function(){return n()})},y.clipLine=_s,y.clone=function(n){var s=new Va(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},y.clone$1=_t,y.clone$2=function(n){var s=new Va(3);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s},y.collisionCircleLayout=e0,y.config=yi,y.create=function(){var n=new Va(16);return Va!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},y.create$1=function(){var n=new Va(9);return Va!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},y.create$2=function(){var n=new Va(4);return Va!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},y.createCommonjsModule=Be,y.createExpression=Dc,y.createLayout=_o,y.createStyleLayer=function(n){return n.type==="custom"?new Ln(n):new jn[n.type](n)},y.cross=function(n,s,l){var d=s[0],x=s[1],C=s[2],T=l[0],R=l[1],z=l[2];return n[0]=x*z-C*R,n[1]=C*T-d*z,n[2]=d*R-x*T,n},y.deepEqual=function n(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var d=0;d<s.length;d++)if(!n(s[d],l[d]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var x in s)if(!n(s[x],l[x]))return!1;return!0}return s===l},y.dot=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]},y.dot$1=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]+n[3]*s[3]},y.ease=Lt,y.emitValidationErrors=yc,y.endsWith=re,y.enforceCacheSizeLimit=function(n){xr(),oe&&oe.then(function(s){s.keys().then(function(l){for(var d=0;d<l.length-n;d++)s.delete(l[d])})})},y.evaluateSizeForFeature=Oi,y.evaluateSizeForZoom=ta,y.evaluateVariableOffset=rf,y.evented=yp,y.extend=Xt,y.featureFilter=ec,y.filterObject=Ot,y.fromRotation=function(n,s){var l=Math.sin(s),d=Math.cos(s);return n[0]=d,n[1]=l,n[2]=0,n[3]=-l,n[4]=d,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},y.getAnchorAlignment=Dn,y.getAnchorJustification=Ye,y.getArrayBuffer=Si,y.getImage=ie,y.getJSON=function(n,s){return ro(Xt(n,{type:"json"}),s)},y.getRTLTextPluginStatus=xi,y.getReferrer=Vi,y.getVideo=function(n,s){var l,d,x=Ae.document.createElement("video");x.muted=!0,x.onloadstart=function(){s(null,x)};for(var C=0;C<n.length;C++){var T=Ae.document.createElement("source");l=n[C],d=void 0,(d=Ae.document.createElement("a")).href=l,(d.protocol!==Ae.document.location.protocol||d.host!==Ae.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=n[C],x.appendChild(T)}return{cancel:function(){}}},y.identity=_u,y.invert=function(n,s){var l=s[0],d=s[1],x=s[2],C=s[3],T=s[4],R=s[5],z=s[6],W=s[7],$=s[8],ee=s[9],le=s[10],be=s[11],$e=s[12],Je=s[13],dt=s[14],st=s[15],Dt=l*R-d*T,kt=l*z-x*T,lr=l*W-C*T,yr=d*z-x*R,zr=d*W-C*R,hn=x*W-C*z,Bn=$*Je-ee*$e,wi=$*dt-le*$e,$n=$*st-be*$e,Ci=ee*dt-le*Je,ri=ee*st-be*Je,Ca=le*st-be*dt,ki=Dt*Ca-kt*ri+lr*Ci+yr*$n-zr*wi+hn*Bn;return ki?(n[0]=(R*Ca-z*ri+W*Ci)*(ki=1/ki),n[1]=(x*ri-d*Ca-C*Ci)*ki,n[2]=(Je*hn-dt*zr+st*yr)*ki,n[3]=(le*zr-ee*hn-be*yr)*ki,n[4]=(z*$n-T*Ca-W*wi)*ki,n[5]=(l*Ca-x*$n+C*wi)*ki,n[6]=(dt*lr-$e*hn-st*kt)*ki,n[7]=($*hn-le*lr+be*kt)*ki,n[8]=(T*ri-R*$n+W*Bn)*ki,n[9]=(d*$n-l*ri-C*Bn)*ki,n[10]=($e*zr-Je*lr+st*Dt)*ki,n[11]=(ee*lr-$*zr-be*Dt)*ki,n[12]=(R*wi-T*Ci-z*Bn)*ki,n[13]=(l*Ci-d*wi+x*Bn)*ki,n[14]=(Je*kt-$e*yr-dt*Dt)*ki,n[15]=($*yr-ee*kt+le*Dt)*ki,n):null},y.isChar=In,y.isMapboxURL=Ji,y.keysDifference=function(n,s){var l=[];for(var d in n)d in s||l.push(d);return l},y.makeRequest=ro,y.mapObject=_r,y.mercatorXfromLng=hr,y.mercatorYfromLat=Xl,y.mercatorZfromAltitude=Sd,y.mul=_h,y.multiply=lu,y.mvt=cu,y.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},y.normalize=function(n,s){var l=s[0],d=s[1],x=s[2],C=l*l+d*d+x*x;return C>0&&(C=1/Math.sqrt(C)),n[0]=s[0]*C,n[1]=s[1]*C,n[2]=s[2]*C,n},y.number=za,y.offscreenCanvasSupported=ii,y.ortho=function(n,s,l,d,x,C,T){var R=1/(s-l),z=1/(d-x),W=1/(C-T);return n[0]=-2*R,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*z,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*W,n[11]=0,n[12]=(s+l)*R,n[13]=(x+d)*z,n[14]=(T+C)*W,n[15]=1,n},y.parseGlyphPBF=function(n){return new np(n).readFields(dn,[])},y.pbf=np,y.performSymbolLayout=function(n,s,l,d,x,C,T){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var R=n.layers[0].layout,z=n.layers[0]._unevaluatedLayout._values,W={};if(n.textSizeData.kind==="composite"){var $=n.textSizeData,ee=$.maxZoom;W.compositeTextSizes=[z["text-size"].possiblyEvaluate(new pa($.minZoom),T),z["text-size"].possiblyEvaluate(new pa(ee),T)]}if(n.iconSizeData.kind==="composite"){var le=n.iconSizeData,be=le.maxZoom;W.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new pa(le.minZoom),T),z["icon-size"].possiblyEvaluate(new pa(be),T)]}W.layoutTextSize=z["text-size"].possiblyEvaluate(new pa(n.zoom+1),T),W.layoutIconSize=z["icon-size"].possiblyEvaluate(new pa(n.zoom+1),T),W.textMaxSize=z["text-size"].possiblyEvaluate(new pa(18));for(var $e=24*R.get("text-line-height"),Je=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",dt=R.get("text-keep-upright"),st=R.get("text-size"),Dt=function(){var yr=lr[kt],zr=R.get("text-font").evaluate(yr,{},T).join(","),hn=st.evaluate(yr,{},T),Bn=W.layoutTextSize.evaluate(yr,{},T),wi=W.layoutIconSize.evaluate(yr,{},T),$n={horizontal:{},vertical:void 0},Ci=yr.text,ri=[0,0];if(Ci){var Ca=Ci.toString(),ki=24*R.get("text-letter-spacing").evaluate(yr,{},T),hi=function(Ba){for(var Mo=0,xo=Ba;Mo<xo.length;Mo+=1)if(ja=xo[Mo].charCodeAt(0),In.Arabic(ja)||In["Arabic Supplement"](ja)||In["Arabic Extended-A"](ja)||In["Arabic Presentation Forms-A"](ja)||In["Arabic Presentation Forms-B"](ja))return!1;var ja;return!0}(Ca)?ki:0,ga=R.get("text-anchor").evaluate(yr,{},T),da=R.get("text-variable-anchor");if(!da){var Da=R.get("text-radial-offset").evaluate(yr,{},T);ri=Da?rf(ga,[24*Da,bs]):R.get("text-offset").evaluate(yr,{},T).map(function(Ba){return 24*Ba})}var Mi=Je?"center":R.get("text-justify").evaluate(yr,{},T),Ha=R.get("symbol-placement"),Yo=Ha==="point"?24*R.get("text-max-width").evaluate(yr,{},T):0,ns=function(){n.allowVerticalPlacement&&yf(Ca)&&($n.vertical=Zn(Ci,s,l,x,zr,Yo,$e,ga,"left",hi,ri,En.vertical,!0,Ha,Bn,hn))};if(!Je&&da){for(var ds=Mi==="auto"?da.map(function(Ba){return Ye(Ba)}):[Mi],Jo=!1,Es=0;Es<ds.length;Es++){var hu=ds[Es];if(!$n.horizontal[hu])if(Jo)$n.horizontal[hu]=$n.horizontal[0];else{var is=Zn(Ci,s,l,x,zr,Yo,$e,"center",hu,hi,ri,En.horizontal,!1,Ha,Bn,hn);is&&($n.horizontal[hu]=is,Jo=is.positionedLines.length===1)}}ns()}else{Mi==="auto"&&(Mi=Ye(ga));var Uu=Zn(Ci,s,l,x,zr,Yo,$e,ga,Mi,hi,ri,En.horizontal,!1,Ha,Bn,hn);Uu&&($n.horizontal[Mi]=Uu),ns(),yf(Ca)&&Je&&dt&&($n.vertical=Zn(Ci,s,l,x,zr,Yo,$e,ga,Mi,hi,ri,En.vertical,!1,Ha,Bn,hn))}}var bu=void 0,Pu=!1;if(yr.icon&&yr.icon.name){var Is=d[yr.icon.name];Is&&(bu=function(Ba,Mo,xo){var ja=Dn(xo),Zu=Mo[0]-Ba.displaySize[0]*ja.horizontalAlign,Vu=Mo[1]-Ba.displaySize[1]*ja.verticalAlign;return{image:Ba,top:Vu,bottom:Vu+Ba.displaySize[1],left:Zu,right:Zu+Ba.displaySize[0]}}(x[yr.icon.name],R.get("icon-offset").evaluate(yr,{},T),R.get("icon-anchor").evaluate(yr,{},T)),Pu=Is.sdf,n.sdfIcons===void 0?n.sdfIcons=Is.sdf:n.sdfIcons!==Is.sdf&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Is.pixelRatio!==n.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var pu=qt($n.horizontal)||$n.vertical;n.iconsInText=!!pu&&pu.iconsInText,(pu||bu)&&function(Ba,Mo,xo,ja,Zu,Vu,zo,as,ks,ao,_l){var Yl=Vu.textMaxSize.evaluate(Mo,{});Yl===void 0&&(Yl=zo);var Ic,Ps=Ba.layers[0].layout,th=Ps.get("icon-offset").evaluate(Mo,{},_l),kc=qt(xo.horizontal),td=zo/24,kp=Ba.tilePixelRatio*td,rd=Ba.tilePixelRatio*Yl/24,lc=Ba.tilePixelRatio*as,Pp=Ba.tilePixelRatio*Ps.get("symbol-spacing"),nd=Ps.get("text-padding")*Ba.tilePixelRatio,Lf=Ps.get("icon-padding")*Ba.tilePixelRatio,Rp=Ps.get("text-max-angle")/180*Math.PI,Lp=Ps.get("text-rotation-alignment")==="map"&&Ps.get("symbol-placement")!=="point",Td=Ps.get("icon-rotation-alignment")==="map"&&Ps.get("symbol-placement")!=="point",Of=Ps.get("symbol-placement"),Md=Pp/2,rh=Ps.get("icon-text-fit");ja&&rh!=="none"&&(Ba.allowVerticalPlacement&&xo.vertical&&(Ic=Fi(ja,xo.vertical,rh,Ps.get("icon-text-fit-padding"),th,td)),kc&&(ja=Fi(ja,kc,rh,Ps.get("icon-text-fit-padding"),th,td)));var nh=function(Vv,i0){i0.x<0||i0.x>=8192||i0.y<0||i0.y>=8192||function(Ws,ah,Lm,op,Up,kd,a0,kh,I0,o0,k0,P0,lv,Pd,ld,R0,ql,cv,jv,s0,Pc,Rd,Rc,Ph,Gv){var fv,sp,Ld,Od,Fd,Dd=Ws.addToLineVertexArray(ah,Lm),Hv=0,Wv=0,cd=0,L0=0,u0=-1,Lc=-1,Pl={},up=je(""),Bd=0,fd=0;if(kh._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Bd=(fv=kh.layout.get("text-offset").evaluate(Pc,{},Ph).map(function(hd){return 24*hd}))[0],fd=fv[1]):(Bd=24*kh.layout.get("text-radial-offset").evaluate(Pc,{},Ph),fd=bs),Ws.allowVerticalPlacement&&op.vertical){var O0=kh.layout.get("text-rotate").evaluate(Pc,{},Ph)+90;Od=new xs(I0,ah,o0,k0,P0,op.vertical,lv,Pd,ld,O0),a0&&(Fd=new xs(I0,ah,o0,k0,P0,a0,ql,cv,ld,O0))}if(Up){var Nd=kh.layout.get("icon-rotate").evaluate(Pc,{}),zd=kh.layout.get("icon-text-fit")!=="none",l0=Js(Up,Nd,Rc,zd),Ud=a0?Js(a0,Nd,Rc,zd):void 0;Ld=new xs(I0,ah,o0,k0,P0,Up,ql,cv,!1,Nd),Hv=4*l0.length;var c0=Ws.iconSizeData,Ff=null;c0.kind==="source"?(Ff=[128*kh.layout.get("icon-size").evaluate(Pc,{})])[0]>32640&&Ue(Ws.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):c0.kind==="composite"&&((Ff=[128*Rd.compositeIconSizes[0].evaluate(Pc,{},Ph),128*Rd.compositeIconSizes[1].evaluate(Pc,{},Ph)])[0]>32640||Ff[1]>32640)&&Ue(Ws.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ws.addSymbols(Ws.icon,l0,Ff,s0,jv,Pc,!1,ah,Dd.lineStartIndex,Dd.lineLength,-1,Ph),u0=Ws.icon.placedSymbolArray.length-1,Ud&&(Wv=4*Ud.length,Ws.addSymbols(Ws.icon,Ud,Ff,s0,jv,Pc,En.vertical,ah,Dd.lineStartIndex,Dd.lineLength,-1,Ph),Lc=Ws.icon.placedSymbolArray.length-1)}for(var il in op.horizontal){var lp=op.horizontal[il];if(!sp){up=je(lp.text);var F0=kh.layout.get("text-rotate").evaluate(Pc,{},Ph);sp=new xs(I0,ah,o0,k0,P0,lp,lv,Pd,ld,F0)}var Rh=lp.positionedLines.length===1;if(cd+=dr(Ws,ah,lp,kd,kh,ld,Pc,R0,Dd,op.vertical?En.horizontal:En.horizontalOnly,Rh?Object.keys(op.horizontal):[il],Pl,u0,Rd,Ph),Rh)break}op.vertical&&(L0+=dr(Ws,ah,op.vertical,kd,kh,ld,Pc,R0,Dd,En.vertical,["vertical"],Pl,Lc,Rd,Ph));var Zp=sp?sp.boxStartIndex:Ws.collisionBoxArray.length,hv=sp?sp.boxEndIndex:Ws.collisionBoxArray.length,Xv=Od?Od.boxStartIndex:Ws.collisionBoxArray.length,Yv=Od?Od.boxEndIndex:Ws.collisionBoxArray.length,qv=Ld?Ld.boxStartIndex:Ws.collisionBoxArray.length,$v=Ld?Ld.boxEndIndex:Ws.collisionBoxArray.length,Kv=Fd?Fd.boxStartIndex:Ws.collisionBoxArray.length,Qv=Fd?Fd.boxEndIndex:Ws.collisionBoxArray.length,of=-1,X=function(hd,Rs){return hd&&hd.circleDiameter?Math.max(hd.circleDiameter,Rs):Rs};of=X(sp,of),of=X(Od,of),of=X(Ld,of);var cp=(of=X(Fd,of))>-1?1:0;cp&&(of*=Gv/24),Ws.glyphOffsetArray.length>=nt.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pc.sortKey!==void 0&&Ws.addToSortKeyRanges(Ws.symbolInstances.length,Pc.sortKey),Ws.symbolInstances.emplaceBack(ah.x,ah.y,Pl.right>=0?Pl.right:-1,Pl.center>=0?Pl.center:-1,Pl.left>=0?Pl.left:-1,Pl.vertical||-1,u0,Lc,up,Zp,hv,Xv,Yv,qv,$v,Kv,Qv,o0,cd,L0,Hv,Wv,cp,0,lv,Bd,fd,of)}(Ba,i0,Vv,xo,ja,Zu,Ic,Ba.layers[0],Ba.collisionBoxArray,Mo.index,Mo.sourceLayerIndex,Ba.index,kp,nd,Lp,ks,lc,Lf,Td,th,Mo,Vu,ao,_l,zo)};if(Of==="line")for(var Mh=0,id=_s(Mo.geometry,0,0,8192,8192);Mh<id.length;Mh+=1)for(var ad=id[Mh],Op=0,Fp=Vs(ad,Pp,Rp,xo.vertical||kc,ja,24,rd,Ba.overscaling,8192);Op<Fp.length;Op+=1){var Dp=Fp[Op];kc&&ei(Ba,kc.text,Md,Dp)||nh(ad,Dp)}else if(Of==="line-center")for(var od=0,Bp=Mo.geometry;od<Bp.length;od+=1){var Np=Bp[od];if(Np.length>1){var zp=eo(Np,Rp,xo.vertical||kc,ja,24,rd);zp&&nh(Np,zp)}}else if(Mo.type==="Polygon")for(var Ih=0,sd=Cp(Mo.geometry,0);Ih<sd.length;Ih+=1){var ih=sd[Ih],ud=Yi(ih,16);nh(ih[0],new Rn(ud.x,ud.y,0))}else if(Mo.type==="LineString")for(var va=0,ca=Mo.geometry;va<ca.length;va+=1){var ap=ca[va];nh(ap,new Rn(ap[0].x,ap[0].y,0))}else if(Mo.type==="Point")for(var w0=0,T0=Mo.geometry;w0<T0.length;w0+=1)for(var Id=0,n0=T0[w0];Id<n0.length;Id+=1){var M0=n0[Id];nh([M0],new Rn(M0.x,M0.y,0))}}(n,yr,$n,bu,d,W,Bn,wi,ri,Pu,T)},kt=0,lr=n.features;kt<lr.length;kt+=1)Dt();C&&n.generateCollisionDebugBuffers()},y.perspective=function(n,s,l,d,x){var C,T=1/Math.tan(s/2);return n[0]=T/l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,x!=null&&x!==1/0?(n[10]=(x+d)*(C=1/(d-x)),n[14]=2*x*d*C):(n[10]=-1,n[14]=-2*d),n},y.pick=function(n,s){for(var l={},d=0;d<s.length;d++){var x=s[d];x in n&&(l[x]=n[x])}return l},y.plugin=qs,y.polygonIntersectsPolygon=Ms,y.postMapLoadEvent=Ke,y.postTurnstileEvent=sr,y.potpack=Ur,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Jn,y.registerForPluginStateChange=function(n){return n({pluginStatus:Tu,pluginURL:zl}),yp.on("pluginStateChange",n),n},y.renderColorRamp=Iu,y.rotate=function(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],R=Math.sin(l),z=Math.cos(l);return n[0]=d*z+C*R,n[1]=x*z+T*R,n[2]=d*-R+C*z,n[3]=x*-R+T*z,n},y.rotateX=function(n,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[4],T=s[5],R=s[6],z=s[7],W=s[8],$=s[9],ee=s[10],le=s[11];return s!==n&&(n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[4]=C*x+W*d,n[5]=T*x+$*d,n[6]=R*x+ee*d,n[7]=z*x+le*d,n[8]=W*x-C*d,n[9]=$*x-T*d,n[10]=ee*x-R*d,n[11]=le*x-z*d,n},y.rotateZ=function(n,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[0],T=s[1],R=s[2],z=s[3],W=s[4],$=s[5],ee=s[6],le=s[7];return s!==n&&(n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[0]=C*x+W*d,n[1]=T*x+$*d,n[2]=R*x+ee*d,n[3]=z*x+le*d,n[4]=W*x-C*d,n[5]=$*x-T*d,n[6]=ee*x-R*d,n[7]=le*x-z*d,n},y.scale=function(n,s,l){var d=l[0],x=l[1],C=l[2];return n[0]=s[0]*d,n[1]=s[1]*d,n[2]=s[2]*d,n[3]=s[3]*d,n[4]=s[4]*x,n[5]=s[5]*x,n[6]=s[6]*x,n[7]=s[7]*x,n[8]=s[8]*C,n[9]=s[9]*C,n[10]=s[10]*C,n[11]=s[11]*C,n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},y.scale$1=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n[3]=s[3]*l,n},y.scale$2=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n},y.setCacheLimits=function(n,s){Nt=n,Sr=s},y.setRTLTextPlugin=function(n,s,l){if(l===void 0&&(l=!1),Tu==="deferred"||Tu==="loading"||Tu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");zl=Ri.resolveURL(n),Tu="deferred",Nl=s,Vc(),l||cl()},y.sphericalToCartesian=function(n){var s=n[0],l=n[1],d=n[2];return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(d),y:s*Math.sin(l)*Math.sin(d),z:s*Math.cos(d)}},y.sqrLen=function(n){var s=n[0],l=n[1];return s*s+l*l},y.styleSpec=Te,y.sub=function(n,s,l){return n[0]=s[0]-l[0],n[1]=s[1]-l[1],n[2]=s[2]-l[2],n},y.symbolSize=Ma,y.transformMat3=function(n,s,l){var d=s[0],x=s[1],C=s[2];return n[0]=d*l[0]+x*l[3]+C*l[6],n[1]=d*l[1]+x*l[4]+C*l[7],n[2]=d*l[2]+x*l[5]+C*l[8],n},y.transformMat4=Sf,y.translate=function(n,s,l){var d,x,C,T,R,z,W,$,ee,le,be,$e,Je=l[0],dt=l[1],st=l[2];return s===n?(n[12]=s[0]*Je+s[4]*dt+s[8]*st+s[12],n[13]=s[1]*Je+s[5]*dt+s[9]*st+s[13],n[14]=s[2]*Je+s[6]*dt+s[10]*st+s[14],n[15]=s[3]*Je+s[7]*dt+s[11]*st+s[15]):(x=s[1],C=s[2],T=s[3],R=s[4],z=s[5],W=s[6],$=s[7],ee=s[8],le=s[9],be=s[10],$e=s[11],n[0]=d=s[0],n[1]=x,n[2]=C,n[3]=T,n[4]=R,n[5]=z,n[6]=W,n[7]=$,n[8]=ee,n[9]=le,n[10]=be,n[11]=$e,n[12]=d*Je+R*dt+ee*st+s[12],n[13]=x*Je+z*dt+le*st+s[13],n[14]=C*Je+W*dt+be*st+s[14],n[15]=T*Je+$*dt+$e*st+s[15]),n},y.triggerPluginCompletionEvent=Hf,y.uniqueId=cr,y.validateCustomStyleLayer=function(n){var s=[],l=n.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),n.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Qa,y.validateStyle=hh,y.values=function(n){var s=[];for(var l in n)s.push(n[l]);return s},y.vectorTile=cu,y.version="1.13.2",y.warnOnce=Ue,y.webpSupported=ln,y.window=Ae,y.wrap=Yt}),de(["./shared"],function(y){"use strict";function Be(Q){var ie=typeof Q;if(ie==="number"||ie==="boolean"||ie==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){for(var me="[",Ie=0,qe=Q;Ie<qe.length;Ie+=1)me+=Be(qe[Ie])+",";return me+"]"}for(var ot=Object.keys(Q).sort(),xt="{",Te=0;Te<ot.length;Te++)xt+=JSON.stringify(ot[Te])+":"+Be(Q[ot[Te]])+",";return xt+"}"}function K(Q){for(var ie="",me=0,Ie=y.refProperties;me<Ie.length;me+=1)ie+="/"+Be(Q[Ie[me]]);return ie}var ke=function(Q){this.keyCache={},Q&&this.replace(Q)};ke.prototype.replace=function(Q){this._layerConfigs={},this._layers={},this.update(Q,[])},ke.prototype.update=function(Q,ie){for(var me=this,Ie=0,qe=Q;Ie<qe.length;Ie+=1){var ot=qe[Ie];this._layerConfigs[ot.id]=ot;var xt=this._layers[ot.id]=y.createStyleLayer(ot);xt._featureFilter=y.featureFilter(xt.filter),this.keyCache[ot.id]&&delete this.keyCache[ot.id]}for(var Te=0,rt=ie;Te<rt.length;Te+=1){var Ht=rt[Te];delete this.keyCache[Ht],delete this._layerConfigs[Ht],delete this._layers[Ht]}this.familiesBySource={};for(var Zr=0,ar=function(Tn,Mn){for(var sa={},Pr=0;Pr<Tn.length;Pr++){var $i=Mn&&Mn[Tn[Pr].id]||K(Tn[Pr]);Mn&&(Mn[Tn[Pr].id]=$i);var La=sa[$i];La||(La=sa[$i]=[]),La.push(Tn[Pr])}var ra=[];for(var ma in sa)ra.push(sa[ma]);return ra}(y.values(this._layerConfigs),this.keyCache);Zr<ar.length;Zr+=1){var pr=ar[Zr].map(function(Tn){return me._layers[Tn.id]}),Hr=pr[0];if(Hr.visibility!=="none"){var li=Hr.source||"",wn=this.familiesBySource[li];wn||(wn=this.familiesBySource[li]={});var er=Hr.sourceLayer||"_geojsonTileLayer",Hn=wn[er];Hn||(Hn=wn[er]=[]),Hn.push(pr)}}};var he=function(Q){var ie={},me=[];for(var Ie in Q){var qe=Q[Ie],ot=ie[Ie]={};for(var xt in qe){var Te=qe[+xt];if(Te&&Te.bitmap.width!==0&&Te.bitmap.height!==0){var rt={x:0,y:0,w:Te.bitmap.width+2,h:Te.bitmap.height+2};me.push(rt),ot[xt]={rect:rt,metrics:Te.metrics}}}}var Ht=y.potpack(me),Zr=new y.AlphaImage({width:Ht.w||1,height:Ht.h||1});for(var ar in Q){var pr=Q[ar];for(var Hr in pr){var li=pr[+Hr];if(li&&li.bitmap.width!==0&&li.bitmap.height!==0){var wn=ie[ar][Hr].rect;y.AlphaImage.copy(li.bitmap,Zr,{x:0,y:0},{x:wn.x+1,y:wn.y+1},li.bitmap)}}}this.image=Zr,this.positions=ie};y.register("GlyphAtlas",he);var ut=function(Q){this.tileID=new y.OverscaledTileID(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId};function Ae(Q,ie,me){for(var Ie=new y.EvaluationParameters(ie),qe=0,ot=Q;qe<ot.length;qe+=1)ot[qe].recalculate(Ie,me)}function Xe(Q,ie){var me=y.getArrayBuffer(Q.request,function(Ie,qe,ot,xt){Ie?ie(Ie):qe&&ie(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(qe)),rawData:qe,cacheControl:ot,expires:xt})});return function(){me.cancel(),ie()}}ut.prototype.parse=function(Q,ie,me,Ie,qe){var ot=this;this.status="parsing",this.data=Q,this.collisionBoxArray=new y.CollisionBoxArray;var xt=new y.DictionaryCoder(Object.keys(Q.layers).sort()),Te=new y.FeatureIndex(this.tileID,this.promoteId);Te.bucketLayerIDs=[];var rt,Ht,Zr,ar,pr={},Hr={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},li=ie.familiesBySource[this.source];for(var wn in li){var er=Q.layers[wn];if(er){er.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+wn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Hn=xt.encode(wn),Tn=[],Mn=0;Mn<er.length;Mn++){var sa=er.feature(Mn),Pr=Te.getId(sa,wn);Tn.push({feature:sa,id:Pr,index:Mn,sourceLayerIndex:Hn})}for(var $i=0,La=li[wn];$i<La.length;$i+=1){var ra=La[$i],ma=ra[0];ma.minzoom&&this.zoom<Math.floor(ma.minzoom)||ma.maxzoom&&this.zoom>=ma.maxzoom||ma.visibility!=="none"&&(Ae(ra,this.zoom,me),(pr[ma.id]=ma.createBucket({index:Te.bucketLayerIDs.length,layers:ra,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hn,sourceID:this.source})).populate(Tn,Hr,this.tileID.canonical),Te.bucketLayerIDs.push(ra.map(function(Na){return Na.id})))}}}var Ft=y.mapObject(Hr.glyphDependencies,function(Na){return Object.keys(Na).map(Number)});Object.keys(Ft).length?Ie.send("getGlyphs",{uid:this.uid,stacks:Ft},function(Na,ji){rt||(rt=Na,Ht=ji,lo.call(ot))}):Ht={};var Tt=Object.keys(Hr.iconDependencies);Tt.length?Ie.send("getImages",{icons:Tt,source:this.source,tileID:this.tileID,type:"icons"},function(Na,ji){rt||(rt=Na,Zr=ji,lo.call(ot))}):Zr={};var ea=Object.keys(Hr.patternDependencies);function lo(){if(rt)return qe(rt);if(Ht&&Zr&&ar){var Na=new he(Ht),ji=new y.ImageAtlas(Zr,ar);for(var Aa in pr){var Co=pr[Aa];Co instanceof y.SymbolBucket?(Ae(Co.layers,this.zoom,me),y.performSymbolLayout(Co,Ht,Na.positions,Zr,ji.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Co.hasPattern&&(Co instanceof y.LineBucket||Co instanceof y.FillBucket||Co instanceof y.FillExtrusionBucket)&&(Ae(Co.layers,this.zoom,me),Co.addFeatures(Hr,this.tileID.canonical,ji.patternPositions))}this.status="done",qe(null,{buckets:y.values(pr).filter(function(an){return!an.isEmpty()}),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Na.image,imageAtlas:ji,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?Zr:null,glyphPositions:this.returnDependencies?Na.positions:null})}}ea.length?Ie.send("getImages",{icons:ea,source:this.source,tileID:this.tileID,type:"patterns"},function(Na,ji){rt||(rt=Na,ar=ji,lo.call(ot))}):ar={},lo.call(this)};var Ct=function(Q,ie,me,Ie){this.actor=Q,this.layerIndex=ie,this.availableImages=me,this.loadVectorData=Ie||Xe,this.loading={},this.loaded={}};Ct.prototype.loadTile=function(Q,ie){var me=this,Ie=Q.uid;this.loading||(this.loading={});var qe=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new y.RequestPerformance(Q.request),ot=this.loading[Ie]=new ut(Q);ot.abort=this.loadVectorData(Q,function(xt,Te){if(delete me.loading[Ie],xt||!Te)return ot.status="done",me.loaded[Ie]=ot,ie(xt);var rt=Te.rawData,Ht={};Te.expires&&(Ht.expires=Te.expires),Te.cacheControl&&(Ht.cacheControl=Te.cacheControl);var Zr={};if(qe){var ar=qe.finish();ar&&(Zr.resourceTiming=JSON.parse(JSON.stringify(ar)))}ot.vectorTile=Te.vectorTile,ot.parse(Te.vectorTile,me.layerIndex,me.availableImages,me.actor,function(pr,Hr){if(pr||!Hr)return ie(pr);ie(null,y.extend({rawTileData:rt.slice(0)},Hr,Ht,Zr))}),me.loaded=me.loaded||{},me.loaded[Ie]=ot})},Ct.prototype.reloadTile=function(Q,ie){var me=this,Ie=this.loaded,qe=Q.uid,ot=this;if(Ie&&Ie[qe]){var xt=Ie[qe];xt.showCollisionBoxes=Q.showCollisionBoxes;var Te=function(rt,Ht){var Zr=xt.reloadCallback;Zr&&(delete xt.reloadCallback,xt.parse(xt.vectorTile,ot.layerIndex,me.availableImages,ot.actor,Zr)),ie(rt,Ht)};xt.status==="parsing"?xt.reloadCallback=Te:xt.status==="done"&&(xt.vectorTile?xt.parse(xt.vectorTile,this.layerIndex,this.availableImages,this.actor,Te):Te())}},Ct.prototype.abortTile=function(Q,ie){var me=this.loading,Ie=Q.uid;me&&me[Ie]&&me[Ie].abort&&(me[Ie].abort(),delete me[Ie]),ie()},Ct.prototype.removeTile=function(Q,ie){var me=this.loaded,Ie=Q.uid;me&&me[Ie]&&delete me[Ie],ie()};var Lt=y.window.ImageBitmap,tr=function(){this.loaded={}};function Yt(Q,ie){if(Q.length!==0){Xt(Q[0],ie);for(var me=1;me<Q.length;me++)Xt(Q[me],!ie)}}function Xt(Q,ie){for(var me=0,Ie=0,qe=Q.length,ot=qe-1;Ie<qe;ot=Ie++)me+=(Q[Ie][0]-Q[ot][0])*(Q[ot][1]+Q[Ie][1]);me>=0!=!!ie&&Q.reverse()}tr.prototype.loadTile=function(Q,ie){var me=Q.uid,Ie=Q.encoding,qe=Q.rawImageData,ot=Lt&&qe instanceof Lt?this.getImageData(qe):qe,xt=new y.DEMData(me,ot,Ie);this.loaded=this.loaded||{},this.loaded[me]=xt,ie(null,xt)},tr.prototype.getImageData=function(Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,Q.width+2,Q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ie.width,height:ie.height},ie.data)},tr.prototype.removeTile=function(Q){var ie=this.loaded,me=Q.uid;ie&&ie[me]&&delete ie[me]};var Er=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,cr=function(Q){this._feature=Q,this.extent=y.EXTENT,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))};cr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Q=[],ie=0,me=this._feature.geometry;ie<me.length;ie+=1){var Ie=me[ie];Q.push([new y.Point$1(Ie[0],Ie[1])])}return Q}for(var qe=[],ot=0,xt=this._feature.geometry;ot<xt.length;ot+=1){for(var Te=[],rt=0,Ht=xt[ot];rt<Ht.length;rt+=1){var Zr=Ht[rt];Te.push(new y.Point$1(Zr[0],Zr[1]))}qe.push(Te)}return qe},cr.prototype.toGeoJSON=function(Q,ie,me){return Er.call(this,Q,ie,me)};var Rt=function(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=Q.length,this._features=Q};Rt.prototype.feature=function(Q){return new cr(this._features[Q])};var Zt=y.vectorTile.VectorTileFeature,Rr=re;function re(Q,ie){this.options=ie||{},this.features=Q,this.length=Q.length}function _r(Q,ie){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=ie||4096}re.prototype.feature=function(Q){return new _r(this.features[Q],this.options.extent)},_r.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var ie=0;ie<Q.length;ie++){for(var me=Q[ie],Ie=[],qe=0;qe<me.length;qe++)Ie.push(new y.Point$1(me[qe][0],me[qe][1]));this.geometry.push(Ie)}return this.geometry},_r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,ie=1/0,me=-1/0,Ie=1/0,qe=-1/0,ot=0;ot<Q.length;ot++)for(var xt=Q[ot],Te=0;Te<xt.length;Te++){var rt=xt[Te];ie=Math.min(ie,rt.x),me=Math.max(me,rt.x),Ie=Math.min(Ie,rt.y),qe=Math.max(qe,rt.y)}return[ie,Ie,me,qe]},_r.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Ot=Kt,_t=Rr;function Kt(Q){var ie=new y.pbf;return function(me,Ie){for(var qe in me.layers)Ie.writeMessage(3,Ue,me.layers[qe])}(Q,ie),ie.finish()}function Ue(Q,ie){var me;ie.writeVarintField(15,Q.version||1),ie.writeStringField(1,Q.name||""),ie.writeVarintField(5,Q.extent||4096);var Ie={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<Q.length;me++)Ie.feature=Q.feature(me),ie.writeMessage(2,Cr,Ie);var qe=Ie.keys;for(me=0;me<qe.length;me++)ie.writeStringField(3,qe[me]);var ot=Ie.values;for(me=0;me<ot.length;me++)ie.writeMessage(4,_e,ot[me])}function Cr(Q,ie){var me=Q.feature;me.id!==void 0&&ie.writeVarintField(1,me.id),ie.writeMessage(2,nn,Q),ie.writeVarintField(3,me.type),ie.writeMessage(4,Z,me)}function nn(Q,ie){var me=Q.feature,Ie=Q.keys,qe=Q.values,ot=Q.keycache,xt=Q.valuecache;for(var Te in me.properties){var rt=ot[Te];rt===void 0&&(Ie.push(Te),ot[Te]=rt=Ie.length-1),ie.writeVarint(rt);var Ht=me.properties[Te],Zr=typeof Ht;Zr!=="string"&&Zr!=="boolean"&&Zr!=="number"&&(Ht=JSON.stringify(Ht));var ar=Zr+":"+Ht,pr=xt[ar];pr===void 0&&(qe.push(Ht),xt[ar]=pr=qe.length-1),ie.writeVarint(pr)}}function ue(Q,ie){return(ie<<3)+(7&Q)}function tt(Q){return Q<<1^Q>>31}function Z(Q,ie){for(var me=Q.loadGeometry(),Ie=Q.type,qe=0,ot=0,xt=me.length,Te=0;Te<xt;Te++){var rt=me[Te],Ht=1;Ie===1&&(Ht=rt.length),ie.writeVarint(ue(1,Ht));for(var Zr=Ie===3?rt.length-1:rt.length,ar=0;ar<Zr;ar++){ar===1&&Ie!==1&&ie.writeVarint(ue(2,Zr-1));var pr=rt[ar].x-qe,Hr=rt[ar].y-ot;ie.writeVarint(tt(pr)),ie.writeVarint(tt(Hr)),qe+=pr,ot+=Hr}Ie===3&&ie.writeVarint(ue(7,1))}}function _e(Q,ie){var me=typeof Q;me==="string"?ie.writeStringField(1,Q):me==="boolean"?ie.writeBooleanField(7,Q):me==="number"&&(Q%1!=0?ie.writeDoubleField(3,Q):Q<0?ie.writeSVarintField(6,Q):ie.writeVarintField(5,Q))}function ze(Q,ie,me,Ie){wt(Q,me,Ie),wt(ie,2*me,2*Ie),wt(ie,2*me+1,2*Ie+1)}function wt(Q,ie,me){var Ie=Q[ie];Q[ie]=Q[me],Q[me]=Ie}function Vt(Q,ie,me,Ie){var qe=Q-me,ot=ie-Ie;return qe*qe+ot*ot}Ot.fromVectorTileJs=Kt,Ot.fromGeojsonVt=function(Q,ie){ie=ie||{};var me={};for(var Ie in Q)me[Ie]=new Rr(Q[Ie].features,ie),me[Ie].name=Ie,me[Ie].version=ie.version,me[Ie].extent=ie.extent;return Kt({layers:me})},Ot.GeoJSONWrapper=_t;var fr=function(Q){return Q[0]},Mt=function(Q){return Q[1]},Fr=function(Q,ie,me,Ie,qe){ie===void 0&&(ie=fr),me===void 0&&(me=Mt),Ie===void 0&&(Ie=64),qe===void 0&&(qe=Float64Array),this.nodeSize=Ie,this.points=Q;for(var ot=Q.length<65536?Uint16Array:Uint32Array,xt=this.ids=new ot(Q.length),Te=this.coords=new qe(2*Q.length),rt=0;rt<Q.length;rt++)xt[rt]=rt,Te[2*rt]=ie(Q[rt]),Te[2*rt+1]=me(Q[rt]);(function Ht(Zr,ar,pr,Hr,li,wn){if(!(li-Hr<=pr)){var er=Hr+li>>1;(function Hn(Tn,Mn,sa,Pr,$i,La){for(;$i>Pr;){if($i-Pr>600){var ra=$i-Pr+1,ma=sa-Pr+1,Ft=Math.log(ra),Tt=.5*Math.exp(2*Ft/3),ea=.5*Math.sqrt(Ft*Tt*(ra-Tt)/ra)*(ma-ra/2<0?-1:1);Hn(Tn,Mn,sa,Math.max(Pr,Math.floor(sa-ma*Tt/ra+ea)),Math.min($i,Math.floor(sa+(ra-ma)*Tt/ra+ea)),La)}var lo=Mn[2*sa+La],Na=Pr,ji=$i;for(ze(Tn,Mn,Pr,sa),Mn[2*$i+La]>lo&&ze(Tn,Mn,Pr,$i);Na<ji;){for(ze(Tn,Mn,Na,ji),Na++,ji--;Mn[2*Na+La]<lo;)Na++;for(;Mn[2*ji+La]>lo;)ji--}Mn[2*Pr+La]===lo?ze(Tn,Mn,Pr,ji):ze(Tn,Mn,++ji,$i),ji<=sa&&(Pr=ji+1),sa<=ji&&($i=ji-1)}})(Zr,ar,er,Hr,li,wn%2),Ht(Zr,ar,pr,Hr,er-1,wn+1),Ht(Zr,ar,pr,er+1,li,wn+1)}})(xt,Te,Ie,0,xt.length-1,0)};Fr.prototype.range=function(Q,ie,me,Ie){return function(qe,ot,xt,Te,rt,Ht,Zr){for(var ar,pr,Hr=[0,qe.length-1,0],li=[];Hr.length;){var wn=Hr.pop(),er=Hr.pop(),Hn=Hr.pop();if(er-Hn<=Zr)for(var Tn=Hn;Tn<=er;Tn++)pr=ot[2*Tn+1],(ar=ot[2*Tn])>=xt&&ar<=rt&&pr>=Te&&pr<=Ht&&li.push(qe[Tn]);else{var Mn=Math.floor((Hn+er)/2);pr=ot[2*Mn+1],(ar=ot[2*Mn])>=xt&&ar<=rt&&pr>=Te&&pr<=Ht&&li.push(qe[Mn]);var sa=(wn+1)%2;(wn===0?xt<=ar:Te<=pr)&&(Hr.push(Hn),Hr.push(Mn-1),Hr.push(sa)),(wn===0?rt>=ar:Ht>=pr)&&(Hr.push(Mn+1),Hr.push(er),Hr.push(sa))}}return li}(this.ids,this.coords,Q,ie,me,Ie,this.nodeSize)},Fr.prototype.within=function(Q,ie,me){return function(Ie,qe,ot,xt,Te,rt){for(var Ht=[0,Ie.length-1,0],Zr=[],ar=Te*Te;Ht.length;){var pr=Ht.pop(),Hr=Ht.pop(),li=Ht.pop();if(Hr-li<=rt)for(var wn=li;wn<=Hr;wn++)Vt(qe[2*wn],qe[2*wn+1],ot,xt)<=ar&&Zr.push(Ie[wn]);else{var er=Math.floor((li+Hr)/2),Hn=qe[2*er],Tn=qe[2*er+1];Vt(Hn,Tn,ot,xt)<=ar&&Zr.push(Ie[er]);var Mn=(pr+1)%2;(pr===0?ot-Te<=Hn:xt-Te<=Tn)&&(Ht.push(li),Ht.push(er-1),Ht.push(Mn)),(pr===0?ot+Te>=Hn:xt+Te>=Tn)&&(Ht.push(er+1),Ht.push(Hr),Ht.push(Mn))}}return Zr}(this.ids,this.coords,Q,ie,me,this.nodeSize)};var Xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Q){return Q}},Jr=function(Q){this.options=Ia(Object.create(Xn),Q),this.trees=new Array(this.options.maxZoom+1)};function Ri(Q,ie,me,Ie,qe){return{x:Q,y:ie,zoom:1/0,id:me,parentId:-1,numPoints:Ie,properties:qe}}function yi(Q,ie){var me=Q.geometry.coordinates,Ie=me[1];return{x:fa(me[0]),y:Di(Ie),zoom:1/0,index:ie,parentId:-1}}function ln(Q){return{type:"Feature",id:Q.id,properties:Sa(Q),geometry:{type:"Point",coordinates:[(Ie=Q.x,360*(Ie-.5)),(ie=Q.y,me=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ie,me,Ie}function Sa(Q){var ie=Q.numPoints,me=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return Ia(Ia({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:ie,point_count_abbreviated:me})}function fa(Q){return Q/360+.5}function Di(Q){var ie=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return me<0?0:me>1?1:me}function Ia(Q,ie){for(var me in ie)Q[me]=ie[me];return Q}function ui(Q){return Q.x}function Ji(Q){return Q.y}function di(Q,ie,me,Ie,qe,ot){var xt=qe-me,Te=ot-Ie;if(xt!==0||Te!==0){var rt=((Q-me)*xt+(ie-Ie)*Te)/(xt*xt+Te*Te);rt>1?(me=qe,Ie=ot):rt>0&&(me+=xt*rt,Ie+=Te*rt)}return(xt=Q-me)*xt+(Te=ie-Ie)*Te}function _i(Q,ie,me,Ie){var qe={id:Q===void 0?null:Q,type:ie,geometry:me,tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var xt=ot.geometry,Te=ot.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Uo(ot,xt);else if(Te==="Polygon"||Te==="MultiLineString")for(var rt=0;rt<xt.length;rt++)Uo(ot,xt[rt]);else if(Te==="MultiPolygon")for(rt=0;rt<xt.length;rt++)for(var Ht=0;Ht<xt[rt].length;Ht++)Uo(ot,xt[rt][Ht])}(qe),qe}function Uo(Q,ie){for(var me=0;me<ie.length;me+=3)Q.minX=Math.min(Q.minX,ie[me]),Q.minY=Math.min(Q.minY,ie[me+1]),Q.maxX=Math.max(Q.maxX,ie[me]),Q.maxY=Math.max(Q.maxY,ie[me+1])}function Eo(Q,ie,me,Ie){if(ie.geometry){var qe=ie.geometry.coordinates,ot=ie.geometry.type,xt=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),Te=[],rt=ie.id;if(me.promoteId?rt=ie.properties[me.promoteId]:me.generateId&&(rt=Ie||0),ot==="Point")to(qe,Te);else if(ot==="MultiPoint")for(var Ht=0;Ht<qe.length;Ht++)to(qe[Ht],Te);else if(ot==="LineString")Pt(qe,Te,xt,!1);else if(ot==="MultiLineString"){if(me.lineMetrics){for(Ht=0;Ht<qe.length;Ht++)Pt(qe[Ht],Te=[],xt,!1),Q.push(_i(rt,"LineString",Te,ie.properties));return}ge(qe,Te,xt,!1)}else if(ot==="Polygon")ge(qe,Te,xt,!0);else{if(ot!=="MultiPolygon"){if(ot==="GeometryCollection"){for(Ht=0;Ht<ie.geometry.geometries.length;Ht++)Eo(Q,{id:rt,geometry:ie.geometry.geometries[Ht],properties:ie.properties},me,Ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ht=0;Ht<qe.length;Ht++){var Zr=[];ge(qe[Ht],Zr,xt,!0),Te.push(Zr)}}Q.push(_i(rt,ot,Te,ie.properties))}}function to(Q,ie){ie.push(oe(Q[0])),ie.push(we(Q[1])),ie.push(0)}function Pt(Q,ie,me,Ie){for(var qe,ot,xt=0,Te=0;Te<Q.length;Te++){var rt=oe(Q[Te][0]),Ht=we(Q[Te][1]);ie.push(rt),ie.push(Ht),ie.push(0),Te>0&&(xt+=Ie?(qe*Ht-rt*ot)/2:Math.sqrt(Math.pow(rt-qe,2)+Math.pow(Ht-ot,2))),qe=rt,ot=Ht}var Zr=ie.length-3;ie[2]=1,function ar(pr,Hr,li,wn){for(var er,Hn=wn,Tn=li-Hr>>1,Mn=li-Hr,sa=pr[Hr],Pr=pr[Hr+1],$i=pr[li],La=pr[li+1],ra=Hr+3;ra<li;ra+=3){var ma=di(pr[ra],pr[ra+1],sa,Pr,$i,La);if(ma>Hn)er=ra,Hn=ma;else if(ma===Hn){var Ft=Math.abs(ra-Tn);Ft<Mn&&(er=ra,Mn=Ft)}}Hn>wn&&(er-Hr>3&&ar(pr,Hr,er,wn),pr[er+2]=Hn,li-er>3&&ar(pr,er,li,wn))}(ie,0,Zr,me),ie[Zr+2]=1,ie.size=Math.abs(xt),ie.start=0,ie.end=ie.size}function ge(Q,ie,me,Ie){for(var qe=0;qe<Q.length;qe++){var ot=[];Pt(Q[qe],ot,me,Ie),ie.push(ot)}}function oe(Q){return Q/360+.5}function we(Q){var ie=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return me<0?0:me>1?1:me}function V(Q,ie,me,Ie,qe,ot,xt,Te){if(Ie/=ie,ot>=(me/=ie)&&xt<Ie)return Q;if(xt<me||ot>=Ie)return null;for(var rt=[],Ht=0;Ht<Q.length;Ht++){var Zr=Q[Ht],ar=Zr.geometry,pr=Zr.type,Hr=qe===0?Zr.minX:Zr.minY,li=qe===0?Zr.maxX:Zr.maxY;if(Hr>=me&&li<Ie)rt.push(Zr);else if(!(li<me||Hr>=Ie)){var wn=[];if(pr==="Point"||pr==="MultiPoint")at(ar,wn,me,Ie,qe);else if(pr==="LineString")sr(ar,wn,me,Ie,qe,!1,Te.lineMetrics);else if(pr==="MultiLineString")Ke(ar,wn,me,Ie,qe,!1);else if(pr==="Polygon")Ke(ar,wn,me,Ie,qe,!0);else if(pr==="MultiPolygon")for(var er=0;er<ar.length;er++){var Hn=[];Ke(ar[er],Hn,me,Ie,qe,!0),Hn.length&&wn.push(Hn)}if(wn.length){if(Te.lineMetrics&&pr==="LineString"){for(er=0;er<wn.length;er++)rt.push(_i(Zr.id,pr,wn[er],Zr.tags));continue}pr!=="LineString"&&pr!=="MultiLineString"||(wn.length===1?(pr="LineString",wn=wn[0]):pr="MultiLineString"),pr!=="Point"&&pr!=="MultiPoint"||(pr=wn.length===3?"Point":"MultiPoint"),rt.push(_i(Zr.id,pr,wn,Zr.tags))}}}return rt.length?rt:null}function at(Q,ie,me,Ie,qe){for(var ot=0;ot<Q.length;ot+=3){var xt=Q[ot+qe];xt>=me&&xt<=Ie&&(ie.push(Q[ot]),ie.push(Q[ot+1]),ie.push(Q[ot+2]))}}function sr(Q,ie,me,Ie,qe,ot,xt){for(var Te,rt,Ht=$r(Q),Zr=qe===0?Sr:xr,ar=Q.start,pr=0;pr<Q.length-3;pr+=3){var Hr=Q[pr],li=Q[pr+1],wn=Q[pr+2],er=Q[pr+3],Hn=Q[pr+4],Tn=qe===0?Hr:li,Mn=qe===0?er:Hn,sa=!1;xt&&(Te=Math.sqrt(Math.pow(Hr-er,2)+Math.pow(li-Hn,2))),Tn<me?Mn>me&&(rt=Zr(Ht,Hr,li,er,Hn,me),xt&&(Ht.start=ar+Te*rt)):Tn>Ie?Mn<Ie&&(rt=Zr(Ht,Hr,li,er,Hn,Ie),xt&&(Ht.start=ar+Te*rt)):Nt(Ht,Hr,li,wn),Mn<me&&Tn>=me&&(rt=Zr(Ht,Hr,li,er,Hn,me),sa=!0),Mn>Ie&&Tn<=Ie&&(rt=Zr(Ht,Hr,li,er,Hn,Ie),sa=!0),!ot&&sa&&(xt&&(Ht.end=ar+Te*rt),ie.push(Ht),Ht=$r(Q)),xt&&(ar+=Te)}var Pr=Q.length-3;Hr=Q[Pr],li=Q[Pr+1],wn=Q[Pr+2],(Tn=qe===0?Hr:li)>=me&&Tn<=Ie&&Nt(Ht,Hr,li,wn),Pr=Ht.length-3,ot&&Pr>=3&&(Ht[Pr]!==Ht[0]||Ht[Pr+1]!==Ht[1])&&Nt(Ht,Ht[0],Ht[1],Ht[2]),Ht.length&&ie.push(Ht)}function $r(Q){var ie=[];return ie.size=Q.size,ie.start=Q.start,ie.end=Q.end,ie}function Ke(Q,ie,me,Ie,qe,ot){for(var xt=0;xt<Q.length;xt++)sr(Q[xt],ie,me,Ie,qe,ot,!1)}function Nt(Q,ie,me,Ie){Q.push(ie),Q.push(me),Q.push(Ie)}function Sr(Q,ie,me,Ie,qe,ot){var xt=(ot-ie)/(Ie-ie);return Q.push(ot),Q.push(me+(qe-me)*xt),Q.push(1),xt}function xr(Q,ie,me,Ie,qe,ot){var xt=(ot-me)/(qe-me);return Q.push(ie+(Ie-ie)*xt),Q.push(ot),Q.push(1),xt}function Lr(Q,ie){for(var me=[],Ie=0;Ie<Q.length;Ie++){var qe,ot=Q[Ie],xt=ot.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")qe=gn(ot.geometry,ie);else if(xt==="MultiLineString"||xt==="Polygon"){qe=[];for(var Te=0;Te<ot.geometry.length;Te++)qe.push(gn(ot.geometry[Te],ie))}else if(xt==="MultiPolygon")for(qe=[],Te=0;Te<ot.geometry.length;Te++){for(var rt=[],Ht=0;Ht<ot.geometry[Te].length;Ht++)rt.push(gn(ot.geometry[Te][Ht],ie));qe.push(rt)}me.push(_i(ot.id,xt,qe,ot.tags))}return me}function gn(Q,ie){var me=[];me.size=Q.size,Q.start!==void 0&&(me.start=Q.start,me.end=Q.end);for(var Ie=0;Ie<Q.length;Ie+=3)me.push(Q[Ie]+ie,Q[Ie+1],Q[Ie+2]);return me}function mi(Q,ie){if(Q.transformed)return Q;var me,Ie,qe,ot=1<<Q.z,xt=Q.x,Te=Q.y;for(me=0;me<Q.features.length;me++){var rt=Q.features[me],Ht=rt.geometry,Zr=rt.type;if(rt.geometry=[],Zr===1)for(Ie=0;Ie<Ht.length;Ie+=2)rt.geometry.push(ii(Ht[Ie],Ht[Ie+1],ie,ot,xt,Te));else for(Ie=0;Ie<Ht.length;Ie++){var ar=[];for(qe=0;qe<Ht[Ie].length;qe+=2)ar.push(ii(Ht[Ie][qe],Ht[Ie][qe+1],ie,ot,xt,Te));rt.geometry.push(ar)}}return Q.transformed=!0,Q}function ii(Q,ie,me,Ie,qe,ot){return[Math.round(me*(Q*Ie-qe)),Math.round(me*(ie*Ie-ot))]}function Sn(Q,ie,me,Ie,qe){for(var ot=ie===qe.maxZoom?0:qe.tolerance/((1<<ie)*qe.extent),xt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:Ie,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Te=0;Te<Q.length;Te++){xt.numFeatures++,Bi(xt,Q[Te],ot,qe);var rt=Q[Te].minX,Ht=Q[Te].minY,Zr=Q[Te].maxX,ar=Q[Te].maxY;rt<xt.minX&&(xt.minX=rt),Ht<xt.minY&&(xt.minY=Ht),Zr>xt.maxX&&(xt.maxX=Zr),ar>xt.maxY&&(xt.maxY=ar)}return xt}function Bi(Q,ie,me,Ie){var qe=ie.geometry,ot=ie.type,xt=[];if(ot==="Point"||ot==="MultiPoint")for(var Te=0;Te<qe.length;Te+=3)xt.push(qe[Te]),xt.push(qe[Te+1]),Q.numPoints++,Q.numSimplified++;else if(ot==="LineString")Vi(xt,qe,Q,me,!1,!1);else if(ot==="MultiLineString"||ot==="Polygon")for(Te=0;Te<qe.length;Te++)Vi(xt,qe[Te],Q,me,ot==="Polygon",Te===0);else if(ot==="MultiPolygon")for(var rt=0;rt<qe.length;rt++){var Ht=qe[rt];for(Te=0;Te<Ht.length;Te++)Vi(xt,Ht[Te],Q,me,!0,Te===0)}if(xt.length){var Zr=ie.tags||null;if(ot==="LineString"&&Ie.lineMetrics){for(var ar in Zr={},ie.tags)Zr[ar]=ie.tags[ar];Zr.mapbox_clip_start=qe.start/qe.size,Zr.mapbox_clip_end=qe.end/qe.size}var pr={geometry:xt,type:ot==="Polygon"||ot==="MultiPolygon"?3:ot==="LineString"||ot==="MultiLineString"?2:1,tags:Zr};ie.id!==null&&(pr.id=ie.id),Q.features.push(pr)}}function Vi(Q,ie,me,Ie,qe,ot){var xt=Ie*Ie;if(Ie>0&&ie.size<(qe?xt:Ie))me.numPoints+=ie.length/3;else{for(var Te=[],rt=0;rt<ie.length;rt+=3)(Ie===0||ie[rt+2]>xt)&&(me.numSimplified++,Te.push(ie[rt]),Te.push(ie[rt+1])),me.numPoints++;qe&&function(Ht,Zr){for(var ar=0,pr=0,Hr=Ht.length,li=Hr-2;pr<Hr;li=pr,pr+=2)ar+=(Ht[pr]-Ht[li])*(Ht[pr+1]+Ht[li+1]);if(ar>0===Zr)for(pr=0,Hr=Ht.length;pr<Hr/2;pr+=2){var wn=Ht[pr],er=Ht[pr+1];Ht[pr]=Ht[Hr-2-pr],Ht[pr+1]=Ht[Hr-1-pr],Ht[Hr-2-pr]=wn,Ht[Hr-1-pr]=er}}(Te,ot),Q.push(Te)}}function Ga(Q,ie){var me=(ie=this.options=function(qe,ot){for(var xt in ot)qe[xt]=ot[xt];return qe}(Object.create(this.options),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ie=function(qe,ot){var xt=[];if(qe.type==="FeatureCollection")for(var Te=0;Te<qe.features.length;Te++)Eo(xt,qe.features[Te],ot,Te);else Eo(xt,qe.type==="Feature"?qe:{geometry:qe},ot);return xt}(Q,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ie=function(qe,ot){var xt=ot.buffer/ot.extent,Te=qe,rt=V(qe,1,-1-xt,xt,0,-1,2,ot),Ht=V(qe,1,1-xt,2+xt,0,-1,2,ot);return(rt||Ht)&&(Te=V(qe,1,-xt,1+xt,0,-1,2,ot)||[],rt&&(Te=Lr(rt,1).concat(Te)),Ht&&(Te=Te.concat(Lr(Ht,-1)))),Te}(Ie,ie)).length&&this.splitTile(Ie,0,0,0),me&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oa(Q,ie,me){return 32*((1<<Q)*me+ie)+Q}function ro(Q,ie){var me=Q.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var Ie=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Ie)return ie(null,null);var qe=new Rt(Ie.features),ot=Ot(qe);ot.byteOffset===0&&ot.byteLength===ot.buffer.byteLength||(ot=new Uint8Array(ot)),ie(null,{vectorTile:qe,rawData:ot.buffer})}Jr.prototype.load=function(Q){var ie=this.options,me=ie.log,Ie=ie.minZoom,qe=ie.maxZoom,ot=ie.nodeSize;me&&console.time("total time");var xt="prepare "+Q.length+" points";me&&console.time(xt),this.points=Q;for(var Te=[],rt=0;rt<Q.length;rt++)Q[rt].geometry&&Te.push(yi(Q[rt],rt));this.trees[qe+1]=new Fr(Te,ui,Ji,ot,Float32Array),me&&console.timeEnd(xt);for(var Ht=qe;Ht>=Ie;Ht--){var Zr=+Date.now();Te=this._cluster(Te,Ht),this.trees[Ht]=new Fr(Te,ui,Ji,ot,Float32Array),me&&console.log("z%d: %d clusters in %dms",Ht,Te.length,+Date.now()-Zr)}return me&&console.timeEnd("total time"),this},Jr.prototype.getClusters=function(Q,ie){var me=((Q[0]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,Q[1])),qe=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,ot=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)me=-180,qe=180;else if(me>qe){var xt=this.getClusters([me,Ie,180,ot],ie),Te=this.getClusters([-180,Ie,qe,ot],ie);return xt.concat(Te)}for(var rt=this.trees[this._limitZoom(ie)],Ht=[],Zr=0,ar=rt.range(fa(me),Di(ot),fa(qe),Di(Ie));Zr<ar.length;Zr+=1){var pr=rt.points[ar[Zr]];Ht.push(pr.numPoints?ln(pr):this.points[pr.index])}return Ht},Jr.prototype.getChildren=function(Q){var ie=this._getOriginId(Q),me=this._getOriginZoom(Q),Ie="No cluster with the specified id.",qe=this.trees[me];if(!qe)throw new Error(Ie);var ot=qe.points[ie];if(!ot)throw new Error(Ie);for(var xt=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Te=[],rt=0,Ht=qe.within(ot.x,ot.y,xt);rt<Ht.length;rt+=1){var Zr=qe.points[Ht[rt]];Zr.parentId===Q&&Te.push(Zr.numPoints?ln(Zr):this.points[Zr.index])}if(Te.length===0)throw new Error(Ie);return Te},Jr.prototype.getLeaves=function(Q,ie,me){var Ie=[];return this._appendLeaves(Ie,Q,ie=ie||10,me=me||0,0),Ie},Jr.prototype.getTile=function(Q,ie,me){var Ie=this.trees[this._limitZoom(Q)],qe=Math.pow(2,Q),ot=this.options,xt=ot.radius/ot.extent,Te=(me-xt)/qe,rt=(me+1+xt)/qe,Ht={features:[]};return this._addTileFeatures(Ie.range((ie-xt)/qe,Te,(ie+1+xt)/qe,rt),Ie.points,ie,me,qe,Ht),ie===0&&this._addTileFeatures(Ie.range(1-xt/qe,Te,1,rt),Ie.points,qe,me,qe,Ht),ie===qe-1&&this._addTileFeatures(Ie.range(0,Te,xt/qe,rt),Ie.points,-1,me,qe,Ht),Ht.features.length?Ht:null},Jr.prototype.getClusterExpansionZoom=function(Q){for(var ie=this._getOriginZoom(Q)-1;ie<=this.options.maxZoom;){var me=this.getChildren(Q);if(ie++,me.length!==1)break;Q=me[0].properties.cluster_id}return ie},Jr.prototype._appendLeaves=function(Q,ie,me,Ie,qe){for(var ot=0,xt=this.getChildren(ie);ot<xt.length;ot+=1){var Te=xt[ot],rt=Te.properties;if(rt&&rt.cluster?qe+rt.point_count<=Ie?qe+=rt.point_count:qe=this._appendLeaves(Q,rt.cluster_id,me,Ie,qe):qe<Ie?qe++:Q.push(Te),Q.length===me)break}return qe},Jr.prototype._addTileFeatures=function(Q,ie,me,Ie,qe,ot){for(var xt=0,Te=Q;xt<Te.length;xt+=1){var rt=ie[Te[xt]],Ht=rt.numPoints,Zr={type:1,geometry:[[Math.round(this.options.extent*(rt.x*qe-me)),Math.round(this.options.extent*(rt.y*qe-Ie))]],tags:Ht?Sa(rt):this.points[rt.index].properties},ar=void 0;Ht?ar=rt.id:this.options.generateId?ar=rt.index:this.points[rt.index].id&&(ar=this.points[rt.index].id),ar!==void 0&&(Zr.id=ar),ot.features.push(Zr)}},Jr.prototype._limitZoom=function(Q){return Math.max(this.options.minZoom,Math.min(+Q,this.options.maxZoom+1))},Jr.prototype._cluster=function(Q,ie){for(var me=[],Ie=this.options,qe=Ie.reduce,ot=Ie.minPoints,xt=Ie.radius/(Ie.extent*Math.pow(2,ie)),Te=0;Te<Q.length;Te++){var rt=Q[Te];if(!(rt.zoom<=ie)){rt.zoom=ie;for(var Ht=this.trees[ie+1],Zr=Ht.within(rt.x,rt.y,xt),ar=rt.numPoints||1,pr=ar,Hr=0,li=Zr;Hr<li.length;Hr+=1){var wn=Ht.points[li[Hr]];wn.zoom>ie&&(pr+=wn.numPoints||1)}if(pr>=ot){for(var er=rt.x*ar,Hn=rt.y*ar,Tn=qe&&ar>1?this._map(rt,!0):null,Mn=(Te<<5)+(ie+1)+this.points.length,sa=0,Pr=Zr;sa<Pr.length;sa+=1){var $i=Ht.points[Pr[sa]];if(!($i.zoom<=ie)){$i.zoom=ie;var La=$i.numPoints||1;er+=$i.x*La,Hn+=$i.y*La,$i.parentId=Mn,qe&&(Tn||(Tn=this._map(rt,!0)),qe(Tn,this._map($i)))}}rt.parentId=Mn,me.push(Ri(er/pr,Hn/pr,Mn,pr,Tn))}else if(me.push(rt),pr>1)for(var ra=0,ma=Zr;ra<ma.length;ra+=1){var Ft=Ht.points[ma[ra]];Ft.zoom<=ie||(Ft.zoom=ie,me.push(Ft))}}}return me},Jr.prototype._getOriginId=function(Q){return Q-this.points.length>>5},Jr.prototype._getOriginZoom=function(Q){return(Q-this.points.length)%32},Jr.prototype._map=function(Q,ie){if(Q.numPoints)return ie?Ia({},Q.properties):Q.properties;var me=this.points[Q.index].properties,Ie=this.options.map(me);return ie&&Ie===me?Ia({},Ie):Ie},Ga.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ga.prototype.splitTile=function(Q,ie,me,Ie,qe,ot,xt){for(var Te=[Q,ie,me,Ie],rt=this.options,Ht=rt.debug;Te.length;){Ie=Te.pop(),me=Te.pop(),ie=Te.pop(),Q=Te.pop();var Zr=1<<ie,ar=oa(ie,me,Ie),pr=this.tiles[ar];if(!pr&&(Ht>1&&console.time("creation"),pr=this.tiles[ar]=Sn(Q,ie,me,Ie,rt),this.tileCoords.push({z:ie,x:me,y:Ie}),Ht)){Ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Ie,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));var Hr="z"+ie;this.stats[Hr]=(this.stats[Hr]||0)+1,this.total++}if(pr.source=Q,qe){if(ie===rt.maxZoom||ie===qe)continue;var li=1<<qe-ie;if(me!==Math.floor(ot/li)||Ie!==Math.floor(xt/li))continue}else if(ie===rt.indexMaxZoom||pr.numPoints<=rt.indexMaxPoints)continue;if(pr.source=null,Q.length!==0){Ht>1&&console.time("clipping");var wn,er,Hn,Tn,Mn,sa,Pr=.5*rt.buffer/rt.extent,$i=.5-Pr,La=.5+Pr,ra=1+Pr;wn=er=Hn=Tn=null,Mn=V(Q,Zr,me-Pr,me+La,0,pr.minX,pr.maxX,rt),sa=V(Q,Zr,me+$i,me+ra,0,pr.minX,pr.maxX,rt),Q=null,Mn&&(wn=V(Mn,Zr,Ie-Pr,Ie+La,1,pr.minY,pr.maxY,rt),er=V(Mn,Zr,Ie+$i,Ie+ra,1,pr.minY,pr.maxY,rt),Mn=null),sa&&(Hn=V(sa,Zr,Ie-Pr,Ie+La,1,pr.minY,pr.maxY,rt),Tn=V(sa,Zr,Ie+$i,Ie+ra,1,pr.minY,pr.maxY,rt),sa=null),Ht>1&&console.timeEnd("clipping"),Te.push(wn||[],ie+1,2*me,2*Ie),Te.push(er||[],ie+1,2*me,2*Ie+1),Te.push(Hn||[],ie+1,2*me+1,2*Ie),Te.push(Tn||[],ie+1,2*me+1,2*Ie+1)}}},Ga.prototype.getTile=function(Q,ie,me){var Ie=this.options,qe=Ie.extent,ot=Ie.debug;if(Q<0||Q>24)return null;var xt=1<<Q,Te=oa(Q,ie=(ie%xt+xt)%xt,me);if(this.tiles[Te])return mi(this.tiles[Te],qe);ot>1&&console.log("drilling down to z%d-%d-%d",Q,ie,me);for(var rt,Ht=Q,Zr=ie,ar=me;!rt&&Ht>0;)Ht--,Zr=Math.floor(Zr/2),ar=Math.floor(ar/2),rt=this.tiles[oa(Ht,Zr,ar)];return rt&&rt.source?(ot>1&&console.log("found parent tile z%d-%d-%d",Ht,Zr,ar),ot>1&&console.time("drilling down"),this.splitTile(rt.source,Ht,Zr,ar,Q,ie,me),ot>1&&console.timeEnd("drilling down"),this.tiles[Te]?mi(this.tiles[Te],qe):null):null};var Si=function(Q){function ie(me,Ie,qe,ot){Q.call(this,me,Ie,qe,ro),ot&&(this.loadGeoJSON=ot)}return Q&&(ie.__proto__=Q),(ie.prototype=Object.create(Q&&Q.prototype)).constructor=ie,ie.prototype.loadData=function(me,Ie){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ie,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ie=this._pendingCallback,qe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ot=!!(qe&&qe.request&&qe.request.collectResourceTiming)&&new y.RequestPerformance(qe.request);this.loadGeoJSON(qe,function(xt,Te){if(xt||!Te)return Ie(xt);if(typeof Te!="object")return Ie(new Error("Input data given to '"+qe.source+"' is not a valid GeoJSON object."));(function pr(Hr,li){var wn,er=Hr&&Hr.type;if(er==="FeatureCollection")for(wn=0;wn<Hr.features.length;wn++)pr(Hr.features[wn],li);else if(er==="GeometryCollection")for(wn=0;wn<Hr.geometries.length;wn++)pr(Hr.geometries[wn],li);else if(er==="Feature")pr(Hr.geometry,li);else if(er==="Polygon")Yt(Hr.coordinates,li);else if(er==="MultiPolygon")for(wn=0;wn<Hr.coordinates.length;wn++)Yt(Hr.coordinates[wn],li);return Hr})(Te,!0);try{if(qe.filter){var rt=y.createExpression(qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(function(pr){return pr.key+": "+pr.message}).join(", "));var Ht=Te.features.filter(function(pr){return rt.value.evaluate({zoom:0},pr)});Te={type:"FeatureCollection",features:Ht}}me._geoJSONIndex=qe.cluster?new Jr(function(pr){var Hr=pr.superclusterOptions,li=pr.clusterProperties;if(!li||!Hr)return Hr;for(var wn={},er={},Hn={accumulated:null,zoom:0},Tn={properties:null},Mn=Object.keys(li),sa=0,Pr=Mn;sa<Pr.length;sa+=1){var $i=Pr[sa],La=li[$i],ra=La[0],ma=y.createExpression(La[1]),Ft=y.createExpression(typeof ra=="string"?[ra,["accumulated"],["get",$i]]:ra);wn[$i]=ma.value,er[$i]=Ft.value}return Hr.map=function(Tt){Tn.properties=Tt;for(var ea={},lo=0,Na=Mn;lo<Na.length;lo+=1){var ji=Na[lo];ea[ji]=wn[ji].evaluate(Hn,Tn)}return ea},Hr.reduce=function(Tt,ea){Tn.properties=ea;for(var lo=0,Na=Mn;lo<Na.length;lo+=1){var ji=Na[lo];Hn.accumulated=Tt[ji],Tt[ji]=er[ji].evaluate(Hn,Tn)}},Hr}(qe)).load(Te.features):function(pr,Hr){return new Ga(pr,Hr)}(Te,qe.geojsonVtOptions)}catch(pr){return Ie(pr)}me.loaded={};var Zr={};if(ot){var ar=ot.finish();ar&&(Zr.resourceTiming={},Zr.resourceTiming[qe.source]=JSON.parse(JSON.stringify(ar)))}Ie(null,Zr)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(me,Ie){var qe=this.loaded;return qe&&qe[me.uid]?Q.prototype.reloadTile.call(this,me,Ie):this.loadTile(me,Ie)},ie.prototype.loadGeoJSON=function(me,Ie){if(me.request)y.getJSON(me.request,Ie);else{if(typeof me.data!="string")return Ie(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return Ie(null,JSON.parse(me.data))}catch(qe){return Ie(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(me,Ie){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ie()},ie.prototype.getClusterExpansionZoom=function(me,Ie){try{Ie(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(qe){Ie(qe)}},ie.prototype.getClusterChildren=function(me,Ie){try{Ie(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(qe){Ie(qe)}},ie.prototype.getClusterLeaves=function(me,Ie){try{Ie(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(qe){Ie(qe)}},ie}(Ct),ha=function(Q){var ie=this;this.self=Q,this.actor=new y.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ct,geojson:Si},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,Ie){if(ie.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ie.workerSourceTypes[me]=Ie},this.self.registerRTLTextPlugin=function(me){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=me.applyArabicShaping,y.plugin.processBidirectionalText=me.processBidirectionalText,y.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return ha.prototype.setReferrer=function(Q,ie){this.referrer=ie},ha.prototype.setImages=function(Q,ie,me){for(var Ie in this.availableImages[Q]=ie,this.workerSources[Q]){var qe=this.workerSources[Q][Ie];for(var ot in qe)qe[ot].availableImages=ie}me()},ha.prototype.setLayers=function(Q,ie,me){this.getLayerIndex(Q).replace(ie),me()},ha.prototype.updateLayers=function(Q,ie,me){this.getLayerIndex(Q).update(ie.layers,ie.removedIds),me()},ha.prototype.loadTile=function(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source).loadTile(ie,me)},ha.prototype.loadDEMTile=function(Q,ie,me){this.getDEMWorkerSource(Q,ie.source).loadTile(ie,me)},ha.prototype.reloadTile=function(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source).reloadTile(ie,me)},ha.prototype.abortTile=function(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source).abortTile(ie,me)},ha.prototype.removeTile=function(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source).removeTile(ie,me)},ha.prototype.removeDEMTile=function(Q,ie){this.getDEMWorkerSource(Q,ie.source).removeTile(ie)},ha.prototype.removeSource=function(Q,ie,me){if(this.workerSources[Q]&&this.workerSources[Q][ie.type]&&this.workerSources[Q][ie.type][ie.source]){var Ie=this.workerSources[Q][ie.type][ie.source];delete this.workerSources[Q][ie.type][ie.source],Ie.removeSource!==void 0?Ie.removeSource(ie,me):me()}},ha.prototype.loadWorkerSource=function(Q,ie,me){try{this.self.importScripts(ie.url),me()}catch(Ie){me(Ie.toString())}},ha.prototype.syncRTLPluginState=function(Q,ie,me){try{y.plugin.setState(ie);var Ie=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&Ie!=null){this.self.importScripts(Ie);var qe=y.plugin.isParsed();me(qe?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ie),qe)}}catch(ot){me(ot.toString())}},ha.prototype.getAvailableImages=function(Q){var ie=this.availableImages[Q];return ie||(ie=[]),ie},ha.prototype.getLayerIndex=function(Q){var ie=this.layerIndexes[Q];return ie||(ie=this.layerIndexes[Q]=new ke),ie},ha.prototype.getWorkerSource=function(Q,ie,me){var Ie=this;return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ie]||(this.workerSources[Q][ie]={}),this.workerSources[Q][ie][me]||(this.workerSources[Q][ie][me]=new this.workerSourceTypes[ie]({send:function(qe,ot,xt){Ie.actor.send(qe,ot,xt,Q)}},this.getLayerIndex(Q),this.getAvailableImages(Q))),this.workerSources[Q][ie][me]},ha.prototype.getDEMWorkerSource=function(Q,ie){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ie]||(this.demWorkerSources[Q][ie]=new tr),this.demWorkerSources[Q][ie]},ha.prototype.enforceCacheSizeLimit=function(Q,ie){y.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ha(self)),ha}),de(["./shared"],function(y){"use strict";var Be=y.createCommonjsModule(function(c){function h(S){return!f(S)}function f(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,B,Y=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(Y);try{B=new Worker(te),P=!0}catch(xe){P=!1}return B&&B.terminate(),URL.revokeObjectURL(te),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var B=P.getContext("2d");if(!B)return!1;var Y=B.getImageData(0,0,1,1);return Y&&Y.width===P.width}()?(m[I=S&&S.failIfMajorPerformanceCaveat]===void 0&&(m[I]=function(P){var B=function(te){var xe=document.createElement("canvas"),Ce=Object.create(h.webGLContextAttributes);return Ce.failIfMajorPerformanceCaveat=te,xe.probablySupportsContext?xe.probablySupportsContext("webgl",Ce)||xe.probablySupportsContext("experimental-webgl",Ce):xe.supportsContext?xe.supportsContext("webgl",Ce)||xe.supportsContext("experimental-webgl",Ce):xe.getContext("webgl",Ce)||xe.getContext("experimental-webgl",Ce)}(P);if(!B)return!1;var Y=B.createShader(B.VERTEX_SHADER);return!(!Y||B.isContextLost())&&(B.shaderSource(Y,"void main() {}"),B.compileShader(Y),B.getShaderParameter(Y,B.COMPILE_STATUS)===!0)}(I)),m[I]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var I}c.exports?c.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=f);var m={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),K={create:function(c,h,f){var m=y.window.document.createElement(c);return h!==void 0&&(m.className=h),f&&f.appendChild(m),m},createNS:function(c,h){return y.window.document.createElementNS(c,h)}},ke=y.window.document&&y.window.document.documentElement.style;function he(c){if(!ke)return c[0];for(var h=0;h<c.length;h++)if(c[h]in ke)return c[h];return c[0]}var ut,Ae=he(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);K.disableDrag=function(){ke&&Ae&&(ut=ke[Ae],ke[Ae]="none")},K.enableDrag=function(){ke&&Ae&&(ke[Ae]=ut)};var Xe=he(["transform","WebkitTransform"]);K.setTransform=function(c,h){c.style[Xe]=h};var Ct=!1;try{var Lt=Object.defineProperty({},"passive",{get:function(){Ct=!0}});y.window.addEventListener("test",Lt,Lt),y.window.removeEventListener("test",Lt,Lt)}catch(c){Ct=!1}K.addEventListener=function(c,h,f,m){m===void 0&&(m={}),c.addEventListener(h,f,"passive"in m&&Ct?m:m.capture)},K.removeEventListener=function(c,h,f,m){m===void 0&&(m={}),c.removeEventListener(h,f,"passive"in m&&Ct?m:m.capture)};var tr=function(c){c.preventDefault(),c.stopPropagation(),y.window.removeEventListener("click",tr,!0)};function Yt(c){var h=c.userImage;return!!(h&&h.render&&h.render())&&(c.data.replace(new Uint8Array(h.data.buffer)),!0)}K.suppressClick=function(){y.window.addEventListener("click",tr,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",tr,!0)},0)},K.mousePos=function(c,h){var f=c.getBoundingClientRect();return new y.Point(h.clientX-f.left-c.clientLeft,h.clientY-f.top-c.clientTop)},K.touchPos=function(c,h){for(var f=c.getBoundingClientRect(),m=[],S=0;S<h.length;S++)m.push(new y.Point(h[S].clientX-f.left-c.clientLeft,h[S].clientY-f.top-c.clientTop));return m},K.mouseButton=function(c){return y.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},K.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Xt=function(c){function h(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,S=this.requestors;m<S.length;m+=1){var I=S[m];this._notify(I.ids,I.callback)}this.requestors=[]}},h.prototype.getImage=function(f){return this.images[f]},h.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},h.prototype._validate=function(f,m){var S=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(m.content,m)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},h.prototype._validateStretch=function(f,m){if(!f)return!0;for(var S=0,I=0,P=f;I<P.length;I+=1){var B=P[I];if(B[0]<S||B[1]<B[0]||m<B[1])return!1;S=B[1]}return!0},h.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},h.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},h.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(f,m){var S=!0;if(!this.isLoaded())for(var I=0,P=f;I<P.length;I+=1)this.images[P[I]]||(S=!1);this.isLoaded()||S?this._notify(f,m):this.requestors.push({ids:f,callback:m})},h.prototype._notify=function(f,m){for(var S={},I=0,P=f;I<P.length;I+=1){var B=P[I];this.images[B]||this.fire(new y.Event("styleimagemissing",{id:B}));var Y=this.images[B];Y?S[B]={data:Y.data.clone(),pixelRatio:Y.pixelRatio,sdf:Y.sdf,version:Y.version,stretchX:Y.stretchX,stretchY:Y.stretchY,content:Y.content,hasRenderCallback:Boolean(Y.userImage&&Y.userImage.render)}:y.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,S)},h.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},h.prototype.getPattern=function(f){var m=this.patterns[f],S=this.getImage(f);if(!S)return null;if(m&&m.position.version===S.version)return m.position;if(m)m.position.version=S.version;else{var I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},P=new y.ImagePosition(I,S);this.patterns[f]={bin:I,position:P}}return this._updatePatternAtlas(),this.patterns[f].position},h.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var S=y.potpack(f),I=S.w,P=S.h,B=this.atlasImage;for(var Y in B.resize({width:I||1,height:P||1}),this.patterns){var te=this.patterns[Y].bin,xe=te.x+1,Ce=te.y+1,Me=this.images[Y].data,et=Me.width,Ne=Me.height;y.RGBAImage.copy(Me,B,{x:0,y:0},{x:xe,y:Ce},{width:et,height:Ne}),y.RGBAImage.copy(Me,B,{x:0,y:Ne-1},{x:xe,y:Ce-1},{width:et,height:1}),y.RGBAImage.copy(Me,B,{x:0,y:0},{x:xe,y:Ce+Ne},{width:et,height:1}),y.RGBAImage.copy(Me,B,{x:et-1,y:0},{x:xe-1,y:Ce},{width:1,height:Ne}),y.RGBAImage.copy(Me,B,{x:0,y:0},{x:xe+et,y:Ce},{width:1,height:Ne})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(f){for(var m=0,S=f;m<S.length;m+=1){var I=S[m];if(!this.callbackDispatchedThisFrame[I]){this.callbackDispatchedThisFrame[I]=!0;var P=this.images[I];Yt(P)&&this.updateImage(I,P)}}},h}(y.Evented),Er=Zt,cr=Zt,Rt=1e20;function Zt(c,h,f,m,S,I){this.fontSize=c||24,this.buffer=h===void 0?3:h,this.cutoff=m||.25,this.fontFamily=S||"sans-serif",this.fontWeight=I||"normal",this.radius=f||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Rr(c,h,f,m,S,I,P){for(var B=0;B<h;B++){for(var Y=0;Y<f;Y++)m[Y]=c[Y*h+B];for(re(m,S,I,P,f),Y=0;Y<f;Y++)c[Y*h+B]=S[Y]}for(Y=0;Y<f;Y++){for(B=0;B<h;B++)m[B]=c[Y*h+B];for(re(m,S,I,P,h),B=0;B<h;B++)c[Y*h+B]=Math.sqrt(S[B])}}function re(c,h,f,m,S){f[0]=0,m[0]=-Rt,m[1]=+Rt;for(var I=1,P=0;I<S;I++){for(var B=(c[I]+I*I-(c[f[P]]+f[P]*f[P]))/(2*I-2*f[P]);B<=m[P];)P--,B=(c[I]+I*I-(c[f[P]]+f[P]*f[P]))/(2*I-2*f[P]);f[++P]=I,m[P]=B,m[P+1]=+Rt}for(I=0,P=0;I<S;I++){for(;m[P+1]<I;)P++;h[I]=(I-f[P])*(I-f[P])+c[f[P]]}}Zt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var S=h.data[4*m+3]/255;this.gridOuter[m]=S===1?0:S===0?Rt:Math.pow(Math.max(0,.5-S),2),this.gridInner[m]=S===1?Rt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Rr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Rr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},Er.default=cr;var _r=function(c,h){this.requestManager=c,this.localIdeographFontFamily=h,this.entries={}};_r.prototype.setURL=function(c){this.url=c},_r.prototype.getGlyphs=function(c,h){var f=this,m=[];for(var S in c)for(var I=0,P=c[S];I<P.length;I+=1)m.push({stack:S,id:P[I]});y.asyncAll(m,function(B,Y){var te=B.stack,xe=B.id,Ce=f.entries[te];Ce||(Ce=f.entries[te]={glyphs:{},requests:{},ranges:{}});var Me=Ce.glyphs[xe];if(Me===void 0){if(Me=f._tinySDF(Ce,te,xe))return Ce.glyphs[xe]=Me,void Y(null,{stack:te,id:xe,glyph:Me});var et=Math.floor(xe/256);if(256*et>65535)Y(new Error("glyphs > 65535 not supported"));else if(Ce.ranges[et])Y(null,{stack:te,id:xe,glyph:Me});else{var Ne=Ce.requests[et];Ne||(Ne=Ce.requests[et]=[],_r.loadGlyphRange(te,et,f.url,f.requestManager,function(ct,je){if(je){for(var ht in je)f._doesCharSupportLocalGlyph(+ht)||(Ce.glyphs[+ht]=je[+ht]);Ce.ranges[et]=!0}for(var Et=0,Wt=Ne;Et<Wt.length;Et+=1)(0,Wt[Et])(ct,je);delete Ce.requests[et]})),Ne.push(function(ct,je){ct?Y(ct):je&&Y(null,{stack:te,id:xe,glyph:je[xe]||null})})}}else Y(null,{stack:te,id:xe,glyph:Me})},function(B,Y){if(B)h(B);else if(Y){for(var te={},xe=0,Ce=Y;xe<Ce.length;xe+=1){var Me=Ce[xe],et=Me.stack,Ne=Me.id,ct=Me.glyph;(te[et]||(te[et]={}))[Ne]=ct&&{id:ct.id,bitmap:ct.bitmap.clone(),metrics:ct.metrics}}h(null,te)}})},_r.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](c)||y.isChar["Hangul Syllables"](c)||y.isChar.Hiragana(c)||y.isChar.Katakana(c))},_r.prototype._tinySDF=function(c,h,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),S=c.tinySDF=new _r.TinySDF(24,3,8,.25,m,I)}return{id:f,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_r.loadGlyphRange=function(c,h,f,m,S){var I=256*h,P=I+255,B=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",I+"-"+P),y.ResourceType.Glyphs);y.getArrayBuffer(B,function(Y,te){if(Y)S(Y);else if(te){for(var xe={},Ce=0,Me=y.parseGlyphPBF(te);Ce<Me.length;Ce+=1){var et=Me[Ce];xe[et.id]=et}S(null,xe)}})},_r.TinySDF=Er;var Ot=function(){this.specification=y.styleSpec.light.position};Ot.prototype.possiblyEvaluate=function(c,h){return y.sphericalToCartesian(c.expression.evaluate(h))},Ot.prototype.interpolate=function(c,h,f){return{x:y.number(c.x,h.x,f),y:y.number(c.y,h.y,f),z:y.number(c.z,h.z,f)}};var _t=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Ot,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Kt=function(c){function h(f){c.call(this),this._transitionable=new y.Transitionable(_t),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(y.validateLight,f,m))for(var S in f){var I=f[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),I):this._transitionable.setValue(S,I)}},h.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},h.prototype._validate=function(f,m,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,f.call(y.validateStyle,y.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},h}(y.Evented),Ue=function(c,h){this.width=c,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ue.prototype.getDash=function(c,h){var f=c.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,h)),this.dashEntry[f]},Ue.prototype.getDashRanges=function(c,h,f){var m=[],S=c.length%2==1?-c[c.length-1]*f:0,I=c[0]*f,P=!0;m.push({left:S,right:I,isDash:P,zeroLength:c[0]===0});for(var B=c[0],Y=1;Y<c.length;Y++){var te=c[Y];m.push({left:S=B*f,right:I=(B+=te)*f,isDash:P=!P,zeroLength:te===0})}return m},Ue.prototype.addRoundDash=function(c,h,f){for(var m=h/2,S=-f;S<=f;S++)for(var I=this.width*(this.nextRow+f+S),P=0,B=c[P],Y=0;Y<this.width;Y++){Y/B.right>1&&(B=c[++P]);var te=Math.abs(Y-B.left),xe=Math.abs(Y-B.right),Ce=Math.min(te,xe),Me=void 0,et=S/f*(m+1);if(B.isDash){var Ne=m-Math.abs(et);Me=Math.sqrt(Ce*Ce+Ne*Ne)}else Me=m-Math.sqrt(Ce*Ce+et*et);this.data[I+Y]=Math.max(0,Math.min(255,Me+128))}},Ue.prototype.addRegularDash=function(c){for(var h=c.length-1;h>=0;--h){var f=c[h],m=c[h+1];f.zeroLength?c.splice(h,1):m&&m.isDash===f.isDash&&(m.left=f.left,c.splice(h,1))}var S=c[0],I=c[c.length-1];S.isDash===I.isDash&&(S.left=I.left-this.width,I.right=S.right+this.width);for(var P=this.width*this.nextRow,B=0,Y=c[B],te=0;te<this.width;te++){te/Y.right>1&&(Y=c[++B]);var xe=Math.abs(te-Y.left),Ce=Math.abs(te-Y.right),Me=Math.min(xe,Ce);this.data[P+te]=Math.max(0,Math.min(255,(Y.isDash?Me:-Me)+128))}},Ue.prototype.addDash=function(c,h){var f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,I=0;I<c.length;I++)S+=c[I];if(S!==0){var P=this.width/S,B=this.getDashRanges(c,this.width,P);h?this.addRoundDash(B,P,f):this.addRegularDash(B)}var Y={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=m,this.dirty=!0,Y},Ue.prototype.bind=function(c){var h=c.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Cr=function c(h,f){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var m=this.workerPool.acquire(this.id),S=0;S<m.length;S++){var I=new c.Actor(m[S],f,this.id);I.name="Worker "+S,this.actors.push(I)}};function nn(c,h,f){var m=function(S,I){if(S)return f(S);if(I){var P=y.pick(y.extend(I,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(P.vectorLayers=I.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(B){return B.id})),P.tiles=h.canonicalizeTileset(P,c.url),f(null,P)}};return c.url?y.getJSON(h.transformRequest(h.normalizeSourceURL(c.url),y.ResourceType.Source),m):y.browser.frame(function(){return m(null,c)})}Cr.prototype.broadcast=function(c,h,f){y.asyncAll(this.actors,function(m,S){m.send(c,h,S)},f=f||function(){})},Cr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Cr.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Cr.Actor=y.Actor;var ue=function(c,h,f){this.bounds=y.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=f||24};ue.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},ue.prototype.contains=function(c){var h=Math.pow(2,c.z),f=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*h),m=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=f&&c.x<S&&c.y>=m&&c.y<I};var tt=function(c){function h(f,m,S,I){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(m,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=nn(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new y.ErrorEvent(m)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new ue(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},h.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return y.extend({},this._options)},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(B,Y){return delete f.request,f.aborted?m(null):B&&B.status!==404?m(B):(Y&&Y.resourceTiming&&(f.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&f.setExpiryData(Y),f.loadVectorData(Y,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",I,P.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",I,P.bind(this)))},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(y.Evented),Z=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},m),y.extend(this,y.pick(m,["url","scheme","tileSize"]))}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=nn(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new y.ErrorEvent(m)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new ue(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return y.extend({},this._options)},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.loadTile=function(f,m){var S=this,I=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=y.getImage(this.map._requestManager.transformRequest(I,y.ResourceType.Tile),function(P,B){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(P)f.state="errored",m(P);else if(B){S.map._refreshExpiredTiles&&f.setExpiryData(B),delete B.cacheControl,delete B.expires;var Y=S.map.painter.context,te=Y.gl;f.texture=S.map.painter.getTileTexture(B.width),f.texture?f.texture.update(B,{useMipmap:!0}):(f.texture=new y.Texture(Y,B,te.RGBA,{useMipmap:!0}),f.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),Y.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax)),f.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),m(null)}})},h.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},h.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},h.prototype.hasTransition=function(){return!1},h}(y.Evented),_e=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function I(P,B){P&&(f.state="errored",m(P)),B&&(f.dem=B,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(P,B){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(P)f.state="errored",m(P);else if(B){this.map._refreshExpiredTiles&&f.setExpiryData(B),delete B.cacheControl,delete B.expires;var Y=y.window.ImageBitmap&&B instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?B:y.browser.getImageData(B,1),te={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:Y,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",te,I.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},h.prototype._getNeighboringTiles=function(f){var m=f.canonical,S=Math.pow(2,m.z),I=(m.x-1+S)%S,P=m.x===0?f.wrap-1:f.wrap,B=(m.x+1+S)%S,Y=m.x+1===S?f.wrap+1:f.wrap,te={};return te[new y.OverscaledTileID(f.overscaledZ,P,m.z,I,m.y).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,Y,m.z,B,m.y).key]={backfilled:!1},m.y>0&&(te[new y.OverscaledTileID(f.overscaledZ,P,m.z,I,m.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,Y,m.z,B,m.y-1).key]={backfilled:!1}),m.y+1<S&&(te[new y.OverscaledTileID(f.overscaledZ,P,m.z,I,m.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,Y,m.z,B,m.y+1).key]={backfilled:!1}),te},h.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},h}(Z),ze=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(I),this._data=m.data,this._options=y.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var P=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*P,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*P,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:y.EXTENT,radius:(m.clusterRadius||50)*P,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new y.ErrorEvent(m));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",S))}})},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)m.fire(new y.ErrorEvent(S));else{var I={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(I.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new y.Event("data",I))}}),this},h.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},h.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},h.prototype.getClusterLeaves=function(f,m,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:S},I),this},h.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var S=y.extend({},this.workerOptions),I=this._data;typeof I=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(I),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(I),this.actor.send(this.type+".loadData",S,function(P,B){m._removed||B&&B.abandoned||(m._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[m.id]&&(m._resourceTiming=B.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:S.source},null),f(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(f,m){var S=this,I=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(I,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,B){return delete f.request,f.unloadVectorData(),f.aborted?m(null):P?m(P):(f.loadVectorData(B,S.map.painter,I==="reloadTile"),m(null))})},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},h.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(y.Evented),wt=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Vt=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(f,m){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(I,P){S._loaded=!0,I?S.fire(new y.ErrorEvent(I)):P&&(S.image=P,f&&(S.coordinates=f),m&&m(),S._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var S=f.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var B=1/0,Y=1/0,te=-1/0,xe=-1/0,Ce=0,Me=P;Ce<Me.length;Ce+=1){var et=Me[Ce];B=Math.min(B,et.x),Y=Math.min(Y,et.y),te=Math.max(te,et.x),xe=Math.max(xe,et.y)}var Ne=Math.max(te-B,xe-Y),ct=Math.max(0,Math.floor(-Math.log(Ne)/Math.LN2)),je=Math.pow(2,ct);return new y.CanonicalTileID(ct,Math.floor((B+te)/2*je),Math.floor((Y+xe)/2*je))}(S),this.minzoom=this.maxzoom=this.tileID.z;var I=S.map(function(P){return m.tileID.getTilePoint(P)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(I[2].x,I[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},h.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(y.Evented),fr=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),this.roundZoom=!0,this.type="video",this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var S=0,I=m.urls;S<I.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(I[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(P,B){f._loaded=!0,P?f.fire(new y.ErrorEvent(P)):B&&(f.video=B,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(Vt),Mt=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(B){return typeof B!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,S=m.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(m,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var S=m[f];if(isNaN(S)||S<=0)return!0}return!1},h}(Vt),Fr={vector:tt,raster:Z,"raster-dem":_e,geojson:ze,video:fr,image:Vt,canvas:Mt};function Xn(c,h){var f=y.identity([]);return y.translate(f,f,[1,1,0]),y.scale(f,f,[.5*c.width,.5*c.height,1]),y.multiply(f,f,c.calculatePosMatrix(h.toUnwrapped()))}function Jr(c,h,f,m,S,I){var P=function(ct,je,ht){if(ct)for(var Et=0,Wt=ct;Et<Wt.length;Et+=1){var vr=je[Wt[Et]];if(vr&&vr.source===ht&&vr.type==="fill-extrusion")return!0}else for(var rr in je){var Ar=je[rr];if(Ar.source===ht&&Ar.type==="fill-extrusion")return!0}return!1}(S&&S.layers,h,c.id),B=I.maxPitchScaleFactor(),Y=c.tilesIn(m,B,P);Y.sort(Ri);for(var te=[],xe=0,Ce=Y;xe<Ce.length;xe+=1){var Me=Ce[xe];te.push({wrappedTileID:Me.tileID.wrapped().key,queryResults:Me.tile.queryRenderedFeatures(h,f,c._state,Me.queryGeometry,Me.cameraQueryGeometry,Me.scale,S,I,B,Xn(c.transform,Me.tileID))})}var et=function(ct){for(var je={},ht={},Et=0,Wt=ct;Et<Wt.length;Et+=1){var vr=Wt[Et],rr=vr.queryResults,Ar=vr.wrappedTileID,Xr=ht[Ar]=ht[Ar]||{};for(var bn in rr)for(var pn=rr[bn],Vn=Xr[bn]=Xr[bn]||{},bi=je[bn]=je[bn]||[],Ti=0,Ai=pn;Ti<Ai.length;Ti+=1){var ba=Ai[Ti];Vn[ba.featureIndex]||(Vn[ba.featureIndex]=!0,bi.push(ba))}}return je}(te);for(var Ne in et)et[Ne].forEach(function(ct){var je=ct.feature,ht=c.getFeatureState(je.layer["source-layer"],je.id);je.source=je.layer.source,je.layer["source-layer"]&&(je.sourceLayer=je.layer["source-layer"]),je.state=ht});return et}function Ri(c,h){var f=c.tileID,m=h.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var yi=function(c,h){this.max=c,this.onRemove=h,this.reset()};yi.prototype.reset=function(){for(var c in this.data)for(var h=0,f=this.data[c];h<f.length;h+=1){var m=f[h];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},yi.prototype.add=function(c,h,f){var m=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var I={value:h,timeout:void 0};if(f!==void 0&&(I.timeout=setTimeout(function(){m.remove(c,I)},f)),this.data[S].push(I),this.order.push(S),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},yi.prototype.has=function(c){return c.wrapped().key in this.data},yi.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},yi.prototype._getAndRemoveByKey=function(c){var h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value},yi.prototype.getByKey=function(c){var h=this.data[c];return h?h[0].value:null},yi.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},yi.prototype.remove=function(c,h){if(!this.has(c))return this;var f=c.wrapped().key,m=h===void 0?0:this.data[f].indexOf(h),S=this.data[f][m];return this.data[f].splice(m,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},yi.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},yi.prototype.filter=function(c){var h=[];for(var f in this.data)for(var m=0,S=this.data[f];m<S.length;m+=1){var I=S[m];c(I.value)||h.push(I)}for(var P=0,B=h;P<B.length;P+=1){var Y=B[P];this.remove(Y.value.tileID,Y)}};var ln=function(c,h,f){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};ln.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ln.prototype.updateData=function(c){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},ln.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Sa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},fa=function(c,h,f,m){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};fa.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},fa.prototype.updateData=function(c){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)},fa.prototype.enableAttributes=function(c,h){for(var f=0;f<this.attributes.length;f++){var m=h.attributes[this.attributes[f].name];m!==void 0&&c.enableVertexAttribArray(m)}},fa.prototype.setVertexAttribPointers=function(c,h,f){for(var m=0;m<this.attributes.length;m++){var S=this.attributes[m],I=h.attributes[S.name];I!==void 0&&c.vertexAttribPointer(I,S.components,c[Sa[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},fa.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Di=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Di.prototype.get=function(){return this.current},Di.prototype.set=function(c){},Di.prototype.getDefault=function(){return this.default},Di.prototype.setDefault=function(){this.set(this.default)};var Ia=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return y.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Di),ui=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},h}(Di),Ji=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},h}(Di),di=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Di),_i=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},h}(Di),Uo=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},h}(Di),Eo=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},h}(Di),to=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},h}(Di),Pt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},h}(Di),ge=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Di),oe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},h}(Di),we=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},h}(Di),V=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},h}(Di),at=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Di),sr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return y.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Di),$r=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},h}(Di),Ke=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},h}(Di),Nt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},h}(Di),Sr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},h}(Di),xr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},h}(Di),Lr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},h}(Di),gn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Di),mi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},h}(Di),ii=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(Di),Sn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},h}(Di),Bi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},h}(Di),Vi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},h}(Di),Ga=function(c){function h(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},h}(Di),oa=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},h}(Di),ro=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},h}(Di),Si=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},h}(Di),ha=function(c){function h(f,m){c.call(this,f),this.context=f,this.parent=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(Di),Q=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},h}(ha),ie=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(ha),me=function(c,h,f,m){this.context=c,this.width=h,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Q(c,S),m&&(this.depthAttachment=new ie(c,S))};me.prototype.destroy=function(){var c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var Ie=function(c,h,f){this.func=c,this.mask=h,this.range=f};Ie.ReadOnly=!1,Ie.ReadWrite=!0,Ie.disabled=new Ie(519,Ie.ReadOnly,[0,1]);var qe=function(c,h,f,m,S,I){this.test=c,this.ref=h,this.mask=f,this.fail=m,this.depthFail=S,this.pass=I};qe.disabled=new qe({func:519,mask:0},0,0,7680,7680,7680);var ot=function(c,h,f){this.blendFunction=c,this.blendColor=h,this.mask=f};ot.disabled=new ot(ot.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),ot.unblended=new ot(ot.Replace,y.Color.transparent,[!0,!0,!0,!0]),ot.alphaBlended=new ot([1,771],y.Color.transparent,[!0,!0,!0,!0]);var xt=function(c,h,f){this.enable=c,this.mode=h,this.frontFace=f};xt.disabled=new xt(!1,1029,2305),xt.backCCW=new xt(!0,1029,2305);var Te=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ia(this),this.clearDepth=new ui(this),this.clearStencil=new Ji(this),this.colorMask=new di(this),this.depthMask=new _i(this),this.stencilMask=new Uo(this),this.stencilFunc=new Eo(this),this.stencilOp=new to(this),this.stencilTest=new Pt(this),this.depthRange=new ge(this),this.depthTest=new oe(this),this.depthFunc=new we(this),this.blend=new V(this),this.blendFunc=new at(this),this.blendColor=new sr(this),this.blendEquation=new $r(this),this.cullFace=new Ke(this),this.cullFaceSide=new Nt(this),this.frontFace=new Sr(this),this.program=new xr(this),this.activeTexture=new Lr(this),this.viewport=new gn(this),this.bindFramebuffer=new mi(this),this.bindRenderbuffer=new ii(this),this.bindTexture=new Sn(this),this.bindVertexBuffer=new Bi(this),this.bindElementBuffer=new Vi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ga(this),this.pixelStoreUnpack=new oa(this),this.pixelStoreUnpackPremultiplyAlpha=new ro(this),this.pixelStoreUnpackFlipY=new Si(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};Te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Te.prototype.createIndexBuffer=function(c,h){return new ln(this,c,h)},Te.prototype.createVertexBuffer=function(c,h,f){return new fa(this,c,h,f)},Te.prototype.createRenderbuffer=function(c,h,f){var m=this.gl,S=m.createRenderbuffer();return this.bindRenderbuffer.set(S),m.renderbufferStorage(m.RENDERBUFFER,c,h,f),this.bindRenderbuffer.set(null),S},Te.prototype.createFramebuffer=function(c,h,f){return new me(this,c,h,f)},Te.prototype.clear=function(c){var h=c.color,f=c.depth,m=this.gl,S=0;h&&(S|=m.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(S)},Te.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},Te.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},Te.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},Te.prototype.setColorMode=function(c){y.deepEqual(c.blendFunction,ot.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},Te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var rt=function(c){function h(f,m,S){var I=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=function(P,B,Y,te){var xe=new Fr[B.type](P,B,Y,te);if(xe.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+xe.id);return y.bindAll(["load","abort","unload","serialize","prepare"],xe),xe}(f,m,S,this),this._tiles={},this._cache=new yi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},h.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},h.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},h.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[m];S.upload(f),S.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return y.values(this._tiles).map(function(f){return f.tileID}).sort(Ht).map(function(f){return f.key})},h.prototype.getRenderableIds=function(f){var m=this,S=[];for(var I in this._tiles)this._isIdRenderable(I,f)&&S.push(this._tiles[I]);return f?S.sort(function(P,B){var Y=P.tileID,te=B.tileID,xe=new y.Point(Y.canonical.x,Y.canonical.y)._rotate(m.transform.angle),Ce=new y.Point(te.canonical.x,te.canonical.y)._rotate(m.transform.angle);return Y.overscaledZ-te.overscaledZ||Ce.y-xe.y||Ce.x-xe.x}).map(function(P){return P.tileID.key}):S.map(function(P){return P.tileID}).sort(Ht).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},h.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},h.prototype._reloadTile=function(f,m){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=m),this._loadTile(S,this._tileLoaded.bind(this,S,f,m)))},h.prototype._tileLoaded=function(f,m,S,I){if(I)return f.state="errored",void(I.status!==404?this._source.fire(new y.ErrorEvent(I,{tile:f})):this.update(this.transform));f.timeAdded=y.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},h.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),S=0;S<m.length;S++){var I=m[S];if(f.neighboringTiles&&f.neighboringTiles[I]){var P=this.getTileByID(I);B(f,P),B(P,f)}}function B(Y,te){Y.needsHillshadePrepare=!0;var xe=te.tileID.canonical.x-Y.tileID.canonical.x,Ce=te.tileID.canonical.y-Y.tileID.canonical.y,Me=Math.pow(2,Y.tileID.canonical.z),et=te.tileID.key;xe===0&&Ce===0||Math.abs(Ce)>1||(Math.abs(xe)>1&&(Math.abs(xe+Me)===1?xe+=Me:Math.abs(xe-Me)===1&&(xe-=Me)),te.dem&&Y.dem&&(Y.dem.backfillBorder(te.dem,xe,Ce),Y.neighboringTiles&&Y.neighboringTiles[et]&&(Y.neighboringTiles[et].backfilled=!0)))}},h.prototype.getTile=function(f){return this.getTileByID(f.key)},h.prototype.getTileByID=function(f){return this._tiles[f]},h.prototype._retainLoadedChildren=function(f,m,S,I){for(var P in this._tiles){var B=this._tiles[P];if(!(I[P]||!B.hasData()||B.tileID.overscaledZ<=m||B.tileID.overscaledZ>S)){for(var Y=B.tileID;B&&B.tileID.overscaledZ>m+1;){var te=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[te.key])&&B.hasData()&&(Y=te)}for(var xe=Y;xe.overscaledZ>m;)if(f[(xe=xe.scaledTo(xe.overscaledZ-1)).key]){I[Y.key]=Y;break}}}},h.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=m?S:null}for(var I=f.overscaledZ-1;I>=m;I--){var P=f.scaledTo(I),B=this._getLoadedTile(P);if(B)return B}},h.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},h.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,I=Math.floor(m*S*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var S={};for(var I in this._tiles){var P=this._tiles[I];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+m),S[P.tileID.key]=P}for(var B in this._tiles=S,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var Y in this._tiles)this._setTileReloadTimer(Y,this._tiles[Y])}},h.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Xr){return new y.OverscaledTileID(Xr.canonical.z,Xr.wrap,Xr.canonical.z,Xr.canonical.x,Xr.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Xr){return m._source.hasTile(Xr)}))):S=[];var I=f.coveringZoomLevel(this._source),P=Math.max(I-h.maxOverzooming,this._source.minzoom),B=Math.max(I+h.maxUnderzooming,this._source.minzoom),Y=this._updateRetainedTiles(S,I);if(Zr(this._source.type)){for(var te={},xe={},Ce=0,Me=Object.keys(Y);Ce<Me.length;Ce+=1){var et=Me[Ce],Ne=Y[et],ct=this._tiles[et];if(ct&&!(ct.fadeEndTime&&ct.fadeEndTime<=y.browser.now())){var je=this.findLoadedParent(Ne,P);je&&(this._addTile(je.tileID),te[je.tileID.key]=je.tileID),xe[et]=Ne}}for(var ht in this._retainLoadedChildren(xe,I,B,Y),te)Y[ht]||(this._coveredTiles[ht]=!0,Y[ht]=te[ht])}for(var Et in Y)this._tiles[Et].clearFadeHold();for(var Wt=0,vr=y.keysDifference(this._tiles,Y);Wt<vr.length;Wt+=1){var rr=vr[Wt],Ar=this._tiles[rr];Ar.hasSymbolBuckets&&!Ar.holdingForFade()?Ar.setHoldDuration(this.map._fadeDuration):Ar.hasSymbolBuckets&&!Ar.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},h.prototype._updateRetainedTiles=function(f,m){for(var S={},I={},P=Math.max(m-h.maxOverzooming,this._source.minzoom),B=Math.max(m+h.maxUnderzooming,this._source.minzoom),Y={},te=0,xe=f;te<xe.length;te+=1){var Ce=xe[te],Me=this._addTile(Ce);S[Ce.key]=Ce,Me.hasData()||m<this._source.maxzoom&&(Y[Ce.key]=Ce)}this._retainLoadedChildren(Y,m,B,S);for(var et=0,Ne=f;et<Ne.length;et+=1){var ct=Ne[et],je=this._tiles[ct.key];if(!je.hasData()){if(m+1>this._source.maxzoom){var ht=ct.children(this._source.maxzoom)[0],Et=this.getTile(ht);if(Et&&Et.hasData()){S[ht.key]=ht;continue}}else{var Wt=ct.children(this._source.maxzoom);if(S[Wt[0].key]&&S[Wt[1].key]&&S[Wt[2].key]&&S[Wt[3].key])continue}for(var vr=je.wasRequested(),rr=ct.overscaledZ-1;rr>=P;--rr){var Ar=ct.scaledTo(rr);if(I[Ar.key]||(I[Ar.key]=!0,!(je=this.getTile(Ar))&&vr&&(je=this._addTile(Ar)),je&&(S[Ar.key]=Ar,vr=je.wasRequested(),je.hasData())))break}}}return S},h.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],S=void 0,I=this._tiles[f].tileID;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}m.push(I.key);var P=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(P))break;I=P}for(var B=0,Y=m;B<Y.length;B+=1)this._loadedParentTiles[Y[B]]=S}},h.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var S=Boolean(m);return S||(m=new y.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,S||this._source.fire(new y.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},h.prototype._setTileReloadTimer=function(f,m){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var I=m.getExpiryTimeout();I&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},I))},h.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},h.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},h.prototype.tilesIn=function(f,m,S){var I=this,P=[],B=this.transform;if(!B)return P;for(var Y=S?B.getCameraQueryGeometry(f):f,te=f.map(function(rr){return B.pointCoordinate(rr)}),xe=Y.map(function(rr){return B.pointCoordinate(rr)}),Ce=this.getIds(),Me=1/0,et=1/0,Ne=-1/0,ct=-1/0,je=0,ht=xe;je<ht.length;je+=1){var Et=ht[je];Me=Math.min(Me,Et.x),et=Math.min(et,Et.y),Ne=Math.max(Ne,Et.x),ct=Math.max(ct,Et.y)}for(var Wt=function(rr){var Ar=I._tiles[Ce[rr]];if(!Ar.holdingForFade()){var Xr=Ar.tileID,bn=Math.pow(2,B.zoom-Ar.tileID.overscaledZ),pn=m*Ar.queryPadding*y.EXTENT/Ar.tileSize/bn,Vn=[Xr.getTilePoint(new y.MercatorCoordinate(Me,et)),Xr.getTilePoint(new y.MercatorCoordinate(Ne,ct))];if(Vn[0].x-pn<y.EXTENT&&Vn[0].y-pn<y.EXTENT&&Vn[1].x+pn>=0&&Vn[1].y+pn>=0){var bi=te.map(function(Ai){return Xr.getTilePoint(Ai)}),Ti=xe.map(function(Ai){return Xr.getTilePoint(Ai)});P.push({tile:Ar,tileID:Xr,queryGeometry:bi,cameraQueryGeometry:Ti,scale:bn})}}},vr=0;vr<Ce.length;vr++)Wt(vr);return P},h.prototype.getVisibleCoordinates=function(f){for(var m=this,S=this.getRenderableIds(f).map(function(Y){return m._tiles[Y].tileID}),I=0,P=S;I<P.length;I+=1){var B=P[I];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return S},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Zr(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=y.browser.now())return!0}return!1},h.prototype.setFeatureState=function(f,m,S){this._state.updateState(f=f||"_geojsonTileLayer",m,S)},h.prototype.removeFeatureState=function(f,m,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,S)},h.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},h.prototype.setDependencies=function(f,m,S){var I=this._tiles[f];I&&I.setDependencies(m,S)},h.prototype.reloadTilesForDependencies=function(f,m){for(var S in this._tiles)this._tiles[S].hasDependency(f,m)&&this._reloadTile(S,"reloading");this._cache.filter(function(I){return!I.hasDependency(f,m)})},h}(y.Evented);function Ht(c,h){var f=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*h.wrap)-+(h.wrap<0);return c.overscaledZ-h.overscaledZ||m-f||h.canonical.y-c.canonical.y||h.canonical.x-c.canonical.x}function Zr(c){return c==="raster"||c==="image"||c==="video"}function ar(){return new y.window.Worker(Ef.workerUrl)}rt.maxOverzooming=10,rt.maxUnderzooming=3;var pr="mapboxgl_preloaded_worker_pool",Hr=function(){this.active={}};Hr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Hr.workerCount;)this.workers.push(new ar);return this.active[c]=!0,this.workers.slice()},Hr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},Hr.prototype.isPreloaded=function(){return!!this.active[pr]},Hr.prototype.numActive=function(){return Object.keys(this.active).length};var li,wn=Math.floor(y.browser.hardwareConcurrency/2);function er(){return li||(li=new Hr),li}function Hn(c,h){var f={};for(var m in c)m!=="ref"&&(f[m]=c[m]);return y.refProperties.forEach(function(S){S in h&&(f[S]=h[S])}),f}function Tn(c){c=c.slice();for(var h=Object.create(null),f=0;f<c.length;f++)h[c[f].id]=c[f];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=Hn(c[m],h[c[m].ref]));return c}Hr.workerCount=Math.max(Math.min(wn,6),1);var Mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function sa(c,h,f){f.push({command:Mn.addSource,args:[c,h[c]]})}function Pr(c,h,f){h.push({command:Mn.removeSource,args:[c]}),f[c]=!0}function $i(c,h,f,m){Pr(c,f,m),sa(c,h,f)}function La(c,h,f){var m;for(m in c[f])if(c[f].hasOwnProperty(m)&&m!=="data"&&!y.deepEqual(c[f][m],h[f][m]))return!1;for(m in h[f])if(h[f].hasOwnProperty(m)&&m!=="data"&&!y.deepEqual(c[f][m],h[f][m]))return!1;return!0}function ra(c,h,f,m,S,I){var P;for(P in h=h||{},c=c||{})c.hasOwnProperty(P)&&(y.deepEqual(c[P],h[P])||f.push({command:I,args:[m,P,h[P],S]}));for(P in h)h.hasOwnProperty(P)&&!c.hasOwnProperty(P)&&(y.deepEqual(c[P],h[P])||f.push({command:I,args:[m,P,h[P],S]}))}function ma(c){return c.id}function Ft(c,h){return c[h.id]=h,c}var Tt=function(c,h){this.reset(c,h)};Tt.prototype.reset=function(c,h){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Tt.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=y.clamp(c,0,1);for(var h=1,f=this._distances[h],m=c*this.paddedLength+this.padding;f<m&&h<this._distances.length;)f=this._distances[++h];var S=h-1,I=this._distances[S],P=f-I,B=P>0?(m-I)/P:0;return this.points[S].mult(1-B).add(this.points[h].mult(B))};var ea=function(c,h,f){var m=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(h/f);for(var I=0;I<this.xCellCount*this.yCellCount;I++)m.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function lo(c,h,f,m,S){var I=y.create();return h?(y.scale(I,I,[1/S,1/S,1]),f||y.rotateZ(I,I,m.angle)):y.multiply(I,m.labelPlaneMatrix,c),I}function Na(c,h,f,m,S){if(h){var I=y.clone(c);return y.scale(I,I,[S,S,1]),f||y.rotateZ(I,I,-m.angle),I}return m.glCoordMatrix}function ji(c,h){var f=[c.x,c.y,0,1];mo(f,f,h);var m=f[3];return{point:new y.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function Aa(c,h){return .5+c/h*.5}function Co(c,h){var f=c[0]/c[3],m=c[1]/c[3];return f>=-h[0]&&f<=h[0]&&m>=-h[1]&&m<=h[1]}function an(c,h,f,m,S,I,P,B){var Y=m?c.textSizeData:c.iconSizeData,te=y.evaluateSizeForZoom(Y,f.transform.zoom),xe=[256/f.width*2+1,256/f.height*2+1],Ce=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Ce.clear();for(var Me=c.lineVertexArray,et=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,Ne=f.transform.width/f.transform.height,ct=!1,je=0;je<et.length;je++){var ht=et.get(je);if(ht.hidden||ht.writingMode===y.WritingMode.vertical&&!ct)Oa(ht.numGlyphs,Ce);else{ct=!1;var Et=[ht.anchorX,ht.anchorY,0,1];if(y.transformMat4(Et,Et,h),Co(Et,xe)){var Wt=Aa(f.transform.cameraToCenterDistance,Et[3]),vr=y.evaluateSizeForFeature(Y,te,ht),rr=P?vr/Wt:vr*Wt,Ar=new y.Point(ht.anchorX,ht.anchorY),Xr=ji(Ar,S).point,bn={},pn=Ls(ht,rr,!1,B,h,S,I,c.glyphOffsetArray,Me,Ce,Xr,Ar,bn,Ne);ct=pn.useVertical,(pn.notEnoughRoom||ct||pn.needsFlipping&&Ls(ht,rr,!0,B,h,S,I,c.glyphOffsetArray,Me,Ce,Xr,Ar,bn,Ne).notEnoughRoom)&&Oa(ht.numGlyphs,Ce)}else Oa(ht.numGlyphs,Ce)}}m?c.text.dynamicLayoutVertexBuffer.updateData(Ce):c.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function Yr(c,h,f,m,S,I,P,B,Y,te,xe){var Ce=B.glyphStartIndex+B.numGlyphs,Me=B.lineStartIndex,et=B.lineStartIndex+B.lineLength,Ne=h.getoffsetX(B.glyphStartIndex),ct=h.getoffsetX(Ce-1),je=qi(c*Ne,f,m,S,I,P,B.segment,Me,et,Y,te,xe);if(!je)return null;var ht=qi(c*ct,f,m,S,I,P,B.segment,Me,et,Y,te,xe);return ht?{first:je,last:ht}:null}function bt(c,h,f,m){return c===y.WritingMode.horizontal&&Math.abs(f.y-h.y)>Math.abs(f.x-h.x)*m?{useVertical:!0}:(c===y.WritingMode.vertical?h.y<f.y:h.x>f.x)?{needsFlipping:!0}:null}function Ls(c,h,f,m,S,I,P,B,Y,te,xe,Ce,Me,et){var Ne,ct=h/24,je=c.lineOffsetX*ct,ht=c.lineOffsetY*ct;if(c.numGlyphs>1){var Et=c.glyphStartIndex+c.numGlyphs,Wt=c.lineStartIndex,vr=c.lineStartIndex+c.lineLength,rr=Yr(ct,B,je,ht,f,xe,Ce,c,Y,I,Me);if(!rr)return{notEnoughRoom:!0};var Ar=ji(rr.first.point,P).point,Xr=ji(rr.last.point,P).point;if(m&&!f){var bn=bt(c.writingMode,Ar,Xr,et);if(bn)return bn}Ne=[rr.first];for(var pn=c.glyphStartIndex+1;pn<Et-1;pn++)Ne.push(qi(ct*B.getoffsetX(pn),je,ht,f,xe,Ce,c.segment,Wt,vr,Y,I,Me));Ne.push(rr.last)}else{if(m&&!f){var Vn=ji(Ce,S).point,bi=c.lineStartIndex+c.segment+1,Ti=new y.Point(Y.getx(bi),Y.gety(bi)),Ai=ji(Ti,S),ba=Ai.signedDistanceFromCamera>0?Ai.point:Gt(Ce,Ti,Vn,1,S),Wn=bt(c.writingMode,Vn,ba,et);if(Wn)return Wn}var Wi=qi(ct*B.getoffsetX(c.glyphStartIndex),je,ht,f,xe,Ce,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,Y,I,Me);if(!Wi)return{notEnoughRoom:!0};Ne=[Wi]}for(var na=0,Xi=Ne;na<Xi.length;na+=1){var Pi=Xi[na];y.addDynamicAttributes(te,Pi.point,Pi.angle)}return{}}function Gt(c,h,f,m,S){var I=ji(c.add(c.sub(h)._unit()),S).point,P=f.sub(I);return f.add(P._mult(m/P.mag()))}function qi(c,h,f,m,S,I,P,B,Y,te,xe,Ce){var Me=m?c-h:c+h,et=Me>0?1:-1,Ne=0;m&&(et*=-1,Ne=Math.PI),et<0&&(Ne+=Math.PI);for(var ct=et>0?B+P:B+P+1,je=S,ht=S,Et=0,Wt=0,vr=Math.abs(Me),rr=[];Et+Wt<=vr;){if((ct+=et)<B||ct>=Y)return null;if(ht=je,rr.push(je),(je=Ce[ct])===void 0){var Ar=new y.Point(te.getx(ct),te.gety(ct)),Xr=ji(Ar,xe);if(Xr.signedDistanceFromCamera>0)je=Ce[ct]=Xr.point;else{var bn=ct-et;je=Gt(Et===0?I:new y.Point(te.getx(bn),te.gety(bn)),Ar,ht,vr-Et+1,xe)}}Et+=Wt,Wt=ht.dist(je)}var pn=(vr-Et)/Wt,Vn=je.sub(ht),bi=Vn.mult(pn)._add(ht);bi._add(Vn._unit()._perp()._mult(f*et));var Ti=Ne+Math.atan2(je.y-ht.y,je.x-ht.x);return rr.push(bi),{point:bi,angle:Ti,path:rr}}ea.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ea.prototype.insert=function(c,h,f,m,S){this._forEachCell(h,f,m,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(S)},ea.prototype.insertCircle=function(c,h,f,m){this._forEachCell(h-m,f-m,h+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(f),this.circles.push(m)},ea.prototype._insertBoxCell=function(c,h,f,m,S,I){this.boxCells[S].push(I)},ea.prototype._insertCircleCell=function(c,h,f,m,S,I){this.circleCells[S].push(I)},ea.prototype._query=function(c,h,f,m,S,I){if(f<0||c>this.width||m<0||h>this.height)return!S&&[];var P=[];if(c<=0&&h<=0&&this.width<=f&&this.height<=m){if(S)return!0;for(var B=0;B<this.boxKeys.length;B++)P.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var Y=0;Y<this.circleKeys.length;Y++){var te=this.circles[3*Y],xe=this.circles[3*Y+1],Ce=this.circles[3*Y+2];P.push({key:this.circleKeys[Y],x1:te-Ce,y1:xe-Ce,x2:te+Ce,y2:xe+Ce})}return I?P.filter(I):P}return this._forEachCell(c,h,f,m,this._queryCell,P,{hitTest:S,seenUids:{box:{},circle:{}}},I),S?P.length>0:P},ea.prototype._queryCircle=function(c,h,f,m,S){var I=c-f,P=c+f,B=h-f,Y=h+f;if(P<0||I>this.width||Y<0||B>this.height)return!m&&[];var te=[];return this._forEachCell(I,B,P,Y,this._queryCellCircle,te,{hitTest:m,circle:{x:c,y:h,radius:f},seenUids:{box:{},circle:{}}},S),m?te.length>0:te},ea.prototype.query=function(c,h,f,m,S){return this._query(c,h,f,m,!1,S)},ea.prototype.hitTest=function(c,h,f,m,S){return this._query(c,h,f,m,!0,S)},ea.prototype.hitTestCircle=function(c,h,f,m){return this._queryCircle(c,h,f,!0,m)},ea.prototype._queryCell=function(c,h,f,m,S,I,P,B){var Y=P.seenUids,te=this.boxCells[S];if(te!==null)for(var xe=this.bboxes,Ce=0,Me=te;Ce<Me.length;Ce+=1){var et=Me[Ce];if(!Y.box[et]){Y.box[et]=!0;var Ne=4*et;if(c<=xe[Ne+2]&&h<=xe[Ne+3]&&f>=xe[Ne+0]&&m>=xe[Ne+1]&&(!B||B(this.boxKeys[et]))){if(P.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[et],x1:xe[Ne],y1:xe[Ne+1],x2:xe[Ne+2],y2:xe[Ne+3]})}}}var ct=this.circleCells[S];if(ct!==null)for(var je=this.circles,ht=0,Et=ct;ht<Et.length;ht+=1){var Wt=Et[ht];if(!Y.circle[Wt]){Y.circle[Wt]=!0;var vr=3*Wt;if(this._circleAndRectCollide(je[vr],je[vr+1],je[vr+2],c,h,f,m)&&(!B||B(this.circleKeys[Wt]))){if(P.hitTest)return I.push(!0),!0;var rr=je[vr],Ar=je[vr+1],Xr=je[vr+2];I.push({key:this.circleKeys[Wt],x1:rr-Xr,y1:Ar-Xr,x2:rr+Xr,y2:Ar+Xr})}}}},ea.prototype._queryCellCircle=function(c,h,f,m,S,I,P,B){var Y=P.circle,te=P.seenUids,xe=this.boxCells[S];if(xe!==null)for(var Ce=this.bboxes,Me=0,et=xe;Me<et.length;Me+=1){var Ne=et[Me];if(!te.box[Ne]){te.box[Ne]=!0;var ct=4*Ne;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,Ce[ct+0],Ce[ct+1],Ce[ct+2],Ce[ct+3])&&(!B||B(this.boxKeys[Ne])))return I.push(!0),!0}}var je=this.circleCells[S];if(je!==null)for(var ht=this.circles,Et=0,Wt=je;Et<Wt.length;Et+=1){var vr=Wt[Et];if(!te.circle[vr]){te.circle[vr]=!0;var rr=3*vr;if(this._circlesCollide(ht[rr],ht[rr+1],ht[rr+2],Y.x,Y.y,Y.radius)&&(!B||B(this.circleKeys[vr])))return I.push(!0),!0}}},ea.prototype._forEachCell=function(c,h,f,m,S,I,P,B){for(var Y=this._convertToXCellCoord(c),te=this._convertToYCellCoord(h),xe=this._convertToXCellCoord(f),Ce=this._convertToYCellCoord(m),Me=Y;Me<=xe;Me++)for(var et=te;et<=Ce;et++)if(S.call(this,c,h,f,m,this.xCellCount*et+Me,I,P,B))return},ea.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},ea.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},ea.prototype._circlesCollide=function(c,h,f,m,S,I){var P=m-c,B=S-h,Y=f+I;return Y*Y>P*P+B*B},ea.prototype._circleAndRectCollide=function(c,h,f,m,S,I,P){var B=(I-m)/2,Y=Math.abs(c-(m+B));if(Y>B+f)return!1;var te=(P-S)/2,xe=Math.abs(h-(S+te));if(xe>te+f)return!1;if(Y<=B||xe<=te)return!0;var Ce=Y-B,Me=xe-te;return Ce*Ce+Me*Me<=f*f};var Kl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(c,h){for(var f=0;f<c;f++){var m=h.length;h.resize(m+4),h.float32.set(Kl,3*m)}}function mo(c,h,f){var m=h[0],S=h[1];return c[0]=f[0]*m+f[4]*S+f[12],c[1]=f[1]*m+f[5]*S+f[13],c[3]=f[3]*m+f[7]*S+f[15],c}var Io=function(c,h,f){h===void 0&&(h=new ea(c.width+200,c.height+200,25)),f===void 0&&(f=new ea(c.width+200,c.height+200,25)),this.transform=c,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function xa(c,h,f){return h*(y.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Io.prototype.placeCollisionBox=function(c,h,f,m,S){var I=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),P=f*I.perspectiveRatio,B=c.x1*P+I.point.x,Y=c.y1*P+I.point.y,te=c.x2*P+I.point.x,xe=c.y2*P+I.point.y;return!this.isInsideGrid(B,Y,te,xe)||!h&&this.grid.hitTest(B,Y,te,xe,S)?{box:[],offscreen:!1}:{box:[B,Y,te,xe],offscreen:this.isOffscreen(B,Y,te,xe)}},Io.prototype.placeCollisionCircles=function(c,h,f,m,S,I,P,B,Y,te,xe,Ce,Me){var et=[],Ne=new y.Point(h.anchorX,h.anchorY),ct=ji(Ne,I),je=Aa(this.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),ht=(te?S/je:S*je)/y.ONE_EM,Et=ji(Ne,P).point,Wt=Yr(ht,m,h.lineOffsetX*ht,h.lineOffsetY*ht,!1,Et,Ne,h,f,P,{}),vr=!1,rr=!1,Ar=!0;if(Wt){for(var Xr=.5*Ce*je+Me,bn=new y.Point(-100,-100),pn=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Vn=new Tt,bi=Wt.first,Ti=Wt.last,Ai=[],ba=bi.path.length-1;ba>=1;ba--)Ai.push(bi.path[ba]);for(var Wn=1;Wn<Ti.path.length;Wn++)Ai.push(Ti.path[Wn]);var Wi=2.5*Xr;if(B){var na=Ai.map(function(Ou){return ji(Ou,B)});Ai=na.some(function(Ou){return Ou.signedDistanceFromCamera<=0})?[]:na.map(function(Ou){return Ou.point})}var Xi=[];if(Ai.length>0){for(var Pi=Ai[0].clone(),ia=Ai[0].clone(),zi=1;zi<Ai.length;zi++)Pi.x=Math.min(Pi.x,Ai[zi].x),Pi.y=Math.min(Pi.y,Ai[zi].y),ia.x=Math.max(ia.x,Ai[zi].x),ia.y=Math.max(ia.y,Ai[zi].y);Xi=Pi.x>=bn.x&&ia.x<=pn.x&&Pi.y>=bn.y&&ia.y<=pn.y?[Ai]:ia.x<bn.x||Pi.x>pn.x||ia.y<bn.y||Pi.y>pn.y?[]:y.clipLine([Ai],bn.x,bn.y,pn.x,pn.y)}for(var Li=0,vs=Xi;Li<vs.length;Li+=1){var fo;Vn.reset(vs[Li],.25*Xr),fo=Vn.length<=.5*Xr?1:Math.ceil(Vn.paddedLength/Wi)+1;for(var Ho=0;Ho<fo;Ho++){var Us=Ho/Math.max(fo-1,1),Bo=Vn.lerp(Us),Wo=Bo.x+100,ou=Bo.y+100;et.push(Wo,ou,Xr,0);var su=Wo-Xr,Ms=ou-Xr,ms=Wo+Xr,Vl=ou+Xr;if(Ar=Ar&&this.isOffscreen(su,Ms,ms,Vl),rr=rr||this.isInsideGrid(su,Ms,ms,Vl),!c&&this.grid.hitTestCircle(Wo,ou,Xr,xe)&&(vr=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:vr}}}}return{circles:!Y&&vr||!rr?[]:et,offscreen:Ar,collisionDetected:vr}},Io.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],f=1/0,m=1/0,S=-1/0,I=-1/0,P=0,B=c;P<B.length;P+=1){var Y=B[P],te=new y.Point(Y.x+100,Y.y+100);f=Math.min(f,te.x),m=Math.min(m,te.y),S=Math.max(S,te.x),I=Math.max(I,te.y),h.push(te)}for(var xe={},Ce={},Me=0,et=this.grid.query(f,m,S,I).concat(this.ignoredGrid.query(f,m,S,I));Me<et.length;Me+=1){var Ne=et[Me],ct=Ne.key;if(xe[ct.bucketInstanceId]===void 0&&(xe[ct.bucketInstanceId]={}),!xe[ct.bucketInstanceId][ct.featureIndex]){var je=[new y.Point(Ne.x1,Ne.y1),new y.Point(Ne.x2,Ne.y1),new y.Point(Ne.x2,Ne.y2),new y.Point(Ne.x1,Ne.y2)];y.polygonIntersectsPolygon(h,je)&&(xe[ct.bucketInstanceId][ct.featureIndex]=!0,Ce[ct.bucketInstanceId]===void 0&&(Ce[ct.bucketInstanceId]=[]),Ce[ct.bucketInstanceId].push(ct.featureIndex))}}return Ce},Io.prototype.insertCollisionBox=function(c,h,f,m,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:S},c[0],c[1],c[2],c[3])},Io.prototype.insertCollisionCircles=function(c,h,f,m,S){for(var I=h?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:m,collisionGroupID:S},B=0;B<c.length;B+=4)I.insertCircle(P,c[B],c[B+1],c[B+2])},Io.prototype.projectAndGetPerspectiveRatio=function(c,h,f){var m=[h,f,0,1];return mo(m,m,c),{point:new y.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Io.prototype.isOffscreen=function(c,h,f,m){return f<100||c>=this.screenRightBoundary||m<100||h>this.screenBottomBoundary},Io.prototype.isInsideGrid=function(c,h,f,m){return f>=0&&c<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary},Io.prototype.getViewportMatrix=function(){var c=y.identity([]);return y.translate(c,c,[-100,-100,0]),c};var Os=function(c,h,f,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):m&&f?1:0,this.placed=f};Os.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Fs=function(c,h,f,m,S){this.text=new Os(c?c.text:null,h,f,S),this.icon=new Os(c?c.icon:null,h,m,S)};Fs.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ql=function(c,h,f){this.text=c,this.icon=h,this.skipFade=f},So=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},As=function(c,h,f,m,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=S},Ka=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Oo(c,h,f,m,S){var I=y.getAnchorAlignment(c),P=-(I.horizontalAlign-.5)*h,B=-(I.verticalAlign-.5)*f,Y=y.evaluateVariableOffset(c,m);return new y.Point(P+Y[0]*S,B+Y[1]*S)}function ws(c,h,f,m,S,I){var P=c.x1,B=c.x2,Y=c.y1,te=c.y2,xe=c.anchorPointX,Ce=c.anchorPointY,Me=new y.Point(h,f);return m&&Me._rotate(S?I:-I),{x1:P+Me.x,y1:Y+Me.y,x2:B+Me.x,y2:te+Me.y,anchorPointX:xe,anchorPointY:Ce}}Ka.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:function(f){return f.collisionGroupID===h}}}return this.collisionGroups[c]};var ko=function(c,h,f,m){this.transform=c.clone(),this.collisionIndex=new Io(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Ka(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function Yu(c,h,f,m,S){c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0)}ko.prototype.getBucketParts=function(c,h,f,m){var S=f.getBucket(h),I=f.latestFeatureIndex;if(S&&I&&h.id===S.layerIds[0]){var P=f.collisionBoxArray,B=S.layers[0].layout,Y=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),te=f.tileSize/y.EXTENT,xe=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Ce=B.get("text-pitch-alignment")==="map",Me=B.get("text-rotation-alignment")==="map",et=xa(f,1,this.transform.zoom),Ne=lo(xe,Ce,Me,this.transform,et),ct=null;if(Ce){var je=Na(xe,Ce,Me,this.transform,et);ct=y.multiply([],this.transform.labelPlaneMatrix,je)}this.retainedQueryData[S.bucketInstanceId]=new As(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,f.tileID);var ht={bucket:S,layout:B,posMatrix:xe,textLabelPlaneMatrix:Ne,labelToScreenMatrix:ct,scale:Y,textPixelRatio:te,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(m)for(var Et=0,Wt=S.sortKeyRanges;Et<Wt.length;Et+=1){var vr=Wt[Et];c.push({sortKey:vr.sortKey,symbolInstanceStart:vr.symbolInstanceStart,symbolInstanceEnd:vr.symbolInstanceEnd,parameters:ht})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ht})}},ko.prototype.attemptAnchorPlacement=function(c,h,f,m,S,I,P,B,Y,te,xe,Ce,Me,et,Ne){var ct,je=[Ce.textOffset0,Ce.textOffset1],ht=Oo(c,f,m,je,S),Et=this.collisionIndex.placeCollisionBox(ws(h,ht.x,ht.y,I,P,this.transform.angle),xe,B,Y,te.predicate);if(!Ne||this.collisionIndex.placeCollisionBox(ws(Ne,ht.x,ht.y,I,P,this.transform.angle),xe,B,Y,te.predicate).box.length!==0)return Et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ce.crossTileID]&&this.prevPlacement.placements[Ce.crossTileID]&&this.prevPlacement.placements[Ce.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[Ce.crossTileID].anchor),this.variableOffsets[Ce.crossTileID]={textOffset:je,width:f,height:m,anchor:c,textBoxScale:S,prevAnchor:ct},this.markUsedJustification(Me,c,Ce,et),Me.allowVerticalPlacement&&(this.markUsedOrientation(Me,et,Ce),this.placedOrientations[Ce.crossTileID]=et),{shift:ht,placedGlyphBoxes:Et}):void 0},ko.prototype.placeLayerBucketPart=function(c,h,f){var m=this,S=c.parameters,I=S.bucket,P=S.layout,B=S.posMatrix,Y=S.textLabelPlaneMatrix,te=S.labelToScreenMatrix,xe=S.textPixelRatio,Ce=S.holdingForFade,Me=S.collisionBoxArray,et=S.partiallyEvaluatedTextSize,Ne=S.collisionGroup,ct=P.get("text-optional"),je=P.get("icon-optional"),ht=P.get("text-allow-overlap"),Et=P.get("icon-allow-overlap"),Wt=P.get("text-rotation-alignment")==="map",vr=P.get("text-pitch-alignment")==="map",rr=P.get("icon-text-fit")!=="none",Ar=P.get("symbol-z-order")==="viewport-y",Xr=ht&&(Et||!I.hasIconData()||je),bn=Et&&(ht||!I.hasTextData()||ct);!I.collisionArrays&&Me&&I.deserializeCollisionBoxes(Me);var pn=function(Wn,Wi){if(!h[Wn.crossTileID])if(Ce)m.placements[Wn.crossTileID]=new Ql(!1,!1,!1);else{var na,Xi=!1,Pi=!1,ia=!0,zi=null,Li={box:null,offscreen:null},vs={box:null,offscreen:null},fo=null,Ho=null,Us=0,Bo=0,Wo=0;Wi.textFeatureIndex?Us=Wi.textFeatureIndex:Wn.useRuntimeCollisionCircles&&(Us=Wn.featureIndex),Wi.verticalTextFeatureIndex&&(Bo=Wi.verticalTextFeatureIndex);var ou=Wi.textBox;if(ou){var su=function(Va){var _u=y.WritingMode.horizontal;if(I.allowVerticalPlacement&&!Va&&m.prevPlacement){var lu=m.prevPlacement.placedOrientations[Wn.crossTileID];lu&&(m.placedOrientations[Wn.crossTileID]=lu,m.markUsedOrientation(I,_u=lu,Wn))}return _u},Ms=function(Va,_u){if(I.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Wi.verticalTextBox)for(var lu=0,Cc=I.writingModes;lu<Cc.length&&(Cc[lu]===y.WritingMode.vertical?(Li=_u(),vs=Li):Li=Va(),!(Li&&Li.box&&Li.box.length));lu+=1);else Li=Va()};if(P.get("text-variable-anchor")){var ms=P.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[Wn.crossTileID]){var Vl=m.prevPlacement.variableOffsets[Wn.crossTileID];ms.indexOf(Vl.anchor)>0&&(ms=ms.filter(function(Va){return Va!==Vl.anchor})).unshift(Vl.anchor)}var Ou=function(Va,_u,lu){for(var Cc=Va.x2-Va.x1,_h=Va.y2-Va.y1,Sf=Wn.textBoxScale,Xc=rr&&!Et?_u:null,Ks={box:[],offscreen:!1},xh=ht?2*ms.length:ms.length,tl=0;tl<xh;++tl){var Yc=m.attemptAnchorPlacement(ms[tl%ms.length],Va,Cc,_h,Sf,Wt,vr,xe,B,Ne,tl>=ms.length,Wn,I,lu,Xc);if(Yc&&(Ks=Yc.placedGlyphBoxes)&&Ks.box&&Ks.box.length){Xi=!0,zi=Yc.shift;break}}return Ks};Ms(function(){return Ou(ou,Wi.iconBox,y.WritingMode.horizontal)},function(){var Va=Wi.verticalTextBox;return I.allowVerticalPlacement&&!(Li&&Li.box&&Li.box.length)&&Wn.numVerticalGlyphVertices>0&&Va?Ou(Va,Wi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Li&&(Xi=Li.box,ia=Li.offscreen);var Cf=su(Li&&Li.box);if(!Xi&&m.prevPlacement){var Ml=m.prevPlacement.variableOffsets[Wn.crossTileID];Ml&&(m.variableOffsets[Wn.crossTileID]=Ml,m.markUsedJustification(I,Ml.anchor,Wn,Cf))}}else{var Il=function(Va,_u){var lu=m.collisionIndex.placeCollisionBox(Va,ht,xe,B,Ne.predicate);return lu&&lu.box&&lu.box.length&&(m.markUsedOrientation(I,_u,Wn),m.placedOrientations[Wn.crossTileID]=_u),lu};Ms(function(){return Il(ou,y.WritingMode.horizontal)},function(){var Va=Wi.verticalTextBox;return I.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Va?Il(Va,y.WritingMode.vertical):{box:null,offscreen:null}}),su(Li&&Li.box&&Li.box.length)}}if(Xi=(na=Li)&&na.box&&na.box.length>0,ia=na&&na.offscreen,Wn.useRuntimeCollisionCircles){var Ec=I.text.placedSymbolArray.get(Wn.centerJustifiedTextSymbolIndex),Hc=y.evaluateSizeForFeature(I.textSizeData,et,Ec),jl=P.get("text-padding");fo=m.collisionIndex.placeCollisionCircles(ht,Ec,I.lineVertexArray,I.glyphOffsetArray,Hc,B,Y,te,f,vr,Ne.predicate,Wn.collisionCircleDiameter,jl),Xi=ht||fo.circles.length>0&&!fo.collisionDetected,ia=ia&&fo.offscreen}if(Wi.iconFeatureIndex&&(Wo=Wi.iconFeatureIndex),Wi.iconBox){var Wc=function(Va){var _u=rr&&zi?ws(Va,zi.x,zi.y,Wt,vr,m.transform.angle):Va;return m.collisionIndex.placeCollisionBox(_u,Et,xe,B,Ne.predicate)};Pi=vs&&vs.box&&vs.box.length&&Wi.verticalIconBox?(Ho=Wc(Wi.verticalIconBox)).box.length>0:(Ho=Wc(Wi.iconBox)).box.length>0,ia=ia&&Ho.offscreen}var gl=ct||Wn.numHorizontalGlyphVertices===0&&Wn.numVerticalGlyphVertices===0,gs=je||Wn.numIconVertices===0;if(gl||gs?gs?gl||(Pi=Pi&&Xi):Xi=Pi&&Xi:Pi=Xi=Pi&&Xi,Xi&&na&&na.box&&m.collisionIndex.insertCollisionBox(na.box,P.get("text-ignore-placement"),I.bucketInstanceId,vs&&vs.box&&Bo?Bo:Us,Ne.ID),Pi&&Ho&&m.collisionIndex.insertCollisionBox(Ho.box,P.get("icon-ignore-placement"),I.bucketInstanceId,Wo,Ne.ID),fo&&(Xi&&m.collisionIndex.insertCollisionCircles(fo.circles,P.get("text-ignore-placement"),I.bucketInstanceId,Us,Ne.ID),f)){var uu=I.bucketInstanceId,Gl=m.collisionCircleArrays[uu];Gl===void 0&&(Gl=m.collisionCircleArrays[uu]=new So);for(var ic=0;ic<fo.circles.length;ic+=4)Gl.circles.push(fo.circles[ic+0]),Gl.circles.push(fo.circles[ic+1]),Gl.circles.push(fo.circles[ic+2]),Gl.circles.push(fo.collisionDetected?1:0)}m.placements[Wn.crossTileID]=new Ql(Xi||Xr,Pi||bn,ia||I.justReloaded),h[Wn.crossTileID]=!0}};if(Ar)for(var Vn=I.getSortedSymbolIndexes(this.transform.angle),bi=Vn.length-1;bi>=0;--bi){var Ti=Vn[bi];pn(I.symbolInstances.get(Ti),I.collisionArrays[Ti])}else for(var Ai=c.symbolInstanceStart;Ai<c.symbolInstanceEnd;Ai++)pn(I.symbolInstances.get(Ai),I.collisionArrays[Ai]);if(f&&I.bucketInstanceId in this.collisionCircleArrays){var ba=this.collisionCircleArrays[I.bucketInstanceId];y.invert(ba.invProjMatrix,B),ba.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1},ko.prototype.markUsedJustification=function(c,h,f,m){var S;S=m===y.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(h)];for(var I=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];I<P.length;I+=1){var B=P[I];B>=0&&(c.text.placedSymbolArray.get(B).crossTileID=S>=0&&B!==S?0:f.crossTileID)}},ko.prototype.markUsedOrientation=function(c,h,f){for(var m=h===y.WritingMode.horizontal||h===y.WritingMode.horizontalOnly?h:0,S=h===y.WritingMode.vertical?h:0,I=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];I<P.length;I+=1)c.text.placedSymbolArray.get(P[I]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},ko.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var m=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},I=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var B in this.placements){var Y=this.placements[B],te=S[B];te?(this.opacities[B]=new Fs(te,m,Y.text,Y.icon),f=f||Y.text!==te.text.placed||Y.icon!==te.icon.placed):(this.opacities[B]=new Fs(null,m,Y.text,Y.icon,Y.skipFade),f=f||Y.text||Y.icon)}for(var xe in S){var Ce=S[xe];if(!this.opacities[xe]){var Me=new Fs(Ce,m,!1,!1);Me.isHidden()||(this.opacities[xe]=Me,f=f||Ce.text.placed||Ce.icon.placed)}}for(var et in I)this.variableOffsets[et]||!this.opacities[et]||this.opacities[et].isHidden()||(this.variableOffsets[et]=I[et]);for(var Ne in P)this.placedOrientations[Ne]||!this.opacities[Ne]||this.opacities[Ne].isHidden()||(this.placedOrientations[Ne]=P[Ne]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)},ko.prototype.updateLayerOpacities=function(c,h){for(var f={},m=0,S=h;m<S.length;m+=1){var I=S[m],P=I.getBucket(c);P&&I.latestFeatureIndex&&c.id===P.layerIds[0]&&this.updateBucketOpacities(P,f,I.collisionBoxArray)}},ko.prototype.updateBucketOpacities=function(c,h,f){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,I=new Fs(null,0,!1,!1,!0),P=S.get("text-allow-overlap"),B=S.get("icon-allow-overlap"),Y=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",xe=S.get("text-pitch-alignment")==="map",Ce=S.get("icon-text-fit")!=="none",Me=new Fs(null,0,P&&(B||!c.hasIconData()||S.get("icon-optional")),B&&(P||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var et=function(ht,Et,Wt){for(var vr=0;vr<Et/4;vr++)ht.opacityVertexArray.emplaceBack(Wt)},Ne=function(ht){var Et=c.symbolInstances.get(ht),Wt=Et.numHorizontalGlyphVertices,vr=Et.numVerticalGlyphVertices,rr=Et.crossTileID,Ar=m.opacities[rr];h[rr]?Ar=I:Ar||(m.opacities[rr]=Ar=Me),h[rr]=!0;var Xr=Et.numIconVertices>0,bn=m.placedOrientations[Et.crossTileID],pn=bn===y.WritingMode.vertical,Vn=bn===y.WritingMode.horizontal||bn===y.WritingMode.horizontalOnly;if(Wt>0||vr>0){var bi=Qn(Ar.text);et(c.text,Wt,pn?ya:bi),et(c.text,vr,Vn?ya:bi);var Ti=Ar.text.isHidden();[Et.rightJustifiedTextSymbolIndex,Et.centerJustifiedTextSymbolIndex,Et.leftJustifiedTextSymbolIndex].forEach(function(Li){Li>=0&&(c.text.placedSymbolArray.get(Li).hidden=Ti||pn?1:0)}),Et.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Et.verticalPlacedTextSymbolIndex).hidden=Ti||Vn?1:0);var Ai=m.variableOffsets[Et.crossTileID];Ai&&m.markUsedJustification(c,Ai.anchor,Et,bn);var ba=m.placedOrientations[Et.crossTileID];ba&&(m.markUsedJustification(c,"left",Et,ba),m.markUsedOrientation(c,ba,Et))}if(Xr){var Wn=Qn(Ar.icon),Wi=!(Ce&&Et.verticalPlacedIconSymbolIndex&&pn);Et.placedIconSymbolIndex>=0&&(et(c.icon,Et.numIconVertices,Wi?Wn:ya),c.icon.placedSymbolArray.get(Et.placedIconSymbolIndex).hidden=Ar.icon.isHidden()),Et.verticalPlacedIconSymbolIndex>=0&&(et(c.icon,Et.numVerticalIconVertices,Wi?ya:Wn),c.icon.placedSymbolArray.get(Et.verticalPlacedIconSymbolIndex).hidden=Ar.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var na=c.collisionArrays[ht];if(na){var Xi=new y.Point(0,0);if(na.textBox||na.verticalTextBox){var Pi=!0;if(Y){var ia=m.variableOffsets[rr];ia?(Xi=Oo(ia.anchor,ia.width,ia.height,ia.textOffset,ia.textBoxScale),te&&Xi._rotate(xe?m.transform.angle:-m.transform.angle)):Pi=!1}na.textBox&&Yu(c.textCollisionBox.collisionVertexArray,Ar.text.placed,!Pi||pn,Xi.x,Xi.y),na.verticalTextBox&&Yu(c.textCollisionBox.collisionVertexArray,Ar.text.placed,!Pi||Vn,Xi.x,Xi.y)}var zi=Boolean(!Vn&&na.verticalIconBox);na.iconBox&&Yu(c.iconCollisionBox.collisionVertexArray,Ar.icon.placed,zi,Ce?Xi.x:0,Ce?Xi.y:0),na.verticalIconBox&&Yu(c.iconCollisionBox.collisionVertexArray,Ar.icon.placed,!zi,Ce?Xi.x:0,Ce?Xi.y:0)}}},ct=0;ct<c.symbolInstances.length;ct++)Ne(ct);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var je=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=je.invProjMatrix,c.placementViewportMatrix=je.viewportMatrix,c.collisionCircleArray=je.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},ko.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ko.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},ko.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},ko.prototype.stillRecent=function(c,h){var f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>c},ko.prototype.setStale=function(){this.stale=!0};var ul=Math.pow(2,25),rs=Math.pow(2,24),ve=Math.pow(2,17),De=Math.pow(2,16),mt=Math.pow(2,9),ir=Math.pow(2,8),yn=Math.pow(2,1);function Qn(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var h=c.placed?1:0,f=Math.floor(127*c.opacity);return f*ul+h*rs+f*ve+h*De+f*mt+h*ir+f*yn+h}var ya=0,qo=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};qo.prototype.continuePlacement=function(c,h,f,m,S){for(var I=this._bucketParts;this._currentTileIndex<c.length;)if(h.getBucketParts(I,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(function(P,B){return P.sortKey-B.sortKey}));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Fa=function(c,h,f,m,S,I,P){this.placement=new ko(c,S,I,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};Fa.prototype.isDone=function(){return this._done},Fa.prototype.continuePlacement=function(c,h,f){for(var m=this,S=y.browser.now(),I=function(){var Y=y.browser.now()-S;return!m._forceFullPlacement&&Y>2};this._currentPlacementIndex>=0;){var P=h[c[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=B)&&(!P.maxzoom||P.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new qo(P)),this._inProgressLayer.continuePlacement(f[P.source],this.placement,this._showCollisionBoxes,P,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Fa.prototype.commit=function(c){return this.placement.commit(c),this.placement};var Fo=512/y.EXTENT/2,Zo=function(c,h,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<h.length;m++){var S=h.get(m),I=S.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};Zo.prototype.getScaledCoordinates=function(c,h){var f=Fo/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*y.EXTENT+c.anchorX)*f),y:Math.floor((h.canonical.y*y.EXTENT+c.anchorY)*f)}},Zo.prototype.findMatches=function(c,h,f){for(var m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=0;S<c.length;S++){var I=c.get(S);if(!I.crossTileID){var P=this.indexedSymbolInstances[I.key];if(P)for(var B=this.getScaledCoordinates(I,h),Y=0,te=P;Y<te.length;Y+=1){var xe=te[Y];if(Math.abs(xe.coord.x-B.x)<=m&&Math.abs(xe.coord.y-B.y)<=m&&!f[xe.crossTileID]){f[xe.crossTileID]=!0,I.crossTileID=xe.crossTileID;break}}}}};var To=function(){this.maxCrossTileID=0};To.prototype.generate=function(){return++this.maxCrossTileID};var Ds=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ds.prototype.handleWrapJump=function(c){var h=Math.round((c-this.lng)/360);if(h!==0)for(var f in this.indexes){var m=this.indexes[f],S={};for(var I in m){var P=m[I];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),S[P.tileID.key]=P}this.indexes[f]=S}this.lng=c},Ds.prototype.addBucket=function(c,h,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<h.symbolInstances.length;m++)h.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var I in this.indexes){var P=this.indexes[I];if(Number(I)>c.overscaledZ)for(var B in P){var Y=P[B];Y.tileID.isChildOf(c)&&Y.findMatches(h.symbolInstances,c,S)}else{var te=P[c.scaledTo(Number(I)).key];te&&te.findMatches(h.symbolInstances,c,S)}}for(var xe=0;xe<h.symbolInstances.length;xe++){var Ce=h.symbolInstances.get(xe);Ce.crossTileID||(Ce.crossTileID=f.generate(),S[Ce.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Zo(c,h.symbolInstances,h.bucketInstanceId),!0},Ds.prototype.removeBucketCrossTileIDs=function(c,h){for(var f in h.indexedSymbolInstances)for(var m=0,S=h.indexedSymbolInstances[f];m<S.length;m+=1)delete this.usedCrossTileIDs[c][S[m].crossTileID]},Ds.prototype.removeStaleBuckets=function(c){var h=!1;for(var f in this.indexes){var m=this.indexes[f];for(var S in m)c[m[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[S]),delete m[S],h=!0)}return h};var cs=function(){this.layerIndexes={},this.crossTileIDs=new To,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};cs.prototype.addLayer=function(c,h,f){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Ds);var S=!1,I={};m.handleWrapJump(f);for(var P=0,B=h;P<B.length;P+=1){var Y=B[P],te=Y.getBucket(c);te&&c.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(Y.tileID,te,this.crossTileIDs)&&(S=!0),I[te.bucketInstanceId]=!0)}return m.removeStaleBuckets(I)&&(S=!0),S},cs.prototype.pruneUnusedLayers=function(c){var h={};for(var f in c.forEach(function(m){h[m]=!0}),this.layerIndexes)h[f]||delete this.layerIndexes[f]};var Ts=function(c,h){return y.emitValidationErrors(c,h&&h.filter(function(f){return f.identifier!=="source.canvas"}))},Eu=y.pick(Mn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),qu=y.pick(Mn,["setCenter","setZoom","setBearing","setPitch"]),Cu=function(){var c={},h=y.styleSpec.$version;for(var f in y.styleSpec.$root){var m,S=y.styleSpec.$root[f];S.required&&(m=f==="version"?h:S.type==="array"?[]:{})!=null&&(c[f]=m)}return c}(),Su=function(c){function h(f,m){var S=this;m===void 0&&(m={}),c.call(this),this.map=f,this.dispatcher=new Cr(er(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new _r(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new Ue(256,512),this.crossTileSymbolIndex=new cs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var I=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){I.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(B,Y){if(y.triggerPluginCompletionEvent(B),Y&&Y.every(function(xe){return xe}))for(var te in I.sourceCaches)I.sourceCaches[te].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var B=S.sourceCaches[P.sourceId];if(B){var Y=B.getSource();if(Y&&Y.vectorLayerIds)for(var te in S._layers){var xe=S._layers[te];xe.source===Y.id&&S._validateLayer(xe)}}}})}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.loadURL=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var I=typeof m.validate=="boolean"?m.validate:!y.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var P=this.map._requestManager.transformRequest(f,y.ResourceType.Style);this._request=y.getJSON(P,function(B,Y){S._request=null,B?S.fire(new y.ErrorEvent(B)):Y&&S._load(Y,I)})},h.prototype.loadJSON=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(f,m.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Cu,!1)},h.prototype._load=function(f,m){if(!m||!Ts(this,y.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var I=Tn(this.stylesheet.layers);this._order=I.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var P=0,B=I;P<B.length;P+=1){var Y=B[P];(Y=y.createStyleLayer(Y)).setEventedParent(this,{layer:{id:Y.id}}),this._layers[Y.id]=Y,this._serializedLayers[Y.id]=Y.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},h.prototype._loadSprite=function(f){var m=this;this._spriteRequest=function(S,I,P){var B,Y,te,xe=y.browser.devicePixelRatio>1?"@2x":"",Ce=y.getJSON(I.transformRequest(I.normalizeSpriteURL(S,xe,".json"),y.ResourceType.SpriteJSON),function(Ne,ct){Ce=null,te||(te=Ne,B=ct,et())}),Me=y.getImage(I.transformRequest(I.normalizeSpriteURL(S,xe,".png"),y.ResourceType.SpriteImage),function(Ne,ct){Me=null,te||(te=Ne,Y=ct,et())});function et(){if(te)P(te);else if(B&&Y){var Ne=y.browser.getImageData(Y),ct={};for(var je in B){var ht=B[je],Et=ht.width,Wt=ht.height,vr=ht.x,rr=ht.y,Ar=ht.sdf,Xr=ht.pixelRatio,bn=ht.stretchX,pn=ht.stretchY,Vn=ht.content,bi=new y.RGBAImage({width:Et,height:Wt});y.RGBAImage.copy(Ne,bi,{x:vr,y:rr},{x:0,y:0},{width:Et,height:Wt}),ct[je]={data:bi,pixelRatio:Xr,sdf:Ar,stretchX:bn,stretchY:pn,content:Vn}}P(null,ct)}}return{cancel:function(){Ce&&(Ce.cancel(),Ce=null),Me&&(Me.cancel(),Me=null)}}}(f,this.map._requestManager,function(S,I){if(m._spriteRequest=null,S)m.fire(new y.ErrorEvent(S));else if(I)for(var P in I)m.imageManager.addImage(P,I[P]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new y.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var S=f.sourceLayer;if(S){var I=m.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+I.id+'" as specified by style layer "'+f.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(f){for(var m=[],S=0,I=f;S<I.length;S+=1){var P=this._layers[I[S]];P.type!=="custom"&&m.push(P.serialize())}return m},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);for(var P in(S.length||I.length)&&this._updateWorkerLayers(S,I),this._updatedSources){var B=this._updatedSources[P];B==="reload"?this._reloadSource(P):B==="clear"&&this._clearSource(P)}for(var Y in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Y].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var te={};for(var xe in this.sourceCaches){var Ce=this.sourceCaches[xe];te[xe]=Ce.used,Ce.used=!1}for(var Me=0,et=this._order;Me<et.length;Me+=1){var Ne=this._layers[et[Me]];Ne.recalculate(f,this._availableImages),!Ne.isHidden(f.zoom)&&Ne.source&&(this.sourceCaches[Ne.source].used=!0)}for(var ct in te){var je=this.sourceCaches[ct];te[ct]!==je.used&&je.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ct}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new y.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},h.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(f){var m=this;if(this._checkLoaded(),Ts(this,y.validateStyle(f)))return!1;(f=y.clone$1(f)).layers=Tn(f.layers);var S=function(P,B){if(!P)return[{command:Mn.setStyle,args:[B]}];var Y=[];try{if(!y.deepEqual(P.version,B.version))return[{command:Mn.setStyle,args:[B]}];y.deepEqual(P.center,B.center)||Y.push({command:Mn.setCenter,args:[B.center]}),y.deepEqual(P.zoom,B.zoom)||Y.push({command:Mn.setZoom,args:[B.zoom]}),y.deepEqual(P.bearing,B.bearing)||Y.push({command:Mn.setBearing,args:[B.bearing]}),y.deepEqual(P.pitch,B.pitch)||Y.push({command:Mn.setPitch,args:[B.pitch]}),y.deepEqual(P.sprite,B.sprite)||Y.push({command:Mn.setSprite,args:[B.sprite]}),y.deepEqual(P.glyphs,B.glyphs)||Y.push({command:Mn.setGlyphs,args:[B.glyphs]}),y.deepEqual(P.transition,B.transition)||Y.push({command:Mn.setTransition,args:[B.transition]}),y.deepEqual(P.light,B.light)||Y.push({command:Mn.setLight,args:[B.light]});var te={},xe=[];(function(Me,et,Ne,ct){var je;for(je in et=et||{},Me=Me||{})Me.hasOwnProperty(je)&&(et.hasOwnProperty(je)||Pr(je,Ne,ct));for(je in et)et.hasOwnProperty(je)&&(Me.hasOwnProperty(je)?y.deepEqual(Me[je],et[je])||(Me[je].type==="geojson"&&et[je].type==="geojson"&&La(Me,et,je)?Ne.push({command:Mn.setGeoJSONSourceData,args:[je,et[je].data]}):$i(je,et,Ne,ct)):sa(je,et,Ne))})(P.sources,B.sources,xe,te);var Ce=[];P.layers&&P.layers.forEach(function(Me){te[Me.source]?Y.push({command:Mn.removeLayer,args:[Me.id]}):Ce.push(Me)}),Y=Y.concat(xe),function(Me,et,Ne){et=et||[];var ct,je,ht,Et,Wt,vr,rr,Ar=(Me=Me||[]).map(ma),Xr=et.map(ma),bn=Me.reduce(Ft,{}),pn=et.reduce(Ft,{}),Vn=Ar.slice(),bi=Object.create(null);for(ct=0,je=0;ct<Ar.length;ct++)pn.hasOwnProperty(ht=Ar[ct])?je++:(Ne.push({command:Mn.removeLayer,args:[ht]}),Vn.splice(Vn.indexOf(ht,je),1));for(ct=0,je=0;ct<Xr.length;ct++)Vn[Vn.length-1-ct]!==(ht=Xr[Xr.length-1-ct])&&(bn.hasOwnProperty(ht)?(Ne.push({command:Mn.removeLayer,args:[ht]}),Vn.splice(Vn.lastIndexOf(ht,Vn.length-je),1)):je++,Ne.push({command:Mn.addLayer,args:[pn[ht],vr=Vn[Vn.length-ct]]}),Vn.splice(Vn.length-ct,0,ht),bi[ht]=!0);for(ct=0;ct<Xr.length;ct++)if(Et=bn[ht=Xr[ct]],Wt=pn[ht],!bi[ht]&&!y.deepEqual(Et,Wt))if(y.deepEqual(Et.source,Wt.source)&&y.deepEqual(Et["source-layer"],Wt["source-layer"])&&y.deepEqual(Et.type,Wt.type)){for(rr in ra(Et.layout,Wt.layout,Ne,ht,null,Mn.setLayoutProperty),ra(Et.paint,Wt.paint,Ne,ht,null,Mn.setPaintProperty),y.deepEqual(Et.filter,Wt.filter)||Ne.push({command:Mn.setFilter,args:[ht,Wt.filter]}),y.deepEqual(Et.minzoom,Wt.minzoom)&&y.deepEqual(Et.maxzoom,Wt.maxzoom)||Ne.push({command:Mn.setLayerZoomRange,args:[ht,Wt.minzoom,Wt.maxzoom]}),Et)Et.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?ra(Et[rr],Wt[rr],Ne,ht,rr.slice(6),Mn.setPaintProperty):y.deepEqual(Et[rr],Wt[rr])||Ne.push({command:Mn.setLayerProperty,args:[ht,rr,Wt[rr]]}));for(rr in Wt)Wt.hasOwnProperty(rr)&&!Et.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?ra(Et[rr],Wt[rr],Ne,ht,rr.slice(6),Mn.setPaintProperty):y.deepEqual(Et[rr],Wt[rr])||Ne.push({command:Mn.setLayerProperty,args:[ht,rr,Wt[rr]]}))}else Ne.push({command:Mn.removeLayer,args:[ht]}),vr=Vn[Vn.lastIndexOf(ht)+1],Ne.push({command:Mn.addLayer,args:[Wt,vr]})}(Ce,B.layers,Y)}catch(Me){console.warn("Unable to compute style diff:",Me),Y=[{command:Mn.setStyle,args:[B]}]}return Y}(this.serialize(),f).filter(function(P){return!(P.command in qu)});if(S.length===0)return!1;var I=S.filter(function(P){return!(P.command in Eu)});if(I.length>0)throw new Error("Unimplemented: "+I.map(function(P){return P.command}).join(", ")+".");return S.forEach(function(P){P.command!=="setTransition"&&m[P.command].apply(m,P.args)}),this.stylesheet=f,!0},h.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},h.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},h.prototype.getImage=function(f){return this.imageManager.getImage(f)},h.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},h.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(f,m,S){var I=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(y.validateStyle.source,"sources."+f,m,null,S))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var P=this.sourceCaches[f]=new rt(f,m,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:I.loaded(),source:P.serialize(),sourceId:f}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new y.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},h.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},h.prototype.addLayer=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var I=f.id;if(this.getLayer(I))this.fire(new y.ErrorEvent(new Error('Layer with id "'+I+'" already exists on this map')));else{var P;if(f.type==="custom"){if(Ts(this,y.validateCustomStyleLayer(f)))return;P=y.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(I,f.source),f=y.clone$1(f),f=y.extend(f,{source:I})),this._validate(y.validateStyle.layer,"layers."+I,f,{arrayIndex:-1},S))return;P=y.createStyleLayer(f),this._validateLayer(P),P.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[P.id]=P.serialize()}var B=m?this._order.indexOf(m):this._order.length;if(m&&B===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(B,0,I),this._layerOrderChanged=!0,this._layers[I]=P,this._removedLayers[I]&&P.source&&P.type!=="custom"){var Y=this._removedLayers[I];delete this._removedLayers[I],Y.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var S=this._order.indexOf(f);this._order.splice(S,1);var I=m?this._order.indexOf(m):this._order.length;m&&I===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(I,0,f),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(f){return this._layers[f]},h.prototype.hasLayer=function(f){return f in this._layers},h.prototype.setLayerZoomRange=function(f,m,S){this._checkLoaded();var I=this.getLayer(f);I?I.minzoom===m&&I.maxzoom===S||(m!=null&&(I.minzoom=m),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var I=this.getLayer(f);if(I){if(!y.deepEqual(I.filter,m))return m==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(y.validateStyle.filter,"layers."+I.id+".filter",m,null,S)||(I.filter=y.clone$1(m),this._updateLayer(I)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(f){return y.clone$1(this.getLayer(f).filter)},h.prototype.setLayoutProperty=function(f,m,S,I){I===void 0&&(I={}),this._checkLoaded();var P=this.getLayer(f);P?y.deepEqual(P.getLayoutProperty(m),S)||(P.setLayoutProperty(m,S,I),this._updateLayer(P)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(f,m){var S=this.getLayer(f);if(S)return S.getLayoutProperty(m);this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(f,m,S,I){I===void 0&&(I={}),this._checkLoaded();var P=this.getLayer(f);P?y.deepEqual(P.getPaintProperty(m),S)||(P.setPaintProperty(m,S,I)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},h.prototype.setFeatureState=function(f,m){this._checkLoaded();var S=f.source,I=f.sourceLayer,P=this.sourceCaches[S];if(P!==void 0){var B=P.getSource().type;B==="geojson"&&I?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||I?(f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(I,f.id,m)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(f,m){this._checkLoaded();var S=f.source,I=this.sourceCaches[S];if(I!==void 0){var P=I.getSource().type,B=P==="vector"?f.sourceLayer:void 0;P!=="vector"||B?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(B,f.id,m):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,S=f.sourceLayer,I=this.sourceCaches[m];if(I!==void 0){if(I.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,f.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},h.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,S=function(bn){return m._layers[bn].type==="fill-extrusion"},I={},P=[],B=this._order.length-1;B>=0;B--){var Y=this._order[B];if(S(Y)){I[Y]=B;for(var te=0,xe=f;te<xe.length;te+=1){var Ce=xe[te][Y];if(Ce)for(var Me=0,et=Ce;Me<et.length;Me+=1)P.push(et[Me])}}}P.sort(function(bn,pn){return pn.intersectionZ-bn.intersectionZ});for(var Ne=[],ct=this._order.length-1;ct>=0;ct--){var je=this._order[ct];if(S(je))for(var ht=P.length-1;ht>=0;ht--){var Et=P[ht].feature;if(I[Et.layer.id]<ct)break;Ne.push(Et),P.pop()}else for(var Wt=0,vr=f;Wt<vr.length;Wt+=1){var rr=vr[Wt][je];if(rr)for(var Ar=0,Xr=rr;Ar<Xr.length;Ar+=1)Ne.push(Xr[Ar].feature)}}return Ne},h.prototype.queryRenderedFeatures=function(f,m,S){m&&m.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var I={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,B=m.layers;P<B.length;P+=1){var Y=B[P],te=this._layers[Y];if(!te)return this.fire(new y.ErrorEvent(new Error("The layer '"+Y+"' does not exist in the map's style and cannot be queried for features."))),[];I[te.source]=!0}}var xe=[];for(var Ce in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!I[Ce]||xe.push(Jr(this.sourceCaches[Ce],this._layers,this._serializedLayers,f,m,S));return this.placement&&xe.push(function(Me,et,Ne,ct,je,ht,Et){for(var Wt={},vr=ht.queryRenderedSymbols(ct),rr=[],Ar=0,Xr=Object.keys(vr).map(Number);Ar<Xr.length;Ar+=1)rr.push(Et[Xr[Ar]]);rr.sort(Ri);for(var bn=function(){var Ai=Vn[pn],ba=Ai.featureIndex.lookupSymbolFeatures(vr[Ai.bucketInstanceId],et,Ai.bucketIndex,Ai.sourceLayerIndex,je.filter,je.layers,je.availableImages,Me);for(var Wn in ba){var Wi=Wt[Wn]=Wt[Wn]||[],na=ba[Wn];na.sort(function(ia,zi){var Li=Ai.featureSortOrder;if(Li){var vs=Li.indexOf(ia.featureIndex);return Li.indexOf(zi.featureIndex)-vs}return zi.featureIndex-ia.featureIndex});for(var Xi=0,Pi=na;Xi<Pi.length;Xi+=1)Wi.push(Pi[Xi])}},pn=0,Vn=rr;pn<Vn.length;pn+=1)bn();var bi=function(Ai){Wt[Ai].forEach(function(ba){var Wn=ba.feature,Wi=Ne[Me[Ai].source].getFeatureState(Wn.layer["source-layer"],Wn.id);Wn.source=Wn.layer.source,Wn.layer["source-layer"]&&(Wn.sourceLayer=Wn.layer["source-layer"]),Wn.state=Wi})};for(var Ti in Wt)bi(Ti);return Wt}(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(xe)},h.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var S=this.sourceCaches[f];return S?function(I,P){for(var B=I.getRenderableIds().map(function(et){return I.getTileByID(et)}),Y=[],te={},xe=0;xe<B.length;xe++){var Ce=B[xe],Me=Ce.tileID.canonical.key;te[Me]||(te[Me]=!0,Ce.querySourceFeatures(Y,P))}return Y}(S,m):[]},h.prototype.addSourceType=function(f,m,S){return h.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(h.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},S):S(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var S=this.light.getLight(),I=!1;for(var P in f)if(!y.deepEqual(f[P],S[P])){I=!0;break}if(I){var B={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(B)}},h.prototype._validate=function(f,m,S,I,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&Ts(this,f.call(y.validateStyle,y.extend({key:m,style:this.serialize(),value:S,styleSpec:y.styleSpec},I)))},h.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},h.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},h.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},h.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},h.prototype._updatePlacement=function(f,m,S,I,P){P===void 0&&(P=!1);for(var B=!1,Y=!1,te={},xe=0,Ce=this._order;xe<Ce.length;xe+=1){var Me=this._layers[Ce[xe]];if(Me.type==="symbol"){if(!te[Me.source]){var et=this.sourceCaches[Me.source];te[Me.source]=et.getRenderableIds(!0).map(function(Et){return et.getTileByID(Et)}).sort(function(Et,Wt){return Wt.tileID.overscaledZ-Et.tileID.overscaledZ||(Et.tileID.isLessThan(Wt.tileID)?-1:1)})}var Ne=this.crossTileSymbolIndex.addLayer(Me,te[Me.source],f.center.lng);B=B||Ne}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),f.zoom))&&(this.pauseablePlacement=new Fa(f,this._order,P,m,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),Y=!0),B&&this.pauseablePlacement.placement.setStale()),Y||B)for(var ct=0,je=this._order;ct<je.length;ct+=1){var ht=this._layers[je[ct]];ht.type==="symbol"&&this.placement.updateLayerOpacities(ht,te[ht.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},h.prototype.getImages=function(f,m,S){this.imageManager.getImages(m.icons,S),this._updateTilesForChangedImages();var I=this.sourceCaches[m.source];I&&I.setDependencies(m.tileID.key,m.type,m.icons)},h.prototype.getGlyphs=function(f,m,S){this.glyphManager.getGlyphs(m.stacks,S)},h.prototype.getResource=function(f,m,S){return y.makeRequest(m,S)},h}(y.Evented);Su.getSourceType=function(c){return Fr[c]},Su.setSourceType=function(c,h){Fr[c]=h},Su.registerForPluginStateChange=y.registerForPluginStateChange;var za=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),fs=ka(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),nu=ka(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Au=ka(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),uf=ka(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Vh=ka("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xs=ka(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),lf=ka(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ll=ka("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Fc=ka("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=ka("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=ka(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),G=ka(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),D=ka(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ne=ka(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Re=ka(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),pt=ka(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),It=ka(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),jt=ka(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Nr=ka(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Wr=ka(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Kn=ka(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Hi=ka(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Gi=ka(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ni=ka(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),no=ka(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),go=ka(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ka(c,h){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=h.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=I?I.concat(S):S,B={};return{fragmentSource:c=c.replace(f,function(Y,te,xe,Ce,Me){return B[Me]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
varying `+xe+" "+Ce+" "+Me+`;
#else
uniform `+xe+" "+Ce+" u_"+Me+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Me+`
    `+xe+" "+Ce+" "+Me+" = u_"+Me+`;
#endif
`}),vertexSource:h=h.replace(f,function(Y,te,xe,Ce,Me){var et=Ce==="float"?"vec2":"vec4",Ne=Me.match(/color/)?"color":et;return B[Me]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
uniform lowp float u_`+Me+`_t;
attribute `+xe+" "+et+" a_"+Me+`;
varying `+xe+" "+Ce+" "+Me+`;
#else
uniform `+xe+" "+Ce+" u_"+Me+`;
#endif
`:Ne==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Me+" = a_"+Me+`;
#else
    `+xe+" "+Ce+" "+Me+" = u_"+Me+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+Me+" = unpack_mix_"+Ne+"(a_"+Me+", u_"+Me+`_t);
#else
    `+xe+" "+Ce+" "+Me+" = u_"+Me+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+Me+`
uniform lowp float u_`+Me+`_t;
attribute `+xe+" "+et+" a_"+Me+`;
#else
uniform `+xe+" "+Ce+" u_"+Me+`;
#endif
`:Ne==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+xe+" "+Ce+" "+Me+" = a_"+Me+`;
#else
    `+xe+" "+Ce+" "+Me+" = u_"+Me+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Me+`
    `+xe+" "+Ce+" "+Me+" = unpack_mix_"+Ne+"(a_"+Me+", u_"+Me+`_t);
#else
    `+xe+" "+Ce+" "+Me+" = u_"+Me+`;
#endif
`}),staticAttributes:m,staticUniforms:P}}var iu=Object.freeze({__proto__:null,prelude:fs,background:nu,backgroundPattern:Au,circle:uf,clippingMask:Vh,heatmap:Xs,heatmapTexture:lf,collisionBox:ll,collisionCircle:Fc,debug:b,fill:k,fillOutline:G,fillOutlinePattern:D,fillPattern:ne,fillExtrusion:Re,fillExtrusionPattern:pt,hillshadePrepare:It,hillshade:jt,line:Nr,lineGradient:Wr,linePattern:Kn,lineSDF:Hi,raster:Gi,symbolIcon:Ni,symbolSDF:no,symbolTextAndIcon:go}),Ol=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function fc(c){for(var h=[],f=0;f<c.length;f++)if(c[f]!==null){var m=c[f].split(" ");h.push(m.pop())}return h}Ol.prototype.bind=function(c,h,f,m,S,I,P,B){this.context=c;for(var Y=this.boundPaintVertexBuffers.length!==m.length,te=0;!Y&&te<m.length;te++)this.boundPaintVertexBuffers[te]!==m[te]&&(Y=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===f&&!Y&&this.boundIndexBuffer===S&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===B?(c.bindVertexArrayOES.set(this.vao),P&&P.bind(),S&&S.dynamicDraw&&S.bind(),B&&B.bind()):this.freshBind(h,f,m,S,I,P,B)},Ol.prototype.freshBind=function(c,h,f,m,S,I,P){var B,Y=c.numAttributes,te=this.context,xe=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=P;else{B=te.currentNumAttributes||0;for(var Ce=Y;Ce<B;Ce++)xe.disableVertexAttribArray(Ce)}h.enableAttributes(xe,c);for(var Me=0,et=f;Me<et.length;Me+=1)et[Me].enableAttributes(xe,c);I&&I.enableAttributes(xe,c),P&&P.enableAttributes(xe,c),h.bind(),h.setVertexAttribPointers(xe,c,S);for(var Ne=0,ct=f;Ne<ct.length;Ne+=1){var je=ct[Ne];je.bind(),je.setVertexAttribPointers(xe,c,S)}I&&(I.bind(),I.setVertexAttribPointers(xe,c,S)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(xe,c,S)),te.currentNumAttributes=Y},Ol.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hc=function(c,h,f,m,S,I){var P=c.gl;this.program=P.createProgram();for(var B=fc(f.staticAttributes),Y=m?m.getBinderAttributes():[],te=B.concat(Y),xe=f.staticUniforms?fc(f.staticUniforms):[],Ce=m?m.getBinderUniforms():[],Me=[],et=0,Ne=xe.concat(Ce);et<Ne.length;et+=1){var ct=Ne[et];Me.indexOf(ct)<0&&Me.push(ct)}var je=m?m.defines():[];I&&je.push("#define OVERDRAW_INSPECTOR;");var ht=je.concat(fs.fragmentSource,f.fragmentSource).join(`
`),Et=je.concat(fs.vertexSource,f.vertexSource).join(`
`),Wt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,ht),P.compileShader(Wt),P.attachShader(this.program,Wt);var vr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vr,Et),P.compileShader(vr),P.attachShader(this.program,vr),this.attributes={};var rr={};this.numAttributes=te.length;for(var Ar=0;Ar<this.numAttributes;Ar++)te[Ar]&&(P.bindAttribLocation(this.program,Ar,te[Ar]),this.attributes[te[Ar]]=Ar);P.linkProgram(this.program),P.deleteShader(vr),P.deleteShader(Wt);for(var Xr=0;Xr<Me.length;Xr++){var bn=Me[Xr];if(bn&&!rr[bn]){var pn=P.getUniformLocation(this.program,bn);pn&&(rr[bn]=pn)}}this.fixedUniforms=S(c,rr),this.binderUniforms=m?m.getUniforms(c,rr):[]}}};function pc(c,h,f){var m=1/xa(f,1,h.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),I=f.tileSize*Math.pow(2,h.transform.tileZoom)/S,P=I*(f.tileID.canonical.x+f.tileID.wrap*S),B=I*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[P>>16,B>>16],u_pixel_coord_lower:[65535&P,65535&B]}}hc.prototype.draw=function(c,h,f,m,S,I,P,B,Y,te,xe,Ce,Me,et,Ne,ct){var je,ht=c.gl;if(!this.failedToCreate){for(var Et in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(m),c.setColorMode(S),c.setCullFace(I),this.fixedUniforms)this.fixedUniforms[Et].set(P[Et]);et&&et.setUniforms(c,this.binderUniforms,Ce,{zoom:Me});for(var Wt=(je={},je[ht.LINES]=2,je[ht.TRIANGLES]=3,je[ht.LINE_STRIP]=1,je)[h],vr=0,rr=xe.get();vr<rr.length;vr+=1){var Ar=rr[vr],Xr=Ar.vaos||(Ar.vaos={});(Xr[B]||(Xr[B]=new Ol)).bind(c,this,Y,et?et.getPaintVertexBuffers():[],te,Ar.vertexOffset,Ne,ct),ht.drawElements(h,Ar.primitiveLength*Wt,ht.UNSIGNED_SHORT,Ar.primitiveOffset*Wt*2)}}};var dc=function(c,h,f,m){var S=h.style.light,I=S.properties.get("position"),P=[I.x,I.y,I.z],B=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(B,-h.transform.angle),y.transformMat3(P,P,B);var Y=S.properties.get("color");return{u_matrix:c,u_lightpos:P,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+f,u_opacity:m}},Ru=function(c,h,f,m,S,I,P){return y.extend(dc(c,h,f,m),pc(I,h,P),{u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8})},Fl=function(c){return{u_matrix:c}},El=function(c,h,f,m){return y.extend(Fl(c),pc(f,h,m))},Vo=function(c,h){return{u_matrix:c,u_world:h}},vp=function(c,h,f,m,S){return y.extend(El(c,h,f,m),{u_world:S})},jh=function(c,h,f,m){var S,I,P=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var B=xa(f,1,P.zoom);S=!0,I=[B,B]}else S=!1,I=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(h.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:I}},wu=function(c,h,f){var m=xa(f,1,h.zoom),S=Math.pow(2,h.zoom-f.tileID.overscaledZ),I=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[h.pixelsToGLUnits[0]/(m*S),h.pixelsToGLUnits[1]/(m*S)],u_overscale_factor:I}},cf=function(c,h,f){return{u_matrix:c,u_inv_matrix:h,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},Cl=function(c,h,f){return f===void 0&&(f=1),{u_matrix:c,u_color:h,u_overlay:0,u_overlay_scale:f}},$u=function(c){return{u_matrix:c}},Gh=function(c,h,f,m){return{u_matrix:c,u_extrude_scale:xa(h,1,f),u_intensity:m}},Sl=function(c,h,f){var m=c.transform;return{u_matrix:mp(c,h,f),u_ratio:1/xa(h,1,m.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},yo=function(c,h,f,m){return y.extend(Sl(c,h,f),{u_image:0,u_image_height:m})},Ys=function(c,h,f,m){var S=c.transform,I=Al(h,S);return{u_matrix:mp(c,h,f),u_texsize:h.imageAtlasTexture.size,u_ratio:1/xa(h,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[I,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Hh=function(c,h,f,m,S){var I=c.lineAtlas,P=Al(h,c.transform),B=f.layout.get("line-cap")==="round",Y=I.getDash(m.from,B),te=I.getDash(m.to,B),xe=Y.width*S.fromScale,Ce=te.width*S.toScale;return y.extend(Sl(c,h,f),{u_patternscale_a:[P/xe,-Y.height/2],u_patternscale_b:[P/Ce,-te.height/2],u_sdfgamma:I.width/(256*Math.min(xe,Ce)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:te.y,u_mix:S.t})};function Al(c,h){return 1/xa(c,1,h.tileZoom)}function mp(c,h,f){return c.translatePosMatrix(h.tileID.posMatrix,h,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var gp=function(c,h,f,m,S){return{u_matrix:c,u_tl_parent:h,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(P=S.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(I=S.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:lh(S.paint.get("raster-hue-rotate"))};var I,P};function lh(c){c*=Math.PI/180;var h=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*h-f+1)/3,(Math.sqrt(3)*h-f+1)/3]}var Nf,ff=function(c,h,f,m,S,I,P,B,Y,te){var xe=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:xe.cameraToCenterDistance,u_pitch:xe.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:xe.width/xe.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:P,u_coord_matrix:B,u_is_text:+Y,u_pitch_with_map:+m,u_texsize:te,u_texture:0}},zf=function(c,h,f,m,S,I,P,B,Y,te,xe){var Ce=S.transform;return y.extend(ff(c,h,f,m,S,I,P,B,Y,te),{u_gamma_scale:m?Math.cos(Ce._pitch)*Ce.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+xe})},Dc=function(c,h,f,m,S,I,P,B,Y,te){return y.extend(zf(c,h,f,m,S,I,P,B,!0,Y,!0),{u_texsize_icon:te,u_texture_icon:1})},Uf=function(c,h,f){return{u_matrix:c,u_opacity:h,u_color:f}},vc=function(c,h,f,m,S,I){return y.extend(function(P,B,Y,te){var xe=Y.imageManager.getPattern(P.from.toString()),Ce=Y.imageManager.getPattern(P.to.toString()),Me=Y.imageManager.getPixelSize(),et=Me.width,Ne=Me.height,ct=Math.pow(2,te.tileID.overscaledZ),je=te.tileSize*Math.pow(2,Y.transform.tileZoom)/ct,ht=je*(te.tileID.canonical.x+te.tileID.wrap*ct),Et=je*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:xe.tl,u_pattern_br_a:xe.br,u_pattern_tl_b:Ce.tl,u_pattern_br_b:Ce.br,u_texsize:[et,Ne],u_mix:B.t,u_pattern_size_a:xe.displaySize,u_pattern_size_b:Ce.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/xa(te,1,Y.transform.tileZoom),u_pixel_coord_upper:[ht>>16,Et>>16],u_pixel_coord_lower:[65535&ht,65535&Et]}}(m,I,f,S),{u_matrix:c,u_opacity:h})},hf={fillExtrusion:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_lightpos:new y.Uniform3f(c,h.u_lightpos),u_lightintensity:new y.Uniform1f(c,h.u_lightintensity),u_lightcolor:new y.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,h.u_vertical_gradient),u_opacity:new y.Uniform1f(c,h.u_opacity)}},fillExtrusionPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_lightpos:new y.Uniform3f(c,h.u_lightpos),u_lightintensity:new y.Uniform1f(c,h.u_lightintensity),u_lightcolor:new y.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,h.u_vertical_gradient),u_height_factor:new y.Uniform1f(c,h.u_height_factor),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade),u_opacity:new y.Uniform1f(c,h.u_opacity)}},fill:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},fillPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},fillOutline:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world)}},fillOutlinePattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},circle:function(c,h){return{u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(c,h.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(c,h.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},collisionBox:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(c,h.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(c,h.u_extrude_scale),u_overscale_factor:new y.Uniform1f(c,h.u_overscale_factor)}},collisionCircle:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_inv_matrix:new y.UniformMatrix4f(c,h.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(c,h.u_viewport_size)}},debug:function(c,h){return{u_color:new y.UniformColor(c,h.u_color),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_overlay:new y.Uniform1i(c,h.u_overlay),u_overlay_scale:new y.Uniform1f(c,h.u_overlay_scale)}},clippingMask:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},heatmap:function(c,h){return{u_extrude_scale:new y.Uniform1f(c,h.u_extrude_scale),u_intensity:new y.Uniform1f(c,h.u_intensity),u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},heatmapTexture:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world),u_image:new y.Uniform1i(c,h.u_image),u_color_ramp:new y.Uniform1i(c,h.u_color_ramp),u_opacity:new y.Uniform1f(c,h.u_opacity)}},hillshade:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_latrange:new y.Uniform2f(c,h.u_latrange),u_light:new y.Uniform2f(c,h.u_light),u_shadow:new y.UniformColor(c,h.u_shadow),u_highlight:new y.UniformColor(c,h.u_highlight),u_accent:new y.UniformColor(c,h.u_accent)}},hillshadePrepare:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_dimension:new y.Uniform2f(c,h.u_dimension),u_zoom:new y.Uniform1f(c,h.u_zoom),u_unpack:new y.Uniform4f(c,h.u_unpack)}},line:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels)}},lineGradient:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_image:new y.Uniform1i(c,h.u_image),u_image_height:new y.Uniform1f(c,h.u_image_height)}},linePattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_texsize:new y.Uniform2f(c,h.u_texsize),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_image:new y.Uniform1i(c,h.u_image),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},lineSDF:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(c,h.u_patternscale_a),u_patternscale_b:new y.Uniform2f(c,h.u_patternscale_b),u_sdfgamma:new y.Uniform1f(c,h.u_sdfgamma),u_image:new y.Uniform1i(c,h.u_image),u_tex_y_a:new y.Uniform1f(c,h.u_tex_y_a),u_tex_y_b:new y.Uniform1f(c,h.u_tex_y_b),u_mix:new y.Uniform1f(c,h.u_mix)}},raster:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_tl_parent:new y.Uniform2f(c,h.u_tl_parent),u_scale_parent:new y.Uniform1f(c,h.u_scale_parent),u_buffer_scale:new y.Uniform1f(c,h.u_buffer_scale),u_fade_t:new y.Uniform1f(c,h.u_fade_t),u_opacity:new y.Uniform1f(c,h.u_opacity),u_image0:new y.Uniform1i(c,h.u_image0),u_image1:new y.Uniform1i(c,h.u_image1),u_brightness_low:new y.Uniform1f(c,h.u_brightness_low),u_brightness_high:new y.Uniform1f(c,h.u_brightness_high),u_saturation_factor:new y.Uniform1f(c,h.u_saturation_factor),u_contrast_factor:new y.Uniform1f(c,h.u_contrast_factor),u_spin_weights:new y.Uniform3f(c,h.u_spin_weights)}},symbolIcon:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texture:new y.Uniform1i(c,h.u_texture)}},symbolSDF:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texture:new y.Uniform1i(c,h.u_texture),u_gamma_scale:new y.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,h.u_is_halo)}},symbolTextAndIcon:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texsize_icon:new y.Uniform2f(c,h.u_texsize_icon),u_texture:new y.Uniform1i(c,h.u_texture),u_texture_icon:new y.Uniform1i(c,h.u_texture_icon),u_gamma_scale:new y.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,h.u_is_halo)}},background:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_opacity:new y.Uniform1f(c,h.u_opacity),u_color:new y.UniformColor(c,h.u_color)}},backgroundPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_opacity:new y.Uniform1f(c,h.u_opacity),u_image:new y.Uniform1i(c,h.u_image),u_pattern_tl_a:new y.Uniform2f(c,h.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(c,h.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(c,h.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(c,h.u_pattern_br_b),u_texsize:new y.Uniform2f(c,h.u_texsize),u_mix:new y.Uniform1f(c,h.u_mix),u_pattern_size_a:new y.Uniform2f(c,h.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(c,h.u_pattern_size_b),u_scale_a:new y.Uniform1f(c,h.u_scale_a),u_scale_b:new y.Uniform1f(c,h.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(c,h.u_tile_units_to_pixels)}}};function Jl(c,h,f,m,S,I,P){for(var B=c.context,Y=B.gl,te=c.useProgram("collisionBox"),xe=[],Ce=0,Me=0,et=0;et<m.length;et++){var Ne=m[et],ct=h.getTile(Ne),je=ct.getBucket(f);if(je){var ht=Ne.posMatrix;S[0]===0&&S[1]===0||(ht=c.translatePosMatrix(Ne.posMatrix,ct,S,I));var Et=P?je.textCollisionBox:je.iconCollisionBox,Wt=je.collisionCircleArray;if(Wt.length>0){var vr=y.create(),rr=ht;y.mul(vr,je.placementInvProjMatrix,c.transform.glCoordMatrix),y.mul(vr,vr,je.placementViewportMatrix),xe.push({circleArray:Wt,circleOffset:Me,transform:rr,invTransform:vr}),Me=Ce+=Wt.length/4}Et&&te.draw(B,Y.LINES,Ie.disabled,qe.disabled,c.colorModeForRenderPass(),xt.disabled,wu(ht,c.transform,ct),f.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,c.transform.zoom,null,null,Et.collisionVertexBuffer)}}if(P&&xe.length){var Ar=c.useProgram("collisionCircle"),Xr=new y.StructArrayLayout2f1f2i16;Xr.resize(4*Ce),Xr._trim();for(var bn=0,pn=0,Vn=xe;pn<Vn.length;pn+=1)for(var bi=Vn[pn],Ti=0;Ti<bi.circleArray.length/4;Ti++){var Ai=4*Ti,ba=bi.circleArray[Ai+0],Wn=bi.circleArray[Ai+1],Wi=bi.circleArray[Ai+2],na=bi.circleArray[Ai+3];Xr.emplace(bn++,ba,Wn,Wi,na,0),Xr.emplace(bn++,ba,Wn,Wi,na,1),Xr.emplace(bn++,ba,Wn,Wi,na,2),Xr.emplace(bn++,ba,Wn,Wi,na,3)}(!Nf||Nf.length<2*Ce)&&(Nf=function(fo){var Ho=2*fo,Us=new y.StructArrayLayout3ui6;Us.resize(Ho),Us._trim();for(var Bo=0;Bo<Ho;Bo++){var Wo=6*Bo;Us.uint16[Wo+0]=4*Bo+0,Us.uint16[Wo+1]=4*Bo+1,Us.uint16[Wo+2]=4*Bo+2,Us.uint16[Wo+3]=4*Bo+2,Us.uint16[Wo+4]=4*Bo+3,Us.uint16[Wo+5]=4*Bo+0}return Us}(Ce));for(var Xi=B.createIndexBuffer(Nf,!0),Pi=B.createVertexBuffer(Xr,y.collisionCircleLayout.members,!0),ia=0,zi=xe;ia<zi.length;ia+=1){var Li=zi[ia],vs=cf(Li.transform,Li.invTransform,c.transform);Ar.draw(B,Y.TRIANGLES,Ie.disabled,qe.disabled,c.colorModeForRenderPass(),xt.disabled,vs,f.id,Pi,Xi,y.SegmentVector.simpleSegment(0,2*Li.circleOffset,Li.circleArray.length,Li.circleArray.length/2),null,c.transform.zoom,null,null,null)}Pi.destroy(),Xi.destroy()}}var au=y.identity(new Float32Array(16));function Zf(c,h,f,m,S,I){var P=y.getAnchorAlignment(c),B=-(P.horizontalAlign-.5)*h,Y=-(P.verticalAlign-.5)*f,te=y.evaluateVariableOffset(c,m);return new y.Point((B/S+te[0])*I,(Y/S+te[1])*I)}function Vf(c,h,f,m,S,I,P,B,Y,te,xe){var Ce=c.text.placedSymbolArray,Me=c.text.dynamicLayoutVertexArray,et=c.icon.dynamicLayoutVertexArray,Ne={};Me.clear();for(var ct=0;ct<Ce.length;ct++){var je=Ce.get(ct),ht=je.hidden||!je.crossTileID||c.allowVerticalPlacement&&!je.placedOrientation?null:m[je.crossTileID];if(ht){var Et=new y.Point(je.anchorX,je.anchorY),Wt=ji(Et,f?B:P),vr=Aa(I.cameraToCenterDistance,Wt.signedDistanceFromCamera),rr=S.evaluateSizeForFeature(c.textSizeData,te,je)*vr/y.ONE_EM;f&&(rr*=c.tilePixelRatio/Y);for(var Ar=Zf(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale,rr),Xr=f?ji(Et.add(Ar),P).point:Wt.point.add(h?Ar.rotate(-I.angle):Ar),bn=c.allowVerticalPlacement&&je.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,pn=0;pn<je.numGlyphs;pn++)y.addDynamicAttributes(Me,Xr,bn);xe&&je.associatedIconIndex>=0&&(Ne[je.associatedIconIndex]={shiftedAnchor:Xr,angle:bn})}else Oa(je.numGlyphs,Me)}if(xe){et.clear();for(var Vn=c.icon.placedSymbolArray,bi=0;bi<Vn.length;bi++){var Ti=Vn.get(bi);if(Ti.hidden)Oa(Ti.numGlyphs,et);else{var Ai=Ne[bi];if(Ai)for(var ba=0;ba<Ti.numGlyphs;ba++)y.addDynamicAttributes(et,Ai.shiftedAnchor,Ai.angle);else Oa(Ti.numGlyphs,et)}}c.icon.dynamicLayoutVertexBuffer.updateData(et)}c.text.dynamicLayoutVertexBuffer.updateData(Me)}function Wh(c,h,f){return f.iconsInText&&h?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function mc(c,h,f,m,S,I,P,B,Y,te,xe,Ce){for(var Me=c.context,et=Me.gl,Ne=c.transform,ct=B==="map",je=Y==="map",ht=ct&&f.layout.get("symbol-placement")!=="point",Et=ct&&!je&&!ht,Wt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,vr=!1,rr=c.depthModeForSublayer(0,Ie.ReadOnly),Ar=f.layout.get("text-variable-anchor"),Xr=[],bn=0,pn=m;bn<pn.length;bn+=1){var Vn=pn[bn],bi=h.getTile(Vn),Ti=bi.getBucket(f);if(Ti){var Ai=S?Ti.text:Ti.icon;if(Ai&&Ai.segments.get().length){var ba=Ai.programConfigurations.get(f.id),Wn=S||Ti.sdfIcons,Wi=S?Ti.textSizeData:Ti.iconSizeData,na=je||Ne.pitch!==0,Xi=c.useProgram(Wh(Wn,S,Ti),ba),Pi=y.evaluateSizeForZoom(Wi,Ne.zoom),ia=void 0,zi=[0,0],Li=void 0,vs=void 0,fo=null,Ho=void 0;if(S)Li=bi.glyphAtlasTexture,vs=et.LINEAR,ia=bi.glyphAtlasTexture.size,Ti.iconsInText&&(zi=bi.imageAtlasTexture.size,fo=bi.imageAtlasTexture,Ho=na||c.options.rotating||c.options.zooming||Wi.kind==="composite"||Wi.kind==="camera"?et.LINEAR:et.NEAREST);else{var Us=f.layout.get("icon-size").constantOr(0)!==1||Ti.iconsNeedLinear;Li=bi.imageAtlasTexture,vs=Wn||c.options.rotating||c.options.zooming||Us||na?et.LINEAR:et.NEAREST,ia=bi.imageAtlasTexture.size}var Bo=xa(bi,1,c.transform.zoom),Wo=lo(Vn.posMatrix,je,ct,c.transform,Bo),ou=Na(Vn.posMatrix,je,ct,c.transform,Bo),su=Ar&&Ti.hasTextData(),Ms=f.layout.get("icon-text-fit")!=="none"&&su&&Ti.hasIconData();ht&&an(Ti,Vn.posMatrix,c,S,Wo,ou,je,te);var ms=c.translatePosMatrix(Vn.posMatrix,bi,I,P),Vl=ht||S&&Ar||Ms?au:Wo,Ou=c.translatePosMatrix(ou,bi,I,P,!0),Cf=Wn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ml={program:Xi,buffers:Ai,uniformValues:Wn?Ti.iconsInText?Dc(Wi.kind,Pi,Et,je,c,ms,Vl,Ou,ia,zi):zf(Wi.kind,Pi,Et,je,c,ms,Vl,Ou,S,ia,!0):ff(Wi.kind,Pi,Et,je,c,ms,Vl,Ou,S,ia),atlasTexture:Li,atlasTextureIcon:fo,atlasInterpolation:vs,atlasInterpolationIcon:Ho,isSDF:Wn,hasHalo:Cf};if(Wt&&Ti.canOverlap){vr=!0;for(var Il=0,Ec=Ai.segments.get();Il<Ec.length;Il+=1){var Hc=Ec[Il];Xr.push({segments:new y.SegmentVector([Hc]),sortKey:Hc.sortKey,state:Ml})}}else Xr.push({segments:Ai.segments,sortKey:0,state:Ml})}}}vr&&Xr.sort(function(Gl,ic){return Gl.sortKey-ic.sortKey});for(var jl=0,Wc=Xr;jl<Wc.length;jl+=1){var gl=Wc[jl],gs=gl.state;if(Me.activeTexture.set(et.TEXTURE0),gs.atlasTexture.bind(gs.atlasInterpolation,et.CLAMP_TO_EDGE),gs.atlasTextureIcon&&(Me.activeTexture.set(et.TEXTURE1),gs.atlasTextureIcon&&gs.atlasTextureIcon.bind(gs.atlasInterpolationIcon,et.CLAMP_TO_EDGE)),gs.isSDF){var uu=gs.uniformValues;gs.hasHalo&&(uu.u_is_halo=1,Ku(gs.buffers,gl.segments,f,c,gs.program,rr,xe,Ce,uu)),uu.u_is_halo=0}Ku(gs.buffers,gl.segments,f,c,gs.program,rr,xe,Ce,gs.uniformValues)}}function Ku(c,h,f,m,S,I,P,B,Y){var te=m.context;S.draw(te,te.gl.TRIANGLES,I,P,B,xt.disabled,Y,f.id,c.layoutVertexBuffer,c.indexBuffer,h,f.paint,m.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Dl(c,h,f,m,S,I,P){var B,Y,te,xe,Ce,Me=c.context.gl,et=f.paint.get("fill-pattern"),Ne=et&&et.constantOr(1),ct=f.getCrossfadeParameters();P?(Y=Ne&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=Me.LINES):(Y=Ne?"fillPattern":"fill",B=Me.TRIANGLES);for(var je=0,ht=m;je<ht.length;je+=1){var Et=ht[je],Wt=h.getTile(Et);if(!Ne||Wt.patternsLoaded()){var vr=Wt.getBucket(f);if(vr){var rr=vr.programConfigurations.get(f.id),Ar=c.useProgram(Y,rr);Ne&&(c.context.activeTexture.set(Me.TEXTURE0),Wt.imageAtlasTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),rr.updatePaintBuffers(ct));var Xr=et.constantOr(null);if(Xr&&Wt.imageAtlas){var bn=Wt.imageAtlas,pn=bn.patternPositions[Xr.to.toString()],Vn=bn.patternPositions[Xr.from.toString()];pn&&Vn&&rr.setConstantPatternPositions(pn,Vn)}var bi=c.translatePosMatrix(Et.posMatrix,Wt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(P){xe=vr.indexBuffer2,Ce=vr.segments2;var Ti=[Me.drawingBufferWidth,Me.drawingBufferHeight];te=Y==="fillOutlinePattern"&&Ne?vp(bi,c,ct,Wt,Ti):Vo(bi,Ti)}else xe=vr.indexBuffer,Ce=vr.segments,te=Ne?El(bi,c,ct,Wt):Fl(bi);Ar.draw(c.context,B,S,c.stencilModeForClipping(Et),I,xt.disabled,te,f.id,vr.layoutVertexBuffer,xe,Ce,f.paint,c.transform.zoom,rr)}}}}function Bc(c,h,f,m,S,I,P){for(var B=c.context,Y=B.gl,te=f.paint.get("fill-extrusion-pattern"),xe=te.constantOr(1),Ce=f.getCrossfadeParameters(),Me=f.paint.get("fill-extrusion-opacity"),et=0,Ne=m;et<Ne.length;et+=1){var ct=Ne[et],je=h.getTile(ct),ht=je.getBucket(f);if(ht){var Et=ht.programConfigurations.get(f.id),Wt=c.useProgram(xe?"fillExtrusionPattern":"fillExtrusion",Et);xe&&(c.context.activeTexture.set(Y.TEXTURE0),je.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Et.updatePaintBuffers(Ce));var vr=te.constantOr(null);if(vr&&je.imageAtlas){var rr=je.imageAtlas,Ar=rr.patternPositions[vr.to.toString()],Xr=rr.patternPositions[vr.from.toString()];Ar&&Xr&&Et.setConstantPatternPositions(Ar,Xr)}var bn=c.translatePosMatrix(ct.posMatrix,je,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),pn=f.paint.get("fill-extrusion-vertical-gradient"),Vn=xe?Ru(bn,c,pn,Me,ct,Ce,je):dc(bn,c,pn,Me);Wt.draw(B,B.gl.TRIANGLES,S,I,P,xt.backCCW,Vn,f.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,f.paint,c.transform.zoom,Et)}}}function ec(c,h,f,m,S,I){var P=c.context,B=P.gl,Y=h.fbo;if(Y){var te=c.useProgram("hillshade");P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Y.colorAttachment.get());var xe=function(Ce,Me,et){var Ne=et.paint.get("hillshade-shadow-color"),ct=et.paint.get("hillshade-highlight-color"),je=et.paint.get("hillshade-accent-color"),ht=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(ht-=Ce.transform.angle);var Et,Wt,vr,rr=!Ce.options.moving;return{u_matrix:Ce.transform.calculatePosMatrix(Me.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(Et=Me.tileID,Wt=Math.pow(2,Et.canonical.z),vr=Et.canonical.y,[new y.MercatorCoordinate(0,vr/Wt).toLngLat().lat,new y.MercatorCoordinate(0,(vr+1)/Wt).toLngLat().lat]),u_light:[et.paint.get("hillshade-exaggeration"),ht],u_shadow:Ne,u_highlight:ct,u_accent:je}}(c,h,f);te.draw(P,B.TRIANGLES,m,S,I,xt.disabled,xe,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function jf(c,h,f,m,S,I){var P=c.context,B=P.gl,Y=h.dem;if(Y&&Y.data){var te=Y.dim,xe=Y.stride,Ce=Y.getPixels();if(P.activeTexture.set(B.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||c.getTileTexture(xe),h.demTexture){var Me=h.demTexture;Me.update(Ce,{premultiply:!1}),Me.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else h.demTexture=new y.Texture(P,Ce,B.RGBA,{premultiply:!1}),h.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);P.activeTexture.set(B.TEXTURE0);var et=h.fbo;if(!et){var Ne=new y.Texture(P,{width:te,height:te,data:null},B.RGBA);Ne.bind(B.LINEAR,B.CLAMP_TO_EDGE),(et=h.fbo=P.createFramebuffer(te,te,!0)).colorAttachment.set(Ne.texture)}P.bindFramebuffer.set(et.framebuffer),P.viewport.set([0,0,te,te]),c.useProgram("hillshadePrepare").draw(P,B.TRIANGLES,m,S,I,xt.disabled,function(ct,je){var ht=je.stride,Et=y.create();return y.ortho(Et,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Et,Et,[0,-y.EXTENT,0]),{u_matrix:Et,u_image:1,u_dimension:[ht,ht],u_zoom:ct.overscaledZ,u_unpack:je.getUnpackVector()}}(h.tileID,Y),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Gf(c,h,f,m,S){var I=m.paint.get("raster-fade-duration");if(I>0){var P=y.browser.now(),B=(P-c.timeAdded)/I,Y=h?(P-h.timeAdded)/I:-1,te=f.getSource(),xe=S.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),Ce=!h||Math.abs(h.tileID.overscaledZ-xe)>Math.abs(c.tileID.overscaledZ-xe),Me=Ce&&c.refreshedUponExpiration?1:y.clamp(Ce?B:1-Y,0,1);return c.refreshedUponExpiration&&B>=1&&(c.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Me}:{opacity:Me,mix:0}}return{opacity:1,mix:0}}var gc=new y.Color(1,0,0,1),Xh=new y.Color(0,1,0,1),ch=new y.Color(0,0,1,1),Nc=new y.Color(1,0,1,1),Xp=new y.Color(0,1,1,1);function fh(c,h,f,m){pf(c,0,h+f/2,c.transform.width,f,m)}function Yh(c,h,f,m){pf(c,h-f/2,0,f,c.transform.height,m)}function pf(c,h,f,m,S,I){var P=c.context,B=P.gl;B.enable(B.SCISSOR_TEST),B.scissor(h*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,m*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),P.clear({color:I}),B.disable(B.SCISSOR_TEST)}function Yp(c,h,f){var m=c.context,S=m.gl,I=f.posMatrix,P=c.useProgram("debug"),B=Ie.disabled,Y=qe.disabled,te=c.colorModeForRenderPass();m.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),P.draw(m,S.LINE_STRIP,B,Y,te,xt.disabled,Cl(I,y.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var xe=h.getTileByID(f.key).latestRawTileData,Ce=Math.floor((xe&&xe.byteLength||0)/1024),Me=h.getTile(f).tileSize,et=512/Math.min(Me,512)*(f.overscaledZ/c.transform.zoom)*.5,Ne=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ne+=" => "+f.overscaledZ),function(ct,je){ct.initDebugOverlayCanvas();var ht=ct.debugOverlayCanvas,Et=ct.context.gl,Wt=ct.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,ht.width,ht.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(je,5,5),Wt.strokeText(je,5,5),ct.debugOverlayTexture.update(ht),ct.debugOverlayTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE)}(c,Ne+" "+Ce+"kb"),P.draw(m,S.TRIANGLES,B,Y,ot.alphaBlended,xt.disabled,Cl(I,y.Color.transparent,et),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var zc={symbol:function(c,h,f,m,S){if(c.renderPass==="translucent"){var I=qe.disabled,P=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(B,Y,te,xe,Ce,Me,et){for(var Ne=Y.transform,ct=Ce==="map",je=Me==="map",ht=0,Et=B;ht<Et.length;ht+=1){var Wt=Et[ht],vr=xe.getTile(Wt),rr=vr.getBucket(te);if(rr&&rr.text&&rr.text.segments.get().length){var Ar=y.evaluateSizeForZoom(rr.textSizeData,Ne.zoom),Xr=xa(vr,1,Y.transform.zoom),bn=lo(Wt.posMatrix,je,ct,Y.transform,Xr),pn=te.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if(Ar){var Vn=Math.pow(2,Ne.zoom-vr.tileID.overscaledZ);Vf(rr,ct,je,et,y.symbolSize,Ne,bn,Wt.posMatrix,Vn,Ar,pn)}}}}(m,c,f,h,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&mc(c,h,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),I,P),f.paint.get("text-opacity").constantOr(1)!==0&&mc(c,h,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),I,P),h.map.showCollisionBoxes&&(Jl(c,h,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Jl(c,h,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),I=f.paint.get("circle-stroke-width"),P=f.paint.get("circle-stroke-opacity"),B=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||I.constantOr(1)!==0&&P.constantOr(1)!==0){for(var Y=c.context,te=Y.gl,xe=c.depthModeForSublayer(0,Ie.ReadOnly),Ce=qe.disabled,Me=c.colorModeForRenderPass(),et=[],Ne=0;Ne<m.length;Ne++){var ct=m[Ne],je=h.getTile(ct),ht=je.getBucket(f);if(ht){var Et=ht.programConfigurations.get(f.id),Wt={programConfiguration:Et,program:c.useProgram("circle",Et),layoutVertexBuffer:ht.layoutVertexBuffer,indexBuffer:ht.indexBuffer,uniformValues:jh(c,ct,je,f)};if(B)for(var vr=0,rr=ht.segments.get();vr<rr.length;vr+=1){var Ar=rr[vr];et.push({segments:new y.SegmentVector([Ar]),sortKey:Ar.sortKey,state:Wt})}else et.push({segments:ht.segments,sortKey:0,state:Wt})}}B&&et.sort(function(bi,Ti){return bi.sortKey-Ti.sortKey});for(var Xr=0,bn=et;Xr<bn.length;Xr+=1){var pn=bn[Xr],Vn=pn.state;Vn.program.draw(Y,te.TRIANGLES,xe,Ce,Me,xt.disabled,Vn.uniformValues,f.id,Vn.layoutVertexBuffer,Vn.indexBuffer,pn.segments,f.paint,c.transform.zoom,Vn.programConfiguration)}}}},heatmap:function(c,h,f,m){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,I=S.gl,P=qe.disabled,B=new ot([I.ONE,I.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(et,Ne,ct){var je=et.gl;et.activeTexture.set(je.TEXTURE1),et.viewport.set([0,0,Ne.width/4,Ne.height/4]);var ht=ct.heatmapFbo;if(ht)je.bindTexture(je.TEXTURE_2D,ht.colorAttachment.get()),et.bindFramebuffer.set(ht.framebuffer);else{var Et=je.createTexture();je.bindTexture(je.TEXTURE_2D,Et),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MAG_FILTER,je.LINEAR),ht=ct.heatmapFbo=et.createFramebuffer(Ne.width/4,Ne.height/4,!1),function(Wt,vr,rr,Ar){var Xr=Wt.gl;Xr.texImage2D(Xr.TEXTURE_2D,0,Xr.RGBA,vr.width/4,vr.height/4,0,Xr.RGBA,Wt.extRenderToTextureHalfFloat?Wt.extTextureHalfFloat.HALF_FLOAT_OES:Xr.UNSIGNED_BYTE,null),Ar.colorAttachment.set(rr)}(et,Ne,Et,ht)}})(S,c,f),S.clear({color:y.Color.transparent});for(var Y=0;Y<m.length;Y++){var te=m[Y];if(!h.hasRenderableParent(te)){var xe=h.getTile(te),Ce=xe.getBucket(f);if(Ce){var Me=Ce.programConfigurations.get(f.id);c.useProgram("heatmap",Me).draw(S,I.TRIANGLES,Ie.disabled,P,B,xt.disabled,Gh(te.posMatrix,xe,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,f.paint,c.transform.zoom,Me)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(et,Ne){var ct=et.context,je=ct.gl,ht=Ne.heatmapFbo;if(ht){ct.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_2D,ht.colorAttachment.get()),ct.activeTexture.set(je.TEXTURE1);var Et=Ne.colorRampTexture;Et||(Et=Ne.colorRampTexture=new y.Texture(ct,Ne.colorRamp,je.RGBA)),Et.bind(je.LINEAR,je.CLAMP_TO_EDGE),et.useProgram("heatmapTexture").draw(ct,je.TRIANGLES,Ie.disabled,qe.disabled,et.colorModeForRenderPass(),xt.disabled,function(Wt,vr,rr,Ar){var Xr=y.create();y.ortho(Xr,0,Wt.width,Wt.height,0,0,1);var bn=Wt.context.gl;return{u_matrix:Xr,u_world:[bn.drawingBufferWidth,bn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:vr.paint.get("heatmap-opacity")}}(et,Ne),Ne.id,et.viewportBuffer,et.quadTriangleIndexBuffer,et.viewportSegments,Ne.paint,et.transform.zoom)}}(c,f))},line:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),I=f.paint.get("line-width");if(S.constantOr(1)!==0&&I.constantOr(1)!==0)for(var P=c.depthModeForSublayer(0,Ie.ReadOnly),B=c.colorModeForRenderPass(),Y=f.paint.get("line-dasharray"),te=f.paint.get("line-pattern"),xe=te.constantOr(1),Ce=f.paint.get("line-gradient"),Me=f.getCrossfadeParameters(),et=xe?"linePattern":Y?"lineSDF":Ce?"lineGradient":"line",Ne=c.context,ct=Ne.gl,je=!0,ht=0,Et=m;ht<Et.length;ht+=1){var Wt=Et[ht],vr=h.getTile(Wt);if(!xe||vr.patternsLoaded()){var rr=vr.getBucket(f);if(rr){var Ar=rr.programConfigurations.get(f.id),Xr=c.context.program.get(),bn=c.useProgram(et,Ar),pn=je||bn.program!==Xr,Vn=te.constantOr(null);if(Vn&&vr.imageAtlas){var bi=vr.imageAtlas,Ti=bi.patternPositions[Vn.to.toString()],Ai=bi.patternPositions[Vn.from.toString()];Ti&&Ai&&Ar.setConstantPatternPositions(Ti,Ai)}var ba=xe?Ys(c,vr,f,Me):Y?Hh(c,vr,f,Y,Me):Ce?yo(c,vr,f,rr.lineClipsArray.length):Sl(c,vr,f);if(xe)Ne.activeTexture.set(ct.TEXTURE0),vr.imageAtlasTexture.bind(ct.LINEAR,ct.CLAMP_TO_EDGE),Ar.updatePaintBuffers(Me);else if(Y&&(pn||c.lineAtlas.dirty))Ne.activeTexture.set(ct.TEXTURE0),c.lineAtlas.bind(Ne);else if(Ce){var Wn=rr.gradients[f.id],Wi=Wn.texture;if(f.gradientVersion!==Wn.version){var na=256;if(f.stepInterpolant){var Xi=h.getSource().maxzoom,Pi=Wt.canonical.z===Xi?Math.ceil(1<<c.transform.maxZoom-Wt.canonical.z):1;na=y.clamp(y.nextPowerOfTwo(rr.maxLineLength/y.EXTENT*1024*Pi),256,Ne.maxTextureSize)}Wn.gradient=y.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:na,image:Wn.gradient||void 0,clips:rr.lineClipsArray}),Wn.texture?Wn.texture.update(Wn.gradient):Wn.texture=new y.Texture(Ne,Wn.gradient,ct.RGBA),Wn.version=f.gradientVersion,Wi=Wn.texture}Ne.activeTexture.set(ct.TEXTURE0),Wi.bind(f.stepInterpolant?ct.NEAREST:ct.LINEAR,ct.CLAMP_TO_EDGE)}bn.draw(Ne,ct.TRIANGLES,P,c.stencilModeForClipping(Wt),B,xt.disabled,ba,f.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,f.paint,c.transform.zoom,Ar,rr.layoutVertexBuffer2),je=!1}}}}},fill:function(c,h,f,m){var S=f.paint.get("fill-color"),I=f.paint.get("fill-opacity");if(I.constantOr(1)!==0){var P=c.colorModeForRenderPass(),B=f.paint.get("fill-pattern"),Y=c.opaquePassEnabledForLayer()&&!B.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===Y){var te=c.depthModeForSublayer(1,c.renderPass==="opaque"?Ie.ReadWrite:Ie.ReadOnly);Dl(c,h,f,m,te,P,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var xe=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,Ie.ReadOnly);Dl(c,h,f,m,xe,P,!0)}}},"fill-extrusion":function(c,h,f,m){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var I=new Ie(c.context.gl.LEQUAL,Ie.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Bc(c,h,f,m,I,qe.disabled,ot.disabled),Bc(c,h,f,m,I,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var P=c.colorModeForRenderPass();Bc(c,h,f,m,I,qe.disabled,P)}}},hillshade:function(c,h,f,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,I=c.depthModeForSublayer(0,Ie.ReadOnly),P=c.colorModeForRenderPass(),B=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],Y=B[0],te=0,xe=B[1];te<xe.length;te+=1){var Ce=xe[te],Me=h.getTile(Ce);Me.needsHillshadePrepare&&c.renderPass==="offscreen"?jf(c,Me,f,I,qe.disabled,P):c.renderPass==="translucent"&&ec(c,Me,f,I,Y[Ce.overscaledZ],P)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,h,f,m){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var S=c.context,I=S.gl,P=h.getSource(),B=c.useProgram("raster"),Y=c.colorModeForRenderPass(),te=P instanceof Vt?[{},m]:c.stencilConfigForOverlap(m),xe=te[0],Ce=te[1],Me=Ce[Ce.length-1].overscaledZ,et=!c.options.moving,Ne=0,ct=Ce;Ne<ct.length;Ne+=1){var je=ct[Ne],ht=c.depthModeForSublayer(je.overscaledZ-Me,f.paint.get("raster-opacity")===1?Ie.ReadWrite:Ie.ReadOnly,I.LESS),Et=h.getTile(je),Wt=c.transform.calculatePosMatrix(je.toUnwrapped(),et);Et.registerFadeDuration(f.paint.get("raster-fade-duration"));var vr=h.findLoadedParent(je,0),rr=Gf(Et,vr,h,f,c.transform),Ar=void 0,Xr=void 0,bn=f.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;S.activeTexture.set(I.TEXTURE0),Et.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(I.TEXTURE1),vr?(vr.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),Ar=Math.pow(2,vr.tileID.overscaledZ-Et.tileID.overscaledZ),Xr=[Et.tileID.canonical.x*Ar%1,Et.tileID.canonical.y*Ar%1]):Et.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var pn=gp(Wt,Xr||[0,0],Ar||1,rr,f);P instanceof Vt?B.draw(S,I.TRIANGLES,ht,qe.disabled,Y,xt.disabled,pn,f.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments):B.draw(S,I.TRIANGLES,ht,xe[je.overscaledZ],Y,xt.disabled,pn,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,h,f){var m=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var I=c.context,P=I.gl,B=c.transform,Y=B.tileSize,te=f.paint.get("background-pattern");if(!c.isPatternMissing(te)){var xe=!te&&m.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===xe){var Ce=qe.disabled,Me=c.depthModeForSublayer(0,xe==="opaque"?Ie.ReadWrite:Ie.ReadOnly),et=c.colorModeForRenderPass(),Ne=c.useProgram(te?"backgroundPattern":"background"),ct=B.coveringTiles({tileSize:Y});te&&(I.activeTexture.set(P.TEXTURE0),c.imageManager.bind(c.context));for(var je=f.getCrossfadeParameters(),ht=0,Et=ct;ht<Et.length;ht+=1){var Wt=Et[ht],vr=c.transform.calculatePosMatrix(Wt.toUnwrapped()),rr=te?vc(vr,S,c,te,{tileID:Wt,tileSize:Y},je):Uf(vr,S,m);Ne.draw(I,P.TRIANGLES,Me,Ce,et,xt.disabled,rr,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,h,f){for(var m=0;m<f.length;m++)Yp(c,h,f[m])},custom:function(c,h,f){var m=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var I=S.prerender;I&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),I.call(S,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(qe.disabled);var P=S.renderingMode==="3d"?new Ie(c.context.gl.LEQUAL,Ie.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Ie.ReadOnly);m.setDepthMode(P),S.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Ao=function(c,h){this.context=new Te(c),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=rt.maxUnderzooming+rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new cs,this.gpuTimers={}};Ao.prototype.resize=function(c,h){if(this.width=c*y.browser.devicePixelRatio,this.height=h*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},Ao.prototype.setup=function(){var c=this.context,h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,za.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var f=new y.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(y.EXTENT,0),f.emplaceBack(0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=c.createVertexBuffer(f,za.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var m=new y.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(y.EXTENT,0,y.EXTENT,0),m.emplaceBack(0,y.EXTENT,0,y.EXTENT),m.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,wt.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,za.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var I=new y.StructArrayLayout1ui2;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(I);var P=new y.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(P),this.emptyTexture=new y.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new qe({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},Ao.prototype.clearStencil=function(){var c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=y.create();y.ortho(f,0,this.width,this.height,0,0,1),y.scale(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,h.TRIANGLES,Ie.disabled,this.stencilClearMode,ot.disabled,xt.disabled,$u(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ao.prototype._renderTileClippingMasks=function(c,h){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&h&&h.length){this.currentStencilSource=c.source;var f=this.context,m=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(ot.disabled),f.setDepthMode(Ie.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var I=0,P=h;I<P.length;I+=1){var B=P[I],Y=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;S.draw(f,m.TRIANGLES,Ie.disabled,new qe({func:m.ALWAYS,mask:0},Y,255,m.KEEP,m.KEEP,m.REPLACE),ot.disabled,xt.disabled,$u(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ao.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,h=this.context.gl;return new qe({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)},Ao.prototype.stencilModeForClipping=function(c){var h=this.context.gl;return new qe({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)},Ao.prototype.stencilConfigForOverlap=function(c){var h,f=this.context.gl,m=c.sort(function(Y,te){return te.overscaledZ-Y.overscaledZ}),S=m[m.length-1].overscaledZ,I=m[0].overscaledZ-S+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();for(var P={},B=0;B<I;B++)P[B+S]=new qe({func:f.GEQUAL,mask:255},B+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=I,[P,m]}return[(h={},h[S]=qe.disabled,h),m]},Ao.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new ot([c.CONSTANT_COLOR,c.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ot.unblended:ot.alphaBlended},Ao.prototype.depthModeForSublayer=function(c,h,f){if(!this.opaquePassEnabledForLayer())return Ie.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Ie(f||this.context.gl.LEQUAL,h,[m,m])},Ao.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ao.prototype.render=function(c,h){var f=this;this.style=c,this.options=h,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var m=this.style._order,S=this.style.sourceCaches;for(var I in S){var P=S[I];P.used&&P.prepare(this.context)}var B,Y,te={},xe={},Ce={};for(var Me in S){var et=S[Me];te[Me]=et.getVisibleCoordinates(),xe[Me]=te[Me].slice().reverse(),Ce[Me]=et.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ne=0;Ne<m.length;Ne++)if(this.style._layers[m[Ne]].is3D()){this.opaquePassCutoff=Ne;break}this.renderPass="offscreen";for(var ct=0,je=m;ct<je.length;ct+=1){var ht=this.style._layers[je[ct]];if(ht.hasOffscreenPass()&&!ht.isHidden(this.transform.zoom)){var Et=xe[ht.source];(ht.type==="custom"||Et.length)&&this.renderLayer(this,S[ht.source],ht,Et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Wt=this.style._layers[m[this.currentLayer]],vr=S[Wt.source],rr=te[Wt.source];this._renderTileClippingMasks(Wt,rr),this.renderLayer(this,vr,Wt,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var Ar=this.style._layers[m[this.currentLayer]],Xr=S[Ar.source],bn=(Ar.type==="symbol"?Ce:xe)[Ar.source];this._renderTileClippingMasks(Ar,te[Ar.source]),this.renderLayer(this,Xr,Ar,bn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(pn){pn.source&&!pn.isHidden(f.transform.zoom)&&(pn.source!==(Y&&Y.id)&&(Y=f.style.sourceCaches[pn.source]),(!B||B.getSource().maxzoom<Y.getSource().maxzoom)&&(B=Y))}),B&&zc.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&function(pn){var Vn=pn.transform.padding;fh(pn,pn.transform.height-(Vn.top||0),3,gc),fh(pn,Vn.bottom||0,3,Xh),Yh(pn,Vn.left||0,3,ch),Yh(pn,pn.transform.width-(Vn.right||0),3,Nc);var bi=pn.transform.centerPoint;(function(Ti,Ai,ba,Wn){pf(Ti,Ai-1,ba-10,2,20,Wn),pf(Ti,Ai-10,ba-1,20,2,Wn)})(pn,bi.x,pn.transform.height-bi.y,Xp)}(this),this.context.setDefault()},Ao.prototype.renderLayer=function(c,h,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),zc[f.type](c,h,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ao.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var h=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),f.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f.query)}},Ao.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ao.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ao.prototype.queryGpuTimers=function(c){var h={};for(var f in c){var m=c[f],S=this.context.extTimerQuery,I=S.getQueryObjectEXT(m.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(m.query),h[f]=I}return h},Ao.prototype.translatePosMatrix=function(c,h,f,m,S){if(!f[0]&&!f[1])return c;var I=S?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(I){var P=Math.sin(I),B=Math.cos(I);f=[f[0]*B-f[1]*P,f[0]*P+f[1]*B]}var Y=[S?f[0]:xa(h,f[0],this.transform.zoom),S?f[1]:xa(h,f[1],this.transform.zoom),0],te=new Float32Array(16);return y.translate(te,c,Y),te},Ao.prototype.saveTileTexture=function(c){var h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]},Ao.prototype.getTileTexture=function(c){var h=this._tileTextures[c];return h&&h.length>0?h.pop():null},Ao.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var h=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!h||!f},Ao.prototype.useProgram=function(c,h){this.cache=this.cache||{};var f=""+c+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new hc(this.context,c,iu[c],h,hf[c],this._showOverdrawInspector)),this.cache[f]},Ao.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ao.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ao.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ao.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Bs=function(c,h){this.points=c,this.planes=h};Bs.fromInvProjectionMatrix=function(c,h,f){var m=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return y.transformMat4([],P,c)}).map(function(P){return y.scale$1([],P,1/P[3]/h*m)}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var B=y.sub([],S[P[0]],S[P[1]]),Y=y.sub([],S[P[2]],S[P[1]]),te=y.normalize([],y.cross([],B,Y)),xe=-y.dot(te,S[P[1]]);return te.concat(xe)});return new Bs(S,I)};var Uc=function(c,h){this.min=c,this.max=h,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Uc.prototype.quadrant=function(c){for(var h=[c%2==0,c<2],f=y.clone$2(this.min),m=y.clone$2(this.max),S=0;S<h.length;S++)f[S]=h[S]?this.min[S]:this.center[S],m[S]=h[S]?this.center[S]:this.max[S];return m[2]=this.max[2],new Uc(f,m)},Uc.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Uc.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Uc.prototype.intersects=function(c){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<c.planes.length;m++){for(var S=c.planes[m],I=0,P=0;P<h.length;P++)I+=y.dot$1(S,h[P])>=0;if(I===0)return 0;I!==h.length&&(f=!1)}if(f)return 2;for(var B=0;B<3;B++){for(var Y=Number.MAX_VALUE,te=-Number.MAX_VALUE,xe=0;xe<c.points.length;xe++){var Ce=c.points[xe][B]-this.min[B];Y=Math.min(Y,Ce),te=Math.max(te,Ce)}if(te<0||Y>this.max[B]-this.min[B])return 0}return 1};var Pa=function(c,h,f,m){if(c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=f,this.right=m};Pa.prototype.interpolate=function(c,h,f){return h.top!=null&&c.top!=null&&(this.top=y.number(c.top,h.top,f)),h.bottom!=null&&c.bottom!=null&&(this.bottom=y.number(c.bottom,h.bottom,f)),h.left!=null&&c.left!=null&&(this.left=y.number(c.left,h.left,f)),h.right!=null&&c.right!=null&&(this.right=y.number(c.right,h.right,f)),this},Pa.prototype.getCenter=function(c,h){var f=y.clamp((this.left+c-this.right)/2,0,c),m=y.clamp((this.top+h-this.bottom)/2,0,h);return new y.Point(f,m)},Pa.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},Pa.prototype.clone=function(){return new Pa(this.top,this.bottom,this.left,this.right)},Pa.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ta=function(c,h,f,m,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=f==null?0:f,this._maxPitch=m==null?60:m,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pa,this._posMatrixCache={},this._alignedPosMatrixCache={}},wo={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ta.prototype.clone=function(){var c=new Ta(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},wo.minZoom.get=function(){return this._minZoom},wo.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},wo.maxZoom.get=function(){return this._maxZoom},wo.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},wo.minPitch.get=function(){return this._minPitch},wo.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},wo.maxPitch.get=function(){return this._maxPitch},wo.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},wo.renderWorldCopies.get=function(){return this._renderWorldCopies},wo.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},wo.worldSize.get=function(){return this.tileSize*this.scale},wo.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},wo.size.get=function(){return new y.Point(this.width,this.height)},wo.bearing.get=function(){return-this.angle/Math.PI*180},wo.bearing.set=function(c){var h=-y.wrap(c,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},wo.pitch.get=function(){return this._pitch/Math.PI*180},wo.pitch.set=function(c){var h=y.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},wo.fov.get=function(){return this._fov/Math.PI*180},wo.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},wo.zoom.get=function(){return this._zoom},wo.zoom.set=function(c){var h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},wo.center.get=function(){return this._center},wo.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},wo.padding.get=function(){return this._edgeInsets.toJSON()},wo.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},wo.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ta.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Ta.prototype.interpolatePadding=function(c,h,f){this._unmodified=!1,this._edgeInsets.interpolate(c,h,f),this._constrain(),this._calcMatrices()},Ta.prototype.coveringZoomLevel=function(c){var h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)},Ta.prototype.getVisibleUnwrappedCoordinates=function(c){var h=[new y.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new y.Point(0,0)),m=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),I=this.pointCoordinate(new y.Point(0,this.height)),P=Math.floor(Math.min(f.x,m.x,S.x,I.x)),B=Math.floor(Math.max(f.x,m.x,S.x,I.x)),Y=P-1;Y<=B+1;Y++)Y!==0&&h.push(new y.UnwrappedTileID(Y,c));return h},Ta.prototype.coveringTiles=function(c){var h=this.coveringZoomLevel(c),f=h;if(c.minzoom!==void 0&&h<c.minzoom)return[];c.maxzoom!==void 0&&h>c.maxzoom&&(h=c.maxzoom);var m=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,h),I=[S*m.x,S*m.y,0],P=Bs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),B=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=h);var Y=function(pn){return{aabb:new Uc([pn*S,0,0],[(pn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:pn,fullyVisible:!1}},te=[],xe=[],Ce=h,Me=c.reparseOverscaled?f:h;if(this._renderWorldCopies)for(var et=1;et<=3;et++)te.push(Y(-et)),te.push(Y(et));for(te.push(Y(0));te.length>0;){var Ne=te.pop(),ct=Ne.x,je=Ne.y,ht=Ne.fullyVisible;if(!ht){var Et=Ne.aabb.intersects(P);if(Et===0)continue;ht=Et===2}var Wt=Ne.aabb.distanceX(I),vr=Ne.aabb.distanceY(I),rr=Math.max(Math.abs(Wt),Math.abs(vr));if(Ne.zoom===Ce||rr>3+(1<<Ce-Ne.zoom)-2&&Ne.zoom>=B)xe.push({tileID:new y.OverscaledTileID(Ne.zoom===Ce?Me:Ne.zoom,Ne.wrap,Ne.zoom,ct,je),distanceSq:y.sqrLen([I[0]-.5-ct,I[1]-.5-je])});else for(var Ar=0;Ar<4;Ar++){var Xr=(ct<<1)+Ar%2,bn=(je<<1)+(Ar>>1);te.push({aabb:Ne.aabb.quadrant(Ar),zoom:Ne.zoom+1,x:Xr,y:bn,wrap:Ne.wrap,fullyVisible:ht})}}return xe.sort(function(pn,Vn){return pn.distanceSq-Vn.distanceSq}).map(function(pn){return pn.tileID})},Ta.prototype.resize=function(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()},wo.unmodified.get=function(){return this._unmodified},Ta.prototype.zoomScale=function(c){return Math.pow(2,c)},Ta.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Ta.prototype.project=function(c){var h=y.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(c.lng)*this.worldSize,y.mercatorYfromLat(h)*this.worldSize)},Ta.prototype.unproject=function(c){return new y.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},wo.point.get=function(){return this.project(this.center)},Ta.prototype.setLocationAtPoint=function(c,h){var f=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),I=new y.MercatorCoordinate(S.x-(f.x-m.x),S.y-(f.y-m.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())},Ta.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Ta.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Ta.prototype.locationCoordinate=function(c){return y.MercatorCoordinate.fromLngLat(c)},Ta.prototype.coordinateLocation=function(c){return c.toLngLat()},Ta.prototype.pointCoordinate=function(c){var h=[c.x,c.y,0,1],f=[c.x,c.y,1,1];y.transformMat4(h,h,this.pixelMatrixInverse),y.transformMat4(f,f,this.pixelMatrixInverse);var m=h[3],S=f[3],I=h[1]/m,P=f[1]/S,B=h[2]/m,Y=f[2]/S,te=B===Y?0:(0-B)/(Y-B);return new y.MercatorCoordinate(y.number(h[0]/m,f[0]/S,te)/this.worldSize,y.number(I,P,te)/this.worldSize)},Ta.prototype.coordinatePoint=function(c){var h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(h,h,this.pixelMatrix),new y.Point(h[0]/h[3],h[1]/h[3])},Ta.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Ta.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ta.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ta.prototype.calculatePosMatrix=function(c,h){h===void 0&&(h=!1);var f=c.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var S=c.canonical,I=this.worldSize/this.zoomScale(S.z),P=S.x+Math.pow(2,S.z)*c.wrap,B=y.identity(new Float64Array(16));return y.translate(B,B,[P*I,S.y*I,0]),y.scale(B,B,[I/y.EXTENT,I/y.EXTENT,1]),y.multiply(B,h?this.alignedProjMatrix:this.projMatrix,B),m[f]=new Float32Array(B),m[f]},Ta.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ta.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,h,f,m,S=-90,I=90,P=-180,B=180,Y=this.size,te=this._unmodified;if(this.latRange){var xe=this.latRange;S=y.mercatorYfromLat(xe[1])*this.worldSize,c=(I=y.mercatorYfromLat(xe[0])*this.worldSize)-S<Y.y?Y.y/(I-S):0}if(this.lngRange){var Ce=this.lngRange;P=y.mercatorXfromLng(Ce[0])*this.worldSize,h=(B=y.mercatorXfromLng(Ce[1])*this.worldSize)-P<Y.x?Y.x/(B-P):0}var Me=this.point,et=Math.max(h||0,c||0);if(et)return this.center=this.unproject(new y.Point(h?(B+P)/2:Me.x,c?(I+S)/2:Me.y)),this.zoom+=this.scaleZoom(et),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var Ne=Me.y,ct=Y.y/2;Ne-ct<S&&(m=S+ct),Ne+ct>I&&(m=I-ct)}if(this.lngRange){var je=Me.x,ht=Y.x/2;je-ht<P&&(f=P+ht),je+ht>B&&(f=B-ht)}f===void 0&&m===void 0||(this.center=this.unproject(new y.Point(f!==void 0?f:Me.x,m!==void 0?m:Me.y))),this._unmodified=te,this._constraining=!1}},Ta.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-h-f,.01,Math.PI-.01)),S=this.point,I=S.x,P=S.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),Y=this.height/50,te=new Float64Array(16);y.perspective(te,this._fov,this.width/this.height,Y,B),te[8]=2*-c.x/this.width,te[9]=2*c.y/this.height,y.scale(te,te,[1,-1,1]),y.translate(te,te,[0,0,-this.cameraToCenterDistance]),y.rotateX(te,te,this._pitch),y.rotateZ(te,te,this.angle),y.translate(te,te,[-I,-P,0]),this.mercatorMatrix=y.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),y.scale(te,te,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=y.invert([],this.projMatrix);var xe=this.width%2/2,Ce=this.height%2/2,Me=Math.cos(this.angle),et=Math.sin(this.angle),Ne=I-Math.round(I)+Me*xe+et*Ce,ct=P-Math.round(P)+Me*Ce+et*xe,je=new Float64Array(te);if(y.translate(je,je,[Ne>.5?Ne-1:Ne,ct>.5?ct-1:ct,0]),this.alignedProjMatrix=je,te=y.create(),y.scale(te,te,[this.width/2,-this.height/2,1]),y.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=y.create(),y.scale(te,te,[1,-1,1]),y.translate(te,te,[-1,-1,0]),y.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ta.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new y.Point(0,0)),h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ta.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,c))},Ta.prototype.getCameraQueryGeometry=function(c){var h=this.getCameraPoint();if(c.length===1)return[c[0],h];for(var f=h.x,m=h.y,S=h.x,I=h.y,P=0,B=c;P<B.length;P+=1){var Y=B[P];f=Math.min(f,Y.x),m=Math.min(m,Y.y),S=Math.max(S,Y.x),I=Math.max(I,Y.y)}return[new y.Point(f,m),new y.Point(S,m),new y.Point(S,I),new y.Point(f,I),new y.Point(f,m)]},Object.defineProperties(Ta.prototype,wo);var vu=function(c){var h,f,m,S;this._hashName=c&&encodeURIComponent(c),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),f=!1,m=null,S=function(){m=null,f&&(h(),m=setTimeout(S,300),f=!1)},function(){return f=!0,m||S(),m})};vu.prototype.addTo=function(c){return this._map=c,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},vu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},vu.prototype.getHashString=function(c){var h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,m),I=Math.round(h.lng*S)/S,P=Math.round(h.lat*S)/S,B=this._map.getBearing(),Y=this._map.getPitch(),te="";if(te+=c?"/"+I+"/"+P+"/"+f:f+"/"+P+"/"+I,(B||Y)&&(te+="/"+Math.round(10*B)/10),Y&&(te+="/"+Math.round(Y)),this._hashName){var xe=this._hashName,Ce=!1,Me=y.window.location.hash.slice(1).split("&").map(function(et){var Ne=et.split("=")[0];return Ne===xe?(Ce=!0,Ne+"="+te):et}).filter(function(et){return et});return Ce||Me.push(xe+"="+te),"#"+Me.join("&")}return"#"+te},vu.prototype._getCurrentHash=function(){var c,h=this,f=y.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===h._hashName&&(c=m)}),(c&&c[1]||"").split("/")):f.split("/")},vu.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:h,pitch:+(c[4]||0)}),!0}return!1},vu.prototype._updateHashUnthrottled=function(){var c=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,c)}catch(h){}};var df={linearity:.3,easing:y.bezier(0,0,.3,1)},tc=y.extend({deceleration:2500,maxSpeed:1400},df),hh=y.extend({deceleration:20,maxSpeed:1400},df),Qa=y.extend({deceleration:1e3,maxSpeed:360},df),vf=y.extend({deceleration:1e3,maxSpeed:90},df),Bl=function(c){this._map=c,this.clear()};function yc(c,h){(!c.duration||c.duration<h.duration)&&(c.duration=h.duration,c.easing=h.easing)}function rc(c,h,f){var m=f.maxSpeed,S=f.linearity,I=f.deceleration,P=y.clamp(c*S/(h/1e3),-m,m),B=Math.abs(P)/(I*S);return{easing:f.easing,duration:1e3*B,amount:P*(B/2)}}Bl.prototype.clear=function(){this._inertiaBuffer=[]},Bl.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:c})},Bl.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,h=y.browser.now();c.length>0&&h-c[0].time>160;)c.shift()},Bl.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var S=m[f].settings;h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround)}var I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var B=rc(h.pan.mag(),I,y.extend({},tc,c||{}));P.offset=h.pan.mult(B.amount/h.pan.mag()),P.center=this._map.transform.center,yc(P,B)}if(h.zoom){var Y=rc(h.zoom,I,hh);P.zoom=this._map.transform.zoom+Y.amount,yc(P,Y)}if(h.bearing){var te=rc(h.bearing,I,Qa);P.bearing=this._map.transform.bearing+y.clamp(te.amount,-179,179),yc(P,te)}if(h.pitch){var xe=rc(h.pitch,I,vf);P.pitch=this._map.transform.pitch+xe.amount,yc(P,xe)}if(P.zoom||P.bearing){var Ce=h.pinchAround===void 0?h.around:h.pinchAround;P.around=Ce?this._map.unproject(Ce):this._map.getCenter()}return this.clear(),y.extend(P,{noMoveStart:!0})}};var hs=function(c){function h(m,S,I,P){P===void 0&&(P={});var B=K.mousePos(S.getCanvasContainer(),I),Y=S.unproject(B);c.call(this,m,y.extend({point:B,lngLat:Y,originalEvent:I},P)),this._defaultPrevented=!1,this.target=S}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),Qu=function(c){function h(m,S,I){var P=m==="touchend"?I.changedTouches:I.touches,B=K.touchPos(S.getCanvasContainer(),P),Y=B.map(function(Ce){return S.unproject(Ce)}),te=B.reduce(function(Ce,Me,et,Ne){return Ce.add(Me.div(Ne.length))},new y.Point(0,0)),xe=S.unproject(te);c.call(this,m,{points:B,point:te,lngLats:Y,lngLat:xe,originalEvent:I}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),mf=function(c){function h(m,S,I){c.call(this,m,{originalEvent:I}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),Do=function(c,h){this._map=c,this._clickTolerance=h.clickTolerance};Do.prototype.reset=function(){delete this._mousedownPos},Do.prototype.wheel=function(c){return this._firePreventable(new mf(c.type,this._map,c))},Do.prototype.mousedown=function(c,h){return this._mousedownPos=h,this._firePreventable(new hs(c.type,this._map,c))},Do.prototype.mouseup=function(c){this._map.fire(new hs(c.type,this._map,c))},Do.prototype.click=function(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new hs(c.type,this._map,c))},Do.prototype.dblclick=function(c){return this._firePreventable(new hs(c.type,this._map,c))},Do.prototype.mouseover=function(c){this._map.fire(new hs(c.type,this._map,c))},Do.prototype.mouseout=function(c){this._map.fire(new hs(c.type,this._map,c))},Do.prototype.touchstart=function(c){return this._firePreventable(new Qu(c.type,this._map,c))},Do.prototype.touchmove=function(c){this._map.fire(new Qu(c.type,this._map,c))},Do.prototype.touchend=function(c){this._map.fire(new Qu(c.type,this._map,c))},Do.prototype.touchcancel=function(c){this._map.fire(new Qu(c.type,this._map,c))},Do.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Do.prototype.isEnabled=function(){return!0},Do.prototype.isActive=function(){return!1},Do.prototype.enable=function(){},Do.prototype.disable=function(){};var Jn=function(c){this._map=c};Jn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Jn.prototype.mousemove=function(c){this._map.fire(new hs(c.type,this._map,c))},Jn.prototype.mousedown=function(){this._delayContextMenu=!0},Jn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Jn.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new hs(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},Jn.prototype.isEnabled=function(){return!0},Jn.prototype.isActive=function(){return!1},Jn.prototype.enable=function(){},Jn.prototype.disable=function(){};var jo=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1};function Zc(c,h){for(var f={},m=0;m<c.length;m++)f[c[m].identifier]=h[m];return f}jo.prototype.isEnabled=function(){return!!this._enabled},jo.prototype.isActive=function(){return!!this._active},jo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},jo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},jo.prototype.mousedown=function(c,h){this.isEnabled()&&c.shiftKey&&c.button===0&&(K.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},jo.prototype.mousemoveWindow=function(c,h){if(this._active){var f=h;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=K.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(m.x,f.x),I=Math.max(m.x,f.x),P=Math.min(m.y,f.y),B=Math.max(m.y,f.y);K.setTransform(this._box,"translate("+S+"px,"+P+"px)"),this._box.style.width=I-S+"px",this._box.style.height=B-P+"px"}}},jo.prototype.mouseupWindow=function(c,h){var f=this;if(this._active&&c.button===0){var m=this._startPos,S=h;if(this.reset(),K.suppressClick(),m.x!==S.x||m.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(I){return I.fitScreenCoordinates(m,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},jo.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},jo.prototype.blur=function(){this.reset()},jo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos},jo.prototype._fireEvent=function(c,h){return this._map.fire(new y.Event(c,{originalEvent:h}))};var gf=function(c){this.reset(),this.numTouches=c.numTouches};gf.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},gf.prototype.touchstart=function(c,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){for(var S=new y.Point(0,0),I=0,P=m;I<P.length;I+=1)S._add(P[I]);return S.div(m.length)}(h),this.touches=Zc(f,h)))},gf.prototype.touchmove=function(c,h,f){if(!this.aborted&&this.centroid){var m=Zc(f,h);for(var S in this.touches){var I=m[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}},gf.prototype.touchend=function(c,h,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var Ja=function(c){this.singleTap=new gf(c),this.numTaps=c.numTaps,this.reset()};Ja.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ja.prototype.touchstart=function(c,h,f){this.singleTap.touchstart(c,h,f)},Ja.prototype.touchmove=function(c,h,f){this.singleTap.touchmove(c,h,f)},Ja.prototype.touchend=function(c,h,f){var m=this.singleTap.touchend(c,h,f);if(m){var S=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(m)<30;if(S&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var Lu=function(){this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()};Lu.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Lu.prototype.touchstart=function(c,h,f){this._zoomIn.touchstart(c,h,f),this._zoomOut.touchstart(c,h,f)},Lu.prototype.touchmove=function(c,h,f){this._zoomIn.touchmove(c,h,f),this._zoomOut.touchmove(c,h,f)},Lu.prototype.touchend=function(c,h,f){var m=this,S=this._zoomIn.touchend(c,h,f),I=this._zoomOut.touchend(c,h,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(S)},{originalEvent:c})}}):I?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(I)},{originalEvent:c})}}):void 0},Lu.prototype.touchcancel=function(){this.reset()},Lu.prototype.enable=function(){this._enabled=!0},Lu.prototype.disable=function(){this._enabled=!1,this.reset()},Lu.prototype.isEnabled=function(){return this._enabled},Lu.prototype.isActive=function(){return this._active};var _c={0:1,2:2},In=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};In.prototype.blur=function(){this.reset()},In.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},In.prototype._correctButton=function(c,h){return!1},In.prototype._move=function(c,h){return{}},In.prototype.mousedown=function(c,h){if(!this._lastPoint){var f=K.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=h,this._eventButton=f)}},In.prototype.mousemoveWindow=function(c,h){var f=this._lastPoint;if(f){if(c.preventDefault(),function(m,S){var I=_c[S];return m.buttons===void 0||(m.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(f,h)}},In.prototype.mouseupWindow=function(c){this._lastPoint&&K.mouseButton(c)===this._eventButton&&(this._moved&&K.suppressClick(),this.reset())},In.prototype.enable=function(){this._enabled=!0},In.prototype.disable=function(){this._enabled=!1,this.reset()},In.prototype.isEnabled=function(){return this._enabled},In.prototype.isActive=function(){return this._active};var yf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.mousedown=function(f,m){c.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},h.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},h}(In),ph=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=.8*(m.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(In),wl=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=-.5*(m.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(In),co=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};co.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},co.prototype.touchstart=function(c,h,f){return this._calculateTransform(c,h,f)},co.prototype.touchmove=function(c,h,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,h,f)},co.prototype.touchend=function(c,h,f){this._calculateTransform(c,h,f),this._active&&f.length<this._minTouches&&this.reset()},co.prototype.touchcancel=function(){this.reset()},co.prototype._calculateTransform=function(c,h,f){f.length>0&&(this._active=!0);var m=Zc(f,h),S=new y.Point(0,0),I=new y.Point(0,0),P=0;for(var B in m){var Y=m[B],te=this._touches[B];te&&(S._add(Y),I._add(Y.sub(te)),P++,m[B]=Y)}if(this._touches=m,!(P<this._minTouches)&&I.mag()){var xe=I.div(P);if(this._sum._add(xe),!(this._sum.mag()<this._clickTolerance))return{around:S.div(P),panDelta:xe}}},co.prototype.enable=function(){this._enabled=!0},co.prototype.disable=function(){this._enabled=!1,this.reset()},co.prototype.isEnabled=function(){return this._enabled},co.prototype.isActive=function(){return this._active};var mu=function(){this.reset()};function Ua(c,h,f){for(var m=0;m<c.length;m++)if(c[m].identifier===f)return h[m]}function Nl(c,h){return Math.log(c/h)/Math.LN2}mu.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},mu.prototype._start=function(c){},mu.prototype._move=function(c,h,f){return{}},mu.prototype.touchstart=function(c,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))},mu.prototype.touchmove=function(c,h,f){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,S=m[1],I=Ua(f,h,m[0]),P=Ua(f,h,S);if(I&&P){var B=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],B,c)}}},mu.prototype.touchend=function(c,h,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,S=m[1],I=Ua(f,h,m[0]),P=Ua(f,h,S);I&&P||(this._active&&K.suppressClick(),this.reset())}},mu.prototype.touchcancel=function(){this.reset()},mu.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},mu.prototype.disable=function(){this._enabled=!1,this.reset()},mu.prototype.isEnabled=function(){return this._enabled},mu.prototype.isActive=function(){return this._active};var Tu=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Nl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nl(this._distance,S),pinchAround:m}},h}(mu);function zl(c,h){return 180*c.angleWith(h)/Math.PI}var Hf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zl(this._vector,S),pinchAround:m}},h.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,S=zl(f,this._startVector);return Math.abs(S)<m},h}(mu);function Vc(c){return Math.abs(c.y)>Math.abs(c.x)}var yp=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(f){this._lastPoints=f,Vc(f[0].sub(f[1]))&&(this._valid=!1)},h.prototype._move=function(f,m,S){var I=f[0].sub(this._lastPoints[0]),P=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(I,P,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(I.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(f,m,S){if(this._valid!==void 0)return this._valid;var I=f.mag()>=2,P=m.mag()>=2;if(I||P){if(!I||!P)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var B=f.y>0==m.y>0;return Vc(f)&&Vc(m)&&B}},h}(mu),xi={panStep:100,bearingStep:15,pitchStep:10},cl=function(){var c=xi;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function qs(c){return c*(2-c)}cl.prototype.blur=function(){this.reset()},cl.prototype.reset=function(){this._active=!1},cl.prototype.keydown=function(c){var h=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,m=0,S=0,I=0,P=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),I=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),I=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),P=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,S=0),{cameraAnimation:function(B){var Y=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:qs,zoom:f?Math.round(Y)+f*(c.shiftKey?2:1):Y,bearing:B.getBearing()+m*h._bearingStep,pitch:B.getPitch()+S*h._pitchStep,offset:[-I*h._panStep,-P*h._panStep],center:B.getCenter()},{originalEvent:c})}}}},cl.prototype.enable=function(){this._enabled=!0},cl.prototype.disable=function(){this._enabled=!1,this.reset()},cl.prototype.isEnabled=function(){return this._enabled},cl.prototype.isActive=function(){return this._active},cl.prototype.disableRotation=function(){this._rotationDisabled=!0},cl.prototype.enableRotation=function(){this._rotationDisabled=!1};var pa=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};pa.prototype.setZoomRate=function(c){this._defaultZoomRate=c},pa.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},pa.prototype.isEnabled=function(){return!!this._enabled},pa.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},pa.prototype.isZooming=function(){return!!this._zooming},pa.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},pa.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},pa.prototype.wheel=function(c){if(this.isEnabled()){var h=c.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=y.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}},pa.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},pa.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=K.mousePos(this._el,c);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},pa.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var S=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(S*m))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var I,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,B=this._startZoom,Y=this._easing,te=!1;if(this._type==="wheel"&&B&&Y){var xe=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Ce=Y(xe);I=y.number(B,P,Ce),xe<1?this._frameId||(this._frameId=!0):te=!0}else I=P,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:I-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},pa.prototype._smoothOutEasing=function(c){var h=y.ease;if(this._prevEase){var f=this._prevEase,m=(y.browser.now()-f.start)/f.duration,S=f.easing(m+.01)-f.easing(m),I=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-I*I);h=y.bezier(I,P,.25,1)}return this._prevEase={start:y.browser.now(),duration:c,easing:h},h},pa.prototype.blur=function(){this.reset()},pa.prototype.reset=function(){this._active=!1};var fl=function(c,h){this._clickZoom=c,this._tapZoom=h};fl.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},fl.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},fl.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},fl.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var gu=function(){this.reset()};gu.prototype.reset=function(){this._active=!1},gu.prototype.blur=function(){this.reset()},gu.prototype.dblclick=function(c,h){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(h)},{originalEvent:c})}}},gu.prototype.enable=function(){this._enabled=!0},gu.prototype.disable=function(){this._enabled=!1,this.reset()},gu.prototype.isEnabled=function(){return this._enabled},gu.prototype.isActive=function(){return this._active};var Ns=function(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()};Ns.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ns.prototype.touchstart=function(c,h,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=h[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,h,f))},Ns.prototype.touchmove=function(c,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=h[0],S=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,f)},Ns.prototype.touchend=function(c,h,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,h,f)&&(this._tapTime=c.timeStamp)},Ns.prototype.touchcancel=function(){this.reset()},Ns.prototype.enable=function(){this._enabled=!0},Ns.prototype.disable=function(){this._enabled=!1,this.reset()},Ns.prototype.isEnabled=function(){return this._enabled},Ns.prototype.isActive=function(){return this._active};var _f=function(c,h,f){this._el=c,this._mousePan=h,this._touchPan=f};_f.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},_f.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},_f.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},_f.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var xc=function(c,h,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f};xc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},xc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},xc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},xc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Mu=function(c,h,f,m){this._el=c,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};Mu.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Mu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Mu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Mu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Mu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Mu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var yu=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Ju=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h}(y.Event);function Ei(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var vi=function(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bl(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),y.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[y.window,"blur",void 0]];for(var m=0,S=this._listeners;m<S.length;m+=1){var I=S[m],P=I[0];K.addEventListener(P,I[1],P===y.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};vi.prototype.destroy=function(){for(var c=0,h=this._listeners;c<h.length;c+=1){var f=h[c],m=f[0];K.removeEventListener(m,f[1],m===y.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},vi.prototype._addDefaultHandlers=function(c){var h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new Do(h,c));var m=h.boxZoom=new jo(h,c);this._add("boxZoom",m);var S=new Lu,I=new gu;h.doubleClickZoom=new fl(I,S),this._add("tapZoom",S),this._add("clickZoom",I);var P=new Ns;this._add("tapDragZoom",P);var B=h.touchPitch=new yp;this._add("touchPitch",B);var Y=new ph(c),te=new wl(c);h.dragRotate=new xc(c,Y,te),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var xe=new yf(c),Ce=new co(c);h.dragPan=new _f(f,xe,Ce),this._add("mousePan",xe),this._add("touchPan",Ce,["touchZoom","touchRotate"]);var Me=new Hf,et=new Tu;h.touchZoomRotate=new Mu(f,et,Me,P),this._add("touchRotate",Me,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]);var Ne=h.scrollZoom=new pa(h,this);this._add("scrollZoom",Ne,["mousePan"]);var ct=h.keyboard=new cl;this._add("keyboard",ct),this._add("blockableMapEvent",new Jn(h));for(var je=0,ht=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];je<ht.length;je+=1){var Et=ht[je];c.interactive&&c[Et]&&h[Et].enable(c[Et])}},vi.prototype._add=function(c,h,f){this._handlers.push({handlerName:c,handler:h,allowed:f}),this._handlersById[c]=h},vi.prototype.stop=function(c){if(!this._updatingCamera){for(var h=0,f=this._handlers;h<f.length;h+=1)f[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},vi.prototype.isActive=function(){for(var c=0,h=this._handlers;c<h.length;c+=1)if(h[c].handler.isActive())return!0;return!1},vi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},vi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},vi.prototype.isMoving=function(){return Boolean(yu(this._eventsInProgress))||this.isZooming()},vi.prototype._blockedByActive=function(c,h,f){for(var m in c)if(m!==f&&(!h||h.indexOf(m)<0))return!0;return!1},vi.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},vi.prototype._getMapTouches=function(c){for(var h=[],f=0,m=c;f<m.length;f+=1){var S=m[f];this._el.contains(S.target)&&h.push(S)}return h},vi.prototype.handleEvent=function(c,h){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},S={},I={},P=c.touches?this._getMapTouches(c.touches):void 0,B=P?K.touchPos(this._el,P):K.mousePos(this._el,c),Y=0,te=this._handlers;Y<te.length;Y+=1){var xe=te[Y],Ce=xe.handlerName,Me=xe.handler,et=xe.allowed;if(Me.isEnabled()){var Ne=void 0;this._blockedByActive(I,et,Ce)?Me.reset():Me[h||c.type]&&(Ne=Me[h||c.type](c,B,P),this.mergeHandlerResult(m,S,Ne,Ce,f),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Me.isActive())&&(I[Ce]=Me)}}var ct={};for(var je in this._previousActiveHandlers)I[je]||(ct[je]=f);this._previousActiveHandlers=I,(Object.keys(ct).length||Ei(m))&&(this._changes.push([m,S,ct]),this._triggerRenderFrame()),(Object.keys(I).length||Ei(m))&&this._map._stop(!0),this._updatingCamera=!1;var ht=m.cameraAnimation;ht&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ht(this._map))},vi.prototype.mergeHandlerResult=function(c,h,f,m,S){if(f){y.extend(c,f);var I={handlerName:m,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(h.zoom=I),f.panDelta!==void 0&&(h.drag=I),f.pitchDelta!==void 0&&(h.pitch=I),f.bearingDelta!==void 0&&(h.rotate=I)}},vi.prototype._applyChanges=function(){for(var c={},h={},f={},m=0,S=this._changes;m<S.length;m+=1){var I=S[m],P=I[0],B=I[1],Y=I[2];P.panDelta&&(c.panDelta=(c.panDelta||new y.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(c.around=P.around),P.pinchAround!==void 0&&(c.pinchAround=P.pinchAround),P.noInertia&&(c.noInertia=P.noInertia),y.extend(h,B),y.extend(f,Y)}this._updateMapTransform(c,h,f),this._changes=[]},vi.prototype._updateMapTransform=function(c,h,f){var m=this._map,S=m.transform;if(!Ei(c))return this._fireEvents(h,f,!0);var I=c.panDelta,P=c.zoomDelta,B=c.bearingDelta,Y=c.pitchDelta,te=c.around,xe=c.pinchAround;xe!==void 0&&(te=xe),m._stop(!0),te=te||m.transform.centerPoint;var Ce=S.pointLocation(I?te.sub(I):te);B&&(S.bearing+=B),Y&&(S.pitch+=Y),P&&(S.zoom+=P),S.setLocationAtPoint(Ce,te),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,f,!0)},vi.prototype._fireEvents=function(c,h,f){var m=this,S=yu(this._eventsInProgress),I=yu(c),P={};for(var B in c)this._eventsInProgress[B]||(P[B+"start"]=c[B].originalEvent),this._eventsInProgress[B]=c[B];for(var Y in!S&&I&&this._fireEvent("movestart",I.originalEvent),P)this._fireEvent(Y,P[Y]);for(var te in I&&this._fireEvent("move",I.originalEvent),c)this._fireEvent(te,c[te].originalEvent);var xe,Ce={};for(var Me in this._eventsInProgress){var et=this._eventsInProgress[Me],Ne=et.handlerName,ct=et.originalEvent;this._handlersById[Ne].isActive()||(delete this._eventsInProgress[Me],Ce[Me+"end"]=xe=h[Ne]||ct)}for(var je in Ce)this._fireEvent(je,Ce[je]);var ht=yu(this._eventsInProgress);if(f&&(S||I)&&!ht){this._updatingCamera=!0;var Et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wt=function(vr){return vr!==0&&-m._bearingSnap<vr&&vr<m._bearingSnap};Et?(Wt(Et.bearing||this._map.getBearing())&&(Et.bearing=0),this._map.easeTo(Et,{originalEvent:xe})):(this._map.fire(new y.Event("moveend",{originalEvent:xe})),Wt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},vi.prototype._fireEvent=function(c,h){this._map.fire(new y.Event(c,h?{originalEvent:h}:{}))},vi.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete c._frameId,c.handleEvent(new Ju("renderFrame",{timeStamp:h})),c._applyChanges()})},vi.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Wf=function(c){function h(f,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},h.prototype.panBy=function(f,m,S){return f=y.Point.convert(f).mult(-1),this.panTo(this.transform.center,y.extend({offset:f},m),S)},h.prototype.panTo=function(f,m,S){return this.easeTo(y.extend({center:f},m),S)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},h.prototype.zoomTo=function(f,m,S){return this.easeTo(y.extend({zoom:f},m),S)},h.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},h.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},h.prototype.rotateTo=function(f,m,S){return this.easeTo(y.extend({bearing:f},m),S)},h.prototype.resetNorth=function(f,m){return this.rotateTo(0,y.extend({duration:1e3},f),m),this},h.prototype.resetNorthPitch=function(f,m){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},f),m),this},h.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},h.prototype.cameraForBounds=function(f,m){f=y.LngLatBounds.convert(f);var S=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,m)},h.prototype._cameraForBoxAndBearing=function(f,m,S,I){var P={top:0,bottom:0,right:0,left:0};if(typeof(I=y.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){var B=I.padding;I.padding={top:B,bottom:B,right:B,left:B}}I.padding=y.extend(P,I.padding);var Y=this.transform,te=Y.padding,xe=Y.project(y.LngLat.convert(f)),Ce=Y.project(y.LngLat.convert(m)),Me=xe.rotate(-S*Math.PI/180),et=Ce.rotate(-S*Math.PI/180),Ne=new y.Point(Math.max(Me.x,et.x),Math.max(Me.y,et.y)),ct=new y.Point(Math.min(Me.x,et.x),Math.min(Me.y,et.y)),je=Ne.sub(ct),ht=(Y.width-(te.left+te.right+I.padding.left+I.padding.right))/je.x,Et=(Y.height-(te.top+te.bottom+I.padding.top+I.padding.bottom))/je.y;if(!(Et<0||ht<0)){var Wt=Math.min(Y.scaleZoom(Y.scale*Math.min(ht,Et)),I.maxZoom),vr=typeof I.offset.x=="number"?new y.Point(I.offset.x,I.offset.y):y.Point.convert(I.offset),rr=new y.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),Ar=vr.add(rr).mult(Y.scale/Y.zoomScale(Wt));return{center:Y.unproject(xe.add(Ce).div(2).sub(Ar)),zoom:Wt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(f,m,S){return this._fitInternal(this.cameraForBounds(f,m),m,S)},h.prototype.fitScreenCoordinates=function(f,m,S,I,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(f)),this.transform.pointLocation(y.Point.convert(m)),S,I),I,P)},h.prototype._fitInternal=function(f,m,S){return f?(delete(m=y.extend(f,m)).padding,m.linear?this.easeTo(m,S):this.flyTo(m,S)):this},h.prototype.jumpTo=function(f,m){this.stop();var S=this.transform,I=!1,P=!1,B=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(I=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=y.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(P=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(B=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new y.Event("movestart",m)).fire(new y.Event("move",m)),I&&this.fire(new y.Event("zoomstart",m)).fire(new y.Event("zoom",m)).fire(new y.Event("zoomend",m)),P&&this.fire(new y.Event("rotatestart",m)).fire(new y.Event("rotate",m)).fire(new y.Event("rotateend",m)),B&&this.fire(new y.Event("pitchstart",m)).fire(new y.Event("pitch",m)).fire(new y.Event("pitchend",m)),this.fire(new y.Event("moveend",m))},h.prototype.easeTo=function(f,m){var S=this;this._stop(!1,f.easeId),((f=y.extend({offset:[0,0],duration:500,easing:y.ease},f)).animate===!1||!f.essential&&y.browser.prefersReducedMotion)&&(f.duration=0);var I=this.transform,P=this.getZoom(),B=this.getBearing(),Y=this.getPitch(),te=this.getPadding(),xe="zoom"in f?+f.zoom:P,Ce="bearing"in f?this._normalizeBearing(f.bearing,B):B,Me="pitch"in f?+f.pitch:Y,et="padding"in f?f.padding:I.padding,Ne=y.Point.convert(f.offset),ct=I.centerPoint.add(Ne),je=I.pointLocation(ct),ht=y.LngLat.convert(f.center||je);this._normalizeCenter(ht);var Et,Wt,vr=I.project(je),rr=I.project(ht).sub(vr),Ar=I.zoomScale(xe-P);f.around&&(Et=y.LngLat.convert(f.around),Wt=I.locationPoint(Et));var Xr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||xe!==P,this._rotating=this._rotating||B!==Ce,this._pitching=this._pitching||Me!==Y,this._padding=!I.isPaddingEqual(et),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,Xr),this._ease(function(bn){if(S._zooming&&(I.zoom=y.number(P,xe,bn)),S._rotating&&(I.bearing=y.number(B,Ce,bn)),S._pitching&&(I.pitch=y.number(Y,Me,bn)),S._padding&&(I.interpolatePadding(te,et,bn),ct=I.centerPoint.add(Ne)),Et)I.setLocationAtPoint(Et,Wt);else{var pn=I.zoomScale(I.zoom-P),Vn=xe>P?Math.min(2,Ar):Math.max(.5,Ar),bi=Math.pow(Vn,1-bn),Ti=I.unproject(vr.add(rr.mult(bn*bi)).mult(pn));I.setLocationAtPoint(I.renderWorldCopies?Ti.wrap():Ti,ct)}S._fireMoveEvents(m)},function(bn){S._afterEase(m,bn)},f),this},h.prototype._prepareEase=function(f,m,S){S===void 0&&(S={}),this._moving=!0,m||S.moving||this.fire(new y.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",f))},h.prototype._fireMoveEvents=function(f){this.fire(new y.Event("move",f)),this._zooming&&this.fire(new y.Event("zoom",f)),this._rotating&&this.fire(new y.Event("rotate",f)),this._pitching&&this.fire(new y.Event("pitch",f))},h.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var S=this._zooming,I=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",f)),I&&this.fire(new y.Event("rotateend",f)),P&&this.fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))}},h.prototype.flyTo=function(f,m){var S=this;if(!f.essential&&y.browser.prefersReducedMotion){var I=y.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(I,m)}this.stop(),f=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},f);var P=this.transform,B=this.getZoom(),Y=this.getBearing(),te=this.getPitch(),xe=this.getPadding(),Ce="zoom"in f?y.clamp(+f.zoom,P.minZoom,P.maxZoom):B,Me="bearing"in f?this._normalizeBearing(f.bearing,Y):Y,et="pitch"in f?+f.pitch:te,Ne="padding"in f?f.padding:P.padding,ct=P.zoomScale(Ce-B),je=y.Point.convert(f.offset),ht=P.centerPoint.add(je),Et=P.pointLocation(ht),Wt=y.LngLat.convert(f.center||Et);this._normalizeCenter(Wt);var vr=P.project(Et),rr=P.project(Wt).sub(vr),Ar=f.curve,Xr=Math.max(P.width,P.height),bn=Xr/ct,pn=rr.mag();if("minZoom"in f){var Vn=y.clamp(Math.min(f.minZoom,B,Ce),P.minZoom,P.maxZoom),bi=Xr/P.zoomScale(Vn-B);Ar=Math.sqrt(bi/pn*2)}var Ti=Ar*Ar;function Ai(zi){var Li=(bn*bn-Xr*Xr+(zi?-1:1)*Ti*Ti*pn*pn)/(2*(zi?bn:Xr)*Ti*pn);return Math.log(Math.sqrt(Li*Li+1)-Li)}function ba(zi){return(Math.exp(zi)-Math.exp(-zi))/2}function Wn(zi){return(Math.exp(zi)+Math.exp(-zi))/2}var Wi=Ai(0),na=function(zi){return Wn(Wi)/Wn(Wi+Ar*zi)},Xi=function(zi){return Xr*((Wn(Wi)*(ba(Li=Wi+Ar*zi)/Wn(Li))-ba(Wi))/Ti)/pn;var Li},Pi=(Ai(1)-Wi)/Ar;if(Math.abs(pn)<1e-6||!isFinite(Pi)){if(Math.abs(Xr-bn)<1e-6)return this.easeTo(f,m);var ia=bn<Xr?-1:1;Pi=Math.abs(Math.log(bn/Xr))/Ar,Xi=function(){return 0},na=function(zi){return Math.exp(ia*Ar*zi)}}return f.duration="duration"in f?+f.duration:1e3*Pi/("screenSpeed"in f?+f.screenSpeed/Ar:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=Y!==Me,this._pitching=et!==te,this._padding=!P.isPaddingEqual(Ne),this._prepareEase(m,!1),this._ease(function(zi){var Li=zi*Pi,vs=1/na(Li);P.zoom=zi===1?Ce:B+P.scaleZoom(vs),S._rotating&&(P.bearing=y.number(Y,Me,zi)),S._pitching&&(P.pitch=y.number(te,et,zi)),S._padding&&(P.interpolatePadding(xe,Ne,zi),ht=P.centerPoint.add(je));var fo=zi===1?Wt:P.unproject(vr.add(rr.mult(Xi(Li))).mult(vs));P.setLocationAtPoint(P.renderWorldCopies?fo.wrap():fo,ht),S._fireMoveEvents(m)},function(){return S._afterEase(m)},f),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,m)}if(!f){var I=this.handlers;I&&I.stop(!1)}return this},h.prototype._ease=function(f,m,S){S.animate===!1||S.duration===0?(f(1),m()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var f=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(f,m){f=y.wrap(f,-180,180);var S=Math.abs(f-m);return Math.abs(f-360-m)<S&&(f-=360),Math.abs(f+360-m)<S&&(f+=360),f},h.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var S=f.lng-m.center.lng;f.lng+=S>180?-360:S<-180?360:0}},h}(y.Evented),zs=function(c){c===void 0&&(c={}),this.options=c,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};zs.prototype.getDefaultPosition=function(){return"bottom-right"},zs.prototype.onAdd=function(c){var h=this.options&&this.options.compact;return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},zs.prototype.onRemove=function(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},zs.prototype._setElementTitle=function(c,h){var f=this._map._getUIString("AttributionControl."+h);c.title=f,c.setAttribute("aria-label",f)},zs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},zs.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(c){var f=h.reduce(function(m,S,I){return S.value&&(m+=S.key+"="+S.value+(I<h.length-1?"&":"")),m},"?");c.href=y.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},zs.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},zs.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(B){return typeof B!="string"?"":B})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var f=this._map.style.sourceCaches;for(var m in f){var S=f[m];if(S.used){var I=S.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort(function(B,Y){return B.length-Y.length});var P=(c=c.filter(function(B,Y){for(var te=Y+1;te<c.length;te++)if(c[te].indexOf(B)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,c.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},zs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var hl=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};hl.prototype.onAdd=function(c){this._map=c,this._container=K.create("div","mapboxgl-ctrl");var h=K.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},hl.prototype.onRemove=function(){K.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},hl.prototype.getDefaultPosition=function(){return"bottom-left"},hl.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},hl.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var h in c)if(c[h].getSource().mapbox_logo)return!0;return!1}},hl.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var $o=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};$o.prototype.add=function(c){var h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h},$o.prototype.remove=function(c){for(var h=this._currentlyRunning,f=0,m=h?this._queue.concat(h):this._queue;f<m.length;f+=1){var S=m[f];if(S.id===c)return void(S.cancelled=!0)}},$o.prototype.run=function(c){c===void 0&&(c=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=h;f<m.length;f+=1){var S=m[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},$o.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},dh=y.window.HTMLImageElement,xf=y.window.HTMLElement,Za=y.window.ImageBitmap,_o={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},vh=function(c){function h(m){var S=this;if((m=y.extend({},_o,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var I=new Ta(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,I,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new $o,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Tl,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new y.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=y.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof xf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new vi(this,m),this._hash=m.hash&&new vu(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,y.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new zs({customAttribution:m.customAttribution})),this.addControl(new hl,m.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(P){S._update(P.dataType==="style"),S.fire(new y.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){S.fire(new y.Event(P.dataType+"dataloading",P))})}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(m,S){if(S===void 0&&(S=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var I=m.onAdd(this);this._controls.push(m);var P=this._controlPositions[S];return S.indexOf("bottom")!==-1?P.insertBefore(I,P.firstChild):P.appendChild(I),this},h.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(m);return S>-1&&this._controls.splice(S,1),m.onRemove(this),this},h.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},h.prototype.resize=function(m){var S=this._containerDimensions(),I=S[0],P=S[1];if(I===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(I,P),this.transform.resize(I,P),this.painter.resize(I,P);var B=!this._moving;return B&&this.fire(new y.Event("movestart",m)).fire(new y.Event("move",m)),this.fire(new y.Event("resize",m)),B&&this.fire(new y.Event("moveend",m)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(y.LngLatBounds.convert(m)),this._update()},h.prototype.setMinZoom=function(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(m){if((m=m==null?60:m)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},h.prototype.project=function(m){return this.transform.locationPoint(y.LngLat.convert(m))},h.prototype.unproject=function(m){return this.transform.pointLocation(y.Point.convert(m))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(m,S,I){var P,B=this;if(m==="mouseenter"||m==="mouseover"){var Y=!1;return{layer:S,listener:I,delegates:{mousemove:function(xe){var Ce=B.getLayer(S)?B.queryRenderedFeatures(xe.point,{layers:[S]}):[];Ce.length?Y||(Y=!0,I.call(B,new hs(m,B,xe.originalEvent,{features:Ce}))):Y=!1},mouseout:function(){Y=!1}}}}if(m==="mouseleave"||m==="mouseout"){var te=!1;return{layer:S,listener:I,delegates:{mousemove:function(xe){(B.getLayer(S)?B.queryRenderedFeatures(xe.point,{layers:[S]}):[]).length?te=!0:te&&(te=!1,I.call(B,new hs(m,B,xe.originalEvent)))},mouseout:function(xe){te&&(te=!1,I.call(B,new hs(m,B,xe.originalEvent)))}}}}return{layer:S,listener:I,delegates:(P={},P[m]=function(xe){var Ce=B.getLayer(S)?B.queryRenderedFeatures(xe.point,{layers:[S]}):[];Ce.length&&(xe.features=Ce,I.call(B,xe),delete xe.features)},P)}},h.prototype.on=function(m,S,I){if(I===void 0)return c.prototype.on.call(this,m,S);var P=this._createDelegatedListener(m,S,I);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(P),P.delegates)this.on(B,P.delegates[B]);return this},h.prototype.once=function(m,S,I){if(I===void 0)return c.prototype.once.call(this,m,S);var P=this._createDelegatedListener(m,S,I);for(var B in P.delegates)this.once(B,P.delegates[B]);return this},h.prototype.off=function(m,S,I){var P=this;return I===void 0?c.prototype.off.call(this,m,S):(this._delegatedListeners&&this._delegatedListeners[m]&&function(B){for(var Y=B[m],te=0;te<Y.length;te++){var xe=Y[te];if(xe.layer===S&&xe.listener===I){for(var Ce in xe.delegates)P.off(Ce,xe.delegates[Ce]);return Y.splice(te,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(m,S){if(!this.style)return[];var I;if(S!==void 0||m===void 0||m instanceof y.Point||Array.isArray(m)||(S=m,m=void 0),S=S||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof m[0]=="number")I=[y.Point.convert(m)];else{var P=y.Point.convert(m[0]),B=y.Point.convert(m[1]);I=[P,new y.Point(B.x,P.y),B,new y.Point(P.x,B.y),P]}return this.style.queryRenderedFeatures(I,S,this.transform)},h.prototype.querySourceFeatures=function(m,S){return this.style.querySourceFeatures(m,S)},h.prototype.setStyle=function(m,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(m,S))},h.prototype._getUIString=function(m){var S=this._locale[m];if(S==null)throw new Error("Missing UI string '"+m+"'");return S},h.prototype._updateStyle=function(m,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Su(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Su(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(m,S){var I=this;if(typeof m=="string"){var P=this._requestManager.normalizeStyleURL(m),B=this._requestManager.transformRequest(P,y.ResourceType.Style);y.getJSON(B,function(Y,te){Y?I.fire(new y.ErrorEvent(Y)):te&&I._updateDiff(te,S)})}else typeof m=="object"&&this._updateDiff(m,S)},h.prototype._updateDiff=function(m,S){try{this.style.setState(m)&&this._update(!0)}catch(I){y.warnOnce("Unable to perform style diff: "+(I.message||I.error||I)+".  Rebuilding the style from scratch."),this._updateStyle(m,S)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(m,S){return this._lazyInitEmptyStyle(),this.style.addSource(m,S),this._update(!0)},h.prototype.isSourceLoaded=function(m){var S=this.style&&this.style.sourceCaches[m];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},h.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var S in m){var I=m[S]._tiles;for(var P in I){var B=I[P];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(m,S,I){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,S,I)},h.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},h.prototype.getSource=function(m){return this.style.getSource(m)},h.prototype.addImage=function(m,S,I){I===void 0&&(I={});var P=I.pixelRatio;P===void 0&&(P=1);var B=I.sdf;B===void 0&&(B=!1);var Y=I.stretchX,te=I.stretchY,xe=I.content;if(this._lazyInitEmptyStyle(),S instanceof dh||Za&&S instanceof Za){var Ce=y.browser.getImageData(S);this.style.addImage(m,{data:new y.RGBAImage({width:Ce.width,height:Ce.height},Ce.data),pixelRatio:P,stretchX:Y,stretchY:te,content:xe,sdf:B,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Me=S;this.style.addImage(m,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:P,stretchX:Y,stretchY:te,content:xe,sdf:B,version:0,userImage:Me}),Me.onAdd&&Me.onAdd(this,m)}},h.prototype.updateImage=function(m,S){var I=this.style.getImage(m);if(!I)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=S instanceof dh||Za&&S instanceof Za?y.browser.getImageData(S):S,B=P.width,Y=P.height,te=P.data;return B===void 0||Y===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==I.data.width||Y!==I.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(I.data.replace(te,!(S instanceof dh||Za&&S instanceof Za)),void this.style.updateImage(m,I))},h.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(m){this.style.removeImage(m)},h.prototype.loadImage=function(m,S){y.getImage(this._requestManager.transformRequest(m,y.ResourceType.Image),S)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(m,S){return this._lazyInitEmptyStyle(),this.style.addLayer(m,S),this._update(!0)},h.prototype.moveLayer=function(m,S){return this.style.moveLayer(m,S),this._update(!0)},h.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},h.prototype.getLayer=function(m){return this.style.getLayer(m)},h.prototype.setLayerZoomRange=function(m,S,I){return this.style.setLayerZoomRange(m,S,I),this._update(!0)},h.prototype.setFilter=function(m,S,I){return I===void 0&&(I={}),this.style.setFilter(m,S,I),this._update(!0)},h.prototype.getFilter=function(m){return this.style.getFilter(m)},h.prototype.setPaintProperty=function(m,S,I,P){return P===void 0&&(P={}),this.style.setPaintProperty(m,S,I,P),this._update(!0)},h.prototype.getPaintProperty=function(m,S){return this.style.getPaintProperty(m,S)},h.prototype.setLayoutProperty=function(m,S,I,P){return P===void 0&&(P={}),this.style.setLayoutProperty(m,S,I,P),this._update(!0)},h.prototype.getLayoutProperty=function(m,S){return this.style.getLayoutProperty(m,S)},h.prototype.setLight=function(m,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(m,S),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(m,S){return this.style.setFeatureState(m,S),this._update()},h.prototype.removeFeatureState=function(m,S){return this.style.removeFeatureState(m,S),this._update()},h.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var m=0,S=0;return this._container&&(m=this._container.clientWidth||400,S=this._container.clientHeight||300),[m,S]},h.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=K.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=K.create("div","mapboxgl-canvas-container",m);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=K.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var I=this._containerDimensions();this._resizeCanvas(I[0],I[1]);var P=this._controlContainer=K.create("div","mapboxgl-control-container",m),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Y){B[Y]=K.create("div","mapboxgl-ctrl-"+Y,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(m,S){var I=y.browser.devicePixelRatio||1;this._canvas.width=I*m,this._canvas.height=I*S,this._canvas.style.width=m+"px",this._canvas.style.height=S+"px"},h.prototype._setupPainter=function(){var m=y.extend({},Be.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);S?(this.painter=new Ao(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:m}))},h.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:m}))},h.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},h.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},h.prototype._render=function(m){var S,I=this,P=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,S),P=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var Y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,xe=y.browser.now();this.style.zoomHistory.update(te,xe);var Ce=new y.EvaluationParameters(te,{now:xe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Me=Ce.crossFadingFactor();Me===1&&Me===this._crossFadingFactor||(Y=!0,this._crossFadingFactor=Me),this.style.update(Ce)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||Y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var et=y.browser.now()-P;B.endQueryEXT(B.TIME_ELAPSED_EXT,S),setTimeout(function(){var je=B.getQueryObjectEXT(S,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(S),I.fire(new y.Event("gpu-timing-frame",{cpuTime:et,gpuTime:je}))},50)}if(this.listens("gpu-timing-layer")){var Ne=this.painter.collectGpuTimers();setTimeout(function(){var je=I.painter.queryGpuTimers(Ne);I.fire(new y.Event("gpu-timing-layer",{layerTimes:je}))},50)}var ct=this._sourcesDirty||this._styleDirty||this._placementDirty;return ct||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||ct||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,S=this._controls;m<S.length;m+=1)S[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var I=this.painter.context.gl.getExtension("WEBGL_lose_context");I&&I.loseContext(),Xf(this._canvasContainer),Xf(this._controlContainer),Xf(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},h.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){m._frame=null,m._render(S)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},h.prototype._setCacheLimits=function(m,S){y.setCacheLimits(m,S)},f.version.get=function(){return y.version},Object.defineProperties(h.prototype,f),h}(Wf);function Xf(c){c.parentNode&&c.parentNode.removeChild(c)}var pl={showCompass:!0,showZoom:!0,visualizePitch:!1},el=function(c){var h=this;this.options=y.extend({},pl,c),this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return h._map.zoomIn({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return h._map.zoomOut({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:f}):h._map.resetNorth({},{originalEvent:f})}),this._compassIcon=K.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};el.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),h=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},el.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},el.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $s(this._map,this._compass,this.options.visualizePitch)),this._container},el.prototype.onRemove=function(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},el.prototype._createButton=function(c,h){var f=K.create("button",c,this._container);return f.type="button",f.addEventListener("click",h),f},el.prototype._setButtonTitle=function(c,h){var f=this._map._getUIString("NavigationControl."+h);c.title=f,c.setAttribute("aria-label",f)};var $s=function(c,h,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new ph({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new wl({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),K.addEventListener(h,"mousedown",this.mousedown),K.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(h,"touchmove",this.touchmove),K.addEventListener(h,"touchend",this.touchend),K.addEventListener(h,"touchcancel",this.reset)};function dl(c,h,f){if(c=new y.LngLat(c.lng,c.lat),h){var m=new y.LngLat(c.lng-360,c.lat),S=new y.LngLat(c.lng+360,c.lat),I=f.locationPoint(c).distSqr(h);f.locationPoint(m).distSqr(h)<I?c=m:f.locationPoint(S).distSqr(h)<I&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var P=f.locationPoint(c);if(P.x>=0&&P.y>=0&&P.x<=f.width&&P.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}$s.prototype.down=function(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),K.disableDrag()},$s.prototype.move=function(c,h){var f=this.map,m=this.mouseRotate.mousemoveWindow(c,h);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,h);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},$s.prototype.off=function(){var c=this.element;K.removeEventListener(c,"mousedown",this.mousedown),K.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(c,"touchmove",this.touchmove),K.removeEventListener(c,"touchend",this.touchend),K.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},$s.prototype.offTemp=function(){K.enableDrag(),K.removeEventListener(y.window,"mousemove",this.mousemove),K.removeEventListener(y.window,"mouseup",this.mouseup)},$s.prototype.mousedown=function(c){this.down(y.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),K.mousePos(this.element,c)),K.addEventListener(y.window,"mousemove",this.mousemove),K.addEventListener(y.window,"mouseup",this.mouseup)},$s.prototype.mousemove=function(c){this.move(c,K.mousePos(this.element,c))},$s.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},$s.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},$s.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},$s.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},$s.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mh(c,h,f){var m=c.classList;for(var S in Ul)m.remove("mapboxgl-"+f+"-anchor-"+S);m.add("mapboxgl-"+f+"-anchor-"+h)}var Go,gh=function(c){function h(f,m){if(c.call(this),(f instanceof y.window.HTMLElement||m)&&(f=y.extend({element:f},m)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=y.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");var S=K.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");var P=K.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var B=K.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var Y=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Y<te.length;Y+=1){var xe=te[Y],Ce=K.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",xe.rx),Ce.setAttributeNS(null,"ry",xe.ry),B.appendChild(Ce)}var Me=K.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"fill",this._color);var et=K.createNS("http://www.w3.org/2000/svg","path");et.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Me.appendChild(et);var Ne=K.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"opacity","0.25"),Ne.setAttributeNS(null,"fill","#000000");var ct=K.createNS("http://www.w3.org/2000/svg","path");ct.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ne.appendChild(ct);var je=K.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(6.0, 7.0)"),je.setAttributeNS(null,"fill","#FFFFFF");var ht=K.createNS("http://www.w3.org/2000/svg","g");ht.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Et=K.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#000000"),Et.setAttributeNS(null,"opacity","0.25"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962");var Wt=K.createNS("http://www.w3.org/2000/svg","circle");Wt.setAttributeNS(null,"fill","#FFFFFF"),Wt.setAttributeNS(null,"cx","5.5"),Wt.setAttributeNS(null,"cy","5.5"),Wt.setAttributeNS(null,"r","5.4999962"),ht.appendChild(Et),ht.appendChild(Wt),P.appendChild(B),P.appendChild(Me),P.appendChild(Ne),P.appendChild(je),P.appendChild(ht),S.appendChild(P),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(vr){vr.preventDefault()}),this._element.addEventListener("mousedown",function(vr){vr.preventDefault()}),mh(this._element,this._anchor,"marker"),this._popup=null}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(f){var m=f.code,S=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&S!==32&&S!==13||this.togglePopup()},h.prototype._onMapClick=function(f){var m=f.originalEvent.target,S=this._element;this._popup&&(m===S||S.contains(m))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},h.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=dl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,Ul[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+m)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(f){return this._offset=y.Point.convert(f),this._update(),this},h.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(y.Evented),qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},jc=0,bf=!1,bc=function(c){function h(f){c.call(this),this.options=y.extend({},qh,f),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){var m;return this._map=f,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,Go!==void 0?m(Go):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){m(Go=S.state!=="denied")}):m(Go=!!y.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jc=0,bf=!1},h.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),S=f.coords;return m&&(S.longitude<m.getWest()||S.longitude>m.getEast()||S.latitude<m.getSouth()||S.latitude>m.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",f)),this._finish()}},h.prototype._updateCamera=function(f){var m=new y.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,I=this._map.getBearing(),P=y.extend({bearing:I},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(S),P,{geolocateSource:!0})},h.prototype._updateMarker=function(f){if(f){var m=new y.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),S=this._map.unproject([1,f]),I=m.distanceTo(S),P=Math.ceil(2*this._accuracy/I);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&bf)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",f)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=K.create("button","mapboxgl-ctrl-geolocate",this._container),K.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var I=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new gh(this._dotElement),this._circleElement=K.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||m._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new y.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jc--,bf=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++jc>1?(f={maximumAge:6e5,timeout:0},bf=!0):(f=this.options.positionOptions,bf=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(y.Evented),Zl={maxWidth:100,unit:"metric"},vl=function(c){this.options=y.extend({},Zl,c),y.bindAll(["_onMove","setUnit"],this)};function Yf(c,h,f){var m=f&&f.maxWidth||100,S=c._container.clientHeight/2,I=c.unproject([0,S]),P=c.unproject([m,S]),B=I.distanceTo(P);if(f&&f.unit==="imperial"){var Y=3.2808*B;Y>5280?nc(h,m,Y/5280,c._getUIString("ScaleControl.Miles")):nc(h,m,Y,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?nc(h,m,B/1852,c._getUIString("ScaleControl.NauticalMiles")):B>=1e3?nc(h,m,B/1e3,c._getUIString("ScaleControl.Kilometers")):nc(h,m,B,c._getUIString("ScaleControl.Meters"))}function nc(c,h,f,m){var S,I,P,B=(S=f,(I=Math.pow(10,(""+Math.floor(S)).length-1))*(P=(P=S/I)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(Y){var te=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*te)/te}(P)));c.style.width=h*(B/f)+"px",c.innerHTML=B+"&nbsp;"+m}vl.prototype.getDefaultPosition=function(){return"bottom-left"},vl.prototype._onMove=function(){Yf(this._map,this._container,this.options)},vl.prototype.onAdd=function(c){return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vl.prototype.onRemove=function(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vl.prototype.setUnit=function(c){this.options.unit=c,Yf(this._map,this._container,this.options)};var ml=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof y.window.HTMLElement?this._container=c.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};ml.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ml.prototype.onRemove=function(){K.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ml.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},ml.prototype._setupUI=function(){var c=this._fullscreenButton=K.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ml.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},ml.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ml.prototype._isFullscreen=function(){return this._fullscreen},ml.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ml.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),_p=function(c){function h(f){c.call(this),this.options=y.extend(Object.create(Gc),f),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(f){return this.setDOMContent(y.window.document.createTextNode(f))},h.prototype.setHTML=function(f){var m,S=y.window.document.createDocumentFragment(),I=y.window.document.createElement("body");for(I.innerHTML=f;m=I.firstChild;)S.appendChild(m);return this.setDOMContent(S)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},h.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},h.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},h.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},h.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=K.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(f){this._update(f.point)},h.prototype._onMouseMove=function(f){this._update(f.point)},h.prototype._onDrag=function(f){this._update(f.point)},h.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=K.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=K.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ce){return m._container.classList.add(Ce)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),I=this.options.anchor,P=function Ce(Me){if(Me){if(typeof Me=="number"){var et=Math.round(Math.sqrt(.5*Math.pow(Me,2)));return{center:new y.Point(0,0),top:new y.Point(0,Me),"top-left":new y.Point(et,et),"top-right":new y.Point(-et,et),bottom:new y.Point(0,-Me),"bottom-left":new y.Point(et,-et),"bottom-right":new y.Point(-et,-et),left:new y.Point(Me,0),right:new y.Point(-Me,0)}}if(Me instanceof y.Point||Array.isArray(Me)){var Ne=y.Point.convert(Me);return{center:Ne,top:Ne,"top-left":Ne,"top-right":Ne,bottom:Ne,"bottom-left":Ne,"bottom-right":Ne,left:Ne,right:Ne}}return{center:y.Point.convert(Me.center||[0,0]),top:y.Point.convert(Me.top||[0,0]),"top-left":y.Point.convert(Me["top-left"]||[0,0]),"top-right":y.Point.convert(Me["top-right"]||[0,0]),bottom:y.Point.convert(Me.bottom||[0,0]),"bottom-left":y.Point.convert(Me["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Me["bottom-right"]||[0,0]),left:y.Point.convert(Me.left||[0,0]),right:y.Point.convert(Me.right||[0,0])}}return Ce(new y.Point(0,0))}(this.options.offset);if(!I){var B,Y=this._container.offsetWidth,te=this._container.offsetHeight;B=S.y+P.bottom.y<te?["top"]:S.y>this._map.transform.height-te?["bottom"]:[],S.x<Y/2?B.push("left"):S.x>this._map.transform.width-Y/2&&B.push("right"),I=B.length===0?"bottom":B.join("-")}var xe=S.add(P[I]).round();K.setTransform(this._container,Ul[I]+" translate("+xe.x+"px,"+xe.y+"px)"),mh(this._container,I,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(yh);f&&f.focus()}},h.prototype._onClose=function(){this.remove()},h}(y.Evented),Ef={version:y.version,supported:Be,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:vh,NavigationControl:el,GeolocateControl:bc,AttributionControl:zs,ScaleControl:vl,FullscreenControl:ml,Popup:_p,Marker:gh,Style:Su,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){er().acquire(pr)},clearPrewarmedResources:function(){var c=li;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(pr),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(c){y.config.ACCESS_TOKEN=c},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(c){y.config.API_URL=c},get workerCount(){return Hr.workerCount},set workerCount(c){Hr.workerCount=c},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){y.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){y.clearTileCache(c)},workerUrl:""};return Ef}),We})},3614:function(pi,Se,fe){"use strict";pi.exports=de;var We=fe(80645);function de(ue){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ue)?ue:new Uint8Array(ue||0),this.pos=0,this.type=0,this.length=this.buf.length}de.Varint=0,de.Fixed64=1,de.Bytes=2,de.Fixed32=5;var y=(1<<16)*(1<<16),Be=1/y,K=12,ke=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");de.prototype={destroy:function(){this.buf=null},readFields:function(ue,tt,Z){for(Z=Z||this.length;this.pos<Z;){var _e=this.readVarint(),ze=_e>>3,wt=this.pos;this.type=_e&7,ue(ze,tt,this),this.pos===wt&&this.skip(_e)}return tt},readMessage:function(ue,tt){return this.readFields(ue,tt,this.readVarint()+this.pos)},readFixed32:function(){var ue=Ot(this.buf,this.pos);return this.pos+=4,ue},readSFixed32:function(){var ue=Kt(this.buf,this.pos);return this.pos+=4,ue},readFixed64:function(){var ue=Ot(this.buf,this.pos)+Ot(this.buf,this.pos+4)*y;return this.pos+=8,ue},readSFixed64:function(){var ue=Ot(this.buf,this.pos)+Kt(this.buf,this.pos+4)*y;return this.pos+=8,ue},readFloat:function(){var ue=We.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ue},readDouble:function(){var ue=We.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ue},readVarint:function(ue){var tt=this.buf,Z,_e;return _e=tt[this.pos++],Z=_e&127,_e<128||(_e=tt[this.pos++],Z|=(_e&127)<<7,_e<128)||(_e=tt[this.pos++],Z|=(_e&127)<<14,_e<128)||(_e=tt[this.pos++],Z|=(_e&127)<<21,_e<128)?Z:(_e=tt[this.pos],Z|=(_e&15)<<28,he(Z,ue,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ue=this.readVarint();return ue%2==1?(ue+1)/-2:ue/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ue=this.readVarint()+this.pos,tt=this.pos;return this.pos=ue,ue-tt>=K&&ke?Cr(this.buf,tt,ue):Ue(this.buf,tt,ue)},readBytes:function(){var ue=this.readVarint()+this.pos,tt=this.buf.subarray(this.pos,ue);return this.pos=ue,tt},readPackedVarint:function(ue,tt){if(this.type!==de.Bytes)return ue.push(this.readVarint(tt));var Z=ut(this);for(ue=ue||[];this.pos<Z;)ue.push(this.readVarint(tt));return ue},readPackedSVarint:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSVarint());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readSVarint());return ue},readPackedBoolean:function(ue){if(this.type!==de.Bytes)return ue.push(this.readBoolean());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readBoolean());return ue},readPackedFloat:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFloat());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readFloat());return ue},readPackedDouble:function(ue){if(this.type!==de.Bytes)return ue.push(this.readDouble());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readDouble());return ue},readPackedFixed32:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFixed32());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readFixed32());return ue},readPackedSFixed32:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSFixed32());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readSFixed32());return ue},readPackedFixed64:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFixed64());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readFixed64());return ue},readPackedSFixed64:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSFixed64());var tt=ut(this);for(ue=ue||[];this.pos<tt;)ue.push(this.readSFixed64());return ue},skip:function(ue){var tt=ue&7;if(tt===de.Varint)for(;this.buf[this.pos++]>127;);else if(tt===de.Bytes)this.pos=this.readVarint()+this.pos;else if(tt===de.Fixed32)this.pos+=4;else if(tt===de.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+tt)},writeTag:function(ue,tt){this.writeVarint(ue<<3|tt)},realloc:function(ue){for(var tt=this.length||16;tt<this.pos+ue;)tt*=2;if(tt!==this.length){var Z=new Uint8Array(tt);Z.set(this.buf),this.buf=Z,this.length=tt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ue){this.realloc(4),_t(this.buf,ue,this.pos),this.pos+=4},writeSFixed32:function(ue){this.realloc(4),_t(this.buf,ue,this.pos),this.pos+=4},writeFixed64:function(ue){this.realloc(8),_t(this.buf,ue&-1,this.pos),_t(this.buf,Math.floor(ue*Be),this.pos+4),this.pos+=8},writeSFixed64:function(ue){this.realloc(8),_t(this.buf,ue&-1,this.pos),_t(this.buf,Math.floor(ue*Be),this.pos+4),this.pos+=8},writeVarint:function(ue){if(ue=+ue||0,ue>268435455||ue<0){Xe(ue,this);return}this.realloc(4),this.buf[this.pos++]=ue&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=ue>>>7&127)))},writeSVarint:function(ue){this.writeVarint(ue<0?-ue*2-1:ue*2)},writeBoolean:function(ue){this.writeVarint(Boolean(ue))},writeString:function(ue){ue=String(ue),this.realloc(ue.length*4),this.pos++;var tt=this.pos;this.pos=nn(this.buf,ue,this.pos);var Z=this.pos-tt;Z>=128&&tr(tt,Z,this),this.pos=tt-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(ue){this.realloc(4),We.write(this.buf,ue,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ue){this.realloc(8),We.write(this.buf,ue,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ue){var tt=ue.length;this.writeVarint(tt),this.realloc(tt);for(var Z=0;Z<tt;Z++)this.buf[this.pos++]=ue[Z]},writeRawMessage:function(ue,tt){this.pos++;var Z=this.pos;ue(tt,this);var _e=this.pos-Z;_e>=128&&tr(Z,_e,this),this.pos=Z-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(ue,tt,Z){this.writeTag(ue,de.Bytes),this.writeRawMessage(tt,Z)},writePackedVarint:function(ue,tt){tt.length&&this.writeMessage(ue,Yt,tt)},writePackedSVarint:function(ue,tt){tt.length&&this.writeMessage(ue,Xt,tt)},writePackedBoolean:function(ue,tt){tt.length&&this.writeMessage(ue,Rt,tt)},writePackedFloat:function(ue,tt){tt.length&&this.writeMessage(ue,Er,tt)},writePackedDouble:function(ue,tt){tt.length&&this.writeMessage(ue,cr,tt)},writePackedFixed32:function(ue,tt){tt.length&&this.writeMessage(ue,Zt,tt)},writePackedSFixed32:function(ue,tt){tt.length&&this.writeMessage(ue,Rr,tt)},writePackedFixed64:function(ue,tt){tt.length&&this.writeMessage(ue,re,tt)},writePackedSFixed64:function(ue,tt){tt.length&&this.writeMessage(ue,_r,tt)},writeBytesField:function(ue,tt){this.writeTag(ue,de.Bytes),this.writeBytes(tt)},writeFixed32Field:function(ue,tt){this.writeTag(ue,de.Fixed32),this.writeFixed32(tt)},writeSFixed32Field:function(ue,tt){this.writeTag(ue,de.Fixed32),this.writeSFixed32(tt)},writeFixed64Field:function(ue,tt){this.writeTag(ue,de.Fixed64),this.writeFixed64(tt)},writeSFixed64Field:function(ue,tt){this.writeTag(ue,de.Fixed64),this.writeSFixed64(tt)},writeVarintField:function(ue,tt){this.writeTag(ue,de.Varint),this.writeVarint(tt)},writeSVarintField:function(ue,tt){this.writeTag(ue,de.Varint),this.writeSVarint(tt)},writeStringField:function(ue,tt){this.writeTag(ue,de.Bytes),this.writeString(tt)},writeFloatField:function(ue,tt){this.writeTag(ue,de.Fixed32),this.writeFloat(tt)},writeDoubleField:function(ue,tt){this.writeTag(ue,de.Fixed64),this.writeDouble(tt)},writeBooleanField:function(ue,tt){this.writeVarintField(ue,Boolean(tt))}};function he(ue,tt,Z){var _e=Z.buf,ze,wt;if(wt=_e[Z.pos++],ze=(wt&112)>>4,wt<128||(wt=_e[Z.pos++],ze|=(wt&127)<<3,wt<128)||(wt=_e[Z.pos++],ze|=(wt&127)<<10,wt<128)||(wt=_e[Z.pos++],ze|=(wt&127)<<17,wt<128)||(wt=_e[Z.pos++],ze|=(wt&127)<<24,wt<128)||(wt=_e[Z.pos++],ze|=(wt&1)<<31,wt<128))return Ae(ue,ze,tt);throw new Error("Expected varint not more than 10 bytes")}function ut(ue){return ue.type===de.Bytes?ue.readVarint()+ue.pos:ue.pos+1}function Ae(ue,tt,Z){return Z?tt*4294967296+(ue>>>0):(tt>>>0)*4294967296+(ue>>>0)}function Xe(ue,tt){var Z,_e;if(ue>=0?(Z=ue%4294967296|0,_e=ue/4294967296|0):(Z=~(-ue%4294967296),_e=~(-ue/4294967296),Z^4294967295?Z=Z+1|0:(Z=0,_e=_e+1|0)),ue>=18446744073709552e3||ue<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");tt.realloc(10),Ct(Z,_e,tt),Lt(_e,tt)}function Ct(ue,tt,Z){Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos]=ue&127}function Lt(ue,tt){var Z=(ue&7)<<4;tt.buf[tt.pos++]|=Z|((ue>>>=3)?128:0),!!ue&&(tt.buf[tt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(tt.buf[tt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(tt.buf[tt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(tt.buf[tt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(tt.buf[tt.pos++]=ue&127)))))}function tr(ue,tt,Z){var _e=tt<=16383?1:tt<=2097151?2:tt<=268435455?3:Math.floor(Math.log(tt)/(Math.LN2*7));Z.realloc(_e);for(var ze=Z.pos-1;ze>=ue;ze--)Z.buf[ze+_e]=Z.buf[ze]}function Yt(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeVarint(ue[Z])}function Xt(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeSVarint(ue[Z])}function Er(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeFloat(ue[Z])}function cr(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeDouble(ue[Z])}function Rt(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeBoolean(ue[Z])}function Zt(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeFixed32(ue[Z])}function Rr(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeSFixed32(ue[Z])}function re(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeFixed64(ue[Z])}function _r(ue,tt){for(var Z=0;Z<ue.length;Z++)tt.writeSFixed64(ue[Z])}function Ot(ue,tt){return(ue[tt]|ue[tt+1]<<8|ue[tt+2]<<16)+ue[tt+3]*16777216}function _t(ue,tt,Z){ue[Z]=tt,ue[Z+1]=tt>>>8,ue[Z+2]=tt>>>16,ue[Z+3]=tt>>>24}function Kt(ue,tt){return(ue[tt]|ue[tt+1]<<8|ue[tt+2]<<16)+(ue[tt+3]<<24)}function Ue(ue,tt,Z){for(var _e="",ze=tt;ze<Z;){var wt=ue[ze],Vt=null,fr=wt>239?4:wt>223?3:wt>191?2:1;if(ze+fr>Z)break;var Mt,Fr,Xn;fr===1?wt<128&&(Vt=wt):fr===2?(Mt=ue[ze+1],(Mt&192)==128&&(Vt=(wt&31)<<6|Mt&63,Vt<=127&&(Vt=null))):fr===3?(Mt=ue[ze+1],Fr=ue[ze+2],(Mt&192)==128&&(Fr&192)==128&&(Vt=(wt&15)<<12|(Mt&63)<<6|Fr&63,(Vt<=2047||Vt>=55296&&Vt<=57343)&&(Vt=null))):fr===4&&(Mt=ue[ze+1],Fr=ue[ze+2],Xn=ue[ze+3],(Mt&192)==128&&(Fr&192)==128&&(Xn&192)==128&&(Vt=(wt&15)<<18|(Mt&63)<<12|(Fr&63)<<6|Xn&63,(Vt<=65535||Vt>=1114112)&&(Vt=null))),Vt===null?(Vt=65533,fr=1):Vt>65535&&(Vt-=65536,_e+=String.fromCharCode(Vt>>>10&1023|55296),Vt=56320|Vt&1023),_e+=String.fromCharCode(Vt),ze+=fr}return _e}function Cr(ue,tt,Z){return ke.decode(ue.subarray(tt,Z))}function nn(ue,tt,Z){for(var _e=0,ze,wt;_e<tt.length;_e++){if(ze=tt.charCodeAt(_e),ze>55295&&ze<57344)if(wt)if(ze<56320){ue[Z++]=239,ue[Z++]=191,ue[Z++]=189,wt=ze;continue}else ze=wt-55296<<10|ze-56320|65536,wt=null;else{ze>56319||_e+1===tt.length?(ue[Z++]=239,ue[Z++]=191,ue[Z++]=189):wt=ze;continue}else wt&&(ue[Z++]=239,ue[Z++]=191,ue[Z++]=189,wt=null);ze<128?ue[Z++]=ze:(ze<2048?ue[Z++]=ze>>6|192:(ze<65536?ue[Z++]=ze>>12|224:(ue[Z++]=ze>>18|240,ue[Z++]=ze>>12&63|128),ue[Z++]=ze>>6&63|128),ue[Z++]=ze&63|128)}return Z}},32676:function(pi,Se,fe){var We=fe(34155);(function(de,y){pi.exports=y()})(this,function(){"use strict";function de(Pt,ge){if(!(Pt instanceof ge))throw new TypeError("Cannot call a class as a function")}function y(Pt,ge){for(var oe=0;oe<ge.length;oe++){var we=ge[oe];we.enumerable=we.enumerable||!1,we.configurable=!0,"value"in we&&(we.writable=!0),Object.defineProperty(Pt,we.key,we)}}function Be(Pt,ge,oe){return ge&&y(Pt.prototype,ge),oe&&y(Pt,oe),Pt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var K=function(){function Pt(ge,oe){this.next=null,this.key=ge,this.data=oe,this.left=null,this.right=null}return Pt}();function ke(Pt,ge){return Pt>ge?1:Pt<ge?-1:0}function he(Pt,ge,oe){for(var we=new K(null,null),V=we,at=we;;){var sr=oe(Pt,ge.key);if(sr<0){if(ge.left===null)break;if(oe(Pt,ge.left.key)<0){var $r=ge.left;if(ge.left=$r.right,$r.right=ge,ge=$r,ge.left===null)break}at.left=ge,at=ge,ge=ge.left}else if(sr>0){if(ge.right===null)break;if(oe(Pt,ge.right.key)>0){var $r=ge.right;if(ge.right=$r.left,$r.left=ge,ge=$r,ge.right===null)break}V.right=ge,V=ge,ge=ge.right}else break}return V.right=ge.left,at.left=ge.right,ge.left=we.right,ge.right=we.left,ge}function ut(Pt,ge,oe,we){var V=new K(Pt,ge);if(oe===null)return V.left=V.right=null,V;oe=he(Pt,oe,we);var at=we(Pt,oe.key);return at<0?(V.left=oe.left,V.right=oe,oe.left=null):at>=0&&(V.right=oe.right,V.left=oe,oe.right=null),V}function Ae(Pt,ge,oe){var we=null,V=null;if(ge){ge=he(Pt,ge,oe);var at=oe(ge.key,Pt);at===0?(we=ge.left,V=ge.right):at<0?(V=ge.right,ge.right=null,we=ge):(we=ge.left,ge.left=null,V=ge)}return{left:we,right:V}}function Xe(Pt,ge,oe){return ge===null?Pt:(Pt===null||(ge=he(Pt.key,ge,oe),ge.left=Pt),ge)}function Ct(Pt,ge,oe,we,V){if(Pt){we(""+ge+(oe?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+V(Pt)+`
`);var at=ge+(oe?"    ":"\u2502   ");Pt.left&&Ct(Pt.left,at,!1,we,V),Pt.right&&Ct(Pt.right,at,!0,we,V)}}var Lt=function(){function Pt(ge){ge===void 0&&(ge=ke),this._root=null,this._size=0,this._comparator=ge}return Pt.prototype.insert=function(ge,oe){return this._size++,this._root=ut(ge,oe,this._root,this._comparator)},Pt.prototype.add=function(ge,oe){var we=new K(ge,oe);this._root===null&&(we.left=we.right=null,this._size++,this._root=we);var V=this._comparator,at=he(ge,this._root,V),sr=V(ge,at.key);return sr===0?this._root=at:(sr<0?(we.left=at.left,we.right=at,at.left=null):sr>0&&(we.right=at.right,we.left=at,at.right=null),this._size++,this._root=we),this._root},Pt.prototype.remove=function(ge){this._root=this._remove(ge,this._root,this._comparator)},Pt.prototype._remove=function(ge,oe,we){var V;if(oe===null)return null;oe=he(ge,oe,we);var at=we(ge,oe.key);return at===0?(oe.left===null?V=oe.right:(V=he(ge,oe.left,we),V.right=oe.right),this._size--,V):oe},Pt.prototype.pop=function(){var ge=this._root;if(ge){for(;ge.left;)ge=ge.left;return this._root=he(ge.key,this._root,this._comparator),this._root=this._remove(ge.key,this._root,this._comparator),{key:ge.key,data:ge.data}}return null},Pt.prototype.findStatic=function(ge){for(var oe=this._root,we=this._comparator;oe;){var V=we(ge,oe.key);if(V===0)return oe;V<0?oe=oe.left:oe=oe.right}return null},Pt.prototype.find=function(ge){return this._root&&(this._root=he(ge,this._root,this._comparator),this._comparator(ge,this._root.key)!==0)?null:this._root},Pt.prototype.contains=function(ge){for(var oe=this._root,we=this._comparator;oe;){var V=we(ge,oe.key);if(V===0)return!0;V<0?oe=oe.left:oe=oe.right}return!1},Pt.prototype.forEach=function(ge,oe){for(var we=this._root,V=[],at=!1;!at;)we!==null?(V.push(we),we=we.left):V.length!==0?(we=V.pop(),ge.call(oe,we),we=we.right):at=!0;return this},Pt.prototype.range=function(ge,oe,we,V){for(var at=[],sr=this._comparator,$r=this._root,Ke;at.length!==0||$r;)if($r)at.push($r),$r=$r.left;else{if($r=at.pop(),Ke=sr($r.key,oe),Ke>0)break;if(sr($r.key,ge)>=0&&we.call(V,$r))return this;$r=$r.right}return this},Pt.prototype.keys=function(){var ge=[];return this.forEach(function(oe){var we=oe.key;return ge.push(we)}),ge},Pt.prototype.values=function(){var ge=[];return this.forEach(function(oe){var we=oe.data;return ge.push(we)}),ge},Pt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Pt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Pt.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},Pt.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},Pt.prototype.at=function(ge){for(var oe=this._root,we=!1,V=0,at=[];!we;)if(oe)at.push(oe),oe=oe.left;else if(at.length>0){if(oe=at.pop(),V===ge)return oe;V++,oe=oe.right}else we=!0;return null},Pt.prototype.next=function(ge){var oe=this._root,we=null;if(ge.right){for(we=ge.right;we.left;)we=we.left;return we}for(var V=this._comparator;oe;){var at=V(ge.key,oe.key);if(at===0)break;at<0?(we=oe,oe=oe.left):oe=oe.right}return we},Pt.prototype.prev=function(ge){var oe=this._root,we=null;if(ge.left!==null){for(we=ge.left;we.right;)we=we.right;return we}for(var V=this._comparator;oe;){var at=V(ge.key,oe.key);if(at===0)break;at<0?oe=oe.left:(we=oe,oe=oe.right)}return we},Pt.prototype.clear=function(){return this._root=null,this._size=0,this},Pt.prototype.toList=function(){return Xt(this._root)},Pt.prototype.load=function(ge,oe,we){oe===void 0&&(oe=[]),we===void 0&&(we=!1);var V=ge.length,at=this._comparator;if(we&&Rt(ge,oe,0,V-1,at),this._root===null)this._root=tr(ge,oe,0,V),this._size=V;else{var sr=cr(this.toList(),Yt(ge,oe),at);V=this._size+V,this._root=Er({head:sr},0,V)}return this},Pt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Pt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Pt.prototype.toString=function(ge){ge===void 0&&(ge=function(V){return String(V.key)});var oe=[];return Ct(this._root,"",!0,function(we){return oe.push(we)},ge),oe.join("")},Pt.prototype.update=function(ge,oe,we){var V=this._comparator,at=Ae(ge,this._root,V),sr=at.left,$r=at.right;V(ge,oe)<0?$r=ut(oe,we,$r,V):sr=ut(oe,we,sr,V),this._root=Xe(sr,$r,V)},Pt.prototype.split=function(ge){return Ae(ge,this._root,this._comparator)},Pt}();function tr(Pt,ge,oe,we){var V=we-oe;if(V>0){var at=oe+Math.floor(V/2),sr=Pt[at],$r=ge[at],Ke=new K(sr,$r);return Ke.left=tr(Pt,ge,oe,at),Ke.right=tr(Pt,ge,at+1,we),Ke}return null}function Yt(Pt,ge){for(var oe=new K(null,null),we=oe,V=0;V<Pt.length;V++)we=we.next=new K(Pt[V],ge[V]);return we.next=null,oe.next}function Xt(Pt){for(var ge=Pt,oe=[],we=!1,V=new K(null,null),at=V;!we;)ge?(oe.push(ge),ge=ge.left):oe.length>0?(ge=at=at.next=oe.pop(),ge=ge.right):we=!0;return at.next=null,V.next}function Er(Pt,ge,oe){var we=oe-ge;if(we>0){var V=ge+Math.floor(we/2),at=Er(Pt,ge,V),sr=Pt.head;return sr.left=at,Pt.head=Pt.head.next,sr.right=Er(Pt,V+1,oe),sr}return null}function cr(Pt,ge,oe){for(var we=new K(null,null),V=we,at=Pt,sr=ge;at!==null&&sr!==null;)oe(at.key,sr.key)<0?(V.next=at,at=at.next):(V.next=sr,sr=sr.next),V=V.next;return at!==null?V.next=at:sr!==null&&(V.next=sr),we.next}function Rt(Pt,ge,oe,we,V){if(!(oe>=we)){for(var at=Pt[oe+we>>1],sr=oe-1,$r=we+1;;){do sr++;while(V(Pt[sr],at)<0);do $r--;while(V(Pt[$r],at)>0);if(sr>=$r)break;var Ke=Pt[sr];Pt[sr]=Pt[$r],Pt[$r]=Ke,Ke=ge[sr],ge[sr]=ge[$r],ge[$r]=Ke}Rt(Pt,ge,oe,$r,V),Rt(Pt,ge,$r+1,we,V)}}var Zt=function(ge,oe){return ge.ll.x<=oe.x&&oe.x<=ge.ur.x&&ge.ll.y<=oe.y&&oe.y<=ge.ur.y},Rr=function(ge,oe){if(oe.ur.x<ge.ll.x||ge.ur.x<oe.ll.x||oe.ur.y<ge.ll.y||ge.ur.y<oe.ll.y)return null;var we=ge.ll.x<oe.ll.x?oe.ll.x:ge.ll.x,V=ge.ur.x<oe.ur.x?ge.ur.x:oe.ur.x,at=ge.ll.y<oe.ll.y?oe.ll.y:ge.ll.y,sr=ge.ur.y<oe.ur.y?ge.ur.y:oe.ur.y;return{ll:{x:we,y:at},ur:{x:V,y:sr}}},re=Number.EPSILON;re===void 0&&(re=Math.pow(2,-52));var _r=re*re,Ot=function(ge,oe){if(-re<ge&&ge<re&&-re<oe&&oe<re)return 0;var we=ge-oe;return we*we<_r*ge*oe?0:ge<oe?-1:1},_t=function(){function Pt(){de(this,Pt),this.reset()}return Be(Pt,[{key:"reset",value:function(){this.xRounder=new Kt,this.yRounder=new Kt}},{key:"round",value:function(oe,we){return{x:this.xRounder.round(oe),y:this.yRounder.round(we)}}}]),Pt}(),Kt=function(){function Pt(){de(this,Pt),this.tree=new Lt,this.round(0)}return Be(Pt,[{key:"round",value:function(oe){var we=this.tree.add(oe),V=this.tree.prev(we);if(V!==null&&Ot(we.key,V.key)===0)return this.tree.remove(oe),V.key;var at=this.tree.next(we);return at!==null&&Ot(we.key,at.key)===0?(this.tree.remove(oe),at.key):oe}}]),Pt}(),Ue=new _t,Cr=function(ge,oe){return ge.x*oe.y-ge.y*oe.x},nn=function(ge,oe){return ge.x*oe.x+ge.y*oe.y},ue=function(ge,oe,we){var V={x:oe.x-ge.x,y:oe.y-ge.y},at={x:we.x-ge.x,y:we.y-ge.y},sr=Cr(V,at);return Ot(sr,0)},tt=function(ge){return Math.sqrt(nn(ge,ge))},Z=function(ge,oe,we){var V={x:oe.x-ge.x,y:oe.y-ge.y},at={x:we.x-ge.x,y:we.y-ge.y};return Cr(at,V)/tt(at)/tt(V)},_e=function(ge,oe,we){var V={x:oe.x-ge.x,y:oe.y-ge.y},at={x:we.x-ge.x,y:we.y-ge.y};return nn(at,V)/tt(at)/tt(V)},ze=function(ge,oe,we){return oe.y===0?null:{x:ge.x+oe.x/oe.y*(we-ge.y),y:we}},wt=function(ge,oe,we){return oe.x===0?null:{x:we,y:ge.y+oe.y/oe.x*(we-ge.x)}},Vt=function(ge,oe,we,V){if(oe.x===0)return wt(we,V,ge.x);if(V.x===0)return wt(ge,oe,we.x);if(oe.y===0)return ze(we,V,ge.y);if(V.y===0)return ze(ge,oe,we.y);var at=Cr(oe,V);if(at==0)return null;var sr={x:we.x-ge.x,y:we.y-ge.y},$r=Cr(sr,oe)/at,Ke=Cr(sr,V)/at,Nt=ge.x+Ke*oe.x,Sr=we.x+$r*V.x,xr=ge.y+Ke*oe.y,Lr=we.y+$r*V.y,gn=(Nt+Sr)/2,mi=(xr+Lr)/2;return{x:gn,y:mi}},fr=function(){Be(Pt,null,[{key:"compare",value:function(oe,we){var V=Pt.comparePoints(oe.point,we.point);return V!==0?V:(oe.point!==we.point&&oe.link(we),oe.isLeft!==we.isLeft?oe.isLeft?1:-1:Fr.compare(oe.segment,we.segment))}},{key:"comparePoints",value:function(oe,we){return oe.x<we.x?-1:oe.x>we.x?1:oe.y<we.y?-1:oe.y>we.y?1:0}}]);function Pt(ge,oe){de(this,Pt),ge.events===void 0?ge.events=[this]:ge.events.push(this),this.point=ge,this.isLeft=oe}return Be(Pt,[{key:"link",value:function(oe){if(oe.point===this.point)throw new Error("Tried to link already linked events");for(var we=oe.point.events,V=0,at=we.length;V<at;V++){var sr=we[V];this.point.events.push(sr),sr.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var oe=this.point.events.length,we=0;we<oe;we++){var V=this.point.events[we];if(V.segment.consumedBy===void 0)for(var at=we+1;at<oe;at++){var sr=this.point.events[at];sr.consumedBy===void 0&&V.otherSE.point.events===sr.otherSE.point.events&&V.segment.consume(sr.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var oe=[],we=0,V=this.point.events.length;we<V;we++){var at=this.point.events[we];at!==this&&!at.segment.ringOut&&at.segment.isInResult()&&oe.push(at)}return oe}},{key:"getLeftmostComparator",value:function(oe){var we=this,V=new Map,at=function($r){var Ke=$r.otherSE;V.set($r,{sine:Z(we.point,oe.point,Ke.point),cosine:_e(we.point,oe.point,Ke.point)})};return function(sr,$r){V.has(sr)||at(sr),V.has($r)||at($r);var Ke=V.get(sr),Nt=Ke.sine,Sr=Ke.cosine,xr=V.get($r),Lr=xr.sine,gn=xr.cosine;return Nt>=0&&Lr>=0?Sr<gn?1:Sr>gn?-1:0:Nt<0&&Lr<0?Sr<gn?-1:Sr>gn?1:0:Lr<Nt?-1:Lr>Nt?1:0}}}]),Pt}(),Mt=0,Fr=function(){Be(Pt,null,[{key:"compare",value:function(oe,we){var V=oe.leftSE.point.x,at=we.leftSE.point.x,sr=oe.rightSE.point.x,$r=we.rightSE.point.x;if($r<V)return 1;if(sr<at)return-1;var Ke=oe.leftSE.point.y,Nt=we.leftSE.point.y,Sr=oe.rightSE.point.y,xr=we.rightSE.point.y;if(V<at){if(Nt<Ke&&Nt<Sr)return 1;if(Nt>Ke&&Nt>Sr)return-1;var Lr=oe.comparePoint(we.leftSE.point);if(Lr<0)return 1;if(Lr>0)return-1;var gn=we.comparePoint(oe.rightSE.point);return gn!==0?gn:-1}if(V>at){if(Ke<Nt&&Ke<xr)return-1;if(Ke>Nt&&Ke>xr)return 1;var mi=we.comparePoint(oe.leftSE.point);if(mi!==0)return mi;var ii=oe.comparePoint(we.rightSE.point);return ii<0?1:ii>0?-1:1}if(Ke<Nt)return-1;if(Ke>Nt)return 1;if(sr<$r){var Sn=we.comparePoint(oe.rightSE.point);if(Sn!==0)return Sn}if(sr>$r){var Bi=oe.comparePoint(we.rightSE.point);if(Bi<0)return 1;if(Bi>0)return-1}if(sr!==$r){var Vi=Sr-Ke,Ga=sr-V,oa=xr-Nt,ro=$r-at;if(Vi>Ga&&oa<ro)return 1;if(Vi<Ga&&oa>ro)return-1}return sr>$r?1:sr<$r||Sr<xr?-1:Sr>xr?1:oe.id<we.id?-1:oe.id>we.id?1:0}}]);function Pt(ge,oe,we,V){de(this,Pt),this.id=++Mt,this.leftSE=ge,ge.segment=this,ge.otherSE=oe,this.rightSE=oe,oe.segment=this,oe.otherSE=ge,this.rings=we,this.windings=V}return Be(Pt,[{key:"replaceRightSE",value:function(oe){this.rightSE=oe,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var oe=this.leftSE.point.y,we=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:oe<we?oe:we},ur:{x:this.rightSE.point.x,y:oe>we?oe:we}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(oe){return oe.x===this.leftSE.point.x&&oe.y===this.leftSE.point.y||oe.x===this.rightSE.point.x&&oe.y===this.rightSE.point.y}},{key:"comparePoint",value:function(oe){if(this.isAnEndpoint(oe))return 0;var we=this.leftSE.point,V=this.rightSE.point,at=this.vector();if(we.x===V.x)return oe.x===we.x?0:oe.x<we.x?1:-1;var sr=(oe.y-we.y)/at.y,$r=we.x+sr*at.x;if(oe.x===$r)return 0;var Ke=(oe.x-we.x)/at.x,Nt=we.y+Ke*at.y;return oe.y===Nt?0:oe.y<Nt?-1:1}},{key:"getIntersection",value:function(oe){var we=this.bbox(),V=oe.bbox(),at=Rr(we,V);if(at===null)return null;var sr=this.leftSE.point,$r=this.rightSE.point,Ke=oe.leftSE.point,Nt=oe.rightSE.point,Sr=Zt(we,Ke)&&this.comparePoint(Ke)===0,xr=Zt(V,sr)&&oe.comparePoint(sr)===0,Lr=Zt(we,Nt)&&this.comparePoint(Nt)===0,gn=Zt(V,$r)&&oe.comparePoint($r)===0;if(xr&&Sr)return gn&&!Lr?$r:!gn&&Lr?Nt:null;if(xr)return Lr&&sr.x===Nt.x&&sr.y===Nt.y?null:sr;if(Sr)return gn&&$r.x===Ke.x&&$r.y===Ke.y?null:Ke;if(gn&&Lr)return null;if(gn)return $r;if(Lr)return Nt;var mi=Vt(sr,this.vector(),Ke,oe.vector());return mi===null||!Zt(at,mi)?null:Ue.round(mi.x,mi.y)}},{key:"split",value:function(oe){var we=[],V=oe.events!==void 0,at=new fr(oe,!0),sr=new fr(oe,!1),$r=this.rightSE;this.replaceRightSE(sr),we.push(sr),we.push(at);var Ke=new Pt(at,$r,this.rings.slice(),this.windings.slice());return fr.comparePoints(Ke.leftSE.point,Ke.rightSE.point)>0&&Ke.swapEvents(),fr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),V&&(at.checkForConsuming(),sr.checkForConsuming()),we}},{key:"swapEvents",value:function(){var oe=this.rightSE;this.rightSE=this.leftSE,this.leftSE=oe,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var we=0,V=this.windings.length;we<V;we++)this.windings[we]*=-1}},{key:"consume",value:function(oe){for(var we=this,V=oe;we.consumedBy;)we=we.consumedBy;for(;V.consumedBy;)V=V.consumedBy;var at=Pt.compare(we,V);if(at!==0){if(at>0){var sr=we;we=V,V=sr}if(we.prev===V){var $r=we;we=V,V=$r}for(var Ke=0,Nt=V.rings.length;Ke<Nt;Ke++){var Sr=V.rings[Ke],xr=V.windings[Ke],Lr=we.rings.indexOf(Sr);Lr===-1?(we.rings.push(Sr),we.windings.push(xr)):we.windings[Lr]+=xr}V.rings=null,V.windings=null,V.consumedBy=we,V.leftSE.consumedBy=we.leftSE,V.rightSE.consumedBy=we.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var oe=this.prev.consumedBy||this.prev;this._beforeState=oe.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var oe=this.beforeState();this._afterState={rings:oe.rings.slice(0),windings:oe.windings.slice(0),multiPolys:[]};for(var we=this._afterState.rings,V=this._afterState.windings,at=this._afterState.multiPolys,sr=0,$r=this.rings.length;sr<$r;sr++){var Ke=this.rings[sr],Nt=this.windings[sr],Sr=we.indexOf(Ke);Sr===-1?(we.push(Ke),V.push(Nt)):V[Sr]+=Nt}for(var xr=[],Lr=[],gn=0,mi=we.length;gn<mi;gn++)if(V[gn]!==0){var ii=we[gn],Sn=ii.poly;if(Lr.indexOf(Sn)===-1)if(ii.isExterior)xr.push(Sn);else{Lr.indexOf(Sn)===-1&&Lr.push(Sn);var Bi=xr.indexOf(ii.poly);Bi!==-1&&xr.splice(Bi,1)}}for(var Vi=0,Ga=xr.length;Vi<Ga;Vi++){var oa=xr[Vi].multiPoly;at.indexOf(oa)===-1&&at.push(oa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var oe=this.beforeState().multiPolys,we=this.afterState().multiPolys;switch(Ji.type){case"union":{var V=oe.length===0,at=we.length===0;this._isInResult=V!==at;break}case"intersection":{var sr,$r;oe.length<we.length?(sr=oe.length,$r=we.length):(sr=we.length,$r=oe.length),this._isInResult=$r===Ji.numMultiPolys&&sr<$r;break}case"xor":{var Ke=Math.abs(oe.length-we.length);this._isInResult=Ke%2==1;break}case"difference":{var Nt=function(xr){return xr.length===1&&xr[0].isSubject};this._isInResult=Nt(oe)!==Nt(we);break}default:throw new Error("Unrecognized operation type found ".concat(Ji.type))}return this._isInResult}}],[{key:"fromRing",value:function(oe,we,V){var at,sr,$r,Ke=fr.comparePoints(oe,we);if(Ke<0)at=oe,sr=we,$r=1;else if(Ke>0)at=we,sr=oe,$r=-1;else throw new Error("Tried to create degenerate segment at [".concat(oe.x,", ").concat(oe.y,"]"));var Nt=new fr(at,!0),Sr=new fr(sr,!1);return new Pt(Nt,Sr,[V],[$r])}}]),Pt}(),Xn=function(){function Pt(ge,oe,we){if(de(this,Pt),!Array.isArray(ge)||ge.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=oe,this.isExterior=we,this.segments=[],typeof ge[0][0]!="number"||typeof ge[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var V=Ue.round(ge[0][0],ge[0][1]);this.bbox={ll:{x:V.x,y:V.y},ur:{x:V.x,y:V.y}};for(var at=V,sr=1,$r=ge.length;sr<$r;sr++){if(typeof ge[sr][0]!="number"||typeof ge[sr][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ke=Ue.round(ge[sr][0],ge[sr][1]);Ke.x===at.x&&Ke.y===at.y||(this.segments.push(Fr.fromRing(at,Ke,this)),Ke.x<this.bbox.ll.x&&(this.bbox.ll.x=Ke.x),Ke.y<this.bbox.ll.y&&(this.bbox.ll.y=Ke.y),Ke.x>this.bbox.ur.x&&(this.bbox.ur.x=Ke.x),Ke.y>this.bbox.ur.y&&(this.bbox.ur.y=Ke.y),at=Ke)}(V.x!==at.x||V.y!==at.y)&&this.segments.push(Fr.fromRing(at,V,this))}return Be(Pt,[{key:"getSweepEvents",value:function(){for(var oe=[],we=0,V=this.segments.length;we<V;we++){var at=this.segments[we];oe.push(at.leftSE),oe.push(at.rightSE)}return oe}}]),Pt}(),Jr=function(){function Pt(ge,oe){if(de(this,Pt),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Xn(ge[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var we=1,V=ge.length;we<V;we++){var at=new Xn(ge[we],this,!1);at.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=at.bbox.ll.x),at.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=at.bbox.ll.y),at.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=at.bbox.ur.x),at.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=at.bbox.ur.y),this.interiorRings.push(at)}this.multiPoly=oe}return Be(Pt,[{key:"getSweepEvents",value:function(){for(var oe=this.exteriorRing.getSweepEvents(),we=0,V=this.interiorRings.length;we<V;we++)for(var at=this.interiorRings[we].getSweepEvents(),sr=0,$r=at.length;sr<$r;sr++)oe.push(at[sr]);return oe}}]),Pt}(),Ri=function(){function Pt(ge,oe){if(de(this,Pt),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof ge[0][0][0]=="number"&&(ge=[ge])}catch(sr){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var we=0,V=ge.length;we<V;we++){var at=new Jr(ge[we],this);at.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=at.bbox.ll.x),at.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=at.bbox.ll.y),at.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=at.bbox.ur.x),at.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=at.bbox.ur.y),this.polys.push(at)}this.isSubject=oe}return Be(Pt,[{key:"getSweepEvents",value:function(){for(var oe=[],we=0,V=this.polys.length;we<V;we++)for(var at=this.polys[we].getSweepEvents(),sr=0,$r=at.length;sr<$r;sr++)oe.push(at[sr]);return oe}}]),Pt}(),yi=function(){Be(Pt,null,[{key:"factory",value:function(oe){for(var we=[],V=0,at=oe.length;V<at;V++){var sr=oe[V];if(!(!sr.isInResult()||sr.ringOut)){for(var $r=null,Ke=sr.leftSE,Nt=sr.rightSE,Sr=[Ke],xr=Ke.point,Lr=[];$r=Ke,Ke=Nt,Sr.push(Ke),Ke.point!==xr;)for(;;){var gn=Ke.getAvailableLinkedEvents();if(gn.length===0){var mi=Sr[0].point,ii=Sr[Sr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(mi.x,",")+" ".concat(mi.y,"]. Last matching segment found ends at")+" [".concat(ii.x,", ").concat(ii.y,"]."))}if(gn.length===1){Nt=gn[0].otherSE;break}for(var Sn=null,Bi=0,Vi=Lr.length;Bi<Vi;Bi++)if(Lr[Bi].point===Ke.point){Sn=Bi;break}if(Sn!==null){var Ga=Lr.splice(Sn)[0],oa=Sr.splice(Ga.index);oa.unshift(oa[0].otherSE),we.push(new Pt(oa.reverse()));continue}Lr.push({index:Sr.length,point:Ke.point});var ro=Ke.getLeftmostComparator($r);Nt=gn.sort(ro)[0].otherSE;break}we.push(new Pt(Sr))}}return we}}]);function Pt(ge){de(this,Pt),this.events=ge;for(var oe=0,we=ge.length;oe<we;oe++)ge[oe].segment.ringOut=this;this.poly=null}return Be(Pt,[{key:"getGeom",value:function(){for(var oe=this.events[0].point,we=[oe],V=1,at=this.events.length-1;V<at;V++){var sr=this.events[V].point,$r=this.events[V+1].point;ue(sr,oe,$r)!==0&&(we.push(sr),oe=sr)}if(we.length===1)return null;var Ke=we[0],Nt=we[1];ue(Ke,oe,Nt)===0&&we.shift(),we.push(we[0]);for(var Sr=this.isExteriorRing()?1:-1,xr=this.isExteriorRing()?0:we.length-1,Lr=this.isExteriorRing()?we.length:-1,gn=[],mi=xr;mi!=Lr;mi+=Sr)gn.push([we[mi].x,we[mi].y]);return gn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var oe=this.enclosingRing();this._isExteriorRing=oe?!oe.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var oe=this.events[0],we=1,V=this.events.length;we<V;we++){var at=this.events[we];fr.compare(oe,at)>0&&(oe=at)}for(var sr=oe.segment.prevInResult(),$r=sr?sr.prevInResult():null;;){if(!sr)return null;if(!$r)return sr.ringOut;if($r.ringOut!==sr.ringOut)return $r.ringOut.enclosingRing()!==sr.ringOut?sr.ringOut:sr.ringOut.enclosingRing();sr=$r.prevInResult(),$r=sr?sr.prevInResult():null}}}]),Pt}(),ln=function(){function Pt(ge){de(this,Pt),this.exteriorRing=ge,ge.poly=this,this.interiorRings=[]}return Be(Pt,[{key:"addInterior",value:function(oe){this.interiorRings.push(oe),oe.poly=this}},{key:"getGeom",value:function(){var oe=[this.exteriorRing.getGeom()];if(oe[0]===null)return null;for(var we=0,V=this.interiorRings.length;we<V;we++){var at=this.interiorRings[we].getGeom();at!==null&&oe.push(at)}return oe}}]),Pt}(),Sa=function(){function Pt(ge){de(this,Pt),this.rings=ge,this.polys=this._composePolys(ge)}return Be(Pt,[{key:"getGeom",value:function(){for(var oe=[],we=0,V=this.polys.length;we<V;we++){var at=this.polys[we].getGeom();at!==null&&oe.push(at)}return oe}},{key:"_composePolys",value:function(oe){for(var we=[],V=0,at=oe.length;V<at;V++){var sr=oe[V];if(!sr.poly)if(sr.isExteriorRing())we.push(new ln(sr));else{var $r=sr.enclosingRing();$r.poly||we.push(new ln($r)),$r.poly.addInterior(sr)}}return we}}]),Pt}(),fa=function(){function Pt(ge){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fr.compare;de(this,Pt),this.queue=ge,this.tree=new Lt(oe),this.segments=[]}return Be(Pt,[{key:"process",value:function(oe){var we=oe.segment,V=[];if(oe.consumedBy)return oe.isLeft?this.queue.remove(oe.otherSE):this.tree.remove(we),V;var at=oe.isLeft?this.tree.insert(we):this.tree.find(we);if(!at)throw new Error("Unable to find segment #".concat(we.id," ")+"[".concat(we.leftSE.point.x,", ").concat(we.leftSE.point.y,"] -> ")+"[".concat(we.rightSE.point.x,", ").concat(we.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var sr=at,$r=at,Ke=void 0,Nt=void 0;Ke===void 0;)sr=this.tree.prev(sr),sr===null?Ke=null:sr.key.consumedBy===void 0&&(Ke=sr.key);for(;Nt===void 0;)$r=this.tree.next($r),$r===null?Nt=null:$r.key.consumedBy===void 0&&(Nt=$r.key);if(oe.isLeft){var Sr=null;if(Ke){var xr=Ke.getIntersection(we);if(xr!==null&&(we.isAnEndpoint(xr)||(Sr=xr),!Ke.isAnEndpoint(xr)))for(var Lr=this._splitSafely(Ke,xr),gn=0,mi=Lr.length;gn<mi;gn++)V.push(Lr[gn])}var ii=null;if(Nt){var Sn=Nt.getIntersection(we);if(Sn!==null&&(we.isAnEndpoint(Sn)||(ii=Sn),!Nt.isAnEndpoint(Sn)))for(var Bi=this._splitSafely(Nt,Sn),Vi=0,Ga=Bi.length;Vi<Ga;Vi++)V.push(Bi[Vi])}if(Sr!==null||ii!==null){var oa=null;if(Sr===null)oa=ii;else if(ii===null)oa=Sr;else{var ro=fr.comparePoints(Sr,ii);oa=ro<=0?Sr:ii}this.queue.remove(we.rightSE),V.push(we.rightSE);for(var Si=we.split(oa),ha=0,Q=Si.length;ha<Q;ha++)V.push(Si[ha])}V.length>0?(this.tree.remove(we),V.push(oe)):(this.segments.push(we),we.prev=Ke)}else{if(Ke&&Nt){var ie=Ke.getIntersection(Nt);if(ie!==null){if(!Ke.isAnEndpoint(ie))for(var me=this._splitSafely(Ke,ie),Ie=0,qe=me.length;Ie<qe;Ie++)V.push(me[Ie]);if(!Nt.isAnEndpoint(ie))for(var ot=this._splitSafely(Nt,ie),xt=0,Te=ot.length;xt<Te;xt++)V.push(ot[xt])}}this.tree.remove(we)}return V}},{key:"_splitSafely",value:function(oe,we){this.tree.remove(oe);var V=oe.rightSE;this.queue.remove(V);var at=oe.split(we);return at.push(V),oe.consumedBy===void 0&&this.tree.insert(oe),at}}]),Pt}(),Di=typeof We!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ia=typeof We!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ui=function(){function Pt(){de(this,Pt)}return Be(Pt,[{key:"run",value:function(oe,we,V){Ji.type=oe,Ue.reset();for(var at=[new Ri(we,!0)],sr=0,$r=V.length;sr<$r;sr++)at.push(new Ri(V[sr],!1));if(Ji.numMultiPolys=at.length,Ji.type==="difference")for(var Ke=at[0],Nt=1;Nt<at.length;)Rr(at[Nt].bbox,Ke.bbox)!==null?Nt++:at.splice(Nt,1);if(Ji.type==="intersection"){for(var Sr=0,xr=at.length;Sr<xr;Sr++)for(var Lr=at[Sr],gn=Sr+1,mi=at.length;gn<mi;gn++)if(Rr(Lr.bbox,at[gn].bbox)===null)return[]}for(var ii=new Lt(fr.compare),Sn=0,Bi=at.length;Sn<Bi;Sn++)for(var Vi=at[Sn].getSweepEvents(),Ga=0,oa=Vi.length;Ga<oa;Ga++)if(ii.insert(Vi[Ga]),ii.size>Di)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ro=new fa(ii),Si=ii.size,ha=ii.pop();ha;){var Q=ha.key;if(ii.size===Si){var ie=Q.segment;throw new Error("Unable to pop() ".concat(Q.isLeft?"left":"right"," SweepEvent ")+"[".concat(Q.point.x,", ").concat(Q.point.y,"] from segment #").concat(ie.id," ")+"[".concat(ie.leftSE.point.x,", ").concat(ie.leftSE.point.y,"] -> ")+"[".concat(ie.rightSE.point.x,", ").concat(ie.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ii.size>Di)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ro.segments.length>Ia)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var me=ro.process(Q),Ie=0,qe=me.length;Ie<qe;Ie++){var ot=me[Ie];ot.consumedBy===void 0&&ii.insert(ot)}Si=ii.size,ha=ii.pop()}Ue.reset();var xt=yi.factory(ro.segments),Te=new Sa(xt);return Te.getGeom()}}]),Pt}(),Ji=new ui,di=function(ge){for(var oe=arguments.length,we=new Array(oe>1?oe-1:0),V=1;V<oe;V++)we[V-1]=arguments[V];return Ji.run("union",ge,we)},_i=function(ge){for(var oe=arguments.length,we=new Array(oe>1?oe-1:0),V=1;V<oe;V++)we[V-1]=arguments[V];return Ji.run("intersection",ge,we)},Uo=function(ge){for(var oe=arguments.length,we=new Array(oe>1?oe-1:0),V=1;V<oe;V++)we[V-1]=arguments[V];return Ji.run("xor",ge,we)},Eo=function(ge){for(var oe=arguments.length,we=new Array(oe>1?oe-1:0),V=1;V<oe;V++)we[V-1]=arguments[V];return Ji.run("difference",ge,we)},to={union:di,intersection:_i,xor:Uo,difference:Eo};return to})},28660:function(pi,Se,fe){var We=fe(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var de;(function(y){(function(Be){var K=typeof fe.g=="object"?fe.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ke=he(y);typeof K.Reflect=="undefined"?K.Reflect=y:ke=he(K.Reflect,ke),Be(ke);function he(ut,Ae){return function(Xe,Ct){typeof ut[Xe]!="function"&&Object.defineProperty(ut,Xe,{configurable:!0,writable:!0,value:Ct}),Ae&&Ae(Xe,Ct)}}})(function(Be){var K=Object.prototype.hasOwnProperty,ke=typeof Symbol=="function",he=ke&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ut=ke&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",Ae=typeof Object.create=="function",Xe={__proto__:[]}instanceof Array,Ct=!Ae&&!Xe,Lt={create:Ae?function(){return $r(Object.create(null))}:Xe?function(){return $r({__proto__:null})}:function(){return $r({})},has:Ct?function(Ke,Nt){return K.call(Ke,Nt)}:function(Ke,Nt){return Nt in Ke},get:Ct?function(Ke,Nt){return K.call(Ke,Nt)?Ke[Nt]:void 0}:function(Ke,Nt){return Ke[Nt]}},tr=Object.getPrototypeOf(Function),Yt=typeof We=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Yt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:V(),Er=!Yt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:at(),cr=!Yt&&typeof WeakMap=="function"?WeakMap:sr(),Rt=new cr;function Zt(Ke,Nt,Sr,xr){if(Jr(Sr)){if(!Ji(Ke))throw new TypeError;if(!_i(Nt))throw new TypeError;return ue(Ke,Nt)}else{if(!Ji(Ke))throw new TypeError;if(!ln(Nt))throw new TypeError;if(!ln(xr)&&!Jr(xr)&&!Ri(xr))throw new TypeError;return Ri(xr)&&(xr=void 0),Sr=ui(Sr),tt(Ke,Nt,Sr,xr)}}Be("decorate",Zt);function Rr(Ke,Nt){function Sr(xr,Lr){if(!ln(xr))throw new TypeError;if(!Jr(Lr)&&!Uo(Lr))throw new TypeError;fr(Ke,Nt,xr,Lr)}return Sr}Be("metadata",Rr);function re(Ke,Nt,Sr,xr){if(!ln(Sr))throw new TypeError;return Jr(xr)||(xr=ui(xr)),fr(Ke,Nt,Sr,xr)}Be("defineMetadata",re);function _r(Ke,Nt,Sr){if(!ln(Nt))throw new TypeError;return Jr(Sr)||(Sr=ui(Sr)),_e(Ke,Nt,Sr)}Be("hasMetadata",_r);function Ot(Ke,Nt,Sr){if(!ln(Nt))throw new TypeError;return Jr(Sr)||(Sr=ui(Sr)),ze(Ke,Nt,Sr)}Be("hasOwnMetadata",Ot);function _t(Ke,Nt,Sr){if(!ln(Nt))throw new TypeError;return Jr(Sr)||(Sr=ui(Sr)),wt(Ke,Nt,Sr)}Be("getMetadata",_t);function Kt(Ke,Nt,Sr){if(!ln(Nt))throw new TypeError;return Jr(Sr)||(Sr=ui(Sr)),Vt(Ke,Nt,Sr)}Be("getOwnMetadata",Kt);function Ue(Ke,Nt){if(!ln(Ke))throw new TypeError;return Jr(Nt)||(Nt=ui(Nt)),Mt(Ke,Nt)}Be("getMetadataKeys",Ue);function Cr(Ke,Nt){if(!ln(Ke))throw new TypeError;return Jr(Nt)||(Nt=ui(Nt)),Fr(Ke,Nt)}Be("getOwnMetadataKeys",Cr);function nn(Ke,Nt,Sr){if(!ln(Nt))throw new TypeError;Jr(Sr)||(Sr=ui(Sr));var xr=Z(Nt,Sr,!1);if(Jr(xr)||!xr.delete(Ke))return!1;if(xr.size>0)return!0;var Lr=Rt.get(Nt);return Lr.delete(Sr),Lr.size>0||Rt.delete(Nt),!0}Be("deleteMetadata",nn);function ue(Ke,Nt){for(var Sr=Ke.length-1;Sr>=0;--Sr){var xr=Ke[Sr],Lr=xr(Nt);if(!Jr(Lr)&&!Ri(Lr)){if(!_i(Lr))throw new TypeError;Nt=Lr}}return Nt}function tt(Ke,Nt,Sr,xr){for(var Lr=Ke.length-1;Lr>=0;--Lr){var gn=Ke[Lr],mi=gn(Nt,Sr,xr);if(!Jr(mi)&&!Ri(mi)){if(!ln(mi))throw new TypeError;xr=mi}}return xr}function Z(Ke,Nt,Sr){var xr=Rt.get(Ke);if(Jr(xr)){if(!Sr)return;xr=new Xt,Rt.set(Ke,xr)}var Lr=xr.get(Nt);if(Jr(Lr)){if(!Sr)return;Lr=new Xt,xr.set(Nt,Lr)}return Lr}function _e(Ke,Nt,Sr){var xr=ze(Ke,Nt,Sr);if(xr)return!0;var Lr=we(Nt);return Ri(Lr)?!1:_e(Ke,Lr,Sr)}function ze(Ke,Nt,Sr){var xr=Z(Nt,Sr,!1);return Jr(xr)?!1:Di(xr.has(Ke))}function wt(Ke,Nt,Sr){var xr=ze(Ke,Nt,Sr);if(xr)return Vt(Ke,Nt,Sr);var Lr=we(Nt);if(!Ri(Lr))return wt(Ke,Lr,Sr)}function Vt(Ke,Nt,Sr){var xr=Z(Nt,Sr,!1);if(!Jr(xr))return xr.get(Ke)}function fr(Ke,Nt,Sr,xr){var Lr=Z(Sr,xr,!0);Lr.set(Ke,Nt)}function Mt(Ke,Nt){var Sr=Fr(Ke,Nt),xr=we(Ke);if(xr===null)return Sr;var Lr=Mt(xr,Nt);if(Lr.length<=0)return Sr;if(Sr.length<=0)return Lr;for(var gn=new Er,mi=[],ii=0,Sn=Sr;ii<Sn.length;ii++){var Bi=Sn[ii],Vi=gn.has(Bi);Vi||(gn.add(Bi),mi.push(Bi))}for(var Ga=0,oa=Lr;Ga<oa.length;Ga++){var Bi=oa[Ga],Vi=gn.has(Bi);Vi||(gn.add(Bi),mi.push(Bi))}return mi}function Fr(Ke,Nt){var Sr=[],xr=Z(Ke,Nt,!1);if(Jr(xr))return Sr;for(var Lr=xr.keys(),gn=to(Lr),mi=0;;){var ii=ge(gn);if(!ii)return Sr.length=mi,Sr;var Sn=Pt(ii);try{Sr[mi]=Sn}catch(Bi){try{oe(gn)}finally{throw Bi}}mi++}}function Xn(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function Jr(Ke){return Ke===void 0}function Ri(Ke){return Ke===null}function yi(Ke){return typeof Ke=="symbol"}function ln(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function Sa(Ke,Nt){switch(Xn(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var Sr=Nt===3?"string":Nt===5?"number":"default",xr=Eo(Ke,he);if(xr!==void 0){var Lr=xr.call(Ke,Sr);if(ln(Lr))throw new TypeError;return Lr}return fa(Ke,Sr==="default"?"number":Sr)}function fa(Ke,Nt){if(Nt==="string"){var Sr=Ke.toString;if(di(Sr)){var xr=Sr.call(Ke);if(!ln(xr))return xr}var Lr=Ke.valueOf;if(di(Lr)){var xr=Lr.call(Ke);if(!ln(xr))return xr}}else{var Lr=Ke.valueOf;if(di(Lr)){var xr=Lr.call(Ke);if(!ln(xr))return xr}var gn=Ke.toString;if(di(gn)){var xr=gn.call(Ke);if(!ln(xr))return xr}}throw new TypeError}function Di(Ke){return!!Ke}function Ia(Ke){return""+Ke}function ui(Ke){var Nt=Sa(Ke,3);return yi(Nt)?Nt:Ia(Nt)}function Ji(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function di(Ke){return typeof Ke=="function"}function _i(Ke){return typeof Ke=="function"}function Uo(Ke){switch(Xn(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function Eo(Ke,Nt){var Sr=Ke[Nt];if(Sr!=null){if(!di(Sr))throw new TypeError;return Sr}}function to(Ke){var Nt=Eo(Ke,ut);if(!di(Nt))throw new TypeError;var Sr=Nt.call(Ke);if(!ln(Sr))throw new TypeError;return Sr}function Pt(Ke){return Ke.value}function ge(Ke){var Nt=Ke.next();return Nt.done?!1:Nt}function oe(Ke){var Nt=Ke.return;Nt&&Nt.call(Ke)}function we(Ke){var Nt=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===tr||Nt!==tr)return Nt;var Sr=Ke.prototype,xr=Sr&&Object.getPrototypeOf(Sr);if(xr==null||xr===Object.prototype)return Nt;var Lr=xr.constructor;return typeof Lr!="function"||Lr===Ke?Nt:Lr}function V(){var Ke={},Nt=[],Sr=function(){function mi(ii,Sn,Bi){this._index=0,this._keys=ii,this._values=Sn,this._selector=Bi}return mi.prototype["@@iterator"]=function(){return this},mi.prototype[ut]=function(){return this},mi.prototype.next=function(){var ii=this._index;if(ii>=0&&ii<this._keys.length){var Sn=this._selector(this._keys[ii],this._values[ii]);return ii+1>=this._keys.length?(this._index=-1,this._keys=Nt,this._values=Nt):this._index++,{value:Sn,done:!1}}return{value:void 0,done:!0}},mi.prototype.throw=function(ii){throw this._index>=0&&(this._index=-1,this._keys=Nt,this._values=Nt),ii},mi.prototype.return=function(ii){return this._index>=0&&(this._index=-1,this._keys=Nt,this._values=Nt),{value:ii,done:!0}},mi}();return function(){function mi(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(mi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),mi.prototype.has=function(ii){return this._find(ii,!1)>=0},mi.prototype.get=function(ii){var Sn=this._find(ii,!1);return Sn>=0?this._values[Sn]:void 0},mi.prototype.set=function(ii,Sn){var Bi=this._find(ii,!0);return this._values[Bi]=Sn,this},mi.prototype.delete=function(ii){var Sn=this._find(ii,!1);if(Sn>=0){for(var Bi=this._keys.length,Vi=Sn+1;Vi<Bi;Vi++)this._keys[Vi-1]=this._keys[Vi],this._values[Vi-1]=this._values[Vi];return this._keys.length--,this._values.length--,ii===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},mi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},mi.prototype.keys=function(){return new Sr(this._keys,this._values,xr)},mi.prototype.values=function(){return new Sr(this._keys,this._values,Lr)},mi.prototype.entries=function(){return new Sr(this._keys,this._values,gn)},mi.prototype["@@iterator"]=function(){return this.entries()},mi.prototype[ut]=function(){return this.entries()},mi.prototype._find=function(ii,Sn){return this._cacheKey!==ii&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ii)),this._cacheIndex<0&&Sn&&(this._cacheIndex=this._keys.length,this._keys.push(ii),this._values.push(void 0)),this._cacheIndex},mi}();function xr(mi,ii){return mi}function Lr(mi,ii){return ii}function gn(mi,ii){return[mi,ii]}}function at(){return function(){function Ke(){this._map=new Xt}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(Nt){return this._map.has(Nt)},Ke.prototype.add=function(Nt){return this._map.set(Nt,Nt),this},Ke.prototype.delete=function(Nt){return this._map.delete(Nt)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[ut]=function(){return this.keys()},Ke}()}function sr(){var Ke=16,Nt=Lt.create(),Sr=xr();return function(){function Sn(){this._key=xr()}return Sn.prototype.has=function(Bi){var Vi=Lr(Bi,!1);return Vi!==void 0?Lt.has(Vi,this._key):!1},Sn.prototype.get=function(Bi){var Vi=Lr(Bi,!1);return Vi!==void 0?Lt.get(Vi,this._key):void 0},Sn.prototype.set=function(Bi,Vi){var Ga=Lr(Bi,!0);return Ga[this._key]=Vi,this},Sn.prototype.delete=function(Bi){var Vi=Lr(Bi,!1);return Vi!==void 0?delete Vi[this._key]:!1},Sn.prototype.clear=function(){this._key=xr()},Sn}();function xr(){var Sn;do Sn="@@WeakMap@@"+ii();while(Lt.has(Nt,Sn));return Nt[Sn]=!0,Sn}function Lr(Sn,Bi){if(!K.call(Sn,Sr)){if(!Bi)return;Object.defineProperty(Sn,Sr,{value:Lt.create()})}return Sn[Sr]}function gn(Sn,Bi){for(var Vi=0;Vi<Bi;++Vi)Sn[Vi]=Math.random()*255|0;return Sn}function mi(Sn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Sn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Sn)):gn(new Uint8Array(Sn),Sn):gn(new Array(Sn),Sn)}function ii(){var Sn=mi(Ke);Sn[6]=Sn[6]&79|64,Sn[8]=Sn[8]&191|128;for(var Bi="",Vi=0;Vi<Ke;++Vi){var Ga=Sn[Vi];(Vi===4||Vi===6||Vi===8)&&(Bi+="-"),Ga<16&&(Bi+="0"),Bi+=Ga.toString(16).toLowerCase()}return Bi}}function $r(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(de||(de={}))},69848:function(pi){(function(Se,fe){pi.exports=fe()})(this,function(){"use strict";function Se(Ot,_t,Kt,Ue,Cr,nn){if(!(Cr-Ue<=Kt)){var ue=Ue+Cr>>1;fe(Ot,_t,ue,Ue,Cr,nn%2),Se(Ot,_t,Kt,Ue,ue-1,nn+1),Se(Ot,_t,Kt,ue+1,Cr,nn+1)}}function fe(Ot,_t,Kt,Ue,Cr,nn){for(;Cr>Ue;){if(Cr-Ue>600){var ue=Cr-Ue+1,tt=Kt-Ue+1,Z=Math.log(ue),_e=.5*Math.exp(2*Z/3),ze=.5*Math.sqrt(Z*_e*(ue-_e)/ue)*(tt-ue/2<0?-1:1),wt=Math.max(Ue,Math.floor(Kt-tt*_e/ue+ze)),Vt=Math.min(Cr,Math.floor(Kt+(ue-tt)*_e/ue+ze));fe(Ot,_t,Kt,wt,Vt,nn)}var fr=_t[2*Kt+nn],Mt=Ue,Fr=Cr;for(We(Ot,_t,Ue,Kt),_t[2*Cr+nn]>fr&&We(Ot,_t,Ue,Cr);Mt<Fr;){for(We(Ot,_t,Mt,Fr),Mt++,Fr--;_t[2*Mt+nn]<fr;)Mt++;for(;_t[2*Fr+nn]>fr;)Fr--}_t[2*Ue+nn]===fr?We(Ot,_t,Ue,Fr):(Fr++,We(Ot,_t,Fr,Cr)),Fr<=Kt&&(Ue=Fr+1),Kt<=Fr&&(Cr=Fr-1)}}function We(Ot,_t,Kt,Ue){de(Ot,Kt,Ue),de(_t,2*Kt,2*Ue),de(_t,2*Kt+1,2*Ue+1)}function de(Ot,_t,Kt){var Ue=Ot[_t];Ot[_t]=Ot[Kt],Ot[Kt]=Ue}function y(Ot,_t,Kt,Ue,Cr,nn,ue){for(var tt=[0,Ot.length-1,0],Z=[],_e,ze;tt.length;){var wt=tt.pop(),Vt=tt.pop(),fr=tt.pop();if(Vt-fr<=ue){for(var Mt=fr;Mt<=Vt;Mt++)_e=_t[2*Mt],ze=_t[2*Mt+1],_e>=Kt&&_e<=Cr&&ze>=Ue&&ze<=nn&&Z.push(Ot[Mt]);continue}var Fr=Math.floor((fr+Vt)/2);_e=_t[2*Fr],ze=_t[2*Fr+1],_e>=Kt&&_e<=Cr&&ze>=Ue&&ze<=nn&&Z.push(Ot[Fr]);var Xn=(wt+1)%2;(wt===0?Kt<=_e:Ue<=ze)&&(tt.push(fr),tt.push(Fr-1),tt.push(Xn)),(wt===0?Cr>=_e:nn>=ze)&&(tt.push(Fr+1),tt.push(Vt),tt.push(Xn))}return Z}function Be(Ot,_t,Kt,Ue,Cr,nn){for(var ue=[0,Ot.length-1,0],tt=[],Z=Cr*Cr;ue.length;){var _e=ue.pop(),ze=ue.pop(),wt=ue.pop();if(ze-wt<=nn){for(var Vt=wt;Vt<=ze;Vt++)K(_t[2*Vt],_t[2*Vt+1],Kt,Ue)<=Z&&tt.push(Ot[Vt]);continue}var fr=Math.floor((wt+ze)/2),Mt=_t[2*fr],Fr=_t[2*fr+1];K(Mt,Fr,Kt,Ue)<=Z&&tt.push(Ot[fr]);var Xn=(_e+1)%2;(_e===0?Kt-Cr<=Mt:Ue-Cr<=Fr)&&(ue.push(wt),ue.push(fr-1),ue.push(Xn)),(_e===0?Kt+Cr>=Mt:Ue+Cr>=Fr)&&(ue.push(fr+1),ue.push(ze),ue.push(Xn))}return tt}function K(Ot,_t,Kt,Ue){var Cr=Ot-Kt,nn=_t-Ue;return Cr*Cr+nn*nn}var ke=function(Ot){return Ot[0]},he=function(Ot){return Ot[1]},ut=function(_t,Kt,Ue,Cr,nn){Kt===void 0&&(Kt=ke),Ue===void 0&&(Ue=he),Cr===void 0&&(Cr=64),nn===void 0&&(nn=Float64Array),this.nodeSize=Cr,this.points=_t;for(var ue=_t.length<65536?Uint16Array:Uint32Array,tt=this.ids=new ue(_t.length),Z=this.coords=new nn(_t.length*2),_e=0;_e<_t.length;_e++)tt[_e]=_e,Z[2*_e]=Kt(_t[_e]),Z[2*_e+1]=Ue(_t[_e]);Se(tt,Z,Cr,0,tt.length-1,0)};ut.prototype.range=function(_t,Kt,Ue,Cr){return y(this.ids,this.coords,_t,Kt,Ue,Cr,this.nodeSize)},ut.prototype.within=function(_t,Kt,Ue){return Be(this.ids,this.coords,_t,Kt,Ue,this.nodeSize)};var Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ot){return Ot}},Xe=Math.fround||function(Ot){return function(_t){return Ot[0]=+_t,Ot[0]}}(new Float32Array(1)),Ct=function(_t){this.options=Rr(Object.create(Ae),_t),this.trees=new Array(this.options.maxZoom+1)};Ct.prototype.load=function(_t){var Kt=this.options,Ue=Kt.log,Cr=Kt.minZoom,nn=Kt.maxZoom,ue=Kt.nodeSize;Ue&&console.time("total time");var tt="prepare "+_t.length+" points";Ue&&console.time(tt),this.points=_t;for(var Z=[],_e=0;_e<_t.length;_e++)!_t[_e].geometry||Z.push(tr(_t[_e],_e));this.trees[nn+1]=new ut(Z,re,_r,ue,Float32Array),Ue&&console.timeEnd(tt);for(var ze=nn;ze>=Cr;ze--){var wt=+Date.now();Z=this._cluster(Z,ze),this.trees[ze]=new ut(Z,re,_r,ue,Float32Array),Ue&&console.log("z%d: %d clusters in %dms",ze,Z.length,+Date.now()-wt)}return Ue&&console.timeEnd("total time"),this},Ct.prototype.getClusters=function(_t,Kt){var Ue=((_t[0]+180)%360+360)%360-180,Cr=Math.max(-90,Math.min(90,_t[1])),nn=_t[2]===180?180:((_t[2]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,_t[3]));if(_t[2]-_t[0]>=360)Ue=-180,nn=180;else if(Ue>nn){var tt=this.getClusters([Ue,Cr,180,ue],Kt),Z=this.getClusters([-180,Cr,nn,ue],Kt);return tt.concat(Z)}for(var _e=this.trees[this._limitZoom(Kt)],ze=_e.range(Er(Ue),cr(ue),Er(nn),cr(Cr)),wt=[],Vt=0,fr=ze;Vt<fr.length;Vt+=1){var Mt=fr[Vt],Fr=_e.points[Mt];wt.push(Fr.numPoints?Yt(Fr):this.points[Fr.index])}return wt},Ct.prototype.getChildren=function(_t){var Kt=this._getOriginId(_t),Ue=this._getOriginZoom(_t),Cr="No cluster with the specified id.",nn=this.trees[Ue];if(!nn)throw new Error(Cr);var ue=nn.points[Kt];if(!ue)throw new Error(Cr);for(var tt=this.options.radius/(this.options.extent*Math.pow(2,Ue-1)),Z=nn.within(ue.x,ue.y,tt),_e=[],ze=0,wt=Z;ze<wt.length;ze+=1){var Vt=wt[ze],fr=nn.points[Vt];fr.parentId===_t&&_e.push(fr.numPoints?Yt(fr):this.points[fr.index])}if(_e.length===0)throw new Error(Cr);return _e},Ct.prototype.getLeaves=function(_t,Kt,Ue){Kt=Kt||10,Ue=Ue||0;var Cr=[];return this._appendLeaves(Cr,_t,Kt,Ue,0),Cr},Ct.prototype.getTile=function(_t,Kt,Ue){var Cr=this.trees[this._limitZoom(_t)],nn=Math.pow(2,_t),ue=this.options,tt=ue.extent,Z=ue.radius,_e=Z/tt,ze=(Ue-_e)/nn,wt=(Ue+1+_e)/nn,Vt={features:[]};return this._addTileFeatures(Cr.range((Kt-_e)/nn,ze,(Kt+1+_e)/nn,wt),Cr.points,Kt,Ue,nn,Vt),Kt===0&&this._addTileFeatures(Cr.range(1-_e/nn,ze,1,wt),Cr.points,nn,Ue,nn,Vt),Kt===nn-1&&this._addTileFeatures(Cr.range(0,ze,_e/nn,wt),Cr.points,-1,Ue,nn,Vt),Vt.features.length?Vt:null},Ct.prototype.getClusterExpansionZoom=function(_t){for(var Kt=this._getOriginZoom(_t)-1;Kt<=this.options.maxZoom;){var Ue=this.getChildren(_t);if(Kt++,Ue.length!==1)break;_t=Ue[0].properties.cluster_id}return Kt},Ct.prototype._appendLeaves=function(_t,Kt,Ue,Cr,nn){for(var ue=this.getChildren(Kt),tt=0,Z=ue;tt<Z.length;tt+=1){var _e=Z[tt],ze=_e.properties;if(ze&&ze.cluster?nn+ze.point_count<=Cr?nn+=ze.point_count:nn=this._appendLeaves(_t,ze.cluster_id,Ue,Cr,nn):nn<Cr?nn++:_t.push(_e),_t.length===Ue)break}return nn},Ct.prototype._addTileFeatures=function(_t,Kt,Ue,Cr,nn,ue){for(var tt=0,Z=_t;tt<Z.length;tt+=1){var _e=Z[tt],ze=Kt[_e],wt=ze.numPoints,Vt=void 0,fr=void 0,Mt=void 0;if(wt)Vt=Xt(ze),fr=ze.x,Mt=ze.y;else{var Fr=this.points[ze.index];Vt=Fr.properties,fr=Er(Fr.geometry.coordinates[0]),Mt=cr(Fr.geometry.coordinates[1])}var Xn={type:1,geometry:[[Math.round(this.options.extent*(fr*nn-Ue)),Math.round(this.options.extent*(Mt*nn-Cr))]],tags:Vt},Jr=void 0;wt?Jr=ze.id:this.options.generateId?Jr=ze.index:this.points[ze.index].id&&(Jr=this.points[ze.index].id),Jr!==void 0&&(Xn.id=Jr),ue.features.push(Xn)}},Ct.prototype._limitZoom=function(_t){return Math.max(this.options.minZoom,Math.min(Math.floor(+_t),this.options.maxZoom+1))},Ct.prototype._cluster=function(_t,Kt){for(var Ue=[],Cr=this.options,nn=Cr.radius,ue=Cr.extent,tt=Cr.reduce,Z=Cr.minPoints,_e=nn/(ue*Math.pow(2,Kt)),ze=0;ze<_t.length;ze++){var wt=_t[ze];if(!(wt.zoom<=Kt)){wt.zoom=Kt;for(var Vt=this.trees[Kt+1],fr=Vt.within(wt.x,wt.y,_e),Mt=wt.numPoints||1,Fr=Mt,Xn=0,Jr=fr;Xn<Jr.length;Xn+=1){var Ri=Jr[Xn],yi=Vt.points[Ri];yi.zoom>Kt&&(Fr+=yi.numPoints||1)}if(Fr>Mt&&Fr>=Z){for(var ln=wt.x*Mt,Sa=wt.y*Mt,fa=tt&&Mt>1?this._map(wt,!0):null,Di=(ze<<5)+(Kt+1)+this.points.length,Ia=0,ui=fr;Ia<ui.length;Ia+=1){var Ji=ui[Ia],di=Vt.points[Ji];if(!(di.zoom<=Kt)){di.zoom=Kt;var _i=di.numPoints||1;ln+=di.x*_i,Sa+=di.y*_i,di.parentId=Di,tt&&(fa||(fa=this._map(wt,!0)),tt(fa,this._map(di)))}}wt.parentId=Di,Ue.push(Lt(ln/Fr,Sa/Fr,Di,Fr,fa))}else if(Ue.push(wt),Fr>1)for(var Uo=0,Eo=fr;Uo<Eo.length;Uo+=1){var to=Eo[Uo],Pt=Vt.points[to];Pt.zoom<=Kt||(Pt.zoom=Kt,Ue.push(Pt))}}}return Ue},Ct.prototype._getOriginId=function(_t){return _t-this.points.length>>5},Ct.prototype._getOriginZoom=function(_t){return(_t-this.points.length)%32},Ct.prototype._map=function(_t,Kt){if(_t.numPoints)return Kt?Rr({},_t.properties):_t.properties;var Ue=this.points[_t.index].properties,Cr=this.options.map(Ue);return Kt&&Cr===Ue?Rr({},Cr):Cr};function Lt(Ot,_t,Kt,Ue,Cr){return{x:Xe(Ot),y:Xe(_t),zoom:Infinity,id:Kt,parentId:-1,numPoints:Ue,properties:Cr}}function tr(Ot,_t){var Kt=Ot.geometry.coordinates,Ue=Kt[0],Cr=Kt[1];return{x:Xe(Er(Ue)),y:Xe(cr(Cr)),zoom:Infinity,index:_t,parentId:-1}}function Yt(Ot){return{type:"Feature",id:Ot.id,properties:Xt(Ot),geometry:{type:"Point",coordinates:[Rt(Ot.x),Zt(Ot.y)]}}}function Xt(Ot){var _t=Ot.numPoints,Kt=_t>=1e4?Math.round(_t/1e3)+"k":_t>=1e3?Math.round(_t/100)/10+"k":_t;return Rr(Rr({},Ot.properties),{cluster:!0,cluster_id:Ot.id,point_count:_t,point_count_abbreviated:Kt})}function Er(Ot){return Ot/360+.5}function cr(Ot){var _t=Math.sin(Ot*Math.PI/180),Kt=.5-.25*Math.log((1+_t)/(1-_t))/Math.PI;return Kt<0?0:Kt>1?1:Kt}function Rt(Ot){return(Ot-.5)*360}function Zt(Ot){var _t=(180-Ot*360)*Math.PI/180;return 360*Math.atan(Math.exp(_t))/Math.PI-90}function Rr(Ot,_t){for(var Kt in _t)Ot[Kt]=_t[Kt];return Ot}function re(Ot){return Ot.x}function _r(Ot){return Ot.y}return Ct})}}]);
