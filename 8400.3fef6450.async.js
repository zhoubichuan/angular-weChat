var ty=(yr,ne,N)=>new Promise((ge,ee)=>{var y=ae=>{try{z(N.next(ae))}catch(te){ee(te)}},ce=ae=>{try{z(N.throw(ae))}catch(te){ee(te)}},z=ae=>ae.done?ge(ae.value):Promise.resolve(ae.value).then(y,ce);z((N=N.apply(yr,ne)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8400],{64335:function(yr,ne,N){"use strict";var ge=N(67294),ee=(0,ge.createContext)({});ne.Z=ee},21349:function(yr,ne,N){"use strict";var ge=N(84305),ee=N(39559),y=N(85893),ce=N(94184),z=N.n(ce),ae=N(67294),te=N(64335),Pe=N(53645),re=N.n(Pe),Ze=function(nt){var Tt=(0,ae.useContext)(te.Z),Ct=nt.children,Gt=nt.contentWidth,Jt=nt.className,Zt=nt.style,wt=(0,ae.useContext)(ee.ZP.ConfigContext),xt=wt.getPrefixCls,Lr=nt.prefixCls||xt("pro"),mr=Gt||Tt.contentWidth,hr="".concat(Lr,"-grid-content");return(0,y.jsx)("div",{className:z()(hr,Jt,{wide:mr==="Fixed"}),style:Zt,children:(0,y.jsx)("div",{className:"".concat(Lr,"-grid-content-children"),children:Ct})})};ne.Z=Ze},90857:function(yr){"use strict";var ne=Object.prototype.hasOwnProperty,N="~";function ge(){}Object.create&&(ge.prototype=Object.create(null),new ge().__proto__||(N=!1));function ee(ae,te,Pe){this.fn=ae,this.context=te,this.once=Pe||!1}function y(ae,te,Pe,re,Ze){if(typeof Pe!="function")throw new TypeError("The listener must be a function");var Ke=new ee(Pe,re||ae,Ze),nt=N?N+te:te;return ae._events[nt]?ae._events[nt].fn?ae._events[nt]=[ae._events[nt],Ke]:ae._events[nt].push(Ke):(ae._events[nt]=Ke,ae._eventsCount++),ae}function ce(ae,te){--ae._eventsCount==0?ae._events=new ge:delete ae._events[te]}function z(){this._events=new ge,this._eventsCount=0}z.prototype.eventNames=function(){var te=[],Pe,re;if(this._eventsCount===0)return te;for(re in Pe=this._events)ne.call(Pe,re)&&te.push(N?re.slice(1):re);return Object.getOwnPropertySymbols?te.concat(Object.getOwnPropertySymbols(Pe)):te},z.prototype.listeners=function(te){var Pe=N?N+te:te,re=this._events[Pe];if(!re)return[];if(re.fn)return[re.fn];for(var Ze=0,Ke=re.length,nt=new Array(Ke);Ze<Ke;Ze++)nt[Ze]=re[Ze].fn;return nt},z.prototype.listenerCount=function(te){var Pe=N?N+te:te,re=this._events[Pe];return re?re.fn?1:re.length:0},z.prototype.emit=function(te,Pe,re,Ze,Ke,nt){var Tt=N?N+te:te;if(!this._events[Tt])return!1;var Ct=this._events[Tt],Gt=arguments.length,Jt,Zt;if(Ct.fn){switch(Ct.once&&this.removeListener(te,Ct.fn,void 0,!0),Gt){case 1:return Ct.fn.call(Ct.context),!0;case 2:return Ct.fn.call(Ct.context,Pe),!0;case 3:return Ct.fn.call(Ct.context,Pe,re),!0;case 4:return Ct.fn.call(Ct.context,Pe,re,Ze),!0;case 5:return Ct.fn.call(Ct.context,Pe,re,Ze,Ke),!0;case 6:return Ct.fn.call(Ct.context,Pe,re,Ze,Ke,nt),!0}for(Zt=1,Jt=new Array(Gt-1);Zt<Gt;Zt++)Jt[Zt-1]=arguments[Zt];Ct.fn.apply(Ct.context,Jt)}else{var wt=Ct.length,xt;for(Zt=0;Zt<wt;Zt++)switch(Ct[Zt].once&&this.removeListener(te,Ct[Zt].fn,void 0,!0),Gt){case 1:Ct[Zt].fn.call(Ct[Zt].context);break;case 2:Ct[Zt].fn.call(Ct[Zt].context,Pe);break;case 3:Ct[Zt].fn.call(Ct[Zt].context,Pe,re);break;case 4:Ct[Zt].fn.call(Ct[Zt].context,Pe,re,Ze);break;default:if(!Jt)for(xt=1,Jt=new Array(Gt-1);xt<Gt;xt++)Jt[xt-1]=arguments[xt];Ct[Zt].fn.apply(Ct[Zt].context,Jt)}}return!0},z.prototype.on=function(te,Pe,re){return y(this,te,Pe,re,!1)},z.prototype.once=function(te,Pe,re){return y(this,te,Pe,re,!0)},z.prototype.removeListener=function(te,Pe,re,Ze){var Ke=N?N+te:te;if(!this._events[Ke])return this;if(!Pe)return ce(this,Ke),this;var nt=this._events[Ke];if(nt.fn)nt.fn===Pe&&(!Ze||nt.once)&&(!re||nt.context===re)&&ce(this,Ke);else{for(var Tt=0,Ct=[],Gt=nt.length;Tt<Gt;Tt++)(nt[Tt].fn!==Pe||Ze&&!nt[Tt].once||re&&nt[Tt].context!==re)&&Ct.push(nt[Tt]);Ct.length?this._events[Ke]=Ct.length===1?Ct[0]:Ct:ce(this,Ke)}return this},z.prototype.removeAllListeners=function(te){var Pe;return te?(Pe=N?N+te:te,this._events[Pe]&&ce(this,Pe)):(this._events=new ge,this._eventsCount=0),this},z.prototype.off=z.prototype.removeListener,z.prototype.addListener=z.prototype.on,z.prefixed=N,z.EventEmitter=z,yr.exports=z},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(yr){try{let re=function(){z||(z=!0,y())},Ze=function(){try{ce.documentElement.doScroll("left")}catch(Ke){return void setTimeout(Ze,50)}re()};var te=re,Pe=Ze,ne=(ne=document.getElementsByTagName("script"))[ne.length-1],N=ne.getAttribute("data-injectcss"),ne=ne.getAttribute("data-disable-injectsvg");if(!ne){var ge,ee,y,ce,z,ae=function(nt,Tt){Tt.parentNode.insertBefore(nt,Tt)};if(N&&!yr.__iconfont__svg__cssinject__){yr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(Ke){console&&console.log(Ke)}}ge=function(){var nt,Tt=document.createElement("div");Tt.innerHTML=yr._iconfont_svg_string_3580659,(Tt=Tt.getElementsByTagName("svg")[0])&&(Tt.setAttribute("aria-hidden","true"),Tt.style.position="absolute",Tt.style.width=0,Tt.style.height=0,Tt.style.overflow="hidden",Tt=Tt,(nt=document.body).firstChild?ae(Tt,nt.firstChild):nt.appendChild(Tt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ge,0):(ee=function(){document.removeEventListener("DOMContentLoaded",ee,!1),ge()},document.addEventListener("DOMContentLoaded",ee,!1)):document.attachEvent&&(y=ge,ce=yr.document,z=!1,Ze(),ce.onreadystatechange=function(){ce.readyState=="complete"&&(ce.onreadystatechange=null,re())})}}catch(re){}}(window)},90870:function(yr,ne,N){"use strict";N.d(ne,{zP:function(){return WL},JE:function(){return jB},ns:function(){return HL}});var ge={};N.r(ge),N.d(ge,{add:function(){return lp},adjoint:function(){return qn},clone:function(){return ar},copy:function(){return Er},create:function(){return Vt},determinant:function(){return li},equals:function(){return Lo},exactEquals:function(){return B0},frob:function(){return Hv},fromQuat:function(){return dg},fromQuat2:function(){return up},fromRotation:function(){return lg},fromRotationTranslation:function(){return zd},fromRotationTranslationScale:function(){return hg},fromRotationTranslationScaleOrigin:function(){return pg},fromScaling:function(){return ug},fromTranslation:function(){return sp},fromValues:function(){return vr},fromXRotation:function(){return cg},fromYRotation:function(){return Ud},fromZRotation:function(){return Sh},frustum:function(){return vg},getRotation:function(){return Ua},getScaling:function(){return Mo},getTranslation:function(){return fg},identity:function(){return In},invert:function(){return bn},lookAt:function(){return of},mul:function(){return jf},multiply:function(){return Pi},multiplyScalar:function(){return mg},multiplyScalarAndAdd:function(){return gg},ortho:function(){return Bo},orthoNO:function(){return jv},orthoZO:function(){return qp},perspective:function(){return Zd},perspectiveFromFieldOfView:function(){return Th},perspectiveNO:function(){return Vv},perspectiveZO:function(){return Ah},rotate:function(){return Yp},rotateX:function(){return eu},rotateY:function(){return op},rotateZ:function(){return pl},scale:function(){return Js},set:function(){return Rr},str:function(){return jd},sub:function(){return _g},subtract:function(){return Ic},targetTo:function(){return Vd},translate:function(){return Ga},transpose:function(){return yn}});var ee=N(67294),y=(0,ee.createContext)({});function ce(){return(0,ee.useContext)(y)}var z={},ae={},te=function(t){return ae[t]},Pe=function(t,r){ae[t]=r},re=function(t){return z[t]},Ze=function(t,r){z[t]=r},Ke={},nt={},Tt=34,Ct=10,Gt=13;function Jt(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function Zt(e,t){var r=Jt(e);return function(n,i){return t(r(n),i,e)}}function wt(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var i in n)i in t||r.push(t[i]=i)}),r}function xt(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function Lr(e){return e<0?"-"+xt(-e,6):e>9999?"+"+xt(e,6):xt(e,4)}function mr(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Lr(e.getUTCFullYear(),4)+"-"+xt(e.getUTCMonth()+1,2)+"-"+xt(e.getUTCDate(),2)+(i?"T"+xt(t,2)+":"+xt(r,2)+":"+xt(n,2)+"."+xt(i,3)+"Z":n?"T"+xt(t,2)+":"+xt(r,2)+":"+xt(n,2)+"Z":r||t?"T"+xt(t,2)+":"+xt(r,2)+"Z":"")}function hr(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(b,A){var w,I,P=i(b,function(L,Z){if(w)return w(L,Z-1);I=L,w=A?Zt(L,A):Jt(L)});return P.columns=I||[],P}function i(b,A){var w=[],I=b.length,P=0,L=0,Z,Q=I<=0,oe=!1;b.charCodeAt(I-1)===Ct&&--I,b.charCodeAt(I-1)===Gt&&--I;function Ae(){if(Q)return nt;if(oe)return oe=!1,Ke;var Ve,rt=P,_t;if(b.charCodeAt(rt)===Tt){for(;P++<I&&b.charCodeAt(P)!==Tt||b.charCodeAt(++P)===Tt;);return(Ve=P)>=I?Q=!0:(_t=b.charCodeAt(P++))===Ct?oe=!0:_t===Gt&&(oe=!0,b.charCodeAt(P)===Ct&&++P),b.slice(rt+1,Ve-1).replace(/""/g,'"')}for(;P<I;){if((_t=b.charCodeAt(Ve=P++))===Ct)oe=!0;else if(_t===Gt)oe=!0,b.charCodeAt(P)===Ct&&++P;else if(_t!==r)continue;return b.slice(rt,Ve)}return Q=!0,b.slice(rt,I)}for(;(Z=Ae())!==nt;){for(var Oe=[];Z!==Ke&&Z!==nt;)Oe.push(Z),Z=Ae();A&&(Oe=A(Oe,L++))==null||w.push(Oe)}return w}function a(b,A){return b.map(function(w){return A.map(function(I){return _(w[I])}).join(e)})}function s(b,A){return A==null&&(A=wt(b)),[A.map(_).join(e)].concat(a(b,A)).join(`
`)}function l(b,A){return A==null&&(A=wt(b)),a(b,A).join(`
`)}function f(b){return b.map(d).join(`
`)}function d(b){return b.map(_).join(e)}function _(b){return b==null?"":b instanceof Date?mr(b):t.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:f,formatRow:d,formatValue:_}}var Et=hr(","),lt=Et.parse,Ut=Et.parseRows,vt=Et.format,er=Et.formatBody,xr=Et.formatRows,q=Et.formatRow,De=Et.formatValue,F=N(28991),Me=63710088e-1,Te={centimeters:Me*100,centimetres:Me*100,degrees:Me/111325,feet:Me*3.28084,inches:Me*39.37,kilometers:Me/1e3,kilometres:Me/1e3,meters:Me,metres:Me,miles:Me/1609.344,millimeters:Me*1e3,millimetres:Me*1e3,nauticalmiles:Me/1852,radians:1,yards:Me*1.0936},ht={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Me,yards:1.0936133},bt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function St(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function qt(e,t,r){switch(r===void 0&&(r={}),e){case"Point":return or(t).geometry;case"LineString":return on(t).geometry;case"Polygon":return Or(t).geometry;case"MultiPoint":return xn(t).geometry;case"MultiLineString":return ei(t).geometry;case"MultiPolygon":return Fi(t).geometry;default:throw new Error(e+" is invalid")}}function or(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!de(e[0])||!de(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return St(n,t,r)}function rn(e,t,r){return r===void 0&&(r={}),mi(e.map(function(n){return or(n,t)}),r)}function Or(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return St(l,t,r)}function Kn(e,t,r){return r===void 0&&(r={}),mi(e.map(function(n){return Or(n,t)}),r)}function on(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return St(n,t,r)}function Pn(e,t,r){return r===void 0&&(r={}),mi(e.map(function(n){return on(n,t)}),r)}function mi(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function ei(e,t,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return St(n,t,r)}function xn(e,t,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return St(n,t,r)}function Fi(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return St(n,t,r)}function zi(e,t,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return St(n,t,r)}function Li(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function Qn(e,t){t===void 0&&(t="kilometers");var r=Te[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Ln(e,t){t===void 0&&(t="kilometers");var r=Te[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Fo(e,t){return ao(Ln(e,t))}function sa(e){var t=e%360;return t<0&&(t+=360),t}function ao(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Pt(e){var t=e%360;return t*Math.PI/180}function k(e,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Qn(Ln(e,t),r)}function se(e,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=bt[t];if(!n)throw new Error("invalid original units");var i=bt[r];if(!i)throw new Error("invalid final units");return e/n*i}function de(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function je(e){return!!e&&e.constructor===Object}function mt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!de(t))throw new Error("bbox must only contain numbers")})}function Kt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ar(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Xe(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Mt(e[0]);throw new Error("coordinates must only contain numbers")}function sr(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function dr(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function Gr(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!a.geometry||a.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+a.geometry.type)}}function Nn(e){return e.type==="Feature"?e.geometry:e}function On(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function An(e,t,r){if(e!==null)for(var n,i,a,s,l,f,d,_=0,b=0,A,w=e.type,I=w==="FeatureCollection",P=w==="Feature",L=I?e.features.length:1,Z=0;Z<L;Z++){d=I?e.features[Z].geometry:P?e.geometry:e,A=d?d.type==="GeometryCollection":!1,l=A?d.geometries.length:1;for(var Q=0;Q<l;Q++){var oe=0,Ae=0;if(s=A?d.geometries[Q]:d,s!==null){f=s.coordinates;var Oe=s.type;switch(_=r&&(Oe==="Polygon"||Oe==="MultiPolygon")?1:0,Oe){case null:break;case"Point":if(t(f,b,Z,oe,Ae)===!1)return!1;b++,oe++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(t(f[n],b,Z,oe,Ae)===!1)return!1;b++,Oe==="MultiPoint"&&oe++}Oe==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(i=0;i<f[n].length-_;i++){if(t(f[n][i],b,Z,oe,Ae)===!1)return!1;b++}Oe==="MultiLineString"&&oe++,Oe==="Polygon"&&Ae++}Oe==="Polygon"&&oe++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(Ae=0,i=0;i<f[n].length;i++){for(a=0;a<f[n][i].length-_;a++){if(t(f[n][i][a],b,Z,oe,Ae)===!1)return!1;b++}Ae++}oe++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(An(s.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Tn(e,t,r,n){var i=r;return An(e,function(a,s,l,f,d){s===0&&r===void 0?i=a:i=t(i,a,s,l,f,d)},n),i}function fi(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&t(e.features[r].properties,r)!==!1;r++);break;case"Feature":t(e.properties,0);break}}function ni(e,t,r){var n=r;return fi(e,function(i,a){a===0&&r===void 0?n=i:n=t(n,i,a)}),n}function ta(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function ra(e,t,r){var n=r;return ta(e,function(i,a){a===0&&r===void 0?n=i:n=t(n,i,a)}),n}function Zo(e){var t=[];return An(e,function(r){t.push(r)}),t}function Ts(e,t){var r,n,i,a,s,l,f,d,_,b,A=0,w=e.type==="FeatureCollection",I=e.type==="Feature",P=w?e.features.length:1;for(r=0;r<P;r++){for(l=w?e.features[r].geometry:I?e.geometry:e,d=w?e.features[r].properties:I?e.properties:{},_=w?e.features[r].bbox:I?e.bbox:void 0,b=w?e.features[r].id:I?e.id:void 0,f=l?l.type==="GeometryCollection":!1,s=f?l.geometries.length:1,i=0;i<s;i++){if(a=f?l.geometries[i]:l,a===null){if(t(null,A,d,_,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,A,d,_,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(t(a.geometries[n],A,d,_,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function wi(e,t,r){var n=r;return Ts(e,function(i,a,s,l,f){a===0&&r===void 0?n=i:n=t(n,i,a,s,l,f)}),n}function G(e,t){Ts(e,function(r,n,i,a,s){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return t(St(r,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var d=0;d<r.coordinates.length;d++){var _=r.coordinates[d],b={type:f,coordinates:_};if(t(St(b,i),n,d)===!1)return!1}})}function J(e,t,r){var n=r;return G(e,function(i,a,s){a===0&&s===0&&r===void 0?n=i:n=t(n,i,a,s)}),n}function ue(e,t){G(e,function(r,n,i){var a=0;if(!!r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,f=0,d=0,_=0;if(An(r,function(b,A,w,I,P){if(l===void 0||n>f||I>d||P>_){l=b,f=n,d=I,_=P,a=0;return}var L=lineString([l,b],r.properties);if(t(L,n,i,P,a)===!1)return!1;a++,l=b})===!1)return!1}}})}function be(e,t,r){var n=r,i=!1;return ue(e,function(a,s,l,f,d){i===!1&&r===void 0?n=a:n=t(n,a,s,l,f,d),i=!0}),n}function ke(e,t){if(!e)throw new Error("geojson is required");G(e,function(r,n,i){if(r.geometry!==null){var a=r.geometry.type,s=r.geometry.coordinates;switch(a){case"LineString":if(t(r,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(t(lineString(s[l],r.properties),n,i,l)===!1)return!1;break}}})}function it(e,t,r){var n=r;return ke(e,function(i,a,s,l){a===0&&r===void 0?n=i:n=t(n,i,a,s,l)}),n}function ct(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),s=s||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=f.length+a-1),lineString([f[a],f[a+1]],s,t);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a-1),lineString([f[i][a],f[i][a+1]],s,t);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a-1),lineString([f[n][a],f[n][a+1]],s,t);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a-1),lineString([f[n][i][a],f[n][i][a+1]],s,t)}throw new Error("geojson is invalid")}function me(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,n=t.multiFeatureIndex||0,i=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),s=s||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return point(f,s,t);case"MultiPoint":return n<0&&(n=f.length+n),point(f[n],s,t);case"LineString":return a<0&&(a=f.length+a),point(f[a],s,t);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),point(f[i][a],s,t);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a),point(f[n][a],s,t);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a),point(f[n][i][a],s,t)}throw new Error("geojson is invalid")}var Y=N(5991),ye=N(6610),tt=N(10379),gt=N(46070),le=N(77608),br=N(14665);function En(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(t){return typeof e=="function"}}var vn=N(51814);function rr(e,t,r){return(0,vn.Z)()?rr=Reflect.construct.bind():rr=function(i,a,s){var l=[null];l.push.apply(l,a);var f=Function.bind.apply(i,l),d=new f;return s&&(0,br.Z)(d,s.prototype),d},rr.apply(null,arguments)}function nn(e){var t=typeof Map=="function"?new Map:void 0;return nn=function(n){if(n===null||!En(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return rr(n,arguments,(0,le.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,br.Z)(i,n)},nn(e)}var Hr={REGISTERED_PROTOCOLS:{}};function Yr(e){var t=gi();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function gi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jr=function(t){return Hr.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]},xi=function(e){(0,tt.Z)(r,e);var t=Yr(r);function r(n,i,a,s){var l;return(0,ye.Z)(this,r),l=t.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,Y.Z)(r)}(nn(Error));function Gi(e,t){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){t(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var a=r.response;if(e.type==="json")try{a=JSON.parse(r.response)}catch(l){return t(l)}t(null,a,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var s=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new xi(r.status,r.statusText,n.toString(),s))}},r.cancel=r.abort,r.send(e.body),r}function _i(e){return new Promise(function(t,r){Gi(e,function(n,i,a,s,l){n?r({err:n,data:null,xhr:l}):t({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function Ci(e,t){return Gi(e,t)}var Ri=function(t,r){var n=Jr(t.url)||Ci;return n((0,F.Z)((0,F.Z)({},t),{},{type:"json"}),r)},go=function(t,r){var n=Jr(t.url)||Ci;return n((0,F.Z)((0,F.Z)({},t),{},{type:"arrayBuffer"}),r)},Ji=function(t,r){return Ci(_objectSpread(_objectSpread({},t),{},{method:"POST"}),r)},Sa=function(t,r){return Ci((0,F.Z)((0,F.Z)({},t),{},{method:"GET"}),r)};function Mi(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var yi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ai(e,t){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){t(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=yi})},r.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(i):yi}function Ca(e,t){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){t(null,n)}).catch(function(n){t(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Vs=function(t,r,n){var i=function(s,l){if(s)r(s);else if(l){var f=typeof createImageBitmap=="function",d=n?n(l):l;f?Ca(d,r):Ai(d,r)}};return t.type==="json"?Ri(t,i):go(t,i)},va=function(t,r){var n=typeof createImageBitmap=="function";n?Ca(t,r):Ai(t,r)},Ra=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Yu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nu(e,t,r){var n=e.classList;for(var i in Yu)Yu.hasOwnProperty(i)&&n.remove("l7-".concat(r,"-anchor-").concat(i));n.add("l7-".concat(r,"-anchor-").concat(t))}var xa=N(2650);function as(e){return typeof e=="string"?!!d3.color(e):!1}function ii(e){var t=xa.ZP(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function ua(e){var t=e&&e[0],r=e&&e[1],n=e&&e[2],i=t+r*256+n*65536-1;return i}function Ma(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function na(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;for(var n=null,i=r.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var f=(e.positions[l]-a)/(s-a);i.addColorStop(f,e.colors[l])}return r.fillStyle=i,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:n,width:256,height:1}}function Yo(e,t){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=t[1]-t[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-t[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var f=n.getImageData(0,0,256,1).data,d=fc(n,f);return r=null,n=null,d}function Vo(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=ii(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),t=null,r=null,n}function Du(e){var t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[i],r.moveTo(i*n,0),r.lineTo((i+1)*n,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=fc(r,a);return t=null,r=null,s}function ws(e,t){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-t[0])/i*255,0),n.lineTo((e.positions[a+1]-t[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=fc(n,s);return r=null,n=null,l}function fc(e,t){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=t[n+0],r.data[n+1]=t[n+1],r.data[n+2]=t[n+2],r.data[n+3]=t[n+3];return r}function Da(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var ji={BACK:1029,FRONT:1028};function jo(e){switch(e){case"GAODE1.x":return ji.BACK;case"GAODE2.x":return ji.BACK;case"MAPBOX":return ji.FRONT;case"SIMPLE":return ji.FRONT;case"GLOBEL":return ji.BACK;case"DEBAULT":return ji.FRONT;default:return ji.FRONT}}var Wt=N(85061),K=N(28481),Re=N(74691),st=N.n(Re),nr=N(50361),Wr=N.n(nr),Dn=N(23279),Hi=N.n(Dn),oo=N(27361),_o=N.n(oo),to=N(51584),Cs=N.n(to),Uc=N(60442),iu=N.n(Uc),mf=N(14293),Ho=N.n(mf),yl=N(81763),xl=N.n(yl),Fu=N(68630),ku=N.n(Fu),qu=N(47037),zc=N.n(qu),Rs=N(36719),Za=N.n(Rs),bl=N(82492),Ku=N.n(bl),gf=N(30236),zh=N.n(gf),_f=N(97019),rh=N.n(_f),nh=N(23493),ih=N.n(nh),Zh=N(44908),Vh=N.n(Zh),Bp=N(11700),Zc=N.n(Bp),Bu=N(23560),jh=N.n(Bu),Wo=N(13218),zl=N.n(Wo),El=N(52353),js=N.n(El),Sl=N(68929),au=N.n(Sl),di={isNil:Ho(),merge:Ku(),throttle:ih(),isString:zc(),debounce:Hi(),pull:rh(),isTypedArray:Za(),isPlainObject:ku(),isNumber:xl(),isBoolean:Cs(),isEqual:iu(),cloneDeep:Wr(),uniq:Vh(),clamp:st(),upperFirst:Zc(),get:_o(),mergeWith:zh(),isFunction:jh(),isObject:zl(),isUndefined:js(),camelCase:au()},Hs=di.pull;function Lu(e){var t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function Qu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ah(e){return Qu(e).split(/\s+/)}function Hh(e){var t,r=(t=document)===null||t===void 0||(t=t.documentElement)===null||t===void 0?void 0:t.style;if(!r)return e[0];for(var n in e)if(e[n]&&e[n]in r)return e[n];return e[0]}function Fn(e,t,r){var n=window.document.createElement(e);return t&&(n.className=t||""),r&&r.appendChild(n),n}function Ws(e){var t=e.parentNode;t&&t.removeChild(e)}function Ms(e,t){if(e.classList!==void 0)for(var r=ah(t),n=0,i=r.length;n<i;n++)e.classList.add(r[n]);else if(!Va(e,t)){var a=xf(e);yf(e,(a?a+" ":"")+t)}}function Ju(e,t){if(e.classList!==void 0){var r=ah(t);r.forEach(function(n){e.classList.remove(n)})}else yf(e,Qu((" "+xf(e)+" ").replace(" "+t+" "," ")))}function Va(e,t){if(e.classList!==void 0)return e.classList.contains(t);var r=xf(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function yf(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function xf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Is(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var el=Hh(["transform","WebkitTransform"]);function mu(e,t){e.style[el]=t}function Al(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function oh(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,t.join(""))}function hc(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var r=(e=t.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(i){var a=i.split("="),s=(0,K.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var la=hc()<1?1:window.devicePixelRatio;function pc(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function tl(e){return e.split(";").map(function(t){return t.trim()}).filter(function(t){return t})}function Tl(e,t){var r,n=tl((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),i=tl(t),a=Hs.apply(void 0,[n].concat((0,Wt.Z)(i)));e.setAttribute("style",a.join(";"))}function sh(e){return Object.entries(e).map(function(t){var r=(0,K.Z)(t,2),n=r[0],i=r[1];return"".concat(n,": ").concat(i)}).join(";")}function Vc(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function ca(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function wl(e){e.innerHTML=""}function Wh(e){e.setAttribute("draggable","false")}function Ps(e,t){if(typeof t=="string"){var r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append.apply(e,(0,Wt.Z)(t)):e.append(t)}function jc(e,t){for(var r=Array.isArray(t)?t:[t],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(r.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var Hc;function bf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function rl(){return typeof importScripts=="function"}var Zl=rl()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Nu=(Hc=navigator)===null||Hc===void 0?void 0:Hc.userAgent,Wc=!!Nu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),dc=Nu.indexOf("Android")>-1||Nu.indexOf("Adr")>-1;function Vl(){for(var e=Nu,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,i=t;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){r=!1;break}}return r}function Ef(e,t){e.forEach(function(r){!t[r]||(t[r]=t[r].bind(t))})}var vc=null;function Os(e){var t=[Infinity,Infinity,-Infinity,-Infinity];return An(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Os.default=Os;var uh=Os;function Gc(e){return typeof e=="number"}var mc=2*Math.PI*6378137/2;function Cl(e,t){var r=(0,K.Z)(t,4),n=r[0],i=r[1],a=r[2],s=r[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function Uu(e){var t=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;jl(t,n)}),t}function jl(e,t){return Array.isArray(t[0])?t.forEach(function(r){jl(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function Sf(e,t){return nl(e,t)}function nl(e,t){return Array.isArray(e[0])?e.map(function(r){return nl(r,t)}):t(e)}function lh(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Gh(e,t);var n=e[0],i=e[1],a=n*mc/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*mc/180,r.enable&&(a=Number(a.toFixed(r.decimal)),s=Number(s.toFixed(r.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function ch(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],i=r/mc*180,a=n/mc*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),t!=null&&(i=Number(i.toFixed(t)),a=Number(a.toFixed(t))),e.length===3?[i,a,e[2]]:[i,a]}function fh(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Af(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Gh(e,t){if(t===!1)return e;var r=fh(e[0]),n=Af(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function so(e){var t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),n=256<<20,i=Math.PI/180,a=e[0]*i,s=r*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,f=.5,d=-.5/Math.PI;return i=.5,a=n*(l*a+f),s=n*(d*s+i),[Math.floor(a),Math.floor(s)]}function Xh(e){var t=.5/Math.PI,r=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],f=s[1];l=(l/a-r)/t,f=(f/a-i)/n,f=(Math.atan(Math.pow(Math.E,f))-Math.PI/4)*2,i=Math.PI/180;var d=f/i,_=l/i;return[_,d]}function Tf(e,t){var r=85.0511287798,n=Math.PI/180,i=6378137;return t=Math.max(Math.min(r,t),-r),e*=n,t*=n,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*i,t*i]}function $h(e,t){var r=Math.PI/180,n=6378137,i=e/n/r,a=2*(Math.atan(Math.exp(t/n))-Math.PI/4)/r;return[i,a]}function Hl(e,t,r){var n=Pt(t[1]-e[1]),i=Pt(t[0]-e[0]),a=Pt(e[1]),s=Pt(t[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return Qn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function Yh(e){var t=Math.PI/180,r=85.0511287798,n=6378137,i=Math.max(Math.min(r,e[1]),-r),a=Math.sin(i*t),s=n*e[0]*t,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function ou(e,t){var r=Math.abs(e[1][1]-e[0][1])*t,n=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function fa(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Wl(e){return[[e[0],e[1]],[e[2],e[3]]]}function zu(e){var t=il(e,[0,0]);return[e[0]/t,e[1]/t]}function il(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Ni(e,t){return e[0]*t[0]+e[1]*t[1]}function ma(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function su(e,t){return Math.acos(Ni(e,t)/(ma(e)*ma(t)))*180/Math.PI}function Xc(e,t){return t[0]>0?t[1]>0?90-Math.atan(t[1]/t[0])*180/Math.PI:90+Math.atan(-t[1]/t[0])*180/Math.PI:t[1]<0?180+(90-Math.atan(t[1]/t[0])*180/Math.PI):270+Math.atan(t[1]/-t[0])*180/Math.PI}function $c(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],f=il(s,l);n+=f;var d=[s[0]-l[0],s[1]-l[1]],_=Xc(r,d);if(a>0){var b=i[a-1].rotation;b-_>360-b+_&&(_=_+360)}i.push({start:s,end:l,dis:f,rotation:_,duration:0})}return i.map(function(A){A.duration=t*(A.dis/n)}),i}}function Gs(e){if(Gc(e[0]))return e;if(Gc(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Gc(e[0][0][0])){var t=e,r=0,n=0,i=0;return t.forEach(function(a){a.forEach(function(s){r+=s[0],n+=s[1],i++})}),[r/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function qh(e){for(var t=e[0],r=e[1],n=e[0],i=e[1],a=0,s=0,l=0,f=0;f<e.length;f+=2){var d=e[f],_=e[f+1];d&&_&&(t=Math.max(d,t),r=Math.max(_,r),n=Math.min(d,n),i=Math.min(_,i),a+=d,s+=_,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(t-n,2)+Math.pow(r-i,2))/2}}function wf(e){return uh(mi([on(e)]))}function Cf(e){var t=131,r=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/r),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/r)),n=n*t+e.charCodeAt(a);return n}function Gl(e){e=e.toString();for(var t=5381,r=e.length;r;)t=t*33^e.charCodeAt(--r);return t>>>0}function yo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e==="x"?t:t&3|8;return r.toString(16)})}var Fa=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Yc(e,t,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=r;return s&&(l=Math.round(r*(a-1))/(a-1)),n?os(e,t,l,n,i):os(e,t,l,.314,i)}function gc(e,t){var r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function Ka(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function _n(e,t,r){var n=[t[0]-e[0],t[1]-e[1]],i=Ka(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(r),l=a+r,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function os(e,t,r,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(t[0],t[1]),l=_n(a,s,n),f=[a[0],l[0],s[0]],d=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(gc(f,r),gc(d,r))),[0])}else{var _=_n(e,t,n),b=[e[0],_[0],t[0]],A=[e[1],_[1],t[1]];return[gc(b,r),gc(A,r),0]}}function Rf(e,t,r,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=r;return s&&(l=Math.round(r*29)/29),Mf(e,t,l,i)}function _c(e,t){var r=[t[0]-e[0],t[1]-e[1]],n=calDistance(r,[0,0]),i=Math.atan2(r[1],r[0]),a=.314,s=n/2/Math.cos(a),l=i+a,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function qo(e,t){var r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function ha(e,t){var r=[e[0]-t[0],e[1]-t[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(t[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Mf(e,t,r,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(t[0]),degreesToRadians(t[1])];if(n==="GAODE2.x"){var s=_c(i,a),l=[i[0],s[0],a[0]],f=[i[1],s[1],a[1]];return[qo(l,r),qo(f,r),0]}else{var d=ha(i,a);if(Math.abs(d-Math.PI)<.001)return[(1-r)*i[0]+r*a[0],(1-r)*i[1]+r*a[1]];var _=Math.sin((1-r)*d)/Math.sin(d),b=Math.sin(r*d)/Math.sin(d),A=[Math.sin(i[0]),Math.sin(i[1])],w=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],P=[Math.cos(a[0]),Math.cos(a[1])],L=_*w[1]*w[0]+b*P[1]*P[0],Z=_*w[1]*A[0]+b*P[1]*I[0],Q=_*A[1]+b*I[1];return[radiansToDegrees(Math.atan2(Z,L)),radiansToDegrees(Math.atan2(Q,Math.sqrt(L*L+Z*Z)))]}}function qr(e,t){for(var r=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=qc(a,s),f=r;r+=l,n.push({p1:a,p2:s,totalDistance:r,distance:l,lastTotalDistance:f})}for(var d=r*t,_,b,A=0,w=n;A<w.length;A++){var I=w[A],P=I.totalDistance;if(P>d){var L=I.p1,Z=I.p2,Q=(d-I.lastTotalDistance)/I.distance,oe=al(Z,L,Q);_=oe[0],b=oe[1];break}}return{lng:_,lat:b,height:0}}function al(e,t,r){return[e[0]*r+t[0]*(1-r),e[1]*r+t[1]*(1-r)]}function qc(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Kc(e,t){var r=t.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(i){var a=i.id;return a===r})),n.map(function(i){var a=Ds(i,t);return _objectSpread(_objectSpread({},i),a)})}function gu(e,t){return new Promise(function(r){e.inited?r(Kc(e,t)):e.once("update",function(){r(Kc(e,t))})})}function Ds(e,t){var r=t.offset,n=t.shape,i=t.thetaOffset,a=t.mapVersion,s=t.segmentNumber,l=s===void 0?30:s,f=t.autoFit,d=f===void 0?!0:f,_=e.coordinates;if(n==="line")return pathLineAtOffset(_,r);var b=_[0],A=_[1],w=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=arcLineAtOffset;break;case"greatcircle":I=greatCircleLineAtOffset;break;default:I=arcLineAtOffset}var P=I(b,A,r,w,a,l,d),L=_slicedToArray(P,3),Z=L[0],Q=L[1],oe=L[2];return{lng:Z,lat:Q,height:oe}}var If=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ye.Z)(this,e),this.limit=t,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Y.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(i){return i===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Pf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function ss(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function _u(e){if(e.length===0)return 0;for(var t=e[0]*1,r=1;r<e.length;r++)t+=e[r]*1;return t}function Kh(e){if(e.length===0)throw new Error("mean requires at least one data point");return _u(e)/e.length}function yc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],r=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==t?(i>n&&(n=i,r=t),i=1,t=e[a]):i++;return r*1}var xc={min:ss,max:Pf,mean:Kh,sum:_u,mode:yc};function Qc(e,t){return e.map(function(r){return r[t]})}function Fs(e,t){return xc[e](t)}var Ot=N(92137),Ee=N(63349),B=N(96156),Xs=N(87757),ve=N.n(Xs);function Rl(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[r,n],l=[r,a],f=[i,a],d=[i,n];return Or([[s,d,f,l,s]],t.properties,{bbox:e,id:t.id})}var ka=N(26729),ks=N.n(ka),xo=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),us=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),kn=0,Sn=1,Ko=2;function Qo(e){e.forEach(function(t){t.isCurrent&&(t.isVisible=t.isLoaded)})}function yu(e){e.forEach(function(t){t.properties.state=kn}),e.forEach(function(t){t.isCurrent&&!$s(t)&&xu(t)}),e.forEach(function(t){t.isVisible=Boolean(t.properties.state&Ko)})}function Ia(e){e.forEach(function(r){r.properties.state=kn}),e.forEach(function(r){r.isCurrent&&$s(r)});var t=e.slice().sort(function(r,n){return r.z-n.z});t.forEach(function(r){r.isVisible=Boolean(r.properties.state&Ko),r.children.length&&(r.isVisible||r.properties.state&Sn)?r.children.forEach(function(n){n.properties.state=Sn}):r.isCurrent&&xu(r)})}function $s(e){for(;e;){if(e.isLoaded)return e.properties.state|=Ko,!0;e=e.parent}return!1}function xu(e){e.children.forEach(function(t){t.isLoaded?t.properties.state|=Ko:xu(t)})}var bu,ia=256,uo=[-Infinity,-Infinity,Infinity,Infinity],hh=.2,Ml=5,Of=(bu={},(0,B.Z)(bu,xo.Realtime,Qo),(0,B.Z)(bu,xo.Overlap,yu),(0,B.Z)(bu,xo.Replace,Ia),bu),ol=function(){};function ls(e,t,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),i=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,i]}function Xl(e,t,r){var n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var Eu=function(t,r,n){var i=Xl(t,r,n),a=(0,K.Z)(i,2),s=a[0],l=a[1],f=Xl(t+1,r+1,n),d=(0,K.Z)(f,2),_=d[0],b=d[1];return[s,b,_,l]};function Df(e){var t=e.zoom,r=e.latLonBounds,n=e.maxZoom,i=n===void 0?Infinity:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,f=l===void 0?0:l,d=e.extent,_=d===void 0?uo:d,b=Math.ceil(t)+f;if(Number.isFinite(s)&&b<s)return[];Number.isFinite(i)&&b>i&&(b=i);for(var A=(0,K.Z)(r,4),w=A[0],I=A[1],P=A[2],L=A[3],Z=[Math.max(w,_[0]),Math.max(I,_[1]),Math.min(P,_[2]),Math.min(L,_[3])],Q=[],oe=ls(Z[0],Z[1],b),Ae=(0,K.Z)(oe,2),Oe=Ae[0],Ve=Ae[1],rt=ls(Z[2],Z[3],b),_t=(0,K.Z)(rt,2),Bt=_t[0],ur=_t[1],lr=Oe;lr<=Bt;lr++)for(var zr=ur;zr<=Ve;zr++)Q.push({x:lr,y:zr,z:b});var un=(Bt+Oe)/2,Rn=(Ve+ur)/2,Bi=function(io,Oo){return Math.abs(io-un)+Math.abs(Oo-Rn)};return Q.sort(function(eo,io){return Bi(eo.x,eo.y)-Bi(io.x,io.y)}),Q}var bc=function(t,r,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,f=t,d=r;return i&&(f<0?f=f+l:f>s&&(f=f%l)),{warpX:f,warpY:d}};function Jc(e){var t=Ff();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $l=function(e){(0,tt.Z)(r,e);var t=Jc(r);function r(n){var i;(0,ye.Z)(this,r),i=t.call(this),(0,B.Z)((0,Ee.Z)(i),"tileSize",256),(0,B.Z)((0,Ee.Z)(i),"isVisible",!1),(0,B.Z)((0,Ee.Z)(i),"isCurrent",!1),(0,B.Z)((0,Ee.Z)(i),"isVisibleChange",!1),(0,B.Z)((0,Ee.Z)(i),"loadedLayers",0),(0,B.Z)((0,Ee.Z)(i),"isLayerLoaded",!1),(0,B.Z)((0,Ee.Z)(i),"isLoad",!1),(0,B.Z)((0,Ee.Z)(i),"isChildLoad",!1),(0,B.Z)((0,Ee.Z)(i),"parent",null),(0,B.Z)((0,Ee.Z)(i),"children",[]),(0,B.Z)((0,Ee.Z)(i),"data",null),(0,B.Z)((0,Ee.Z)(i),"properties",{}),(0,B.Z)((0,Ee.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,f=n.tileSize,d=n.warp,_=d===void 0?!0:d;return i.x=a,i.y=s,i.z=l,i.warp=_||!0,i.tileSize=f,i}return(0,Y.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===us.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===us.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===us.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===us.Cancelled}},{key:"isDone",get:function(){return[us.Loaded,us.Cancelled,us.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Eu(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,K.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],f=i[3],d=[(l-a)/2,(f-s)/2],_=Rl(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:d,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l,f,d,_,b,A,w,I,P,L,Z,Q,oe,Ae,Oe,Ve,rt;return ve().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return l=s.getData,f=s.onLoad,d=s.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=us.Loading,b=null,Bt.prev=7,w=this.x,I=this.y,P=this.z,L=this.bounds,Z=this.tileSize,Q=this.warp,oe=bc(w,I,P,Q),Ae=oe.warpX,Oe=oe.warpY,Ve=this.abortController.signal,rt={x:Ae,y:Oe,z:P,bounds:L,tileSize:Z,signal:Ve,warp:Q},Bt.next=14,l(rt,this);case 14:b=Bt.sent,Bt.next=20;break;case 17:Bt.prev=17,Bt.t0=Bt.catch(7),A=Bt.t0;case 20:if(_===this.loadDataId){Bt.next=22;break}return Bt.abrupt("return");case 22:if(!(this.isCancelled&&!b)){Bt.next=24;break}return Bt.abrupt("return");case 24:if(!(A||!b)){Bt.next=28;break}return this.loadStatus=us.Failure,d(A,this),Bt.abrupt("return");case 28:this.loadStatus=us.Loaded,this.data=b,f(this);case 31:case"end":return Bt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=us.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(ka.EventEmitter),Yl=function(t,r){var n=Wl(t),i=ou(n,r),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},ph=function(t,r){var n=Wl(t),i=Wl(r),a=fa(n,i);return a};function Jo(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Su(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Su(e,t){if(!!e){if(typeof e=="string")return ef(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ef(e,t)}}function ef(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Il(e){var t=uu();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dh=di.throttle,Zu=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),kf=function(e){(0,tt.Z)(r,e);var t=Il(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),(0,B.Z)((0,Ee.Z)(i),"currentTiles",[]),(0,B.Z)((0,Ee.Z)(i),"cacheTiles",new Map),(0,B.Z)((0,Ee.Z)(i),"throttleUpdate",dh(function(a,s){i.update(a,s)},16)),(0,B.Z)((0,Ee.Z)(i),"onTileLoad",function(a){i.emit(Zu.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,B.Z)((0,Ee.Z)(i),"onTileError",function(a,s){i.emit(Zu.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,B.Z)((0,Ee.Z)(i),"onTileUnload",function(a){i.emit(Zu.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:uo,getTileData:ol,warp:!0,updateStrategy:xo.Replace},i.updateOptions(n),i}return(0,Y.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,F.Z)((0,F.Z)((0,F.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&ph(this.lastViewStates.latLonBoundsBuffer,a))){var f=Yl(a,hh);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:f},this.currentZoom=l;var d=!1,_=this.getTileIndices(l,f).filter(function(b){return s.options.warp||b.x>=0&&b.x<Math.pow(2,l)});this.emit(Zu.TilesLoadStart),this.currentTiles=_.map(function(b){var A=b.x,w=b.y,I=b.z,P=s.getTile(A,w,I);if(P){var L,Z,Q=((L=P)===null||L===void 0?void 0:L.isFailure)||((Z=P)===null||Z===void 0?void 0:Z.isCancelled);return Q&&P.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),P}return P=s.createTile(A,w,I),d=!0,P}),d&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Jo(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,K.Z)(a.value,2),l=s[0],f=s[1];if(!this.currentTiles.includes(f)){this.cacheTiles.delete(l),this.onTileUnload(f);return}this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(d){i.e(d)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(f){s.reloadTileById(f.z,f.x,f.y)})}},{key:"pruneRequests",value:function(){var i=[],a=Jo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(d){a.e(d)}finally{a.f()}for(;i.length>0;){var f=i.shift();f.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,f=Math.ceil(s)+l,d=ls(i,a,f),_=this.tiles.filter(function(b){return b.key==="".concat(d[0],"_").concat(d[1],"_").concat(f)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(f){return f.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Jo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=Jo(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var f=l.value;a.set(f.key,f.isVisible),f.isCurrent=!1,f.isVisible=!1}}catch(I){s.e(I)}finally{s.f()}var d=Jo(this.currentTiles),_;try{for(d.s();!(_=d.n()).done;){var b=_.value;b.isCurrent=!0,b.isVisible=!0}}catch(I){d.e(I)}finally{d.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):Of[i](A);var w=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,w=!0):I.isVisibleChange=!1}),w&&this.emit(Zu.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,f=s.extent,d=s.zoomOffset,_=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),A=Df({maxZoom:_,minZoom:b,zoomOffset:d,tileSize:l,zoom:i,latLonBounds:a,extent:f});return A}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(Zu.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=this.cacheTiles.get(l);return f}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=new $l({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),f}},{key:"resizeCacheTiles",value:function(){var i=Ml*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=Jo(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var f=(0,K.Z)(l.value,2),d=f[0],_=f[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(d),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(b){s.e(b)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Jo(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=Jo(this.cacheTiles.values()),f;try{for(l.s();!(f=l.n()).done;){var d=f.value,_=this.getNearestAncestor(d.x,d.y,d.z);d.parent=_,_!=null&&_.children&&_.children.push(d)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),r}(ks());function vh(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e){var t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),a;for(a=n;a<=i;++a)t.push(e.replace(r[0],String.fromCharCode(a)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var s=parseInt(r[2],10),l=parseInt(r[1],10);l<=s;l++)t.push(e.replace(r[0],l.toString()));return t}return t.push(e),t}function v(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=t.x,n=t.y,i=t.z,a=h(e),s=Math.abs(r+n)%a.length,l=Jr(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Eu(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function p(e,t){var r=t.x,n=t.y,i=t.z,a=t.layer,s=t.version,l=s===void 0?"1.0.0":s,f=t.style,d=f===void 0?"default":f,_=t.format,b=t.service,A=b===void 0?"WMTS":b,w=t.tileMatrixset,I="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(d,"&TILEMATRIXSET=").concat(w,"&FORMAT=").concat(_,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function g(e,t){if(!e)throw new Error(t||"web worker helper assertion failed.")}var S={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},C=S.self||S.window||{},R=S.window||S.self||{},O=S.self||S.window||{},j=S.document||{},$=typeof importScripts=="function",pe=typeof window!="undefined"&&typeof window.orientation!="undefined",_e=function(){function e(t,r){var n=this;this.name=t,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(t,r){this.workerThread.postMessage({source:"Main thread",type:t,payload:r})},e.prototype.done=function(t){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},e.prototype.error=function(t){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},e}(),xe=_e,Ue=new Map;function Be(e){g(e.source&&!e.url||!e.source&&e.url);var t=Ue.get(e.source||e.url);return t||(e.url&&(t=Qe(e.url),Ue.set(e.url,t)),e.source&&(t=Ie(e.source),Ue.set(e.source,t))),g(t),t}function Qe(e){if(!e.startsWith("http"))return e;var t=qe(e);return Ie(t)}function Ie(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function qe(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function ft(e,t,r){t===void 0&&(t=!0);var n=r||new Set;if(e){if(Rt(e))n.add(e);else if(Rt(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(var i in e)ft(e[i],t,n)}}return r===void 0?Array.from(n):[]}function Rt(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var $t=function(){},jt=function(){function e(t){this.terminated=!1,this.loadableURL="";var r=t.name,n=t.source,i=t.url;g(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=$t,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=$t,this.onError=$t,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(t,r){r=r||ft(t),this.worker.postMessage(t,r)},e.prototype.getErrorFromErrorEvent=function(t){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",t.message&&(r+=t.message+" in "),t.lineno&&(r+=":"+t.lineno+":"+t.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Be({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?t.onMessage(n.data):t.onError(new Error("No data received"))},r.onerror=function(n){t.onError(t.getErrorFromErrorEvent(n)),t.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+t.name+", message error: "+n)},r},e}(),ir=jt,pr=function(){return pr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},pr.apply(this,arguments)},Ur=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(b){s(b)}}function f(_){try{d(n.throw(_))}catch(b){s(b)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,t||[])).next())})},Fr=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){r.label=d[1];break}if(d[0]===6&&r.label<a[1]){r.label=a[1],a=d;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(d);break}a[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},ln=function(){function e(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(t){return t.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(t){this.props=pr(pr({},this.props),t),t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)},e.prototype.startJob=function(t,r,n){return r===void 0&&(r=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),Ur(this,void 0,void 0,function(){var i,a=this;return Fr(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:t,onMessage:r,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return Ur(this,void 0,void 0,function(){var t,r,n;return Fr(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(t=this.getAvailableWorker(),!t)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:t}),n=new xe(r.name,t),t.onMessage=function(a){return r.onMessage(n,a.type,a.payload)},t.onError=function(a){return r.onError(n,a)},r.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(t){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new ir({name:t,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return pe?this.maxMobileConcurrency:this.maxConcurrency},e}(),Un=ln,Bn=function(){return Bn=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Bn.apply(this,arguments)},Zn=function(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Zi={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},mn=function(){function e(t){this.workerPools=new Map,this.props=Bn({},Zi),this.setProps(t),this.workerPools=new Map}return e.isSupported=function(){return ir.isSupported()},e.getWorkerFarm=function(t){return t===void 0&&(t={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(t),e.workerFarm},e.prototype.destroy=function(){var t,r;try{for(var n=Zn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setProps=function(t){var r,n;this.props=Bn(Bn({},this.props),t);try{for(var i=Zn(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(t){var r=t.name,n=t.source,i=t.url,a=this.workerPools.get(r);return a||(a=new Un({name:r,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),oi=null,vi=new Map,ai=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(t){self.onmessage=function(r){if(!!pi(r)){var n=r.data,i=n.type,a=n.payload;t(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(t){var r=vi.get(t);r||(r=function(n){if(!!pi(n)){var i=n.data,a=i.type,s=i.payload;t(a,s)}}),self.addEventListener("message",r)},e.removeEventListener=function(t){var r=vi.get(t);vi.delete(t),self.removeEventListener("message",r)},e.postMessage=function(t,r){if(self){var n={source:"Worker thread",type:t,payload:r},i=ft(r);self.postMessage(n,i)}},e}(),ti=null;function pi(e){var t=e.type,r=e.data;return t==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function ri(e){return JSON.parse($n(e))}function $n(e){var t=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(t.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}t.add(n)}return n})}function bo(e){return""+e.name}function ja(e,t){t===void 0&&(t={});var r=t[e.id]||{},n=e.name+".worker.js",i=r.workerUrl;return t._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var Eo=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(b){s(b)}}function f(_){try{d(n.throw(_))}catch(b){s(b)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,t||[])).next())})},lo=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){r.label=d[1];break}if(d[0]===6&&r.label<a[1]){r.label=a[1],a=d;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(d);break}a[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};function Ba(e,t){return WorkerFarm.isSupported()?e.worker&&(t==null?void 0:t.worker):!1}function Ha(e,t,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),Eo(this,void 0,void 0,function(){var i,a,s,l,f,d,_,b;return lo(this,function(A){switch(A.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,r),s=WorkerFarm.getWorkerFarm(r),l=s.getWorkerPool({name:i,url:a}),f=r.jobName||e.name,[4,l.startJob(f,cs.bind(null,n))];case 1:return d=A.sent(),_=removeNontransferableOptions(r),d.postMessage("process",{input:t,options:_}),[4,d.result];case 2:return b=A.sent(),[2,b.result]}})})}function cs(e,t,r,n){return Eo(this,void 0,void 0,function(){var i,a,s,l,f,d,_;return lo(this,function(b){switch(b.label){case 0:switch(i=r,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return t.done(n),[3,9];case 2:return t.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,b.label=4;case 4:return b.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(t.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return f=b.sent(),t.postMessage("done",{id:a,result:f}),[3,7];case 6:return d=b.sent(),_=d instanceof Error?d.message:"unknown error",t.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),b.label=9;case 9:return[2]}})})}var fs=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(t){return this.enqueue(t)},e.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();t instanceof Error?r.reject(t):r.resolve({value:t})}else this._values.push(t)},e.prototype.close=function(){for(;this._settlers.length>0;){var t=this._settlers.shift();t.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var t=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){t._settlers.push({resolve:n,reject:i})})},e}(),sl=null,hs=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(b){s(b)}}function f(_){try{d(n.throw(_))}catch(b){s(b)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,t||[])).next())})},lu=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){r.label=d[1];break}if(d[0]===6&&r.label<a[1]){r.label=a[1],a=d;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(d);break}a[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Bs=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(a){r[a]=e[a]&&function(s){return new Promise(function(l,f){s=e[a](s),i(l,f,s.done,s.value)})}}function i(a,s,l,f){Promise.resolve(f).then(function(d){a({value:d,done:l})},s)}},Ec=0,Vu,Au;function ql(e,t){var r=this;if(typeof self!="undefined"){var n={process:ul};WorkerBody.onmessage=function(i,a){return hs(r,void 0,void 0,function(){var s,l,f,d,_,b,A,w,I,P,L;return lu(this,function(Z){switch(Z.label){case 0:switch(Z.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=Z.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!t)throw new Error("Worker does not support batched processing");Vu=new AsyncQueue,Au=a.options||{},f=t(Vu,Au,n),Z.label=4;case 4:Z.trys.push([4,9,10,15]),d=Bs(f),Z.label=5;case 5:return[4,d.next()];case 6:if(_=Z.sent(),!!_.done)return[3,8];b=_.value,WorkerBody.postMessage("output-batch",{result:b}),Z.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=Z.sent(),P={error:A},[3,15];case 10:return Z.trys.push([10,,13,14]),_&&!_.done&&(L=d.return)?[4,L.call(d)]:[3,12];case 11:Z.sent(),Z.label=12;case 12:return[3,14];case 13:if(P)throw P.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return Vu.push(a.input),[3,18];case 17:return Vu.close(),[3,18];case 18:return[3,20];case 19:return w=Z.sent(),I=w instanceof Error?w.message:"",WorkerBody.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function ul(e,t){return t===void 0&&(t={}),new Promise(function(r,n){var i=Ec++,a=function(l,f){if(f.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),r(f.result);break;case"error":WorkerBody.removeEventListener(a),n(f.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:t};WorkerBody.postMessage("process",s)})}var cu=function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(b){s(b)}}function f(_){try{d(n.throw(_))}catch(b){s(b)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,t||[])).next())})},ll=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){r.label=d[1];break}if(d[0]===6&&r.label<a[1]){r.label=a[1],a=d;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(d);break}a[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},So={};function Qa(e,t,r){return t===void 0&&(t=null),r===void 0&&(r={}),cu(this,void 0,void 0,function(){return ll(this,function(n){switch(n.label){case 0:return t&&(e=ys(e,t,r)),So[e]=So[e]||fu(e),[4,So[e]];case 1:return[2,n.sent()]}})})}function ys(e,t,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+t+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+t+"/src/libs/"+e}function fu(e){return cu(this,void 0,void 0,function(){var t,r,n;return ll(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return t=i.sent(),[4,t.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=i.sent(),[4,r.text()];case 5:return n=i.sent(),[2,Tu(n,e)]}})})}function Tu(e,t){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var Ui="0.0.3",Go={id:"null",name:"null",module:"web-worker-helper",options:{}};function Ja(e){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function hu(e,t,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function Sc(e){var t=e.filter;return t?[1]:[0]}function ju(e,t){return[t]}var mh=N(9187),Ao=N.n(mh),Mr=N(31437),Ls=Mr.create(),gh=Mr.create(),To=Mr.create(),Ys=Mr.create(),wo=Mr.create();function Qh(e,t,r,n,i){Mr.add(e,r,n),Mr.normalize(e,e),t=Mr.fromValues(-e[1],e[0]);var a=Mr.fromValues(-r[1],r[0]);return[i/Mr.dot(t,a),t]}function Kl(e,t){return Mr.set(e,-t[1],t[0])}function cl(e,t,r){return Mr.sub(e,t,r),Mr.normalize(e,e),e}function Lp(e,t){return e[0]===t[0]&&e[1]===t[1]}function og(e){for(var t=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();t.get(n)?(e.splice(r,1),r++):t.set(n,n)}return e}var kv=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ye.Z)(this,e),(0,B.Z)(this,"lastFlip",-1),(0,B.Z)(this,"miter",Mr.fromValues(0,0)),(0,B.Z)(this,"started",!1),(0,B.Z)(this,"dash",!1),(0,B.Z)(this,"totalDistance",0),(0,B.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Y.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,b=r[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],w=r[l];w.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],P=l<r.length-1?[].concat((0,Wt.Z)(r[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,L=l<n.length-1?n[l+1]:null,Z=this.segment_gaode2(i,s,b,w,P,A,I,L);s+=Z}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,b=r[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],w=r[l];w.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],P=l<r.length-1?[].concat((0,Wt.Z)(r[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,L=l<n.length-1?n[l+1]:null,Z=this.simpleSegment(i,s,b,w,P,A,I,L);s+=Z}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],f=r[s],d=s<r.length-1?r[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],f=r[s],d=s<r.length-1?r[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,i,a,s,l,f,d){var _=0,b=r.indices,A=r.positions,w=r.normals,I=this.cap==="square",P=this.join==="bevel",L=so([f[0],f[1]]),Z=so([l[0],l[1]]);cl(To,a,i);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(L,Z),this.totalDistance+=Q),this.normal||(this.normal=Mr.create(),Kl(this.normal,To)),!this.started)if(this.started=!0,I){var oe=Mr.create(),Ae=Mr.create();Mr.add(oe,this.normal,To),Mr.add(Ae,this.normal,To),w.push(Ae[0],Ae[1],0),w.push(oe[0],oe[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-Q);if(b.push(n+0,n+1,n+2),s){Lp(a,s)&&Mr.add(s,a,Mr.normalize(s,Mr.subtract(s,a,i))),cl(Ys,s,a);var rt=Qh(wo,Mr.create(),To,Ys,this.thickness),_t=(0,K.Z)(rt,2),Bt=_t[0],ur=_t[1],lr=Mr.dot(wo,this.normal)<0?-1:1,zr=P;if(!zr&&this.join==="miter"){var un=Bt;un>this.miterLimit&&(zr=!0)}zr?(w.push(this.normal[0],this.normal[1],0),w.push(ur[0],ur[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Wt.Z)(this.lastFlip!==-lr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Kl(Ls,Ys),Mr.copy(this.normal,Ls),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,ur,Bt,this.totalDistance),b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),lr=-1,Mr.copy(this.normal,ur),_+=2),this.lastFlip=lr}else{if(Kl(this.normal,To),I){var Oe=Mr.create(),Ve=Mr.create();Mr.sub(Ve,To,this.normal),Mr.add(Oe,To,this.normal),w.push(Ve[0],Ve[1],0),w.push(Oe[0],Oe[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(r,n,i,a,s){var l=0,f=r.indices,d=r.positions,_=r.normals,b=so([a[0],a[1]]),A=so([i[0],i[1]]);cl(To,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Mr.create(),Kl(this.normal,To)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-w)),f.push(n+0,n+1,n+2),!s)Kl(this.normal,To),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=so([s[0],s[1]]);Lp(b,I)&&Mr.add(I,b,Mr.normalize(I,Mr.subtract(I,b,A))),cl(Ys,I,b);var P=Qh(wo,Mr.create(),To,Ys,this.thickness),L=(0,K.Z)(P,2),Z=L[0],Q=L[1],oe=Mr.dot(wo,this.normal)<0?-1:1;this.extrusions(d,_,a,Q,Z,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,Mr.copy(this.normal,Q),l+=2,this.lastFlip=oe}return l}},{key:"segment",value:function(r,n,i,a,s){var l=0,f=r.indices,d=r.positions,_=r.normals,b=this.cap==="square",A=this.join==="bevel",w=so([a[0],a[1]]),I=so([i[0],i[1]]);cl(To,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Mr.create(),Kl(this.normal,To)),!this.started)if(this.started=!0,b){var L=Mr.create(),Z=Mr.create();Mr.add(L,this.normal,To),Mr.add(Z,this.normal,To),_.push(Z[0],Z[1],0),_.push(L[0],L[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-P);if(f.push(n+0,n+1,n+2),s){var Ae=so([s[0],s[1]]);Lp(w,Ae)&&Mr.add(Ae,w,Mr.normalize(Ae,Mr.subtract(Ae,w,I))),cl(Ys,Ae,w);var Oe=Qh(wo,Mr.create(),To,Ys,this.thickness),Ve=(0,K.Z)(Oe,2),rt=Ve[0],_t=Ve[1],Bt=Mr.dot(wo,this.normal)<0?-1:1,ur=A;if(!ur&&this.join==="miter"){var lr=rt;lr>this.miterLimit&&(ur=!0)}ur?(_.push(this.normal[0],this.normal[1],0),_.push(_t[0],_t[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Wt.Z)(this.lastFlip!==-Bt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Kl(Ls,Ys),Mr.copy(this.normal,Ls),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,_t,rt,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Bt=-1,Mr.copy(this.normal,_t),l+=2),this.lastFlip=Bt}else{if(Kl(this.normal,To),b){var Q=Mr.create(),oe=Mr.create();Mr.sub(oe,To,this.normal),Mr.add(Q,To,this.normal),_.push(oe[0],oe[1],0),_.push(Q[0],Q[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),r.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],a=n[1]-r[1];return Math.sqrt(i*i+a*a)}}]),e}();function Bf(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new kv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=t;Array.isArray(a[0][0])||(a=[t]);var s=r;Array.isArray(s[0][0])||(s=[r]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=t;_[0]&&!Array.isArray(_[0][0])&&(_=[t]),_.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function Jh(e){var t=Gs(e.coordinates);return{vertices:[].concat((0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function _h(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes,s=Ao()(n,a,i);return{indices:s,vertices:n,size:i}}var Rd=function(){var e=(0,Ot.Z)(ve().mark(function t(r){var n,i,a,s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s=r.iconMap,l={a_Color:Ja,a_Position:hu,filter:Sc,a_vertexId:ju,a_PickingColor:function(P){var L=P.id;return a?Ma(L):[0,0,0]},a_DistanceAndIndex:function(P,L,Z,Q,oe,Ae){return Ae===void 0?[Z[3],10]:[Z[3],Ae]},a_Total_Distance:function(P,L,Z){return[Z[5]]},a_Size:function(P){var L=P.size,Z=L===void 0?1:L;return Array.isArray(Z)?[Z[0],Z[1]]:[Z,0]},a_Normal:function(P,L,Z,Q,oe){return oe},a_Miter:function(P,L,Z){return[Z[4]]},a_iconMapUV:function(P){var L=P.texture,Z=s[L]||{x:0,y:0},Q=Z.x,oe=Z.y;return[Q,oe]}},f={sizePerElement:0,elements:[]},d=0,_=[],b=3,i.forEach(function(I,P){var L=Bf(I),Z=L.indices,Q=L.vertices,oe=L.normals,Ae=L.size,Oe=L.indexes;Z.forEach(function(Bt){_.push(Bt+d)}),b=Ae;var Ve=Q.length/Ae;f.sizePerElement=b,f.elements.push({featureIdx:P,vertices:Q,normals:oe,offset:d}),d+=Ve;for(var rt=function(ur){var lr=(oe==null?void 0:oe.slice(ur*3,ur*3+3))||[],zr=Q.slice(ur*Ae,ur*Ae+Ae),un=0;Oe&&Oe[ur]!==void 0&&(un=Oe[ur]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var Bi;(Bi=Rn.buffer.data).push.apply(Bi,(0,Wt.Z)(l[Rn.name](I,P,zr,ur,lr,un)))}})},_t=0;_t<Ve;_t++)rt(_t)}),w.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return w.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),Ac=function(){var e=(0,Ot.Z)(ve().mark(function t(r){var n,i,a,s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s=r.shape2d,l={a_Color:Ja,a_Position:hu,filter:Sc,a_vertexId:ju,a_PickingColor:function(P){var L=P.id;return a?Ma(L):[0,0,0]},a_Shape:function(P){var L=P.shape,Z=L===void 0?2:L,Q=s.indexOf(Z);return[Q]},a_Extrude:function(P,L,Z,Q){var oe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ae=Q%4*3;return[oe[Ae],oe[Ae+1],oe[Ae+2]]},a_Size:function(P){var L=P.size,Z=L===void 0?5:L;return Array.isArray(Z)?[Z[0]]:[Z]}},f={sizePerElement:0,elements:[]},d=0,_=[],b=3,i.forEach(function(I,P){var L=Jh(I),Z=L.indices,Q=L.vertices,oe=L.normals,Ae=L.size,Oe=L.indexes;Z.forEach(function(Bt){_.push(Bt+d)}),b=Ae;var Ve=Q.length/Ae;f.sizePerElement=b,f.elements.push({featureIdx:P,vertices:Q,normals:oe,offset:d}),d+=Ve;for(var rt=function(ur){var lr=(oe==null?void 0:oe.slice(ur*3,ur*3+3))||[],zr=Q.slice(ur*Ae,ur*Ae+Ae),un=0;Oe&&Oe[ur]!==void 0&&(un=Oe[ur]),n.forEach(function(Rn){if(Rn&&l[Rn.name]){var Bi;(Bi=Rn.buffer.data).push.apply(Bi,(0,Wt.Z)(l[Rn.name](I,P,zr,ur,lr,un)))}})},_t=0;_t<Ve;_t++)rt(_t)}),w.abrupt("return",{descriptors:n,featureLayout:f,indices:_});case 8:case"end":return w.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),yh=function(){var e=(0,Ot.Z)(ve().mark(function t(r){var n,i,a,s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,i=r.features,a=r.enablePicking,s={a_Color:Ja,a_Position:hu,filter:Sc,a_vertexId:ju,a_PickingColor:function(I){var P=I.id;return a?Ma(P):[0,0,0]}},l={sizePerElement:0,elements:[]},f=0,d=[],_=3,i.forEach(function(w,I){var P=_h(w),L=P.indices,Z=P.vertices,Q=P.normals,oe=P.size,Ae=P.indexes;L.forEach(function(_t){d.push(_t+f)}),_=oe;var Oe=Z.length/oe;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:Z,normals:Q,offset:f}),f+=Oe;for(var Ve=function(Bt){var ur=(Q==null?void 0:Q.slice(Bt*3,Bt*3+3))||[],lr=Z.slice(Bt*oe,Bt*oe+oe),zr=0;Ae&&Ae[Bt]!==void 0&&(zr=Ae[Bt]),n.forEach(function(un){if(un&&s[un.name]){var Rn;(Rn=un.buffer.data).push.apply(Rn,(0,Wt.Z)(s[un.name](w,I,lr,Bt,ur,zr)))}})},rt=0;rt<Oe;rt++)Ve(rt)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:d});case 8:case"end":return A.stop()}},t)}));return function(r){return e.apply(this,arguments)}}(),Bv={pointFill:Ac,line:Rd,polygonFill:yh},Md=(0,F.Z)({},Bv);function sg(e){return Np.apply(this,arguments)}function Np(){return Np=_asyncToGenerator(_regeneratorRuntime.mark(function e(t){var r,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t.workerType,n=t.data,!Md[r]){a.next=3;break}return a.abrupt("return",Md[r](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),Np.apply(this,arguments)}var Id=new Map;function Pd(e,t){Id.set(e,t)}function Up(e){var t=Id.get(e);return t}var Pl="l7-worker",ep=3,Tc=!0;function zp(e){registerWorkerSource(Pl,e)}function Wa(){var e=getWorkerSource(Pl);if(!e)throw new Error("get worker failed by workerName: ".concat(Pl,"."));return e}function Lf(e,t){return Nf.apply(this,arguments)}function Nf(){return Nf=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,r){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=Wa(),i=WorkerFarm.getWorkerFarm({maxConcurrency:ep,reuseWorkers:Tc}),a=i.getWorkerPool({name:Pl,source:n}),d.next=5,a.startJob(Pl,function(_,b,A){return _.done(A)});case 5:return s=d.sent,s.postMessage("process",{input:{workerType:t,data:r}}),d.next=9,s.result;case 9:return l=d.sent,d.abrupt("return",l.result);case 11:case"end":return d.stop()}},e)})),Nf.apply(this,arguments)}var tf=N(38163),rf=N.n(tf);function wc(e,t){return e.map(function(r){return r[t]*1})}function Uf(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function xh(e){return Array.isArray(e)?e.length===0?!1:!!Uf(e[0]):!1}function Ol(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Ql(e){var t=Object.isFrozen(e)?di.cloneDeep(e):e;return rf()(t,!0),t}function Cc(e,t){var r=t.x,n=t.y,i=t.x1,a=t.y1,s=t.coordinates,l=t.geometry,f=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(Z){return Z[l]&&Z[l].type&&Z[l].coordinates&&Z[l].coordinates.length>0}).forEach(function(Z,Q){var oe=Ql(Z[l]);G(oe,function(Ae){var Oe=Xe(Ae),Ve=(0,F.Z)((0,F.Z)({},Z),{},{_id:Q,coordinates:Oe});f.push(Ve)})}),{dataArray:f};for(var d=0;d<e.length;d++){var _=e[d],b=[];if(s){var A="Polygon";Array.isArray(s[0])||(A="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(A="LineString");var w=Ql({type:A,coordinates:_[s]});b=w.coordinates}else if(r&&n&&i&&a){var I=[parseFloat(_[r]),parseFloat(_[n])],P=[parseFloat(_[i]),parseFloat(_[a])];b=[I,P]}else r&&n&&(b=[parseFloat(_[r]),parseFloat(_[n])]);var L=(0,F.Z)((0,F.Z)({},_),{},{_id:d,coordinates:b});f.push(L)}return{dataArray:f}}function Od(e,t){var r=lt(e);return Cc(r,t)}var ps=N(90484);function nf(e){for(var t=e.toString(),r=5381,n=t.length;n;)r=r*33^t.charCodeAt(--n);return r>>>0}function tp(e,t){return t===void 0?null:(0,ps.Z)(e.properties[t])*1==="number"?e.properties[t]*1:e.properties&&e.properties[t]?nf(e.properties[t]+"")%1000019:null}function Zp(e,t){var r=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=Ql(e),e.features.length===0?{dataArray:[],featureKeys:n}:(G(e,function(i,a){var s=tp(i,t==null?void 0:t.featureId);s===null&&(s=a);var l=s,f=Xe(i),d=(0,F.Z)((0,F.Z)({},i.properties),{},{coordinates:f,_id:l});r.push(d)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function bh(e,t,r,n){for(var i=n,a=r-t>>1,s=r-t,l,f=e[t],d=e[t+1],_=e[r],b=e[r+1],A=t+3;A<r;A+=3){var w=Vp(e[A],e[A+1],f,d,_,b);if(w>i)l=A,i=w;else if(w===i){var I=Math.abs(A-a);I<s&&(l=A,s=I)}}i>n&&(l-t>3&&bh(e,t,l,n),e[l+2]=i,r-l>3&&bh(e,l,r,n))}function Vp(e,t,r,n,i,a){var s=i-r,l=a-n;if(s!==0||l!==0){var f=((e-r)*s+(t-n)*l)/(s*s+l*l);f>1?(r=i,n=a):f>0&&(r+=s*f,n+=l*f)}return s=e-r,l=t-n,s*s+l*l}function qs(e,t,r,n){var i={id:typeof e=="undefined"?null:e,type:t,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Rc(i),i}function Rc(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")rp(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<t.length;n++)rp(e,t[n]);else if(r==="MultiPolygon")for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)rp(e,t[n][i])}function rp(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Dd(e,t){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Eh(r,e.features[n],t,n);else e.type==="Feature"?Eh(r,e,t):Eh(r,{geometry:e},t);return r}function Eh(e,t,r,n){if(!!t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],f=t.id;if(r.promoteId?f=t.properties[r.promoteId]:r.generateId&&(f=n||0),a==="Point")jp(i,l);else if(a==="MultiPoint")for(var d=0;d<i.length;d++)jp(i[d],l);else if(a==="LineString")Jl(i,l,s,!1);else if(a==="MultiLineString")if(r.lineMetrics){for(d=0;d<i.length;d++)l=[],Jl(i[d],l,s,!1),e.push(qs(f,"LineString",l,t.properties));return}else Hp(i,l,s,!1);else if(a==="Polygon")Hp(i,l,s,!0);else if(a==="MultiPolygon")for(d=0;d<i.length;d++){var _=[];Hp(i[d],_,s,!0),l.push(_)}else if(a==="GeometryCollection"){for(d=0;d<t.geometry.geometries.length;d++)Eh(e,{id:f,geometry:t.geometry.geometries[d],properties:t.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(qs(f,a,l,t.properties))}}function jp(e,t){t.push(fl(e[0])),t.push(np(e[1])),t.push(0)}function Jl(e,t,r,n){for(var i,a,s=0,l=0;l<e.length;l++){var f=fl(e[l][0]),d=np(e[l][1]);t.push(f),t.push(d),t.push(0),l>0&&(n?s+=(i*d-f*a)/2:s+=Math.sqrt(Math.pow(f-i,2)+Math.pow(d-a,2))),i=f,a=d}var _=t.length-3;t[2]=1,bh(t,0,_,r),t[_+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function Hp(e,t,r,n){for(var i=0;i<e.length;i++){var a=[];Jl(e[i],a,r,n),t.push(a)}}function fl(e){return e/360+.5}function np(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Ks(e,t,r,n,i,a,s,l){if(r/=t,n/=t,a>=r&&s<n)return e;if(s<r||a>=n)return null;for(var f=[],d=0;d<e.length;d++){var _=e[d],b=_.geometry,A=_.type,w=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(w>=r&&I<n){f.push(_);continue}else if(I<r||w>=n)continue;var P=[];if(A==="Point"||A==="MultiPoint")Mc(b,P,r,n,i);else if(A==="LineString")Wp(b,P,r,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")zf(b,P,r,n,i,!1);else if(A==="Polygon")zf(b,P,r,n,i,!0);else if(A==="MultiPolygon")for(var L=0;L<b.length;L++){var Z=[];zf(b[L],Z,r,n,i,!0),Z.length&&P.push(Z)}if(P.length){if(l.lineMetrics&&A==="LineString"){for(L=0;L<P.length;L++)f.push(qs(_.id,A,P[L],_.tags));continue}(A==="LineString"||A==="MultiLineString")&&(P.length===1?(A="LineString",P=P[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=P.length===3?"Point":"MultiPoint"),f.push(qs(_.id,A,P,_.tags))}}return f.length?f:null}function Mc(e,t,r,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=r&&s<=n&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function Wp(e,t,r,n,i,a,s){for(var l=ec(e),f=i===0?xs:ds,d=e.start,_,b,A=0;A<e.length-3;A+=3){var w=e[A],I=e[A+1],P=e[A+2],L=e[A+3],Z=e[A+4],Q=i===0?w:I,oe=i===0?L:Z,Ae=!1;s&&(_=Math.sqrt(Math.pow(w-L,2)+Math.pow(I-Z,2))),Q<r?oe>r&&(b=f(l,w,I,L,Z,r),s&&(l.start=d+_*b)):Q>n?oe<n&&(b=f(l,w,I,L,Z,n),s&&(l.start=d+_*b)):Zf(l,w,I,P),oe<r&&Q>=r&&(b=f(l,w,I,L,Z,r),Ae=!0),oe>n&&Q<=n&&(b=f(l,w,I,L,Z,n),Ae=!0),!a&&Ae&&(s&&(l.end=d+_*b),t.push(l),l=ec(e)),s&&(d+=_)}var Oe=e.length-3;w=e[Oe],I=e[Oe+1],P=e[Oe+2],Q=i===0?w:I,Q>=r&&Q<=n&&Zf(l,w,I,P),Oe=l.length-3,a&&Oe>=3&&(l[Oe]!==l[0]||l[Oe+1]!==l[1])&&Zf(l,l[0],l[1],l[2]),l.length&&t.push(l)}function ec(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function zf(e,t,r,n,i,a){for(var s=0;s<e.length;s++)Wp(e[s],t,r,n,i,a,!1)}function Zf(e,t,r,n){e.push(t),e.push(r),e.push(n)}function xs(e,t,r,n,i,a){var s=(a-t)/(n-t);return e.push(a),e.push(r+(i-r)*s),e.push(1),s}function ds(e,t,r,n,i,a){var s=(a-r)/(i-r);return e.push(t+(n-t)*s),e.push(a),e.push(1),s}function Co(e,t){var r=t.buffer/t.extent,n=e,i=Ks(e,1,-1-r,r,0,-1,2,t),a=Ks(e,1,1-r,2+r,0,-1,2,t);return(i||a)&&(n=Ks(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=Qs(i,1).concat(n)),a&&(n=n.concat(Qs(a,-1)))),n}function Qs(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=ip(i.geometry,t);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(ip(i.geometry[l],t))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var f=[],d=0;d<i.geometry[l].length;d++)f.push(ip(i.geometry[l][d],t));s.push(f)}r.push(qs(i.id,a,s,i.tags))}return r}function ip(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function Vf(e,t){if(e.transformed)return e;var r=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var f=e.features[a],d=f.geometry,_=f.type;if(f.geometry=[],_===1)for(s=0;s<d.length;s+=2)f.geometry.push(Gp(d[s],d[s+1],t,r,n,i));else for(s=0;s<d.length;s++){var b=[];for(l=0;l<d[s].length;l+=2)b.push(Gp(d[s][l],d[s][l+1],t,r,n,i));f.geometry.push(b)}}return e.transformed=!0,e}function Gp(e,t,r,n,i,a){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-a))]}function Lv(e,t,r,n,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,Nv(s,e[l],a,i);var f=e[l].minX,d=e[l].minY,_=e[l].maxX,b=e[l].maxY;f<s.minX&&(s.minX=f),d<s.minY&&(s.minY=d),_>s.maxX&&(s.maxX=_),b>s.maxY&&(s.maxY=b)}return s}function Nv(e,t,r,n){var i=t.geometry,a=t.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")ap(s,i,e,r,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)ap(s,i[l],e,r,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var f=0;f<i.length;f++){var d=i[f];for(l=0;l<d.length;l++)ap(s,d[l],e,r,!0,l===0)}if(s.length){var _=t.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var b in t.tags)_[b]=t.tags[b];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var A={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};t.id!==null&&(A.id=t.id),e.features.push(A)}}function ap(e,t,r,n,i,a){var s=n*n;if(n>0&&t.size<(i?s:n)){r.numPoints+=t.length/3;return}for(var l=[],f=0;f<t.length;f+=3)(n===0||t[f+2]>s)&&(r.numSimplified++,l.push(t[f]),l.push(t[f+1])),r.numPoints++;i&&Uv(l,a),e.push(l)}function Uv(e,t){for(var r=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)r+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Fd(e,t){return new Xo(e,t)}function Xo(e,t){t=this.options=kd(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Dd(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Co(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Xo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Xo.prototype.splitTile=function(e,t,r,n,i,a,s){for(var l=[e,t,r,n],f=this.options,d=f.debug;l.length;){n=l.pop(),r=l.pop(),t=l.pop(),e=l.pop();var _=1<<t,b=Xp(t,r,n),A=this.tiles[b];if(!A&&(d>1&&console.time("creation"),A=this.tiles[b]=Lv(e,t,r,n,f),this.tileCoords.push({z:t,x:r,y:n}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var w="z"+t;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(A.source=e,i){if(t===f.maxZoom||t===i)continue;var I=1<<i-t;if(r!==Math.floor(a/I)||n!==Math.floor(s/I))continue}else if(t===f.indexMaxZoom||A.numPoints<=f.indexMaxPoints)continue;if(A.source=null,e.length!==0){d>1&&console.time("clipping");var P=.5*f.buffer/f.extent,L=.5-P,Z=.5+P,Q=1+P,oe,Ae,Oe,Ve,rt,_t;oe=Ae=Oe=Ve=null,rt=Ks(e,_,r-P,r+Z,0,A.minX,A.maxX,f),_t=Ks(e,_,r+L,r+Q,0,A.minX,A.maxX,f),e=null,rt&&(oe=Ks(rt,_,n-P,n+Z,1,A.minY,A.maxY,f),Ae=Ks(rt,_,n+L,n+Q,1,A.minY,A.maxY,f),rt=null),_t&&(Oe=Ks(_t,_,n-P,n+Z,1,A.minY,A.maxY,f),Ve=Ks(_t,_,n+L,n+Q,1,A.minY,A.maxY,f),_t=null),d>1&&console.timeEnd("clipping"),l.push(oe||[],t+1,r*2,n*2),l.push(Ae||[],t+1,r*2,n*2+1),l.push(Oe||[],t+1,r*2+1,n*2),l.push(Ve||[],t+1,r*2+1,n*2+1)}}},Xo.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;t=(t%s+s)%s;var l=Xp(e,t,r);if(this.tiles[l])return Vf(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var f=e,d=t,_=r,b;!b&&f>0;)f--,d=Math.floor(d/2),_=Math.floor(_/2),b=this.tiles[Xp(f,d,_)];return!b||!b.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",f,d,_),a>1&&console.time("drilling down"),this.splitTile(b.source,f,d,_,e,t,r),a>1&&console.timeEnd("drilling down"),this.tiles[l]?Vf(this.tiles[l],i):null)};function Xp(e,t,r){return((1<<e)*r+t)*32+e}function kd(e,t){for(var r in t)e[r]=t[r];return e}var af=function(){function e(t,r,n,i){(0,ye.Z)(this,e),(0,B.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=t}return(0,Y.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Bd={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function $p(e){for(var t=0,r=0,n=e.length,i=n-1,a,s;r<n;i=r++)a=e[r],s=e[i],t+=(s.x-a.x)*(a.y+s.y);return t}function zv(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,a=0;a<t;a++){var s=$p(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}var Zv=["Unknown","Point","LineString","Polygon"];function Ld(e,t,r,n,i){var a=i.geometry,s=i.type,l=i.tags,f=i.id,d=e*Math.pow(2,n),_=e*t,b=e*r,A=Zv[s],w,I;function P(Q){for(var oe=0;oe<Q.length;oe++){var Ae=Q[oe];if(Ae[3])break;var Oe=180-(Ae[1]+b)*360/d,Ve=(Ae[0]+_)*360/d-180,rt=360/Math.PI*Math.atan(Math.exp(Oe*Math.PI/180))-90;Q[oe]=[Ve,rt,0,1]}}switch(s){case 1:var L=[];for(w=0;w<a.length;w++)L[w]=a[w][0];a=L,P(a);break;case 2:for(w=0;w<a.length;w++)P(a[w]);break;case 3:for(a=zv(a),w=0;w<a.length;w++)for(I=0;I<a[w].length;I++)P(a[w][I]);break}a.length===1?a=a[0]:A="Multi"+A;var Z={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:f,tileOrigin:[0,0],coord:""};return Z}var Nd=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f){var d=n.getTile(r.z,r.x,r.y),_=d?d.features.map(function(w){return Ld(a,i.x,i.y,i.z,w)}):[],b={layers:{defaultLayer:{features:_}}},A=new af(b,r.x,r.y,r.z);f(A)}));case 1:case"end":return l.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}();function V(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?t:(0,F.Z)((0,F.Z)({},t),e.geojsonvtOptions)}function Se(e,t){var r=V(t),n=r.extent||4096,i=Fd(e,r),a=function(f,d){return Nd(d,i,f,n)},s=(0,F.Z)((0,F.Z)((0,F.Z)({},Bd),t),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function He(e,t){var r=t.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,i=t.requestParameters,a=i===void 0?{}:i,s=new Promise(function(f){e instanceof HTMLImageElement||bf(e)?f([e]):Ht(e,a,function(d){f(d)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function Ht(e,t,r){var n=[];if(typeof e=="string")Vs((0,F.Z)((0,F.Z)({},t),{},{url:e}),function(s,l){l&&(n.push(l),r(n))});else{var i=e.length,a=0;e.forEach(function(s){Vs((0,F.Z)((0,F.Z)({},t),{},{url:s}),function(l,f){a++,f&&n.push(f),a===i&&r(n)})})}return He}var cr=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=v(r,s),d.abrupt("return",new Promise(function(_){a?a(s,function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new af(w,n.x,n.y,n.z);_(I)}else{var P={layers:{defaultLayer:{features:A.features}}},L=new af(P,n.x,n.y,n.z);_(L)}}):Sa((0,F.Z)((0,F.Z)({},i),{},{url:l}),function(b,A){if(b||!A){var w={layers:{defaultLayer:{features:[]}}},I=new af(w,n.x,n.y,n.z);_(I)}else{var P=JSON.parse(A),L={layers:{defaultLayer:{features:P}}},Z=new af(L,n.x,n.y,n.z);_(Z)}})}));case 3:case"end":return d.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}();function Xt(e,t){var r=function(a,s){return cr(e,s,t==null?void 0:t.requestParameters,t.getCustomData)},n=(0,F.Z)((0,F.Z)({},t),{},{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Lt=N(38929),Dr=N(3614),Tr=N.n(Dr),Vr=function(){function e(t,r,n,i){(0,ye.Z)(this,e),(0,B.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=i,this.vectorTile=new Lt.VectorTile(new(Tr())(t))}return(0,Y.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,F.Z)((0,F.Z)({},l),{},{properties:(0,F.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),kr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Zr=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a,s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l=v(r,n),d.abrupt("return",new Promise(function(_){if(s)s({x:i.x,y:i.y,z:i.z},function(A,w){if(A||!w)_(void 0);else{var I=new Vr(w,i.x,i.y,i.z);_(I)}});else{var b=go((0,F.Z)((0,F.Z)({},a),{},{url:l}),function(A,w){if(A||!w)_(void 0);else{var I=new Vr(w,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return b.cancel()}}}));case 2:case"end":return d.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}();function Xr(e,t){var r=Array.isArray(e)?e[0]:e,n=function(s,l){return Zr(r,s,l,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData)},i=(0,F.Z)((0,F.Z)((0,F.Z)({},kr),t),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}function wr(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Nr(e,t){for(var r=t[0],n=r.width,i=r.height,a=t.map(function(w){return w.rasterData}),s=n*i,l=[],f=JSON.stringify(e),d=0;d<s;d++){var _=JSON.parse(f),b=At(_,a,d);if(typeof b=="number")l.push(b);else{var A=Ir(_);l.push(A)}}return l}function At(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=t[n[1]][r]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:At(n,t,r)}})}function tr(e){var t=(0,K.Z)(e,3),r=t[0],n=t[1],i=n===void 0?-1:n,a=t[2],s=a===void 0?-1:a;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,i,s]}function Ir(e){var t=tr(e),r=t[0],n=t[1],i=t[2];return Array.isArray(n)&&(n=Ir(e[1])),Array.isArray(i)&&(i=Ir(e[2])),wr(r,n,i)}var tn={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:gr}};function gr(e,t){for(var r=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(t==null?void 0:t.countCut)||[2,98],l=(0,K.Z)(s,2),f=l[0],d=l[1],_=(t==null?void 0:t.RMinMax)||sn(r,f,d),b=(t==null?void 0:t.GMinMax)||sn(n,f,d),A=(t==null?void 0:t.BMinMax)||sn(i,f,d),w=0;w<r.length;w++)a.push(Math.max(0,r[w]-_[0])),a.push(Math.max(0,n[w]-b[0])),a.push(Math.max(0,i[w]-A[0]));return{rasterData:a,rMinMax:_,gMinMax:b,bMinMax:A}}function sn(e,t,r){var n=e.slice().sort(function(l,f){return l-f}),i=n.length,a=n[Math.ceil(i*t/100)],s=n[Math.ceil(i*r/100)];return[a,s]}function Cr(e,t,r){return en.apply(this,arguments)}function en(){return en=(0,Ot.Z)(ve().mark(function e(t,r,n){var i,a,s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t.length!==0){b.next=2;break}return b.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return b.next=4,Promise.all(t.map(function(A){var w=A.data,I=A.bands,P=I===void 0?[0]:I;return r(w,P)}));case 4:i=b.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,(0,Wt.Z)(A)):a.push(A)}),s=a[0],l=s.width,f=s.height,b.t0=(0,ps.Z)(n),b.next=b.t0==="function"?11:b.t0==="object"?13:15;break;case 11:return d=n(a),b.abrupt("break",16);case 13:return Array.isArray(n)?d={rasterData:Nr(n,a)}:d=_r(n,a),b.abrupt("break",16);case 15:d={rasterData:a[0].rasterData};case 16:return b.abrupt("return",(0,F.Z)((0,F.Z)({},d),{},{width:l,height:f}));case 17:case"end":return b.stop()}},e)})),en.apply(this,arguments)}function _r(e,t){var r=tn[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?Kr(r.expression,t):{rasterData:Nr(r.expression,t)}}function Kr(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Nr(e.r||["band",0],t),n=Nr(e.g||["band",0],t),i=Nr(e.b||["band",0],t);return[r,n,i]}function Vn(e,t,r,n){return si.apply(this,arguments)}function si(){return si=(0,Ot.Z)(ve().mark(function e(t,r,n,i){var a;return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Cr(t,r,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),si.apply(this,arguments)}function Qr(e,t){var r=t.extent,n=t.width,i=t.height,a=t.min,s=t.max,l=t.format,f=t.operation,d,_,b;if(l===void 0||Ol(e))d=Array.from(e),_=n,b=i;else{var A=Array.isArray(e)?e:[e];d=Cr(A,l,f)}var w={_id:1,dataArray:[{_id:1,data:d,width:_,height:b,min:a,max:s,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return w}var Pr=N(28660),ot=N(86700),jn=N(84879),pt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},cn=N(49296),Si=N.n(cn);function ui(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Jn(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function Jn(e,t){if(!!e){if(typeof e=="string")return Xi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xi(e,t)}}function Xi(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var La=30;function $o(e){var t=e.characterSet,r=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,f=e.xOffset,d=f===void 0?0:f,_=e.yOffset,b=_===void 0?0:_,A=0,w=d;Array.from(t).forEach(function(P,L){if(!l[P]){var Z=r(P,L);w+La>a&&(w=0,A++),l[P]={x:w,y:b+A*La,width:La,height:La,advance:Z},w+=La}});var I=n+i*2;return{mapping:l,xOffset:w,yOffset:b+A*I,canvasHeight:ba(b+(A+1)*I)}}function Oi(e,t,r){var n=0,i=0,a=0,s=[],l={},f=ui(e),d;try{for(f.s();!(d=f.n()).done;){var _=d.value;if(!l[_.id]){var b=_.size;n+b+t>r&&(ro(l,s,i),n=0,i=a+i+t,a=0,s=[]),s.push({icon:_,xOffset:n}),n=n+b+t,a=Math.max(a,b)}}}catch(w){f.e(w)}finally{f.f()}s.length>0&&ro(l,s,i);var A=ba(a+i+t);return{mapping:l,canvasHeight:A}}function ro(e,t,r){var n=ui(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,F.Z)((0,F.Z)({},s),{},{x:l,y:r,image:s.image,width:s.width,height:s.height})}}catch(f){n.e(f)}finally{n.f()}}function ba(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var co,fo;function Na(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ko(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function ko(e,t){if(!!e){if(typeof e=="string")return es(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return es(e,t)}}function es(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ro(e){var t=Ei();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Ei(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ts=pa(),ea="sans-serif",Yn="normal",Ii=24,$i=3,ho=.25,hl=8,Ne=1024,Yt=1,Nt=1,fn=3,Ti=null;function pa(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function fe(e,t,r,n){e.font="".concat(n," ").concat(r,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function Ce(e,t){for(var r=0;r<e.length;r++)t.data[4*r+3]=e[r]}var We=(co=(0,ot.b2)(),co(fo=function(e){(0,tt.Z)(r,e);var t=Ro(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"fontAtlas",void 0),(0,B.Z)((0,Ee.Z)(n),"iconFontMap",void 0),(0,B.Z)((0,Ee.Z)(n),"iconFontGlyphs",{}),(0,B.Z)((0,Ee.Z)(n),"fontOptions",void 0),(0,B.Z)((0,Ee.Z)(n),"key",void 0),(0,B.Z)((0,Ee.Z)(n),"cache",new If(fn)),n}return(0,Y.Z)(r,[{key:"scale",get:function(){return Nt}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ea,fontWeight:Yn,characterSet:ts,fontSize:Ii,buffer:$i,sdf:!0,cutoff:ho,radius:hl,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,F.Z)((0,F.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(f){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(f)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,f=l.fontFamily,d=l.fontWeight,_=l.fontSize,b=l.buffer,A=l.sdf,w=l.radius,I=l.cutoff,P=l.iconfont,L=s&&s.data;L||(L=window.document.createElement("canvas"),L.width=Ne);var Z=L.getContext("2d",{willReadFrequently:!0});fe(Z,f,_,d);var Q=$o((0,F.Z)({getFontWidth:function(As){return Z.measureText(As).width},fontHeight:_*Nt,buffer:b,characterSet:a,maxCanvasWidth:Ne},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),oe=Q.mapping,Ae=Q.canvasHeight,Oe=Q.xOffset,Ve=Q.yOffset,rt=Z.getImageData(0,0,L.width,L.height);if(L.height=Ae,Z.putImageData(rt,0,0),fe(Z,f,_,d),A){var _t=new(Si())(_,b,w,I,f,d),Bt=Z.getImageData(0,0,_t.size,_t.size),ur=Na(a),lr;try{for(ur.s();!(lr=ur.n()).done;){var zr=lr.value;if(P){var un=String.fromCharCode(parseInt(zr.replace("&#x","").replace(";",""),16)),Rn=_t.draw(un);Ce(Rn,Bt)}else Ce(_t.draw(zr),Bt);Z.putImageData(Bt,oe[zr].x,oe[zr].y)}}catch(Oo){ur.e(Oo)}finally{ur.f()}}else{var Bi=Na(a),eo;try{for(Bi.s();!(eo=Bi.n()).done;){var io=eo.value;Z.fillText(io,oe[io].x,oe[io].y+_*Yt)}}catch(Oo){Bi.e(Oo)}finally{Bi.f()}}return{xOffset:Oe,yOffset:Ve,mapping:oe,data:L,width:L.width,height:L.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],f=s.mapping,d=new Set(Object.keys(f)),_=new Set(a);return _.forEach(function(b){d.has(b)||l.push(b)}),l}}]),r}(ka.EventEmitter))||fo),zt,Ft;function Je(e){var t=ut();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dt=3,ze=1024,et=64,we=(zt=(0,ot.b2)(),zt(Ft=function(e){(0,tt.Z)(r,e);var t=Je(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"canvasHeight",128),(0,B.Z)((0,Ee.Z)(n),"texture",void 0),(0,B.Z)((0,Ee.Z)(n),"canvas",void 0),(0,B.Z)((0,Ee.Z)(n),"iconData",void 0),(0,B.Z)((0,Ee.Z)(n),"iconMap",void 0),(0,B.Z)((0,Ee.Z)(n),"ctx",void 0),(0,B.Z)((0,Ee.Z)(n),"loadingImageCount",0),n}return(0,Y.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s,l){var f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:et}),this.updateIconMap(),b.next=6,this.loadImage(l);case 6:f=b.sent,d=this.iconData.find(function(A){return A.id===s}),d&&(d.image=f,d.width=f.width,d.height=f.height),this.update();case 10:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,f=s.getSceneConfig().canvas,d=f.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:et}),this.updateIconMap(),this.loadImageMini(a,f).then(function(_){d=_;var b=l.iconData.find(function(A){return A.id===i});b&&(b.image=d,b.width=d.width,b.height=d.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=ze,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,f=s.y,d=s.image,_=s.width,b=_===void 0?64:_,A=s.height,w=A===void 0?64:A,I=Math.max(b,w),P=I/et,L=w/P,Z=b/P;d&&i.ctx.drawImage(d,l+(et-Z)/2,f+(et-L)/2,Z,L)})}},{key:"updateIconMap",value:function(){var i=Oi(this.iconData,dt,ze),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var f=a.createImage();f.crossOrigin="anonymous",f.onload=function(){s(f)},f.onerror=function(){l(new Error("Could not load image at "+i))},f.src=i})}}]),r}(ka.EventEmitter))||Ft),Ye=N(49685);function Vt(){var e=new Ye.WT(16);return Ye.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ar(e){var t=new Ye.WT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Er(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vr(e,t,r,n,i,a,s,l,f,d,_,b,A,w,I,P){var L=new Ye.WT(16);return L[0]=e,L[1]=t,L[2]=r,L[3]=n,L[4]=i,L[5]=a,L[6]=s,L[7]=l,L[8]=f,L[9]=d,L[10]=_,L[11]=b,L[12]=A,L[13]=w,L[14]=I,L[15]=P,L}function Rr(e,t,r,n,i,a,s,l,f,d,_,b,A,w,I,P,L){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=l,e[7]=f,e[8]=d,e[9]=_,e[10]=b,e[11]=A,e[12]=w,e[13]=I,e[14]=P,e[15]=L,e}function In(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yn(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],a=t[6],s=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=s,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function bn(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],f=t[6],d=t[7],_=t[8],b=t[9],A=t[10],w=t[11],I=t[12],P=t[13],L=t[14],Z=t[15],Q=r*l-n*s,oe=r*f-i*s,Ae=r*d-a*s,Oe=n*f-i*l,Ve=n*d-a*l,rt=i*d-a*f,_t=_*P-b*I,Bt=_*L-A*I,ur=_*Z-w*I,lr=b*L-A*P,zr=b*Z-w*P,un=A*Z-w*L,Rn=Q*un-oe*zr+Ae*lr+Oe*ur-Ve*Bt+rt*_t;return Rn?(Rn=1/Rn,e[0]=(l*un-f*zr+d*lr)*Rn,e[1]=(i*zr-n*un-a*lr)*Rn,e[2]=(P*rt-L*Ve+Z*Oe)*Rn,e[3]=(A*Ve-b*rt-w*Oe)*Rn,e[4]=(f*ur-s*un-d*Bt)*Rn,e[5]=(r*un-i*ur+a*Bt)*Rn,e[6]=(L*Ae-I*rt-Z*oe)*Rn,e[7]=(_*rt-A*Ae+w*oe)*Rn,e[8]=(s*zr-l*ur+d*_t)*Rn,e[9]=(n*ur-r*zr-a*_t)*Rn,e[10]=(I*Ve-P*Ae+Z*Q)*Rn,e[11]=(b*Ae-_*Ve-w*Q)*Rn,e[12]=(l*Bt-s*lr-f*_t)*Rn,e[13]=(r*lr-n*Bt+i*_t)*Rn,e[14]=(P*oe-I*Oe-L*Q)*Rn,e[15]=(_*Oe-b*oe+A*Q)*Rn,e):null}function qn(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],f=t[6],d=t[7],_=t[8],b=t[9],A=t[10],w=t[11],I=t[12],P=t[13],L=t[14],Z=t[15];return e[0]=l*(A*Z-w*L)-b*(f*Z-d*L)+P*(f*w-d*A),e[1]=-(n*(A*Z-w*L)-b*(i*Z-a*L)+P*(i*w-a*A)),e[2]=n*(f*Z-d*L)-l*(i*Z-a*L)+P*(i*d-a*f),e[3]=-(n*(f*w-d*A)-l*(i*w-a*A)+b*(i*d-a*f)),e[4]=-(s*(A*Z-w*L)-_*(f*Z-d*L)+I*(f*w-d*A)),e[5]=r*(A*Z-w*L)-_*(i*Z-a*L)+I*(i*w-a*A),e[6]=-(r*(f*Z-d*L)-s*(i*Z-a*L)+I*(i*d-a*f)),e[7]=r*(f*w-d*A)-s*(i*w-a*A)+_*(i*d-a*f),e[8]=s*(b*Z-w*P)-_*(l*Z-d*P)+I*(l*w-d*b),e[9]=-(r*(b*Z-w*P)-_*(n*Z-a*P)+I*(n*w-a*b)),e[10]=r*(l*Z-d*P)-s*(n*Z-a*P)+I*(n*d-a*l),e[11]=-(r*(l*w-d*b)-s*(n*w-a*b)+_*(n*d-a*l)),e[12]=-(s*(b*L-A*P)-_*(l*L-f*P)+I*(l*A-f*b)),e[13]=r*(b*L-A*P)-_*(n*L-i*P)+I*(n*A-i*b),e[14]=-(r*(l*L-f*P)-s*(n*L-i*P)+I*(n*f-i*l)),e[15]=r*(l*A-f*b)-s*(n*A-i*b)+_*(n*f-i*l),e}function li(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],f=e[7],d=e[8],_=e[9],b=e[10],A=e[11],w=e[12],I=e[13],P=e[14],L=e[15],Z=t*s-r*a,Q=t*l-n*a,oe=t*f-i*a,Ae=r*l-n*s,Oe=r*f-i*s,Ve=n*f-i*l,rt=d*I-_*w,_t=d*P-b*w,Bt=d*L-A*w,ur=_*P-b*I,lr=_*L-A*I,zr=b*L-A*P;return Z*zr-Q*lr+oe*ur+Ae*Bt-Oe*_t+Ve*rt}function Pi(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],l=t[4],f=t[5],d=t[6],_=t[7],b=t[8],A=t[9],w=t[10],I=t[11],P=t[12],L=t[13],Z=t[14],Q=t[15],oe=r[0],Ae=r[1],Oe=r[2],Ve=r[3];return e[0]=oe*n+Ae*l+Oe*b+Ve*P,e[1]=oe*i+Ae*f+Oe*A+Ve*L,e[2]=oe*a+Ae*d+Oe*w+Ve*Z,e[3]=oe*s+Ae*_+Oe*I+Ve*Q,oe=r[4],Ae=r[5],Oe=r[6],Ve=r[7],e[4]=oe*n+Ae*l+Oe*b+Ve*P,e[5]=oe*i+Ae*f+Oe*A+Ve*L,e[6]=oe*a+Ae*d+Oe*w+Ve*Z,e[7]=oe*s+Ae*_+Oe*I+Ve*Q,oe=r[8],Ae=r[9],Oe=r[10],Ve=r[11],e[8]=oe*n+Ae*l+Oe*b+Ve*P,e[9]=oe*i+Ae*f+Oe*A+Ve*L,e[10]=oe*a+Ae*d+Oe*w+Ve*Z,e[11]=oe*s+Ae*_+Oe*I+Ve*Q,oe=r[12],Ae=r[13],Oe=r[14],Ve=r[15],e[12]=oe*n+Ae*l+Oe*b+Ve*P,e[13]=oe*i+Ae*f+Oe*A+Ve*L,e[14]=oe*a+Ae*d+Oe*w+Ve*Z,e[15]=oe*s+Ae*_+Oe*I+Ve*Q,e}function Ga(e,t,r){var n=r[0],i=r[1],a=r[2],s,l,f,d,_,b,A,w,I,P,L,Z;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(s=t[0],l=t[1],f=t[2],d=t[3],_=t[4],b=t[5],A=t[6],w=t[7],I=t[8],P=t[9],L=t[10],Z=t[11],e[0]=s,e[1]=l,e[2]=f,e[3]=d,e[4]=_,e[5]=b,e[6]=A,e[7]=w,e[8]=I,e[9]=P,e[10]=L,e[11]=Z,e[12]=s*n+_*i+I*a+t[12],e[13]=l*n+b*i+P*a+t[13],e[14]=f*n+A*i+L*a+t[14],e[15]=d*n+w*i+Z*a+t[15]),e}function Js(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Yp(e,t,r,n){var i=n[0],a=n[1],s=n[2],l=Math.hypot(i,a,s),f,d,_,b,A,w,I,P,L,Z,Q,oe,Ae,Oe,Ve,rt,_t,Bt,ur,lr,zr,un,Rn,Bi;return l<Ye.Ib?null:(l=1/l,i*=l,a*=l,s*=l,f=Math.sin(r),d=Math.cos(r),_=1-d,b=t[0],A=t[1],w=t[2],I=t[3],P=t[4],L=t[5],Z=t[6],Q=t[7],oe=t[8],Ae=t[9],Oe=t[10],Ve=t[11],rt=i*i*_+d,_t=a*i*_+s*f,Bt=s*i*_-a*f,ur=i*a*_-s*f,lr=a*a*_+d,zr=s*a*_+i*f,un=i*s*_+a*f,Rn=a*s*_-i*f,Bi=s*s*_+d,e[0]=b*rt+P*_t+oe*Bt,e[1]=A*rt+L*_t+Ae*Bt,e[2]=w*rt+Z*_t+Oe*Bt,e[3]=I*rt+Q*_t+Ve*Bt,e[4]=b*ur+P*lr+oe*zr,e[5]=A*ur+L*lr+Ae*zr,e[6]=w*ur+Z*lr+Oe*zr,e[7]=I*ur+Q*lr+Ve*zr,e[8]=b*un+P*Rn+oe*Bi,e[9]=A*un+L*Rn+Ae*Bi,e[10]=w*un+Z*Rn+Oe*Bi,e[11]=I*un+Q*Rn+Ve*Bi,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function eu(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],s=t[5],l=t[6],f=t[7],d=t[8],_=t[9],b=t[10],A=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+d*n,e[5]=s*i+_*n,e[6]=l*i+b*n,e[7]=f*i+A*n,e[8]=d*i-a*n,e[9]=_*i-s*n,e[10]=b*i-l*n,e[11]=A*i-f*n,e}function op(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],l=t[2],f=t[3],d=t[8],_=t[9],b=t[10],A=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-d*n,e[1]=s*i-_*n,e[2]=l*i-b*n,e[3]=f*i-A*n,e[8]=a*n+d*i,e[9]=s*n+_*i,e[10]=l*n+b*i,e[11]=f*n+A*i,e}function pl(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],l=t[2],f=t[3],d=t[4],_=t[5],b=t[6],A=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+d*n,e[1]=s*i+_*n,e[2]=l*i+b*n,e[3]=f*i+A*n,e[4]=d*i-a*n,e[5]=_*i-s*n,e[6]=b*i-l*n,e[7]=A*i-f*n,e}function sp(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ug(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lg(e,t,r){var n=r[0],i=r[1],a=r[2],s=Math.hypot(n,i,a),l,f,d;return s<Ye.Ib?null:(s=1/s,n*=s,i*=s,a*=s,l=Math.sin(t),f=Math.cos(t),d=1-f,e[0]=n*n*d+f,e[1]=i*n*d+a*l,e[2]=a*n*d-i*l,e[3]=0,e[4]=n*i*d-a*l,e[5]=i*i*d+f,e[6]=a*i*d+n*l,e[7]=0,e[8]=n*a*d+i*l,e[9]=i*a*d-n*l,e[10]=a*a*d+f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function cg(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ud(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sh(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zd(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3],l=n+n,f=i+i,d=a+a,_=n*l,b=n*f,A=n*d,w=i*f,I=i*d,P=a*d,L=s*l,Z=s*f,Q=s*d;return e[0]=1-(w+P),e[1]=b+Q,e[2]=A-Z,e[3]=0,e[4]=b-Q,e[5]=1-(_+P),e[6]=I+L,e[7]=0,e[8]=A+Z,e[9]=I-L,e[10]=1-(_+w),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function up(e,t){var r=new Ye.WT(3),n=-t[0],i=-t[1],a=-t[2],s=t[3],l=t[4],f=t[5],d=t[6],_=t[7],b=n*n+i*i+a*a+s*s;return b>0?(r[0]=(l*s+_*n+f*a-d*i)*2/b,r[1]=(f*s+_*i+d*n-l*a)*2/b,r[2]=(d*s+_*a+l*i-f*n)*2/b):(r[0]=(l*s+_*n+f*a-d*i)*2,r[1]=(f*s+_*i+d*n-l*a)*2,r[2]=(d*s+_*a+l*i-f*n)*2),zd(e,t,r),e}function fg(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Mo(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],s=t[5],l=t[6],f=t[8],d=t[9],_=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(a,s,l),e[2]=Math.hypot(f,d,_),e}function Ua(e,t){var r=new Ye.WT(3);Mo(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],s=t[0]*n,l=t[1]*i,f=t[2]*a,d=t[4]*n,_=t[5]*i,b=t[6]*a,A=t[8]*n,w=t[9]*i,I=t[10]*a,P=s+_+I,L=0;return P>0?(L=Math.sqrt(P+1)*2,e[3]=.25*L,e[0]=(b-w)/L,e[1]=(A-f)/L,e[2]=(l-d)/L):s>_&&s>I?(L=Math.sqrt(1+s-_-I)*2,e[3]=(b-w)/L,e[0]=.25*L,e[1]=(l+d)/L,e[2]=(A+f)/L):_>I?(L=Math.sqrt(1+_-s-I)*2,e[3]=(A-f)/L,e[0]=(l+d)/L,e[1]=.25*L,e[2]=(b+w)/L):(L=Math.sqrt(1+I-s-_)*2,e[3]=(l-d)/L,e[0]=(A+f)/L,e[1]=(b+w)/L,e[2]=.25*L),e}function hg(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=t[3],f=i+i,d=a+a,_=s+s,b=i*f,A=i*d,w=i*_,I=a*d,P=a*_,L=s*_,Z=l*f,Q=l*d,oe=l*_,Ae=n[0],Oe=n[1],Ve=n[2];return e[0]=(1-(I+L))*Ae,e[1]=(A+oe)*Ae,e[2]=(w-Q)*Ae,e[3]=0,e[4]=(A-oe)*Oe,e[5]=(1-(b+L))*Oe,e[6]=(P+Z)*Oe,e[7]=0,e[8]=(w+Q)*Ve,e[9]=(P-Z)*Ve,e[10]=(1-(b+I))*Ve,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function pg(e,t,r,n,i){var a=t[0],s=t[1],l=t[2],f=t[3],d=a+a,_=s+s,b=l+l,A=a*d,w=a*_,I=a*b,P=s*_,L=s*b,Z=l*b,Q=f*d,oe=f*_,Ae=f*b,Oe=n[0],Ve=n[1],rt=n[2],_t=i[0],Bt=i[1],ur=i[2],lr=(1-(P+Z))*Oe,zr=(w+Ae)*Oe,un=(I-oe)*Oe,Rn=(w-Ae)*Ve,Bi=(1-(A+Z))*Ve,eo=(L+Q)*Ve,io=(I+oe)*rt,Oo=(L-Q)*rt,As=(1-(A+P))*rt;return e[0]=lr,e[1]=zr,e[2]=un,e[3]=0,e[4]=Rn,e[5]=Bi,e[6]=eo,e[7]=0,e[8]=io,e[9]=Oo,e[10]=As,e[11]=0,e[12]=r[0]+_t-(lr*_t+Rn*Bt+io*ur),e[13]=r[1]+Bt-(zr*_t+Bi*Bt+Oo*ur),e[14]=r[2]+ur-(un*_t+eo*Bt+As*ur),e[15]=1,e}function dg(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,l=n+n,f=i+i,d=r*s,_=n*s,b=n*l,A=i*s,w=i*l,I=i*f,P=a*s,L=a*l,Z=a*f;return e[0]=1-b-I,e[1]=_+Z,e[2]=A-L,e[3]=0,e[4]=_-Z,e[5]=1-d-I,e[6]=w+P,e[7]=0,e[8]=A+L,e[9]=w-P,e[10]=1-d-b,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vg(e,t,r,n,i,a,s){var l=1/(r-t),f=1/(i-n),d=1/(a-s);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*f,e[6]=0,e[7]=0,e[8]=(r+t)*l,e[9]=(i+n)*f,e[10]=(s+a)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*d,e[15]=0,e}function Vv(e,t,r,n,i){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=(i+n)*s,e[14]=2*i*n*s):(e[10]=-1,e[14]=-2*n),e}var Zd=Vv;function Ah(e,t,r,n,i){var a=1/Math.tan(t/2),s;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(s=1/(n-i),e[10]=i*s,e[14]=i*n*s):(e[10]=-1,e[14]=-n),e}function Th(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),f=2/(s+l),d=2/(i+a);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=-((s-l)*f*.5),e[9]=(i-a)*d*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function jv(e,t,r,n,i,a,s){var l=1/(t-r),f=1/(n-i),d=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*d,e[11]=0,e[12]=(t+r)*l,e[13]=(i+n)*f,e[14]=(s+a)*d,e[15]=1,e}var Bo=jv;function qp(e,t,r,n,i,a,s){var l=1/(t-r),f=1/(n-i),d=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=d,e[11]=0,e[12]=(t+r)*l,e[13]=(i+n)*f,e[14]=a*d,e[15]=1,e}function of(e,t,r,n){var i,a,s,l,f,d,_,b,A,w,I=t[0],P=t[1],L=t[2],Z=n[0],Q=n[1],oe=n[2],Ae=r[0],Oe=r[1],Ve=r[2];return Math.abs(I-Ae)<Ye.Ib&&Math.abs(P-Oe)<Ye.Ib&&Math.abs(L-Ve)<Ye.Ib?In(e):(_=I-Ae,b=P-Oe,A=L-Ve,w=1/Math.hypot(_,b,A),_*=w,b*=w,A*=w,i=Q*A-oe*b,a=oe*_-Z*A,s=Z*b-Q*_,w=Math.hypot(i,a,s),w?(w=1/w,i*=w,a*=w,s*=w):(i=0,a=0,s=0),l=b*s-A*a,f=A*i-_*s,d=_*a-b*i,w=Math.hypot(l,f,d),w?(w=1/w,l*=w,f*=w,d*=w):(l=0,f=0,d=0),e[0]=i,e[1]=l,e[2]=_,e[3]=0,e[4]=a,e[5]=f,e[6]=b,e[7]=0,e[8]=s,e[9]=d,e[10]=A,e[11]=0,e[12]=-(i*I+a*P+s*L),e[13]=-(l*I+f*P+d*L),e[14]=-(_*I+b*P+A*L),e[15]=1,e)}function Vd(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=n[0],f=n[1],d=n[2],_=i-r[0],b=a-r[1],A=s-r[2],w=_*_+b*b+A*A;w>0&&(w=1/Math.sqrt(w),_*=w,b*=w,A*=w);var I=f*A-d*b,P=d*_-l*A,L=l*b-f*_;return w=I*I+P*P+L*L,w>0&&(w=1/Math.sqrt(w),I*=w,P*=w,L*=w),e[0]=I,e[1]=P,e[2]=L,e[3]=0,e[4]=b*L-A*P,e[5]=A*I-_*L,e[6]=_*P-b*I,e[7]=0,e[8]=_,e[9]=b,e[10]=A,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e}function jd(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Hv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function lp(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ic(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function mg(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function gg(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function B0(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Lo(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],l=e[5],f=e[6],d=e[7],_=e[8],b=e[9],A=e[10],w=e[11],I=e[12],P=e[13],L=e[14],Z=e[15],Q=t[0],oe=t[1],Ae=t[2],Oe=t[3],Ve=t[4],rt=t[5],_t=t[6],Bt=t[7],ur=t[8],lr=t[9],zr=t[10],un=t[11],Rn=t[12],Bi=t[13],eo=t[14],io=t[15];return Math.abs(r-Q)<=Ye.Ib*Math.max(1,Math.abs(r),Math.abs(Q))&&Math.abs(n-oe)<=Ye.Ib*Math.max(1,Math.abs(n),Math.abs(oe))&&Math.abs(i-Ae)<=Ye.Ib*Math.max(1,Math.abs(i),Math.abs(Ae))&&Math.abs(a-Oe)<=Ye.Ib*Math.max(1,Math.abs(a),Math.abs(Oe))&&Math.abs(s-Ve)<=Ye.Ib*Math.max(1,Math.abs(s),Math.abs(Ve))&&Math.abs(l-rt)<=Ye.Ib*Math.max(1,Math.abs(l),Math.abs(rt))&&Math.abs(f-_t)<=Ye.Ib*Math.max(1,Math.abs(f),Math.abs(_t))&&Math.abs(d-Bt)<=Ye.Ib*Math.max(1,Math.abs(d),Math.abs(Bt))&&Math.abs(_-ur)<=Ye.Ib*Math.max(1,Math.abs(_),Math.abs(ur))&&Math.abs(b-lr)<=Ye.Ib*Math.max(1,Math.abs(b),Math.abs(lr))&&Math.abs(A-zr)<=Ye.Ib*Math.max(1,Math.abs(A),Math.abs(zr))&&Math.abs(w-un)<=Ye.Ib*Math.max(1,Math.abs(w),Math.abs(un))&&Math.abs(I-Rn)<=Ye.Ib*Math.max(1,Math.abs(I),Math.abs(Rn))&&Math.abs(P-Bi)<=Ye.Ib*Math.max(1,Math.abs(P),Math.abs(Bi))&&Math.abs(L-eo)<=Ye.Ib*Math.max(1,Math.abs(L),Math.abs(eo))&&Math.abs(Z-io)<=Ye.Ib*Math.max(1,Math.abs(Z),Math.abs(io))}var jf=Pi,_g=Ic,o,u,c=(o=(0,ot.b2)(),o(u=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"viewport",void 0),(0,B.Z)(this,"overridedViewProjectionMatrix",void 0),(0,B.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,B.Z)(this,"jitteredProjectionMatrix",void 0),(0,B.Z)(this,"viewMatrixInverse",void 0),(0,B.Z)(this,"cameraPosition",void 0)}return(0,Y.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Vt(),bn(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,K.Z)(r,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var i=sp(Vt(),[r,n,0]);this.jitteredProjectionMatrix=Pi(Vt(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Pi(Vt(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||u),m=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),x,E;function T(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function M(e,t){if(!!e){if(typeof e=="string")return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}}function D(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var U={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},H=(x=(0,ot.b2)(),x(E=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"container",void 0),(0,B.Z)(this,"controlCorners",void 0),(0,B.Z)(this,"controlContainer",void 0),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"controls",[]),(0,B.Z)(this,"unAddControls",[])}return(0,Y.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(pt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var i=n.get(pt.IMapService);i.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=T(this.controls),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;i.remove()}}catch(a){r.e(a)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",i=this.controlContainer=Fn("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=l.map(function(d){return n+d}).join(" ");r[l.filter(function(d){return!["row","column"].includes(d)}).join("")]=Fn("div",f,i)}function s(l){var f=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Wt.Z)(f),[U[l]])}Object.values(m).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Ws(this.controlCorners[r]);this.controlContainer&&Ws(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(!!n)for(var i=function(){var f=s[a],d=f.match(/^(top|bottom)(left|right)$/);if(d){var _=(0,K.Z)(d,3),b=_[1],A=_[2],w=r.controlCorners["".concat(b).concat(A)],I=new n(function(P){var L=(0,K.Z)(P,1),Z=L[0].target;w&&(w.style[b]=Z.clientHeight+"px")});I.observe(r.controlCorners["".concat(A).concat(b)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||E),X,ie,he=(X=(0,ot.b2)(),X(ie=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"container",void 0),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"markers",[]),(0,B.Z)(this,"markerLayers",[]),(0,B.Z)(this,"unAddMarkers",[]),(0,B.Z)(this,"unAddMarkerLayers",[])}return(0,Y.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(pt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ie),Fe,Le,at=(Fe=(0,ot.b2)(),Fe(Le=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"scene",void 0),(0,B.Z)(this,"mapsService",void 0),(0,B.Z)(this,"popups",[]),(0,B.Z)(this,"unAddPopups",[])}return(0,Y.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(r);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,Wt.Z)(this.popups),(0,Wt.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(pt.IMapService)}}]),e}())||Le),Ge=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),yt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Dt=function(e){return e.AND="and",e.OR="or",e}({}),kt=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Qt={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},fr=Qt,Br,$r,zn=di.merge,hn={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Hn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Dt.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},pn=(Br=(0,ot.b2)(),Br($r=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"sceneConfigCache",{}),(0,B.Z)(this,"layerConfigCache",{}),(0,B.Z)(this,"layerAttributeConfigCache",{})}return(0,Y.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return fr[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,F.Z)((0,F.Z)({},hn),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,i){this.layerConfigCache[n]=(0,F.Z)({},zn({},this.sceneConfigCache[r],Hn,i))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,F.Z)((0,F.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||$r);function an(e,t,r,n){!r||Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function jr(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(s,l){return l(e,t,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,t,a),a=null),a}function Cn(){var e=new Ye.WT(4);return Ye.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ki(e){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bi(e,t,r,n){var i=new Ye.WT(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function Yi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xn(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function aa(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Xa(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function po(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function no(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function $a(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function vo(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function rs(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function ns(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function tu(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function is(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function ru(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Io(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,n,i,a)}function vs(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function Vi(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function Aa(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function ga(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Ki(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function pu(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=a*s,e}function Ns(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function za(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],f=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],_=t[0],b=t[1],A=t[2],w=t[3];return e[0]=b*d-A*f+w*l,e[1]=-(_*d)+A*s-w*a,e[2]=_*f-b*s+w*i,e[3]=-(_*l)+b*a-A*i,e}function No(e,t,r,n){var i=t[0],a=t[1],s=t[2],l=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=l+n*(r[3]-l),e}function Us(e,t){t=t||1;var r,n,i,a,s,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,s=r*r+n*n;while(s>=1);do i=glMatrix.RANDOM()*2-1,a=glMatrix.RANDOM()*2-1,l=i*i+a*a;while(l>=1);var f=Math.sqrt((1-s)/l);return e[0]=t*r,e[1]=t*n,e[2]=t*i*f,e[3]=t*a*f,e}function qi(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*s,e}function sf(e,t,r){var n=t[0],i=t[1],a=t[2],s=r[0],l=r[1],f=r[2],d=r[3],_=d*n+l*a-f*i,b=d*i+f*n-s*a,A=d*a+s*i-l*n,w=-s*n-l*i-f*a;return e[0]=_*d+w*-s+b*-f-A*-l,e[1]=b*d+w*-l+A*-s-_*-f,e[2]=A*d+w*-f+_*-l-b*-s,e[3]=t[3],e}function dl(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function uf(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Po(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function lf(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],s=t[0],l=t[1],f=t[2],d=t[3];return Math.abs(r-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))}var tc=null,Kp=null,cp=null,Qp=null,Hf=null,Jp=null,Wv=null,ed=function(){var e=Cn();return function(t,r,n,i,a,s){var l,f;for(r||(r=4),n||(n=0),i?f=Math.min(i*r+n,t.length):f=t.length,l=n;l<f;l+=r)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],a(e,e,s),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}}(),wh=Math.PI/180,Hd=512,td=4003e4;function Pc(e){var t=e.latitude,r=t===void 0?0:t,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,f=e.flipY,d=f===void 0?!1:f;a=a!==void 0?a:Math.pow(2,i);var _={},b=Hd*a,A=Math.cos(r*wh),w=b/360,I=w/A,P=b/td/A;if(_.pixelsPerMeter=[P,-P,P],_.metersPerPixel=[1/P,-1/P,1/P],_.pixelsPerDegree=[w,-I,P],_.degreesPerPixel=[1/w,-1/I,1/P],l){var L=wh*Math.tan(r*wh)/A,Z=w*L/2,Q=b/td*L,oe=Q/I*P;_.pixelsPerDegree2=[0,-Z,Q],_.pixelsPerMeter2=[oe,0,oe],d&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return d&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var Oc=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Dl={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},cf,Ch,rd,fp,hp,nd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Wd=(cf=(0,ot.b2)(),Ch=(0,ot.f3)(pt.ICameraService),cf(rd=(fp=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"needRefresh",!0),an(this,"cameraService",hp,this),(0,B.Z)(this,"coordinateSystem",void 0),(0,B.Z)(this,"viewportCenter",void 0),(0,B.Z)(this,"viewportCenterProjection",void 0),(0,B.Z)(this,"pixelsPerDegree",void 0),(0,B.Z)(this,"pixelsPerDegree2",void 0),(0,B.Z)(this,"pixelsPerMeter",void 0)}return(0,Y.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=r||this.cameraService.getCenter(),s=Pc({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,f=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Oc.LNGLAT||this.coordinateSystem===Oc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Oc.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===Oc.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,i,a){var s=Pc({latitude:r[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,f=s.pixelsPerDegree,d=s.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),A=Pi([],b,_),w=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=qi([],[w[0],w[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=Pi([],b,_),A=Pi([],A,nd),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=d}}]),e}(),hp=jr(fp.prototype,"cameraService",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp))||rd),pp,dp;function id(e){var t=Gd();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Gd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vp=(pp=(0,ot.b2)(),pp(dp=function(e){(0,tt.Z)(r,e);var t=id(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"renderMap",new Map),(0,B.Z)((0,Ee.Z)(n),"enable",!1),(0,B.Z)((0,Ee.Z)(n),"renderEnable",!1),(0,B.Z)((0,Ee.Z)(n),"cacheLogs",{}),n}return(0,Y.Z)(r,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(!!this.enable){var l=i.split("."),f=null;l.forEach(function(d,_){f!==null?(f[d]||(f[d]={}),_!==l.length-1&&(f=f[d])):(s.cacheLogs[d]||(s.cacheLogs[d]={}),_!==l.length-1&&(f=s.cacheLogs[d])),_===l.length-1&&(f[d]=(0,F.Z)((0,F.Z)({time:Date.now()},f[d]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,ps.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?yo():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,F.Z)((0,F.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,F.Z)((0,F.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(ka.EventEmitter))||dp),Xd=N(50840),Dc=N.n(Xd),bs=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Wf,mp,Rh,ad,Gv;function Xv(e){var t=yg();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function yg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $v={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},L0=(Wf=(0,ot.b2)(),mp=(0,ot.f3)(pt.IMapService),Wf(Rh=(ad=function(e){(0,tt.Z)(r,e);var t=Xv(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"indragging",!1),an((0,Ee.Z)(n),"mapService",Gv,(0,Ee.Z)(n)),(0,B.Z)((0,Ee.Z)(n),"hammertime",void 0),(0,B.Z)((0,Ee.Z)(n),"lastClickTime",0),(0,B.Z)((0,Ee.Z)(n),"lastClickXY",[-1,-1]),(0,B.Z)((0,Ee.Z)(n),"clickTimer",void 0),(0,B.Z)((0,Ee.Z)(n),"$containter",void 0),(0,B.Z)((0,Ee.Z)(n),"onDrag",function(l){var f=n.interactionEvent(l);f.type=$v[f.type],f.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(bs.Drag,f)}),(0,B.Z)((0,Ee.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var f=n.interactionEvent(l);n.emit(bs.Hover,f)}),(0,B.Z)((0,Ee.Z)(n),"onTouch",function(l){var f=l.touches[0];n.onHover({x:f.pageX,y:f.pageY,type:"touch"})}),(0,B.Z)((0,Ee.Z)(n),"onHover",function(l){var f=l.clientX,d=l.clientY,_=f,b=d,A=l.type,w=n.mapService.getMapContainer();if(w){var I=w.getBoundingClientRect(),P=I.top,L=I.left;_=_-L-w.clientLeft,b=b-P-w.clientTop}var Z=n.mapService.containerToLngLat([_,b]);if(A==="click"){n.isDoubleTap(_,b,Z);return}if(A==="touch"){n.isDoubleTap(_,b,Z);return}A!=="click"&&A!=="dblclick"&&n.emit(bs.Hover,{x:_,y:b,lngLat:Z,type:A,target:l})}),n}return(0,Y.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(bs.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(bs.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(bs.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(bs.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(Dc()).Manager(i);a.add(new(Dc()).Tap({event:"dblclick",taps:2})),a.add(new(Dc()).Tap({event:"click"})),a.add(new(Dc()).Pan({threshold:0,pointers:0})),a.add(new(Dc()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,f;s==="touch"?(f=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(f=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var d=this.mapService.getMapContainer();if(d){var _=d.getBoundingClientRect(),b=_.top,A=_.left;l-=A,f-=b}var w=this.mapService.containerToLngLat([l,f]);return{x:l,y:f,lngLat:w,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,f=new Date().getTime(),d="click";f-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),d="dblclick",this.emit(bs.Hover,{x:i,y:a,lngLat:s,type:d})):(this.lastClickTime=f,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){d="click",l.emit(bs.Hover,{x:i,y:a,lngLat:s,type:d})},400))}}]),r}(ks()),Gv=jr(ad.prototype,"mapService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad))||Rh),od=0;function mo(e){var t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(od++),r.classList.add("l7-scene"),t.appendChild(r),r}return null}function rc(e){var t,r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){r=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return r}var W=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),ff,$d,Yv,sd,nc,ud,gp,Fc,ld,Yd,qv,_p,Kv,xg=(ff=(0,ot.b2)(),$d=(0,ot.f3)(pt.IMapService),Yv=(0,ot.f3)(pt.IRendererService),sd=(0,ot.f3)(pt.IGlobalConfigService),nc=(0,ot.f3)(pt.IInteractionService),ud=(0,ot.f3)(pt.ILayerService),ff(gp=(Fc=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,B.Z)(this,"pickedColors",void 0),(0,B.Z)(this,"pickedTileLayers",[]),an(this,"mapService",ld,this),an(this,"rendererService",Yd,this),an(this,"configService",qv,this),an(this,"interactionService",_p,this),an(this,"layerService",Kv,this),(0,B.Z)(this,"pickingFBO",void 0),(0,B.Z)(this,"width",0),(0,B.Z)(this,"height",0),(0,B.Z)(this,"alreadyInPicking",!1),(0,B.Z)(this,"pickBufferScale",1),(0,B.Z)(this,"pickFromPickingFBO",function(r,n){var i=n.x,a=n.y,s=n.lngLat,l=n.type,f=n.target,d=!1,_=t.rendererService,b=_.readPixels,A=_.getContainer,w=t.getContainerSize(A()),I=w.width,P=w.height;I*=la,P*=la;var L=r.getLayerConfig(),Z=L.enableHighlight,Q=L.enableSelect,oe=i*la,Ae=a*la;if(oe>I-1*la||oe<0||Ae>P-1*la||Ae<0)return!1;var Oe=b({x:Math.floor(oe/t.pickBufferScale),y:Math.floor((P-(a+1)*la)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO});if(t.pickedColors=Oe,Oe[0]!==0||Oe[1]!==0||Oe[2]!==0){var Ve=ua(Oe),rt=r.layerPickService.getFeatureById(Ve);Ve!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var _t={x:i,y:a,type:l,lngLat:s,featureId:Ve,feature:rt,target:f};rt&&(d=!0,r.setCurrentPickId(Ve),t.triggerHoverOnLayer(r,_t))}else{var Bt={x:i,y:a,lngLat:s,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:f,feature:null};t.triggerHoverOnLayer(r,(0,F.Z)((0,F.Z)({},Bt),{},{type:"unpick"})),t.triggerHoverOnLayer(r,Bt),r.setCurrentPickId(null)}if(Z&&r.layerPickService.highlightPickedFeature(Oe),Q&&l==="click"&&(Oe==null?void 0:Oe.toString())!==[0,0,0,0].toString()){var ur=ua(Oe);r.getCurrentSelectedId()===null||ur!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Oe),r.setCurrentSelectedId(ur)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return d})}return(0,Y.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),f=l.width,d=l.height;f*=la,d*=la,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(f/this.pickBufferScale),height:Math.round(d/this.pickBufferScale),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(bs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a,s){var l=this,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:f=this.rendererService,d=f.useFramebuffer,_=f.clear,this.resizePickingFBO(),d(this.pickingFBO,function(){_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var w=l.pickBox(i,a);s(w)});case 3:case"end":return A.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var i=this,a=n.map(function(ur){var lr=ur<0?0:ur;return Math.floor(lr*la/i.pickBufferScale)}),s=(0,K.Z)(a,4),l=s[0],f=s[1],d=s[2],_=s[3],b=this.rendererService,A=b.readPixels,w=b.getContainer,I=this.getContainerSize(w()),P=I.width,L=I.height;if(P*=la,L*=la,l>(P-1)*la/this.pickBufferScale||d<0||f>(L-1)*la/this.pickBufferScale||_<0)return[];for(var Z=Math.min(P/this.pickBufferScale,d)-l,Q=Math.min(L/this.pickBufferScale,_)-f,oe=A({x:l,y:Math.floor(L/this.pickBufferScale-(_+1)),width:Z,height:Q,data:new Uint8Array(Z*Q*4),framebuffer:this.pickingFBO}),Ae=[],Oe={},Ve=0;Ve<oe.length/4;Ve=Ve+1){var rt=oe.slice(Ve*4,Ve*4+4),_t=ua(rt);if(_t!==-1&&!Oe[_t]){var Bt=r.layerPickService.getFeatureById(_t);Ae.push((0,F.Z)((0,F.Z)({},Bt),{},{pickedFeatureIdx:_t})),Oe[_t]=!0}}return Ae}},{key:"handleCursor",value:function(r,n){var i=r.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var f=this.mapService.version,d=f==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=d==null?void 0:d.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?d==null||d.style.setProperty("cursor",""):n==="mousemove"&&(d==null||d.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/la,height:r.height/la}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),i=n.width,a=n.height;i*=la,a*=la,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){var a=this,s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:s=this.rendererService,l=s.useFramebuffer,f=s.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var b=a.layerService.getRenderList();b.filter(function(A){return A.needPick(i.type)}).reverse().some(function(A){f({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(i);var w=a.pickFromPickingFBO(A,i);return a.layerService.pickedLayerId=w?+A.id:-1,w&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return _.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){rc(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),ld=jr(Fc.prototype,"mapService",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=jr(Fc.prototype,"rendererService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qv=jr(Fc.prototype,"configService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=jr(Fc.prototype,"interactionService",[nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=jr(Fc.prototype,"layerService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc))||gp),bg=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ye.Z)(this,e),(0,B.Z)(this,"autoStart",void 0),(0,B.Z)(this,"startTime",0),(0,B.Z)(this,"oldTime",0),(0,B.Z)(this,"running",!1),(0,B.Z)(this,"elapsedTime",0),this.autoStart=t}return(0,Y.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Qv,Jv,wu,cd,em,Hu,Eg,tm,Gf;function Xf(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yp(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function yp(e,t){if(!!e){if(typeof e=="string")return Mh(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mh(e,t)}}function Mh(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xp(e){var t=Sg();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Sg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rm=di.throttle,Ag=(Qv=(0,ot.b2)(),Jv=(0,ot.f3)(pt.IRendererService),wu=(0,ot.f3)(pt.IMapService),cd=(0,ot.f3)(pt.IDebugService),Qv(em=(Hu=function(e){(0,tt.Z)(r,e);var t=xp(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"pickedLayerId",-1),(0,B.Z)((0,Ee.Z)(n),"clock",new bg),(0,B.Z)((0,Ee.Z)(n),"alreadyInRendering",!1),(0,B.Z)((0,Ee.Z)(n),"layers",[]),(0,B.Z)((0,Ee.Z)(n),"layerList",[]),(0,B.Z)((0,Ee.Z)(n),"layerRenderID",void 0),(0,B.Z)((0,Ee.Z)(n),"sceneInited",!1),(0,B.Z)((0,Ee.Z)(n),"animateInstanceCount",0),(0,B.Z)((0,Ee.Z)(n),"shaderPicking",!0),(0,B.Z)((0,Ee.Z)(n),"enableRender",!0),an((0,Ee.Z)(n),"renderService",Eg,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"mapService",tm,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"debugService",Gf,(0,Ee.Z)(n)),(0,B.Z)((0,Ee.Z)(n),"reRender",rm(function(){n.renderLayers()},32)),(0,B.Z)((0,Ee.Z)(n),"throttleRenderLayers",rm(function(){n.renderLayers()},16)),n}return(0,Y.Z)(r,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s=this;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var d=(0,Ot.Z)(ve().mark(function _(b){return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(b.startInit){w.next=4;break}return w.next=3,b.init();case 3:s.updateLayerRenderList();case 4:case"end":return w.stop()}},_)}));return function(_){return d.apply(this,arguments)}}());case 2:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s,l){var f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:l?(f=l.layerChildren.indexOf(s),f>-1&&l.layerChildren.splice(f,1)):(d=this.layers.indexOf(s),d>-1&&this.layers.splice(d,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){w.next=2;break}return w.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),this.renderService.beginFrame(),l=Xf(this.layerList),w.prev=9,l.s();case 11:if((f=l.n()).done){w.next=24;break}if(d=f.value,_=d.getLayerConfig(),b=_.enableMask,d.masks.filter(function(I){return I.inited}).length>0&&b&&this.renderMask(d.masks),!d.getLayerConfig().enableMultiPassRenderer){w.next=20;break}return w.next=18,d.renderMultiPass();case 18:w.next=22;break;case 20:return w.next=22,d.render();case 22:w.next=11;break;case 24:w.next=29;break;case 26:w.prev=26,w.t0=w.catch(9),l.e(w.t0);case 29:return w.prev=29,l.f(),w.finish(29);case 32:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 35:case"end":return w.stop()}},a,this,[[9,26,29,32]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?yt.MULTIPLE:yt.SINGLE,l=Xf(i),f;try{for(l.s();!(f=l.n()).done;){var d=f.value;d.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,s.hooks.beforeRenderData.promise();case 2:l=d.sent,l&&this.renderLayers();case 4:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,f=l===void 0?!0:l,d=i.tileMask?1:0,_=i.masks.filter(function(P){return P.inited});d=d+(f?_.length:1);var b=d>1?yt.MULTIPLE:yt.SINGLE;if((i.tileMask||_.length&&f)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&f){var A=Xf(_),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;I.render({isStencil:!0,stencilType:b,stencilIndex:a++})}}catch(P){A.e(P)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:b,stencilIndex:a++,stencilOperation:Dt.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){f.next=6;break}return f.next=4,s.renderMultiPass();case 4:f.next=8;break;case 6:return f.next=8,s.render();case 8:case"end":return f.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=ii(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(ka.EventEmitter),Eg=jr(Hu.prototype,"renderService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=jr(Hu.prototype,"mapService",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gf=jr(Hu.prototype,"debugService",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu))||em),Fl=N(81253),nm=di.isNil,im=function(){function e(t){var r=this;(0,ye.Z)(this,e),(0,B.Z)(this,"name",void 0),(0,B.Z)(this,"type",void 0),(0,B.Z)(this,"scale",void 0),(0,B.Z)(this,"descriptor",void 0),(0,B.Z)(this,"featureBufferLayout",[]),(0,B.Z)(this,"needRescale",!1),(0,B.Z)(this,"needRemapping",!1),(0,B.Z)(this,"needRegenerateVertices",!1),(0,B.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,B.Z)(this,"vertexAttribute",void 0),(0,B.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=r.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,f=(l=r.scale)===null||l===void 0?void 0:l.scalers[s].func,d=f(a);return d})}),this.setProps(t)}return(0,Y.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,Wt.Z)(r));if(!nm(a))return[a]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),hf=["buffer","update","name"],Tg=["buffer","update","name"],Ih,qd,am,Kd,Qd,om,sm=(Ih={},(0,B.Z)(Ih,W.FLOAT,4),(0,B.Z)(Ih,W.UNSIGNED_BYTE,1),(0,B.Z)(Ih,W.UNSIGNED_SHORT,2),Ih),wg=(qd=(0,ot.b2)(),am=(0,ot.f3)(pt.IRendererService),qd(Kd=(Qd=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"attributesAndIndices",void 0),an(this,"rendererService",om,this),(0,B.Z)(this,"attributes",[]),(0,B.Z)(this,"triangulation",void 0),(0,B.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Y.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new im(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(i){return i.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(r[a]||s&&r[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,i){var a=this.getLayerStyleAttribute(r);a||(a=this.registerStyleAttribute((0,F.Z)((0,F.Z)({},n),{},{name:r})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,i=this.getLayerStyleAttribute(r),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Oe){return Oe.name===r});if(l&&l.descriptor){var f=l.descriptor,d=f.update,_=f.buffer,b=f.size,A=b===void 0?0:b,w=sm[_.type||W.FLOAT];if(d){var I=this.featureLayout,P=I.elements,L=I.sizePerElement,Z=P.slice(i,a);if(!Z.length)return;var Q=Z[0].offset,oe=Q*A*w,Ae=Z.map(function(Oe,Ve){for(var rt=Oe.featureIdx,_t=Oe.vertices,Bt=Oe.normals,ur=_t.length/L,lr=[],zr=0;zr<ur;zr++){var un=Bt?Bt.slice(zr*3,zr*3+3):[];lr.push.apply(lr,(0,Wt.Z)(d(n[rt],rt,_t.slice(zr*L,zr*L+L),Ve,un)))}return lr}).reduce(function(Oe,Ve){return Oe.push.apply(Oe,(0,Wt.Z)(Ve)),Oe},[]);l.vertexAttribute.updateBuffer({data:Ae,offset:oe}),s==null||s.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndices",value:function(r,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(Z){return Z.resetDescriptor(),Z.descriptor}),l=0,f=0,d=[],_=3;r.forEach(function(Z,Q){var oe=a.triangulation(Z,i),Ae=oe.indices,Oe=oe.vertices,Ve=oe.normals,rt=oe.size,_t=oe.indexes,Bt=oe.count;typeof Bt=="number"&&(f+=Bt),Ae.forEach(function(un){d.push(un+l)}),_=rt;var ur=Oe.length/rt;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:Q,vertices:Oe,normals:Ve,offset:l}),l+=ur;for(var lr=function(Rn){var Bi=(Ve==null?void 0:Ve.slice(Rn*3,Rn*3+3))||[],eo=Oe.slice(Rn*rt,Rn*rt+rt),io=0;_t&&_t[Rn]!==void 0&&(io=_t[Rn]),s.forEach(function(Oo,As){if(Oo&&Oo.update){var uc;(uc=Oo.buffer.data).push.apply(uc,(0,Wt.Z)(Oo.update(Z,Q,eo,Rn,Bi,io)))}})},zr=0;zr<ur;zr++)lr(zr)});var b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createElements,P={};s.forEach(function(Z,Q){if(Z){var oe=Z.buffer,Ae=Z.update,Oe=Z.name,Ve=(0,Fl.Z)(Z,hf),rt=A((0,F.Z)({buffer:w(oe)},Ve));P[Z.name||""]=rt,a.attributes[Q].vertexAttribute=rt}});var L=I({data:d,type:W.UNSIGNED_INT,count:d.length});return this.attributesAndIndices={attributes:P,elements:L,count:f},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(w){return w.resetDescriptor(),w.descriptor}),s=0,l=[],f=3;r.forEach(function(w,I){var P=i.triangulation(w),L=P.indices,Z=P.vertices,Q=P.normals,oe=P.size,Ae=P.indexes;L.forEach(function(_t){l.push(_t+s)}),f=oe;var Oe=Z.length/oe;i.featureLayout.sizePerElement=f,i.featureLayout.elements.push({featureIdx:I,vertices:Z,normals:Q,offset:s}),s+=Oe;for(var Ve=function(Bt){var ur=(Q==null?void 0:Q.slice(Bt*3,Bt*3+3))||[],lr=Z.slice(Bt*oe,Bt*oe+oe),zr=0;Ae&&Ae[Bt]!==void 0&&(zr=Ae[Bt]),a.forEach(function(un,Rn){if(un&&un.update){var Bi;(Bi=un.buffer.data).push.apply(Bi,(0,Wt.Z)(un.update(w,I,lr,Bt,ur,zr)))}})},rt=0;rt<Oe;rt++)Ve(rt)});var d=this.rendererService,_=d.createAttribute,b=d.createBuffer,A={};return a.forEach(function(w,I){if(w){var P=w.buffer,L=w.update,Z=w.name,Q=(0,Fl.Z)(w,Tg),oe=_((0,F.Z)({buffer:b(P)},Q));A[w.name||""]=oe,i.attributes[I].vertexAttribute=oe}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),om=jr(Qd.prototype,"rendererService",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd))||Kd),Ph=N(34155);function Jd(e,t,r,n){function i(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function l(_){try{d(n.next(_))}catch(b){s(b)}}function f(_){try{d(n.throw(_))}catch(b){s(b)}}function d(_){_.done?a(_.value):i(_.value).then(l,f)}d((n=n.apply(e,t||[])).next())})}function bp(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(_){return f([d,_])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,i=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){r.label=d[1];break}if(d[0]===6&&r.label<a[1]){r.label=a[1],a=d;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(d);break}a[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(e,r)}catch(_){d=[6,_],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function ev(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a}function fd(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function um(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lm={exports:{}},tv={exports:{}},hd={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=t.default})(hd,hd.exports);var Wu={},cm={exports:{}},fm={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return r.call(this,n,a)}},e.exports=t.default})(fm,fm.exports);var $f={};Object.defineProperty($f,"__esModule",{value:!0}),$f.fallback=Ep,$f.wrap=hm;var kc=$f.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,rv=$f.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Cg=$f.hasNextTick=typeof Ph=="object"&&typeof Ph.nextTick=="function";function Ep(e){setTimeout(e,0)}function hm(e){return function(t){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return t.apply(void 0,r)})}}var pm;kc?pm=queueMicrotask:rv?pm=setImmediate:Cg?pm=Ph.nextTick:pm=Ep,$f.default=hm(pm),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;var r=fm.exports,n=l(r),i=$f,a=l(i),s=Wu;function l(b){return b&&b.__esModule?b:{default:b}}function f(b){return(0,s.isAsync)(b)?function(){for(var A=[],w=arguments.length;w--;)A[w]=arguments[w];var I=A.pop(),P=b.apply(this,A);return d(P,I)}:(0,n.default)(function(A,w){var I;try{I=b.apply(this,A)}catch(P){return w(P)}if(I&&typeof I.then=="function")return d(I,w);w(null,I)})}function d(b,A){return b.then(function(w){_(A,null,w)},function(w){_(A,w&&w.message?w:new Error(w))})}function _(b,A,w){try{b(A,w)}catch(I){(0,a.default)(function(P){throw P},I)}}e.exports=t.default}(cm,cm.exports),Object.defineProperty(Wu,"__esModule",{value:!0}),Wu.isAsyncIterable=Wu.isAsyncGenerator=Wu.isAsync=void 0;var nA=cm.exports,iA=aA(nA);function aA(e){return e&&e.__esModule?e:{default:e}}function ry(e){return e[Symbol.toStringTag]==="AsyncFunction"}function oA(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function sA(e){return typeof e[Symbol.asyncIterator]=="function"}function uA(e){if(typeof e!="function")throw new Error("expected a function");return ry(e)?(0,iA.default)(e):e}Wu.default=uA,Wu.isAsync=ry,Wu.isAsyncGenerator=oA,Wu.isAsyncIterable=sA;var pd={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],f=arguments.length;f--;)l[f]=arguments[f];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(d,_){l[i-1]=function(b){for(var A=[],w=arguments.length-1;w-- >0;)A[w]=arguments[w+1];if(b)return _(b);d(A.length>1?A:A[0])},n.apply(s,l)})}return a}e.exports=t.default})(pd,pd.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hd.exports,n=f(r),i=Wu,a=f(i),s=pd.exports,l=f(s);function f(d){return d&&d.__esModule?d:{default:d}}t.default=(0,l.default)(function(d,_,b){var A=(0,n.default)(_)?[]:{};d(_,function(w,I,P){(0,a.default)(w)(function(L){for(var Z,Q=[],oe=arguments.length-1;oe-- >0;)Q[oe]=arguments[oe+1];Q.length<2&&(Z=Q,Q=Z[0]),A[I]=Q,P(L)})},function(w){return b(w,A)})},3),e.exports=t.default}(tv,tv.exports);var N0={exports:{}},Rg={exports:{}},U0={exports:{}},dm={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=t.default})(dm,dm.exports);var z0={exports:{}},Z0={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(Z0,Z0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=_;var r=hd.exports,n=s(r),i=Z0.exports,a=s(i);function s(b){return b&&b.__esModule?b:{default:b}}function l(b){var A=-1,w=b.length;return function(){return++A<w?{value:b[A],key:A}:null}}function f(b){var A=-1;return function(){var I=b.next();return I.done?null:(A++,{value:I.value,key:A})}}function d(b){var A=b?Object.keys(b):[],w=-1,I=A.length;return function P(){var L=A[++w];return L==="__proto__"?P():w<I?{value:b[L],key:L}:null}}function _(b){if((0,n.default)(b))return l(b);var A=(0,a.default)(b);return A?f(A):d(b)}e.exports=t.default}(z0,z0.exports);var vm={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=t.default})(vm,vm.exports);var V0={exports:{}},mm={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(mm,mm.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=mm.exports,n=i(r);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,f,d){var _=!1,b=!1,A=!1,w=0,I=0;function P(){w>=l||A||_||(A=!0,s.next().then(function(Q){var oe=Q.value,Ae=Q.done;if(!(b||_)){if(A=!1,Ae){_=!0,w<=0&&d(null);return}w++,f(oe,I,L),I++,P()}}).catch(Z))}function L(Q,oe){if(w-=1,!b){if(Q)return Z(Q);if(Q===!1){_=!0,b=!0;return}if(oe===n.default||_&&w<=0)return _=!0,d(null);P()}}function Z(Q){b||(A=!1,_=!0,d(Q))}P()}e.exports=t.default}(V0,V0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=dm.exports,n=w(r),i=z0.exports,a=w(i),s=vm.exports,l=w(s),f=Wu,d=V0.exports,_=w(d),b=mm.exports,A=w(b);function w(I){return I&&I.__esModule?I:{default:I}}t.default=function(I){return function(P,L,Z){if(Z=(0,n.default)(Z),I<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!P)return Z(null);if((0,f.isAsyncGenerator)(P))return(0,_.default)(P,I,L,Z);if((0,f.isAsyncIterable)(P))return(0,_.default)(P[Symbol.asyncIterator](),I,L,Z);var Q=(0,a.default)(P),oe=!1,Ae=!1,Oe=0,Ve=!1;function rt(Bt,ur){if(!Ae)if(Oe-=1,Bt)oe=!0,Z(Bt);else if(Bt===!1)oe=!0,Ae=!0;else{if(ur===A.default||oe&&Oe<=0)return oe=!0,Z(null);Ve||_t()}}function _t(){for(Ve=!0;Oe<I&&!oe;){var Bt=Q();if(Bt===null){oe=!0,Oe<=0&&Z(null);return}Oe+=1,L(Bt.value,Bt.key,(0,l.default)(rt))}Ve=!1}_t()}},e.exports=t.default}(U0,U0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=U0.exports,n=f(r),i=Wu,a=f(i),s=pd.exports,l=f(s);function f(_){return _&&_.__esModule?_:{default:_}}function d(_,b,A,w){return(0,n.default)(b)(_,(0,a.default)(A),w)}t.default=(0,l.default)(d,4),e.exports=t.default}(Rg,Rg.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Rg.exports,n=s(r),i=pd.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d,_){return(0,n.default)(f,1,d,_)}t.default=(0,a.default)(l,3),e.exports=t.default}(N0,N0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=tv.exports,n=s(r),i=N0.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,n.default)(a.default,f,d)}e.exports=t.default}(lm,lm.exports);var Mg=um(lm.exports),Yf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Mg(this.tasks)},e.prototype.tap=function(t,r){var n=this;this.tasks.push(function(i){r.apply(void 0,fd([],ev(n.args),!1)),i(null,t)})},e}(),j0={exports:{}},H0={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hd.exports,n=L(r),i=mm.exports,a=L(i),s=Rg.exports,l=L(s),f=dm.exports,d=L(f),_=vm.exports,b=L(_),A=Wu,w=L(A),I=pd.exports,P=L(I);function L(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}function Z(Ae,Oe,Ve){Ve=(0,d.default)(Ve);var rt=0,_t=0,Bt=Ae.length,ur=!1;Bt===0&&Ve(null);function lr(zr,un){zr===!1&&(ur=!0),ur!==!0&&(zr?Ve(zr):(++_t===Bt||un===a.default)&&Ve(null))}for(;rt<Bt;rt++)Oe(Ae[rt],rt,(0,b.default)(lr))}function Q(Ae,Oe,Ve){return(0,l.default)(Ae,Infinity,Oe,Ve)}function oe(Ae,Oe,Ve){var rt=(0,n.default)(Ae)?Z:Q;return rt(Ae,(0,w.default)(Oe),Ve)}t.default=(0,P.default)(oe,3),e.exports=t.default})(H0,H0.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=H0.exports,n=s(r),i=tv.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,a.default)(n.default,f,d)}e.exports=t.default}(j0,j0.exports);var lA=um(j0.exports),_6=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return lA(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return Jd(n,void 0,void 0,function(){return bp(this,function(a){switch(a.label){case 0:return[4,r()];case 1:return a.sent(),i(null,t),[2]}})})})},e}(),W0={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=dm.exports,n=_(r),i=vm.exports,a=_(i),s=Wu,l=_(s),f=pd.exports,d=_(f);function _(A){return A&&A.__esModule?A:{default:A}}function b(A,w){if(w=(0,n.default)(w),!Array.isArray(A))return w(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return w();var I=0;function P(Z){var Q=(0,l.default)(A[I++]);Q.apply(void 0,Z.concat([(0,a.default)(L)]))}function L(Z){for(var Q=[],oe=arguments.length-1;oe-- >0;)Q[oe]=arguments[oe+1];if(Z!==!1){if(Z||I===A.length)return w.apply(void 0,[Z].concat(Q));P(Q)}}P([])}t.default=(0,d.default)(b),e.exports=t.default})(W0,W0.exports);var ny=um(W0.exports),y6=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ny(this.tasks)},e.prototype.tap=function(t,r){this.tasks.length===0?this.tasks.push(function(n){var i=r();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=r.apply(void 0,fd([],ev(n),!1));i(a?null:!1,t)})},e}(),iy=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Mg(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(n){var i=r();n(i,t)})},e}(),cA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Mg(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return Jd(n,void 0,void 0,function(){return bp(this,function(a){switch(a.label){case 0:return[4,r.apply(void 0,fd([],ev(this.args),!1))];case 1:return a.sent(),i(null,t),[2]}})})})},e}(),fA=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Mg(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return Jd(n,void 0,void 0,function(){var a;return bp(this,function(s){switch(s.label){case 0:return[4,r.apply(void 0,fd([],ev(this.args),!1))];case 1:return a=s.sent(),i(a,t),[2]}})})})},e}(),hA=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ny(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){r(n).then(function(a){i(null,a)})})},e}(),ay=N(67709),pA=N.n(ay),oy,sy,uy,ly,cy,fy,hy,py,dy,vy,gy,_y,yy,xy,by,Ey,Sy,Ay,du,Ty,wy,Cy,Ry,My,Iy,Py,Oy,Dy,Fy,ky,By,Ly,Ny,Uy,zy;function dA(e){var t=vA();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=(oy=(0,ot.b2)(),sy=(0,ot.f3)(pt.SceneID),uy=(0,ot.f3)(pt.IIconService),ly=(0,ot.f3)(pt.IFontService),cy=(0,ot.f3)(pt.IControlService),fy=(0,ot.f3)(pt.IGlobalConfigService),hy=(0,ot.f3)(pt.IMapService),py=(0,ot.f3)(pt.ICoordinateSystemService),dy=(0,ot.f3)(pt.IRendererService),vy=(0,ot.f3)(pt.ILayerService),gy=(0,ot.f3)(pt.IDebugService),_y=(0,ot.f3)(pt.ICameraService),yy=(0,ot.f3)(pt.IInteractionService),xy=(0,ot.f3)(pt.IPickingService),by=(0,ot.f3)(pt.IShaderModuleService),Ey=(0,ot.f3)(pt.IMarkerService),Sy=(0,ot.f3)(pt.IPopupService),oy(Ay=(du=function(e){(0,tt.Z)(r,e);var t=dA(r);function r(){var n;return(0,ye.Z)(this,r),n=t.call(this),(0,B.Z)((0,Ee.Z)(n),"destroyed",!1),(0,B.Z)((0,Ee.Z)(n),"loaded",!1),an((0,Ee.Z)(n),"id",Ty,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"iconService",wy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"fontService",Cy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"controlService",Ry,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"configService",My,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"map",Iy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"coordinateSystemService",Py,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"rendererService",Oy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"layerService",Dy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"debugService",Fy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"cameraService",ky,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"interactionService",By,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"pickingService",Ly,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"shaderModuleService",Ny,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"markerService",Uy,(0,Ee.Z)(n)),an((0,Ee.Z)(n),"popupService",zy,(0,Ee.Z)(n)),(0,B.Z)((0,Ee.Z)(n),"inited",!1),(0,B.Z)((0,Ee.Z)(n),"initPromise",void 0),(0,B.Z)((0,Ee.Z)(n),"rendering",!1),(0,B.Z)((0,Ee.Z)(n),"$container",void 0),(0,B.Z)((0,Ee.Z)(n),"canvas",void 0),(0,B.Z)((0,Ee.Z)(n),"markerContainer",void 0),(0,B.Z)((0,Ee.Z)(n),"hooks",void 0),(0,B.Z)((0,Ee.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Al(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,B.Z)((0,Ee.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new cA},n}return(0,Y.Z)(r,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ot.Z)(ve().mark(function s(){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),f.next=3,new Promise(function(d){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),d()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(bs.Drag,a.addSceneEvent.bind(a));case 10:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Ot.Z)(ve().mark(function s(){var l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,f?a.$container=f:a.$container=mo(a.configService.getSceneConfig(a.id).id||""),!a.$container){b.next=13;break}return a.canvas=Fn("canvas","",a.$container),a.setCanvas(),b.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),pA()(a.$container,a.handleWindowResized),window.matchMedia&&((d=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||d===void 0||d.addListener(a.handleWindowResized)),b.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return b.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ot.Z)(ve().mark(function s(){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,new Promise(function(d){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),a.map.version!=="GAODE2.x"&&d()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(bs.Drag,a.addSceneEvent.bind(a));case 5:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Ot.Z)(ve().mark(function s(){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){d.next=7;break}return d.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:d.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return d.stop()}},s)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],b.next=3,this.render();case 3:return d=s==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png"),b.abrupt("return",d);case 5:case"end":return b.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=Fn("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if((0,ay.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var s;(s=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=la,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d&&(d.width=l*s,d.height=f*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*f})}},{key:"setCanvas",value:function(){var i,a,s=la,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d.width=l*s,d.height=f*s,d.style.width="100%",d.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),r}(ka.EventEmitter),Ty=jr(du.prototype,"id",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=jr(du.prototype,"iconService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=jr(du.prototype,"fontService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=jr(du.prototype,"controlService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),My=jr(du.prototype,"configService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=jr(du.prototype,"map",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=jr(du.prototype,"coordinateSystemService",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=jr(du.prototype,"rendererService",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy=jr(du.prototype,"layerService",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=jr(du.prototype,"debugService",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky=jr(du.prototype,"cameraService",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=jr(du.prototype,"interactionService",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=jr(du.prototype,"pickingService",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=jr(du.prototype,"shaderModuleService",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=jr(du.prototype,"markerService",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=jr(du.prototype,"popupService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du))||Ay);function gA(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break;default:}return t}var Zy=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Vy(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r={};return e=e.replace(Zy,function(n,i,a){var s=a.split(":"),l=s[0].trim(),f="";switch(s.length>1&&(f=s[1].trim()),i){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(d,_){return d.push(Number(_.trim())),d},[]):f=new Array(gA(i)).fill(0);break;default:}return r[l]=f,"".concat(t?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:r}}function G0(e){var t=Vy(e,!0),r=t.content,n=t.uniforms;return r=r.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=Vy(s),f=l.content,d=l.uniforms;return Object.assign(n,d),"".concat(a,`{
`).concat(f,`
};`)}),{content:r,uniforms:n}}function jy(e){var t={};return e.replace(Zy,function(r,n,i){var a=i.trim();return t[a]?"":(t[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var Hy,Wy,_A=di.uniq,Gy="#define PI 3.14159265359",yA=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Xy=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  mat4 u_Mvp;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  vec2 u_sceneCenterMercator;
  float u_FocalDistance;
};`,$y=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,xA=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,bA=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,EA=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,SA=`layout(location = 2) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,AA=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Yy=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,TA=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,wA=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,qy=/precision\s+(high|low|medium)p\s+float/,Ky=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,CA=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,RA=/void\s+main\s*\([^)]*\)\s*\{\n?/,x6=/}\n?[^{}]*$/,MA=(Hy=(0,ot.b2)(),Hy(Wy=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"moduleCache",{}),(0,B.Z)(this,"rawContentCache",{})}return(0,Y.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Gy,fs:Gy}),this.registerModule("decode",{vs:yA,fs:""}),this.registerModule("scene_uniforms",{vs:Xy,fs:Xy}),this.registerModule("picking_uniforms",{vs:$y,fs:$y}),this.registerModule("projection",{vs:Yy,fs:Yy}),this.registerModule("project",{vs:AA,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:wA}),this.registerModule("lighting",{vs:bA,fs:""}),this.registerModule("light",{vs:xA,fs:""}),this.registerModule("picking",{vs:SA,fs:EA}),this.registerModule("rotation_2d",{vs:TA,fs:""})}},{key:"registerModule",value:function(r,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,f=G0(i),d=f.content,_=f.uniforms,b=G0(a),A=b.content,w=b.uniforms;this.rawContentCache[r]={fs:A,inject:l,uniforms:(0,F.Z)((0,F.Z)((0,F.Z)({},_),w),s),vs:d}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,i=this.rawContentCache[r].vs,a=this.rawContentCache[r].fs,s=this.rawContentCache[r].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=G0(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(RA,function(Z){return Z+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var f=this.processModule(i,[],"vs"),d=f.content,_=f.includeList,b=this.processModule(a,[],"fs"),A=b.content,w=b.includeList,I="",P=_A(_.concat(w).concat(r)).reduce(function(Z,Q){return(0,F.Z)((0,F.Z)({},Z),n.rawContentCache[Q].uniforms)},(0,F.Z)({},l));qy.test(A)||(I=I+Ky),I=I+A;var L="";return qy.test(d)||(L=L+Ky),L=L+d,this.moduleCache[r]={fs:I.trim(),uniforms:P,vs:L.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var a=this,s=r.replace(CA,function(l,f){var d=f.split(" "),_=d[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var b=a.rawContentCache[_][i];n.push(_);var A=a.processModule(b,n,i),w=A.content;return w});return{content:s,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(r[a],`;
`)},`
`);return n}}]),e}())||Wy),Ea=N(66213),nv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),Qy,Jy,Ig=(Qy=(0,ot.b2)(),Qy(Jy=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"shaderModuleService",void 0),(0,B.Z)(this,"rendererService",void 0),(0,B.Z)(this,"cameraService",void 0),(0,B.Z)(this,"mapService",void 0),(0,B.Z)(this,"interactionService",void 0),(0,B.Z)(this,"layerService",void 0),(0,B.Z)(this,"config",void 0)}return(0,Y.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return nv.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(pt.IRendererService),this.cameraService=r.getContainer().get(pt.ICameraService),this.mapService=r.getContainer().get(pt.IMapService),this.interactionService=r.getContainer().get(pt.IInteractionService),this.layerService=r.getContainer().get(pt.ILayerService),this.shaderModuleService=r.getContainer().get(pt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Jy),e1,t1;function IA(e){var t=PA();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=(e1=(0,ot.b2)(),e1(t1=function(e){(0,tt.Z)(r,e);var t=IA(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){(0,Ea.Z)((0,le.Z)(r.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Ig))||t1),r1,n1,i1,X0,a1;function DA(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FA(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function FA(e,t){if(!!e){if(typeof e=="string")return o1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o1(e,t)}}function o1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var kA=(r1=(0,ot.b2)(),n1=(0,ot.f3)(pt.IPostProcessor),r1(i1=(X0=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"passes",[]),an(this,"postProcessor",a1,this),(0,B.Z)(this,"layer",void 0),(0,B.Z)(this,"renderFlag",void 0),(0,B.Z)(this,"width",0),(0,B.Z)(this,"height",0)}return(0,Y.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){var i,a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i=DA(this.passes),f.prev=1,i.s();case 3:if((a=i.n()).done){f.next=9;break}return s=a.value,f.next=7,s.render(this.layer);case 7:f.next=3;break;case 9:f.next=14;break;case 11:f.prev=11,f.t0=f.catch(1),i.e(f.t0);case 14:return f.prev=14,i.f(),f.finish(14);case 17:return f.next=19,this.postProcessor.render(this.layer);case 19:case"end":return f.stop()}},n,this,[[1,11,14,17]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===nv.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,i){r.init(this.layer,n),this.passes.splice(i,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),a1=jr(X0.prototype,"postProcessor",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X0))||i1),s1,u1;function BA(e){var t=LA();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NA=(s1=(0,ot.b2)(),s1(u1=function(e){(0,tt.Z)(r,e);var t=BA(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"pickingFBO",void 0),(0,B.Z)((0,Ee.Z)(n),"layer",void 0),(0,B.Z)((0,Ee.Z)(n),"width",0),(0,B.Z)((0,Ee.Z)(n),"height",0),(0,B.Z)((0,Ee.Z)(n),"alreadyInRendering",!1),(0,B.Z)((0,Ee.Z)(n),"pickFromPickingFBO",function(l){var f=l.x,d=l.y,_=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var A=n.rendererService,w=A.getViewportSize,I=A.readPixels,P=A.useFramebuffer,L=w(),Z=L.width,Q=L.height,oe=n.layer.getLayerConfig(),Ae=oe.enableHighlight,Oe=oe.enableSelect,Ve=f*la,rt=d*la;if(!(Ve>Z||Ve<0||rt>Q||rt<0)){var _t;P(n.pickingFBO,function(){var Bt;if(_t=I({x:Math.round(Ve),y:Math.round(Q-(d+1)*la),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),_t[0]!==0||_t[1]!==0||_t[2]!==0){var ur=ua(_t),lr=n.layer.getSource().getFeatureById(ur),zr={x:f,y:d,type:b,lngLat:_,featureId:ur,feature:lr};lr&&(n.layer.setCurrentPickId(ur),n.triggerHoverOnLayer(zr))}else{var un={x:f,y:d,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,F.Z)((0,F.Z)({},un),{},{type:"unpick"})),n.triggerHoverOnLayer(un),n.layer.setCurrentPickId(null)}Ae&&n.highlightPickedFeature(_t),Oe&&b==="click"&&((Bt=_t)===null||Bt===void 0?void 0:Bt.toString())!==[0,0,0,0].toString()&&n.selectFeature(_t)})}}}),n}return(0,Y.Z)(r,[{key:"getType",value:function(){return nv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){(0,Ea.Z)((0,le.Z)(r.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,f=s.createFramebuffer,d=s.getViewportSize,_=d(),b=_.width,A=_.height;this.pickingFBO=f({color:l({width:b,height:A,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(bs.Hover,this.pickFromPickingFBO),this.interactionService.on(bs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(bs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,f=s.useFramebuffer,d=s.clear,_=l(),b=_.width,A=_.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==A)&&(this.pickingFBO.resize({width:b,height:A}),this.width=b,this.height=A),f(this.pickingFBO,function(){d({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var w=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(w),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,K.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeHighlight.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,K.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeSelect.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=Ma(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=Ma(a);this.highlightPickedFeature(new Uint8Array(s))}}]),r}(Ig))||u1),l1,c1,f1,$0,h1,UA=di.camelCase,zA=di.isNil,ZA=di.upperFirst,VA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Oh=(l1=(0,ot.b2)(),c1=(0,ot.f3)(pt.IShaderModuleService),l1(f1=($0=function(){function e(){(0,ye.Z)(this,e),an(this,"shaderModuleService",h1,this),(0,B.Z)(this,"rendererService",void 0),(0,B.Z)(this,"config",void 0),(0,B.Z)(this,"quad",VA),(0,B.Z)(this,"enabled",!0),(0,B.Z)(this,"renderToScreen",!1),(0,B.Z)(this,"model",void 0),(0,B.Z)(this,"name",void 0),(0,B.Z)(this,"optionsToUpdate",{})}return(0,Y.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return nv.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(pt.IRendererService),this.shaderModuleService=r.getContainer().get(pt.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,f=this.setupShaders(),d=f.vs,_=f.fs,b=f.uniforms;this.model=l({vs:d,fs:_,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:(0,F.Z)((0,F.Z)({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var i=this,a=r.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,f=s.getViewportSize,d=s.clear,_=f(),b=_.width,A=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){d({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var w=(0,F.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[b,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(w.u_BloomFinal=1,w.u_Texture2=n),i.model.draw({uniforms:w})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,F.Z)((0,F.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(i){zA(r[i])||(n["u_".concat(ZA(UA(i)))]=r[i])}),n}}]),e}(),h1=jr($0.prototype,"shaderModuleService",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$0))||f1),p1,d1;function jA(e){var t=HA();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function HA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WA=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,GA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Y0=di.isNil,XA=(p1=(0,ot.b2)(),p1(d1=function(e){(0,tt.Z)(r,e);var t=jA(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:GA,fs:WA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Y0(i.bloomRadius)||(a.u_radius=i.bloomRadius),Y0(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),Y0(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),r}(Oh))||d1),v1,m1;function $A(e){var t=YA();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,KA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,QA=di.isNil,JA=(v1=(0,ot.b2)(),v1(m1=function(e){(0,tt.Z)(r,e);var t=$A(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:KA,fs:qA});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return QA(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),r}(Oh))||m1),g1,_1;function eT(e){var t=tT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function tT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,nT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,iT=di.isNil,aT=(g1=(0,ot.b2)(),g1(_1=function(e){(0,tt.Z)(r,e);var t=eT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:nT,fs:rT});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return iT(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),r}(Oh))||_1),y1,x1;function oT(e){var t=sT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function sT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,lT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cT=(y1=(0,ot.b2)(),y1(x1=function(e){(0,tt.Z)(r,e);var t=oT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:lT,fs:uT});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),r}(Oh))||x1),b1,E1;function fT(e){var t=hT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,dT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vT=(b1=(0,ot.b2)(),b1(E1=function(e){(0,tt.Z)(r,e);var t=fT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:dT,fs:pT}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Oh))||E1),S1,A1;function mT(e){var t=gT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _T=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,yT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xT=(S1=(0,ot.b2)(),S1(A1=function(e){(0,tt.Z)(r,e);var t=mT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:yT,fs:_T});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),r}(Oh))||A1),T1,w1;function bT(e){var t=ET();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,AT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TT=(T1=(0,ot.b2)(),T1(w1=function(e){(0,tt.Z)(r,e);var t=bT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:AT,fs:ST});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,_=f.height;return{vs:a,fs:s,uniforms:(0,F.Z)((0,F.Z)({},l),{},{u_ViewportSize:[d,_]})}}}]),r}(Oh))||w1),C1,R1;function wT(e){var t=CT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function CT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,MT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IT=(C1=(0,ot.b2)(),C1(R1=function(e){(0,tt.Z)(r,e);var t=wT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:MT,fs:RT}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Oh))||R1),M1,I1;function PT(e){var t=OT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,FT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,kT=(M1=(0,ot.b2)(),M1(I1=function(e){(0,tt.Z)(r,e);var t=PT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:DT,fs:FT}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Oh))||I1),P1,O1,D1,F1,iv,k1,BT=(P1=(0,ot.b2)(),O1=(0,ot.f3)(pt.IRendererService),D1=(0,ot.zY)(),P1(F1=(iv=function(){function e(){(0,ye.Z)(this,e),an(this,"rendererService",k1,this),(0,B.Z)(this,"passes",[]),(0,B.Z)(this,"readFBO",void 0),(0,B.Z)(this,"writeFBO",void 0)}return(0,Y.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,i=r.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(r.readFBO,(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.getReadFBOTex();case 2:s=d.sent,l=0;case 4:if(!(l<4)){d.next=11;break}return d.next=7,a.render(i,s);case 7:this.swap(),l++,d.next=4;break;case 11:case"end":return d.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){var a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=0;case 1:if(!(a<this.passes.length)){f.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){f.next=9;break}return f.next=7,this.renderBloomPass(i,s);case 7:f.next=12;break;case 9:return f.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,f.next=1;break;case 15:case"end":return f.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,i){r.init(n,i),this.passes.push(r)}},{key:"insert",value:function(r,n,i,a){r.init(i,a),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,i=r.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),k1=jr(iv.prototype,"rendererService",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr(iv.prototype,"init",[D1],Object.getOwnPropertyDescriptor(iv.prototype,"init"),iv.prototype),iv))||F1),B1,L1;function LT(e){var t=NT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function NT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=(B1=(0,ot.b2)(),B1(L1=function(e){(0,tt.Z)(r,e);var t=LT(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getType",value:function(){return nv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){(0,Ea.Z)((0,le.Z)(r.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,f=i.multiPassRenderer.getPostProcessor().getReadFBO();s(f,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:f}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(d){d.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Ig))||L1),N1,U1,z1,q0,Z1;function zT(e){var t=ZT();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VT=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,V1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,jT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function j1(e,t){for(var r=0,n=1/t,i=e;i>0;)r=r+n*(i%t),i=Math.floor(i/t),n=n/t;return r}var HT=1,WT=(N1=(0,ot.b2)(),U1=(0,ot.f3)(pt.IShaderModuleService),N1(z1=(q0=function(e){(0,tt.Z)(r,e);var t=zT(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),an((0,Ee.Z)(n),"shaderModuleService",Z1,(0,Ee.Z)(n)),(0,B.Z)((0,Ee.Z)(n),"haltonSequence",[]),(0,B.Z)((0,Ee.Z)(n),"accumulatingId",0),(0,B.Z)((0,Ee.Z)(n),"frame",0),(0,B.Z)((0,Ee.Z)(n),"timer",void 0),(0,B.Z)((0,Ee.Z)(n),"sampleRenderTarget",void 0),(0,B.Z)((0,Ee.Z)(n),"prevRenderTarget",void 0),(0,B.Z)((0,Ee.Z)(n),"outputRenderTarget",void 0),(0,B.Z)((0,Ee.Z)(n),"copyRenderTarget",void 0),(0,B.Z)((0,Ee.Z)(n),"blendModel",void 0),(0,B.Z)((0,Ee.Z)(n),"outputModel",void 0),(0,B.Z)((0,Ee.Z)(n),"copyModel",void 0),n}return(0,Y.Z)(r,[{key:"getType",value:function(){return nv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){(0,Ea.Z)((0,le.Z)(r.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,f=s.createTexture2D;this.sampleRenderTarget=l({color:f({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:f({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:f({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:f({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})});for(var d=0;d<30;d++)this.haltonSequence.push([j1(d,2),j1(d,3)]);this.blendModel=this.createTriangleModel("blend-pass",VT),this.outputModel=this.createTriangleModel("copy-pass",V1,{blend:{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:W.ONE,dstAlpha:W.ONE_MINUS_SRC_ALPHA},equation:{rgb:W.FUNC_ADD,alpha:W.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",V1)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),b=_.width,A=_.height;this.sampleRenderTarget.resize({width:b,height:A}),this.prevRenderTarget.resize({width:b,height:A}),this.outputRenderTarget.resize({width:b,height:A}),this.copyRenderTarget.resize({width:b,height:A}),this.resetFrame(),this.stopAccumulating();var w=i.multiPassRenderer.getPostProcessor().getReadFBO();d(w,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:w}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function P(L){!a.accumulatingId||L!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){P(L)}))};this.accumulatingId=HT++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,_=f(),b=_.width,A=_.height,w=i.getLayerConfig(),I=w.jitterScale,P=I===void 0?1:I,L=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((L[0]*2-1)/b*P,(L[1]*2-1)/A*P),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),d(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var Z=i.getLayerConfig();d(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:Z.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(d(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),d(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var Q=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Q,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:jT,fs:a});var l=this.shaderModuleService.getModule(i),f=l.vs,d=l.fs,_=l.uniforms,b=this.rendererService,A=b.createAttribute,w=b.createBuffer,I=b.createModel;return I((0,F.Z)({vs:f,fs:d,attributes:{a_Position:A({buffer:w({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:(0,F.Z)({},_),depth:{enable:!1},count:3},s))}}]),r}(Ig),Z1=jr(q0.prototype,"shaderModuleService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q0))||z1),gm=new ot.W2;gm.bind(pt.IGlobalConfigService).to(pn).inSingletonScope(),(0,ot.GW)((0,ot.b2)(),ka.EventEmitter),gm.bind(pt.IEventEmitter).to(ka.EventEmitter);var H1=(0,jn.Z)(gm,!1),K0=function(t){var r=H1.lazyInject(t);return function(n,i,a){r.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},b6=function(t){var r=H1.lazyMultiInject(t);return function(n,i,a){r.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},kl=gm,GT=0;function XT(){var e=new ot.W2;return e.parent=gm,e.bind(pt.SceneID).toConstantValue("".concat(GT++)),e.bind(pt.IShaderModuleService).to(MA).inSingletonScope(),e.bind(pt.ILayerService).to(Ag).inSingletonScope(),e.bind(pt.IDebugService).to(vp).inSingletonScope(),e.bind(pt.ISceneService).to(mA).inSingletonScope(),e.bind(pt.ICameraService).to(c).inSingletonScope(),e.bind(pt.ICoordinateSystemService).to(Wd).inSingletonScope(),e.bind(pt.IInteractionService).to(L0).inSingletonScope(),e.bind(pt.IPickingService).to(xg).inSingletonScope(),e.bind(pt.IControlService).to(H).inSingletonScope(),e.bind(pt.IMarkerService).to(he).inSingletonScope(),e.bind(pt.IIconService).to(we).inSingletonScope(),e.bind(pt.IFontService).to(We).inSingletonScope(),e.bind(pt.IPopupService).to(at).inSingletonScope(),e.bind(pt.INormalPass).to(OA).whenTargetNamed("clear"),e.bind(pt.INormalPass).to(NA).whenTargetNamed("pixelPicking"),e.bind(pt.INormalPass).to(UT).whenTargetNamed("render"),e.bind(pt.INormalPass).to(WT).whenTargetNamed("taa"),e.bind(pt.IFactoryNormalPass).toFactory(function(t){return function(r){return t.container.getNamed(pt.INormalPass,r)}}),e.bind(pt.IPostProcessingPass).to(vT).whenTargetNamed("copy"),e.bind(pt.IPostProcessingPass).to(XA).whenTargetNamed("bloom"),e.bind(pt.IPostProcessingPass).to(JA).whenTargetNamed("blurH"),e.bind(pt.IPostProcessingPass).to(aT).whenTargetNamed("blurV"),e.bind(pt.IPostProcessingPass).to(IT).whenTargetNamed("noise"),e.bind(pt.IPostProcessingPass).to(kT).whenTargetNamed("sepia"),e.bind(pt.IPostProcessingPass).to(cT).whenTargetNamed("colorHalftone"),e.bind(pt.IPostProcessingPass).to(xT).whenTargetNamed("hexagonalPixelate"),e.bind(pt.IPostProcessingPass).to(TT).whenTargetNamed("ink"),e.bind(pt.IFactoryPostProcessingPass).toFactory(function(t){return function(r){var n=t.container.getNamed(pt.IPostProcessingPass,r);return n.setName(r),n}}),e}function _m(e){var t=new ot.W2;return t.parent=e,t.bind(pt.IStyleAttributeService).to(wg).inSingletonScope(),t.bind(pt.IMultiPassRenderer).to(kA).inSingletonScope(),t.bind(pt.IPostProcessor).to(BT).inSingletonScope(),t}var $T=null;function E6(e){return $T.indexOf(e)}var W1=di.clamp,YT=2,S6=4,qT=64,A6=128,KT=256,QT=512,T6=8192,w6=16384,C6=32768,JT=null,G1=131072,R6=262144,ew=524288,M6=1048576,tw=2097152,I6=4194304,rw=8388608,nw=16777216,iw=null;function Pg(e,t){return e=W1(Math.floor(e),0,255),t=W1(Math.floor(t),0,255),256*e+t}function P6(e){var t=e.color,r=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,f=e.strokeWidth,d=e.strokeOpacity,_=[],b=[],A=[],w=[Pg(t[0],t[1]),Pg(t[2],t[3])],I=[Pg(l[0],l[1]),Pg(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(P){var L=_slicedToArray(P,2),Z=L[0],Q=L[1];_.push([].concat(w,[(Z+1)*rw+(Q+1)*tw+getShapeIndex(a)*G1+r,(n+512)*ew+(i+512)*qT])),b.push([].concat(I,[f,d])),A.push([s,0,0,0])}),{packedBuffer:_,packedBuffer2:b,packedBuffer3:A}}function O6(e,t){if(e===0&&!t)return 0;if(e===1&&t)return 4294967295;var r=t?1:0,n=Math.floor(e*127);return n*iw+r*nw+n*G1+r*JT+n*QT+r*KT+n*YT+r}var dd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Es={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Ya=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),av=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),dn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),aw=["mapload","mapchange","mapAfterFrameChange"],Og=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Cu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),ow=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f,d){n({x:r.x,y:r.y,z:r.z},function(_,b){if(_||b.length===0){d(_);return}b&&Vn([{data:b,bands:[0]}],i,a,function(A,w){A?d(A):w&&f(w)})})}));case 1:case"end":return l.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}(),sw=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:r.x,y:r.y,z:r.z},function(f,d){if(f||!d){l(f);return}d instanceof ArrayBuffer?va(d,function(_,b){_&&l(_),s(b)}):d instanceof HTMLImageElement?s(d):l(f)})}));case 1:case"end":return a.stop()}},t)}));return function(r,n){return e.apply(this,arguments)}}();function uw(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return v(r,t)}):e.map(function(r){return{url:v(r.url,t),bands:r.bands||[0]}}):v(e,t)}function lw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(t){return{url:t,bands:[0]}}):e}function X1(e,t){e.xhrCancel=function(){t.map(function(r){r.abort()})}}var cw=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a,s){var l,f,d,_,b,A;return ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=lw(n.url),!(l.length>1)){I.next=15;break}return I.next=4,fw(l,n);case 4:if(f=I.sent,d=f.rasterFiles,_=f.xhrList,b=f.errList,X1(r,_),!(b.length>0)){I.next=12;break}return i(b,null),I.abrupt("return");case 12:Vn(d,a,s,i),I.next=17;break;case 15:A=go(n,function(P,L){if(P)i(P);else if(L){var Z=[{data:L,bands:l[0].bands}];Vn(Z,a,s,i)}}),X1(r,[A]);case 17:case"end":return I.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}();function fw(e,t){return Q0.apply(this,arguments)}function Q0(){return Q0=(0,Ot.Z)(ve().mark(function e(t,r){var n,i,a,s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<t.length)){P.next=20;break}return l=t[s],f=(0,F.Z)((0,F.Z)({},r),{},{url:l.url}),d=l.bands,P.next=10,_i((0,F.Z)((0,F.Z)({},f),{},{type:"arrayBuffer"}));case 10:_=P.sent,b=_.err,A=_.data,w=_.xhr,b&&a.push(b),i.push(w),n.push({data:A,bands:d});case 17:s++,P.next=4;break;case 20:return P.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return P.stop()}},e)})),Q0.apply(this,arguments)}var hw=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a,s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l={url:uw(r,n)},d.abrupt("return",new Promise(function(_,b){cw(i,l,function(A,w){A?b(A):w&&_(w)},a,s)}));case 2:case"end":return d.stop()}},t)}));return function(r,n,i,a,s){return e.apply(this,arguments)}}(),$1=function(){var e=(0,Ot.Z)(ve().mark(function t(r,n,i,a){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return l=Array.isArray(r)?r[0]:r,a.wmtsOptions?(f=(a==null?void 0:a.getURLFromTemplate)||p,s=f(l,(0,F.Z)((0,F.Z)({},n),a.wmtsOptions))):(d=(a==null?void 0:a.getURLFromTemplate)||v,s=d(l,n)),b.abrupt("return",new Promise(function(A,w){var I,P=Vs({url:s,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(L,Z){L?w(L):Z&&A(Z)},a.transformResponse);i.xhrCancel=function(){return P.cancel()}}));case 3:case"end":return b.stop()}},t)}));return function(r,n,i,a){return e.apply(this,arguments)}}(),Y1=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},pw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},D6=[Cu.ARRAYBUFFER,Cu.RGB];function dw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function vw(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(dw(e))throw new Error("tile server url is error");var r=(t==null?void 0:t.dataType)||Cu.IMAGE;r===Cu.RGB&&(r=Cu.ARRAYBUFFER);var n=function(s,l){switch(r){case Cu.IMAGE:return $1(e,s,l,t);case Cu.CUSTOMIMAGE:case Cu.CUSTOMTERRAINRGB:return sw(l,t==null?void 0:t.getCustomData);case Cu.ARRAYBUFFER:return hw(e,s,l,(t==null?void 0:t.format)||Y1,t==null?void 0:t.operation);case Cu.CUSTOMARRAYBUFFER:case Cu.CUSTOMRGB:return ow(l,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||Y1,t==null?void 0:t.operation);default:return $1(e,s,l,t)}},i=(0,F.Z)((0,F.Z)((0,F.Z)({},pw),t),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var mw=["extent","min","max","width","height","format","operation"];function gw(e,t){var r=t.extent,n=t.min,i=t.max,a=t.width,s=t.height,l=t.format,f=t.operation,d=(0,Fl.Z)(t,mw),_;if(l===void 0||Ol(e))_=Array.from(e);else{var b=Array.isArray(e)?e:[e];_=Cr(b,l,f)}var A={_id:1,dataArray:[(0,F.Z)((0,F.Z)({_id:1,data:_,width:a,height:s},d),{},{min:n,max:i,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return A}var _w={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},yw=function(){var e=(0,Ot.Z)(ve().mark(function t(r){return ve().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,K.Z)(r.bounds,4),l=s[0],f=s[1],d=s[2],_=s[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(l+d)/2,y:(f+_)/2},geometry:{type:"LineString",coordinates:[[d,_],[d,f],[l,f],[l,f]]}}]}}};a(b)}));case 1:case"end":return i.stop()}},t)}));return function(r){return e.apply(this,arguments)}}();function xw(e,t){var r=function(a){return yw(a)},n=(0,F.Z)((0,F.Z)((0,F.Z)({},_w),t),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var bw=N(69848),q1=N.n(bw);function K1(e,t){var r=t.radius,n=r===void 0?40:r,i=t.maxZoom,a=i===void 0?18:i,s=t.minZoom,l=s===void 0?0:s,f=t.zoom,d=f===void 0?2:f;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(d));return e.dataArray=Ew(_),e}var b=new(q1())({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(w){return{type:"Feature",geometry:{type:"Point",coordinates:w.coordinates},properties:(0,F.Z)({},w)}}),b.load(A.features),b}function Ew(e){return e.map(function(t,r){return(0,F.Z)({coordinates:t.geometry.coordinates,_id:r+1},t.properties)})}function Sw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function Aw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function Q1(e){if(e.length===0)return 0;for(var t=e[0],r=0,n,i=1;i<e.length;i++)n=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?r+=t-n+e[i]:r+=e[i]-n+t,t=n;return t+r*1}function Tw(e){if(e.length===0)throw new Error("mean requires at least one data point");return Q1(e)/e.length}var ww={min:Aw,max:Sw,mean:Tw,sum:Q1};function Cw(e){var t=Rw();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mw=di.cloneDeep,J1=di.isFunction,Iw=di.isString,Pw=di.mergeWith;function Ow(e,t){if(Array.isArray(t))return t}var Dw=function(e){(0,tt.Z)(r,e);var t=Cw(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,B.Z)((0,Ee.Z)(a),"type","source"),(0,B.Z)((0,Ee.Z)(a),"isTile",!1),(0,B.Z)((0,Ee.Z)(a),"inited",!1),(0,B.Z)((0,Ee.Z)(a),"hooks",{init:new Yf}),(0,B.Z)((0,Ee.Z)(a),"parser",{type:"geojson"}),(0,B.Z)((0,Ee.Z)(a),"transforms",[]),(0,B.Z)((0,Ee.Z)(a),"cluster",!1),(0,B.Z)((0,Ee.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,B.Z)((0,Ee.Z)(a),"invalidExtent",!1),(0,B.Z)((0,Ee.Z)(a),"dataArrayChanged",!1),(0,B.Z)((0,Ee.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,Y.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,f=l===void 0?"sum":l,d=s.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(b){b.id||(b.properties.point_count=1)}),(d||J1(f))&&(_=_.map(function(b){var A=b.id;if(A){var w=a.clusterIndex.getLeaves(A,Infinity),I=w.map(function(Z){return Z.properties}),P;if(Iw(f)&&d){var L=wc(I,d);P=ww[f](L)}J1(f)&&(P=f(I)),b.properties.stat=P}else b.properties.point_count=1;return b})),this.data=te("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,f=a.geometry;if(l==="geojson"&&!this.cluster){var d=i<this.originData.features.length?this.originData.features[i]:"null",_=Mw(d);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var b=this.data.dataArray.find(function(A){return A._id===i});_.properties=b}return _}else return l==="json"&&f?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,F.Z)((0,F.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s=this;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(d,_){try{s.excuteParser(),s.initCluster(),s.executeTrans(),d({})}catch(b){_(b)}}));case 1:case"end":return f.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=Pw(this.cfg,i,Ow);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,F.Z)((0,F.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=te(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Uu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new kf((0,F.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,f=re(l)(i.data,s);Object.assign(i.data,f)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=K1(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=ou(Wl(this.extent),i)),a[0].concat(a[1])}}]),r}(ka.EventEmitter);function Fw(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function ex(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kw(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function kw(e,t){if(!!e){if(typeof e=="string")return tx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tx(e,t)}}function tx(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var J0=6378e3;function Bw(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,a=i/(2*Math.PI*J0)*(256<<20)/2,s=Lw(r,i),l=s.gridHash,f=s.gridOffset,d=Zw(l,f,t);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:d}}function Lw(e,t){var r=Infinity,n=-Infinity,i,a=ex(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(r=i<r?i:r,n=i>n?i:n)}}catch(oe){a.e(oe)}finally{a.f()}var f=(r+n)/2,d=Nw(t,f);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};var _={},b=ex(e),A;try{for(b.s();!(A=b.n()).done;){var w=A.value,I=w.coordinates[1],P=w.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(P)){var L=Math.floor((I+90)/d.yOffset),Z=Math.floor((P+180)/d.xOffset),Q="".concat(L,"-").concat(Z);_[Q]=_[Q]||{count:0,points:[]},_[Q].count+=1,_[Q].points.push(w)}}}catch(oe){b.e(oe)}finally{b.f()}return{gridHash:_,gridOffset:d}}function Nw(e,t){var r=Uw(e),n=zw(t,e);return{yOffset:r,xOffset:n}}function Uw(e){return e/J0*(180/Math.PI)}function zw(e,t){return t/J0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Zw(e,t,r){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),f=parseInt(s[1],10),d={};if(r.field&&r.method){var _=Qc(e[i].points,r.field);d[r.method]=xc[r.method](_)}return Object.assign(d,{_id:a,coordinates:so([-180+t.xOffset*(f+.5),-90+t.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(d),n},[])}var ov=Math.PI/3,Vw=[0,ov,2*ov,3*ov,4*ov,5*ov];function jw(e){return e[0]}function Hw(e){return e[1]}function Ww(){var e=0,t=0,r=1,n=1,i=jw,a=Hw,s,l,f;function d(b){var A={},w=[],I,P=b.length;for(I=0;I<P;++I)if(!(isNaN(Z=+i.call(null,L=b[I],I,b))||isNaN(Q=+a.call(null,L,I,b)))){var L,Z,Q,oe=Math.round(Q=Q/f),Ae=Math.round(Z=Z/l-(oe&1)/2),Oe=Q-oe;if(Math.abs(Oe)*3>1){var Ve=Z-Ae,rt=Ae+(Z<Ae?-1:1)/2,_t=oe+(Q<oe?-1:1),Bt=Z-rt,ur=Q-_t;Ve*Ve+Oe*Oe>Bt*Bt+ur*ur&&(Ae=rt+(oe&1?1:-1)/2,oe=_t)}var lr=Ae+"-"+oe,zr=A[lr];zr?zr.push(L):(w.push(zr=A[lr]=[L]),zr.x=(Ae+(oe&1)/2)*l,zr.y=oe*f)}return w}function _(b){var A=0,w=0;return Vw.map(function(I){var P=Math.sin(I)*b,L=-Math.cos(I)*b,Z=P-A,Q=L-w;return A=P,w=L,[Z,Q]})}return d.hexagon=function(b){return"m"+_(b==null?s:+b).join("l")+"z"},d.centers=function(){for(var b=[],A=Math.round(t/f),w=Math.round(e/l),I=A*f;I<n+s;I+=f,++A)for(var P=w*l+(A&1)*l/2;P<r+l/2;P+=l)b.push([P,I]);return b},d.mesh=function(){var b=_(s).slice(0,4).join("l");return d.centers().map(function(A){return"M"+A+"m"+b}).join("")},d.x=function(b){return arguments.length?(i=b,d):i},d.y=function(b){return arguments.length?(a=b,d):a},d.radius=function(b){return arguments.length?(s=+b,l=s*2*Math.sin(ov),f=s*1.5,d):s},d.size=function(b){return arguments.length?(e=t=0,r=+b[0],n=+b[1],d):[r-e,n-t]},d.extent=function(b){return arguments.length?(e=+b[0][0],t=+b[0][1],r=+b[1][0],n=+b[1][1],d):[[e,t],[r,n]]},d.radius(1)}var Gw=6378e3;function Xw(e,t){var r=e.dataArray,n=t.size,i=n===void 0?10:n,a=t.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*Gw)*(256<<20)/2,f=r.map(function(A){var w=so(A.coordinates),I=(0,K.Z)(w,2),P=I[0],L=I[1];return(0,F.Z)((0,F.Z)({},A),{},{coordinates:[P,L]})}),d=Ww().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),_=d(f),b={dataArray:_.map(function(A,w){var I;if(t.field&&s){var P=Qc(A,t.field);A[s]=xc[s](P)}return I={},(0,B.Z)(I,t.method,A[s]),(0,B.Z)(I,"count",A.length),(0,B.Z)(I,"rawData",A),(0,B.Z)(I,"coordinates",[A.x,A.y]),(0,B.Z)(I,"_id",w),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function $w(e,t){var r=t.sourceField,n=t.targetField,i=t.data,a={};return i.forEach(function(s){a[s[r]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,F.Z)((0,F.Z)({},s),a[l])}),e}function Yw(e,t){var r=t.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Pe("rasterTile",vw),Pe("mvt",Xr),Pe("geojsonvt",Se),Pe("testTile",xw),Pe("geojson",Zp),Pe("jsonTile",Xt),Pe("image",He),Pe("csv",Od),Pe("json",Cc),Pe("raster",Qr),Pe("rasterRgb",gw),Ze("cluster",K1),Ze("filter",Fw),Ze("join",$w),Ze("map",Yw),Ze("grid",Bw),Ze("hexagon",Xw);var rx=Dw;function qw(e){var t=Kw();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nx=function(e){(0,tt.Z)(r,e);var t=qw(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),(0,B.Z)((0,Ee.Z)(i),"added",!1),(0,B.Z)((0,Ee.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,F.Z)((0,F.Z)({},i.getDefault()),n),Ef(["update","onMove","onMapClick"],(0,Ee.Z)(i)),i.init(),i}return(0,Y.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ra.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(pt.IMapService),this.sceneSerive=i.get(pt.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ws(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&Ws(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),mu(a,"".concat(Yu[s]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,f=l.lng,d=l.lat,_=this.mapsService.lngLatToContainer([f,d]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=b.containerHeight,w=b.containerWidth,I=b.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>w){var P=this.mapsService.lngLatToContainer([f-360,d]);_.x=P.x}if(_.x<0){var L=this.mapsService.lngLatToContainer([f+360,d]);_.x=L.x}}(_.x>w||_.x<0||_.y>A||_.y<0)&&(a.style.display="none"),a.style.left=_.x+s[0]+"px",a.style.top=_.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,f=s.anchor;if(!a){this.defaultMarker=!0,a=Fn("div"),this.markerOption.element=a;var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height","48px"),d.setAttributeNS(null,"width","48px"),d.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),d.appendChild(_),a.appendChild(d)}Ms(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var A,w,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((w=i.markerOption)===null||w===void 0?void 0:w.style[b]);a&&(a.style[b]=I)}),nu(a,f,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Vl()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),r}(ka.EventEmitter);function Qw(e){var t=Jw();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e3=di.merge,F6=function(e){(0,tt.Z)(r,e);var t=Qw(r);function r(n){var i,a;return(0,ye.Z)(this,r),a=t.call(this),(0,B.Z)((0,Ee.Z)(a),"markers",[]),(0,B.Z)((0,Ee.Z)(a),"points",[]),(0,B.Z)((0,Ee.Z)(a),"clusterMarkers",[]),a.markerLayerOption=e3(a.getDefault(),n),Ef(["update"],(0,Ee.Z)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return(0,Y.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(pt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var i=this.mapsService.getContainer();this.containerSize={containerWidth:(i==null?void 0:i.scrollWidth)||0,containerHeight:(i==null?void 0:i.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;if(i.getMarkerLayerContainerSize=this.getContainerSize.bind(this),a&&(this.addPoint(i,this.markers.length),this.mapsService)){var s=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=ou(l,.5),this.zoom=Math.floor(s),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&(this.markers.splice(a,1),this.markerLayerOption.cluster&&(this.removePoint(a),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(i,a){var s=i.getLnglat(),l=s.lng,f=s.lat,d={geometry:{type:"Point",coordinates:[l,f]},properties:(0,F.Z)((0,F.Z)({},i.getExtData()),{},{marker_id:a})};this.points.push(d),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(i){var a=this.points.findIndex(function(s){return s.properties.marker_id===i});a>-1&&this.points.splice(a,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,s=i.minZoom,l=s===void 0?0:s,f=i.maxZoom;this.clusterIndex=new(q1())({radius:a,minZoom:l,maxZoom:f}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var s=this,l=i[0].concat(i[1]),f=this.clusterIndex.getClusters(l,a);this.clusterMarkers.forEach(function(d){d.remove()}),this.clusterMarkers=[],f.forEach(function(d){var _,b=s.markerLayerOption.clusterOption,A=b.field,w=b.method;if((_=d.properties)!==null&&_!==void 0&&_.cluster_id){var I,P=s.getLeaves((I=d.properties)===null||I===void 0?void 0:I.cluster_id);if(d.properties.clusterData=P,A&&w){var L=P==null?void 0:P.map(function(Oe){var Ve=(0,B.Z)({},A,Oe.properties[A]);return Ve}),Z=Qc(L,A),Q=Fs(w,Z),oe="point_"+w;d.properties[oe]=Q.toFixed(2)}}var Ae=s.clusterMarker(d);s.clusterMarkers.push(Ae),Ae.addTo(s.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,s):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,s=a,l=s.element,f=l===void 0?this.generateElement.bind(this):l,d=new nx({element:f(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return d}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!fa(this.bbox,a))&&(this.bbox=ou(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(i){var a=Fn("div","l7-marker-cluster"),s=Fn("div","",a),l=Fn("span","",s),f=this.markerLayerOption.clusterOption,d=f.field,_=f.method;i.properties.point_count=i.properties.point_count||1;var b=d&&_?i.properties["point_"+_]||i.properties[d]:i.properties.point_count;return l.textContent=b,a}}]),r}(ka.EventEmitter),k6=N(4157);function t3(e){var t=r3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function r3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sv=function(e){(0,tt.Z)(r,e);var t=t3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this),r.controlCount++,i.controlOption=(0,F.Z)((0,F.Z)({},i.getDefault(n)),n||{}),i}return(0,Y.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,K.Z)(s,2),f=l[0],d=l[1];d===void 0&&(i[f]=a[f])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,F.Z)((0,F.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(pt.IMapService),this.renderService=i.get(pt.IRendererService),this.layerService=i.get(pt.ILayerService),this.controlService=i.get(pt.IControlService),this.configService=i.get(pt.IGlobalConfigService),this.scene=i.get(pt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),Ms(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ws(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Fn("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;Ju(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;Ms(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:m.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:m.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&Ju(a,s),i&&Ms(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),r}(ks());(0,B.Z)(sv,"controlCount",0);function n3(e){var t=i3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dg=function(e){(0,tt.Z)(r,e);var t=n3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"isDisable",!1),n}return(0,Y.Z)(r,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Fn("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Ws(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var f;(f=this.button)===null||f===void 0||f.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(!!this.button)if(Ju(this.button,"l7-button-control--row"),Ju(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=Fn("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,Ms(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Ws(this.buttonText),this.buttonText=void 0)}}]),r}(sv);function a3(e){var t=o3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ix=function(e){(0,tt.Z)(r,e);var t=a3(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,B.Z)((0,Ee.Z)(a),"isShow",!1),(0,B.Z)((0,Ee.Z)(a),"timeout",null),(0,B.Z)((0,Ee.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),Ju(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&r.conflictPopperList.forEach(function(s){s!==(0,Ee.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,Ee.Z)(a)}),(0,B.Z)((0,Ee.Z)(a),"hide",function(){return a.isShow&&(Ms(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,Ee.Z)(a)}),(0,B.Z)((0,Ee.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){!a.isShow||(a.hide(),a.timeout=null)},300))}),(0,B.Z)((0,Ee.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,B.Z)((0,Ee.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,B.Z)((0,Ee.Z)(a),"onPopperUnClick",function(s){jc(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,B.Z)((0,Ee.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,B.Z)((0,Ee.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&r.conflictPopperList.push((0,Ee.Z)(a)),a}return(0,Y.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(wl(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ws(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,f=l===void 0?[0,0]:l,d=a.placement,_=(0,K.Z)(f,2),b=_[0],A=_[1],w=this.button.getBoundingClientRect(),I=s.getBoundingClientRect(),P=Vc(w,I),L=P.left,Z=P.right,Q=P.top,oe=P.bottom,Ae=!1,Oe=!1;/^(left|right)/.test(d)?(d.includes("left")?i.right="".concat(w.width+Z,"px"):d.includes("right")&&(i.left="".concat(w.width+L,"px")),d.includes("start")?i.top="".concat(Q,"px"):d.includes("end")?i.bottom="".concat(oe,"px"):(i.top="".concat(Q+w.height/2,"px"),Oe=!0,i.transform="translate(".concat(b,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(d)&&(d.includes("top")?i.bottom="".concat(w.height+oe,"px"):d.includes("bottom")&&(i.top="".concat(w.height+Q,"px")),d.includes("start")?i.left="".concat(L,"px"):d.includes("end")?i.right="".concat(Z,"px"):(i.left="".concat(L+w.width/2,"px"),Ae=!0,i.transform="translate(calc(".concat(b,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(b,"px - ").concat(Ae?"50%":"0%","), calc(").concat(A,"px - ").concat(Oe?"50%":"0%",")");var Ve=d.split("-");Ve.length&&Ms(this.popperDOM,Ve.map(function(rt){return"l7-popper-".concat(rt)}).join(" ")),pc(this.popperDOM,sh(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,f=i.content,d=Fn("div","l7-popper l7-popper-hide ".concat(l)),_=Fn("div","l7-popper-content"),b=Fn("div","l7-popper-arrow");return d.appendChild(_),d.appendChild(b),a.appendChild(d),this.popperDOM=d,this.contentDOM=_,f&&this.setContent(f),d}}]),r}(ka.EventEmitter);(0,B.Z)(ix,"conflictPopperList",[]);function s3(e){var t=u3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function u3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l3={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},c3=function(e){(0,tt.Z)(r,e);var t=s3(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,Ea.Z)((0,le.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":l3[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,f=a.popperTrigger,d=this.mapsService.getMapContainer();return this.popper=new ix(this.button,{className:s,placement:l,trigger:f,container:d,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if((0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),r}(Dg);function f3(e){var t=h3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function h3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Sp||{}),ax=function(e){(0,tt.Z)(r,e);var t=f3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"selectValue",[]),(0,B.Z)((0,Ee.Z)(n),"createNormalOption",function(l){var f=n.selectValue.includes(l.value),d=Fn("div","l7-select-control-item ".concat(f?Sp.ActiveOptionClassName:""));n.getIsMultiple()&&d.appendChild(n.createCheckbox(f)),l.icon&&d.appendChild(l.icon);var _=Fn("span");return _.innerText=l.text,d.appendChild(_),d}),(0,B.Z)((0,Ee.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var f=n.selectValue.findIndex(function(d){return d===l.value});f>-1?n.selectValue.splice(f,1):n.selectValue=[].concat((0,Wt.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,Y.Z)(r,[{key:"setOptions",value:function(i){(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(i);this.optionDOMList.forEach(function(f){var d=f.getAttribute(Sp.OptionValueAttrKey),_=a.getIsMultiple()?f.querySelector("input[type=checkbox]"):void 0;l.includes(d)?(Ms(f,Sp.ActiveOptionClassName),_&&ca(_,!0)):(Ju(f,Sp.ActiveOptionClassName),_&&ca(_,!1))}),this.selectValue=l,s&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=Fn("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Ms(l,"l7-select-control--multiple");var f=i.map(function(d,_){var b=s?a.createImageOption(d):a.createNormalOption(d);return b.setAttribute(Sp.OptionValueAttrKey,d.value),b.setAttribute(Sp.OptionIndexAttrKey,window.String(_)),b.addEventListener("click",a.onItemClick.bind(a,d)),b});return l.append.apply(l,(0,Wt.Z)(f)),this.optionDOMList=f,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=Fn("div","l7-select-control-item ".concat(a?Sp.ActiveOptionClassName:"")),l=Fn("img");l.setAttribute("src",i.img),Wh(l),s.appendChild(l);var f=Fn("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var d=Fn("span");return d.innerText=i.text,f.appendChild(d),s.appendChild(f),s}},{key:"createCheckbox",value:function(i){var a=Fn("input");return a.setAttribute("type","checkbox"),i&&ca(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),r}(c3),Dh=function(t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),r.appendChild(n),r};function p3(e){var t=v3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m3=function(e){(0,tt.Z)(r,e);var t=p3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"onClick",(0,Ot.Z)(ve().mark(function l(){var f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=n.controlOption.onExport,_.t0=f==null,_.t0){_.next=8;break}return _.t1=f,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),(0,B.Z)((0,Ee.Z)(n),"mergeImage",(0,Ot.Z)(ve().mark(function l(){var f,d,_,b,A,w,I,P,L,Z,Q,oe,Ae,Oe,Ve=arguments;return ve().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:for(_=n.controlOption.imageType,b=(f=(d=n.mapsService.getContainer())===null||d===void 0?void 0:d.getBoundingClientRect())!==null&&f!==void 0?f:{},A=b.width,w=A===void 0?0:A,I=b.height,P=I===void 0?0:I,L=document.createElement("canvas"),L.width=w,L.height=P,Z=L.getContext("2d"),Q=Ve.length,oe=new Array(Q),Ae=0;Ae<Q;Ae++)oe[Ae]=Ve[Ae];return _t.next=9,Promise.all(oe.map(function(Bt){return new Promise(function(ur){var lr=new Image;lr.onload=function(){ur(lr)},lr.src=Bt})}));case 9:return Oe=_t.sent,Oe.forEach(function(Bt){Z==null||Z.drawImage(Bt,0,0,w,P)}),_t.abrupt("return",L.toDataURL("image/".concat(_)));case 12:case"end":return _t.stop()}},l)}))),n}return(0,Y.Z)(r,[{key:"onAdd",value:function(){var i=(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Dh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.mapsService.exportMap("png");case 2:return s=d.sent,d.next=5,this.scene.exportPng("png");case 5:return l=d.sent,d.abrupt("return",this.mergeImage.apply(this,(0,Wt.Z)([s,l].filter(function(_){return _}))));case 7:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Dg);function g3(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_3(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function _3(e,t){if(!!e){if(typeof e=="string")return ox(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ox(e,t)}}function ox(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var sx=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Fh=function(){if(typeof document=="undefined")return!1;for(var e=sx[0],t={},r=0,n=sx;r<n.length;r++){var i=n[r],a=i==null?void 0:i[1];if(a in document){var s=g3(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var f=(0,K.Z)(l.value,2),d=f[0],_=f[1];t[e[d]]=_}}catch(b){s.e(b)}finally{s.f()}return t}}return!1}(),ux={change:Fh.fullscreenchange,error:Fh.fullscreenerror},ic={request:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){ic.off("change",l),n()};ic.on("change",a);var s=t[Fh.requestFullscreen](r);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(t,r){if(!ic.isFullscreen){t();return}var n=function a(){ic.off("change",a),t()};ic.on("change",n);var i=document[Fh.exitFullscreen]();i instanceof Promise&&i.then(n).catch(r)})},toggle:function(t,r){return ic.isFullscreen?ic.exit():ic.request(t,r)},onchange:function(t){ic.on("change",t)},onerror:function(t){ic.on("error",t)},on:function(t,r){var n=ux[t];n&&document.addEventListener(n,r,!1)},off:function(t,r){var n=ux[t];n&&document.removeEventListener(n,r,!1)},raw:Fh};Object.defineProperties(ic,{isFullscreen:{get:function(){return Boolean(document[Fh.fullscreenElement])}},element:{enumerable:!0,get:function(){var t;return(t=document[Fh.fullscreenElement])!==null&&t!==void 0?t:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[Fh.fullscreenEnabled])}}}),Fh||(ic={isEnabled:!1});var e_=ic;function y3(e){var t=x3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function x3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b3=function(e){(0,tt.Z)(r,e);var t=y3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this,n),(0,B.Z)((0,Ee.Z)(i),"isFullscreen",!1),(0,B.Z)((0,Ee.Z)(i),"toggleFullscreen",(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!e_.isEnabled){l.next=3;break}return l.next=3,e_.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,B.Z)((0,Ee.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,B.Z)((0,Ee.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,f=a.title,d=a.exitBtnText,_=a.exitBtnIcon,b=a.exitTitle;i.isFullscreen?(i.setBtnTitle(b),i.setBtnText(d),i.setBtnIcon(_)):(i.setBtnTitle(f),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),e_.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,Y.Z)(r,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Lu(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){(0,Ea.Z)((0,le.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Dh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Dh("l7-icon-exit-fullscreen")})}}]),r}(Dg);function E3(e){var t=S3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=function(e){(0,tt.Z)(r,e);var t=E3(r);function r(n){var i;return(0,ye.Z)(this,r),i=t.call(this,n),(0,B.Z)((0,Ee.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var f=l.coords,d=f!=null?f:{},_=d.longitude,b=d.latitude;!isNaN(_)&&!isNaN(b)?a([_,b]):s()},function(l){s(l)})})}),(0,B.Z)((0,Ee.Z)(i),"onClick",(0,Ot.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return s=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,f=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=f>15?f:15,!s){_.next=15;break}return _.next=12,s(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,Y.Z)(r,[{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Dh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),r}(Dg);function T3(e){var t=w3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function w3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function lx(e){return Object.keys(e!=null?e:{}).every(function(t){return["layer","name","img"].includes(t)})}var cx=function(e){(0,tt.Z)(r,e);var t=T3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,B.Z)((0,Ee.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,B.Z)((0,Ee.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var f=n.selectValue.includes(l.name),d=l.isVisible();f&&!d&&l.show(),!f&&d&&l.hide()})}),n}return(0,Y.Z)(r,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(lx(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var f=i.getLayer(l)||i.getLayerByName(l);f&&s.push(f)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Dh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(lx(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var f=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:f==null?void 0:f.name,value:f==null?void 0:f.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers"]);(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i),a&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(ax);function C3(e){var t=R3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function R3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fx=function(e){(0,tt.Z)(r,e);var t=C3(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getDefault",value:function(){return{position:m.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=Fn("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(wl(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,f=Fn("img");if(f.setAttribute("src",l),f.setAttribute("aria-label","AntV logo"),Wh(f),s){var d=Fn("a","l7-control-logo-link");d.target="_blank",d.href=s,d.rel="noopener nofollow",d.setAttribute("rel","noopener nofollow"),d.appendChild(f),i.appendChild(d)}else i.appendChild(f)}}]),r}(sv),M3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},I3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function P3(e){var t=O3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D3=function(e){(0,tt.Z)(r,e);var t=P3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,Y.Z)(r,[{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Dh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?I3:M3;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,K.Z)(a,2),l=s[0],f=s[1];return typeof f=="string"&&l!=="blank"}).map(function(a){var s,l=(0,K.Z)(a,2),f=l[0],d=l[1],_=(s=i[f])!==null&&s!==void 0?s:{},b=_.text,A=_.img;return{text:b!=null?b:f,value:d,img:A,key:f}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,f=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(_){return _.key===f}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:f}else{var d=this.getMapStyle();d?this.controlOption.defaultValue=d:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,Ea.Z)((0,le.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(ax);function F3(e){var t=k3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function k3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B3=function(e){(0,tt.Z)(r,e);var t=F3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"location",[0,0]),(0,B.Z)((0,Ee.Z)(n),"onMouseMove",function(l){var f=n.location,d=l.lngLat||l.lnglat,_=n.controlOption.transform;d&&(f=[d.lng,d.lat]),n.location=f,_&&(f=_(f)),n.insertLocation2HTML(f),n.emit("locationChange",f)}),n}return(0,Y.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{position:m.BOTTOMLEFT,transform:function(s){var l=(0,K.Z)(s,2),f=l[0],d=l[1];return[+(+f).toFixed(6),+(+d).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=Fn("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),r}(sv);function L3(e){var t=N3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function N3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U3=function(e){(0,tt.Z)(r,e);var t=L3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"update",function(){var l=n.mapsService,f=n.controlOption.maxWidth,d=l.getSize()[1]/2,_=l.containerToLngLat([0,d]),b=l.containerToLngLat([f,d]),A=Hl([_.lng,_.lat],[b.lng,b.lat]);n.updateScales(A)}),n}return(0,Y.Z)(r,[{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:m.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=Fn("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){wl(i);var a=this.controlOption,s=a.metric,l=a.imperial,f=a.maxWidth,d=a.lockWidth;d&&pc(i,"width: ".concat(f,"px")),s&&(this.mScale=Fn("div","l7-control-scale-line",i)),l&&(this.iScale=Fn("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,f;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(f=this.getRoundNum(a),this.updateScale(this.iScale,f+" ft",f/a))}}]),r}(sv);function z3(e){var t=Z3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V3=function(e){(0,tt.Z)(r,e);var t=z3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,B.Z)((0,Ee.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,B.Z)((0,Ee.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,Y.Z)(r,[{key:"getDefault",value:function(i){return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{position:m.BOTTOMRIGHT,name:"zoom",zoomInText:Dh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Dh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=Fn("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){wl(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,f){var d=Fn("button",s,l);return typeof i=="string"?d.innerHTML=i:d.append(i),d.title=a,f&&d.addEventListener("click",f),d}}]),r}(sv);function j3(e){var t=H3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function H3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t_=function(e){(0,tt.Z)(r,e);var t=j3(r);function r(n){var i;(0,ye.Z)(this,r),i=t.call(this),(0,B.Z)((0,Ee.Z)(i),"isShow",!0),(0,B.Z)((0,Ee.Z)(i),"onMouseMove",function(s){var l,f=i.mapsService.getMapContainer(),d=(l=f==null?void 0:f.getBoundingClientRect())!==null&&l!==void 0?l:{},_=d.left,b=_===void 0?0:_,A=d.top,w=A===void 0?0:A;i.setPopupPosition(s.clientX-b,s.clientY-w)}),(0,B.Z)((0,Ee.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,f=s.lat,d=i.mapsService.lngLatToContainer([l,f]),_=d.x,b=d.y;i.setPopupPosition(_,b)}}),(0,B.Z)((0,Ee.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,B.Z)((0,Ee.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,B.Z)((0,Ee.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,f=l.className,d=l.style,_=l.maxWidth,b=l.anchor,A=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var w=i.mapsService.getMarkerContainer();if(!i.container&&w&&(i.container=Fn("div","l7-popup ".concat(f!=null?f:""," ").concat(i.isShow?"":"l7-popup-hide"),w),d&&i.container.setAttribute("style",d),i.tip=Fn("div","l7-popup-tip",i.container),i.container.appendChild(i.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(L){i.container.addEventListener(L,function(Z){Z.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),mu(i.container,"".concat(Yu[b])),nu(i.container,b,"popup"),_){var I=i.container.getBoundingClientRect(),P=I.width;P>parseFloat(_)&&(i.container.style.width=_)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,F.Z)((0,F.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,Y.Z)(r,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(pt.IMapService),this.sceneService=i.get(pt.ISceneService),this.layerService=i.get(pt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,f=a.title;return s?this.setHTML(s):l&&this.setText(l),f&&this.setTitle(f),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&Ws(this.content),this.container&&(Ws(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,F.Z)((0,F.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ws(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Ju(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Ms(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=Fn("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),wl(this.contentTitle),Ps(this.contentTitle,i)):this.contentTitle&&(Ws(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ra.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),Ps(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Ws(this.content),this.contentTitle=void 0,this.content=Fn("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Dh("l7-icon-guanbi");Ms(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=Fn("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=a-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),r}(ka.EventEmitter);function W3(e){var t=G3();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=di.get,B6=function(e){(0,tt.Z)(r,e);var t=W3(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"layerClickCountByFrame",0),(0,B.Z)((0,Ee.Z)(n),"layerConfigMap",new WeakMap),(0,B.Z)((0,Ee.Z)(n),"onLayerClick",function(l,f){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,f.featureId))n.hide();else{var d=n.getLayerInfoFrag(l,f),_=d.title,b=d.content;n.setDOMContent(b),n.setLnglat(f.lngLat),n.setTitle(_),n.displayFeatureInfo={layer:l,featureId:f.featureId},n.show()}})}),(0,B.Z)((0,Ee.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,B.Z)((0,Ee.Z)(n),"updateCloseOnClick",function(){}),n}return(0,Y.Z)(r,[{key:"layerConfigItems",get:function(){var i,a=this.popupOption,s=a.config,l=a.items;return(i=s!=null?s:l)!==null&&i!==void 0?i:[]}},{key:"addTo",value:function(i){return(0,Ea.Z)((0,le.Z)(r.prototype),"addTo",this).call(this,i),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,Ea.Z)((0,le.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(i){this.unbindLayerEvent();var a=(0,F.Z)({},i),s=a.trigger||this.popupOption.trigger,l=a.items||this.popupOption.items,f=(l==null?void 0:l.length)===0;return a.followCursor=s==="hover"&&!f,(0,Ea.Z)((0,le.Z)(r.prototype),"setOptions",this).call(this,a),this.bindLayerEvent(),f&&this.hide(),this}},{key:"getDefault",value:function(i){var a=i.trigger==="hover";return(0,F.Z)((0,F.Z)({},(0,Ea.Z)((0,le.Z)(r.prototype),"getDefault",this).call(this,i)),{},{trigger:"hover",followCursor:a,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var i=this,a=this.popupOption,s=a.trigger,l=a.closeOnClick;this.layerConfigItems.forEach(function(f){var d,_=i.getLayerByConfig(f);if(!!_){var b=(0,F.Z)({},f);if(s==="hover"){var A=i.onLayerMouseMove.bind(i,_),w=i.onLayerMouseOut.bind(i,_);b.onMouseMove=A,b.onMouseOut=w,_==null||_.on("mousemove",A),_==null||_.on("mouseout",w)}else{var I,P=i.onLayerClick.bind(i,_);b.onClick=P,_==null||_.on("click",P);var L=(I=i.mapsService)===null||I===void 0?void 0:I.getMapContainer();L&&l&&L.addEventListener("click",i.onSceneClick)}var Z=_==null||(d=_.getSource)===null||d===void 0?void 0:d.call(_),Q=i.onSourceUpdate.bind(i);Z==null||Z.on("update",Q),b.onSourceUpdate=Q,i.layerConfigMap.set(_,b)}})}},{key:"unbindLayerEvent",value:function(){var i=this;this.layerConfigItems.forEach(function(a){var s,l=i.getLayerByConfig(a),f=l&&i.layerConfigMap.get(l);if(!!f){var d=f.onMouseMove,_=f.onMouseOut,b=f.onClick,A=f.onSourceUpdate;if(d&&l.off("mousemove",d),_&&l.off("mouseout",_),b&&l.off("click",b),A){var w;l==null||(w=l.getSource())===null||w===void 0||w.off("update",A)}var I=(s=i.mapsService)===null||s===void 0?void 0:s.getMapContainer();I&&I.removeEventListener("click",i.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(i,a){if(!this.isSameFeature(i,a.featureId)){var s=this.getLayerInfoFrag(i,a),l=s.title,f=s.content;this.setDOMContent(f),this.setTitle(l),this.displayFeatureInfo={layer:i,featureId:a.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(i,a){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(i,a){var s=this.layerConfigMap.get(i),l,f=document.createDocumentFragment();if(s){var d=a.feature;d.type==="Feature"&&"properties"in d&&"geometry"in d&&(d=d.properties);var _=s.title,b=s.fields,A=s.customContent;if(_){l=document.createDocumentFragment();var w=_ instanceof Function?_(d):_;Ps(l,w)}if(A){var I=A instanceof Function?A(d):A;Ps(f,I)}else b!=null&&b.length&&(b==null||b.forEach(function(P){var L,Z,Q=typeof P=="string"?{field:P}:P,oe=Q.field,Ae=Q.formatField,Oe=Q.formatValue,Ve=Q.getValue,rt=Fn("div","l7-layer-popup__row"),_t=Ve?Ve(a.feature):X3(d,oe),Bt=(L=Ae instanceof Function?Ae(oe,d):Ae)!==null&&L!==void 0?L:oe,ur=(Z=Oe instanceof Function?Oe(_t,d):Oe)!==null&&Z!==void 0?Z:_t,lr=Fn("span","l7-layer-popup__key",rt);Ps(lr,Bt),Ps(lr,document.createTextNode("\uFF1A"));var zr=Fn("span","l7-layer-popup__value",rt);Array.isArray(ur)&&ur.every(function(un){return!(un instanceof Object)})&&(ur=ur.map(function(un){return String(un)}).join(",")),Ps(zr,ur),f.appendChild(rt)}))}return{title:l,content:f}}},{key:"getLayerByConfig",value:function(i){var a=i.layer;if(a instanceof Object)return a;if(typeof a=="string")return this.layerService.getLayer(a)||this.layerService.getLayerByName(a)}},{key:"isSameFeature",value:function(i,a){var s=this.displayFeatureInfo;return s&&i===s.layer&&a===s.featureId}}]),r}(t_);function $3(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}$3(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Ap,hx=(Ap={},(0,B.Z)(Ap,Ge.additive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:1,dstAlpha:1}}),(0,B.Z)(Ap,Ge.none,{enable:!1}),(0,B.Z)(Ap,Ge.normal,{enable:!0,func:{srcRGB:W.SRC_ALPHA,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,B.Z)(Ap,Ge.subtractive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:W.ZERO,dstAlpha:W.ONE_MINUS_SRC_COLOR},equation:{rgb:W.FUNC_SUBTRACT,alpha:W.FUNC_SUBTRACT}}),(0,B.Z)(Ap,Ge.max,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MAX_EXT}}),(0,B.Z)(Ap,Ge.min,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MIN_EXT}}),Ap);function px(e){return e.map(function(t){return typeof t=="string"&&(t=[t,{}]),t})}function dx(e,t,r,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),px(t).forEach(function(l){var f=(0,K.Z)(l,2),d=f[0],_=f[1];i.add(r(d),_)}),i.add(r("copy")),i}var Y3=function(){function e(t){(0,ye.Z)(this,e),this.layer=t}return(0,Y.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),i=n.get(pt.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(r);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var i=this.layer.getContainer(),a=i.get(pt.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),a.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,i){var a=this.layer.getContainer(),s=a.get(pt.IPickingService),l=a.get(pt.IMapService),f=this.layer.getSource().extent,d=Cl(n.lngLat,f),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},b=i||r;if(d){var A=this.readRasterValue(r,f,l,n.x,n.y);return _.rasterValue=A,s.triggerHoverOnLayer(b,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(b,(0,F.Z)((0,F.Z)({},_),{},{type:"unpick"})),s.triggerHoverOnLayer(b,_),!1}},{key:"readRasterValue",value:function(r,n,i,a,s){var l=r.getSource().data.dataArray[0],f=(0,K.Z)(n,4),d=f[0],_=d===void 0?0:d,b=f[1],A=b===void 0?0:b,w=f[2],I=w===void 0?10:w,P=f[3],L=P===void 0?-10:P,Z=i.lngLatToContainer([_,A]),Q=i.lngLatToContainer([I,L]),oe=Q.x-Z.x,Ae=Z.y-Q.y,Oe=[(a-Z.x)/oe,(s-Q.y)/Ae],Ve=l.width||1,rt=l.height||1,_t=Math.floor(Oe[0]*Ve),Bt=Math.floor(Oe[1]*rt),ur=Math.max(0,Bt-1)*Ve+_t,lr=l.data[ur];return lr}},{key:"selectFeature",value:function(r){var n=this.layer,i=(0,K.Z)(r,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,K.Z)(r,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),q3=function(){function e(t){(0,ye.Z)(this,e),this.layer=t;var r=this.layer.getContainer();this.rendererService=r.get(pt.IRendererService)}return(0,Y.Z)(e,[{key:"getColorTexture",value:function(r,n){var i=this.getTextureKey(r,n);return this.key===i?this.colorTexture:(this.createColorTexture(r,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(r,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(r,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return Vo(r);case"quantize":return Du(r);case"custom":return ws(r,n);case"linear":return Yo(r,n);default:return na(r)}}},{key:"getTextureKey",value:function(r,n){var i;return"".concat(r.colors.join("_"),"_").concat(r==null||(i=r.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),K3=["passes"],Q3=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],vx,r_,mx;function J3(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=eC(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function eC(e,t){if(!!e){if(typeof e=="string")return gx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gx(e,t)}}function gx(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tC(e){var t=rC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n_=di.isEqual,_x=di.isFunction,yx=di.isNumber,Ru=di.isObject,nC=di.isPlainObject,iC=di.isUndefined,xx=0,Tp=(vx=K0(pt.IGlobalConfigService),r_=function(e){(0,tt.Z)(r,e);var t=tC(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ye.Z)(this,r),n=t.call(this),(0,B.Z)((0,Ee.Z)(n),"id","".concat(xx++)),(0,B.Z)((0,Ee.Z)(n),"name","".concat(xx)),(0,B.Z)((0,Ee.Z)(n),"visible",!0),(0,B.Z)((0,Ee.Z)(n),"zIndex",0),(0,B.Z)((0,Ee.Z)(n),"inited",!1),(0,B.Z)((0,Ee.Z)(n),"layerModelNeedUpdate",!1),(0,B.Z)((0,Ee.Z)(n),"pickedFeatureID",null),(0,B.Z)((0,Ee.Z)(n),"selectedFeatureID",null),(0,B.Z)((0,Ee.Z)(n),"styleNeedUpdate",!1),(0,B.Z)((0,Ee.Z)(n),"forceRender",!1),(0,B.Z)((0,Ee.Z)(n),"clusterZoom",0),(0,B.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,B.Z)((0,Ee.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,B.Z)((0,Ee.Z)(n),"hooks",{init:new fA,afterInit:new iy,beforeRender:new iy,beforeRenderData:new hA,afterRender:new Yf,beforePickingEncode:new Yf,afterPickingEncode:new Yf,beforeHighlight:new Yf(["pickedColor"]),afterHighlight:new Yf,beforeSelect:new Yf(["pickedColor"]),afterSelect:new Yf,beforeDestroy:new Yf,afterDestroy:new Yf}),(0,B.Z)((0,Ee.Z)(n),"models",[]),(0,B.Z)((0,Ee.Z)(n),"startInit",!1),(0,B.Z)((0,Ee.Z)(n),"layerChildren",[]),(0,B.Z)((0,Ee.Z)(n),"masks",[]),an((0,Ee.Z)(n),"configService",mx,(0,Ee.Z)(n)),(0,B.Z)((0,Ee.Z)(n),"animateOptions",{enable:!1}),(0,B.Z)((0,Ee.Z)(n),"currentPickId",null),(0,B.Z)((0,Ee.Z)(n),"encodeStyleAttribute",{}),(0,B.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",[]),(0,B.Z)((0,Ee.Z)(n),"enableDataEncodeStyles",[]),(0,B.Z)((0,Ee.Z)(n),"enablg",[]),(0,B.Z)((0,Ee.Z)(n),"pendingStyleAttributes",[]),(0,B.Z)((0,Ee.Z)(n),"scaleOptions",{}),(0,B.Z)((0,Ee.Z)(n),"animateStatus",!1),(0,B.Z)((0,Ee.Z)(n),"isDestroyed",!1),(0,B.Z)((0,Ee.Z)(n),"encodeDataLength",0),(0,B.Z)((0,Ee.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,Y.Z)(r,[{key:"addMask",value:function(i){this.masks.push(i),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,F.Z)((0,F.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(pt.SceneID);this.configService.setLayerConfig(s,this.id,(0,F.Z)((0,F.Z)((0,F.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s=this,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:l=this.container.get(pt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(pt.IIconService),this.fontService=this.container.get(pt.IFontService),this.rendererService=this.container.get(pt.IRendererService),this.layerService=this.container.get(pt.ILayerService),this.debugService=this.container.get(pt.IDebugService),this.interactionService=this.container.get(pt.IInteractionService),this.pickingService=this.container.get(pt.IPickingService),this.mapService=this.container.get(pt.IMapService),f=this.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,d&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(pt.ICameraService),this.coordinateService=this.container.get(pt.ICoordinateSystemService),this.shaderModuleService=this.container.get(pt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(pt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(pt.IFactoryNormalPass),this.styleAttributeService=this.container.get(pt.IStyleAttributeService),d&&(this.multiPassRenderer=this.container.get(pt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(L){var Z=L.attributeName,Q=L.attributeField,oe=L.attributeValues,Ae=L.updateOptions;s.styleAttributeService.updateStyleAttribute(Z,{scale:(0,F.Z)({field:Q},s.splitValuesAndCallbackInAttribute(oe,Q?void 0:s.getLayerConfig()[Z]))},Ae)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(pt.ILayerPlugin),b=J3(this.plugins);try{for(b.s();!(A=b.n()).done;)w=A.value,w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(L){b.e(L)}finally{b.f()}return this.layerPickService=new Y3(this),this.textureService=new q3(this),this.log(Es.LayerInitStart),P.next=31,this.hooks.init.promise();case 31:this.log(Es.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),f={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,f)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Ru(i)?(a.enable=!0,a=(0,F.Z)((0,F.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(Es.SourceInitStart,kt.UPDATE),this.layerSource.setData(i,a),this.log(Es.SourceInitEnd,kt.UPDATE)):this.on("inited",function(){s.log(Es.SourceInitStart,kt.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new rx(i,a)),s.layerSource.once("update",function(){s.log(Es.SourceInitEnd,kt.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,Fl.Z)(i,K3);s&&px(s).forEach(function(d){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(d[0]);_&&_.updateOptions(d[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var f=l;return Object.keys(l).forEach(function(d){var _=l[d];Array.isArray(_)&&_.length===2&&!yx(_[0])&&!yx(_[1])&&(f[d]={field:_[0],value:_[1]})}),this.encodeStyle(f),this.updateLayerConfig(f),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,Wt.Z)(a.enableShaderEncodeStyles),(0,Wt.Z)(a.enableDataEncodeStyles)).includes(s)&&nC(i[s])&&(i[s].field||i[s].value)&&!n_(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,F.Z)({},this.scaleOptions);if(Ru(i)?this.scaleOptions=(0,F.Z)((0,F.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!n_(s,this.scaleOptions)){var l=Ru(i)?i:(0,B.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Ru(i)?!0:i,Ru(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Ru(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({highlightColor:Ru(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Ru(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Ru(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Ru(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ma(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Ru(i)?!0:i,Ru(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Ru(i)){var l=i.x,f=l===void 0?0:l,d=i.y,_=d===void 0?0:d;this.updateLayerConfig({selectColor:Ru(a)?a.color:this.getLayerConfig().selectColor,selectMix:Ru(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:f,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Ru(a)?a.color:this.getLayerConfig().selectColor,selectMix:Ru(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ma(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,f=l===void 0?-Infinity:l,d=a.maxZoom,_=d===void 0?Infinity:d;return!!s&&i>=f&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,f=l===void 0?[]:l;this.multiPassRenderer=dx(this,f,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var d=this.rendererService.getViewportSize(),_=d.width,b=d.height;this.multiPassRenderer.resize(_,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(f){return Math.abs(f)===Infinity});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,f,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),b=_.maskfence;b&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(d),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var f=l.type;if(a.coordCenter===void 0){var d,_=a.layerSource.center;a.coordCenter=_,(d=a.mapService)!==null&&d!==void 0&&d.setCoordCenter&&a.mapService.setCoordCenter(_)}if(f==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,f=this.styleAttributeService.getLayerStyleAttribute(i),d=(f==null||(a=f.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=d[0].option)===null||s===void 0?void 0:s.type,field:f==null||(l=f.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(d){return(0,B.Z)({value:a.invertExtent(d)},i,d)});return s}else if(a.ticks){var l=a.ticks().map(function(d){return(0,B.Z)({value:d},i,a(d))});return l}else if(a!=null&&a.domain){var f=a.domain().filter(function(d){return!iC(d)}).map(function(d){return(0,B.Z)({value:d},i,a(d))});return f}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l=this,f,d,_,b,A,w,I,P,L,Z,Q,oe;return ve().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return f=s.moduleName,d=s.vertexShader,_=s.fragmentShader,b=s.inject,A=s.triangulation,w=s.styleOption,I=(0,Fl.Z)(s,Q3),this.shaderModuleService.registerModule(f,{vs:d,fs:_,inject:b}),P=this.shaderModuleService.getModule(f),L=P.vs,Z=P.fs,Q=P.uniforms,oe=this.rendererService.createModel,Oe.abrupt("return",new Promise(function(Ve){var rt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,w),_t=rt.attributes,Bt=rt.elements,ur=rt.count,lr=(0,F.Z)({attributes:_t,uniforms:Q,fs:Z,vs:L,elements:Bt,blend:hx[Ge.normal],uniformBuffers:[].concat((0,Wt.Z)(l.layerModel.uniformBuffers),(0,Wt.Z)(l.rendererService.uniformBuffers)),textures:l.layerModel.textures},I);ur&&(lr.count=ur);var zr=oe(lr);Ve(zr)}));case 5:case"end":return Oe.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,f=a.enableSelect,d=f===void 0?!0:f,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&d&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.render();case 2:case"end":return f.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var f=this.configService.getAttributeConfig(this.id)||{};return n_(f[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,B.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,F.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(f){return f.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:_x(i)?void 0:i,callback:_x(i)?i:void 0}}}]),r}(ka.EventEmitter),mx=jr(r_.prototype,"configService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_);function aC(e,t){return{enable:e,mask:255,func:{cmp:W.EQUAL,ref:t?1:0,mask:1}}}function bx(e){return e.maskOperation===Dt.OR?{enable:!0,mask:255,func:{cmp:W.ALWAYS,ref:1,mask:255},opFront:{fail:W.KEEP,zfail:W.REPLACE,zpass:W.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===yt.SINGLE||e.stencilIndex===0?W.ALWAYS:W.LESS,ref:e.stencilType===yt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:W.KEEP,zfail:W.REPLACE,zpass:W.REPLACE}}}var oC={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},Fg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function L6(e){var t="";return Object.keys(e).forEach(function(r){var n=e[r];Array.isArray(n)?t+="vec".concat(n.length," ").concat(r,`;
`):t+="flot ".concat(r,`;
`)}),t}function Ex(e){return Math.ceil(e/4)*4}var Ss=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e}({});function sC(e){switch(e){case"rotation":return{name:"Rotation",type:dn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Ss.ROTATION,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(r){var n=r.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:dn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Ss.STROKE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(r){var n=r.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:dn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Ss.OPACITY,buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(r){var n=r.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:dn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Ss.EXTRUSION_BASE,buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(r){var n=r.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:dn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Ss.OFFSETS,buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:dn.Attribute,descriptor:{name:"a_ThetaOffset",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(r){var n=r.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var Sx,i_,Ax,Tx={opacity:Ss.OPACITY,stroke:Ss.STROKE,offsets:Ss.OFFSETS,rotation:Ss.ROTATION,extrusionBase:Ss.EXTRUSION_BASE},Ta=(Sx=K0(pt.IGlobalConfigService),i_=function(){function e(t){(0,ye.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"textures",[]),(0,B.Z)(this,"preStyleAttribute",{}),(0,B.Z)(this,"encodeStyleAttribute",{}),an(this,"configService",Ax,this),this.layer=t,this.rendererService=t.getContainer().get(pt.IRendererService),this.pickingService=t.getContainer().get(pt.IPickingService),this.shaderModuleService=t.getContainer().get(pt.IShaderModuleService),this.styleAttributeService=t.getContainer().get(pt.IStyleAttributeService),this.mapService=t.getContainer().get(pt.IMapService),this.iconService=t.getContainer().get(pt.IIconService),this.fontService=t.getContainer().get(pt.IFontService),this.cameraService=t.getContainer().get(pt.ICameraService),this.layerService=t.getContainer().get(pt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,Y.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,i=n===void 0?"normal":n;return hx[Ge[i]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,f=n.enableMask,d=n.maskOperation,_=d===void 0?Dt.AND:d;if(this.layer.type==="MaskLayer")return bx({isStencil:!0,stencilType:yt.SINGLE});if(r.isStencil)return bx((0,F.Z)((0,F.Z)({},r),{},{maskOperation:_}));var b=a||f&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return aC(b,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){r[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(Fg[l]," u_").concat(l,";")),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(Tx[l],") in ").concat(Fg[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(Fg[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(Fg[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var r=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!r.layer.encodeStyleAttribute[i]){var a=r.layer.getLayerConfig()[i],s=typeof a=="undefined"?oC[i]:a;i==="stroke"&&(s=ii(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=sC(n);i&&(r.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=Tx[n]))})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}},{key:"initUniformsBuffer",value:function(){var r=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ex(r.uniformsLength)),isUBO:!0}),this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(Ex(n.uniformsLength)),isUBO:!0}),this.uniformBuffers=[this.attributeUnifoms,this.commonUnifoms]}},{key:"getUniformsBufferInfo",value:function(r){var n=0,i=[];return Object.values(r).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,Wt.Z)(a)),n+=a.length):(i.push(a),n+=1)}),{uniformsOption:r,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var r=this.getUniformsBufferInfo(this.getStyleAttribute()),n=r.uniformsArray,i=this.getCommonUniformsInfo(),a=i.uniformsArray;this.attributeUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),this.commonUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)})}}]),e}(),Ax=jr(i_.prototype,"configService",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_),a_=100,N6=36,U6=40;function Cx(e){return e/180*Math.acos(-1)}function Rx(e){var t=Cx(e[0])+Math.PI/2,r=Cx(e[1]),n=a_+Math.random()*.4,i=n*Math.cos(r)*Math.cos(t),a=n*Math.cos(r)*Math.sin(t),s=n*Math.sin(r);return[a,s,i]}function z6(e,t){var r=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);t=t||{},e=typeof e!="undefined"?e:1;for(var s=typeof t.segments!="undefined"?t.segments:32,l=2+s,f=2*l,d=[],_=[],b=[],A=[],w=[],I=[],P=0;P<=l;P++){for(var L=P/l,Z=L*Math.PI,Q=0;Q<=f;Q++){var oe=Q/f,Ae=oe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Z),mat4.identity(r),mat4.rotateY(r,r,Ae),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,r),vec3.scale(a,a,-e),b.push(a.slice()),A.push.apply(A,_toConsumableArray(a.slice())),vec3.normalize(a,a),w.push.apply(w,_toConsumableArray(a.slice())),I.push([oe,1-L]),A.push(oe,1-L)}if(P>0)for(var Oe=b.length,Ve=Oe-2*(f+1);Ve+f+2<Oe;Ve++)d.push([Ve,Ve+1,Ve+f+1]),_.push(Ve,Ve+1,Ve+f+1),d.push([Ve+f+1,Ve+1,Ve+f+2]),_.push(Ve+f+1,Ve+1,Ve+f+2)}return{cells:d,positions:b,uvs:I,positionsArr:A,indicesArr:_,normalArr:w}}var kg=Mr.create(),Z6=Mr.create(),zs=Mr.create(),wp=Mr.create(),uv=Mr.create();function o_(e,t,r,n,i){Mr.add(e,r,n),Mr.normalize(e,e),t=Mr.fromValues(-e[1],e[0]);var a=Mr.fromValues(-r[1],r[0]);return[i/Mr.dot(t,a),t]}function Cp(e,t){return Mr.set(e,-t[1],t[0])}function lv(e,t,r){return Mr.sub(e,t,r),Mr.normalize(e,e),e}function s_(e,t){return e[0]===t[0]&&e[1]===t[1]}function V6(e){for(var t=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();t.get(n)?(e.splice(r,1),r++):t.set(n,n)}return e}var uC=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ye.Z)(this,e),(0,B.Z)(this,"lastFlip",-1),(0,B.Z)(this,"miter",Mr.fromValues(0,0)),(0,B.Z)(this,"started",!1),(0,B.Z)(this,"dash",!1),(0,B.Z)(this,"totalDistance",0),(0,B.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Y.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],f=r[s],d=s<r.length-1?r[s+1]:null,_=this.simpleSegment(n,a,l,f,d);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,b=r[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],w=r[l];w.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],P=l<r.length-1?[].concat((0,Wt.Z)(r[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,L=l<n.length-1?n[l+1]:null,Z=this.simpleSegment(i,s,b,w,P,A,I,L);s+=Z}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(r,n){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=i.startIndex,l=1;l<a;l++){var f,d,_,b=r[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var A=n[l-1],w=r[l];w.push((d=n[l][2])!==null&&d!==void 0?d:0);var I=n[l],P=l<r.length-1?[].concat((0,Wt.Z)(r[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,L=l<n.length-1?n[l+1]:null,Z=this.segment_gaode2(i,s,b,w,P,A,I,L);s+=Z}if(this.dash)for(var Q=0;Q<i.positions.length/6;Q++)i.positions[Q*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=r.length,a=n.startIndex,s=1;s<i;s++){var l=r[s-1],f=r[s],d=s<r.length-1?r[s+1]:null,_=this.segment(n,a,l,f,d);a+=_}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,i,a,s){var l=0,f=r.indices,d=r.positions,_=r.normals,b=so([a[0],a[1]]),A=so([i[0],i[1]]);lv(zs,b,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(b,A),this.totalDistance+=w),this.normal||(this.normal=Mr.create(),Cp(this.normal,zs)),this.started||(this.started=!0,this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-w)),f.push(n+0,n+1,n+2),!s)Cp(this.normal,zs),this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=so([s[0],s[1]]);s_(b,I)&&Mr.add(I,b,Mr.normalize(I,Mr.subtract(I,b,A))),lv(wp,I,b);var P=o_(uv,Mr.create(),zs,wp,this.thickness),L=(0,K.Z)(P,2),Z=L[0],Q=L[1],oe=Mr.dot(uv,this.normal)<0?-1:1;this.extrusions(d,_,a,Q,Z,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,Mr.copy(this.normal,Q),l+=2,this.lastFlip=oe}return l}},{key:"segment_gaode2",value:function(r,n,i,a,s,l,f,d){var _=0,b=r.indices,A=r.positions,w=r.normals,I=this.cap==="square",P=this.join==="bevel",L=so([f[0],f[1]]),Z=so([l[0],l[1]]);lv(zs,a,i);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(L,Z),this.totalDistance+=Q),this.normal||(this.normal=Mr.create(),Cp(this.normal,zs)),!this.started)if(this.started=!0,I){var oe=Mr.create(),Ae=Mr.create();Mr.add(oe,this.normal,zs),Mr.add(Ae,this.normal,zs),w.push(Ae[0],Ae[1],0),w.push(oe[0],oe[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-Q,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-Q);if(b.push(n+0,n+1,n+2),s){s_(a,s)&&Mr.add(s,a,Mr.normalize(s,Mr.subtract(s,a,i))),lv(wp,s,a);var rt=o_(uv,Mr.create(),zs,wp,this.thickness),_t=(0,K.Z)(rt,2),Bt=_t[0],ur=_t[1],lr=Mr.dot(uv,this.normal)<0?-1:1,zr=P;if(!zr&&this.join==="miter"){var un=Bt;un>this.miterLimit&&(zr=!0)}zr?(w.push(this.normal[0],this.normal[1],0),w.push(ur[0],ur[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Wt.Z)(this.lastFlip!==-lr?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Cp(kg,wp),Mr.copy(this.normal,kg),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*lr,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,ur,Bt,this.totalDistance),b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),lr=-1,Mr.copy(this.normal,ur),_+=2),this.lastFlip=lr}else{if(Cp(this.normal,zs),I){var Oe=Mr.create(),Ve=Mr.create();Mr.sub(Ve,zs,this.normal),Mr.add(Oe,zs,this.normal),w.push(Ve[0],Ve[1],0),w.push(Oe[0],Oe[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(r,n,i,a,s){var l=0,f=r.indices,d=r.positions,_=r.normals,b=this.cap==="square",A=this.join==="bevel",w=so([a[0],a[1]]),I=so([i[0],i[1]]);lv(zs,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=Mr.create(),Cp(this.normal,zs)),!this.started)if(this.started=!0,b){var L=Mr.create(),Z=Mr.create();Mr.add(L,this.normal,zs),Mr.add(Z,this.normal,zs),_.push(Z[0],Z[1],0),_.push(L[0],L[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,i,this.normal,this.thickness,this.totalDistance-P);if(f.push(n+0,n+1,n+2),s){var Ae=so([s[0],s[1]]);s_(w,Ae)&&Mr.add(Ae,w,Mr.normalize(Ae,Mr.subtract(Ae,w,I))),lv(wp,Ae,w);var Oe=o_(uv,Mr.create(),zs,wp,this.thickness),Ve=(0,K.Z)(Oe,2),rt=Ve[0],_t=Ve[1],Bt=Mr.dot(uv,this.normal)<0?-1:1,ur=A;if(!ur&&this.join==="miter"){var lr=rt;lr>this.miterLimit&&(ur=!0)}ur?(_.push(this.normal[0],this.normal[1],0),_.push(_t[0],_t[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Wt.Z)(this.lastFlip!==-Bt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Cp(kg,wp),Mr.copy(this.normal,kg),_.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Bt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,_,a,_t,rt,this.totalDistance),f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Bt=-1,Mr.copy(this.normal,_t),l+=2),this.lastFlip=Bt}else{if(Cp(this.normal,zs),b){var Q=Mr.create(),oe=Mr.create();Mr.sub(oe,zs,this.normal),Mr.add(Q,zs,this.normal),_.push(oe[0],oe[1],0),_.push(Q[0],Q[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,_,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Wt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),r.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),r.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var i=n[0]-r[0],a=n[1]-r[1];return Math.sqrt(i*i+a*a)}}]),e}(),wa=N(77160);function lC(e){var t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Ao().flatten(e),a=i.vertices,s=i.dimensions,l=[],f=[],d=0;d<a.length/s;d++)s===2?l.push(a[d*2],a[d*2+1],1):l.push(a[d*3],a[d*3+1],1);var _=Ao()(i.vertices,i.holes,i.dimensions);f.push.apply(f,(0,Wt.Z)(_));for(var b=function(){var I=i.vertices.slice(A*s,(A+1)*s),P=i.vertices.slice((A+1)*s,(A+2)*s);P.length===0&&(P=i.vertices.slice(0,s));var L=l.length/3;l.push(I[0],I[1],1,P[0],P[1],1,I[0],I[1],0,P[0],P[1],0),f.push.apply(f,(0,Wt.Z)([0,2,1,2,3,1].map(function(Z){return Z+L})))},A=0;A<n;A++)b();return{positions:l,index:f}}function cC(e){var t=Ao().flatten(e),r=Ao()(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:r}}function Mx(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Ao().flatten(e),s=a.vertices,l=a.dimensions,f=[],d=[],_=[],b=0;b<s.length/l;b++)f.push(s[b*l],s[b*l+1],1,-1,-1),_.push(0,0,1);var A=Ao()(a.vertices,a.holes,a.dimensions);d.push.apply(d,(0,Wt.Z)(A));for(var w=function(){var L=a.vertices.slice(I*l,(I+1)*l),Z=a.vertices.slice((I+1)*l,(I+2)*l);Z.length===0&&(Z=a.vertices.slice(0,l));var Q=f.length/5;f.push(L[0],L[1],1,0,0,Z[0],Z[1],1,.1,0,L[0],L[1],0,0,.8,Z[0],Z[1],0,.1,.8);var oe=fC([Z[0],Z[1],1],[L[0],L[1],0],[L[0],L[1],1],t);_.push.apply(_,(0,Wt.Z)(oe).concat((0,Wt.Z)(oe),(0,Wt.Z)(oe),(0,Wt.Z)(oe))),d.push.apply(d,(0,Wt.Z)([1,2,0,3,2,1].map(function(Ae){return Ae+Q})))},I=0;I<i;I++)w();return{positions:f,index:d,normals:_}}function fC(e,t,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=wa.create(),a=wa.create(),s=wa.create();n&&(e=lh(e),t=lh(t),r=lh(r));var l=wa.fromValues.apply(wa,(0,Wt.Z)(e)),f=wa.fromValues.apply(wa,(0,Wt.Z)(t)),d=wa.fromValues.apply(wa,(0,Wt.Z)(r));wa.sub(i,d,f),wa.sub(a,l,f),wa.cross(s,i,a);var _=wa.create();return wa.normalize(_,s),_}var Bc,ym=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),xm=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function bm(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(r*i+t*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),f=Math.cos(s+Math.PI/4);return[l,f,0]});return a}function u_(){return bm(30)}function Ix(){return bm(4)}function Px(){return bm(3)}function Ox(){return bm(6,1)}function Dx(){return bm(5)}var cv=(Bc={},(0,B.Z)(Bc,xm.CIRCLE,u_),(0,B.Z)(Bc,xm.HEXAGON,Ox),(0,B.Z)(Bc,xm.TRIANGLE,Px),(0,B.Z)(Bc,xm.SQUARE,Ix),(0,B.Z)(Bc,xm.PENTAGON,Dx),(0,B.Z)(Bc,ym.CYLINDER,u_),(0,B.Z)(Bc,ym.HEXAGONCOLUMN,Ox),(0,B.Z)(Bc,ym.TRIANGLECOLUMN,Px),(0,B.Z)(Bc,ym.SQUARECOLUMN,Ix),(0,B.Z)(Bc,ym.PENTAGONCOLUMN,Dx),Bc),Bg={};function Lg(e){var t=Gs(e.coordinates);return{vertices:[].concat((0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t),(0,Wt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Fx(e){var t=Gs(e.coordinates),r=Rx(t);return{vertices:[].concat((0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r),(0,Wt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function l_(e){var t=e.shape,r=_C(t,!1),n=r.positions,i=r.index,a=r.normals;return{vertices:n,indices:i,normals:a,size:5}}function hC(e){var t=Gs(e.coordinates);return{vertices:(0,Wt.Z)(t),indices:[0],size:t.length}}function c_(e){var t=e.coordinates,r=e.originCoordinates,n=e.version,i=new uC({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=t;Array.isArray(a[0][0])||(a=[t]);var s=r;Array.isArray(s[0][0])||(s=[r]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var _=t;_[0]&&!Array.isArray(_[0][0])&&(_=[t]),_.forEach(function(A){i.extrude(A)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function j6(e){var t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(t),[1,2,-3],_toConsumableArray(t),[1,1,-3],_toConsumableArray(t),[0,1,0],_toConsumableArray(t),[0,0,0],_toConsumableArray(t),[1,0,0],_toConsumableArray(t),[1,2,-3],_toConsumableArray(t),[1,1,-3],_toConsumableArray(t),[0,1,0],_toConsumableArray(t),[0,0,0],_toConsumableArray(t)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function pC(e){var t=e.coordinates,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=dC(t),i=n.results,a=n.totalDistance;return i.map(function(s){r.push(s[0],s[1],s[2],s[3],0,a)}),{vertices:r,indices:[],normals:[],size:6,count:i.length}}function H6(e){var t=e.coordinates,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],size:4,count:0};var n=vC(t),i=n.results;return i.map(function(a){r.push(a[0],a[1],a[2],a[3])}),{vertices:r,indices:[],size:4,count:i.length}}function kx(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function fv(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function dC(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var r=0;if(t.length<2)return{results:t,totalDistance:0};var n=[],i=fv(t[0],r);n.push(i);for(var a=1;a<t.length-1;a++){var s=kx(t[a-1],t[a]);r+=s;var l=fv(t[a],r);n.push(l),n.push(l)}var f=kx(t[t.length-2],t[t.length-1]);return r+=f,n.push(fv(t[t.length-1],r)),{results:n,totalDistance:r}}function vC(e){if(e.length<2)return{results:e};var t=[],r=fv(e[0]);t.push(r);for(var n=1;n<e.length-1;n++){var i=fv(e[n]);t.push(i),t.push(i)}return t.push(fv(e[e.length-1])),{results:t}}function f_(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes;return{indices:Ao()(n,a,i),vertices:n,size:i}}function mC(e){var t=e.coordinates,r=Ao().flatten(t),n=r.vertices,i=r.dimensions,a=r.holes;return{indices:Ao()(n,a,i),vertices:gC(n),size:i+4}}function gC(e){for(var t=[],r=qh(e),n=r.center,i=r.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];t.push.apply(t,[s,l,0].concat((0,Wt.Z)(n),[i]))}return t}function h_(e){var t=e.coordinates,r=Mx(t,!0),n=r.positions,i=r.index,a=r.normals;return{vertices:n,indices:i,normals:a,size:5}}function Bx(e){var t=e.shape,r=xC(t),n=r.positions,i=r.index;return{vertices:n,indices:i,size:3}}function Ng(e){var t=e.coordinates,r=[].concat((0,Wt.Z)(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],(0,Wt.Z)(t[1]),[0,1,0],(0,Wt.Z)(t[0]),[0,0,1],(0,Wt.Z)(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Ug(e,t){for(var r=t.segmentNumber,n=r===void 0?30:r,i=e.coordinates,a=[],s=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&s.push.apply(s,(0,Wt.Z)([0,1,2,1,3,2].map(function(b){return _*2+b})))},f=0;f<n;f++)l(f);return{vertices:a,indices:s,size:7}}function Lx(e){var t=e.coordinates;t.length===2&&t.push(0);var r=zg(-1,1),n=zg(1,1),i=zg(-1,-1),a=zg(1,-1),s=[].concat((0,Wt.Z)(t),(0,Wt.Z)(r),(0,Wt.Z)(t),(0,Wt.Z)(i),(0,Wt.Z)(t),(0,Wt.Z)(a),(0,Wt.Z)(t),(0,Wt.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function _C(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Bg&&Bg[e])return Bg[e];var r=cv[e]?cv[e]():cv.cylinder(),n=Mx([r],t);return Bg[e]=n,n}function W6(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/r*3),a,s,l,f=vec3.create(),d=vec3.create(),_=vec3.create(),b=0,A=t.length;b<A;b+=3){a=t[b+0]*3,s=t[b+1]*3,l=t[b+2]*3;var w=[e[a],e[a+1]],I=[e[s],e[s+1]],P=[e[l],e[l+1]];n&&(w=lngLatToMeters(w),I=lngLatToMeters(I),P=lngLatToMeters(P));var L=w,Z=_slicedToArray(L,2),Q=Z[0],oe=Z[1],Ae=vec3.fromValues(Q,oe,e[a+2]),Oe=I,Ve=_slicedToArray(Oe,2),rt=Ve[0],_t=Ve[1],Bt=vec3.fromValues(rt,_t,e[s+2]),ur=P,lr=_slicedToArray(ur,2),zr=lr[0],un=lr[1],Rn=vec3.fromValues(zr,un,e[l+2]);vec3.sub(f,Rn,Bt),vec3.sub(d,Ae,Bt),vec3.cross(_,f,d),i[a]+=f[0],i[a+1]+=f[1],i[a+2]+=f[2],i[s]+=f[0],i[s+1]+=f[1],i[s+2]+=f[2],i[l]+=f[0],i[l+1]+=f[1],i[l+2]+=f[2]}return yC(i),i}function yC(e){for(var t=0,r=e.length;t<r;t+=3){var n=vec3.fromValues(e[t],e[t+1],e[t+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,t)}}function G6(e){var t=e[0][0],r=e[0][e[0].length-1];return t[0]===r[0]&&t[1]===r[1]}function xC(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=cv[e]?cv[e]():cv.circle(),n=t.indexOf(e)===-1?cC([r]):lC([r]);return n}function zg(e,t){var r=(e+1)/2,n=(t+1)/2;return[r,n]}function X6(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),t=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:t,indices:r,size:5,normals:n}}function $6(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),t=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:t,indices:r,size:5,normals:n}}function bC(e){var t=EC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,AC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,TC=function(e){(0,tt.Z)(r,e);var t=bC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,f=l===void 0?"rgb(16,16,16)":l,d=i.brightColor,_=d===void 0?"rgb(255,176,38)":d,b=i.windowColor,A=b===void 0?"rgb(30,60,89)":b,w=i.time,I=w===void 0?0:w,P=i.sweep,L=P===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:P;return{u_cityCenter:L.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*L.sweepRadius,u_circleSweep:L.enable?1:0,u_circleSweepColor:ii(L.sweepColor).slice(0,3),u_circleSweepSpeed:L.sweepSpeed,u_opacity:s,u_baseColor:ii(f),u_brightColor:ii(_),u_windowColor:ii(A),u_time:this.layer.getLayerAnimateTime()||I}}},{key:"calCityGeo",value:function(){var i=(0,K.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],f=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(f+s)/2]);var d=this.mapService.lngLatToCoord([l,f]),_=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(d[0]-_[0],2)+Math.pow(d[1]-_[1],2))/4}else{var b=l-a,A=f-s;this.cityCenter=[(l+a)/2,(f+s)/2],this.cityMinSize=Math.sqrt(Math.pow(b,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:AC,fragmentShader:SC,triangulation:h_,depth:{enable:!0},cull:{enable:!0,face:W.BACK}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Ta);function wC(e){var t=CC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RC=function(e){(0,tt.Z)(r,e);var t=wC(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","CityBuildingLayer"),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new TC(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Tp);function MC(e){var t=IC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,OC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,DC=function(e){(0,tt.Z)(r,e);var t=MC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:s||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:PC,fragmentShader:OC,triangulation:Bx,primitive:W.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Ta);function FC(e){var t=kC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,LC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,NC=function(e){(0,tt.Z)(r,e);var t=FC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:s||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:BC,fragmentShader:LC,triangulation:l_,primitive:W.TRIANGLES,depth:{enable:!0}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Ta);function UC(e,t){for(var r=[],n=[],i=[],a=e+1,s=t+1,l=e/2,f=t/2,d=0;d<s;d++)for(var _=d-f,b=0;b<a;b++){var A=b-l;n.push(A/l,-_/f,0),i.push(b/e),i.push(1-d/t)}for(var w=0;w<t;w++)for(var I=0;I<e;I++){var P=I+a*w,L=I+a*(w+1),Z=I+1+a*(w+1),Q=I+1+a*w;r.push(P,L,Q),r.push(L,Z,Q)}return{vertices:n,indices:r,uvs:i}}var Nx,Ux;function zC(e){var t=ZC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,jC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,HC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,WC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,GC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,XC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,$C=di.isEqual,zx=(Nx=(0,ot.b2)(),Nx(Ux=function(e){(0,tt.Z)(r,e);var t=zC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.useFramebuffer,d=this.layer.getLayerConfig(),_=d.rampColors;f(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),$C(this.preRampColors,_)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w,I,P;return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return l=this.rendererService,f=l.createFramebuffer,d=l.getViewportSize,_=l.createTexture2D,b=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(b==null||(s=b.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=A,Z.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=Z.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),w=d(),I=w.width,P=w.height,this.heatmapFramerBuffer=f({color:_({width:Math.floor(I/4),height:Math.floor(P/4),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),depth:!1}),this.updateColorTexture(),Z.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return Z.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:dn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=Lx,f.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:XC,fragmentShader:GC,triangulation:Lx,depth:{enable:!1},cull:{enable:!0,face:jo(this.mapService.version)}});case 3:return s=f.sent,f.abrupt("return",s);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:WC,fs:HC});var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService,d=f.createAttribute,_=f.createElements,b=f.createBuffer,A=f.createModel;return A({vs:a,fs:s,attributes:{a_Position:d({buffer:b({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:W.FLOAT}),size:3}),a_Uv:d({buffer:b({data:[0,1,1,1,0,0,1,0],type:W.FLOAT}),size:2})},uniforms:(0,F.Z)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:W.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.opacity,l=a.intensity,f=l===void 0?10:l,d=a.radius,_=d===void 0?5:d;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:{u_opacity:s||1,u_radius:_,u_intensity:f},blend:{enable:!0,func:{srcRGB:W.ONE,srcAlpha:1,dstRGB:W.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity;(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=Vt();bn(f,this.cameraService.getViewProjectionMatrixUncentered()),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Wt.Z)(f)},blend:{enable:!0,func:{srcRGB:W.SRC_ALPHA,srcAlpha:1,dstRGB:W.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,f=UC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:jC,fs:VC});var d=this.shaderModuleService.getModule("heatmap3dColor"),_=d.vs,b=d.fs,A=d.uniforms,w=this.rendererService,I=w.createAttribute,P=w.createElements,L=w.createBuffer,Z=w.createModel;return Z({vs:_,fs:b,attributes:{a_Position:I({buffer:L({data:f.vertices,type:W.FLOAT}),size:3}),a_Uv:I({buffer:L({data:f.uvs,type:W.FLOAT}),size:2})},primitive:W.TRIANGLES,uniforms:(0,F.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:W.SRC_ALPHA,srcAlpha:1,dstRGB:W.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:P({data:f.indices,type:W.UNSIGNED_INT,count:f.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=na(s);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1}),this.preRampColors=s}}]),r}(Ta))||Ux);function YC(e){var t=qC();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,QC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,JC=function(e){(0,tt.Z)(r,e);var t=YC(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:s||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:QC,fragmentShader:KC,triangulation:Bx,depth:{enable:!1},primitive:W.TRIANGLES});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),r}(Ta),eR={heatmap:zx,heatmap3d:zx,grid:DC,grid3d:NC,hexagon:JC},tR=eR;function rR(e){var t=nR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function nR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iR=function(e){(0,tt.Z)(r,e);var t=rR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","HeatMapLayer"),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new tR[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,f=this.getSource(),d=f.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":d==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":d==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}}]),r}(Tp);function aR(e){var t=oR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function oR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sR=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,uR=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,lR=function(e){(0,tt.Z)(r,e);var t=aR(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),b.next=5,s.data.images;case 5:return f=b.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,mag:W.LINEAR,min:W.LINEAR}),b.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:uR,fragmentShader:sR,triangulation:Ng,primitive:W.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return d=b.sent,b.abrupt("return",[d]);case 11:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Ta),cR={image:lR},fR=cR;function hR(e){var t=pR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function pR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zx=function(e){(0,tt.Z)(r,e);var t=hR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","ImageLayer"),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new fR[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),r}(Tp);function dR(e){var t=vR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function vR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mR=`varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;

  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,gR=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;
#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,_R=`
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,yR=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,xR=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,bR=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ER={solid:0,dash:1},Y6=di.isNumber,SR=function(e){(0,tt.Z)(r,e);var t=dR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.sourceColor,f=i.targetColor,d=i.textureBlend,_=d===void 0?"normal":d,b=i.lineType,A=b===void 0?"solid":b,w=i.dashArray,I=w===void 0?[10,5]:w,P=i.forward,L=P===void 0?!0:P,Z=i.lineTexture,Q=Z===void 0?!1:Z,oe=i.iconStep,Ae=oe===void 0?100:oe,Oe=i.segmentNumber,Ve=Oe===void 0?30:Oe;I.length===2&&I.push(0,0);var rt=0,_t=[0,0,0,0],Bt=[0,0,0,0];return l&&f&&(_t=ii(l),Bt=ii(f),rt=1),this.rendererService.getDirty()&&this.texture.bind(),(0,F.Z)({u_textureBlend:_==="normal"?0:1,segmentNumber:Ve,u_line_type:ER[A||"solid"],u_dash_array:I,u_blur:.9,u_lineDir:L?1:-1,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:_t,u_targetColor:Bt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType;return l==="dash"?{frag:mR,vert:gR,type:"Dash"}:a&&s?{frag:xR,vert:bR,type:"Linear"}:{frag:_R,vert:yR,type:""}}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,b=d.vert,A=d.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:Ug,depth:{enable:!1},styleOption:{segmentNumber:f}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta);function AR(e){var t=TR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function TR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,CR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,RR=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,MR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,IR={solid:0,dash:1},PR=function(e){(0,tt.Z)(r,e);var t=AR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,Z=i.segmentNumber,Q=Z===void 0?30:Z,oe=i.globalArcHeight,Ae=oe===void 0?10:oe;A.length===2&&A.push(0,0);var Oe=0,Ve=[0,0,0,0],rt=[0,0,0,0];return a&&s&&(Ve=ii(a),rt=ii(s),Oe=1),this.rendererService.getDirty()&&this.texture.bind(),(0,F.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:a_,u_global_height:Ae,u_textureBlend:f==="normal"?0:1,segmentNumber:Q,u_line_type:IR[_]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:L,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Oe,u_sourceColor:Ve,u_targetColor:rt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor;return a&&s?{frag:RR,vert:MR,type:"Linear"}:{frag:wR,vert:CR,type:""}}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,b=d.vert,A=d.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:Ug,styleOption:{segmentNumber:f}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta);function OR(e){var t=DR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function DR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,kR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,BR=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,LR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,NR={solid:0,dash:1},UR=function(e){(0,tt.Z)(r,e);var t=OR(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.sourceColor,f=i.targetColor,d=i.textureBlend,_=d===void 0?"normal":d,b=i.lineType,A=b===void 0?"solid":b,w=i.dashArray,I=w===void 0?[10,5]:w,P=i.lineTexture,L=P===void 0?!1:P,Z=i.iconStep,Q=Z===void 0?100:Z,oe=i.segmentNumber,Ae=oe===void 0?30:oe,Oe=i.globalArcHeight,Ve=Oe===void 0?10:Oe;I.length===2&&I.push(0,0);var rt=0,_t=[0,0,0,0],Bt=[0,0,0,0];return l&&f&&(_t=ii(l),Bt=ii(f),rt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:a_,u_global_height:Ve,u_opacity:s,u_textureBlend:_==="normal"?0:1,segmentNumber:Ae,u_line_type:NR[A]||0,u_dash_array:I,u_texture:this.texture,u_line_texture:L?1:0,u_icon_step:Q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:_t,u_targetColor:Bt}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor;return a&&s?{frag:BR,vert:LR,type:"Linear"}:{frag:FR,vert:kR,type:""}}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),_=d.frag,b=d.vert,A=d.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+A,vertexShader:b,fragmentShader:_,triangulation:Ug,depth:{enable:!0},styleOption:{segmentNumber:f}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta),Vx={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},Bl=1/2;function zR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?1:i;return{vertices:[0,Bl*e,1*e*n,-(a+Bl)*e,1*e*n,(a-Bl)*e,0,Bl*e,1*e*n,-(a+Bl)*e,1*e*n,(a-Bl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function ZR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function VR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function jR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function HR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function WR(e,t){var r=t.width,n=r===void 0?2:r,i=t.height,a=i===void 0?2:i,s=u_(),l=Ao().flatten([s]),f=Ao()(l.vertices,l.holes,l.dimensions),d=s.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat((0,Wt.Z)(d),(0,Wt.Z)(d)),dimensions:2,indices:f.map(function(_){return _+s.length}),outLineIndices:f,normals:[].concat((0,Wt.Z)(s.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),(0,Wt.Z)(new Array(s.length*3).fill(0)))}}function GR(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=(0,ps.Z)(r.source)==="object"?r.source.type:r.source,i=(0,ps.Z)(r.target)==="object"?r.target.type:r.target,a=(0,ps.Z)(r.source)==="object"?r.source:{},s=a.width,l=s===void 0?n?Vx[n]:0:s,f=a.height,d=f===void 0?2:f,_=(0,ps.Z)(r.target)==="object"?r.target:{},b=_.width,A=b===void 0?i?Vx[i]:0:b,w=_.height,I=w===void 0?2:w;return{vertices:[0,Bl,1*l].concat((0,Wt.Z)(e),[1,Bl,-1*A],(0,Wt.Z)(e),[1,-Bl,-1*A],(0,Wt.Z)(e),[0,-Bl,1*l],(0,Wt.Z)(e),[0,Bl,1*l],(0,Wt.Z)(e),[1,Bl,-1*A],(0,Wt.Z)(e),[1,-Bl,-1*A],(0,Wt.Z)(e),[0,-Bl,1*l],(0,Wt.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(P){return P+t}),indices:[4,5,6,4,6,7].map(function(P){return P+t}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function jx(e,t){var r=(0,ps.Z)(e)==="object"?e.type:e,n=t==="source"?1:-1,i=(0,ps.Z)(e)==="object"?e:{};switch(r){case"circle":return WR(n,i);case"triangle":return ZR(n,i);case"diamond":return jR(n,i);case"rect":return VR(n,i);case"classic":return HR(n,i);case"halfTriangle":return zR(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function XR(e){var t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,Wt.Z)(t),[1,2,-3],(0,Wt.Z)(t),[1,1,-3],(0,Wt.Z)(t),[0,1,0],(0,Wt.Z)(t),[0,0,0],(0,Wt.Z)(t),[1,0,0],(0,Wt.Z)(t),[1,2,-3],(0,Wt.Z)(t),[1,1,-3],(0,Wt.Z)(t),[0,1,0],(0,Wt.Z)(t),[0,0,0],(0,Wt.Z)(t)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function $R(e,t){return t?YR(e,t):XR(e)}function YR(e,t){var r=e.coordinates.flat(),n=t,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,f=Hx(jx(l,"source"),r,0,0),d=GR(r,f.vertices.length/7,t),_=Hx(jx(a,"target"),r,1,f.vertices.length/7+d.vertices.length/7),b={vertices:[].concat((0,Wt.Z)(f.vertices),(0,Wt.Z)(d.vertices),(0,Wt.Z)(_.vertices)),indices:[].concat((0,Wt.Z)(f.outLineIndices),(0,Wt.Z)(d.outLineIndices),(0,Wt.Z)(_.outLineIndices),(0,Wt.Z)(f.indices),(0,Wt.Z)(d.indices),(0,Wt.Z)(_.indices)),normals:[].concat((0,Wt.Z)(f.normals),(0,Wt.Z)(d.normals),(0,Wt.Z)(_.normals)),size:7};return b}function Hx(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,f=e.outLineIndices,d=0;d<a.length;d+=l)i.push.apply(i,[r,a[d+1],a[d]].concat((0,Wt.Z)(t)));return(0,F.Z)((0,F.Z)({},e),{},{vertices:i,indices:s.map(function(_){return _+n}),outLineIndices:f.map(function(_){return _+n})})}function qR(e){var t=KR();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function KR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QR=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,JR=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,eM=function(e){(0,tt.Z)(r,e);var t=qR(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,f=l===void 0?1:l,d=i.stroke,_=d===void 0?"#000":d,b=i.strokeOpacity,A=b===void 0?1:b;return(0,F.Z)({u_gap_width:s,u_stroke_width:f,u_stroke:ii(_),u_stroke_opacity:A},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:JR,fragmentShader:QR,inject:this.getInject(),triangulation:$R,styleOption:this.layer.getLayerConfig().symbol,primitive:W.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}})}}]),r}(Ta);function tM(e){var t=rM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function rM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
     gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,iM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,aM={solid:0,dash:1},oM=function(e){(0,tt.Z)(r,e);var t=tM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,b=i.dashArray,A=b===void 0?[10,5]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,Z=i.segmentNumber,Q=Z===void 0?30:Z;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var oe=0,Ae=[0,0,0,0],Oe=[0,0,0,0];return a&&s&&(Ae=ii(a),Oe=ii(s),oe=1),(0,F.Z)({u_textureBlend:f==="normal"?0:1,segmentNumber:Q,u_line_type:aM[_]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:L,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:oe,u_sourceColor:Ae,u_targetColor:Oe},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,b.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:iM,fragmentShader:nM,triangulation:Ug,styleOption:{segmentNumber:f},inject:this.getInject(),depth:{enable:!1}});case 3:return d=b.sent,b.abrupt("return",[d]);case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:dn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta),q6=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),Zg=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),sM=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),p_=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),K6=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function uM(e){var t=lM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cM=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,fM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));
  
 float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hM=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_strokeWidth: 0.0;

uniform vec3 u_blur;
varying vec4 v_color;
varying vec4 v_stroke;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        gl_FragColor.rgb = mix(v_stroke.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,Wx=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_stroke;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pM=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,dM={solid:0,dash:1},Gx=function(e){(0,tt.Z)(r,e);var t=uM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"textureEventFlag",!1),(0,B.Z)((0,Ee.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,_=d===void 0?"solid":d,b=i.dashArray,A=b===void 0?[10,5,0,0]:b,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,L=P===void 0?100:P,Z=i.vertexHeightScale,Q=Z===void 0?20:Z,oe=i.strokeWidth,Ae=oe===void 0?0:oe,Oe=i.raisingHeight,Ve=Oe===void 0?0:Oe,rt=i.heightfixed,_t=rt===void 0?!1:rt,Bt=i.linearDir,ur=Bt===void 0?Zg.VERTICAL:Bt,lr=i.blur,zr=lr===void 0?[1,1,1]:lr;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var un=0,Rn=[0,0,0,0],Bi=[0,0,0,0];return a&&s&&(Rn=ii(a),Bi=ii(s),un=1),(0,F.Z)({u_textureBlend:f===sM.NORMAL?0:1,u_line_type:dM[_],u_dash_array:A,u_blur:zr,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:L,u_textSize:[1024,this.iconService.canvasHeight||128],u_strokeWidth:Ae,u_linearDir:ur===Zg.VERTICAL?1:0,u_linearColor:un,u_sourceColor:Rn,u_targetColor:Bi,u_heightfixed:Number(_t),u_vertexScale:Q,u_raisingHeight:Number(Ve)},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,d=this.getShaders(),_=d.frag,b=d.vert,A=d.type,this.layer.triangulation=Bf,P.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:b,fragmentShader:_,triangulation:Bf,inject:this.getInject(),depth:{enable:f}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType;return l==="dash"?{frag:cM,vert:fM,type:"Dash"}:a&&s?{frag:pM,vert:Wx,type:"Linear"}:{frag:hM,vert:Wx,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:dn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,f,d,_,b){return b===void 0?[f[3],10]:[f[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,f,d,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta);function vM(e){var t=mM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,_M=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Q6=di.isNumber,yM=function(e){(0,tt.Z)(r,e);var t=vM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var f=n.layer.getLayerConfig(),d=f.rampColors,_=na(d);n.colorTexture=l({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.vertexHeightScale,f=l===void 0?20:l,d=i.raisingHeight,_=d===void 0?0:d,b=i.heightfixed,A=b===void 0?!1:b,w=i.linearDir,I=w===void 0?Zg.VERTICAL:w;return this.rendererService.getDirty()&&this.colorTexture.bind(),(0,F.Z)({u_linearDir:I===Zg.VERTICAL?1:0,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:f,u_raisingHeight:Number(_)},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,this.layer.triangulation=c_,b.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:_M,fragmentShader:gM,triangulation:c_,inject:this.getInject(),depth:{enable:f}});case 4:return d=b.sent,b.abrupt("return",[d]);case 6:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:dn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l,f,d,_){return _===void 0?[l[3],10]:[l[3],_]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,l){return[l[4]]}}})}}]),r}(Ta);function xM(e){var t=bM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,SM=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
varying vec4 v_color;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Xx=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,J6=di.isNumber,AM=function(e){(0,tt.Z)(r,e);var t=xM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.sourceColor,f=i.targetColor,d=i.vertexHeightScale,_=d===void 0?20:d,b=0,A=[0,0,0,0],w=[0,0,0,0];return l&&f&&(A=ii(l),w=ii(f),b=1),(0,F.Z)({u_linearColor:b,u_sourceColor:A,u_targetColor:w,u_vertexScale:_},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor;return a&&s?{frag:SM,vert:Xx,type:"lineSimpleLinear"}:{frag:EM,vert:Xx,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,A.next=3,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,triangulation:pC,inject:this.getInject(),primitive:W.LINES,depth:{enable:!1},pick:!1});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:dn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(Ta);function TM(e){var t=wM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CM=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,RM=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,MM=function(e){(0,tt.Z)(r,e);var t=TM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.heightfixed,_=d===void 0?!1:d,b=i.lineTexture,A=b===void 0?!1:b,w=i.iconStep,I=w===void 0?100:w,P=i.iconStepCount,L=P===void 0?1:P;this.rendererService.getDirty()&&this.texture.bind();var Z=0,Q=[0,0,0,0],oe=[0,0,0,0];return a&&s&&(Q=ii(a),oe=ii(s),Z=1),(0,F.Z)({u_heightfixed:Number(_),u_textureBlend:f==="normal"?0:1,u_texture:this.texture,u_line_texture:A?1:0,u_iconStepCount:L,u_icon_step:I,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Z,u_sourceColor:Q,u_targetColor:oe},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:RM,fragmentShader:CM,triangulation:c_,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:dn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:dn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,f,d,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:dn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta),IM={arc:SR,arc3d:PR,greatcircle:oM,wall:MM,line:Gx,simple:AM,linearline:yM,earthArc3d:UR,flowline:eM},PM=IM;function OM(e){var t=DM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function DM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d_=function(e){(0,tt.Z)(r,e);var t=OM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","LineLayer"),(0,B.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","thetaOffset"]),(0,B.Z)((0,Ee.Z)(n),"arrowInsertCount",0),(0,B.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new PM[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,F.Z)({},s);s.coordinates.map(function(f){a.push((0,F.Z)((0,F.Z)({},l),{},{coordinates:f}))})}else a.push(s)}),a}}]),r}(Tp);function FM(e){var t=kM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function kM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BM=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,LM=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function $x(e){var t=e.coordinates;return{vertices:(0,Wt.Z)(t),indices:[0],size:t.length}}var NM=function(e){(0,tt.Z)(r,e);var t=FM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.offsets,f=l===void 0?[0,0]:l,d=i.blend,_=i.strokeOpacity,b=_===void 0?1:_,A=i.strokeWidth,w=A===void 0?0:A,I=i.stroke,P=I===void 0?"#fff":I;return{u_additive:d==="additive"?1:0,u_opacity:s,u_offsets:f,u_stroke_opacity:b,u_stroke_width:w,u_stroke_color:ii(P)}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=$x,f.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:LM,fragmentShader:BM,triangulation:$x,depth:{enable:!1},primitive:W.POINTS});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ta);function UM(e){var t=zM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function zM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,VM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,jM=di.isNumber,HM=function(e){(0,tt.Z)(r,e);var t=UM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"raiseCount",0),(0,B.Z)((0,Ee.Z)(n),"raiseRepeat",0),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,f=l===void 0?1:l,d=i.sourceColor,_=i.targetColor,b=i.pickLight,A=b===void 0?!1:b,w=i.heightfixed,I=w===void 0?!1:w,P=i.opacityLinear,L=P===void 0?{enable:!1,dir:"up"}:P,Z=i.lightEnable,Q=Z===void 0?!0:Z,oe=0,Ae=[0,0,0,0],Oe=[0,0,0,0];if(d&&_&&(Ae=ii(d),Oe=ii(_),oe=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Ve=s.speed,rt=Ve===void 0?.01:Ve;this.raiseCount+=rt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(I),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:jM(f)?f:1,u_linearColor:oe,u_sourceColor:Ae,u_targetColor:Oe,u_opacitylinear:Number(L.enable),u_opacitylinear_dir:L.dir==="up"?1:0,u_lightEnable:Number(Q)}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,f=l===void 0?1:l,this.raiseRepeat=f,b.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:VM,fragmentShader:ZM,triangulation:l_,depth:{enable:!0},cull:{enable:!0,face:jo(this.mapService.version)},blend:this.getBlend()});case 4:return d=b.sent,b.abrupt("return",[d]);case 6:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:dn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=Gs(a.coordinates);return Rx([s[0],s[1]])}}})}}]),r}(Ta);function WM(e){var t=GM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XM=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$M=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,YM=function(e){(0,tt.Z)(r,e);var t=WM(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.strokeOpacity,f=l===void 0?1:l,d=i.strokeWidth,_=d===void 0?0:d,b=i.stroke,A=b===void 0?"rgba(0,0,0,0)":b,w=i.blend,I=i.blur,P=I===void 0?0:I;return{u_blur:P,u_additive:w==="additive"?1:0,u_opacity:s,u_stroke_opacity:f,u_stroke_width:_,u_stroke_color:ii(A)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=Fx,f.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:$M,fragmentShader:XM,triangulation:Fx,depth:{enable:!0},blend:this.getBlend()});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,f,d){var _=(0,K.Z)(f,3),b=_[0],A=_[1],w=_[2],I=wa.fromValues(0,0,1),P=wa.fromValues(b,0,w),L=b>=0?wa.angle(I,P):Math.PI*2-wa.angle(I,P),Z=Math.PI*2-Math.asin(A/100),Q=Vt();op(Q,Q,L),eu(Q,Q,Z);var oe=wa.fromValues(1,1,0);wa.transformMat4(oe,oe,Q),wa.normalize(oe,oe);var Ae=wa.fromValues(-1,1,0);wa.transformMat4(Ae,Ae,Q),wa.normalize(Ae,Ae);var Oe=wa.fromValues(-1,-1,0);wa.transformMat4(Oe,Oe,Q),wa.normalize(Oe,Oe);var Ve=wa.fromValues(1,-1,0);wa.transformMat4(Ve,Ve,Q),wa.normalize(Ve,Ve);var rt=[].concat((0,Wt.Z)(oe),(0,Wt.Z)(Ae),(0,Wt.Z)(Oe),(0,Wt.Z)(Ve)),_t=d%4*3;return[rt[_t],rt[_t+1],rt[_t+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:dn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.layer.getLayerConfig().shape2d,_=d.indexOf(f);return[_]}}})}}]),r}(Ta);function qM(e){var t=KM();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function KM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QM=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,JM=`#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,Yx=function(e){(0,tt.Z)(r,e);var t=qM(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"raiseCount",0),(0,B.Z)((0,Ee.Z)(n),"raiseRepeat",0),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,F.Z)((0,F.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,f=i.targetColor,d=i.pickLight,_=d===void 0?!1:d,b=i.heightfixed,A=b===void 0?!1:b,w=i.opacityLinear,I=w===void 0?{enable:!1,dir:"up"}:w,P=i.lightEnable,L=P===void 0?!0:P,Z=0,Q=[0,0,0,0],oe=[0,0,0,0];if(l&&f&&(Q=ii(l),oe=ii(f),Z=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var Ae=s.speed,Oe=Ae===void 0?.01:Ae;this.raiseCount+=Oe,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var Ve={u_pickLight:Number(_),u_heightfixed:Number(A),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:Z,u_sourceColor:Q,u_targetColor:oe,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(L)},rt=this.getUniformsBufferInfo(Ve);return rt}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!0:l,d=s.animateOption.repeat,_=d===void 0?1:d,this.raiseRepeat=_,this.initUniformsBuffer(),w.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:JM,fragmentShader:QM,triangulation:l_,inject:this.getInject(),cull:{enable:!0,face:jo(this.mapService.version)},depth:{enable:f}});case 5:return b=w.sent,w.abrupt("return",[b]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ss.SIZE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ss.NORMAL,buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:dn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ss.EXTRUDE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a){var s=Gs(a.coordinates);return[s[0],s[1],0]}}})}}]),r}(Ta);function eI(e){var t=tI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function tI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qx=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rI=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,v_=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 10) in float a_Shape;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,Kx=function(e){(0,tt.Z)(r,e);var t=eI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,_=i.blur,b=_===void 0?0:_,A=i.raisingHeight,w=A===void 0?0:A,I=i.heightfixed,P=I===void 0?!1:I,L=i.unit,Z=L===void 0?"pixel":L,Q=(0,F.Z)({u_blur_height_fixed:[b,Number(w),Number(P)],u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:f,u_size_unit:p_[Z]},this.getStyleAttribute()),oe=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(oe.u_stroke),(0,Wt.Z)(oe.u_offsets),[oe.u_opacity,oe.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(Q.u_blur_height_fixed),[Q.u_stroke_width,Q.u_stroke_opacity,Q.u_additive,Q.u_size_unit])).buffer)}),Q}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Jh)}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w,I,P;return ve().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,f=l===void 0?{enable:!1}:l,d=this.getShaders(f),_=d.frag,b=d.vert,A=d.type,this.layer.triangulation=Jh,w=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),I=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),this.uniformBuffers.push(w,I),Z.next=8,this.layer.buildLayerModel({moduleName:A,vertexShader:b,fragmentShader:_,inject:this.getInject(),triangulation:Jh,depth:{enable:!1}});case 8:return P=Z.sent,Z.abrupt("return",[P]);case 10:case"end":return Z.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:qx,vert:v_,type:"pointWave"};default:return{frag:qx,vert:v_,type:"pointWave"}}else return{frag:rI,vert:v_,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:dn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ss.EXTRUDE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=d%4*3;return[_[b],_[b+1],_[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ss.SIZE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:dn.Attribute,descriptor:{name:"a_Shape",shaderLocation:Ss.SHAPE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.indexOf(f);return[d]}}})}}]),r}(Ta);function nI(e){var t=iI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function iI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aI=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,oI=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,sI=function(e){(0,tt.Z)(r,e);var t=nI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"meter2coord",1),(0,B.Z)((0,Ee.Z)(n),"isMeter",!1),(0,B.Z)((0,Ee.Z)(n),"radian",0),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d=i.unit,_=d===void 0?"pixel":d;return this.rendererService.getDirty()&&this.texture.bind(),(0,F.Z)({u_raisingHeight:Number(s),u_heightfixed:Number(f),u_size_unit:p_[_],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:oI,fragmentShader:aI,triangulation:Lg,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:jo(this.mapService.version)}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,b=d.y;return[_,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,f,d){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=d%4*3;return[_[b],_[b+1],_[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}})}}]),r}(Ta);function uI(e){var t=lI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function lI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cI=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,fI=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Qx=function(e){(0,tt.Z)(r,e);var t=uI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l;return this.rendererService.getDirty()&&this.texture.bind(),(0,F.Z)({u_raisingHeight:Number(s),u_heightfixed:Number(f),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:fI,fragmentShader:cI,triangulation:hC,inject:this.getInject(),depth:{enable:!1},primitive:W.POINTS});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},_=d.x,b=d.y;return[_,b]}}})}}]),r}(Ta);function hI(e){var t=pI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function pI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dI=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,vI=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function Jx(e){var t=e.coordinates;return{vertices:(0,Wt.Z)(t),indices:[0],size:t.length}}var eb=function(e){(0,tt.Z)(r,e);var t=hI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Wt.Z)(i.u_stroke),(0,Wt.Z)(i.u_offsets),[i.u_opacity,i.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([.5]).buffer)}),(0,F.Z)({u_size_scale:.5},i)}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.layer.triangulation=Jx,s=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),l=this.rendererService.createBuffer({data:new Float32Array(4),isUBO:!0}),this.uniformBuffers.push(s,l),_.next=6,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:vI,fragmentShader:dI,triangulation:Jx,inject:this.getInject(),depth:{enable:!1},primitive:W.POINTS,pick:!1});case 6:return f=_.sent,_.abrupt("return",[f]);case 8:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",shaderLocation:Ss.SIZE,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ta);function mI(e){var t=gI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function gI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _I=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,yI=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,xI=function(e){(0,tt.Z)(r,e);var t=mI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.blend,f=i.speed,d=f===void 0?1:f,_=i.unit,b=_===void 0?"pixel":_;return{u_size_unit:p_[b],u_speed:d,u_additive:l==="additive"?1:0,u_opacity:s}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:yI,fragmentShader:_I,triangulation:Lg,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:dn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f){var d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=f%4*3;return[d[_],d[_+1],d[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?5:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ta);function bI(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function EI(e,t){if(!!e){if(typeof e=="string")return tb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tb(e,t)}}function tb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var SI=function(){function e(t,r,n){(0,ye.Z)(this,e),(0,B.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(r/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Y.Z)(e,[{key:"insert",value:function(r,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(r,n,i,a,s){return this.queryHitTest(r,n,i,a,!1,s)}},{key:"hitTest",value:function(r,n,i,a,s){return this.queryHitTest(r,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(r,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(r,n,i,a,s,l){if(i<0||r>this.width||a<0||n>this.height)return s?!1:[];var f=[];if(r<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var d=0;d<this.boxKeys.length;d++)f.push({key:this.boxKeys[d],x1:this.bboxes[d*4],y1:this.bboxes[d*4+1],x2:this.bboxes[d*4+2],y2:this.bboxes[d*4+3]});return l?f.filter(l):f}var _={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,i,a,this.queryCell,f,_,l),s?f.length>0:f}},{key:"queryCell",value:function(r,n,i,a,s,l,f,d){var _=f.seenUids,b=this.boxCells[s];if(b!==null){var A=this.bboxes,w=bI(b),I;try{for(w.s();!(I=w.n()).done;){var P=I.value;if(!_.box[P]){_.box[P]=!0;var L=P*4;if(r<=A[L+2]&&n<=A[L+3]&&i>=A[L+0]&&a>=A[L+1]&&(!d||d(this.boxKeys[P]))){if(f.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[P],x1:A[L],y1:A[L+1],x2:A[L+2],y2:A[L+3]})}}}}catch(Z){w.e(Z)}finally{w.f()}}return!1}},{key:"forEachCell",value:function(r,n,i,a,s,l,f,d){for(var _=this.convertToXCellCoord(r),b=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),w=this.convertToYCellCoord(a),I=_;I<=A;I++)for(var P=b;P<=w;P++){var L=this.xCellCount*P+I;if(s.call(this,r,n,i,a,L,l,f,d))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),AI=SI,TI=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"viewportPadding",100),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new AI(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Y.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,i=r.y1+r.anchorPointY+this.viewportPadding,a=r.x2+r.anchorPointX+this.viewportPadding,s=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(r,n){var i={featureIndex:n};this.grid.insert(i,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,i){var a=bi(n,i,0,1),s=Cn(),l=vr.apply(ge,(0,Wt.Z)(r));return qi(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,i,a){return i>=0&&r<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function rb(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function wI(e,t){if(!!e){if(typeof e=="string")return nb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nb(e,t)}}function nb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ib(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function ab(e,t,r,n,i){if(!!i){var a=e[n],s=a.glyph;if(s)for(var l=t[s].advance*a.scale,f=(e[n].x+l)*i,d=r;d<=n;d++)e[d].x-=f}}function ob(e,t,r,n,i,a,s){var l=(t-r)*i,f=(-n*s+.5)*a,d=rb(e),_;try{for(d.s();!(_=d.n()).done;){var b=_.value;b.x+=l,b.y+=f}}catch(A){d.e(A)}finally{d.f()}}function CI(e,t,r,n,i,a,s){var l=-8,f=0,d=l,_=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;r.forEach(function(Q){if(Q.split("").forEach(function(Ae){var Oe=t[Ae],Ve=0;Oe&&(b.push({glyph:Ae,x:f,y:d+Ve,vertical:!1,scale:1,metrics:Oe}),f+=Oe.advance+s)}),b.length!==w){var oe=f-s;_=Math.max(oe,_),ab(b,t,w,b.length-1,A)}f=0,d-=n+5});var I=ib(i),P=I.horizontalAlign,L=I.verticalAlign;ob(b,A,P,L,_,n,r.length);var Z=d-l;e.top+=-L*Z,e.bottom=e.top-Z,e.left+=-P*_,e.right=e.left+_}function RI(e,t,r,n,i,a,s){var l=-8,f=0,d=l,_=0,b=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=b.length;r.forEach(function(Q){var oe=t[Q],Ae=0;if(oe&&(b.push({glyph:Q,x:oe.advance/2,y:d+Ae,vertical:!1,scale:1,metrics:oe}),f+=oe.advance+s),b.length!==w){var Oe=f-s;_=Math.max(Oe,_),ab(b,t,w,b.length-1,A)}f=0,d-=n+5});var I=ib(i),P=I.horizontalAlign,L=I.verticalAlign;ob(b,A,P,L,_,n,r.length);var Z=d-l;e.top+=-L*Z,e.bottom=e.top-Z,e.left+=-P*_,e.right=e.left+_}function MI(e,t,r,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,f=e.split(`
`),d=[],_={positionedGlyphs:d,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:f.length,text:e};return l?RI(_,t,f,r,n,i,a):CI(_,t,f,r,n,i,a),d.length?_:!1}function II(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=rb(i),l;try{for(s.s();!(l=s.n()).done;){var f=l.value,d=f.metrics,_=4,b=d.advance*f.scale/2,A=r?[f.x+b,f.y]:[0,0],w=r?[0,0]:[f.x+b+t[0],f.y+t[1]],I=(0-_)*f.scale-b+w[0],P=(0-_)*f.scale+w[1],L=I+d.width*f.scale,Z=P+d.height*f.scale,Q={x:I,y:P},oe={x:L,y:P},Ae={x:I,y:Z},Oe={x:L,y:Z};a.push({tl:Q,tr:oe,bl:Ae,br:Oe,tex:d,glyphOffset:A})}}catch(Ve){s.e(Ve)}finally{s.f()}return a}function PI(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=OI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function OI(e,t){if(!!e){if(typeof e=="string")return sb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sb(e,t)}}function sb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DI(e){var t=FI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function FI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,lb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,Em=di.isEqual;function cb(e){var t=this,r=e.id,n=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var a=t.glyphInfoMap[r].centroid,s=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[r].glyphQuads.forEach(function(l,f){n.push.apply(n,(0,Wt.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,Wt.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,Wt.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,Wt.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+f*4,1+f*4,2+f*4,2+f*4,3+f*4,0+f*4)}),{vertices:n,indices:i,size:7}}var fb=function(e){(0,tt.Z)(r,e);var t=DI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"glyphInfoMap",{}),(0,B.Z)((0,Ee.Z)(n),"currentZoom",-1),(0,B.Z)((0,Ee.Z)(n),"textureHeight",0),(0,B.Z)((0,Ee.Z)(n),"textCount",0),(0,B.Z)((0,Ee.Z)(n),"preTextStyle",{}),(0,B.Z)((0,Ee.Z)(n),"mapping",(0,Ot.Z)(ve().mark(function l(){return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n.initGlyph(),n.updateTexture(),d.next=4,n.reBuildModel();case 4:case"end":return d.stop()}},l)}))),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,f=l===void 0?0:l,d=i.halo,_=d===void 0?.5:d,b=i.gamma,A=b===void 0?2:b,w=i.raisingHeight,I=w===void 0?0:w,P=this.getFontServiceMapping(),L=this.getFontServiceCanvas();return P&&Object.keys(P).length!==this.textCount&&L&&(this.updateTexture(),this.textCount=Object.keys(P).length),this.preTextStyle=this.getTextStyle(),(0,F.Z)({u_raisingHeight:Number(I),u_stroke_width:f,u_stroke_color:ii(s),u_sdf_map:this.texture,u_halo_blur:_,u_gamma_scale:A,u_sdf_map_size:[(L==null?void 0:L.width)||1,(L==null?void 0:L.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,f=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),f||this.filterGlyphs(),b.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:lb,fragmentShader:ub,inject:this.getInject(),triangulation:cb.bind(this),depth:{enable:!1}});case 6:return d=b.sent,b.abrupt("return",[d]);case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w,I,P,L,Z;return ve().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,f=l===void 0?!1:l,d=s.textAnchor,_=d===void 0?"center":d,b=s.textOffset,A=s.padding,w=s.fontFamily,I=s.fontWeight,!(!Em(A,this.preTextStyle.padding)||!Em(b,this.preTextStyle.textOffset)||!Em(_,this.preTextStyle.textAnchor)||!Em(w,this.preTextStyle.fontFamily)||!Em(I,this.preTextStyle.fontWeight))){oe.next=5;break}return oe.next=4,this.mapping();case 4:return oe.abrupt("return",!0);case 5:if(!f){oe.next=7;break}return oe.abrupt("return",!1);case 7:if(P=this.mapService.getZoom(),L=this.mapService.getBounds(),Z=fa(this.extent,L),!(Math.abs(this.currentZoom-P)>.5||!Z||f!==this.preTextStyle.textAllowOverlap)){oe.next=14;break}return oe.next=13,this.reBuildModel();case 13:return oe.abrupt("return",!0);case 14:return oe.abrupt("return",!1);case 15:case"end":return oe.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:dn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:dn.Attribute,descriptor:{name:"a_tex",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return ou(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,b=_===void 0?"":_;b=b.toString();var A=PI(b),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;f.indexOf(I)===-1&&f.push(I)}}catch(P){A.e(P)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var _=d.shape,b=_===void 0?"":_;b="".concat(b),f.indexOf(b)===-1&&f.push(b)}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l,d=i.textAllowOverlap,_=d===void 0?!1:d,b=i.padding,A=b===void 0?[0,0]:b,w=i.textAnchor,I=w===void 0?"center":w,P=i.textOffset,L=P===void 0?[0,0]:P,Z=i.opacity,Q=Z===void 0?1:Z,oe=i.strokeOpacity,Ae=oe===void 0?1:oe,Oe=i.strokeWidth,Ve=Oe===void 0?0:Oe,rt=i.stroke,_t=rt===void 0?"#000":rt;return{fontWeight:s,fontFamily:f,textAllowOverlap:_,padding:A,textAnchor:I,textOffset:L,opacity:Q,strokeOpacity:Ae,strokeWidth:Ve,stroke:_t}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),f=l.spacing,d=f===void 0?2:f,_=l.textAnchor,b=_===void 0?"center":_,A=l.textOffset,w=this.rawEncodeData;this.glyphInfo=w.map(function(I){var P=I.shape,L=P===void 0?"":P,Z=I.id,Q=I.size,oe=Q===void 0?1:Q,Ae=I.textOffset?I.textOffset:A||[0,0],Oe=I.textAnchor?I.textAnchor:b||"center",Ve=MI(L.toString(),s,oe,Oe,"left",d,Ae,i),rt=II(Ve,Ae,!1);return I.shaping=Ve,I.glyphQuads=rt,I.centroid=Gs(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?Gs(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[Z]={shaping:Ve,glyphQuads:rt,centroid:Gs(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(f,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(f,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,f=a.textAllowOverlap,d=f===void 0?!1:f;if(!d){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),b=_.width,A=_.height,w=new TI(b,A),I=this.glyphInfo.filter(function(P){var L=P.shaping,Z=P.id,Q=Z===void 0?0:Z,oe=P.version==="GAODE2.x"?P.originCentroid:P.centroid,Ae=P.size,Oe=Ae/16,Ve=i.mapService.lngLatToContainer(oe),rt=w.placeCollisionBox({x1:L.left*Oe-l[0],x2:L.right*Oe+l[0],y1:L.top*Oe-l[1],y2:L.bottom*Oe+l[1],anchorPointX:Ve.x,anchorPointY:Ve.y}),_t=rt.box;return _t&&_t.length?(w.insertCollisionBox(_t,Q),!0):!1});I.forEach(function(P){i.glyphInfoMap[P.id]=P})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:W.LINEAR,min:W.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.filterGlyphs(),f.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:lb,fragmentShader:ub,triangulation:cb.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=f.sent,this.layer.models=[s];case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Ta),kI={fillImage:sI,fill:Kx,radar:xI,image:Qx,normal:eb,simplePoint:NM,extrude:Yx,text:fb,earthFill:YM,earthExtrude:HM},BI=kI;function LI(e,t){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=NI(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){r=r.call(e)},n:function(){var d=r.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw l}}}}function NI(e,t){if(!!e){if(typeof e=="string")return hb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hb(e,t)}}function hb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function UI(e){var t=zI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function zI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vg=function(e){(0,tt.Z)(r,e);var t=UI(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","PointLayer"),(0,B.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,B.Z)((0,Ee.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,B.Z)((0,Ee.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new BI[s](this),f.next=5,this.initLayerModels();case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),f=l.shape2d,d=this.iconService.getIconMap();if(a&&(f==null?void 0:f.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var _=LI(s),b;try{for(_.s();!(b=_.n()).done;){var A=b.value;if(typeof A=="string"&&d.hasOwnProperty(A))return"image"}}catch(w){_.e(w)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=a.billboard,d=f===void 0?!0:f,_=this.iconService.getIconMap(),b=i.find(function(w){return w.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||d===!1?"fillImage":(s==null?void 0:s.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Tp);function ZI(e){var t=VI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function VI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jI=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,HI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,WI=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,GI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,XI=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,$I=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,YI=function(e){(0,tt.Z)(r,e);var t=ZI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,s=a===void 0?!1:a,l=i.raisingHeight,f=l===void 0?0:l,d=i.topsurface,_=d===void 0?!0:d,b=i.sidesurface,A=b===void 0?!0:b,w=i.sourceColor,I=i.targetColor,P=0,L=[1,1,1,1],Z=[1,1,1,1];return w&&I&&(L=ii(w),Z=ii(I),P=1),(0,F.Z)({u_topsurface:Number(_),u_sidesurface:Number(A),u_heightfixed:Number(s),u_raisingHeight:Number(f),u_linearColor:P,u_sourceColor:L,u_targetColor:Z,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,A.next=3,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:h_});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:WI,vert:GI,type:"polygonExtrudeTexture"}:a?{frag:XI,vert:$I,type:"polygonExtrudePickLight"}:{frag:jI,vert:HI,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],f=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var d=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),_=(0,K.Z)(d,2),b=_[0],A=_[1],w=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),I=(0,K.Z)(w,2),P=I[0],L=I[1];l=P-b,f=L-A,a=[b,A,P,L]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:dn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(Q,oe,Ae){var Oe=Ae[0],Ve=Ae[1];return[(Oe-a[0])/l,(Ve-a[1])/f,Ae[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(Q,oe,Ae,Oe,Ve){return Ve}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(Q){var oe=Q.size,Ae=oe===void 0?10:oe;return Array.isArray(Ae)?[Ae[0]]:[Ae]}}})}},{key:"loadTexture",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s=this,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=this.layer.getLayerConfig(),f=l.mapTexture,d=this.rendererService.createTexture2D,this.texture=d({height:0,width:0}),!f){b.next=5;break}return b.abrupt("return",new Promise(function(A,w){var I=new Image;I.crossOrigin="anonymous",I.src=f,I.onload=function(){return s.texture=d({data:I,width:I.width,height:I.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),A(null)},I.onerror=function(){w(new Error("image load error"))}}));case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),r}(Ta);function qI(e){var t=KI();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function KI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QI=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,eP=function(e){(0,tt.Z)(r,e);var t=qI(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){return(0,F.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,A.next=3,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:h_});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:QI,vert:JI,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:dn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:dn.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(Ta);function tP(e){var t=rP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function rP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nP=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iP=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,aP=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,oP=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,sP=function(e){(0,tt.Z)(r,e);var t=tP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,f=l===void 0?{enable:!1,dir:"in"}:l;return(0,F.Z)({u_raisingHeight:Number(s),u_opacitylinear:Number(f.enable),u_dir:f.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=this.getModelParams(),l=s.frag,f=s.vert,d=s.triangulation,_=s.type,this.layer.triangulation=d,w.next=4,this.layer.buildLayerModel({moduleName:_,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:d,primitive:W.TRIANGLES,depth:{enable:!1}});case 4:return b=w.sent,w.abrupt("return",[b]);case 6:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:dn.Attribute,descriptor:{name:"a_linear",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(f,d,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:iP,vert:aP,type:"polygonLinear",triangulation:mC}:{frag:nP,vert:oP,type:"polygonFill",triangulation:_h}}}]),r}(Ta);function uP(e){var t=lP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function lP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cP=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,fP=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,hP=di.isNumber,pP=function(e){(0,tt.Z)(r,e);var t=uP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.watercolor,f=l===void 0?"#6D99A8":l,d=i.watercolor2,_=d===void 0?"#0F121C":d;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:ii(f),u_watercolor2:ii(_),u_opacity:hP(s)?s:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:fP,fragmentShader:cP,triangulation:f_,primitive:W.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,K.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,b=d-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:dn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(w,I,P,L){var Z=w.version==="GAODE2.x"?w.originCoordinates[0][L]:P,Q=(0,K.Z)(Z,2),oe=Q[0],Ae=Q[1];return[(oe-s)/_,(Ae-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(d){i.texture1=f(d[0]),i.texture2=f(d[1]),i.texture3=f(d[2]),i.layerService.reRender()});function l(d){var _=0,b=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(w){var I=new Image;I.crossOrigin="",I.src=w,b.push(I),I.onload=function(){_++,_===3&&d(b)}})}function f(d){return a({data:d,width:d.width,height:d.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR})}}}]),r}(Ta);function dP(e){var t=vP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function vP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mP=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,gP=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,_P=di.isNumber,yP=function(e){(0,tt.Z)(r,e);var t=dP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.speed,f=l===void 0?.5:l;return{u_texture:this.texture,u_speed:f,u_opacity:_P(s)?s:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:gP,fragmentShader:mP,triangulation:f_,primitive:W.TRIANGLES,depth:{enable:!1}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,K.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],_=f-s,b=d-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:dn.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(w,I,P,L){var Z=w.version==="GAODE2.x"?w.originCoordinates[0][L]:P,Q=(0,K.Z)(Z,2),oe=Q[0],Ae=Q[1];return[(oe-s)/_,(Ae-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var f=new Image;f.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),f.src=s):f.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",f.onload=function(){i.texture=l({data:f,width:f.width,height:f.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR}),i.layerService.reRender()}}}]),r}(Ta),xP={fill:sP,line:Gx,extrude:YI,text:fb,point_fill:Kx,point_image:Qx,point_normal:eb,point_extrude:Yx,water:yP,ocean:pP,extrusion:eP},bP=xP;function EP(e){var t=SP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function SP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jg=function(e){(0,tt.Z)(r,e);var t=EP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","PolygonLayer"),(0,B.Z)((0,Ee.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new bP[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=this.iconService.getIconMap(),d=i.find(function(b){return b.hasOwnProperty("shape")});if(d){var _=d.shape;return _==="dot"?"point_normal":(s==null?void 0:s.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":f.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),r}(Tp);function AP(e){var t=TP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function TP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wP=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,CP=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,pb=function(e){(0,tt.Z)(r,e);var t=AP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,f=l===void 0?!0:l,d=i.clampHigh,_=d===void 0?!0:d,b=i.noDataValue,A=b===void 0?-9999999:b,w=i.domain,I=i.rampColors,P=w||Da(I);return this.colorTexture=this.layer.textureService.getColorTexture(I,P),{u_opacity:s||1,u_texture:this.texture,u_domain:P,u_clampLow:f,u_clampHigh:typeof _!="undefined"?_:f,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(s.data)){A.next=4;break}return A.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return A.next=6,s.data;case 6:return l=A.sent,f=l.rasterData,d=l.width,_=l.height,A.abrupt("return",{data:Array.from(f),width:d,height:_});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],P.next=5,this.getRasterData(f);case 5:return d=P.sent,_=d.data,b=d.width,A=d.height,this.texture=l({data:_,width:b,height:A,format:W.LUMINANCE,type:W.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:CP,fragmentShader:wP,triangulation:Ng,primitive:W.TRIANGLES,depth:{enable:!1}});case 12:return w=P.sent,P.abrupt("return",[w]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Ta),RP=["data"],MP=["rasterData"];function IP(e){var t=PP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function PP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OP=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,DP=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,FP=function(e){(0,tt.Z)(r,e);var t=IP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"dataOption",{}),n}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,f=l===void 0?0:l,d=this.dataOption,_=d.rMinMax,b=d.gMinMax,A=d.bMinMax;return{u_opacity:s||1,u_texture:this.texture,u_noDataValue:f,u_rminmax:_,u_gminmax:b,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!Array.isArray(s.data)){w.next=4;break}return l=s.data,f=(0,Fl.Z)(s,RP),this.dataOption=f,w.abrupt("return",(0,F.Z)({data:l},f));case 4:return w.next=6,s.data;case 6:if(d=w.sent,_=d.rasterData,b=(0,Fl.Z)(d,MP),this.dataOption=b,!Array.isArray(_)){w.next=14;break}return w.abrupt("return",(0,F.Z)({data:_},b));case 14:return w.abrupt("return",(0,F.Z)({data:Array.from(_)},b));case 15:case"end":return w.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],P.next=5,this.getRasterData(f);case 5:return d=P.sent,_=d.data,b=d.width,A=d.height,this.texture=l({data:_,width:b,height:A,format:W.RGB,type:W.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:OP,fragmentShader:DP,triangulation:Ng,primitive:W.TRIANGLES,depth:{enable:!1}});case 12:return w=P.sent,P.abrupt("return",[w]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Ta);function kP(e){var t=BP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function BP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LP=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,NP=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,UP=function(e){(0,tt.Z)(r,e);var t=kP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,f=i.clampHigh,d=f===void 0?!0:f,_=i.noDataValue,b=_===void 0?-9999999:_,A=i.domain,w=i.rampColors,I=i.colorTexture,P=i.rScaler,L=P===void 0?6553.6:P,Z=i.gScaler,Q=Z===void 0?25.6:Z,oe=i.bScaler,Ae=oe===void 0?.1:oe,Oe=i.offset,Ve=Oe===void 0?1e4:Oe,rt=A||Da(w),_t=I;return I?this.layer.textureService.setColorTexture(I,w,rt):_t=this.layer.textureService.getColorTexture(w,rt),{u_opacity:a||1,u_texture:this.texture,u_domain:rt,u_clampLow:l,u_clampHigh:typeof d!="undefined"?d:l,u_noDataValue:b,u_unpack:[L,Q,Ae,Ve],u_colorTexture:_t}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,b.next=4,s.data.images;case 4:return f=b.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,min:W.LINEAR,mag:W.LINEAR}),b.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:NP,fragmentShader:LP,triangulation:Ng,primitive:W.TRIANGLES,depth:{enable:!1}});case 8:return d=b.sent,b.abrupt("return",[d]);case 10:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:dn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),r}(Ta),zP={raster:pb,rasterRgb:FP,raster3d:pb,rasterTerrainRgb:UP},ZP=zP;function VP(e){var t=jP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function jP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hg=function(e){(0,tt.Z)(r,e);var t=VP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","RasterLayer"),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new ZP[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Tp);function HP(e){var t=WP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function WP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GP=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,XP=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,$P=di.isNumber,YP=function(e){(0,tt.Z)(r,e);var t=HP(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,f=l===void 0?"#000":l;return{u_opacity:$P(s)?s:0,u_color:ii(f)}}},{key:"initModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:XP,fragmentShader:GP,triangulation:f_,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Ta),qP={fill:YP},KP=qP;function QP(e){var t=JP();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function JP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=function(e){(0,tt.Z)(r,e);var t=QP(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"type","MaskLayer"),n}return(0,Y.Z)(r,[{key:"buildModels",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new KP[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Tp),vb,mb,gb,_b,Wg,yb,xb,e5=di.cloneDeep,t5=(vb=(0,ot.b2)(),mb=(0,ot.f3)(pt.IMapService),gb=(0,ot.f3)(pt.IFontService),vb(_b=(Wg=function(){function e(){(0,ye.Z)(this,e),an(this,"mapService",yb,this),an(this,"fontService",xb,this)}return(0,Y.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,Ot.Z)(ve().mark(function s(){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:r.log(Es.MappingStart,kt.INIT),i.generateMaping(r,{styleAttributeService:a}),r.log(Es.MappingEnd,kt.INIT);case 3:case"end":return f.stop()}},s)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Ot.Z)(ve().mark(function l(f){var d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f){b.next=2;break}return b.abrupt("return",f);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(Es.MappingStart,kt.UPDATE),d=i.generateMaping(r,{styleAttributeService:a}),r.log(Es.MappingEnd,kt.UPDATE),b.abrupt("return",d);case 7:case"end":return b.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=r.getSource();if(!(r.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),d=s.data.dataArray;if(!(Array.isArray(d)&&d.length===0)){var _=l.filter(function(w){return w.needRemapping}),b=d;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(b=d.filter(function(w){return i.applyAttributeMapping(f,w)[0]})),_.length){var A=i.mapping(r,_,b,r.getEncodedData());r.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(r,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),f=r.getSource().data.dataArray,d=f;l!=null&&l.scale&&(d=f.filter(function(b){return i.applyAttributeMapping(l,b)[0]})),d=r.processData(d);var _=this.mapping(r,s,d,void 0);return r.setEncodedData(_),f.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,i,a){var s=this,l=n.filter(function(d){return d.scale!==void 0}).filter(function(d){return d.name!=="filter"}),f=i.map(function(d,_){var b=a?a[_]:{},A=(0,F.Z)({id:d._id,coordinates:d.coordinates},b);return l.forEach(function(w){var I=s.applyAttributeMapping(w,d);(w.name==="color"||w.name==="stroke")&&(I=I.map(function(P){return ii(P)})),A[w.name]=Array.isArray(I)&&I.length===1?I[0]:I,w.name==="shape"&&(A.shape=s.fontService.getIconFontKey(A[w.name]))}),A});return n.forEach(function(d){d.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,r),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var i=this;if(r.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;r.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=e5(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version==="SIMPLE"&&r.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var i=[];return r.map(function(s){var l=[];s.map(function(f){l.push(n.mapService.simpleMapCoord.unproject(f))}),i.push(l)}),i}else{var a=[];return r.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(r,n){var i;if(!r.scale)return[];var a=(r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(f){var d,_=f.field;(n.hasOwnProperty(_)||((d=r.scale)===null||d===void 0?void 0:d.type)==="variable")&&s.push(n[_])});var l=r.mapping?r.mapping(s):[];return l}},{key:"getArrowPoints",value:function(r,n){var i=[n[0]-r[0],n[1]-r[1]],a=zu(i),s=[r[0]+a[0]*1e-4,r[1]+a[1]*1e-4];return s}}]),e}(),yb=jr(Wg.prototype,"mapService",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xb=jr(Wg.prototype,"fontService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wg))||_b),bb,Eb,r5=(bb=(0,ot.b2)(),bb(Eb=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(pt.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,Ot.Z)(ve().mark(function i(){var a,s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(r.log(Es.SourceInitStart,kt.INIT),a=r.getSource(),a||(s=r.sourceOption||r.defaultSourceConfig,l=s.data,f=s.options,a=new rx(l,f),r.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(r),r.log(Es.SourceInitEnd,kt.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(b){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(r),r.log(Es.SourceInitEnd,kt.INIT)),b(null)})});case 10:case"end":return _.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Ot.Z)(ve().mark(function i(){var a,s,l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,l=a||s,d.abrupt("return",l);case 5:case"end":return d.stop()}},i)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,f=r.dataState.dataSourceNeedUpdate;return i&&f&&n.updateClusterData(Math.floor(l)),i&&Math.abs(r.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||Eb);function m_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Sb(e){return e.length===1&&(e=n5(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function n5(e){return function(t,r){return m_(e(t),r)}}var Ab=Sb(m_),i5=Ab.right,eN=Ab.left,Gg=i5;function Tb(e,t){var r=e.length,n=-1,i,a,s;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<r;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<r;)(i=t(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var wb=Array.prototype,tN=wb.slice,rN=wb.map,g_=Math.sqrt(50),__=Math.sqrt(10),y_=Math.sqrt(2);function Cb(e,t,r){var n,i=-1,a,s,l;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(l=Xg(e,t,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),t=Math.floor(t/l),s=new Array(a=Math.ceil(t-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),t=Math.ceil(t*l),s=new Array(a=Math.ceil(e-t+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function Xg(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=g_?10:a>=__?5:a>=y_?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=g_?10:a>=__?5:a>=y_?2:1)}function x_(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=g_?i*=10:a>=__?i*=5:a>=y_&&(i*=2),t<e?-i:i}function nN(){var e=identity,t=extent,r=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=t(f),_=d[0],b=d[1],A=r(f,_,b);Array.isArray(A)||(A=tickStep(_,b,A),A=range(Math.ceil(_/A)*A,b,A));for(var w=A.length;A[0]<=_;)A.shift(),--w;for(;A[w-1]>b;)A.pop(),--w;var I=new Array(w+1),P;for(a=0;a<=w;++a)P=I[a]=[],P.x0=a>0?A[a-1]:_,P.x1=a<w?A[a]:b;for(a=0;a<s;++a)l=f[a],_<=l&&l<=b&&I[bisect(A,l,0,w)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(t=typeof i=="function"?i:constant([i[0],i[1]]),n):t},n.thresholds=function(i){return arguments.length?(r=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):r},n}function iN(e,t,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-t)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function a5(e){return e===null?NaN:+e}function o5(e,t,r){if(r==null&&(r=a5),!!(n=e.length)){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,a=Math.floor(i),s=+r(e[a],a,e),l=+r(e[a+1],a+1,e);return s+(l-s)*(i-a)}}var s5=N(87765),Lc="$";function $g(){}$g.prototype=Rb.prototype={constructor:$g,has:function(e){return Lc+e in this},get:function(e){return this[Lc+e]},set:function(e,t){return this[Lc+e]=t,this},remove:function(e){var t=Lc+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Lc&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Lc&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Lc&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Lc&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Lc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Lc)return!1;return!0},each:function(e){for(var t in this)t[0]===Lc&&e(this[t],t.slice(1),this)}};function Rb(e,t){var r=new $g;if(e instanceof $g)e.each(function(l,f){r.set(f,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var s in e)r.set(s,e[s]);return r}var b_=Rb;function aN(){var e=[],t=[],r,n,i;function a(l,f,d,_){if(f>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var b=-1,A=l.length,w=e[f++],I,P,L=map(),Z,Q=d();++b<A;)(Z=L.get(I=w(P=l[b])+""))?Z.push(P):L.set(I,[P]);return L.each(function(oe,Ae){_(Q,Ae,a(oe,f,d,_))}),Q}function s(l,f){if(++f>e.length)return l;var d,_=t[f-1];return n!=null&&f>=e.length?d=l.entries():(d=[],l.each(function(b,A){d.push({key:A,values:s(b,f)})})),_!=null?d.sort(function(b,A){return _(b.key,A.key)}):d}return i={object:function(l){return a(l,0,u5,l5)},map:function(l){return a(l,0,Mb,Ib)},entries:function(l){return s(a(l,0,Mb,Ib),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return t[e.length-1]=l,i},sortValues:function(l){return r=l,i},rollup:function(l){return n=l,i}}}function u5(){return{}}function l5(e,t,r){e[t]=r}function Mb(){return map()}function Ib(e,t,r){e.set(t,r)}function Yg(){}var vd=b_.prototype;Yg.prototype=c5.prototype={constructor:Yg,has:vd.has,add:function(e){return e+="",this[Lc+e]=e,this},remove:vd.remove,clear:vd.clear,values:vd.keys,size:vd.size,empty:vd.empty,each:vd.each};function c5(e,t){var r=new Yg;if(e instanceof Yg)e.each(function(a){r.add(a)});else if(e){var n=-1,i=e.length;if(t==null)for(;++n<i;)r.add(e[n]);else for(;++n<i;)r.add(t(e[n],n,e))}return r}var oN=null,Pb=Array.prototype,Ob=Pb.map,md=Pb.slice;function Rp(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Db(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var Fb={name:"implicit"};function qg(){var e=b_(),t=[],r=[],n=Fb;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Fb)return n;e.set(s,l=t.push(a))}return r[(l-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=b_();for(var s=-1,l=a.length,f,d;++s<l;)e.has(d=(f=a[s])+"")||e.set(d,t.push(f));return i},i.range=function(a){return arguments.length?(r=md.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return qg(t,r).unknown(n)},Rp.apply(i,arguments),i}function kb(){var e=ordinal().unknown(void 0),t=e.domain,r=e.range,n=[0,1],i,a,s=!1,l=0,f=0,d=.5;delete e.unknown;function _(){var b=t().length,A=n[1]<n[0],w=n[A-0],I=n[1-A];i=(I-w)/Math.max(1,b-l+f*2),s&&(i=Math.floor(i)),w+=(I-w-i*(b-l))*d,a=i*(1-l),s&&(w=Math.round(w),a=Math.round(a));var P=sequence(b).map(function(L){return w+i*L});return r(A?P.reverse():P)}return e.domain=function(b){return arguments.length?(t(b),_()):t()},e.range=function(b){return arguments.length?(n=[+b[0],+b[1]],_()):n.slice()},e.rangeRound=function(b){return n=[+b[0],+b[1]],s=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(b){return arguments.length?(s=!!b,_()):s},e.padding=function(b){return arguments.length?(l=Math.min(1,f=+b),_()):l},e.paddingInner=function(b){return arguments.length?(l=Math.min(1,b),_()):l},e.paddingOuter=function(b){return arguments.length?(f=+b,_()):f},e.align=function(b){return arguments.length?(d=Math.max(0,Math.min(1,b)),_()):d},e.copy=function(){return kb(t(),n).round(s).paddingInner(l).paddingOuter(f).align(d)},initRange.apply(_(),arguments)}function Bb(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Bb(t())},e}function sN(){return Bb(kb.apply(null,arguments).paddingInner(1))}var f5=N(21775),h5=N(73626);function p5(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function d5(e){return function(){return e}}function v5(e){return+e}var Lb=[0,1];function Gu(e){return e}function E_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:d5(isNaN(t)?NaN:.5)}function Nb(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function m5(e,t,r){var n=e[0],i=e[1],a=t[0],s=t[1];return i<n?(n=E_(i,n),a=r(s,a)):(n=E_(n,i),a=r(a,s)),function(l){return a(n(l))}}function g5(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=E_(e[s],e[s+1]),a[s]=r(t[s],t[s+1]);return function(l){var f=Gg(e,l,1,n)-1;return a[f](i[f](l))}}function Kg(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function S_(){var e=Lb,t=Lb,r=f5.Z,n,i,a,s=Gu,l,f,d;function _(){return l=Math.min(e.length,t.length)>2?g5:m5,f=d=null,b}function b(A){return isNaN(A=+A)?a:(f||(f=l(e.map(n),t,r)))(n(s(A)))}return b.invert=function(A){return s(i((d||(d=l(t,e.map(n),h5.Z)))(A)))},b.domain=function(A){return arguments.length?(e=Ob.call(A,v5),s===Gu||(s=Nb(e)),_()):e.slice()},b.range=function(A){return arguments.length?(t=md.call(A),_()):t.slice()},b.rangeRound=function(A){return t=md.call(A),r=p5,_()},b.clamp=function(A){return arguments.length?(s=A?Nb(e):Gu,b):s!==Gu},b.interpolate=function(A){return arguments.length?(r=A,_()):r},b.unknown=function(A){return arguments.length?(a=A,b):a},function(A,w){return n=A,i=w,_()}}function Ub(e,t){return S_()(e,t)}var _5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qg(e){if(!(t=_5.exec(e)))throw new Error("invalid format: "+e);var t;return new A_({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Qg.prototype=A_.prototype;function A_(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}A_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function y5(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Jg(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function hv(e){return e=Jg(Math.abs(e)),e?e[1]:NaN}function x5(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(hv(t)/3)))*3-hv(Math.abs(e)))}function b5(e,t){return function(r,n){for(var i=r.length,a=[],s=0,l=e[0],f=0;i>0&&l>0&&(f+l+1>n&&(l=Math.max(1,n-f)),a.push(r.substring(i-=l,i+l)),!((f+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(t)}}function E5(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}function S5(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var zb;function A5(e,t){var r=Jg(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(zb=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Jg(e,Math.max(0,t+a-1))[0]}function Zb(e,t){var r=Jg(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var Vb={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:y5,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Zb(e*100,t)},r:Zb,s:A5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function jb(e){return e}var Hb=Array.prototype.map,Wb=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function T5(e){var t=e.grouping===void 0||e.thousands===void 0?jb:b5(Hb.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?jb:E5(Hb.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",f=e.nan===void 0?"NaN":e.nan+"";function d(b){b=Qg(b);var A=b.fill,w=b.align,I=b.sign,P=b.symbol,L=b.zero,Z=b.width,Q=b.comma,oe=b.precision,Ae=b.trim,Oe=b.type;Oe==="n"?(Q=!0,Oe="g"):Vb[Oe]||(oe===void 0&&(oe=12),Ae=!0,Oe="g"),(L||A==="0"&&w==="=")&&(L=!0,A="0",w="=");var Ve=P==="$"?r:P==="#"&&/[boxX]/.test(Oe)?"0"+Oe.toLowerCase():"",rt=P==="$"?n:/[%p]/.test(Oe)?s:"",_t=Vb[Oe],Bt=/[defgprs%]/.test(Oe);oe=oe===void 0?6:/[gprs]/.test(Oe)?Math.max(1,Math.min(21,oe)):Math.max(0,Math.min(20,oe));function ur(lr){var zr=Ve,un=rt,Rn,Bi,eo;if(Oe==="c")un=_t(lr)+un,lr="";else{lr=+lr;var io=lr<0||1/lr<0;if(lr=isNaN(lr)?f:_t(Math.abs(lr),oe),Ae&&(lr=S5(lr)),io&&+lr==0&&I!=="+"&&(io=!1),zr=(io?I==="("?I:l:I==="-"||I==="("?"":I)+zr,un=(Oe==="s"?Wb[8+zb/3]:"")+un+(io&&I==="("?")":""),Bt){for(Rn=-1,Bi=lr.length;++Rn<Bi;)if(eo=lr.charCodeAt(Rn),48>eo||eo>57){un=(eo===46?i+lr.slice(Rn+1):lr.slice(Rn))+un,lr=lr.slice(0,Rn);break}}}Q&&!L&&(lr=t(lr,Infinity));var Oo=zr.length+lr.length+un.length,As=Oo<Z?new Array(Z-Oo+1).join(A):"";switch(Q&&L&&(lr=t(As+lr,As.length?Z-un.length:Infinity),As=""),w){case"<":lr=zr+lr+un+As;break;case"=":lr=zr+As+lr+un;break;case"^":lr=As.slice(0,Oo=As.length>>1)+zr+lr+un+As.slice(Oo);break;default:lr=As+zr+lr+un;break}return a(lr)}return ur.toString=function(){return b+""},ur}function _(b,A){var w=d((b=Qg(b),b.type="f",b)),I=Math.max(-8,Math.min(8,Math.floor(hv(A)/3)))*3,P=Math.pow(10,-I),L=Wb[8+I/3];return function(Z){return w(P*Z)+L}}return{format:d,formatPrefix:_}}var e0,T_,Gb;w5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function w5(e){return e0=T5(e),T_=e0.format,Gb=e0.formatPrefix,e0}function C5(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,hv(t)-hv(e))+1}function R5(e){return Math.max(0,-hv(Math.abs(e)))}function M5(e,t,r,n){var i=x_(e,t,r),a;switch(n=Qg(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=x5(i,s))&&(n.precision=a),Gb(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=C5(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=R5(i))&&(n.precision=a-(n.type==="%")*2);break}}return T_(n)}function Sm(e){var t=e.domain;return e.ticks=function(r){var n=t();return Cb(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var i=t();return M5(i[0],i[i.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,s=n[i],l=n[a],f;return l<s&&(f=s,s=l,l=f,f=i,i=a,a=f),f=Xg(s,l,r),f>0?(s=Math.floor(s/f)*f,l=Math.ceil(l/f)*f,f=Xg(s,l,r)):f<0&&(s=Math.ceil(s*f)/f,l=Math.floor(l*f)/f,f=Xg(s,l,r)),f>0?(n[i]=Math.floor(s/f)*f,n[a]=Math.ceil(l/f)*f,t(n)):f<0&&(n[i]=Math.ceil(s*f)/f,n[a]=Math.floor(l*f)/f,t(n)),e},e}function Xb(){var e=Ub(Gu,Gu);return e.copy=function(){return Kg(e,Xb())},Rp.apply(e,arguments),Sm(e)}function I5(e){var t;function r(n){return isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return I5(e).unknown(t)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function $b(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],a=e[n],s;return a<i&&(s=r,r=n,n=s,s=i,i=a,a=s),e[r]=t.floor(i),e[n]=t.ceil(a),e}function Yb(e){return Math.log(e)}function qb(e){return Math.exp(e)}function P5(e){return-Math.log(-e)}function O5(e){return-Math.exp(-e)}function D5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function F5(e){return e===10?D5:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function k5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function Kb(e){return function(t){return-e(-t)}}function B5(e){var t=e(Yb,qb),r=t.domain,n=10,i,a;function s(){return i=k5(n),a=F5(n),r()[0]<0?(i=Kb(i),a=Kb(a),e(P5,O5)):e(Yb,qb),t}return t.base=function(l){return arguments.length?(n=+l,s()):n},t.domain=function(l){return arguments.length?(r(l),s()):r()},t.ticks=function(l){var f=r(),d=f[0],_=f[f.length-1],b;(b=_<d)&&(A=d,d=_,_=A);var A=i(d),w=i(_),I,P,L,Z=l==null?10:+l,Q=[];if(!(n%1)&&w-A<Z){if(A=Math.round(A)-1,w=Math.round(w)+1,d>0){for(;A<w;++A)for(P=1,I=a(A);P<n;++P)if(L=I*P,!(L<d)){if(L>_)break;Q.push(L)}}else for(;A<w;++A)for(P=n-1,I=a(A);P>=1;--P)if(L=I*P,!(L<d)){if(L>_)break;Q.push(L)}}else Q=Cb(A,w,Math.min(w-A,Z)).map(a);return b?Q.reverse():Q},t.tickFormat=function(l,f){if(f==null&&(f=n===10?".0e":","),typeof f!="function"&&(f=T_(f)),l===Infinity)return f;l==null&&(l=10);var d=Math.max(1,n*l/t.ticks().length);return function(_){var b=_/a(Math.round(i(_)));return b*n<n-.5&&(b*=n),b<=d?f(_):""}},t.nice=function(){return r($b(r(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},t}function Qb(){var e=B5(S_()).domain([1,10]);return e.copy=function(){return Kg(e,Qb()).base(e.base())},Rp.apply(e,arguments),e}function Jb(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function eE(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function L5(e){var t=1,r=e(Jb(t),eE(t));return r.constant=function(n){return arguments.length?e(Jb(t=+n),eE(t)):t},linearish(r)}function N5(){var e=L5(transformer());return e.copy=function(){return copy(e,N5()).constant(e.constant())},initRange.apply(e,arguments)}function tE(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function U5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function z5(e){return e<0?-e*e:e*e}function Z5(e){var t=e(Gu,Gu),r=1;function n(){return r===1?e(Gu,Gu):r===.5?e(U5,z5):e(tE(r),tE(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},Sm(t)}function w_(){var e=Z5(S_());return e.copy=function(){return Kg(e,w_()).exponent(e.exponent())},Rp.apply(e,arguments),e}function uN(){return w_.apply(null,arguments).exponent(.5)}function rE(){var e=[],t=[],r=[],n;function i(){var s=0,l=Math.max(1,t.length);for(r=new Array(l-1);++s<l;)r[s-1]=o5(e,s/l);return a}function a(s){return isNaN(s=+s)?n:t[Gg(r,s)]}return a.invertExtent=function(s){var l=t.indexOf(s);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,f=s.length,d;l<f;++l)d=s[l],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(m_),i()},a.range=function(s){return arguments.length?(t=md.call(s),i()):t.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return r.slice()},a.copy=function(){return rE().domain(e).range(t).unknown(n)},Rp.apply(a,arguments)}function nE(){var e=0,t=1,r=1,n=[.5],i=[0,1],a;function s(f){return f<=f?i[Gg(n,f,0,r)]:a}function l(){var f=-1;for(n=new Array(r);++f<r;)n[f]=((f+1)*t-(f-r)*e)/(r+1);return s}return s.domain=function(f){return arguments.length?(e=+f[0],t=+f[1],l()):[e,t]},s.range=function(f){return arguments.length?(r=(i=md.call(f)).length-1,l()):i.slice()},s.invertExtent=function(f){var d=i.indexOf(f);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=r?[n[r-1],t]:[n[d-1],n[d]]},s.unknown=function(f){return arguments.length&&(a=f),s},s.thresholds=function(){return n.slice()},s.copy=function(){return nE().domain([e,t]).range(i).unknown(a)},Rp.apply(Sm(s),arguments)}function iE(){var e=[.5],t=[0,1],r,n=1;function i(a){return a<=a?t[Gg(e,a,0,n)]:r}return i.domain=function(a){return arguments.length?(e=md.call(a),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=md.call(a),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var s=t.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return iE().domain(e).range(t).unknown(r)},Rp.apply(i,arguments)}var C_=new Date,R_=new Date;function vl(e,t,r,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return t(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var f=[],d;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return f;do f.push(d=new Date(+a)),t(a,l),e(a);while(d<a&&a<s);return f},i.filter=function(a){return vl(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!a(s););else for(;--l>=0;)for(;t(s,1),!a(s););})},r&&(i.count=function(a,s){return C_.setTime(+a),R_.setTime(+s),e(C_),e(R_),Math.floor(r(C_,R_))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a==0}:function(s){return i.count(0,s)%a==0}):i}),i}var M_=vl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});M_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:vl(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};var pv=M_,lN=M_.range,aE=vl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),V5=aE,cN=aE.range,t0=1e3,Am=6e4,oE=36e5,sE=864e5,uE=6048e5;function gd(e){return vl(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Am)/uE})}var I_=gd(0),r0=gd(1),j5=gd(2),H5=gd(3),dv=gd(4),W5=gd(5),G5=gd(6),fN=I_.range,hN=r0.range,pN=j5.range,dN=H5.range,vN=dv.range,mN=W5.range,gN=G5.range,lE=vl(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Am)/sE},function(e){return e.getDate()-1}),P_=lE,_N=lE.range,cE=vl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*t0-e.getMinutes()*Am)},function(e,t){e.setTime(+e+t*oE)},function(e,t){return(t-e)/oE},function(e){return e.getHours()}),X5=cE,yN=cE.range,fE=vl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*t0)},function(e,t){e.setTime(+e+t*Am)},function(e,t){return(t-e)/Am},function(e){return e.getMinutes()}),$5=fE,xN=fE.range,hE=vl(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*t0)},function(e,t){return(t-e)/t0},function(e){return e.getUTCSeconds()}),Y5=hE,bN=hE.range,n0=vl(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});n0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?vl(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):n0};var q5=n0,EN=n0.range;function _d(e){return vl(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/uE})}var pE=_d(0),i0=_d(1),K5=_d(2),Q5=_d(3),vv=_d(4),J5=_d(5),e4=_d(6),SN=pE.range,AN=i0.range,TN=K5.range,wN=Q5.range,CN=vv.range,RN=J5.range,MN=e4.range,dE=vl(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/sE},function(e){return e.getUTCDate()-1}),vE=dE,IN=dE.range,O_=vl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});O_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:vl(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};var Tm=O_,PN=O_.range;function D_(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function F_(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function wm(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function t4(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,f=e.shortMonths,d=Cm(i),_=Rm(i),b=Cm(a),A=Rm(a),w=Cm(s),I=Rm(s),P=Cm(l),L=Rm(l),Z=Cm(f),Q=Rm(f),oe={a:io,A:Oo,b:As,B:uc,c:null,d:bE,e:bE,f:A4,g:F4,G:B4,H:b4,I:E4,j:S4,L:EE,m:T4,M:w4,p:c6,q:f6,Q:RE,s:ME,S:C4,u:R4,U:M4,V:I4,w:P4,W:O4,x:null,X:null,y:D4,Y:k4,Z:L4,"%":CE},Ae={a:h6,A:p6,b:d6,B:v6,c:null,d:AE,e:AE,f:Z4,g:K4,G:J4,H:N4,I:U4,j:z4,L:TE,m:V4,M:j4,p:m6,q:g6,Q:RE,s:ME,S:H4,u:W4,U:G4,V:X4,w:$4,W:Y4,x:null,X:null,y:q4,Y:Q4,Z:eO,"%":CE},Oe={a:ur,A:lr,b:zr,B:un,c:Rn,d:yE,e:yE,f:g4,g:_E,G:gE,H:xE,I:xE,j:p4,L:m4,m:h4,M:d4,p:Bt,q:f4,Q:y4,s:x4,S:v4,u:o4,U:s4,V:u4,w:a4,W:l4,x:Bi,X:eo,y:_E,Y:gE,Z:c4,"%":_4};oe.x=Ve(r,oe),oe.X=Ve(n,oe),oe.c=Ve(t,oe),Ae.x=Ve(r,Ae),Ae.X=Ve(n,Ae),Ae.c=Ve(t,Ae);function Ve(ci,ya){return function(Oa){var gn=[],Ul=-1,Do=0,lc=ci.length,cc,Cd,rA;for(Oa instanceof Date||(Oa=new Date(+Oa));++Ul<lc;)ci.charCodeAt(Ul)===37&&(gn.push(ci.slice(Do,Ul)),(Cd=mE[cc=ci.charAt(++Ul)])!=null?cc=ci.charAt(++Ul):Cd=cc==="e"?" ":"0",(rA=ya[cc])&&(cc=rA(Oa,Cd)),gn.push(cc),Do=Ul+1);return gn.push(ci.slice(Do,Ul)),gn.join("")}}function rt(ci,ya){return function(Oa){var gn=wm(1900,void 0,1),Ul=_t(gn,ci,Oa+="",0),Do,lc;if(Ul!=Oa.length)return null;if("Q"in gn)return new Date(gn.Q);if("s"in gn)return new Date(gn.s*1e3+("L"in gn?gn.L:0));if(ya&&!("Z"in gn)&&(gn.Z=0),"p"in gn&&(gn.H=gn.H%12+gn.p*12),gn.m===void 0&&(gn.m="q"in gn?gn.q:0),"V"in gn){if(gn.V<1||gn.V>53)return null;"w"in gn||(gn.w=1),"Z"in gn?(Do=F_(wm(gn.y,0,1)),lc=Do.getUTCDay(),Do=lc>4||lc===0?i0.ceil(Do):i0(Do),Do=vE.offset(Do,(gn.V-1)*7),gn.y=Do.getUTCFullYear(),gn.m=Do.getUTCMonth(),gn.d=Do.getUTCDate()+(gn.w+6)%7):(Do=D_(wm(gn.y,0,1)),lc=Do.getDay(),Do=lc>4||lc===0?r0.ceil(Do):r0(Do),Do=P_.offset(Do,(gn.V-1)*7),gn.y=Do.getFullYear(),gn.m=Do.getMonth(),gn.d=Do.getDate()+(gn.w+6)%7)}else("W"in gn||"U"in gn)&&("w"in gn||(gn.w="u"in gn?gn.u%7:"W"in gn?1:0),lc="Z"in gn?F_(wm(gn.y,0,1)).getUTCDay():D_(wm(gn.y,0,1)).getDay(),gn.m=0,gn.d="W"in gn?(gn.w+6)%7+gn.W*7-(lc+5)%7:gn.w+gn.U*7-(lc+6)%7);return"Z"in gn?(gn.H+=gn.Z/100|0,gn.M+=gn.Z%100,F_(gn)):D_(gn)}}function _t(ci,ya,Oa,gn){for(var Ul=0,Do=ya.length,lc=Oa.length,cc,Cd;Ul<Do;){if(gn>=lc)return-1;if(cc=ya.charCodeAt(Ul++),cc===37){if(cc=ya.charAt(Ul++),Cd=Oe[cc in mE?ya.charAt(Ul++):cc],!Cd||(gn=Cd(ci,Oa,gn))<0)return-1}else if(cc!=Oa.charCodeAt(gn++))return-1}return gn}function Bt(ci,ya,Oa){var gn=d.exec(ya.slice(Oa));return gn?(ci.p=_[gn[0].toLowerCase()],Oa+gn[0].length):-1}function ur(ci,ya,Oa){var gn=w.exec(ya.slice(Oa));return gn?(ci.w=I[gn[0].toLowerCase()],Oa+gn[0].length):-1}function lr(ci,ya,Oa){var gn=b.exec(ya.slice(Oa));return gn?(ci.w=A[gn[0].toLowerCase()],Oa+gn[0].length):-1}function zr(ci,ya,Oa){var gn=Z.exec(ya.slice(Oa));return gn?(ci.m=Q[gn[0].toLowerCase()],Oa+gn[0].length):-1}function un(ci,ya,Oa){var gn=P.exec(ya.slice(Oa));return gn?(ci.m=L[gn[0].toLowerCase()],Oa+gn[0].length):-1}function Rn(ci,ya,Oa){return _t(ci,t,ya,Oa)}function Bi(ci,ya,Oa){return _t(ci,r,ya,Oa)}function eo(ci,ya,Oa){return _t(ci,n,ya,Oa)}function io(ci){return s[ci.getDay()]}function Oo(ci){return a[ci.getDay()]}function As(ci){return f[ci.getMonth()]}function uc(ci){return l[ci.getMonth()]}function c6(ci){return i[+(ci.getHours()>=12)]}function f6(ci){return 1+~~(ci.getMonth()/3)}function h6(ci){return s[ci.getUTCDay()]}function p6(ci){return a[ci.getUTCDay()]}function d6(ci){return f[ci.getUTCMonth()]}function v6(ci){return l[ci.getUTCMonth()]}function m6(ci){return i[+(ci.getUTCHours()>=12)]}function g6(ci){return 1+~~(ci.getUTCMonth()/3)}return{format:function(ci){var ya=Ve(ci+="",oe);return ya.toString=function(){return ci},ya},parse:function(ci){var ya=rt(ci+="",!1);return ya.toString=function(){return ci},ya},utcFormat:function(ci){var ya=Ve(ci+="",Ae);return ya.toString=function(){return ci},ya},utcParse:function(ci){var ya=rt(ci+="",!0);return ya.toString=function(){return ci},ya}}}var mE={"-":"",_:" ","0":"0"},vu=/^\s*\d+/,r4=/^%/,n4=/[\\^$*+?|[\]().{}]/g;function Pa(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<r?new Array(r-a+1).join(t)+i:i)}function i4(e){return e.replace(n4,"\\$&")}function Cm(e){return new RegExp("^(?:"+e.map(i4).join("|")+")","i")}function Rm(e){for(var t={},r=-1,n=e.length;++r<n;)t[e[r].toLowerCase()]=r;return t}function a4(e,t,r){var n=vu.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function o4(e,t,r){var n=vu.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function s4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function u4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function l4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function gE(e,t,r){var n=vu.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function _E(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function c4(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function f4(e,t,r){var n=vu.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function h4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function yE(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function p4(e,t,r){var n=vu.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function xE(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function d4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function v4(e,t,r){var n=vu.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function m4(e,t,r){var n=vu.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function g4(e,t,r){var n=vu.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function _4(e,t,r){var n=r4.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function y4(e,t,r){var n=vu.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function x4(e,t,r){var n=vu.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function bE(e,t){return Pa(e.getDate(),t,2)}function b4(e,t){return Pa(e.getHours(),t,2)}function E4(e,t){return Pa(e.getHours()%12||12,t,2)}function S4(e,t){return Pa(1+P_.count(pv(e),e),t,3)}function EE(e,t){return Pa(e.getMilliseconds(),t,3)}function A4(e,t){return EE(e,t)+"000"}function T4(e,t){return Pa(e.getMonth()+1,t,2)}function w4(e,t){return Pa(e.getMinutes(),t,2)}function C4(e,t){return Pa(e.getSeconds(),t,2)}function R4(e){var t=e.getDay();return t===0?7:t}function M4(e,t){return Pa(I_.count(pv(e)-1,e),t,2)}function SE(e){var t=e.getDay();return t>=4||t===0?dv(e):dv.ceil(e)}function I4(e,t){return e=SE(e),Pa(dv.count(pv(e),e)+(pv(e).getDay()===4),t,2)}function P4(e){return e.getDay()}function O4(e,t){return Pa(r0.count(pv(e)-1,e),t,2)}function D4(e,t){return Pa(e.getFullYear()%100,t,2)}function F4(e,t){return e=SE(e),Pa(e.getFullYear()%100,t,2)}function k4(e,t){return Pa(e.getFullYear()%1e4,t,4)}function B4(e,t){var r=e.getDay();return e=r>=4||r===0?dv(e):dv.ceil(e),Pa(e.getFullYear()%1e4,t,4)}function L4(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Pa(t/60|0,"0",2)+Pa(t%60,"0",2)}function AE(e,t){return Pa(e.getUTCDate(),t,2)}function N4(e,t){return Pa(e.getUTCHours(),t,2)}function U4(e,t){return Pa(e.getUTCHours()%12||12,t,2)}function z4(e,t){return Pa(1+vE.count(Tm(e),e),t,3)}function TE(e,t){return Pa(e.getUTCMilliseconds(),t,3)}function Z4(e,t){return TE(e,t)+"000"}function V4(e,t){return Pa(e.getUTCMonth()+1,t,2)}function j4(e,t){return Pa(e.getUTCMinutes(),t,2)}function H4(e,t){return Pa(e.getUTCSeconds(),t,2)}function W4(e){var t=e.getUTCDay();return t===0?7:t}function G4(e,t){return Pa(pE.count(Tm(e)-1,e),t,2)}function wE(e){var t=e.getUTCDay();return t>=4||t===0?vv(e):vv.ceil(e)}function X4(e,t){return e=wE(e),Pa(vv.count(Tm(e),e)+(Tm(e).getUTCDay()===4),t,2)}function $4(e){return e.getUTCDay()}function Y4(e,t){return Pa(i0.count(Tm(e)-1,e),t,2)}function q4(e,t){return Pa(e.getUTCFullYear()%100,t,2)}function K4(e,t){return e=wE(e),Pa(e.getUTCFullYear()%100,t,2)}function Q4(e,t){return Pa(e.getUTCFullYear()%1e4,t,4)}function J4(e,t){var r=e.getUTCDay();return e=r>=4||r===0?vv(e):vv.ceil(e),Pa(e.getUTCFullYear()%1e4,t,4)}function eO(){return"+0000"}function CE(){return"%"}function RE(e){return+e}function ME(e){return Math.floor(+e/1e3)}var mv,IE,tO,rO,nO;iO({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function iO(e){return mv=t4(e),IE=mv.format,tO=mv.parse,rO=mv.utcFormat,nO=mv.utcParse,mv}var Mm=1e3,Im=Mm*60,Pm=Im*60,Om=Pm*24,aO=Om*7,PE=Om*30,k_=Om*365;function oO(e){return new Date(e)}function sO(e){return e instanceof Date?+e:+new Date(+e)}function OE(e,t,r,n,i,a,s,l,f){var d=Ub(Gu,Gu),_=d.invert,b=d.domain,A=f(".%L"),w=f(":%S"),I=f("%I:%M"),P=f("%I %p"),L=f("%a %d"),Z=f("%b %d"),Q=f("%B"),oe=f("%Y"),Ae=[[s,1,Mm],[s,5,5*Mm],[s,15,15*Mm],[s,30,30*Mm],[a,1,Im],[a,5,5*Im],[a,15,15*Im],[a,30,30*Im],[i,1,Pm],[i,3,3*Pm],[i,6,6*Pm],[i,12,12*Pm],[n,1,Om],[n,2,2*Om],[r,1,aO],[t,1,PE],[t,3,3*PE],[e,1,k_]];function Oe(rt){return(s(rt)<rt?A:a(rt)<rt?w:i(rt)<rt?I:n(rt)<rt?P:t(rt)<rt?r(rt)<rt?L:Z:e(rt)<rt?Q:oe)(rt)}function Ve(rt,_t,Bt,ur){if(rt==null&&(rt=10),typeof rt=="number"){var lr=Math.abs(Bt-_t)/rt,zr=Sb(function(un){return un[2]}).right(Ae,lr);zr===Ae.length?(ur=x_(_t/k_,Bt/k_,rt),rt=e):zr?(zr=Ae[lr/Ae[zr-1][2]<Ae[zr][2]/lr?zr-1:zr],ur=zr[1],rt=zr[0]):(ur=Math.max(x_(_t,Bt,rt),1),rt=l)}return ur==null?rt:rt.every(ur)}return d.invert=function(rt){return new Date(_(rt))},d.domain=function(rt){return arguments.length?b(Ob.call(rt,sO)):b().map(oO)},d.ticks=function(rt,_t){var Bt=b(),ur=Bt[0],lr=Bt[Bt.length-1],zr=lr<ur,un;return zr&&(un=ur,ur=lr,lr=un),un=Ve(rt,ur,lr,_t),un=un?un.range(ur,lr+1):[],zr?un.reverse():un},d.tickFormat=function(rt,_t){return _t==null?Oe:f(_t)},d.nice=function(rt,_t){var Bt=b();return(rt=Ve(rt,Bt[0],Bt[Bt.length-1],_t))?b($b(Bt,rt)):d},d.copy=function(){return Kg(d,OE(e,t,r,n,i,a,s,l,f))},d}function uO(){return Rp.apply(OE(pv,V5,I_,P_,X5,$5,Y5,q5,IE).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function ON(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function a0(){var e=0,t=1,r,n,i,a,s=Gu,l=!1,f;function d(_){return isNaN(_=+_)?f:s(i===0?.5:(_=(a(_)-r)*i,l?Math.max(0,Math.min(1,_)):_))}return d.domain=function(_){return arguments.length?(r=a(e=+_[0]),n=a(t=+_[1]),i=r===n?0:1/(n-r),d):[e,t]},d.clamp=function(_){return arguments.length?(l=!!_,d):l},d.interpolator=function(_){return arguments.length?(s=_,d):s},d.unknown=function(_){return arguments.length?(f=_,d):f},function(_){return a=_,r=_(e),n=_(t),i=r===n?0:1/(n-r),d}}function Dm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function DE(){var e=Sm(a0()(Gu));return e.copy=function(){return Dm(e,DE())},Db.apply(e,arguments)}function lO(){var e=loggish(a0()).domain([1,10]);return e.copy=function(){return Dm(e,lO()).base(e.base())},initInterpolator.apply(e,arguments)}function cO(){var e=symlogish(a0());return e.copy=function(){return Dm(e,cO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function FE(){var e=powish(a0());return e.copy=function(){return Dm(e,FE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function DN(){return FE.apply(null,arguments).exponent(.5)}function fO(){var e=[],t=identity;function r(n){if(!isNaN(n=+n))return t((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return fO(t).domain(e)},initInterpolator.apply(r,arguments)}function o0(){var e=0,t=.5,r=1,n,i,a,s,l,f=Gu,d,_=!1,b;function A(w){return isNaN(w=+w)?b:(w=.5+((w=+d(w))-i)*(w<i?s:l),f(_?Math.max(0,Math.min(1,w)):w))}return A.domain=function(w){return arguments.length?(n=d(e=+w[0]),i=d(t=+w[1]),a=d(r=+w[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,t,r]},A.clamp=function(w){return arguments.length?(_=!!w,A):_},A.interpolator=function(w){return arguments.length?(f=w,A):f},A.unknown=function(w){return arguments.length?(b=w,A):b},function(w){return d=w,n=w(e),i=w(t),a=w(r),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function kE(){var e=Sm(o0()(Gu));return e.copy=function(){return Dm(e,kE())},Db.apply(e,arguments)}function hO(){var e=loggish(o0()).domain([.1,1,10]);return e.copy=function(){return copy(e,hO()).base(e.base())},initInterpolator.apply(e,arguments)}function pO(){var e=symlogish(o0());return e.copy=function(){return copy(e,pO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function BE(){var e=powish(o0());return e.copy=function(){return copy(e,BE()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function FN(){return BE.apply(null,arguments).exponent(.5)}function LE(e){var t,r=[];function n(i){return i==null?t:i}return n.invert=n,n.domain=n.range=function(i){return i?(r=i,i):r},n.unknown=function(i){return i?(t=i,i):t},n.copy=function(){return LE(e).unknown(t)},n}var ac,NE,UE,B_=di.isNil,dO=di.isString,vO=di.uniq,mO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,gO=(ac={},(0,B.Z)(ac,Ya.LINEAR,Xb),(0,B.Z)(ac,Ya.POWER,w_),(0,B.Z)(ac,Ya.LOG,Qb),(0,B.Z)(ac,Ya.IDENTITY,LE),(0,B.Z)(ac,Ya.SEQUENTIAL,DE),(0,B.Z)(ac,Ya.TIME,uO),(0,B.Z)(ac,Ya.QUANTILE,rE),(0,B.Z)(ac,Ya.QUANTIZE,nE),(0,B.Z)(ac,Ya.THRESHOLD,iE),(0,B.Z)(ac,Ya.CAT,qg),(0,B.Z)(ac,Ya.DIVERGING,kE),ac),_O=(NE=(0,ot.b2)(),NE(UE=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"scaleOptions",{})}return(0,Y.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,Ot.Z)(ve().mark(function s(){var l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.log(Es.ScaleInitStart,kt.INIT),i.scaleOptions=r.getScaleOptions(),f=a.getLayerStyleAttributes(),d=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(d)&&d.length===0)){b.next=8;break}return b.abrupt("return");case 8:i.caculateScalesForAttributes(f||[],d);case 9:r.log(Es.ScaleInitEnd,kt.INIT);case 10:case"end":return b.stop()}},s)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Ot.Z)(ve().mark(function l(f){var d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(f){A.next=2;break}return A.abrupt("return",f);case 2:if(r.log(Es.ScaleInitStart,kt.UPDATE),i.scaleOptions=r.getScaleOptions(),d=a.getLayerStyleAttributes(),_=r.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(d||[],_),r.log(Es.ScaleInitEnd,kt.UPDATE),r.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){i.scaleOptions=r.getScaleOptions();var s=a.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var f=s.filter(function(d){return d.needRescale});f.length&&i.caculateScalesForAttributes(f,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var i=this;r.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(B_(l)?[]:l);var f=[];s.names.forEach(function(d){var _;f.push(i.createScale(d,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),f.some(function(d){return d.type===av.VARIABLE})?(s.type=av.VARIABLE,f.forEach(function(d){if(!s.callback&&s.values!=="text"){var _;switch((_=d.option)===null||_===void 0?void 0:_.type){case Ya.LOG:case Ya.LINEAR:case Ya.POWER:if(s.values&&s.values.length>2){var b=d.scale.ticks(s.values.length);d.scale.domain(b)}s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case Ya.QUANTILE:case Ya.QUANTIZE:case Ya.THRESHOLD:d.scale.range(s.values);break;case Ya.IDENTITY:break;case Ya.CAT:s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case Ya.DIVERGING:case Ya.SEQUENTIAL:d.scale.interpolator(s5.hD(s.values));break}}if(s.values==="text"){var A;d.scale.range((A=d.option)===null||A===void 0?void 0:A.domain)}})):(s.type=av.CONSTANT,s.defaultValues=f.map(function(d,_){return d.scale(s.names[_])})),s.scalers=f.map(function(d){return{field:d.field,func:d.scale,option:d.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:dO(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,i,a){var s,l,f=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===r?this.scaleOptions[n]:this.scaleOptions[r],d={field:r,scale:void 0,type:av.VARIABLE,option:f};if(!a||!a.length)return f&&f.type?d.scale=this.createDefaultScale(f):(d.scale=qg([r]),d.type=av.CONSTANT),d;var _=(l=a.find(function(w){return!B_(w[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||B_(_)&&!f)d.scale=qg([r]),d.type=av.CONSTANT;else{var b=f&&f.type||this.getDefaultType(_);i==="text"&&(b=Ya.CAT),i===void 0&&(b=Ya.IDENTITY);var A=this.createScaleConfig(b,r,f,a);d.scale=this.createDefaultScale(A),d.option=A}return d}},{key:"getDefaultType",value:function(r){var n=Ya.LINEAR;return typeof r=="string"&&(n=mO.test(r)?Ya.TIME:Ya.CAT),n}},{key:"createScaleConfig",value:function(r,n,i,a){var s={type:r},l=(a==null?void 0:a.map(function(_){return _[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(r===Ya.CAT||r===Ya.IDENTITY)s.domain=vO(l);else if(r===Ya.QUANTILE)s.domain=l;else if(r===Ya.DIVERGING){var f=Tb(l),d=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(f[0]+f[1])/2;s.domain=[f[0],d,f[1]]}else s.domain=Tb(l);return(0,F.Z)((0,F.Z)({},s),i)}},{key:"createDefaultScale",value:function(r){var n=r.type,i=r.domain,a=r.unknown,s=r.clamp,l=r.nice,f=gO[n]();return i&&f.domain&&f.domain(i),a&&f.unknown(a),s!==void 0&&f.clamp&&f.clamp(s),l!==void 0&&f.nice&&f.nice(l),f}}]),e}())||UE),zE,ZE,yO=(zE=(0,ot.b2)(),zE(ZE=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(i){i.addUniforms((0,F.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||ZE),VE,jE,xO=(VE=(0,ot.b2)(),VE(jE=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!r.tileLayer&&i&&i.length>0){var s;(s=r.masks).push.apply(s,(0,Wt.Z)(i)),r.updateLayerConfig({mask:a})}})}}]),e}())||jE),bO=function(){function e(t){var r=t.rendererService,n=t.layerService,i=t.parent;(0,ye.Z)(this,e),(0,B.Z)(this,"tileResource",new Map),(0,B.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=i}return(0,Y.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(a){return a.key===r}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);if(r.isVisible)if(r.parent){var i=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(r.parent){var a=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,i=r==null?void 0:r.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){var i=this,a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var d=(0,Ot.Z)(ve().mark(function _(b){return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,i.layerService.renderTileLayer(b);case 2:case"end":return w.stop()}},_)}));return function(_){return d.apply(this,arguments)}}()),f.next=4,Promise.all(s);case 4:case"end":return f.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,(0,Wt.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return r.map(function(i){return n.push.apply(n,(0,Wt.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),EO=N(32676);function SO(e,t,r){r===void 0&&(r={});var n=Nn(e),i=Nn(t),a=EO.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?Or(a[0],r.properties):Fi(a,r.properties)}var AO=SO,TO=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,i=r[0];return r.map(function(a){var s=Or(a.coordinates);n===null?n=s:n=AO(n,s)}),i&&(n.properties=(0,F.Z)({},i)),n}}]),e}(),Fm="select",km="active",wO=function(){function e(t){var r=t.layerService,n=t.tileLayerService,i=t.parent;(0,ye.Z)(this,e),(0,B.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=i,this.tileSourceService=new TO}return(0,Y.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var i=this.parent.getContainer(),a=i.get(pt.IPickingService);if(r.type==="RasterLayer"){var s=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(s&&s.getMainLayer()!==void 0){var l=s.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,K.Z)(r,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Fm,l),this.updateHighLight(i,a,s,Fm)}},{key:"highlightPickedFeature",value:function(r){var n=(0,K.Z)(r,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(km,l),this.updateHighLight(i,a,s,km)}},{key:"updateHighLight",value:function(r,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case Fm:l==null||l.hooks.beforeSelect.call([r,n,i]);break;case km:l==null||l.hooks.beforeHighlight.call([r,n,i]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(Fm),n=this.tilePickID.get(km);if(r){var i=this.pickId2Color(r),a=(0,K.Z)(i,3),s=a[0],l=a[1],f=a[2];this.updateHighLight(s,l,f,Fm);return}if(n){var d=this.pickId2Color(n),_=(0,K.Z)(d,3),b=_[0],A=_[1],w=_[2];this.updateHighLight(b,A,w,km);return}}},{key:"color2PickId",value:function(r,n,i){return ua(new Uint8Array([r,n,i]))}},{key:"pickId2Color",value:function(r){return Ma(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,Wt.Z)(a.getFeatureById(r)))}),i}},{key:"pickRasterLayer",value:function(r,n,i){return!1}}]),e}();function CO(e){return e==="PolygonLayer"?jg:e==="LineLayer"?d_:Vg}function RO(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function MO(e){var t=IO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function IO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yd=function(e){(0,tt.Z)(r,e);var t=MO(r);function r(n,i){var a;return(0,ye.Z)(this,r),a=t.call(this),(0,B.Z)((0,Ee.Z)(a),"visible",!0),(0,B.Z)((0,Ee.Z)(a),"layers",[]),(0,B.Z)((0,Ee.Z)(a),"isLoaded",!1),(0,B.Z)((0,Ee.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,Y.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,K.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],f=a[2],d=a[3],_=i.lng,b=i.lat;return _>=s&&_<=f&&b>=l&&b<=d}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,F.Z)((0,F.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:RO(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(f){if(!f.tileLayer)return l.push(f),f;var d=f.tileLayer,_=d.getTile(i.sourceTile.key),b=_==null?void 0:_.getLayers()[0];b&&l.push(b)}),l}},{key:"addTileMask",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return s=new jg({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=_m(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),_.next=5,s.init();case 5:return this.tileMask=s,f=this.getMainLayer(),f!==void 0&&(f.tileMask=s),_.abrupt("return",s);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s,l){var f;return ve().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return f=_m(this.parent.sceneContainer),l.setContainer(f,this.parent.sceneContainer),_.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(s){var l;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s.isTileLayer=!0,l=_m(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),d.next=6,s.init();case 6:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,B.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),r}(ka.EventEmitter);function PO(e){var t=OO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function OO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DO=function(e){(0,tt.Z)(r,e);var t=PO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,f=new d_().source(s.data,s.options).size(1).shape("line").color("red"),d=new Vg({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),b.next=6,this.addLayer(f);case 6:return b.next=8,this.addLayer(d);case 8:this.isLoaded=!0;case 9:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),r}(yd);function FO(e){var t=kO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function kO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BO=function(e){(0,tt.Z)(r,e);var t=FO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Zx((0,F.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;d[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(yd);function LO(e){var t=NO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function NO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UO=function(e){(0,tt.Z)(r,e);var t=LO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new db((0,F.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;d[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,f=this.getFeatures(s);return{data:{type:"FeatureCollection",features:f},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),r}(yd),zO=["rasterData"];function ZO(e){var t=VO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function VO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jO=function(e){(0,tt.Z)(r,e);var t=ZO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Hg((0,F.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;d[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,Fl.Z)(a,zO);return{data:s,options:{parser:(0,F.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),r}(yd);function HO(e){var t=WO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function WO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GO=function(e){(0,tt.Z)(r,e);var t=HO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d;return ve().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Hg((0,F.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(A){var w,I,P=A;d[P]((w=s[P])===null||w===void 0?void 0:w.field,(I=s[P])===null||I===void 0?void 0:I.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),r}(yd),XO=["rasterData"];function $O(e){var t=YO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function YO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qO={positions:[0,1],colors:["#000","#fff"]},KO=function(e){(0,tt.Z)(r,e);var t=$O(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_,b,A;return ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=this.getLayerOptions(),_=d.rampColors,b=d.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,b),A=new Hg((0,F.Z)((0,F.Z)({},l),{},{colorTexture:this.colorTexture})).source(f.data,f.options),s&&Object.keys(s).forEach(function(P){var L,Z,Q=P;A[Q]((L=s[Q])===null||L===void 0?void 0:L.field,(Z=s[Q])===null||Z===void 0?void 0:Z.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,Fl.Z)(a,XO);return{data:s,options:{parser:(0,F.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var f=s,d=f.rampColors,_=d===void 0?qO:d,b=f.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,b||Da(_)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),r}(yd);function QO(e){var t=JO();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function JO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s0=function(e){(0,tt.Z)(r,e);var t=QO(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s,l,f,d,_;return ve().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=CO(this.parent.type),d=this.getSourceOption(),d){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return _=new f((0,F.Z)({},l)).source(d.data,d.options),Object.keys(s).forEach(function(w){var I,P,L=w;_[L]((I=s[L])===null||I===void 0?void 0:I.field,(P=s[L])===null||P===void 0?void 0:P.values)}),A.next=12,this.addLayer(_);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,f=a.featureId,d=f===void 0?"id":f,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:d},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),r}(yd);function eD(e){var t=e.type;switch(t){case"PolygonLayer":return s0;case"LineLayer":return s0;case"PointLayer":return s0;case"TileDebugLayer":return DO;case"MaskLayer":return UO;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case Cu.RGB:case Cu.CUSTOMRGB:return jO;case Cu.ARRAYBUFFER:case Cu.CUSTOMARRAYBUFFER:return KO;case Cu.TERRAINRGB:case Cu.CUSTOMTERRAINRGB:return GO;default:return BO}default:return s0}}var tD=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],rD=di.debounce,HE=function(){function e(t){var r=this;(0,ye.Z)(this,e),(0,B.Z)(this,"initedTileset",!1),(0,B.Z)(this,"mapchange",function(){var i;if(r.parent.isVisible()!==!1){var a=r.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(r.mapService.version==="GAODE1.x"){var f=r.parent.getLayerConfig(),d=f.visible;l<2&&d?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):l>=2&&!d&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===l&&r.lastViewStates.latLonBounds.toString()===s.toString()||(r.lastViewStates={zoom:l,latLonBounds:s},(i=r.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,B.Z)(this,"viewchange",rD(this.mapchange,24)),this.parent=t;var n=this.parent.getContainer();this.rendererService=n.get(pt.IRendererService),this.layerService=n.get(pt.ILayerService),this.mapService=n.get(pt.IMapService),this.pickingService=n.get(pt.IPickingService),this.tileLayerService=new bO({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new wO({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}return(0,Y.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(s,a)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(a,i)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){var i=this,a,s;return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.tilesetManager){f.next=2;break}return f.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),f.next=6,Promise.all(this.tilesetManager.tiles.filter(function(d){return d.isLoaded}).filter(function(d){return d.isVisibleChange}).filter(function(d){return d.data}).filter(function(d){return d.z>=a&&d.z<s}).map(function(){var d=(0,Ot.Z)(ve().mark(function _(b){var A,w;return ve().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i.tileLayerService.hasTile(b.key)){P.next=9;break}return A=eD(i.parent),w=new A(b,i.parent),P.next=5,w.initTileLayer();case 5:i.tilePickService.setPickState(),w.getLayers().length!==0&&(i.tileLayerService.addTile(w),i.tileLayerService.updateTileVisible(b),i.layerService.reRender()),P.next=12;break;case 9:i.tileLayerService.updateTileVisible(b),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return P.stop()}},_)}));return function(_){return d.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return f.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;tD.forEach(function(i){var a=r[i].bind(r);r[i]=function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return a.apply(void 0,l),n.getLayers().map(function(d){d[i].apply(d,l)}),i==="style"&&n.getTiles().forEach(function(d){return d.styleUpdate.apply(d,l)}),r}})}}]),e}(),WE,GE,nD=(WE=(0,ot.b2)(),WE(GE=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"build",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,Ot.Z)(ve().mark(function i(){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!r.getSource().isTile){s.next=4;break}return r.prepareBuildModel(),r.tileLayer=new HE(r),s.abrupt("return");case 4:return r.log(Es.BuildModelStart,kt.INIT),s.next=7,n.initLayerModel(r);case 7:r.log(Es.BuildModelEnd,kt.INIT);case 8:case"end":return s.stop()}},i)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Ot.Z)(ve().mark(function a(s){return ve().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",!1);case 2:if(!r.getSource().isTile){f.next=5;break}return r.tileLayer=new HE(r),f.abrupt("return",!1);case 5:return r.log(Es.BuildModelStart,kt.UPDATE),f.next=8,n.prepareLayerModel(r);case 8:return r.log(Es.BuildModelEnd,kt.UPDATE),f.abrupt("return",!0);case 10:case"end":return f.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||GE),XE,$E,iD=(XE=(0,ot.b2)(),XE($E=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&r.fitBounds(a),r.styleNeedUpdate=!1})}}]),e}())||$E),YE,qE,aD=["type"],KE={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},oD={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},sD={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},uD={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function lD(e){var t={u_DirectionalLights:new Array(3).fill((0,F.Z)({},sD)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,F.Z)({},uD)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[oD]),e.forEach(function(r){var n=r.type,i=n===void 0?"directional":n,a=(0,Fl.Z)(r,aD),s=KE[i].lights,l=KE[i].num,f=t[l];t[s][f]=(0,F.Z)((0,F.Z)({},t[s][f]),a),t[l]++}),t}var cD=(YE=(0,ot.b2)(),YE(qE=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),i=n.enableLighting;i&&r.models.forEach(function(a){return a.addUniforms((0,F.Z)({},lD()))})})}}]),e}())||qE),QE,JE,fD=(QE=(0,ot.b2)(),QE(JE=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var f=r.getLayerConfig(),d=f.enableMultiPassRenderer,_=f.passes,b=_===void 0?[]:_;i.enabled=!!d&&r.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(r.multiPassRenderer=dx(r,b,s,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var f=a.getViewportSize(),d=f.width,_=f.height;r.multiPassRenderer.resize(d,_)}})}}]),e}())||JE),e2,t2,gv={NONE:0,ENCODE:1,HIGHLIGHT:2},hD=(e2=(0,ot.b2)(),e2(t2=function(){function e(){(0,ye.Z)(this,e),(0,B.Z)(this,"PickOption",{u_HighlightColor:[1,0,0,1],u_SelectColor:[1,0,0,1],u_PickingColor:[0,0,0],u_PickingStage:0,u_CurrentSelectedId:[0,0,0],u_PickingThreshold:10,u_PickingBuffer:0,u_shaderPick:0,u_EnableSelect:0,u_activeMix:0})}return(0,Y.Z)(e,[{key:"pickOption2Array",value:function(){return Object.values(this.PickOption).flat()}},{key:"updatePickOption",value:function(r,n){var i=this;Object.keys(r).forEach(function(a){i.PickOption[a]=r[a]}),n.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array(this.pickOption2Array()))})}},{key:"apply",value:function(r,n){var i=this,a=n.rendererService,s=n.styleAttributeService;if(!a.uniformBuffers[1]){var l=a.createBuffer({data:new Float32Array(this.pickOption2Array().length),isUBO:!0});a.uniformBuffers[1]=l,this.updatePickOption({},a)}r.hooks.init.tapPromise("PixelPickingPlugin",function(){var f=r.getLayerConfig(),d=f.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:dn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Ss.PICKING_COLOR,buffer:{data:[],type:W.FLOAT},size:3,update:function(b){var A=b.id;return d?Ma(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),d=f.enablePicking;d&&r.isVisible()&&(i.updatePickOption({u_PickingStage:gv.ENCODE},a),r.models.forEach(function(_){return _.addUniforms({u_PickingStage:gv.ENCODE})}))}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),d=f.enablePicking;d&&r.isVisible()&&(i.updatePickOption({u_PickingStage:gv.HIGHLIGHT},a),r.models.forEach(function(_){return _.addUniforms({u_PickingStage:gv.HIGHLIGHT})}))}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var d=r.getLayerConfig(),_=d.highlightColor,b=d.activeMix,A=b===void 0?0:b,w=typeof _=="string"?ii(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ua(new Uint8Array(f))});var I={u_PickingStage:gv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A};i.updatePickOption(I,a),r.models.forEach(function(P){return P.addUniforms(I)})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var d=r.getLayerConfig(),_=d.selectColor,b=d.selectMix,A=b===void 0?0:b,w=typeof _=="string"?ii(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ua(new Uint8Array(f))});var I={u_PickingStage:gv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A,u_CurrentSelectedId:f,u_SelectColor:w.map(function(P){return P*255}),u_EnableSelect:1};console.log(I),i.updatePickOption(I,a),r.models.forEach(function(P){return P.addUniforms(I)})})}}]),e}())||t2),pD=["mvt","geojsonvt","testTile"];function dD(e){var t=e.getSource();return pD.includes(t.parser.type)}function kN(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var r2,n2,vD=(r2=(0,ot.b2)(),r2(n2=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){dD(r)||i.registerBuiltinAttributes(a,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:dn.Attribute,descriptor:{name:"a_Position",shaderLocation:Ss.POSITION,buffer:{data:[],type:W.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:dn.Attribute,descriptor:{name:"a_Color",shaderLocation:Ss.COLOR,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:dn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Ss.VERTEX_ID,buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||n2),i2,a2,o2,s2,u2,l2,c2,xd,f2,h2,p2,d2,v2,mD=(i2=(0,ot.b2)(),a2=(0,ot.f3)(pt.ICameraService),o2=(0,ot.f3)(pt.ICoordinateSystemService),s2=(0,ot.f3)(pt.IRendererService),u2=(0,ot.f3)(pt.IMapService),l2=(0,ot.f3)(pt.ILayerService),i2(c2=(xd=function(){function e(){(0,ye.Z)(this,e),an(this,"cameraService",f2,this),an(this,"coordinateSystemService",h2,this),an(this,"rendererService",p2,this),an(this,"mapService",d2,this),an(this,"layerService",v2,this)}return(0,Y.Z)(e,[{key:"apply",value:function(r){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*5+4*6+4),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(f),i==="GAODE2.x"&&(n.setLayerCenter(r),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter());var d=n.rendererService.getViewportSize(),_=d.width,b=d.height,A=n.generateUBO(a,s,_,b),w=A.data,I=A.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:w}),r.models.forEach(function(P){P.addUniforms((0,F.Z)((0,F.Z)({},I),{},{u_PickingBuffer:r.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(r.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}},{key:"generateUBO",value:function(r,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),f=this.cameraService.getViewMatrix(),d=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),b=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),w=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),P=this.cameraService.getZoomScale(),L=this.coordinateSystemService.getPixelsPerMeter(),Z=this.coordinateSystemService.getCoordinateSystem(),Q=this.cameraService.getCameraPosition(),oe=window.devicePixelRatio,Ae=this.coordinateSystemService.getViewportCenter(),Oe=[i,a],Ve=this.cameraService.getFocalDistance(),rt=[].concat((0,Wt.Z)(f),(0,Wt.Z)(l),(0,Wt.Z)(d),(0,Wt.Z)(_),(0,Wt.Z)(r),(0,Wt.Z)(b),(0,Wt.Z)(A),[w],(0,Wt.Z)(I),[P],(0,Wt.Z)(L),[Z],(0,Wt.Z)(Q),[oe],(0,Wt.Z)(Ae),Oe,(0,Wt.Z)(n),[Ve,0]);return{data:rt,uniforms:(s={},(0,B.Z)(s,dd.ProjectionMatrix,l),(0,B.Z)(s,dd.ViewMatrix,f),(0,B.Z)(s,dd.ViewProjectionMatrix,d),(0,B.Z)(s,dd.Zoom,w),(0,B.Z)(s,dd.ZoomScale,P),(0,B.Z)(s,dd.FocalDistance,Ve),(0,B.Z)(s,dd.CameraPosition,Q),(0,B.Z)(s,Dl.CoordinateSystem,Z),(0,B.Z)(s,Dl.ViewportCenter,Ae),(0,B.Z)(s,Dl.ViewportCenterProjection,b),(0,B.Z)(s,Dl.PixelsPerDegree,A),(0,B.Z)(s,Dl.PixelsPerDegree2,I),(0,B.Z)(s,Dl.PixelsPerMeter,L),(0,B.Z)(s,Dl.Mvp,r),(0,B.Z)(s,"u_sceneCenterMercator",n),(0,B.Z)(s,"u_ViewportSize",Oe),(0,B.Z)(s,"u_ModelMatrix",_),(0,B.Z)(s,"u_DevicePixelRatio",oe),s)}}}]),e}(),f2=jr(xd.prototype,"cameraService",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h2=jr(xd.prototype,"coordinateSystemService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p2=jr(xd.prototype,"rendererService",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=jr(xd.prototype,"mapService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=jr(xd.prototype,"layerService",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||c2),m2,g2,gD=(m2=(0,ot.b2)(),m2(g2=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||g2),_2,y2,_D=(_2=(0,ot.b2)(),_2(y2=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"apply",value:function(r,n){var i=this,a=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(r,{styleAttributeService:a})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&i.updateStyleAttribute(r,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(r,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){r.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,r.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||y2);kl.bind(pt.ILayerPlugin).to(r5).inRequestScope(),kl.bind(pt.ILayerPlugin).to(vD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(_O).inRequestScope(),kl.bind(pt.ILayerPlugin).to(t5).inRequestScope(),kl.bind(pt.ILayerPlugin).to(iD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(xO).inRequestScope(),kl.bind(pt.ILayerPlugin).to(_D).inRequestScope(),kl.bind(pt.ILayerPlugin).to(gD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(fD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(mD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(yO).inRequestScope(),kl.bind(pt.ILayerPlugin).to(cD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(hD).inRequestScope(),kl.bind(pt.ILayerPlugin).to(nD).inRequestScope();var yD=N(81550),xD=N.n(yD),bD=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.buffer,i=r.offset,a=r.stride,s=r.normalized,l=r.size,f=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,Y.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),kh,Bm,Mp,Nc,Lm,Ip,Nm,u0,qf,bd,Mu,Kf,Qf,l0,ED=(kh={},(0,B.Z)(kh,W.POINTS,"points"),(0,B.Z)(kh,W.LINES,"lines"),(0,B.Z)(kh,W.LINE_LOOP,"line loop"),(0,B.Z)(kh,W.LINE_STRIP,"line strip"),(0,B.Z)(kh,W.TRIANGLES,"triangles"),(0,B.Z)(kh,W.TRIANGLE_FAN,"triangle fan"),(0,B.Z)(kh,W.TRIANGLE_STRIP,"triangle strip"),kh),x2=(Bm={},(0,B.Z)(Bm,W.STATIC_DRAW,"static"),(0,B.Z)(Bm,W.DYNAMIC_DRAW,"dynamic"),(0,B.Z)(Bm,W.STREAM_DRAW,"stream"),Bm),L_=(Mp={},(0,B.Z)(Mp,W.BYTE,"int8"),(0,B.Z)(Mp,W.INT,"int32"),(0,B.Z)(Mp,W.UNSIGNED_BYTE,"uint8"),(0,B.Z)(Mp,W.UNSIGNED_SHORT,"uint16"),(0,B.Z)(Mp,W.UNSIGNED_INT,"uint32"),(0,B.Z)(Mp,W.FLOAT,"float"),Mp),SD=(Nc={},(0,B.Z)(Nc,W.ALPHA,"alpha"),(0,B.Z)(Nc,W.LUMINANCE,"luminance"),(0,B.Z)(Nc,W.LUMINANCE_ALPHA,"luminance alpha"),(0,B.Z)(Nc,W.RGB,"rgb"),(0,B.Z)(Nc,W.RGBA,"rgba"),(0,B.Z)(Nc,W.RGBA4,"rgba4"),(0,B.Z)(Nc,W.RGB5_A1,"rgb5 a1"),(0,B.Z)(Nc,W.RGB565,"rgb565"),(0,B.Z)(Nc,W.DEPTH_COMPONENT,"depth"),(0,B.Z)(Nc,W.DEPTH_STENCIL,"depth stencil"),Nc),AD=(Lm={},(0,B.Z)(Lm,W.DONT_CARE,"dont care"),(0,B.Z)(Lm,W.NICEST,"nice"),(0,B.Z)(Lm,W.FASTEST,"fast"),Lm),b2=(Ip={},(0,B.Z)(Ip,W.NEAREST,"nearest"),(0,B.Z)(Ip,W.LINEAR,"linear"),(0,B.Z)(Ip,W.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,B.Z)(Ip,W.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,B.Z)(Ip,W.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,B.Z)(Ip,W.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Ip),E2=(Nm={},(0,B.Z)(Nm,W.REPEAT,"repeat"),(0,B.Z)(Nm,W.CLAMP_TO_EDGE,"clamp"),(0,B.Z)(Nm,W.MIRRORED_REPEAT,"mirror"),Nm),TD=(u0={},(0,B.Z)(u0,W.NONE,"none"),(0,B.Z)(u0,W.BROWSER_DEFAULT_WEBGL,"browser"),u0),wD=(qf={},(0,B.Z)(qf,W.NEVER,"never"),(0,B.Z)(qf,W.ALWAYS,"always"),(0,B.Z)(qf,W.LESS,"less"),(0,B.Z)(qf,W.LEQUAL,"lequal"),(0,B.Z)(qf,W.GREATER,"greater"),(0,B.Z)(qf,W.GEQUAL,"gequal"),(0,B.Z)(qf,W.EQUAL,"equal"),(0,B.Z)(qf,W.NOTEQUAL,"notequal"),qf),S2=(bd={},(0,B.Z)(bd,W.FUNC_ADD,"add"),(0,B.Z)(bd,W.MIN_EXT,"min"),(0,B.Z)(bd,W.MAX_EXT,"max"),(0,B.Z)(bd,W.FUNC_SUBTRACT,"subtract"),(0,B.Z)(bd,W.FUNC_REVERSE_SUBTRACT,"reverse subtract"),bd),c0=(Mu={},(0,B.Z)(Mu,W.ZERO,"zero"),(0,B.Z)(Mu,W.ONE,"one"),(0,B.Z)(Mu,W.SRC_COLOR,"src color"),(0,B.Z)(Mu,W.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,B.Z)(Mu,W.SRC_ALPHA,"src alpha"),(0,B.Z)(Mu,W.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,B.Z)(Mu,W.DST_COLOR,"dst color"),(0,B.Z)(Mu,W.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,B.Z)(Mu,W.DST_ALPHA,"dst alpha"),(0,B.Z)(Mu,W.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,B.Z)(Mu,W.CONSTANT_COLOR,"constant color"),(0,B.Z)(Mu,W.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,B.Z)(Mu,W.CONSTANT_ALPHA,"constant alpha"),(0,B.Z)(Mu,W.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,B.Z)(Mu,W.SRC_ALPHA_SATURATE,"src alpha saturate"),Mu),CD=(Kf={},(0,B.Z)(Kf,W.NEVER,"never"),(0,B.Z)(Kf,W.ALWAYS,"always"),(0,B.Z)(Kf,W.LESS,"less"),(0,B.Z)(Kf,W.LEQUAL,"lequal"),(0,B.Z)(Kf,W.GREATER,"greater"),(0,B.Z)(Kf,W.GEQUAL,"gequal"),(0,B.Z)(Kf,W.EQUAL,"equal"),(0,B.Z)(Kf,W.NOTEQUAL,"notequal"),Kf),_v=(Qf={},(0,B.Z)(Qf,W.ZERO,"zero"),(0,B.Z)(Qf,W.KEEP,"keep"),(0,B.Z)(Qf,W.REPLACE,"replace"),(0,B.Z)(Qf,W.INVERT,"invert"),(0,B.Z)(Qf,W.INCR,"increment"),(0,B.Z)(Qf,W.DECR,"decrement"),(0,B.Z)(Qf,W.INCR_WRAP,"increment wrap"),(0,B.Z)(Qf,W.DECR_WRAP,"decrement wrap"),Qf),RD=(l0={},(0,B.Z)(l0,W.FRONT,"front"),(0,B.Z)(l0,W.BACK,"back"),l0),MD=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"isDestroyed",!1);var n=r.data,i=r.usage,a=r.type;this.buffer=t.buffer({data:n,usage:x2[i||W.STATIC_DRAW],type:L_[a||W.UNSIGNED_BYTE]})}return(0,Y.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}(),ID=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.data,i=r.usage,a=r.type,s=r.count;this.elements=t.elements({data:n,usage:x2[i||W.STATIC_DRAW],type:L_[a||W.UNSIGNED_BYTE],count:s})}return(0,Y.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),PD=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.width,i=r.height,a=r.color,s=r.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(f){return f.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=t.framebuffer(l)}return(0,Y.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}(),OD={}.toString,DD=function(e,t){return OD.call(e)==="[object "+t+"]"},FD=DD,kD=function(e){return FD(e,"Number")},yv=kD,BD=function(e){return e==null},Pp=BD,LD=function(e,t,r){return e<t?t:e>r?r:e},ND=LD,Mn=N(65353),UD=N(90857),A2=UD,$e;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})($e||($e={}));var _a;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(_a||(_a={}));var da;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(da||(da={}));var Um;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Um||(Um={}));var Ll;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Ll||(Ll={}));var oa;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(oa||(oa={}));var Iu;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Iu||(Iu={}));var ml;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(ml||(ml={}));var ms;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(ms||(ms={}));var Zs;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Zs||(Zs={}));var gs;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(gs||(gs={}));var qa;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(qa||(qa={}));var pf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(pf||(pf={}));var Ed;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Ed||(Ed={}));var T2;(function(e){e.LOADED="loaded"})(T2||(T2={}));var Wi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Wi||(Wi={}));var oc;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET"})(oc||(oc={}));var Pu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(Pu||(Pu={}));var Xu;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Xu||(Xu={}));function BN(e,t,r,n){var i=Wi.TEXTURE_2D,a=1,s=oc.SAMPLED;return{dimension:i,format:e,width:t,height:r,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var Uo;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(Uo||(Uo={}));var xv;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(xv||(xv={}));var bv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(bv||(bv={}));var f0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(f0||(f0={}));var Sr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Sr||(Sr={}));var Gn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Gn||(Gn={}));function w2(e){return e}var wn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"})(wn||(wn={}));function hi(e,t,r){return e<<16|t<<8|r}var It;(function(e){e[e.ALPHA=hi(Sr.U8,Gn.A,wn.None)]="ALPHA",e[e.U8_LUMINANCE=hi(Sr.U8,Gn.A,wn.None)]="U8_LUMINANCE",e[e.F16_LUMINANCE=hi(Sr.F16,Gn.A,wn.None)]="F16_LUMINANCE",e[e.F32_LUMINANCE=hi(Sr.F32,Gn.A,wn.None)]="F32_LUMINANCE",e[e.F16_R=hi(Sr.F16,Gn.R,wn.None)]="F16_R",e[e.F16_RG=hi(Sr.F16,Gn.RG,wn.None)]="F16_RG",e[e.F16_RGB=hi(Sr.F16,Gn.RGB,wn.None)]="F16_RGB",e[e.F16_RGBA=hi(Sr.F16,Gn.RGBA,wn.None)]="F16_RGBA",e[e.F32_R=hi(Sr.F32,Gn.R,wn.None)]="F32_R",e[e.F32_RG=hi(Sr.F32,Gn.RG,wn.None)]="F32_RG",e[e.F32_RGB=hi(Sr.F32,Gn.RGB,wn.None)]="F32_RGB",e[e.F32_RGBA=hi(Sr.F32,Gn.RGBA,wn.None)]="F32_RGBA",e[e.U8_R=hi(Sr.U8,Gn.R,wn.None)]="U8_R",e[e.U8_R_NORM=hi(Sr.U8,Gn.R,wn.Normalized)]="U8_R_NORM",e[e.U8_RG=hi(Sr.U8,Gn.RG,wn.None)]="U8_RG",e[e.U8_RG_NORM=hi(Sr.U8,Gn.RG,wn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=hi(Sr.U8,Gn.RGB,wn.None)]="U8_RGB",e[e.U8_RGB_NORM=hi(Sr.U8,Gn.RGB,wn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=hi(Sr.U8,Gn.RGB,wn.sRGB|wn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=hi(Sr.U8,Gn.RGBA,wn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=hi(Sr.U8,Gn.RGBA,wn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=hi(Sr.U8,Gn.RGBA,wn.sRGB|wn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=hi(Sr.U16,Gn.R,wn.None)]="U16_R",e[e.U16_R_NORM=hi(Sr.U16,Gn.R,wn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=hi(Sr.U16,Gn.RG,wn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=hi(Sr.U16,Gn.RGBA,wn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=hi(Sr.U16,Gn.RGB,wn.None)]="U16_RGB",e[e.U32_R=hi(Sr.U32,Gn.R,wn.None)]="U32_R",e[e.U32_RG=hi(Sr.U32,Gn.RG,wn.None)]="U32_RG",e[e.S8_R=hi(Sr.S8,Gn.R,wn.None)]="S8_R",e[e.S8_R_NORM=hi(Sr.S8,Gn.R,wn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=hi(Sr.S8,Gn.RG,wn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=hi(Sr.S8,Gn.RGB,wn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=hi(Sr.S8,Gn.RGBA,wn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=hi(Sr.S16,Gn.R,wn.None)]="S16_R",e[e.S16_RG=hi(Sr.S16,Gn.RG,wn.None)]="S16_RG",e[e.S16_RG_NORM=hi(Sr.S16,Gn.RG,wn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=hi(Sr.S16,Gn.RGB,wn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=hi(Sr.S16,Gn.RGBA,wn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=hi(Sr.S16,Gn.RGBA,wn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=hi(Sr.S32,Gn.R,wn.None)]="S32_R",e[e.U16_RGBA_5551=hi(Sr.U16_PACKED_5551,Gn.RGBA,wn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=hi(Sr.U16_PACKED_565,Gn.RGB,wn.Normalized)]="U16_RGB_565",e[e.BC1=hi(Sr.BC1,Gn.RGBA,wn.Normalized)]="BC1",e[e.BC1_SRGB=hi(Sr.BC1,Gn.RGBA,wn.Normalized|wn.sRGB)]="BC1_SRGB",e[e.BC2=hi(Sr.BC2,Gn.RGBA,wn.Normalized)]="BC2",e[e.BC2_SRGB=hi(Sr.BC2,Gn.RGBA,wn.Normalized|wn.sRGB)]="BC2_SRGB",e[e.BC3=hi(Sr.BC3,Gn.RGBA,wn.Normalized)]="BC3",e[e.BC3_SRGB=hi(Sr.BC3,Gn.RGBA,wn.Normalized|wn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=hi(Sr.BC4_UNORM,Gn.R,wn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=hi(Sr.BC4_SNORM,Gn.R,wn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=hi(Sr.BC5_UNORM,Gn.RG,wn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=hi(Sr.BC5_SNORM,Gn.RG,wn.Normalized)]="BC5_SNORM",e[e.D24=hi(Sr.D24,Gn.R,wn.Depth)]="D24",e[e.D24_S8=hi(Sr.D24S8,Gn.RG,wn.Depth|wn.Stencil)]="D24_S8",e[e.D32F=hi(Sr.D32F,Gn.R,wn.Depth)]="D32F",e[e.D32F_S8=hi(Sr.D32FS8,Gn.RG,wn.Depth|wn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=hi(Sr.U8,Gn.RGB,wn.RenderTarget|wn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=hi(Sr.U8,Gn.RGBA,wn.RenderTarget|wn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=hi(Sr.U8,Gn.RGBA,wn.RenderTarget|wn.Normalized|wn.sRGB)]="U8_RGBA_RT_SRGB"})(It||(It={}));function h0(e){return e>>>8&255}function Jf(e){return e>>>16&255}function Ev(e){return e&255}function C2(e){switch(e){case Sr.F32:case Sr.U32:case Sr.S32:return 4;case Sr.U16:case Sr.S16:case Sr.F16:return 2;case Sr.U8:case Sr.S8:return 1;default:throw new Error("whoops")}}function R2(e){return C2(Jf(e))}function LN(e){return w2(h0(e))}function zD(e){var t=C2(Jf(e)),r=w2(h0(e));return t*r}function NN(e,t){return e&4294967040|t}function UN(e,t){return e&4294902015|t<<8}function M2(e){var t=Ev(e);if(t&wn.Depth)return Uo.Depth;if(t&wn.Normalized)return Uo.Float;var r=Jf(e);if(r===Sr.F16||r===Sr.F32)return Uo.Float;if(r===Sr.U8||r===Sr.U16||r===Sr.U32)return Uo.Uint;if(r===Sr.S8||r===Sr.S16||r===Sr.S32)return Uo.Sint;throw new Error("whoops")}function Di(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function Sd(e){if(e!=null)return e;throw new Error("Missing object")}function I2(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function P2(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function O2(e){var t=e.r,r=e.g,n=e.b,i=e.a;return{r:t,g:r,b:n,a:i}}function p0(e,t,r,n){return n===void 0&&(n=1),{r:e,g:t,b:r,a:n}}var N_=p0(0,0,0,0),zN=p0(0,0,0,1),ZD=p0(1,1,1,0),ZN=p0(1,1,1,1),Sv=!0;function VN(e,t){t===void 0&&(t=Sv),t&&(e[10]=-e[10],e[14]=-e[14])}function jN(e,t){t===void 0&&(t=Sv),t&&(e[10]=-e[10],e[14]=-e[14]+1)}function VD(e,t){if(t===void 0&&(t=Sv),t)switch(e){case da.LESS:return da.GREATER;case da.LEQUAL:return da.GEQUAL;case da.GEQUAL:return da.LEQUAL;case da.GREATER:return da.LESS;default:return e}else return e}function HN(e,t){return t===void 0&&(t=Sv),t?1-e:e}function WN(e,t){return t===void 0&&(t=Sv),t?-e:e}function GN(e,t,r,n){if(n===void 0&&(n=Sv),r=VD(r,n),r===da.LESS)return e<t;if(r===da.LEQUAL)return e<=t;if(r===da.GREATER)return e>t;if(r===da.GEQUAL)return e>=t;throw new Error("whoops")}function d0(e){return!!(e&&(e&e-1)==0)}function Av(e,t){return e!=null?e:t}function jD(e){return e===void 0?null:e}function XN(e,t,r){e.length=t,e.fill(r)}function v0(e,t){var r=t-1;return e+r&~r}function $N(e,t){return((e+t-1)/t|0)*t}function HD(e,t,r){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=r(t,e[a]);s<0?i=a:n=a+1}return n}function YN(e,t,r){var n=HD(e,t,r);e.splice(n,0,t)}function qN(e,t,r){return r?e|=t:e&=~t,e}function WD(e,t){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}function GD(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(n,i){return"".concat(XD(""+(t+i),4," "),"  ").concat(n)}).join(`
`)}function XD(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function KN(e,t){for(var r=[],n=e;n<e+t;n++)r.push(n);return r}function D2(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function m0(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e}function F2(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),D2(e.rgbBlendState,t.rgbBlendState),D2(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function U_(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=F2(e[r],t[r])}function $D(e,t){t.attachmentsState!==void 0&&U_(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&P2(e.blendConstant,t.blendConstant),e.depthCompare=Av(t.depthCompare,e.depthCompare),e.depthWrite=Av(t.depthWrite,e.depthWrite),e.stencilWrite=Av(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&m0(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&m0(e.stencilBack,t.stencilBack),e.cullMode=Av(t.cullMode,e.cullMode),e.frontFace=Av(t.frontFace,e.frontFace),e.polygonOffset=Av(t.polygonOffset,e.polygonOffset)}function Tv(e){var t=Object.assign({},e);return t.attachmentsState=[],U_(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&O2(t.blendConstant),t.stencilFront=m0(void 0,e.stencilFront),t.stencilBack=m0(void 0,e.stencilBack),t}function YD(e,t){t.channelWriteMask!==void 0&&(e.channelWriteMask=t.channelWriteMask),t.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=t.rgbBlendMode),t.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=t.alphaBlendMode),t.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),t.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),t.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),t.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}var k2={blendMode:Iu.ADD,blendSrcFactor:oa.ONE,blendDstFactor:oa.ZERO},Ad={attachmentsState:[{channelWriteMask:Pu.ALL,rgbBlendState:k2,alphaBlendState:k2}],blendConstant:O2(N_),depthWrite:!0,depthCompare:da.LEQUAL,stencilWrite:!1,stencilFront:{compare:da.ALWAYS,passOp:Xu.KEEP,depthFailOp:Xu.KEEP,failOp:Xu.KEEP},stencilBack:{compare:da.ALWAYS,passOp:Xu.KEEP,depthFailOp:Xu.KEEP,failOp:Xu.KEEP},cullMode:Ll.NONE,frontFace:Um.CCW,polygonOffset:!1};function qD(e,t){e===void 0&&(e=null),t===void 0&&(t=Ad);var r=Tv(t);return e!==null&&$D(r,e),r}var QN=qD({depthCompare:da.ALWAYS,depthWrite:!1},Ad);function JN(e,t){return e.attachmentsState===void 0&&(e.attachmentsState=[],U_(e.attachmentsState,Ad.attachmentsState)),YD(e.attachmentsState[0],t),e}var B2={texture:null,sampler:null,formatKind:Uo.Float,dimension:Wi.TEXTURE_2D};function wv(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function zm(e,t){for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=t(e[n]);return r}function KD(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function QD(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function e7(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!wv(e.samplerBindings,t.samplerBindings,QD)||!wv(e.uniformBufferBindings,t.uniformBufferBindings,KD))}function L2(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function JD(e,t){return!(!L2(e.rgbBlendState,t.rgbBlendState)||!L2(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function g0(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp}function eF(e,t){return!wv(e.attachmentsState,t.attachmentsState,JD)||e.blendConstant&&t.blendConstant&&!I2(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!g0(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!g0(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset}function N2(e,t){return e.id===t.id}function tF(e,t){return e===t}function t7(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!eF(e.megaStateDescriptor,t.megaStateDescriptor)||!N2(e.program,t.program)||!wv(e.colorAttachmentFormats,t.colorAttachmentFormats,tF)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function rF(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function nF(e,t){return isNil(e)?isNil(t):isNil(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&wv(e.attributes,t.attributes,rF)}function r7(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!wv(e.vertexBufferDescriptors,t.vertexBufferDescriptors,nF)||!N2(e.program,t.program))}function n7(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function iF(e){var t=e.sampler,r=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:t,texture:r,dimension:n,formatKind:i,comparison:a}}function U2(e){var t=e.buffer,r=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:t,offset:i,size:r}}function i7(e){var t=e.samplerBindings&&zm(e.samplerBindings,iF),r=e.uniformBufferBindings&&zm(e.uniformBufferBindings,U2),n=e.storageBufferBindings&&zm(e.storageBufferBindings,U2);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:n,pipeline:e.pipeline}}function a7(e){var t=e.inputLayout,r=e.program,n=e.topology,i=e.megaStateDescriptor&&Tv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:t,megaStateDescriptor:i,program:r,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function aF(e){var t=e.shaderLocation,r=e.format,n=e.offset,i=e.divisor;return{shaderLocation:t,format:r,offset:n,divisor:i}}function oF(e){if(isNil(e))return e;var t=e.arrayStride,r=e.stepMode,n=zm(e.attributes,aF);return{arrayStride:t,stepMode:r,attributes:n}}function o7(e){var t=zm(e.vertexBufferDescriptors,oF),r=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:n}}var Qi,sF=/([^[]*)(\[[0-9]+\])?/;function uF(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match(sF);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function gl(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function zo(e,t,r,n){var i=null,a=null;return function(s,l,f){var d=t(f,r),_=d.length,b=!1;if(i===null)i=new Float32Array(_),a=_,b=!0;else{Di(a===_,"Uniform length cannot change.");for(var A=0;A<_;++A)if(d[A]!==i[A]){b=!0;break}}return b&&(n(s,e,l,d),i.set(d)),b}}function $u(e,t,r,n){e[t](r,n)}function Bh(e,t,r,n){e[t](r,!1,n)}var lF={},cF={},fF={},z2=[0];function z_(e,t,r,n){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(z2[0]=e,e=z2);var i=e.length;if(e instanceof r)return e;var a=n[i];a||(a=new r(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function sc(e,t){return z_(e,t,Float32Array,lF)}function Op(e,t){return z_(e,t,Int32Array,cF)}function _0(e,t){return z_(e,t,Uint32Array,fF)}var hF=(Qi={},Qi[$e.FLOAT]=zo.bind(null,"uniform1fv",sc,1,$u),Qi[$e.FLOAT_VEC2]=zo.bind(null,"uniform2fv",sc,2,$u),Qi[$e.FLOAT_VEC3]=zo.bind(null,"uniform3fv",sc,3,$u),Qi[$e.FLOAT_VEC4]=zo.bind(null,"uniform4fv",sc,4,$u),Qi[$e.INT]=zo.bind(null,"uniform1iv",Op,1,$u),Qi[$e.INT_VEC2]=zo.bind(null,"uniform2iv",Op,2,$u),Qi[$e.INT_VEC3]=zo.bind(null,"uniform3iv",Op,3,$u),Qi[$e.INT_VEC4]=zo.bind(null,"uniform4iv",Op,4,$u),Qi[$e.BOOL]=zo.bind(null,"uniform1iv",Op,1,$u),Qi[$e.BOOL_VEC2]=zo.bind(null,"uniform2iv",Op,2,$u),Qi[$e.BOOL_VEC3]=zo.bind(null,"uniform3iv",Op,3,$u),Qi[$e.BOOL_VEC4]=zo.bind(null,"uniform4iv",Op,4,$u),Qi[$e.FLOAT_MAT2]=zo.bind(null,"uniformMatrix2fv",sc,4,Bh),Qi[$e.FLOAT_MAT3]=zo.bind(null,"uniformMatrix3fv",sc,9,Bh),Qi[$e.FLOAT_MAT4]=zo.bind(null,"uniformMatrix4fv",sc,16,Bh),Qi[$e.UNSIGNED_INT]=zo.bind(null,"uniform1uiv",_0,1,$u),Qi[$e.UNSIGNED_INT_VEC2]=zo.bind(null,"uniform2uiv",_0,2,$u),Qi[$e.UNSIGNED_INT_VEC3]=zo.bind(null,"uniform3uiv",_0,3,$u),Qi[$e.UNSIGNED_INT_VEC4]=zo.bind(null,"uniform4uiv",_0,4,$u),Qi[$e.FLOAT_MAT2x3]=zo.bind(null,"uniformMatrix2x3fv",sc,6,Bh),Qi[$e.FLOAT_MAT2x4]=zo.bind(null,"uniformMatrix2x4fv",sc,8,Bh),Qi[$e.FLOAT_MAT3x2]=zo.bind(null,"uniformMatrix3x2fv",sc,6,Bh),Qi[$e.FLOAT_MAT3x4]=zo.bind(null,"uniformMatrix3x4fv",sc,12,Bh),Qi[$e.FLOAT_MAT4x2]=zo.bind(null,"uniformMatrix4x2fv",sc,8,Bh),Qi[$e.FLOAT_MAT4x3]=zo.bind(null,"uniformMatrix4x3fv",sc,12,Bh),Qi[$e.SAMPLER_2D]=gl,Qi[$e.SAMPLER_CUBE]=gl,Qi[$e.SAMPLER_3D]=gl,Qi[$e.SAMPLER_2D_SHADOW]=gl,Qi[$e.SAMPLER_2D_ARRAY]=gl,Qi[$e.SAMPLER_2D_ARRAY_SHADOW]=gl,Qi[$e.SAMPLER_CUBE_SHADOW]=gl,Qi[$e.INT_SAMPLER_2D]=gl,Qi[$e.INT_SAMPLER_3D]=gl,Qi[$e.INT_SAMPLER_CUBE]=gl,Qi[$e.INT_SAMPLER_2D_ARRAY]=gl,Qi[$e.UNSIGNED_INT_SAMPLER_2D]=gl,Qi[$e.UNSIGNED_INT_SAMPLER_3D]=gl,Qi[$e.UNSIGNED_INT_SAMPLER_CUBE]=gl,Qi[$e.UNSIGNED_INT_SAMPLER_2D_ARRAY]=gl,Qi);function Z2(e,t,r){var n=hF[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)}var pF={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function dF(e){return Object.prototype.toString.call(e)in pF}function Zm(e,t){return"#define ".concat(e," ").concat(t)}function vF(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,n,i){var a=Number(i);return t[n]=isNaN(a)?i:a,""}),t}function mF(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return r.push({location:isNaN(s)?t[i]:s,name:a}),""}),r}function s7(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var f=__read(l.trim().split(/\s+/),2),d=f[0],_=f[1];s.push({type:d.trim(),name:_.replace(";","").trim()})}),r.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",f=s[1]||"",d=f.indexOf("[")>-1;if(f=f.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=r.find(function(w){return l===w.type});if(_)if(d)for(var b=function(w){_.uniforms.forEach(function(I){t.push("".concat(f,"[").concat(w,"].").concat(I.name))})},A=0;A<5;A++)b(A);else _.uniforms.forEach(function(w){t.push("".concat(f,".").concat(w.name))})}f&&t.push(f)}}),""}),t}function V2(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function gF(e){var t="",r=e;return[r,t]}function Dp(e,t,r,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=t==="frag"&&((a=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,f=r.replace(`\r
`,`
`).split(`
`).map(function(Ve){return Ve.replace(/[/][/].*$/,"")}).filter(function(Ve){var rt=!Ve||/^\s+$/.test(Ve);return!rt}),d="";n!==null&&(d=Object.keys(n).map(function(Ve){return Zm(Ve,n[Ve])}).join(`
`));var _=f.find(function(Ve){return Ve.startsWith("precision")})||"precision mediump float;",b=i?f.filter(function(Ve){return!Ve.startsWith("precision")}).join(`
`):f.join(`
`),A="";if(e.viewportOrigin===xv.UPPER_LEFT&&(A+="".concat(Zm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===bv.ZERO&&(A+="".concat(Zm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var w=0,I=0,P=0;b=b.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(Ve,rt,_t,Bt){var ur=_t?"".concat(_t,", "):"";return"layout(".concat(ur,"set = ").concat(w,", binding = ").concat(I++,") uniform ").concat(Bt)}),w++,I=0,Di(e.separateSamplerTextures),b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Ve,rt,_t,Bt,ur){var lr=V2(_t);lr===null&&(lr=I++);var zr=(0,Mn.__read)(gF(Bt),2),un=zr[0],Rn=zr[1];return t==="frag"?`
layout(set = `.concat(w,", binding = ").concat(lr*2+0,") uniform texture").concat(un," T_").concat(ur,`;
layout(set = `).concat(w,", binding = ").concat(lr*2+1,") uniform sampler").concat(Rn," S_").concat(ur,";").trim():""}),b=b.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(Ve,rt){return"layout(location = ".concat(P++,") ").concat(rt)}),A+="".concat(Zm("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Zm("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var L=0;b=b.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Ve,rt,_t,Bt,ur){var lr=V2(_t);return lr===null&&(lr=L++),"uniform sampler".concat(Bt," ").concat(ur,"; // BINDING=").concat(lr)})}if(e.separateSamplerTextures)b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Ve,rt,_t){return"sampler".concat(rt,"(T_").concat(_t,", S_").concat(_t,")")}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(Ve,rt){return"T_".concat(rt)});else{var Z=[];b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Ve,rt,_t){return Z.push([_t,rt]),_t}),s&&Z.forEach(function(Ve){var rt=(0,Mn.__read)(Ve,2),_t=rt[0],Bt=rt[1];b=b.replace(new RegExp("texture\\(".concat(_t),"g"),function(){return"texture".concat(Bt,"(").concat(_t)})}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(Ve,rt){return rt})}var Q="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(A||"").concat(d?d+`
`:"",`
`).concat(b,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(Q=Q.replace(/^\b(out)\b/g,function(Ve,rt){return"layout(location = 0) ".concat(rt)})),s){if(t==="frag"&&(Q=Q.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(Ve,rt,_t){return"varying ".concat(rt," ").concat(_t,`;
`)})),t==="vert"&&(Q=Q.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Ve,rt,_t){return"varying ".concat(rt," ").concat(_t,`;
`)}),Q=Q.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(Ve,rt,_t){return"attribute ".concat(rt," ").concat(_t,`;
`)})),Q=Q.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(Ve,rt){return rt.trim().replace(/^.*$/gm,function(_t){var Bt=_t.trim();return Bt.startsWith("#")?Bt:_t?"uniform ".concat(Bt):""})}),t==="frag")if(l){var oe=[];Q=Q.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(Ve,rt){return oe.push(rt),"vec4 ".concat(rt,`;
`)});var Ae=Q.lastIndexOf("}");Q=Q.substring(0,Ae)+`
    `.concat(oe.map(function(Ve,rt){return"gl_FragData[".concat(rt,"] = ").concat(Ve,`;
    `)}).join(`
`))+Q.substring(Ae)}else{var Oe;if(Q=Q.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Ve,rt,_t){return Oe=_t,"".concat(rt," ").concat(_t,`;
`)}),Oe){var Ae=Q.lastIndexOf("}");Q=Q.substring(0,Ae)+`
  gl_FragColor = vec4(`.concat(Oe,`);
`)+Q.substring(Ae)}}Q=Q.replace(/^\s*layout\((.*)\)/gm,"")}return Q}function u7(e,t,r,n){n===void 0&&(n=null);var i=Dp(e,"vert",t,n),a=Dp(e,"frag",r,n);return{vert:t,frag:r,preprocessedVert:i,preprocessedFrag:a}}var df=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(A2),_F=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.Bindings;var l=a.uniformBufferBindings,f=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=f||[],s.bindingLayouts=s.createBindingLayouts(),s}return t.prototype.createBindingLayouts=function(){var r=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:r,numUniformBuffers:a,firstSampler:n,numSamplers:s}),r+=a,n+=s,{numUniformBuffers:r,numSamplers:n,bindingLayoutTables:i}},t}(df);function Wn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function j2(e){var t=Jf(e);switch(t){case Sr.BC1:case Sr.BC2:case Sr.BC3:case Sr.BC4_UNORM:case Sr.BC4_SNORM:case Sr.BC5_UNORM:case Sr.BC5_SNORM:return!0;default:return!1}}function H2(e){var t=Ev(e);if(t&wn.Normalized)return!1;var r=Jf(e);return r===Sr.S8||r===Sr.S16||r===Sr.S32||r===Sr.U8||r===Sr.U16||r===Sr.U32}function yF(e){switch(e){case pf.STATIC:return $e.STATIC_DRAW;case pf.DYNAMIC:return $e.DYNAMIC_DRAW}}function W2(e){if(e&qa.INDEX)return $e.ELEMENT_ARRAY_BUFFER;if(e&qa.VERTEX)return $e.ARRAY_BUFFER;if(e&qa.UNIFORM)return $e.UNIFORM_BUFFER}function xF(e){switch(e){case gs.TRIANGLES:return $e.TRIANGLES;case gs.POINTS:return $e.POINTS;case gs.TRIANGLE_STRIP:return $e.TRIANGLE_STRIP;case gs.LINES:return $e.LINES;case gs.LINE_STRIP:return $e.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function bF(e){switch(e){case Sr.U8:return $e.UNSIGNED_BYTE;case Sr.U16:return $e.UNSIGNED_SHORT;case Sr.U32:return $e.UNSIGNED_INT;case Sr.S8:return $e.BYTE;case Sr.S16:return $e.SHORT;case Sr.S32:return $e.INT;case Sr.F16:return $e.HALF_FLOAT;case Sr.F32:return $e.FLOAT;default:throw new Error("whoops")}}function EF(e){switch(e){case Gn.R:return 1;case Gn.RG:return 2;case Gn.RGB:return 3;case Gn.RGBA:return 4;default:return 1}}function SF(e){var t=Jf(e),r=h0(e),n=Ev(e),i=bF(t),a=EF(r),s=!!(n&wn.Normalized);return{size:a,type:i,normalized:s}}function AF(e){switch(e){case It.U8_R:return $e.UNSIGNED_BYTE;case It.U16_R:return $e.UNSIGNED_SHORT;case It.U32_R:return $e.UNSIGNED_INT;default:throw new Error("whoops")}}function Vm(e){switch(e){case ml.CLAMP_TO_EDGE:return $e.CLAMP_TO_EDGE;case ml.REPEAT:return $e.REPEAT;case ml.MIRRORED_REPEAT:return $e.MIRRORED_REPEAT;default:throw new Error("whoops")}}function y0(e,t){if(t===Zs.LINEAR&&e===ms.BILINEAR)return $e.LINEAR_MIPMAP_LINEAR;if(t===Zs.LINEAR&&e===ms.POINT)return $e.NEAREST_MIPMAP_LINEAR;if(t===Zs.NEAREST&&e===ms.BILINEAR)return $e.LINEAR_MIPMAP_NEAREST;if(t===Zs.NEAREST&&e===ms.POINT)return $e.NEAREST_MIPMAP_NEAREST;if(t===Zs.NO_MIP&&e===ms.BILINEAR)return $e.LINEAR;if(t===Zs.NO_MIP&&e===ms.POINT)return $e.NEAREST;throw new Error("Unknown texture filter mode")}function Cv(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function Rv(e){var t=e;return t.gl_texture}function Z_(e){var t=e;return t.gl_sampler}function jm(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function G2(e,t){for(var r=[];;){var n=t.exec(e);if(!n)break;r.push(n)}return r}function Fp(e){return e.blendMode==Iu.ADD&&e.blendSrcFactor==oa.ONE&&e.blendDstFactor===oa.ZERO}function TF(e){switch(e){case f0.OcclusionConservative:return $e.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function wF(e){if(e===Wi.TEXTURE_2D)return $e.TEXTURE_2D;if(e===Wi.TEXTURE_2D_ARRAY)return $e.TEXTURE_2D_ARRAY;if(e===Wi.TEXTURE_CUBE_MAP)return $e.TEXTURE_CUBE_MAP;if(e===Wi.TEXTURE_3D)return $e.TEXTURE_3D;throw new Error("whoops")}function V_(e,t,r,n){return!(e%r!=0||t%n!=0)}var CF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.Buffer;var l=a.viewOrSize,f=a.usage,d=a.hint,_=d===void 0?pf.STATIC:d,b=i.uniformBufferMaxPageByteSize,A=i.gl,w=f&qa.UNIFORM;w||(Wn(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=yv(l)?v0(l,4):v0(l.byteLength,4);s.gl_buffer_pages=[];var P;if(w){for(var L=I;L>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(L,b),f,_)),L-=b;P=b}else s.gl_buffer_pages.push(s.createBufferPage(I,f,_)),P=I;return s.pageByteSize=P,s.byteSize=I,s.usage=f,s.gl_target=W2(f),yv(l)||s.setSubData(0,new Uint8Array(l.buffer)),w||(Wn(A)?A.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,f=r+a,d=r,_=r%l;d<f;){var b=Wn(s)?s.COPY_WRITE_BUFFER:this.gl_target,A=Cv(this,d);if(A.ubo)return;s.bindBuffer(b,A),Wn(s)?s.bufferSubData(b,_,n,i,Math.min(f-d,l)):s.bufferSubData(b,_,n),d+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,n,i){var a=this.device.gl,s=n&qa.UNIFORM;if(!Wn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),f=W2(n),d=yF(i);return a.bindBuffer(f,l),a.bufferData(f,r,d),l},t}(df),RF=function(e){(0,Mn.__extends)(t,e);function t(r){var n,i,a,s,l=r.id,f=r.device,d=r.descriptor,_,b=e.call(this,{id:l,device:f})||this;b.type=_a.InputLayout;var A=d.vertexBufferDescriptors,w=d.indexBufferFormat,I=d.program;Di(w===It.U16_R||w===It.U32_R||w===null);var P=w!==null?AF(w):null,L=w!==null?R2(w):null,Z=b.device.gl,Q=b.device.ensureResourceExists(Wn(Z)?Z.createVertexArray():f.OES_vertex_array_object.createVertexArrayOES());Wn(Z)?Z.bindVertexArray(Q):f.OES_vertex_array_object.bindVertexArrayOES(Q),Z.bindBuffer(Z.ARRAY_BUFFER,Cv(b.device.fallbackVertexBuffer));try{for(var oe=(0,Mn.__values)(d.vertexBufferDescriptors),Ae=oe.next();!Ae.done;Ae=oe.next()){var Oe=Ae.value,Ve=Oe.stepMode,rt=Oe.attributes;try{for(var _t=(a=void 0,(0,Mn.__values)(rt)),Bt=_t.next();!Bt.done;Bt=_t.next()){var ur=Bt.value,lr=ur.shaderLocation,zr=ur.format,un=ur.divisor,Rn=un===void 0?1:un,Bi=Wn(Z)?lr:(_=I.attributes[lr])===null||_===void 0?void 0:_.location,eo=SF(zr);if(ur.vertexFormat=eo,!Pp(Bi)){H2(zr);var io=eo.size,Oo=eo.type,As=eo.normalized;Z.vertexAttribPointer(Bi,io,Oo,As,0,0),Ve===Ed.INSTANCE&&(Wn(Z)?Z.vertexAttribDivisor(Bi,Rn):f.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Bi,Rn)),Z.enableVertexAttribArray(Bi)}}}catch(uc){a={error:uc}}finally{try{Bt&&!Bt.done&&(s=_t.return)&&s.call(_t)}finally{if(a)throw a.error}}}}catch(uc){n={error:uc}}finally{try{Ae&&!Ae.done&&(i=oe.return)&&i.call(oe)}finally{if(n)throw n.error}}return Wn(Z)?Z.bindVertexArray(null):f.OES_vertex_array_object.bindVertexArrayOES(null),b.vertexBufferDescriptors=A,b.vao=Q,b.indexBufferFormat=w,b.indexBufferType=P,b.indexBufferCompByteSize=L,b.program=I,b}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Wn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(df),j_=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=r.fake,l=e.call(this,{id:n,device:i})||this;l.type=_a.Texture,a=(0,Mn.__assign)({dimension:Wi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var f=l.device.gl,d,_,b=l.clampmipLevelCount(a);if(l.immutable=a.usage===oc.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=M2(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=b>=1,!s){_=l.device.ensureResourceExists(f.createTexture());var A=l.device.translateTextureType(a.format),w=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(f.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===Wi.TEXTURE_2D){if(d=$e.TEXTURE_2D,f.bindTexture(d,_),l.immutable)if(Wn(f))f.texStorage2D(d,b,w,a.width,a.height);else{var I=(w===$e.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===It.D32F||l.format===It.D24_S8)&&!Wn(f)&&!i.WEBGL_depth_texture||(f.texImage2D(d,I,w,a.width,a.height,0,w,A,null),l.mipmaps&&(l.mipmaps=!1,f.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.LINEAR),f.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_S,$e.CLAMP_TO_EDGE),f.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_T,$e.CLAMP_TO_EDGE)))}Di(a.depthOrArrayLayers===1)}else if(a.dimension===Wi.TEXTURE_2D_ARRAY)d=$e.TEXTURE_2D_ARRAY,f.bindTexture(d,_),l.immutable&&Wn(f)&&f.texStorage3D(d,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Wi.TEXTURE_3D)d=$e.TEXTURE_3D,f.bindTexture(d,_),l.immutable&&Wn(f)&&f.texStorage3D(d,b,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Wi.TEXTURE_CUBE_MAP)d=$e.TEXTURE_CUBE_MAP,f.bindTexture(d,_),l.immutable&&Wn(f)&&f.texStorage2D(d,b,w,a.width,a.height),Di(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=d,l.mipLevelCount=b,l}return t.prototype.setImageData=function(r,n){n===void 0&&(n=0);var i=this.device.gl;j2(this.format);var a=this.gl_target===$e.TEXTURE_3D||this.gl_target===$e.TEXTURE_2D_ARRAY,s=this.gl_target===$e.TEXTURE_CUBE_MAP,l=dF(r[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var f=r[0],d,_;l?(d=this.width,_=this.height):(d=f.width,_=f.height,this.width=d,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var b=this.device.translateTextureFormat(this.format),A=this.device.translateTextureType(this.format);this.preprocessImage();for(var w=0;w<this.depthOrArrayLayers;w++){var I=r[w],P=this.gl_target;s&&(P=$e.TEXTURE_CUBE_MAP_POSITIVE_X+w%6),this.immutable?i.texSubImage2D(P,n,0,0,d,_,b,A,I):Wn(i)?a?i.texImage3D(P,n,b,d,_,this.depthOrArrayLayers,0,b,A,I):i.texImage2D(P,n,b,d,_,0,b,A,I):l?i.texImage2D(P,n,b,d,_,0,b,A,I):i.texImage2D(P,n,b,b,A,I)}this.mipmaps&&this.generateMipmap(a)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Rv(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===Wi.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var n=Jf(r.format);if(n===Sr.BC1)for(var i=r.width,a=r.height,s=0;s<r.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei($e.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei($e.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei($e.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var n=this.device.gl;return!Wn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),r?(n.texParameteri(this.gl_target,$e.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,$e.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,$e.TEXTURE_MIN_FILTER,$e.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,$e.TEXTURE_MAG_FILTER,$e.LINEAR)):n.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return Wn(r)?!1:!d0(this.width)||!d0(this.height)},t}(df),MF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,f=a.format,d=a.width,_=a.height,b=a.sampleCount,A=b===void 0?1:b,w=a.texture,I=!1;if((f===It.D32F||f===It.D24_S8)&&w&&!Wn(l)&&!i.WEBGL_depth_texture&&(w.destroy(),s.texture=null,I=!0),!I&&w)s.texture=w;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var P=s.device.translateTextureInternalFormat(f,!0);Wn(l)&&A>1?l.renderbufferStorageMultisample($e.RENDERBUFFER,A,P,d,_):l.renderbufferStorage($e.RENDERBUFFER,P,d,_)}return s.format=f,s.width=d,s.height=_,s.sampleCount=A,s}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(df),Nl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Nl||(Nl={}));var IF=function(e){(0,Mn.__extends)(t,e);function t(r,n){var i=r.id,a=r.device,s=r.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=_a.Program,l.uniformSetters={},l.attributes=[];var f=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(f.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Nl.NeedsCompile,l.tryCompileProgram(),l}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){var r,n;Di(this.compileState===Nl.NeedsCompile);var i=this.descriptor,a=this.device.gl;((r=i.vertex)===null||r===void 0?void 0:r.glsl)&&((n=i.fragment)===null||n===void 0?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Nl.Compiling,Wn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=vF(this.descriptor.vertex.glsl),s=mF(this.rawVertexGLSL,a),l=function(_){var b=n.getActiveAttrib(f.gl_program,_),A=b.name,w=b.type,I=b.size,P=n.getAttribLocation(f.gl_program,A),L=(r=s.find(function(Z){return Z.name===A}))===null||r===void 0?void 0:r.location;P>=0&&!Pp(L)&&(f.attributes[L]={name:A,location:P,type:w,size:I})},f=this,d=0;d<i;d++)l(d)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,n=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=r.getActiveUniform(this.gl_program,i),s=uF(a.name).name,l=r.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=Z2(r,l,a),a&&a.size>1)for(var f=0;f<a.size;f++)l=r.getUniformLocation(this.gl_program,"".concat(s,"[").concat(f,"]")),this.uniformSetters["".concat(s,"[").concat(f,"]")]=Z2(r,l,a)}},t.prototype.compileShader=function(r,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,r),i.compileShader(a),a},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var n=this.device.gl;if(!Wn(n)){var i=!1;for(var a in r){i||(n.useProgram(this.gl_program),i=!0);var s=r[a],l=this.uniformSetters[a];if(l){var f=s;f instanceof j_&&(f=f.textureIndex),l(f)}}}return this},t}(df),PF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.QueryPool;var l=s.device.gl;if(Wn(l)){var f=a.elemCount,d=a.type;s.gl_query=WD(f,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=TF(d)}return s}return t.prototype.queryResultOcclusion=function(r){var n=this.device.gl;if(Wn(n)){var i=this.gl_query[r];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(Wn(r))for(var n=0;n<this.gl_query.length;n++)r.deleteQuery(this.gl_query[n])},t}(df),OF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=_a.Readback,a.gl_pbo=null,a.gl_sync=null,a}return t.prototype.clientWaitAsync=function(r,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function f(){var d=a.clientWaitSync(r,n,0);if(d==a.WAIT_FAILED){l();return}if(d==a.TIMEOUT_EXPIRED){setTimeout(f,ND(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}f()})},t.prototype.getBufferSubDataAsync=function(r,n,i,a,s,l){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var f;return(0,Mn.__generator)(this,function(d){switch(d.label){case 0:return f=this.device.gl,Wn(f)?(this.gl_sync=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0),f.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return d.sent(),f.bindBuffer(r,n),f.getBufferSubData(r,i,a,s,l),f.bindBuffer(r,null),[2,a];case 2:return[2]}})})},t.prototype.readTexture=function(r,n,i,a,s,l,f,d){return f===void 0&&(f=0),d===void 0&&(d=l.byteLength||0),(0,Mn.__awaiter)(this,void 0,void 0,function(){var _,b,A,w,I;return(0,Mn.__generator)(this,function(P){return _=this.device.gl,b=r,A=this.device.translateTextureFormat(b.format),w=this.device.translateTextureType(b.format),I=zD(b.format),Wn(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,d,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer($e.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D($e.READ_FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_2D,b.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,s,A,w,f*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,f,0)]):[2,this.readTextureSync(r,n,i,a,s,l,f,d)]})})},t.prototype.readTextureSync=function(r,n,i,a,s,l,f,d){d===void 0&&(d=l.byteLength||0);var _=this.device.gl,b=r,A=this.device.translateTextureType(b.format);return _.bindFramebuffer($e.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D($e.FRAMEBUFFER,$e.COLOR_ATTACHMENT0,$e.TEXTURE_2D,b.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,s,_.RGBA,A,l),l},t.prototype.readBuffer=function(r,n,i,a,s){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var l;return(0,Mn.__generator)(this,function(f){return l=this.device.gl,Wn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Cv(r,n),n,i,a,s)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),Wn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(df),DF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;return f.type=_a.RenderPipeline,f.drawMode=xF((s=a.topology)!==null&&s!==void 0?s:gs.TRIANGLES),f.program=a.program,f.inputLayout=a.inputLayout,f.megaState=(0,Mn.__assign)((0,Mn.__assign)({},Tv(Ad)),a.megaStateDescriptor),f.colorAttachmentFormats=a.colorAttachmentFormats.slice(),f.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,f.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,f}return t}(df),FF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=_a.ComputePipeline,s.descriptor=a,s}return t}(df),kF=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var n=(0,Mn.__values)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),BF=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=_a.Sampler;var d=f.device.gl;if(Wn(d)){var _=f.device.ensureResourceExists(d.createSampler());d.samplerParameteri(_,$e.TEXTURE_WRAP_S,Vm(a.addressModeU)),d.samplerParameteri(_,$e.TEXTURE_WRAP_T,Vm(a.addressModeV)),d.samplerParameteri(_,$e.TEXTURE_WRAP_R,Vm((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),d.samplerParameteri(_,$e.TEXTURE_MIN_FILTER,y0(a.minFilter,a.mipmapFilter)),d.samplerParameteri(_,$e.TEXTURE_MAG_FILTER,y0(a.magFilter,Zs.NO_MIP)),a.lodMinClamp!==void 0&&d.samplerParameterf(_,$e.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&d.samplerParameterf(_,$e.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(d.samplerParameteri(_,d.TEXTURE_COMPARE_MODE,d.COMPARE_REF_TO_TEXTURE),d.samplerParameteri(_,d.TEXTURE_COMPARE_FUNC,a.compareFunction));var b=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;b>1&&f.device.EXT_texture_filter_anisotropic!==null&&(Di(a.minFilter===ms.BILINEAR&&a.magFilter===ms.BILINEAR&&a.mipmapFilter===Zs.LINEAR),d.samplerParameterf(_,f.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b)),f.gl_sampler=_}else f.descriptor=a;return f}return t.prototype.setTextureParameters=function(r,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_MIN_FILTER,$e.LINEAR):s.texParameteri(r,$e.TEXTURE_MIN_FILTER,y0(l.minFilter,l.mipmapFilter)),s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_S,Vm(l.addressModeU)),s.texParameteri($e.TEXTURE_2D,$e.TEXTURE_WRAP_T,Vm(l.addressModeV)),s.texParameteri(r,$e.TEXTURE_MAG_FILTER,y0(l.magFilter,Zs.NO_MIP));var f=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Di(l.minFilter===ms.BILINEAR&&l.magFilter===ms.BILINEAR&&l.mipmapFilter===Zs.LINEAR),s.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Wn(this.device.gl)&&this.device.gl.deleteSampler(Z_(this))},t.prototype.isNPOT=function(r,n){return!d0(r)||!d0(n)},t}(df),LF=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,n){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),X2=65536,NF=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,UF=function(){function e(t,r){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Tv(Ad),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=xv.LOWER_LEFT,this.clipSpaceNearZ=bv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=Sd(t.getContextAttributes()),Wn(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),Wn(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new j_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Wi.TEXTURE_2D,mipLevelCount:1,usage:oc.RENDER_TARGET,format:this.contextAttributes.alpha===!1?It.U8_RGB_RT:It.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Uo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Wi.TEXTURE_2D,Uo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Wi.TEXTURE_2D,Uo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:qa.VERTEX,hint:pf.STATIC}),Wn(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Wi.TEXTURE_2D_ARRAY,Uo.Float),this.fallbackTexture3D=this.createFallbackTexture(Wi.TEXTURE_3D,Uo.Float),this.fallbackTextureCube=this.createFallbackTexture(Wi.TEXTURE_CUBE_MAP,Uo.Float)),this.currentMegaState.depthCompare=da.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Pu.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new kF)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var n=t===Wi.TEXTURE_CUBE_MAP?6:1,i=r===Uo.Depth?It.D32F:It.U8_RGBA_NORM,a=this.createTexture({dimension:t,format:i,usage:oc.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return r===Uo.Float&&a.setImageData([new Uint8Array(4*n)]),Rv(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter($e.MAX_VERTEX_ATTRIBS),Wn(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter($e.MAX_UNIFORM_BLOCK_SIZE),X2),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?(0,Mn.__spreadArray)([],(0,Mn.__read)(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=X2;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(t,r,n){var i=this.scTexture;i.width=t,i.height=r,this.scPlatformFramebuffer=jD(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case It.ALPHA:return $e.ALPHA;case It.U8_LUMINANCE:case It.F16_LUMINANCE:case It.F32_LUMINANCE:return $e.LUMINANCE;case It.F16_R:return $e.R16F;case It.F16_RG:return $e.RG16F;case It.F16_RGB:return $e.RGB16F;case It.F16_RGBA:return $e.RGBA16F;case It.F32_R:return $e.R32F;case It.F32_RG:return $e.RG32F;case It.F32_RGB:return $e.RGB32F;case It.F32_RGBA:return Wn(this.gl)?$e.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:$e.RGBA;case It.U8_R_NORM:return $e.R8;case It.U8_RG_NORM:return $e.RG8;case It.U8_RGB_NORM:case It.U8_RGB_RT:return $e.RGB8;case It.U8_RGB_SRGB:return $e.SRGB8;case It.U8_RGBA_NORM:case It.U8_RGBA_RT:return Wn(this.gl)?$e.RGBA8:r?$e.RGBA4:$e.RGBA;case It.U8_RGBA:return $e.RGBA;case It.U8_RGBA_SRGB:case It.U8_RGBA_RT_SRGB:return $e.SRGB8_ALPHA8;case It.U16_R:return $e.R16UI;case It.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case It.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case It.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case It.U16_RGBA_5551:return $e.RGB5_A1;case It.U16_RGB_565:return $e.RGB565;case It.U32_R:return $e.R32UI;case It.S8_RGBA_NORM:return $e.RGBA8_SNORM;case It.S8_RG_NORM:return $e.RG8_SNORM;case It.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case It.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case It.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case It.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case It.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case It.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case It.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case It.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case It.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case It.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case It.D32F_S8:return Wn(this.gl)?$e.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?$e.DEPTH_STENCIL:$e.DEPTH_COMPONENT16;case It.D24_S8:return Wn(this.gl)?$e.DEPTH24_STENCIL8:this.WEBGL_depth_texture?$e.DEPTH_STENCIL:$e.DEPTH_COMPONENT16;case It.D32F:return Wn(this.gl)?$e.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?$e.DEPTH_COMPONENT:$e.DEPTH_COMPONENT16;case It.D24:return Wn(this.gl)?$e.DEPTH_COMPONENT24:this.WEBGL_depth_texture?$e.DEPTH_COMPONENT:$e.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=Jf(t);switch(r){case Sr.U8:return $e.UNSIGNED_BYTE;case Sr.U16:return $e.UNSIGNED_SHORT;case Sr.U32:return $e.UNSIGNED_INT;case Sr.S8:return $e.BYTE;case Sr.F16:return $e.HALF_FLOAT;case Sr.F32:return $e.FLOAT;case Sr.U16_PACKED_5551:return $e.UNSIGNED_SHORT_5_5_5_1;case Sr.D32F:return Wn(this.gl)?$e.FLOAT:this.WEBGL_depth_texture?$e.UNSIGNED_INT:$e.UNSIGNED_BYTE;case Sr.D24:return Wn(this.gl)?$e.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?$e.UNSIGNED_SHORT:$e.UNSIGNED_BYTE;case Sr.D24S8:return Wn(this.gl)?$e.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?$e.UNSIGNED_INT_24_8_WEBGL:$e.UNSIGNED_BYTE;case Sr.D32FS8:return $e.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateTextureFormat=function(t){if(j2(t)||t===It.F32_LUMINANCE||t===It.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=Wn(this.gl)||!Wn(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case It.D24_S8:case It.D32F_S8:return r?$e.DEPTH_STENCIL:$e.RGBA;case It.D24:case It.D32F:return r?$e.DEPTH_COMPONENT:$e.RGBA}var n=H2(t),i=h0(t);switch(i){case Gn.A:return $e.ALPHA;case Gn.R:return n?$e.RED_INTEGER:$e.RED;case Gn.RG:return n?$e.RG_INTEGER:$e.RG;case Gn.RGB:return n?$e.RGB_INTEGER:$e.RGB;case Gn.RGBA:return $e.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(Wn(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){Di(t.compileState!==Nl.NeedsCompile),t.compileState===Nl.Compiling&&(t.compileState=Nl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new CF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new j_({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new BF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new MF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,s=r.mipLevelCount;return Di(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,n,i,a=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return((n=t.vertex)===null||n===void 0?void 0:n.glsl)&&(t.vertex.glsl=Dp(this.queryVendorInfo(),"vert",t.vertex.glsl)),((i=t.fragment)===null||i===void 0?void 0:i.glsl)&&(t.fragment.glsl=Dp(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,a)},e.prototype.createProgramSimple=function(t,r){var n=new IF({id:this.getNextUniqueId(),device:this,descriptor:t},r);return n},e.prototype.createBindings=function(t){return new _F({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new RF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new DF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new LF},e.prototype.createComputePipeline=function(t){return new FF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new OF({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new PF({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,n,i,a,s,l,f=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(n=t.stencilClearValue)!==null&&n!==void 0?n:"load";for(var d=0;d<f.length;d++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[d]=(i=t.colorAttachmentLevel[d])!==null&&i!==void 0?i:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[d]=(a=t.colorResolveToLevel[d])!==null&&a!==void 0?a:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[d]=(s=t.colorClearColor[d])!==null&&s!==void 0?s:"load",t.colorStore||(t.colorStore=[]),t.colorStore[d]=(l=t.colorStore[d])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,n=t.colorAttachmentLevel,i=t.colorClearColor,a=t.colorResolveTo,s=t.colorResolveToLevel,l=t.depthStencilAttachment,f=t.depthClearValue,d=t.stencilClearValue,_=t.depthStencilResolveTo;this.setRenderPassParametersBegin(r.length);for(var b=0;b<r.length;b++)this.setRenderPassParametersColor(b,r[b],n[b],a[b],s[b]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var b=0;b<r.length;b++){var A=i[b];A!=="load"&&this.setRenderPassParametersClearColor(b,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(f,d),this},e.prototype.submitPass=function(t){Di(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,n,i,a,s){var l=this.gl,f=t,d=i;if(Di(d.mipLevelCount===1),Di(f.mipLevelCount===1),Wn(l))f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,d,0),l.blitFramebuffer(a,s,a+d.width,s+d.height,r,n,r+d.width,n+d.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(f===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,f)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,n){switch(t){case It.BC1_SRGB:case It.BC2_SRGB:case It.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?V_(r,n,4,4):!1;case It.BC1:case It.BC2:case It.BC3:return this.WEBGL_compressed_texture_s3tc!==null?V_(r,n,4,4):!1;case It.BC4_UNORM:case It.BC4_SNORM:case It.BC5_UNORM:case It.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?V_(r,n,4,4):!1;case It.U16_R_NORM:case It.U16_RG_NORM:case It.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case It.F32_R:case It.F32_RG:case It.F32_RGB:case It.F32_RGBA:return this.OES_texture_float_linear!==null;case It.F16_R:case It.F16_RG:case It.F16_RGB:case It.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===Nl.NeedsCompile)throw new Error("whoops");if(t.compileState===Nl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(t),n}return t.compileState===Nl.NeedsBind||t.compileState===Nl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===_a.Buffer)for(var n=t.gl_buffer_pages,i=0;i<n.length;i++)jm(n[i],"".concat(r," Page ").concat(i));else if(t.type===_a.Texture)jm(Rv(t),r);else if(t.type===_a.Sampler)jm(Z_(t),r);else if(t.type===_a.RenderTarget){var a=t.gl_renderbuffer;a!==null&&jm(a,r)}else t.type===_a.InputLayout&&jm(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){Di(this.shaderDebug)},e.prototype.getBufferData=function(t,r,n){n===void 0&&(n=0);var i=this.gl;Wn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Cv(t,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var n=this.gl,i=n.getShaderParameter(t,n.COMPILE_STATUS);if(!i){console.error(GD(r));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return i},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,n=t.gl_program;if(!r.getProgramParameter(n,r.LINK_STATUS)){var i=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,i.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,n,i){var a=this.gl;if(Pp(n))a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,null);else if(n.type===_a.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(t,r,$e.TEXTURE_2D,Rv(n.texture),i);else if(n.type===_a.Texture){var s=Rv(n);n.dimension===Wi.TEXTURE_2D?a.framebufferTexture2D(t,r,$e.TEXTURE_2D,s,i):Wn(a)&&n.dimension===Wi.TEXTURE_2D_ARRAY}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var n=this.gl,i=Pp(r)?wn.Depth|wn.Stencil:Ev(r.format),a=!!(i&wn.Depth),s=!!(i&wn.Stencil);if(a&&s){var l=Wn(this.gl)||!Wn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0)}else a?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(t===-1?(t=a.sampleCount,r=a.width,n=a.height):(Di(t===a.sampleCount),Di(r===a.width),Di(n===a.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(Di(t===this.currentDepthStencilAttachment.sampleCount),Di(r===this.currentDepthStencilAttachment.width),Di(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t){var r=this.gl;if(Wn(r)?r.bindFramebuffer($e.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer($e.FRAMEBUFFER,this.renderPassDrawFramebuffer),Wn(r)?r.drawBuffers([$e.COLOR_ATTACHMENT0,$e.COLOR_ATTACHMENT1,$e.COLOR_ATTACHMENT2,$e.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([$e.COLOR_ATTACHMENT0_WEBGL,$e.COLOR_ATTACHMENT1_WEBGL,$e.COLOR_ATTACHMENT2_WEBGL,$e.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var i=Wn(r)?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,a=Wn(r)?$e.COLOR_ATTACHMENT0:$e.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(i,a+n,$e.RENDERBUFFER,null),r.framebufferTexture2D(i,a+n,$e.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,n,i,a){var s=this.gl,l=Wn(s);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==n)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,(l?$e.COLOR_ATTACHMENT0:$e.COLOR_ATTACHMENT0_WEBGL)+t,r,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==i||this.currentColorResolveToLevels[t]!==a)&&(this.currentColorResolveTos[t]=i,this.currentColorResolveToLevels[t]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r){var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Wn(n)?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[t];l&&l.channelWriteMask!==Pu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),l.channelWriteMask=Pu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==Pu.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=Pu.ALL)}this.setScissorRectEnabled(!1),Wn(s)?s.clearBufferfv(s.COLOR,t,[r,n,i,a]):(s.clearColor(r,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var n=this.gl;t!=="load"&&(Di(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Wn(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),r!=="load"&&(Di(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Wn(n)?n.clearBufferiv(n.STENCIL,0,[r]):(n.clearStencil(r),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r,n=this.gl,i=t,a=i.uniformBufferBindings,s=i.samplerBindings,l=i.bindingLayouts;Di(0<l.bindingLayoutTables.length);var f=l.bindingLayoutTables[0];Di(a.length>=f.numUniformBuffers),Di(s.length>=f.numSamplers);for(var d=0;d<a.length;d++){var _=a[d];if(_.size!==0){var b=f.firstUniformBuffer+d,A=_.buffer,w=_.offset||0,I=_.size||A.byteSize;if(A!==this.currentUniformBuffers[b]||w!==this.currentUniformBufferByteOffsets[b]||I!==this.currentUniformBufferByteSizes[b]){var P=w%A.pageByteSize,L=A.gl_buffer_pages[w/A.pageByteSize|0];Di(P+I<=A.pageByteSize),Wn(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,b,L,P,I),this.currentUniformBuffers[b]=A,this.currentUniformBufferByteOffsets[b]=w,this.currentUniformBufferByteSizes[b]=I}}}for(var d=0;d<f.numSamplers;d++){var _=s[d],Z=f.firstSampler+d,Q=_!==null&&_.sampler!==null?Z_(_.sampler):null,oe=_!==null&&_.texture!==null?Rv(_.texture):null;if(this.currentSamplers[Z]!==Q&&(Wn(n)&&n.bindSampler(Z,Q),this.currentSamplers[Z]=Q),this.currentTextures[Z]!==oe){if(this.setActiveTexture(n.TEXTURE0+Z),oe!==null){var Ae=Sd(_).texture,Oe=Ae.gl_target,Ve=Ae.width,rt=Ae.height;_.texture.textureIndex=Z,n.bindTexture(Oe,oe),Wn(n)||(r=_.sampler)===null||r===void 0||r.setTextureParameters(Oe,Ve,rt),this.debugGroupStatisticsTextureBind()}else{var _t=(0,Mn.__assign)((0,Mn.__assign)({},_),B2),Bt=_t.dimension,ur=_t.formatKind,Oe=wF(Bt);n.bindTexture(Oe,this.getFallbackTexture((0,Mn.__assign)({gl_target:Oe,formatKind:ur},_t)))}this.currentTextures[Z]=oe}}},e.prototype.setViewport=function(t,r,n,i){var a=this.gl;a.viewport(t,r,n,i)},e.prototype.setScissorRect=function(t,r,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(t,r,n,i)},e.prototype.applyAttachmentStateIndexed=function(t,r,n){var i=this.gl,a=this.OES_draw_buffers_indexed;r.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(t,!!(n.channelWriteMask&Pu.RED),!!(n.channelWriteMask&Pu.GREEN),!!(n.channelWriteMask&Pu.BLUE),!!(n.channelWriteMask&Pu.ALPHA)),r.channelWriteMask=n.channelWriteMask);var s=r.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=r.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Fp(r.rgbBlendState)&&Fp(r.alphaBlendState)?a.enableiOES(t,i.BLEND):Fp(n.rgbBlendState)&&Fp(n.alphaBlendState)&&a.disableiOES(t,i.BLEND)),s&&(a.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),r.rgbBlendState.blendMode=n.rgbBlendState.blendMode,r.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var n=this.gl;t.channelWriteMask!==r.channelWriteMask&&(n.colorMask(!!(r.channelWriteMask&Pu.RED),!!(r.channelWriteMask&Pu.GREEN),!!(r.channelWriteMask&Pu.BLUE),!!(r.channelWriteMask&Pu.ALPHA)),t.channelWriteMask=r.channelWriteMask);var i=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(a||i)&&(Fp(t.rgbBlendState)&&Fp(t.alphaBlendState)?n.enable(n.BLEND):Fp(r.rgbBlendState)&&Fp(r.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<t.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],t.attachmentsState[0]);else Di(t.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);if(I2(n.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),P2(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),!!n.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),!!n.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite),!g0(n.stencilFront,t.stencilFront)){var a=t.stencilFront,s=a.passOp,l=a.failOp,f=a.depthFailOp,d=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==f)&&(r.stencilOpSeparate(r.FRONT,l,f,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=f),n.stencilFront.compare!==d&&(this.setStencilReference(0),n.stencilFront.compare=d)}if(!g0(n.stencilBack,t.stencilBack)){var _=t.stencilBack,s=_.passOp,l=_.failOp,f=_.depthFailOp,d=_.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==f)&&(r.stencilOpSeparate(r.BACK,l,f,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=f),n.stencilBack.compare!==d&&(this.setStencilReference(0),n.stencilBack.compare=d)}n.cullMode!==t.cullMode&&(n.cullMode===Ll.NONE?r.enable(r.CULL_FACE):t.cullMode===Ll.NONE&&r.disable(r.CULL_FACE),t.cullMode===Ll.BACK?r.cullFace(r.BACK):t.cullMode===Ll.FRONT?r.cullFace(r.FRONT):t.cullMode===Ll.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?(r.polygonOffset(1,1),r.enable(r.POLYGON_OFFSET_FILL)):r.disable(r.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var n=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&Di(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Di(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var r=this.currentPipeline.program;if(this.useProgram(r),r.compileState===Nl.NeedsBind){var n=this.gl,i=r.gl_program,a=r.descriptor,s=G2(a.vertex.glsl,NF);if(Wn(n))for(var l=0;l<s.length;l++){var f=(0,Mn.__read)(s[l],2),d=f[1],_=n.getUniformBlockIndex(i,d);_!==-1&&_!==4294967295&&n.uniformBlockBinding(i,_,l)}for(var b=G2(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<b.length;l++){var A=(0,Mn.__read)(b[l],3),w=A[1],I=A[2],P=n.getUniformLocation(i,w);n.uniform1i(P,parseInt(I))}r.compileState=Nl.ReadyToUse}},e.prototype.setVertexInput=function(t,r,n){var i,a,s;if(t!==null){Di(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var f=this.gl,d=0;d<l.vertexBufferDescriptors.length;d++){var _=l.vertexBufferDescriptors[d],b=_.arrayStride,A=_.attributes;try{for(var w=(i=void 0,(0,Mn.__values)(A)),I=w.next();!I.done;I=w.next()){var P=I.value,L=P.shaderLocation,Z=P.offset,Q=Wn(f)?L:(s=l.program.attributes[L])===null||s===void 0?void 0:s.location;if(!Pp(Q)){var oe=r[d];if(oe===null)continue;var Ae=P.vertexFormat;f.bindBuffer(f.ARRAY_BUFFER,Cv(oe.buffer));var Oe=(oe.offset||0)+Z;f.vertexAttribPointer(Q,Ae.size,Ae.type,Ae.normalized,b,Oe)}}}catch(rt){i={error:rt}}finally{try{I&&!I.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}}if(Di(n!==null==(l.indexBufferFormat!==null)),n!==null){var Ve=n.buffer;Di(Ve.usage===qa.INDEX),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,Cv(Ve)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Di(this.currentPipeline.inputLayout===null),Di(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,n,i){var a,s=this.gl,l=this.currentPipeline;if(r){var f=[l.drawMode,n||0,t,r];Wn(s)?s.drawArraysInstanced.apply(s,(0,Mn.__spreadArray)([],(0,Mn.__read)(f),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,Mn.__spreadArray)([],(0,Mn.__read)(f),!1))}else s.drawArrays(l.drawMode,n,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,n,i,a){var s,l=this.gl,f=this.currentPipeline,d=Sd(f.inputLayout),_=Sd(this.currentIndexBufferByteOffset)+n*d.indexBufferCompByteSize;if(r){var b=[f.drawMode,t,d.indexBufferType,_,r];Wn(l)?l.drawElementsInstanced.apply(l,(0,Mn.__spreadArray)([],(0,Mn.__read)(b),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,Mn.__spreadArray)([],(0,Mn.__read)(b),!1))}else l.drawElements(f.drawMode,t,d.indexBufferType,_);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(Wn(r)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(n.gl_query_type,n.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(Wn(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=Wn(t),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(Di(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?t.bindFramebuffer(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),r?(t.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(t.bindFramebuffer(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,t.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),t.bindFramebuffer(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var f=this.currentDepthStencilAttachment;if(f){var d=this.currentDepthStencilResolveTo,l=!1;d&&(Di(f.width===d.width&&f.height===d.height),this.setScissorRectEnabled(!1),t.bindFramebuffer(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,f),this.bindFramebufferDepthStencilAttachment(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,d)),l=!0,r&&t.blitFramebuffer(0,0,f.width,f.height,0,0,d.width,d.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(t.bindFramebuffer(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,f),l=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),l&&t.bindFramebuffer(r?$e.READ_FRAMEBUFFER:$e.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||t.bindFramebuffer(r?$e.DRAW_FRAMEBUFFER:$e.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){Pp(this.currentStencilRef)||(this.gl.stencilFuncSeparate($e.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate($e.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,n=t.formatKind;if(r===$e.TEXTURE_2D)return n===Uo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===$e.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===$e.TEXTURE_3D)return this.fallbackTexture3D;if(r===$e.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:qa.VERTEX|qa.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Ed.VERTEX,attributes:[{format:It.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:gs.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[It.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Tv(Ad)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[ZD]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),zF=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var r,n,i,a,s,l,f,d,_,b,A;return(0,Mn.__generator)(this,function(w){return r=this.pluginOptions,n=r.targets,i=r.xrCompatible,a=r.antialias,s=a===void 0?!1:a,l=r.preserveDrawingBuffer,f=l===void 0?!1:l,d=r.premultipliedAlpha,_=d===void 0?!0:d,b={antialias:s,preserveDrawingBuffer:f,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(t),n.includes("webgl2")&&(A=t.getContext("webgl2",b)||t.getContext("experimental-webgl2",b)),!A&&n.includes("webgl1")&&(A=t.getContext("webgl",b)||t.getContext("experimental-webgl",b)),[2,new UF(A,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,n=r.onContextLost,i=r.onContextRestored,a=r.onContextCreationError;a&&t.addEventListener("webglcontextcreationerror",a,!1),n&&t.addEventListener("webglcontextlost",n,!1),i&&t.addEventListener("webglcontextrestored",i,!1)},e}();let _s;const $2=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&$2.decode();let Hm=null;function x0(){return(Hm===null||Hm.byteLength===0)&&(Hm=new Uint8Array(_s.memory.buffer)),Hm}function b0(e,t){return e=e>>>0,$2.decode(x0().subarray(e,e+t))}const Lh=new Array(128).fill(void 0);Lh.push(void 0,null,!0,!1);let Wm=Lh.length;function ZF(e){Wm===Lh.length&&Lh.push(Lh.length+1);const t=Wm;return Wm=Lh[t],Lh[t]=e,t}function E0(e){return Lh[e]}function VF(e){e<132||(Lh[e]=Wm,Wm=e)}function jF(e){const t=E0(e);return VF(e),t}let Gm=0;const S0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},HF=typeof S0.encodeInto=="function"?function(e,t){return S0.encodeInto(e,t)}:function(e,t){const r=S0.encode(e);return t.set(r),{read:e.length,written:r.length}};function H_(e,t,r){if(r===void 0){const l=S0.encode(e),f=t(l.length,1)>>>0;return x0().subarray(f,f+l.length).set(l),Gm=l.length,f}let n=e.length,i=t(n,1)>>>0;const a=x0();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=r(i,n,n=s+e.length*3,1)>>>0;const l=x0().subarray(i+s,i+n);s+=HF(e,l).written}return Gm=s,i}let Xm=null;function A0(){return(Xm===null||Xm.byteLength===0)&&(Xm=new Int32Array(_s.memory.buffer)),Xm}function WF(e,t,r){let n,i;try{const l=_s.__wbindgen_add_to_stack_pointer(-16),f=H_(e,_s.__wbindgen_malloc,_s.__wbindgen_realloc),d=Gm,_=H_(t,_s.__wbindgen_malloc,_s.__wbindgen_realloc),b=Gm;_s.glsl_compile(l,f,d,_,b,r);var a=A0()[l/4+0],s=A0()[l/4+1];return n=a,i=s,b0(a,s)}finally{_s.__wbindgen_add_to_stack_pointer(16),_s.__wbindgen_free(n,i,1)}}class $m{static __wrap(t){t=t>>>0;const r=Object.create($m.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();_s.__wbg_wgslcomposer_free(t)}constructor(){const t=_s.wgslcomposer_new();return $m.__wrap(t)}wgsl_compile(t){let r,n;try{const s=_s.__wbindgen_add_to_stack_pointer(-16),l=H_(t,_s.__wbindgen_malloc,_s.__wbindgen_realloc),f=Gm;_s.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,f);var i=A0()[s/4+0],a=A0()[s/4+1];return r=i,n=a,b0(i,a)}finally{_s.__wbindgen_add_to_stack_pointer(16),_s.__wbindgen_free(r,n,1)}}}function GF(e,t){return ty(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=yield e.arrayBuffer();return yield WebAssembly.instantiate(r,t)}else{const r=yield WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}})}function XF(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const n=b0(t,r);return ZF(n)},e.wbg.__wbindgen_object_drop_ref=function(t){jF(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(E0(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(E0(t),E0(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(b0(t,r))},e}function $F(e,t){return _s=e.exports,Y2.__wbindgen_wasm_module=t,Xm=null,Hm=null,_s}function Y2(e){return ty(this,null,function*(){if(_s!==void 0)return _s;const t=XF();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=yield GF(yield e,t);return $F(r,n)})}var _l;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(_l||(_l={}));var W_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(W_||(W_={}));function YF(e){var t=0;return e&oc.SAMPLED&&(t|=_l.TEXTURE_BINDING|_l.COPY_DST),e&oc.RENDER_TARGET&&(t|=_l.RENDER_ATTACHMENT|_l.TEXTURE_BINDING|_l.COPY_SRC|_l.COPY_DST),t}function G_(e){if(e===It.U8_R_NORM)return"r8unorm";if(e===It.U8_RG_NORM)return"rg8unorm";if(e===It.U8_RGBA_RT)return"bgra8unorm";if(e===It.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===It.U8_RGBA_NORM)return"rgba8unorm";if(e===It.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===It.S8_R_NORM)return"r8snorm";if(e===It.S8_RG_NORM)return"rg8snorm";if(e===It.S8_RGBA_NORM)return"rgba8snorm";if(e===It.U32_R)return"r32uint";if(e===It.F16_RGBA)return"rgba16float";if(e===It.F32_RGBA)return"rgba32float";if(e===It.D24)return"depth24plus";if(e===It.D24_S8)return"depth24plus-stencil8";if(e===It.D32F)return"depth32float";if(e===It.D32F_S8)return"depth32float-stencil8";if(e===It.BC1)return"bc1-rgba-unorm";if(e===It.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===It.BC2)return"bc2-rgba-unorm";if(e===It.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===It.BC3)return"bc3-rgba-unorm";if(e===It.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===It.BC4_SNORM)return"bc4-r-snorm";if(e===It.BC4_UNORM)return"bc4-r-unorm";if(e===It.BC5_SNORM)return"bc5-rg-snorm";if(e===It.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function qF(e){if(e===Wi.TEXTURE_2D)return"2d";if(e===Wi.TEXTURE_CUBE_MAP)return"2d";if(e===Wi.TEXTURE_2D_ARRAY)return"2d";if(e===Wi.TEXTURE_3D)return"3d";throw new Error("whoops")}function KF(e){if(e===Wi.TEXTURE_2D)return"2d";if(e===Wi.TEXTURE_CUBE_MAP)return"cube";if(e===Wi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Wi.TEXTURE_3D)return"3d";throw new Error("whoops")}function QF(e){var t=0;return e&qa.INDEX&&(t|=GPUBufferUsage.INDEX),e&qa.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&qa.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&qa.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&qa.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),t|=GPUBufferUsage.COPY_DST,t}function X_(e){if(e===ml.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===ml.REPEAT)return"repeat";if(e===ml.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function q2(e){if(e===ms.BILINEAR)return"linear";if(e===ms.POINT)return"nearest";throw new Error("whoops")}function JF(e){if(e===Zs.LINEAR)return"linear";if(e===Zs.NEAREST)return"nearest";if(e===Zs.NO_MIP)return"nearest";throw new Error("whoops")}function Mv(e){var t=e;return t.gpuBuffer}function ek(e){var t=e;return t.gpuSampler}function tk(e){var t=e;return t.querySet}function rk(e){if(e===f0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function nk(e){switch(e){case gs.TRIANGLES:return"triangle-list";case gs.POINTS:return"point-list";case gs.TRIANGLE_STRIP:return"triangle-strip";case gs.LINES:return"line-list";case gs.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function ik(e){if(e===Ll.NONE)return"none";if(e===Ll.FRONT)return"front";if(e===Ll.BACK)return"back";throw new Error("whoops")}function ak(e){if(e===Um.CCW)return"ccw";if(e===Um.CW)return"cw";throw new Error("whoops")}function ok(e,t){return{topology:nk(e),cullMode:ik(t.cullMode),frontFace:ak(t.frontFace)}}function K2(e){if(e===oa.ZERO)return"zero";if(e===oa.ONE)return"one";if(e===oa.SRC)return"src";if(e===oa.ONE_MINUS_SRC)return"one-minus-src";if(e===oa.DST)return"dst";if(e===oa.ONE_MINUS_DST)return"one-minus-dst";if(e===oa.SRC_ALPHA)return"src-alpha";if(e===oa.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===oa.DST_ALPHA)return"dst-alpha";if(e===oa.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===oa.CONST)return"constant";if(e===oa.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===oa.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function sk(e){if(e===Iu.ADD)return"add";if(e===Iu.SUBSTRACT)return"subtract";if(e===Iu.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Iu.MIN)return"min";if(e===Iu.MAX)return"max";throw new Error("whoops")}function Q2(e){return{operation:sk(e.blendMode),srcFactor:K2(e.blendSrcFactor),dstFactor:K2(e.blendDstFactor)}}function J2(e){return e.blendMode===Iu.ADD&&e.blendSrcFactor===oa.ONE&&e.blendDstFactor===oa.ZERO}function uk(e){if(!(J2(e.rgbBlendState)&&J2(e.alphaBlendState)))return{color:Q2(e.rgbBlendState),alpha:Q2(e.alphaBlendState)}}function lk(e,t){return{format:G_(t),blend:uk(e),writeMask:e.channelWriteMask}}function ck(e,t){return t.attachmentsState.map(function(r,n){return lk(r,e[n])})}function T0(e){if(e===da.NEVER)return"never";if(e===da.LESS)return"less";if(e===da.EQUAL)return"equal";if(e===da.LEQUAL)return"less-equal";if(e===da.GREATER)return"greater";if(e===da.NOTEQUAL)return"not-equal";if(e===da.GEQUAL)return"greater-equal";if(e===da.ALWAYS)return"always";throw new Error("whoops")}function Iv(e){if(e===Xu.KEEP)return"keep";if(e===Xu.REPLACE)return"replace";if(e===Xu.ZERO)return"zero";if(e===Xu.DECREMENT_CLAMP)return"decrement-clamp";if(e===Xu.DECREMENT_WRAP)return"decrement-wrap";if(e===Xu.INCREMENT_CLAMP)return"increment-clamp";if(e===Xu.INCREMENT_WRAP)return"increment-wrap";if(e===Xu.INVERT)return"invert";throw new Error("whoops")}function fk(e,t){if(!Pp(e))return{format:G_(e),depthWriteEnabled:!!t.depthWrite,depthCompare:T0(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0,stencilFront:{compare:T0(t.stencilFront.compare),passOp:Iv(t.stencilFront.passOp),failOp:Iv(t.stencilFront.failOp),depthFailOp:Iv(t.stencilFront.depthFailOp)},stencilBack:{compare:T0(t.stencilBack.compare),passOp:Iv(t.stencilBack.passOp),failOp:Iv(t.stencilBack.failOp),depthFailOp:Iv(t.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function hk(e){if(e!==null){if(e===It.U16_R)return"uint16";if(e===It.U32_R)return"uint32";throw new Error("whoops")}}function pk(e){if(e===Ed.VERTEX)return"vertex";if(e===Ed.INSTANCE)return"instance";throw new Error("whoops")}function dk(e){if(e===It.U8_R)return"uint8x2";if(e===It.U8_RG)return"uint8x2";if(e===It.U8_RGB)return"uint8x4";if(e===It.U8_RGBA)return"uint8x4";if(e===It.U8_RG_NORM)return"unorm8x2";if(e===It.U8_RGBA_NORM)return"unorm8x4";if(e===It.S8_RGB_NORM)return"snorm8x4";if(e===It.S8_RGBA_NORM)return"snorm8x4";if(e===It.U16_RG_NORM)return"unorm16x2";if(e===It.U16_RGBA_NORM)return"unorm16x4";if(e===It.S16_RG_NORM)return"snorm16x2";if(e===It.S16_RGBA_NORM)return"snorm16x4";if(e===It.S16_RG)return"uint16x2";if(e===It.F16_RG)return"float16x2";if(e===It.F16_RGBA)return"float16x4";if(e===It.F32_R)return"float32";if(e===It.F32_RG)return"float32x2";if(e===It.F32_RGB)return"float32x3";if(e===It.F32_RGBA)return"float32x4";throw"whoops"}function vk(e){var t=Jf(e);switch(t){case Sr.BC1:case Sr.BC2:case Sr.BC3:case Sr.BC4_SNORM:case Sr.BC4_UNORM:case Sr.BC5_SNORM:case Sr.BC5_UNORM:return!0;default:return!1}}function mk(e){var t=Jf(e);switch(t){case Sr.BC1:case Sr.BC2:case Sr.BC3:case Sr.BC4_SNORM:case Sr.BC4_UNORM:case Sr.BC5_SNORM:case Sr.BC5_UNORM:return 4;default:return 1}}function eS(e,t,r,n){switch(r===void 0&&(r=!1),e){case It.S8_R:case It.S8_R_NORM:case It.S8_RG_NORM:case It.S8_RGB_NORM:case It.S8_RGBA_NORM:{var i=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return n&&i.set(new Int8Array(n)),i}case It.U8_R:case It.U8_R_NORM:case It.U8_RG:case It.U8_RG_NORM:case It.U8_RGB:case It.U8_RGB_NORM:case It.U8_RGB_SRGB:case It.U8_RGBA:case It.U8_RGBA_NORM:case It.U8_RGBA_SRGB:{var a=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&a.set(new Uint8Array(n)),a}case It.S16_R:case It.S16_RG:case It.S16_RG_NORM:case It.S16_RGB_NORM:case It.S16_RGBA:case It.S16_RGBA_NORM:{var s=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&s.set(new Int16Array(n)),s}case It.U16_R:case It.U16_RGB:case It.U16_RGBA_5551:case It.U16_RGBA_NORM:case It.U16_RG_NORM:case It.U16_R_NORM:{var l=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&l.set(new Uint16Array(n)),l}case It.S32_R:{var f=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&f.set(new Int32Array(n)),f}case It.U32_R:case It.U32_RG:{var d=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&d.set(new Uint32Array(n)),d}case It.F32_R:case It.F32_RG:case It.F32_RGB:case It.F32_RGBA:{var _=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&_.set(new Float32Array(n)),_}}var b=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&b.set(new Uint8Array(n)),b}function gk(e){var t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:(t?-1:1)*Infinity:(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}var eh=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return t.prototype.destroy=function(){},t}(A2),_k=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.Bindings;var l=a.pipeline;Di(!!l);var f=a.uniformBufferBindings,d=a.storageBufferBindings,_=a.samplerBindings;s.numUniformBuffers=(f==null?void 0:f.length)||0;var b=[[],[]],A=0;if(d&&d.length)for(var w=0;w<d.length;w++){var I=a.storageBufferBindings[w],P=I.binding,L=I.size,Z=I.offset,Q=I.buffer,oe={buffer:Mv(Q),offset:Z!=null?Z:0,size:L};b[0].push({binding:P!=null?P:A++,resource:oe})}if(f&&f.length)for(var w=0;w<f.length;w++){var Ae=a.uniformBufferBindings[w],P=Ae.binding,L=Ae.size,Z=Ae.offset,Q=Ae.buffer,oe={buffer:Mv(Q),offset:Z!=null?Z:0,size:L};b[0].push({binding:P!=null?P:A++,resource:oe})}if(_&&_.length){A=0;for(var w=0;w<_.length;w++){var Oe=(0,Mn.__assign)((0,Mn.__assign)({},_[w]),B2),P=a.samplerBindings[w],Ve=P.texture!==null?P.texture:s.device.getFallbackTexture(Oe);Oe.dimension=Ve.dimension,Oe.formatKind=M2(Ve.format);var rt=Ve.gpuTextureView;b[1].push({binding:A++,resource:rt});var _t=P.sampler!==null?P.sampler:s.device.getFallbackSampler(Oe),Bt=ek(_t);b[1].push({binding:A++,resource:Bt})}}return s.gpuBindGroup=b.filter(function(ur){return ur.length>0}).map(function(ur,lr){return s.device.device.createBindGroup({layout:l.getBindGroupLayout(lr),entries:ur})}),s}return t}(eh),yk=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.Buffer;var l=a.usage,f=a.viewOrSize,d=!!(l&qa.MAP_READ);s.usage=QF(l),d&&(s.usage=qa.MAP_READ|qa.COPY_DST);var _=!yv(f);if(s.view=yv(f)?null:f,s.size=yv(f)?v0(f,4):v0(f.byteLength,4),yv(f))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:d?_:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var b=f&&f.constructor||Float32Array;new b(s.gpuBuffer.getMappedRange()).set(f),s.gpuBuffer.unmap()}return s}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-r);var l=n.byteOffset+i,f=l+a,d=a+3&~3;if(d!==a){var _=new Uint8Array(n.buffer.slice(l,f));n=new Uint8Array(d),n.set(_),i=0,l=0,f=d,a=d}for(var b=1024*1024*15,A=0;f-(l+A)>b;)this.device.device.queue.writeBuffer(s,r+A,n.buffer,l+A,b),A+=b;this.device.device.queue.writeBuffer(s,r+A,n.buffer,l+A,a-A)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(eh),xk=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,n){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,n)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){Di(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,n=Sd(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(t){var r=t;this.gpuComputePassEncoder.setBindGroup(0,r.gpuBindGroup[0])},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),bk=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,f=l.computeStage;if(f===null)return s;var d={layout:"auto",compute:(0,Mn.__assign)({},f)};return s.gpuComputePipeline=s.device.device.createComputePipeline(d),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(eh),Ek=function(e){(0,Mn.__extends)(t,e);function t(r){var n,i,a,s,l=r.id,f=r.device,d=r.descriptor,_=e.call(this,{id:l,device:f})||this;_.type=_a.InputLayout;var b=[];try{for(var A=(0,Mn.__values)(d.vertexBufferDescriptors),w=A.next();!w.done;w=A.next()){var I=w.value,P=I.arrayStride,L=I.stepMode,Z=I.attributes;b.push({arrayStride:P,stepMode:pk(L),attributes:[]});try{for(var Q=(a=void 0,(0,Mn.__values)(Z)),oe=Q.next();!oe.done;oe=Q.next()){var Ae=oe.value,Oe=Ae.shaderLocation,Ve=Ae.format,rt=Ae.offset;b[b.length-1].attributes.push({shaderLocation:Oe,format:dk(Ve),offset:rt})}}catch(_t){a={error:_t}}finally{try{oe&&!oe.done&&(s=Q.return)&&s.call(Q)}finally{if(a)throw a.error}}}}catch(_t){n={error:_t}}finally{try{w&&!w.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return _.indexFormat=hk(d.indexBufferFormat),_.buffers=b,_}return t}(eh),tS=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=_a.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,n){var i,a,s=r.glsl,l=r.wgsl,f=r.entryPoint,d=!1,_=l;if(!_)try{_=this.device.glsl_compile(s,n,d)}catch(L){throw console.error(L,s),new Error("whoops")}var b=function(L){if(!_.includes(L))return"continue";_=_.replace("var T_".concat(L,": texture_2d<f32>;"),"var T_".concat(L,": texture_depth_2d;")),_=_.replace(new RegExp("textureSample\\(T_".concat(L,"(.*)\\);$"),"gm"),function(Z,Q){return"vec4<f32>(textureSample(T_".concat(L).concat(Q,"), 0.0, 0.0, 0.0);")})};try{for(var A=(0,Mn.__values)(["u_TextureFramebufferDepth"]),w=A.next();!w.done;w=A.next()){var I=w.value;b(I)}}catch(L){i={error:L}}finally{try{w&&!w.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}var P=this.device.device.createShaderModule({code:_});return{module:P,entryPoint:f||"main"}},t}(eh),Sk=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=_a.QueryPool;var l=a.elemCount,f=a.type;return s.querySet=s.device.device.createQuerySet({type:rk(f),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(eh),Ak=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=_a.Readback,a}return t.prototype.readTexture=function(r,n,i,a,s,l,f,d){return f===void 0&&(f=0),(0,Mn.__awaiter)(this,void 0,void 0,function(){var _,b,A,w,I,P,L,Z;return(0,Mn.__generator)(this,function(Q){return _=r,b=0,A=this.getBlockInformationFromFormat(_.gpuTextureformat),w=Math.ceil(a/A.width)*A.length,I=Math.ceil(w/256)*256,P=I*s,L=this.device.createBuffer({usage:qa.STORAGE|qa.MAP_READ|qa.COPY_DST,hint:pf.STATIC,viewOrSize:P}),Z=this.device.device.createCommandEncoder(),Z.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(b,0)}},{buffer:L.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([Z.finish()]),[2,this.readBuffer(L,0,l.byteLength===P?l:null,f,P,_.format)]})})},t.prototype.readTextureSync=function(r,n,i,a,s,l,f,d){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,n,i,a,s,l,f,d){var _=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=It.U8_RGB),f===void 0&&(f=!1);var b=r,A=s||b.size,w=i||b.view,I=w&&w.constructor&&w.constructor.BYTES_PER_ELEMENT||R2(l),P=b;if(!(b.usage&qa.MAP_READ&&b.usage&qa.COPY_DST)){var L=this.device.device.createCommandEncoder();P=this.device.createBuffer({usage:qa.STORAGE|qa.MAP_READ|qa.COPY_DST,hint:pf.STATIC,viewOrSize:A}),L.copyBufferToBuffer(b.gpuBuffer,n,P.gpuBuffer,0,A),this.device.device.queue.submit([L.finish()])}return new Promise(function(Z,Q){P.gpuBuffer.mapAsync(W_.READ,n,A).then(function(){var oe=P.gpuBuffer.getMappedRange(n,A),Ae=w;if(f)Ae===null?Ae=eS(l,A,!0,oe):Ae=eS(l,Ae.buffer,void 0,oe);else if(Ae===null)switch(I){case 1:Ae=new Uint8Array(A),Ae.set(new Uint8Array(oe));break;case 2:Ae=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,oe);break;case 4:Ae=new Float32Array(A/4),Ae.set(new Float32Array(oe));break}else switch(I){case 1:Ae=new Uint8Array(Ae.buffer),Ae.set(new Uint8Array(oe));break;case 2:Ae=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,oe,w);break;case 4:var Oe=w&&w.constructor||Float32Array;Ae=new Oe(Ae.buffer),Ae.set(new Oe(oe));break}P.gpuBuffer.unmap(),Z(Ae)},function(oe){return Q(oe)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,n,i){i||(i=new Float32Array(r));for(var a=new Uint16Array(n);r--;)i[r]=gk(a[r]);return i},t.prototype.getBlockInformationFromFormat=function(r){switch(r){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},t}(eh),Tk=function(){function e(t){this.device=t,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(t,r){return Di(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,n,i,a,s,l;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var f=t.colorAttachment.length;this.gfxColorAttachment.length=f,this.gfxColorResolveTo.length=f;for(var d=0;d<t.colorAttachment.length;d++){var _=t.colorAttachment[d],b=t.colorResolveTo[d];if(_===null&&b!==null&&(_=b,b=null),this.gfxColorAttachment[d]=_,this.gfxColorResolveTo[d]=b,this.gfxColorAttachmentLevel[d]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[d])||0,this.gfxColorResolveToLevel[d]=((n=t.colorResolveToLevel)===null||n===void 0?void 0:n[d])||0,_!==null){this.gpuColorAttachments[d]===void 0&&(this.gpuColorAttachments[d]={});var A=this.gpuColorAttachments[d];A.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[d])||0);var w=(s=(a=t.colorClearColor)===null||a===void 0?void 0:a[d])!==null&&s!==void 0?s:"load";w==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=w),A.storeOp=((l=t.colorStore)===null||l===void 0?void 0:l[d])?"store":"discard",A.resolveTarget=void 0,b!==null&&(_.sampleCount>1?A.resolveTarget=this.getTextureView(b,this.gfxColorResolveToLevel[d]):A.storeOp="store")}else{this.gpuColorAttachments.length=d,this.gfxColorAttachment.length=d,this.gfxColorResolveTo.length=d;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var I=t.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var P=!!(Ev(I.format)&wn.Depth);P?(t.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var L=!!(Ev(I.format)&wn.Stencil);L?(t.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=Pp(t.occlusionQueryPool)?void 0:tk(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t){Di(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(t),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var n=this.device.swapChainHeight;return n-t-r},e.prototype.setViewport=function(t,r,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,i),n,i,a,s)},e.prototype.setScissorRect=function(t,r,n,i){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,i),n,i)},e.prototype.setPipeline=function(t){var r=t,n=Sd(r.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(t,r,n){if(t!==null){var i=t;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(Mv(n.buffer),Sd(i.indexFormat),n.offset);for(var a=0;a<r.length;a++){var s=r[a];s!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,Mv(s.buffer),s.offset)}}},e.prototype.setBindings=function(t){var r=t;this.gpuRenderPassEncoder.setBindGroup(0,r.gpuBindGroup[0]),r.gpuBindGroup[1]&&this.gpuRenderPassEncoder.setBindGroup(1,r.gpuBindGroup[1])},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,n,i){this.gpuRenderPassEncoder.draw(t,r,n,i)},e.prototype.drawIndexed=function(t,r,n,i,a){this.gpuRenderPassEncoder.drawIndexed(t,r,n,i,a)},e.prototype.drawIndirect=function(t,r){this.gpuRenderPassEncoder.drawIndirect(Mv(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.gpuRenderPassEncoder.drawIndexedIndirect(Mv(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var r=this.gfxColorAttachment[t],n=this.gfxColorResolveTo[t];r!==null&&n!==null&&r.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[t],r,this.gfxColorResolveToLevel[t])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(t,r,n,i){Di(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:t.gpuTexture,mipLevel:r};Di(n.width>>>i==t.width>>>r),Di(n.height>>>i==t.height>>>r),Di(!!(n.usage&_l.COPY_SRC)),Di(!!(t.usage&_l.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,s,[t.width,t.height,1])},e}(),wk=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=_a.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(eh),Ck=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=_a.Sampler;var d=a.lodMinClamp,_=a.mipmapFilter===Zs.NO_MIP?a.lodMinClamp:a.lodMaxClamp,b=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return b>1&&Di(a.minFilter===ms.BILINEAR&&a.magFilter===ms.BILINEAR&&a.mipmapFilter===Zs.LINEAR),f.gpuSampler=f.device.device.createSampler({addressModeU:X_(a.addressModeU),addressModeV:X_(a.addressModeV),addressModeW:X_((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:d,lodMaxClamp:_,minFilter:q2(a.minFilter),magFilter:q2(a.magFilter),mipmapFilter:JF(a.mipmapFilter),compare:a.compareFunction!==void 0?T0(a.compareFunction):void 0,maxAnisotropy:b}),f}return t}(eh),w0=function(e){(0,Mn.__extends)(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,s=r.skipCreate,l=r.sampleCount,f=e.call(this,{id:n,device:i})||this;f.type=_a.Texture;var d=a.format,_=a.dimension,b=a.width,A=a.height,w=a.depthOrArrayLayers,I=a.mipLevelCount,P=a.usage;return f.device.createTextureShared({format:d,dimension:_!=null?_:Wi.TEXTURE_2D,width:b,height:A,depthOrArrayLayers:w!=null?w:1,mipLevelCount:I!=null?I:1,usage:P,sampleCount:l!=null?l:1},f,s),f}return t.prototype.textureFromImageBitmapOrCanvas=function(r,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},f=r.createTexture(l),d=0;d<n.length;d++)r.queue.copyExternalImageToTexture({source:n[d]},{texture:f,origin:[0,0,d]},[a,s]);return[f,a,s]},t.prototype.isImageBitmapOrCanvases=function(r){var n=r[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var n=r[0];return n instanceof HTMLVideoElement},t.prototype.setImageData=function(r,n){var i,a=this.device.device,s,l,f;this.isImageBitmapOrCanvases(r)?(i=(0,Mn.__read)(this.textureFromImageBitmapOrCanvas(a,r,this.depthOrArrayLayers),3),s=i[0],l=i[1],f=i[2]):this.isVideo(r)&&(s=a.importExternalTexture({source:r[0]})),this.width=l,this.height=f,this.gpuTexture=s,this.gpuTextureView=s.createView({dimension:KF(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(eh),Rk=function(){function e(t,r,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=_l.RENDER_ATTACHMENT|_l.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=xv.UPPER_LEFT,this.clipSpaceNearZ=bv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Wi.TEXTURE_2D,Uo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Wi.TEXTURE_2D,Uo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Wi.TEXTURE_2D_ARRAY,Uo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Wi.TEXTURE_3D,Uo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Wi.TEXTURE_CUBE_MAP,Uo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:ml.REPEAT,addressModeV:ml.REPEAT,minFilter:ms.POINT,magFilter:ms.POINT,mipmapFilter:Zs.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:ml.REPEAT,addressModeV:ml.REPEAT,minFilter:ms.POINT,magFilter:ms.POINT,mipmapFilter:Zs.NEAREST,compareFunction:da.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),n=new w0({id:0,device:this,descriptor:{format:It.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Wi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=t,n.gpuTextureView=r,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new yk({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new w0({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new Ck({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new w0({id:this.getNextUniqueId(),device:this,descriptor:(0,Mn.__assign)((0,Mn.__assign)({},t),{dimension:Wi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:oc.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=_a.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,s=r.depthOrArrayLayers,l=r.sampleCount,f=r.mipLevelCount,d=r.gpuTexture,_=r.gpuTextureView,b=r.usage;Di(!!(b&_l.RENDER_ATTACHMENT));var A=new w0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:Wi.TEXTURE_2D,mipLevelCount:f,usage:b},skipCreate:!0});return A.depthOrArrayLayers=s,A.sampleCount=l,A.gpuTexture=d,A.gpuTextureView=_,A},e.prototype.createProgram=function(t){var r,n;return((r=t.vertex)===null||r===void 0?void 0:r.glsl)&&(t.vertex.glsl=Dp(this.queryVendorInfo(),"vert",t.vertex.glsl)),((n=t.fragment)===null||n===void 0?void 0:n.glsl)&&(t.fragment.glsl=Dp(this.queryVendorInfo(),"frag",t.fragment.glsl)),new tS({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new tS({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,n){var i={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},a=t.mipLevelCount,s=G_(t.format),l=qF(t.dimension),f=YF(t.usage);if(r.gpuTextureformat=s,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=a,r.usage=f,r.sampleCount=t.sampleCount,!n){var d=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:t.sampleCount,usage:f}),_=d.createView();r.gpuTexture=d,r.gpuTextureView=_}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===Uo.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,n=t.formatKind;if(r===Wi.TEXTURE_2D)return n===Uo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Wi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Wi.TEXTURE_3D)return this.fallbackTexture3D;if(r===Wi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var n=t===Wi.TEXTURE_CUBE_MAP?6:1,i=r===Uo.Float?It.U8_RGBA_NORM:It.D24;return this.createTexture({dimension:t,format:i,usage:oc.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(t){return new _k({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new Ek({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new bk({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new wk({id:this.getNextUniqueId(),device:this,descriptor:(0,Mn.__assign)({},t)})},e.prototype.createQueryPool=function(t,r){return new Sk({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var n;if(t.gpuRenderPipeline===null){var i=t.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var f=i.megaStateDescriptor||{},d=f.stencilBack,_=f.stencilFront,b=(0,Mn.__rest)(f,["stencilBack","stencilFront"]),A=Tv(Ad);i.megaStateDescriptor=(0,Mn.__assign)((0,Mn.__assign)((0,Mn.__assign)({},A),{stencilBack:(0,Mn.__assign)((0,Mn.__assign)({},A.stencilBack),d),stencilFront:(0,Mn.__assign)((0,Mn.__assign)({},A.stencilFront),_)}),b);var w=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Ae,Oe){i.megaStateDescriptor.attachmentsState[Oe]||(i.megaStateDescriptor.attachmentsState[Oe]=F2(void 0,w))});var I=ok((n=i.topology)!==null&&n!==void 0?n:gs.TRIANGLES,i.megaStateDescriptor),P=ck(i.colorAttachmentFormats,i.megaStateDescriptor),L=fk(i.depthStencilAttachmentFormat,i.megaStateDescriptor),Z=void 0;i.inputLayout!==null&&(Z=i.inputLayout.buffers);var Q=i.sampleCount,oe={layout:"auto",vertex:(0,Mn.__assign)((0,Mn.__assign)({},s),{buffers:Z}),primitive:I,depthStencil:L,multisample:{count:Q},fragment:(0,Mn.__assign)((0,Mn.__assign)({},l),{targets:P})};t.gpuRenderPipeline=this.device.createRenderPipeline(oe)}}},e.prototype.createReadback=function(){return new Ak({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();return r===void 0&&(r=new Tk(this)),r.commandEncoder=this.device.createCommandEncoder(),r.beginRenderPass(t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();return t===void 0&&(t=new xk),t.commandEncoder=this.device.createCommandEncoder(),t.beginComputePass(),t},e.prototype.submitPass=function(t){var r=this.device.queue,n=t,i=n.finish();r.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(t,r,n,i,a,s){var l=this.device.createCommandEncoder(),f=t,d=i,_={texture:d.gpuTexture,origin:[a,s,0]},b={texture:f.gpuTexture,origin:[r,n,0]};Di(!!(d.usage&_l.COPY_SRC)),Di(!!(f.usage&_l.COPY_DST)),l.copyTextureToTexture(_,b,[d.width,d.height,1]),this.device.queue.submit([l.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,n){if(vk(t)){if(!this.featureTextureCompressionBC)return!1;var i=mk(t);return r%i!=0||n%i!=0?!1:this.featureTextureCompressionBC}switch(t){case It.U16_RGBA_NORM:return!1;case It.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===_a.Buffer){var n=t;n.gpuBuffer.label=r}else if(t.type===_a.Texture){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===_a.RenderTarget){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===_a.Sampler){var n=t;n.gpuSampler.label=r}else if(t.type===_a.RenderPipeline){var n=t;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),Mk=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,Mn.__awaiter)(this,void 0,void 0,function(){var r,n,i,a,s,l,f,d;return(0,Mn.__generator)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return r=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return r===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],s=a.filter(function(b){return r.features.has(b)}),[4,r.requestDevice({requiredFeatures:s})]);case 5:if(l=_.sent(),l&&(f=this.pluginOptions.onContextLost,l.lost.then(function(){f&&f()})),l===null)return[2,null];if(d=t.getContext("webgpu"),!d)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,Y2(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new Rk(r,l,t,d,WF,$m&&new $m)]}})})},e}(),Ik=di.isPlainObject,Pk=di.isTypedArray,Ok=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"destroyed",!1),(0,B.Z)(this,"uniforms",{}),this.reGl=t;var n=r.vs,i=r.fs,a=r.attributes,s=r.uniforms,l=r.primitive,f=r.count,d=r.elements,_=r.depth,b=r.cull,A=r.instances,w={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:xv.LOWER_LEFT,clipSpaceNearZ:bv.NEGATIVE_ONE,supportMRT:!1},I={};this.options=r,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(Z){I[Z]=t.prop(Z)}));var P={};Object.keys(a).forEach(function(Z){P[Z]=a[Z].get()});var L={attributes:P,frag:jy(Dp(w,"frag",i,null,!1)),uniforms:I,vert:jy(Dp(w,"vert",n,null,!1)),colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:ED[l===void 0?W.TRIANGLES:l]};A&&(L.instances=A),f?L.count=f:d&&(L.elements=d.get()),this.initDepthDrawParams({depth:_},L),this.initCullDrawParams({cull:b},L),this.drawCommand=t(L),this.drawParams=L}return(0,Y.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var i={};Object.keys(r).forEach(function(a){i[a]=r[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(i){n[i]=r[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,F.Z)((0,F.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,F.Z)((0,F.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,ps.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),a.stencil=this.getStencilDrawParams(r),a.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var r;(r=this.drawParams)===null||r===void 0||(r=r.elements)===null||r===void 0||r.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:wD[i.func||W.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:c0[s&&s.srcRGB||W.SRC_ALPHA],srcAlpha:c0[s&&s.srcAlpha||W.SRC_ALPHA],dstRGB:c0[s&&s.dstRGB||W.ONE_MINUS_SRC_ALPHA],dstAlpha:c0[s&&s.dstAlpha||W.ONE_MINUS_SRC_ALPHA]},equation:{rgb:S2[l&&l.rgb||W.FUNC_ADD],alpha:S2[l&&l.alpha||W.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,d=f===void 0?{cmp:W.ALWAYS,ref:0,mask:-1}:f,_=i.opFront,b=_===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:_,A=i.opBack,w=A===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:A;return{enable:!!a,mask:l,func:(0,F.Z)((0,F.Z)({},d),{},{cmp:CD[d.cmp]}),opFront:{fail:_v[b.fail],zfail:_v[b.zfail],zpass:_v[b.zpass]},opBack:{fail:_v[w.fail],zfail:_v[w.zfail],zpass:_v[w.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var i=r.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?W.BACK:s;n.cull={enable:!!a,face:RD[l]}}}},{key:"extractUniforms",value:function(r){var n=this,i={};return Object.keys(r).forEach(function(a){n.extractUniformsRecursively(a,r[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(r,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Pk(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(r)]=n;return}Ik(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(r,"[").concat(f,"]"))})})}}]),e}(),Dk=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"isDestroy",!1);var n=r.data,i=r.type,a=i===void 0?W.UNSIGNED_BYTE:i,s=r.width,l=r.height,f=r.flipY,d=f===void 0?!1:f,_=r.format,b=_===void 0?W.RGBA:_,A=r.mipmap,w=A===void 0?!1:A,I=r.wrapS,P=I===void 0?W.CLAMP_TO_EDGE:I,L=r.wrapT,Z=L===void 0?W.CLAMP_TO_EDGE:L,Q=r.aniso,oe=Q===void 0?0:Q,Ae=r.alignment,Oe=Ae===void 0?1:Ae,Ve=r.premultiplyAlpha,rt=Ve===void 0?!1:Ve,_t=r.mag,Bt=_t===void 0?W.NEAREST:_t,ur=r.min,lr=ur===void 0?W.NEAREST:ur,zr=r.colorSpace,un=zr===void 0?W.BROWSER_DEFAULT_WEBGL:zr,Rn=r.x,Bi=Rn===void 0?0:Rn,eo=r.y,io=eo===void 0?0:eo,Oo=r.copy,As=Oo===void 0?!1:Oo;this.width=s,this.height=l;var uc={width:s,height:l,type:L_[a],format:SD[b],wrapS:E2[P],wrapT:E2[Z],mag:b2[Bt],min:b2[lr],alignment:Oe,flipY:d,colorSpace:TD[un],premultiplyAlpha:rt,aniso:oe,x:Bi,y:io,copy:As};n&&(uc.data=n),typeof w=="number"?uc.mipmap=AD[w]:typeof w=="boolean"&&(uc.mipmap=w),this.texture=t.texture(uc)}return(0,Y.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),rS,nS,Fk=(rS=(0,ot.b2)(),rS(nS=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"createModel",function(r){return new Ok(t.gl,r)}),(0,B.Z)(this,"createAttribute",function(r){return new bD(t.gl,r)}),(0,B.Z)(this,"createBuffer",function(r){return new MD(t.gl,r)}),(0,B.Z)(this,"createElements",function(r){return new ID(t.gl,r)}),(0,B.Z)(this,"createTexture2D",function(r){return new Dk(t.gl,r)}),(0,B.Z)(this,"createFramebuffer",function(r){return new PD(t.gl,r)}),(0,B.Z)(this,"useFramebuffer",function(r,n){t.gl({framebuffer:r?r.get():null})(n)}),(0,B.Z)(this,"clear",function(r){var n,i=r.color,a=r.depth,s=r.stencil,l=r.framebuffer,f=l===void 0?null:l,d={color:i,depth:a,stencil:s};d.framebuffer=f===null?f:f.get(),(n=t.gl)===null||n===void 0||n.clear(d)}),(0,B.Z)(this,"viewport",function(r){var n=r.x,i=r.y,a=r.width,s=r.height;t.gl._gl.viewport(n,i,a,s),t.width=a,t.height=s,t.gl._refresh()}),(0,B.Z)(this,"readPixels",function(r){var n=r.framebuffer,i=r.x,a=r.y,s=r.width,l=r.height,f={x:i,y:a,width:s,height:l};return n&&(f.framebuffer=n.get()),t.gl.read(f)}),(0,B.Z)(this,"getViewportSize",function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}}),(0,B.Z)(this,"getContainer",function(){var r;return(r=t.canvas)===null||r===void 0?void 0:r.parentElement}),(0,B.Z)(this,"getCanvas",function(){return t.canvas}),(0,B.Z)(this,"getGLContext",function(){return t.gl._gl}),(0,B.Z)(this,"destroy",function(){var r;t.canvas=null,(r=t.gl)===null||r===void 0||(r=r._gl)===null||r===void 0||(r=r.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),t.gl.destroy(),t.gl=null})}return(0,Y.Z)(e,[{key:"init",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a,s){var l=this;return ve().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.canvas=i,!s){d.next=5;break}this.gl=s,d.next=8;break;case 5:return d.next=7,new Promise(function(_,b){xD()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(w,I){(w||!I)&&b(w),_(I)}})});case 7:this.gl=d.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return d.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||nS),kk=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.buffer,i=r.offset,a=r.stride,s=r.normalized,l=r.size,f=r.divisor,d=r.shaderLocation;this.buffer=n,this.attribute={shaderLocation:d,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,Y.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),kp,Nh,Pv,Ym,qm,th,C0,Td,Ou,R0=(kp={},(0,B.Z)(kp,W.FLOAT,Float32Array),(0,B.Z)(kp,W.UNSIGNED_BYTE,Uint8Array),(0,B.Z)(kp,W.SHORT,Int16Array),(0,B.Z)(kp,W.UNSIGNED_SHORT,Uint16Array),(0,B.Z)(kp,W.INT,Int32Array),(0,B.Z)(kp,W.UNSIGNED_INT,Uint32Array),kp),Bk=(Nh={},(0,B.Z)(Nh,W.POINTS,gs.POINTS),(0,B.Z)(Nh,W.LINES,gs.LINES),(0,B.Z)(Nh,W.LINE_LOOP,gs.LINES),(0,B.Z)(Nh,W.LINE_STRIP,gs.LINE_STRIP),(0,B.Z)(Nh,W.TRIANGLES,gs.TRIANGLES),(0,B.Z)(Nh,W.TRIANGLE_FAN,gs.TRIANGLES),(0,B.Z)(Nh,W.TRIANGLE_STRIP,gs.TRIANGLE_STRIP),Nh),Lk=(Pv={},(0,B.Z)(Pv,1,It.F32_R),(0,B.Z)(Pv,2,It.F32_RG),(0,B.Z)(Pv,3,It.F32_RGB),(0,B.Z)(Pv,4,It.F32_RGBA),Pv),Nk=(Ym={},(0,B.Z)(Ym,W.STATIC_DRAW,pf.STATIC),(0,B.Z)(Ym,W.DYNAMIC_DRAW,pf.DYNAMIC),(0,B.Z)(Ym,W.STREAM_DRAW,pf.DYNAMIC),Ym),iS=(qm={},(0,B.Z)(qm,W.REPEAT,ml.REPEAT),(0,B.Z)(qm,W.CLAMP_TO_EDGE,ml.CLAMP_TO_EDGE),(0,B.Z)(qm,W.MIRRORED_REPEAT,ml.MIRRORED_REPEAT),qm),Uk=(th={},(0,B.Z)(th,W.NEVER,da.NEVER),(0,B.Z)(th,W.ALWAYS,da.ALWAYS),(0,B.Z)(th,W.LESS,da.LESS),(0,B.Z)(th,W.LEQUAL,da.LEQUAL),(0,B.Z)(th,W.GREATER,da.GREATER),(0,B.Z)(th,W.GEQUAL,da.GEQUAL),(0,B.Z)(th,W.EQUAL,da.EQUAL),(0,B.Z)(th,W.NOTEQUAL,da.NOTEQUAL),th),zk=(C0={},(0,B.Z)(C0,W.FRONT,Ll.FRONT),(0,B.Z)(C0,W.BACK,Ll.BACK),C0),aS=(Td={},(0,B.Z)(Td,W.FUNC_ADD,Iu.ADD),(0,B.Z)(Td,W.MIN_EXT,Iu.MIN),(0,B.Z)(Td,W.MAX_EXT,Iu.MAX),(0,B.Z)(Td,W.FUNC_SUBTRACT,Iu.SUBSTRACT),(0,B.Z)(Td,W.FUNC_REVERSE_SUBTRACT,Iu.REVERSE_SUBSTRACT),Td),M0=(Ou={},(0,B.Z)(Ou,W.ZERO,oa.ZERO),(0,B.Z)(Ou,W.ONE,oa.ONE),(0,B.Z)(Ou,W.SRC_COLOR,oa.SRC),(0,B.Z)(Ou,W.ONE_MINUS_SRC_COLOR,oa.ONE_MINUS_SRC),(0,B.Z)(Ou,W.SRC_ALPHA,oa.SRC_ALPHA),(0,B.Z)(Ou,W.ONE_MINUS_SRC_ALPHA,oa.ONE_MINUS_SRC_ALPHA),(0,B.Z)(Ou,W.DST_COLOR,oa.DST),(0,B.Z)(Ou,W.ONE_MINUS_DST_COLOR,oa.ONE_MINUS_DST),(0,B.Z)(Ou,W.DST_ALPHA,oa.DST_ALPHA),(0,B.Z)(Ou,W.ONE_MINUS_DST_ALPHA,oa.ONE_MINUS_DST_ALPHA),(0,B.Z)(Ou,W.CONSTANT_COLOR,oa.CONST),(0,B.Z)(Ou,W.ONE_MINUS_CONSTANT_COLOR,oa.ONE_MINUS_CONSTANT),(0,B.Z)(Ou,W.CONSTANT_ALPHA,oa.CONST),(0,B.Z)(Ou,W.ONE_MINUS_CONSTANT_ALPHA,oa.ONE_MINUS_CONSTANT),(0,B.Z)(Ou,W.SRC_ALPHA_SATURATE,oa.SRC_ALPHA_SATURATE),Ou),Zk={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function I0(e){return Object.prototype.toString.call(e)in Zk}var Vk=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"isDestroyed",!1);var n=r.data,i=r.usage,a=r.type,s=r.isUBO,l;I0(n)?l=n:l=new R0[this.type||W.FLOAT](n),this.type=a,this.size=l.byteLength,this.buffer=t.createBuffer({viewOrSize:l,usage:s?qa.UNIFORM:qa.VERTEX,hint:Nk[i||W.STATIC_DRAW]})}return(0,Y.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,i=r.offset,a;I0(n)?a=n:a=new R0[this.type||W.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),jk=function(){function e(t,r){(0,ye.Z)(this,e);var n=r.data,i=r.type,a=r.count,s=a===void 0?0:a,l;I0(n)?l=n:l=new R0[this.type||W.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=t.createBuffer({viewOrSize:l,usage:qa.INDEX})}return(0,Y.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(r){var n=r.data,i;I0(n)?i=n:i=new R0[this.type||W.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function Hk(e){return!1}var Wk=function(){function e(t,r){(0,ye.Z)(this,e),(0,B.Z)(this,"isDestroy",!1);var n=r.data,i=r.type,a=i===void 0?W.UNSIGNED_BYTE:i,s=r.width,l=r.height,f=r.flipY,d=f===void 0?!1:f,_=r.format,b=_===void 0?W.RGBA:_,A=r.wrapS,w=A===void 0?W.CLAMP_TO_EDGE:A,I=r.wrapT,P=I===void 0?W.CLAMP_TO_EDGE:I,L=r.alignment,Z=L===void 0?1:L;this.width=s,this.height=l;var Q=It.U8_RGBA_RT;if(a===W.UNSIGNED_BYTE&&b===W.RGBA)Q=It.U8_RGBA_RT;else if(b===W.LUMINANCE&&a===W.FLOAT)Q=It.F32_LUMINANCE;else if(b===W.LUMINANCE&&a===W.UNSIGNED_BYTE)Q=It.U8_LUMINANCE;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(b));this.texture=t.createTexture({format:Q,width:s,height:l,usage:oc.SAMPLED,pixelStore:{unpackFlipY:d,packAlignment:Z}}),n&&this.texture.setImageData([n]),this.sampler=t.createSampler({addressModeU:iS[w],addressModeV:iS[P],minFilter:ms.POINT,magFilter:ms.BILINEAR,mipmapFilter:Zs.NO_MIP,lodMinClamp:0,lodMaxClamp:0})}return(0,Y.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(r){var n=r.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),Gk=function(){function e(t,r){(0,ye.Z)(this,e),this.device=t;var n=r.width,i=r.height,a=r.color;Hk(a)?(this.renderTarget=t.createRenderTargetFromTexture(a.get()),this.width=a.width,this.height=a.height):n&&i&&(this.renderTarget=t.createRenderTarget({format:It.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}return(0,Y.Z)(e,[{key:"get",value:function(){return this.renderTarget}},{key:"destroy",value:function(){this.renderTarget.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;(this.width!==n||this.height!==i)&&(this.renderTarget&&this.renderTarget.destroy(),this.renderTarget=this.device.createRenderTarget({format:It.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}}]),e}(),Xk=di.isPlainObject,$k=di.isTypedArray,Yk=function(){function e(t,r){var n=this;(0,ye.Z)(this,e),(0,B.Z)(this,"destroyed",!1),(0,B.Z)(this,"uniforms",{}),(0,B.Z)(this,"vertexBuffers",[]),this.device=t,this.options=r;var i=r.vs,a=r.fs,s=r.attributes,l=r.uniforms,f=r.count,d=r.elements;this.options=r;var _=t.createProgram({vertex:{glsl:i},fragment:{glsl:a}});this.program=_,l&&(this.uniforms=this.extractUniforms(l));var b=[],A=0;Object.keys(s).forEach(function(I){var P=s[I],L=P.get();n.vertexBuffers.push(L.get());var Z=P.attribute,Q=Z.offset,oe=Q===void 0?0:Q,Ae=Z.stride,Oe=Ae===void 0?0:Ae,Ve=Z.size,rt=Ve===void 0?1:Ve,_t=Z.divisor,Bt=_t===void 0?0:_t,ur=Z.shaderLocation,lr=ur===void 0?0:ur;b.push({arrayStride:Oe||rt*4,stepMode:Ed.VERTEX,attributes:[{format:Lk[rt],shaderLocation:lr,offset:oe,divisor:Bt}]}),A=L.size/rt}),f||(this.options.count=A),d&&(this.indexBuffer=d.get());var w=t.createInputLayout({vertexBufferDescriptors:b,indexBufferFormat:d?It.U32_R:null,program:_});this.inputLayout=w,this.pipeline=this.createPipeline(r)}return(0,Y.Z)(e,[{key:"createPipeline",value:function(r){var n=r.primitive,i=n===void 0?W.TRIANGLES:n,a=r.depth,s=r.cull,l=r.blend,f=this.initDepthDrawParams({depth:a}),d=!!(f&&f.enable),_=this.initCullDrawParams({cull:s}),b=!!(_&&_.enable),A=this.getBlendDrawParams({blend:l}),w=!!(A&&A.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:Bk[i],colorAttachmentFormats:[It.U8_RGBA_RT],depthStencilAttachmentFormat:It.D24_S8,megaStateDescriptor:{attachmentsState:[{channelWriteMask:Pu.ALL,rgbBlendState:{blendMode:w&&A.equation.rgb||Iu.ADD,blendSrcFactor:w&&A.func.srcRGB||oa.SRC_ALPHA,blendDstFactor:w&&A.func.dstRGB||oa.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:w&&A.equation.alpha||Iu.ADD,blendSrcFactor:w&&A.func.srcAlpha||oa.ONE,blendDstFactor:w&&A.func.dstAlpha||oa.ONE_MINUS_SRC_ALPHA}}],blendConstant:N_,depthWrite:d,depthCompare:d&&f.func||da.LESS,cullMode:b&&_.face||Ll.NONE,stencilWrite:!1}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(r){this.uniforms=(0,F.Z)((0,F.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r){var n=(0,F.Z)((0,F.Z)({},this.options),r),i=n.count,a=i===void 0?0:i,s=n.instances,l=n.elements,f=n.uniforms,d=f===void 0?{}:f,_=n.uniformBuffers,b=n.textures;this.uniforms=(0,F.Z)((0,F.Z)({},this.uniforms),this.extractUniforms(d));var A=this.device,w=A.width,I=A.height,P=this.device.renderPass;if(this.pipeline=this.createPipeline(n),P.setPipeline(this.pipeline),P.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(Z){return{buffer:Z}}),l?{buffer:this.indexBuffer,offset:0}:null),P.setViewport(0,0,w,I),_&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:_.map(function(Z,Q){var oe=Z;return{binding:Q,buffer:oe.get(),size:oe.size}}),samplerBindings:b==null?void 0:b.map(function(Z){return{texture:Z.texture,sampler:Z.sampler}})})),this.bindings&&(P.setBindings(this.bindings),this.program.setUniformsLegacy(this.uniforms)),l){var L=l.count;L===0?P.draw(a,s):P.drawIndexed(L,s)}else P.draw(a,s)}},{key:"destroy",value:function(){var r,n,i;this.program.destroy(),(r=this.vertexBuffers)===null||r===void 0||r.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r){var n=r.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:Uk[n.func||W.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:M0[s&&s.srcRGB||W.SRC_ALPHA],srcAlpha:M0[s&&s.srcAlpha||W.SRC_ALPHA],dstRGB:M0[s&&s.dstRGB||W.ONE_MINUS_SRC_ALPHA],dstAlpha:M0[s&&s.dstAlpha||W.ONE_MINUS_SRC_ALPHA]},equation:{rgb:aS[l&&l.rgb||W.FUNC_ADD],alpha:aS[l&&l.alpha||W.FUNC_ADD]},color:d}}},{key:"initCullDrawParams",value:function(r){var n=r.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?W.BACK:a;return{enable:!!i,face:zk[s]}}}},{key:"extractUniforms",value:function(r){var n=this,i={};return Object.keys(r).forEach(function(a){n.extractUniformsRecursively(a,r[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(r,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||$k(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(r)]=n;return}Xk(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(r,"[").concat(f,"]"))})})}}]),e}();function qk(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var oS,sS,Kk=(oS=(0,ot.b2)(),oS(sS=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,B.Z)(this,"uniformBuffers",[]),(0,B.Z)(this,"createModel",function(r){return new Yk(t.device,r)}),(0,B.Z)(this,"createAttribute",function(r){return new kk(t.device,r)}),(0,B.Z)(this,"createBuffer",function(r){return new Vk(t.device,r)}),(0,B.Z)(this,"createElements",function(r){return new jk(t.device,r)}),(0,B.Z)(this,"createTexture2D",function(r){return new Wk(t.device,r)}),(0,B.Z)(this,"createFramebuffer",function(r){return new Gk(t.device,r)}),(0,B.Z)(this,"useFramebuffer",function(){}),(0,B.Z)(this,"clear",function(){}),(0,B.Z)(this,"viewport",function(r){var n=r.width,i=r.height;t.width=n,t.height=i,t.device.width=n,t.device.height=i}),(0,B.Z)(this,"readPixels",function(){return new Uint8Array}),(0,B.Z)(this,"getViewportSize",function(){return{width:t.device.width,height:t.device.height}}),(0,B.Z)(this,"getContainer",function(){var r;return(r=t.canvas)===null||r===void 0?void 0:r.parentElement}),(0,B.Z)(this,"getCanvas",function(){return t.canvas}),(0,B.Z)(this,"getGLContext",function(){return t.device.gl}),(0,B.Z)(this,"destroy",function(){var r;t.canvas=null,(r=t.uniformBuffers)===null||r===void 0||r.forEach(function(n){n.destroy()}),t.device.destroy()})}return(0,Y.Z)(e,[{key:"init",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a){var s,l,f,d,_,b;return ve().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,f=s?new Mk({shaderCompilerPath:l}):new zF({targets:["webgl2","webgl1"],onContextLost:function(P){console.warn("context lost",P)},onContextCreationError:function(P){console.warn("context creation error",P)},onContextRestored:function(P){console.warn("context restored",P)}}),w.next=5,f.createSwapChain(i);case 5:d=w.sent,d.configureSwapChain(i.width,i.height),this.device=d.getDevice(),this.swapChain=d,_=this.device.gl,this.extensionObject={OES_texture_float:!qk(_)&&this.device.OES_texture_float},b=this.device.createTexture({format:It.U8_RGBA_RT,width:i.width,height:i.height,usage:oc.RENDER_TARGET}),this.renderTarget=this.device.createRenderTargetFromTexture(b),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:It.D24_S8,width:i.width,height:i.height,usage:oc.RENDER_TARGET}));case 14:case"end":return w.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"beginFrame",value:function(){var r=this.swapChain.getOnscreenTexture();this.renderPass=this.device.createRenderPass({colorAttachment:[this.renderTarget],colorResolveTo:[r],colorClearColor:[N_],depthStencilAttachment:this.mainDepthRT,depthClearValue:1}),this.device.renderPass=this.renderPass}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var r=this.device.gl;return r.getParameter(r.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||sS);function Qk(e){var t=Jk();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function Jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $_=["selectstart","selecting","selectend"],eB=function(e){(0,tt.Z)(r,e);var t=Qk(r);function r(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ye.Z)(this,r),i=t.call(this),(0,B.Z)((0,Ee.Z)(i),"isEnable",!1),(0,B.Z)((0,Ee.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,B.Z)((0,Ee.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,B.Z)((0,Ee.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,Y.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=Fn("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,f=l.x,d=l.y,_=Math.min(a,f),b=Math.min(s,d),A=Math.abs(a-f),w=Math.abs(s-d);this.box.style.top="".concat(b,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(w,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,f=l.lng,d=l.lat;return wf([[a,s],[f,d]])}}]),r}(ka.EventEmitter),tB=function(){function e(t){(0,ye.Z)(this,e);var r=t.id,n=t.map,i=t.canvas,a=t.hasBaseMap,s=t.renderer,l=s===void 0?"regl":s,f=XT();this.container=f,n.setContainer(f,r,i,a),f.bind(pt.IRendererService).to(l==="regl"?Fk:Kk).inSingletonScope(),this.sceneService=f.get(pt.ISceneService),this.mapService=f.get(pt.IMapService),this.iconService=f.get(pt.IIconService),this.fontService=f.get(pt.IFontService),this.controlService=f.get(pt.IControlService),this.layerService=f.get(pt.ILayerService),this.debugService=f.get(pt.IDebugService),this.debugService.setEnable(t.debug),this.markerService=f.get(pt.IMarkerService),this.interactionService=f.get(pt.IInteractionService),this.popupService=f.get(pt.IPopupService),this.boxSelect=new eB(this,{}),this.initComponent(r),this.sceneService.init(t),this.initControl()}return(0,Y.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i){return ve().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var i=new r(this);i.init()}else this.on("loaded",function(){var a=new r(n);a.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,i=_m(this.container);if(r.setContainer(i,this.container),this.sceneService.addLayer(r),r.inited){var a=this.initMask(r);this.addMask(a,r.id)}else r.on("inited",function(){var s=n.initMask(r);n.addMask(s,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,f=n.maskOpacity,d=f===void 0?0:f;if(!(!i||!a)){var _=new db().source(a).shape("fill").style({color:l,opacity:d});return _}}},{key:"addMask",value:function(r,n){if(!!r){var i=this.getLayer(n);if(i){var a=_m(this.container);r.setContainer(a,this.container),i.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var t=(0,Ot.Z)(ve().mark(function n(){return ve().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(i){var a=(0,K.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(r,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var t=(0,Ot.Z)(ve().mark(function n(i,a){return ve().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if($_.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.on(r,n)}else Og.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if($_.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.once(r,n)}else Og.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){Og.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if($_.includes(r)){var i;(i=this.boxSelect)===null||i===void 0||i.off(r,n)}else Og.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(r,n||(0,F.Z)((0,F.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(pt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return Hr.REGISTERED_PROTOCOLS[r]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Lu(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,i=r.logoPosition;n&&this.addControl(new fx({position:i}))}}],[{key:"addProtocol",value:function(r,n){Hr.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete Hr.REGISTERED_PROTOCOLS[r]}}]),e}(),l7="2.20.5";function Km(e){return Km=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Km(e)}function uS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function c7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uS(Object(r),!0).forEach(function(n){rB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rB(e,t,r){return t=nB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nB(e){var t=iB(e,"string");return Km(t)==="symbol"?t:String(t)}function iB(e,t){if(Km(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Km(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function f7(e,t){return uB(e)||sB(e,t)||oB(e,t)||aB()}function aB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oB(e,t){if(!!e){if(typeof e=="string")return lS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lS(e,t)}}function lS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function uB(e){if(Array.isArray(e))return e}var h7=null,p7=null,cS,Y_,fS,lB=(cS=K0(pt.IGlobalConfigService),Y_=function(){function e(t){(0,ye.Z)(this,e),an(this,"configService",fS,this),this.config=t}return(0,Y.Z)(e,[{key:"setContainer",value:function(r,n,i,a){r.bind(pt.MapConfig).toConstantValue((0,F.Z)((0,F.Z)({},this.config),{},{id:n,canvas:i,hasBaseMap:a})),r.bind(pt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),fS=jr(Y_.prototype,"configService",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_),cB=N(6158),Qm=N.n(cB),fB=function(){function e(t){(0,ye.Z)(this,e),(0,B.Z)(this,"size",1e4),this.size=t||1e4}return(0,Y.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),i=this.mercatorYfromLat(r[1]);return[n,i]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),i=this.latFromMercatorY(r[1]);return[n,i]}}]),e}(),hB={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},hS,pS,dS,vS,mS,gS,Ov,_S,yS,xS,bS,ES={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},pB=12,dB=(hS=(0,ot.b2)(),pS=(0,ot.f3)(pt.MapConfig),dS=(0,ot.f3)(pt.IGlobalConfigService),vS=(0,ot.f3)(pt.ICoordinateSystemService),mS=(0,ot.f3)(pt.IEventEmitter),hS(gS=(Ov=function(){function e(){var t=this;(0,ye.Z)(this,e),(0,B.Z)(this,"version","DEFAUlTMAP"),(0,B.Z)(this,"simpleMapCoord",new fB),(0,B.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),an(this,"config",_S,this),an(this,"configService",yS,this),an(this,"coordinateSystemService",xS,this),an(this,"eventEmitter",bS,this),(0,B.Z)(this,"handleCameraChanged",function(r){var n=t.map.getCenter(),i=n.lat,a=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[a,i],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0}),t.updateCoordinateSystemService(),t.cameraChangedCallback(t.viewport)})}return(0,Y.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Fn("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){aw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(ES[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(ES[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return hB}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[r].concat(a))}},{key:"once",value:function(r){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[r].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),i=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>pB&&n?this.coordinateSystemService.setCoordinateSystem(Oc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Oc.LNGLAT)}}]),e}(),_S=jr(Ov.prototype,"config",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=jr(Ov.prototype,"configService",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xS=jr(Ov.prototype,"coordinateSystemService",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bS=jr(Ov.prototype,"eventEmitter",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov))||gS);function Jm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function P0(e,t){var r=qi([],t,e);return is(r,r,1/r[3]),r}function d7(e,t){var r=e%t;return r<0?t+r:r}function v7(e,t,r){return r*t+(1-r)*e}function wd(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var vf=Math.PI,SS=vf/4,Uh=vf/180,AS=180/vf,q_=512,K_=4003e4,vB=1.5;function TS(e){return Math.pow(2,e)}function mB(e){return Math.log2(e)}function O0(e,t){var r=(0,K.Z)(e,2),n=r[0],i=r[1];wd(Number.isFinite(n)&&Number.isFinite(t)),wd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),t*=q_;var a=n*Uh,s=i*Uh,l=t*(a+vf)/(2*vf),f=t*(vf-Math.log(Math.tan(SS+s*.5)))/(2*vf);return[l,f]}function Q_(e,t){var r=(0,K.Z)(e,2),n=r[0],i=r[1];t*=q_;var a=n/t*(2*vf)-vf,s=2*(Math.atan(Math.exp(vf-i/t*(2*vf)))-SS);return[a*AS,s*AS]}function m7(e){var t=e.latitude;assert(Number.isFinite(t));var r=Math.cos(t*Uh);return mB(K_*r)-9}function wS(e){var t=e.latitude,r=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:TS(n),wd(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i));var l={},f=q_*i,d=Math.cos(t*Uh),_=f/360,b=_/d,A=f/K_/d;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[_,-b,A],l.degreesPerPixel=[1/_,-1/b,1/A],s){var w=Uh*Math.tan(t*Uh)/d,I=_*w/2,P=f/K_*w,L=P/b*A;l.pixelsPerDegree2=[0,-I,P],l.pixelsPerMeter2=[L,0,L]}return l}function g7(e,t){var r=_slicedToArray(e,3),n=r[0],i=r[1],a=r[2],s=_slicedToArray(t,3),l=s[0],f=s[1],d=s[2],_=1,b=wS({longitude:n,latitude:i,scale:_,highPrecision:!0}),A=b.pixelsPerMeter,w=b.pixelsPerMeter2,I=O0(e,_);I[0]+=l*(A[0]+w[0]*f),I[1]+=f*(A[1]+w[1]*f);var P=Q_(I,_),L=(a||0)+(d||0);return Number.isFinite(a)||Number.isFinite(d)?[P[0],P[1],L]:P}function gB(e){var t=e.height,r=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,f=l===void 0?!1:l,d=Jm();return Ga(d,d,[0,0,-i]),Js(d,d,[1,1,1/t]),eu(d,d,-r*Uh),pl(d,d,n*Uh),f&&Js(d,d,[1,-1,1]),s&&Ga(d,d,wa.negate([],s)),d}function _B(e){var t=e.width,r=e.height,n=e.altitude,i=n===void 0?vB:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,f=l===void 0?1:l,d=e.farZMultiplier,_=d===void 0?1:d,b=s*Uh,A=Math.atan(.5/i),w=Math.sin(A)*i/Math.sin(Math.PI/2-b-A),I=Math.cos(Math.PI/2-b)*w+i;return{fov:2*Math.atan(r/2/i),aspect:t/r,focalDistance:i,near:f,far:I*_}}function yB(e){var t=e.width,r=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=_B({width:t,height:r,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),f=l.fov,d=l.aspect,_=l.near,b=l.far,A=Zd([],f,d,_,b);return A}function xB(e,t){var r=(0,K.Z)(e,3),n=r[0],i=r[1],a=r[2],s=a===void 0?0:a;return wd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),P0(t,[n,i,s,1])}function CS(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,K.Z)(e,3),i=n[0],a=n[1],s=n[2];if(wd(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=P0(t,[i,a,s,1]);return l}var f=P0(t,[i,a,0,1]),d=P0(t,[i,a,1,1]),_=f[2],b=d[2],A=_===b?0:((r||0)-_)/(b-_);return Mr.lerp([],f,d,A)}var RS=Jm(),bB=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,n=t.height,i=t.viewMatrix,a=i===void 0?RS:i,s=t.projectionMatrix,l=s===void 0?RS:s;(0,ye.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var f=Jm();Pi(f,f,this.projectionMatrix),Pi(f,f,this.viewMatrix),this.viewProjectionMatrix=f;var d=Jm();Js(d,d,[this.width/2,-this.height/2,1]),Ga(d,d,[1,-1,0]),Pi(d,d,this.viewProjectionMatrix);var _=bn(Jm(),d);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Y.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Lo(r.projectionMatrix,this.projectionMatrix)&&Lo(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(r),l=xB(s,this.pixelProjectionMatrix),f=(0,K.Z)(l,2),d=f[0],_=f[1],b=a?_:this.height-_;return r.length===2?[d,b]:[d,b,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,K.Z)(r,3),f=l[0],d=l[1],_=l[2],b=a?d:this.height-d,A=s&&s*this.pixelsPerMeter,w=CS([f,b,_],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(w),P=(0,K.Z)(I,3),L=P[0],Z=P[1],Q=P[2];return Number.isFinite(_)?[L,Z,Q]:Number.isFinite(s)?[L,Z,s]:[L,Z]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),i=(0,K.Z)(n,2),a=i[0],s=i[1],l=(r[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),i=(0,K.Z)(n,2),a=i[0],s=i[1],l=(r[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function EB(e){var t=e.width,r=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,f=e.padding,d=f===void 0?0:f,_=e.offset,b=_===void 0?[0,0]:_,A=(0,K.Z)(n,2),w=(0,K.Z)(A[0],2),I=w[0],P=w[1],L=(0,K.Z)(A[1],2),Z=L[0],Q=L[1];if(Number.isFinite(d)){var oe=d;d={top:oe,bottom:oe,left:oe,right:oe}}else wd(Number.isFinite(d.top)&&Number.isFinite(d.bottom)&&Number.isFinite(d.left)&&Number.isFinite(d.right));var Ae=new MS({width:t,height:r,longitude:0,latitude:0,zoom:0}),Oe=Ae.project([I,Q]),Ve=Ae.project([Z,P]),rt=[Math.max(Math.abs(Ve[0]-Oe[0]),a),Math.max(Math.abs(Ve[1]-Oe[1]),a)],_t=[t-d.left-d.right-Math.abs(b[0])*2,r-d.top-d.bottom-Math.abs(b[1])*2];wd(_t[0]>0&&_t[1]>0);var Bt=_t[0]/rt[0],ur=_t[1]/rt[1],lr=(d.right-d.left)/2/Bt,zr=(d.bottom-d.top)/2/ur,un=[(Ve[0]+Oe[0])/2+lr,(Ve[1]+Oe[1])/2+zr],Rn=Ae.unproject(un),Bi=Ae.zoom+Math.log2(Math.abs(Math.min(Bt,ur)));return{longitude:Rn[0],latitude:Rn[1],zoom:Math.min(Bi,l)}}var MS=function(e){(0,tt.Z)(t,e);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,f=n.longitude,d=f===void 0?0:f,_=n.zoom,b=_===void 0?0:_,A=n.pitch,w=A===void 0?0:A,I=n.bearing,P=I===void 0?0:I,L=n.altitude,Z=L===void 0?1.5:L,Q=n.nearZMultiplier,oe=n.farZMultiplier;(0,ye.Z)(this,t),i=i||1,a=a||1;var Ae=TS(b);Z=Math.max(.75,Z);var Oe=O0([d,l],Ae);Oe[2]=0;var Ve=yB({width:i,height:a,pitch:w,bearing:P,altitude:Z,nearZMultiplier:Q||1/a,farZMultiplier:oe||1.01}),rt=gB({height:a,center:Oe,pitch:w,bearing:P,altitude:Z,flipY:!0});return r=(0,gt.Z)(this,(0,le.Z)(t).call(this,{width:i,height:a,viewMatrix:rt,projectionMatrix:Ve})),r.latitude=l,r.longitude=d,r.zoom=b,r.pitch=w,r.bearing=P,r.altitude=Z,r.scale=Ae,r.center=Oe,r.pixelsPerMeter=wS((0,Ee.Z)((0,Ee.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Ee.Z)((0,Ee.Z)(r))),r}return(0,Y.Z)(t,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return O0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q_(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=CS(a,this.pixelUnprojectionMatrix),l=O0(i,this.scale),f=Mr.add([],l,Mr.negate([],s)),d=Mr.add([],this.center,f);return Q_(d,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=EB(Object.assign({width:a,height:s,bounds:n},i)),f=l.longitude,d=l.latitude,_=l.zoom;return new t({width:a,height:s,longitude:f,latitude:d,zoom:_})}}]),t}(bB),SB=function(){function e(){(0,ye.Z)(this,e)}return(0,Y.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,i=r.zoom,a=r.pitch,s=r.bearing,l=r.viewportHeight,f=r.viewportWidth;this.viewport=new MS({width:f,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),AB=["id","attributionControl","style","token","rotation","mapInstance"],IS,PS;function TB(e){var t=wB();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function wB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function CB(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}CB(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Qm();var RB=0,OS="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",MB=(IS=(0,ot.b2)(),IS(PS=function(e){(0,tt.Z)(r,e);var t=TB(r);function r(){var n;(0,ye.Z)(this,r);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=t.call.apply(t,[this].concat(a)),(0,B.Z)((0,Ee.Z)(n),"version","MAPBOX"),n}return(0,Y.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,f=s.y;return[l-a.x,f-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,f=l===void 0?0:l,d=s.y,_=d===void 0?0:d,b=s.z,A=b===void 0?0:b;return{x:f,y:_,z:A}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},d=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),_=d.meterInMercatorCoordinateUnits(),b=Vt();return Ga(b,b,wa.fromValues(d.x-f.x,d.y-f.y,d.z||0-f.z)),Js(b,b,wa.fromValues(_*l[0],-_*l[1],_*l[2])),eu(b,b,s[0]),op(b,b,s[1]),pl(b,b,s[2]),b}},{key:"init",value:function(){var n=(0,Ot.Z)(ve().mark(function a(){var s=this,l,f,d,_,b,A,w,I,P,L,Z,Q,oe;return ve().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:l=this.config,f=l.id,d=f===void 0?"map":f,_=l.attributionControl,b=_===void 0?!1:_,A=l.style,w=A===void 0?"light":A,I=l.token,P=I===void 0?OS:I,L=l.rotation,Z=L===void 0?0:L,Q=l.mapInstance,oe=(0,Fl.Z)(l,AB),this.viewport=new SB,!Q&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),P===OS&&w!=="blank"&&!window.mapboxgl.accessToken&&!Q&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Q&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=P),Q?(this.map=Q,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(d),this.map=new window.mapboxgl.Map((0,F.Z)({container:this.$mapContainer,style:this.getMapStyleValue(w),attributionControl:b,bearing:Z},oe))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Oe.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(Qm()).LngLat(i[0],i[1]),l=new(Qm()).LngLat(a[0],a[1]),f=s.distanceTo(l),d=Qm().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),_=Qm().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),b=d.x,A=d.y,w=_.x,I=_.y,P=Math.sqrt(Math.pow(b-w,2)+Math.pow(A-I,2))*4194304*2;return P/f}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+RB++,a.appendChild(s),s}}]),r}(dB))||PS);function IB(e){var t=PB();return function(){var n=(0,le.Z)(e),i;if(t){var a=(0,le.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,gt.Z)(this,i)}}function PB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function OB(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var s=t.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),i.appendChild(s),s}}OB(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var DB=function(e){(0,tt.Z)(r,e);var t=IB(r);function r(){return(0,ye.Z)(this,r),t.apply(this,arguments)}return(0,Y.Z)(r,[{key:"getServiceConstructor",value:function(){return MB}}]),r}(lB);function eg(e){return eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eg(e)}function DS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function FS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DS(Object(r),!0).forEach(function(n){FB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FB(e,t,r){return t=kB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kB(e){var t=BB(e,"string");return eg(t)==="symbol"?t:String(t)}function BB(e,t){if(eg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(eg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LB(e,t){return ZB(e)||zB(e,t)||UB(e,t)||NB()}function NB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UB(e,t){if(!!e){if(typeof e=="string")return kS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kS(e,t)}}function kS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function zB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function ZB(e){if(Array.isArray(e))return e}var VB=ee.memo(function(e){var t=e.style,r=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,ee.createRef)(),l=(0,ee.useState)(),f=LB(l,2),d=f[0],_=f[1];return(0,ee.useEffect)(function(){var b=new tB(FS(FS({id:s.current},i),{},{map:new DB(n)}));return b.on("loaded",function(){_(b),a&&a(b)}),function(){b.destroy()}},[]),(0,ee.useEffect)(function(){d&&n.style&&d.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ee.useEffect)(function(){d&&n.zoom&&d.setZoom(n.zoom)},[n.zoom]),(0,ee.useEffect)(function(){d&&n.center&&d.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ee.useEffect)(function(){d&&n.pitch!==void 0&&d.setPitch(n.pitch||0)},[n.pitch]),(0,ee.useEffect)(function(){d&&n.rotation&&d.setRotation(n.rotation)},[n.rotation]),ee.createElement(y.Provider,{value:d},(0,ee.createElement)("div",{ref:s,style:t,className:r},d&&e.children))}),jB=VB;function tg(e){return tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tg(e)}function BS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function _7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BS(Object(r),!0).forEach(function(n){HB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HB(e,t,r){return t=WB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WB(e){var t=GB(e,"string");return tg(t)==="symbol"?t:String(t)}function GB(e,t){if(tg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function y7(e,t){return qB(e)||YB(e,t)||$B(e,t)||XB()}function XB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $B(e,t){if(!!e){if(typeof e=="string")return LS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return LS(e,t)}}function LS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function YB(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function qB(e){if(Array.isArray(e))return e}var x7=null,b7=null;function rg(e){return rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rg(e)}function NS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function E7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NS(Object(r),!0).forEach(function(n){KB(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KB(e,t,r){return t=QB(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QB(e){var t=JB(e,"string");return rg(t)==="symbol"?t:String(t)}function JB(e,t){if(rg(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function S7(e,t){return nL(e)||rL(e,t)||tL(e,t)||eL()}function eL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tL(e,t){if(!!e){if(typeof e=="string")return US(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return US(e,t)}}function US(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function nL(e){if(Array.isArray(e))return e}var A7=null,T7=null;function ng(e){return ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ng(e)}function zS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function w7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zS(Object(r),!0).forEach(function(n){iL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iL(e,t,r){return t=aL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aL(e){var t=oL(e,"string");return ng(t)==="symbol"?t:String(t)}function oL(e,t){if(ng(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ng(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function C7(e,t){return cL(e)||lL(e,t)||uL(e,t)||sL()}function sL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uL(e,t){if(!!e){if(typeof e=="string")return ZS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ZS(e,t)}}function ZS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function cL(e){if(Array.isArray(e))return e}var R7=null,M7=null;function I7(e,t){return dL(e)||pL(e,t)||hL(e,t)||fL()}function fL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hL(e,t){if(!!e){if(typeof e=="string")return VS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return VS(e,t)}}function VS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function dL(e){if(Array.isArray(e))return e}var P7=null;function ig(e){return ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ig(e)}var O7=null;function jS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function D7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jS(Object(r),!0).forEach(function(n){vL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vL(e,t,r){return t=mL(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mL(e){var t=gL(e,"string");return ig(t)==="symbol"?t:String(t)}function gL(e,t){if(ig(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ig(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F7(e,t){if(e==null)return{};var r=_L(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function _L(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var k7={exportImage:m3,fullscreen:b3,geoLocate:A3,layer:cx,layerSwitch:cx,logo:fx,mapTheme:D3,mouseLocation:B3,zoom:V3,scale:U3},B7=null,HS=N(73935);function WS(e,t){return EL(e)||bL(e,t)||xL(e,t)||yL()}function yL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xL(e,t){if(!!e){if(typeof e=="string")return GS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GS(e,t)}}function GS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function EL(e){if(Array.isArray(e))return e}var XS=ee.useEffect,$S=ee.useState,SL=/\B([A-Z])/g,AL=function(t){return t.replace(SL,"-$1").toLowerCase()};function L7(e){var t=e.className,r=e.style,n=e.children,i=e.position,a=$S(),s=WS(a,2),l=s[0],f=s[1],d=useSceneValue(),_=$S(function(){return document.createElement("div")}),b=WS(_,1),A=b[0];return XS(function(){var w=new Control({position:i});return w.onAdd=function(){if(t&&(A.className=t),r){var I=Object.keys(r).map(function(P){return"".concat(AL(P),":").concat(r[P])}).join(";");A.style.cssText=I}return A},w.onRemove=function(){},f(w),d.addControl(w),function(){d.removeControl(w)}},[]),XS(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,A)}var YS=(0,ee.createContext)({});function N7(){return useContext(YS)}var TL=ee.memo(function(t){var r=t.layer,n=t.active;return r.active(n.option),null},iu()),wL=ee.memo(function(t){var r=t.layer,n=t.animate;return r.animate(n),null},iu()),CL=ee.memo(function(t){var r=t.layer,n=t.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},iu()),RL=ee.memo(function(t){var r=t.layer,n=t.filter;return n.field&&r.filter(n.field,n.values),null},iu()),ML=ee.memo(function(t){var r=t.layer,n=t.scale;return r.scale(n.values),null},iu()),IL=ee.memo(function(t){var r=t.layer,n=t.select;return r.select(n.option),null},iu()),PL=ee.memo(function(t){var r=t.layer,n=t.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},iu()),OL=ee.memo(function(t){var r=t.layer,n=t.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},iu()),DL=["data"];function FL(e,t){if(e==null)return{};var r=kL(e,t),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function kL(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}var BL=ee.memo(function(t){var r=t.layer,n=t.source,i=n.data,a=FL(n,DL);return r.inited?r.setData(i,a):r.source(i,a),a.autoFit&&r.fitBounds(a&&a.fitBoundsOptions),null},iu()),U7=ee.useEffect,LL=ee.memo(function(t){var r=t.layer,n=t.style;return r.style(n),null},iu());function NL(e,t){return VL(e)||ZL(e,t)||zL(e,t)||UL()}function UL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zL(e,t){if(!!e){if(typeof e=="string")return qS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qS(e,t)}}function qS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZL(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;f=!1}else for(;!(f=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);f=!0);}catch(_){d=!0,i=_}finally{try{if(!f&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function VL(e){if(Array.isArray(e))return e}var ag=ee.useEffect,jL=ee.useState;function KS(e,t){var r=t.source,n=t.color,i=t.shape,a=t.style,s=t.size,l=t.scale,f=t.active,d=t.select,_=t.filter,b=t.animate,A=t.options,w=t.onLayerLoaded,I=ce(),P=jL(function(){var Q;switch(e){case"polygonLayer":Q=new jg(A);break;case"lineLayer":Q=new d_(A);break;case"pointLayer":Q=new Vg(A);break;case"heatmapLayer":Q=new iR(A);break;case"rasterLayer":Q=new Hg(A);break;case"imageLayer":Q=new Zx(A);break;case"citybuildingLayer":Q=new RC(A);break;default:Q=new jg(A)}return Q.on("inited",function(){w&&w(Q,I)}),Q}),L=NL(P,1),Z=L[0];return ag(function(){return I.addLayer(Z),function(){I.removeLayer(Z)}},[]),ag(function(){Z.inited&&A&&Z.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),ag(function(){Z.inited&&(A==null?void 0:A.zIndex)&&Z.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),ag(function(){Z.inited&&(A==null?void 0:A.blend)&&Z.setBlend(A.blend)},[A==null?void 0:A.blend]),ag(function(){I.render()}),ee.createElement(YS.Provider,{value:Z},ee.createElement(BL,{layer:Z,source:r}),l&&ee.createElement(ML,{layer:Z,scale:l}),n&&ee.createElement(CL,{layer:Z,color:n}),s&&ee.createElement(OL,{layer:Z,size:s}),i&&ee.createElement(PL,{layer:Z,shape:i}),a&&ee.createElement(LL,{layer:Z,style:a}),f&&ee.createElement(TL,{layer:Z,active:f}),d&&ee.createElement(IL,{layer:Z,select:d}),_&&ee.createElement(RL,{layer:Z,filter:_}),b&&ee.createElement(wL,{layer:Z,animate:b}),t.children)}var z7=null,Z7=null,HL=ee.memo(function(t){return KS("pointLayer",t)}),WL=ee.memo(function(t){return KS("heatmapLayer",t)}),V7=null,j7=null,H7=null,W7=ee.useEffect,G7=null,X7=null;function Dv(e){return Dv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dv(e)}function QS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function D0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QS(Object(r),!0).forEach(function(n){GL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GL(e,t,r){return t=eA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XL(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function JS(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,eA(n.key),n)}}function $L(e,t,r){return t&&JS(e.prototype,t),r&&JS(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eA(e){var t=YL(e,"string");return Dv(t)==="symbol"?t:String(t)}function YL(e,t){if(Dv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Dv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qL(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J_(e,t)}function J_(e,t){return J_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},J_(e,t)}function KL(e){var t=e6();return function(){var n=F0(e),i;if(t){var a=F0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return QL(this,i)}}function QL(e,t){if(t&&(Dv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JL(e)}function JL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function e6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function F0(e){return F0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},F0(e)}var $7=function(e){qL(r,e);var t=KL(r);function r(n){var i;return XL(this,r),i=t.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return $L(r,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,f=a.option,d=a.lngLat,_=new t_(D0(D0({},f),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&_.setLnglat(s),d&&_.setLnglat(d),l&&_.setHTML(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,s,l,f,d,_,b=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(f=l.lnglat)===null||f===void 0?void 0:f.lng,(d=this.props)===null||d===void 0||(_=d.lnglat)===null||_===void 0?void 0:_.lat],w=b.toString()!==A.toString();if(w){var I;this.popup.remove(),this.popup=new t_(D0(D0({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return ee.createElement(y.Consumer,{},function(a){return a&&(i.scene=a),(0,HS.createPortal)(i.props.children,i.el)})}}]),r}(ee.PureComponent);function Fv(e){return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fv(e)}function t6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tA(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n6(n.key),n)}}function r6(e,t,r){return t&&tA(e.prototype,t),r&&tA(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function n6(e){var t=i6(e,"string");return Fv(t)==="symbol"?t:String(t)}function i6(e,t){if(Fv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Fv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function a6(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ey(e,t)}function ey(e,t){return ey=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ey(e,t)}function o6(e){var t=l6();return function(){var n=k0(e),i;if(t){var a=k0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return s6(this,i)}}function s6(e,t){if(t&&(Fv(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return u6(e)}function u6(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function k0(e){return k0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},k0(e)}var Y7=function(e){a6(r,e);var t=o6(r);function r(n){var i;return t6(this,r),i=t.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return r6(r,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,f=i.onMarkerLoaded,d=new nx(l);a&&d.setLnglat(a),s&&d.setElement(this.el),this.marker=d,f&&f(d),this.scene.addMarker(d)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return ee.createElement(y.Consumer,{},function(a){return a&&(i.scene=a),(0,HS.createPortal)(i.props.children,i.el)})}}]),r}(ee.PureComponent),q7=ee.useEffect,K7=null,Q7=null,J7=ee.useEffect,e8=null},66213:function(yr,ne,N){"use strict";N.d(ne,{Z:function(){return y}});var ge=N(77608);function ee(ce,z){for(;!Object.prototype.hasOwnProperty.call(ce,z)&&(ce=(0,ge.Z)(ce),ce!==null););return ce}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(z,ae,te){var Pe=ee(z,ae);if(!!Pe){var re=Object.getOwnPropertyDescriptor(Pe,ae);return re.get?re.get.call(arguments.length<3?z:te):re.value}},y.apply(this,arguments)}},38163:function(yr){yr.exports=ne;function ne(ee,y){var ce=ee&&ee.type,z;if(ce==="FeatureCollection")for(z=0;z<ee.features.length;z++)ne(ee.features[z],y);else if(ce==="GeometryCollection")for(z=0;z<ee.geometries.length;z++)ne(ee.geometries[z],y);else if(ce==="Feature")ne(ee.geometry,y);else if(ce==="Polygon")N(ee.coordinates,y);else if(ce==="MultiPolygon")for(z=0;z<ee.coordinates.length;z++)N(ee.coordinates[z],y);return ee}function N(ee,y){if(ee.length!==0){ge(ee[0],y);for(var ce=1;ce<ee.length;ce++)ge(ee[ce],!y)}}function ge(ee,y){for(var ce=0,z=0,ae=0,te=ee.length,Pe=te-1;ae<te;Pe=ae++){var re=(ee[ae][0]-ee[Pe][0])*(ee[Pe][1]+ee[ae][1]),Ze=ce+re;z+=Math.abs(ce)>=Math.abs(re)?ce-Ze+re:re-Ze+ce,ce=Ze}ce+z>=0!=!!y&&ee.reverse()}},75550:function(yr){"use strict";yr.exports=ne;function ne(N,ge){this.x=N,this.y=ge}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(N){return this.clone()._add(N)},sub:function(N){return this.clone()._sub(N)},multByPoint:function(N){return this.clone()._multByPoint(N)},divByPoint:function(N){return this.clone()._divByPoint(N)},mult:function(N){return this.clone()._mult(N)},div:function(N){return this.clone()._div(N)},rotate:function(N){return this.clone()._rotate(N)},rotateAround:function(N,ge){return this.clone()._rotateAround(N,ge)},matMult:function(N){return this.clone()._matMult(N)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(N){return this.x===N.x&&this.y===N.y},dist:function(N){return Math.sqrt(this.distSqr(N))},distSqr:function(N){var ge=N.x-this.x,ee=N.y-this.y;return ge*ge+ee*ee},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(N){return Math.atan2(this.y-N.y,this.x-N.x)},angleWith:function(N){return this.angleWithSep(N.x,N.y)},angleWithSep:function(N,ge){return Math.atan2(this.x*ge-this.y*N,this.x*N+this.y*ge)},_matMult:function(N){var ge=N[0]*this.x+N[1]*this.y,ee=N[2]*this.x+N[3]*this.y;return this.x=ge,this.y=ee,this},_add:function(N){return this.x+=N.x,this.y+=N.y,this},_sub:function(N){return this.x-=N.x,this.y-=N.y,this},_mult:function(N){return this.x*=N,this.y*=N,this},_div:function(N){return this.x/=N,this.y/=N,this},_multByPoint:function(N){return this.x*=N.x,this.y*=N.y,this},_divByPoint:function(N){return this.x/=N.x,this.y/=N.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var N=this.y;return this.y=this.x,this.x=-N,this},_rotate:function(N){var ge=Math.cos(N),ee=Math.sin(N),y=ge*this.x-ee*this.y,ce=ee*this.x+ge*this.y;return this.x=y,this.y=ce,this},_rotateAround:function(N,ge){var ee=Math.cos(N),y=Math.sin(N),ce=ge.x+ee*(this.x-ge.x)-y*(this.y-ge.y),z=ge.y+y*(this.x-ge.x)+ee*(this.y-ge.y);return this.x=ce,this.y=z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(N){return N instanceof ne?N:Array.isArray(N)?new ne(N[0],N[1]):N}},49296:function(yr){"use strict";yr.exports=N,yr.exports.default=N;var ne=1e20;function N(z,ae,te,Pe,re,Ze){this.fontSize=z||24,this.buffer=ae===void 0?3:ae,this.cutoff=Pe||.25,this.fontFamily=re||"sans-serif",this.fontWeight=Ze||"normal",this.radius=te||8;var Ke=this.size=this.fontSize+this.buffer*2,nt=Ke+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ke,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(nt*nt),this.gridInner=new Float64Array(nt*nt),this.f=new Float64Array(nt),this.z=new Float64Array(nt+1),this.v=new Uint16Array(nt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ke/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ge(z,ae,te,Pe,re,Ze,Ke){Ze.fill(ne,0,ae*te),Ke.fill(0,0,ae*te);for(var nt=(ae-Pe)/2,Tt=0;Tt<re;Tt++)for(var Ct=0;Ct<Pe;Ct++){var Gt=(Tt+nt)*ae+Ct+nt,Jt=z.data[4*(Tt*Pe+Ct)+3]/255;if(Jt===1)Ze[Gt]=0,Ke[Gt]=ne;else if(Jt===0)Ze[Gt]=ne,Ke[Gt]=0;else{var Zt=Math.max(0,.5-Jt),wt=Math.max(0,Jt-.5);Ze[Gt]=Zt*Zt,Ke[Gt]=wt*wt}}}function ee(z,ae,te,Pe,re,Ze,Ke){for(var nt=0;nt<ae*te;nt++){var Tt=Math.sqrt(Pe[nt])-Math.sqrt(re[nt]);z[nt]=Math.round(255-255*(Tt/Ze+Ke))}}N.prototype._draw=function(z,ae){var te=this.ctx.measureText(z),Pe=te.width,re=2*this.buffer,Ze,Ke,nt,Tt,Ct,Gt,Jt,Zt;ae&&this.useMetrics?(Ct=Math.floor(te.actualBoundingBoxAscent),Zt=this.buffer+Math.ceil(te.actualBoundingBoxAscent),Gt=this.buffer,Jt=this.buffer,Ke=Math.min(this.size,Math.ceil(te.actualBoundingBoxRight-te.actualBoundingBoxLeft)),Tt=Math.min(this.size-Gt,Math.ceil(te.actualBoundingBoxAscent+te.actualBoundingBoxDescent)),Ze=Ke+re,nt=Tt+re,this.ctx.textBaseline="alphabetic"):(Ze=Ke=this.size,nt=Tt=this.size,Ct=19*this.fontSize/24,Gt=Jt=0,Zt=this.middle,this.ctx.textBaseline="middle");var wt;Ke&&Tt&&(this.ctx.clearRect(Jt,Gt,Ke,Tt),this.ctx.fillText(z,this.buffer,Zt),wt=this.ctx.getImageData(Jt,Gt,Ke,Tt));var xt=new Uint8ClampedArray(Ze*nt);return ge(wt,Ze,nt,Ke,Tt,this.gridOuter,this.gridInner),y(this.gridOuter,Ze,nt,this.f,this.v,this.z),y(this.gridInner,Ze,nt,this.f,this.v,this.z),ee(xt,Ze,nt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:xt,metrics:{width:Ke,height:Tt,sdfWidth:Ze,sdfHeight:nt,top:Ct,left:0,advance:Pe}}},N.prototype.draw=function(z){return this._draw(z,!1).data},N.prototype.drawWithMetrics=function(z){return this._draw(z,!0)};function y(z,ae,te,Pe,re,Ze){for(var Ke=0;Ke<ae;Ke++)ce(z,Ke,ae,te,Pe,re,Ze);for(var nt=0;nt<te;nt++)ce(z,nt*ae,1,ae,Pe,re,Ze)}function ce(z,ae,te,Pe,re,Ze,Ke){var nt,Tt,Ct,Gt;for(Ze[0]=0,Ke[0]=-ne,Ke[1]=ne,nt=0;nt<Pe;nt++)re[nt]=z[ae+nt*te];for(nt=1,Tt=0,Ct=0;nt<Pe;nt++){do Gt=Ze[Tt],Ct=(re[nt]-re[Gt]+nt*nt-Gt*Gt)/(nt-Gt)/2;while(Ct<=Ke[Tt]&&--Tt>-1);Tt++,Ze[Tt]=nt,Ke[Tt]=Ct,Ke[Tt+1]=ne}for(nt=0,Tt=0;nt<Pe;nt++){for(;Ke[Tt+1]<nt;)Tt++;Gt=Ze[Tt],z[ae+nt*te]=re[Gt]+(nt-Gt)*(nt-Gt)}}},38929:function(yr,ne,N){yr.exports.VectorTile=N(22779),N(66024),N(59701)},22779:function(yr,ne,N){"use strict";var ge=N(59701);yr.exports=ee;function ee(ce,z){this.layers=ce.readFields(y,{},z)}function y(ce,z,ae){if(ce===3){var te=new ge(ae,ae.readVarint()+ae.pos);te.length&&(z[te.name]=te)}}},66024:function(yr,ne,N){"use strict";var ge=N(75550);yr.exports=ee;function ee(te,Pe,re,Ze,Ke){this.properties={},this.extent=re,this.type=0,this._pbf=te,this._geometry=-1,this._keys=Ze,this._values=Ke,te.readFields(y,this,Pe)}function y(te,Pe,re){te==1?Pe.id=re.readVarint():te==2?ce(re,Pe):te==3?Pe.type=re.readVarint():te==4&&(Pe._geometry=re.pos)}function ce(te,Pe){for(var re=te.readVarint()+te.pos;te.pos<re;){var Ze=Pe._keys[te.readVarint()],Ke=Pe._values[te.readVarint()];Pe.properties[Ze]=Ke}}ee.types=["Unknown","Point","LineString","Polygon"],ee.prototype.loadGeometry=function(){var te=this._pbf;te.pos=this._geometry;for(var Pe=te.readVarint()+te.pos,re=1,Ze=0,Ke=0,nt=0,Tt=[],Ct;te.pos<Pe;){if(Ze<=0){var Gt=te.readVarint();re=Gt&7,Ze=Gt>>3}if(Ze--,re===1||re===2)Ke+=te.readSVarint(),nt+=te.readSVarint(),re===1&&(Ct&&Tt.push(Ct),Ct=[]),Ct.push(new ge(Ke,nt));else if(re===7)Ct&&Ct.push(Ct[0].clone());else throw new Error("unknown command "+re)}return Ct&&Tt.push(Ct),Tt},ee.prototype.bbox=function(){var te=this._pbf;te.pos=this._geometry;for(var Pe=te.readVarint()+te.pos,re=1,Ze=0,Ke=0,nt=0,Tt=Infinity,Ct=-Infinity,Gt=Infinity,Jt=-Infinity;te.pos<Pe;){if(Ze<=0){var Zt=te.readVarint();re=Zt&7,Ze=Zt>>3}if(Ze--,re===1||re===2)Ke+=te.readSVarint(),nt+=te.readSVarint(),Ke<Tt&&(Tt=Ke),Ke>Ct&&(Ct=Ke),nt<Gt&&(Gt=nt),nt>Jt&&(Jt=nt);else if(re!==7)throw new Error("unknown command "+re)}return[Tt,Gt,Ct,Jt]},ee.prototype.toGeoJSON=function(te,Pe,re){var Ze=this.extent*Math.pow(2,re),Ke=this.extent*te,nt=this.extent*Pe,Tt=this.loadGeometry(),Ct=ee.types[this.type],Gt,Jt;function Zt(Lr){for(var mr=0;mr<Lr.length;mr++){var hr=Lr[mr],Et=180-(hr.y+nt)*360/Ze;Lr[mr]=[(hr.x+Ke)*360/Ze-180,360/Math.PI*Math.atan(Math.exp(Et*Math.PI/180))-90]}}switch(this.type){case 1:var wt=[];for(Gt=0;Gt<Tt.length;Gt++)wt[Gt]=Tt[Gt][0];Tt=wt,Zt(Tt);break;case 2:for(Gt=0;Gt<Tt.length;Gt++)Zt(Tt[Gt]);break;case 3:for(Tt=z(Tt),Gt=0;Gt<Tt.length;Gt++)for(Jt=0;Jt<Tt[Gt].length;Jt++)Zt(Tt[Gt][Jt]);break}Tt.length===1?Tt=Tt[0]:Ct="Multi"+Ct;var xt={type:"Feature",geometry:{type:Ct,coordinates:Tt},properties:this.properties};return"id"in this&&(xt.id=this.id),xt};function z(te){var Pe=te.length;if(Pe<=1)return[te];for(var re=[],Ze,Ke,nt=0;nt<Pe;nt++){var Tt=ae(te[nt]);Tt!==0&&(Ke===void 0&&(Ke=Tt<0),Ke===Tt<0?(Ze&&re.push(Ze),Ze=[te[nt]]):Ze.push(te[nt]))}return Ze&&re.push(Ze),re}function ae(te){for(var Pe=0,re=0,Ze=te.length,Ke=Ze-1,nt,Tt;re<Ze;Ke=re++)nt=te[re],Tt=te[Ke],Pe+=(Tt.x-nt.x)*(nt.y+Tt.y);return Pe}},59701:function(yr,ne,N){"use strict";var ge=N(66024);yr.exports=ee;function ee(z,ae){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=z,this._keys=[],this._values=[],this._features=[],z.readFields(y,this,ae),this.length=this._features.length}function y(z,ae,te){z===15?ae.version=te.readVarint():z===1?ae.name=te.readString():z===5?ae.extent=te.readVarint():z===2?ae._features.push(te.pos):z===3?ae._keys.push(te.readString()):z===4&&ae._values.push(ce(te))}function ce(z){for(var ae=null,te=z.readVarint()+z.pos;z.pos<te;){var Pe=z.readVarint()>>3;ae=Pe===1?z.readString():Pe===2?z.readFloat():Pe===3?z.readDouble():Pe===4?z.readVarint64():Pe===5?z.readVarint():Pe===6?z.readSVarint():Pe===7?z.readBoolean():null}return ae}ee.prototype.feature=function(z){if(z<0||z>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[z];var ae=this._pbf.readVarint()+this._pbf.pos;return new ge(this._pbf,ae,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(yr,ne,N){"use strict";N.d(ne,{Z:function(){return er}});var ge=N(22122),ee=N(67294),y=N(57838),ce=N(96159),z=N(96156),ae=N(94184),te=N.n(ae),Pe=N(53124),re=N(90860),Ze=N(11726),Ke=N.n(Ze),nt=function(q){var De=q.value,F=q.formatter,Me=q.precision,Te=q.decimalSeparator,ht=q.groupSeparator,bt=ht===void 0?"":ht,St=q.prefixCls,qt;if(typeof F=="function")qt=F(De);else{var or=String(De),rn=or.match(/^(-?)(\d*)(\.(\d+))?$/);if(!rn||or==="-")qt=or;else{var Or=rn[1],Kn=rn[2]||"0",on=rn[4]||"";Kn=Kn.replace(/\B(?=(\d{3})+(?!\d))/g,bt),typeof Me=="number"&&(on=Ke()(on,Me,"0").slice(0,Me>0?Me:0)),on&&(on="".concat(Te).concat(on)),qt=[ee.createElement("span",{key:"int",className:"".concat(St,"-content-value-int")},Or,Kn),on&&ee.createElement("span",{key:"decimal",className:"".concat(St,"-content-value-decimal")},on)]}}return ee.createElement("span",{className:"".concat(St,"-content-value")},qt)},Tt=nt,Ct=function(q){var De=q.prefixCls,F=q.className,Me=q.style,Te=q.valueStyle,ht=q.value,bt=ht===void 0?0:ht,St=q.title,qt=q.valueRender,or=q.prefix,rn=q.suffix,Or=q.loading,Kn=Or===void 0?!1:Or,on=q.direction,Pn=q.onMouseEnter,mi=q.onMouseLeave,ei=q.decimalSeparator,xn=ei===void 0?".":ei,Fi=q.groupSeparator,zi=Fi===void 0?",":Fi,Li=ee.createElement(Tt,(0,ge.Z)({decimalSeparator:xn,groupSeparator:zi},q,{value:bt})),Qn=te()(De,(0,z.Z)({},"".concat(De,"-rtl"),on==="rtl"),F);return ee.createElement("div",{className:Qn,style:Me,onMouseEnter:Pn,onMouseLeave:mi},St&&ee.createElement("div",{className:"".concat(De,"-title")},St),ee.createElement(re.Z,{paragraph:!1,loading:Kn,className:"".concat(De,"-skeleton")},ee.createElement("div",{style:Te,className:"".concat(De,"-content")},or&&ee.createElement("span",{className:"".concat(De,"-content-prefix")},or),qt?qt(Li):Li,rn&&ee.createElement("span",{className:"".concat(De,"-content-suffix")},rn))))},Gt=(0,Pe.PG)({prefixCls:"statistic"})(Ct),Jt=Gt,Zt=N(28481),wt=N(32475),xt=N.n(wt),Lr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function mr(xr,q){var De=xr,F=/\[[^\]]*]/g,Me=(q.match(F)||[]).map(function(St){return St.slice(1,-1)}),Te=q.replace(F,"[]"),ht=Lr.reduce(function(St,qt){var or=(0,Zt.Z)(qt,2),rn=or[0],Or=or[1];if(St.includes(rn)){var Kn=Math.floor(De/Or);return De-=Kn*Or,St.replace(new RegExp("".concat(rn,"+"),"g"),function(on){var Pn=on.length;return xt()(Kn.toString(),Pn,"0")})}return St},Te),bt=0;return ht.replace(F,function(){var St=Me[bt];return bt+=1,St})}function hr(xr,q){var De=q.format,F=De===void 0?"":De,Me=new Date(xr).getTime(),Te=Date.now(),ht=Math.max(Me-Te,0);return mr(ht,F)}var Et=1e3/30;function lt(xr){return new Date(xr).getTime()}var Ut=function(q){var De=q.value,F=q.format,Me=F===void 0?"HH:mm:ss":F,Te=q.onChange,ht=q.onFinish,bt=(0,y.Z)(),St=ee.useRef(null),qt=function(){ht==null||ht(),St.current&&(clearInterval(St.current),St.current=null)},or=function(){var on=lt(De);on>=Date.now()&&(St.current=setInterval(function(){bt(),Te==null||Te(on-Date.now()),on<Date.now()&&qt()},Et))};ee.useEffect(function(){return or(),function(){St.current&&(clearInterval(St.current),St.current=null)}},[De]);var rn=function(on,Pn){return hr(on,(0,ge.Z)((0,ge.Z)({},Pn),{format:Me}))},Or=function(on){return(0,ce.Tm)(on,{title:void 0})};return ee.createElement(Jt,(0,ge.Z)({},q,{valueRender:Or,formatter:rn}))},vt=ee.memo(Ut);Jt.Countdown=vt;var er=Jt},95300:function(yr,ne,N){"use strict";var ge=N(38663),ee=N.n(ge),y=N(81903),ce=N.n(y),z=N(18446)},9187:function(yr){"use strict";yr.exports=ne,yr.exports.default=ne;function ne(F,Me,Te){Te=Te||2;var ht=Me&&Me.length,bt=ht?Me[0]*Te:F.length,St=N(F,0,bt,Te,!0),qt=[];if(!St||St.next===St.prev)return qt;var or,rn,Or,Kn,on,Pn,mi;if(ht&&(St=te(F,Me,St,Te)),F.length>80*Te){or=Or=F[0],rn=Kn=F[1];for(var ei=Te;ei<bt;ei+=Te)on=F[ei],Pn=F[ei+1],on<or&&(or=on),Pn<rn&&(rn=Pn),on>Or&&(Or=on),Pn>Kn&&(Kn=Pn);mi=Math.max(Or-or,Kn-rn),mi=mi!==0?32767/mi:0}return ee(St,qt,Te,or,rn,mi,0),qt}function N(F,Me,Te,ht,bt){var St,qt;if(bt===De(F,Me,Te,ht)>0)for(St=Me;St<Te;St+=ht)qt=er(St,F[St],F[St+1],qt);else for(St=Te-ht;St>=Me;St-=ht)qt=er(St,F[St],F[St+1],qt);return qt&&xt(qt,qt.next)&&(xr(qt),qt=qt.next),qt}function ge(F,Me){if(!F)return F;Me||(Me=F);var Te=F,ht;do if(ht=!1,!Te.steiner&&(xt(Te,Te.next)||wt(Te.prev,Te,Te.next)===0)){if(xr(Te),Te=Me=Te.prev,Te===Te.next)break;ht=!0}else Te=Te.next;while(ht||Te!==Me);return Me}function ee(F,Me,Te,ht,bt,St,qt){if(!!F){!qt&&St&&nt(F,ht,bt,St);for(var or=F,rn,Or;F.prev!==F.next;){if(rn=F.prev,Or=F.next,St?ce(F,ht,bt,St):y(F)){Me.push(rn.i/Te|0),Me.push(F.i/Te|0),Me.push(Or.i/Te|0),xr(F),F=Or.next,or=Or.next;continue}if(F=Or,F===or){qt?qt===1?(F=z(ge(F),Me,Te),ee(F,Me,Te,ht,bt,St,2)):qt===2&&ae(F,Me,Te,ht,bt,St):ee(ge(F),Me,Te,ht,bt,St,1);break}}}}function y(F){var Me=F.prev,Te=F,ht=F.next;if(wt(Me,Te,ht)>=0)return!1;for(var bt=Me.x,St=Te.x,qt=ht.x,or=Me.y,rn=Te.y,Or=ht.y,Kn=bt<St?bt<qt?bt:qt:St<qt?St:qt,on=or<rn?or<Or?or:Or:rn<Or?rn:Or,Pn=bt>St?bt>qt?bt:qt:St>qt?St:qt,mi=or>rn?or>Or?or:Or:rn>Or?rn:Or,ei=ht.next;ei!==Me;){if(ei.x>=Kn&&ei.x<=Pn&&ei.y>=on&&ei.y<=mi&&Jt(bt,or,St,rn,qt,Or,ei.x,ei.y)&&wt(ei.prev,ei,ei.next)>=0)return!1;ei=ei.next}return!0}function ce(F,Me,Te,ht){var bt=F.prev,St=F,qt=F.next;if(wt(bt,St,qt)>=0)return!1;for(var or=bt.x,rn=St.x,Or=qt.x,Kn=bt.y,on=St.y,Pn=qt.y,mi=or<rn?or<Or?or:Or:rn<Or?rn:Or,ei=Kn<on?Kn<Pn?Kn:Pn:on<Pn?on:Pn,xn=or>rn?or>Or?or:Or:rn>Or?rn:Or,Fi=Kn>on?Kn>Pn?Kn:Pn:on>Pn?on:Pn,zi=Ct(mi,ei,Me,Te,ht),Li=Ct(xn,Fi,Me,Te,ht),Qn=F.prevZ,Ln=F.nextZ;Qn&&Qn.z>=zi&&Ln&&Ln.z<=Li;){if(Qn.x>=mi&&Qn.x<=xn&&Qn.y>=ei&&Qn.y<=Fi&&Qn!==bt&&Qn!==qt&&Jt(or,Kn,rn,on,Or,Pn,Qn.x,Qn.y)&&wt(Qn.prev,Qn,Qn.next)>=0||(Qn=Qn.prevZ,Ln.x>=mi&&Ln.x<=xn&&Ln.y>=ei&&Ln.y<=Fi&&Ln!==bt&&Ln!==qt&&Jt(or,Kn,rn,on,Or,Pn,Ln.x,Ln.y)&&wt(Ln.prev,Ln,Ln.next)>=0))return!1;Ln=Ln.nextZ}for(;Qn&&Qn.z>=zi;){if(Qn.x>=mi&&Qn.x<=xn&&Qn.y>=ei&&Qn.y<=Fi&&Qn!==bt&&Qn!==qt&&Jt(or,Kn,rn,on,Or,Pn,Qn.x,Qn.y)&&wt(Qn.prev,Qn,Qn.next)>=0)return!1;Qn=Qn.prevZ}for(;Ln&&Ln.z<=Li;){if(Ln.x>=mi&&Ln.x<=xn&&Ln.y>=ei&&Ln.y<=Fi&&Ln!==bt&&Ln!==qt&&Jt(or,Kn,rn,on,Or,Pn,Ln.x,Ln.y)&&wt(Ln.prev,Ln,Ln.next)>=0)return!1;Ln=Ln.nextZ}return!0}function z(F,Me,Te){var ht=F;do{var bt=ht.prev,St=ht.next.next;!xt(bt,St)&&Lr(bt,ht,ht.next,St)&&lt(bt,St)&&lt(St,bt)&&(Me.push(bt.i/Te|0),Me.push(ht.i/Te|0),Me.push(St.i/Te|0),xr(ht),xr(ht.next),ht=F=St),ht=ht.next}while(ht!==F);return ge(ht)}function ae(F,Me,Te,ht,bt,St){var qt=F;do{for(var or=qt.next.next;or!==qt.prev;){if(qt.i!==or.i&&Zt(qt,or)){var rn=vt(qt,or);qt=ge(qt,qt.next),rn=ge(rn,rn.next),ee(qt,Me,Te,ht,bt,St,0),ee(rn,Me,Te,ht,bt,St,0);return}or=or.next}qt=qt.next}while(qt!==F)}function te(F,Me,Te,ht){var bt=[],St,qt,or,rn,Or;for(St=0,qt=Me.length;St<qt;St++)or=Me[St]*ht,rn=St<qt-1?Me[St+1]*ht:F.length,Or=N(F,or,rn,ht,!1),Or===Or.next&&(Or.steiner=!0),bt.push(Gt(Or));for(bt.sort(Pe),St=0;St<bt.length;St++)Te=re(bt[St],Te);return Te}function Pe(F,Me){return F.x-Me.x}function re(F,Me){var Te=Ze(F,Me);if(!Te)return Me;var ht=vt(Te,F);return ge(ht,ht.next),ge(Te,Te.next)}function Ze(F,Me){var Te=Me,ht=F.x,bt=F.y,St=-Infinity,qt;do{if(bt<=Te.y&&bt>=Te.next.y&&Te.next.y!==Te.y){var or=Te.x+(bt-Te.y)*(Te.next.x-Te.x)/(Te.next.y-Te.y);if(or<=ht&&or>St&&(St=or,qt=Te.x<Te.next.x?Te:Te.next,or===ht))return qt}Te=Te.next}while(Te!==Me);if(!qt)return null;var rn=qt,Or=qt.x,Kn=qt.y,on=Infinity,Pn;Te=qt;do ht>=Te.x&&Te.x>=Or&&ht!==Te.x&&Jt(bt<Kn?ht:St,bt,Or,Kn,bt<Kn?St:ht,bt,Te.x,Te.y)&&(Pn=Math.abs(bt-Te.y)/(ht-Te.x),lt(Te,F)&&(Pn<on||Pn===on&&(Te.x>qt.x||Te.x===qt.x&&Ke(qt,Te)))&&(qt=Te,on=Pn)),Te=Te.next;while(Te!==rn);return qt}function Ke(F,Me){return wt(F.prev,F,Me.prev)<0&&wt(Me.next,F,F.next)<0}function nt(F,Me,Te,ht){var bt=F;do bt.z===0&&(bt.z=Ct(bt.x,bt.y,Me,Te,ht)),bt.prevZ=bt.prev,bt.nextZ=bt.next,bt=bt.next;while(bt!==F);bt.prevZ.nextZ=null,bt.prevZ=null,Tt(bt)}function Tt(F){var Me,Te,ht,bt,St,qt,or,rn,Or=1;do{for(Te=F,F=null,St=null,qt=0;Te;){for(qt++,ht=Te,or=0,Me=0;Me<Or&&(or++,ht=ht.nextZ,!!ht);Me++);for(rn=Or;or>0||rn>0&&ht;)or!==0&&(rn===0||!ht||Te.z<=ht.z)?(bt=Te,Te=Te.nextZ,or--):(bt=ht,ht=ht.nextZ,rn--),St?St.nextZ=bt:F=bt,bt.prevZ=St,St=bt;Te=ht}St.nextZ=null,Or*=2}while(qt>1);return F}function Ct(F,Me,Te,ht,bt){return F=(F-Te)*bt|0,Me=(Me-ht)*bt|0,F=(F|F<<8)&16711935,F=(F|F<<4)&252645135,F=(F|F<<2)&858993459,F=(F|F<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,F|Me<<1}function Gt(F){var Me=F,Te=F;do(Me.x<Te.x||Me.x===Te.x&&Me.y<Te.y)&&(Te=Me),Me=Me.next;while(Me!==F);return Te}function Jt(F,Me,Te,ht,bt,St,qt,or){return(bt-qt)*(Me-or)>=(F-qt)*(St-or)&&(F-qt)*(ht-or)>=(Te-qt)*(Me-or)&&(Te-qt)*(St-or)>=(bt-qt)*(ht-or)}function Zt(F,Me){return F.next.i!==Me.i&&F.prev.i!==Me.i&&!Et(F,Me)&&(lt(F,Me)&&lt(Me,F)&&Ut(F,Me)&&(wt(F.prev,F,Me.prev)||wt(F,Me.prev,Me))||xt(F,Me)&&wt(F.prev,F,F.next)>0&&wt(Me.prev,Me,Me.next)>0)}function wt(F,Me,Te){return(Me.y-F.y)*(Te.x-Me.x)-(Me.x-F.x)*(Te.y-Me.y)}function xt(F,Me){return F.x===Me.x&&F.y===Me.y}function Lr(F,Me,Te,ht){var bt=hr(wt(F,Me,Te)),St=hr(wt(F,Me,ht)),qt=hr(wt(Te,ht,F)),or=hr(wt(Te,ht,Me));return!!(bt!==St&&qt!==or||bt===0&&mr(F,Te,Me)||St===0&&mr(F,ht,Me)||qt===0&&mr(Te,F,ht)||or===0&&mr(Te,Me,ht))}function mr(F,Me,Te){return Me.x<=Math.max(F.x,Te.x)&&Me.x>=Math.min(F.x,Te.x)&&Me.y<=Math.max(F.y,Te.y)&&Me.y>=Math.min(F.y,Te.y)}function hr(F){return F>0?1:F<0?-1:0}function Et(F,Me){var Te=F;do{if(Te.i!==F.i&&Te.next.i!==F.i&&Te.i!==Me.i&&Te.next.i!==Me.i&&Lr(Te,Te.next,F,Me))return!0;Te=Te.next}while(Te!==F);return!1}function lt(F,Me){return wt(F.prev,F,F.next)<0?wt(F,Me,F.next)>=0&&wt(F,F.prev,Me)>=0:wt(F,Me,F.prev)<0||wt(F,F.next,Me)<0}function Ut(F,Me){var Te=F,ht=!1,bt=(F.x+Me.x)/2,St=(F.y+Me.y)/2;do Te.y>St!=Te.next.y>St&&Te.next.y!==Te.y&&bt<(Te.next.x-Te.x)*(St-Te.y)/(Te.next.y-Te.y)+Te.x&&(ht=!ht),Te=Te.next;while(Te!==F);return ht}function vt(F,Me){var Te=new q(F.i,F.x,F.y),ht=new q(Me.i,Me.x,Me.y),bt=F.next,St=Me.prev;return F.next=Me,Me.prev=F,Te.next=bt,bt.prev=Te,ht.next=Te,Te.prev=ht,St.next=ht,ht.prev=St,ht}function er(F,Me,Te,ht){var bt=new q(F,Me,Te);return ht?(bt.next=ht.next,bt.prev=ht,ht.next.prev=bt,ht.next=bt):(bt.prev=bt,bt.next=bt),bt}function xr(F){F.next.prev=F.prev,F.prev.next=F.next,F.prevZ&&(F.prevZ.nextZ=F.nextZ),F.nextZ&&(F.nextZ.prevZ=F.prevZ)}function q(F,Me,Te){this.i=F,this.x=Me,this.y=Te,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ne.deviation=function(F,Me,Te,ht){var bt=Me&&Me.length,St=bt?Me[0]*Te:F.length,qt=Math.abs(De(F,0,St,Te));if(bt)for(var or=0,rn=Me.length;or<rn;or++){var Or=Me[or]*Te,Kn=or<rn-1?Me[or+1]*Te:F.length;qt-=Math.abs(De(F,Or,Kn,Te))}var on=0;for(or=0;or<ht.length;or+=3){var Pn=ht[or]*Te,mi=ht[or+1]*Te,ei=ht[or+2]*Te;on+=Math.abs((F[Pn]-F[ei])*(F[mi+1]-F[Pn+1])-(F[Pn]-F[mi])*(F[ei+1]-F[Pn+1]))}return qt===0&&on===0?0:Math.abs((on-qt)/qt)};function De(F,Me,Te,ht){for(var bt=0,St=Me,qt=Te-ht;St<Te;St+=ht)bt+=(F[qt]-F[St])*(F[St+1]+F[qt+1]),qt=St;return bt}ne.flatten=function(F){for(var Me=F[0][0].length,Te={vertices:[],holes:[],dimensions:Me},ht=0,bt=0;bt<F.length;bt++){for(var St=0;St<F[bt].length;St++)for(var qt=0;qt<Me;qt++)Te.vertices.push(F[bt][St][qt]);bt>0&&(ht+=F[bt-1].length,Te.holes.push(ht))}return Te}},67709:function(yr){function ne(ge){var ee=ge.target||ge.srcElement;ee.__resizeRAF__&&cancelAnimationFrame(ee.__resizeRAF__),ee.__resizeRAF__=requestAnimationFrame(function(){var y=ee.__resizeTrigger__,ce=y&&y.__resizeListeners__;ce&&ce.forEach(function(z){z.call(y,ge)})})}var N=function(ee,y){var ce=this,z=ce.document,ae,te=z.attachEvent;typeof navigator!="undefined"&&(ae=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Pe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ne)}if(!ee.__resizeListeners__)if(ee.__resizeListeners__=[],te)ee.__resizeTrigger__=ee,ee.attachEvent("onresize",ne);else{getComputedStyle(ee).position==="static"&&(ee.style.position="relative");var re=ee.__resizeTrigger__=z.createElement("object");re.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),re.setAttribute("class","resize-sensor"),re.setAttribute("tabindex","-1"),re.setAttribute("title",""),re.__resizeElement__=ee,re.onload=Pe,re.type="text/html",ae&&ee.appendChild(re),re.data="about:blank",ae||ee.appendChild(re)}ee.__resizeListeners__.push(y)};yr.exports=typeof window=="undefined"?N:N.bind(window),yr.exports.unbind=function(ge,ee){var y=document.attachEvent,ce=ge.__resizeListeners__||[];if(ee){var z=ce.indexOf(ee);z!==-1&&ce.splice(z,1)}else ce=ge.__resizeListeners__=[];if(!ce.length){if(y)ge.detachEvent("onresize",ne);else if(ge.__resizeTrigger__){var ae=ge.__resizeTrigger__.contentDocument,te=ae&&ae.defaultView;te&&(te.removeEventListener("resize",ne),delete te.__resizeTrigger__),ge.__resizeTrigger__=!ge.removeChild(ge.__resizeTrigger__)}delete ge.__resizeListeners__}}},26729:function(yr){"use strict";var ne=Object.prototype.hasOwnProperty,N="~";function ge(){}Object.create&&(ge.prototype=Object.create(null),new ge().__proto__||(N=!1));function ee(ae,te,Pe){this.fn=ae,this.context=te,this.once=Pe||!1}function y(ae,te,Pe,re,Ze){if(typeof Pe!="function")throw new TypeError("The listener must be a function");var Ke=new ee(Pe,re||ae,Ze),nt=N?N+te:te;return ae._events[nt]?ae._events[nt].fn?ae._events[nt]=[ae._events[nt],Ke]:ae._events[nt].push(Ke):(ae._events[nt]=Ke,ae._eventsCount++),ae}function ce(ae,te){--ae._eventsCount==0?ae._events=new ge:delete ae._events[te]}function z(){this._events=new ge,this._eventsCount=0}z.prototype.eventNames=function(){var te=[],Pe,re;if(this._eventsCount===0)return te;for(re in Pe=this._events)ne.call(Pe,re)&&te.push(N?re.slice(1):re);return Object.getOwnPropertySymbols?te.concat(Object.getOwnPropertySymbols(Pe)):te},z.prototype.listeners=function(te){var Pe=N?N+te:te,re=this._events[Pe];if(!re)return[];if(re.fn)return[re.fn];for(var Ze=0,Ke=re.length,nt=new Array(Ke);Ze<Ke;Ze++)nt[Ze]=re[Ze].fn;return nt},z.prototype.listenerCount=function(te){var Pe=N?N+te:te,re=this._events[Pe];return re?re.fn?1:re.length:0},z.prototype.emit=function(te,Pe,re,Ze,Ke,nt){var Tt=N?N+te:te;if(!this._events[Tt])return!1;var Ct=this._events[Tt],Gt=arguments.length,Jt,Zt;if(Ct.fn){switch(Ct.once&&this.removeListener(te,Ct.fn,void 0,!0),Gt){case 1:return Ct.fn.call(Ct.context),!0;case 2:return Ct.fn.call(Ct.context,Pe),!0;case 3:return Ct.fn.call(Ct.context,Pe,re),!0;case 4:return Ct.fn.call(Ct.context,Pe,re,Ze),!0;case 5:return Ct.fn.call(Ct.context,Pe,re,Ze,Ke),!0;case 6:return Ct.fn.call(Ct.context,Pe,re,Ze,Ke,nt),!0}for(Zt=1,Jt=new Array(Gt-1);Zt<Gt;Zt++)Jt[Zt-1]=arguments[Zt];Ct.fn.apply(Ct.context,Jt)}else{var wt=Ct.length,xt;for(Zt=0;Zt<wt;Zt++)switch(Ct[Zt].once&&this.removeListener(te,Ct[Zt].fn,void 0,!0),Gt){case 1:Ct[Zt].fn.call(Ct[Zt].context);break;case 2:Ct[Zt].fn.call(Ct[Zt].context,Pe);break;case 3:Ct[Zt].fn.call(Ct[Zt].context,Pe,re);break;case 4:Ct[Zt].fn.call(Ct[Zt].context,Pe,re,Ze);break;default:if(!Jt)for(xt=1,Jt=new Array(Gt-1);xt<Gt;xt++)Jt[xt-1]=arguments[xt];Ct[Zt].fn.apply(Ct[Zt].context,Jt)}}return!0},z.prototype.on=function(te,Pe,re){return y(this,te,Pe,re,!1)},z.prototype.once=function(te,Pe,re){return y(this,te,Pe,re,!0)},z.prototype.removeListener=function(te,Pe,re,Ze){var Ke=N?N+te:te;if(!this._events[Ke])return this;if(!Pe)return ce(this,Ke),this;var nt=this._events[Ke];if(nt.fn)nt.fn===Pe&&(!Ze||nt.once)&&(!re||nt.context===re)&&ce(this,Ke);else{for(var Tt=0,Ct=[],Gt=nt.length;Tt<Gt;Tt++)(nt[Tt].fn!==Pe||Ze&&!nt[Tt].once||re&&nt[Tt].context!==re)&&Ct.push(nt[Tt]);Ct.length?this._events[Ke]=Ct.length===1?Ct[0]:Ct:ce(this,Ke)}return this},z.prototype.removeAllListeners=function(te){var Pe;return te?(Pe=N?N+te:te,this._events[Pe]&&ce(this,Pe)):(this._events=new ge,this._eventsCount=0),this},z.prototype.off=z.prototype.removeListener,z.prototype.addListener=z.prototype.on,z.prefixed=N,z.EventEmitter=z,yr.exports=z},50840:function(yr,ne,N){var ge;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ee,y,ce,z){"use strict";var ae=["","webkit","Moz","MS","ms","o"],te=y.createElement("div"),Pe="function",re=Math.round,Ze=Math.abs,Ke=Date.now;function nt(K,Re,st){return setTimeout(Lr(K,st),Re)}function Tt(K,Re,st){return Array.isArray(K)?(Ct(K,st[Re],st),!0):!1}function Ct(K,Re,st){var nr;if(!!K)if(K.forEach)K.forEach(Re,st);else if(K.length!==z)for(nr=0;nr<K.length;)Re.call(st,K[nr],nr,K),nr++;else for(nr in K)K.hasOwnProperty(nr)&&Re.call(st,K[nr],nr,K)}function Gt(K,Re,st){var nr="DEPRECATED METHOD: "+Re+`
`+st+` AT 
`;return function(){var Wr=new Error("get-stack-trace"),Dn=Wr&&Wr.stack?Wr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Hi=ee.console&&(ee.console.warn||ee.console.log);return Hi&&Hi.call(ee.console,nr,Dn),K.apply(this,arguments)}}var Jt;typeof Object.assign!="function"?Jt=function(Re){if(Re===z||Re===null)throw new TypeError("Cannot convert undefined or null to object");for(var st=Object(Re),nr=1;nr<arguments.length;nr++){var Wr=arguments[nr];if(Wr!==z&&Wr!==null)for(var Dn in Wr)Wr.hasOwnProperty(Dn)&&(st[Dn]=Wr[Dn])}return st}:Jt=Object.assign;var Zt=Gt(function(Re,st,nr){for(var Wr=Object.keys(st),Dn=0;Dn<Wr.length;)(!nr||nr&&Re[Wr[Dn]]===z)&&(Re[Wr[Dn]]=st[Wr[Dn]]),Dn++;return Re},"extend","Use `assign`."),wt=Gt(function(Re,st){return Zt(Re,st,!0)},"merge","Use `assign`.");function xt(K,Re,st){var nr=Re.prototype,Wr;Wr=K.prototype=Object.create(nr),Wr.constructor=K,Wr._super=nr,st&&Jt(Wr,st)}function Lr(K,Re){return function(){return K.apply(Re,arguments)}}function mr(K,Re){return typeof K==Pe?K.apply(Re&&Re[0]||z,Re):K}function hr(K,Re){return K===z?Re:K}function Et(K,Re,st){Ct(er(Re),function(nr){K.addEventListener(nr,st,!1)})}function lt(K,Re,st){Ct(er(Re),function(nr){K.removeEventListener(nr,st,!1)})}function Ut(K,Re){for(;K;){if(K==Re)return!0;K=K.parentNode}return!1}function vt(K,Re){return K.indexOf(Re)>-1}function er(K){return K.trim().split(/\s+/g)}function xr(K,Re,st){if(K.indexOf&&!st)return K.indexOf(Re);for(var nr=0;nr<K.length;){if(st&&K[nr][st]==Re||!st&&K[nr]===Re)return nr;nr++}return-1}function q(K){return Array.prototype.slice.call(K,0)}function De(K,Re,st){for(var nr=[],Wr=[],Dn=0;Dn<K.length;){var Hi=Re?K[Dn][Re]:K[Dn];xr(Wr,Hi)<0&&nr.push(K[Dn]),Wr[Dn]=Hi,Dn++}return st&&(Re?nr=nr.sort(function(_o,to){return _o[Re]>to[Re]}):nr=nr.sort()),nr}function F(K,Re){for(var st,nr,Wr=Re[0].toUpperCase()+Re.slice(1),Dn=0;Dn<ae.length;){if(st=ae[Dn],nr=st?st+Wr:Re,nr in K)return nr;Dn++}return z}var Me=1;function Te(){return Me++}function ht(K){var Re=K.ownerDocument||K;return Re.defaultView||Re.parentWindow||ee}var bt=/mobile|tablet|ip(ad|hone|od)|android/i,St="ontouchstart"in ee,qt=F(ee,"PointerEvent")!==z,or=St&&bt.test(navigator.userAgent),rn="touch",Or="pen",Kn="mouse",on="kinect",Pn=25,mi=1,ei=2,xn=4,Fi=8,zi=1,Li=2,Qn=4,Ln=8,Fo=16,sa=Li|Qn,ao=Ln|Fo,Pt=sa|ao,k=["x","y"],se=["clientX","clientY"];function de(K,Re){var st=this;this.manager=K,this.callback=Re,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(nr){mr(K.options.enable,[K])&&st.handler(nr)},this.init()}de.prototype={handler:function(){},init:function(){this.evEl&&Et(this.element,this.evEl,this.domHandler),this.evTarget&&Et(this.target,this.evTarget,this.domHandler),this.evWin&&Et(ht(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&lt(this.element,this.evEl,this.domHandler),this.evTarget&&lt(this.target,this.evTarget,this.domHandler),this.evWin&&lt(ht(this.element),this.evWin,this.domHandler)}};function je(K){var Re,st=K.options.inputClass;return st?Re=st:qt?Re=J:or?Re=ye:St?Re=br:Re=ra,new Re(K,mt)}function mt(K,Re,st){var nr=st.pointers.length,Wr=st.changedPointers.length,Dn=Re&mi&&nr-Wr==0,Hi=Re&(xn|Fi)&&nr-Wr==0;st.isFirst=!!Dn,st.isFinal=!!Hi,Dn&&(K.session={}),st.eventType=Re,Kt(K,st),K.emit("hammer.input",st),K.recognize(st),K.session.prevInput=st}function Kt(K,Re){var st=K.session,nr=Re.pointers,Wr=nr.length;st.firstInput||(st.firstInput=Mt(Re)),Wr>1&&!st.firstMultiple?st.firstMultiple=Mt(Re):Wr===1&&(st.firstMultiple=!1);var Dn=st.firstInput,Hi=st.firstMultiple,oo=Hi?Hi.center:Dn.center,_o=Re.center=sr(nr);Re.timeStamp=Ke(),Re.deltaTime=Re.timeStamp-Dn.timeStamp,Re.angle=On(oo,_o),Re.distance=Nn(oo,_o),Ar(st,Re),Re.offsetDirection=Gr(Re.deltaX,Re.deltaY);var to=dr(Re.deltaTime,Re.deltaX,Re.deltaY);Re.overallVelocityX=to.x,Re.overallVelocityY=to.y,Re.overallVelocity=Ze(to.x)>Ze(to.y)?to.x:to.y,Re.scale=Hi?Tn(Hi.pointers,nr):1,Re.rotation=Hi?An(Hi.pointers,nr):0,Re.maxPointers=st.prevInput?Re.pointers.length>st.prevInput.maxPointers?Re.pointers.length:st.prevInput.maxPointers:Re.pointers.length,Xe(st,Re);var Cs=K.element;Ut(Re.srcEvent.target,Cs)&&(Cs=Re.srcEvent.target),Re.target=Cs}function Ar(K,Re){var st=Re.center,nr=K.offsetDelta||{},Wr=K.prevDelta||{},Dn=K.prevInput||{};(Re.eventType===mi||Dn.eventType===xn)&&(Wr=K.prevDelta={x:Dn.deltaX||0,y:Dn.deltaY||0},nr=K.offsetDelta={x:st.x,y:st.y}),Re.deltaX=Wr.x+(st.x-nr.x),Re.deltaY=Wr.y+(st.y-nr.y)}function Xe(K,Re){var st=K.lastInterval||Re,nr=Re.timeStamp-st.timeStamp,Wr,Dn,Hi,oo;if(Re.eventType!=Fi&&(nr>Pn||st.velocity===z)){var _o=Re.deltaX-st.deltaX,to=Re.deltaY-st.deltaY,Cs=dr(nr,_o,to);Dn=Cs.x,Hi=Cs.y,Wr=Ze(Cs.x)>Ze(Cs.y)?Cs.x:Cs.y,oo=Gr(_o,to),K.lastInterval=Re}else Wr=st.velocity,Dn=st.velocityX,Hi=st.velocityY,oo=st.direction;Re.velocity=Wr,Re.velocityX=Dn,Re.velocityY=Hi,Re.direction=oo}function Mt(K){for(var Re=[],st=0;st<K.pointers.length;)Re[st]={clientX:re(K.pointers[st].clientX),clientY:re(K.pointers[st].clientY)},st++;return{timeStamp:Ke(),pointers:Re,center:sr(Re),deltaX:K.deltaX,deltaY:K.deltaY}}function sr(K){var Re=K.length;if(Re===1)return{x:re(K[0].clientX),y:re(K[0].clientY)};for(var st=0,nr=0,Wr=0;Wr<Re;)st+=K[Wr].clientX,nr+=K[Wr].clientY,Wr++;return{x:re(st/Re),y:re(nr/Re)}}function dr(K,Re,st){return{x:Re/K||0,y:st/K||0}}function Gr(K,Re){return K===Re?zi:Ze(K)>=Ze(Re)?K<0?Li:Qn:Re<0?Ln:Fo}function Nn(K,Re,st){st||(st=k);var nr=Re[st[0]]-K[st[0]],Wr=Re[st[1]]-K[st[1]];return Math.sqrt(nr*nr+Wr*Wr)}function On(K,Re,st){st||(st=k);var nr=Re[st[0]]-K[st[0]],Wr=Re[st[1]]-K[st[1]];return Math.atan2(Wr,nr)*180/Math.PI}function An(K,Re){return On(Re[1],Re[0],se)+On(K[1],K[0],se)}function Tn(K,Re){return Nn(Re[0],Re[1],se)/Nn(K[0],K[1],se)}var fi={mousedown:mi,mousemove:ei,mouseup:xn},ni="mousedown",ta="mousemove mouseup";function ra(){this.evEl=ni,this.evWin=ta,this.pressed=!1,de.apply(this,arguments)}xt(ra,de,{handler:function(Re){var st=fi[Re.type];st&mi&&Re.button===0&&(this.pressed=!0),st&ei&&Re.which!==1&&(st=xn),!!this.pressed&&(st&xn&&(this.pressed=!1),this.callback(this.manager,st,{pointers:[Re],changedPointers:[Re],pointerType:Kn,srcEvent:Re}))}});var Zo={pointerdown:mi,pointermove:ei,pointerup:xn,pointercancel:Fi,pointerout:Fi},Ts={2:rn,3:Or,4:Kn,5:on},wi="pointerdown",G="pointermove pointerup pointercancel";ee.MSPointerEvent&&!ee.PointerEvent&&(wi="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function J(){this.evEl=wi,this.evWin=G,de.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}xt(J,de,{handler:function(Re){var st=this.store,nr=!1,Wr=Re.type.toLowerCase().replace("ms",""),Dn=Zo[Wr],Hi=Ts[Re.pointerType]||Re.pointerType,oo=Hi==rn,_o=xr(st,Re.pointerId,"pointerId");Dn&mi&&(Re.button===0||oo)?_o<0&&(st.push(Re),_o=st.length-1):Dn&(xn|Fi)&&(nr=!0),!(_o<0)&&(st[_o]=Re,this.callback(this.manager,Dn,{pointers:st,changedPointers:[Re],pointerType:Hi,srcEvent:Re}),nr&&st.splice(_o,1))}});var ue={touchstart:mi,touchmove:ei,touchend:xn,touchcancel:Fi},be="touchstart",ke="touchstart touchmove touchend touchcancel";function it(){this.evTarget=be,this.evWin=ke,this.started=!1,de.apply(this,arguments)}xt(it,de,{handler:function(Re){var st=ue[Re.type];if(st===mi&&(this.started=!0),!!this.started){var nr=ct.call(this,Re,st);st&(xn|Fi)&&nr[0].length-nr[1].length==0&&(this.started=!1),this.callback(this.manager,st,{pointers:nr[0],changedPointers:nr[1],pointerType:rn,srcEvent:Re})}}});function ct(K,Re){var st=q(K.touches),nr=q(K.changedTouches);return Re&(xn|Fi)&&(st=De(st.concat(nr),"identifier",!0)),[st,nr]}var me={touchstart:mi,touchmove:ei,touchend:xn,touchcancel:Fi},Y="touchstart touchmove touchend touchcancel";function ye(){this.evTarget=Y,this.targetIds={},de.apply(this,arguments)}xt(ye,de,{handler:function(Re){var st=me[Re.type],nr=tt.call(this,Re,st);!nr||this.callback(this.manager,st,{pointers:nr[0],changedPointers:nr[1],pointerType:rn,srcEvent:Re})}});function tt(K,Re){var st=q(K.touches),nr=this.targetIds;if(Re&(mi|ei)&&st.length===1)return nr[st[0].identifier]=!0,[st,st];var Wr,Dn,Hi=q(K.changedTouches),oo=[],_o=this.target;if(Dn=st.filter(function(to){return Ut(to.target,_o)}),Re===mi)for(Wr=0;Wr<Dn.length;)nr[Dn[Wr].identifier]=!0,Wr++;for(Wr=0;Wr<Hi.length;)nr[Hi[Wr].identifier]&&oo.push(Hi[Wr]),Re&(xn|Fi)&&delete nr[Hi[Wr].identifier],Wr++;if(!!oo.length)return[De(Dn.concat(oo),"identifier",!0),oo]}var gt=2500,le=25;function br(){de.apply(this,arguments);var K=Lr(this.handler,this);this.touch=new ye(this.manager,K),this.mouse=new ra(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}xt(br,de,{handler:function(Re,st,nr){var Wr=nr.pointerType==rn,Dn=nr.pointerType==Kn;if(!(Dn&&nr.sourceCapabilities&&nr.sourceCapabilities.firesTouchEvents)){if(Wr)En.call(this,st,nr);else if(Dn&&rr.call(this,nr))return;this.callback(Re,st,nr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function En(K,Re){K&mi?(this.primaryTouch=Re.changedPointers[0].identifier,vn.call(this,Re)):K&(xn|Fi)&&vn.call(this,Re)}function vn(K){var Re=K.changedPointers[0];if(Re.identifier===this.primaryTouch){var st={x:Re.clientX,y:Re.clientY};this.lastTouches.push(st);var nr=this.lastTouches,Wr=function(){var Dn=nr.indexOf(st);Dn>-1&&nr.splice(Dn,1)};setTimeout(Wr,gt)}}function rr(K){for(var Re=K.srcEvent.clientX,st=K.srcEvent.clientY,nr=0;nr<this.lastTouches.length;nr++){var Wr=this.lastTouches[nr],Dn=Math.abs(Re-Wr.x),Hi=Math.abs(st-Wr.y);if(Dn<=le&&Hi<=le)return!0}return!1}var nn=F(te.style,"touchAction"),Hr=nn!==z,Yr="compute",gi="auto",Jr="manipulation",xi="none",Gi="pan-x",_i="pan-y",Ci=Ji();function Ri(K,Re){this.manager=K,this.set(Re)}Ri.prototype={set:function(K){K==Yr&&(K=this.compute()),Hr&&this.manager.element.style&&Ci[K]&&(this.manager.element.style[nn]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return Ct(this.manager.recognizers,function(Re){mr(Re.options.enable,[Re])&&(K=K.concat(Re.getTouchAction()))}),go(K.join(" "))},preventDefaults:function(K){var Re=K.srcEvent,st=K.offsetDirection;if(this.manager.session.prevented){Re.preventDefault();return}var nr=this.actions,Wr=vt(nr,xi)&&!Ci[xi],Dn=vt(nr,_i)&&!Ci[_i],Hi=vt(nr,Gi)&&!Ci[Gi];if(Wr){var oo=K.pointers.length===1,_o=K.distance<2,to=K.deltaTime<250;if(oo&&_o&&to)return}if(!(Hi&&Dn)&&(Wr||Dn&&st&sa||Hi&&st&ao))return this.preventSrc(Re)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function go(K){if(vt(K,xi))return xi;var Re=vt(K,Gi),st=vt(K,_i);return Re&&st?xi:Re||st?Re?Gi:_i:vt(K,Jr)?Jr:gi}function Ji(){if(!Hr)return!1;var K={},Re=ee.CSS&&ee.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(st){K[st]=Re?ee.CSS.supports("touch-action",st):!0}),K}var Sa=1,Mi=2,yi=4,Ai=8,Ca=Ai,Vs=16,va=32;function Ra(K){this.options=Jt({},this.defaults,K||{}),this.id=Te(),this.manager=null,this.options.enable=hr(this.options.enable,!0),this.state=Sa,this.simultaneous={},this.requireFail=[]}Ra.prototype={defaults:{},set:function(K){return Jt(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(Tt(K,"recognizeWith",this))return this;var Re=this.simultaneous;return K=xa(K,this),Re[K.id]||(Re[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return Tt(K,"dropRecognizeWith",this)?this:(K=xa(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(Tt(K,"requireFailure",this))return this;var Re=this.requireFail;return K=xa(K,this),xr(Re,K)===-1&&(Re.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(Tt(K,"dropRequireFailure",this))return this;K=xa(K,this);var Re=xr(this.requireFail,K);return Re>-1&&this.requireFail.splice(Re,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var Re=this,st=this.state;function nr(Wr){Re.manager.emit(Wr,K)}st<Ai&&nr(Re.options.event+Yu(st)),nr(Re.options.event),K.additionalEvent&&nr(K.additionalEvent),st>=Ai&&nr(Re.options.event+Yu(st))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=va},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(va|Sa)))return!1;K++}return!0},recognize:function(K){var Re=Jt({},K);if(!mr(this.options.enable,[this,Re])){this.reset(),this.state=va;return}this.state&(Ca|Vs|va)&&(this.state=Sa),this.state=this.process(Re),this.state&(Mi|yi|Ai|Vs)&&this.tryEmit(Re)},process:function(K){},getTouchAction:function(){},reset:function(){}};function Yu(K){return K&Vs?"cancel":K&Ai?"end":K&yi?"move":K&Mi?"start":""}function nu(K){return K==Fo?"down":K==Ln?"up":K==Li?"left":K==Qn?"right":""}function xa(K,Re){var st=Re.manager;return st?st.get(K):K}function as(){Ra.apply(this,arguments)}xt(as,Ra,{defaults:{pointers:1},attrTest:function(K){var Re=this.options.pointers;return Re===0||K.pointers.length===Re},process:function(K){var Re=this.state,st=K.eventType,nr=Re&(Mi|yi),Wr=this.attrTest(K);return nr&&(st&Fi||!Wr)?Re|Vs:nr||Wr?st&xn?Re|Ai:Re&Mi?Re|yi:Mi:va}});function ii(){as.apply(this,arguments),this.pX=null,this.pY=null}xt(ii,as,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pt},getTouchAction:function(){var K=this.options.direction,Re=[];return K&sa&&Re.push(_i),K&ao&&Re.push(Gi),Re},directionTest:function(K){var Re=this.options,st=!0,nr=K.distance,Wr=K.direction,Dn=K.deltaX,Hi=K.deltaY;return Wr&Re.direction||(Re.direction&sa?(Wr=Dn===0?zi:Dn<0?Li:Qn,st=Dn!=this.pX,nr=Math.abs(K.deltaX)):(Wr=Hi===0?zi:Hi<0?Ln:Fo,st=Hi!=this.pY,nr=Math.abs(K.deltaY))),K.direction=Wr,st&&nr>Re.threshold&&Wr&Re.direction},attrTest:function(K){return as.prototype.attrTest.call(this,K)&&(this.state&Mi||!(this.state&Mi)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var Re=nu(K.direction);Re&&(K.additionalEvent=this.options.event+Re),this._super.emit.call(this,K)}});function ua(){as.apply(this,arguments)}xt(ua,as,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xi]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&Mi)},emit:function(K){if(K.scale!==1){var Re=K.scale<1?"in":"out";K.additionalEvent=this.options.event+Re}this._super.emit.call(this,K)}});function Ma(){Ra.apply(this,arguments),this._timer=null,this._input=null}xt(Ma,Ra,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[gi]},process:function(K){var Re=this.options,st=K.pointers.length===Re.pointers,nr=K.distance<Re.threshold,Wr=K.deltaTime>Re.time;if(this._input=K,!nr||!st||K.eventType&(xn|Fi)&&!Wr)this.reset();else if(K.eventType&mi)this.reset(),this._timer=nt(function(){this.state=Ca,this.tryEmit()},Re.time,this);else if(K.eventType&xn)return Ca;return va},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===Ca&&(K&&K.eventType&xn?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=Ke(),this.manager.emit(this.options.event,this._input)))}});function na(){as.apply(this,arguments)}xt(na,as,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xi]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&Mi)}});function Yo(){as.apply(this,arguments)}xt(Yo,as,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:sa|ao,pointers:1},getTouchAction:function(){return ii.prototype.getTouchAction.call(this)},attrTest:function(K){var Re=this.options.direction,st;return Re&(sa|ao)?st=K.overallVelocity:Re&sa?st=K.overallVelocityX:Re&ao&&(st=K.overallVelocityY),this._super.attrTest.call(this,K)&&Re&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&Ze(st)>this.options.velocity&&K.eventType&xn},emit:function(K){var Re=nu(K.offsetDirection);Re&&this.manager.emit(this.options.event+Re,K),this.manager.emit(this.options.event,K)}});function Vo(){Ra.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}xt(Vo,Ra,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Jr]},process:function(K){var Re=this.options,st=K.pointers.length===Re.pointers,nr=K.distance<Re.threshold,Wr=K.deltaTime<Re.time;if(this.reset(),K.eventType&mi&&this.count===0)return this.failTimeout();if(nr&&Wr&&st){if(K.eventType!=xn)return this.failTimeout();var Dn=this.pTime?K.timeStamp-this.pTime<Re.interval:!0,Hi=!this.pCenter||Nn(this.pCenter,K.center)<Re.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!Hi||!Dn?this.count=1:this.count+=1,this._input=K;var oo=this.count%Re.taps;if(oo===0)return this.hasRequireFailures()?(this._timer=nt(function(){this.state=Ca,this.tryEmit()},Re.interval,this),Mi):Ca}return va},failTimeout:function(){return this._timer=nt(function(){this.state=va},this.options.interval,this),va},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ca&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Du(K,Re){return Re=Re||{},Re.recognizers=hr(Re.recognizers,Du.defaults.preset),new Da(K,Re)}Du.VERSION="2.0.7",Du.defaults={domEvents:!1,touchAction:Yr,enable:!0,inputTarget:null,inputClass:null,preset:[[na,{enable:!1}],[ua,{enable:!1},["rotate"]],[Yo,{direction:sa}],[ii,{direction:sa},["swipe"]],[Vo],[Vo,{event:"doubletap",taps:2},["tap"]],[Ma]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ws=1,fc=2;function Da(K,Re){this.options=Jt({},Du.defaults,Re||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=je(this),this.touchAction=new Ri(this,this.options.touchAction),ji(this,!0),Ct(this.options.recognizers,function(st){var nr=this.add(new st[0](st[1]));st[2]&&nr.recognizeWith(st[2]),st[3]&&nr.requireFailure(st[3])},this)}Da.prototype={set:function(K){return Jt(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?fc:ws},recognize:function(K){var Re=this.session;if(!Re.stopped){this.touchAction.preventDefaults(K);var st,nr=this.recognizers,Wr=Re.curRecognizer;(!Wr||Wr&&Wr.state&Ca)&&(Wr=Re.curRecognizer=null);for(var Dn=0;Dn<nr.length;)st=nr[Dn],Re.stopped!==fc&&(!Wr||st==Wr||st.canRecognizeWith(Wr))?st.recognize(K):st.reset(),!Wr&&st.state&(Mi|yi|Ai)&&(Wr=Re.curRecognizer=st),Dn++}},get:function(K){if(K instanceof Ra)return K;for(var Re=this.recognizers,st=0;st<Re.length;st++)if(Re[st].options.event==K)return Re[st];return null},add:function(K){if(Tt(K,"add",this))return this;var Re=this.get(K.options.event);return Re&&this.remove(Re),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(Tt(K,"remove",this))return this;if(K=this.get(K),K){var Re=this.recognizers,st=xr(Re,K);st!==-1&&(Re.splice(st,1),this.touchAction.update())}return this},on:function(K,Re){if(K!==z&&Re!==z){var st=this.handlers;return Ct(er(K),function(nr){st[nr]=st[nr]||[],st[nr].push(Re)}),this}},off:function(K,Re){if(K!==z){var st=this.handlers;return Ct(er(K),function(nr){Re?st[nr]&&st[nr].splice(xr(st[nr],Re),1):delete st[nr]}),this}},emit:function(K,Re){this.options.domEvents&&jo(K,Re);var st=this.handlers[K]&&this.handlers[K].slice();if(!(!st||!st.length)){Re.type=K,Re.preventDefault=function(){Re.srcEvent.preventDefault()};for(var nr=0;nr<st.length;)st[nr](Re),nr++}},destroy:function(){this.element&&ji(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ji(K,Re){var st=K.element;if(!!st.style){var nr;Ct(K.options.cssProps,function(Wr,Dn){nr=F(st.style,Dn),Re?(K.oldCssProps[nr]=st.style[nr],st.style[nr]=Wr):st.style[nr]=K.oldCssProps[nr]||""}),Re||(K.oldCssProps={})}}function jo(K,Re){var st=y.createEvent("Event");st.initEvent(K,!0,!0),st.gesture=Re,Re.target.dispatchEvent(st)}Jt(Du,{INPUT_START:mi,INPUT_MOVE:ei,INPUT_END:xn,INPUT_CANCEL:Fi,STATE_POSSIBLE:Sa,STATE_BEGAN:Mi,STATE_CHANGED:yi,STATE_ENDED:Ai,STATE_RECOGNIZED:Ca,STATE_CANCELLED:Vs,STATE_FAILED:va,DIRECTION_NONE:zi,DIRECTION_LEFT:Li,DIRECTION_RIGHT:Qn,DIRECTION_UP:Ln,DIRECTION_DOWN:Fo,DIRECTION_HORIZONTAL:sa,DIRECTION_VERTICAL:ao,DIRECTION_ALL:Pt,Manager:Da,Input:de,TouchAction:Ri,TouchInput:ye,MouseInput:ra,PointerEventInput:J,TouchMouseInput:br,SingleTouchInput:it,Recognizer:Ra,AttrRecognizer:as,Tap:Vo,Pan:ii,Swipe:Yo,Pinch:ua,Rotate:na,Press:Ma,on:Et,off:lt,each:Ct,merge:wt,extend:Zt,assign:Jt,inherit:xt,bindFn:Lr,prefixed:F});var Wt=typeof ee!="undefined"?ee:typeof self!="undefined"?self:{};Wt.Hammer=Du,ge=function(){return Du}.call(ne,N,ne,yr),ge!==z&&(yr.exports=ge)})(window,document,"Hammer")},80645:function(yr,ne){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ne.read=function(N,ge,ee,y,ce){var z,ae,te=ce*8-y-1,Pe=(1<<te)-1,re=Pe>>1,Ze=-7,Ke=ee?ce-1:0,nt=ee?-1:1,Tt=N[ge+Ke];for(Ke+=nt,z=Tt&(1<<-Ze)-1,Tt>>=-Ze,Ze+=te;Ze>0;z=z*256+N[ge+Ke],Ke+=nt,Ze-=8);for(ae=z&(1<<-Ze)-1,z>>=-Ze,Ze+=y;Ze>0;ae=ae*256+N[ge+Ke],Ke+=nt,Ze-=8);if(z===0)z=1-re;else{if(z===Pe)return ae?NaN:(Tt?-1:1)*Infinity;ae=ae+Math.pow(2,y),z=z-re}return(Tt?-1:1)*ae*Math.pow(2,z-y)},ne.write=function(N,ge,ee,y,ce,z){var ae,te,Pe,re=z*8-ce-1,Ze=(1<<re)-1,Ke=Ze>>1,nt=ce===23?Math.pow(2,-24)-Math.pow(2,-77):0,Tt=y?0:z-1,Ct=y?1:-1,Gt=ge<0||ge===0&&1/ge<0?1:0;for(ge=Math.abs(ge),isNaN(ge)||ge===Infinity?(te=isNaN(ge)?1:0,ae=Ze):(ae=Math.floor(Math.log(ge)/Math.LN2),ge*(Pe=Math.pow(2,-ae))<1&&(ae--,Pe*=2),ae+Ke>=1?ge+=nt/Pe:ge+=nt*Math.pow(2,1-Ke),ge*Pe>=2&&(ae++,Pe/=2),ae+Ke>=Ze?(te=0,ae=Ze):ae+Ke>=1?(te=(ge*Pe-1)*Math.pow(2,ce),ae=ae+Ke):(te=ge*Math.pow(2,Ke-1)*Math.pow(2,ce),ae=0));ce>=8;N[ee+Tt]=te&255,Tt+=Ct,te/=256,ce-=8);for(ae=ae<<ce|te,re+=ce;re>0;N[ee+Tt]=ae&255,Tt+=Ct,ae/=256,re-=8);N[ee+Tt-Ct]|=Gt*128}},7375:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function ge(ae,te,Pe,re){function Ze(){return re&&!Reflect.hasMetadata(N,this,te)&&Reflect.defineMetadata(N,Pe(),this,te),Reflect.hasMetadata(N,this,te)?Reflect.getMetadata(N,this,te):Pe()}function Ke(nt){Reflect.defineMetadata(N,nt,this,te)}Object.defineProperty(ae,te,{configurable:!0,enumerable:!0,get:Ze,set:Ke})}function ee(ae,te){return function(Pe){return function(re,Ze){var Ke=function(){return ae.get(Pe)};ge(re,Ze,Ke,te)}}}ne.makePropertyInjectDecorator=ee;function y(ae,te){return function(Pe,re){return function(Ze,Ke){var nt=function(){return ae.getNamed(Pe,re)};ge(Ze,Ke,nt,te)}}}ne.makePropertyInjectNamedDecorator=y;function ce(ae,te){return function(Pe,re,Ze){return function(Ke,nt){var Tt=function(){return ae.getTagged(Pe,re,Ze)};ge(Ke,nt,Tt,te)}}}ne.makePropertyInjectTaggedDecorator=ce;function z(ae,te){return function(Pe){return function(re,Ze){var Ke=function(){return ae.getAll(Pe)};ge(re,Ze,Ke,te)}}}ne.makePropertyMultiInjectDecorator=z},84879:function(yr,ne,N){"use strict";var ge;ge={value:!0};var ee=N(7375);function y(ce,z){z===void 0&&(z=!0);var ae=ee.makePropertyInjectDecorator(ce,z),te=ee.makePropertyInjectNamedDecorator(ce,z),Pe=ee.makePropertyInjectTaggedDecorator(ce,z),re=ee.makePropertyMultiInjectDecorator(ce,z);return{lazyInject:ae,lazyInjectNamed:te,lazyInjectTagged:Pe,lazyMultiInject:re}}ne.Z=y},99934:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagProperty=ne.tagParameter=ne.decorate=void 0;var ge=N(16674),ee=N(6867);function y(re,Ze,Ke,nt){var Tt=ee.TAGGED;z(Tt,re,Ze,nt,Ke)}ne.tagParameter=y;function ce(re,Ze,Ke){var nt=ee.TAGGED_PROP;z(nt,re.constructor,Ze,Ke)}ne.tagProperty=ce;function z(re,Ze,Ke,nt,Tt){var Ct={},Gt=typeof Tt=="number",Jt=Tt!==void 0&&Gt?Tt.toString():Ke;if(Gt&&Ke!==void 0)throw new Error(ge.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(re,Ze)&&(Ct=Reflect.getMetadata(re,Ze));var Zt=Ct[Jt];if(!Array.isArray(Zt))Zt=[];else for(var wt=0,xt=Zt;wt<xt.length;wt++){var Lr=xt[wt];if(Lr.key===nt.key)throw new Error(ge.DUPLICATED_METADATA+" "+Lr.key.toString())}Zt.push(nt),Ct[Jt]=Zt,Reflect.defineMetadata(re,Ct,Ze)}function ae(re,Ze){Reflect.decorate(re,Ze)}function te(re,Ze){return function(Ke,nt){Ze(Ke,nt,re)}}function Pe(re,Ze,Ke){typeof Ke=="number"?ae([te(Ke,re)],Ze):typeof Ke=="string"?Reflect.decorate([re],Ze,Ke):ae([re],Ze)}ne.decorate=Pe},5744:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.inject=ne.LazyServiceIdentifer=void 0;var ge=N(16674),ee=N(6867),y=N(47738),ce=N(99934),z=function(){function te(Pe){this._cb=Pe}return te.prototype.unwrap=function(){return this._cb()},te}();ne.LazyServiceIdentifer=z;function ae(te){return function(Pe,re,Ze){if(te===void 0)throw new Error(ge.UNDEFINED_INJECT_ANNOTATION(Pe.name));var Ke=new y.Metadata(ee.INJECT_TAG,te);typeof Ze=="number"?ce.tagParameter(Pe,re,Ze,Ke):ce.tagProperty(Pe,re,Ke)}}ne.inject=ae},64315:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.injectable=void 0;var ge=N(16674),ee=N(6867);function y(){return function(ce){if(Reflect.hasOwnMetadata(ee.PARAM_TYPES,ce))throw new Error(ge.DUPLICATED_INJECTABLE_DECORATOR);var z=Reflect.getMetadata(ee.DESIGN_PARAM_TYPES,ce)||[];return Reflect.defineMetadata(ee.PARAM_TYPES,z,ce),ce}}ne.injectable=y},71693:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiInject=void 0;var ge=N(6867),ee=N(47738),y=N(99934);function ce(z){return function(ae,te,Pe){var re=new ee.Metadata(ge.MULTI_INJECT_TAG,z);typeof Pe=="number"?y.tagParameter(ae,te,Pe,re):y.tagProperty(ae,te,re)}}ne.multiInject=ce},38085:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.named=void 0;var ge=N(6867),ee=N(47738),y=N(99934);function ce(z){return function(ae,te,Pe){var re=new ee.Metadata(ge.NAMED_TAG,z);typeof Pe=="number"?y.tagParameter(ae,te,Pe,re):y.tagProperty(ae,te,re)}}ne.named=ce},6515:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.optional=void 0;var ge=N(6867),ee=N(47738),y=N(99934);function ce(){return function(z,ae,te){var Pe=new ee.Metadata(ge.OPTIONAL_TAG,!0);typeof te=="number"?y.tagParameter(z,ae,te,Pe):y.tagProperty(z,ae,Pe)}}ne.optional=ce},7014:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.postConstruct=void 0;var ge=N(16674),ee=N(6867),y=N(47738);function ce(){return function(z,ae,te){var Pe=new y.Metadata(ee.POST_CONSTRUCT,ae);if(Reflect.hasOwnMetadata(ee.POST_CONSTRUCT,z.constructor))throw new Error(ge.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ee.POST_CONSTRUCT,Pe,z.constructor)}}ne.postConstruct=ce},32052:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagged=void 0;var ge=N(47738),ee=N(99934);function y(ce,z){return function(ae,te,Pe){var re=new ge.Metadata(ce,z);typeof Pe=="number"?ee.tagParameter(ae,te,Pe,re):ee.tagProperty(ae,te,re)}}ne.tagged=y},55638:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.targetName=void 0;var ge=N(6867),ee=N(47738),y=N(99934);function ce(z){return function(ae,te,Pe){var re=new ee.Metadata(ge.NAME_TAG,z);y.tagParameter(ae,te,Pe,re)}}ne.targetName=ce},86757:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.unmanaged=void 0;var ge=N(6867),ee=N(47738),y=N(99934);function ce(){return function(z,ae,te){var Pe=new ee.Metadata(ge.UNMANAGED_TAG,!0);y.tagParameter(z,ae,te,Pe)}}ne.unmanaged=ce},44290:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Binding=void 0;var ge=N(28421),ee=N(37791),y=function(){function ce(z,ae){this.id=ee.id(),this.activated=!1,this.serviceIdentifier=z,this.scope=ae,this.type=ge.BindingTypeEnum.Invalid,this.constraint=function(te){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ce.prototype.clone=function(){var z=new ce(this.serviceIdentifier,this.scope);return z.activated=z.scope===ge.BindingScopeEnum.Singleton?this.activated:!1,z.implementationType=this.implementationType,z.dynamicValue=this.dynamicValue,z.scope=this.scope,z.type=this.type,z.factory=this.factory,z.provider=this.provider,z.constraint=this.constraint,z.onActivation=this.onActivation,z.cache=this.cache,z},ce}();ne.Binding=y},23184:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ne.BindingCount=N},16674:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.STACK_OVERFLOW=ne.CIRCULAR_DEPENDENCY_IN_FACTORY=ne.POST_CONSTRUCT_ERROR=ne.MULTIPLE_POST_CONSTRUCT_METHODS=ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ne.ARGUMENTS_LENGTH_MISMATCH=ne.INVALID_DECORATOR_OPERATION=ne.INVALID_TO_SELF_VALUE=ne.INVALID_FUNCTION_BINDING=ne.INVALID_MIDDLEWARE_RETURN=ne.NO_MORE_SNAPSHOTS_AVAILABLE=ne.INVALID_BINDING_TYPE=ne.NOT_IMPLEMENTED=ne.CIRCULAR_DEPENDENCY=ne.UNDEFINED_INJECT_ANNOTATION=ne.MISSING_INJECT_ANNOTATION=ne.MISSING_INJECTABLE_ANNOTATION=ne.NOT_REGISTERED=ne.CANNOT_UNBIND=ne.AMBIGUOUS_MATCH=ne.KEY_NOT_FOUND=ne.NULL_ARGUMENT=ne.DUPLICATED_METADATA=ne.DUPLICATED_INJECTABLE_DECORATOR=void 0,ne.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ne.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ne.NULL_ARGUMENT="NULL argument",ne.KEY_NOT_FOUND="Key Not Found",ne.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ne.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ne.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ne.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ne.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(ce){return"@inject called with undefined this could mean that the class "+ce+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ne.UNDEFINED_INJECT_ANNOTATION=N,ne.CIRCULAR_DEPENDENCY="Circular dependency found:",ne.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ne.INVALID_BINDING_TYPE="Invalid binding type:",ne.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ne.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ne.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ne.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ne.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ge=function(){for(var ce=[],z=0;z<arguments.length;z++)ce[z]=arguments[z];return"The number of constructor arguments in the derived class "+(ce[0]+" must be >= than the number of constructor arguments of its base class.")};ne.ARGUMENTS_LENGTH_MISMATCH=ge,ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ne.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ee=function(){for(var ce=[],z=0;z<arguments.length;z++)ce[z]=arguments[z];return"@postConstruct error in class "+ce[0]+": "+ce[1]};ne.POST_CONSTRUCT_ERROR=ee;var y=function(){for(var ce=[],z=0;z<arguments.length;z++)ce[z]=arguments[z];return"It looks like there is a circular dependency "+("in one of the '"+ce[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ce[1]+"'.")};ne.CIRCULAR_DEPENDENCY_IN_FACTORY=y,ne.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.TargetTypeEnum=ne.BindingTypeEnum=ne.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ne.BindingScopeEnum=N;var ge={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ne.BindingTypeEnum=ge;var ee={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ne.TargetTypeEnum=ee},6867:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.NON_CUSTOM_TAG_KEYS=ne.POST_CONSTRUCT=ne.DESIGN_PARAM_TYPES=ne.PARAM_TYPES=ne.TAGGED_PROP=ne.TAGGED=ne.MULTI_INJECT_TAG=ne.INJECT_TAG=ne.OPTIONAL_TAG=ne.UNMANAGED_TAG=ne.NAME_TAG=ne.NAMED_TAG=void 0,ne.NAMED_TAG="named",ne.NAME_TAG="name",ne.UNMANAGED_TAG="unmanaged",ne.OPTIONAL_TAG="optional",ne.INJECT_TAG="inject",ne.MULTI_INJECT_TAG="multi_inject",ne.TAGGED="inversify:tagged",ne.TAGGED_PROP="inversify:tagged_props",ne.PARAM_TYPES="inversify:paramtypes",ne.DESIGN_PARAM_TYPES="design:paramtypes",ne.POST_CONSTRUCT="post_construct";function N(){return[ne.INJECT_TAG,ne.MULTI_INJECT_TAG,ne.NAME_TAG,ne.UNMANAGED_TAG,ne.NAMED_TAG,ne.OPTIONAL_TAG]}ne.NON_CUSTOM_TAG_KEYS=N()},51389:function(yr,ne,N){"use strict";var ge=this&&this.__awaiter||function(Zt,wt,xt,Lr){function mr(hr){return hr instanceof xt?hr:new xt(function(Et){Et(hr)})}return new(xt||(xt=Promise))(function(hr,Et){function lt(er){try{vt(Lr.next(er))}catch(xr){Et(xr)}}function Ut(er){try{vt(Lr.throw(er))}catch(xr){Et(xr)}}function vt(er){er.done?hr(er.value):mr(er.value).then(lt,Ut)}vt((Lr=Lr.apply(Zt,wt||[])).next())})},ee=this&&this.__generator||function(Zt,wt){var xt={label:0,sent:function(){if(hr[0]&1)throw hr[1];return hr[1]},trys:[],ops:[]},Lr,mr,hr,Et;return Et={next:lt(0),throw:lt(1),return:lt(2)},typeof Symbol=="function"&&(Et[Symbol.iterator]=function(){return this}),Et;function lt(vt){return function(er){return Ut([vt,er])}}function Ut(vt){if(Lr)throw new TypeError("Generator is already executing.");for(;xt;)try{if(Lr=1,mr&&(hr=vt[0]&2?mr.return:vt[0]?mr.throw||((hr=mr.return)&&hr.call(mr),0):mr.next)&&!(hr=hr.call(mr,vt[1])).done)return hr;switch(mr=0,hr&&(vt=[vt[0]&2,hr.value]),vt[0]){case 0:case 1:hr=vt;break;case 4:return xt.label++,{value:vt[1],done:!1};case 5:xt.label++,mr=vt[1],vt=[0];continue;case 7:vt=xt.ops.pop(),xt.trys.pop();continue;default:if(hr=xt.trys,!(hr=hr.length>0&&hr[hr.length-1])&&(vt[0]===6||vt[0]===2)){xt=0;continue}if(vt[0]===3&&(!hr||vt[1]>hr[0]&&vt[1]<hr[3])){xt.label=vt[1];break}if(vt[0]===6&&xt.label<hr[1]){xt.label=hr[1],hr=vt;break}if(hr&&xt.label<hr[2]){xt.label=hr[2],xt.ops.push(vt);break}hr[2]&&xt.ops.pop(),xt.trys.pop();continue}vt=wt.call(Zt,xt)}catch(er){vt=[6,er],mr=0}finally{Lr=hr=0}if(vt[0]&5)throw vt[1];return{value:vt[0]?vt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Zt,wt){for(var xt=0,Lr=wt.length,mr=Zt.length;xt<Lr;xt++,mr++)Zt[mr]=wt[xt];return Zt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Container=void 0;var ce=N(44290),z=N(16674),ae=N(28421),te=N(6867),Pe=N(51377),re=N(86311),Ze=N(31927),Ke=N(15451),nt=N(37791),Tt=N(55800),Ct=N(85700),Gt=N(80175),Jt=function(){function Zt(wt){this._appliedMiddleware=[];var xt=wt||{};if(typeof xt!="object")throw new Error(""+z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(xt.defaultScope===void 0)xt.defaultScope=ae.BindingScopeEnum.Transient;else if(xt.defaultScope!==ae.BindingScopeEnum.Singleton&&xt.defaultScope!==ae.BindingScopeEnum.Transient&&xt.defaultScope!==ae.BindingScopeEnum.Request)throw new Error(""+z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(xt.autoBindInjectable===void 0)xt.autoBindInjectable=!1;else if(typeof xt.autoBindInjectable!="boolean")throw new Error(""+z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(xt.skipBaseClassChecks===void 0)xt.skipBaseClassChecks=!1;else if(typeof xt.skipBaseClassChecks!="boolean")throw new Error(""+z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:xt.autoBindInjectable,defaultScope:xt.defaultScope,skipBaseClassChecks:xt.skipBaseClassChecks},this.id=nt.id(),this._bindingDictionary=new Gt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Pe.MetadataReader}return Zt.merge=function(wt,xt){for(var Lr=[],mr=2;mr<arguments.length;mr++)Lr[mr-2]=arguments[mr];var hr=new Zt,Et=y([wt,xt],Lr).map(function(vt){return re.getBindingDictionary(vt)}),lt=re.getBindingDictionary(hr);function Ut(vt,er){vt.traverse(function(xr,q){q.forEach(function(De){er.add(De.serviceIdentifier,De.clone())})})}return Et.forEach(function(vt){Ut(vt,lt)}),hr},Zt.prototype.load=function(){for(var wt=[],xt=0;xt<arguments.length;xt++)wt[xt]=arguments[xt];for(var Lr=this._getContainerModuleHelpersFactory(),mr=0,hr=wt;mr<hr.length;mr++){var Et=hr[mr],lt=Lr(Et.id);Et.registry(lt.bindFunction,lt.unbindFunction,lt.isboundFunction,lt.rebindFunction)}},Zt.prototype.loadAsync=function(){for(var wt=[],xt=0;xt<arguments.length;xt++)wt[xt]=arguments[xt];return ge(this,void 0,void 0,function(){var Lr,mr,hr,Et,lt;return ee(this,function(Ut){switch(Ut.label){case 0:Lr=this._getContainerModuleHelpersFactory(),mr=0,hr=wt,Ut.label=1;case 1:return mr<hr.length?(Et=hr[mr],lt=Lr(Et.id),[4,Et.registry(lt.bindFunction,lt.unbindFunction,lt.isboundFunction,lt.rebindFunction)]):[3,4];case 2:Ut.sent(),Ut.label=3;case 3:return mr++,[3,1];case 4:return[2]}})})},Zt.prototype.unload=function(){for(var wt=this,xt=[],Lr=0;Lr<arguments.length;Lr++)xt[Lr]=arguments[Lr];var mr=function(hr){return function(Et){return Et.moduleId===hr}};xt.forEach(function(hr){var Et=mr(hr.id);wt._bindingDictionary.removeByCondition(Et)})},Zt.prototype.bind=function(wt){var xt=this.options.defaultScope||ae.BindingScopeEnum.Transient,Lr=new ce.Binding(wt,xt);return this._bindingDictionary.add(wt,Lr),new Ke.BindingToSyntax(Lr)},Zt.prototype.rebind=function(wt){return this.unbind(wt),this.bind(wt)},Zt.prototype.unbind=function(wt){try{this._bindingDictionary.remove(wt)}catch(xt){throw new Error(z.CANNOT_UNBIND+" "+Tt.getServiceIdentifierAsString(wt))}},Zt.prototype.unbindAll=function(){this._bindingDictionary=new Gt.Lookup},Zt.prototype.isBound=function(wt){var xt=this._bindingDictionary.hasKey(wt);return!xt&&this.parent&&(xt=this.parent.isBound(wt)),xt},Zt.prototype.isBoundNamed=function(wt,xt){return this.isBoundTagged(wt,te.NAMED_TAG,xt)},Zt.prototype.isBoundTagged=function(wt,xt,Lr){var mr=!1;if(this._bindingDictionary.hasKey(wt)){var hr=this._bindingDictionary.get(wt),Et=re.createMockRequest(this,wt,xt,Lr);mr=hr.some(function(lt){return lt.constraint(Et)})}return!mr&&this.parent&&(mr=this.parent.isBoundTagged(wt,xt,Lr)),mr},Zt.prototype.snapshot=function(){this._snapshots.push(Ct.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Zt.prototype.restore=function(){var wt=this._snapshots.pop();if(wt===void 0)throw new Error(z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=wt.bindings,this._middleware=wt.middleware},Zt.prototype.createChild=function(wt){var xt=new Zt(wt||this.options);return xt.parent=this,xt},Zt.prototype.applyMiddleware=function(){for(var wt=[],xt=0;xt<arguments.length;xt++)wt[xt]=arguments[xt];this._appliedMiddleware=this._appliedMiddleware.concat(wt);var Lr=this._middleware?this._middleware:this._planAndResolve();this._middleware=wt.reduce(function(mr,hr){return hr(mr)},Lr)},Zt.prototype.applyCustomMetadataReader=function(wt){this._metadataReader=wt},Zt.prototype.get=function(wt){return this._get(!1,!1,ae.TargetTypeEnum.Variable,wt)},Zt.prototype.getTagged=function(wt,xt,Lr){return this._get(!1,!1,ae.TargetTypeEnum.Variable,wt,xt,Lr)},Zt.prototype.getNamed=function(wt,xt){return this.getTagged(wt,te.NAMED_TAG,xt)},Zt.prototype.getAll=function(wt){return this._get(!0,!0,ae.TargetTypeEnum.Variable,wt)},Zt.prototype.getAllTagged=function(wt,xt,Lr){return this._get(!1,!0,ae.TargetTypeEnum.Variable,wt,xt,Lr)},Zt.prototype.getAllNamed=function(wt,xt){return this.getAllTagged(wt,te.NAMED_TAG,xt)},Zt.prototype.resolve=function(wt){var xt=this.createChild();return xt.bind(wt).toSelf(),this._appliedMiddleware.forEach(function(Lr){xt.applyMiddleware(Lr)}),xt.get(wt)},Zt.prototype._getContainerModuleHelpersFactory=function(){var wt=this,xt=function(lt,Ut){lt._binding.moduleId=Ut},Lr=function(lt){return function(Ut){var vt=wt.bind.bind(wt),er=vt(Ut);return xt(er,lt),er}},mr=function(lt){return function(Ut){var vt=wt.unbind.bind(wt);vt(Ut)}},hr=function(lt){return function(Ut){var vt=wt.isBound.bind(wt);return vt(Ut)}},Et=function(lt){return function(Ut){var vt=wt.rebind.bind(wt),er=vt(Ut);return xt(er,lt),er}};return function(lt){return{bindFunction:Lr(lt),isboundFunction:hr(lt),rebindFunction:Et(lt),unbindFunction:mr(lt)}}},Zt.prototype._get=function(wt,xt,Lr,mr,hr,Et){var lt=null,Ut={avoidConstraints:wt,contextInterceptor:function(vt){return vt},isMultiInject:xt,key:hr,serviceIdentifier:mr,targetType:Lr,value:Et};if(this._middleware){if(lt=this._middleware(Ut),lt==null)throw new Error(z.INVALID_MIDDLEWARE_RETURN)}else lt=this._planAndResolve()(Ut);return lt},Zt.prototype._planAndResolve=function(){var wt=this;return function(xt){var Lr=re.plan(wt._metadataReader,wt,xt.isMultiInject,xt.targetType,xt.serviceIdentifier,xt.key,xt.value,xt.avoidConstraints);Lr=xt.contextInterceptor(Lr);var mr=Ze.resolve(Lr);return mr}},Zt}();ne.Container=Jt},33244:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.AsyncContainerModule=ne.ContainerModule=void 0;var ge=N(37791),ee=function(){function ce(z){this.id=ge.id(),this.registry=z}return ce}();ne.ContainerModule=ee;var y=function(){function ce(z){this.id=ge.id(),this.registry=z}return ce}();ne.AsyncContainerModule=y},85700:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.ContainerSnapshot=void 0;var N=function(){function ge(){}return ge.of=function(ee,y){var ce=new ge;return ce.bindings=ee,ce.middleware=y,ce},ge}();ne.ContainerSnapshot=N},80175:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Lookup=void 0;var ge=N(16674),ee=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(ce,z){if(ce==null)throw new Error(ge.NULL_ARGUMENT);if(z==null)throw new Error(ge.NULL_ARGUMENT);var ae=this._map.get(ce);ae!==void 0?(ae.push(z),this._map.set(ce,ae)):this._map.set(ce,[z])},y.prototype.get=function(ce){if(ce==null)throw new Error(ge.NULL_ARGUMENT);var z=this._map.get(ce);if(z!==void 0)return z;throw new Error(ge.KEY_NOT_FOUND)},y.prototype.remove=function(ce){if(ce==null)throw new Error(ge.NULL_ARGUMENT);if(!this._map.delete(ce))throw new Error(ge.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(ce){var z=this;this._map.forEach(function(ae,te){var Pe=ae.filter(function(re){return!ce(re)});Pe.length>0?z._map.set(te,Pe):z._map.delete(te)})},y.prototype.hasKey=function(ce){if(ce==null)throw new Error(ge.NULL_ARGUMENT);return this._map.has(ce)},y.prototype.clone=function(){var ce=new y;return this._map.forEach(function(z,ae){z.forEach(function(te){return ce.add(ae,te.clone())})}),ce},y.prototype.traverse=function(ce){this._map.forEach(function(z,ae){ce(ae,z)})},y}();ne.Lookup=ee},86700:function(yr,ne,N){"use strict";var ge;ge={value:!0},ge=ge=ge=ge=ge=ge=ne.GW=ge=ge=ne.zY=ge=ge=ge=ge=ge=ne.f3=ge=ge=ne.b2=ge=ge=ge=ge=ge=ne.W2=ge=void 0;var ee=N(6867);ge=ee;var y=N(51389);Object.defineProperty(ne,"W2",{enumerable:!0,get:function(){return y.Container}});var ce=N(28421);ge={enumerable:!0,get:function(){return ce.BindingScopeEnum}},ge={enumerable:!0,get:function(){return ce.BindingTypeEnum}},ge={enumerable:!0,get:function(){return ce.TargetTypeEnum}};var z=N(33244);ge={enumerable:!0,get:function(){return z.AsyncContainerModule}},ge={enumerable:!0,get:function(){return z.ContainerModule}};var ae=N(64315);Object.defineProperty(ne,"b2",{enumerable:!0,get:function(){return ae.injectable}});var te=N(32052);ge={enumerable:!0,get:function(){return te.tagged}};var Pe=N(38085);ge={enumerable:!0,get:function(){return Pe.named}};var re=N(5744);Object.defineProperty(ne,"f3",{enumerable:!0,get:function(){return re.inject}}),ge={enumerable:!0,get:function(){return re.LazyServiceIdentifer}};var Ze=N(6515);ge={enumerable:!0,get:function(){return Ze.optional}};var Ke=N(86757);ge={enumerable:!0,get:function(){return Ke.unmanaged}};var nt=N(71693);ge={enumerable:!0,get:function(){return nt.multiInject}};var Tt=N(55638);ge={enumerable:!0,get:function(){return Tt.targetName}};var Ct=N(7014);Object.defineProperty(ne,"zY",{enumerable:!0,get:function(){return Ct.postConstruct}});var Gt=N(51377);ge={enumerable:!0,get:function(){return Gt.MetadataReader}};var Jt=N(37791);ge={enumerable:!0,get:function(){return Jt.id}};var Zt=N(99934);Object.defineProperty(ne,"GW",{enumerable:!0,get:function(){return Zt.decorate}});var wt=N(80758);ge={enumerable:!0,get:function(){return wt.traverseAncerstors}},ge={enumerable:!0,get:function(){return wt.taggedConstraint}},ge={enumerable:!0,get:function(){return wt.namedConstraint}},ge={enumerable:!0,get:function(){return wt.typeConstraint}};var xt=N(55800);ge={enumerable:!0,get:function(){return xt.getServiceIdentifierAsString}};var Lr=N(70600);ge={enumerable:!0,get:function(){return Lr.multiBindToService}}},95228:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Context=void 0;var ge=N(37791),ee=function(){function y(ce){this.id=ge.id(),this.container=ce}return y.prototype.addPlan=function(ce){this.plan=ce},y.prototype.setCurrentRequest=function(ce){this.currentRequest=ce},y}();ne.Context=ee},47738:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Metadata=void 0;var ge=N(6867),ee=function(){function y(ce,z){this.key=ce,this.value=z}return y.prototype.toString=function(){return this.key===ge.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();ne.Metadata=ee},51377:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.MetadataReader=void 0;var ge=N(6867),ee=function(){function y(){}return y.prototype.getConstructorMetadata=function(ce){var z=Reflect.getMetadata(ge.PARAM_TYPES,ce),ae=Reflect.getMetadata(ge.TAGGED,ce);return{compilerGeneratedMetadata:z,userGeneratedMetadata:ae||{}}},y.prototype.getPropertiesMetadata=function(ce){var z=Reflect.getMetadata(ge.TAGGED_PROP,ce)||[];return z},y}();ne.MetadataReader=ee},55314:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Plan=void 0;var N=function(){function ge(ee,y){this.parentContext=ee,this.rootRequest=y}return ge}();ne.Plan=N},86311:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.getBindingDictionary=ne.createMockRequest=ne.plan=void 0;var ge=N(23184),ee=N(16674),y=N(28421),ce=N(6867),z=N(85265),ae=N(55800),te=N(95228),Pe=N(47738),re=N(55314),Ze=N(6e3),Ke=N(6748),nt=N(18924);function Tt(mr){return mr._bindingDictionary}ne.getBindingDictionary=Tt;function Ct(mr,hr,Et,lt,Ut,vt){var er=mr?ce.MULTI_INJECT_TAG:ce.INJECT_TAG,xr=new Pe.Metadata(er,Et),q=new nt.Target(hr,lt,Et,xr);if(Ut!==void 0){var De=new Pe.Metadata(Ut,vt);q.metadata.push(De)}return q}function Gt(mr,hr,Et,lt,Ut){var vt=wt(Et.container,Ut.serviceIdentifier),er=[];return vt.length===ge.BindingCount.NoBindingsAvailable&&Et.container.options.autoBindInjectable&&typeof Ut.serviceIdentifier=="function"&&mr.getConstructorMetadata(Ut.serviceIdentifier).compilerGeneratedMetadata&&(Et.container.bind(Ut.serviceIdentifier).toSelf(),vt=wt(Et.container,Ut.serviceIdentifier)),hr?er=vt:er=vt.filter(function(xr){var q=new Ke.Request(xr.serviceIdentifier,Et,lt,xr,Ut);return xr.constraint(q)}),Jt(Ut.serviceIdentifier,er,Ut,Et.container),er}function Jt(mr,hr,Et,lt){switch(hr.length){case ge.BindingCount.NoBindingsAvailable:if(Et.isOptional())return hr;var Ut=ae.getServiceIdentifierAsString(mr),vt=ee.NOT_REGISTERED;throw vt+=ae.listMetadataForTarget(Ut,Et),vt+=ae.listRegisteredBindingsForServiceIdentifier(lt,Ut,wt),new Error(vt);case ge.BindingCount.OnlyOneBindingAvailable:if(!Et.isArray())return hr;case ge.BindingCount.MultipleBindingsAvailable:default:if(Et.isArray())return hr;var Ut=ae.getServiceIdentifierAsString(mr),vt=ee.AMBIGUOUS_MATCH+" "+Ut;throw vt+=ae.listRegisteredBindingsForServiceIdentifier(lt,Ut,wt),new Error(vt)}}function Zt(mr,hr,Et,lt,Ut,vt){var er,xr;if(Ut===null){er=Gt(mr,hr,lt,null,vt),xr=new Ke.Request(Et,lt,null,er,vt);var q=new re.Plan(lt,xr);lt.addPlan(q)}else er=Gt(mr,hr,lt,Ut,vt),xr=Ut.addChildRequest(vt.serviceIdentifier,er,vt);er.forEach(function(De){var F=null;if(vt.isArray())F=xr.addChildRequest(De.serviceIdentifier,De,vt);else{if(De.cache)return;F=xr}if(De.type===y.BindingTypeEnum.Instance&&De.implementationType!==null){var Me=Ze.getDependencies(mr,De.implementationType);if(!lt.container.options.skipBaseClassChecks){var Te=Ze.getBaseClassDependencyCount(mr,De.implementationType);if(Me.length<Te){var ht=ee.ARGUMENTS_LENGTH_MISMATCH(Ze.getFunctionName(De.implementationType));throw new Error(ht)}}Me.forEach(function(bt){Zt(mr,!1,bt.serviceIdentifier,lt,F,bt)})}})}function wt(mr,hr){var Et=[],lt=Tt(mr);return lt.hasKey(hr)?Et=lt.get(hr):mr.parent!==null&&(Et=wt(mr.parent,hr)),Et}function xt(mr,hr,Et,lt,Ut,vt,er,xr){xr===void 0&&(xr=!1);var q=new te.Context(hr),De=Ct(Et,lt,Ut,"",vt,er);try{return Zt(mr,xr,Ut,q,null,De),q}catch(F){throw z.isStackOverflowExeption(F)&&q.plan&&ae.circularDependencyToException(q.plan.rootRequest),F}}ne.plan=xt;function Lr(mr,hr,Et,lt){var Ut=new nt.Target(y.TargetTypeEnum.Variable,"",hr,new Pe.Metadata(Et,lt)),vt=new te.Context(mr),er=new Ke.Request(hr,vt,null,[],Ut);return er}ne.createMockRequest=Lr},88460:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.QueryableString=void 0;var N=function(){function ge(ee){this.str=ee}return ge.prototype.startsWith=function(ee){return this.str.indexOf(ee)===0},ge.prototype.endsWith=function(ee){var y="",ce=ee.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},ce)},ge.prototype.contains=function(ee){return this.str.indexOf(ee)!==-1},ge.prototype.equals=function(ee){return this.str===ee},ge.prototype.value=function(){return this.str},ge}();ne.QueryableString=N},6e3:function(yr,ne,N){"use strict";var ge=this&&this.__spreadArray||function(Gt,Jt){for(var Zt=0,wt=Jt.length,xt=Gt.length;Zt<wt;Zt++,xt++)Gt[xt]=Jt[Zt];return Gt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getFunctionName=ne.getBaseClassDependencyCount=ne.getDependencies=void 0;var ee=N(5744),y=N(16674),ce=N(28421),z=N(6867),ae=N(55800);Object.defineProperty(ne,"getFunctionName",{enumerable:!0,get:function(){return ae.getFunctionName}});var te=N(18924);function Pe(Gt,Jt){var Zt=ae.getFunctionName(Jt),wt=re(Gt,Zt,Jt,!1);return wt}ne.getDependencies=Pe;function re(Gt,Jt,Zt,wt){var xt=Gt.getConstructorMetadata(Zt),Lr=xt.compilerGeneratedMetadata;if(Lr===void 0){var mr=y.MISSING_INJECTABLE_ANNOTATION+" "+Jt+".";throw new Error(mr)}var hr=xt.userGeneratedMetadata,Et=Object.keys(hr),lt=Zt.length===0&&Et.length>0,Ut=Et.length>Zt.length,vt=lt||Ut?Et.length:Zt.length,er=Ke(wt,Jt,Lr,hr,vt),xr=nt(Gt,Zt),q=ge(ge([],er),xr);return q}function Ze(Gt,Jt,Zt,wt,xt){var Lr=xt[Gt.toString()]||[],mr=Ct(Lr),hr=mr.unmanaged!==!0,Et=wt[Gt],lt=mr.inject||mr.multiInject;if(Et=lt||Et,Et instanceof ee.LazyServiceIdentifer&&(Et=Et.unwrap()),hr){var Ut=Et===Object,vt=Et===Function,er=Et===void 0,xr=Ut||vt||er;if(!Jt&&xr){var q=y.MISSING_INJECT_ANNOTATION+" argument "+Gt+" in class "+Zt+".";throw new Error(q)}var De=new te.Target(ce.TargetTypeEnum.ConstructorArgument,mr.targetName,Et);return De.metadata=Lr,De}return null}function Ke(Gt,Jt,Zt,wt,xt){for(var Lr=[],mr=0;mr<xt;mr++){var hr=mr,Et=Ze(hr,Gt,Jt,Zt,wt);Et!==null&&Lr.push(Et)}return Lr}function nt(Gt,Jt){for(var Zt=Gt.getPropertiesMetadata(Jt),wt=[],xt=Object.keys(Zt),Lr=0,mr=xt;Lr<mr.length;Lr++){var hr=mr[Lr],Et=Zt[hr],lt=Ct(Zt[hr]),Ut=lt.targetName||hr,vt=lt.inject||lt.multiInject,er=new te.Target(ce.TargetTypeEnum.ClassProperty,Ut,vt);er.metadata=Et,wt.push(er)}var xr=Object.getPrototypeOf(Jt.prototype).constructor;if(xr!==Object){var q=nt(Gt,xr);wt=ge(ge([],wt),q)}return wt}function Tt(Gt,Jt){var Zt=Object.getPrototypeOf(Jt.prototype).constructor;if(Zt!==Object){var wt=ae.getFunctionName(Zt),xt=re(Gt,wt,Zt,!0),Lr=xt.map(function(Et){return Et.metadata.filter(function(lt){return lt.key===z.UNMANAGED_TAG})}),mr=[].concat.apply([],Lr).length,hr=xt.length-mr;return hr>0?hr:Tt(Gt,Zt)}else return 0}ne.getBaseClassDependencyCount=Tt;function Ct(Gt){var Jt={};return Gt.forEach(function(Zt){Jt[Zt.key.toString()]=Zt.value}),{inject:Jt[z.INJECT_TAG],multiInject:Jt[z.MULTI_INJECT_TAG],targetName:Jt[z.NAME_TAG],unmanaged:Jt[z.UNMANAGED_TAG]}}},6748:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Request=void 0;var ge=N(37791),ee=function(){function y(ce,z,ae,te,Pe){this.id=ge.id(),this.serviceIdentifier=ce,this.parentContext=z,this.parentRequest=ae,this.target=Pe,this.childRequests=[],this.bindings=Array.isArray(te)?te:[te],this.requestScope=ae===null?new Map:null}return y.prototype.addChildRequest=function(ce,z,ae){var te=new y(ce,this.parentContext,this,z,ae);return this.childRequests.push(te),te},y}();ne.Request=ee},18924:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Target=void 0;var ge=N(6867),ee=N(37791),y=N(47738),ce=N(88460),z=function(){function ae(te,Pe,re,Ze){this.id=ee.id(),this.type=te,this.serviceIdentifier=re,this.name=new ce.QueryableString(Pe||""),this.metadata=new Array;var Ke=null;typeof Ze=="string"?Ke=new y.Metadata(ge.NAMED_TAG,Ze):Ze instanceof y.Metadata&&(Ke=Ze),Ke!==null&&this.metadata.push(Ke)}return ae.prototype.hasTag=function(te){for(var Pe=0,re=this.metadata;Pe<re.length;Pe++){var Ze=re[Pe];if(Ze.key===te)return!0}return!1},ae.prototype.isArray=function(){return this.hasTag(ge.MULTI_INJECT_TAG)},ae.prototype.matchesArray=function(te){return this.matchesTag(ge.MULTI_INJECT_TAG)(te)},ae.prototype.isNamed=function(){return this.hasTag(ge.NAMED_TAG)},ae.prototype.isTagged=function(){return this.metadata.some(function(te){return ge.NON_CUSTOM_TAG_KEYS.every(function(Pe){return te.key!==Pe})})},ae.prototype.isOptional=function(){return this.matchesTag(ge.OPTIONAL_TAG)(!0)},ae.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(te){return te.key===ge.NAMED_TAG})[0]:null},ae.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(te){return ge.NON_CUSTOM_TAG_KEYS.every(function(Pe){return te.key!==Pe})}):null},ae.prototype.matchesNamedTag=function(te){return this.matchesTag(ge.NAMED_TAG)(te)},ae.prototype.matchesTag=function(te){var Pe=this;return function(re){for(var Ze=0,Ke=Pe.metadata;Ze<Ke.length;Ze++){var nt=Ke[Ze];if(nt.key===te&&nt.value===re)return!0}return!1}},ae}();ne.Target=z},52279:function(yr,ne,N){"use strict";var ge=this&&this.__spreadArray||function(re,Ze){for(var Ke=0,nt=Ze.length,Tt=re.length;Ke<nt;Ke++,Tt++)re[Tt]=Ze[Ke];return re};Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolveInstance=void 0;var ee=N(16674),y=N(28421),ce=N(6867);function z(re,Ze,Ke){var nt=Ze.filter(function(Ct){return Ct.target!==null&&Ct.target.type===y.TargetTypeEnum.ClassProperty}),Tt=nt.map(Ke);return nt.forEach(function(Ct,Gt){var Jt="";Jt=Ct.target.name.value();var Zt=Tt[Gt];re[Jt]=Zt}),re}function ae(re,Ze){return new(re.bind.apply(re,ge([void 0],Ze)))}function te(re,Ze){if(Reflect.hasMetadata(ce.POST_CONSTRUCT,re)){var Ke=Reflect.getMetadata(ce.POST_CONSTRUCT,re);try{Ze[Ke.value]()}catch(nt){throw new Error(ee.POST_CONSTRUCT_ERROR(re.name,nt.message))}}}function Pe(re,Ze,Ke){var nt=null;if(Ze.length>0){var Tt=Ze.filter(function(Gt){return Gt.target!==null&&Gt.target.type===y.TargetTypeEnum.ConstructorArgument}),Ct=Tt.map(Ke);nt=ae(re,Ct),nt=z(nt,Ze,Ke)}else nt=new re;return te(re,nt),nt}ne.resolveInstance=Pe},31927:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolve=void 0;var ge=N(16674),ee=N(28421),y=N(85265),ce=N(55800),z=N(52279),ae=function(re,Ze,Ke){try{return Ke()}catch(nt){throw y.isStackOverflowExeption(nt)?new Error(ge.CIRCULAR_DEPENDENCY_IN_FACTORY(re,Ze.toString())):nt}},te=function(re){return function(Ze){Ze.parentContext.setCurrentRequest(Ze);var Ke=Ze.bindings,nt=Ze.childRequests,Tt=Ze.target&&Ze.target.isArray(),Ct=!Ze.parentRequest||!Ze.parentRequest.target||!Ze.target||!Ze.parentRequest.target.matchesArray(Ze.target.serviceIdentifier);if(Tt&&Ct)return nt.map(function(Lr){var mr=te(re);return mr(Lr)});var Gt=null;if(Ze.target.isOptional()&&Ke.length===0)return;var Jt=Ke[0],Zt=Jt.scope===ee.BindingScopeEnum.Singleton,wt=Jt.scope===ee.BindingScopeEnum.Request;if(Zt&&Jt.activated)return Jt.cache;if(wt&&re!==null&&re.has(Jt.id))return re.get(Jt.id);if(Jt.type===ee.BindingTypeEnum.ConstantValue)Gt=Jt.cache,Jt.activated=!0;else if(Jt.type===ee.BindingTypeEnum.Function)Gt=Jt.cache,Jt.activated=!0;else if(Jt.type===ee.BindingTypeEnum.Constructor)Gt=Jt.implementationType;else if(Jt.type===ee.BindingTypeEnum.DynamicValue&&Jt.dynamicValue!==null)Gt=ae("toDynamicValue",Jt.serviceIdentifier,function(){return Jt.dynamicValue(Ze.parentContext)});else if(Jt.type===ee.BindingTypeEnum.Factory&&Jt.factory!==null)Gt=ae("toFactory",Jt.serviceIdentifier,function(){return Jt.factory(Ze.parentContext)});else if(Jt.type===ee.BindingTypeEnum.Provider&&Jt.provider!==null)Gt=ae("toProvider",Jt.serviceIdentifier,function(){return Jt.provider(Ze.parentContext)});else if(Jt.type===ee.BindingTypeEnum.Instance&&Jt.implementationType!==null)Gt=z.resolveInstance(Jt.implementationType,nt,te(re));else{var xt=ce.getServiceIdentifierAsString(Ze.serviceIdentifier);throw new Error(ge.INVALID_BINDING_TYPE+" "+xt)}return typeof Jt.onActivation=="function"&&(Gt=Jt.onActivation(Ze.parentContext,Gt)),Zt&&(Jt.cache=Gt,Jt.activated=!0),wt&&re!==null&&!re.has(Jt.id)&&re.set(Jt.id,Gt),Gt}};function Pe(re){var Ze=te(re.plan.rootRequest.requestScope);return Ze(re.plan.rootRequest)}ne.resolve=Pe},83366:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInSyntax=void 0;var ge=N(28421),ee=N(71325),y=function(){function ce(z){this._binding=z}return ce.prototype.inRequestScope=function(){return this._binding.scope=ge.BindingScopeEnum.Request,new ee.BindingWhenOnSyntax(this._binding)},ce.prototype.inSingletonScope=function(){return this._binding.scope=ge.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},ce.prototype.inTransientScope=function(){return this._binding.scope=ge.BindingScopeEnum.Transient,new ee.BindingWhenOnSyntax(this._binding)},ce}();ne.BindingInSyntax=y},74889:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInWhenOnSyntax=void 0;var ge=N(83366),ee=N(51811),y=N(98370),ce=function(){function z(ae){this._binding=ae,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ee.BindingOnSyntax(this._binding),this._bindingInSyntax=new ge.BindingInSyntax(ae)}return z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},z.prototype.when=function(ae){return this._bindingWhenSyntax.when(ae)},z.prototype.whenTargetNamed=function(ae){return this._bindingWhenSyntax.whenTargetNamed(ae)},z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},z.prototype.whenTargetTagged=function(ae,te){return this._bindingWhenSyntax.whenTargetTagged(ae,te)},z.prototype.whenInjectedInto=function(ae){return this._bindingWhenSyntax.whenInjectedInto(ae)},z.prototype.whenParentNamed=function(ae){return this._bindingWhenSyntax.whenParentNamed(ae)},z.prototype.whenParentTagged=function(ae,te){return this._bindingWhenSyntax.whenParentTagged(ae,te)},z.prototype.whenAnyAncestorIs=function(ae){return this._bindingWhenSyntax.whenAnyAncestorIs(ae)},z.prototype.whenNoAncestorIs=function(ae){return this._bindingWhenSyntax.whenNoAncestorIs(ae)},z.prototype.whenAnyAncestorNamed=function(ae){return this._bindingWhenSyntax.whenAnyAncestorNamed(ae)},z.prototype.whenAnyAncestorTagged=function(ae,te){return this._bindingWhenSyntax.whenAnyAncestorTagged(ae,te)},z.prototype.whenNoAncestorNamed=function(ae){return this._bindingWhenSyntax.whenNoAncestorNamed(ae)},z.prototype.whenNoAncestorTagged=function(ae,te){return this._bindingWhenSyntax.whenNoAncestorTagged(ae,te)},z.prototype.whenAnyAncestorMatches=function(ae){return this._bindingWhenSyntax.whenAnyAncestorMatches(ae)},z.prototype.whenNoAncestorMatches=function(ae){return this._bindingWhenSyntax.whenNoAncestorMatches(ae)},z.prototype.onActivation=function(ae){return this._bindingOnSyntax.onActivation(ae)},z}();ne.BindingInWhenOnSyntax=ce},51811:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingOnSyntax=void 0;var ge=N(98370),ee=function(){function y(ce){this._binding=ce}return y.prototype.onActivation=function(ce){return this._binding.onActivation=ce,new ge.BindingWhenSyntax(this._binding)},y}();ne.BindingOnSyntax=ee},15451:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingToSyntax=void 0;var ge=N(16674),ee=N(28421),y=N(74889),ce=N(71325),z=function(){function ae(te){this._binding=te}return ae.prototype.to=function(te){return this._binding.type=ee.BindingTypeEnum.Instance,this._binding.implementationType=te,new y.BindingInWhenOnSyntax(this._binding)},ae.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ge.INVALID_TO_SELF_VALUE);var te=this._binding.serviceIdentifier;return this.to(te)},ae.prototype.toConstantValue=function(te){return this._binding.type=ee.BindingTypeEnum.ConstantValue,this._binding.cache=te,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ee.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ae.prototype.toDynamicValue=function(te){return this._binding.type=ee.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=te,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ae.prototype.toConstructor=function(te){return this._binding.type=ee.BindingTypeEnum.Constructor,this._binding.implementationType=te,this._binding.scope=ee.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ae.prototype.toFactory=function(te){return this._binding.type=ee.BindingTypeEnum.Factory,this._binding.factory=te,this._binding.scope=ee.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ae.prototype.toFunction=function(te){if(typeof te!="function")throw new Error(ge.INVALID_FUNCTION_BINDING);var Pe=this.toConstantValue(te);return this._binding.type=ee.BindingTypeEnum.Function,this._binding.scope=ee.BindingScopeEnum.Singleton,Pe},ae.prototype.toAutoFactory=function(te){return this._binding.type=ee.BindingTypeEnum.Factory,this._binding.factory=function(Pe){var re=function(){return Pe.container.get(te)};return re},this._binding.scope=ee.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ae.prototype.toProvider=function(te){return this._binding.type=ee.BindingTypeEnum.Provider,this._binding.provider=te,this._binding.scope=ee.BindingScopeEnum.Singleton,new ce.BindingWhenOnSyntax(this._binding)},ae.prototype.toService=function(te){this.toDynamicValue(function(Pe){return Pe.container.get(te)})},ae}();ne.BindingToSyntax=z},71325:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenOnSyntax=void 0;var ge=N(51811),ee=N(98370),y=function(){function ce(z){this._binding=z,this._bindingWhenSyntax=new ee.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ge.BindingOnSyntax(this._binding)}return ce.prototype.when=function(z){return this._bindingWhenSyntax.when(z)},ce.prototype.whenTargetNamed=function(z){return this._bindingWhenSyntax.whenTargetNamed(z)},ce.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ce.prototype.whenTargetTagged=function(z,ae){return this._bindingWhenSyntax.whenTargetTagged(z,ae)},ce.prototype.whenInjectedInto=function(z){return this._bindingWhenSyntax.whenInjectedInto(z)},ce.prototype.whenParentNamed=function(z){return this._bindingWhenSyntax.whenParentNamed(z)},ce.prototype.whenParentTagged=function(z,ae){return this._bindingWhenSyntax.whenParentTagged(z,ae)},ce.prototype.whenAnyAncestorIs=function(z){return this._bindingWhenSyntax.whenAnyAncestorIs(z)},ce.prototype.whenNoAncestorIs=function(z){return this._bindingWhenSyntax.whenNoAncestorIs(z)},ce.prototype.whenAnyAncestorNamed=function(z){return this._bindingWhenSyntax.whenAnyAncestorNamed(z)},ce.prototype.whenAnyAncestorTagged=function(z,ae){return this._bindingWhenSyntax.whenAnyAncestorTagged(z,ae)},ce.prototype.whenNoAncestorNamed=function(z){return this._bindingWhenSyntax.whenNoAncestorNamed(z)},ce.prototype.whenNoAncestorTagged=function(z,ae){return this._bindingWhenSyntax.whenNoAncestorTagged(z,ae)},ce.prototype.whenAnyAncestorMatches=function(z){return this._bindingWhenSyntax.whenAnyAncestorMatches(z)},ce.prototype.whenNoAncestorMatches=function(z){return this._bindingWhenSyntax.whenNoAncestorMatches(z)},ce.prototype.onActivation=function(z){return this._bindingOnSyntax.onActivation(z)},ce}();ne.BindingWhenOnSyntax=y},98370:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenSyntax=void 0;var ge=N(51811),ee=N(80758),y=function(){function ce(z){this._binding=z}return ce.prototype.when=function(z){return this._binding.constraint=z,new ge.BindingOnSyntax(this._binding)},ce.prototype.whenTargetNamed=function(z){return this._binding.constraint=ee.namedConstraint(z),new ge.BindingOnSyntax(this._binding)},ce.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(z){var ae=z.target!==null&&!z.target.isNamed()&&!z.target.isTagged();return ae},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenTargetTagged=function(z,ae){return this._binding.constraint=ee.taggedConstraint(z)(ae),new ge.BindingOnSyntax(this._binding)},ce.prototype.whenInjectedInto=function(z){return this._binding.constraint=function(ae){return ee.typeConstraint(z)(ae.parentRequest)},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenParentNamed=function(z){return this._binding.constraint=function(ae){return ee.namedConstraint(z)(ae.parentRequest)},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenParentTagged=function(z,ae){return this._binding.constraint=function(te){return ee.taggedConstraint(z)(ae)(te.parentRequest)},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorIs=function(z){return this._binding.constraint=function(ae){return ee.traverseAncerstors(ae,ee.typeConstraint(z))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorIs=function(z){return this._binding.constraint=function(ae){return!ee.traverseAncerstors(ae,ee.typeConstraint(z))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorNamed=function(z){return this._binding.constraint=function(ae){return ee.traverseAncerstors(ae,ee.namedConstraint(z))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorNamed=function(z){return this._binding.constraint=function(ae){return!ee.traverseAncerstors(ae,ee.namedConstraint(z))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorTagged=function(z,ae){return this._binding.constraint=function(te){return ee.traverseAncerstors(te,ee.taggedConstraint(z)(ae))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorTagged=function(z,ae){return this._binding.constraint=function(te){return!ee.traverseAncerstors(te,ee.taggedConstraint(z)(ae))},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenAnyAncestorMatches=function(z){return this._binding.constraint=function(ae){return ee.traverseAncerstors(ae,z)},new ge.BindingOnSyntax(this._binding)},ce.prototype.whenNoAncestorMatches=function(z){return this._binding.constraint=function(ae){return!ee.traverseAncerstors(ae,z)},new ge.BindingOnSyntax(this._binding)},ce}();ne.BindingWhenSyntax=y},80758:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.typeConstraint=ne.namedConstraint=ne.taggedConstraint=ne.traverseAncerstors=void 0;var ge=N(6867),ee=N(47738),y=function(te,Pe){var re=te.parentRequest;return re!==null?Pe(re)?!0:y(re,Pe):!1};ne.traverseAncerstors=y;var ce=function(te){return function(Pe){var re=function(Ze){return Ze!==null&&Ze.target!==null&&Ze.target.matchesTag(te)(Pe)};return re.metaData=new ee.Metadata(te,Pe),re}};ne.taggedConstraint=ce;var z=ce(ge.NAMED_TAG);ne.namedConstraint=z;var ae=function(te){return function(Pe){var re=null;if(Pe!==null)if(re=Pe.bindings[0],typeof te=="string"){var Ze=re.serviceIdentifier;return Ze===te}else{var Ke=Pe.bindings[0].implementationType;return te===Ke}return!1}};ne.typeConstraint=ae},70600:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiBindToService=void 0;var N=function(ge){return function(ee){return function(){for(var y=[],ce=0;ce<arguments.length;ce++)y[ce]=arguments[ce];return y.forEach(function(z){return ge.bind(z).toService(ee)})}}};ne.multiBindToService=N},85265:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.isStackOverflowExeption=void 0;var ge=N(16674);function ee(y){return y instanceof RangeError||y.message===ge.STACK_OVERFLOW}ne.isStackOverflowExeption=ee},37791:function(yr,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.id=void 0;var N=0;function ge(){return N++}ne.id=ge},55800:function(yr,ne,N){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.circularDependencyToException=ne.listMetadataForTarget=ne.listRegisteredBindingsForServiceIdentifier=ne.getServiceIdentifierAsString=ne.getFunctionName=void 0;var ge=N(16674);function ee(re){if(typeof re=="function"){var Ze=re;return Ze.name}else{if(typeof re=="symbol")return re.toString();var Ze=re;return Ze}}ne.getServiceIdentifierAsString=ee;function y(re,Ze,Ke){var nt="",Tt=Ke(re,Ze);return Tt.length!==0&&(nt=`
Registered bindings:`,Tt.forEach(function(Ct){var Gt="Object";Ct.implementationType!==null&&(Gt=Pe(Ct.implementationType)),nt=nt+`
 `+Gt,Ct.constraint.metaData&&(nt=nt+" - "+Ct.constraint.metaData)})),nt}ne.listRegisteredBindingsForServiceIdentifier=y;function ce(re,Ze){return re.parentRequest===null?!1:re.parentRequest.serviceIdentifier===Ze?!0:ce(re.parentRequest,Ze)}function z(re){function Ze(nt,Tt){Tt===void 0&&(Tt=[]);var Ct=ee(nt.serviceIdentifier);return Tt.push(Ct),nt.parentRequest!==null?Ze(nt.parentRequest,Tt):Tt}var Ke=Ze(re);return Ke.reverse().join(" --> ")}function ae(re){re.childRequests.forEach(function(Ze){if(ce(Ze,Ze.serviceIdentifier)){var Ke=z(Ze);throw new Error(ge.CIRCULAR_DEPENDENCY+" "+Ke)}else ae(Ze)})}ne.circularDependencyToException=ae;function te(re,Ze){if(Ze.isTagged()||Ze.isNamed()){var Ke="",nt=Ze.getNamedTag(),Tt=Ze.getCustomTags();return nt!==null&&(Ke+=nt.toString()+`
`),Tt!==null&&Tt.forEach(function(Ct){Ke+=Ct.toString()+`
`})," "+re+`
 `+re+" - "+Ke}else return" "+re}ne.listMetadataForTarget=te;function Pe(re){if(re.name)return re.name;var Ze=re.toString(),Ke=Ze.match(/^function\s*([^\s(]+)/);return Ke?Ke[1]:"Anonymous function: "+Ze}ne.getFunctionName=Pe},29750:function(yr){function ne(N,ge,ee){return N===N&&(ee!==void 0&&(N=N<=ee?N:ee),ge!==void 0&&(N=N>=ge?N:ge)),N}yr.exports=ne},74221:function(yr){function ne(N,ge,ee,y){for(var ce=ee-1,z=N.length;++ce<z;)if(y(N[ce],ge))return ce;return-1}yr.exports=ne},65464:function(yr,ne,N){var ge=N(29932),ee=N(42118),y=N(74221),ce=N(7518),z=N(278),ae=Array.prototype,te=ae.splice;function Pe(re,Ze,Ke,nt){var Tt=nt?y:ee,Ct=-1,Gt=Ze.length,Jt=re;for(re===Ze&&(Ze=z(Ze)),Ke&&(Jt=ge(re,ce(Ke)));++Ct<Gt;)for(var Zt=0,wt=Ze[Ct],xt=Ke?Ke(wt):wt;(Zt=Tt(Jt,xt,Zt,nt))>-1;)Jt!==re&&te.call(Jt,Zt,1),te.call(re,Zt,1);return re}yr.exports=Pe},18190:function(yr){var ne=9007199254740991,N=Math.floor;function ge(ee,y){var ce="";if(!ee||y<1||y>ne)return ce;do y%2&&(ce+=ee),y=N(y/2),y&&(ee+=ee);while(y);return ce}yr.exports=ge},78302:function(yr,ne,N){var ge=N(18190),ee=N(80531),y=N(40180),ce=N(62689),z=N(88016),ae=N(83140),te=Math.ceil;function Pe(re,Ze){Ze=Ze===void 0?" ":ee(Ze);var Ke=Ze.length;if(Ke<2)return Ke?ge(Ze,re):Ze;var nt=ge(Ze,te(re/z(Ze)));return ce(Ze)?y(ae(nt),0,re).join(""):nt.slice(0,re)}yr.exports=Pe},74691:function(yr,ne,N){var ge=N(29750),ee=N(14841);function y(ce,z,ae){return ae===void 0&&(ae=z,z=void 0),ae!==void 0&&(ae=ee(ae),ae=ae===ae?ae:0),z!==void 0&&(z=ee(z),z=z===z?z:0),ge(ee(ce),z,ae)}yr.exports=y},51584:function(yr,ne,N){var ge=N(44239),ee=N(37005),y="[object Boolean]";function ce(z){return z===!0||z===!1||ee(z)&&ge(z)==y}yr.exports=ce},60442:function(yr,ne,N){var ge=N(90939);function ee(y,ce){return ge(y,ce)}yr.exports=ee},14293:function(yr){function ne(N){return N==null}yr.exports=ne},81763:function(yr,ne,N){var ge=N(44239),ee=N(37005),y="[object Number]";function ce(z){return typeof z=="number"||ee(z)&&ge(z)==y}yr.exports=ce},30236:function(yr,ne,N){var ge=N(42980),ee=N(21463),y=ee(function(ce,z,ae,te){ge(ce,z,ae,te)});yr.exports=y},11726:function(yr,ne,N){var ge=N(78302),ee=N(88016),y=N(40554),ce=N(79833);function z(ae,te,Pe){ae=ce(ae),te=y(te);var re=te?ee(ae):0;return te&&re<te?ae+ge(te-re,Pe):ae}yr.exports=z},32475:function(yr,ne,N){var ge=N(78302),ee=N(88016),y=N(40554),ce=N(79833);function z(ae,te,Pe){ae=ce(ae),te=y(te);var re=te?ee(ae):0;return te&&re<te?ge(te-re,Pe)+ae:ae}yr.exports=z},97019:function(yr,ne,N){var ge=N(5976),ee=N(45604),y=ge(ee);yr.exports=y},45604:function(yr,ne,N){var ge=N(65464);function ee(y,ce){return y&&y.length&&ce&&ce.length?ge(y,ce):y}yr.exports=ee},23493:function(yr,ne,N){var ge=N(23279),ee=N(13218),y="Expected a function";function ce(z,ae,te){var Pe=!0,re=!0;if(typeof z!="function")throw new TypeError(y);return ee(te)&&(Pe="leading"in te?!!te.leading:Pe,re="trailing"in te?!!te.trailing:re),ge(z,ae,{leading:Pe,maxWait:ae,trailing:re})}yr.exports=ce},44908:function(yr,ne,N){var ge=N(45652);function ee(y){return y&&y.length?ge(y):[]}yr.exports=ee},6158:function(yr){(function(ne,N){yr.exports=N()})(this,function(){"use strict";var ne,N,ge;function ee(y,ce){if(!ne)ne=ce;else if(!N)N=ce;else{var z="var sharedChunk = {}; ("+ne+")(sharedChunk); ("+N+")(sharedChunk);",ae={};ne(ae),ge=ce(ae),typeof window!="undefined"&&(ge.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}return ee(["exports"],function(y){"use strict";function ce(o,u){return o(u={exports:{}},u.exports),u.exports}var z=ae;function ae(o,u,c,m){this.cx=3*o,this.bx=3*(c-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=c,this.p2y=m}ae.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},ae.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},ae.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},ae.prototype.solveCurveX=function(o,u){var c,m,x,E,T;for(u===void 0&&(u=1e-6),x=o,T=0;T<8;T++){if(E=this.sampleCurveX(x)-o,Math.abs(E)<u)return x;var M=this.sampleCurveDerivativeX(x);if(Math.abs(M)<1e-6)break;x-=E/M}if((x=o)<(c=0))return c;if(x>(m=1))return m;for(;c<m;){if(E=this.sampleCurveX(x),Math.abs(E-o)<u)return x;o>E?c=x:m=x,x=.5*(m-c)+c}return x},ae.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var te=Pe;function Pe(o,u){this.x=o,this.y=u}Pe.prototype={clone:function(){return new Pe(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,c=o.y-this.y;return u*u+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),c=Math.sin(o),m=c*this.x+u*this.y;return this.x=u*this.x-c*this.y,this.y=m,this},_rotateAround:function(o,u){var c=Math.cos(o),m=Math.sin(o),x=u.y+m*(this.x-u.x)+c*(this.y-u.y);return this.x=u.x+c*(this.x-u.x)-m*(this.y-u.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pe.convert=function(o){return o instanceof Pe?o:Array.isArray(o)?new Pe(o[0],o[1]):o};var re=typeof self!="undefined"?self:{},Ze=Math.pow(2,53)-1;function Ke(o,u,c,m){var x=new z(o,u,c,m);return function(E){return x.solve(E)}}var nt=Ke(.25,.1,.25,1);function Tt(o,u,c){return Math.min(c,Math.max(u,o))}function Ct(o,u,c){var m=c-u,x=((o-u)%m+m)%m+u;return x===u?c:x}function Gt(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}var Jt=1;function Zt(){return Jt++}function wt(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function xt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Lr(o,u){o.forEach(function(c){u[c]&&(u[c]=u[c].bind(u))})}function mr(o,u){return o.indexOf(u,o.length-u.length)!==-1}function hr(o,u,c){var m={};for(var x in o)m[x]=u.call(c||this,o[x],x,o);return m}function Et(o,u,c){var m={};for(var x in o)u.call(c||this,o[x],x,o)&&(m[x]=o[x]);return m}function lt(o){return Array.isArray(o)?o.map(lt):typeof o=="object"&&o?hr(o,lt):o}var Ut={};function vt(o){Ut[o]||(typeof console!="undefined"&&console.warn(o),Ut[o]=!0)}function er(o,u,c){return(c.y-o.y)*(u.x-o.x)>(u.y-o.y)*(c.x-o.x)}function xr(o){for(var u=0,c=0,m=o.length,x=m-1,E=void 0,T=void 0;c<m;x=c++)u+=((T=o[x]).x-(E=o[c]).x)*(E.y+T.y);return u}function q(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function De(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,x,E,T){var M=E||T;return u[x]=!M||M.toLowerCase(),""}),u["max-age"]){var c=parseInt(u["max-age"],10);isNaN(c)?delete u["max-age"]:u["max-age"]=c}return u}var F=null;function Me(o){if(F==null){var u=o.navigator?o.navigator.userAgent:null;F=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return F}function Te(o){try{var u=re[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var ht,bt,St,qt,or=re.performance&&re.performance.now?re.performance.now.bind(re.performance):Date.now.bind(Date),rn=re.requestAnimationFrame||re.mozRequestAnimationFrame||re.webkitRequestAnimationFrame||re.msRequestAnimationFrame,Or=re.cancelAnimationFrame||re.mozCancelAnimationFrame||re.webkitCancelAnimationFrame||re.msCancelAnimationFrame,Kn={now:or,frame:function(o){var u=rn(o);return{cancel:function(){return Or(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var c=re.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=o.width,c.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return ht||(ht=re.document.createElement("a")),ht.href=o,ht.href},hardwareConcurrency:re.navigator&&re.navigator.hardwareConcurrency||4,get devicePixelRatio(){return re.devicePixelRatio},get prefersReducedMotion(){return!!re.matchMedia&&(bt==null&&(bt=re.matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)}},on={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Pn={supported:!1,testSupport:function(o){!mi&&qt&&(ei?xn(o):St=o)}},mi=!1,ei=!1;function xn(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,qt),o.isContextLost())return;Pn.supported=!0}catch(c){}o.deleteTexture(u),mi=!0}re.document&&((qt=re.document.createElement("img")).onload=function(){St&&xn(St),St=null,ei=!0},qt.onerror=function(){mi=!0,St=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Fi="01",zi=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function Li(o){return o.indexOf("mapbox:")===0}zi.prototype._createSkuToken=function(){var o=function(){for(var u="",c=0;c<10;c++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fi,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},zi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},zi.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},zi.prototype.normalizeStyleURL=function(o,u){if(!Li(o))return o;var c=sa(o);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},zi.prototype.normalizeGlyphsURL=function(o,u){if(!Li(o))return o;var c=sa(o);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},zi.prototype.normalizeSourceURL=function(o,u){if(!Li(o))return o;var c=sa(o);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||u)},zi.prototype.normalizeSpriteURL=function(o,u,c,m){var x=sa(o);return Li(o)?(x.path="/styles/v1"+x.path+"/sprite"+u+c,this._makeAPIURL(x,this._customAccessToken||m)):(x.path+=""+u+c,ao(x))},zi.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Li(o))return o;var c=sa(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Kn.devicePixelRatio>=2||u===512?"@2x":"")+(Pn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(x){for(var E=0,T=x;E<T.length;E+=1){var M=T[E].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||on.ACCESS_TOKEN;return on.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},zi.prototype.canonicalizeTileURL=function(o,u){var c=sa(o);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var x=c.params;return u&&(x=x.filter(function(E){return!E.match(/^access_token=/)})),x.length&&(m+="?"+x.join("&")),m},zi.prototype.canonicalizeTileset=function(o,u){for(var c=!!u&&Li(u),m=[],x=0,E=o.tiles||[];x<E.length;x+=1){var T=E[x];Ln(T)?m.push(this.canonicalizeTileURL(T,c)):m.push(T)}return m},zi.prototype._makeAPIURL=function(o,u){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=sa(on.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var x=o.params.indexOf("secure");x>=0&&o.params.splice(x,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!on.REQUIRE_ACCESS_TOKEN)return ao(o);if(!(u=u||on.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),ao(o)};var Qn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ln(o){return Qn.test(o)}var Fo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function sa(o){var u=o.match(Fo);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function ao(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function Pt(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(re.atob(u[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var k=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};k.prototype.getStorageKey=function(o){var u,c=Pt(on.ACCESS_TOKEN);return u=c&&c.u?re.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,x){return String.fromCharCode(Number("0x"+x))})):on.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},k.prototype.fetchEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{var m=re.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var x=re.localStorage.getItem(c);x&&(this.anonId=x)}catch(E){vt("Unable to read from LocalStorage")}},k.prototype.saveEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{re.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&re.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){vt("Unable to write to LocalStorage")}},k.prototype.processRequests=function(o){},k.prototype.postEvent=function(o,u,c,m){var x=this;if(on.EVENTS_URL){var E=sa(on.EVENTS_URL);E.params.push("access_token="+(m||on.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Fi,userId:this.anonId},M=u?Gt(T,u):T,D={url:ao(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=wi(D,function(U){x.pendingRequest=null,c(U),x.saveEventData(),x.processRequests(m)})}},k.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var se,de,je=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(c,m,x,E){this.skuToken=x;var T=!(!E&&!on.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(D){return Li(D)||Ln(D)});on.EVENTS_URL&&T&&M&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),E=x.id,T=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),xt(this.anonId)||(this.anonId=wt()),this.postEvent(T,{skuToken:this.skuToken},function(M){M||E&&(m.success[E]=!0)},c))}},u}(k),mt=new(function(o){function u(c){o.call(this,"appUserTurnstile"),this._customAccessToken=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(c,m){on.EVENTS_URL&&on.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(x){return Li(x)||Ln(x)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Pt(on.ACCESS_TOKEN),E=x?x.u:on.ACCESS_TOKEN,T=E!==this.eventData.tokenU;xt(this.anonId)||(this.anonId=wt(),T=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),U=new Date(M),H=(M-this.eventData.lastSuccess)/864e5;T=T||H>=1||H<-1||D.getDate()!==U.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(X){X||(m.eventData.lastSuccess=M,m.eventData.tokenU=E)},c)}},u}(k)),Kt=mt.postTurnstileEvent.bind(mt),Ar=new je,Xe=Ar.postMapLoadEvent.bind(Ar),Mt=500,sr=50;function dr(){re.caches&&!se&&(se=re.caches.open("mapbox-tiles"))}function Gr(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Nn,On=1/0;function An(){return Nn==null&&(Nn=re.OffscreenCanvas&&new re.OffscreenCanvas(1,1).getContext("2d")&&typeof re.createImageBitmap=="function"),Nn}var Tn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Tn);var fi=function(o){function u(c,m,x){m===401&&Ln(x)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,c),this.status=m,this.url=x,this.name=this.constructor.name,this.message=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),ni=q()?function(){return self.worker&&self.worker.referrer}:function(){return(re.location.protocol==="blob:"?re.parent:re).location.href},ta,ra,Zo=function(o,u){if(!(/^file:/.test(c=o.url)||/^file:/.test(ni())&&!/^\w+:/.test(c))){if(re.fetch&&re.Request&&re.AbortController&&re.Request.prototype.hasOwnProperty("signal"))return function(m,x){var E,T=new re.AbortController,M=new re.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ni(),signal:T.signal}),D=!1,U=!1,H=(E=M.url).indexOf("sku=")>0&&Ln(E);m.type==="json"&&M.headers.set("Accept","application/json");var X=function(he,Fe,Le){if(!U){if(he&&he.message!=="SecurityError"&&vt(he),Fe&&Le)return ie(Fe);var at=Date.now();re.fetch(M).then(function(Ge){if(Ge.ok){var yt=H?Ge.clone():null;return ie(Ge,yt,at)}return x(new fi(Ge.statusText,Ge.status,m.url))}).catch(function(Ge){Ge.code!==20&&x(new Error(Ge.message))})}},ie=function(he,Fe,Le){(m.type==="arrayBuffer"?he.arrayBuffer():m.type==="json"?he.json():he.text()).then(function(at){U||(Fe&&Le&&function(Ge,yt,Dt){if(dr(),se){var kt={status:yt.status,statusText:yt.statusText,headers:new re.Headers};yt.headers.forEach(function(fr,Br){return kt.headers.set(Br,fr)});var Qt=De(yt.headers.get("Cache-Control")||"");Qt["no-store"]||(Qt["max-age"]&&kt.headers.set("Expires",new Date(Dt+1e3*Qt["max-age"]).toUTCString()),new Date(kt.headers.get("Expires")).getTime()-Dt<42e4||function(fr,Br){if(de===void 0)try{new Response(new ReadableStream),de=!0}catch($r){de=!1}de?Br(fr.body):fr.blob().then(Br)}(yt,function(fr){var Br=new re.Response(fr,kt);dr(),se&&se.then(function($r){return $r.put(Gr(Ge.url),Br)}).catch(function($r){return vt($r.message)})}))}}(M,Fe,Le),D=!0,x(null,at,he.headers.get("Cache-Control"),he.headers.get("Expires")))}).catch(function(at){U||x(new Error(at.message))})};return H?function(he,Fe){if(dr(),!se)return Fe(null);var Le=Gr(he.url);se.then(function(at){at.match(Le).then(function(Ge){var yt=function(Dt){if(!Dt)return!1;var kt=new Date(Dt.headers.get("Expires")||0),Qt=De(Dt.headers.get("Cache-Control")||"");return kt>Date.now()&&!Qt["no-cache"]}(Ge);at.delete(Le),yt&&at.put(Le,Ge.clone()),Fe(null,Ge,yt)}).catch(Fe)}).catch(Fe)}(M,X):X(null,null),{cancel:function(){U=!0,D||T.abort()}}}(o,u);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var c;return function(m,x){var E=new re.XMLHttpRequest;for(var T in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){x(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var M=E.response;if(m.type==="json")try{M=JSON.parse(E.response)}catch(D){return x(D)}x(null,M,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else x(new fi(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},Ts=function(o,u){return Zo(Gt(o,{type:"arrayBuffer"}),u)},wi=function(o,u){return Zo(Gt(o,{method:"POST"}),u)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ta=[],ra=0;var J=function(o,u){if(Pn.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ra>=on.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return ta.push(c),c}ra++;var m=!1,x=function(){if(!m)for(m=!0,ra--;ta.length&&ra<on.MAX_PARALLEL_IMAGE_REQUESTS;){var T=ta.shift();T.cancelled||(T.cancel=J(T.requestParameters,T.callback).cancel)}},E=Ts(o,function(T,M,D,U){x(),T?u(T):M&&(An()?function(H,X){var ie=new re.Blob([new Uint8Array(H)],{type:"image/png"});re.createImageBitmap(ie).then(function(he){X(null,he)}).catch(function(he){X(new Error("Could not load image because of "+he.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,u):function(H,X,ie,he){var Fe=new re.Image,Le=re.URL;Fe.onload=function(){X(null,Fe),Le.revokeObjectURL(Fe.src),Fe.onload=null,re.requestAnimationFrame(function(){Fe.src=G})},Fe.onerror=function(){return X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var at=new re.Blob([new Uint8Array(H)],{type:"image/png"});Fe.cacheControl=ie,Fe.expires=he,Fe.src=H.byteLength?Le.createObjectURL(at):G}(M,u,D,U))});return{cancel:function(){E.cancel(),x()}}};function ue(o,u,c){c[o]&&c[o].indexOf(u)!==-1||(c[o]=c[o]||[],c[o].push(u))}function be(o,u,c){if(c&&c[o]){var m=c[o].indexOf(u);m!==-1&&c[o].splice(m,1)}}var ke=function(o,u){u===void 0&&(u={}),Gt(this,u),this.type=o},it=function(o){function u(c,m){m===void 0&&(m={}),o.call(this,"error",Gt({error:c},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(ke),ct=function(){};ct.prototype.on=function(o,u){return this._listeners=this._listeners||{},ue(o,u,this._listeners),this},ct.prototype.off=function(o,u){return be(o,u,this._listeners),be(o,u,this._oneTimeListeners),this},ct.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},ue(o,u,this._oneTimeListeners),this},ct.prototype.fire=function(o,u){typeof o=="string"&&(o=new ke(o,u||{}));var c=o.type;if(this.listens(c)){o.target=this;for(var m=0,x=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<x.length;m+=1)x[m].call(this,o);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];E<T.length;E+=1){var M=T[E];be(c,M,this._oneTimeListeners),M.call(this,o)}var D=this._eventedParent;D&&(Gt(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(o))}else o instanceof it&&console.error(o.error);return this},ct.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},ct.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Y=function(o,u,c,m){this.message=(o?o+": ":"")+c,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function ye(o){var u=o.value;return u?[new Y(o.key,u,"constants have been deprecated as of v8")]:[]}function tt(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var T in E)o[T]=E[T]}return o}function gt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function le(o){if(Array.isArray(o))return o.map(le);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var c in o)u[c]=le(o[c]);return u}return gt(o)}var br=function(o){function u(c,m){o.call(this,m),this.message=m,this.key=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),En=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var c=0,m=u;c<m.length;c+=1){var x=m[c];this.bindings[x[0]]=x[1]}};En.prototype.concat=function(o){return new En(this,o)},En.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},En.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var vn={kind:"null"},rr={kind:"number"},nn={kind:"string"},Hr={kind:"boolean"},Yr={kind:"color"},gi={kind:"object"},Jr={kind:"value"},xi={kind:"collator"},Gi={kind:"formatted"},_i={kind:"resolvedImage"};function Ci(o,u){return{kind:"array",itemType:o,N:u}}function Ri(o){if(o.kind==="array"){var u=Ri(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var go=[vn,rr,nn,Hr,Yr,Gi,gi,Ci(Jr),_i];function Ji(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Ji(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var c=0,m=go;c<m.length;c+=1)if(!Ji(m[c],u))return null}}return"Expected "+Ri(o)+" but found "+Ri(u)+" instead."}function Sa(o,u){return u.some(function(c){return c.kind===o.kind})}function Mi(o,u){return u.some(function(c){return c==="null"?o===null:c==="array"?Array.isArray(o):c==="object"?o&&!Array.isArray(o)&&typeof o=="object":c===typeof o})}var yi=ce(function(o,u){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function x(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function E(M){return(D=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:D>1?1:D;var D}function T(M,D,U){return U<0?U+=1:U>1&&(U-=1),6*U<1?M+(D-M)*U*6:2*U<1?D:3*U<2?M+(D-M)*(2/3-U)*6:M}try{u.parseCSSColor=function(M){var D,U=M.replace(/ /g,"").toLowerCase();if(U in c)return c[U].slice();if(U[0]==="#")return U.length===4?(D=parseInt(U.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:U.length===7&&(D=parseInt(U.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var H=U.indexOf("("),X=U.indexOf(")");if(H!==-1&&X+1===U.length){var ie=U.substr(0,H),he=U.substr(H+1,X-(H+1)).split(","),Fe=1;switch(ie){case"rgba":if(he.length!==4)return null;Fe=E(he.pop());case"rgb":return he.length!==3?null:[x(he[0]),x(he[1]),x(he[2]),Fe];case"hsla":if(he.length!==4)return null;Fe=E(he.pop());case"hsl":if(he.length!==3)return null;var Le=(parseFloat(he[0])%360+360)%360/360,at=E(he[1]),Ge=E(he[2]),yt=Ge<=.5?Ge*(at+1):Ge+at-Ge*at,Dt=2*Ge-yt;return[m(255*T(Dt,yt,Le+1/3)),m(255*T(Dt,yt,Le)),m(255*T(Dt,yt,Le-1/3)),Fe];default:return null}}return null}}catch(M){}}).parseCSSColor,Ai=function(o,u,c,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=c,this.a=m};Ai.parse=function(o){if(o){if(o instanceof Ai)return o;if(typeof o=="string"){var u=yi(o);if(u)return new Ai(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ai.prototype.toString=function(){var o=this.toArray(),u=o[1],c=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(c)+","+m+")"},Ai.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ai.black=new Ai(0,0,0,1),Ai.white=new Ai(1,1,1,1),Ai.transparent=new Ai(0,0,0,0),Ai.red=new Ai(1,0,0,1);var Ca=function(o,u,c){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ca.prototype.compare=function(o,u){return this.collator.compare(o,u)},Ca.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Vs=function(o,u,c,m,x){this.text=o,this.image=u,this.scale=c,this.fontStack=m,this.textColor=x},va=function(o){this.sections=o};va.fromString=function(o){return new va([new Vs(o,null,null,null,null)])},va.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},va.factory=function(o){return o instanceof va?o:va.fromString(o)},va.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},va.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var x={};m.fontStack&&(x["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(x["font-scale"]=m.scale),m.textColor&&(x["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(x)}}return o};var Ra=function(o){this.name=o.name,this.available=o.available};function Yu(o,u,c,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,c,m]:[o,u,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function nu(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ai||o instanceof Ca||o instanceof va||o instanceof Ra)return!0;if(Array.isArray(o)){for(var u=0,c=o;u<c.length;u+=1)if(!nu(c[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!nu(o[m]))return!1;return!0}return!1}function xa(o){if(o===null)return vn;if(typeof o=="string")return nn;if(typeof o=="boolean")return Hr;if(typeof o=="number")return rr;if(o instanceof Ai)return Yr;if(o instanceof Ca)return xi;if(o instanceof va)return Gi;if(o instanceof Ra)return _i;if(Array.isArray(o)){for(var u,c=o.length,m=0,x=o;m<x.length;m+=1){var E=xa(x[m]);if(u){if(u===E)continue;u=Jr;break}u=E}return Ci(u||Jr,c)}return gi}function as(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ai||o instanceof va||o instanceof Ra?o.toString():JSON.stringify(o)}Ra.prototype.toString=function(){return this.name},Ra.fromString=function(o){return o?new Ra({name:o,available:!1}):null},Ra.prototype.serialize=function(){return["image",this.name]};var ii=function(o,u){this.type=o,this.value=u};ii.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!nu(o[1]))return u.error("invalid value");var c=o[1],m=xa(c),x=u.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new ii(m,c)},ii.prototype.evaluate=function(){return this.value},ii.prototype.eachChild=function(){},ii.prototype.outputDefined=function(){return!0},ii.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ai?["rgba"].concat(this.value.toArray()):this.value instanceof va?this.value.serialize():this.value};var ua=function(o){this.name="ExpressionEvaluationError",this.message=o};ua.prototype.toJSON=function(){return this.message};var Ma={string:nn,number:rr,boolean:Hr,object:gi},na=function(o,u){this.type=o,this.args=u};na.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c,m=1,x=o[0];if(x==="array"){var E,T;if(o.length>2){var M=o[1];if(typeof M!="string"||!(M in Ma)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ma[M],m++}else E=Jr;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}c=Ci(E,T)}else c=Ma[x];for(var D=[];m<o.length;m++){var U=u.parse(o[m],m,Jr);if(!U)return null;D.push(U)}return new na(c,D)},na.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var c=this.args[u].evaluate(o);if(!Ji(this.type,xa(c)))return c;if(u===this.args.length-1)throw new ua("Expected value to be of type "+Ri(this.type)+", but found "+Ri(xa(c))+" instead.")}return null},na.prototype.eachChild=function(o){this.args.forEach(o)},na.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},na.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var c=o.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){u.push(c.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(x){return x.serialize()}))};var Yo=function(o){this.type=Gi,this.sections=o};Yo.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[1];if(!Array.isArray(c)&&typeof c=="object")return u.error("First argument must be an image or text section.");for(var m=[],x=!1,E=1;E<=o.length-1;++E){var T=o[E];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var M=null;if(T["font-scale"]&&!(M=u.parse(T["font-scale"],1,rr)))return null;var D=null;if(T["text-font"]&&!(D=u.parse(T["text-font"],1,Ci(nn))))return null;var U=null;if(T["text-color"]&&!(U=u.parse(T["text-color"],1,Yr)))return null;var H=m[m.length-1];H.scale=M,H.font=D,H.textColor=U}else{var X=u.parse(o[E],1,Jr);if(!X)return null;var ie=X.type.kind;if(ie!=="string"&&ie!=="value"&&ie!=="null"&&ie!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:X,scale:null,font:null,textColor:null})}}return new Yo(m)},Yo.prototype.evaluate=function(o){return new va(this.sections.map(function(u){var c=u.content.evaluate(o);return xa(c)===_i?new Vs("",c,null,null,null):new Vs(as(c),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},Yo.prototype.eachChild=function(o){for(var u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o.push(m.content.serialize());var x={};m.scale&&(x["font-scale"]=m.scale.serialize()),m.font&&(x["text-font"]=m.font.serialize()),m.textColor&&(x["text-color"]=m.textColor.serialize()),o.push(x)}return o};var Vo=function(o){this.type=_i,this.input=o};Vo.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var c=u.parse(o[1],1,nn);return c?new Vo(c):u.error("No image name provided.")},Vo.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=Ra.fromString(u);return c&&o.availableImages&&(c.available=o.availableImages.indexOf(u)>-1),c},Vo.prototype.eachChild=function(o){o(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["image",this.input.serialize()]};var Du={"to-boolean":Hr,"to-color":Yr,"to-number":rr,"to-string":nn},ws=function(o,u){this.type=o,this.args=u};ws.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[0];if((c==="to-boolean"||c==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Du[c],x=[],E=1;E<o.length;E++){var T=u.parse(o[E],E,Jr);if(!T)return null;x.push(T)}return new ws(m,x)},ws.prototype.evaluate=function(o){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(o));if(this.type.kind==="color"){for(var u,c,m=0,x=this.args;m<x.length;m+=1){if(c=null,(u=x[m].evaluate(o))instanceof Ai)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(c=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Yu(u[0],u[1],u[2],u[3])))return new Ai(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new ua(c||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,M=0,D=this.args;M<D.length;M+=1){if((T=D[M].evaluate(o))===null)return 0;var U=Number(T);if(!isNaN(U))return U}throw new ua("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?va.fromString(as(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?Ra.fromString(as(this.args[0].evaluate(o))):as(this.args[0].evaluate(o))},ws.prototype.eachChild=function(o){this.args.forEach(o)},ws.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},ws.prototype.serialize=function(){if(this.type.kind==="formatted")return new Yo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var fc=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?fc[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ai.parse(o)),u};var ji=function(o,u,c,m){this.name=o,this.type=u,this._evaluate=c,this.args=m};ji.prototype.evaluate=function(o){return this._evaluate(o,this.args)},ji.prototype.eachChild=function(o){this.args.forEach(o)},ji.prototype.outputDefined=function(){return!1},ji.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},ji.parse=function(o,u){var c,m=o[0],x=ji.definitions[m];if(!x)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,M=T.filter(function(Hn){var pn=Hn[0];return!Array.isArray(pn)||pn.length===o.length-1}),D=null,U=0,H=M;U<H.length;U+=1){var X=H[U],ie=X[0],he=X[1];D=new qu(u.registry,u.path,null,u.scope);for(var Fe=[],Le=!1,at=1;at<o.length;at++){var Ge=o[at],yt=Array.isArray(ie)?ie[at-1]:ie.type,Dt=D.parse(Ge,1+Fe.length,yt);if(!Dt){Le=!0;break}Fe.push(Dt)}if(!Le)if(Array.isArray(ie)&&ie.length!==Fe.length)D.error("Expected "+ie.length+" arguments, but found "+Fe.length+" instead.");else{for(var kt=0;kt<Fe.length;kt++){var Qt=Array.isArray(ie)?ie[kt]:ie.type,fr=Fe[kt];D.concat(kt+1).checkSubtype(Qt,fr.type)}if(D.errors.length===0)return new ji(m,E,he,Fe)}}if(M.length===1)(c=u.errors).push.apply(c,D.errors);else{for(var Br=(M.length?M:T).map(function(Hn){var pn;return pn=Hn[0],Array.isArray(pn)?"("+pn.map(Ri).join(", ")+")":"("+Ri(pn.type)+"...)"}).join(" | "),$r=[],zn=1;zn<o.length;zn++){var hn=u.parse(o[zn],1+$r.length);if(!hn)return null;$r.push(Ri(hn.type))}u.error("Expected arguments of type "+Br+", but found ("+$r.join(", ")+") instead.")}return null},ji.register=function(o,u){for(var c in ji.definitions=u,u)o[c]=ji};var jo=function(o,u,c){this.type=xi,this.locale=c,this.caseSensitive=o,this.diacriticSensitive=u};function Wt(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function K(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function Re(o,u){var c=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,x=Math.pow(2,u.z);return[Math.round(c*x*8192),Math.round(m*x*8192)]}function st(o,u,c){return u[1]>o[1]!=c[1]>o[1]&&o[0]<(c[0]-u[0])*(o[1]-u[1])/(c[1]-u[1])+u[0]}function nr(o,u){for(var c,m,x,E,T,M,D,U=!1,H=0,X=u.length;H<X;H++)for(var ie=u[H],he=0,Fe=ie.length;he<Fe-1;he++){if((E=(c=o)[0]-(m=ie[he])[0])*(D=c[1]-(x=ie[he+1])[1])-(M=c[0]-x[0])*(T=c[1]-m[1])==0&&E*M<=0&&T*D<=0)return!1;st(o,ie[he],ie[he+1])&&(U=!U)}return U}function Wr(o,u){for(var c=0;c<u.length;c++)if(nr(o,u[c]))return!0;return!1}function Dn(o,u,c,m){var x=m[0]-c[0],E=m[1]-c[1],T=(o[0]-c[0])*E-x*(o[1]-c[1]),M=(u[0]-c[0])*E-x*(u[1]-c[1]);return T>0&&M<0||T<0&&M>0}function Hi(o,u,c){for(var m=0,x=c;m<x.length;m+=1)for(var E=x[m],T=0;T<E.length-1;++T)if((X=[(H=E[T+1])[0]-(U=E[T])[0],H[1]-U[1]])[0]*(ie=[(D=u)[0]-(M=o)[0],D[1]-M[1]])[1]-X[1]*ie[0]!=0&&Dn(M,D,U,H)&&Dn(U,H,M,D))return!0;var M,D,U,H,X,ie;return!1}function oo(o,u){for(var c=0;c<o.length;++c)if(!nr(o[c],u))return!1;for(var m=0;m<o.length-1;++m)if(Hi(o[m],o[m+1],u))return!1;return!0}function _o(o,u){for(var c=0;c<u.length;c++)if(oo(o,u[c]))return!0;return!1}function to(o,u,c){for(var m=[],x=0;x<o.length;x++){for(var E=[],T=0;T<o[x].length;T++){var M=Re(o[x][T],c);Wt(u,M),E.push(M)}m.push(E)}return m}function Cs(o,u,c){for(var m=[],x=0;x<o.length;x++){var E=to(o[x],u,c);m.push(E)}return m}function Uc(o,u,c,m){if(o[0]<c[0]||o[0]>c[2]){var x=.5*m,E=o[0]-c[0]>x?-m:c[0]-o[0]>x?m:0;E===0&&(E=o[0]-c[2]>x?-m:c[2]-o[0]>x?m:0),o[0]+=E}Wt(u,o)}function iu(o,u,c,m){for(var x=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],T=[],M=0,D=o;M<D.length;M+=1)for(var U=0,H=D[M];U<H.length;U+=1){var X=H[U],ie=[X.x+E[0],X.y+E[1]];Uc(ie,u,c,x),T.push(ie)}return T}function mf(o,u,c,m){for(var x,E=8192*Math.pow(2,m.z),T=[8192*m.x,8192*m.y],M=[],D=0,U=o;D<U.length;D+=1){for(var H=[],X=0,ie=U[D];X<ie.length;X+=1){var he=ie[X],Fe=[he.x+T[0],he.y+T[1]];Wt(u,Fe),H.push(Fe)}M.push(H)}if(u[2]-u[0]<=E/2){(x=u)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var Le=0,at=M;Le<at.length;Le+=1)for(var Ge=0,yt=at[Le];Ge<yt.length;Ge+=1)Uc(yt[Ge],u,c,E)}return M}jo.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var c=o[1];if(typeof c!="object"||Array.isArray(c))return u.error("Collator options argument must be an object.");var m=u.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Hr);if(!m)return null;var x=u.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Hr);if(!x)return null;var E=null;return c.locale&&!(E=u.parse(c.locale,1,nn))?null:new jo(m,x,E)},jo.prototype.evaluate=function(o){return new Ca(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},jo.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Ho=function(o,u){this.type=Hr,this.geojson=o,this.geometries=u};function yl(o){if(o instanceof ji&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ho)return!1;var u=!0;return o.eachChild(function(c){u&&!yl(c)&&(u=!1)}),u}function xl(o){if(o instanceof ji&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(c){u&&!xl(c)&&(u=!1)}),u}function Fu(o,u){if(o instanceof ji&&u.indexOf(o.name)>=0)return!1;var c=!0;return o.eachChild(function(m){c&&!Fu(m,u)&&(c=!1)}),c}Ho.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(nu(o[1])){var c=o[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var x=c.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Ho(c,c.features[m].geometry)}else if(c.type==="Feature"){var E=c.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Ho(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ho(c,c)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ho.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=to(c.coordinates,x,E),M=iu(u.geometry(),m,x,E);if(!K(m,x))return!1;for(var D=0,U=M;D<U.length;D+=1)if(!nr(U[D],T))return!1}if(c.type==="MultiPolygon"){var H=Cs(c.coordinates,x,E),X=iu(u.geometry(),m,x,E);if(!K(m,x))return!1;for(var ie=0,he=X;ie<he.length;ie+=1)if(!Wr(he[ie],H))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var T=to(c.coordinates,x,E),M=mf(u.geometry(),m,x,E);if(!K(m,x))return!1;for(var D=0,U=M;D<U.length;D+=1)if(!oo(U[D],T))return!1}if(c.type==="MultiPolygon"){var H=Cs(c.coordinates,x,E),X=mf(u.geometry(),m,x,E);if(!K(m,x))return!1;for(var ie=0,he=X;ie<he.length;ie+=1)if(!_o(he[ie],H))return!1}return!0}(o,this.geometries)}return!1},Ho.prototype.eachChild=function(){},Ho.prototype.outputDefined=function(){return!0},Ho.prototype.serialize=function(){return["within",this.geojson]};var ku=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};ku.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var c=o[1];return u.scope.has(c)?new ku(c,u.scope.get(c)):u.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},ku.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},ku.prototype.eachChild=function(){},ku.prototype.outputDefined=function(){return!1},ku.prototype.serialize=function(){return["var",this.name]};var qu=function(o,u,c,m,x){u===void 0&&(u=[]),m===void 0&&(m=new En),x===void 0&&(x=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=x,this.expectedType=c};function zc(o,u){for(var c,m=o.length-1,x=0,E=m,T=0;x<=E;)if((c=o[T=Math.floor((x+E)/2)])<=u){if(T===m||u<o[T+1])return T;x=T+1}else{if(!(c>u))throw new ua("Input is not a number.");E=T-1}return 0}qu.prototype.parse=function(o,u,c,m,x){return x===void 0&&(x={}),u?this.concat(u,c,m)._parse(o,x):this._parse(o,x)},qu.prototype._parse=function(o,u){function c(U,H,X){return X==="assert"?new na(H,[U]):X==="coerce"?new ws(H,[U]):U}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[m];if(x){var E=x.parse(o,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,M=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else E=c(E,T,u.typeAnnotation||"coerce");else E=c(E,T,u.typeAnnotation||"assert")}if(!(E instanceof ii)&&E.type.kind!=="resolvedImage"&&function U(H){if(H instanceof ku)return U(H.boundExpression);if(H instanceof ji&&H.name==="error"||H instanceof jo||H instanceof Ho)return!1;var X=H instanceof ws||H instanceof na,ie=!0;return H.eachChild(function(he){ie=X?ie&&U(he):ie&&he instanceof ii}),!!ie&&yl(H)&&Fu(H,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var D=new Da;try{E=new ii(E.type,E.evaluate(D))}catch(U){return this.error(U.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},qu.prototype.concat=function(o,u,c){var m=typeof o=="number"?this.path.concat(o):this.path,x=c?this.scope.concat(c):this.scope;return new qu(this.registry,m,u||null,x,this.errors)},qu.prototype.error=function(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];var m=""+this.key+u.map(function(x){return"["+x+"]"}).join("");this.errors.push(new br(m,o))},qu.prototype.checkSubtype=function(o,u){var c=Ji(o,u);return c&&this.error(c),c};var Rs=function(o,u,c){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,x=c;m<x.length;m+=1){var E=x[m],T=E[1];this.labels.push(E[0]),this.outputs.push(T)}};function Za(o,u,c){return o*(1-c)+u*c}Rs.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var c=u.parse(o[1],1,rr);if(!c)return null;var m=[],x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E=1;E<o.length;E+=2){var T=E===1?-1/0:o[E],M=o[E+1],D=E,U=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var H=u.parse(M,U,x);if(!H)return null;x=x||H.type,m.push([T,H])}return new Rs(x,c,m)},Rs.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var x=u.length;return m>=u[x-1]?c[x-1].evaluate(o):c[zc(u,m)].evaluate(o)},Rs.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},Rs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Rs.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var bl=Object.freeze({__proto__:null,number:Za,color:function(o,u,c){return new Ai(Za(o.r,u.r,c),Za(o.g,u.g,c),Za(o.b,u.b,c),Za(o.a,u.a,c))},array:function(o,u,c){return o.map(function(m,x){return Za(m,u[x],c)})}}),Ku=6/29*3*(6/29),gf=Math.PI/180,zh=180/Math.PI;function _f(o){return o>.008856451679035631?Math.pow(o,1/3):o/Ku+4/29}function rh(o){return o>6/29?o*o*o:Ku*(o-4/29)}function nh(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ih(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Zh(o){var u=ih(o.r),c=ih(o.g),m=ih(o.b),x=_f((.4124564*u+.3575761*c+.1804375*m)/.95047),E=_f((.2126729*u+.7151522*c+.072175*m)/1);return{l:116*E-16,a:500*(x-E),b:200*(E-_f((.0193339*u+.119192*c+.9503041*m)/1.08883)),alpha:o.a}}function Vh(o){var u=(o.l+16)/116,c=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*rh(u),c=.95047*rh(c),m=1.08883*rh(m),new Ai(nh(3.2404542*c-1.5371385*u-.4985314*m),nh(-.969266*c+1.8760108*u+.041556*m),nh(.0556434*c-.2040259*u+1.0572252*m),o.alpha)}function Bp(o,u,c){var m=u-o;return o+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var Zc={forward:Zh,reverse:Vh,interpolate:function(o,u,c){return{l:Za(o.l,u.l,c),a:Za(o.a,u.a,c),b:Za(o.b,u.b,c),alpha:Za(o.alpha,u.alpha,c)}}},Bu={forward:function(o){var u=Zh(o),c=u.l,m=u.a,x=u.b,E=Math.atan2(x,m)*zh;return{h:E<0?E+360:E,c:Math.sqrt(m*m+x*x),l:c,alpha:o.a}},reverse:function(o){var u=o.h*gf,c=o.c;return Vh({l:o.l,a:Math.cos(u)*c,b:Math.sin(u)*c,alpha:o.alpha})},interpolate:function(o,u,c){return{h:Bp(o.h,u.h,c),c:Za(o.c,u.c,c),l:Za(o.l,u.l,c),alpha:Za(o.alpha,u.alpha,c)}}},jh=Object.freeze({__proto__:null,lab:Zc,hcl:Bu}),Wo=function(o,u,c,m,x){this.type=o,this.operator=u,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var E=0,T=x;E<T.length;E+=1){var M=T[E],D=M[1];this.labels.push(M[0]),this.outputs.push(D)}};function zl(o,u,c,m){var x=m-c,E=o-c;return x===0?0:u===1?E/x:(Math.pow(u,E)-1)/(Math.pow(u,x)-1)}Wo.interpolationFactor=function(o,u,c,m){var x=0;if(o.name==="exponential")x=zl(u,o.base,c,m);else if(o.name==="linear")x=zl(u,1,c,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;x=new z(E[0],E[1],E[2],E[3]).solve(zl(u,1,c,m))}return x},Wo.parse=function(o,u){var c=o[0],m=o[1],x=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var T=m[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:T}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(at){return typeof at!="number"||at<0||at>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(x=u.parse(x,2,rr)))return null;var D=[],U=null;c==="interpolate-hcl"||c==="interpolate-lab"?U=Yr:u.expectedType&&u.expectedType.kind!=="value"&&(U=u.expectedType);for(var H=0;H<E.length;H+=2){var X=E[H],ie=E[H+1],he=H+3,Fe=H+4;if(typeof X!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',he);if(D.length&&D[D.length-1][0]>=X)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',he);var Le=u.parse(ie,Fe,U);if(!Le)return null;U=U||Le.type,D.push([X,Le])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new Wo(U,c,m,x,D):u.error("Type "+Ri(U)+" is not interpolatable.")},Wo.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var x=u.length;if(m>=u[x-1])return c[x-1].evaluate(o);var E=zc(u,m),T=Wo.interpolationFactor(this.interpolation,m,u[E],u[E+1]),M=c[E].evaluate(o),D=c[E+1].evaluate(o);return this.operator==="interpolate"?bl[this.type.kind.toLowerCase()](M,D,T):this.operator==="interpolate-hcl"?Bu.reverse(Bu.interpolate(Bu.forward(M),Bu.forward(D),T)):Zc.reverse(Zc.interpolate(Zc.forward(M),Zc.forward(D),T))},Wo.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},Wo.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Wo.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],c=0;c<this.labels.length;c++)u.push(this.labels[c],this.outputs[c].serialize());return u};var El=function(o,u){this.type=o,this.args=u};El.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var c=null,m=u.expectedType;m&&m.kind!=="value"&&(c=m);for(var x=[],E=0,T=o.slice(1);E<T.length;E+=1){var M=u.parse(T[E],1+x.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,x.push(M)}var D=m&&x.some(function(U){return Ji(m,U.type)});return new El(D?Jr:c,x)},El.prototype.evaluate=function(o){for(var u,c=null,m=0,x=0,E=this.args;x<E.length&&(m++,(c=E[x].evaluate(o))&&c instanceof Ra&&!c.available&&(u||(u=c.name),c=null,m===this.args.length&&(c=u)),c===null);x+=1);return c},El.prototype.eachChild=function(o){this.args.forEach(o)},El.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},El.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var js=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};js.prototype.evaluate=function(o){return this.result.evaluate(o)},js.prototype.eachChild=function(o){for(var u=0,c=this.bindings;u<c.length;u+=1)o(c[u][1]);o(this.result)},js.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var c=[],m=1;m<o.length-1;m+=2){var x=o[m];if(typeof x!="string")return u.error("Expected string, but found "+typeof x+" instead.",m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;c.push([x,E])}var T=u.parse(o[o.length-1],o.length-1,u.expectedType,c);return T?new js(c,T):null},js.prototype.outputDefined=function(){return this.result.outputDefined()},js.prototype.serialize=function(){for(var o=["let"],u=0,c=this.bindings;u<c.length;u+=1){var m=c[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var Sl=function(o,u,c){this.type=o,this.index=u,this.input=c};Sl.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,rr),m=u.parse(o[2],2,Ci(u.expectedType||Jr));return c&&m?new Sl(m.type.itemType,c,m):null},Sl.prototype.evaluate=function(o){var u=this.index.evaluate(o),c=this.input.evaluate(o);if(u<0)throw new ua("Array index out of bounds: "+u+" < 0.");if(u>=c.length)throw new ua("Array index out of bounds: "+u+" > "+(c.length-1)+".");if(u!==Math.floor(u))throw new ua("Array index must be an integer, but found "+u+" instead.");return c[u]},Sl.prototype.eachChild=function(o){o(this.index),o(this.input)},Sl.prototype.outputDefined=function(){return!1},Sl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var au=function(o,u){this.type=Hr,this.needle=o,this.haystack=u};au.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,Jr),m=u.parse(o[2],2,Jr);return c&&m?Sa(c.type,[Hr,nn,rr,vn,Jr])?new au(c,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead"):null},au.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!c)return!1;if(!Mi(u,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+Ri(xa(u))+" instead.");if(!Mi(c,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+Ri(xa(c))+" instead.");return c.indexOf(u)>=0},au.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},au.prototype.outputDefined=function(){return!0},au.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var di=function(o,u,c){this.type=rr,this.needle=o,this.haystack=u,this.fromIndex=c};di.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,Jr),m=u.parse(o[2],2,Jr);if(!c||!m)return null;if(!Sa(c.type,[Hr,nn,rr,vn,Jr]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ri(c.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,rr);return x?new di(c,m,x):null}return new di(c,m)},di.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!Mi(u,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+Ri(xa(u))+" instead.");if(!Mi(c,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+Ri(xa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return c.indexOf(u,m)}return c.indexOf(u)},di.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},di.prototype.outputDefined=function(){return!1},di.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Hs=function(o,u,c,m,x,E){this.inputType=o,this.type=u,this.input=c,this.cases=m,this.outputs=x,this.otherwise=E};Hs.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var c,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var x={},E=[],T=2;T<o.length-1;T+=2){var M=o[T],D=o[T+1];Array.isArray(M)||(M=[M]);var U=u.concat(T);if(M.length===0)return U.error("Expected at least one branch label.");for(var H=0,X=M;H<X.length;H+=1){var ie=X[H];if(typeof ie!="number"&&typeof ie!="string")return U.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ie=="number"&&Math.floor(ie)!==ie)return U.error("Numeric branch labels must be integer values.");if(c){if(U.checkSubtype(c,xa(ie)))return null}else c=xa(ie);if(x[String(ie)]!==void 0)return U.error("Branch labels must be unique.");x[String(ie)]=E.length}var he=u.parse(D,T,m);if(!he)return null;m=m||he.type,E.push(he)}var Fe=u.parse(o[1],1,Jr);if(!Fe)return null;var Le=u.parse(o[o.length-1],o.length-1,m);return Le?Fe.type.kind!=="value"&&u.concat(1).checkSubtype(c,Fe.type)?null:new Hs(c,m,Fe,x,E,Le):null},Hs.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(xa(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},Hs.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},Hs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},Hs.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],c=[],m={},x=0,E=Object.keys(this.cases).sort();x<E.length;x+=1){var T=E[x];(X=m[this.cases[T]])===void 0?(m[this.cases[T]]=c.length,c.push([this.cases[T],[T]])):c[X][1].push(T)}for(var M=function(he){return o.inputType.kind==="number"?Number(he):he},D=0,U=c;D<U.length;D+=1){var H=U[D],X=H[0],ie=H[1];u.push(ie.length===1?M(ie[0]):ie.map(M)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Lu=function(o,u,c){this.type=o,this.branches=u,this.otherwise=c};Lu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var c;u.expectedType&&u.expectedType.kind!=="value"&&(c=u.expectedType);for(var m=[],x=1;x<o.length-1;x+=2){var E=u.parse(o[x],x,Hr);if(!E)return null;var T=u.parse(o[x+1],x+1,c);if(!T)return null;m.push([E,T]),c=c||T.type}var M=u.parse(o[o.length-1],o.length-1,c);return M?new Lu(c,m,M):null},Lu.prototype.evaluate=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];if(m[0].evaluate(o))return x.evaluate(o)}return this.otherwise.evaluate(o)},Lu.prototype.eachChild=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];o(m[0]),o(x)}o(this.otherwise)},Lu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},Lu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Qu=function(o,u,c,m){this.type=o,this.input=u,this.beginIndex=c,this.endIndex=m};function ah(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Hh(o,u,c,m){return m.compare(u,c)===0}function Fn(o,u,c){var m=o!=="=="&&o!=="!=";return function(){function x(E,T,M){this.type=Hr,this.lhs=E,this.rhs=T,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return x.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var M=E[0],D=T.parse(E[1],1,Jr);if(!D)return null;if(!ah(M,D.type))return T.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ri(D.type)+"'.");var U=T.parse(E[2],2,Jr);if(!U)return null;if(!ah(M,U.type))return T.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ri(U.type)+"'.");if(D.type.kind!==U.type.kind&&D.type.kind!=="value"&&U.type.kind!=="value")return T.error("Cannot compare types '"+Ri(D.type)+"' and '"+Ri(U.type)+"'.");m&&(D.type.kind==="value"&&U.type.kind!=="value"?D=new na(U.type,[D]):D.type.kind!=="value"&&U.type.kind==="value"&&(U=new na(D.type,[U])));var H=null;if(E.length===4){if(D.type.kind!=="string"&&U.type.kind!=="string"&&D.type.kind!=="value"&&U.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!(H=T.parse(E[3],3,xi)))return null}return new x(D,U,H)},x.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var D=xa(T),U=xa(M);if(D.kind!==U.kind||D.kind!=="string"&&D.kind!=="number")throw new ua('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+D.kind+", "+U.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var H=xa(T),X=xa(M);if(H.kind!=="string"||X.kind!=="string")return u(E,T,M)}return this.collator?c(E,T,M,this.collator.evaluate(E)):u(E,T,M)},x.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var E=[o];return this.eachChild(function(T){E.push(T.serialize())}),E},x}()}Qu.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,Jr),m=u.parse(o[2],2,rr);if(!c||!m)return null;if(!Sa(c.type,[Ci(Jr),nn,Jr]))return u.error("Expected first argument to be of type array or string, but found "+Ri(c.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,rr);return x?new Qu(c.type,c,m,x):null}return new Qu(c.type,c,m)},Qu.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=this.beginIndex.evaluate(o);if(!Mi(u,["string","array"]))throw new ua("Expected first argument to be of type array or string, but found "+Ri(xa(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(c,m)}return u.slice(c)},Qu.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},Qu.prototype.outputDefined=function(){return!1},Qu.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ws=Fn("==",function(o,u,c){return u===c},Hh),Ms=Fn("!=",function(o,u,c){return u!==c},function(o,u,c,m){return!Hh(0,u,c,m)}),Ju=Fn("<",function(o,u,c){return u<c},function(o,u,c,m){return m.compare(u,c)<0}),Va=Fn(">",function(o,u,c){return u>c},function(o,u,c,m){return m.compare(u,c)>0}),yf=Fn("<=",function(o,u,c){return u<=c},function(o,u,c,m){return m.compare(u,c)<=0}),xf=Fn(">=",function(o,u,c){return u>=c},function(o,u,c,m){return m.compare(u,c)>=0}),Is=function(o,u,c,m,x){this.type=nn,this.number=o,this.locale=u,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=x};Is.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var c=u.parse(o[1],1,rr);if(!c)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var x=null;if(m.locale&&!(x=u.parse(m.locale,1,nn)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,nn)))return null;var T=null;if(m["min-fraction-digits"]&&!(T=u.parse(m["min-fraction-digits"],1,rr)))return null;var M=null;return m["max-fraction-digits"]&&!(M=u.parse(m["max-fraction-digits"],1,rr))?null:new Is(c,x,E,T,M)},Is.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},Is.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},Is.prototype.outputDefined=function(){return!1},Is.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var el=function(o){this.type=rr,this.input=o};el.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ri(c.type)+" instead."):new el(c):null},el.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new ua("Expected value to be of type string or array, but found "+Ri(xa(u))+" instead.")},el.prototype.eachChild=function(o){o(this.input)},el.prototype.outputDefined=function(){return!1},el.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var mu={"==":Ws,"!=":Ms,">":Va,"<":Ju,">=":xf,"<=":yf,array:na,at:Sl,boolean:na,case:Lu,coalesce:El,collator:jo,format:Yo,image:Vo,in:au,"index-of":di,interpolate:Wo,"interpolate-hcl":Wo,"interpolate-lab":Wo,length:el,let:js,literal:ii,match:Hs,number:na,"number-format":Is,object:na,slice:Qu,step:Rs,string:na,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:ku,within:Ho};function Al(o,u){var c=u[0],m=u[1],x=u[2],E=u[3];c=c.evaluate(o),m=m.evaluate(o),x=x.evaluate(o);var T=E?E.evaluate(o):1,M=Yu(c,m,x,T);if(M)throw new ua(M);return new Ai(c/255*T,m/255*T,x/255*T,T)}function oh(o,u){return o in u}function hc(o,u){var c=u[o];return c===void 0?null:c}function la(o){return{type:o}}function pc(o){return{result:"success",value:o}}function tl(o){return{result:"error",value:o}}function Tl(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function sh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Vc(o){return!!o.expression&&o.expression.interpolated}function ca(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function wl(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Wh(o){return o}function Ps(o,u,c){return o!==void 0?o:u!==void 0?u:c!==void 0?c:void 0}function jc(o,u,c,m,x){return Ps(typeof c===x?m[c]:void 0,o.default,u.default)}function Hc(o,u,c){if(ca(c)!=="number")return Ps(o.default,u.default);var m=o.stops.length;if(m===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[m-1][0])return o.stops[m-1][1];var x=zc(o.stops.map(function(E){return E[0]}),c);return o.stops[x][1]}function bf(o,u,c){var m=o.base!==void 0?o.base:1;if(ca(c)!=="number")return Ps(o.default,u.default);var x=o.stops.length;if(x===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[x-1][0])return o.stops[x-1][1];var E=zc(o.stops.map(function(X){return X[0]}),c),T=function(X,ie,he,Fe){var Le=Fe-he,at=X-he;return Le===0?0:ie===1?at/Le:(Math.pow(ie,at)-1)/(Math.pow(ie,Le)-1)}(c,m,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],D=o.stops[E+1][1],U=bl[u.type]||Wh;if(o.colorSpace&&o.colorSpace!=="rgb"){var H=jh[o.colorSpace];U=function(X,ie){return H.reverse(H.interpolate(H.forward(X),H.forward(ie),T))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var X=[],ie=arguments.length;ie--;)X[ie]=arguments[ie];var he=M.evaluate.apply(void 0,X),Fe=D.evaluate.apply(void 0,X);if(he!==void 0&&Fe!==void 0)return U(he,Fe,T)}}:U(M,D,T)}function rl(o,u,c){return u.type==="color"?c=Ai.parse(c):u.type==="formatted"?c=va.fromString(c.toString()):u.type==="resolvedImage"?c=Ra.fromString(c.toString()):ca(c)===u.type||u.type==="enum"&&u.values[c]||(c=void 0),Ps(c,o.default,u.default)}ji.register(mu,{error:[{kind:"error"},[nn],function(o,u){throw new ua(u[0].evaluate(o))}],typeof:[nn,[Jr],function(o,u){return Ri(xa(u[0].evaluate(o)))}],"to-rgba":[Ci(rr,4),[Yr],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[Yr,[rr,rr,rr],Al],rgba:[Yr,[rr,rr,rr,rr],Al],has:{type:Hr,overloads:[[[nn],function(o,u){return oh(u[0].evaluate(o),o.properties())}],[[nn,gi],function(o,u){var c=u[1];return oh(u[0].evaluate(o),c.evaluate(o))}]]},get:{type:Jr,overloads:[[[nn],function(o,u){return hc(u[0].evaluate(o),o.properties())}],[[nn,gi],function(o,u){var c=u[1];return hc(u[0].evaluate(o),c.evaluate(o))}]]},"feature-state":[Jr,[nn],function(o,u){return hc(u[0].evaluate(o),o.featureState||{})}],properties:[gi,[],function(o){return o.properties()}],"geometry-type":[nn,[],function(o){return o.geometryType()}],id:[Jr,[],function(o){return o.id()}],zoom:[rr,[],function(o){return o.globals.zoom}],"heatmap-density":[rr,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[rr,[],function(o){return o.globals.lineProgress||0}],accumulated:[Jr,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[rr,la(rr),function(o,u){for(var c=0,m=0,x=u;m<x.length;m+=1)c+=x[m].evaluate(o);return c}],"*":[rr,la(rr),function(o,u){for(var c=1,m=0,x=u;m<x.length;m+=1)c*=x[m].evaluate(o);return c}],"-":{type:rr,overloads:[[[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)-c.evaluate(o)}],[[rr],function(o,u){return-u[0].evaluate(o)}]]},"/":[rr,[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)/c.evaluate(o)}],"%":[rr,[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)%c.evaluate(o)}],ln2:[rr,[],function(){return Math.LN2}],pi:[rr,[],function(){return Math.PI}],e:[rr,[],function(){return Math.E}],"^":[rr,[rr,rr],function(o,u){var c=u[1];return Math.pow(u[0].evaluate(o),c.evaluate(o))}],sqrt:[rr,[rr],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[rr,[rr],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[rr,[rr],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[rr,[rr],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[rr,[rr],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[rr,[rr],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[rr,[rr],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[rr,la(rr),function(o,u){return Math.min.apply(Math,u.map(function(c){return c.evaluate(o)}))}],max:[rr,la(rr),function(o,u){return Math.max.apply(Math,u.map(function(c){return c.evaluate(o)}))}],abs:[rr,[rr],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[rr,[rr],function(o,u){var c=u[0].evaluate(o);return c<0?-Math.round(-c):Math.round(c)}],floor:[rr,[rr],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[rr,[rr],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[Hr,[nn,Jr],function(o,u){var c=u[0],m=u[1];return o.properties()[c.value]===m.value}],"filter-id-==":[Hr,[Jr],function(o,u){var c=u[0];return o.id()===c.value}],"filter-type-==":[Hr,[nn],function(o,u){var c=u[0];return o.geometryType()===c.value}],"filter-<":[Hr,[nn,Jr],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x<E}],"filter-id-<":[Hr,[Jr],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m<x}],"filter->":[Hr,[nn,Jr],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x>E}],"filter-id->":[Hr,[Jr],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m>x}],"filter-<=":[Hr,[nn,Jr],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x<=E}],"filter-id-<=":[Hr,[Jr],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m<=x}],"filter->=":[Hr,[nn,Jr],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x>=E}],"filter-id->=":[Hr,[Jr],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m>=x}],"filter-has":[Hr,[Jr],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[Hr,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[Hr,[Ci(nn)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[Hr,[Ci(Jr)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[Hr,[nn,Ci(Jr)],function(o,u){var c=u[0];return u[1].value.indexOf(o.properties()[c.value])>=0}],"filter-in-large":[Hr,[nn,Ci(Jr)],function(o,u){var c=u[0],m=u[1];return function(x,E,T,M){for(;T<=M;){var D=T+M>>1;if(E[D]===x)return!0;E[D]>x?M=D-1:T=D+1}return!1}(o.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Hr,overloads:[[[Hr,Hr],function(o,u){var c=u[1];return u[0].evaluate(o)&&c.evaluate(o)}],[la(Hr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(!m[c].evaluate(o))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],function(o,u){var c=u[1];return u[0].evaluate(o)||c.evaluate(o)}],[la(Hr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(m[c].evaluate(o))return!0;return!1}]]},"!":[Hr,[Hr],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[Hr,[nn],function(o,u){var c=o.globals&&o.globals.isSupportedScript;return!c||c(u[0].evaluate(o))}],upcase:[nn,[nn],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[nn,[nn],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[nn,la(Jr),function(o,u){return u.map(function(c){return as(c.evaluate(o))}).join("")}],"resolved-locale":[nn,[xi],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var Zl=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new Da,this._defaultValue=u?function(c){return c.type==="color"&&wl(c.default)?new Ai(0,0,0,0):c.type==="color"?Ai.parse(c.default)||null:c.default===void 0?null:c.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Nu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in mu}function Wc(o,u){var c=new qu(mu,[],u?function(x){var E={color:Yr,string:nn,number:rr,enum:nn,boolean:Hr,formatted:Gi,resolvedImage:_i};return x.type==="array"?Ci(E[x.value]||Jr,x.length):E[x.type]}(u):void 0),m=c.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?pc(new Zl(m,u)):tl(c.errors)}Zl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Zl.prototype.evaluate=function(o,u,c,m,x,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ua("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var dc=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!xl(u.expression)};dc.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,x,E)},dc.prototype.evaluate=function(o,u,c,m,x,E){return this._styleExpression.evaluate(o,u,c,m,x,E)};var Vl=function(o,u,c,m){this.kind=o,this.zoomStops=c,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!xl(u.expression),this.interpolationType=m};function Ef(o,u){if((o=Wc(o,u)).result==="error")return o;var c=o.value.expression,m=yl(c);if(!m&&!Tl(u))return tl([new br("","data expressions not supported")]);var x=Fu(c,["zoom"]);if(!x&&!sh(u))return tl([new br("","zoom expressions not supported")]);var E=function T(M){var D=null;if(M instanceof js)D=T(M.result);else if(M instanceof El)for(var U=0,H=M.args;U<H.length&&!(D=T(H[U]));U+=1);else(M instanceof Rs||M instanceof Wo)&&M.input instanceof ji&&M.input.name==="zoom"&&(D=M);return D instanceof br||M.eachChild(function(X){var ie=T(X);ie instanceof br?D=ie:!D&&ie?D=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ie&&D!==ie&&(D=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(c);return E||x?E instanceof br?tl([E]):E instanceof Wo&&!Vc(u)?tl([new br("",'"interpolate" expressions cannot be used with this property')]):pc(E?new Vl(m?"camera":"composite",o.value,E.labels,E instanceof Wo?E.interpolation:void 0):new dc(m?"constant":"source",o.value)):tl([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Vl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,x,E)},Vl.prototype.evaluate=function(o,u,c,m,x,E){return this._styleExpression.evaluate(o,u,c,m,x,E)},Vl.prototype.interpolationFactor=function(o,u,c){return this.interpolationType?Wo.interpolationFactor(this.interpolationType,o,u,c):0};var vc=function(o,u){this._parameters=o,this._specification=u,tt(this,function c(m,x){var E,T,M,D=x.type==="color",U=m.stops&&typeof m.stops[0][0]=="object",H=U||!(U||m.property!==void 0),X=m.type||(Vc(x)?"exponential":"interval");if(D&&((m=tt({},m)).stops&&(m.stops=m.stops.map(function(hn){return[hn[0],Ai.parse(hn[1])]})),m.default=Ai.parse(m.default?m.default:x.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!jh[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(X==="exponential")E=bf;else if(X==="interval")E=Hc;else if(X==="categorical"){E=jc,T=Object.create(null);for(var ie=0,he=m.stops;ie<he.length;ie+=1){var Fe=he[ie];T[Fe[0]]=Fe[1]}M=typeof m.stops[0][0]}else{if(X!=="identity")throw new Error('Unknown function type "'+X+'"');E=rl}if(U){for(var Le={},at=[],Ge=0;Ge<m.stops.length;Ge++){var yt=m.stops[Ge],Dt=yt[0].zoom;Le[Dt]===void 0&&(Le[Dt]={zoom:Dt,type:m.type,property:m.property,default:m.default,stops:[]},at.push(Dt)),Le[Dt].stops.push([yt[0].value,yt[1]])}for(var kt=[],Qt=0,fr=at;Qt<fr.length;Qt+=1){var Br=fr[Qt];kt.push([Le[Br].zoom,c(Le[Br],x)])}var $r={name:"linear"};return{kind:"composite",interpolationType:$r,interpolationFactor:Wo.interpolationFactor.bind(void 0,$r),zoomStops:kt.map(function(hn){return hn[0]}),evaluate:function(hn,Hn){var pn=hn.zoom;return bf({stops:kt,base:m.base},x,pn).evaluate(pn,Hn)}}}if(H){var zn=X==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:zn,interpolationFactor:Wo.interpolationFactor.bind(void 0,zn),zoomStops:m.stops.map(function(hn){return hn[0]}),evaluate:function(hn){return E(m,x,hn.zoom,T,M)}}}return{kind:"source",evaluate:function(hn,Hn){var pn=Hn&&Hn.properties?Hn.properties[m.property]:void 0;return pn===void 0?Ps(m.default,x.default):E(m,x,pn,T,M)}}}(this._parameters,this._specification))};function Os(o){var u=o.key,c=o.value,m=o.valueSpec||{},x=o.objectElementValidators||{},E=o.style,T=o.styleSpec,M=[],D=ca(c);if(D!=="object")return[new Y(u,c,"object expected, "+D+" found")];for(var U in c){var H=U.split(".")[0],X=m[H]||m["*"],ie=void 0;if(x[H])ie=x[H];else if(m[H])ie=Ni;else if(x["*"])ie=x["*"];else{if(!m["*"]){M.push(new Y(u,c[U],'unknown property "'+U+'"'));continue}ie=Ni}M=M.concat(ie({key:(u&&u+".")+U,value:c[U],valueSpec:X,style:E,styleSpec:T,object:c,objectKey:U},c))}for(var he in m)x[he]||m[he].required&&m[he].default===void 0&&c[he]===void 0&&M.push(new Y(u,c,'missing required property "'+he+'"'));return M}function uh(o){var u=o.value,c=o.valueSpec,m=o.style,x=o.styleSpec,E=o.key,T=o.arrayElementValidator||Ni;if(ca(u)!=="array")return[new Y(E,u,"array expected, "+ca(u)+" found")];if(c.length&&u.length!==c.length)return[new Y(E,u,"array length "+c.length+" expected, length "+u.length+" found")];if(c["min-length"]&&u.length<c["min-length"])return[new Y(E,u,"array length at least "+c["min-length"]+" expected, length "+u.length+" found")];var M={type:c.value,values:c.values};x.$version<7&&(M.function=c.function),ca(c.value)==="object"&&(M=c.value);for(var D=[],U=0;U<u.length;U++)D=D.concat(T({array:u,arrayIndex:U,value:u[U],valueSpec:M,style:m,styleSpec:x,key:E+"["+U+"]"}));return D}function Gc(o){var u=o.key,c=o.value,m=o.valueSpec,x=ca(c);return x==="number"&&c!=c&&(x="NaN"),x!=="number"?[new Y(u,c,"number expected, "+x+" found")]:"minimum"in m&&c<m.minimum?[new Y(u,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new Y(u,c,c+" is greater than the maximum value "+m.maximum)]:[]}function mc(o){var u,c,m,x=o.valueSpec,E=gt(o.value.type),T={},M=E!=="categorical"&&o.value.property===void 0,D=!M,U=ca(o.value.stops)==="array"&&ca(o.value.stops[0])==="array"&&ca(o.value.stops[0][0])==="object",H=Os({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(he){if(E==="identity")return[new Y(he.key,he.value,'identity function may not have a "stops" property')];var Fe=[],Le=he.value;return Fe=Fe.concat(uh({key:he.key,value:Le,valueSpec:he.valueSpec,style:he.style,styleSpec:he.styleSpec,arrayElementValidator:X})),ca(Le)==="array"&&Le.length===0&&Fe.push(new Y(he.key,Le,"array must have at least one stop")),Fe},default:function(he){return Ni({key:he.key,value:he.value,valueSpec:x,style:he.style,styleSpec:he.styleSpec})}}});return E==="identity"&&M&&H.push(new Y(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||H.push(new Y(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!Vc(o.valueSpec)&&H.push(new Y(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(D&&!Tl(o.valueSpec)?H.push(new Y(o.key,o.value,"property functions not supported")):M&&!sh(o.valueSpec)&&H.push(new Y(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!U||o.value.property!==void 0||H.push(new Y(o.key,o.value,'"property" property is required')),H;function X(he){var Fe=[],Le=he.value,at=he.key;if(ca(Le)!=="array")return[new Y(at,Le,"array expected, "+ca(Le)+" found")];if(Le.length!==2)return[new Y(at,Le,"array length 2 expected, length "+Le.length+" found")];if(U){if(ca(Le[0])!=="object")return[new Y(at,Le,"object expected, "+ca(Le[0])+" found")];if(Le[0].zoom===void 0)return[new Y(at,Le,"object stop key must have zoom")];if(Le[0].value===void 0)return[new Y(at,Le,"object stop key must have value")];if(m&&m>gt(Le[0].zoom))return[new Y(at,Le[0].zoom,"stop zoom values must appear in ascending order")];gt(Le[0].zoom)!==m&&(m=gt(Le[0].zoom),c=void 0,T={}),Fe=Fe.concat(Os({key:at+"[0]",value:Le[0],valueSpec:{zoom:{}},style:he.style,styleSpec:he.styleSpec,objectElementValidators:{zoom:Gc,value:ie}}))}else Fe=Fe.concat(ie({key:at+"[0]",value:Le[0],valueSpec:{},style:he.style,styleSpec:he.styleSpec},Le));return Nu(le(Le[1]))?Fe.concat([new Y(at+"[1]",Le[1],"expressions are not allowed in function stops.")]):Fe.concat(Ni({key:at+"[1]",value:Le[1],valueSpec:x,style:he.style,styleSpec:he.styleSpec}))}function ie(he,Fe){var Le=ca(he.value),at=gt(he.value),Ge=he.value!==null?he.value:Fe;if(u){if(Le!==u)return[new Y(he.key,Ge,Le+" stop domain type must match previous stop domain type "+u)]}else u=Le;if(Le!=="number"&&Le!=="string"&&Le!=="boolean")return[new Y(he.key,Ge,"stop domain value must be a number, string, or boolean")];if(Le!=="number"&&E!=="categorical"){var yt="number expected, "+Le+" found";return Tl(x)&&E===void 0&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Y(he.key,Ge,yt)]}return E!=="categorical"||Le!=="number"||isFinite(at)&&Math.floor(at)===at?E!=="categorical"&&Le==="number"&&c!==void 0&&at<c?[new Y(he.key,Ge,"stop domain values must appear in ascending order")]:(c=at,E==="categorical"&&at in T?[new Y(he.key,Ge,"stop domain values must be unique")]:(T[at]=!0,[])):[new Y(he.key,Ge,"integer expected, found "+at)]}}function Cl(o){var u=(o.expressionContext==="property"?Ef:Wc)(le(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new Y(""+o.key+m.key,o.value,m.message)});var c=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!c.outputDefined())return[new Y(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!xl(c))return[new Y(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!xl(c))return[new Y(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Fu(c,["zoom","feature-state"]))return[new Y(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!yl(c))return[new Y(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Uu(o){var u=o.key,c=o.value,m=o.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(gt(c))===-1&&x.push(new Y(u,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(gt(c))===-1&&x.push(new Y(u,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),x}function jl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,c=o.slice(1);u<c.length;u+=1){var m=c[u];if(!jl(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}vc.deserialize=function(o){return new vc(o._parameters,o._specification)},vc.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var Sf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function nl(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};jl(o)||(o=ch(o));var u=Wc(o,Sf);if(u.result==="error")throw new Error(u.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,x){return u.value.evaluate(c,m,{},x)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var x=1;x<m.length;x++)if(c(m[x]))return!0;return!1}(o)}}function lh(o,u){return o<u?-1:o>u?1:0}function ch(o){if(!o)return!0;var u,c=o[0];return o.length<=1?c!=="any":c==="=="?fh(o[1],o[2],"=="):c==="!="?so(fh(o[1],o[2],"==")):c==="<"||c===">"||c==="<="||c===">="?fh(o[1],o[2],c):c==="any"?(u=o.slice(1),["any"].concat(u.map(ch))):c==="all"?["all"].concat(o.slice(1).map(ch)):c==="none"?["all"].concat(o.slice(1).map(ch).map(so)):c==="in"?Af(o[1],o.slice(2)):c==="!in"?so(Af(o[1],o.slice(2))):c==="has"?Gh(o[1]):c==="!has"?so(Gh(o[1])):c!=="within"||o}function fh(o,u,c){switch(o){case"$type":return["filter-type-"+c,u];case"$id":return["filter-id-"+c,u];default:return["filter-"+c,o,u]}}function Af(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(c){return typeof c!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(lh)]]:["filter-in-small",o,["literal",u]]}}function Gh(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function so(o){return["!",o]}function Xh(o){return jl(le(o.value))?Cl(tt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(c){var m=c.value,x=c.key;if(ca(m)!=="array")return[new Y(x,m,"array expected, "+ca(m)+" found")];var E,T=c.styleSpec,M=[];if(m.length<1)return[new Y(x,m,"filter array must have at least 1 element")];switch(M=M.concat(Uu({key:x+"[0]",value:m[0],valueSpec:T.filter_operator,style:c.style,styleSpec:c.styleSpec})),gt(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&gt(m[1])==="$type"&&M.push(new Y(x,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new Y(x,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=ca(m[1]))!=="string"&&M.push(new Y(x+"[1]",m[1],"string expected, "+E+" found"));for(var D=2;D<m.length;D++)E=ca(m[D]),gt(m[1])==="$type"?M=M.concat(Uu({key:x+"["+D+"]",value:m[D],valueSpec:T.geometry_type,style:c.style,styleSpec:c.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new Y(x+"["+D+"]",m[D],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var U=1;U<m.length;U++)M=M.concat(u({key:x+"["+U+"]",value:m[U],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=ca(m[1]),m.length!==2?M.push(new Y(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&M.push(new Y(x+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=ca(m[1]),m.length!==2?M.push(new Y(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&M.push(new Y(x+"[1]",m[1],"object expected, "+E+" found"))}return M}(o)}function Tf(o,u){var c=o.key,m=o.style,x=o.styleSpec,E=o.value,T=o.objectKey,M=x[u+"_"+o.layerType];if(!M)return[];var D=T.match(/^(.*)-transition$/);if(u==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return Ni({key:c,value:E,valueSpec:x.transition,style:m,styleSpec:x});var U,H=o.valueSpec||M[T];if(!H)return[new Y(c,E,'unknown property "'+T+'"')];if(ca(E)==="string"&&Tl(H)&&!H.tokens&&(U=/^{([^}]+)}$/.exec(E)))return[new Y(c,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(U[1])+" }`.")];var X=[];return o.layerType==="symbol"&&(T==="text-field"&&m&&!m.glyphs&&X.push(new Y(c,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&wl(le(E))&&gt(E.type)==="identity"&&X.push(new Y(c,E,'"text-font" does not support identity functions'))),X.concat(Ni({key:o.key,value:E,valueSpec:H,style:m,styleSpec:x,expressionContext:"property",propertyType:u,propertyKey:T}))}function $h(o){return Tf(o,"paint")}function Hl(o){return Tf(o,"layout")}function Yh(o){var u=[],c=o.value,m=o.key,x=o.style,E=o.styleSpec;c.type||c.ref||u.push(new Y(m,c,'either "type" or "ref" is required'));var T,M=gt(c.type),D=gt(c.ref);if(c.id)for(var U=gt(c.id),H=0;H<o.arrayIndex;H++){var X=x.layers[H];gt(X.id)===U&&u.push(new Y(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+X.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Fe){Fe in c&&u.push(new Y(m,c[Fe],'"'+Fe+'" is prohibited for ref layers'))}),x.layers.forEach(function(Fe){gt(Fe.id)===D&&(T=Fe)}),T?T.ref?u.push(new Y(m,c.ref,"ref cannot reference another ref layer")):M=gt(T.type):u.push(new Y(m,c.ref,'ref layer "'+D+'" not found'));else if(M!=="background")if(c.source){var ie=x.sources&&x.sources[c.source],he=ie&&gt(ie.type);ie?he==="vector"&&M==="raster"?u.push(new Y(m,c.source,'layer "'+c.id+'" requires a raster source')):he==="raster"&&M!=="raster"?u.push(new Y(m,c.source,'layer "'+c.id+'" requires a vector source')):he!=="vector"||c["source-layer"]?he==="raster-dem"&&M!=="hillshade"?u.push(new Y(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||he==="geojson"&&ie.lineMetrics||u.push(new Y(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Y(m,c,'layer "'+c.id+'" must specify a "source-layer"')):u.push(new Y(m,c.source,'source "'+c.source+'" not found'))}else u.push(new Y(m,c,'missing required property "source"'));return u=u.concat(Os({key:m,value:c,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ni({key:m+".type",value:c.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:c,objectKey:"type"})},filter:Xh,layout:function(Fe){return Os({layer:c,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(Le){return Hl(tt({layerType:M},Le))}}})},paint:function(Fe){return Os({layer:c,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(Le){return $h(tt({layerType:M},Le))}}})}}}))}function ou(o){var u=o.value,c=o.key,m=ca(u);return m!=="string"?[new Y(c,u,"string expected, "+m+" found")]:[]}var fa={promoteId:function(o){var u=o.key,c=o.value;if(ca(c)==="string")return ou({key:u,value:c});var m=[];for(var x in c)m.push.apply(m,ou({key:u+"."+x,value:c[x]}));return m}};function Wl(o){var u=o.value,c=o.key,m=o.styleSpec,x=o.style;if(!u.type)return[new Y(c,u,'"type" is required')];var E,T=gt(u.type);switch(T){case"vector":case"raster":case"raster-dem":return Os({key:c,value:u,valueSpec:m["source_"+T.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:fa});case"geojson":if(E=Os({key:c,value:u,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:fa}),u.cluster)for(var M in u.clusterProperties){var D=u.clusterProperties[M],U=D[0],H=typeof U=="string"?[U,["accumulated"],["get",M]]:U;E.push.apply(E,Cl({key:c+"."+M+".map",value:D[1],expressionContext:"cluster-map"})),E.push.apply(E,Cl({key:c+"."+M+".reduce",value:H,expressionContext:"cluster-reduce"}))}return E;case"video":return Os({key:c,value:u,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Os({key:c,value:u,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new Y(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uu({key:c+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:m})}}function zu(o){var u=o.value,c=o.styleSpec,m=c.light,x=o.style,E=[],T=ca(u);if(u===void 0)return E;if(T!=="object")return E.concat([new Y("light",u,"object expected, "+T+" found")]);for(var M in u){var D=M.match(/^(.*)-transition$/);E=E.concat(D&&m[D[1]]&&m[D[1]].transition?Ni({key:M,value:u[M],valueSpec:c.transition,style:x,styleSpec:c}):m[M]?Ni({key:M,value:u[M],valueSpec:m[M],style:x,styleSpec:c}):[new Y(M,u[M],'unknown property "'+M+'"')])}return E}var il={"*":function(){return[]},array:uh,boolean:function(o){var u=o.value,c=o.key,m=ca(u);return m!=="boolean"?[new Y(c,u,"boolean expected, "+m+" found")]:[]},number:Gc,color:function(o){var u=o.key,c=o.value,m=ca(c);return m!=="string"?[new Y(u,c,"color expected, "+m+" found")]:yi(c)===null?[new Y(u,c,'color expected, "'+c+'" found')]:[]},constants:ye,enum:Uu,filter:Xh,function:mc,layer:Yh,object:Os,source:Wl,light:zu,string:ou,formatted:function(o){return ou(o).length===0?[]:Cl(o)},resolvedImage:function(o){return ou(o).length===0?[]:Cl(o)}};function Ni(o){var u=o.value,c=o.valueSpec,m=o.styleSpec;return c.expression&&wl(gt(u))?mc(o):c.expression&&Nu(le(u))?Cl(o):c.type&&il[c.type]?il[c.type](o):Os(tt({},o,{valueSpec:c.type?m[c.type]:c}))}function ma(o){var u=o.value,c=o.key,m=ou(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new Y(c,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new Y(c,u,'"glyphs" url must include a "{range}" token'))),m}function su(o,u){u===void 0&&(u=me);var c=[];return c=c.concat(Ni({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:ma,"*":function(){return[]}}})),o.constants&&(c=c.concat(ye({key:"constants",value:o.constants,style:o,styleSpec:u}))),Xc(c)}function Xc(o){return[].concat(o).sort(function(u,c){return u.line-c.line})}function $c(o){return function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return Xc(o.apply(this,u))}}su.source=$c(Wl),su.light=$c(zu),su.layer=$c(Yh),su.filter=$c(Xh),su.paintProperty=$c($h),su.layoutProperty=$c(Hl);var Gs=su,qh=Gs.light,wf=Gs.paintProperty,Cf=Gs.layoutProperty;function Gl(o,u){var c=!1;if(u&&u.length)for(var m=0,x=u;m<x.length;m+=1)o.fire(new it(new Error(x[m].message))),c=!0;return c}var yo=Fa;function Fa(o,u,c){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(u=x[1])+2*(c=x[2]);for(var E=0;E<this.d*this.d;E++){var T=x[3+E],M=x[3+E+1];m.push(T===M?null:x.subarray(T,M))}var D=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],D),this.bboxes=x.subarray(D),this.insert=this._insertReadonly}else{this.d=u+2*c;for(var U=0;U<this.d*this.d;U++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=c,this.scale=u/o,this.uid=0;var H=c/u*o;this.min=-H,this.max=o+H}Fa.prototype.insert=function(o,u,c,m,x){this._forEachCell(u,c,m,x,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x)},Fa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fa.prototype._insertCell=function(o,u,c,m,x,E){this.cells[x].push(E)},Fa.prototype.query=function(o,u,c,m,x){var E=this.min,T=this.max;if(o<=E&&u<=E&&T<=c&&T<=m&&!x)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(o,u,c,m,this._queryCell,M,{},x),M},Fa.prototype._queryCell=function(o,u,c,m,x,E,T,M){var D=this.cells[x];if(D!==null)for(var U=this.keys,H=this.bboxes,X=0;X<D.length;X++){var ie=D[X];if(T[ie]===void 0){var he=4*ie;(M?M(H[he+0],H[he+1],H[he+2],H[he+3]):o<=H[he+2]&&u<=H[he+3]&&c>=H[he+0]&&m>=H[he+1])?(T[ie]=!0,E.push(U[ie])):T[ie]=!1}}},Fa.prototype._forEachCell=function(o,u,c,m,x,E,T,M){for(var D=this._convertToCellCoord(o),U=this._convertToCellCoord(u),H=this._convertToCellCoord(c),X=this._convertToCellCoord(m),ie=D;ie<=H;ie++)for(var he=U;he<=X;he++){var Fe=this.d*he+ie;if((!M||M(this._convertFromCellCoord(ie),this._convertFromCellCoord(he),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(he+1)))&&x.call(this,o,u,c,m,Fe,E,T,M))return}},Fa.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Fa.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Fa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var x=new Int32Array(u+c+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var E=u,T=0;T<o.length;T++){var M=o[T];x[3+T]=E,x.set(M,E),E+=M.length}return x[3+o.length]=E,x.set(this.keys,E),x[3+o.length+1]=E+=this.keys.length,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer};var Yc=re.ImageData,gc=re.ImageBitmap,Ka={};function _n(o,u,c){c===void 0&&(c={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),Ka[o]={klass:u,omit:c.omit||[],shallow:c.shallow||[]}}for(var os in _n("Object",Object),yo.serialize=function(o,u){var c=o.toArrayBuffer();return u&&u.push(c),{buffer:c}},yo.deserialize=function(o){return new yo(o.buffer)},_n("Grid",yo),_n("Color",Ai),_n("Error",Error),_n("ResolvedImage",Ra),_n("StylePropertyFunction",vc),_n("StyleExpression",Zl,{omit:["_evaluator"]}),_n("ZoomDependentExpression",Vl),_n("ZoomConstantExpression",dc),_n("CompoundExpression",ji,{omit:["_evaluate"]}),mu)mu[os]._classRegistryKey||_n("Expression_"+os,mu[os]);function Rf(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function _c(o){return gc&&o instanceof gc}function qo(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Rf(o)||_c(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var c=o;return u&&u.push(c.buffer),c}if(o instanceof Yc)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],x=0,E=o;x<E.length;x+=1)m.push(qo(E[x],u));return m}if(typeof o=="object"){var T=o.constructor,M=T._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var D=T.serialize?T.serialize(o,u):{};if(!T.serialize){for(var U in o)if(o.hasOwnProperty(U)&&!(Ka[M].omit.indexOf(U)>=0)){var H=o[U];D[U]=Ka[M].shallow.indexOf(U)>=0?H:qo(H,u)}o instanceof Error&&(D.message=o.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(D.$name=M),D}throw new Error("can't serialize object of type "+typeof o)}function ha(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Rf(o)||_c(o)||ArrayBuffer.isView(o)||o instanceof Yc)return o;if(Array.isArray(o))return o.map(ha);if(typeof o=="object"){var u=o.$name||"Object",c=Ka[u].klass;if(!c)throw new Error("can't deserialize unregistered class "+u);if(c.deserialize)return c.deserialize(o);for(var m=Object.create(c.prototype),x=0,E=Object.keys(o);x<E.length;x+=1){var T=E[x];if(T!=="$name"){var M=o[T];m[T]=Ka[u].shallow.indexOf(T)>=0?M:ha(M)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var Mf=function(){this.first=!0};Mf.prototype.update=function(o,u){var c=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=c,!0))};var qr={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function al(o){for(var u=0,c=o;u<c.length;u+=1)if(qc(c[u].charCodeAt(0)))return!0;return!1}function qc(o){return!(o!==746&&o!==747&&(o<4352||!(qr["Bopomofo Extended"](o)||qr.Bopomofo(o)||qr["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||qr["CJK Compatibility Ideographs"](o)||qr["CJK Compatibility"](o)||qr["CJK Radicals Supplement"](o)||qr["CJK Strokes"](o)||!(!qr["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||qr["CJK Unified Ideographs Extension A"](o)||qr["CJK Unified Ideographs"](o)||qr["Enclosed CJK Letters and Months"](o)||qr["Hangul Compatibility Jamo"](o)||qr["Hangul Jamo Extended-A"](o)||qr["Hangul Jamo Extended-B"](o)||qr["Hangul Jamo"](o)||qr["Hangul Syllables"](o)||qr.Hiragana(o)||qr["Ideographic Description Characters"](o)||qr.Kanbun(o)||qr["Kangxi Radicals"](o)||qr["Katakana Phonetic Extensions"](o)||qr.Katakana(o)&&o!==12540||!(!qr["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!qr["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||qr["Unified Canadian Aboriginal Syllabics"](o)||qr["Unified Canadian Aboriginal Syllabics Extended"](o)||qr["Vertical Forms"](o)||qr["Yijing Hexagram Symbols"](o)||qr["Yi Syllables"](o)||qr["Yi Radicals"](o))))}function Kc(o){return!(qc(o)||function(u){return!!(qr["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||qr["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||qr["Letterlike Symbols"](u)||qr["Number Forms"](u)||qr["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||qr["Control Pictures"](u)&&u!==9251||qr["Optical Character Recognition"](u)||qr["Enclosed Alphanumerics"](u)||qr["Geometric Shapes"](u)||qr["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||qr["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||qr["CJK Symbols and Punctuation"](u)||qr.Katakana(u)||qr["Private Use Area"](u)||qr["CJK Compatibility Forms"](u)||qr["Small Form Variants"](u)||qr["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function gu(o){return o>=1424&&o<=2303||qr["Arabic Presentation Forms-A"](o)||qr["Arabic Presentation Forms-B"](o)}function Ds(o,u){return!(!u&&gu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||qr.Khmer(o))}function If(o){for(var u=0,c=o;u<c.length;u+=1)if(gu(c[u].charCodeAt(0)))return!0;return!1}var Pf=null,ss="unavailable",_u=null,Kh=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(ss="error"),Pf&&Pf(o)};function yc(){xc.fire(new ke("pluginStateChange",{pluginStatus:ss,pluginURL:_u}))}var xc=new ct,Qc=function(){return ss},Fs=function(){if(ss!=="deferred"||!_u)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ss="loading",yc(),_u&&Ts({url:_u},function(o){o?Kh(o):(ss="loaded",yc())})},Ot={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ss==="loaded"||Ot.applyArabicShaping!=null},isLoading:function(){return ss==="loading"},setState:function(o){ss=o.pluginStatus,_u=o.pluginURL},isParsed:function(){return Ot.applyArabicShaping!=null&&Ot.processBidirectionalText!=null&&Ot.processStyledBidirectionalText!=null},getPluginURL:function(){return _u}},Ee=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mf,this.transition={})};Ee.prototype.isSupportedScript=function(o){return function(u,c){for(var m=0,x=u;m<x.length;m+=1)if(!Ds(x[m].charCodeAt(0),c))return!1;return!0}(o,Ot.isLoaded())},Ee.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ee.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),c=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*u}};var B=function(o,u){this.property=o,this.value=u,this.expression=function(c,m){if(wl(c))return new vc(c,m);if(Nu(c)){var x=Ef(c,m);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var E=c;return typeof c=="string"&&m.type==="color"&&(E=Ai.parse(c)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};B.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},B.prototype.possiblyEvaluate=function(o,u,c){return this.property.possiblyEvaluate(this,o,u,c)};var Xs=function(o){this.property=o,this.value=new B(o,void 0)};Xs.prototype.transitioned=function(o,u){return new Rl(this.property,this.value,u,Gt({},o.transition,this.transition),o.now)},Xs.prototype.untransitioned=function(){return new Rl(this.property,this.value,null,{},0)};var ve=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};ve.prototype.getValue=function(o){return lt(this._values[o].value.value)},ve.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Xs(this._values[o].property)),this._values[o].value=new B(this._values[o].property,u===null?void 0:lt(u))},ve.prototype.getTransition=function(o){return lt(this._values[o].transition)},ve.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new Xs(this._values[o].property)),this._values[o].transition=lt(u)||void 0},ve.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(o[m]=x);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},ve.prototype.transitioned=function(o,u){for(var c=new ka(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var E=x[m];c._values[E]=this._values[E].transitioned(o,u._values[E])}return c},ve.prototype.untransitioned=function(){for(var o=new ka(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u];o._values[m]=this._values[m].untransitioned()}return o};var Rl=function(o,u,c,m,x){this.property=o,this.value=u,this.begin=x+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Rl.prototype.possiblyEvaluate=function(o,u,c){var m=o.now||0,x=this.value.possiblyEvaluate(o,u,c),E=this.prior;if(E){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return E.possiblyEvaluate(o,u,c);var T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,c),x,function(M){if(M<=0)return 0;if(M>=1)return 1;var D=M*M,U=D*M;return 4*(M<.5?U:3*(M-D)+U-.75)}(T))}return x};var ka=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};ka.prototype.possiblyEvaluate=function(o,u,c){for(var m=new us(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m},ka.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var ks=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};ks.prototype.getValue=function(o){return lt(this._values[o].value)},ks.prototype.setValue=function(o,u){this._values[o]=new B(this._values[o].property,u===null?void 0:lt(u))},ks.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(o[m]=x)}return o},ks.prototype.possiblyEvaluate=function(o,u,c){for(var m=new us(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var T=E[x];m._values[T]=this._values[T].possiblyEvaluate(o,u,c)}return m};var xo=function(o,u,c){this.property=o,this.value=u,this.parameters=c};xo.prototype.isConstant=function(){return this.value.kind==="constant"},xo.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},xo.prototype.evaluate=function(o,u,c,m){return this.property.evaluate(this.value,this.parameters,o,u,c,m)};var us=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};us.prototype.get=function(o){return this._values[o]};var kn=function(o){this.specification=o};kn.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},kn.prototype.interpolate=function(o,u,c){var m=bl[this.specification.type];return m?m(o,u,c):o};var Sn=function(o,u){this.specification=o,this.overrides=u};Sn.prototype.possiblyEvaluate=function(o,u,c,m){return new xo(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},c,m)}:o.expression,u)},Sn.prototype.interpolate=function(o,u,c){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},o.parameters);var m=bl[this.specification.type];return m?new xo(this,{kind:"constant",value:m(o.value.value,u.value.value,c)},o.parameters):o},Sn.prototype.evaluate=function(o,u,c,m,x,E){return o.kind==="constant"?o.value:o.evaluate(u,c,m,x,E)};var Ko=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m,x,E){if(c.value===void 0)return new xo(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var T=c.expression.evaluate(m,null,{},x,E),M=c.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,D=this._calculate(M,M,M,m);return new xo(this,{kind:"constant",value:D},m)}if(c.expression.kind==="camera"){var U=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new xo(this,{kind:"constant",value:U},m)}return new xo(this,c.expression,m)},u.prototype.evaluate=function(c,m,x,E,T,M){if(c.kind==="source"){var D=c.evaluate(m,x,E,T,M);return this._calculate(D,D,D,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},x,E),c.evaluate({zoom:Math.floor(m.zoom)},x,E),c.evaluate({zoom:Math.floor(m.zoom)+1},x,E),m):c.value},u.prototype._calculate=function(c,m,x,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:x,to:m}},u.prototype.interpolate=function(c){return c},u}(Sn),Qo=function(o){this.specification=o};Qo.prototype.possiblyEvaluate=function(o,u,c,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var x=o.expression.evaluate(u,null,{},c,m);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new Ee(Math.floor(u.zoom-1),u)),o.expression.evaluate(new Ee(Math.floor(u.zoom),u)),o.expression.evaluate(new Ee(Math.floor(u.zoom+1),u)),u)}},Qo.prototype._calculate=function(o,u,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:c,to:u}},Qo.prototype.interpolate=function(o){return o};var yu=function(o){this.specification=o};yu.prototype.possiblyEvaluate=function(o,u,c,m){return!!o.expression.evaluate(u,null,{},c,m)},yu.prototype.interpolate=function(){return!1};var Ia=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var c=o[u];c.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new B(c,void 0),x=this.defaultTransitionablePropertyValues[u]=new Xs(c);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};_n("DataDrivenProperty",Sn),_n("DataConstantProperty",kn),_n("CrossFadedDataDrivenProperty",Ko),_n("CrossFadedProperty",Qo),_n("ColorRampProperty",yu);var $s=function(o){function u(c,m){if(o.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new ks(m.layout)),m.paint)){for(var x in this._transitionablePaint=new ve(m.paint),c.paint)this.setPaintProperty(x,c.paint[x],{validate:!1});for(var E in c.layout)this.setLayoutProperty(E,c.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new us(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},u.prototype.setLayoutProperty=function(c,m,x){x===void 0&&(x={}),m!=null&&this._validate(Cf,"layers."+this.id+".layout."+c,c,m,x)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},u.prototype.getPaintProperty=function(c){return mr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},u.prototype.setPaintProperty=function(c,m,x){if(x===void 0&&(x={}),m!=null&&this._validate(wf,"layers."+this.id+".paint."+c,c,m,x))return!1;if(mr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var E=this._transitionablePaint._values[c],T=E.property.specification["property-type"]==="cross-faded-data-driven",M=E.value.isDataDriven(),D=E.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var U=this._transitionablePaint._values[c].value;return U.isDataDriven()||M||T||this._handleOverridablePaintPropertyUpdate(c,D,U)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!1},u.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},u.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Et(c,function(m,x){return!(m===void 0||x==="layout"&&!Object.keys(m).length||x==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(c,m,x,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Gl(this,c.call(Gs,{key:m,layerType:this.type,objectKey:x,value:E,styleSpec:me,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof xo&&Tl(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(ct),xu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},bu=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ia=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function uo(o,u){u===void 0&&(u=1);var c=0,m=0;return{members:o.map(function(x){var E=xu[x.type].BYTES_PER_ELEMENT,T=c=hh(c,Math.max(u,E)),M=x.components||1;return m=Math.max(m,E),c+=E*M,{name:x.name,type:x.type,components:M,offset:T}}),size:hh(c,Math.max(m,u)),alignment:u}}function hh(o,u){return Math.ceil(o/u)*u}ia.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},ia.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},ia.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ia.prototype.clear=function(){this.length=0},ia.prototype.resize=function(o){this.reserve(o),this.length=o},ia.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},ia.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ml=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.int16[E+0]=m,this.int16[E+1]=x,c},u}(ia);Ml.prototype.bytesPerElement=4,_n("StructArrayLayout2i4",Ml);var Of=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,T){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=x,this.int16[M+2]=E,this.int16[M+3]=T,c},u}(ia);Of.prototype.bytesPerElement=8,_n("StructArrayLayout4i8",Of);var ol=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,T,M)},u.prototype.emplace=function(c,m,x,E,T,M,D){var U=6*c;return this.int16[U+0]=m,this.int16[U+1]=x,this.int16[U+2]=E,this.int16[U+3]=T,this.int16[U+4]=M,this.int16[U+5]=D,c},u}(ia);ol.prototype.bytesPerElement=12,_n("StructArrayLayout2i4i12",ol);var ls=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,T,M)},u.prototype.emplace=function(c,m,x,E,T,M,D){var U=4*c,H=8*c;return this.int16[U+0]=m,this.int16[U+1]=x,this.uint8[H+4]=E,this.uint8[H+5]=T,this.uint8[H+6]=M,this.uint8[H+7]=D,c},u}(ia);ls.prototype.bytesPerElement=8,_n("StructArrayLayout2i4ub8",ls);var Xl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.float32[E+0]=m,this.float32[E+1]=x,c},u}(ia);Xl.prototype.bytesPerElement=8,_n("StructArrayLayout2f8",Xl);var Eu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M,D,U,H,X){var ie=this.length;return this.resize(ie+1),this.emplace(ie,c,m,x,E,T,M,D,U,H,X)},u.prototype.emplace=function(c,m,x,E,T,M,D,U,H,X,ie){var he=10*c;return this.uint16[he+0]=m,this.uint16[he+1]=x,this.uint16[he+2]=E,this.uint16[he+3]=T,this.uint16[he+4]=M,this.uint16[he+5]=D,this.uint16[he+6]=U,this.uint16[he+7]=H,this.uint16[he+8]=X,this.uint16[he+9]=ie,c},u}(ia);Eu.prototype.bytesPerElement=20,_n("StructArrayLayout10ui20",Eu);var Df=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M,D,U,H,X,ie,he){var Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,c,m,x,E,T,M,D,U,H,X,ie,he)},u.prototype.emplace=function(c,m,x,E,T,M,D,U,H,X,ie,he,Fe){var Le=12*c;return this.int16[Le+0]=m,this.int16[Le+1]=x,this.int16[Le+2]=E,this.int16[Le+3]=T,this.uint16[Le+4]=M,this.uint16[Le+5]=D,this.uint16[Le+6]=U,this.uint16[Le+7]=H,this.int16[Le+8]=X,this.int16[Le+9]=ie,this.int16[Le+10]=he,this.int16[Le+11]=Fe,c},u}(ia);Df.prototype.bytesPerElement=24,_n("StructArrayLayout4i4ui4i24",Df);var bc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var T=3*c;return this.float32[T+0]=m,this.float32[T+1]=x,this.float32[T+2]=E,c},u}(ia);bc.prototype.bytesPerElement=12,_n("StructArrayLayout3f12",bc);var Jc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},u}(ia);Jc.prototype.bytesPerElement=4,_n("StructArrayLayout1ul4",Jc);var Ff=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M,D,U,H){var X=this.length;return this.resize(X+1),this.emplace(X,c,m,x,E,T,M,D,U,H)},u.prototype.emplace=function(c,m,x,E,T,M,D,U,H,X){var ie=10*c,he=5*c;return this.int16[ie+0]=m,this.int16[ie+1]=x,this.int16[ie+2]=E,this.int16[ie+3]=T,this.int16[ie+4]=M,this.int16[ie+5]=D,this.uint32[he+3]=U,this.uint16[ie+8]=H,this.uint16[ie+9]=X,c},u}(ia);Ff.prototype.bytesPerElement=20,_n("StructArrayLayout6i1ul2ui20",Ff);var $l=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,x,E,T,M)},u.prototype.emplace=function(c,m,x,E,T,M,D){var U=6*c;return this.int16[U+0]=m,this.int16[U+1]=x,this.int16[U+2]=E,this.int16[U+3]=T,this.int16[U+4]=M,this.int16[U+5]=D,c},u}(ia);$l.prototype.bytesPerElement=12,_n("StructArrayLayout2i2i2i12",$l);var Yl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,x,E,T)},u.prototype.emplace=function(c,m,x,E,T,M){var D=4*c,U=8*c;return this.float32[D+0]=m,this.float32[D+1]=x,this.float32[D+2]=E,this.int16[U+6]=T,this.int16[U+7]=M,c},u}(ia);Yl.prototype.bytesPerElement=16,_n("StructArrayLayout2f1f2i16",Yl);var ph=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,T){var M=12*c,D=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=x,this.float32[D+1]=E,this.float32[D+2]=T,c},u}(ia);ph.prototype.bytesPerElement=12,_n("StructArrayLayout2ub2f12",ph);var Jo=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var T=3*c;return this.uint16[T+0]=m,this.uint16[T+1]=x,this.uint16[T+2]=E,c},u}(ia);Jo.prototype.bytesPerElement=6,_n("StructArrayLayout3ui6",Jo);var Su=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt){var Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt)},u.prototype.emplace=function(c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt,Dt){var kt=24*c,Qt=12*c,fr=48*c;return this.int16[kt+0]=m,this.int16[kt+1]=x,this.uint16[kt+2]=E,this.uint16[kt+3]=T,this.uint32[Qt+2]=M,this.uint32[Qt+3]=D,this.uint32[Qt+4]=U,this.uint16[kt+10]=H,this.uint16[kt+11]=X,this.uint16[kt+12]=ie,this.float32[Qt+7]=he,this.float32[Qt+8]=Fe,this.uint8[fr+36]=Le,this.uint8[fr+37]=at,this.uint8[fr+38]=Ge,this.uint32[Qt+10]=yt,this.int16[kt+22]=Dt,c},u}(ia);Su.prototype.bytesPerElement=48,_n("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Su);var ef=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt,Dt,kt,Qt,fr,Br,$r,zn,hn,Hn,pn,an){var jr=this.length;return this.resize(jr+1),this.emplace(jr,c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt,Dt,kt,Qt,fr,Br,$r,zn,hn,Hn,pn,an)},u.prototype.emplace=function(c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le,at,Ge,yt,Dt,kt,Qt,fr,Br,$r,zn,hn,Hn,pn,an,jr){var Cn=34*c,ki=17*c;return this.int16[Cn+0]=m,this.int16[Cn+1]=x,this.int16[Cn+2]=E,this.int16[Cn+3]=T,this.int16[Cn+4]=M,this.int16[Cn+5]=D,this.int16[Cn+6]=U,this.int16[Cn+7]=H,this.uint16[Cn+8]=X,this.uint16[Cn+9]=ie,this.uint16[Cn+10]=he,this.uint16[Cn+11]=Fe,this.uint16[Cn+12]=Le,this.uint16[Cn+13]=at,this.uint16[Cn+14]=Ge,this.uint16[Cn+15]=yt,this.uint16[Cn+16]=Dt,this.uint16[Cn+17]=kt,this.uint16[Cn+18]=Qt,this.uint16[Cn+19]=fr,this.uint16[Cn+20]=Br,this.uint16[Cn+21]=$r,this.uint16[Cn+22]=zn,this.uint32[ki+12]=hn,this.float32[ki+13]=Hn,this.float32[ki+14]=pn,this.float32[ki+15]=an,this.float32[ki+16]=jr,c},u}(ia);ef.prototype.bytesPerElement=68,_n("StructArrayLayout8i15ui1ul4f68",ef);var Il=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},u}(ia);Il.prototype.bytesPerElement=4,_n("StructArrayLayout1f4",Il);var uu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var T=3*c;return this.int16[T+0]=m,this.int16[T+1]=x,this.int16[T+2]=E,c},u}(ia);uu.prototype.bytesPerElement=6,_n("StructArrayLayout3i6",uu);var dh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var T=4*c;return this.uint32[2*c+0]=m,this.uint16[T+2]=x,this.uint16[T+3]=E,c},u}(ia);dh.prototype.bytesPerElement=8,_n("StructArrayLayout1ul2ui8",dh);var Zu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.uint16[E+0]=m,this.uint16[E+1]=x,c},u}(ia);Zu.prototype.bytesPerElement=4,_n("StructArrayLayout2ui4",Zu);var kf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},u}(ia);kf.prototype.bytesPerElement=2,_n("StructArrayLayout1ui2",kf);var vh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var T=this.length;return this.resize(T+1),this.emplace(T,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,T){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=x,this.float32[M+2]=E,this.float32[M+3]=T,c},u}(ia);vh.prototype.bytesPerElement=16,_n("StructArrayLayout4f16",vh);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new te(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,c),u}(bu);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new h(this,c)},u}(Ff);_n("CollisionBoxArray",v);var p=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,c),u}(bu);p.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new p(this,c)},u}(Su);_n("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,c),u}(bu);S.prototype.size=68;var C=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new S(this,c)},u}(ef);_n("SymbolInstanceArray",C);var R=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(c){return this.float32[1*c+0]},u}(Il);_n("GlyphOffsetArray",R);var O=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(c){return this.int16[3*c+0]},u.prototype.gety=function(c){return this.int16[3*c+1]},u.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},u}(uu);_n("SymbolLineVertexArray",O);var j=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,c),u}(bu);j.prototype.size=8;var $=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new j(this,c)},u}(dh);_n("FeatureIndexArray",$);var pe=uo([{name:"a_pos",components:2,type:"Int16"}],4).members,_e=function(o){o===void 0&&(o=[]),this.segments=o};function xe(o,u){return 256*(o=Tt(Math.floor(o),0,255))+Tt(Math.floor(u),0,255)}_e.prototype.prepareSegment=function(o,u,c,m){var x=this.segments[this.segments.length-1];return o>_e.MAX_VERTEX_ARRAY_LENGTH&&vt("Max vertices per segment is "+_e.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!x||x.vertexLength+o>_e.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:u.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x},_e.prototype.get=function(){return this.segments},_e.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var c=u[o];for(var m in c.vaos)c.vaos[m].destroy()}},_e.simpleSegment=function(o,u,c,m){return new _e([{vertexOffset:o,primitiveOffset:u,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_n("SegmentVector",_e);var Ue=uo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Be=ce(function(o){o.exports=function(u,c){var m,x,E,T,M,D,U,H;for(x=u.length-(m=3&u.length),E=c,M=3432918353,D=461845907,H=0;H<x;)U=255&u.charCodeAt(H)|(255&u.charCodeAt(++H))<<8|(255&u.charCodeAt(++H))<<16|(255&u.charCodeAt(++H))<<24,++H,E=27492+(65535&(T=5*(65535&(E=(E^=U=(65535&(U=(U=(65535&U)*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(U=0,m){case 3:U^=(255&u.charCodeAt(H+2))<<16;case 2:U^=(255&u.charCodeAt(H+1))<<8;case 1:E^=U=(65535&(U=(U=(65535&(U^=255&u.charCodeAt(H)))*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),Qe=ce(function(o){o.exports=function(u,c){for(var m,x=u.length,E=c^x,T=0;x>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Ie=Be,qe=Qe;Ie.murmur3=Be,Ie.murmur2=qe;var ft=function(){this.ids=[],this.positions=[],this.indexed=!1};ft.prototype.add=function(o,u,c,m){this.ids.push($t(o)),this.positions.push(u,c,m)},ft.prototype.getPositions=function(o){for(var u=$t(o),c=0,m=this.ids.length-1;c<m;){var x=c+m>>1;this.ids[x]>=u?m=x:c=x+1}for(var E=[];this.ids[c]===u;)E.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return E},ft.serialize=function(o,u){var c=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function x(E,T,M,D){for(;M<D;){for(var U=E[M+D>>1],H=M-1,X=D+1;;){do H++;while(E[H]<U);do X--;while(E[X]>U);if(H>=X)break;jt(E,H,X),jt(T,3*H,3*X),jt(T,3*H+1,3*X+1),jt(T,3*H+2,3*X+2)}X-M<D-X?(x(E,T,M,X),M=X+1):(x(E,T,X+1,D),D=X)}}(c,m,0,c.length-1),u&&u.push(c.buffer,m.buffer),{ids:c,positions:m}},ft.deserialize=function(o){var u=new ft;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var Rt=Math.pow(2,53)-1;function $t(o){var u=+o;return!isNaN(u)&&u<=Rt?u:Ie(String(o))}function jt(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}_n("FeaturePositionMap",ft);var ir=function(o,u){this.gl=o.gl,this.location=u},pr=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},u}(ir),Ur=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},u}(ir),Fr=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},u}(ir),ln=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},u}(ir),Un=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},u}(ir),Bn=function(o){function u(c,m){o.call(this,c,m),this.current=Ai.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},u}(ir),Zn=new Float32Array(16),Zi=function(o){function u(c,m){o.call(this,c,m),this.current=Zn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},u}(ir);function mn(o){return[xe(255*o.r,255*o.g),xe(255*o.b,255*o.a)]}var oi=function(o,u,c){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=c};oi.prototype.setUniform=function(o,u,c){o.set(c.constantOr(this.value))},oi.prototype.getBinding=function(o,u,c){return this.type==="color"?new Bn(o,u):new Ur(o,u)};var vi=function(o,u){this.uniformNames=u.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};vi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},vi.prototype.setUniform=function(o,u,c,m){var x=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)},vi.prototype.getBinding=function(o,u,c){return c.substr(0,9)==="u_pattern"?new Un(o,u):new Ur(o,u)};var ai=function(o,u,c,m){this.expression=o,this.type=c,this.maxValue=0,this.paintVertexAttributes=u.map(function(x){return{name:"a_"+x,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ai.prototype.populatePaintArray=function(o,u,c,m,x){var E=this.paintVertexArray.length,T=this.expression.evaluate(new Ee(0),u,{},m,[],x);this.paintVertexArray.resize(o),this._setPaintValue(E,o,T)},ai.prototype.updatePaintArray=function(o,u,c,m){var x=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(o,u,x)},ai.prototype._setPaintValue=function(o,u,c){if(this.type==="color")for(var m=mn(c),x=o;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},ai.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ti=function(o,u,c,m,x,E){this.expression=o,this.uniformNames=u.map(function(T){return"u_"+T+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(function(T){return{name:"a_"+T,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ti.prototype.populatePaintArray=function(o,u,c,m,x){var E=this.expression.evaluate(new Ee(this.zoom),u,{},m,[],x),T=this.expression.evaluate(new Ee(this.zoom+1),u,{},m,[],x),M=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(M,o,E,T)},ti.prototype.updatePaintArray=function(o,u,c,m){var x=this.expression.evaluate({zoom:this.zoom},c,m),E=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(o,u,x,E)},ti.prototype._setPaintValue=function(o,u,c,m){if(this.type==="color")for(var x=mn(c),E=mn(m),T=o;T<u;T++)this.paintVertexArray.emplace(T,x[0],x[1],E[0],E[1]);else{for(var M=o;M<u;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},ti.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ti.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ti.prototype.setUniform=function(o,u){var c=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=Tt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);o.set(m)},ti.prototype.getBinding=function(o,u,c){return new Ur(o,u)};var pi=function(o,u,c,m,x,E){this.expression=o,this.type=u,this.useIntegerZoom=c,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};pi.prototype.populatePaintArray=function(o,u,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],c)},pi.prototype.updatePaintArray=function(o,u,c,m,x){this._setPaintValues(o,u,c.patterns&&c.patterns[this.layerId],x)},pi.prototype._setPaintValues=function(o,u,c,m){if(m&&c){var x=m[c.min],E=m[c.mid],T=m[c.max];if(x&&E&&T)for(var M=o;M<u;M++)this.zoomInPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},pi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Ue.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Ue.members,this.expression.isStateDependent))},pi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ri=function(o,u,c){this.binders={},this._buffers=[];var m=[];for(var x in o.paint._values)if(c(x)){var E=o.paint.get(x);if(E instanceof xo&&Tl(E.property.specification)){var T=bo(x,o.type),M=E.value,D=E.property.specification.type,U=E.property.useIntegerZoom,H=E.property.specification["property-type"],X=H==="cross-faded"||H==="cross-faded-data-driven";if(M.kind==="constant")this.binders[x]=X?new vi(M.value,T):new oi(M.value,T,D),m.push("/u_"+x);else if(M.kind==="source"||X){var ie=ja(x,D,"source");this.binders[x]=X?new pi(M,D,U,u,ie,o.id):new ai(M,T,D,ie),m.push("/a_"+x)}else{var he=ja(x,D,"composite");this.binders[x]=new ti(M,T,D,U,u,he),m.push("/z_"+x)}}}this.cacheKey=m.sort().join("")};ri.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof ai||u instanceof ti?u.maxValue:0},ri.prototype.populatePaintArrays=function(o,u,c,m,x){for(var E in this.binders){var T=this.binders[E];(T instanceof ai||T instanceof ti||T instanceof pi)&&T.populatePaintArray(o,u,c,m,x)}},ri.prototype.setConstantPatternPositions=function(o,u){for(var c in this.binders){var m=this.binders[c];m instanceof vi&&m.setConstantPatternPositions(o,u)}},ri.prototype.updatePaintArrays=function(o,u,c,m,x){var E=!1;for(var T in o)for(var M=0,D=u.getPositions(T);M<D.length;M+=1){var U=D[M],H=c.feature(U.index);for(var X in this.binders){var ie=this.binders[X];if((ie instanceof ai||ie instanceof ti||ie instanceof pi)&&ie.expression.isStateDependent===!0){var he=m.paint.get(X);ie.expression=he.value,ie.updatePaintArray(U.start,U.end,H,o[T],x),E=!0}}}return E},ri.prototype.defines=function(){var o=[];for(var u in this.binders){var c=this.binders[u];(c instanceof oi||c instanceof vi)&&o.push.apply(o,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},ri.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ai||c instanceof ti)for(var m=0;m<c.paintVertexAttributes.length;m++)o.push(c.paintVertexAttributes[m].name);else if(c instanceof pi)for(var x=0;x<Ue.members.length;x++)o.push(Ue.members[x].name)}return o},ri.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof oi||c instanceof vi||c instanceof ti)for(var m=0,x=c.uniformNames;m<x.length;m+=1)o.push(x[m])}return o},ri.prototype.getPaintVertexBuffers=function(){return this._buffers},ri.prototype.getUniforms=function(o,u){var c=[];for(var m in this.binders){var x=this.binders[m];if(x instanceof oi||x instanceof vi||x instanceof ti)for(var E=0,T=x.uniformNames;E<T.length;E+=1){var M=T[E];if(u[M]){var D=x.getBinding(o,u[M],M);c.push({name:M,property:m,binding:D})}}}return c},ri.prototype.setUniforms=function(o,u,c,m){for(var x=0,E=u;x<E.length;x+=1){var T=E[x],M=T.name,D=T.property;this.binders[D].setUniform(T.binding,m,c.get(D),M)}},ri.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var c=this.binders[u];if(o&&c instanceof pi){var m=o.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof ai||c instanceof ti)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},ri.prototype.upload=function(o){for(var u in this.binders){var c=this.binders[u];(c instanceof ai||c instanceof ti||c instanceof pi)&&c.upload(o)}this.updatePaintBuffers()},ri.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof ai||u instanceof ti||u instanceof pi)&&u.destroy()}};var $n=function(o,u,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,x=o;m<x.length;m+=1){var E=x[m];this.programConfigurations[E.id]=new ri(E,u,c)}this.needsUpload=!1,this._featureMap=new ft,this._bufferOffset=0};function bo(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function ja(o,u,c){var m={color:{source:Xl,composite:vh},number:{source:Il,composite:Xl}},x=function(E){return{"line-pattern":{source:Eu,composite:Eu},"fill-pattern":{source:Eu,composite:Eu},"fill-extrusion-pattern":{source:Eu,composite:Eu}}[E]}(o);return x&&x[c]||m[u][c]}$n.prototype.populatePaintArrays=function(o,u,c,m,x,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,u,m,x,E);u.id!==void 0&&this._featureMap.add(u.id,c,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},$n.prototype.updatePaintArrays=function(o,u,c,m){for(var x=0,E=c;x<E.length;x+=1){var T=E[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,u,T,m)||this.needsUpload}},$n.prototype.get=function(o){return this.programConfigurations[o]},$n.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},$n.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},_n("ConstantBinder",oi),_n("CrossFadedConstantBinder",vi),_n("SourceExpressionBinder",ai),_n("CrossFadedCompositeBinder",pi),_n("CompositeExpressionBinder",ti),_n("ProgramConfiguration",ri,{omit:["_buffers"]}),_n("ProgramConfigurationSet",$n);var Eo=Math.pow(2,14)-1,lo=-Eo-1;function Ba(o){for(var u=8192/o.extent,c=o.loadGeometry(),m=0;m<c.length;m++)for(var x=c[m],E=0;E<x.length;E++){var T=x[E],M=Math.round(T.x*u),D=Math.round(T.y*u);T.x=Tt(M,lo,Eo),T.y=Tt(D,lo,Eo),(M<T.x||M>T.x+1||D<T.y||D>T.y+1)&&vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function Ha(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?Ba(o):[]}}function cs(o,u,c,m,x){o.emplaceBack(2*u+(m+1)/2,2*c+(x+1)/2)}var fs=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Ml,this.indexArray=new Jo,this.segments=new _e,this.programConfigurations=new $n(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function sl(o,u){for(var c=0;c<o.length;c++)if(cu(u,o[c]))return!0;for(var m=0;m<u.length;m++)if(cu(o,u[m]))return!0;return!!Ec(o,u)}function hs(o,u,c){return!!cu(o,u)||!!Au(u,o,c)}function lu(o,u){if(o.length===1)return ul(u,o[0]);for(var c=0;c<u.length;c++)for(var m=u[c],x=0;x<m.length;x++)if(cu(o,m[x]))return!0;for(var E=0;E<o.length;E++)if(ul(u,o[E]))return!0;for(var T=0;T<u.length;T++)if(Ec(o,u[T]))return!0;return!1}function Bs(o,u,c){if(o.length>1){if(Ec(o,u))return!0;for(var m=0;m<u.length;m++)if(Au(u[m],o,c))return!0}for(var x=0;x<o.length;x++)if(Au(o[x],u,c))return!0;return!1}function Ec(o,u){if(o.length===0||u.length===0)return!1;for(var c=0;c<o.length-1;c++)for(var m=o[c],x=o[c+1],E=0;E<u.length-1;E++)if(Vu(m,x,u[E],u[E+1]))return!0;return!1}function Vu(o,u,c,m){return er(o,c,m)!==er(u,c,m)&&er(o,u,c)!==er(o,u,m)}function Au(o,u,c){var m=c*c;if(u.length===1)return o.distSqr(u[0])<m;for(var x=1;x<u.length;x++)if(ql(o,u[x-1],u[x])<m)return!0;return!1}function ql(o,u,c){var m=u.distSqr(c);if(m===0)return o.distSqr(u);var x=((o.x-u.x)*(c.x-u.x)+(o.y-u.y)*(c.y-u.y))/m;return o.distSqr(x<0?u:x>1?c:c.sub(u)._mult(x)._add(u))}function ul(o,u){for(var c,m,x,E=!1,T=0;T<o.length;T++)for(var M=0,D=(c=o[T]).length-1;M<c.length;D=M++)(m=c[M]).y>u.y!=(x=c[D]).y>u.y&&u.x<(x.x-m.x)*(u.y-m.y)/(x.y-m.y)+m.x&&(E=!E);return E}function cu(o,u){for(var c=!1,m=0,x=o.length-1;m<o.length;x=m++){var E=o[m],T=o[x];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(c=!c)}return c}function ll(o,u,c){var m=c[0],x=c[2];if(o.x<m.x&&u.x<m.x||o.x>x.x&&u.x>x.x||o.y<m.y&&u.y<m.y||o.y>x.y&&u.y>x.y)return!1;var E=er(o,u,c[0]);return E!==er(o,u,c[1])||E!==er(o,u,c[2])||E!==er(o,u,c[3])}function So(o,u,c){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:c.programConfigurations.get(u.id).getMaxValue(o)}function Qa(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function ys(o,u,c,m,x){if(!u[0]&&!u[1])return o;var E=te.convert(u)._mult(x);c==="viewport"&&E._rotate(-m);for(var T=[],M=0;M<o.length;M++)T.push(o[M].sub(E));return T}fs.prototype.populate=function(o,u,c){var m=this.layers[0],x=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var T=0,M=o;T<M.length;T+=1){var D=M[T],U=D.feature,H=D.id,X=D.index,ie=D.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,Fe=Ha(U,he);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),Fe,c)){var Le=E?E.evaluate(Fe,{},c):void 0,at={id:H,properties:U.properties,type:U.type,sourceLayerIndex:ie,index:X,geometry:he?Fe.geometry:Ba(U),patterns:{},sortKey:Le};x.push(at)}}E&&x.sort(function($r,zn){return $r.sortKey-zn.sortKey});for(var Ge=0,yt=x;Ge<yt.length;Ge+=1){var Dt=yt[Ge],kt=Dt.geometry,Qt=Dt.index,fr=Dt.sourceLayerIndex,Br=o[Qt].feature;this.addFeature(Dt,kt,Qt,c),u.featureIndex.insert(Br,kt,Qt,fr,this.index)}},fs.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,pe),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(o,u,c,m){for(var x=0,E=u;x<E.length;x+=1)for(var T=0,M=E[x];T<M.length;T+=1){var D=M[T],U=D.x,H=D.y;if(!(U<0||U>=8192||H<0||H>=8192)){var X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),ie=X.vertexLength;cs(this.layoutVertexArray,U,H,-1,-1),cs(this.layoutVertexArray,U,H,1,-1),cs(this.layoutVertexArray,U,H,1,1),cs(this.layoutVertexArray,U,H,-1,1),this.indexArray.emplaceBack(ie,ie+1,ie+2),this.indexArray.emplaceBack(ie,ie+3,ie+2),X.vertexLength+=4,X.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,{},m)},_n("CircleBucket",fs,{omit:["layers"]});var fu=new Ia({"circle-sort-key":new Sn(me.layout_circle["circle-sort-key"])}),Tu={paint:new Ia({"circle-radius":new Sn(me.paint_circle["circle-radius"]),"circle-color":new Sn(me.paint_circle["circle-color"]),"circle-blur":new Sn(me.paint_circle["circle-blur"]),"circle-opacity":new Sn(me.paint_circle["circle-opacity"]),"circle-translate":new kn(me.paint_circle["circle-translate"]),"circle-translate-anchor":new kn(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kn(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kn(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(me.paint_circle["circle-stroke-opacity"])}),layout:fu},Ui=typeof Float32Array!="undefined"?Float32Array:Array;function Go(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ja(o,u,c){var m=u[0],x=u[1],E=u[2],T=u[3],M=u[4],D=u[5],U=u[6],H=u[7],X=u[8],ie=u[9],he=u[10],Fe=u[11],Le=u[12],at=u[13],Ge=u[14],yt=u[15],Dt=c[0],kt=c[1],Qt=c[2],fr=c[3];return o[0]=Dt*m+kt*M+Qt*X+fr*Le,o[1]=Dt*x+kt*D+Qt*ie+fr*at,o[2]=Dt*E+kt*U+Qt*he+fr*Ge,o[3]=Dt*T+kt*H+Qt*Fe+fr*yt,o[4]=(Dt=c[4])*m+(kt=c[5])*M+(Qt=c[6])*X+(fr=c[7])*Le,o[5]=Dt*x+kt*D+Qt*ie+fr*at,o[6]=Dt*E+kt*U+Qt*he+fr*Ge,o[7]=Dt*T+kt*H+Qt*Fe+fr*yt,o[8]=(Dt=c[8])*m+(kt=c[9])*M+(Qt=c[10])*X+(fr=c[11])*Le,o[9]=Dt*x+kt*D+Qt*ie+fr*at,o[10]=Dt*E+kt*U+Qt*he+fr*Ge,o[11]=Dt*T+kt*H+Qt*Fe+fr*yt,o[12]=(Dt=c[12])*m+(kt=c[13])*M+(Qt=c[14])*X+(fr=c[15])*Le,o[13]=Dt*x+kt*D+Qt*ie+fr*at,o[14]=Dt*E+kt*U+Qt*he+fr*Ge,o[15]=Dt*T+kt*H+Qt*Fe+fr*yt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,c=arguments.length;c--;)u+=o[c]*o[c];return Math.sqrt(u)});var hu,Sc=Ja;function ju(o,u,c){var m=u[0],x=u[1],E=u[2],T=u[3];return o[0]=c[0]*m+c[4]*x+c[8]*E+c[12]*T,o[1]=c[1]*m+c[5]*x+c[9]*E+c[13]*T,o[2]=c[2]*m+c[6]*x+c[10]*E+c[14]*T,o[3]=c[3]*m+c[7]*x+c[11]*E+c[15]*T,o}hu=new Ui(3),Ui!=Float32Array&&(hu[0]=0,hu[1]=0,hu[2]=0),function(){var o=new Ui(4);Ui!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var mh=(function(){var o=new Ui(2);Ui!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(c){o.call(this,c,Tu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new fs(c)},u.prototype.queryRadius=function(c){var m=c;return So("circle-radius",this,m)+So("circle-stroke-width",this,m)+Qa(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,T,M,D,U){for(var H=ys(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),X=this.paint.get("circle-radius").evaluate(m,x)+this.paint.get("circle-stroke-width").evaluate(m,x),ie=this.paint.get("circle-pitch-alignment")==="map",he=ie?H:function(Br,$r){return Br.map(function(zn){return Ao(zn,$r)})}(H,U),Fe=ie?X*D:X,Le=0,at=E;Le<at.length;Le+=1)for(var Ge=0,yt=at[Le];Ge<yt.length;Ge+=1){var Dt=yt[Ge],kt=ie?Dt:Ao(Dt,U),Qt=Fe,fr=ju([],[Dt.x,Dt.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Qt*=fr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Qt*=M.cameraToCenterDistance/fr[3]),hs(he,kt,Qt))return!0}return!1},u}($s));function Ao(o,u){var c=ju([],[o.x,o.y,0,1],u);return new te(c[0]/c[3],c[1]/c[3])}var Mr=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(fs);function Ls(o,u,c,m){var x=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==x*E*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(x*E*c);return o.width=x,o.height=E,o.data=m,o}function gh(o,u,c){var m=u.width,x=u.height;if(m!==o.width||x!==o.height){var E=Ls({},{width:m,height:x},c);To(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,x)},c),o.width=m,o.height=x,o.data=E.data}}function To(o,u,c,m,x,E){if(x.width===0||x.height===0)return u;if(x.width>o.width||x.height>o.height||c.x>o.width-x.width||c.y>o.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>u.width||x.height>u.height||m.x>u.width-x.width||m.y>u.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=o.data,M=u.data,D=0;D<x.height;D++)for(var U=((c.y+D)*o.width+c.x)*E,H=((m.y+D)*u.width+m.x)*E,X=0;X<x.width*E;X++)M[H+X]=T[U+X];return u}_n("HeatmapBucket",Mr,{omit:["layers"]});var Ys=function(o,u){Ls(this,o,1,u)};Ys.prototype.resize=function(o){gh(this,o,1)},Ys.prototype.clone=function(){return new Ys({width:this.width,height:this.height},new Uint8Array(this.data))},Ys.copy=function(o,u,c,m,x){To(o,u,c,m,x,1)};var wo=function(o,u){Ls(this,o,4,u)};wo.prototype.resize=function(o){gh(this,o,4)},wo.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},wo.prototype.clone=function(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))},wo.copy=function(o,u,c,m,x){To(o,u,c,m,x,4)},_n("AlphaImage",Ys),_n("RGBAImage",wo);var Qh={paint:new Ia({"heatmap-radius":new Sn(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kn(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yu(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kn(me.paint_heatmap["heatmap-opacity"])})};function Kl(o){var u={},c=o.resolution||256,m=o.clips?o.clips.length:1,x=o.image||new wo({width:c,height:m}),E=function(Fe,Le,at){u[o.evaluationKey]=at;var Ge=o.expression.evaluate(u);x.data[Fe+Le+0]=Math.floor(255*Ge.r/Ge.a),x.data[Fe+Le+1]=Math.floor(255*Ge.g/Ge.a),x.data[Fe+Le+2]=Math.floor(255*Ge.b/Ge.a),x.data[Fe+Le+3]=Math.floor(255*Ge.a)};if(o.clips)for(var T=0,M=0;T<m;++T,M+=4*c)for(var D=0,U=0;D<c;D++,U+=4){var H=D/(c-1),X=o.clips[T];E(M,U,X.start*(1-H)+X.end*H)}else for(var ie=0,he=0;ie<c;ie++,he+=4)E(0,he,ie/(c-1));return x}var cl=function(o){function u(c){o.call(this,c,Qh),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Mr(c)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=Kl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}($s),Lp={paint:new Ia({"hillshade-illumination-direction":new kn(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kn(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kn(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kn(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kn(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kn(me.paint_hillshade["hillshade-accent-color"])})},og=function(o){function u(c){o.call(this,c,Lp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}($s),kv=uo([{name:"a_pos",components:2,type:"Int16"}],4).members,Bf=_h,Jh=_h;function _h(o,u,c){c=c||2;var m,x,E,T,M,D,U,H=u&&u.length,X=H?u[0]*c:o.length,ie=Rd(o,0,X,c,!0),he=[];if(!ie||ie.next===ie.prev)return he;if(H&&(ie=function(Le,at,Ge,yt){var Dt,kt,Qt,fr=[];for(Dt=0,kt=at.length;Dt<kt;Dt++)(Qt=Rd(Le,at[Dt]*yt,Dt<kt-1?at[Dt+1]*yt:Le.length,yt,!1))===Qt.next&&(Qt.steiner=!0),fr.push(ep(Qt));for(fr.sort(Id),Dt=0;Dt<fr.length;Dt++)Pd(fr[Dt],Ge),Ge=Ac(Ge,Ge.next);return Ge}(o,u,ie,c)),o.length>80*c){m=E=o[0],x=T=o[1];for(var Fe=c;Fe<X;Fe+=c)(M=o[Fe])<m&&(m=M),(D=o[Fe+1])<x&&(x=D),M>E&&(E=M),D>T&&(T=D);U=(U=Math.max(E-m,T-x))!==0?1/U:0}return yh(ie,he,c,m,x,U),he}function Rd(o,u,c,m,x){var E,T;if(x===Cc(o,u,c,m)>0)for(E=u;E<c;E+=m)T=xh(E,o[E],o[E+1],T);else for(E=c-m;E>=u;E-=m)T=xh(E,o[E],o[E+1],T);return T&&Lf(T,T.next)&&(Ol(T),T=T.next),T}function Ac(o,u){if(!o)return o;u||(u=o);var c,m=o;do if(c=!1,m.steiner||!Lf(m,m.next)&&Wa(m.prev,m,m.next)!==0)m=m.next;else{if(Ol(m),(m=u=m.prev)===m.next)break;c=!0}while(c||m!==u);return u}function yh(o,u,c,m,x,E,T){if(o){!T&&E&&function(H,X,ie,he){var Fe=H;do Fe.z===null&&(Fe.z=Pl(Fe.x,Fe.y,X,ie,he)),Fe.prevZ=Fe.prev,Fe.nextZ=Fe.next,Fe=Fe.next;while(Fe!==H);Fe.prevZ.nextZ=null,Fe.prevZ=null,function(Le){var at,Ge,yt,Dt,kt,Qt,fr,Br,$r=1;do{for(Ge=Le,Le=null,kt=null,Qt=0;Ge;){for(Qt++,yt=Ge,fr=0,at=0;at<$r&&(fr++,yt=yt.nextZ);at++);for(Br=$r;fr>0||Br>0&&yt;)fr!==0&&(Br===0||!yt||Ge.z<=yt.z)?(Dt=Ge,Ge=Ge.nextZ,fr--):(Dt=yt,yt=yt.nextZ,Br--),kt?kt.nextZ=Dt:Le=Dt,Dt.prevZ=kt,kt=Dt;Ge=yt}kt.nextZ=null,$r*=2}while(Qt>1)}(Fe)}(o,m,x,E);for(var M,D,U=o;o.prev!==o.next;)if(M=o.prev,D=o.next,E?Md(o,m,x,E):Bv(o))u.push(M.i/c),u.push(o.i/c),u.push(D.i/c),Ol(o),o=D.next,U=D.next;else if((o=D)===U){T?T===1?yh(o=sg(Ac(o),u,c),u,c,m,x,E,2):T===2&&Np(o,u,c,m,x,E):yh(Ac(o),u,c,m,x,E,1);break}}}function Bv(o){var u=o.prev,c=o,m=o.next;if(Wa(u,c,m)>=0)return!1;for(var x=o.next.next;x!==o.prev;){if(Tc(u.x,u.y,c.x,c.y,m.x,m.y,x.x,x.y)&&Wa(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Md(o,u,c,m){var x=o.prev,E=o,T=o.next;if(Wa(x,E,T)>=0)return!1;for(var M=x.x>E.x?x.x>T.x?x.x:T.x:E.x>T.x?E.x:T.x,D=x.y>E.y?x.y>T.y?x.y:T.y:E.y>T.y?E.y:T.y,U=Pl(x.x<E.x?x.x<T.x?x.x:T.x:E.x<T.x?E.x:T.x,x.y<E.y?x.y<T.y?x.y:T.y:E.y<T.y?E.y:T.y,u,c,m),H=Pl(M,D,u,c,m),X=o.prevZ,ie=o.nextZ;X&&X.z>=U&&ie&&ie.z<=H;){if(X!==o.prev&&X!==o.next&&Tc(x.x,x.y,E.x,E.y,T.x,T.y,X.x,X.y)&&Wa(X.prev,X,X.next)>=0||(X=X.prevZ,ie!==o.prev&&ie!==o.next&&Tc(x.x,x.y,E.x,E.y,T.x,T.y,ie.x,ie.y)&&Wa(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;X&&X.z>=U;){if(X!==o.prev&&X!==o.next&&Tc(x.x,x.y,E.x,E.y,T.x,T.y,X.x,X.y)&&Wa(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;ie&&ie.z<=H;){if(ie!==o.prev&&ie!==o.next&&Tc(x.x,x.y,E.x,E.y,T.x,T.y,ie.x,ie.y)&&Wa(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function sg(o,u,c){var m=o;do{var x=m.prev,E=m.next.next;!Lf(x,E)&&Nf(x,m,m.next,E)&&wc(x,E)&&wc(E,x)&&(u.push(x.i/c),u.push(m.i/c),u.push(E.i/c),Ol(m),Ol(m.next),m=o=E),m=m.next}while(m!==o);return Ac(m)}function Np(o,u,c,m,x,E){var T=o;do{for(var M=T.next.next;M!==T.prev;){if(T.i!==M.i&&zp(T,M)){var D=Uf(T,M);return T=Ac(T,T.next),D=Ac(D,D.next),yh(T,u,c,m,x,E),void yh(D,u,c,m,x,E)}M=M.next}T=T.next}while(T!==o)}function Id(o,u){return o.x-u.x}function Pd(o,u){if(u=function(m,x){var E,T=x,M=m.x,D=m.y,U=-1/0;do{if(D<=T.y&&D>=T.next.y&&T.next.y!==T.y){var H=T.x+(D-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(H<=M&&H>U){if(U=H,H===M){if(D===T.y)return T;if(D===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!E)return null;if(M===U)return E;var X,ie=E,he=E.x,Fe=E.y,Le=1/0;T=E;do M>=T.x&&T.x>=he&&M!==T.x&&Tc(D<Fe?M:U,D,he,Fe,D<Fe?U:M,D,T.x,T.y)&&(X=Math.abs(D-T.y)/(M-T.x),wc(T,m)&&(X<Le||X===Le&&(T.x>E.x||T.x===E.x&&Up(E,T)))&&(E=T,Le=X)),T=T.next;while(T!==ie);return E}(o,u)){var c=Uf(u,o);Ac(u,u.next),Ac(c,c.next)}}function Up(o,u){return Wa(o.prev,o,u.prev)<0&&Wa(u.next,o,o.next)<0}function Pl(o,u,c,m,x){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-c)*x)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*x)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function ep(o){var u=o,c=o;do(u.x<c.x||u.x===c.x&&u.y<c.y)&&(c=u),u=u.next;while(u!==o);return c}function Tc(o,u,c,m,x,E,T,M){return(x-T)*(u-M)-(o-T)*(E-M)>=0&&(o-T)*(m-M)-(c-T)*(u-M)>=0&&(c-T)*(E-M)-(x-T)*(m-M)>=0}function zp(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(c,m){var x=c;do{if(x.i!==c.i&&x.next.i!==c.i&&x.i!==m.i&&x.next.i!==m.i&&Nf(x,x.next,c,m))return!0;x=x.next}while(x!==c);return!1}(o,u)&&(wc(o,u)&&wc(u,o)&&function(c,m){var x=c,E=!1,T=(c.x+m.x)/2,M=(c.y+m.y)/2;do x.y>M!=x.next.y>M&&x.next.y!==x.y&&T<(x.next.x-x.x)*(M-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==c);return E}(o,u)&&(Wa(o.prev,o,u.prev)||Wa(o,u.prev,u))||Lf(o,u)&&Wa(o.prev,o,o.next)>0&&Wa(u.prev,u,u.next)>0)}function Wa(o,u,c){return(u.y-o.y)*(c.x-u.x)-(u.x-o.x)*(c.y-u.y)}function Lf(o,u){return o.x===u.x&&o.y===u.y}function Nf(o,u,c,m){var x=rf(Wa(o,u,c)),E=rf(Wa(o,u,m)),T=rf(Wa(c,m,o)),M=rf(Wa(c,m,u));return x!==E&&T!==M||!(x!==0||!tf(o,c,u))||!(E!==0||!tf(o,m,u))||!(T!==0||!tf(c,o,m))||!(M!==0||!tf(c,u,m))}function tf(o,u,c){return u.x<=Math.max(o.x,c.x)&&u.x>=Math.min(o.x,c.x)&&u.y<=Math.max(o.y,c.y)&&u.y>=Math.min(o.y,c.y)}function rf(o){return o>0?1:o<0?-1:0}function wc(o,u){return Wa(o.prev,o,o.next)<0?Wa(o,u,o.next)>=0&&Wa(o,o.prev,u)>=0:Wa(o,u,o.prev)<0||Wa(o,o.next,u)<0}function Uf(o,u){var c=new Ql(o.i,o.x,o.y),m=new Ql(u.i,u.x,u.y),x=o.next,E=u.prev;return o.next=u,u.prev=o,c.next=x,x.prev=c,m.next=c,c.prev=m,E.next=m,m.prev=E,m}function xh(o,u,c,m){var x=new Ql(o,u,c);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function Ol(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Ql(o,u,c){this.i=o,this.x=u,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Cc(o,u,c,m){for(var x=0,E=u,T=c-m;E<c;E+=m)x+=(o[T]-o[E])*(o[E+1]+o[T+1]),T=E;return x}function Od(o,u,c,m,x){(function E(T,M,D,U,H){for(;U>D;){if(U-D>600){var X=U-D+1,ie=M-D+1,he=Math.log(X),Fe=.5*Math.exp(2*he/3),Le=.5*Math.sqrt(he*Fe*(X-Fe)/X)*(ie-X/2<0?-1:1);E(T,M,Math.max(D,Math.floor(M-ie*Fe/X+Le)),Math.min(U,Math.floor(M+(X-ie)*Fe/X+Le)),H)}var at=T[M],Ge=D,yt=U;for(ps(T,D,M),H(T[U],at)>0&&ps(T,D,U);Ge<yt;){for(ps(T,Ge,yt),Ge++,yt--;H(T[Ge],at)<0;)Ge++;for(;H(T[yt],at)>0;)yt--}H(T[D],at)===0?ps(T,D,yt):ps(T,++yt,U),yt<=M&&(D=yt+1),M<=yt&&(U=yt-1)}})(o,u,c||0,m||o.length-1,x||nf)}function ps(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}function nf(o,u){return o<u?-1:o>u?1:0}function tp(o,u){var c=o.length;if(c<=1)return[o];for(var m,x,E=[],T=0;T<c;T++){var M=xr(o[T]);M!==0&&(o[T].area=Math.abs(M),x===void 0&&(x=M<0),x===M<0?(m&&E.push(m),m=[o[T]]):m.push(o[T]))}if(m&&E.push(m),u>1)for(var D=0;D<E.length;D++)E[D].length<=u||(Od(E[D],u,1,E[D].length-1,Zp),E[D]=E[D].slice(0,u));return E}function Zp(o,u){return u.area-o.area}function bh(o,u,c){for(var m=c.patternDependencies,x=!1,E=0,T=u;E<T.length;E+=1){var M=T[E].paint.get(o+"-pattern");M.isConstant()||(x=!0);var D=M.constantOr(null);D&&(x=!0,m[D.to]=!0,m[D.from]=!0)}return x}function Vp(o,u,c,m,x){for(var E=x.patternDependencies,T=0,M=u;T<M.length;T+=1){var D=M[T],U=D.paint.get(o+"-pattern").value;if(U.kind!=="constant"){var H=U.evaluate({zoom:m-1},c,{},x.availableImages),X=U.evaluate({zoom:m},c,{},x.availableImages),ie=U.evaluate({zoom:m+1},c,{},x.availableImages);X=X&&X.name?X.name:X,ie=ie&&ie.name?ie.name:ie,E[H=H&&H.name?H.name:H]=!0,E[X]=!0,E[ie]=!0,c.patterns[D.id]={min:H,mid:X,max:ie}}}return c}_h.deviation=function(o,u,c,m){var x=u&&u.length,E=Math.abs(Cc(o,0,x?u[0]*c:o.length,c));if(x)for(var T=0,M=u.length;T<M;T++)E-=Math.abs(Cc(o,u[T]*c,T<M-1?u[T+1]*c:o.length,c));var D=0;for(T=0;T<m.length;T+=3){var U=m[T]*c,H=m[T+1]*c,X=m[T+2]*c;D+=Math.abs((o[U]-o[X])*(o[H+1]-o[U+1])-(o[U]-o[H])*(o[X+1]-o[U+1]))}return E===0&&D===0?0:Math.abs((D-E)/E)},_h.flatten=function(o){for(var u=o[0][0].length,c={vertices:[],holes:[],dimensions:u},m=0,x=0;x<o.length;x++){for(var E=0;E<o[x].length;E++)for(var T=0;T<u;T++)c.vertices.push(o[x][E][T]);x>0&&c.holes.push(m+=o[x-1].length)}return c},Bf.default=Jh;var qs=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ml,this.indexArray=new Jo,this.indexArray2=new Zu,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};qs.prototype.populate=function(o,u,c){this.hasPattern=bh("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],D=M.feature,U=M.id,H=M.index,X=M.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,he=Ha(D,ie);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),he,c)){var Fe=m?m.evaluate(he,{},c,u.availableImages):void 0,Le={id:U,properties:D.properties,type:D.type,sourceLayerIndex:X,index:H,geometry:ie?he.geometry:Ba(D),patterns:{},sortKey:Fe};x.push(Le)}}m&&x.sort(function(Br,$r){return Br.sortKey-$r.sortKey});for(var at=0,Ge=x;at<Ge.length;at+=1){var yt=Ge[at],Dt=yt.geometry,kt=yt.index,Qt=yt.sourceLayerIndex;if(this.hasPattern){var fr=Vp("fill",this.layers,yt,this.zoom,u);this.patternFeatures.push(fr)}else this.addFeature(yt,Dt,kt,c,{});u.featureIndex.insert(o[kt].feature,Dt,kt,Qt,this.index)}},qs.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},qs.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},qs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qs.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,kv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},qs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},qs.prototype.addFeature=function(o,u,c,m,x){for(var E=0,T=tp(u,500);E<T.length;E+=1){for(var M=T[E],D=0,U=0,H=M;U<H.length;U+=1)D+=H[U].length;for(var X=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ie=X.vertexLength,he=[],Fe=[],Le=0,at=M;Le<at.length;Le+=1){var Ge=at[Le];if(Ge.length!==0){Ge!==M[0]&&Fe.push(he.length/2);var yt=this.segments2.prepareSegment(Ge.length,this.layoutVertexArray,this.indexArray2),Dt=yt.vertexLength;this.layoutVertexArray.emplaceBack(Ge[0].x,Ge[0].y),this.indexArray2.emplaceBack(Dt+Ge.length-1,Dt),he.push(Ge[0].x),he.push(Ge[0].y);for(var kt=1;kt<Ge.length;kt++)this.layoutVertexArray.emplaceBack(Ge[kt].x,Ge[kt].y),this.indexArray2.emplaceBack(Dt+kt-1,Dt+kt),he.push(Ge[kt].x),he.push(Ge[kt].y);yt.vertexLength+=Ge.length,yt.primitiveLength+=Ge.length}}for(var Qt=Bf(he,Fe),fr=0;fr<Qt.length;fr+=3)this.indexArray.emplaceBack(ie+Qt[fr],ie+Qt[fr+1],ie+Qt[fr+2]);X.vertexLength+=D,X.primitiveLength+=Qt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},_n("FillBucket",qs,{omit:["layers","patternFeatures"]});var Rc=new Ia({"fill-sort-key":new Sn(me.layout_fill["fill-sort-key"])}),rp={paint:new Ia({"fill-antialias":new kn(me.paint_fill["fill-antialias"]),"fill-opacity":new Sn(me.paint_fill["fill-opacity"]),"fill-color":new Sn(me.paint_fill["fill-color"]),"fill-outline-color":new Sn(me.paint_fill["fill-outline-color"]),"fill-translate":new kn(me.paint_fill["fill-translate"]),"fill-translate-anchor":new kn(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ko(me.paint_fill["fill-pattern"])}),layout:Rc},Dd=function(o){function u(c){o.call(this,c,rp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(c){return new qs(c)},u.prototype.queryRadius=function(){return Qa(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,T,M,D){return lu(ys(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),E)},u.prototype.isTileClipped=function(){return!0},u}($s),Eh=uo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,jp=Jl;function Jl(o,u,c,m,x){this.properties={},this.extent=c,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=x,o.readFields(Hp,this,u)}function Hp(o,u,c){o==1?u.id=c.readVarint():o==2?function(m,x){for(var E=m.readVarint()+m.pos;m.pos<E;){var T=x._keys[m.readVarint()],M=x._values[m.readVarint()];x.properties[T]=M}}(c,u):o==3?u.type=c.readVarint():o==4&&(u._geometry=c.pos)}function fl(o){for(var u,c,m=0,x=0,E=o.length,T=E-1;x<E;T=x++)m+=((c=o[T]).x-(u=o[x]).x)*(u.y+c.y);return m}Jl.types=["Unknown","Point","LineString","Polygon"],Jl.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,c=o.readVarint()+o.pos,m=1,x=0,E=0,T=0,M=[];o.pos<c;){if(x<=0){var D=o.readVarint();m=7&D,x=D>>3}if(x--,m===1||m===2)E+=o.readSVarint(),T+=o.readSVarint(),m===1&&(u&&M.push(u),u=[]),u.push(new te(E,T));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&M.push(u),M},Jl.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,c=1,m=0,x=0,E=0,T=1/0,M=-1/0,D=1/0,U=-1/0;o.pos<u;){if(m<=0){var H=o.readVarint();c=7&H,m=H>>3}if(m--,c===1||c===2)(x+=o.readSVarint())<T&&(T=x),x>M&&(M=x),(E+=o.readSVarint())<D&&(D=E),E>U&&(U=E);else if(c!==7)throw new Error("unknown command "+c)}return[T,D,M,U]},Jl.prototype.toGeoJSON=function(o,u,c){var m,x,E=this.extent*Math.pow(2,c),T=this.extent*o,M=this.extent*u,D=this.loadGeometry(),U=Jl.types[this.type];function H(he){for(var Fe=0;Fe<he.length;Fe++){var Le=he[Fe];he[Fe]=[360*(Le.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Le.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(m=0;m<D.length;m++)X[m]=D[m][0];H(D=X);break;case 2:for(m=0;m<D.length;m++)H(D[m]);break;case 3:for(D=function(he){var Fe=he.length;if(Fe<=1)return[he];for(var Le,at,Ge=[],yt=0;yt<Fe;yt++){var Dt=fl(he[yt]);Dt!==0&&(at===void 0&&(at=Dt<0),at===Dt<0?(Le&&Ge.push(Le),Le=[he[yt]]):Le.push(he[yt]))}return Le&&Ge.push(Le),Ge}(D),m=0;m<D.length;m++)for(x=0;x<D[m].length;x++)H(D[m][x])}D.length===1?D=D[0]:U="Multi"+U;var ie={type:"Feature",geometry:{type:U,coordinates:D},properties:this.properties};return"id"in this&&(ie.id=this.id),ie};var np=Ks;function Ks(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Mc,this,u),this.length=this._features.length}function Mc(o,u,c){o===15?u.version=c.readVarint():o===1?u.name=c.readString():o===5?u.extent=c.readVarint():o===2?u._features.push(c.pos):o===3?u._keys.push(c.readString()):o===4&&u._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;x=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return x}(c))}function Wp(o,u,c){if(o===3){var m=new np(c,c.readVarint()+c.pos);m.length&&(u[m.name]=m)}}Ks.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new jp(this._pbf,u,this.extent,this._keys,this._values)};var ec={VectorTile:function(o,u){this.layers=o.readFields(Wp,{},u)},VectorTileFeature:jp,VectorTileLayer:np},zf=ec.VectorTileFeature.types,Zf=Math.pow(2,13);function xs(o,u,c,m,x,E,T,M){o.emplaceBack(u,c,2*Math.floor(m*Zf)+T,x*Zf*2,E*Zf*2,Math.round(M))}var ds=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ol,this.indexArray=new Jo,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Co(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}ds.prototype.populate=function(o,u,c){this.features=[],this.hasPattern=bh("fill-extrusion",this.layers,u);for(var m=0,x=o;m<x.length;m+=1){var E=x[m],T=E.feature,M=E.id,D=E.index,U=E.sourceLayerIndex,H=this.layers[0]._featureFilter.needGeometry,X=Ha(T,H);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),X,c)){var ie={id:M,sourceLayerIndex:U,index:D,geometry:H?X.geometry:Ba(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Vp("fill-extrusion",this.layers,ie,this.zoom,u)):this.addFeature(ie,ie.geometry,D,c,{}),u.featureIndex.insert(T,ie.geometry,D,U,this.index,!0)}}},ds.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.features;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},ds.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ds.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Eh),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ds.prototype.addFeature=function(o,u,c,m,x){for(var E=0,T=tp(u,500);E<T.length;E+=1){for(var M=T[E],D=0,U=0,H=M;U<H.length;U+=1)D+=H[U].length;for(var X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ie=0,he=M;ie<he.length;ie+=1){var Fe=he[ie];if(Fe.length!==0&&!((ki=Fe).every(function(bi){return bi.x<0})||ki.every(function(bi){return bi.x>8192})||ki.every(function(bi){return bi.y<0})||ki.every(function(bi){return bi.y>8192})))for(var Le=0,at=0;at<Fe.length;at++){var Ge=Fe[at];if(at>=1){var yt=Fe[at-1];if(!Co(Ge,yt)){X.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Dt=Ge.sub(yt)._perp()._unit(),kt=yt.dist(Ge);Le+kt>32768&&(Le=0),xs(this.layoutVertexArray,Ge.x,Ge.y,Dt.x,Dt.y,0,0,Le),xs(this.layoutVertexArray,Ge.x,Ge.y,Dt.x,Dt.y,0,1,Le),xs(this.layoutVertexArray,yt.x,yt.y,Dt.x,Dt.y,0,0,Le+=kt),xs(this.layoutVertexArray,yt.x,yt.y,Dt.x,Dt.y,0,1,Le);var Qt=X.vertexLength;this.indexArray.emplaceBack(Qt,Qt+2,Qt+1),this.indexArray.emplaceBack(Qt+1,Qt+2,Qt+3),X.vertexLength+=4,X.primitiveLength+=2}}}}if(X.vertexLength+D>_e.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),zf[o.type]==="Polygon"){for(var fr=[],Br=[],$r=X.vertexLength,zn=0,hn=M;zn<hn.length;zn+=1){var Hn=hn[zn];if(Hn.length!==0){Hn!==M[0]&&Br.push(fr.length/2);for(var pn=0;pn<Hn.length;pn++){var an=Hn[pn];xs(this.layoutVertexArray,an.x,an.y,0,0,1,1,0),fr.push(an.x),fr.push(an.y)}}}for(var jr=Bf(fr,Br),Cn=0;Cn<jr.length;Cn+=3)this.indexArray.emplaceBack($r+jr[Cn],$r+jr[Cn+2],$r+jr[Cn+1]);X.primitiveLength+=jr.length/3,X.vertexLength+=D}}var ki;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},_n("FillExtrusionBucket",ds,{omit:["layers","features"]});var Qs={paint:new Ia({"fill-extrusion-opacity":new kn(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kn(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kn(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ko(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kn(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ip=function(o){function u(c){o.call(this,c,Qs)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new ds(c)},u.prototype.queryRadius=function(){return Qa(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(c,m,x,E,T,M,D,U){var H=ys(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),X=this.paint.get("fill-extrusion-height").evaluate(m,x),ie=this.paint.get("fill-extrusion-base").evaluate(m,x),he=function(Le,at,Ge,yt){for(var Dt=[],kt=0,Qt=Le;kt<Qt.length;kt+=1){var fr=Qt[kt],Br=[fr.x,fr.y,0,1];ju(Br,Br,at),Dt.push(new te(Br[0]/Br[3],Br[1]/Br[3]))}return Dt}(H,U),Fe=function(Le,at,Ge,yt){for(var Dt=[],kt=[],Qt=yt[8]*at,fr=yt[9]*at,Br=yt[10]*at,$r=yt[11]*at,zn=yt[8]*Ge,hn=yt[9]*Ge,Hn=yt[10]*Ge,pn=yt[11]*Ge,an=0,jr=Le;an<jr.length;an+=1){for(var Cn=[],ki=[],bi=0,Yi=jr[an];bi<Yi.length;bi+=1){var Xn=Yi[bi],aa=Xn.x,Xa=Xn.y,po=yt[0]*aa+yt[4]*Xa+yt[12],no=yt[1]*aa+yt[5]*Xa+yt[13],$a=yt[2]*aa+yt[6]*Xa+yt[14],vo=yt[3]*aa+yt[7]*Xa+yt[15],rs=$a+Br,ns=vo+$r,tu=po+zn,is=no+hn,ru=$a+Hn,Io=vo+pn,vs=new te((po+Qt)/ns,(no+fr)/ns);vs.z=rs/ns,Cn.push(vs);var Vi=new te(tu/Io,is/Io);Vi.z=ru/Io,ki.push(Vi)}Dt.push(Cn),kt.push(ki)}return[Dt,kt]}(E,ie,X,U);return function(Le,at,Ge){var yt=1/0;lu(Ge,at)&&(yt=Gp(Ge,at[0]));for(var Dt=0;Dt<at.length;Dt++)for(var kt=at[Dt],Qt=Le[Dt],fr=0;fr<kt.length-1;fr++){var Br=kt[fr],$r=[Br,kt[fr+1],Qt[fr+1],Qt[fr],Br];sl(Ge,$r)&&(yt=Math.min(yt,Gp(Ge,$r)))}return yt!==1/0&&yt}(Fe[0],Fe[1],he)},u}($s);function Vf(o,u){return o.x*u.x+o.y*u.y}function Gp(o,u){if(o.length===1){for(var c,m=0,x=u[m++];!c||x.equals(c);)if(!(c=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],T=o[0],M=c.sub(x),D=E.sub(x),U=T.sub(x),H=Vf(M,M),X=Vf(M,D),ie=Vf(D,D),he=Vf(U,M),Fe=Vf(U,D),Le=H*ie-X*X,at=(ie*he-X*Fe)/Le,Ge=(H*Fe-X*he)/Le,yt=x.z*(1-at-Ge)+c.z*at+E.z*Ge;if(isFinite(yt))return yt}return 1/0}for(var Dt=1/0,kt=0,Qt=u;kt<Qt.length;kt+=1)Dt=Math.min(Dt,Qt[kt].z);return Dt}var Lv=uo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Nv=uo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ap=ec.VectorTileFeature.types,Uv=Math.cos(Math.PI/180*37.5),Fd=Math.pow(2,14)/.5,Xo=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){u.gradients[c.id]={}}),this.layoutVertexArray=new ls,this.layoutVertexArray2=new Xl,this.indexArray=new Jo,this.programConfigurations=new $n(o.layers,o.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Xo.prototype.populate=function(o,u,c){this.hasPattern=bh("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),x=[],E=0,T=o;E<T.length;E+=1){var M=T[E],D=M.feature,U=M.id,H=M.index,X=M.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,he=Ha(D,ie);if(this.layers[0]._featureFilter.filter(new Ee(this.zoom),he,c)){var Fe=m?m.evaluate(he,{},c):void 0,Le={id:U,properties:D.properties,type:D.type,sourceLayerIndex:X,index:H,geometry:ie?he.geometry:Ba(D),patterns:{},sortKey:Fe};x.push(Le)}}m&&x.sort(function(Br,$r){return Br.sortKey-$r.sortKey});for(var at=0,Ge=x;at<Ge.length;at+=1){var yt=Ge[at],Dt=yt.geometry,kt=yt.index,Qt=yt.sourceLayerIndex;if(this.hasPattern){var fr=Vp("line",this.layers,yt,this.zoom,u);this.patternFeatures.push(fr)}else this.addFeature(yt,Dt,kt,c,{});u.featureIndex.insert(o[kt].feature,Dt,kt,Qt,this.index)}},Xo.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Xo.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},Xo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xo.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Nv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Lv),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Xo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xo.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},Xo.prototype.addFeature=function(o,u,c,m,x){var E=this.layers[0].layout,T=E.get("line-join").evaluate(o,{}),M=E.get("line-cap"),D=E.get("line-miter-limit"),U=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var H=0,X=u;H<X.length;H+=1)this.addLine(X[H],o,T,M,D,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},Xo.prototype.addLine=function(o,u,c,m,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<o.length-1;T++)this.totalDistance+=o[T].dist(o[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=ap[u.type]==="Polygon",D=o.length;D>=2&&o[D-1].equals(o[D-2]);)D--;for(var U=0;U<D-1&&o[U].equals(o[U+1]);)U++;if(!(D<(M?3:2))){c==="bevel"&&(x=1.05);var H,X=this.overscaling<=16?122880/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),he=void 0,Fe=void 0,Le=void 0,at=void 0;this.e1=this.e2=-1,M&&(at=o[U].sub(H=o[D-2])._unit()._perp());for(var Ge=U;Ge<D;Ge++)if(!(Fe=Ge===D-1?M?o[U+1]:void 0:o[Ge+1])||!o[Ge].equals(Fe)){at&&(Le=at),H&&(he=H),H=o[Ge],at=Fe?Fe.sub(H)._unit()._perp():Le;var yt=(Le=Le||at).add(at);yt.x===0&&yt.y===0||yt._unit();var Dt=Le.x*at.x+Le.y*at.y,kt=yt.x*at.x+yt.y*at.y,Qt=kt!==0?1/kt:1/0,fr=2*Math.sqrt(2-2*kt),Br=kt<Uv&&he&&Fe,$r=Le.x*at.y-Le.y*at.x>0;if(Br&&Ge>U){var zn=H.dist(he);if(zn>2*X){var hn=H.sub(H.sub(he)._mult(X/zn)._round());this.updateDistance(he,hn),this.addCurrentVertex(hn,Le,0,0,ie),he=hn}}var Hn=he&&Fe,pn=Hn?c:M?"butt":m;if(Hn&&pn==="round"&&(Qt<E?pn="miter":Qt<=2&&(pn="fakeround")),pn==="miter"&&Qt>x&&(pn="bevel"),pn==="bevel"&&(Qt>2&&(pn="flipbevel"),Qt<x&&(pn="miter")),he&&this.updateDistance(he,H),pn==="miter")yt._mult(Qt),this.addCurrentVertex(H,yt,0,0,ie);else if(pn==="flipbevel"){if(Qt>100)yt=at.mult(-1);else{var an=Qt*Le.add(at).mag()/Le.sub(at).mag();yt._perp()._mult(an*($r?-1:1))}this.addCurrentVertex(H,yt,0,0,ie),this.addCurrentVertex(H,yt.mult(-1),0,0,ie)}else if(pn==="bevel"||pn==="fakeround"){var jr=-Math.sqrt(Qt*Qt-1),Cn=$r?jr:0,ki=$r?0:jr;if(he&&this.addCurrentVertex(H,Le,Cn,ki,ie),pn==="fakeround")for(var bi=Math.round(180*fr/Math.PI/20),Yi=1;Yi<bi;Yi++){var Xn=Yi/bi;if(Xn!==.5){var aa=Xn-.5;Xn+=Xn*aa*(Xn-1)*((1.0904+Dt*(Dt*(3.55645-1.43519*Dt)-3.2452))*aa*aa+(.848013+Dt*(.215638*Dt-1.06021)))}var Xa=at.sub(Le)._mult(Xn)._add(Le)._unit()._mult($r?-1:1);this.addHalfVertex(H,Xa.x,Xa.y,!1,$r,0,ie)}Fe&&this.addCurrentVertex(H,at,-Cn,-ki,ie)}else if(pn==="butt")this.addCurrentVertex(H,yt,0,0,ie);else if(pn==="square"){var po=he?1:-1;this.addCurrentVertex(H,yt,po,po,ie)}else pn==="round"&&(he&&(this.addCurrentVertex(H,Le,0,0,ie),this.addCurrentVertex(H,Le,1,1,ie,!0)),Fe&&(this.addCurrentVertex(H,at,-1,-1,ie,!0),this.addCurrentVertex(H,at,0,0,ie)));if(Br&&Ge<D-1){var no=H.dist(Fe);if(no>2*X){var $a=H.add(Fe.sub(H)._mult(X/no)._round());this.updateDistance(H,$a),this.addCurrentVertex($a,at,0,0,ie),H=$a}}}}},Xo.prototype.addCurrentVertex=function(o,u,c,m,x,E){E===void 0&&(E=!1);var T=u.y*m-u.x,M=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*c,u.y-u.x*c,E,!1,c,x),this.addHalfVertex(o,T,M,E,!0,-m,x),this.distance>Fd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,c,m,x,E))},Xo.prototype.addHalfVertex=function(o,u,c,m,x,E,T){var M=.5*(this.lineClips?this.scaledDistance*(Fd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*c)+128,1+(E===0?0:E<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),x?this.e2=D:this.e1=D},Xo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Xo.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},_n("LineBucket",Xo,{omit:["layers","patternFeatures"]});var Xp=new Ia({"line-cap":new kn(me.layout_line["line-cap"]),"line-join":new Sn(me.layout_line["line-join"]),"line-miter-limit":new kn(me.layout_line["line-miter-limit"]),"line-round-limit":new kn(me.layout_line["line-round-limit"]),"line-sort-key":new Sn(me.layout_line["line-sort-key"])}),kd={paint:new Ia({"line-opacity":new Sn(me.paint_line["line-opacity"]),"line-color":new Sn(me.paint_line["line-color"]),"line-translate":new kn(me.paint_line["line-translate"]),"line-translate-anchor":new kn(me.paint_line["line-translate-anchor"]),"line-width":new Sn(me.paint_line["line-width"]),"line-gap-width":new Sn(me.paint_line["line-gap-width"]),"line-offset":new Sn(me.paint_line["line-offset"]),"line-blur":new Sn(me.paint_line["line-blur"]),"line-dasharray":new Qo(me.paint_line["line-dasharray"]),"line-pattern":new Ko(me.paint_line["line-pattern"]),"line-gradient":new yu(me.paint_line["line-gradient"])}),layout:Xp},af=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m){return m=new Ee(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,c,m)},u.prototype.evaluate=function(c,m,x,E){return m=Gt({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,c,m,x,E)},u}(Sn))(kd.paint.properties["line-width"].specification);af.useIntegerZoom=!0;var Bd=function(o){function u(c){o.call(this,c,kd),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Ze)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=af.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},u.prototype.createBucket=function(c){return new Xo(c)},u.prototype.queryRadius=function(c){var m=c,x=$p(So("line-width",this,m),So("line-gap-width",this,m)),E=So("line-offset",this,m);return x/2+Math.abs(E)+Qa(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,T,M,D){var U=ys(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),H=D/2*$p(this.paint.get("line-width").evaluate(m,x),this.paint.get("line-gap-width").evaluate(m,x)),X=this.paint.get("line-offset").evaluate(m,x);return X&&(E=function(ie,he){for(var Fe=[],Le=new te(0,0),at=0;at<ie.length;at++){for(var Ge=ie[at],yt=[],Dt=0;Dt<Ge.length;Dt++){var kt=Ge[Dt],Qt=Ge[Dt+1],fr=Dt===0?Le:kt.sub(Ge[Dt-1])._unit()._perp(),Br=Dt===Ge.length-1?Le:Qt.sub(kt)._unit()._perp(),$r=fr._add(Br)._unit();$r._mult(1/($r.x*Br.x+$r.y*Br.y)),yt.push($r._mult(he)._add(kt))}Fe.push(yt)}return Fe}(E,X*D)),function(ie,he,Fe){for(var Le=0;Le<he.length;Le++){var at=he[Le];if(ie.length>=3){for(var Ge=0;Ge<at.length;Ge++)if(cu(ie,at[Ge]))return!0}if(Bs(ie,at,Fe))return!0}return!1}(U,E,H)},u.prototype.isTileClipped=function(){return!0},u}($s);function $p(o,u){return u>0?u+2*o:o}var zv=uo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zv=uo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ld=(uo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),uo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Nd=(uo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),uo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),V=uo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Se(o,u,c){return o.sections.forEach(function(m){m.text=function(x,E,T){var M=E.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?x=x.toLocaleUpperCase():M==="lowercase"&&(x=x.toLocaleLowerCase()),Ot.applyArabicShaping&&(x=Ot.applyArabicShaping(x)),x}(m.text,u,c)}),o}uo([{name:"triangle",components:3,type:"Uint16"}]),uo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),uo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),uo([{type:"Float32",name:"offsetX"}]),uo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var He={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Ht=function(o,u,c,m,x){var E,T,M=8*x-m-1,D=(1<<M)-1,U=D>>1,H=-7,X=c?x-1:0,ie=c?-1:1,he=o[u+X];for(X+=ie,E=he&(1<<-H)-1,he>>=-H,H+=M;H>0;E=256*E+o[u+X],X+=ie,H-=8);for(T=E&(1<<-H)-1,E>>=-H,H+=m;H>0;T=256*T+o[u+X],X+=ie,H-=8);if(E===0)E=1-U;else{if(E===D)return T?NaN:1/0*(he?-1:1);T+=Math.pow(2,m),E-=U}return(he?-1:1)*T*Math.pow(2,E-m)},cr=function(o,u,c,m,x,E){var T,M,D,U=8*E-x-1,H=(1<<U)-1,X=H>>1,ie=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,he=m?0:E-1,Fe=m?1:-1,Le=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(M=isNaN(u)?1:0,T=H):(T=Math.floor(Math.log(u)/Math.LN2),u*(D=Math.pow(2,-T))<1&&(T--,D*=2),(u+=T+X>=1?ie/D:ie*Math.pow(2,1-X))*D>=2&&(T++,D/=2),T+X>=H?(M=0,T=H):T+X>=1?(M=(u*D-1)*Math.pow(2,x),T+=X):(M=u*Math.pow(2,X-1)*Math.pow(2,x),T=0));x>=8;o[c+he]=255&M,he+=Fe,M/=256,x-=8);for(T=T<<x|M,U+=x;U>0;o[c+he]=255&T,he+=Fe,T/=256,U-=8);o[c+he-Fe]|=128*Le},Xt=Lt;function Lt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Lt.Varint=0,Lt.Fixed64=1,Lt.Bytes=2,Lt.Fixed32=5;var Dr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Tr(o){return o.type===Lt.Bytes?o.readVarint()+o.pos:o.pos+1}function Vr(o,u,c){return c?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function kr(o,u,c){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));c.realloc(m);for(var x=c.pos-1;x>=o;x--)c.buf[x+m]=c.buf[x]}function Zr(o,u){for(var c=0;c<o.length;c++)u.writeVarint(o[c])}function Xr(o,u){for(var c=0;c<o.length;c++)u.writeSVarint(o[c])}function wr(o,u){for(var c=0;c<o.length;c++)u.writeFloat(o[c])}function Nr(o,u){for(var c=0;c<o.length;c++)u.writeDouble(o[c])}function At(o,u){for(var c=0;c<o.length;c++)u.writeBoolean(o[c])}function tr(o,u){for(var c=0;c<o.length;c++)u.writeFixed32(o[c])}function Ir(o,u){for(var c=0;c<o.length;c++)u.writeSFixed32(o[c])}function tn(o,u){for(var c=0;c<o.length;c++)u.writeFixed64(o[c])}function gr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed64(o[c])}function sn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function Cr(o,u,c){o[c]=u,o[c+1]=u>>>8,o[c+2]=u>>>16,o[c+3]=u>>>24}function en(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function _r(o,u,c){o===1&&c.readMessage(Kr,u)}function Kr(o,u,c){if(o===3){var m=c.readMessage(Vn,{}),x=m.width,E=m.height,T=m.left,M=m.top,D=m.advance;u.push({id:m.id,bitmap:new Ys({width:x+6,height:E+6},m.bitmap),metrics:{width:x,height:E,left:T,top:M,advance:D}})}}function Vn(o,u,c){o===1?u.id=c.readVarint():o===2?u.bitmap=c.readBytes():o===3?u.width=c.readVarint():o===4?u.height=c.readVarint():o===5?u.left=c.readSVarint():o===6?u.top=c.readSVarint():o===7&&(u.advance=c.readVarint())}function si(o){for(var u=0,c=0,m=0,x=o;m<x.length;m+=1){var E=x[m];u+=E.w*E.h,c=Math.max(c,E.w)}o.sort(function(Le,at){return at.h-Le.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),c),h:1/0}],M=0,D=0,U=0,H=o;U<H.length;U+=1)for(var X=H[U],ie=T.length-1;ie>=0;ie--){var he=T[ie];if(!(X.w>he.w||X.h>he.h)){if(X.x=he.x,X.y=he.y,D=Math.max(D,X.y+X.h),M=Math.max(M,X.x+X.w),X.w===he.w&&X.h===he.h){var Fe=T.pop();ie<T.length&&(T[ie]=Fe)}else X.h===he.h?(he.x+=X.w,he.w-=X.w):X.w===he.w?(he.y+=X.h,he.h-=X.h):(T.push({x:he.x+X.w,y:he.y,w:he.w-X.w,h:X.h}),he.y+=X.h,he.h-=X.h);break}}return{w:M,h:D,fill:u/(M*D)||0}}Lt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),x=m>>3,E=this.pos;this.type=7&m,o(x,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=sn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=en(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sn(this.buf,this.pos)+4294967296*sn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=sn(this.buf,this.pos)+4294967296*en(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Ht(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Ht(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,c,m=this.buf;return u=127&(c=m[this.pos++]),c<128?u:(u|=(127&(c=m[this.pos++]))<<7,c<128?u:(u|=(127&(c=m[this.pos++]))<<14,c<128?u:(u|=(127&(c=m[this.pos++]))<<21,c<128?u:function(x,E,T){var M,D,U=T.buf;if(M=(112&(D=U[T.pos++]))>>4,D<128||(M|=(127&(D=U[T.pos++]))<<3,D<128)||(M|=(127&(D=U[T.pos++]))<<10,D<128)||(M|=(127&(D=U[T.pos++]))<<17,D<128)||(M|=(127&(D=U[T.pos++]))<<24,D<128)||(M|=(1&(D=U[T.pos++]))<<31,D<128))return Vr(x,M,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(c=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Dr?function(c,m,x){return Dr.decode(c.subarray(m,x))}(this.buf,u,o):function(c,m,x){for(var E="",T=m;T<x;){var M,D,U,H=c[T],X=null,ie=H>239?4:H>223?3:H>191?2:1;if(T+ie>x)break;ie===1?H<128&&(X=H):ie===2?(192&(M=c[T+1]))==128&&(X=(31&H)<<6|63&M)<=127&&(X=null):ie===3?(D=c[T+2],(192&(M=c[T+1]))==128&&(192&D)==128&&((X=(15&H)<<12|(63&M)<<6|63&D)<=2047||X>=55296&&X<=57343)&&(X=null)):ie===4&&(D=c[T+2],U=c[T+3],(192&(M=c[T+1]))==128&&(192&D)==128&&(192&U)==128&&((X=(15&H)<<18|(63&M)<<12|(63&D)<<6|63&U)<=65535||X>=1114112)&&(X=null)),X===null?(X=65533,ie=1):X>65535&&(X-=65536,E+=String.fromCharCode(X>>>10&1023|55296),X=56320|1023&X),E+=String.fromCharCode(X),T+=ie}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==Lt.Bytes)return o.push(this.readVarint(u));var c=Tr(this);for(o=o||[];this.pos<c;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==Lt.Bytes)return o.push(this.readSVarint());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Lt.Bytes)return o.push(this.readBoolean());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Lt.Bytes)return o.push(this.readFloat());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Lt.Bytes)return o.push(this.readDouble());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Lt.Bytes)return o.push(this.readFixed32());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Lt.Bytes)return o.push(this.readSFixed32());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Lt.Bytes)return o.push(this.readFixed64());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Lt.Bytes)return o.push(this.readSFixed64());var u=Tr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===Lt.Varint)for(;this.buf[this.pos++]>127;);else if(u===Lt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Lt.Fixed32)this.pos+=4;else{if(u!==Lt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var c=new Uint8Array(u);c.set(this.buf),this.buf=c,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Cr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Cr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Cr(this.buf,-1&o,this.pos),Cr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Cr(this.buf,-1&o,this.pos),Cr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,c){var m,x;if(u>=0?(m=u%4294967296|0,x=u/4294967296|0):(x=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,x=x+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(E,T,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(m,0,c),function(E,T){var M=(7&E)<<4;T.buf[T.pos++]|=M|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(x,c)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,x,E){for(var T,M,D=0;D<x.length;D++){if((T=x.charCodeAt(D))>55295&&T<57344){if(!M){T>56319||D+1===x.length?(m[E++]=239,m[E++]=191,m[E++]=189):M=T;continue}if(T<56320){m[E++]=239,m[E++]=191,m[E++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[E++]=239,m[E++]=191,m[E++]=189,M=null);T<128?m[E++]=T:(T<2048?m[E++]=T>>6|192:(T<65536?m[E++]=T>>12|224:(m[E++]=T>>18|240,m[E++]=T>>12&63|128),m[E++]=T>>6&63|128),m[E++]=63&T|128)}return E}(this.buf,o,this.pos);var c=this.pos-u;c>=128&&kr(u,c,this),this.pos=u-1,this.writeVarint(c),this.pos+=c},writeFloat:function(o){this.realloc(4),cr(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),cr(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var c=0;c<u;c++)this.buf[this.pos++]=o[c]},writeRawMessage:function(o,u){this.pos++;var c=this.pos;o(u,this);var m=this.pos-c;m>=128&&kr(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,c){this.writeTag(o,Lt.Bytes),this.writeRawMessage(u,c)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,Zr,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,Xr,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,At,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,wr,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,Nr,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,tr,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,Ir,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,tn,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,gr,u)},writeBytesField:function(o,u){this.writeTag(o,Lt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,Lt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,Lt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,Lt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,Lt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,Lt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,Lt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,Lt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,Lt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,Lt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,Boolean(u))}};var Qr=function(o,u){var c=u.pixelRatio,m=u.version,x=u.stretchX,E=u.stretchY,T=u.content;this.paddedRect=o,this.pixelRatio=c,this.stretchX=x,this.stretchY=E,this.content=T,this.version=m},Pr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Pr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Pr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Pr.tlbr.get=function(){return this.tl.concat(this.br)},Pr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Qr.prototype,Pr);var ot=function(o,u){var c={},m={};this.haveRenderCallbacks=[];var x=[];this.addImages(o,c,x),this.addImages(u,m,x);var E=si(x),T=new wo({width:E.w||1,height:E.h||1});for(var M in o){var D=o[M],U=c[M].paddedRect;wo.copy(D.data,T,{x:0,y:0},{x:U.x+1,y:U.y+1},D.data)}for(var H in u){var X=u[H],ie=m[H].paddedRect,he=ie.x+1,Fe=ie.y+1,Le=X.data.width,at=X.data.height;wo.copy(X.data,T,{x:0,y:0},{x:he,y:Fe},X.data),wo.copy(X.data,T,{x:0,y:at-1},{x:he,y:Fe-1},{width:Le,height:1}),wo.copy(X.data,T,{x:0,y:0},{x:he,y:Fe+at},{width:Le,height:1}),wo.copy(X.data,T,{x:Le-1,y:0},{x:he-1,y:Fe},{width:1,height:at}),wo.copy(X.data,T,{x:0,y:0},{x:he+Le,y:Fe},{width:1,height:at})}this.image=T,this.iconPositions=c,this.patternPositions=m};ot.prototype.addImages=function(o,u,c){for(var m in o){var x=o[m],E={x:0,y:0,w:x.data.width+2,h:x.data.height+2};c.push(E),u[m]=new Qr(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},ot.prototype.patchUpdatedImages=function(o,u){for(var c in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[c],o.getImage(c),u),this.patchUpdatedImage(this.patternPositions[c],o.getImage(c),u)},ot.prototype.patchUpdatedImage=function(o,u,c){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;c.update(u.data,void 0,{x:m[0],y:m[1]})}},_n("ImagePosition",Qr),_n("ImageAtlas",ot);var jn={horizontal:1,vertical:2,horizontalOnly:3},pt=function(){this.scale=1,this.fontStack="",this.imageName=null};pt.forText=function(o,u){var c=new pt;return c.scale=o||1,c.fontStack=u,c},pt.forImage=function(o){var u=new pt;return u.imageName=o,u};var cn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Si(o,u,c,m,x,E,T,M,D,U,H,X,ie,he,Fe,Le){var at,Ge=cn.fromFeature(o,x);X===jn.vertical&&Ge.verticalizePunctuation();var yt=Ot.processBidirectionalText,Dt=Ot.processStyledBidirectionalText;if(yt&&Ge.sections.length===1){at=[];for(var kt=0,Qt=yt(Ge.toString(),ro(Ge,U,E,u,m,he,Fe));kt<Qt.length;kt+=1){var fr=Qt[kt],Br=new cn;Br.text=fr,Br.sections=Ge.sections;for(var $r=0;$r<fr.length;$r++)Br.sectionIndex.push(0);at.push(Br)}}else if(Dt){at=[];for(var zn=0,hn=Dt(Ge.text,Ge.sectionIndex,ro(Ge,U,E,u,m,he,Fe));zn<hn.length;zn+=1){var Hn=hn[zn],pn=new cn;pn.text=Hn[0],pn.sectionIndex=Hn[1],pn.sections=Ge.sections,at.push(pn)}}else at=function(Cn,ki){for(var bi=[],Yi=Cn.text,Xn=0,aa=0,Xa=ki;aa<Xa.length;aa+=1){var po=Xa[aa];bi.push(Cn.substring(Xn,po)),Xn=po}return Xn<Yi.length&&bi.push(Cn.substring(Xn,Yi.length)),bi}(Ge,ro(Ge,U,E,u,m,he,Fe));var an=[],jr={positionedLines:an,text:Ge.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:X,iconsInText:!1,verticalizable:!1};return function(Cn,ki,bi,Yi,Xn,aa,Xa,po,no,$a,vo,rs){for(var ns=0,tu=-17,is=0,ru=0,Io=po==="right"?1:po==="left"?0:.5,vs=0,Vi=0,Aa=Xn;Vi<Aa.length;Vi+=1){var ga=Aa[Vi];ga.trim();var Ki=ga.getMaxScale(),pu=24*(Ki-1),Ns={positionedGlyphs:[],lineOffset:0};Cn.positionedLines[vs]=Ns;var za=Ns.positionedGlyphs,No=0;if(ga.length()){for(var Us=0;Us<ga.length();Us++){var qi=ga.getSection(Us),sf=ga.getSectionIndex(Us),dl=ga.getCharCode(Us),uf=0,Po=null,lf=null,tc=null,Kp=24,cp=!(no===jn.horizontal||!vo&&!qc(dl)||vo&&(ui[dl]||(Pc=dl,qr.Arabic(Pc)||qr["Arabic Supplement"](Pc)||qr["Arabic Extended-A"](Pc)||qr["Arabic Presentation Forms-A"](Pc)||qr["Arabic Presentation Forms-B"](Pc))));if(qi.imageName){var Qp=Yi[qi.imageName];if(!Qp)continue;tc=qi.imageName,Cn.iconsInText=Cn.iconsInText||!0,lf=Qp.paddedRect;var Hf=Qp.displaySize;qi.scale=24*qi.scale/rs,uf=pu+(24-Hf[1]*qi.scale),Kp=(Po={width:Hf[0],height:Hf[1],left:1,top:-3,advance:cp?Hf[1]:Hf[0]}).advance;var Jp=cp?Hf[0]*qi.scale-24*Ki:Hf[1]*qi.scale-24*Ki;Jp>0&&Jp>No&&(No=Jp)}else{var Wv=bi[qi.fontStack],ed=Wv&&Wv[dl];if(ed&&ed.rect)lf=ed.rect,Po=ed.metrics;else{var wh=ki[qi.fontStack],Hd=wh&&wh[dl];if(!Hd)continue;Po=Hd.metrics}uf=24*(Ki-qi.scale)}cp?(Cn.verticalizable=!0,za.push({glyph:dl,imageName:tc,x:ns,y:tu+uf,vertical:cp,scale:qi.scale,fontStack:qi.fontStack,sectionIndex:sf,metrics:Po,rect:lf}),ns+=Kp*qi.scale+$a):(za.push({glyph:dl,imageName:tc,x:ns,y:tu+uf,vertical:cp,scale:qi.scale,fontStack:qi.fontStack,sectionIndex:sf,metrics:Po,rect:lf}),ns+=Po.advance*qi.scale+$a)}za.length!==0&&(is=Math.max(ns-$a,is),co(za,0,za.length-1,Io,No)),ns=0;var td=aa*Ki+No;Ns.lineOffset=Math.max(No,pu),tu+=td,ru=Math.max(td,ru),++vs}else tu+=aa,++vs}var Pc,Oc=tu- -17,Dl=ba(Xa),cf=Dl.horizontalAlign,Ch=Dl.verticalAlign;(function(rd,fp,hp,nd,Wd,pp,dp,id,Gd){var vp,Xd=(fp-hp)*Wd;vp=pp!==dp?-id*nd- -17:(-nd*Gd+.5)*dp;for(var Dc=0,bs=rd;Dc<bs.length;Dc+=1)for(var Wf=0,mp=bs[Dc].positionedGlyphs;Wf<mp.length;Wf+=1){var Rh=mp[Wf];Rh.x+=Xd,Rh.y+=vp}})(Cn.positionedLines,Io,cf,Ch,is,ru,aa,Oc,Xn.length),Cn.top+=-Ch*Oc,Cn.bottom=Cn.top+Oc,Cn.left+=-cf*is,Cn.right=Cn.left+is}(jr,u,c,m,at,T,M,D,X,U,ie,Le),!function(Cn){for(var ki=0,bi=Cn;ki<bi.length;ki+=1)if(bi[ki].positionedGlyphs.length!==0)return!1;return!0}(an)&&jr}cn.fromFeature=function(o,u){for(var c=new cn,m=0;m<o.sections.length;m++){var x=o.sections[m];x.image?c.addImageSection(x):c.addTextSection(x,u)}return c},cn.prototype.length=function(){return this.text.length},cn.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},cn.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},cn.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},cn.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",c=0;c<o.length;c++){var m=o.charCodeAt(c+1)||null,x=o.charCodeAt(c-1)||null;u+=m&&Kc(m)&&!He[o[c+1]]||x&&Kc(x)&&!He[o[c-1]]||!He[o[c]]?o[c]:He[o[c]]}return u}(this.text)},cn.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&ui[this.text.charCodeAt(u)];u++)o++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=o&&ui[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)},cn.prototype.substring=function(o,u){var c=new cn;return c.text=this.text.substring(o,u),c.sectionIndex=this.sectionIndex.slice(o,u),c.sections=this.sections,c},cn.prototype.toString=function(){return this.text},cn.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,c){return Math.max(u,o.sections[c].scale)},0)},cn.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(pt.forText(o.scale,o.fontStack||u));for(var c=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(c)},cn.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(pt.forImage(u)),this.sectionIndex.push(this.sections.length-1)):vt("Reached maximum number of images 6401")}else vt("Can't add FormattedSection with an empty image.")},cn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ui={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jn={};function Xi(o,u,c,m,x,E){if(u.imageName){var T=m[u.imageName];return T?T.displaySize[0]*u.scale*24/E+x:0}var M=c[u.fontStack],D=M&&M[o];return D?D.metrics.advance*u.scale+x:0}function La(o,u,c,m){var x=Math.pow(o-u,2);return m?o<u?x/2:2*x:x+Math.abs(c)*c}function $o(o,u,c){var m=0;return o===10&&(m-=1e4),c&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Oi(o,u,c,m,x,E){for(var T=null,M=La(u,c,x,E),D=0,U=m;D<U.length;D+=1){var H=U[D],X=La(u-H.x,c,x,E)+H.badness;X<=M&&(T=H,M=X)}return{index:o,x:u,priorBreak:T,badness:M}}function ro(o,u,c,m,x,E,T){if(E!=="point")return[];if(!o)return[];for(var M,D=[],U=function(at,Ge,yt,Dt,kt,Qt){for(var fr=0,Br=0;Br<at.length();Br++){var $r=at.getSection(Br);fr+=Xi(at.getCharCode(Br),$r,Dt,kt,Ge,Qt)}return fr/Math.max(1,Math.ceil(fr/yt))}(o,u,c,m,x,T),H=o.text.indexOf("\u200B")>=0,X=0,ie=0;ie<o.length();ie++){var he=o.getSection(ie),Fe=o.getCharCode(ie);if(ui[Fe]||(X+=Xi(Fe,he,m,x,u,T)),ie<o.length()-1){var Le=!((M=Fe)<11904||!(qr["Bopomofo Extended"](M)||qr.Bopomofo(M)||qr["CJK Compatibility Forms"](M)||qr["CJK Compatibility Ideographs"](M)||qr["CJK Compatibility"](M)||qr["CJK Radicals Supplement"](M)||qr["CJK Strokes"](M)||qr["CJK Symbols and Punctuation"](M)||qr["CJK Unified Ideographs Extension A"](M)||qr["CJK Unified Ideographs"](M)||qr["Enclosed CJK Letters and Months"](M)||qr["Halfwidth and Fullwidth Forms"](M)||qr.Hiragana(M)||qr["Ideographic Description Characters"](M)||qr["Kangxi Radicals"](M)||qr["Katakana Phonetic Extensions"](M)||qr.Katakana(M)||qr["Vertical Forms"](M)||qr["Yi Radicals"](M)||qr["Yi Syllables"](M)));(Jn[Fe]||Le||he.imageName)&&D.push(Oi(ie+1,X,U,D,$o(Fe,o.getCharCode(ie+1),Le&&H),!1))}}return function at(Ge){return Ge?at(Ge.priorBreak).concat(Ge.index):[]}(Oi(o.length(),X,U,D,0,!0))}function ba(o){var u=.5,c=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:u,verticalAlign:c}}function co(o,u,c,m,x){if(m||x)for(var E=o[c],T=(o[c].x+E.metrics.advance*E.scale)*m,M=u;M<=c;M++)o[M].x-=T,o[M].y+=x}function fo(o,u,c,m,x,E){var T,M=o.image;if(M.content){var D=M.content,U=M.pixelRatio||1;T=[D[0]/U,D[1]/U,M.displaySize[0]-D[2]/U,M.displaySize[1]-D[3]/U]}var H,X,ie,he,Fe=u.left*E,Le=u.right*E;c==="width"||c==="both"?(he=x[0]+Fe-m[3],X=x[0]+Le+m[1]):X=(he=x[0]+(Fe+Le-M.displaySize[0])/2)+M.displaySize[0];var at=u.top*E,Ge=u.bottom*E;return c==="height"||c==="both"?(H=x[1]+at-m[0],ie=x[1]+Ge+m[2]):ie=(H=x[1]+(at+Ge-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:H,right:X,bottom:ie,left:he,collisionPadding:T}}Jn[10]=!0,Jn[32]=!0,Jn[38]=!0,Jn[40]=!0,Jn[41]=!0,Jn[43]=!0,Jn[45]=!0,Jn[47]=!0,Jn[173]=!0,Jn[183]=!0,Jn[8203]=!0,Jn[8208]=!0,Jn[8211]=!0,Jn[8231]=!0;var Na=function(o){function u(c,m,x,E){o.call(this,c,m),this.angle=x,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(te);function ko(o,u){var c=u.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Ee(o+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,x=c.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var T=E=Math.max(0,E-1);T<m.length&&m[T]<o+1;)T++;T=Math.min(m.length-1,T);var M=m[E],D=m[T];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:x}:{kind:"camera",minZoom:M,maxZoom:D,minSize:c.evaluate(new Ee(M)),maxSize:c.evaluate(new Ee(D)),interpolationType:x}}function es(o,u,c){var m=u.uSize,x=c.lowerSize;return o.kind==="source"?x/128:o.kind==="composite"?Za(x/128,c.upperSize/128,u.uSizeT):m}function Ro(o,u){var c=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var x=o.interpolationType,E=x?Tt(Wo.interpolationFactor(x,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=Za(o.minSize,o.maxSize,E):c=E}return{uSizeT:c,uSize:m}}_n("Anchor",Na);var Ei=Object.freeze({__proto__:null,getSizeData:ko,evaluateSizeForFeature:es,evaluateSizeForZoom:Ro,SIZE_PACK_FACTOR:128});function ts(o,u,c,m,x){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,M=0;M>-c/2;){if(--T<0)return!1;M-=o[T].dist(E),E=o[T]}M+=o[T].dist(o[T+1]),T++;for(var D=[],U=0;M<c/2;){var H=o[T],X=o[T+1];if(!X)return!1;var ie=o[T-1].angleTo(H)-H.angleTo(X);for(ie=Math.abs((ie+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:ie}),U+=ie;M-D[0].distance>m;)U-=D.shift().angleDelta;if(U>x)return!1;T++,M+=H.dist(X)}return!0}function ea(o){for(var u=0,c=0;c<o.length-1;c++)u+=o[c].dist(o[c+1]);return u}function Yn(o,u,c){return o?.6*u*c:0}function Ii(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function $i(o,u,c,m,x,E){for(var T=Yn(c,x,E),M=Ii(c,m)*E,D=0,U=ea(o)/2,H=0;H<o.length-1;H++){var X=o[H],ie=o[H+1],he=X.dist(ie);if(D+he>U){var Fe=(U-D)/he,Le=Za(X.x,ie.x,Fe),at=Za(X.y,ie.y,Fe),Ge=new Na(Le,at,ie.angleTo(X),H);return Ge._round(),!T||ts(o,Ge,M,T,u)?Ge:void 0}D+=he}}function ho(o,u,c,m,x,E,T,M,D){var U=Yn(m,E,T),H=Ii(m,x),X=H*T,ie=o[0].x===0||o[0].x===D||o[0].y===0||o[0].y===D;return u-X<u/4&&(u=X+u/4),function he(Fe,Le,at,Ge,yt,Dt,kt,Qt,fr){for(var Br=Dt/2,$r=ea(Fe),zn=0,hn=Le-at,Hn=[],pn=0;pn<Fe.length-1;pn++){for(var an=Fe[pn],jr=Fe[pn+1],Cn=an.dist(jr),ki=jr.angleTo(an);hn+at<zn+Cn;){var bi=((hn+=at)-zn)/Cn,Yi=Za(an.x,jr.x,bi),Xn=Za(an.y,jr.y,bi);if(Yi>=0&&Yi<fr&&Xn>=0&&Xn<fr&&hn-Br>=0&&hn+Br<=$r){var aa=new Na(Yi,Xn,ki,pn);aa._round(),Ge&&!ts(Fe,aa,Dt,Ge,yt)||Hn.push(aa)}}zn+=Cn}return Qt||Hn.length||kt||(Hn=he(Fe,zn/2,at,Ge,yt,Dt,kt,!0,fr)),Hn}(o,ie?u/2*M%u:(H/2+2*E)*T*M%u,u,U,c,X,ie,!1,D)}function hl(o,u,c,m,x){for(var E=[],T=0;T<o.length;T++)for(var M=o[T],D=void 0,U=0;U<M.length-1;U++){var H=M[U],X=M[U+1];H.x<u&&X.x<u||(H.x<u?H=new te(u,H.y+(u-H.x)/(X.x-H.x)*(X.y-H.y))._round():X.x<u&&(X=new te(u,H.y+(u-H.x)/(X.x-H.x)*(X.y-H.y))._round()),H.y<c&&X.y<c||(H.y<c?H=new te(H.x+(c-H.y)/(X.y-H.y)*(X.x-H.x),c)._round():X.y<c&&(X=new te(H.x+(c-H.y)/(X.y-H.y)*(X.x-H.x),c)._round()),H.x>=m&&X.x>=m||(H.x>=m?H=new te(m,H.y+(m-H.x)/(X.x-H.x)*(X.y-H.y))._round():X.x>=m&&(X=new te(m,H.y+(m-H.x)/(X.x-H.x)*(X.y-H.y))._round()),H.y>=x&&X.y>=x||(H.y>=x?H=new te(H.x+(x-H.y)/(X.y-H.y)*(X.x-H.x),x)._round():X.y>=x&&(X=new te(H.x+(x-H.y)/(X.y-H.y)*(X.x-H.x),x)._round()),D&&H.equals(D[D.length-1])||E.push(D=[H]),D.push(X)))))}return E}function Ne(o,u,c,m){var x=[],E=o.image,T=E.pixelRatio,M=E.paddedRect.w-2,D=E.paddedRect.h-2,U=o.right-o.left,H=o.bottom-o.top,X=E.stretchX||[[0,M]],ie=E.stretchY||[[0,D]],he=function(Yi,Xn){return Yi+Xn[1]-Xn[0]},Fe=X.reduce(he,0),Le=ie.reduce(he,0),at=M-Fe,Ge=D-Le,yt=0,Dt=Fe,kt=0,Qt=Le,fr=0,Br=at,$r=0,zn=Ge;if(E.content&&m){var hn=E.content;yt=Yt(X,0,hn[0]),kt=Yt(ie,0,hn[1]),Dt=Yt(X,hn[0],hn[2]),Qt=Yt(ie,hn[1],hn[3]),fr=hn[0]-yt,$r=hn[1]-kt,Br=hn[2]-hn[0]-Dt,zn=hn[3]-hn[1]-Qt}var Hn=function(Yi,Xn,aa,Xa){var po=fn(Yi.stretch-yt,Dt,U,o.left),no=Ti(Yi.fixed-fr,Br,Yi.stretch,Fe),$a=fn(Xn.stretch-kt,Qt,H,o.top),vo=Ti(Xn.fixed-$r,zn,Xn.stretch,Le),rs=fn(aa.stretch-yt,Dt,U,o.left),ns=Ti(aa.fixed-fr,Br,aa.stretch,Fe),tu=fn(Xa.stretch-kt,Qt,H,o.top),is=Ti(Xa.fixed-$r,zn,Xa.stretch,Le),ru=new te(po,$a),Io=new te(rs,$a),vs=new te(rs,tu),Vi=new te(po,tu),Aa=new te(no/T,vo/T),ga=new te(ns/T,is/T),Ki=u*Math.PI/180;if(Ki){var pu=Math.sin(Ki),Ns=Math.cos(Ki),za=[Ns,-pu,pu,Ns];ru._matMult(za),Io._matMult(za),Vi._matMult(za),vs._matMult(za)}var No=Yi.stretch+Yi.fixed,Us=Xn.stretch+Xn.fixed;return{tl:ru,tr:Io,bl:Vi,br:vs,tex:{x:E.paddedRect.x+1+No,y:E.paddedRect.y+1+Us,w:aa.stretch+aa.fixed-No,h:Xa.stretch+Xa.fixed-Us},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Aa,pixelOffsetBR:ga,minFontScaleX:Br/T/U,minFontScaleY:zn/T/H,isSDF:c}};if(m&&(E.stretchX||E.stretchY))for(var pn=Nt(X,at,Fe),an=Nt(ie,Ge,Le),jr=0;jr<pn.length-1;jr++)for(var Cn=pn[jr],ki=pn[jr+1],bi=0;bi<an.length-1;bi++)x.push(Hn(Cn,an[bi],ki,an[bi+1]));else x.push(Hn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return x}function Yt(o,u,c){for(var m=0,x=0,E=o;x<E.length;x+=1){var T=E[x];m+=Math.max(u,Math.min(c,T[1]))-Math.max(u,Math.min(c,T[0]))}return m}function Nt(o,u,c){for(var m=[{fixed:-1,stretch:0}],x=0,E=o;x<E.length;x+=1){var T=E[x],M=T[0],D=T[1],U=m[m.length-1];m.push({fixed:M-U.stretch,stretch:U.stretch}),m.push({fixed:M-U.stretch,stretch:U.stretch+(D-M)})}return m.push({fixed:u+1,stretch:c}),m}function fn(o,u,c,m){return o/u*c+m}function Ti(o,u,c,m){return o-u*c/m}var pa=function(o,u,c,m,x,E,T,M,D,U){if(this.boxStartIndex=o.length,D){var H=E.top,X=E.bottom,ie=E.collisionPadding;ie&&(H-=ie[1],X+=ie[3]);var he=X-H;he>0&&(he=Math.max(10,he),this.circleDiameter=he)}else{var Fe=E.top*T-M,Le=E.bottom*T+M,at=E.left*T-M,Ge=E.right*T+M,yt=E.collisionPadding;if(yt&&(at-=yt[0]*T,Fe-=yt[1]*T,Ge+=yt[2]*T,Le+=yt[3]*T),U){var Dt=new te(at,Fe),kt=new te(Ge,Fe),Qt=new te(at,Le),fr=new te(Ge,Le),Br=U*Math.PI/180;Dt._rotate(Br),kt._rotate(Br),Qt._rotate(Br),fr._rotate(Br),at=Math.min(Dt.x,kt.x,Qt.x,fr.x),Ge=Math.max(Dt.x,kt.x,Qt.x,fr.x),Fe=Math.min(Dt.y,kt.y,Qt.y,fr.y),Le=Math.max(Dt.y,kt.y,Qt.y,fr.y)}o.emplaceBack(u.x,u.y,at,Fe,Ge,Le,c,m,x)}this.boxEndIndex=o.length},fe=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Ce),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Ce(o,u){return o<u?-1:o>u?1:0}function We(o,u,c){u===void 0&&(u=1),c===void 0&&(c=!1);for(var m=1/0,x=1/0,E=-1/0,T=-1/0,M=o[0],D=0;D<M.length;D++){var U=M[D];(!D||U.x<m)&&(m=U.x),(!D||U.y<x)&&(x=U.y),(!D||U.x>E)&&(E=U.x),(!D||U.y>T)&&(T=U.y)}var H=Math.min(E-m,T-x),X=H/2,ie=new fe([],zt);if(H===0)return new te(m,x);for(var he=m;he<E;he+=H)for(var Fe=x;Fe<T;Fe+=H)ie.push(new Ft(he+X,Fe+X,X,o));for(var Le=function(yt){for(var Dt=0,kt=0,Qt=0,fr=yt[0],Br=0,$r=fr.length,zn=$r-1;Br<$r;zn=Br++){var hn=fr[Br],Hn=fr[zn],pn=hn.x*Hn.y-Hn.x*hn.y;kt+=(hn.x+Hn.x)*pn,Qt+=(hn.y+Hn.y)*pn,Dt+=3*pn}return new Ft(kt/Dt,Qt/Dt,0,yt)}(o),at=ie.length;ie.length;){var Ge=ie.pop();(Ge.d>Le.d||!Le.d)&&(Le=Ge,c&&console.log("found best %d after %d probes",Math.round(1e4*Ge.d)/1e4,at)),Ge.max-Le.d<=u||(ie.push(new Ft(Ge.p.x-(X=Ge.h/2),Ge.p.y-X,X,o)),ie.push(new Ft(Ge.p.x+X,Ge.p.y-X,X,o)),ie.push(new Ft(Ge.p.x-X,Ge.p.y+X,X,o)),ie.push(new Ft(Ge.p.x+X,Ge.p.y+X,X,o)),at+=4)}return c&&(console.log("num probes: "+at),console.log("best distance: "+Le.d)),Le.p}function zt(o,u){return u.max-o.max}function Ft(o,u,c,m){this.p=new te(o,u),this.h=c,this.d=function(x,E){for(var T=!1,M=1/0,D=0;D<E.length;D++)for(var U=E[D],H=0,X=U.length,ie=X-1;H<X;ie=H++){var he=U[H],Fe=U[ie];he.y>x.y!=Fe.y>x.y&&x.x<(Fe.x-he.x)*(x.y-he.y)/(Fe.y-he.y)+he.x&&(T=!T),M=Math.min(M,ql(x,he,Fe))}return(T?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}fe.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},fe.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},fe.prototype.peek=function(){return this.data[0]},fe.prototype._up=function(o){for(var u=this.data,c=this.compare,m=u[o];o>0;){var x=o-1>>1,E=u[x];if(c(m,E)>=0)break;u[o]=E,o=x}u[o]=m},fe.prototype._down=function(o){for(var u=this.data,c=this.compare,m=this.length>>1,x=u[o];o<m;){var E=1+(o<<1),T=u[E],M=E+1;if(M<this.length&&c(u[M],T)<0&&(E=M,T=u[M]),c(T,x)>=0)break;u[o]=T,o=E}u[o]=x};var Je=Number.POSITIVE_INFINITY;function ut(o,u){return u[1]!==Je?function(c,m,x){var E=0,T=0;switch(m=Math.abs(m),x=Math.abs(x),c){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(c){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,T]}(o,u[0],u[1]):function(c,m){var x=0,E=0;m<0&&(m=0);var T=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(c){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=m;break;case"right":x=-m}return[x,E]}(o,u[0])}function dt(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ze(o,u,c,m,x,E,T,M,D,U,H,X,ie,he,Fe){var Le=function(kt,Qt,fr,Br,$r,zn,hn,Hn){for(var pn=Br.layout.get("text-rotate").evaluate(zn,{})*Math.PI/180,an=[],jr=0,Cn=Qt.positionedLines;jr<Cn.length;jr+=1)for(var ki=Cn[jr],bi=0,Yi=ki.positionedGlyphs;bi<Yi.length;bi+=1){var Xn=Yi[bi];if(Xn.rect){var aa=Xn.rect||{},Xa=4,po=!0,no=1,$a=0,vo=($r||Hn)&&Xn.vertical,rs=Xn.metrics.advance*Xn.scale/2;if(Hn&&Qt.verticalizable&&($a=ki.lineOffset/2-(Xn.imageName?-(24-Xn.metrics.width*Xn.scale)/2:24*(Xn.scale-1))),Xn.imageName){var ns=hn[Xn.imageName];po=ns.sdf,Xa=1/(no=ns.pixelRatio)}var tu=$r?[Xn.x+rs,Xn.y]:[0,0],is=$r?[0,0]:[Xn.x+rs+fr[0],Xn.y+fr[1]-$a],ru=[0,0];vo&&(ru=is,is=[0,0]);var Io=(Xn.metrics.left-Xa)*Xn.scale-rs+is[0],vs=(-Xn.metrics.top-Xa)*Xn.scale+is[1],Vi=Io+aa.w*Xn.scale/no,Aa=vs+aa.h*Xn.scale/no,ga=new te(Io,vs),Ki=new te(Vi,vs),pu=new te(Io,Aa),Ns=new te(Vi,Aa);if(vo){var za=new te(-rs,rs- -17),No=-Math.PI/2,Us=12-rs,qi=new te(22-Us,-(Xn.imageName?Us:0)),sf=new(Function.prototype.bind.apply(te,[null].concat(ru)));ga._rotateAround(No,za)._add(qi)._add(sf),Ki._rotateAround(No,za)._add(qi)._add(sf),pu._rotateAround(No,za)._add(qi)._add(sf),Ns._rotateAround(No,za)._add(qi)._add(sf)}if(pn){var dl=Math.sin(pn),uf=Math.cos(pn),Po=[uf,-dl,dl,uf];ga._matMult(Po),Ki._matMult(Po),pu._matMult(Po),Ns._matMult(Po)}var lf=new te(0,0),tc=new te(0,0);an.push({tl:ga,tr:Ki,bl:pu,br:Ns,tex:aa,writingMode:Qt.writingMode,glyphOffset:tu,sectionIndex:Xn.sectionIndex,isSDF:po,pixelOffsetTL:lf,pixelOffsetBR:tc,minFontScaleX:0,minFontScaleY:0})}}return an}(0,c,M,x,E,T,m,o.allowVerticalPlacement),at=o.textSizeData,Ge=null;at.kind==="source"?(Ge=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&vt(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):at.kind==="composite"&&((Ge=[128*he.compositeTextSizes[0].evaluate(T,{},Fe),128*he.compositeTextSizes[1].evaluate(T,{},Fe)])[0]>32640||Ge[1]>32640)&&vt(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,Le,Ge,M,E,T,U,u,D.lineStartIndex,D.lineLength,ie,Fe);for(var yt=0,Dt=H;yt<Dt.length;yt+=1)X[Dt[yt]]=o.text.placedSymbolArray.length-1;return 4*Le.length}function et(o){for(var u in o)return o[u];return null}function we(o,u,c,m){var x=o.compareText;if(u in x){for(var E=x[u],T=E.length-1;T>=0;T--)if(m.dist(E[T])<c)return!0}else x[u]=[];return x[u].push(m),!1}var Ye=ec.VectorTileFeature.types,Vt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ar(o,u,c,m,x,E,T,M,D,U,H,X,ie){var he=M?Math.min(32640,Math.round(M[0])):0,Fe=M?Math.min(32640,Math.round(M[1])):0;o.emplaceBack(u,c,Math.round(32*m),Math.round(32*x),E,T,(he<<1)+(D?1:0),Fe,16*U,16*H,256*X,256*ie)}function Er(o,u,c){o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c)}function vr(o){for(var u=0,c=o.sections;u<c.length;u+=1)if(If(c[u].text))return!0;return!1}var Rr=function(o){this.layoutVertexArray=new Df,this.indexArray=new Jo,this.programConfigurations=o,this.segments=new _e,this.dynamicLayoutVertexArray=new bc,this.opacityVertexArray=new Jc,this.placedSymbolArray=new g};Rr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rr.prototype.upload=function(o,u,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Zv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Vt,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(o))},Rr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},_n("SymbolBuffers",Rr);var In=function(o,u,c){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new c,this.segments=new _e,this.collisionVertexArray=new ph};In.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Ld.members,!0)},In.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},_n("CollisionBuffers",In);var yn=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Go([]),this.placementViewportMatrix=Go([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ko(this.zoom,u["text-size"]),this.iconSizeData=ko(this.zoom,u["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),x=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(E){return jn[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};yn.prototype.createArrays=function(){this.text=new Rr(new $n(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new Rr(new $n(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new R,this.lineVertexArray=new O,this.symbolInstances=new C},yn.prototype.calculateGlyphDependencies=function(o,u,c,m,x){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(c||m)&&x){var T=He[o.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},yn.prototype.populate=function(o,u,c){var m=this.layers[0],x=m.layout,E=x.get("text-font"),T=x.get("text-field"),M=x.get("icon-image"),D=(T.value.kind!=="constant"||T.value.value instanceof va&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,H=x.get("symbol-sort-key");if(this.features=[],D||U){for(var X=u.iconDependencies,ie=u.glyphDependencies,he=u.availableImages,Fe=new Ee(this.zoom),Le=0,at=o;Le<at.length;Le+=1){var Ge=at[Le],yt=Ge.feature,Dt=Ge.id,kt=Ge.index,Qt=Ge.sourceLayerIndex,fr=m._featureFilter.needGeometry,Br=Ha(yt,fr);if(m._featureFilter.filter(Fe,Br,c)){fr||(Br.geometry=Ba(yt));var $r=void 0;if(D){var zn=m.getValueAndResolveTokens("text-field",Br,c,he),hn=va.factory(zn);vr(hn)&&(this.hasRTLText=!0),(!this.hasRTLText||Qc()==="unavailable"||this.hasRTLText&&Ot.isParsed())&&($r=Se(hn,m,Br))}var Hn=void 0;if(U){var pn=m.getValueAndResolveTokens("icon-image",Br,c,he);Hn=pn instanceof Ra?pn:Ra.fromString(pn)}if($r||Hn){var an=this.sortFeaturesByKey?H.evaluate(Br,{},c):void 0;if(this.features.push({id:Dt,text:$r,icon:Hn,index:kt,sourceLayerIndex:Qt,geometry:Br.geometry,properties:yt.properties,type:Ye[yt.type],sortKey:an}),Hn&&(X[Hn.name]=!0),$r){var jr=E.evaluate(Br,{},c).join(","),Cn=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jn.vertical)>=0;for(var ki=0,bi=$r.sections;ki<bi.length;ki+=1){var Yi=bi[ki];if(Yi.image)X[Yi.image.name]=!0;else{var Xn=al($r.toString()),aa=Yi.fontStack||jr,Xa=ie[aa]=ie[aa]||{};this.calculateGlyphDependencies(Yi.text,Xa,Cn,this.allowVerticalPlacement,Xn)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(po){var no={},$a={},vo=[],rs=0;function ns(za){vo.push(po[za]),rs++}function tu(za,No,Us){var qi=$a[za];return delete $a[za],$a[No]=qi,vo[qi].geometry[0].pop(),vo[qi].geometry[0]=vo[qi].geometry[0].concat(Us[0]),qi}function is(za,No,Us){var qi=no[No];return delete no[No],no[za]=qi,vo[qi].geometry[0].shift(),vo[qi].geometry[0]=Us[0].concat(vo[qi].geometry[0]),qi}function ru(za,No,Us){var qi=Us?No[0][No[0].length-1]:No[0][0];return za+":"+qi.x+":"+qi.y}for(var Io=0;Io<po.length;Io++){var vs=po[Io],Vi=vs.geometry,Aa=vs.text?vs.text.toString():null;if(Aa){var ga=ru(Aa,Vi),Ki=ru(Aa,Vi,!0);if(ga in $a&&Ki in no&&$a[ga]!==no[Ki]){var pu=is(ga,Ki,Vi),Ns=tu(ga,Ki,vo[pu].geometry);delete no[ga],delete $a[Ki],$a[ru(Aa,vo[Ns].geometry,!0)]=Ns,vo[pu].geometry=null}else ga in $a?tu(ga,Ki,Vi):Ki in no?is(ga,Ki,Vi):(ns(Io),no[ga]=rs-1,$a[Ki]=rs-1)}else ns(Io)}return vo.filter(function(za){return za.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(po,no){return po.sortKey-no.sortKey})}},yn.prototype.update=function(o,u,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,c),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,c))},yn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},yn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yn.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yn.prototype.addToLineVertexArray=function(o,u){var c=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]),E={},T=o.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:m},T<u.length-1&&(m+=u[T+1].dist(u[T]));for(var M=o.segment||0;M>=0;M--)E[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=u[M-1].dist(u[M]));for(var D=0;D<u.length;D++){var U=E[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},yn.prototype.addSymbols=function(o,u,c,m,x,E,T,M,D,U,H,X){for(var ie=o.indexArray,he=o.layoutVertexArray,Fe=o.segments.prepareSegment(4*u.length,he,ie,this.canOverlap?E.sortKey:void 0),Le=this.glyphOffsetArray.length,at=Fe.vertexLength,Ge=this.allowVerticalPlacement&&T===jn.vertical?Math.PI/2:0,yt=E.text&&E.text.sections,Dt=0;Dt<u.length;Dt++){var kt=u[Dt],Qt=kt.tl,fr=kt.tr,Br=kt.bl,$r=kt.br,zn=kt.tex,hn=kt.pixelOffsetTL,Hn=kt.pixelOffsetBR,pn=kt.minFontScaleX,an=kt.minFontScaleY,jr=kt.glyphOffset,Cn=kt.isSDF,ki=kt.sectionIndex,bi=Fe.vertexLength,Yi=jr[1];ar(he,M.x,M.y,Qt.x,Yi+Qt.y,zn.x,zn.y,c,Cn,hn.x,hn.y,pn,an),ar(he,M.x,M.y,fr.x,Yi+fr.y,zn.x+zn.w,zn.y,c,Cn,Hn.x,hn.y,pn,an),ar(he,M.x,M.y,Br.x,Yi+Br.y,zn.x,zn.y+zn.h,c,Cn,hn.x,Hn.y,pn,an),ar(he,M.x,M.y,$r.x,Yi+$r.y,zn.x+zn.w,zn.y+zn.h,c,Cn,Hn.x,Hn.y,pn,an),Er(o.dynamicLayoutVertexArray,M,Ge),ie.emplaceBack(bi,bi+1,bi+2),ie.emplaceBack(bi+1,bi+2,bi+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jr[0]),Dt!==u.length-1&&ki===u[Dt+1].sectionIndex||o.programConfigurations.populatePaintArrays(he.length,E,E.index,{},X,yt&&yt[ki])}o.placedSymbolArray.emplaceBack(M.x,M.y,Le,this.glyphOffsetArray.length-Le,at,D,U,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],T,0,!1,0,H)},yn.prototype._addCollisionDebugVertex=function(o,u,c,m,x,E){return u.emplaceBack(0,0),o.emplaceBack(c.x,c.y,m,x,Math.round(E.x),Math.round(E.y))},yn.prototype.addCollisionDebugVertices=function(o,u,c,m,x,E,T){var M=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),D=M.vertexLength,U=x.layoutVertexArray,H=x.collisionVertexArray,X=T.anchorX,ie=T.anchorY;this._addCollisionDebugVertex(U,H,E,X,ie,new te(o,u)),this._addCollisionDebugVertex(U,H,E,X,ie,new te(c,u)),this._addCollisionDebugVertex(U,H,E,X,ie,new te(c,m)),this._addCollisionDebugVertex(U,H,E,X,ie,new te(o,m)),M.vertexLength+=4;var he=x.indexArray;he.emplaceBack(D,D+1),he.emplaceBack(D+1,D+2),he.emplaceBack(D+2,D+3),he.emplaceBack(D+3,D),M.primitiveLength+=4},yn.prototype.addDebugCollisionBoxes=function(o,u,c,m){for(var x=o;x<u;x++){var E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,c)}},yn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new In($l,Nd.members,Zu),this.iconCollisionBox=new In($l,Nd.members,Zu);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},yn.prototype._deserializeCollisionBoxesForSymbol=function(o,u,c,m,x,E,T,M,D){for(var U={},H=u;H<c;H++){var X=o.get(H);U.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.textFeatureIndex=X.featureIndex;break}for(var ie=m;ie<x;ie++){var he=o.get(ie);U.verticalTextBox={x1:he.x1,y1:he.y1,x2:he.x2,y2:he.y2,anchorPointX:he.anchorPointX,anchorPointY:he.anchorPointY},U.verticalTextFeatureIndex=he.featureIndex;break}for(var Fe=E;Fe<T;Fe++){var Le=o.get(Fe);U.iconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},U.iconFeatureIndex=Le.featureIndex;break}for(var at=M;at<D;at++){var Ge=o.get(at);U.verticalIconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},U.verticalIconFeatureIndex=Ge.featureIndex;break}return U},yn.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var c=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},yn.prototype.hasTextData=function(){return this.text.segments.get().length>0},yn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yn.prototype.addIndicesForPlacedSymbol=function(o,u){for(var c=o.placedSymbolArray.get(u),m=c.vertexStartIndex+4*c.numGlyphs,x=c.vertexStartIndex;x<m;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)},yn.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),c=Math.cos(o),m=[],x=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var M=this.symbolInstances.get(T);m.push(0|Math.round(u*M.anchorX+c*M.anchorY)),x.push(M.featureIndex)}return E.sort(function(D,U){return m[D]-m[U]||x[U]-x[D]}),E},yn.prototype.addToSortKeyRanges=function(o,u){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===u?c.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},yn.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var x=this.symbolInstances.get(m[c]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(E,T,M){E>=0&&M.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},_n("SymbolBucket",yn,{omit:["layers","collisionBoxArray","features","compareText"]}),yn.MAX_GLYPHS=65535,yn.addDynamicAttributes=Er;var bn=new Ia({"symbol-placement":new kn(me.layout_symbol["symbol-placement"]),"symbol-spacing":new kn(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kn(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kn(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kn(me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kn(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new kn(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kn(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(me.layout_symbol["icon-size"]),"icon-text-fit":new kn(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kn(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(me.layout_symbol["icon-image"]),"icon-rotate":new Sn(me.layout_symbol["icon-rotate"]),"icon-padding":new kn(me.layout_symbol["icon-padding"]),"icon-keep-upright":new kn(me.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(me.layout_symbol["icon-offset"]),"icon-anchor":new Sn(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kn(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kn(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kn(me.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(me.layout_symbol["text-field"]),"text-font":new Sn(me.layout_symbol["text-font"]),"text-size":new Sn(me.layout_symbol["text-size"]),"text-max-width":new Sn(me.layout_symbol["text-max-width"]),"text-line-height":new kn(me.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(me.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(me.layout_symbol["text-justify"]),"text-radial-offset":new Sn(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kn(me.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(me.layout_symbol["text-anchor"]),"text-max-angle":new kn(me.layout_symbol["text-max-angle"]),"text-writing-mode":new kn(me.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(me.layout_symbol["text-rotate"]),"text-padding":new kn(me.layout_symbol["text-padding"]),"text-keep-upright":new kn(me.layout_symbol["text-keep-upright"]),"text-transform":new Sn(me.layout_symbol["text-transform"]),"text-offset":new Sn(me.layout_symbol["text-offset"]),"text-allow-overlap":new kn(me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kn(me.layout_symbol["text-ignore-placement"]),"text-optional":new kn(me.layout_symbol["text-optional"])}),qn={paint:new Ia({"icon-opacity":new Sn(me.paint_symbol["icon-opacity"]),"icon-color":new Sn(me.paint_symbol["icon-color"]),"icon-halo-color":new Sn(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(me.paint_symbol["icon-halo-blur"]),"icon-translate":new kn(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new kn(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new Sn(me.paint_symbol["text-opacity"]),"text-color":new Sn(me.paint_symbol["text-color"],{runtimeType:Yr,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new Sn(me.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(me.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(me.paint_symbol["text-halo-blur"]),"text-translate":new kn(me.paint_symbol["text-translate"]),"text-translate-anchor":new kn(me.paint_symbol["text-translate-anchor"])}),layout:bn},li=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:vn,this.defaultValue=o};li.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},li.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},li.prototype.outputDefined=function(){return!1},li.prototype.serialize=function(){return null},_n("FormatSectionOverride",li,{omit:["defaultValue"]});var Pi=function(o){function u(c){o.call(this,c,qn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){if(o.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],T=0,M=x;T<M.length;T+=1){var D=M[T];E.indexOf(D)<0&&E.push(D)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(c,m,x,E){var T=this.layout.get(c).evaluate(m,{},x,E),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||Nu(M.value)||!T?T:function(D,U){return U.replace(/{([^{}]+)}/g,function(H,X){return X in D?String(D[X]):""})}(m.properties,T)},u.prototype.createBucket=function(c){return new yn(c)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var c=0,m=qn.paint.overridableProperties;c<m.length;c+=1){var x=m[c];if(u.hasPaintOverride(this.layout,x)){var E,T=this.paint.get(x),M=new li(T),D=new Zl(M,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new dc("source",D):new Vl("composite",D,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new xo(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!(!this.layout||m.isDataDriven()||x.isDataDriven())&&u.hasPaintOverride(this.layout,c)},u.hasPaintOverride=function(c,m){var x=c.get("text-field"),E=qn.paint.properties[m],T=!1,M=function(H){for(var X=0,ie=H;X<ie.length;X+=1)if(E.overrides&&E.overrides.hasOverride(ie[X]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof va)M(x.value.value.sections);else if(x.value.kind==="source"){var D=function(H){T||(H instanceof ii&&xa(H.value)===Gi?M(H.value.sections):H instanceof Yo?M(H.sections):H.eachChild(D))},U=x.value;U._styleExpression&&D(U._styleExpression.expression)}return T},u}($s),Ga={paint:new Ia({"background-color":new kn(me.paint_background["background-color"]),"background-pattern":new Qo(me.paint_background["background-pattern"]),"background-opacity":new kn(me.paint_background["background-opacity"])})},Js=function(o){function u(c){o.call(this,c,Ga)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}($s),Yp={paint:new Ia({"raster-opacity":new kn(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new kn(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kn(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kn(me.paint_raster["raster-brightness-max"]),"raster-saturation":new kn(me.paint_raster["raster-saturation"]),"raster-contrast":new kn(me.paint_raster["raster-contrast"]),"raster-resampling":new kn(me.paint_raster["raster-resampling"]),"raster-fade-duration":new kn(me.paint_raster["raster-fade-duration"])})},eu=function(o){function u(c){o.call(this,c,Yp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}($s),op=function(o){function u(c){o.call(this,c,{}),this.implementation=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},u.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},u}($s),pl={circle:mh,heatmap:cl,hillshade:og,fill:Dd,"fill-extrusion":ip,line:Bd,symbol:Pi,background:Js,raster:eu},sp=re.HTMLImageElement,ug=re.HTMLCanvasElement,lg=re.HTMLVideoElement,cg=re.ImageData,Ud=re.ImageBitmap,Sh=function(o,u,c,m){this.context=o,this.format=c,this.texture=o.gl.createTexture(),this.update(u,m)};Sh.prototype.update=function(o,u,c){var m=o.width,x=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===x||c),T=this.context,M=T.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],o instanceof sp||o instanceof ug||o instanceof lg||o instanceof cg||Ud&&o instanceof Ud?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,m,x,0,this.format,M.UNSIGNED_BYTE,o.data);else{var D=c||{x:0,y:0},U=D.x,H=D.y;o instanceof sp||o instanceof ug||o instanceof lg||o instanceof cg||Ud&&o instanceof Ud?M.texSubImage2D(M.TEXTURE_2D,0,U,H,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,U,H,m,x,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Sh.prototype.bind=function(o,u,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Sh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Sh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var zd=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};zd.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},zd.prototype.remove=function(){delete this._channel,this._callback=function(){}};var up=function(o,u,c){this.target=o,this.parent=u,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Lr(["receive","process"],this),this.invoker=new zd(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=q()?o:re};function fg(o,u,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}up.prototype.send=function(o,u,c,m,x){var E=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[T]=c);var M=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:o,hasCallback:!!c,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:qo(u,M)},M),{cancel:function(){c&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},up.prototype.receive=function(o){var u=o.data,c=u.id;if(c&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else q()||u.mustQueue?(this.tasks[c]=u,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,u)},up.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},up.prototype.processTask=function(o,u){var c=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(ha(u.error)):m(null,ha(u.data)))}else{var x=!1,E=Me(this.globalScope)?void 0:[],T=u.hasCallback?function(H,X){x=!0,delete c.cancelCallbacks[o],c.target.postMessage({id:o,type:"<response>",sourceMapId:c.mapId,error:H?qo(H):null,data:qo(X,E)},E)}:function(H){x=!0},M=null,D=ha(u.data);if(this.parent[u.type])M=this.parent[u.type](u.sourceMapId,D,T);else if(this.parent.getWorkerSource){var U=u.type.split(".");M=this.parent.getWorkerSource(u.sourceMapId,U[0],D.source)[U[1]](D,T)}else T(new Error("Could not find function "+u.type));!x&&M&&M.cancel&&(this.cancelCallbacks[o]=M.cancel)}},up.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Mo=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Mo.prototype.setNorthEast=function(o){return this._ne=o instanceof Ua?new Ua(o.lng,o.lat):Ua.convert(o),this},Mo.prototype.setSouthWest=function(o){return this._sw=o instanceof Ua?new Ua(o.lng,o.lat):Ua.convert(o),this},Mo.prototype.extend=function(o){var u,c,m=this._sw,x=this._ne;if(o instanceof Ua)u=o,c=o;else{if(!(o instanceof Mo))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Mo.convert(o)):this.extend(Ua.convert(o)):this;if(c=o._ne,!(u=o._sw)||!c)return this}return m||x?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),x.lng=Math.max(c.lng,x.lng),x.lat=Math.max(c.lat,x.lat)):(this._sw=new Ua(u.lng,u.lat),this._ne=new Ua(c.lng,c.lat)),this},Mo.prototype.getCenter=function(){return new Ua((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Mo.prototype.getSouthWest=function(){return this._sw},Mo.prototype.getNorthEast=function(){return this._ne},Mo.prototype.getNorthWest=function(){return new Ua(this.getWest(),this.getNorth())},Mo.prototype.getSouthEast=function(){return new Ua(this.getEast(),this.getSouth())},Mo.prototype.getWest=function(){return this._sw.lng},Mo.prototype.getSouth=function(){return this._sw.lat},Mo.prototype.getEast=function(){return this._ne.lng},Mo.prototype.getNorth=function(){return this._ne.lat},Mo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Mo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Mo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Mo.prototype.contains=function(o){var u=Ua.convert(o),c=u.lng,m=u.lat,x=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&x},Mo.convert=function(o){return!o||o instanceof Mo?o:new Mo(o)};var Ua=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ua.prototype.wrap=function(){return new Ua(Ct(this.lng,-180,180),this.lat)},Ua.prototype.toArray=function(){return[this.lng,this.lat]},Ua.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ua.prototype.distanceTo=function(o){var u=Math.PI/180,c=this.lat*u,m=o.lat*u,x=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(x,1))},Ua.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,c=u/Math.cos(Math.PI/180*this.lat);return new Mo(new Ua(this.lng-c,this.lat-u),new Ua(this.lng+c,this.lat+u))},Ua.convert=function(o){if(o instanceof Ua)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Ua(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Ua(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var hg=2*Math.PI*63710088e-1;function pg(o){return hg*Math.cos(o*Math.PI/180)}function dg(o){return(180+o)/360}function vg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Vv(o,u){return o/pg(u)}function Zd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Ah=function(o,u,c){c===void 0&&(c=0),this.x=+o,this.y=+u,this.z=+c};Ah.fromLngLat=function(o,u){u===void 0&&(u=0);var c=Ua.convert(o);return new Ah(dg(c.lng),vg(c.lat),Vv(u,c.lat))},Ah.prototype.toLngLat=function(){return new Ua(360*this.x-180,Zd(this.y))},Ah.prototype.toAltitude=function(){return this.z*pg(Zd(this.y))},Ah.prototype.meterInMercatorCoordinateUnits=function(){return 1/hg*(o=Zd(this.y),1/Math.cos(o*Math.PI/180));var o};var Th=function(o,u,c){this.z=o,this.x=u,this.y=c,this.key=qp(0,o,o,u,c)};Th.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},Th.prototype.url=function(o,u){var c,m,x,E,T,M=(m=this.y,x=this.z,E=fg(256*(c=this.x),256*(m=Math.pow(2,x)-m-1),x),T=fg(256*(c+1),256*(m+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),D=function(U,H,X){for(var ie,he="",Fe=U;Fe>0;Fe--)he+=(H&(ie=1<<Fe-1)?1:0)+(X&ie?2:0);return he}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",M)},Th.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new te(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},Th.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var jv=function(o,u){this.wrap=o,this.canonical=u,this.key=qp(o,u.z,u.z,u.x,u.y)},Bo=function(o,u,c,m,x){this.overscaledZ=o,this.wrap=u,this.canonical=new Th(c,+m,+x),this.key=qp(u,o,c,m,x)};function qp(o,u,c,m,x){(o*=2)<0&&(o=-1*o-1);var E=1<<c;return(E*E*o+E*x+m).toString(36)+c.toString(36)+u.toString(36)}Bo.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},Bo.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new Bo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bo(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},Bo.prototype.calculateScaledKey=function(o,u){var c=this.canonical.z-o;return o>this.canonical.z?qp(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):qp(this.wrap*+u,o,o,this.canonical.x>>c,this.canonical.y>>c)},Bo.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},Bo.prototype.children=function(o){if(this.overscaledZ>=o)return[new Bo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Bo(u,this.wrap,u,c,m),new Bo(u,this.wrap,u,c+1,m),new Bo(u,this.wrap,u,c,m+1),new Bo(u,this.wrap,u,c+1,m+1)]},Bo.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},Bo.prototype.wrapped=function(){return new Bo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Bo.prototype.unwrapTo=function(o){return new Bo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},Bo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Bo.prototype.toUnwrapped=function(){return new jv(this.wrap,this.canonical)},Bo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Bo.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Ah(o.x-this.wrap,o.y))},_n("CanonicalTileID",Th),_n("OverscaledTileID",Bo,{omit:["posMatrix"]});var of=function(o,u,c){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return vt('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=c||"mapbox";for(var x=0;x<m;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(m,x)]=this.data[this._idx(m-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,m)]=this.data[this._idx(x,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};of.prototype.get=function(o,u){var c=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},of.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},of.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},of.prototype._unpackMapbox=function(o,u,c){return(256*o*256+256*u+c)/10-1e4},of.prototype._unpackTerrarium=function(o,u,c){return 256*o+u+c/256-32768},of.prototype.getPixels=function(){return new wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},of.prototype.backfillBorder=function(o,u,c){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,x=u*this.dim+this.dim,E=c*this.dim,T=c*this.dim+this.dim;switch(u){case-1:m=x-1;break;case 1:x=m+1}switch(c){case-1:E=T-1;break;case 1:T=E+1}for(var M=-u*this.dim,D=-c*this.dim,U=E;U<T;U++)for(var H=m;H<x;H++)this.data[this._idx(H,U)]=o.data[this._idx(H+M,U+D)]},_n("DEMData",of);var Vd=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var c=o[u];this._stringToNumber[c]=u,this._numberToString[u]=c}};Vd.prototype.encode=function(o){return this._stringToNumber[o]},Vd.prototype.decode=function(o){return this._numberToString[o]};var jd=function(o,u,c,m,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=c,o._y=m,this.properties=o.properties,this.id=x},Hv={geometry:{configurable:!0}};Hv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Hv.geometry.set=function(o){this._geometry=o},jd.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(jd.prototype,Hv);var lp=function(){this.state={},this.stateChanges={},this.deletedStates={}};lp.prototype.updateState=function(o,u,c){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},Gt(this.stateChanges[o][m],c),this.deletedStates[o]===null)for(var x in this.deletedStates[o]={},this.state[o])x!==m&&(this.deletedStates[o][x]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])c[E]||(this.deletedStates[o][m][E]=null);else for(var T in c)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][T]===null&&delete this.deletedStates[o][m][T]},lp.prototype.removeFeatureState=function(o,u,c){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},c&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][c]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(c in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][c]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},lp.prototype.getState=function(o,u){var c=String(u),m=Gt({},(this.state[o]||{})[c],(this.stateChanges[o]||{})[c]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var x=this.deletedStates[o][u];if(x===null)return{};for(var E in x)delete m[E]}return m},lp.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},lp.prototype.coalesceChanges=function(o,u){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var x={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Gt(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];c[m]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var M={};if(this.deletedStates[T]===null)for(var D in this.state[T])M[D]={},this.state[T][D]={};else for(var U in this.deletedStates[T]){if(this.deletedStates[T][U]===null)this.state[T][U]={};else for(var H=0,X=Object.keys(this.deletedStates[T][U]);H<X.length;H+=1)delete this.state[T][U][X[H]];M[U]=this.state[T][U]}c[T]=c[T]||{},Gt(c[T],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var ie in o)o[ie].setFeatureState(c,u)};var Ic=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new yo(8192,16,0),this.grid3D=new yo(8192,16,0),this.featureIndexArray=new $,this.promoteId=u};function mg(o,u,c,m,x){return hr(o,function(E,T){var M=u instanceof us?u.get(T):null;return M&&M.evaluate?M.evaluate(c,m,x):M})}function gg(o){for(var u=1/0,c=1/0,m=-1/0,x=-1/0,E=0,T=o;E<T.length;E+=1){var M=T[E];u=Math.min(u,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),x=Math.max(x,M.y)}return{minX:u,minY:c,maxX:m,maxY:x}}function B0(o,u){return u-o}Ic.prototype.insert=function(o,u,c,m,x,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,x);for(var M=E?this.grid3D:this.grid,D=0;D<u.length;D++){for(var U=u[D],H=[1/0,1/0,-1/0,-1/0],X=0;X<U.length;X++){var ie=U[X];H[0]=Math.min(H[0],ie.x),H[1]=Math.min(H[1],ie.y),H[2]=Math.max(H[2],ie.x),H[3]=Math.max(H[3],ie.y)}H[0]<8192&&H[1]<8192&&H[2]>=0&&H[3]>=0&&M.insert(T,H[0],H[1],H[2],H[3])}},Ic.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ec.VectorTile(new Xt(this.rawTileData)).layers,this.sourceLayerCoder=new Vd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ic.prototype.query=function(o,u,c,m){var x=this;this.loadVTLayers();for(var E=o.params||{},T=8192/o.tileSize/o.scale,M=nl(E.filter),D=o.queryGeometry,U=o.queryPadding*T,H=gg(D),X=this.grid.query(H.minX-U,H.minY-U,H.maxX+U,H.maxY+U),ie=gg(o.cameraQueryGeometry),he=this.grid3D.query(ie.minX-U,ie.minY-U,ie.maxX+U,ie.maxY+U,function(kt,Qt,fr,Br){return function($r,zn,hn,Hn,pn){for(var an=0,jr=$r;an<jr.length;an+=1){var Cn=jr[an];if(zn<=Cn.x&&hn<=Cn.y&&Hn>=Cn.x&&pn>=Cn.y)return!0}var ki=[new te(zn,hn),new te(zn,pn),new te(Hn,pn),new te(Hn,hn)];if($r.length>2){for(var bi=0,Yi=ki;bi<Yi.length;bi+=1)if(cu($r,Yi[bi]))return!0}for(var Xn=0;Xn<$r.length-1;Xn++)if(ll($r[Xn],$r[Xn+1],ki))return!0;return!1}(o.cameraQueryGeometry,kt-U,Qt-U,fr+U,Br+U)}),Fe=0,Le=he;Fe<Le.length;Fe+=1)X.push(Le[Fe]);X.sort(B0);for(var at,Ge={},yt=function(kt){var Qt=X[kt];if(Qt!==at){at=Qt;var fr=x.featureIndexArray.get(Qt),Br=null;x.loadMatchingFeature(Ge,fr.bucketIndex,fr.sourceLayerIndex,fr.featureIndex,M,E.layers,E.availableImages,u,c,m,function($r,zn,hn){return Br||(Br=Ba($r)),zn.queryIntersectsFeature(D,$r,hn,Br,x.z,o.transform,T,o.pixelPosMatrix)})}},Dt=0;Dt<X.length;Dt++)yt(Dt);return Ge},Ic.prototype.loadMatchingFeature=function(o,u,c,m,x,E,T,M,D,U,H){var X=this.bucketLayerIDs[u];if(!E||function($r,zn){for(var hn=0;hn<$r.length;hn++)if(zn.indexOf($r[hn])>=0)return!0;return!1}(E,X)){var ie=this.sourceLayerCoder.decode(c),he=this.vtLayers[ie].feature(m);if(x.needGeometry){var Fe=Ha(he,!0);if(!x.filter(new Ee(this.tileID.overscaledZ),Fe,this.tileID.canonical))return}else if(!x.filter(new Ee(this.tileID.overscaledZ),he))return;for(var Le=this.getId(he,ie),at=0;at<X.length;at++){var Ge=X[at];if(!(E&&E.indexOf(Ge)<0)){var yt=M[Ge];if(yt){var Dt={};Le!==void 0&&U&&(Dt=U.getState(yt.sourceLayer||"_geojsonTileLayer",Le));var kt=Gt({},D[Ge]);kt.paint=mg(kt.paint,yt.paint,he,Dt,T),kt.layout=mg(kt.layout,yt.layout,he,Dt,T);var Qt=!H||H(he,yt,Dt);if(Qt){var fr=new jd(he,this.z,this.x,this.y,Le);fr.layer=kt;var Br=o[Ge];Br===void 0&&(Br=o[Ge]=[]),Br.push({featureIndex:m,feature:fr,intersectionZ:Qt})}}}}}},Ic.prototype.lookupSymbolFeatures=function(o,u,c,m,x,E,T,M){var D={};this.loadVTLayers();for(var U=nl(x),H=0,X=o;H<X.length;H+=1)this.loadMatchingFeature(D,c,m,X[H],U,E,T,M,u);return D},Ic.prototype.hasLayer=function(o){for(var u=0,c=this.bucketLayerIDs;u<c.length;u+=1)for(var m=0,x=c[u];m<x.length;m+=1)if(o===x[m])return!0;return!1},Ic.prototype.getId=function(o,u){var c=o.id;return this.promoteId&&typeof(c=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(c=Number(c)),c},_n("FeatureIndex",Ic,{omit:["rawTileData","sourceLayerCoder"]});var Lo=function(o,u){this.tileID=o,this.uid=Zt(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Lo.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<Kn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},Lo.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Lo.prototype.loadVectorData=function(o,u,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(U,H){var X={};if(!H)return X;for(var ie=function(){var Le=Fe[he],at=Le.layerIds.map(function(Dt){return H.getLayer(Dt)}).filter(Boolean);if(at.length!==0){Le.layers=at,Le.stateDependentLayerIds&&(Le.stateDependentLayers=Le.stateDependentLayerIds.map(function(Dt){return at.filter(function(kt){return kt.id===Dt})[0]}));for(var Ge=0,yt=at;Ge<yt.length;Ge+=1)X[yt[Ge].id]=Le}},he=0,Fe=U;he<Fe.length;he+=1)ie();return X}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[m];if(x instanceof yn){if(this.hasSymbolBuckets=!0,!c)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof yn&&T.hasRTLText){this.hasRTLText=!0,Ot.isLoading()||Ot.isLoaded()||Qc()!=="deferred"||Fs();break}}for(var M in this.queryPadding=0,this.buckets){var D=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(M).queryRadius(D))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},Lo.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Lo.prototype.getBucket=function(o){return this.buckets[o.id]},Lo.prototype.upload=function(o){for(var u in this.buckets){var c=this.buckets[u];c.uploadPending()&&c.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Sh(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Sh(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},Lo.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},Lo.prototype.queryRenderedFeatures=function(o,u,c,m,x,E,T,M,D,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:U,transform:M,params:T,queryPadding:this.queryPadding*D},o,u,c):{}},Lo.prototype.querySourceFeatures=function(o,u){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),x=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(E)for(var T=nl(u&&u.filter),M=this.tileID.canonical,D=M.z,U=M.x,H=M.y,X={z:D,x:U,y:H},ie=0;ie<E.length;ie++){var he=E.feature(ie);if(T.needGeometry){var Fe=Ha(he,!0);if(!T.filter(new Ee(this.tileID.overscaledZ),Fe,this.tileID.canonical))continue}else if(!T.filter(new Ee(this.tileID.overscaledZ),he))continue;var Le=c.getId(he,x),at=new jd(he,D,U,H,Le);at.tile=X,o.push(at)}}},Lo.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Lo.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Lo.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var c=De(o.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),x=!1;if(this.expirationTime>m)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Lo.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Lo.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",T=c[E],M=o[E];if(T&&M&&Object.keys(M).length!==0){x.update(M,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=u&&u.style&&u.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(x)))}}}},Lo.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Lo.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kn.now()},Lo.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Lo.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=Kn.now()+o},Lo.prototype.setDependencies=function(o,u){for(var c={},m=0,x=u;m<x.length;m+=1)c[x[m]]=!0;this.dependencies[o]=c},Lo.prototype.hasDependency=function(o,u){for(var c=0,m=o;c<m.length;c+=1){var x=this.dependencies[m[c]];if(x){for(var E=0,T=u;E<T.length;E+=1)if(x[T[E]])return!0}}return!1};var jf=re.performance,_g=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},jf.mark(this._marks.start)};_g.prototype.finish=function(){jf.mark(this._marks.end);var o=jf.getEntriesByName(this._marks.measure);return o.length===0&&(jf.measure(this._marks.measure,this._marks.start,this._marks.end),o=jf.getEntriesByName(this._marks.measure),jf.clearMarks(this._marks.start),jf.clearMarks(this._marks.end),jf.clearMeasures(this._marks.measure)),o},y.Actor=up,y.AlphaImage=Ys,y.CanonicalTileID=Th,y.CollisionBoxArray=v,y.Color=Ai,y.DEMData=of,y.DataConstantProperty=kn,y.DictionaryCoder=Vd,y.EXTENT=8192,y.ErrorEvent=it,y.EvaluationParameters=Ee,y.Event=ke,y.Evented=ct,y.FeatureIndex=Ic,y.FillBucket=qs,y.FillExtrusionBucket=ds,y.ImageAtlas=ot,y.ImagePosition=Qr,y.LineBucket=Xo,y.LngLat=Ua,y.LngLatBounds=Mo,y.MercatorCoordinate=Ah,y.ONE_EM=24,y.OverscaledTileID=Bo,y.Point=te,y.Point$1=te,y.Properties=Ia,y.Protobuf=Xt,y.RGBAImage=wo,y.RequestManager=zi,y.RequestPerformance=_g,y.ResourceType=Tn,y.SegmentVector=_e,y.SourceFeatureState=lp,y.StructArrayLayout1ui2=kf,y.StructArrayLayout2f1f2i16=Yl,y.StructArrayLayout2i4=Ml,y.StructArrayLayout3ui6=Jo,y.StructArrayLayout4i8=Of,y.SymbolBucket=yn,y.Texture=Sh,y.Tile=Lo,y.Transitionable=ve,y.Uniform1f=Ur,y.Uniform1i=pr,y.Uniform2f=Fr,y.Uniform3f=ln,y.Uniform4f=Un,y.UniformColor=Bn,y.UniformMatrix4f=Zi,y.UnwrappedTileID=jv,y.ValidationError=Y,y.WritingMode=jn,y.ZoomHistory=Mf,y.add=function(o,u,c){return o[0]=u[0]+c[0],o[1]=u[1]+c[1],o[2]=u[2]+c[2],o},y.addDynamicAttributes=Er,y.asyncAll=function(o,u,c){if(!o.length)return c(null,[]);var m=o.length,x=new Array(o.length),E=null;o.forEach(function(T,M){u(T,function(D,U){D&&(E=D),x[M]=U,--m==0&&c(E,x)})})},y.bezier=Ke,y.bindAll=Lr,y.browser=Kn,y.cacheEntryPossiblyAdded=function(o){++On>sr&&(o.getActor().send("enforceCacheSizeLimit",Mt),On=0)},y.clamp=Tt,y.clearTileCache=function(o){var u=re.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},y.clipLine=hl,y.clone=function(o){var u=new Ui(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},y.clone$1=lt,y.clone$2=function(o){var u=new Ui(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},y.collisionCircleLayout=V,y.config=on,y.create=function(){var o=new Ui(16);return Ui!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},y.create$1=function(){var o=new Ui(9);return Ui!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},y.create$2=function(){var o=new Ui(4);return Ui!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},y.createCommonjsModule=ce,y.createExpression=Wc,y.createLayout=uo,y.createStyleLayer=function(o){return o.type==="custom"?new op(o):new pl[o.type](o)},y.cross=function(o,u,c){var m=u[0],x=u[1],E=u[2],T=c[0],M=c[1],D=c[2];return o[0]=x*D-E*M,o[1]=E*T-m*D,o[2]=m*M-x*T,o},y.deepEqual=function o(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],c[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(var x in u)if(!o(u[x],c[x]))return!1;return!0}return u===c},y.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},y.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},y.ease=nt,y.emitValidationErrors=Gl,y.endsWith=mr,y.enforceCacheSizeLimit=function(o){dr(),se&&se.then(function(u){u.keys().then(function(c){for(var m=0;m<c.length-o;m++)u.delete(c[m])})})},y.evaluateSizeForFeature=es,y.evaluateSizeForZoom=Ro,y.evaluateVariableOffset=ut,y.evented=xc,y.extend=Gt,y.featureFilter=nl,y.filterObject=Et,y.fromRotation=function(o,u){var c=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=c,o[2]=0,o[3]=-c,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},y.getAnchorAlignment=ba,y.getAnchorJustification=dt,y.getArrayBuffer=Ts,y.getImage=J,y.getJSON=function(o,u){return Zo(Gt(o,{type:"json"}),u)},y.getRTLTextPluginStatus=Qc,y.getReferrer=ni,y.getVideo=function(o,u){var c,m,x=re.document.createElement("video");x.muted=!0,x.onloadstart=function(){u(null,x)};for(var E=0;E<o.length;E++){var T=re.document.createElement("source");c=o[E],m=void 0,(m=re.document.createElement("a")).href=c,(m.protocol!==re.document.location.protocol||m.host!==re.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=o[E],x.appendChild(T)}return{cancel:function(){}}},y.identity=Go,y.invert=function(o,u){var c=u[0],m=u[1],x=u[2],E=u[3],T=u[4],M=u[5],D=u[6],U=u[7],H=u[8],X=u[9],ie=u[10],he=u[11],Fe=u[12],Le=u[13],at=u[14],Ge=u[15],yt=c*M-m*T,Dt=c*D-x*T,kt=c*U-E*T,Qt=m*D-x*M,fr=m*U-E*M,Br=x*U-E*D,$r=H*Le-X*Fe,zn=H*at-ie*Fe,hn=H*Ge-he*Fe,Hn=X*at-ie*Le,pn=X*Ge-he*Le,an=ie*Ge-he*at,jr=yt*an-Dt*pn+kt*Hn+Qt*hn-fr*zn+Br*$r;return jr?(o[0]=(M*an-D*pn+U*Hn)*(jr=1/jr),o[1]=(x*pn-m*an-E*Hn)*jr,o[2]=(Le*Br-at*fr+Ge*Qt)*jr,o[3]=(ie*fr-X*Br-he*Qt)*jr,o[4]=(D*hn-T*an-U*zn)*jr,o[5]=(c*an-x*hn+E*zn)*jr,o[6]=(at*kt-Fe*Br-Ge*Dt)*jr,o[7]=(H*Br-ie*kt+he*Dt)*jr,o[8]=(T*pn-M*hn+U*$r)*jr,o[9]=(m*hn-c*pn-E*$r)*jr,o[10]=(Fe*fr-Le*kt+Ge*yt)*jr,o[11]=(X*kt-H*fr-he*yt)*jr,o[12]=(M*zn-T*Hn-D*$r)*jr,o[13]=(c*Hn-m*zn+x*$r)*jr,o[14]=(Le*Dt-Fe*Qt-at*yt)*jr,o[15]=(H*Qt-X*Dt+ie*yt)*jr,o):null},y.isChar=qr,y.isMapboxURL=Li,y.keysDifference=function(o,u){var c=[];for(var m in o)m in u||c.push(m);return c},y.makeRequest=Zo,y.mapObject=hr,y.mercatorXfromLng=dg,y.mercatorYfromLat=vg,y.mercatorZfromAltitude=Vv,y.mul=Sc,y.multiply=Ja,y.mvt=ec,y.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},y.normalize=function(o,u){var c=u[0],m=u[1],x=u[2],E=c*c+m*m+x*x;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},y.number=Za,y.offscreenCanvasSupported=An,y.ortho=function(o,u,c,m,x,E,T){var M=1/(u-c),D=1/(m-x),U=1/(E-T);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*D,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*U,o[11]=0,o[12]=(u+c)*M,o[13]=(x+m)*D,o[14]=(T+E)*U,o[15]=1,o},y.parseGlyphPBF=function(o){return new Xt(o).readFields(_r,[])},y.pbf=Xt,y.performSymbolLayout=function(o,u,c,m,x,E,T){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var M=o.layers[0].layout,D=o.layers[0]._unevaluatedLayout._values,U={};if(o.textSizeData.kind==="composite"){var H=o.textSizeData,X=H.maxZoom;U.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ee(H.minZoom),T),D["text-size"].possiblyEvaluate(new Ee(X),T)]}if(o.iconSizeData.kind==="composite"){var ie=o.iconSizeData,he=ie.maxZoom;U.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ee(ie.minZoom),T),D["icon-size"].possiblyEvaluate(new Ee(he),T)]}U.layoutTextSize=D["text-size"].possiblyEvaluate(new Ee(o.zoom+1),T),U.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ee(o.zoom+1),T),U.textMaxSize=D["text-size"].possiblyEvaluate(new Ee(18));for(var Fe=24*M.get("text-line-height"),Le=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",at=M.get("text-keep-upright"),Ge=M.get("text-size"),yt=function(){var Qt=kt[Dt],fr=M.get("text-font").evaluate(Qt,{},T).join(","),Br=Ge.evaluate(Qt,{},T),$r=U.layoutTextSize.evaluate(Qt,{},T),zn=U.layoutIconSize.evaluate(Qt,{},T),hn={horizontal:{},vertical:void 0},Hn=Qt.text,pn=[0,0];if(Hn){var an=Hn.toString(),jr=24*M.get("text-letter-spacing").evaluate(Qt,{},T),Cn=function(Vi){for(var Aa=0,ga=Vi;Aa<ga.length;Aa+=1)if(Ki=ga[Aa].charCodeAt(0),qr.Arabic(Ki)||qr["Arabic Supplement"](Ki)||qr["Arabic Extended-A"](Ki)||qr["Arabic Presentation Forms-A"](Ki)||qr["Arabic Presentation Forms-B"](Ki))return!1;var Ki;return!0}(an)?jr:0,ki=M.get("text-anchor").evaluate(Qt,{},T),bi=M.get("text-variable-anchor");if(!bi){var Yi=M.get("text-radial-offset").evaluate(Qt,{},T);pn=Yi?ut(ki,[24*Yi,Je]):M.get("text-offset").evaluate(Qt,{},T).map(function(Vi){return 24*Vi})}var Xn=Le?"center":M.get("text-justify").evaluate(Qt,{},T),aa=M.get("symbol-placement"),Xa=aa==="point"?24*M.get("text-max-width").evaluate(Qt,{},T):0,po=function(){o.allowVerticalPlacement&&al(an)&&(hn.vertical=Si(Hn,u,c,x,fr,Xa,Fe,ki,"left",Cn,pn,jn.vertical,!0,aa,$r,Br))};if(!Le&&bi){for(var no=Xn==="auto"?bi.map(function(Vi){return dt(Vi)}):[Xn],$a=!1,vo=0;vo<no.length;vo++){var rs=no[vo];if(!hn.horizontal[rs])if($a)hn.horizontal[rs]=hn.horizontal[0];else{var ns=Si(Hn,u,c,x,fr,Xa,Fe,"center",rs,Cn,pn,jn.horizontal,!1,aa,$r,Br);ns&&(hn.horizontal[rs]=ns,$a=ns.positionedLines.length===1)}}po()}else{Xn==="auto"&&(Xn=dt(ki));var tu=Si(Hn,u,c,x,fr,Xa,Fe,ki,Xn,Cn,pn,jn.horizontal,!1,aa,$r,Br);tu&&(hn.horizontal[Xn]=tu),po(),al(an)&&Le&&at&&(hn.vertical=Si(Hn,u,c,x,fr,Xa,Fe,ki,Xn,Cn,pn,jn.vertical,!1,aa,$r,Br))}}var is=void 0,ru=!1;if(Qt.icon&&Qt.icon.name){var Io=m[Qt.icon.name];Io&&(is=function(Vi,Aa,ga){var Ki=ba(ga),pu=Aa[0]-Vi.displaySize[0]*Ki.horizontalAlign,Ns=Aa[1]-Vi.displaySize[1]*Ki.verticalAlign;return{image:Vi,top:Ns,bottom:Ns+Vi.displaySize[1],left:pu,right:pu+Vi.displaySize[0]}}(x[Qt.icon.name],M.get("icon-offset").evaluate(Qt,{},T),M.get("icon-anchor").evaluate(Qt,{},T)),ru=Io.sdf,o.sdfIcons===void 0?o.sdfIcons=Io.sdf:o.sdfIcons!==Io.sdf&&vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Io.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var vs=et(hn.horizontal)||hn.vertical;o.iconsInText=!!vs&&vs.iconsInText,(vs||is)&&function(Vi,Aa,ga,Ki,pu,Ns,za,No,Us,qi,sf){var dl=Ns.textMaxSize.evaluate(Aa,{});dl===void 0&&(dl=za);var uf,Po=Vi.layers[0].layout,lf=Po.get("icon-offset").evaluate(Aa,{},sf),tc=et(ga.horizontal),Kp=za/24,cp=Vi.tilePixelRatio*Kp,Qp=Vi.tilePixelRatio*dl/24,Hf=Vi.tilePixelRatio*No,Jp=Vi.tilePixelRatio*Po.get("symbol-spacing"),Wv=Po.get("text-padding")*Vi.tilePixelRatio,ed=Po.get("icon-padding")*Vi.tilePixelRatio,wh=Po.get("text-max-angle")/180*Math.PI,Hd=Po.get("text-rotation-alignment")==="map"&&Po.get("symbol-placement")!=="point",td=Po.get("icon-rotation-alignment")==="map"&&Po.get("symbol-placement")!=="point",Pc=Po.get("symbol-placement"),Oc=Jp/2,Dl=Po.get("icon-text-fit");Ki&&Dl!=="none"&&(Vi.allowVerticalPlacement&&ga.vertical&&(uf=fo(Ki,ga.vertical,Dl,Po.get("icon-text-fit-padding"),lf,Kp)),tc&&(Ki=fo(Ki,tc,Dl,Po.get("icon-text-fit-padding"),lf,Kp)));var cf=function(L0,od){od.x<0||od.x>=8192||od.y<0||od.y>=8192||function(mo,rc,W,ff,$d,Yv,sd,nc,ud,gp,Fc,ld,Yd,qv,_p,Kv,xg,bg,Qv,Jv,wu,cd,em,Hu,Eg){var tm,Gf,Xf,yp,Mh,xp=mo.addToLineVertexArray(rc,W),Sg=0,rm=0,Ag=0,Fl=0,nm=-1,im=-1,hf={},Tg=Ie(""),Ih=0,qd=0;if(nc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ih=(tm=nc.layout.get("text-offset").evaluate(wu,{},Hu).map(function(Ep){return 24*Ep}))[0],qd=tm[1]):(Ih=24*nc.layout.get("text-radial-offset").evaluate(wu,{},Hu),qd=Je),mo.allowVerticalPlacement&&ff.vertical){var am=nc.layout.get("text-rotate").evaluate(wu,{},Hu)+90;yp=new pa(ud,rc,gp,Fc,ld,ff.vertical,Yd,qv,_p,am),sd&&(Mh=new pa(ud,rc,gp,Fc,ld,sd,xg,bg,_p,am))}if($d){var Kd=nc.layout.get("icon-rotate").evaluate(wu,{}),Qd=nc.layout.get("icon-text-fit")!=="none",om=Ne($d,Kd,em,Qd),sm=sd?Ne(sd,Kd,em,Qd):void 0;Xf=new pa(ud,rc,gp,Fc,ld,$d,xg,bg,!1,Kd),Sg=4*om.length;var wg=mo.iconSizeData,Ph=null;wg.kind==="source"?(Ph=[128*nc.layout.get("icon-size").evaluate(wu,{})])[0]>32640&&vt(mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):wg.kind==="composite"&&((Ph=[128*cd.compositeIconSizes[0].evaluate(wu,{},Hu),128*cd.compositeIconSizes[1].evaluate(wu,{},Hu)])[0]>32640||Ph[1]>32640)&&vt(mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),mo.addSymbols(mo.icon,om,Ph,Jv,Qv,wu,!1,rc,xp.lineStartIndex,xp.lineLength,-1,Hu),nm=mo.icon.placedSymbolArray.length-1,sm&&(rm=4*sm.length,mo.addSymbols(mo.icon,sm,Ph,Jv,Qv,wu,jn.vertical,rc,xp.lineStartIndex,xp.lineLength,-1,Hu),im=mo.icon.placedSymbolArray.length-1)}for(var Jd in ff.horizontal){var bp=ff.horizontal[Jd];if(!Gf){Tg=Ie(bp.text);var ev=nc.layout.get("text-rotate").evaluate(wu,{},Hu);Gf=new pa(ud,rc,gp,Fc,ld,bp,Yd,qv,_p,ev)}var fd=bp.positionedLines.length===1;if(Ag+=ze(mo,rc,bp,Yv,nc,_p,wu,Kv,xp,ff.vertical?jn.horizontal:jn.horizontalOnly,fd?Object.keys(ff.horizontal):[Jd],hf,nm,cd,Hu),fd)break}ff.vertical&&(Fl+=ze(mo,rc,ff.vertical,Yv,nc,_p,wu,Kv,xp,jn.vertical,["vertical"],hf,im,cd,Hu));var um=Gf?Gf.boxStartIndex:mo.collisionBoxArray.length,lm=Gf?Gf.boxEndIndex:mo.collisionBoxArray.length,tv=yp?yp.boxStartIndex:mo.collisionBoxArray.length,hd=yp?yp.boxEndIndex:mo.collisionBoxArray.length,Wu=Xf?Xf.boxStartIndex:mo.collisionBoxArray.length,cm=Xf?Xf.boxEndIndex:mo.collisionBoxArray.length,fm=Mh?Mh.boxStartIndex:mo.collisionBoxArray.length,$f=Mh?Mh.boxEndIndex:mo.collisionBoxArray.length,kc=-1,rv=function(Ep,hm){return Ep&&Ep.circleDiameter?Math.max(Ep.circleDiameter,hm):hm};kc=rv(Gf,kc),kc=rv(yp,kc),kc=rv(Xf,kc);var Cg=(kc=rv(Mh,kc))>-1?1:0;Cg&&(kc*=Eg/24),mo.glyphOffsetArray.length>=yn.MAX_GLYPHS&&vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wu.sortKey!==void 0&&mo.addToSortKeyRanges(mo.symbolInstances.length,wu.sortKey),mo.symbolInstances.emplaceBack(rc.x,rc.y,hf.right>=0?hf.right:-1,hf.center>=0?hf.center:-1,hf.left>=0?hf.left:-1,hf.vertical||-1,nm,im,Tg,um,lm,tv,hd,Wu,cm,fm,$f,gp,Ag,Fl,Sg,rm,Cg,0,Yd,Ih,qd,kc)}(Vi,od,L0,ga,Ki,pu,uf,Vi.layers[0],Vi.collisionBoxArray,Aa.index,Aa.sourceLayerIndex,Vi.index,cp,Wv,Hd,Us,Hf,ed,td,lf,Aa,Ns,qi,sf,za)};if(Pc==="line")for(var Ch=0,rd=hl(Aa.geometry,0,0,8192,8192);Ch<rd.length;Ch+=1)for(var fp=rd[Ch],hp=0,nd=ho(fp,Jp,wh,ga.vertical||tc,Ki,24,Qp,Vi.overscaling,8192);hp<nd.length;hp+=1){var Wd=nd[hp];tc&&we(Vi,tc.text,Oc,Wd)||cf(fp,Wd)}else if(Pc==="line-center")for(var pp=0,dp=Aa.geometry;pp<dp.length;pp+=1){var id=dp[pp];if(id.length>1){var Gd=$i(id,wh,ga.vertical||tc,Ki,24,Qp);Gd&&cf(id,Gd)}}else if(Aa.type==="Polygon")for(var vp=0,Xd=tp(Aa.geometry,0);vp<Xd.length;vp+=1){var Dc=Xd[vp],bs=We(Dc,16);cf(Dc[0],new Na(bs.x,bs.y,0))}else if(Aa.type==="LineString")for(var Wf=0,mp=Aa.geometry;Wf<mp.length;Wf+=1){var Rh=mp[Wf];cf(Rh,new Na(Rh[0].x,Rh[0].y,0))}else if(Aa.type==="Point")for(var ad=0,Gv=Aa.geometry;ad<Gv.length;ad+=1)for(var Xv=0,yg=Gv[ad];Xv<yg.length;Xv+=1){var $v=yg[Xv];cf([$v],new Na($v.x,$v.y,0))}}(o,Qt,hn,is,m,U,$r,zn,pn,ru,T)},Dt=0,kt=o.features;Dt<kt.length;Dt+=1)yt();E&&o.generateCollisionDebugBuffers()},y.perspective=function(o,u,c,m,x){var E,T=1/Math.tan(u/2);return o[0]=T/c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,x!=null&&x!==1/0?(o[10]=(x+m)*(E=1/(m-x)),o[14]=2*x*m*E):(o[10]=-1,o[14]=-2*m),o},y.pick=function(o,u){for(var c={},m=0;m<u.length;m++){var x=u[m];x in o&&(c[x]=o[x])}return c},y.plugin=Ot,y.polygonIntersectsPolygon=sl,y.postMapLoadEvent=Xe,y.postTurnstileEvent=Kt,y.potpack=si,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=_n,y.registerForPluginStateChange=function(o){return o({pluginStatus:ss,pluginURL:_u}),xc.on("pluginStateChange",o),o},y.renderColorRamp=Kl,y.rotate=function(o,u,c){var m=u[0],x=u[1],E=u[2],T=u[3],M=Math.sin(c),D=Math.cos(c);return o[0]=m*D+E*M,o[1]=x*D+T*M,o[2]=m*-M+E*D,o[3]=x*-M+T*D,o},y.rotateX=function(o,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[4],T=u[5],M=u[6],D=u[7],U=u[8],H=u[9],X=u[10],ie=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*x+U*m,o[5]=T*x+H*m,o[6]=M*x+X*m,o[7]=D*x+ie*m,o[8]=U*x-E*m,o[9]=H*x-T*m,o[10]=X*x-M*m,o[11]=ie*x-D*m,o},y.rotateZ=function(o,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[0],T=u[1],M=u[2],D=u[3],U=u[4],H=u[5],X=u[6],ie=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*x+U*m,o[1]=T*x+H*m,o[2]=M*x+X*m,o[3]=D*x+ie*m,o[4]=U*x-E*m,o[5]=H*x-T*m,o[6]=X*x-M*m,o[7]=ie*x-D*m,o},y.scale=function(o,u,c){var m=c[0],x=c[1],E=c[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*x,o[5]=u[5]*x,o[6]=u[6]*x,o[7]=u[7]*x,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},y.scale$1=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o[3]=u[3]*c,o},y.scale$2=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o},y.setCacheLimits=function(o,u){Mt=o,sr=u},y.setRTLTextPlugin=function(o,u,c){if(c===void 0&&(c=!1),ss==="deferred"||ss==="loading"||ss==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");_u=Kn.resolveURL(o),ss="deferred",Pf=u,yc(),c||Fs()},y.sphericalToCartesian=function(o){var u=o[0],c=o[1],m=o[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(m),y:u*Math.sin(c)*Math.sin(m),z:u*Math.cos(m)}},y.sqrLen=function(o){var u=o[0],c=o[1];return u*u+c*c},y.styleSpec=me,y.sub=function(o,u,c){return o[0]=u[0]-c[0],o[1]=u[1]-c[1],o[2]=u[2]-c[2],o},y.symbolSize=Ei,y.transformMat3=function(o,u,c){var m=u[0],x=u[1],E=u[2];return o[0]=m*c[0]+x*c[3]+E*c[6],o[1]=m*c[1]+x*c[4]+E*c[7],o[2]=m*c[2]+x*c[5]+E*c[8],o},y.transformMat4=ju,y.translate=function(o,u,c){var m,x,E,T,M,D,U,H,X,ie,he,Fe,Le=c[0],at=c[1],Ge=c[2];return u===o?(o[12]=u[0]*Le+u[4]*at+u[8]*Ge+u[12],o[13]=u[1]*Le+u[5]*at+u[9]*Ge+u[13],o[14]=u[2]*Le+u[6]*at+u[10]*Ge+u[14],o[15]=u[3]*Le+u[7]*at+u[11]*Ge+u[15]):(x=u[1],E=u[2],T=u[3],M=u[4],D=u[5],U=u[6],H=u[7],X=u[8],ie=u[9],he=u[10],Fe=u[11],o[0]=m=u[0],o[1]=x,o[2]=E,o[3]=T,o[4]=M,o[5]=D,o[6]=U,o[7]=H,o[8]=X,o[9]=ie,o[10]=he,o[11]=Fe,o[12]=m*Le+M*at+X*Ge+u[12],o[13]=x*Le+D*at+ie*Ge+u[13],o[14]=E*Le+U*at+he*Ge+u[14],o[15]=T*Le+H*at+Fe*Ge+u[15]),o},y.triggerPluginCompletionEvent=Kh,y.uniqueId=Zt,y.validateCustomStyleLayer=function(o){var u=[],c=o.id;return c===void 0&&u.push({message:"layers."+c+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+c+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),u},y.validateLight=qh,y.validateStyle=Gs,y.values=function(o){var u=[];for(var c in o)u.push(o[c]);return u},y.vectorTile=ec,y.version="1.13.3",y.warnOnce=vt,y.webpSupported=Pn,y.window=re,y.wrap=Ct}),ee(["./shared"],function(y){"use strict";function ce(G){var J=typeof G;if(J==="number"||J==="boolean"||J==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ue="[",be=0,ke=G;be<ke.length;be+=1)ue+=ce(ke[be])+",";return ue+"]"}for(var it=Object.keys(G).sort(),ct="{",me=0;me<it.length;me++)ct+=JSON.stringify(it[me])+":"+ce(G[it[me]])+",";return ct+"}"}function z(G){for(var J="",ue=0,be=y.refProperties;ue<be.length;ue+=1)J+="/"+ce(G[be[ue]]);return J}var ae=function(G){this.keyCache={},G&&this.replace(G)};ae.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},ae.prototype.update=function(G,J){for(var ue=this,be=0,ke=G;be<ke.length;be+=1){var it=ke[be];this._layerConfigs[it.id]=it;var ct=this._layers[it.id]=y.createStyleLayer(it);ct._featureFilter=y.featureFilter(ct.filter),this.keyCache[it.id]&&delete this.keyCache[it.id]}for(var me=0,Y=J;me<Y.length;me+=1){var ye=Y[me];delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye]}this.familiesBySource={};for(var tt=0,gt=function(Hr,Yr){for(var gi={},Jr=0;Jr<Hr.length;Jr++){var xi=Yr&&Yr[Hr[Jr].id]||z(Hr[Jr]);Yr&&(Yr[Hr[Jr].id]=xi);var Gi=gi[xi];Gi||(Gi=gi[xi]=[]),Gi.push(Hr[Jr])}var _i=[];for(var Ci in gi)_i.push(gi[Ci]);return _i}(y.values(this._layerConfigs),this.keyCache);tt<gt.length;tt+=1){var le=gt[tt].map(function(Hr){return ue._layers[Hr.id]}),br=le[0];if(br.visibility!=="none"){var En=br.source||"",vn=this.familiesBySource[En];vn||(vn=this.familiesBySource[En]={});var rr=br.sourceLayer||"_geojsonTileLayer",nn=vn[rr];nn||(nn=vn[rr]=[]),nn.push(le)}}};var te=function(G){var J={},ue=[];for(var be in G){var ke=G[be],it=J[be]={};for(var ct in ke){var me=ke[+ct];if(me&&me.bitmap.width!==0&&me.bitmap.height!==0){var Y={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};ue.push(Y),it[ct]={rect:Y,metrics:me.metrics}}}}var ye=y.potpack(ue),tt=new y.AlphaImage({width:ye.w||1,height:ye.h||1});for(var gt in G){var le=G[gt];for(var br in le){var En=le[+br];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var vn=J[gt][br].rect;y.AlphaImage.copy(En.bitmap,tt,{x:0,y:0},{x:vn.x+1,y:vn.y+1},En.bitmap)}}}this.image=tt,this.positions=J};y.register("GlyphAtlas",te);var Pe=function(G){this.tileID=new y.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function re(G,J,ue){for(var be=new y.EvaluationParameters(J),ke=0,it=G;ke<it.length;ke+=1)it[ke].recalculate(be,ue)}function Ze(G,J){var ue=y.getArrayBuffer(G.request,function(be,ke,it,ct){be?J(be):ke&&J(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(ke)),rawData:ke,cacheControl:it,expires:ct})});return function(){ue.cancel(),J()}}Pe.prototype.parse=function(G,J,ue,be,ke){var it=this;this.status="parsing",this.data=G,this.collisionBoxArray=new y.CollisionBoxArray;var ct=new y.DictionaryCoder(Object.keys(G.layers).sort()),me=new y.FeatureIndex(this.tileID,this.promoteId);me.bucketLayerIDs=[];var Y,ye,tt,gt,le={},br={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ue},En=J.familiesBySource[this.source];for(var vn in En){var rr=G.layers[vn];if(rr){rr.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+vn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var nn=ct.encode(vn),Hr=[],Yr=0;Yr<rr.length;Yr++){var gi=rr.feature(Yr),Jr=me.getId(gi,vn);Hr.push({feature:gi,id:Jr,index:Yr,sourceLayerIndex:nn})}for(var xi=0,Gi=En[vn];xi<Gi.length;xi+=1){var _i=Gi[xi],Ci=_i[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(re(_i,this.zoom,ue),(le[Ci.id]=Ci.createBucket({index:me.bucketLayerIDs.length,layers:_i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nn,sourceID:this.source})).populate(Hr,br,this.tileID.canonical),me.bucketLayerIDs.push(_i.map(function(Mi){return Mi.id})))}}}var Ri=y.mapObject(br.glyphDependencies,function(Mi){return Object.keys(Mi).map(Number)});Object.keys(Ri).length?be.send("getGlyphs",{uid:this.uid,stacks:Ri},function(Mi,yi){Y||(Y=Mi,ye=yi,Sa.call(it))}):ye={};var go=Object.keys(br.iconDependencies);go.length?be.send("getImages",{icons:go,source:this.source,tileID:this.tileID,type:"icons"},function(Mi,yi){Y||(Y=Mi,tt=yi,Sa.call(it))}):tt={};var Ji=Object.keys(br.patternDependencies);function Sa(){if(Y)return ke(Y);if(ye&&tt&&gt){var Mi=new te(ye),yi=new y.ImageAtlas(tt,gt);for(var Ai in le){var Ca=le[Ai];Ca instanceof y.SymbolBucket?(re(Ca.layers,this.zoom,ue),y.performSymbolLayout(Ca,ye,Mi.positions,tt,yi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ca.hasPattern&&(Ca instanceof y.LineBucket||Ca instanceof y.FillBucket||Ca instanceof y.FillExtrusionBucket)&&(re(Ca.layers,this.zoom,ue),Ca.addFeatures(br,this.tileID.canonical,yi.patternPositions))}this.status="done",ke(null,{buckets:y.values(le).filter(function(Vs){return!Vs.isEmpty()}),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mi.image,imageAtlas:yi,glyphMap:this.returnDependencies?ye:null,iconMap:this.returnDependencies?tt:null,glyphPositions:this.returnDependencies?Mi.positions:null})}}Ji.length?be.send("getImages",{icons:Ji,source:this.source,tileID:this.tileID,type:"patterns"},function(Mi,yi){Y||(Y=Mi,gt=yi,Sa.call(it))}):gt={},Sa.call(this)};var Ke=function(G,J,ue,be){this.actor=G,this.layerIndex=J,this.availableImages=ue,this.loadVectorData=be||Ze,this.loading={},this.loaded={}};Ke.prototype.loadTile=function(G,J){var ue=this,be=G.uid;this.loading||(this.loading={});var ke=!!(G&&G.request&&G.request.collectResourceTiming)&&new y.RequestPerformance(G.request),it=this.loading[be]=new Pe(G);it.abort=this.loadVectorData(G,function(ct,me){if(delete ue.loading[be],ct||!me)return it.status="done",ue.loaded[be]=it,J(ct);var Y=me.rawData,ye={};me.expires&&(ye.expires=me.expires),me.cacheControl&&(ye.cacheControl=me.cacheControl);var tt={};if(ke){var gt=ke.finish();gt&&(tt.resourceTiming=JSON.parse(JSON.stringify(gt)))}it.vectorTile=me.vectorTile,it.parse(me.vectorTile,ue.layerIndex,ue.availableImages,ue.actor,function(le,br){if(le||!br)return J(le);J(null,y.extend({rawTileData:Y.slice(0)},br,ye,tt))}),ue.loaded=ue.loaded||{},ue.loaded[be]=it})},Ke.prototype.reloadTile=function(G,J){var ue=this,be=this.loaded,ke=G.uid,it=this;if(be&&be[ke]){var ct=be[ke];ct.showCollisionBoxes=G.showCollisionBoxes;var me=function(Y,ye){var tt=ct.reloadCallback;tt&&(delete ct.reloadCallback,ct.parse(ct.vectorTile,it.layerIndex,ue.availableImages,it.actor,tt)),J(Y,ye)};ct.status==="parsing"?ct.reloadCallback=me:ct.status==="done"&&(ct.vectorTile?ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor,me):me())}},Ke.prototype.abortTile=function(G,J){var ue=this.loading,be=G.uid;ue&&ue[be]&&ue[be].abort&&(ue[be].abort(),delete ue[be]),J()},Ke.prototype.removeTile=function(G,J){var ue=this.loaded,be=G.uid;ue&&ue[be]&&delete ue[be],J()};var nt=y.window.ImageBitmap,Tt=function(){this.loaded={}};function Ct(G,J){if(G.length!==0){Gt(G[0],J);for(var ue=1;ue<G.length;ue++)Gt(G[ue],!J)}}function Gt(G,J){for(var ue=0,be=0,ke=0,it=G.length,ct=it-1;ke<it;ct=ke++){var me=(G[ke][0]-G[ct][0])*(G[ct][1]+G[ke][1]),Y=ue+me;be+=Math.abs(ue)>=Math.abs(me)?ue-Y+me:me-Y+ue,ue=Y}ue+be>=0!=!!J&&G.reverse()}Tt.prototype.loadTile=function(G,J){var ue=G.uid,be=G.encoding,ke=G.rawImageData,it=nt&&ke instanceof nt?this.getImageData(ke):ke,ct=new y.DEMData(ue,it,be);this.loaded=this.loaded||{},this.loaded[ue]=ct,J(null,ct)},Tt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var J=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:J.width,height:J.height},J.data)},Tt.prototype.removeTile=function(G){var J=this.loaded,ue=G.uid;J&&J[ue]&&delete J[ue]};var Jt=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Zt=function(G){this._feature=G,this.extent=y.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],J=0,ue=this._feature.geometry;J<ue.length;J+=1){var be=ue[J];G.push([new y.Point$1(be[0],be[1])])}return G}for(var ke=[],it=0,ct=this._feature.geometry;it<ct.length;it+=1){for(var me=[],Y=0,ye=ct[it];Y<ye.length;Y+=1){var tt=ye[Y];me.push(new y.Point$1(tt[0],tt[1]))}ke.push(me)}return ke},Zt.prototype.toGeoJSON=function(G,J,ue){return Jt.call(this,G,J,ue)};var wt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=G.length,this._features=G};wt.prototype.feature=function(G){return new Zt(this._features[G])};var xt=y.vectorTile.VectorTileFeature,Lr=mr;function mr(G,J){this.options=J||{},this.features=G,this.length=G.length}function hr(G,J){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=J||4096}mr.prototype.feature=function(G){return new hr(this.features[G],this.options.extent)},hr.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var J=0;J<G.length;J++){for(var ue=G[J],be=[],ke=0;ke<ue.length;ke++)be.push(new y.Point$1(ue[ke][0],ue[ke][1]));this.geometry.push(be)}return this.geometry},hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,J=1/0,ue=-1/0,be=1/0,ke=-1/0,it=0;it<G.length;it++)for(var ct=G[it],me=0;me<ct.length;me++){var Y=ct[me];J=Math.min(J,Y.x),ue=Math.max(ue,Y.x),be=Math.min(be,Y.y),ke=Math.max(ke,Y.y)}return[J,be,ue,ke]},hr.prototype.toGeoJSON=xt.prototype.toGeoJSON;var Et=Ut,lt=Lr;function Ut(G){var J=new y.pbf;return function(ue,be){for(var ke in ue.layers)be.writeMessage(3,vt,ue.layers[ke])}(G,J),J.finish()}function vt(G,J){var ue;J.writeVarintField(15,G.version||1),J.writeStringField(1,G.name||""),J.writeVarintField(5,G.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<G.length;ue++)be.feature=G.feature(ue),J.writeMessage(2,er,be);var ke=be.keys;for(ue=0;ue<ke.length;ue++)J.writeStringField(3,ke[ue]);var it=be.values;for(ue=0;ue<it.length;ue++)J.writeMessage(4,Me,it[ue])}function er(G,J){var ue=G.feature;ue.id!==void 0&&J.writeVarintField(1,ue.id),J.writeMessage(2,xr,G),J.writeVarintField(3,ue.type),J.writeMessage(4,F,ue)}function xr(G,J){var ue=G.feature,be=G.keys,ke=G.values,it=G.keycache,ct=G.valuecache;for(var me in ue.properties){var Y=it[me];Y===void 0&&(be.push(me),it[me]=Y=be.length-1),J.writeVarint(Y);var ye=ue.properties[me],tt=typeof ye;tt!=="string"&&tt!=="boolean"&&tt!=="number"&&(ye=JSON.stringify(ye));var gt=tt+":"+ye,le=ct[gt];le===void 0&&(ke.push(ye),ct[gt]=le=ke.length-1),J.writeVarint(le)}}function q(G,J){return(J<<3)+(7&G)}function De(G){return G<<1^G>>31}function F(G,J){for(var ue=G.loadGeometry(),be=G.type,ke=0,it=0,ct=ue.length,me=0;me<ct;me++){var Y=ue[me],ye=1;be===1&&(ye=Y.length),J.writeVarint(q(1,ye));for(var tt=be===3?Y.length-1:Y.length,gt=0;gt<tt;gt++){gt===1&&be!==1&&J.writeVarint(q(2,tt-1));var le=Y[gt].x-ke,br=Y[gt].y-it;J.writeVarint(De(le)),J.writeVarint(De(br)),ke+=le,it+=br}be===3&&J.writeVarint(q(7,1))}}function Me(G,J){var ue=typeof G;ue==="string"?J.writeStringField(1,G):ue==="boolean"?J.writeBooleanField(7,G):ue==="number"&&(G%1!=0?J.writeDoubleField(3,G):G<0?J.writeSVarintField(6,G):J.writeVarintField(5,G))}function Te(G,J,ue,be){ht(G,ue,be),ht(J,2*ue,2*be),ht(J,2*ue+1,2*be+1)}function ht(G,J,ue){var be=G[J];G[J]=G[ue],G[ue]=be}function bt(G,J,ue,be){var ke=G-ue,it=J-be;return ke*ke+it*it}Et.fromVectorTileJs=Ut,Et.fromGeojsonVt=function(G,J){J=J||{};var ue={};for(var be in G)ue[be]=new Lr(G[be].features,J),ue[be].name=be,ue[be].version=J.version,ue[be].extent=J.extent;return Ut({layers:ue})},Et.GeoJSONWrapper=lt;var St=function(G){return G[0]},qt=function(G){return G[1]},or=function(G,J,ue,be,ke){J===void 0&&(J=St),ue===void 0&&(ue=qt),be===void 0&&(be=64),ke===void 0&&(ke=Float64Array),this.nodeSize=be,this.points=G;for(var it=G.length<65536?Uint16Array:Uint32Array,ct=this.ids=new it(G.length),me=this.coords=new ke(2*G.length),Y=0;Y<G.length;Y++)ct[Y]=Y,me[2*Y]=J(G[Y]),me[2*Y+1]=ue(G[Y]);(function ye(tt,gt,le,br,En,vn){if(!(En-br<=le)){var rr=br+En>>1;(function nn(Hr,Yr,gi,Jr,xi,Gi){for(;xi>Jr;){if(xi-Jr>600){var _i=xi-Jr+1,Ci=gi-Jr+1,Ri=Math.log(_i),go=.5*Math.exp(2*Ri/3),Ji=.5*Math.sqrt(Ri*go*(_i-go)/_i)*(Ci-_i/2<0?-1:1);nn(Hr,Yr,gi,Math.max(Jr,Math.floor(gi-Ci*go/_i+Ji)),Math.min(xi,Math.floor(gi+(_i-Ci)*go/_i+Ji)),Gi)}var Sa=Yr[2*gi+Gi],Mi=Jr,yi=xi;for(Te(Hr,Yr,Jr,gi),Yr[2*xi+Gi]>Sa&&Te(Hr,Yr,Jr,xi);Mi<yi;){for(Te(Hr,Yr,Mi,yi),Mi++,yi--;Yr[2*Mi+Gi]<Sa;)Mi++;for(;Yr[2*yi+Gi]>Sa;)yi--}Yr[2*Jr+Gi]===Sa?Te(Hr,Yr,Jr,yi):Te(Hr,Yr,++yi,xi),yi<=gi&&(Jr=yi+1),gi<=yi&&(xi=yi-1)}})(tt,gt,rr,br,En,vn%2),ye(tt,gt,le,br,rr-1,vn+1),ye(tt,gt,le,rr+1,En,vn+1)}})(ct,me,be,0,ct.length-1,0)};or.prototype.range=function(G,J,ue,be){return function(ke,it,ct,me,Y,ye,tt){for(var gt,le,br=[0,ke.length-1,0],En=[];br.length;){var vn=br.pop(),rr=br.pop(),nn=br.pop();if(rr-nn<=tt)for(var Hr=nn;Hr<=rr;Hr++)le=it[2*Hr+1],(gt=it[2*Hr])>=ct&&gt<=Y&&le>=me&&le<=ye&&En.push(ke[Hr]);else{var Yr=Math.floor((nn+rr)/2);le=it[2*Yr+1],(gt=it[2*Yr])>=ct&&gt<=Y&&le>=me&&le<=ye&&En.push(ke[Yr]);var gi=(vn+1)%2;(vn===0?ct<=gt:me<=le)&&(br.push(nn),br.push(Yr-1),br.push(gi)),(vn===0?Y>=gt:ye>=le)&&(br.push(Yr+1),br.push(rr),br.push(gi))}}return En}(this.ids,this.coords,G,J,ue,be,this.nodeSize)},or.prototype.within=function(G,J,ue){return function(be,ke,it,ct,me,Y){for(var ye=[0,be.length-1,0],tt=[],gt=me*me;ye.length;){var le=ye.pop(),br=ye.pop(),En=ye.pop();if(br-En<=Y)for(var vn=En;vn<=br;vn++)bt(ke[2*vn],ke[2*vn+1],it,ct)<=gt&&tt.push(be[vn]);else{var rr=Math.floor((En+br)/2),nn=ke[2*rr],Hr=ke[2*rr+1];bt(nn,Hr,it,ct)<=gt&&tt.push(be[rr]);var Yr=(le+1)%2;(le===0?it-me<=nn:ct-me<=Hr)&&(ye.push(En),ye.push(rr-1),ye.push(Yr)),(le===0?it+me>=nn:ct+me>=Hr)&&(ye.push(rr+1),ye.push(br),ye.push(Yr))}}return tt}(this.ids,this.coords,G,J,ue,this.nodeSize)};var rn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Or=function(G){this.options=Fi(Object.create(rn),G),this.trees=new Array(this.options.maxZoom+1)};function Kn(G,J,ue,be,ke){return{x:G,y:J,zoom:1/0,id:ue,parentId:-1,numPoints:be,properties:ke}}function on(G,J){var ue=G.geometry.coordinates,be=ue[1];return{x:ei(ue[0]),y:xn(be),zoom:1/0,index:J,parentId:-1}}function Pn(G){return{type:"Feature",id:G.id,properties:mi(G),geometry:{type:"Point",coordinates:[(be=G.x,360*(be-.5)),(J=G.y,ue=(180-360*J)*Math.PI/180,360*Math.atan(Math.exp(ue))/Math.PI-90)]}};var J,ue,be}function mi(G){var J=G.numPoints,ue=J>=1e4?Math.round(J/1e3)+"k":J>=1e3?Math.round(J/100)/10+"k":J;return Fi(Fi({},G.properties),{cluster:!0,cluster_id:G.id,point_count:J,point_count_abbreviated:ue})}function ei(G){return G/360+.5}function xn(G){var J=Math.sin(G*Math.PI/180),ue=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ue<0?0:ue>1?1:ue}function Fi(G,J){for(var ue in J)G[ue]=J[ue];return G}function zi(G){return G.x}function Li(G){return G.y}function Qn(G,J,ue,be,ke,it){var ct=ke-ue,me=it-be;if(ct!==0||me!==0){var Y=((G-ue)*ct+(J-be)*me)/(ct*ct+me*me);Y>1?(ue=ke,be=it):Y>0&&(ue+=ct*Y,be+=me*Y)}return(ct=G-ue)*ct+(me=J-be)*me}function Ln(G,J,ue,be){var ke={id:G===void 0?null:G,type:J,geometry:ue,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var ct=it.geometry,me=it.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")Fo(it,ct);else if(me==="Polygon"||me==="MultiLineString")for(var Y=0;Y<ct.length;Y++)Fo(it,ct[Y]);else if(me==="MultiPolygon")for(Y=0;Y<ct.length;Y++)for(var ye=0;ye<ct[Y].length;ye++)Fo(it,ct[Y][ye])}(ke),ke}function Fo(G,J){for(var ue=0;ue<J.length;ue+=3)G.minX=Math.min(G.minX,J[ue]),G.minY=Math.min(G.minY,J[ue+1]),G.maxX=Math.max(G.maxX,J[ue]),G.maxY=Math.max(G.maxY,J[ue+1])}function sa(G,J,ue,be){if(J.geometry){var ke=J.geometry.coordinates,it=J.geometry.type,ct=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),me=[],Y=J.id;if(ue.promoteId?Y=J.properties[ue.promoteId]:ue.generateId&&(Y=be||0),it==="Point")ao(ke,me);else if(it==="MultiPoint")for(var ye=0;ye<ke.length;ye++)ao(ke[ye],me);else if(it==="LineString")Pt(ke,me,ct,!1);else if(it==="MultiLineString"){if(ue.lineMetrics){for(ye=0;ye<ke.length;ye++)Pt(ke[ye],me=[],ct,!1),G.push(Ln(Y,"LineString",me,J.properties));return}k(ke,me,ct,!1)}else if(it==="Polygon")k(ke,me,ct,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(ye=0;ye<J.geometry.geometries.length;ye++)sa(G,{id:Y,geometry:J.geometry.geometries[ye],properties:J.properties},ue,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<ke.length;ye++){var tt=[];k(ke[ye],tt,ct,!0),me.push(tt)}}G.push(Ln(Y,it,me,J.properties))}}function ao(G,J){J.push(se(G[0])),J.push(de(G[1])),J.push(0)}function Pt(G,J,ue,be){for(var ke,it,ct=0,me=0;me<G.length;me++){var Y=se(G[me][0]),ye=de(G[me][1]);J.push(Y),J.push(ye),J.push(0),me>0&&(ct+=be?(ke*ye-Y*it)/2:Math.sqrt(Math.pow(Y-ke,2)+Math.pow(ye-it,2))),ke=Y,it=ye}var tt=J.length-3;J[2]=1,function gt(le,br,En,vn){for(var rr,nn=vn,Hr=En-br>>1,Yr=En-br,gi=le[br],Jr=le[br+1],xi=le[En],Gi=le[En+1],_i=br+3;_i<En;_i+=3){var Ci=Qn(le[_i],le[_i+1],gi,Jr,xi,Gi);if(Ci>nn)rr=_i,nn=Ci;else if(Ci===nn){var Ri=Math.abs(_i-Hr);Ri<Yr&&(rr=_i,Yr=Ri)}}nn>vn&&(rr-br>3&&gt(le,br,rr,vn),le[rr+2]=nn,En-rr>3&&gt(le,rr,En,vn))}(J,0,tt,ue),J[tt+2]=1,J.size=Math.abs(ct),J.start=0,J.end=J.size}function k(G,J,ue,be){for(var ke=0;ke<G.length;ke++){var it=[];Pt(G[ke],it,ue,be),J.push(it)}}function se(G){return G/360+.5}function de(G){var J=Math.sin(G*Math.PI/180),ue=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ue<0?0:ue>1?1:ue}function je(G,J,ue,be,ke,it,ct,me){if(be/=J,it>=(ue/=J)&&ct<be)return G;if(ct<ue||it>=be)return null;for(var Y=[],ye=0;ye<G.length;ye++){var tt=G[ye],gt=tt.geometry,le=tt.type,br=ke===0?tt.minX:tt.minY,En=ke===0?tt.maxX:tt.maxY;if(br>=ue&&En<be)Y.push(tt);else if(!(En<ue||br>=be)){var vn=[];if(le==="Point"||le==="MultiPoint")mt(gt,vn,ue,be,ke);else if(le==="LineString")Kt(gt,vn,ue,be,ke,!1,me.lineMetrics);else if(le==="MultiLineString")Xe(gt,vn,ue,be,ke,!1);else if(le==="Polygon")Xe(gt,vn,ue,be,ke,!0);else if(le==="MultiPolygon")for(var rr=0;rr<gt.length;rr++){var nn=[];Xe(gt[rr],nn,ue,be,ke,!0),nn.length&&vn.push(nn)}if(vn.length){if(me.lineMetrics&&le==="LineString"){for(rr=0;rr<vn.length;rr++)Y.push(Ln(tt.id,le,vn[rr],tt.tags));continue}le!=="LineString"&&le!=="MultiLineString"||(vn.length===1?(le="LineString",vn=vn[0]):le="MultiLineString"),le!=="Point"&&le!=="MultiPoint"||(le=vn.length===3?"Point":"MultiPoint"),Y.push(Ln(tt.id,le,vn,tt.tags))}}}return Y.length?Y:null}function mt(G,J,ue,be,ke){for(var it=0;it<G.length;it+=3){var ct=G[it+ke];ct>=ue&&ct<=be&&(J.push(G[it]),J.push(G[it+1]),J.push(G[it+2]))}}function Kt(G,J,ue,be,ke,it,ct){for(var me,Y,ye=Ar(G),tt=ke===0?sr:dr,gt=G.start,le=0;le<G.length-3;le+=3){var br=G[le],En=G[le+1],vn=G[le+2],rr=G[le+3],nn=G[le+4],Hr=ke===0?br:En,Yr=ke===0?rr:nn,gi=!1;ct&&(me=Math.sqrt(Math.pow(br-rr,2)+Math.pow(En-nn,2))),Hr<ue?Yr>ue&&(Y=tt(ye,br,En,rr,nn,ue),ct&&(ye.start=gt+me*Y)):Hr>be?Yr<be&&(Y=tt(ye,br,En,rr,nn,be),ct&&(ye.start=gt+me*Y)):Mt(ye,br,En,vn),Yr<ue&&Hr>=ue&&(Y=tt(ye,br,En,rr,nn,ue),gi=!0),Yr>be&&Hr<=be&&(Y=tt(ye,br,En,rr,nn,be),gi=!0),!it&&gi&&(ct&&(ye.end=gt+me*Y),J.push(ye),ye=Ar(G)),ct&&(gt+=me)}var Jr=G.length-3;br=G[Jr],En=G[Jr+1],vn=G[Jr+2],(Hr=ke===0?br:En)>=ue&&Hr<=be&&Mt(ye,br,En,vn),Jr=ye.length-3,it&&Jr>=3&&(ye[Jr]!==ye[0]||ye[Jr+1]!==ye[1])&&Mt(ye,ye[0],ye[1],ye[2]),ye.length&&J.push(ye)}function Ar(G){var J=[];return J.size=G.size,J.start=G.start,J.end=G.end,J}function Xe(G,J,ue,be,ke,it){for(var ct=0;ct<G.length;ct++)Kt(G[ct],J,ue,be,ke,it,!1)}function Mt(G,J,ue,be){G.push(J),G.push(ue),G.push(be)}function sr(G,J,ue,be,ke,it){var ct=(it-J)/(be-J);return G.push(it),G.push(ue+(ke-ue)*ct),G.push(1),ct}function dr(G,J,ue,be,ke,it){var ct=(it-ue)/(ke-ue);return G.push(J+(be-J)*ct),G.push(it),G.push(1),ct}function Gr(G,J){for(var ue=[],be=0;be<G.length;be++){var ke,it=G[be],ct=it.type;if(ct==="Point"||ct==="MultiPoint"||ct==="LineString")ke=Nn(it.geometry,J);else if(ct==="MultiLineString"||ct==="Polygon"){ke=[];for(var me=0;me<it.geometry.length;me++)ke.push(Nn(it.geometry[me],J))}else if(ct==="MultiPolygon")for(ke=[],me=0;me<it.geometry.length;me++){for(var Y=[],ye=0;ye<it.geometry[me].length;ye++)Y.push(Nn(it.geometry[me][ye],J));ke.push(Y)}ue.push(Ln(it.id,ct,ke,it.tags))}return ue}function Nn(G,J){var ue=[];ue.size=G.size,G.start!==void 0&&(ue.start=G.start,ue.end=G.end);for(var be=0;be<G.length;be+=3)ue.push(G[be]+J,G[be+1],G[be+2]);return ue}function On(G,J){if(G.transformed)return G;var ue,be,ke,it=1<<G.z,ct=G.x,me=G.y;for(ue=0;ue<G.features.length;ue++){var Y=G.features[ue],ye=Y.geometry,tt=Y.type;if(Y.geometry=[],tt===1)for(be=0;be<ye.length;be+=2)Y.geometry.push(An(ye[be],ye[be+1],J,it,ct,me));else for(be=0;be<ye.length;be++){var gt=[];for(ke=0;ke<ye[be].length;ke+=2)gt.push(An(ye[be][ke],ye[be][ke+1],J,it,ct,me));Y.geometry.push(gt)}}return G.transformed=!0,G}function An(G,J,ue,be,ke,it){return[Math.round(ue*(G*be-ke)),Math.round(ue*(J*be-it))]}function Tn(G,J,ue,be,ke){for(var it=J===ke.maxZoom?0:ke.tolerance/((1<<J)*ke.extent),ct={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:be,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},me=0;me<G.length;me++){ct.numFeatures++,fi(ct,G[me],it,ke);var Y=G[me].minX,ye=G[me].minY,tt=G[me].maxX,gt=G[me].maxY;Y<ct.minX&&(ct.minX=Y),ye<ct.minY&&(ct.minY=ye),tt>ct.maxX&&(ct.maxX=tt),gt>ct.maxY&&(ct.maxY=gt)}return ct}function fi(G,J,ue,be){var ke=J.geometry,it=J.type,ct=[];if(it==="Point"||it==="MultiPoint")for(var me=0;me<ke.length;me+=3)ct.push(ke[me]),ct.push(ke[me+1]),G.numPoints++,G.numSimplified++;else if(it==="LineString")ni(ct,ke,G,ue,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(me=0;me<ke.length;me++)ni(ct,ke[me],G,ue,it==="Polygon",me===0);else if(it==="MultiPolygon")for(var Y=0;Y<ke.length;Y++){var ye=ke[Y];for(me=0;me<ye.length;me++)ni(ct,ye[me],G,ue,!0,me===0)}if(ct.length){var tt=J.tags||null;if(it==="LineString"&&be.lineMetrics){for(var gt in tt={},J.tags)tt[gt]=J.tags[gt];tt.mapbox_clip_start=ke.start/ke.size,tt.mapbox_clip_end=ke.end/ke.size}var le={geometry:ct,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:tt};J.id!==null&&(le.id=J.id),G.features.push(le)}}function ni(G,J,ue,be,ke,it){var ct=be*be;if(be>0&&J.size<(ke?ct:be))ue.numPoints+=J.length/3;else{for(var me=[],Y=0;Y<J.length;Y+=3)(be===0||J[Y+2]>ct)&&(ue.numSimplified++,me.push(J[Y]),me.push(J[Y+1])),ue.numPoints++;ke&&function(ye,tt){for(var gt=0,le=0,br=ye.length,En=br-2;le<br;En=le,le+=2)gt+=(ye[le]-ye[En])*(ye[le+1]+ye[En+1]);if(gt>0===tt)for(le=0,br=ye.length;le<br/2;le+=2){var vn=ye[le],rr=ye[le+1];ye[le]=ye[br-2-le],ye[le+1]=ye[br-1-le],ye[br-2-le]=vn,ye[br-1-le]=rr}}(me,it),G.push(me)}}function ta(G,J){var ue=(J=this.options=function(ke,it){for(var ct in it)ke[ct]=it[ct];return ke}(Object.create(this.options),J)).debug;if(ue&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");var be=function(ke,it){var ct=[];if(ke.type==="FeatureCollection")for(var me=0;me<ke.features.length;me++)sa(ct,ke.features[me],it,me);else sa(ct,ke.type==="Feature"?ke:{geometry:ke},it);return ct}(G,J);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(be=function(ke,it){var ct=it.buffer/it.extent,me=ke,Y=je(ke,1,-1-ct,ct,0,-1,2,it),ye=je(ke,1,1-ct,2+ct,0,-1,2,it);return(Y||ye)&&(me=je(ke,1,-ct,1+ct,0,-1,2,it)||[],Y&&(me=Gr(Y,1).concat(me)),ye&&(me=me.concat(Gr(ye,-1)))),me}(be,J)).length&&this.splitTile(be,0,0,0),ue&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ra(G,J,ue){return 32*((1<<G)*ue+J)+G}function Zo(G,J){var ue=G.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);var be=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!be)return J(null,null);var ke=new wt(be.features),it=Et(ke);it.byteOffset===0&&it.byteLength===it.buffer.byteLength||(it=new Uint8Array(it)),J(null,{vectorTile:ke,rawData:it.buffer})}Or.prototype.load=function(G){var J=this.options,ue=J.log,be=J.minZoom,ke=J.maxZoom,it=J.nodeSize;ue&&console.time("total time");var ct="prepare "+G.length+" points";ue&&console.time(ct),this.points=G;for(var me=[],Y=0;Y<G.length;Y++)G[Y].geometry&&me.push(on(G[Y],Y));this.trees[ke+1]=new or(me,zi,Li,it,Float32Array),ue&&console.timeEnd(ct);for(var ye=ke;ye>=be;ye--){var tt=+Date.now();me=this._cluster(me,ye),this.trees[ye]=new or(me,zi,Li,it,Float32Array),ue&&console.log("z%d: %d clusters in %dms",ye,me.length,+Date.now()-tt)}return ue&&console.timeEnd("total time"),this},Or.prototype.getClusters=function(G,J){var ue=((G[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,G[1])),ke=G[2]===180?180:((G[2]+180)%360+360)%360-180,it=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ue=-180,ke=180;else if(ue>ke){var ct=this.getClusters([ue,be,180,it],J),me=this.getClusters([-180,be,ke,it],J);return ct.concat(me)}for(var Y=this.trees[this._limitZoom(J)],ye=[],tt=0,gt=Y.range(ei(ue),xn(it),ei(ke),xn(be));tt<gt.length;tt+=1){var le=Y.points[gt[tt]];ye.push(le.numPoints?Pn(le):this.points[le.index])}return ye},Or.prototype.getChildren=function(G){var J=this._getOriginId(G),ue=this._getOriginZoom(G),be="No cluster with the specified id.",ke=this.trees[ue];if(!ke)throw new Error(be);var it=ke.points[J];if(!it)throw new Error(be);for(var ct=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),me=[],Y=0,ye=ke.within(it.x,it.y,ct);Y<ye.length;Y+=1){var tt=ke.points[ye[Y]];tt.parentId===G&&me.push(tt.numPoints?Pn(tt):this.points[tt.index])}if(me.length===0)throw new Error(be);return me},Or.prototype.getLeaves=function(G,J,ue){var be=[];return this._appendLeaves(be,G,J=J||10,ue=ue||0,0),be},Or.prototype.getTile=function(G,J,ue){var be=this.trees[this._limitZoom(G)],ke=Math.pow(2,G),it=this.options,ct=it.radius/it.extent,me=(ue-ct)/ke,Y=(ue+1+ct)/ke,ye={features:[]};return this._addTileFeatures(be.range((J-ct)/ke,me,(J+1+ct)/ke,Y),be.points,J,ue,ke,ye),J===0&&this._addTileFeatures(be.range(1-ct/ke,me,1,Y),be.points,ke,ue,ke,ye),J===ke-1&&this._addTileFeatures(be.range(0,me,ct/ke,Y),be.points,-1,ue,ke,ye),ye.features.length?ye:null},Or.prototype.getClusterExpansionZoom=function(G){for(var J=this._getOriginZoom(G)-1;J<=this.options.maxZoom;){var ue=this.getChildren(G);if(J++,ue.length!==1)break;G=ue[0].properties.cluster_id}return J},Or.prototype._appendLeaves=function(G,J,ue,be,ke){for(var it=0,ct=this.getChildren(J);it<ct.length;it+=1){var me=ct[it],Y=me.properties;if(Y&&Y.cluster?ke+Y.point_count<=be?ke+=Y.point_count:ke=this._appendLeaves(G,Y.cluster_id,ue,be,ke):ke<be?ke++:G.push(me),G.length===ue)break}return ke},Or.prototype._addTileFeatures=function(G,J,ue,be,ke,it){for(var ct=0,me=G;ct<me.length;ct+=1){var Y=J[me[ct]],ye=Y.numPoints,tt={type:1,geometry:[[Math.round(this.options.extent*(Y.x*ke-ue)),Math.round(this.options.extent*(Y.y*ke-be))]],tags:ye?mi(Y):this.points[Y.index].properties},gt=void 0;ye?gt=Y.id:this.options.generateId?gt=Y.index:this.points[Y.index].id&&(gt=this.points[Y.index].id),gt!==void 0&&(tt.id=gt),it.features.push(tt)}},Or.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Or.prototype._cluster=function(G,J){for(var ue=[],be=this.options,ke=be.reduce,it=be.minPoints,ct=be.radius/(be.extent*Math.pow(2,J)),me=0;me<G.length;me++){var Y=G[me];if(!(Y.zoom<=J)){Y.zoom=J;for(var ye=this.trees[J+1],tt=ye.within(Y.x,Y.y,ct),gt=Y.numPoints||1,le=gt,br=0,En=tt;br<En.length;br+=1){var vn=ye.points[En[br]];vn.zoom>J&&(le+=vn.numPoints||1)}if(le>=it){for(var rr=Y.x*gt,nn=Y.y*gt,Hr=ke&&gt>1?this._map(Y,!0):null,Yr=(me<<5)+(J+1)+this.points.length,gi=0,Jr=tt;gi<Jr.length;gi+=1){var xi=ye.points[Jr[gi]];if(!(xi.zoom<=J)){xi.zoom=J;var Gi=xi.numPoints||1;rr+=xi.x*Gi,nn+=xi.y*Gi,xi.parentId=Yr,ke&&(Hr||(Hr=this._map(Y,!0)),ke(Hr,this._map(xi)))}}Y.parentId=Yr,ue.push(Kn(rr/le,nn/le,Yr,le,Hr))}else if(ue.push(Y),le>1)for(var _i=0,Ci=tt;_i<Ci.length;_i+=1){var Ri=ye.points[Ci[_i]];Ri.zoom<=J||(Ri.zoom=J,ue.push(Ri))}}}return ue},Or.prototype._getOriginId=function(G){return G-this.points.length>>5},Or.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Or.prototype._map=function(G,J){if(G.numPoints)return J?Fi({},G.properties):G.properties;var ue=this.points[G.index].properties,be=this.options.map(ue);return J&&be===ue?Fi({},be):be},ta.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ta.prototype.splitTile=function(G,J,ue,be,ke,it,ct){for(var me=[G,J,ue,be],Y=this.options,ye=Y.debug;me.length;){be=me.pop(),ue=me.pop(),J=me.pop(),G=me.pop();var tt=1<<J,gt=ra(J,ue,be),le=this.tiles[gt];if(!le&&(ye>1&&console.time("creation"),le=this.tiles[gt]=Tn(G,J,ue,be,Y),this.tileCoords.push({z:J,x:ue,y:be}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ue,be,le.numFeatures,le.numPoints,le.numSimplified),console.timeEnd("creation"));var br="z"+J;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(le.source=G,ke){if(J===Y.maxZoom||J===ke)continue;var En=1<<ke-J;if(ue!==Math.floor(it/En)||be!==Math.floor(ct/En))continue}else if(J===Y.indexMaxZoom||le.numPoints<=Y.indexMaxPoints)continue;if(le.source=null,G.length!==0){ye>1&&console.time("clipping");var vn,rr,nn,Hr,Yr,gi,Jr=.5*Y.buffer/Y.extent,xi=.5-Jr,Gi=.5+Jr,_i=1+Jr;vn=rr=nn=Hr=null,Yr=je(G,tt,ue-Jr,ue+Gi,0,le.minX,le.maxX,Y),gi=je(G,tt,ue+xi,ue+_i,0,le.minX,le.maxX,Y),G=null,Yr&&(vn=je(Yr,tt,be-Jr,be+Gi,1,le.minY,le.maxY,Y),rr=je(Yr,tt,be+xi,be+_i,1,le.minY,le.maxY,Y),Yr=null),gi&&(nn=je(gi,tt,be-Jr,be+Gi,1,le.minY,le.maxY,Y),Hr=je(gi,tt,be+xi,be+_i,1,le.minY,le.maxY,Y),gi=null),ye>1&&console.timeEnd("clipping"),me.push(vn||[],J+1,2*ue,2*be),me.push(rr||[],J+1,2*ue,2*be+1),me.push(nn||[],J+1,2*ue+1,2*be),me.push(Hr||[],J+1,2*ue+1,2*be+1)}}},ta.prototype.getTile=function(G,J,ue){var be=this.options,ke=be.extent,it=be.debug;if(G<0||G>24)return null;var ct=1<<G,me=ra(G,J=(J%ct+ct)%ct,ue);if(this.tiles[me])return On(this.tiles[me],ke);it>1&&console.log("drilling down to z%d-%d-%d",G,J,ue);for(var Y,ye=G,tt=J,gt=ue;!Y&&ye>0;)ye--,tt=Math.floor(tt/2),gt=Math.floor(gt/2),Y=this.tiles[ra(ye,tt,gt)];return Y&&Y.source?(it>1&&console.log("found parent tile z%d-%d-%d",ye,tt,gt),it>1&&console.time("drilling down"),this.splitTile(Y.source,ye,tt,gt,G,J,ue),it>1&&console.timeEnd("drilling down"),this.tiles[me]?On(this.tiles[me],ke):null):null};var Ts=function(G){function J(ue,be,ke,it){G.call(this,ue,be,ke,Zo),it&&(this.loadGeoJSON=it)}return G&&(J.__proto__=G),(J.prototype=Object.create(G&&G.prototype)).constructor=J,J.prototype.loadData=function(ue,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=be,this._pendingLoadDataParams=ue,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},J.prototype._loadData=function(){var ue=this;if(this._pendingCallback&&this._pendingLoadDataParams){var be=this._pendingCallback,ke=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var it=!!(ke&&ke.request&&ke.request.collectResourceTiming)&&new y.RequestPerformance(ke.request);this.loadGeoJSON(ke,function(ct,me){if(ct||!me)return be(ct);if(typeof me!="object")return be(new Error("Input data given to '"+ke.source+"' is not a valid GeoJSON object."));(function le(br,En){var vn,rr=br&&br.type;if(rr==="FeatureCollection")for(vn=0;vn<br.features.length;vn++)le(br.features[vn],En);else if(rr==="GeometryCollection")for(vn=0;vn<br.geometries.length;vn++)le(br.geometries[vn],En);else if(rr==="Feature")le(br.geometry,En);else if(rr==="Polygon")Ct(br.coordinates,En);else if(rr==="MultiPolygon")for(vn=0;vn<br.coordinates.length;vn++)Ct(br.coordinates[vn],En);return br})(me,!0);try{if(ke.filter){var Y=y.createExpression(ke.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(function(le){return le.key+": "+le.message}).join(", "));var ye=me.features.filter(function(le){return Y.value.evaluate({zoom:0},le)});me={type:"FeatureCollection",features:ye}}ue._geoJSONIndex=ke.cluster?new Or(function(le){var br=le.superclusterOptions,En=le.clusterProperties;if(!En||!br)return br;for(var vn={},rr={},nn={accumulated:null,zoom:0},Hr={properties:null},Yr=Object.keys(En),gi=0,Jr=Yr;gi<Jr.length;gi+=1){var xi=Jr[gi],Gi=En[xi],_i=Gi[0],Ci=y.createExpression(Gi[1]),Ri=y.createExpression(typeof _i=="string"?[_i,["accumulated"],["get",xi]]:_i);vn[xi]=Ci.value,rr[xi]=Ri.value}return br.map=function(go){Hr.properties=go;for(var Ji={},Sa=0,Mi=Yr;Sa<Mi.length;Sa+=1){var yi=Mi[Sa];Ji[yi]=vn[yi].evaluate(nn,Hr)}return Ji},br.reduce=function(go,Ji){Hr.properties=Ji;for(var Sa=0,Mi=Yr;Sa<Mi.length;Sa+=1){var yi=Mi[Sa];nn.accumulated=go[yi],go[yi]=rr[yi].evaluate(nn,Hr)}},br}(ke)).load(me.features):function(le,br){return new ta(le,br)}(me,ke.geojsonVtOptions)}catch(le){return be(le)}ue.loaded={};var tt={};if(it){var gt=it.finish();gt&&(tt.resourceTiming={},tt.resourceTiming[ke.source]=JSON.parse(JSON.stringify(gt)))}be(null,tt)})}},J.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},J.prototype.reloadTile=function(ue,be){var ke=this.loaded;return ke&&ke[ue.uid]?G.prototype.reloadTile.call(this,ue,be):this.loadTile(ue,be)},J.prototype.loadGeoJSON=function(ue,be){if(ue.request)y.getJSON(ue.request,be);else{if(typeof ue.data!="string")return be(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."));try{return be(null,JSON.parse(ue.data))}catch(ke){return be(new Error("Input data given to '"+ue.source+"' is not a valid GeoJSON object."))}}},J.prototype.removeSource=function(ue,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),be()},J.prototype.getClusterExpansionZoom=function(ue,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ue.clusterId))}catch(ke){be(ke)}},J.prototype.getClusterChildren=function(ue,be){try{be(null,this._geoJSONIndex.getChildren(ue.clusterId))}catch(ke){be(ke)}},J.prototype.getClusterLeaves=function(ue,be){try{be(null,this._geoJSONIndex.getLeaves(ue.clusterId,ue.limit,ue.offset))}catch(ke){be(ke)}},J}(Ke),wi=function(G){var J=this;this.self=G,this.actor=new y.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ke,geojson:Ts},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ue,be){if(J.workerSourceTypes[ue])throw new Error('Worker source with name "'+ue+'" already registered.');J.workerSourceTypes[ue]=be},this.self.registerRTLTextPlugin=function(ue){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=ue.applyArabicShaping,y.plugin.processBidirectionalText=ue.processBidirectionalText,y.plugin.processStyledBidirectionalText=ue.processStyledBidirectionalText}};return wi.prototype.setReferrer=function(G,J){this.referrer=J},wi.prototype.setImages=function(G,J,ue){for(var be in this.availableImages[G]=J,this.workerSources[G]){var ke=this.workerSources[G][be];for(var it in ke)ke[it].availableImages=J}ue()},wi.prototype.setLayers=function(G,J,ue){this.getLayerIndex(G).replace(J),ue()},wi.prototype.updateLayers=function(G,J,ue){this.getLayerIndex(G).update(J.layers,J.removedIds),ue()},wi.prototype.loadTile=function(G,J,ue){this.getWorkerSource(G,J.type,J.source).loadTile(J,ue)},wi.prototype.loadDEMTile=function(G,J,ue){this.getDEMWorkerSource(G,J.source).loadTile(J,ue)},wi.prototype.reloadTile=function(G,J,ue){this.getWorkerSource(G,J.type,J.source).reloadTile(J,ue)},wi.prototype.abortTile=function(G,J,ue){this.getWorkerSource(G,J.type,J.source).abortTile(J,ue)},wi.prototype.removeTile=function(G,J,ue){this.getWorkerSource(G,J.type,J.source).removeTile(J,ue)},wi.prototype.removeDEMTile=function(G,J){this.getDEMWorkerSource(G,J.source).removeTile(J)},wi.prototype.removeSource=function(G,J,ue){if(this.workerSources[G]&&this.workerSources[G][J.type]&&this.workerSources[G][J.type][J.source]){var be=this.workerSources[G][J.type][J.source];delete this.workerSources[G][J.type][J.source],be.removeSource!==void 0?be.removeSource(J,ue):ue()}},wi.prototype.loadWorkerSource=function(G,J,ue){try{this.self.importScripts(J.url),ue()}catch(be){ue(be.toString())}},wi.prototype.syncRTLPluginState=function(G,J,ue){try{y.plugin.setState(J);var be=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&be!=null){this.self.importScripts(be);var ke=y.plugin.isParsed();ue(ke?void 0:new Error("RTL Text Plugin failed to import scripts from "+be),ke)}}catch(it){ue(it.toString())}},wi.prototype.getAvailableImages=function(G){var J=this.availableImages[G];return J||(J=[]),J},wi.prototype.getLayerIndex=function(G){var J=this.layerIndexes[G];return J||(J=this.layerIndexes[G]=new ae),J},wi.prototype.getWorkerSource=function(G,J,ue){var be=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][J]||(this.workerSources[G][J]={}),this.workerSources[G][J][ue]||(this.workerSources[G][J][ue]=new this.workerSourceTypes[J]({send:function(ke,it,ct){be.actor.send(ke,it,ct,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][J][ue]},wi.prototype.getDEMWorkerSource=function(G,J){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][J]||(this.demWorkerSources[G][J]=new Tt),this.demWorkerSources[G][J]},wi.prototype.enforceCacheSizeLimit=function(G,J){y.enforceCacheSizeLimit(J)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new wi(self)),wi}),ee(["./shared"],function(y){"use strict";var ce=y.createCommonjsModule(function(h){function v(S){return!p(S)}function p(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,O,j=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(j);try{O=new Worker($),R=!0}catch(pe){R=!1}return O&&O.terminate(),URL.revokeObjectURL($),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var O=R.getContext("2d");if(!O)return!1;var j=O.getImageData(0,0,1,1);return j&&j.width===R.width}()?(g[C=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(R){var O=function($){var pe=document.createElement("canvas"),_e=Object.create(v.webGLContextAttributes);return _e.failIfMajorPerformanceCaveat=$,pe.probablySupportsContext?pe.probablySupportsContext("webgl",_e)||pe.probablySupportsContext("experimental-webgl",_e):pe.supportsContext?pe.supportsContext("webgl",_e)||pe.supportsContext("experimental-webgl",_e):pe.getContext("webgl",_e)||pe.getContext("experimental-webgl",_e)}(R);if(!O)return!1;var j=O.createShader(O.VERTEX_SHADER);return!(!j||O.isContextLost())&&(O.shaderSource(j,"void main() {}"),O.compileShader(j),O.getShaderParameter(j,O.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=p);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),z={create:function(h,v,p){var g=y.window.document.createElement(h);return v!==void 0&&(g.className=v),p&&p.appendChild(g),g},createNS:function(h,v){return y.window.document.createElementNS(h,v)}},ae=y.window.document&&y.window.document.documentElement.style;function te(h){if(!ae)return h[0];for(var v=0;v<h.length;v++)if(h[v]in ae)return h[v];return h[0]}var Pe,re=te(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);z.disableDrag=function(){ae&&re&&(Pe=ae[re],ae[re]="none")},z.enableDrag=function(){ae&&re&&(ae[re]=Pe)};var Ze=te(["transform","WebkitTransform"]);z.setTransform=function(h,v){h.style[Ze]=v};var Ke=!1;try{var nt=Object.defineProperty({},"passive",{get:function(){Ke=!0}});y.window.addEventListener("test",nt,nt),y.window.removeEventListener("test",nt,nt)}catch(h){Ke=!1}z.addEventListener=function(h,v,p,g){g===void 0&&(g={}),h.addEventListener(v,p,"passive"in g&&Ke?g:g.capture)},z.removeEventListener=function(h,v,p,g){g===void 0&&(g={}),h.removeEventListener(v,p,"passive"in g&&Ke?g:g.capture)};var Tt=function(h){h.preventDefault(),h.stopPropagation(),y.window.removeEventListener("click",Tt,!0)};function Ct(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}z.suppressClick=function(){y.window.addEventListener("click",Tt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Tt,!0)},0)},z.mousePos=function(h,v){var p=h.getBoundingClientRect();return new y.Point(v.clientX-p.left-h.clientLeft,v.clientY-p.top-h.clientTop)},z.touchPos=function(h,v){for(var p=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new y.Point(v[S].clientX-p.left-h.clientLeft,v[S].clientY-p.top-h.clientTop));return g},z.mouseButton=function(h){return y.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},z.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Gt=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var g=0,S=this.requestors;g<S.length;g+=1){var C=S[g];this._notify(C.ids,C.callback)}this.requestors=[]}},v.prototype.getImage=function(p){return this.images[p]},v.prototype.addImage=function(p,g){this._validate(p,g)&&(this.images[p]=g)},v.prototype._validate=function(p,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(p,g){if(!p)return!0;for(var S=0,C=0,R=p;C<R.length;C+=1){var O=R[C];if(O[0]<S||O[1]<O[0]||g<O[1])return!1;S=O[1]}return!0},v.prototype._validateContent=function(p,g){return!(p&&(p.length!==4||p[0]<0||g.data.width<p[0]||p[1]<0||g.data.height<p[1]||p[2]<0||g.data.width<p[2]||p[3]<0||g.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},v.prototype.updateImage=function(p,g){g.version=this.images[p].version+1,this.images[p]=g,this.updatedImages[p]=!0},v.prototype.removeImage=function(p){var g=this.images[p];delete this.images[p],delete this.patterns[p],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(p,g){var S=!0;if(!this.isLoaded())for(var C=0,R=p;C<R.length;C+=1)this.images[R[C]]||(S=!1);this.isLoaded()||S?this._notify(p,g):this.requestors.push({ids:p,callback:g})},v.prototype._notify=function(p,g){for(var S={},C=0,R=p;C<R.length;C+=1){var O=R[C];this.images[O]||this.fire(new y.Event("styleimagemissing",{id:O}));var j=this.images[O];j?S[O]={data:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:Boolean(j.userImage&&j.userImage.render)}:y.warnOnce('Image "'+O+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},v.prototype.getPattern=function(p){var g=this.patterns[p],S=this.getImage(p);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var C={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(C,S);this.patterns[p]={bin:C,position:R}}return this._updatePatternAtlas(),this.patterns[p].position},v.prototype.bind=function(p){var g=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(p,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var p=[];for(var g in this.patterns)p.push(this.patterns[g].bin);var S=y.potpack(p),C=S.w,R=S.h,O=this.atlasImage;for(var j in O.resize({width:C||1,height:R||1}),this.patterns){var $=this.patterns[j].bin,pe=$.x+1,_e=$.y+1,xe=this.images[j].data,Ue=xe.width,Be=xe.height;y.RGBAImage.copy(xe,O,{x:0,y:0},{x:pe,y:_e},{width:Ue,height:Be}),y.RGBAImage.copy(xe,O,{x:0,y:Be-1},{x:pe,y:_e-1},{width:Ue,height:1}),y.RGBAImage.copy(xe,O,{x:0,y:0},{x:pe,y:_e+Be},{width:Ue,height:1}),y.RGBAImage.copy(xe,O,{x:Ue-1,y:0},{x:pe-1,y:_e},{width:1,height:Be}),y.RGBAImage.copy(xe,O,{x:0,y:0},{x:pe+Ue,y:_e},{width:1,height:Be})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(p){for(var g=0,S=p;g<S.length;g+=1){var C=S[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var R=this.images[C];Ct(R)&&this.updateImage(C,R)}}},v}(y.Evented),Jt=xt,Zt=xt,wt=1e20;function xt(h,v,p,g,S,C){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=C||"normal",this.radius=p||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Lr(h,v,p,g,S,C,R){for(var O=0;O<v;O++){for(var j=0;j<p;j++)g[j]=h[j*v+O];for(mr(g,S,C,R,p),j=0;j<p;j++)h[j*v+O]=S[j]}for(j=0;j<p;j++){for(O=0;O<v;O++)g[O]=h[j*v+O];for(mr(g,S,C,R,v),O=0;O<v;O++)h[j*v+O]=Math.sqrt(S[O])}}function mr(h,v,p,g,S){p[0]=0,g[0]=-wt,g[1]=+wt;for(var C=1,R=0;C<S;C++){for(var O=(h[C]+C*C-(h[p[R]]+p[R]*p[R]))/(2*C-2*p[R]);O<=g[R];)R--,O=(h[C]+C*C-(h[p[R]]+p[R]*p[R]))/(2*C-2*p[R]);p[++R]=C,g[R]=O,g[R+1]=+wt}for(C=0,R=0;C<S;C++){for(;g[R+1]<C;)R++;v[C]=(C-p[R])*(C-p[R])+h[p[R]]}}xt.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?wt:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?wt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Lr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Lr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)p[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return p},Jt.default=Zt;var hr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};hr.prototype.setURL=function(h){this.url=h},hr.prototype.getGlyphs=function(h,v){var p=this,g=[];for(var S in h)for(var C=0,R=h[S];C<R.length;C+=1)g.push({stack:S,id:R[C]});y.asyncAll(g,function(O,j){var $=O.stack,pe=O.id,_e=p.entries[$];_e||(_e=p.entries[$]={glyphs:{},requests:{},ranges:{}});var xe=_e.glyphs[pe];if(xe===void 0){if(xe=p._tinySDF(_e,$,pe))return _e.glyphs[pe]=xe,void j(null,{stack:$,id:pe,glyph:xe});var Ue=Math.floor(pe/256);if(256*Ue>65535)j(new Error("glyphs > 65535 not supported"));else if(_e.ranges[Ue])j(null,{stack:$,id:pe,glyph:xe});else{var Be=_e.requests[Ue];Be||(Be=_e.requests[Ue]=[],hr.loadGlyphRange($,Ue,p.url,p.requestManager,function(Qe,Ie){if(Ie){for(var qe in Ie)p._doesCharSupportLocalGlyph(+qe)||(_e.glyphs[+qe]=Ie[+qe]);_e.ranges[Ue]=!0}for(var ft=0,Rt=Be;ft<Rt.length;ft+=1)(0,Rt[ft])(Qe,Ie);delete _e.requests[Ue]})),Be.push(function(Qe,Ie){Qe?j(Qe):Ie&&j(null,{stack:$,id:pe,glyph:Ie[pe]||null})})}}else j(null,{stack:$,id:pe,glyph:xe})},function(O,j){if(O)v(O);else if(j){for(var $={},pe=0,_e=j;pe<_e.length;pe+=1){var xe=_e[pe],Ue=xe.stack,Be=xe.id,Qe=xe.glyph;($[Ue]||($[Ue]={}))[Be]=Qe&&{id:Qe.id,bitmap:Qe.bitmap.clone(),metrics:Qe.metrics}}v(null,$)}})},hr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](h)||y.isChar["Hangul Syllables"](h)||y.isChar.Hiragana(h)||y.isChar.Katakana(h))},hr.prototype._tinySDF=function(h,v,p){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(p)){var S=h.tinySDF;if(!S){var C="400";/bold/i.test(v)?C="900":/medium/i.test(v)?C="500":/light/i.test(v)&&(C="200"),S=h.tinySDF=new hr.TinySDF(24,3,8,.25,g,C)}return{id:p,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},hr.loadGlyphRange=function(h,v,p,g,S){var C=256*v,R=C+255,O=g.transformRequest(g.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",C+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(O,function(j,$){if(j)S(j);else if($){for(var pe={},_e=0,xe=y.parseGlyphPBF($);_e<xe.length;_e+=1){var Ue=xe[_e];pe[Ue.id]=Ue}S(null,pe)}})},hr.TinySDF=Jt;var Et=function(){this.specification=y.styleSpec.light.position};Et.prototype.possiblyEvaluate=function(h,v){return y.sphericalToCartesian(h.expression.evaluate(v))},Et.prototype.interpolate=function(h,v,p){return{x:y.number(h.x,v.x,p),y:y.number(h.y,v.y,p),z:y.number(h.z,v.z,p)}};var lt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Et,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Ut=function(h){function v(p){h.call(this),this._transitionable=new y.Transitionable(lt),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(p,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,p,g))for(var S in p){var C=p[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),C):this._transitionable.setValue(S,C)}},v.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},v.prototype._validate=function(p,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,p.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},v}(y.Evented),vt=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};vt.prototype.getDash=function(h,v){var p=h.join(",")+String(v);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,v)),this.dashEntry[p]},vt.prototype.getDashRanges=function(h,v,p){var g=[],S=h.length%2==1?-h[h.length-1]*p:0,C=h[0]*p,R=!0;g.push({left:S,right:C,isDash:R,zeroLength:h[0]===0});for(var O=h[0],j=1;j<h.length;j++){var $=h[j];g.push({left:S=O*p,right:C=(O+=$)*p,isDash:R=!R,zeroLength:$===0})}return g},vt.prototype.addRoundDash=function(h,v,p){for(var g=v/2,S=-p;S<=p;S++)for(var C=this.width*(this.nextRow+p+S),R=0,O=h[R],j=0;j<this.width;j++){j/O.right>1&&(O=h[++R]);var $=Math.abs(j-O.left),pe=Math.abs(j-O.right),_e=Math.min($,pe),xe=void 0,Ue=S/p*(g+1);if(O.isDash){var Be=g-Math.abs(Ue);xe=Math.sqrt(_e*_e+Be*Be)}else xe=g-Math.sqrt(_e*_e+Ue*Ue);this.data[C+j]=Math.max(0,Math.min(255,xe+128))}},vt.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var p=h[v],g=h[v+1];p.zeroLength?h.splice(v,1):g&&g.isDash===p.isDash&&(g.left=p.left,h.splice(v,1))}var S=h[0],C=h[h.length-1];S.isDash===C.isDash&&(S.left=C.left-this.width,C.right=S.right+this.width);for(var R=this.width*this.nextRow,O=0,j=h[O],$=0;$<this.width;$++){$/j.right>1&&(j=h[++O]);var pe=Math.abs($-j.left),_e=Math.abs($-j.right),xe=Math.min(pe,_e);this.data[R+$]=Math.max(0,Math.min(255,(j.isDash?xe:-xe)+128))}},vt.prototype.addDash=function(h,v){var p=v?7:0,g=2*p+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,C=0;C<h.length;C++)S+=h[C];if(S!==0){var R=this.width/S,O=this.getDashRanges(h,this.width,R);v?this.addRoundDash(O,R,p):this.addRegularDash(O)}var j={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:S};return this.nextRow+=g,this.dirty=!0,j},vt.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var er=function h(v,p){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var C=new h.Actor(g[S],p,this.id);C.name="Worker "+S,this.actors.push(C)}};function xr(h,v,p){var g=function(S,C){if(S)return p(S);if(C){var R=y.pick(y.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(R.vectorLayers=C.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(O){return O.id})),R.tiles=v.canonicalizeTileset(R,h.url),p(null,R)}};return h.url?y.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,h)})}er.prototype.broadcast=function(h,v,p){y.asyncAll(this.actors,function(g,S){g.send(h,v,S)},p=p||function(){})},er.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},er.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},er.Actor=y.Actor;var q=function(h,v,p){this.bounds=y.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=p||24};q.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},q.prototype.contains=function(h){var v=Math.pow(2,h.z),p=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*v),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=p&&h.x<S&&h.y>=g&&h.y<C};var De=function(h){function v(p,g,S,C){if(h.call(this),this.id=p,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new q(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles,p.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(p){var g=this;return this.setSourceProperty(function(){g._options.tiles=p}),this},v.prototype.setUrl=function(p){var g=this;return this.setSourceProperty(function(){g.url=p,g._options.url=p}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(O,j){return delete p.request,p.aborted?g(null):O&&O.status!==404?g(O):(j&&j.resourceTiming&&(p.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&p.setExpiryData(j),p.loadVectorData(j,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=g:p.request=p.actor.send("reloadTile",C,R.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",C,R.bind(this)))},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(y.Evented),F=function(h){function v(p,g,S,C){h.call(this),this.id=p,this.dispatcher=S,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new y.ErrorEvent(g)):S&&(y.extend(p,S),S.bounds&&(p.tileBounds=new q(S.bounds,p.minzoom,p.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return y.extend({},this._options)},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.loadTile=function(p,g){var S=this,C=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(R,O){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(O){S.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var j=S.map.painter.context,$=j.gl;p.texture=S.map.painter.getTileTexture(O.width),p.texture?p.texture.update(O,{useMipmap:!0}):(p.texture=new y.Texture(j,O,$.RGBA,{useMipmap:!0}),p.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),j.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax)),p.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(p,g){p.request&&(p.request.cancel(),delete p.request),g()},v.prototype.unloadTile=function(p,g){p.texture&&this.map.painter.saveTileTexture(p.texture),g()},v.prototype.hasTransition=function(){return!1},v}(y.Evented),Me=function(h){function v(p,g,S,C){h.call(this,p,g,S,C),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(R,O){R&&(p.state="errored",g(R)),O&&(p.dem=O,p.needsHillshadePrepare=!0,p.state="loaded",g(null))}p.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,O){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(R)p.state="errored",g(R);else if(O){this.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var j=y.window.ImageBitmap&&O instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?O:y.browser.getImageData(O,1),$={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:j,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",$,C.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},v.prototype._getNeighboringTiles=function(p){var g=p.canonical,S=Math.pow(2,g.z),C=(g.x-1+S)%S,R=g.x===0?p.wrap-1:p.wrap,O=(g.x+1+S)%S,j=g.x+1===S?p.wrap+1:p.wrap,$={};return $[new y.OverscaledTileID(p.overscaledZ,R,g.z,C,g.y).key]={backfilled:!1},$[new y.OverscaledTileID(p.overscaledZ,j,g.z,O,g.y).key]={backfilled:!1},g.y>0&&($[new y.OverscaledTileID(p.overscaledZ,R,g.z,C,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(p.overscaledZ,j,g.z,O,g.y-1).key]={backfilled:!1}),g.y+1<S&&($[new y.OverscaledTileID(p.overscaledZ,R,g.z,C,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(p.overscaledZ,j,g.z,O,g.y+1).key]={backfilled:!1}),$},v.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},v}(F),Te=function(h){function v(p,g,S,C){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(C),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)p.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(S.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new y.Event("data",S))}})},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setData=function(p){var g=this;return this._data=p,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",C))}}),this},v.prototype.getClusterExpansionZoom=function(p,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},g),this},v.prototype.getClusterChildren=function(p,g){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},g),this},v.prototype.getClusterLeaves=function(p,g,S,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:g,offset:S},C),this},v.prototype._updateWorkerData=function(p){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),C=this._data;typeof C=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(C),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(C),this.actor.send(this.type+".loadData",S,function(R,O){g._removed||O&&O.abandoned||(g._loaded=!0,O&&O.resourceTiming&&O.resourceTiming[g.id]&&(g._resourceTiming=O.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),p(R))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(p,g){var S=this,C=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(C,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,O){return delete p.request,p.unloadVectorData(),p.aborted?g(null):R?g(R):(p.loadVectorData(O,S.map.painter,C==="reloadTile"),g(null))})},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},v.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(y.Evented),ht=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),bt=function(h){function v(p,g,S,C){h.call(this),this.id=p,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(p,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(C,R){S._loaded=!0,C?S.fire(new y.ErrorEvent(C)):R&&(S.image=R,p&&(S.coordinates=p),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(p){var g=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setCoordinates=function(p){var g=this;this.coordinates=p;var S=p.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var O=1/0,j=1/0,$=-1/0,pe=-1/0,_e=0,xe=R;_e<xe.length;_e+=1){var Ue=xe[_e];O=Math.min(O,Ue.x),j=Math.min(j,Ue.y),$=Math.max($,Ue.x),pe=Math.max(pe,Ue.y)}var Be=Math.max($-O,pe-j),Qe=Math.max(0,Math.floor(-Math.log(Be)/Math.LN2)),Ie=Math.pow(2,Qe);return new y.CanonicalTileID(Qe,Math.floor((O+$)/2*Ie),Math.floor((j+pe)/2*Ie))}(S),this.minzoom=this.maxzoom=this.tileID.z;var C=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.loadTile=function(p,g){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},g(null)):(p.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(y.Evented),St=function(h){function v(p,g,S,C){h.call(this,p,g,S,C),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,C=g.urls;S<C.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(C[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,O){p._loaded=!0,R?p.fire(new y.ErrorEvent(R)):O&&(p.video=O,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(p){if(this.video){var g=this.video.seekable;p<g.start(0)||p>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=p}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(bt),qt=function(h){function v(p,g,S,C){h.call(this,p,g,S,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(O){return typeof O!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[C];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var p=0,g=[this.canvas.width,this.canvas.height];p<g.length;p+=1){var S=g[p];if(isNaN(S)||S<=0)return!0}return!1},v}(bt),or={vector:De,raster:F,"raster-dem":Me,geojson:Te,video:St,image:bt,canvas:qt};function rn(h,v){var p=y.identity([]);return y.translate(p,p,[1,1,0]),y.scale(p,p,[.5*h.width,.5*h.height,1]),y.multiply(p,p,h.calculatePosMatrix(v.toUnwrapped()))}function Or(h,v,p,g,S,C){var R=function(Qe,Ie,qe){if(Qe)for(var ft=0,Rt=Qe;ft<Rt.length;ft+=1){var $t=Ie[Rt[ft]];if($t&&$t.source===qe&&$t.type==="fill-extrusion")return!0}else for(var jt in Ie){var ir=Ie[jt];if(ir.source===qe&&ir.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),O=C.maxPitchScaleFactor(),j=h.tilesIn(g,O,R);j.sort(Kn);for(var $=[],pe=0,_e=j;pe<_e.length;pe+=1){var xe=_e[pe];$.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(v,p,h._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,S,C,O,rn(h.transform,xe.tileID))})}var Ue=function(Qe){for(var Ie={},qe={},ft=0,Rt=Qe;ft<Rt.length;ft+=1){var $t=Rt[ft],jt=$t.queryResults,ir=$t.wrappedTileID,pr=qe[ir]=qe[ir]||{};for(var Ur in jt)for(var Fr=jt[Ur],ln=pr[Ur]=pr[Ur]||{},Un=Ie[Ur]=Ie[Ur]||[],Bn=0,Zn=Fr;Bn<Zn.length;Bn+=1){var Zi=Zn[Bn];ln[Zi.featureIndex]||(ln[Zi.featureIndex]=!0,Un.push(Zi))}}return Ie}($);for(var Be in Ue)Ue[Be].forEach(function(Qe){var Ie=Qe.feature,qe=h.getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=qe});return Ue}function Kn(h,v){var p=h.tileID,g=v.tileID;return p.overscaledZ-g.overscaledZ||p.canonical.y-g.canonical.y||p.wrap-g.wrap||p.canonical.x-g.canonical.x}var on=function(h,v){this.max=h,this.onRemove=v,this.reset()};on.prototype.reset=function(){for(var h in this.data)for(var v=0,p=this.data[h];v<p.length;v+=1){var g=p[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},on.prototype.add=function(h,v,p){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var C={value:v,timeout:void 0};if(p!==void 0&&(C.timeout=setTimeout(function(){g.remove(h,C)},p)),this.data[S].push(C),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},on.prototype.has=function(h){return h.wrapped().key in this.data},on.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},on.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},on.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},on.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},on.prototype.remove=function(h,v){if(!this.has(h))return this;var p=h.wrapped().key,g=v===void 0?0:this.data[p].indexOf(v),S=this.data[p][g];return this.data[p].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this},on.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},on.prototype.filter=function(h){var v=[];for(var p in this.data)for(var g=0,S=this.data[p];g<S.length;g+=1){var C=S[g];h(C.value)||v.push(C)}for(var R=0,O=v;R<O.length;R+=1){var j=O[R];this.remove(j.value.tileID,j)}};var Pn=function(h,v,p){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Pn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Pn.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},Pn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ei=function(h,v,p,g){this.length=v.length,this.attributes=p,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};ei.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ei.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},ei.prototype.enableAttributes=function(h,v){for(var p=0;p<this.attributes.length;p++){var g=v.attributes[this.attributes[p].name];g!==void 0&&h.enableVertexAttribArray(g)}},ei.prototype.setVertexAttribPointers=function(h,v,p){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],C=v.attributes[S.name];C!==void 0&&h.vertexAttribPointer(C,S.components,h[mi[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}},ei.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var xn=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};xn.prototype.get=function(){return this.current},xn.prototype.set=function(h){},xn.prototype.getDefault=function(){return this.default},xn.prototype.setDefault=function(){this.set(this.default)};var Fi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(xn),zi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},v}(xn),Li=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},v}(xn),Qn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(xn),Ln=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},v}(xn),Fo=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},v}(xn),sa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(p){var g=this.current;(p.func!==g.func||p.ref!==g.ref||p.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},v}(xn),ao=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},v}(xn),Pt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=p,this.dirty=!1}},v}(xn),k=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},v}(xn),se=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=p,this.dirty=!1}},v}(xn),de=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},v}(xn),je=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.BLEND):g.disable(g.BLEND),this.current=p,this.dirty=!1}},v}(xn),mt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},v}(xn),Kt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return y.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(xn),Ar=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},v}(xn),Xe=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=p,this.dirty=!1}},v}(xn),Mt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},v}(xn),sr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},v}(xn),dr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},v}(xn),Gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},v}(xn),Nn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(xn),On=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},v}(xn),An=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(xn),Tn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,p),this.current=p,this.dirty=!1}},v}(xn),fi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},v}(xn),ni=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},v}(xn),ta=function(h){function v(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},v}(xn),ra=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},v}(xn),Zo=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},v}(xn),Ts=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},v}(xn),wi=function(h){function v(p,g){h.call(this,p),this.context=p,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(xn),G=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},v}(wi),J=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(wi),ue=function(h,v,p,g){this.context=h,this.width=v,this.height=p;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new G(h,S),g&&(this.depthAttachment=new J(h,S))};ue.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p)}h.deleteFramebuffer(this.framebuffer)};var be=function(h,v,p){this.func=h,this.mask=v,this.range=p};be.ReadOnly=!1,be.ReadWrite=!0,be.disabled=new be(519,be.ReadOnly,[0,1]);var ke=function(h,v,p,g,S,C){this.test=h,this.ref=v,this.mask=p,this.fail=g,this.depthFail=S,this.pass=C};ke.disabled=new ke({func:519,mask:0},0,0,7680,7680,7680);var it=function(h,v,p){this.blendFunction=h,this.blendColor=v,this.mask=p};it.disabled=new it(it.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),it.unblended=new it(it.Replace,y.Color.transparent,[!0,!0,!0,!0]),it.alphaBlended=new it([1,771],y.Color.transparent,[!0,!0,!0,!0]);var ct=function(h,v,p){this.enable=h,this.mode=v,this.frontFace=p};ct.disabled=new ct(!1,1029,2305),ct.backCCW=new ct(!0,1029,2305);var me=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Fi(this),this.clearDepth=new zi(this),this.clearStencil=new Li(this),this.colorMask=new Qn(this),this.depthMask=new Ln(this),this.stencilMask=new Fo(this),this.stencilFunc=new sa(this),this.stencilOp=new ao(this),this.stencilTest=new Pt(this),this.depthRange=new k(this),this.depthTest=new se(this),this.depthFunc=new de(this),this.blend=new je(this),this.blendFunc=new mt(this),this.blendColor=new Kt(this),this.blendEquation=new Ar(this),this.cullFace=new Xe(this),this.cullFaceSide=new Mt(this),this.frontFace=new sr(this),this.program=new dr(this),this.activeTexture=new Gr(this),this.viewport=new Nn(this),this.bindFramebuffer=new On(this),this.bindRenderbuffer=new An(this),this.bindTexture=new Tn(this),this.bindVertexBuffer=new fi(this),this.bindElementBuffer=new ni(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ta(this),this.pixelStoreUnpack=new ra(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Ts(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};me.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},me.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},me.prototype.createIndexBuffer=function(h,v){return new Pn(this,h,v)},me.prototype.createVertexBuffer=function(h,v,p){return new ei(this,h,v,p)},me.prototype.createRenderbuffer=function(h,v,p){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,p),this.bindRenderbuffer.set(null),S},me.prototype.createFramebuffer=function(h,v,p){return new ue(this,h,v,p)},me.prototype.clear=function(h){var v=h.color,p=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),g.clear(S)},me.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},me.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},me.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},me.prototype.setColorMode=function(h){y.deepEqual(h.blendFunction,it.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},me.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Y=function(h){function v(p,g,S){var C=this;h.call(this),this.id=p,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(R,O,j,$){var pe=new or[O.type](R,O,j,$);if(pe.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+pe.id);return y.bindAll(["load","abort","unload","serialize","prepare"],pe),pe}(p,g,S,this),this._tiles={},this._cache=new on(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},v.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var g=this._tiles[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(p,g){return this._source.loadTile(p,g)},v.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},v.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(p){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(p),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return y.values(this._tiles).map(function(p){return p.tileID}).sort(ye).map(function(p){return p.key})},v.prototype.getRenderableIds=function(p){var g=this,S=[];for(var C in this._tiles)this._isIdRenderable(C,p)&&S.push(this._tiles[C]);return p?S.sort(function(R,O){var j=R.tileID,$=O.tileID,pe=new y.Point(j.canonical.x,j.canonical.y)._rotate(g.transform.angle),_e=new y.Point($.canonical.x,$.canonical.y)._rotate(g.transform.angle);return j.overscaledZ-$.overscaledZ||_e.y-pe.y||_e.x-pe.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(ye).map(function(R){return R.key})},v.prototype.hasRenderableParent=function(p){var g=this.findLoadedParent(p,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(p,g){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(g||!this._tiles[p].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},v.prototype._reloadTile=function(p,g){var S=this._tiles[p];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,p,g)))},v.prototype._tileLoaded=function(p,g,S,C){if(C)return p.state="errored",void(C.status!==404?this._source.fire(new y.ErrorEvent(C,{tile:p})):this.update(this.transform));p.timeAdded=y.browser.now(),S==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(g,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},v.prototype._backfillDEM=function(p){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var C=g[S];if(p.neighboringTiles&&p.neighboringTiles[C]){var R=this.getTileByID(C);O(p,R),O(R,p)}}function O(j,$){j.needsHillshadePrepare=!0;var pe=$.tileID.canonical.x-j.tileID.canonical.x,_e=$.tileID.canonical.y-j.tileID.canonical.y,xe=Math.pow(2,j.tileID.canonical.z),Ue=$.tileID.key;pe===0&&_e===0||Math.abs(_e)>1||(Math.abs(pe)>1&&(Math.abs(pe+xe)===1?pe+=xe:Math.abs(pe-xe)===1&&(pe-=xe)),$.dem&&j.dem&&(j.dem.backfillBorder($.dem,pe,_e),j.neighboringTiles&&j.neighboringTiles[Ue]&&(j.neighboringTiles[Ue].backfilled=!0)))}},v.prototype.getTile=function(p){return this.getTileByID(p.key)},v.prototype.getTileByID=function(p){return this._tiles[p]},v.prototype._retainLoadedChildren=function(p,g,S,C){for(var R in this._tiles){var O=this._tiles[R];if(!(C[R]||!O.hasData()||O.tileID.overscaledZ<=g||O.tileID.overscaledZ>S)){for(var j=O.tileID;O&&O.tileID.overscaledZ>g+1;){var $=O.tileID.scaledTo(O.tileID.overscaledZ-1);(O=this._tiles[$.key])&&O.hasData()&&(j=$)}for(var pe=j;pe.overscaledZ>g;)if(p[(pe=pe.scaledTo(pe.overscaledZ-1)).key]){C[j.key]=j;break}}}},v.prototype.findLoadedParent=function(p,g){if(p.key in this._loadedParentTiles){var S=this._loadedParentTiles[p.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var C=p.overscaledZ-1;C>=g;C--){var R=p.scaledTo(C),O=this._getLoadedTile(R);if(O)return O}},v.prototype._getLoadedTile=function(p){var g=this._tiles[p.key];return g&&g.hasData()?g:this._cache.getByKey(p.wrapped().key)},v.prototype.updateCacheSize=function(p){var g=Math.ceil(p.width/this._source.tileSize)+1,S=Math.ceil(p.height/this._source.tileSize)+1,C=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(R)},v.prototype.handleWrapJump=function(p){var g=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,g){var S={};for(var C in this._tiles){var R=this._tiles[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var O in this._tiles=S,this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(var j in this._tiles)this._setTileReloadTimer(j,this._tiles[j])}},v.prototype.update=function(p){var g=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new y.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(S=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(pr){return g._source.hasTile(pr)}))):S=[];var C=p.coveringZoomLevel(this._source),R=Math.max(C-v.maxOverzooming,this._source.minzoom),O=Math.max(C+v.maxUnderzooming,this._source.minzoom),j=this._updateRetainedTiles(S,C);if(tt(this._source.type)){for(var $={},pe={},_e=0,xe=Object.keys(j);_e<xe.length;_e+=1){var Ue=xe[_e],Be=j[Ue],Qe=this._tiles[Ue];if(Qe&&!(Qe.fadeEndTime&&Qe.fadeEndTime<=y.browser.now())){var Ie=this.findLoadedParent(Be,R);Ie&&(this._addTile(Ie.tileID),$[Ie.tileID.key]=Ie.tileID),pe[Ue]=Be}}for(var qe in this._retainLoadedChildren(pe,C,O,j),$)j[qe]||(this._coveredTiles[qe]=!0,j[qe]=$[qe])}for(var ft in j)this._tiles[ft].clearFadeHold();for(var Rt=0,$t=y.keysDifference(this._tiles,j);Rt<$t.length;Rt+=1){var jt=$t[Rt],ir=this._tiles[jt];ir.hasSymbolBuckets&&!ir.holdingForFade()?ir.setHoldDuration(this.map._fadeDuration):ir.hasSymbolBuckets&&!ir.symbolFadeFinished()||this._removeTile(jt)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},v.prototype._updateRetainedTiles=function(p,g){for(var S={},C={},R=Math.max(g-v.maxOverzooming,this._source.minzoom),O=Math.max(g+v.maxUnderzooming,this._source.minzoom),j={},$=0,pe=p;$<pe.length;$+=1){var _e=pe[$],xe=this._addTile(_e);S[_e.key]=_e,xe.hasData()||g<this._source.maxzoom&&(j[_e.key]=_e)}this._retainLoadedChildren(j,g,O,S);for(var Ue=0,Be=p;Ue<Be.length;Ue+=1){var Qe=Be[Ue],Ie=this._tiles[Qe.key];if(!Ie.hasData()){if(g+1>this._source.maxzoom){var qe=Qe.children(this._source.maxzoom)[0],ft=this.getTile(qe);if(ft&&ft.hasData()){S[qe.key]=qe;continue}}else{var Rt=Qe.children(this._source.maxzoom);if(S[Rt[0].key]&&S[Rt[1].key]&&S[Rt[2].key]&&S[Rt[3].key])continue}for(var $t=Ie.wasRequested(),jt=Qe.overscaledZ-1;jt>=R;--jt){var ir=Qe.scaledTo(jt);if(C[ir.key]||(C[ir.key]=!0,!(Ie=this.getTile(ir))&&$t&&(Ie=this._addTile(ir)),Ie&&(S[ir.key]=ir,$t=Ie.wasRequested(),Ie.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,C=this._tiles[p].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){S=this._loadedParentTiles[C.key];break}g.push(C.key);var R=C.scaledTo(C.overscaledZ-1);if(S=this._getLoadedTile(R))break;C=R}for(var O=0,j=g;O<j.length;O+=1)this._loadedParentTiles[j[O]]=S}},v.prototype._addTile=function(p){var g=this._tiles[p.key];if(g)return g;(g=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,g),g.tileID=p,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,g)));var S=Boolean(g);return S||(g=new y.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,p.key,g.state))),g?(g.uses++,this._tiles[p.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(p,g){var S=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var C=g.getExpiryTimeout();C&&(this._timers[p]=setTimeout(function(){S._reloadTile(p,"expired"),delete S._timers[p]},C))},v.prototype._removeTile=function(p){var g=this._tiles[p];g&&(g.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},v.prototype.tilesIn=function(p,g,S){var C=this,R=[],O=this.transform;if(!O)return R;for(var j=S?O.getCameraQueryGeometry(p):p,$=p.map(function(jt){return O.pointCoordinate(jt)}),pe=j.map(function(jt){return O.pointCoordinate(jt)}),_e=this.getIds(),xe=1/0,Ue=1/0,Be=-1/0,Qe=-1/0,Ie=0,qe=pe;Ie<qe.length;Ie+=1){var ft=qe[Ie];xe=Math.min(xe,ft.x),Ue=Math.min(Ue,ft.y),Be=Math.max(Be,ft.x),Qe=Math.max(Qe,ft.y)}for(var Rt=function(jt){var ir=C._tiles[_e[jt]];if(!ir.holdingForFade()){var pr=ir.tileID,Ur=Math.pow(2,O.zoom-ir.tileID.overscaledZ),Fr=g*ir.queryPadding*y.EXTENT/ir.tileSize/Ur,ln=[pr.getTilePoint(new y.MercatorCoordinate(xe,Ue)),pr.getTilePoint(new y.MercatorCoordinate(Be,Qe))];if(ln[0].x-Fr<y.EXTENT&&ln[0].y-Fr<y.EXTENT&&ln[1].x+Fr>=0&&ln[1].y+Fr>=0){var Un=$.map(function(Zn){return pr.getTilePoint(Zn)}),Bn=pe.map(function(Zn){return pr.getTilePoint(Zn)});R.push({tile:ir,tileID:pr,queryGeometry:Un,cameraQueryGeometry:Bn,scale:Ur})}}},$t=0;$t<_e.length;$t++)Rt($t);return R},v.prototype.getVisibleCoordinates=function(p){for(var g=this,S=this.getRenderableIds(p).map(function(j){return g._tiles[j].tileID}),C=0,R=S;C<R.length;C+=1){var O=R[C];O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(tt(this._source.type))for(var p in this._tiles){var g=this._tiles[p];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},v.prototype.setFeatureState=function(p,g,S){this._state.updateState(p=p||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(p,g,S){this._state.removeFeatureState(p=p||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(p,g){return this._state.getState(p=p||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(p,g,S){var C=this._tiles[p];C&&C.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(p,g){for(var S in this._tiles)this._tiles[S].hasDependency(p,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(C){return!C.hasDependency(p,g)})},v}(y.Evented);function ye(h,v){var p=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-p||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function tt(h){return h==="raster"||h==="image"||h==="video"}function gt(){return new y.window.Worker(vh.workerUrl)}Y.maxOverzooming=10,Y.maxUnderzooming=3;var le="mapboxgl_preloaded_worker_pool",br=function(){this.active={}};br.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new gt);return this.active[h]=!0,this.workers.slice()},br.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},br.prototype.isPreloaded=function(){return!!this.active[le]},br.prototype.numActive=function(){return Object.keys(this.active).length};var En,vn=Math.floor(y.browser.hardwareConcurrency/2);function rr(){return En||(En=new br),En}function nn(h,v){var p={};for(var g in h)g!=="ref"&&(p[g]=h[g]);return y.refProperties.forEach(function(S){S in v&&(p[S]=v[S])}),p}function Hr(h){h=h.slice();for(var v=Object.create(null),p=0;p<h.length;p++)v[h[p].id]=h[p];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=nn(h[g],v[h[g].ref]));return h}br.workerCount=Math.max(Math.min(vn,6),1);var Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(h,v,p){p.push({command:Yr.addSource,args:[h,v[h]]})}function Jr(h,v,p){v.push({command:Yr.removeSource,args:[h]}),p[h]=!0}function xi(h,v,p,g){Jr(h,p,g),gi(h,v,p)}function Gi(h,v,p){var g;for(g in h[p])if(h[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;for(g in v[p])if(v[p].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(h[p][g],v[p][g]))return!1;return!0}function _i(h,v,p,g,S,C){var R;for(R in v=v||{},h=h||{})h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:C,args:[g,R,v[R],S]}));for(R in v)v.hasOwnProperty(R)&&!h.hasOwnProperty(R)&&(y.deepEqual(h[R],v[R])||p.push({command:C,args:[g,R,v[R],S]}))}function Ci(h){return h.id}function Ri(h,v){return h[v.id]=v,h}var go=function(h,v){this.reset(h,v)};go.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},go.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=y.clamp(h,0,1);for(var v=1,p=this._distances[v],g=h*this.paddedLength+this.padding;p<g&&v<this._distances.length;)p=this._distances[++v];var S=v-1,C=this._distances[S],R=p-C,O=R>0?(g-C)/R:0;return this.points[S].mult(1-O).add(this.points[v].mult(O))};var Ji=function(h,v,p){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(v/p);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function Sa(h,v,p,g,S){var C=y.create();return v?(y.scale(C,C,[1/S,1/S,1]),p||y.rotateZ(C,C,g.angle)):y.multiply(C,g.labelPlaneMatrix,h),C}function Mi(h,v,p,g,S){if(v){var C=y.clone(h);return y.scale(C,C,[S,S,1]),p||y.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function yi(h,v){var p=[h.x,h.y,0,1];ua(p,p,v);var g=p[3];return{point:new y.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Ai(h,v){return .5+h/v*.5}function Ca(h,v){var p=h[0]/h[3],g=h[1]/h[3];return p>=-v[0]&&p<=v[0]&&g>=-v[1]&&g<=v[1]}function Vs(h,v,p,g,S,C,R,O){var j=g?h.textSizeData:h.iconSizeData,$=y.evaluateSizeForZoom(j,p.transform.zoom),pe=[256/p.width*2+1,256/p.height*2+1],_e=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;_e.clear();for(var xe=h.lineVertexArray,Ue=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,Be=p.transform.width/p.transform.height,Qe=!1,Ie=0;Ie<Ue.length;Ie++){var qe=Ue.get(Ie);if(qe.hidden||qe.writingMode===y.WritingMode.vertical&&!Qe)ii(qe.numGlyphs,_e);else{Qe=!1;var ft=[qe.anchorX,qe.anchorY,0,1];if(y.transformMat4(ft,ft,v),Ca(ft,pe)){var Rt=Ai(p.transform.cameraToCenterDistance,ft[3]),$t=y.evaluateSizeForFeature(j,$,qe),jt=R?$t/Rt:$t*Rt,ir=new y.Point(qe.anchorX,qe.anchorY),pr=yi(ir,S).point,Ur={},Fr=Yu(qe,jt,!1,O,v,S,C,h.glyphOffsetArray,xe,_e,pr,ir,Ur,Be);Qe=Fr.useVertical,(Fr.notEnoughRoom||Qe||Fr.needsFlipping&&Yu(qe,jt,!0,O,v,S,C,h.glyphOffsetArray,xe,_e,pr,ir,Ur,Be).notEnoughRoom)&&ii(qe.numGlyphs,_e)}else ii(qe.numGlyphs,_e)}}g?h.text.dynamicLayoutVertexBuffer.updateData(_e):h.icon.dynamicLayoutVertexBuffer.updateData(_e)}function va(h,v,p,g,S,C,R,O,j,$,pe){var _e=O.glyphStartIndex+O.numGlyphs,xe=O.lineStartIndex,Ue=O.lineStartIndex+O.lineLength,Be=v.getoffsetX(O.glyphStartIndex),Qe=v.getoffsetX(_e-1),Ie=xa(h*Be,p,g,S,C,R,O.segment,xe,Ue,j,$,pe);if(!Ie)return null;var qe=xa(h*Qe,p,g,S,C,R,O.segment,xe,Ue,j,$,pe);return qe?{first:Ie,last:qe}:null}function Ra(h,v,p,g){return h===y.WritingMode.horizontal&&Math.abs(p.y-v.y)>Math.abs(p.x-v.x)*g?{useVertical:!0}:(h===y.WritingMode.vertical?v.y<p.y:v.x>p.x)?{needsFlipping:!0}:null}function Yu(h,v,p,g,S,C,R,O,j,$,pe,_e,xe,Ue){var Be,Qe=v/24,Ie=h.lineOffsetX*Qe,qe=h.lineOffsetY*Qe;if(h.numGlyphs>1){var ft=h.glyphStartIndex+h.numGlyphs,Rt=h.lineStartIndex,$t=h.lineStartIndex+h.lineLength,jt=va(Qe,O,Ie,qe,p,pe,_e,h,j,C,xe);if(!jt)return{notEnoughRoom:!0};var ir=yi(jt.first.point,R).point,pr=yi(jt.last.point,R).point;if(g&&!p){var Ur=Ra(h.writingMode,ir,pr,Ue);if(Ur)return Ur}Be=[jt.first];for(var Fr=h.glyphStartIndex+1;Fr<ft-1;Fr++)Be.push(xa(Qe*O.getoffsetX(Fr),Ie,qe,p,pe,_e,h.segment,Rt,$t,j,C,xe));Be.push(jt.last)}else{if(g&&!p){var ln=yi(_e,S).point,Un=h.lineStartIndex+h.segment+1,Bn=new y.Point(j.getx(Un),j.gety(Un)),Zn=yi(Bn,S),Zi=Zn.signedDistanceFromCamera>0?Zn.point:nu(_e,Bn,ln,1,S),mn=Ra(h.writingMode,ln,Zi,Ue);if(mn)return mn}var oi=xa(Qe*O.getoffsetX(h.glyphStartIndex),Ie,qe,p,pe,_e,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,j,C,xe);if(!oi)return{notEnoughRoom:!0};Be=[oi]}for(var vi=0,ai=Be;vi<ai.length;vi+=1){var ti=ai[vi];y.addDynamicAttributes($,ti.point,ti.angle)}return{}}function nu(h,v,p,g,S){var C=yi(h.add(h.sub(v)._unit()),S).point,R=p.sub(C);return p.add(R._mult(g/R.mag()))}function xa(h,v,p,g,S,C,R,O,j,$,pe,_e){var xe=g?h-v:h+v,Ue=xe>0?1:-1,Be=0;g&&(Ue*=-1,Be=Math.PI),Ue<0&&(Be+=Math.PI);for(var Qe=Ue>0?O+R:O+R+1,Ie=S,qe=S,ft=0,Rt=0,$t=Math.abs(xe),jt=[];ft+Rt<=$t;){if((Qe+=Ue)<O||Qe>=j)return null;if(qe=Ie,jt.push(Ie),(Ie=_e[Qe])===void 0){var ir=new y.Point($.getx(Qe),$.gety(Qe)),pr=yi(ir,pe);if(pr.signedDistanceFromCamera>0)Ie=_e[Qe]=pr.point;else{var Ur=Qe-Ue;Ie=nu(ft===0?C:new y.Point($.getx(Ur),$.gety(Ur)),ir,qe,$t-ft+1,pe)}}ft+=Rt,Rt=qe.dist(Ie)}var Fr=($t-ft)/Rt,ln=Ie.sub(qe),Un=ln.mult(Fr)._add(qe);Un._add(ln._unit()._perp()._mult(p*Ue));var Bn=Be+Math.atan2(Ie.y-qe.y,Ie.x-qe.x);return jt.push(Un),{point:Un,angle:Bn,path:jt}}Ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ji.prototype.insert=function(h,v,p,g,S){this._forEachCell(v,p,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(S)},Ji.prototype.insertCircle=function(h,v,p,g){this._forEachCell(v-g,p-g,v+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(p),this.circles.push(g)},Ji.prototype._insertBoxCell=function(h,v,p,g,S,C){this.boxCells[S].push(C)},Ji.prototype._insertCircleCell=function(h,v,p,g,S,C){this.circleCells[S].push(C)},Ji.prototype._query=function(h,v,p,g,S,C){if(p<0||h>this.width||g<0||v>this.height)return!S&&[];var R=[];if(h<=0&&v<=0&&this.width<=p&&this.height<=g){if(S)return!0;for(var O=0;O<this.boxKeys.length;O++)R.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(var j=0;j<this.circleKeys.length;j++){var $=this.circles[3*j],pe=this.circles[3*j+1],_e=this.circles[3*j+2];R.push({key:this.circleKeys[j],x1:$-_e,y1:pe-_e,x2:$+_e,y2:pe+_e})}return C?R.filter(C):R}return this._forEachCell(h,v,p,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},C),S?R.length>0:R},Ji.prototype._queryCircle=function(h,v,p,g,S){var C=h-p,R=h+p,O=v-p,j=v+p;if(R<0||C>this.width||j<0||O>this.height)return!g&&[];var $=[];return this._forEachCell(C,O,R,j,this._queryCellCircle,$,{hitTest:g,circle:{x:h,y:v,radius:p},seenUids:{box:{},circle:{}}},S),g?$.length>0:$},Ji.prototype.query=function(h,v,p,g,S){return this._query(h,v,p,g,!1,S)},Ji.prototype.hitTest=function(h,v,p,g,S){return this._query(h,v,p,g,!0,S)},Ji.prototype.hitTestCircle=function(h,v,p,g){return this._queryCircle(h,v,p,!0,g)},Ji.prototype._queryCell=function(h,v,p,g,S,C,R,O){var j=R.seenUids,$=this.boxCells[S];if($!==null)for(var pe=this.bboxes,_e=0,xe=$;_e<xe.length;_e+=1){var Ue=xe[_e];if(!j.box[Ue]){j.box[Ue]=!0;var Be=4*Ue;if(h<=pe[Be+2]&&v<=pe[Be+3]&&p>=pe[Be+0]&&g>=pe[Be+1]&&(!O||O(this.boxKeys[Ue]))){if(R.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Ue],x1:pe[Be],y1:pe[Be+1],x2:pe[Be+2],y2:pe[Be+3]})}}}var Qe=this.circleCells[S];if(Qe!==null)for(var Ie=this.circles,qe=0,ft=Qe;qe<ft.length;qe+=1){var Rt=ft[qe];if(!j.circle[Rt]){j.circle[Rt]=!0;var $t=3*Rt;if(this._circleAndRectCollide(Ie[$t],Ie[$t+1],Ie[$t+2],h,v,p,g)&&(!O||O(this.circleKeys[Rt]))){if(R.hitTest)return C.push(!0),!0;var jt=Ie[$t],ir=Ie[$t+1],pr=Ie[$t+2];C.push({key:this.circleKeys[Rt],x1:jt-pr,y1:ir-pr,x2:jt+pr,y2:ir+pr})}}}},Ji.prototype._queryCellCircle=function(h,v,p,g,S,C,R,O){var j=R.circle,$=R.seenUids,pe=this.boxCells[S];if(pe!==null)for(var _e=this.bboxes,xe=0,Ue=pe;xe<Ue.length;xe+=1){var Be=Ue[xe];if(!$.box[Be]){$.box[Be]=!0;var Qe=4*Be;if(this._circleAndRectCollide(j.x,j.y,j.radius,_e[Qe+0],_e[Qe+1],_e[Qe+2],_e[Qe+3])&&(!O||O(this.boxKeys[Be])))return C.push(!0),!0}}var Ie=this.circleCells[S];if(Ie!==null)for(var qe=this.circles,ft=0,Rt=Ie;ft<Rt.length;ft+=1){var $t=Rt[ft];if(!$.circle[$t]){$.circle[$t]=!0;var jt=3*$t;if(this._circlesCollide(qe[jt],qe[jt+1],qe[jt+2],j.x,j.y,j.radius)&&(!O||O(this.circleKeys[$t])))return C.push(!0),!0}}},Ji.prototype._forEachCell=function(h,v,p,g,S,C,R,O){for(var j=this._convertToXCellCoord(h),$=this._convertToYCellCoord(v),pe=this._convertToXCellCoord(p),_e=this._convertToYCellCoord(g),xe=j;xe<=pe;xe++)for(var Ue=$;Ue<=_e;Ue++)if(S.call(this,h,v,p,g,this.xCellCount*Ue+xe,C,R,O))return},Ji.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},Ji.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},Ji.prototype._circlesCollide=function(h,v,p,g,S,C){var R=g-h,O=S-v,j=p+C;return j*j>R*R+O*O},Ji.prototype._circleAndRectCollide=function(h,v,p,g,S,C,R){var O=(C-g)/2,j=Math.abs(h-(g+O));if(j>O+p)return!1;var $=(R-S)/2,pe=Math.abs(v-(S+$));if(pe>$+p)return!1;if(j<=O||pe<=$)return!0;var _e=j-O,xe=pe-$;return _e*_e+xe*xe<=p*p};var as=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ii(h,v){for(var p=0;p<h;p++){var g=v.length;v.resize(g+4),v.float32.set(as,3*g)}}function ua(h,v,p){var g=v[0],S=v[1];return h[0]=p[0]*g+p[4]*S+p[12],h[1]=p[1]*g+p[5]*S+p[13],h[3]=p[3]*g+p[7]*S+p[15],h}var Ma=function(h,v,p){v===void 0&&(v=new Ji(h.width+200,h.height+200,25)),p===void 0&&(p=new Ji(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function na(h,v,p){return v*(y.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}Ma.prototype.placeCollisionBox=function(h,v,p,g,S){var C=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),R=p*C.perspectiveRatio,O=h.x1*R+C.point.x,j=h.y1*R+C.point.y,$=h.x2*R+C.point.x,pe=h.y2*R+C.point.y;return!this.isInsideGrid(O,j,$,pe)||!v&&this.grid.hitTest(O,j,$,pe,S)?{box:[],offscreen:!1}:{box:[O,j,$,pe],offscreen:this.isOffscreen(O,j,$,pe)}},Ma.prototype.placeCollisionCircles=function(h,v,p,g,S,C,R,O,j,$,pe,_e,xe){var Ue=[],Be=new y.Point(v.anchorX,v.anchorY),Qe=yi(Be,C),Ie=Ai(this.transform.cameraToCenterDistance,Qe.signedDistanceFromCamera),qe=($?S/Ie:S*Ie)/y.ONE_EM,ft=yi(Be,R).point,Rt=va(qe,g,v.lineOffsetX*qe,v.lineOffsetY*qe,!1,ft,Be,v,p,R,{}),$t=!1,jt=!1,ir=!0;if(Rt){for(var pr=.5*_e*Ie+xe,Ur=new y.Point(-100,-100),Fr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),ln=new go,Un=Rt.first,Bn=Rt.last,Zn=[],Zi=Un.path.length-1;Zi>=1;Zi--)Zn.push(Un.path[Zi]);for(var mn=1;mn<Bn.path.length;mn++)Zn.push(Bn.path[mn]);var oi=2.5*pr;if(O){var vi=Zn.map(function(Bs){return yi(Bs,O)});Zn=vi.some(function(Bs){return Bs.signedDistanceFromCamera<=0})?[]:vi.map(function(Bs){return Bs.point})}var ai=[];if(Zn.length>0){for(var ti=Zn[0].clone(),pi=Zn[0].clone(),ri=1;ri<Zn.length;ri++)ti.x=Math.min(ti.x,Zn[ri].x),ti.y=Math.min(ti.y,Zn[ri].y),pi.x=Math.max(pi.x,Zn[ri].x),pi.y=Math.max(pi.y,Zn[ri].y);ai=ti.x>=Ur.x&&pi.x<=Fr.x&&ti.y>=Ur.y&&pi.y<=Fr.y?[Zn]:pi.x<Ur.x||ti.x>Fr.x||pi.y<Ur.y||ti.y>Fr.y?[]:y.clipLine([Zn],Ur.x,Ur.y,Fr.x,Fr.y)}for(var $n=0,bo=ai;$n<bo.length;$n+=1){var ja;ln.reset(bo[$n],.25*pr),ja=ln.length<=.5*pr?1:Math.ceil(ln.paddedLength/oi)+1;for(var Eo=0;Eo<ja;Eo++){var lo=Eo/Math.max(ja-1,1),Ba=ln.lerp(lo),Ha=Ba.x+100,cs=Ba.y+100;Ue.push(Ha,cs,pr,0);var fs=Ha-pr,sl=cs-pr,hs=Ha+pr,lu=cs+pr;if(ir=ir&&this.isOffscreen(fs,sl,hs,lu),jt=jt||this.isInsideGrid(fs,sl,hs,lu),!h&&this.grid.hitTestCircle(Ha,cs,pr,pe)&&($t=!0,!j))return{circles:[],offscreen:!1,collisionDetected:$t}}}}return{circles:!j&&$t||!jt?[]:Ue,offscreen:ir,collisionDetected:$t}},Ma.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],p=1/0,g=1/0,S=-1/0,C=-1/0,R=0,O=h;R<O.length;R+=1){var j=O[R],$=new y.Point(j.x+100,j.y+100);p=Math.min(p,$.x),g=Math.min(g,$.y),S=Math.max(S,$.x),C=Math.max(C,$.y),v.push($)}for(var pe={},_e={},xe=0,Ue=this.grid.query(p,g,S,C).concat(this.ignoredGrid.query(p,g,S,C));xe<Ue.length;xe+=1){var Be=Ue[xe],Qe=Be.key;if(pe[Qe.bucketInstanceId]===void 0&&(pe[Qe.bucketInstanceId]={}),!pe[Qe.bucketInstanceId][Qe.featureIndex]){var Ie=[new y.Point(Be.x1,Be.y1),new y.Point(Be.x2,Be.y1),new y.Point(Be.x2,Be.y2),new y.Point(Be.x1,Be.y2)];y.polygonIntersectsPolygon(v,Ie)&&(pe[Qe.bucketInstanceId][Qe.featureIndex]=!0,_e[Qe.bucketInstanceId]===void 0&&(_e[Qe.bucketInstanceId]=[]),_e[Qe.bucketInstanceId].push(Qe.featureIndex))}}return _e},Ma.prototype.insertCollisionBox=function(h,v,p,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},Ma.prototype.insertCollisionCircles=function(h,v,p,g,S){for(var C=v?this.ignoredGrid:this.grid,R={bucketInstanceId:p,featureIndex:g,collisionGroupID:S},O=0;O<h.length;O+=4)C.insertCircle(R,h[O],h[O+1],h[O+2])},Ma.prototype.projectAndGetPerspectiveRatio=function(h,v,p){var g=[v,p,0,1];return ua(g,g,h),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Ma.prototype.isOffscreen=function(h,v,p,g){return p<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},Ma.prototype.isInsideGrid=function(h,v,p,g){return p>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},Ma.prototype.getViewportMatrix=function(){var h=y.identity([]);return y.translate(h,h,[-100,-100,0]),h};var Yo=function(h,v,p,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&p?1:0,this.placed=p};Yo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vo=function(h,v,p,g,S){this.text=new Yo(h?h.text:null,v,p,S),this.icon=new Yo(h?h.icon:null,v,g,S)};Vo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Du=function(h,v,p){this.text=h,this.icon=v,this.skipFade=p},ws=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},fc=function(h,v,p,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=S},Da=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function ji(h,v,p,g,S){var C=y.getAnchorAlignment(h),R=-(C.horizontalAlign-.5)*v,O=-(C.verticalAlign-.5)*p,j=y.evaluateVariableOffset(h,g);return new y.Point(R+j[0]*S,O+j[1]*S)}function jo(h,v,p,g,S,C){var R=h.x1,O=h.x2,j=h.y1,$=h.y2,pe=h.anchorPointX,_e=h.anchorPointY,xe=new y.Point(v,p);return g&&xe._rotate(S?C:-C),{x1:R+xe.x,y1:j+xe.y,x2:O+xe.x,y2:$+xe.y,anchorPointX:pe,anchorPointY:_e}}Da.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(p){return p.collisionGroupID===v}}}return this.collisionGroups[h]};var Wt=function(h,v,p,g){this.transform=h.clone(),this.collisionIndex=new Ma(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Da(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function K(h,v,p,g,S){h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0)}Wt.prototype.getBucketParts=function(h,v,p,g){var S=p.getBucket(v),C=p.latestFeatureIndex;if(S&&C&&v.id===S.layerIds[0]){var R=p.collisionBoxArray,O=S.layers[0].layout,j=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/y.EXTENT,pe=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),_e=O.get("text-pitch-alignment")==="map",xe=O.get("text-rotation-alignment")==="map",Ue=na(p,1,this.transform.zoom),Be=Sa(pe,_e,xe,this.transform,Ue),Qe=null;if(_e){var Ie=Mi(pe,_e,xe,this.transform,Ue);Qe=y.multiply([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[S.bucketInstanceId]=new fc(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,p.tileID);var qe={bucket:S,layout:O,posMatrix:pe,textLabelPlaneMatrix:Be,labelToScreenMatrix:Qe,scale:j,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var ft=0,Rt=S.sortKeyRanges;ft<Rt.length;ft+=1){var $t=Rt[ft];h.push({sortKey:$t.sortKey,symbolInstanceStart:$t.symbolInstanceStart,symbolInstanceEnd:$t.symbolInstanceEnd,parameters:qe})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:qe})}},Wt.prototype.attemptAnchorPlacement=function(h,v,p,g,S,C,R,O,j,$,pe,_e,xe,Ue,Be){var Qe,Ie=[_e.textOffset0,_e.textOffset1],qe=ji(h,p,g,Ie,S),ft=this.collisionIndex.placeCollisionBox(jo(v,qe.x,qe.y,C,R,this.transform.angle),pe,O,j,$.predicate);if(!Be||this.collisionIndex.placeCollisionBox(jo(Be,qe.x,qe.y,C,R,this.transform.angle),pe,O,j,$.predicate).box.length!==0)return ft.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Qe=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:Ie,width:p,height:g,anchor:h,textBoxScale:S,prevAnchor:Qe},this.markUsedJustification(xe,h,_e,Ue),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,Ue,_e),this.placedOrientations[_e.crossTileID]=Ue),{shift:qe,placedGlyphBoxes:ft}):void 0},Wt.prototype.placeLayerBucketPart=function(h,v,p){var g=this,S=h.parameters,C=S.bucket,R=S.layout,O=S.posMatrix,j=S.textLabelPlaneMatrix,$=S.labelToScreenMatrix,pe=S.textPixelRatio,_e=S.holdingForFade,xe=S.collisionBoxArray,Ue=S.partiallyEvaluatedTextSize,Be=S.collisionGroup,Qe=R.get("text-optional"),Ie=R.get("icon-optional"),qe=R.get("text-allow-overlap"),ft=R.get("icon-allow-overlap"),Rt=R.get("text-rotation-alignment")==="map",$t=R.get("text-pitch-alignment")==="map",jt=R.get("icon-text-fit")!=="none",ir=R.get("symbol-z-order")==="viewport-y",pr=qe&&(ft||!C.hasIconData()||Ie),Ur=ft&&(qe||!C.hasTextData()||Qe);!C.collisionArrays&&xe&&C.deserializeCollisionBoxes(xe);var Fr=function(mn,oi){if(!v[mn.crossTileID])if(_e)g.placements[mn.crossTileID]=new Du(!1,!1,!1);else{var vi,ai=!1,ti=!1,pi=!0,ri=null,$n={box:null,offscreen:null},bo={box:null,offscreen:null},ja=null,Eo=null,lo=0,Ba=0,Ha=0;oi.textFeatureIndex?lo=oi.textFeatureIndex:mn.useRuntimeCollisionCircles&&(lo=mn.featureIndex),oi.verticalTextFeatureIndex&&(Ba=oi.verticalTextFeatureIndex);var cs=oi.textBox;if(cs){var fs=function(Ui){var Go=y.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Ui&&g.prevPlacement){var Ja=g.prevPlacement.placedOrientations[mn.crossTileID];Ja&&(g.placedOrientations[mn.crossTileID]=Ja,g.markUsedOrientation(C,Go=Ja,mn))}return Go},sl=function(Ui,Go){if(C.allowVerticalPlacement&&mn.numVerticalGlyphVertices>0&&oi.verticalTextBox)for(var Ja=0,hu=C.writingModes;Ja<hu.length&&(hu[Ja]===y.WritingMode.vertical?($n=Go(),bo=$n):$n=Ui(),!($n&&$n.box&&$n.box.length));Ja+=1);else $n=Ui()};if(R.get("text-variable-anchor")){var hs=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[mn.crossTileID]){var lu=g.prevPlacement.variableOffsets[mn.crossTileID];hs.indexOf(lu.anchor)>0&&(hs=hs.filter(function(Ui){return Ui!==lu.anchor})).unshift(lu.anchor)}var Bs=function(Ui,Go,Ja){for(var hu=Ui.x2-Ui.x1,Sc=Ui.y2-Ui.y1,ju=mn.textBoxScale,mh=jt&&!ft?Go:null,Ao={box:[],offscreen:!1},Mr=qe?2*hs.length:hs.length,Ls=0;Ls<Mr;++Ls){var gh=g.attemptAnchorPlacement(hs[Ls%hs.length],Ui,hu,Sc,ju,Rt,$t,pe,O,Be,Ls>=hs.length,mn,C,Ja,mh);if(gh&&(Ao=gh.placedGlyphBoxes)&&Ao.box&&Ao.box.length){ai=!0,ri=gh.shift;break}}return Ao};sl(function(){return Bs(cs,oi.iconBox,y.WritingMode.horizontal)},function(){var Ui=oi.verticalTextBox;return C.allowVerticalPlacement&&!($n&&$n.box&&$n.box.length)&&mn.numVerticalGlyphVertices>0&&Ui?Bs(Ui,oi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),$n&&(ai=$n.box,pi=$n.offscreen);var Ec=fs($n&&$n.box);if(!ai&&g.prevPlacement){var Vu=g.prevPlacement.variableOffsets[mn.crossTileID];Vu&&(g.variableOffsets[mn.crossTileID]=Vu,g.markUsedJustification(C,Vu.anchor,mn,Ec))}}else{var Au=function(Ui,Go){var Ja=g.collisionIndex.placeCollisionBox(Ui,qe,pe,O,Be.predicate);return Ja&&Ja.box&&Ja.box.length&&(g.markUsedOrientation(C,Go,mn),g.placedOrientations[mn.crossTileID]=Go),Ja};sl(function(){return Au(cs,y.WritingMode.horizontal)},function(){var Ui=oi.verticalTextBox;return C.allowVerticalPlacement&&mn.numVerticalGlyphVertices>0&&Ui?Au(Ui,y.WritingMode.vertical):{box:null,offscreen:null}}),fs($n&&$n.box&&$n.box.length)}}if(ai=(vi=$n)&&vi.box&&vi.box.length>0,pi=vi&&vi.offscreen,mn.useRuntimeCollisionCircles){var ql=C.text.placedSymbolArray.get(mn.centerJustifiedTextSymbolIndex),ul=y.evaluateSizeForFeature(C.textSizeData,Ue,ql),cu=R.get("text-padding");ja=g.collisionIndex.placeCollisionCircles(qe,ql,C.lineVertexArray,C.glyphOffsetArray,ul,O,j,$,p,$t,Be.predicate,mn.collisionCircleDiameter,cu),ai=qe||ja.circles.length>0&&!ja.collisionDetected,pi=pi&&ja.offscreen}if(oi.iconFeatureIndex&&(Ha=oi.iconFeatureIndex),oi.iconBox){var ll=function(Ui){var Go=jt&&ri?jo(Ui,ri.x,ri.y,Rt,$t,g.transform.angle):Ui;return g.collisionIndex.placeCollisionBox(Go,ft,pe,O,Be.predicate)};ti=bo&&bo.box&&bo.box.length&&oi.verticalIconBox?(Eo=ll(oi.verticalIconBox)).box.length>0:(Eo=ll(oi.iconBox)).box.length>0,pi=pi&&Eo.offscreen}var So=Qe||mn.numHorizontalGlyphVertices===0&&mn.numVerticalGlyphVertices===0,Qa=Ie||mn.numIconVertices===0;if(So||Qa?Qa?So||(ti=ti&&ai):ai=ti&&ai:ti=ai=ti&&ai,ai&&vi&&vi.box&&g.collisionIndex.insertCollisionBox(vi.box,R.get("text-ignore-placement"),C.bucketInstanceId,bo&&bo.box&&Ba?Ba:lo,Be.ID),ti&&Eo&&g.collisionIndex.insertCollisionBox(Eo.box,R.get("icon-ignore-placement"),C.bucketInstanceId,Ha,Be.ID),ja&&(ai&&g.collisionIndex.insertCollisionCircles(ja.circles,R.get("text-ignore-placement"),C.bucketInstanceId,lo,Be.ID),p)){var ys=C.bucketInstanceId,fu=g.collisionCircleArrays[ys];fu===void 0&&(fu=g.collisionCircleArrays[ys]=new ws);for(var Tu=0;Tu<ja.circles.length;Tu+=4)fu.circles.push(ja.circles[Tu+0]),fu.circles.push(ja.circles[Tu+1]),fu.circles.push(ja.circles[Tu+2]),fu.circles.push(ja.collisionDetected?1:0)}g.placements[mn.crossTileID]=new Du(ai||pr,ti||Ur,pi||C.justReloaded),v[mn.crossTileID]=!0}};if(ir)for(var ln=C.getSortedSymbolIndexes(this.transform.angle),Un=ln.length-1;Un>=0;--Un){var Bn=ln[Un];Fr(C.symbolInstances.get(Bn),C.collisionArrays[Bn])}else for(var Zn=h.symbolInstanceStart;Zn<h.symbolInstanceEnd;Zn++)Fr(C.symbolInstances.get(Zn),C.collisionArrays[Zn]);if(p&&C.bucketInstanceId in this.collisionCircleArrays){var Zi=this.collisionCircleArrays[C.bucketInstanceId];y.invert(Zi.invProjMatrix,O),Zi.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Wt.prototype.markUsedJustification=function(h,v,p,g){var S;S=g===y.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(v)];for(var C=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];C<R.length;C+=1){var O=R[C];O>=0&&(h.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:p.crossTileID)}},Wt.prototype.markUsedOrientation=function(h,v,p){for(var g=v===y.WritingMode.horizontal||v===y.WritingMode.horizontalOnly?v:0,S=v===y.WritingMode.vertical?v:0,C=0,R=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];C<R.length;C+=1)h.text.placedSymbolArray.get(R[C]).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)},Wt.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,p=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},C=v?v.variableOffsets:{},R=v?v.placedOrientations:{};for(var O in this.placements){var j=this.placements[O],$=S[O];$?(this.opacities[O]=new Vo($,g,j.text,j.icon),p=p||j.text!==$.text.placed||j.icon!==$.icon.placed):(this.opacities[O]=new Vo(null,g,j.text,j.icon,j.skipFade),p=p||j.text||j.icon)}for(var pe in S){var _e=S[pe];if(!this.opacities[pe]){var xe=new Vo(_e,g,!1,!1);xe.isHidden()||(this.opacities[pe]=xe,p=p||_e.text.placed||_e.icon.placed)}}for(var Ue in C)this.variableOffsets[Ue]||!this.opacities[Ue]||this.opacities[Ue].isHidden()||(this.variableOffsets[Ue]=C[Ue]);for(var Be in R)this.placedOrientations[Be]||!this.opacities[Be]||this.opacities[Be].isHidden()||(this.placedOrientations[Be]=R[Be]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},Wt.prototype.updateLayerOpacities=function(h,v){for(var p={},g=0,S=v;g<S.length;g+=1){var C=S[g],R=C.getBucket(h);R&&C.latestFeatureIndex&&h.id===R.layerIds[0]&&this.updateBucketOpacities(R,p,C.collisionBoxArray)}},Wt.prototype.updateBucketOpacities=function(h,v,p){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,C=new Vo(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),O=S.get("icon-allow-overlap"),j=S.get("text-variable-anchor"),$=S.get("text-rotation-alignment")==="map",pe=S.get("text-pitch-alignment")==="map",_e=S.get("icon-text-fit")!=="none",xe=new Vo(null,0,R&&(O||!h.hasIconData()||S.get("icon-optional")),O&&(R||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(p);for(var Ue=function(qe,ft,Rt){for(var $t=0;$t<ft/4;$t++)qe.opacityVertexArray.emplaceBack(Rt)},Be=function(qe){var ft=h.symbolInstances.get(qe),Rt=ft.numHorizontalGlyphVertices,$t=ft.numVerticalGlyphVertices,jt=ft.crossTileID,ir=g.opacities[jt];v[jt]?ir=C:ir||(g.opacities[jt]=ir=xe),v[jt]=!0;var pr=ft.numIconVertices>0,Ur=g.placedOrientations[ft.crossTileID],Fr=Ur===y.WritingMode.vertical,ln=Ur===y.WritingMode.horizontal||Ur===y.WritingMode.horizontalOnly;if(Rt>0||$t>0){var Un=_o(ir.text);Ue(h.text,Rt,Fr?to:Un),Ue(h.text,$t,ln?to:Un);var Bn=ir.text.isHidden();[ft.rightJustifiedTextSymbolIndex,ft.centerJustifiedTextSymbolIndex,ft.leftJustifiedTextSymbolIndex].forEach(function($n){$n>=0&&(h.text.placedSymbolArray.get($n).hidden=Bn||Fr?1:0)}),ft.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(ft.verticalPlacedTextSymbolIndex).hidden=Bn||ln?1:0);var Zn=g.variableOffsets[ft.crossTileID];Zn&&g.markUsedJustification(h,Zn.anchor,ft,Ur);var Zi=g.placedOrientations[ft.crossTileID];Zi&&(g.markUsedJustification(h,"left",ft,Zi),g.markUsedOrientation(h,Zi,ft))}if(pr){var mn=_o(ir.icon),oi=!(_e&&ft.verticalPlacedIconSymbolIndex&&Fr);ft.placedIconSymbolIndex>=0&&(Ue(h.icon,ft.numIconVertices,oi?mn:to),h.icon.placedSymbolArray.get(ft.placedIconSymbolIndex).hidden=ir.icon.isHidden()),ft.verticalPlacedIconSymbolIndex>=0&&(Ue(h.icon,ft.numVerticalIconVertices,oi?to:mn),h.icon.placedSymbolArray.get(ft.verticalPlacedIconSymbolIndex).hidden=ir.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var vi=h.collisionArrays[qe];if(vi){var ai=new y.Point(0,0);if(vi.textBox||vi.verticalTextBox){var ti=!0;if(j){var pi=g.variableOffsets[jt];pi?(ai=ji(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textBoxScale),$&&ai._rotate(pe?g.transform.angle:-g.transform.angle)):ti=!1}vi.textBox&&K(h.textCollisionBox.collisionVertexArray,ir.text.placed,!ti||Fr,ai.x,ai.y),vi.verticalTextBox&&K(h.textCollisionBox.collisionVertexArray,ir.text.placed,!ti||ln,ai.x,ai.y)}var ri=Boolean(!ln&&vi.verticalIconBox);vi.iconBox&&K(h.iconCollisionBox.collisionVertexArray,ir.icon.placed,ri,_e?ai.x:0,_e?ai.y:0),vi.verticalIconBox&&K(h.iconCollisionBox.collisionVertexArray,ir.icon.placed,!ri,_e?ai.x:0,_e?ai.y:0)}}},Qe=0;Qe<h.symbolInstances.length;Qe++)Be(Qe);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Ie=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Ie.invProjMatrix,h.placementViewportMatrix=Ie.viewportMatrix,h.collisionCircleArray=Ie.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Wt.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wt.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Wt.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Wt.prototype.stillRecent=function(h,v){var p=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*p>h},Wt.prototype.setStale=function(){this.stale=!0};var Re=Math.pow(2,25),st=Math.pow(2,24),nr=Math.pow(2,17),Wr=Math.pow(2,16),Dn=Math.pow(2,9),Hi=Math.pow(2,8),oo=Math.pow(2,1);function _o(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,p=Math.floor(127*h.opacity);return p*Re+v*st+p*nr+v*Wr+p*Dn+v*Hi+p*oo+v}var to=0,Cs=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Cs.prototype.continuePlacement=function(h,v,p,g,S){for(var C=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(C,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(R,O){return R.sortKey-O.sortKey}));this._currentPartIndex<C.length;)if(v.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1};var Uc=function(h,v,p,g,S,C,R){this.placement=new Wt(h,S,C,R),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1};Uc.prototype.isDone=function(){return this._done},Uc.prototype.continuePlacement=function(h,v,p){for(var g=this,S=y.browser.now(),C=function(){var j=y.browser.now()-S;return!g._forceFullPlacement&&j>2};this._currentPlacementIndex>=0;){var R=v[h[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=O)&&(!R.maxzoom||R.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Cs(R)),this._inProgressLayer.continuePlacement(p[R.source],this.placement,this._showCollisionBoxes,R,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Uc.prototype.commit=function(h){return this.placement.commit(h),this.placement};var iu=512/y.EXTENT/2,mf=function(h,v,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var g=0;g<v.length;g++){var S=v.get(g),C=S.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};mf.prototype.getScaledCoordinates=function(h,v){var p=iu/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*y.EXTENT+h.anchorX)*p),y:Math.floor((v.canonical.y*y.EXTENT+h.anchorY)*p)}},mf.prototype.findMatches=function(h,v,p){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var C=h.get(S);if(!C.crossTileID){var R=this.indexedSymbolInstances[C.key];if(R)for(var O=this.getScaledCoordinates(C,v),j=0,$=R;j<$.length;j+=1){var pe=$[j];if(Math.abs(pe.coord.x-O.x)<=g&&Math.abs(pe.coord.y-O.y)<=g&&!p[pe.crossTileID]){p[pe.crossTileID]=!0,C.crossTileID=pe.crossTileID;break}}}}};var Ho=function(){this.maxCrossTileID=0};Ho.prototype.generate=function(){return++this.maxCrossTileID};var yl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};yl.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var p in this.indexes){var g=this.indexes[p],S={};for(var C in g){var R=g[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+v),S[R.tileID.key]=R}this.indexes[p]=S}this.lng=h},yl.prototype.addBucket=function(h,v,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var C in this.indexes){var R=this.indexes[C];if(Number(C)>h.overscaledZ)for(var O in R){var j=R[O];j.tileID.isChildOf(h)&&j.findMatches(v.symbolInstances,h,S)}else{var $=R[h.scaledTo(Number(C)).key];$&&$.findMatches(v.symbolInstances,h,S)}}for(var pe=0;pe<v.symbolInstances.length;pe++){var _e=v.symbolInstances.get(pe);_e.crossTileID||(_e.crossTileID=p.generate(),S[_e.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new mf(h,v.symbolInstances,v.bucketInstanceId),!0},yl.prototype.removeBucketCrossTileIDs=function(h,v){for(var p in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[p];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},yl.prototype.removeStaleBuckets=function(h){var v=!1;for(var p in this.indexes){var g=this.indexes[p];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[S]),delete g[S],v=!0)}return v};var xl=function(){this.layerIndexes={},this.crossTileIDs=new Ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};xl.prototype.addLayer=function(h,v,p){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new yl);var S=!1,C={};g.handleWrapJump(p);for(var R=0,O=v;R<O.length;R+=1){var j=O[R],$=j.getBucket(h);$&&h.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(j.tileID,$,this.crossTileIDs)&&(S=!0),C[$.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(S=!0),S},xl.prototype.pruneUnusedLayers=function(h){var v={};for(var p in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[p]||delete this.layerIndexes[p]};var Fu=function(h,v){return y.emitValidationErrors(h,v&&v.filter(function(p){return p.identifier!=="source.canvas"}))},ku=y.pick(Yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),qu=y.pick(Yr,["setCenter","setZoom","setBearing","setPitch"]),zc=function(){var h={},v=y.styleSpec.$version;for(var p in y.styleSpec.$root){var g,S=y.styleSpec.$root[p];S.required&&(g=p==="version"?v:S.type==="array"?[]:{})!=null&&(h[p]=g)}return h}(),Rs=function(h){function v(p,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=p,this.dispatcher=new er(rr(),this),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new hr(p._requestManager,g.localIdeographFontFamily),this.lineAtlas=new vt(256,512),this.crossTileSymbolIndex=new xl,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var C=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(R){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(O,j){if(y.triggerPluginCompletionEvent(O),j&&j.every(function(pe){return pe}))for(var $ in C.sourceCaches)C.sourceCaches[$].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var O=S.sourceCaches[R.sourceId];if(O){var j=O.getSource();if(j&&j.vectorLayerIds)for(var $ in S._layers){var pe=S._layers[$];pe.source===j.id&&S._validateLayer(pe)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,g.accessToken);var R=this.map._requestManager.transformRequest(p,y.ResourceType.Style);this._request=y.getJSON(R,function(O,j){S._request=null,O?S.fire(new y.ErrorEvent(O)):j&&S._load(j,C)})},v.prototype.loadJSON=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(p,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(zc,!1)},v.prototype._load=function(p,g){if(!g||!Fu(this,y.validateStyle(p))){for(var S in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var C=Hr(this.stylesheet.layers);this._order=C.map(function($){return $.id}),this._layers={},this._serializedLayers={};for(var R=0,O=C;R<O.length;R+=1){var j=O[R];(j=y.createStyleLayer(j)).setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j,this._serializedLayers[j.id]=j.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ut(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},v.prototype._loadSprite=function(p){var g=this;this._spriteRequest=function(S,C,R){var O,j,$,pe=y.browser.devicePixelRatio>1?"@2x":"",_e=y.getJSON(C.transformRequest(C.normalizeSpriteURL(S,pe,".json"),y.ResourceType.SpriteJSON),function(Be,Qe){_e=null,$||($=Be,O=Qe,Ue())}),xe=y.getImage(C.transformRequest(C.normalizeSpriteURL(S,pe,".png"),y.ResourceType.SpriteImage),function(Be,Qe){xe=null,$||($=Be,j=Qe,Ue())});function Ue(){if($)R($);else if(O&&j){var Be=y.browser.getImageData(j),Qe={};for(var Ie in O){var qe=O[Ie],ft=qe.width,Rt=qe.height,$t=qe.x,jt=qe.y,ir=qe.sdf,pr=qe.pixelRatio,Ur=qe.stretchX,Fr=qe.stretchY,ln=qe.content,Un=new y.RGBAImage({width:ft,height:Rt});y.RGBAImage.copy(Be,Un,{x:$t,y:jt},{x:0,y:0},{width:ft,height:Rt}),Qe[Ie]={data:Un,pixelRatio:pr,sdf:ir,stretchX:Ur,stretchY:Fr,content:ln}}R(null,Qe)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),xe&&(xe.cancel(),xe=null)}}}(p,this.map._requestManager,function(S,C){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(C)for(var R in C)g.imageManager.addImage(R,C[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(p){var g=this.sourceCaches[p.source];if(g){var S=p.sourceLayer;if(S){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+C.id+'" as specified by style layer "'+p.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(p){for(var g=[],S=0,C=p;S<C.length;S+=1){var R=this._layers[C[S]];R.type!=="custom"&&g.push(R.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(p){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var R in(S.length||C.length)&&this._updateWorkerLayers(S,C),this._updatedSources){var O=this._updatedSources[R];O==="reload"?this._reloadSource(R):O==="clear"&&this._clearSource(R)}for(var j in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[j].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var $={};for(var pe in this.sourceCaches){var _e=this.sourceCaches[pe];$[pe]=_e.used,_e.used=!1}for(var xe=0,Ue=this._order;xe<Ue.length;xe+=1){var Be=this._layers[Ue[xe]];Be.recalculate(p,this._availableImages),!Be.isHidden(p.zoom)&&Be.source&&(this.sourceCaches[Be.source].used=!0)}for(var Qe in $){var Ie=this.sourceCaches[Qe];$[Qe]!==Ie.used&&Ie.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Qe}))}this.light.recalculate(p),this.z=p.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},v.prototype._updateWorkerLayers=function(p,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(p){var g=this;if(this._checkLoaded(),Fu(this,y.validateStyle(p)))return!1;(p=y.clone$1(p)).layers=Hr(p.layers);var S=function(R,O){if(!R)return[{command:Yr.setStyle,args:[O]}];var j=[];try{if(!y.deepEqual(R.version,O.version))return[{command:Yr.setStyle,args:[O]}];y.deepEqual(R.center,O.center)||j.push({command:Yr.setCenter,args:[O.center]}),y.deepEqual(R.zoom,O.zoom)||j.push({command:Yr.setZoom,args:[O.zoom]}),y.deepEqual(R.bearing,O.bearing)||j.push({command:Yr.setBearing,args:[O.bearing]}),y.deepEqual(R.pitch,O.pitch)||j.push({command:Yr.setPitch,args:[O.pitch]}),y.deepEqual(R.sprite,O.sprite)||j.push({command:Yr.setSprite,args:[O.sprite]}),y.deepEqual(R.glyphs,O.glyphs)||j.push({command:Yr.setGlyphs,args:[O.glyphs]}),y.deepEqual(R.transition,O.transition)||j.push({command:Yr.setTransition,args:[O.transition]}),y.deepEqual(R.light,O.light)||j.push({command:Yr.setLight,args:[O.light]});var $={},pe=[];(function(xe,Ue,Be,Qe){var Ie;for(Ie in Ue=Ue||{},xe=xe||{})xe.hasOwnProperty(Ie)&&(Ue.hasOwnProperty(Ie)||Jr(Ie,Be,Qe));for(Ie in Ue)Ue.hasOwnProperty(Ie)&&(xe.hasOwnProperty(Ie)?y.deepEqual(xe[Ie],Ue[Ie])||(xe[Ie].type==="geojson"&&Ue[Ie].type==="geojson"&&Gi(xe,Ue,Ie)?Be.push({command:Yr.setGeoJSONSourceData,args:[Ie,Ue[Ie].data]}):xi(Ie,Ue,Be,Qe)):gi(Ie,Ue,Be))})(R.sources,O.sources,pe,$);var _e=[];R.layers&&R.layers.forEach(function(xe){$[xe.source]?j.push({command:Yr.removeLayer,args:[xe.id]}):_e.push(xe)}),j=j.concat(pe),function(xe,Ue,Be){Ue=Ue||[];var Qe,Ie,qe,ft,Rt,$t,jt,ir=(xe=xe||[]).map(Ci),pr=Ue.map(Ci),Ur=xe.reduce(Ri,{}),Fr=Ue.reduce(Ri,{}),ln=ir.slice(),Un=Object.create(null);for(Qe=0,Ie=0;Qe<ir.length;Qe++)Fr.hasOwnProperty(qe=ir[Qe])?Ie++:(Be.push({command:Yr.removeLayer,args:[qe]}),ln.splice(ln.indexOf(qe,Ie),1));for(Qe=0,Ie=0;Qe<pr.length;Qe++)ln[ln.length-1-Qe]!==(qe=pr[pr.length-1-Qe])&&(Ur.hasOwnProperty(qe)?(Be.push({command:Yr.removeLayer,args:[qe]}),ln.splice(ln.lastIndexOf(qe,ln.length-Ie),1)):Ie++,Be.push({command:Yr.addLayer,args:[Fr[qe],$t=ln[ln.length-Qe]]}),ln.splice(ln.length-Qe,0,qe),Un[qe]=!0);for(Qe=0;Qe<pr.length;Qe++)if(ft=Ur[qe=pr[Qe]],Rt=Fr[qe],!Un[qe]&&!y.deepEqual(ft,Rt))if(y.deepEqual(ft.source,Rt.source)&&y.deepEqual(ft["source-layer"],Rt["source-layer"])&&y.deepEqual(ft.type,Rt.type)){for(jt in _i(ft.layout,Rt.layout,Be,qe,null,Yr.setLayoutProperty),_i(ft.paint,Rt.paint,Be,qe,null,Yr.setPaintProperty),y.deepEqual(ft.filter,Rt.filter)||Be.push({command:Yr.setFilter,args:[qe,Rt.filter]}),y.deepEqual(ft.minzoom,Rt.minzoom)&&y.deepEqual(ft.maxzoom,Rt.maxzoom)||Be.push({command:Yr.setLayerZoomRange,args:[qe,Rt.minzoom,Rt.maxzoom]}),ft)ft.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?_i(ft[jt],Rt[jt],Be,qe,jt.slice(6),Yr.setPaintProperty):y.deepEqual(ft[jt],Rt[jt])||Be.push({command:Yr.setLayerProperty,args:[qe,jt,Rt[jt]]}));for(jt in Rt)Rt.hasOwnProperty(jt)&&!ft.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?_i(ft[jt],Rt[jt],Be,qe,jt.slice(6),Yr.setPaintProperty):y.deepEqual(ft[jt],Rt[jt])||Be.push({command:Yr.setLayerProperty,args:[qe,jt,Rt[jt]]}))}else Be.push({command:Yr.removeLayer,args:[qe]}),$t=ln[ln.lastIndexOf(qe)+1],Be.push({command:Yr.addLayer,args:[Rt,$t]})}(_e,O.layers,j)}catch(xe){console.warn("Unable to compute style diff:",xe),j=[{command:Yr.setStyle,args:[O]}]}return j}(this.serialize(),p).filter(function(R){return!(R.command in qu)});if(S.length===0)return!1;var C=S.filter(function(R){return!(R.command in ku)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=p,!0},v.prototype.addImage=function(p,g){if(this.getImage(p))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,g),this._afterImageUpdated(p)},v.prototype.updateImage=function(p,g){this.imageManager.updateImage(p,g)},v.prototype.getImage=function(p){return this.imageManager.getImage(p)},v.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},v.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(p,g,S){var C=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+p,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[p]=new Y(p,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:R.serialize(),sourceId:p}}),R.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===p)return this.fire(new y.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(p,g){this._checkLoaded(),this.sourceCaches[p].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},v.prototype.addLayer=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var C=p.id;if(this.getLayer(C))this.fire(new y.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var R;if(p.type==="custom"){if(Fu(this,y.validateCustomStyleLayer(p)))return;R=y.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(C,p.source),p=y.clone$1(p),p=y.extend(p,{source:C})),this._validate(y.validateStyle.layer,"layers."+C,p,{arrayIndex:-1},S))return;R=y.createStyleLayer(p),this._validateLayer(R),R.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[R.id]=R.serialize()}var O=g?this._order.indexOf(g):this._order.length;if(g&&O===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(O,0,C),this._layerOrderChanged=!0,this._layers[C]=R,this._removedLayers[C]&&R.source&&R.type!=="custom"){var j=this._removedLayers[C];delete this._removedLayers[C],j.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},v.prototype.moveLayer=function(p,g){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==g){var S=this._order.indexOf(p);this._order.splice(S,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,p),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(p){this._checkLoaded();var g=this._layers[p];if(g){g.setEventedParent(null);var S=this._order.indexOf(p);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=g,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(p){return this._layers[p]},v.prototype.hasLayer=function(p){return p in this._layers},v.prototype.setLayerZoomRange=function(p,g,S){this._checkLoaded();var C=this.getLayer(p);C?C.minzoom===g&&C.maxzoom===S||(g!=null&&(C.minzoom=g),S!=null&&(C.maxzoom=S),this._updateLayer(C)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var C=this.getLayer(p);if(C){if(!y.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(y.validateStyle.filter,"layers."+C.id+".filter",g,null,S)||(C.filter=y.clone$1(g),this._updateLayer(C)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(p){return y.clone$1(this.getLayer(p).filter)},v.prototype.setLayoutProperty=function(p,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,C),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(p,g){var S=this.getLayer(p);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(p,g,S,C){C===void 0&&(C={}),this._checkLoaded();var R=this.getLayer(p);R?y.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,C)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(p,g){return this.getLayer(p).getPaintProperty(g)},v.prototype.setFeatureState=function(p,g){this._checkLoaded();var S=p.source,C=p.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var O=R.getSource().type;O==="geojson"&&C?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||C?(p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(C,p.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(p,g){this._checkLoaded();var S=p.source,C=this.sourceCaches[S];if(C!==void 0){var R=C.getSource().type,O=R==="vector"?p.sourceLayer:void 0;R!=="vector"||O?g&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(O,p.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(p){this._checkLoaded();var g=p.source,S=p.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||S)return p.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(S,p.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},v.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(p){for(var g=this,S=function(Ur){return g._layers[Ur].type==="fill-extrusion"},C={},R=[],O=this._order.length-1;O>=0;O--){var j=this._order[O];if(S(j)){C[j]=O;for(var $=0,pe=p;$<pe.length;$+=1){var _e=pe[$][j];if(_e)for(var xe=0,Ue=_e;xe<Ue.length;xe+=1)R.push(Ue[xe])}}}R.sort(function(Ur,Fr){return Fr.intersectionZ-Ur.intersectionZ});for(var Be=[],Qe=this._order.length-1;Qe>=0;Qe--){var Ie=this._order[Qe];if(S(Ie))for(var qe=R.length-1;qe>=0;qe--){var ft=R[qe].feature;if(C[ft.layer.id]<Qe)break;Be.push(ft),R.pop()}else for(var Rt=0,$t=p;Rt<$t.length;Rt+=1){var jt=$t[Rt][Ie];if(jt)for(var ir=0,pr=jt;ir<pr.length;ir+=1)Be.push(pr[ir].feature)}}return Be},v.prototype.queryRenderedFeatures=function(p,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,O=g.layers;R<O.length;R+=1){var j=O[R],$=this._layers[j];if(!$)return this.fire(new y.ErrorEvent(new Error("The layer '"+j+"' does not exist in the map's style and cannot be queried for features."))),[];C[$.source]=!0}}var pe=[];for(var _e in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[_e]||pe.push(Or(this.sourceCaches[_e],this._layers,this._serializedLayers,p,g,S));return this.placement&&pe.push(function(xe,Ue,Be,Qe,Ie,qe,ft){for(var Rt={},$t=qe.queryRenderedSymbols(Qe),jt=[],ir=0,pr=Object.keys($t).map(Number);ir<pr.length;ir+=1)jt.push(ft[pr[ir]]);jt.sort(Kn);for(var Ur=function(){var Zn=ln[Fr],Zi=Zn.featureIndex.lookupSymbolFeatures($t[Zn.bucketInstanceId],Ue,Zn.bucketIndex,Zn.sourceLayerIndex,Ie.filter,Ie.layers,Ie.availableImages,xe);for(var mn in Zi){var oi=Rt[mn]=Rt[mn]||[],vi=Zi[mn];vi.sort(function(pi,ri){var $n=Zn.featureSortOrder;if($n){var bo=$n.indexOf(pi.featureIndex);return $n.indexOf(ri.featureIndex)-bo}return ri.featureIndex-pi.featureIndex});for(var ai=0,ti=vi;ai<ti.length;ai+=1)oi.push(ti[ai])}},Fr=0,ln=jt;Fr<ln.length;Fr+=1)Ur();var Un=function(Zn){Rt[Zn].forEach(function(Zi){var mn=Zi.feature,oi=Be[xe[Zn].source].getFeatureState(mn.layer["source-layer"],mn.id);mn.source=mn.layer.source,mn.layer["source-layer"]&&(mn.sourceLayer=mn.layer["source-layer"]),mn.state=oi})};for(var Bn in Rt)Un(Bn);return Rt}(this._layers,this._serializedLayers,this.sourceCaches,p,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(pe)},v.prototype.querySourceFeatures=function(p,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[p];return S?function(C,R){for(var O=C.getRenderableIds().map(function(Ue){return C.getTileByID(Ue)}),j=[],$={},pe=0;pe<O.length;pe++){var _e=O[pe],xe=_e.tileID.canonical.key;$[xe]||($[xe]=!0,_e.querySourceFeatures(j,R))}return j}(S,g):[]},v.prototype.addSourceType=function(p,g,S){return v.getSourceType(p)?S(new Error('A source type called "'+p+'" already exists.')):(v.setSourceType(p,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(p,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),C=!1;for(var R in p)if(!y.deepEqual(p[R],S[R])){C=!0;break}if(C){var O={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,g),this.light.updateTransitions(O)}},v.prototype._validate=function(p,g,S,C,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Fu(this,p.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},C)))},v.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},v.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},v.prototype._updateSources=function(p){for(var g in this.sourceCaches)this.sourceCaches[g].update(p)},v.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},v.prototype._updatePlacement=function(p,g,S,C,R){R===void 0&&(R=!1);for(var O=!1,j=!1,$={},pe=0,_e=this._order;pe<_e.length;pe+=1){var xe=this._layers[_e[pe]];if(xe.type==="symbol"){if(!$[xe.source]){var Ue=this.sourceCaches[xe.source];$[xe.source]=Ue.getRenderableIds(!0).map(function(ft){return Ue.getTileByID(ft)}).sort(function(ft,Rt){return Rt.tileID.overscaledZ-ft.tileID.overscaledZ||(ft.tileID.isLessThan(Rt.tileID)?-1:1)})}var Be=this.crossTileSymbolIndex.addLayer(xe,$[xe.source],p.center.lng);O=O||Be}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),p.zoom))&&(this.pauseablePlacement=new Uc(p,this._order,R,g,S,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),j=!0),O&&this.pauseablePlacement.placement.setStale()),j||O)for(var Qe=0,Ie=this._order;Qe<Ie.length;Qe+=1){var qe=this._layers[Ie[Qe]];qe.type==="symbol"&&this.placement.updateLayerOpacities(qe,$[qe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},v.prototype.getImages=function(p,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(p,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(p,g,S){return y.makeRequest(g,S)},v}(y.Evented);Rs.getSourceType=function(h){return or[h]},Rs.setSourceType=function(h,v){or[h]=v},Rs.registerForPluginStateChange=y.registerForPluginStateChange;var Za=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),bl=Fn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ku=Fn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gf=Fn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),zh=Fn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),_f=Fn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rh=Fn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),nh=Fn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ih=Fn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Zh=Fn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Vh=Fn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Bp=Fn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Zc=Fn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Bu=Fn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),jh=Fn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Wo=Fn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),zl=Fn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),El=Fn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),js=Fn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Sl=Fn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),au=Fn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),di=Fn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Hs=Fn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Lu=Fn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Qu=Fn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ah=Fn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Hh=Fn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Fn(h,v){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=C?C.concat(S):S,O={};return{fragmentSource:h=h.replace(p,function(j,$,pe,_e,xe){return O[xe]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+pe+" "+_e+" "+xe+`;
#else
uniform `+pe+" "+_e+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+pe+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:v=v.replace(p,function(j,$,pe,_e,xe){var Ue=_e==="float"?"vec2":"vec4",Be=xe.match(/color/)?"color":Ue;return O[xe]?$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+pe+" "+Ue+" a_"+xe+`;
varying `+pe+" "+_e+" "+xe+`;
#else
uniform `+pe+" "+_e+" u_"+xe+`;
#endif
`:Be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+pe+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Be+"(a_"+xe+", u_"+xe+`_t);
#else
    `+pe+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+pe+" "+Ue+" a_"+xe+`;
#else
uniform `+pe+" "+_e+" u_"+xe+`;
#endif
`:Be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+pe+" "+_e+" "+xe+" = a_"+xe+`;
#else
    `+pe+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+pe+" "+_e+" "+xe+" = unpack_mix_"+Be+"(a_"+xe+", u_"+xe+`_t);
#else
    `+pe+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var Ws=Object.freeze({__proto__:null,prelude:bl,background:Ku,backgroundPattern:gf,circle:zh,clippingMask:_f,heatmap:rh,heatmapTexture:nh,collisionBox:ih,collisionCircle:Zh,debug:Vh,fill:Bp,fillOutline:Zc,fillOutlinePattern:Bu,fillPattern:jh,fillExtrusion:Wo,fillExtrusionPattern:zl,hillshadePrepare:El,hillshade:js,line:Sl,lineGradient:au,linePattern:di,lineSDF:Hs,raster:Lu,symbolIcon:Qu,symbolSDF:ah,symbolTextAndIcon:Hh}),Ms=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ju(h){for(var v=[],p=0;p<h.length;p++)if(h[p]!==null){var g=h[p].split(" ");v.push(g.pop())}return v}Ms.prototype.bind=function(h,v,p,g,S,C,R,O){this.context=h;for(var j=this.boundPaintVertexBuffers.length!==g.length,$=0;!j&&$<g.length;$++)this.boundPaintVertexBuffers[$]!==g[$]&&(j=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===p&&!j&&this.boundIndexBuffer===S&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===O?(h.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),O&&O.bind()):this.freshBind(v,p,g,S,C,R,O)},Ms.prototype.freshBind=function(h,v,p,g,S,C,R){var O,j=h.numAttributes,$=this.context,pe=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R;else{O=$.currentNumAttributes||0;for(var _e=j;_e<O;_e++)pe.disableVertexAttribArray(_e)}v.enableAttributes(pe,h);for(var xe=0,Ue=p;xe<Ue.length;xe+=1)Ue[xe].enableAttributes(pe,h);C&&C.enableAttributes(pe,h),R&&R.enableAttributes(pe,h),v.bind(),v.setVertexAttribPointers(pe,h,S);for(var Be=0,Qe=p;Be<Qe.length;Be+=1){var Ie=Qe[Be];Ie.bind(),Ie.setVertexAttribPointers(pe,h,S)}C&&(C.bind(),C.setVertexAttribPointers(pe,h,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(pe,h,S)),$.currentNumAttributes=j},Ms.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Va=function(h,v,p,g,S,C){var R=h.gl;this.program=R.createProgram();for(var O=Ju(p.staticAttributes),j=g?g.getBinderAttributes():[],$=O.concat(j),pe=p.staticUniforms?Ju(p.staticUniforms):[],_e=g?g.getBinderUniforms():[],xe=[],Ue=0,Be=pe.concat(_e);Ue<Be.length;Ue+=1){var Qe=Be[Ue];xe.indexOf(Qe)<0&&xe.push(Qe)}var Ie=g?g.defines():[];C&&Ie.push("#define OVERDRAW_INSPECTOR;");var qe=Ie.concat(bl.fragmentSource,p.fragmentSource).join(`
`),ft=Ie.concat(bl.vertexSource,p.vertexSource).join(`
`),Rt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Rt,qe),R.compileShader(Rt),R.attachShader(this.program,Rt);var $t=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource($t,ft),R.compileShader($t),R.attachShader(this.program,$t),this.attributes={};var jt={};this.numAttributes=$.length;for(var ir=0;ir<this.numAttributes;ir++)$[ir]&&(R.bindAttribLocation(this.program,ir,$[ir]),this.attributes[$[ir]]=ir);R.linkProgram(this.program),R.deleteShader($t),R.deleteShader(Rt);for(var pr=0;pr<xe.length;pr++){var Ur=xe[pr];if(Ur&&!jt[Ur]){var Fr=R.getUniformLocation(this.program,Ur);Fr&&(jt[Ur]=Fr)}}this.fixedUniforms=S(h,jt),this.binderUniforms=g?g.getUniforms(h,jt):[]}}};function yf(h,v,p){var g=1/na(p,1,v.transform.tileZoom),S=Math.pow(2,p.tileID.overscaledZ),C=p.tileSize*Math.pow(2,v.transform.tileZoom)/S,R=C*(p.tileID.canonical.x+p.tileID.wrap*S),O=C*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[R>>16,O>>16],u_pixel_coord_lower:[65535&R,65535&O]}}Va.prototype.draw=function(h,v,p,g,S,C,R,O,j,$,pe,_e,xe,Ue,Be,Qe){var Ie,qe=h.gl;if(!this.failedToCreate){for(var ft in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(C),this.fixedUniforms)this.fixedUniforms[ft].set(R[ft]);Ue&&Ue.setUniforms(h,this.binderUniforms,_e,{zoom:xe});for(var Rt=(Ie={},Ie[qe.LINES]=2,Ie[qe.TRIANGLES]=3,Ie[qe.LINE_STRIP]=1,Ie)[v],$t=0,jt=pe.get();$t<jt.length;$t+=1){var ir=jt[$t],pr=ir.vaos||(ir.vaos={});(pr[O]||(pr[O]=new Ms)).bind(h,this,j,Ue?Ue.getPaintVertexBuffers():[],$,ir.vertexOffset,Be,Qe),qe.drawElements(v,ir.primitiveLength*Rt,qe.UNSIGNED_SHORT,ir.primitiveOffset*Rt*2)}}};var xf=function(h,v,p,g){var S=v.style.light,C=S.properties.get("position"),R=[C.x,C.y,C.z],O=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(O,-v.transform.angle),y.transformMat3(R,R,O);var j=S.properties.get("color");return{u_matrix:h,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+p,u_opacity:g}},Is=function(h,v,p,g,S,C,R){return y.extend(xf(h,v,p,g),yf(C,v,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},el=function(h){return{u_matrix:h}},mu=function(h,v,p,g){return y.extend(el(h),yf(p,v,g))},Al=function(h,v){return{u_matrix:h,u_world:v}},oh=function(h,v,p,g,S){return y.extend(mu(h,v,p,g),{u_world:S})},hc=function(h,v,p,g){var S,C,R=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var O=na(p,1,R.zoom);S=!0,C=[O,O]}else S=!1,C=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,p,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:C}},la=function(h,v,p){var g=na(p,1,v.zoom),S=Math.pow(2,v.zoom-p.tileID.overscaledZ),C=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:C}},pc=function(h,v,p){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:p.cameraToCenterDistance,u_viewport_size:[p.width,p.height]}},tl=function(h,v,p){return p===void 0&&(p=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:p}},Tl=function(h){return{u_matrix:h}},sh=function(h,v,p,g){return{u_matrix:h,u_extrude_scale:na(v,1,p),u_intensity:g}},Vc=function(h,v,p){var g=h.transform;return{u_matrix:jc(h,v,p),u_ratio:1/na(v,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ca=function(h,v,p,g){return y.extend(Vc(h,v,p),{u_image:0,u_image_height:g})},wl=function(h,v,p,g){var S=h.transform,C=Ps(v,S);return{u_matrix:jc(h,v,p),u_texsize:v.imageAtlasTexture.size,u_ratio:1/na(v,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Wh=function(h,v,p,g,S){var C=h.lineAtlas,R=Ps(v,h.transform),O=p.layout.get("line-cap")==="round",j=C.getDash(g.from,O),$=C.getDash(g.to,O),pe=j.width*S.fromScale,_e=$.width*S.toScale;return y.extend(Vc(h,v,p),{u_patternscale_a:[R/pe,-j.height/2],u_patternscale_b:[R/_e,-$.height/2],u_sdfgamma:C.width/(256*Math.min(pe,_e)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:$.y,u_mix:S.t})};function Ps(h,v){return 1/na(h,1,v.tileZoom)}function jc(h,v,p){return h.translatePosMatrix(v.tileID.posMatrix,v,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var Hc=function(h,v,p,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:p,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(C=S.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:bf(S.paint.get("raster-hue-rotate"))};var C,R};function bf(h){h*=Math.PI/180;var v=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*v-p+1)/3,(Math.sqrt(3)*v-p+1)/3]}var rl,Zl=function(h,v,p,g,S,C,R,O,j,$){var pe=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_pitch:pe.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:pe.width/pe.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:R,u_coord_matrix:O,u_is_text:+j,u_pitch_with_map:+g,u_texsize:$,u_texture:0}},Nu=function(h,v,p,g,S,C,R,O,j,$,pe){var _e=S.transform;return y.extend(Zl(h,v,p,g,S,C,R,O,j,$),{u_gamma_scale:g?Math.cos(_e._pitch)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+pe})},Wc=function(h,v,p,g,S,C,R,O,j,$){return y.extend(Nu(h,v,p,g,S,C,R,O,!0,j,!0),{u_texsize_icon:$,u_texture_icon:1})},dc=function(h,v,p){return{u_matrix:h,u_opacity:v,u_color:p}},Vl=function(h,v,p,g,S,C){return y.extend(function(R,O,j,$){var pe=j.imageManager.getPattern(R.from.toString()),_e=j.imageManager.getPattern(R.to.toString()),xe=j.imageManager.getPixelSize(),Ue=xe.width,Be=xe.height,Qe=Math.pow(2,$.tileID.overscaledZ),Ie=$.tileSize*Math.pow(2,j.transform.tileZoom)/Qe,qe=Ie*($.tileID.canonical.x+$.tileID.wrap*Qe),ft=Ie*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:pe.tl,u_pattern_br_a:pe.br,u_pattern_tl_b:_e.tl,u_pattern_br_b:_e.br,u_texsize:[Ue,Be],u_mix:O.t,u_pattern_size_a:pe.displaySize,u_pattern_size_b:_e.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/na($,1,j.transform.tileZoom),u_pixel_coord_upper:[qe>>16,ft>>16],u_pixel_coord_lower:[65535&qe,65535&ft]}}(g,C,p,S),{u_matrix:h,u_opacity:v})},Ef={fillExtrusion:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_lightpos:new y.Uniform3f(h,v.u_lightpos),u_lightintensity:new y.Uniform1f(h,v.u_lightintensity),u_lightcolor:new y.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new y.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new y.Uniform1f(h,v.u_height_factor),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade),u_opacity:new y.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_texsize:new y.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new y.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new y.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new y.UniformColor(h,v.u_color),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_overlay:new y.Uniform1i(h,v.u_overlay),u_overlay_scale:new y.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new y.Uniform1f(h,v.u_extrude_scale),u_intensity:new y.Uniform1f(h,v.u_intensity),u_matrix:new y.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_world:new y.Uniform2f(h,v.u_world),u_image:new y.Uniform1i(h,v.u_image),u_color_ramp:new y.Uniform1i(h,v.u_color_ramp),u_opacity:new y.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_latrange:new y.Uniform2f(h,v.u_latrange),u_light:new y.Uniform2f(h,v.u_light),u_shadow:new y.UniformColor(h,v.u_shadow),u_highlight:new y.UniformColor(h,v.u_highlight),u_accent:new y.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_image:new y.Uniform1i(h,v.u_image),u_dimension:new y.Uniform2f(h,v.u_dimension),u_zoom:new y.Uniform1f(h,v.u_zoom),u_unpack:new y.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_image:new y.Uniform1i(h,v.u_image),u_image_height:new y.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_texsize:new y.Uniform2f(h,v.u_texsize),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_image:new y.Uniform1i(h,v.u_image),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_scale:new y.Uniform3f(h,v.u_scale),u_fade:new y.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_ratio:new y.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new y.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new y.Uniform1f(h,v.u_sdfgamma),u_image:new y.Uniform1i(h,v.u_image),u_tex_y_a:new y.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new y.Uniform1f(h,v.u_tex_y_b),u_mix:new y.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new y.Uniform2f(h,v.u_tl_parent),u_scale_parent:new y.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new y.Uniform1f(h,v.u_buffer_scale),u_fade_t:new y.Uniform1f(h,v.u_fade_t),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image0:new y.Uniform1i(h,v.u_image0),u_image1:new y.Uniform1i(h,v.u_image1),u_brightness_low:new y.Uniform1f(h,v.u_brightness_low),u_brightness_high:new y.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new y.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new y.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new y.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texture:new y.Uniform1i(h,v.u_texture),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new y.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new y.Uniform1f(h,v.u_size_t),u_size:new y.Uniform1f(h,v.u_size),u_camera_to_center_distance:new y.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new y.Uniform1f(h,v.u_pitch),u_rotate_symbol:new y.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new y.Uniform1f(h,v.u_fade_change),u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new y.Uniform1i(h,v.u_is_text),u_pitch_with_map:new y.Uniform1i(h,v.u_pitch_with_map),u_texsize:new y.Uniform2f(h,v.u_texsize),u_texsize_icon:new y.Uniform2f(h,v.u_texsize_icon),u_texture:new y.Uniform1i(h,v.u_texture),u_texture_icon:new y.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new y.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_color:new y.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new y.UniformMatrix4f(h,v.u_matrix),u_opacity:new y.Uniform1f(h,v.u_opacity),u_image:new y.Uniform1i(h,v.u_image),u_pattern_tl_a:new y.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(h,v.u_pattern_br_b),u_texsize:new y.Uniform2f(h,v.u_texsize),u_mix:new y.Uniform1f(h,v.u_mix),u_pattern_size_a:new y.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new y.Uniform1f(h,v.u_scale_a),u_scale_b:new y.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(h,v.u_tile_units_to_pixels)}}};function vc(h,v,p,g,S,C,R){for(var O=h.context,j=O.gl,$=h.useProgram("collisionBox"),pe=[],_e=0,xe=0,Ue=0;Ue<g.length;Ue++){var Be=g[Ue],Qe=v.getTile(Be),Ie=Qe.getBucket(p);if(Ie){var qe=Be.posMatrix;S[0]===0&&S[1]===0||(qe=h.translatePosMatrix(Be.posMatrix,Qe,S,C));var ft=R?Ie.textCollisionBox:Ie.iconCollisionBox,Rt=Ie.collisionCircleArray;if(Rt.length>0){var $t=y.create(),jt=qe;y.mul($t,Ie.placementInvProjMatrix,h.transform.glCoordMatrix),y.mul($t,$t,Ie.placementViewportMatrix),pe.push({circleArray:Rt,circleOffset:xe,transform:jt,invTransform:$t}),xe=_e+=Rt.length/4}ft&&$.draw(O,j.LINES,be.disabled,ke.disabled,h.colorModeForRenderPass(),ct.disabled,la(qe,h.transform,Qe),p.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,null,h.transform.zoom,null,null,ft.collisionVertexBuffer)}}if(R&&pe.length){var ir=h.useProgram("collisionCircle"),pr=new y.StructArrayLayout2f1f2i16;pr.resize(4*_e),pr._trim();for(var Ur=0,Fr=0,ln=pe;Fr<ln.length;Fr+=1)for(var Un=ln[Fr],Bn=0;Bn<Un.circleArray.length/4;Bn++){var Zn=4*Bn,Zi=Un.circleArray[Zn+0],mn=Un.circleArray[Zn+1],oi=Un.circleArray[Zn+2],vi=Un.circleArray[Zn+3];pr.emplace(Ur++,Zi,mn,oi,vi,0),pr.emplace(Ur++,Zi,mn,oi,vi,1),pr.emplace(Ur++,Zi,mn,oi,vi,2),pr.emplace(Ur++,Zi,mn,oi,vi,3)}(!rl||rl.length<2*_e)&&(rl=function(ja){var Eo=2*ja,lo=new y.StructArrayLayout3ui6;lo.resize(Eo),lo._trim();for(var Ba=0;Ba<Eo;Ba++){var Ha=6*Ba;lo.uint16[Ha+0]=4*Ba+0,lo.uint16[Ha+1]=4*Ba+1,lo.uint16[Ha+2]=4*Ba+2,lo.uint16[Ha+3]=4*Ba+2,lo.uint16[Ha+4]=4*Ba+3,lo.uint16[Ha+5]=4*Ba+0}return lo}(_e));for(var ai=O.createIndexBuffer(rl,!0),ti=O.createVertexBuffer(pr,y.collisionCircleLayout.members,!0),pi=0,ri=pe;pi<ri.length;pi+=1){var $n=ri[pi],bo=pc($n.transform,$n.invTransform,h.transform);ir.draw(O,j.TRIANGLES,be.disabled,ke.disabled,h.colorModeForRenderPass(),ct.disabled,bo,p.id,ti,ai,y.SegmentVector.simpleSegment(0,2*$n.circleOffset,$n.circleArray.length,$n.circleArray.length/2),null,h.transform.zoom,null,null,null)}ti.destroy(),ai.destroy()}}var Os=y.identity(new Float32Array(16));function uh(h,v,p,g,S,C){var R=y.getAnchorAlignment(h),O=-(R.horizontalAlign-.5)*v,j=-(R.verticalAlign-.5)*p,$=y.evaluateVariableOffset(h,g);return new y.Point((O/S+$[0])*C,(j/S+$[1])*C)}function Gc(h,v,p,g,S,C,R,O,j,$,pe){var _e=h.text.placedSymbolArray,xe=h.text.dynamicLayoutVertexArray,Ue=h.icon.dynamicLayoutVertexArray,Be={};xe.clear();for(var Qe=0;Qe<_e.length;Qe++){var Ie=_e.get(Qe),qe=Ie.hidden||!Ie.crossTileID||h.allowVerticalPlacement&&!Ie.placedOrientation?null:g[Ie.crossTileID];if(qe){var ft=new y.Point(Ie.anchorX,Ie.anchorY),Rt=yi(ft,p?O:R),$t=Ai(C.cameraToCenterDistance,Rt.signedDistanceFromCamera),jt=S.evaluateSizeForFeature(h.textSizeData,$,Ie)*$t/y.ONE_EM;p&&(jt*=h.tilePixelRatio/j);for(var ir=uh(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale,jt),pr=p?yi(ft.add(ir),R).point:Rt.point.add(v?ir.rotate(-C.angle):ir),Ur=h.allowVerticalPlacement&&Ie.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Fr=0;Fr<Ie.numGlyphs;Fr++)y.addDynamicAttributes(xe,pr,Ur);pe&&Ie.associatedIconIndex>=0&&(Be[Ie.associatedIconIndex]={shiftedAnchor:pr,angle:Ur})}else ii(Ie.numGlyphs,xe)}if(pe){Ue.clear();for(var ln=h.icon.placedSymbolArray,Un=0;Un<ln.length;Un++){var Bn=ln.get(Un);if(Bn.hidden)ii(Bn.numGlyphs,Ue);else{var Zn=Be[Un];if(Zn)for(var Zi=0;Zi<Bn.numGlyphs;Zi++)y.addDynamicAttributes(Ue,Zn.shiftedAnchor,Zn.angle);else ii(Bn.numGlyphs,Ue)}}h.icon.dynamicLayoutVertexBuffer.updateData(Ue)}h.text.dynamicLayoutVertexBuffer.updateData(xe)}function mc(h,v,p){return p.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Cl(h,v,p,g,S,C,R,O,j,$,pe,_e){for(var xe=h.context,Ue=xe.gl,Be=h.transform,Qe=O==="map",Ie=j==="map",qe=Qe&&p.layout.get("symbol-placement")!=="point",ft=Qe&&!Ie&&!qe,Rt=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,$t=!1,jt=h.depthModeForSublayer(0,be.ReadOnly),ir=p.layout.get("text-variable-anchor"),pr=[],Ur=0,Fr=g;Ur<Fr.length;Ur+=1){var ln=Fr[Ur],Un=v.getTile(ln),Bn=Un.getBucket(p);if(Bn){var Zn=S?Bn.text:Bn.icon;if(Zn&&Zn.segments.get().length){var Zi=Zn.programConfigurations.get(p.id),mn=S||Bn.sdfIcons,oi=S?Bn.textSizeData:Bn.iconSizeData,vi=Ie||Be.pitch!==0,ai=h.useProgram(mc(mn,S,Bn),Zi),ti=y.evaluateSizeForZoom(oi,Be.zoom),pi=void 0,ri=[0,0],$n=void 0,bo=void 0,ja=null,Eo=void 0;if(S)$n=Un.glyphAtlasTexture,bo=Ue.LINEAR,pi=Un.glyphAtlasTexture.size,Bn.iconsInText&&(ri=Un.imageAtlasTexture.size,ja=Un.imageAtlasTexture,Eo=vi||h.options.rotating||h.options.zooming||oi.kind==="composite"||oi.kind==="camera"?Ue.LINEAR:Ue.NEAREST);else{var lo=p.layout.get("icon-size").constantOr(0)!==1||Bn.iconsNeedLinear;$n=Un.imageAtlasTexture,bo=mn||h.options.rotating||h.options.zooming||lo||vi?Ue.LINEAR:Ue.NEAREST,pi=Un.imageAtlasTexture.size}var Ba=na(Un,1,h.transform.zoom),Ha=Sa(ln.posMatrix,Ie,Qe,h.transform,Ba),cs=Mi(ln.posMatrix,Ie,Qe,h.transform,Ba),fs=ir&&Bn.hasTextData(),sl=p.layout.get("icon-text-fit")!=="none"&&fs&&Bn.hasIconData();qe&&Vs(Bn,ln.posMatrix,h,S,Ha,cs,Ie,$);var hs=h.translatePosMatrix(ln.posMatrix,Un,C,R),lu=qe||S&&ir||sl?Os:Ha,Bs=h.translatePosMatrix(cs,Un,C,R,!0),Ec=mn&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Vu={program:ai,buffers:Zn,uniformValues:mn?Bn.iconsInText?Wc(oi.kind,ti,ft,Ie,h,hs,lu,Bs,pi,ri):Nu(oi.kind,ti,ft,Ie,h,hs,lu,Bs,S,pi,!0):Zl(oi.kind,ti,ft,Ie,h,hs,lu,Bs,S,pi),atlasTexture:$n,atlasTextureIcon:ja,atlasInterpolation:bo,atlasInterpolationIcon:Eo,isSDF:mn,hasHalo:Ec};if(Rt&&Bn.canOverlap){$t=!0;for(var Au=0,ql=Zn.segments.get();Au<ql.length;Au+=1){var ul=ql[Au];pr.push({segments:new y.SegmentVector([ul]),sortKey:ul.sortKey,state:Vu})}}else pr.push({segments:Zn.segments,sortKey:0,state:Vu})}}}$t&&pr.sort(function(fu,Tu){return fu.sortKey-Tu.sortKey});for(var cu=0,ll=pr;cu<ll.length;cu+=1){var So=ll[cu],Qa=So.state;if(xe.activeTexture.set(Ue.TEXTURE0),Qa.atlasTexture.bind(Qa.atlasInterpolation,Ue.CLAMP_TO_EDGE),Qa.atlasTextureIcon&&(xe.activeTexture.set(Ue.TEXTURE1),Qa.atlasTextureIcon&&Qa.atlasTextureIcon.bind(Qa.atlasInterpolationIcon,Ue.CLAMP_TO_EDGE)),Qa.isSDF){var ys=Qa.uniformValues;Qa.hasHalo&&(ys.u_is_halo=1,Uu(Qa.buffers,So.segments,p,h,Qa.program,jt,pe,_e,ys)),ys.u_is_halo=0}Uu(Qa.buffers,So.segments,p,h,Qa.program,jt,pe,_e,Qa.uniformValues)}}function Uu(h,v,p,g,S,C,R,O,j){var $=g.context;S.draw($,$.gl.TRIANGLES,C,R,O,ct.disabled,j,p.id,h.layoutVertexBuffer,h.indexBuffer,v,p.paint,g.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function jl(h,v,p,g,S,C,R){var O,j,$,pe,_e,xe=h.context.gl,Ue=p.paint.get("fill-pattern"),Be=Ue&&Ue.constantOr(1),Qe=p.getCrossfadeParameters();R?(j=Be&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=xe.LINES):(j=Be?"fillPattern":"fill",O=xe.TRIANGLES);for(var Ie=0,qe=g;Ie<qe.length;Ie+=1){var ft=qe[Ie],Rt=v.getTile(ft);if(!Be||Rt.patternsLoaded()){var $t=Rt.getBucket(p);if($t){var jt=$t.programConfigurations.get(p.id),ir=h.useProgram(j,jt);Be&&(h.context.activeTexture.set(xe.TEXTURE0),Rt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),jt.updatePaintBuffers(Qe));var pr=Ue.constantOr(null);if(pr&&Rt.imageAtlas){var Ur=Rt.imageAtlas,Fr=Ur.patternPositions[pr.to.toString()],ln=Ur.patternPositions[pr.from.toString()];Fr&&ln&&jt.setConstantPatternPositions(Fr,ln)}var Un=h.translatePosMatrix(ft.posMatrix,Rt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(R){pe=$t.indexBuffer2,_e=$t.segments2;var Bn=[xe.drawingBufferWidth,xe.drawingBufferHeight];$=j==="fillOutlinePattern"&&Be?oh(Un,h,Qe,Rt,Bn):Al(Un,Bn)}else pe=$t.indexBuffer,_e=$t.segments,$=Be?mu(Un,h,Qe,Rt):el(Un);ir.draw(h.context,O,S,h.stencilModeForClipping(ft),C,ct.disabled,$,p.id,$t.layoutVertexBuffer,pe,_e,p.paint,h.transform.zoom,jt)}}}}function Sf(h,v,p,g,S,C,R){for(var O=h.context,j=O.gl,$=p.paint.get("fill-extrusion-pattern"),pe=$.constantOr(1),_e=p.getCrossfadeParameters(),xe=p.paint.get("fill-extrusion-opacity"),Ue=0,Be=g;Ue<Be.length;Ue+=1){var Qe=Be[Ue],Ie=v.getTile(Qe),qe=Ie.getBucket(p);if(qe){var ft=qe.programConfigurations.get(p.id),Rt=h.useProgram(pe?"fillExtrusionPattern":"fillExtrusion",ft);pe&&(h.context.activeTexture.set(j.TEXTURE0),Ie.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ft.updatePaintBuffers(_e));var $t=$.constantOr(null);if($t&&Ie.imageAtlas){var jt=Ie.imageAtlas,ir=jt.patternPositions[$t.to.toString()],pr=jt.patternPositions[$t.from.toString()];ir&&pr&&ft.setConstantPatternPositions(ir,pr)}var Ur=h.translatePosMatrix(Qe.posMatrix,Ie,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Fr=p.paint.get("fill-extrusion-vertical-gradient"),ln=pe?Is(Ur,h,Fr,xe,Qe,_e,Ie):xf(Ur,h,Fr,xe);Rt.draw(O,O.gl.TRIANGLES,S,C,R,ct.backCCW,ln,p.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,p.paint,h.transform.zoom,ft)}}}function nl(h,v,p,g,S,C){var R=h.context,O=R.gl,j=v.fbo;if(j){var $=h.useProgram("hillshade");R.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,j.colorAttachment.get());var pe=function(_e,xe,Ue){var Be=Ue.paint.get("hillshade-shadow-color"),Qe=Ue.paint.get("hillshade-highlight-color"),Ie=Ue.paint.get("hillshade-accent-color"),qe=Ue.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ue.paint.get("hillshade-illumination-anchor")==="viewport"&&(qe-=_e.transform.angle);var ft,Rt,$t,jt=!_e.options.moving;return{u_matrix:_e.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),jt),u_image:0,u_latrange:(ft=xe.tileID,Rt=Math.pow(2,ft.canonical.z),$t=ft.canonical.y,[new y.MercatorCoordinate(0,$t/Rt).toLngLat().lat,new y.MercatorCoordinate(0,($t+1)/Rt).toLngLat().lat]),u_light:[Ue.paint.get("hillshade-exaggeration"),qe],u_shadow:Be,u_highlight:Qe,u_accent:Ie}}(h,v,p);$.draw(R,O.TRIANGLES,g,S,C,ct.disabled,pe,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function lh(h,v,p,g,S,C){var R=h.context,O=R.gl,j=v.dem;if(j&&j.data){var $=j.dim,pe=j.stride,_e=j.getPixels();if(R.activeTexture.set(O.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(pe),v.demTexture){var xe=v.demTexture;xe.update(_e,{premultiply:!1}),xe.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else v.demTexture=new y.Texture(R,_e,O.RGBA,{premultiply:!1}),v.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);R.activeTexture.set(O.TEXTURE0);var Ue=v.fbo;if(!Ue){var Be=new y.Texture(R,{width:$,height:$,data:null},O.RGBA);Be.bind(O.LINEAR,O.CLAMP_TO_EDGE),(Ue=v.fbo=R.createFramebuffer($,$,!0)).colorAttachment.set(Be.texture)}R.bindFramebuffer.set(Ue.framebuffer),R.viewport.set([0,0,$,$]),h.useProgram("hillshadePrepare").draw(R,O.TRIANGLES,g,S,C,ct.disabled,function(Qe,Ie){var qe=Ie.stride,ft=y.create();return y.ortho(ft,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(ft,ft,[0,-y.EXTENT,0]),{u_matrix:ft,u_image:1,u_dimension:[qe,qe],u_zoom:Qe.overscaledZ,u_unpack:Ie.getUnpackVector()}}(v.tileID,j),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function ch(h,v,p,g,S){var C=g.paint.get("raster-fade-duration");if(C>0){var R=y.browser.now(),O=(R-h.timeAdded)/C,j=v?(R-v.timeAdded)/C:-1,$=p.getSource(),pe=S.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),_e=!v||Math.abs(v.tileID.overscaledZ-pe)>Math.abs(h.tileID.overscaledZ-pe),xe=_e&&h.refreshedUponExpiration?1:y.clamp(_e?O:1-j,0,1);return h.refreshedUponExpiration&&O>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var fh=new y.Color(1,0,0,1),Af=new y.Color(0,1,0,1),Gh=new y.Color(0,0,1,1),so=new y.Color(1,0,1,1),Xh=new y.Color(0,1,1,1);function Tf(h,v,p,g){Hl(h,0,v+p/2,h.transform.width,p,g)}function $h(h,v,p,g){Hl(h,v-p/2,0,p,h.transform.height,g)}function Hl(h,v,p,g,S,C){var R=h.context,O=R.gl;O.enable(O.SCISSOR_TEST),O.scissor(v*y.browser.devicePixelRatio,p*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:C}),O.disable(O.SCISSOR_TEST)}function Yh(h,v,p){var g=h.context,S=g.gl,C=p.posMatrix,R=h.useProgram("debug"),O=be.disabled,j=ke.disabled,$=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,O,j,$,ct.disabled,tl(C,y.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var pe=v.getTileByID(p.key).latestRawTileData,_e=Math.floor((pe&&pe.byteLength||0)/1024),xe=v.getTile(p).tileSize,Ue=512/Math.min(xe,512)*(p.overscaledZ/h.transform.zoom)*.5,Be=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Be+=" => "+p.overscaledZ),function(Qe,Ie){Qe.initDebugOverlayCanvas();var qe=Qe.debugOverlayCanvas,ft=Qe.context.gl,Rt=Qe.debugOverlayCanvas.getContext("2d");Rt.clearRect(0,0,qe.width,qe.height),Rt.shadowColor="white",Rt.shadowBlur=2,Rt.lineWidth=1.5,Rt.strokeStyle="white",Rt.textBaseline="top",Rt.font="bold 36px Open Sans, sans-serif",Rt.fillText(Ie,5,5),Rt.strokeText(Ie,5,5),Qe.debugOverlayTexture.update(qe),Qe.debugOverlayTexture.bind(ft.LINEAR,ft.CLAMP_TO_EDGE)}(h,Be+" "+_e+"kb"),R.draw(g,S.TRIANGLES,O,j,it.alphaBlended,ct.disabled,tl(C,y.Color.transparent,Ue),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var ou={symbol:function(h,v,p,g,S){if(h.renderPass==="translucent"){var C=ke.disabled,R=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(O,j,$,pe,_e,xe,Ue){for(var Be=j.transform,Qe=_e==="map",Ie=xe==="map",qe=0,ft=O;qe<ft.length;qe+=1){var Rt=ft[qe],$t=pe.getTile(Rt),jt=$t.getBucket($);if(jt&&jt.text&&jt.text.segments.get().length){var ir=y.evaluateSizeForZoom(jt.textSizeData,Be.zoom),pr=na($t,1,j.transform.zoom),Ur=Sa(Rt.posMatrix,Ie,Qe,j.transform,pr),Fr=$.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(ir){var ln=Math.pow(2,Be.zoom-$t.tileID.overscaledZ);Gc(jt,Qe,Ie,Ue,y.symbolSize,Be,Ur,Rt.posMatrix,ln,ir,Fr)}}}}(g,h,p,v,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&Cl(h,v,p,g,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),C,R),p.paint.get("text-opacity").constantOr(1)!==0&&Cl(h,v,p,g,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),C,R),v.map.showCollisionBoxes&&(vc(h,v,p,g,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),vc(h,v,p,g,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("circle-opacity"),C=p.paint.get("circle-stroke-width"),R=p.paint.get("circle-stroke-opacity"),O=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||C.constantOr(1)!==0&&R.constantOr(1)!==0){for(var j=h.context,$=j.gl,pe=h.depthModeForSublayer(0,be.ReadOnly),_e=ke.disabled,xe=h.colorModeForRenderPass(),Ue=[],Be=0;Be<g.length;Be++){var Qe=g[Be],Ie=v.getTile(Qe),qe=Ie.getBucket(p);if(qe){var ft=qe.programConfigurations.get(p.id),Rt={programConfiguration:ft,program:h.useProgram("circle",ft),layoutVertexBuffer:qe.layoutVertexBuffer,indexBuffer:qe.indexBuffer,uniformValues:hc(h,Qe,Ie,p)};if(O)for(var $t=0,jt=qe.segments.get();$t<jt.length;$t+=1){var ir=jt[$t];Ue.push({segments:new y.SegmentVector([ir]),sortKey:ir.sortKey,state:Rt})}else Ue.push({segments:qe.segments,sortKey:0,state:Rt})}}O&&Ue.sort(function(Un,Bn){return Un.sortKey-Bn.sortKey});for(var pr=0,Ur=Ue;pr<Ur.length;pr+=1){var Fr=Ur[pr],ln=Fr.state;ln.program.draw(j,$.TRIANGLES,pe,_e,xe,ct.disabled,ln.uniformValues,p.id,ln.layoutVertexBuffer,ln.indexBuffer,Fr.segments,p.paint,h.transform.zoom,ln.programConfiguration)}}}},heatmap:function(h,v,p,g){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,C=S.gl,R=ke.disabled,O=new it([C.ONE,C.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Ue,Be,Qe){var Ie=Ue.gl;Ue.activeTexture.set(Ie.TEXTURE1),Ue.viewport.set([0,0,Be.width/4,Be.height/4]);var qe=Qe.heatmapFbo;if(qe)Ie.bindTexture(Ie.TEXTURE_2D,qe.colorAttachment.get()),Ue.bindFramebuffer.set(qe.framebuffer);else{var ft=Ie.createTexture();Ie.bindTexture(Ie.TEXTURE_2D,ft),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MAG_FILTER,Ie.LINEAR),qe=Qe.heatmapFbo=Ue.createFramebuffer(Be.width/4,Be.height/4,!1),function(Rt,$t,jt,ir){var pr=Rt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,$t.width/4,$t.height/4,0,pr.RGBA,Rt.extRenderToTextureHalfFloat?Rt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),ir.colorAttachment.set(jt)}(Ue,Be,ft,qe)}})(S,h,p),S.clear({color:y.Color.transparent});for(var j=0;j<g.length;j++){var $=g[j];if(!v.hasRenderableParent($)){var pe=v.getTile($),_e=pe.getBucket(p);if(_e){var xe=_e.programConfigurations.get(p.id);h.useProgram("heatmap",xe).draw(S,C.TRIANGLES,be.disabled,R,O,ct.disabled,sh($.posMatrix,pe,h.transform.zoom,p.paint.get("heatmap-intensity")),p.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,p.paint,h.transform.zoom,xe)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(Ue,Be){var Qe=Ue.context,Ie=Qe.gl,qe=Be.heatmapFbo;if(qe){Qe.activeTexture.set(Ie.TEXTURE0),Ie.bindTexture(Ie.TEXTURE_2D,qe.colorAttachment.get()),Qe.activeTexture.set(Ie.TEXTURE1);var ft=Be.colorRampTexture;ft||(ft=Be.colorRampTexture=new y.Texture(Qe,Be.colorRamp,Ie.RGBA)),ft.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Ue.useProgram("heatmapTexture").draw(Qe,Ie.TRIANGLES,be.disabled,ke.disabled,Ue.colorModeForRenderPass(),ct.disabled,function(Rt,$t,jt,ir){var pr=y.create();y.ortho(pr,0,Rt.width,Rt.height,0,0,1);var Ur=Rt.context.gl;return{u_matrix:pr,u_world:[Ur.drawingBufferWidth,Ur.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$t.paint.get("heatmap-opacity")}}(Ue,Be),Be.id,Ue.viewportBuffer,Ue.quadTriangleIndexBuffer,Ue.viewportSegments,Be.paint,Ue.transform.zoom)}}(h,p))},line:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("line-opacity"),C=p.paint.get("line-width");if(S.constantOr(1)!==0&&C.constantOr(1)!==0)for(var R=h.depthModeForSublayer(0,be.ReadOnly),O=h.colorModeForRenderPass(),j=p.paint.get("line-dasharray"),$=p.paint.get("line-pattern"),pe=$.constantOr(1),_e=p.paint.get("line-gradient"),xe=p.getCrossfadeParameters(),Ue=pe?"linePattern":j?"lineSDF":_e?"lineGradient":"line",Be=h.context,Qe=Be.gl,Ie=!0,qe=0,ft=g;qe<ft.length;qe+=1){var Rt=ft[qe],$t=v.getTile(Rt);if(!pe||$t.patternsLoaded()){var jt=$t.getBucket(p);if(jt){var ir=jt.programConfigurations.get(p.id),pr=h.context.program.get(),Ur=h.useProgram(Ue,ir),Fr=Ie||Ur.program!==pr,ln=$.constantOr(null);if(ln&&$t.imageAtlas){var Un=$t.imageAtlas,Bn=Un.patternPositions[ln.to.toString()],Zn=Un.patternPositions[ln.from.toString()];Bn&&Zn&&ir.setConstantPatternPositions(Bn,Zn)}var Zi=pe?wl(h,$t,p,xe):j?Wh(h,$t,p,j,xe):_e?ca(h,$t,p,jt.lineClipsArray.length):Vc(h,$t,p);if(pe)Be.activeTexture.set(Qe.TEXTURE0),$t.imageAtlasTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE),ir.updatePaintBuffers(xe);else if(j&&(Fr||h.lineAtlas.dirty))Be.activeTexture.set(Qe.TEXTURE0),h.lineAtlas.bind(Be);else if(_e){var mn=jt.gradients[p.id],oi=mn.texture;if(p.gradientVersion!==mn.version){var vi=256;if(p.stepInterpolant){var ai=v.getSource().maxzoom,ti=Rt.canonical.z===ai?Math.ceil(1<<h.transform.maxZoom-Rt.canonical.z):1;vi=y.clamp(y.nextPowerOfTwo(jt.maxLineLength/y.EXTENT*1024*ti),256,Be.maxTextureSize)}mn.gradient=y.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:vi,image:mn.gradient||void 0,clips:jt.lineClipsArray}),mn.texture?mn.texture.update(mn.gradient):mn.texture=new y.Texture(Be,mn.gradient,Qe.RGBA),mn.version=p.gradientVersion,oi=mn.texture}Be.activeTexture.set(Qe.TEXTURE0),oi.bind(p.stepInterpolant?Qe.NEAREST:Qe.LINEAR,Qe.CLAMP_TO_EDGE)}Ur.draw(Be,Qe.TRIANGLES,R,h.stencilModeForClipping(Rt),O,ct.disabled,Zi,p.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,p.paint,h.transform.zoom,ir,jt.layoutVertexBuffer2),Ie=!1}}}}},fill:function(h,v,p,g){var S=p.paint.get("fill-color"),C=p.paint.get("fill-opacity");if(C.constantOr(1)!==0){var R=h.colorModeForRenderPass(),O=p.paint.get("fill-pattern"),j=h.opaquePassEnabledForLayer()&&!O.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===j){var $=h.depthModeForSublayer(1,h.renderPass==="opaque"?be.ReadWrite:be.ReadOnly);jl(h,v,p,g,$,R,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var pe=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,be.ReadOnly);jl(h,v,p,g,pe,R,!0)}}},"fill-extrusion":function(h,v,p,g){var S=p.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var C=new be(h.context.gl.LEQUAL,be.ReadWrite,h.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))Sf(h,v,p,g,C,ke.disabled,it.disabled),Sf(h,v,p,g,C,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var R=h.colorModeForRenderPass();Sf(h,v,p,g,C,ke.disabled,R)}}},hillshade:function(h,v,p,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,C=h.depthModeForSublayer(0,be.ReadOnly),R=h.colorModeForRenderPass(),O=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],j=O[0],$=0,pe=O[1];$<pe.length;$+=1){var _e=pe[$],xe=v.getTile(_e);xe.needsHillshadePrepare&&h.renderPass==="offscreen"?lh(h,xe,p,C,ke.disabled,R):h.renderPass==="translucent"&&nl(h,xe,p,C,j[_e.overscaledZ],R)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,p,g){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,C=S.gl,R=v.getSource(),O=h.useProgram("raster"),j=h.colorModeForRenderPass(),$=R instanceof bt?[{},g]:h.stencilConfigForOverlap(g),pe=$[0],_e=$[1],xe=_e[_e.length-1].overscaledZ,Ue=!h.options.moving,Be=0,Qe=_e;Be<Qe.length;Be+=1){var Ie=Qe[Be],qe=h.depthModeForSublayer(Ie.overscaledZ-xe,p.paint.get("raster-opacity")===1?be.ReadWrite:be.ReadOnly,C.LESS),ft=v.getTile(Ie),Rt=h.transform.calculatePosMatrix(Ie.toUnwrapped(),Ue);ft.registerFadeDuration(p.paint.get("raster-fade-duration"));var $t=v.findLoadedParent(Ie,0),jt=ch(ft,$t,v,p,h.transform),ir=void 0,pr=void 0,Ur=p.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;S.activeTexture.set(C.TEXTURE0),ft.texture.bind(Ur,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(C.TEXTURE1),$t?($t.texture.bind(Ur,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),ir=Math.pow(2,$t.tileID.overscaledZ-ft.tileID.overscaledZ),pr=[ft.tileID.canonical.x*ir%1,ft.tileID.canonical.y*ir%1]):ft.texture.bind(Ur,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Fr=Hc(Rt,pr||[0,0],ir||1,jt,p);R instanceof bt?O.draw(S,C.TRIANGLES,qe,ke.disabled,j,ct.disabled,Fr,p.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments):O.draw(S,C.TRIANGLES,qe,pe[Ie.overscaledZ],j,ct.disabled,Fr,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,p){var g=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S!==0){var C=h.context,R=C.gl,O=h.transform,j=O.tileSize,$=p.paint.get("background-pattern");if(!h.isPatternMissing($)){var pe=!$&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===pe){var _e=ke.disabled,xe=h.depthModeForSublayer(0,pe==="opaque"?be.ReadWrite:be.ReadOnly),Ue=h.colorModeForRenderPass(),Be=h.useProgram($?"backgroundPattern":"background"),Qe=O.coveringTiles({tileSize:j});$&&(C.activeTexture.set(R.TEXTURE0),h.imageManager.bind(h.context));for(var Ie=p.getCrossfadeParameters(),qe=0,ft=Qe;qe<ft.length;qe+=1){var Rt=ft[qe],$t=h.transform.calculatePosMatrix(Rt.toUnwrapped()),jt=$?Vl($t,S,h,$,{tileID:Rt,tileSize:j},Ie):dc($t,S,g);Be.draw(C,R.TRIANGLES,xe,_e,Ue,ct.disabled,jt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,p){for(var g=0;g<p.length;g++)Yh(h,v,p[g])},custom:function(h,v,p){var g=h.context,S=p.implementation;if(h.renderPass==="offscreen"){var C=S.prerender;C&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),C.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(ke.disabled);var R=S.renderingMode==="3d"?new be(h.context.gl.LEQUAL,be.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,be.ReadOnly);g.setDepthMode(R),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},fa=function(h,v){this.context=new me(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=Y.maxUnderzooming+Y.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xl,this.gpuTimers={}};fa.prototype.resize=function(h,v){if(this.width=h*y.browser.devicePixelRatio,this.height=v*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,g=this.style._order;p<g.length;p+=1)this.style._layers[g[p]].resize()},fa.prototype.setup=function(){var h=this.context,v=new y.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(y.EXTENT,0),v.emplaceBack(0,y.EXTENT),v.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,Za.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var p=new y.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=h.createVertexBuffer(p,Za.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,ht.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,Za.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(C);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(R),this.emptyTexture=new y.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var O=this.context.gl;this.stencilClearMode=new ke({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)},fa.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=y.create();y.ortho(p,0,this.width,this.height,0,0,1),y.scale(p,p,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,be.disabled,this.stencilClearMode,it.disabled,ct.disabled,Tl(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},fa.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var p=this.context,g=p.gl;this.nextStencilID+v.length>256&&this.clearStencil(),p.setColorMode(it.disabled),p.setDepthMode(be.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,R=v;C<R.length;C+=1){var O=R[C],j=this._tileClippingMaskIDs[O.key]=this.nextStencilID++;S.draw(p,g.TRIANGLES,be.disabled,new ke({func:g.ALWAYS,mask:0},j,255,g.KEEP,g.KEEP,g.REPLACE),it.disabled,ct.disabled,Tl(O.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},fa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new ke({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},fa.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new ke({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},fa.prototype.stencilConfigForOverlap=function(h){var v,p=this.context.gl,g=h.sort(function(j,$){return $.overscaledZ-j.overscaledZ}),S=g[g.length-1].overscaledZ,C=g[0].overscaledZ-S+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var R={},O=0;O<C;O++)R[O+S]=new ke({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=C,[R,g]}return[(v={},v[S]=ke.disabled,v),g]},fa.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new it([h.CONSTANT_COLOR,h.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?it.unblended:it.alphaBlended},fa.prototype.depthModeForSublayer=function(h,v,p){if(!this.opaquePassEnabledForLayer())return be.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new be(p||this.context.gl.LEQUAL,v,[g,g])},fa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},fa.prototype.render=function(h,v){var p=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var C in S){var R=S[C];R.used&&R.prepare(this.context)}var O,j,$={},pe={},_e={};for(var xe in S){var Ue=S[xe];$[xe]=Ue.getVisibleCoordinates(),pe[xe]=$[xe].slice().reverse(),_e[xe]=Ue.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Be=0;Be<g.length;Be++)if(this.style._layers[g[Be]].is3D()){this.opaquePassCutoff=Be;break}this.renderPass="offscreen";for(var Qe=0,Ie=g;Qe<Ie.length;Qe+=1){var qe=this.style._layers[Ie[Qe]];if(qe.hasOffscreenPass()&&!qe.isHidden(this.transform.zoom)){var ft=pe[qe.source];(qe.type==="custom"||ft.length)&&this.renderLayer(this,S[qe.source],qe,ft)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Rt=this.style._layers[g[this.currentLayer]],$t=S[Rt.source],jt=$[Rt.source];this._renderTileClippingMasks(Rt,jt),this.renderLayer(this,$t,Rt,jt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var ir=this.style._layers[g[this.currentLayer]],pr=S[ir.source],Ur=(ir.type==="symbol"?_e:pe)[ir.source];this._renderTileClippingMasks(ir,$[ir.source]),this.renderLayer(this,pr,ir,Ur)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Fr){Fr.source&&!Fr.isHidden(p.transform.zoom)&&(Fr.source!==(j&&j.id)&&(j=p.style.sourceCaches[Fr.source]),(!O||O.getSource().maxzoom<j.getSource().maxzoom)&&(O=j))}),O&&ou.debug(this,O,O.getVisibleCoordinates())),this.options.showPadding&&function(Fr){var ln=Fr.transform.padding;Tf(Fr,Fr.transform.height-(ln.top||0),3,fh),Tf(Fr,ln.bottom||0,3,Af),$h(Fr,ln.left||0,3,Gh),$h(Fr,Fr.transform.width-(ln.right||0),3,so);var Un=Fr.transform.centerPoint;(function(Bn,Zn,Zi,mn){Hl(Bn,Zn-1,Zi-10,2,20,mn),Hl(Bn,Zn-10,Zi-1,20,2,mn)})(Fr,Un.x,Fr.transform.height-Un.y,Xh)}(this),this.context.setDefault()},fa.prototype.renderLayer=function(h,v,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||g.length)&&(this.id=p.id,this.gpuTimingStart(p),ou[p.type](h,v,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},fa.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),p.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,p.query)}},fa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},fa.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},fa.prototype.queryGpuTimers=function(h){var v={};for(var p in h){var g=h[p],S=this.context.extTimerQuery,C=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[p]=C}return v},fa.prototype.translatePosMatrix=function(h,v,p,g,S){if(!p[0]&&!p[1])return h;var C=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var R=Math.sin(C),O=Math.cos(C);p=[p[0]*O-p[1]*R,p[0]*R+p[1]*O]}var j=[S?p[0]:na(v,p[0],this.transform.zoom),S?p[1]:na(v,p[1],this.transform.zoom),0],$=new Float32Array(16);return y.translate($,h,j),$},fa.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},fa.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},fa.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!v||!p},fa.prototype.useProgram=function(h,v){this.cache=this.cache||{};var p=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new Va(this.context,h,Ws[h],v,Ef[h],this._showOverdrawInspector)),this.cache[p]},fa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},fa.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},fa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},fa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Wl=function(h,v){this.points=h,this.planes=v};Wl.fromInvProjectionMatrix=function(h,v,p){var g=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,h)}).map(function(R){return y.scale$1([],R,1/R[3]/v*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var O=y.sub([],S[R[0]],S[R[1]]),j=y.sub([],S[R[2]],S[R[1]]),$=y.normalize([],y.cross([],O,j)),pe=-y.dot($,S[R[1]]);return $.concat(pe)});return new Wl(S,C)};var zu=function(h,v){this.min=h,this.max=v,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};zu.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],p=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<v.length;S++)p[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new zu(p,g)},zu.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},zu.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},zu.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],C=0,R=0;R<v.length;R++)C+=y.dot$1(S,v[R])>=0;if(C===0)return 0;C!==v.length&&(p=!1)}if(p)return 2;for(var O=0;O<3;O++){for(var j=Number.MAX_VALUE,$=-Number.MAX_VALUE,pe=0;pe<h.points.length;pe++){var _e=h.points[pe][O]-this.min[O];j=Math.min(j,_e),$=Math.max($,_e)}if($<0||j>this.max[O]-this.min[O])return 0}return 1};var il=function(h,v,p,g){if(h===void 0&&(h=0),v===void 0&&(v=0),p===void 0&&(p=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=p,this.right=g};il.prototype.interpolate=function(h,v,p){return v.top!=null&&h.top!=null&&(this.top=y.number(h.top,v.top,p)),v.bottom!=null&&h.bottom!=null&&(this.bottom=y.number(h.bottom,v.bottom,p)),v.left!=null&&h.left!=null&&(this.left=y.number(h.left,v.left,p)),v.right!=null&&h.right!=null&&(this.right=y.number(h.right,v.right,p)),this},il.prototype.getCenter=function(h,v){var p=y.clamp((this.left+h-this.right)/2,0,h),g=y.clamp((this.top+v-this.bottom)/2,0,v);return new y.Point(p,g)},il.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},il.prototype.clone=function(){return new il(this.top,this.bottom,this.left,this.right)},il.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ni=function(h,v,p,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new il,this._posMatrixCache={},this._alignedPosMatrixCache={}},ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ni.prototype.clone=function(){var h=new Ni(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},ma.minZoom.get=function(){return this._minZoom},ma.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},ma.maxZoom.get=function(){return this._maxZoom},ma.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},ma.minPitch.get=function(){return this._minPitch},ma.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},ma.maxPitch.get=function(){return this._maxPitch},ma.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},ma.renderWorldCopies.get=function(){return this._renderWorldCopies},ma.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},ma.worldSize.get=function(){return this.tileSize*this.scale},ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ma.size.get=function(){return new y.Point(this.width,this.height)},ma.bearing.get=function(){return-this.angle/Math.PI*180},ma.bearing.set=function(h){var v=-y.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ma.pitch.get=function(){return this._pitch/Math.PI*180},ma.pitch.set=function(h){var v=y.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},ma.fov.get=function(){return this._fov/Math.PI*180},ma.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},ma.zoom.get=function(){return this._zoom},ma.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},ma.center.get=function(){return this._center},ma.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},ma.padding.get=function(){return this._edgeInsets.toJSON()},ma.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ni.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Ni.prototype.interpolatePadding=function(h,v,p){this._unmodified=!1,this._edgeInsets.interpolate(h,v,p),this._constrain(),this._calcMatrices()},Ni.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},Ni.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new y.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),C=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(p.x,g.x,S.x,C.x)),O=Math.floor(Math.max(p.x,g.x,S.x,C.x)),j=R-1;j<=O+1;j++)j!==0&&v.push(new y.UnwrappedTileID(j,h));return v},Ni.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),p=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),C=[S*g.x,S*g.y,0],R=Wl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),O=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(O=v);var j=function(Fr){return{aabb:new zu([Fr*S,0,0],[(Fr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Fr,fullyVisible:!1}},$=[],pe=[],_e=v,xe=h.reparseOverscaled?p:v;if(this._renderWorldCopies)for(var Ue=1;Ue<=3;Ue++)$.push(j(-Ue)),$.push(j(Ue));for($.push(j(0));$.length>0;){var Be=$.pop(),Qe=Be.x,Ie=Be.y,qe=Be.fullyVisible;if(!qe){var ft=Be.aabb.intersects(R);if(ft===0)continue;qe=ft===2}var Rt=Be.aabb.distanceX(C),$t=Be.aabb.distanceY(C),jt=Math.max(Math.abs(Rt),Math.abs($t));if(Be.zoom===_e||jt>3+(1<<_e-Be.zoom)-2&&Be.zoom>=O)pe.push({tileID:new y.OverscaledTileID(Be.zoom===_e?xe:Be.zoom,Be.wrap,Be.zoom,Qe,Ie),distanceSq:y.sqrLen([C[0]-.5-Qe,C[1]-.5-Ie])});else for(var ir=0;ir<4;ir++){var pr=(Qe<<1)+ir%2,Ur=(Ie<<1)+(ir>>1);$.push({aabb:Be.aabb.quadrant(ir),zoom:Be.zoom+1,x:pr,y:Ur,wrap:Be.wrap,fullyVisible:qe})}}return pe.sort(function(Fr,ln){return Fr.distanceSq-ln.distanceSq}).map(function(Fr){return Fr.tileID})},Ni.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},ma.unmodified.get=function(){return this._unmodified},Ni.prototype.zoomScale=function(h){return Math.pow(2,h)},Ni.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Ni.prototype.project=function(h){var v=y.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(h.lng)*this.worldSize,y.mercatorYfromLat(v)*this.worldSize)},Ni.prototype.unproject=function(h){return new y.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},ma.point.get=function(){return this.project(this.center)},Ni.prototype.setLocationAtPoint=function(h,v){var p=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),C=new y.MercatorCoordinate(S.x-(p.x-g.x),S.y-(p.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Ni.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Ni.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Ni.prototype.locationCoordinate=function(h){return y.MercatorCoordinate.fromLngLat(h)},Ni.prototype.coordinateLocation=function(h){return h.toLngLat()},Ni.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],p=[h.x,h.y,1,1];y.transformMat4(v,v,this.pixelMatrixInverse),y.transformMat4(p,p,this.pixelMatrixInverse);var g=v[3],S=p[3],C=v[1]/g,R=p[1]/S,O=v[2]/g,j=p[2]/S,$=O===j?0:(0-O)/(j-O);return new y.MercatorCoordinate(y.number(v[0]/g,p[0]/S,$)/this.worldSize,y.number(C,R,$)/this.worldSize)},Ni.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix),new y.Point(v[0]/v[3],v[1]/v[3])},Ni.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Ni.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ni.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ni.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var p=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];var S=h.canonical,C=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*h.wrap,O=y.identity(new Float64Array(16));return y.translate(O,O,[R*C,S.y*C,0]),y.scale(O,O,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(O,v?this.alignedProjMatrix:this.projMatrix,O),g[p]=new Float32Array(O),g[p]},Ni.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ni.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,p,g,S=-90,C=90,R=-180,O=180,j=this.size,$=this._unmodified;if(this.latRange){var pe=this.latRange;S=y.mercatorYfromLat(pe[1])*this.worldSize,h=(C=y.mercatorYfromLat(pe[0])*this.worldSize)-S<j.y?j.y/(C-S):0}if(this.lngRange){var _e=this.lngRange;R=y.mercatorXfromLng(_e[0])*this.worldSize,v=(O=y.mercatorXfromLng(_e[1])*this.worldSize)-R<j.x?j.x/(O-R):0}var xe=this.point,Ue=Math.max(v||0,h||0);if(Ue)return this.center=this.unproject(new y.Point(v?(O+R)/2:xe.x,h?(C+S)/2:xe.y)),this.zoom+=this.scaleZoom(Ue),this._unmodified=$,void(this._constraining=!1);if(this.latRange){var Be=xe.y,Qe=j.y/2;Be-Qe<S&&(g=S+Qe),Be+Qe>C&&(g=C-Qe)}if(this.lngRange){var Ie=xe.x,qe=j.x/2;Ie-qe<R&&(p=R+qe),Ie+qe>O&&(p=O-qe)}p===void 0&&g===void 0||(this.center=this.unproject(new y.Point(p!==void 0?p:xe.x,g!==void 0?g:xe.y))),this._unmodified=$,this._constraining=!1}},Ni.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,p=this._fov*(.5+h.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-v-p,.01,Math.PI-.01)),S=this.point,C=S.x,R=S.y,O=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),j=this.height/50,$=new Float64Array(16);y.perspective($,this._fov,this.width/this.height,j,O),$[8]=2*-h.x/this.width,$[9]=2*h.y/this.height,y.scale($,$,[1,-1,1]),y.translate($,$,[0,0,-this.cameraToCenterDistance]),y.rotateX($,$,this._pitch),y.rotateZ($,$,this.angle),y.translate($,$,[-C,-R,0]),this.mercatorMatrix=y.scale([],$,[this.worldSize,this.worldSize,this.worldSize]),y.scale($,$,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=$,this.invProjMatrix=y.invert([],this.projMatrix);var pe=this.width%2/2,_e=this.height%2/2,xe=Math.cos(this.angle),Ue=Math.sin(this.angle),Be=C-Math.round(C)+xe*pe+Ue*_e,Qe=R-Math.round(R)+xe*_e+Ue*pe,Ie=new Float64Array($);if(y.translate(Ie,Ie,[Be>.5?Be-1:Be,Qe>.5?Qe-1:Qe,0]),this.alignedProjMatrix=Ie,$=y.create(),y.scale($,$,[this.width/2,-this.height/2,1]),y.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=y.create(),y.scale($,$,[1,-1,1]),y.translate($,$,[-1,-1,0]),y.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!($=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=$,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ni.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new y.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return y.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ni.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,h))},Ni.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var p=v.x,g=v.y,S=v.x,C=v.y,R=0,O=h;R<O.length;R+=1){var j=O[R];p=Math.min(p,j.x),g=Math.min(g,j.y),S=Math.max(S,j.x),C=Math.max(C,j.y)}return[new y.Point(p,g),new y.Point(S,g),new y.Point(S,C),new y.Point(p,C),new y.Point(p,g)]},Object.defineProperties(Ni.prototype,ma);var su=function(h){var v,p,g,S;this._hashName=h&&encodeURIComponent(h),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),p=!1,g=null,S=function(){g=null,p&&(v(),g=setTimeout(S,300),p=!1)},function(){return p=!0,g||S(),g})};su.prototype.addTo=function(h){return this._map=h,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},su.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},su.prototype.getHashString=function(h){var v=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),C=Math.round(v.lng*S)/S,R=Math.round(v.lat*S)/S,O=this._map.getBearing(),j=this._map.getPitch(),$="";if($+=h?"/"+C+"/"+R+"/"+p:p+"/"+R+"/"+C,(O||j)&&($+="/"+Math.round(10*O)/10),j&&($+="/"+Math.round(j)),this._hashName){var pe=this._hashName,_e=!1,xe=y.window.location.hash.slice(1).split("&").map(function(Ue){var Be=Ue.split("=")[0];return Be===pe?(_e=!0,Be+"="+$):Ue}).filter(function(Ue){return Ue});return _e||xe.push(pe+"="+$),"#"+xe.join("&")}return"#"+$},su.prototype._getCurrentHash=function(){var h,v=this,p=y.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):p.split("/")},su.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},su.prototype._updateHashUnthrottled=function(){var h=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,h)}catch(v){}};var Xc={linearity:.3,easing:y.bezier(0,0,.3,1)},$c=y.extend({deceleration:2500,maxSpeed:1400},Xc),Gs=y.extend({deceleration:20,maxSpeed:1400},Xc),qh=y.extend({deceleration:1e3,maxSpeed:360},Xc),wf=y.extend({deceleration:1e3,maxSpeed:90},Xc),Cf=function(h){this._map=h,this.clear()};function Gl(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function yo(h,v,p){var g=p.maxSpeed,S=p.linearity,C=p.deceleration,R=y.clamp(h*S/(v/1e3),-g,g),O=Math.abs(R)/(C*S);return{easing:p.easing,duration:1e3*O,amount:R*(O/2)}}Cf.prototype.clear=function(){this._inertiaBuffer=[]},Cf.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:h})},Cf.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=y.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},Cf.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},p=0,g=this._inertiaBuffer;p<g.length;p+=1){var S=g[p].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(v.pan.mag()){var O=yo(v.pan.mag(),C,y.extend({},$c,h||{}));R.offset=v.pan.mult(O.amount/v.pan.mag()),R.center=this._map.transform.center,Gl(R,O)}if(v.zoom){var j=yo(v.zoom,C,Gs);R.zoom=this._map.transform.zoom+j.amount,Gl(R,j)}if(v.bearing){var $=yo(v.bearing,C,qh);R.bearing=this._map.transform.bearing+y.clamp($.amount,-179,179),Gl(R,$)}if(v.pitch){var pe=yo(v.pitch,C,wf);R.pitch=this._map.transform.pitch+pe.amount,Gl(R,pe)}if(R.zoom||R.bearing){var _e=v.pinchAround===void 0?v.around:v.pinchAround;R.around=_e?this._map.unproject(_e):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var Fa=function(h){function v(g,S,C,R){R===void 0&&(R={});var O=z.mousePos(S.getCanvasContainer(),C),j=S.unproject(O);h.call(this,g,y.extend({point:O,lngLat:j,originalEvent:C},R)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),Yc=function(h){function v(g,S,C){var R=g==="touchend"?C.changedTouches:C.touches,O=z.touchPos(S.getCanvasContainer(),R),j=O.map(function(_e){return S.unproject(_e)}),$=O.reduce(function(_e,xe,Ue,Be){return _e.add(xe.div(Be.length))},new y.Point(0,0)),pe=S.unproject($);h.call(this,g,{points:O,point:$,lngLats:j,lngLat:pe,originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),gc=function(h){function v(g,S,C){h.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(y.Event),Ka=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};Ka.prototype.reset=function(){delete this._mousedownPos},Ka.prototype.wheel=function(h){return this._firePreventable(new gc(h.type,this._map,h))},Ka.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new Fa(h.type,this._map,h))},Ka.prototype.mouseup=function(h){this._map.fire(new Fa(h.type,this._map,h))},Ka.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new Fa(h.type,this._map,h))},Ka.prototype.dblclick=function(h){return this._firePreventable(new Fa(h.type,this._map,h))},Ka.prototype.mouseover=function(h){this._map.fire(new Fa(h.type,this._map,h))},Ka.prototype.mouseout=function(h){this._map.fire(new Fa(h.type,this._map,h))},Ka.prototype.touchstart=function(h){return this._firePreventable(new Yc(h.type,this._map,h))},Ka.prototype.touchmove=function(h){this._map.fire(new Yc(h.type,this._map,h))},Ka.prototype.touchend=function(h){this._map.fire(new Yc(h.type,this._map,h))},Ka.prototype.touchcancel=function(h){this._map.fire(new Yc(h.type,this._map,h))},Ka.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},Ka.prototype.isEnabled=function(){return!0},Ka.prototype.isActive=function(){return!1},Ka.prototype.enable=function(){},Ka.prototype.disable=function(){};var _n=function(h){this._map=h};_n.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},_n.prototype.mousemove=function(h){this._map.fire(new Fa(h.type,this._map,h))},_n.prototype.mousedown=function(){this._delayContextMenu=!0},_n.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},_n.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new Fa(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},_n.prototype.isEnabled=function(){return!0},_n.prototype.isActive=function(){return!1},_n.prototype.enable=function(){},_n.prototype.disable=function(){};var os=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function Rf(h,v){for(var p={},g=0;g<h.length;g++)p[h[g].identifier]=v[g];return p}os.prototype.isEnabled=function(){return!!this._enabled},os.prototype.isActive=function(){return!!this._active},os.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},os.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},os.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(z.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},os.prototype.mousemoveWindow=function(h,v){if(this._active){var p=v;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=p,this._box||(this._box=z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,p.x),C=Math.max(g.x,p.x),R=Math.min(g.y,p.y),O=Math.max(g.y,p.y);z.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=C-S+"px",this._box.style.height=O-R+"px"}}},os.prototype.mouseupWindow=function(h,v){var p=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),z.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,S,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},os.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},os.prototype.blur=function(){this.reset()},os.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos},os.prototype._fireEvent=function(h,v){return this._map.fire(new y.Event(h,{originalEvent:v}))};var _c=function(h){this.reset(),this.numTouches=h.numTouches};_c.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},_c.prototype.touchstart=function(h,v,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),C=0,R=g;C<R.length;C+=1)S._add(R[C]);return S.div(g.length)}(v),this.touches=Rf(p,v)))},_c.prototype.touchmove=function(h,v,p){if(!this.aborted&&this.centroid){var g=Rf(p,v);for(var S in this.touches){var C=g[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}},_c.prototype.touchend=function(h,v,p){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var qo=function(h){this.singleTap=new _c(h),this.numTaps=h.numTaps,this.reset()};qo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},qo.prototype.touchstart=function(h,v,p){this.singleTap.touchstart(h,v,p)},qo.prototype.touchmove=function(h,v,p){this.singleTap.touchmove(h,v,p)},qo.prototype.touchend=function(h,v,p){var g=this.singleTap.touchend(h,v,p);if(g){var S=h.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(S&&C||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var ha=function(){this._zoomIn=new qo({numTouches:1,numTaps:2}),this._zoomOut=new qo({numTouches:2,numTaps:1}),this.reset()};ha.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ha.prototype.touchstart=function(h,v,p){this._zoomIn.touchstart(h,v,p),this._zoomOut.touchstart(h,v,p)},ha.prototype.touchmove=function(h,v,p){this._zoomIn.touchmove(h,v,p),this._zoomOut.touchmove(h,v,p)},ha.prototype.touchend=function(h,v,p){var g=this,S=this._zoomIn.touchend(h,v,p),C=this._zoomOut.touchend(h,v,p);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:h})}}):C?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(C)},{originalEvent:h})}}):void 0},ha.prototype.touchcancel=function(){this.reset()},ha.prototype.enable=function(){this._enabled=!0},ha.prototype.disable=function(){this._enabled=!1,this.reset()},ha.prototype.isEnabled=function(){return this._enabled},ha.prototype.isActive=function(){return this._active};var Mf={0:1,2:2},qr=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(h,v){return!1},qr.prototype._move=function(h,v){return{}},qr.prototype.mousedown=function(h,v){if(!this._lastPoint){var p=z.mouseButton(h);this._correctButton(h,p)&&(this._lastPoint=v,this._eventButton=p)}},qr.prototype.mousemoveWindow=function(h,v){var p=this._lastPoint;if(p){if(h.preventDefault(),function(g,S){var C=Mf[S];return g.buttons===void 0||(g.buttons&C)!==C}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(p,v)}},qr.prototype.mouseupWindow=function(h){this._lastPoint&&z.mouseButton(h)===this._eventButton&&(this._moved&&z.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var al=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(p,g){h.prototype.mousedown.call(this,p,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(p,g){return g===0&&!p.ctrlKey},v.prototype._move=function(p,g){return{around:g,panDelta:g.sub(p)}},v}(qr),qc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=.8*(g.x-p.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(qr),Kc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=-.5*(g.y-p.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(qr),gu=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};gu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},gu.prototype.touchstart=function(h,v,p){return this._calculateTransform(h,v,p)},gu.prototype.touchmove=function(h,v,p){if(this._active&&!(p.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,p)},gu.prototype.touchend=function(h,v,p){this._calculateTransform(h,v,p),this._active&&p.length<this._minTouches&&this.reset()},gu.prototype.touchcancel=function(){this.reset()},gu.prototype._calculateTransform=function(h,v,p){p.length>0&&(this._active=!0);var g=Rf(p,v),S=new y.Point(0,0),C=new y.Point(0,0),R=0;for(var O in g){var j=g[O],$=this._touches[O];$&&(S._add(j),C._add(j.sub($)),R++,g[O]=j)}if(this._touches=g,!(R<this._minTouches)&&C.mag()){var pe=C.div(R);if(this._sum._add(pe),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:pe}}},gu.prototype.enable=function(){this._enabled=!0},gu.prototype.disable=function(){this._enabled=!1,this.reset()},gu.prototype.isEnabled=function(){return this._enabled},gu.prototype.isActive=function(){return this._active};var Ds=function(){this.reset()};function If(h,v,p){for(var g=0;g<h.length;g++)if(h[g].identifier===p)return v[g]}function Pf(h,v){return Math.log(h/v)/Math.LN2}Ds.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ds.prototype._start=function(h){},Ds.prototype._move=function(h,v,p){return{}},Ds.prototype.touchstart=function(h,v,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([v[0],v[1]]))},Ds.prototype.touchmove=function(h,v,p){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],C=If(p,v,g[0]),R=If(p,v,S);if(C&&R){var O=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],O,h)}}},Ds.prototype.touchend=function(h,v,p){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],C=If(p,v,g[0]),R=If(p,v,S);C&&R||(this._active&&z.suppressClick(),this.reset())}},Ds.prototype.touchcancel=function(){this.reset()},Ds.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active};var ss=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(Pf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pf(this._distance,S),pinchAround:g}},v}(Ds);function _u(h,v){return 180*h.angleWith(v)/Math.PI}var Kh=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var g=25/(Math.PI*this._minDiameter)*360,S=_u(p,this._startVector);return Math.abs(S)<g},v}(Ds);function yc(h){return Math.abs(h.y)>Math.abs(h.x)}var xc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(p){this._lastPoints=p,yc(p[0].sub(p[1]))&&(this._valid=!1)},v.prototype._move=function(p,g,S){var C=p[0].sub(this._lastPoints[0]),R=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,R,S.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(C.y+R.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(p,g,S){if(this._valid!==void 0)return this._valid;var C=p.mag()>=2,R=g.mag()>=2;if(C||R){if(!C||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var O=p.y>0==g.y>0;return yc(p)&&yc(g)&&O}},v}(Ds),Qc={panStep:100,bearingStep:15,pitchStep:10},Fs=function(){var h=Qc;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Ot(h){return h*(2-h)}Fs.prototype.blur=function(){this.reset()},Fs.prototype.reset=function(){this._active=!1},Fs.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var p=0,g=0,S=0,C=0,R=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),C=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),C=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),R=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(O){var j=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Ot,zoom:p?Math.round(j)+p*(h.shiftKey?2:1):j,bearing:O.getBearing()+g*v._bearingStep,pitch:O.getPitch()+S*v._pitchStep,offset:[-C*v._panStep,-R*v._panStep],center:O.getCenter()},{originalEvent:h})}}}},Fs.prototype.enable=function(){this._enabled=!0},Fs.prototype.disable=function(){this._enabled=!1,this.reset()},Fs.prototype.isEnabled=function(){return this._enabled},Fs.prototype.isActive=function(){return this._active},Fs.prototype.disableRotation=function(){this._rotationDisabled=!0},Fs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ee=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Ee.prototype.setZoomRate=function(h){this._defaultZoomRate=h},Ee.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},Ee.prototype.isEnabled=function(){return!!this._enabled},Ee.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ee.prototype.isZooming=function(){return!!this._zooming},Ee.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},Ee.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ee.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=y.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},Ee.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},Ee.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=z.mousePos(this._el,h);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ee.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,R=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,O=this._startZoom,j=this._easing,$=!1;if(this._type==="wheel"&&O&&j){var pe=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),_e=j(pe);C=y.number(O,R,_e),pe<1?this._frameId||(this._frameId=!0):$=!0}else C=R,$=!0;return this._active=!0,$&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!$,zoomDelta:C-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ee.prototype._smoothOutEasing=function(h){var v=y.ease;if(this._prevEase){var p=this._prevEase,g=(y.browser.now()-p.start)/p.duration,S=p.easing(g+.01)-p.easing(g),C=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-C*C);v=y.bezier(C,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:h,easing:v},v},Ee.prototype.blur=function(){this.reset()},Ee.prototype.reset=function(){this._active=!1};var B=function(h,v){this._clickZoom=h,this._tapZoom=v};B.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},B.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},B.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},B.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Xs=function(){this.reset()};Xs.prototype.reset=function(){this._active=!1},Xs.prototype.blur=function(){this.reset()},Xs.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(p){p.easeTo({duration:300,zoom:p.getZoom()+(h.shiftKey?-1:1),around:p.unproject(v)},{originalEvent:h})}}},Xs.prototype.enable=function(){this._enabled=!0},Xs.prototype.disable=function(){this._enabled=!1,this.reset()},Xs.prototype.isEnabled=function(){return this._enabled},Xs.prototype.isActive=function(){return this._active};var ve=function(){this._tap=new qo({numTouches:1,numTaps:1}),this.reset()};ve.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ve.prototype.touchstart=function(h,v,p){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=v[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(h,v,p))},ve.prototype.touchmove=function(h,v,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,p)},ve.prototype.touchend=function(h,v,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(h,v,p)&&(this._tapTime=h.timeStamp)},ve.prototype.touchcancel=function(){this.reset()},ve.prototype.enable=function(){this._enabled=!0},ve.prototype.disable=function(){this._enabled=!1,this.reset()},ve.prototype.isEnabled=function(){return this._enabled},ve.prototype.isActive=function(){return this._active};var Rl=function(h,v,p){this._el=h,this._mousePan=v,this._touchPan=p};Rl.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Rl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Rl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Rl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ka=function(h,v,p){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=p};ka.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ka.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ka.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ka.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ks=function(h,v,p,g){this._el=h,this._touchZoom=v,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};ks.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ks.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ks.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ks.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ks.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ks.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var xo=function(h){return h.zoom||h.drag||h.pitch||h.rotate},us=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(y.Event);function kn(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var Sn=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cf(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),y.bindAll(["handleEvent","handleWindowEvent"],this);var p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var C=S[g],R=C[0];z.addEventListener(R,C[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};Sn.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var p=v[h],g=p[0];z.removeEventListener(g,p[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},Sn.prototype._addDefaultHandlers=function(h){var v=this._map,p=v.getCanvasContainer();this._add("mapEvent",new Ka(v,h));var g=v.boxZoom=new os(v,h);this._add("boxZoom",g);var S=new ha,C=new Xs;v.doubleClickZoom=new B(C,S),this._add("tapZoom",S),this._add("clickZoom",C);var R=new ve;this._add("tapDragZoom",R);var O=v.touchPitch=new xc;this._add("touchPitch",O);var j=new qc(h),$=new Kc(h);v.dragRotate=new ka(h,j,$),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);var pe=new al(h),_e=new gu(h);v.dragPan=new Rl(p,pe,_e),this._add("mousePan",pe),this._add("touchPan",_e,["touchZoom","touchRotate"]);var xe=new Kh,Ue=new ss;v.touchZoomRotate=new ks(p,Ue,xe,R),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Ue,["touchPan","touchRotate"]);var Be=v.scrollZoom=new Ee(v,this);this._add("scrollZoom",Be,["mousePan"]);var Qe=v.keyboard=new Fs;this._add("keyboard",Qe),this._add("blockableMapEvent",new _n(v));for(var Ie=0,qe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ie<qe.length;Ie+=1){var ft=qe[Ie];h.interactive&&h[ft]&&v[ft].enable(h[ft])}},Sn.prototype._add=function(h,v,p){this._handlers.push({handlerName:h,handler:v,allowed:p}),this._handlersById[h]=v},Sn.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,p=this._handlers;v<p.length;v+=1)p[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},Sn.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},Sn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Sn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Sn.prototype.isMoving=function(){return Boolean(xo(this._eventsInProgress))||this.isZooming()},Sn.prototype._blockedByActive=function(h,v,p){for(var g in h)if(g!==p&&(!v||v.indexOf(g)<0))return!0;return!1},Sn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},Sn.prototype._getMapTouches=function(h){for(var v=[],p=0,g=h;p<g.length;p+=1){var S=g[p];this._el.contains(S.target)&&v.push(S)}return v},Sn.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var p=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},C={},R=h.touches?this._getMapTouches(h.touches):void 0,O=R?z.touchPos(this._el,R):z.mousePos(this._el,h),j=0,$=this._handlers;j<$.length;j+=1){var pe=$[j],_e=pe.handlerName,xe=pe.handler,Ue=pe.allowed;if(xe.isEnabled()){var Be=void 0;this._blockedByActive(C,Ue,_e)?xe.reset():xe[v||h.type]&&(Be=xe[v||h.type](h,O,R),this.mergeHandlerResult(g,S,Be,_e,p),Be&&Be.needsRenderFrame&&this._triggerRenderFrame()),(Be||xe.isActive())&&(C[_e]=xe)}}var Qe={};for(var Ie in this._previousActiveHandlers)C[Ie]||(Qe[Ie]=p);this._previousActiveHandlers=C,(Object.keys(Qe).length||kn(g))&&(this._changes.push([g,S,Qe]),this._triggerRenderFrame()),(Object.keys(C).length||kn(g))&&this._map._stop(!0),this._updatingCamera=!1;var qe=g.cameraAnimation;qe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],qe(this._map))},Sn.prototype.mergeHandlerResult=function(h,v,p,g,S){if(p){y.extend(h,p);var C={handlerName:g,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(v.zoom=C),p.panDelta!==void 0&&(v.drag=C),p.pitchDelta!==void 0&&(v.pitch=C),p.bearingDelta!==void 0&&(v.rotate=C)}},Sn.prototype._applyChanges=function(){for(var h={},v={},p={},g=0,S=this._changes;g<S.length;g+=1){var C=S[g],R=C[0],O=C[1],j=C[2];R.panDelta&&(h.panDelta=(h.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(h.around=R.around),R.pinchAround!==void 0&&(h.pinchAround=R.pinchAround),R.noInertia&&(h.noInertia=R.noInertia),y.extend(v,O),y.extend(p,j)}this._updateMapTransform(h,v,p),this._changes=[]},Sn.prototype._updateMapTransform=function(h,v,p){var g=this._map,S=g.transform;if(!kn(h))return this._fireEvents(v,p,!0);var C=h.panDelta,R=h.zoomDelta,O=h.bearingDelta,j=h.pitchDelta,$=h.around,pe=h.pinchAround;pe!==void 0&&($=pe),g._stop(!0),$=$||g.transform.centerPoint;var _e=S.pointLocation(C?$.sub(C):$);O&&(S.bearing+=O),j&&(S.pitch+=j),R&&(S.zoom+=R),S.setLocationAtPoint(_e,$),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,p,!0)},Sn.prototype._fireEvents=function(h,v,p){var g=this,S=xo(this._eventsInProgress),C=xo(h),R={};for(var O in h)this._eventsInProgress[O]||(R[O+"start"]=h[O].originalEvent),this._eventsInProgress[O]=h[O];for(var j in!S&&C&&this._fireEvent("movestart",C.originalEvent),R)this._fireEvent(j,R[j]);for(var $ in C&&this._fireEvent("move",C.originalEvent),h)this._fireEvent($,h[$].originalEvent);var pe,_e={};for(var xe in this._eventsInProgress){var Ue=this._eventsInProgress[xe],Be=Ue.handlerName,Qe=Ue.originalEvent;this._handlersById[Be].isActive()||(delete this._eventsInProgress[xe],_e[xe+"end"]=pe=v[Be]||Qe)}for(var Ie in _e)this._fireEvent(Ie,_e[Ie]);var qe=xo(this._eventsInProgress);if(p&&(S||C)&&!qe){this._updatingCamera=!0;var ft=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Rt=function($t){return $t!==0&&-g._bearingSnap<$t&&$t<g._bearingSnap};ft?(Rt(ft.bearing||this._map.getBearing())&&(ft.bearing=0),this._map.easeTo(ft,{originalEvent:pe})):(this._map.fire(new y.Event("moveend",{originalEvent:pe})),Rt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Sn.prototype._fireEvent=function(h,v){this._map.fire(new y.Event(h,v?{originalEvent:v}:{}))},Sn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new us("renderFrame",{timeStamp:v})),h._applyChanges()})},Sn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ko=function(h){function v(p,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(p,g){return this.jumpTo({center:p},g)},v.prototype.panBy=function(p,g,S){return p=y.Point.convert(p).mult(-1),this.panTo(this.transform.center,y.extend({offset:p},g),S)},v.prototype.panTo=function(p,g,S){return this.easeTo(y.extend({center:p},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(p,g){return this.jumpTo({zoom:p},g),this},v.prototype.zoomTo=function(p,g,S){return this.easeTo(y.extend({zoom:p},g),S)},v.prototype.zoomIn=function(p,g){return this.zoomTo(this.getZoom()+1,p,g),this},v.prototype.zoomOut=function(p,g){return this.zoomTo(this.getZoom()-1,p,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(p,g){return this.jumpTo({bearing:p},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(p,g){return this.jumpTo({padding:p},g),this},v.prototype.rotateTo=function(p,g,S){return this.easeTo(y.extend({bearing:p},g),S)},v.prototype.resetNorth=function(p,g){return this.rotateTo(0,y.extend({duration:1e3},p),g),this},v.prototype.resetNorthPitch=function(p,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},p),g),this},v.prototype.snapToNorth=function(p,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(p,g){return this.jumpTo({pitch:p},g),this},v.prototype.cameraForBounds=function(p,g){p=y.LngLatBounds.convert(p);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(p,g,S,C){var R={top:0,bottom:0,right:0,left:0};if(typeof(C=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var O=C.padding;C.padding={top:O,bottom:O,right:O,left:O}}C.padding=y.extend(R,C.padding);var j=this.transform,$=j.padding,pe=j.project(y.LngLat.convert(p)),_e=j.project(y.LngLat.convert(g)),xe=pe.rotate(-S*Math.PI/180),Ue=_e.rotate(-S*Math.PI/180),Be=new y.Point(Math.max(xe.x,Ue.x),Math.max(xe.y,Ue.y)),Qe=new y.Point(Math.min(xe.x,Ue.x),Math.min(xe.y,Ue.y)),Ie=Be.sub(Qe),qe=(j.width-($.left+$.right+C.padding.left+C.padding.right))/Ie.x,ft=(j.height-($.top+$.bottom+C.padding.top+C.padding.bottom))/Ie.y;if(!(ft<0||qe<0)){var Rt=Math.min(j.scaleZoom(j.scale*Math.min(qe,ft)),C.maxZoom),$t=typeof C.offset.x=="number"?new y.Point(C.offset.x,C.offset.y):y.Point.convert(C.offset),jt=new y.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(S*Math.PI/180),ir=$t.add(jt).mult(j.scale/j.zoomScale(Rt));return{center:j.unproject(pe.add(_e).div(2).sub(ir)),zoom:Rt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(p,g,S){return this._fitInternal(this.cameraForBounds(p,g),g,S)},v.prototype.fitScreenCoordinates=function(p,g,S,C,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(p)),this.transform.pointLocation(y.Point.convert(g)),S,C),C,R)},v.prototype._fitInternal=function(p,g,S){return p?(delete(g=y.extend(p,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(p,g){this.stop();var S=this.transform,C=!1,R=!1,O=!1;return"zoom"in p&&S.zoom!==+p.zoom&&(C=!0,S.zoom=+p.zoom),p.center!==void 0&&(S.center=y.LngLat.convert(p.center)),"bearing"in p&&S.bearing!==+p.bearing&&(R=!0,S.bearing=+p.bearing),"pitch"in p&&S.pitch!==+p.pitch&&(O=!0,S.pitch=+p.pitch),p.padding==null||S.isPaddingEqual(p.padding)||(S.padding=p.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),C&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),R&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),O&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},v.prototype.easeTo=function(p,g){var S=this;this._stop(!1,p.easeId),((p=y.extend({offset:[0,0],duration:500,easing:y.ease},p)).animate===!1||!p.essential&&y.browser.prefersReducedMotion)&&(p.duration=0);var C=this.transform,R=this.getZoom(),O=this.getBearing(),j=this.getPitch(),$=this.getPadding(),pe="zoom"in p?+p.zoom:R,_e="bearing"in p?this._normalizeBearing(p.bearing,O):O,xe="pitch"in p?+p.pitch:j,Ue="padding"in p?p.padding:C.padding,Be=y.Point.convert(p.offset),Qe=C.centerPoint.add(Be),Ie=C.pointLocation(Qe),qe=y.LngLat.convert(p.center||Ie);this._normalizeCenter(qe);var ft,Rt,$t=C.project(Ie),jt=C.project(qe).sub($t),ir=C.zoomScale(pe-R);p.around&&(ft=y.LngLat.convert(p.around),Rt=C.locationPoint(ft));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||pe!==R,this._rotating=this._rotating||O!==_e,this._pitching=this._pitching||xe!==j,this._padding=!C.isPaddingEqual(Ue),this._easeId=p.easeId,this._prepareEase(g,p.noMoveStart,pr),this._ease(function(Ur){if(S._zooming&&(C.zoom=y.number(R,pe,Ur)),S._rotating&&(C.bearing=y.number(O,_e,Ur)),S._pitching&&(C.pitch=y.number(j,xe,Ur)),S._padding&&(C.interpolatePadding($,Ue,Ur),Qe=C.centerPoint.add(Be)),ft)C.setLocationAtPoint(ft,Rt);else{var Fr=C.zoomScale(C.zoom-R),ln=pe>R?Math.min(2,ir):Math.max(.5,ir),Un=Math.pow(ln,1-Ur),Bn=C.unproject($t.add(jt.mult(Ur*Un)).mult(Fr));C.setLocationAtPoint(C.renderWorldCopies?Bn.wrap():Bn,Qe)}S._fireMoveEvents(g)},function(Ur){S._afterEase(g,Ur)},p),this},v.prototype._prepareEase=function(p,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",p)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",p)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",p)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",p))},v.prototype._fireMoveEvents=function(p){this.fire(new y.Event("move",p)),this._zooming&&this.fire(new y.Event("zoom",p)),this._rotating&&this.fire(new y.Event("rotate",p)),this._pitching&&this.fire(new y.Event("pitch",p))},v.prototype._afterEase=function(p,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,C=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",p)),C&&this.fire(new y.Event("rotateend",p)),R&&this.fire(new y.Event("pitchend",p)),this.fire(new y.Event("moveend",p))}},v.prototype.flyTo=function(p,g){var S=this;if(!p.essential&&y.browser.prefersReducedMotion){var C=y.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),p=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},p);var R=this.transform,O=this.getZoom(),j=this.getBearing(),$=this.getPitch(),pe=this.getPadding(),_e="zoom"in p?y.clamp(+p.zoom,R.minZoom,R.maxZoom):O,xe="bearing"in p?this._normalizeBearing(p.bearing,j):j,Ue="pitch"in p?+p.pitch:$,Be="padding"in p?p.padding:R.padding,Qe=R.zoomScale(_e-O),Ie=y.Point.convert(p.offset),qe=R.centerPoint.add(Ie),ft=R.pointLocation(qe),Rt=y.LngLat.convert(p.center||ft);this._normalizeCenter(Rt);var $t=R.project(ft),jt=R.project(Rt).sub($t),ir=p.curve,pr=Math.max(R.width,R.height),Ur=pr/Qe,Fr=jt.mag();if("minZoom"in p){var ln=y.clamp(Math.min(p.minZoom,O,_e),R.minZoom,R.maxZoom),Un=pr/R.zoomScale(ln-O);ir=Math.sqrt(Un/Fr*2)}var Bn=ir*ir;function Zn(ri){var $n=(Ur*Ur-pr*pr+(ri?-1:1)*Bn*Bn*Fr*Fr)/(2*(ri?Ur:pr)*Bn*Fr);return Math.log(Math.sqrt($n*$n+1)-$n)}function Zi(ri){return(Math.exp(ri)-Math.exp(-ri))/2}function mn(ri){return(Math.exp(ri)+Math.exp(-ri))/2}var oi=Zn(0),vi=function(ri){return mn(oi)/mn(oi+ir*ri)},ai=function(ri){return pr*((mn(oi)*(Zi($n=oi+ir*ri)/mn($n))-Zi(oi))/Bn)/Fr;var $n},ti=(Zn(1)-oi)/ir;if(Math.abs(Fr)<1e-6||!isFinite(ti)){if(Math.abs(pr-Ur)<1e-6)return this.easeTo(p,g);var pi=Ur<pr?-1:1;ti=Math.abs(Math.log(Ur/pr))/ir,ai=function(){return 0},vi=function(ri){return Math.exp(pi*ir*ri)}}return p.duration="duration"in p?+p.duration:1e3*ti/("screenSpeed"in p?+p.screenSpeed/ir:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=j!==xe,this._pitching=Ue!==$,this._padding=!R.isPaddingEqual(Be),this._prepareEase(g,!1),this._ease(function(ri){var $n=ri*ti,bo=1/vi($n);R.zoom=ri===1?_e:O+R.scaleZoom(bo),S._rotating&&(R.bearing=y.number(j,xe,ri)),S._pitching&&(R.pitch=y.number($,Ue,ri)),S._padding&&(R.interpolatePadding(pe,Be,ri),qe=R.centerPoint.add(Ie));var ja=ri===1?Rt:R.unproject($t.add(jt.mult(ai($n))).mult(bo));R.setLocationAtPoint(R.renderWorldCopies?ja.wrap():ja,qe),S._fireMoveEvents(g)},function(){return S._afterEase(g)},p),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(p,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!p){var C=this.handlers;C&&C.stop(!1)}return this},v.prototype._ease=function(p,g,S){S.animate===!1||S.duration===0?(p(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=p,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var p=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(p,g){p=y.wrap(p,-180,180);var S=Math.abs(p-g);return Math.abs(p-360-g)<S&&(p-=360),Math.abs(p+360-g)<S&&(p+=360),p},v.prototype._normalizeCenter=function(p){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=p.lng-g.center.lng;p.lng+=S>180?-360:S<-180?360:0}},v}(y.Evented),Qo=function(h){h===void 0&&(h={}),this.options=h,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Qo.prototype.getDefaultPosition=function(){return"bottom-right"},Qo.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Qo.prototype.onRemove=function(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Qo.prototype._setElementTitle=function(h,v){var p=this._map._getUIString("AttributionControl."+v);h.title=p,h.setAttribute("aria-label",p)},Qo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Qo.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(h){var p=v.reduce(function(g,S,C){return S.value&&(g+=S.key+"="+S.value+(C<v.length-1?"&":"")),g},"?");h.href=y.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},Qo.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Qo.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(O){return typeof O!="string"?"":O})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var p=this._map.style.sourceCaches;for(var g in p){var S=p[g];if(S.used){var C=S.getSource();C.attribution&&h.indexOf(C.attribution)<0&&h.push(C.attribution)}}h.sort(function(O,j){return O.length-j.length});var R=(h=h.filter(function(O,j){for(var $=j+1;$<h.length;$++)if(h[$].indexOf(O)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,h.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Qo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var yu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};yu.prototype.onAdd=function(h){this._map=h,this._container=z.create("div","mapboxgl-ctrl");var v=z.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},yu.prototype.onRemove=function(){z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},yu.prototype.getDefaultPosition=function(){return"bottom-left"},yu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},yu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},yu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Ia=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ia.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Ia.prototype.remove=function(h){for(var v=this._currentlyRunning,p=0,g=v?this._queue.concat(v):this._queue;p<g.length;p+=1){var S=g[p];if(S.id===h)return void(S.cancelled=!0)}},Ia.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,g=v;p<g.length;p+=1){var S=g[p];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ia.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var $s={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},xu=y.window.HTMLImageElement,bu=y.window.HTMLElement,ia=y.window.ImageBitmap,uo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},hh=function(h){function v(g){var S=this;if((g=y.extend({},uo,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Ni(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Ia,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},$s,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof bu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sn(this,g),this._hash=g.hash&&new su(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Qo({customAttribution:g.customAttribution})),this.addControl(new yu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(C,R.firstChild):R.appendChild(C),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),C=S[0],R=S[1];if(C===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(C,R),this.transform.resize(C,R),this.painter.resize(C,R);var O=!this._moving;return O&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),O&&this.fire(new y.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,C){var R,O=this;if(g==="mouseenter"||g==="mouseover"){var j=!1;return{layer:S,listener:C,delegates:{mousemove:function(pe){var _e=O.getLayer(S)?O.queryRenderedFeatures(pe.point,{layers:[S]}):[];_e.length?j||(j=!0,C.call(O,new Fa(g,O,pe.originalEvent,{features:_e}))):j=!1},mouseout:function(){j=!1}}}}if(g==="mouseleave"||g==="mouseout"){var $=!1;return{layer:S,listener:C,delegates:{mousemove:function(pe){(O.getLayer(S)?O.queryRenderedFeatures(pe.point,{layers:[S]}):[]).length?$=!0:$&&($=!1,C.call(O,new Fa(g,O,pe.originalEvent)))},mouseout:function(pe){$&&($=!1,C.call(O,new Fa(g,O,pe.originalEvent)))}}}}return{layer:S,listener:C,delegates:(R={},R[g]=function(pe){var _e=O.getLayer(S)?O.queryRenderedFeatures(pe.point,{layers:[S]}):[];_e.length&&(pe.features=_e,C.call(O,pe),delete pe.features)},R)}},v.prototype.on=function(g,S,C){if(C===void 0)return h.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var O in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(O,R.delegates[O]);return this},v.prototype.once=function(g,S,C){if(C===void 0)return h.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,C);for(var O in R.delegates)this.once(O,R.delegates[O]);return this},v.prototype.off=function(g,S,C){var R=this;return C===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(O){for(var j=O[g],$=0;$<j.length;$++){var pe=j[$];if(pe.layer===S&&pe.listener===C){for(var _e in pe.delegates)R.off(_e,pe.delegates[_e]);return j.splice($,1),R}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var C;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")C=[y.Point.convert(g)];else{var R=y.Point.convert(g[0]),O=y.Point.convert(g[1]);C=[R,new y.Point(O.x,R.y),O,new y.Point(R.x,O.y),R]}return this.style.queryRenderedFeatures(C,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Rs(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Rs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var C=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),O=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(O,function(j,$){j?C.fire(new y.ErrorEvent(j)):$&&C._updateDiff($,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(C){y.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var C=g[S]._tiles;for(var R in C){var O=C[R];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,C)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,C){C===void 0&&(C={});var R=C.pixelRatio;R===void 0&&(R=1);var O=C.sdf;O===void 0&&(O=!1);var j=C.stretchX,$=C.stretchY,pe=C.content;if(this._lazyInitEmptyStyle(),S instanceof xu||ia&&S instanceof ia){var _e=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:_e.width,height:_e.height},_e.data),pixelRatio:R,stretchX:j,stretchY:$,content:pe,sdf:O,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:j,stretchY:$,content:pe,sdf:O,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var C=this.style.getImage(g);if(!C)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof xu||ia&&S instanceof ia?y.browser.getImageData(S):S,O=R.width,j=R.height,$=R.data;return O===void 0||j===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):O!==C.data.width||j!==C.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace($,!(S instanceof xu||ia&&S instanceof ia)),void this.style.updateImage(g,C))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,C){return this.style.setLayerZoomRange(g,S,C),this._update(!0)},v.prototype.setFilter=function(g,S,C){return C===void 0&&(C={}),this.style.setFilter(g,S,C),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,C,R),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,C,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,C,R),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=z.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=z.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=z.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var R=this._controlContainer=z.create("div","mapboxgl-control-container",g),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(j){O[j]=z.create("div","mapboxgl-ctrl-"+j,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var C=y.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=y.extend({},ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new fa(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,C=this,R=0,O=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=O.createQueryEXT(),O.beginQueryEXT(O.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var $=this.transform.zoom,pe=y.browser.now();this.style.zoomHistory.update($,pe);var _e=new y.EvaluationParameters($,{now:pe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=_e.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=xe),this.style.update(_e)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ue=y.browser.now()-R;O.endQueryEXT(O.TIME_ELAPSED_EXT,S),setTimeout(function(){var Ie=O.getQueryObjectEXT(S,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(S),C.fire(new y.Event("gpu-timing-frame",{cpuTime:Ue,gpuTime:Ie}))},50)}if(this.listens("gpu-timing-layer")){var Be=this.painter.collectGpuTimers();setTimeout(function(){var Ie=C.painter.queryGpuTimers(Be);C.fire(new y.Event("gpu-timing-layer",{layerTimes:Ie}))},50)}var Qe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Qe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||Qe||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Ml(this._canvasContainer),Ml(this._controlContainer),Ml(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},p.version.get=function(){return y.version},Object.defineProperties(v.prototype,p),v}(Ko);function Ml(h){h.parentNode&&h.parentNode.removeChild(h)}var Of={showCompass:!0,showZoom:!0,visualizePitch:!1},ol=function(h){var v=this;this.options=y.extend({},Of,h),this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return v._map.zoomIn({},{originalEvent:p})}),z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return v._map.zoomOut({},{originalEvent:p})}),z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:p}):v._map.resetNorth({},{originalEvent:p})}),this._compassIcon=z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ol.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),p=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},ol.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},ol.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ls(this._map,this._compass,this.options.visualizePitch)),this._container},ol.prototype.onRemove=function(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ol.prototype._createButton=function(h,v){var p=z.create("button",h,this._container);return p.type="button",p.addEventListener("click",v),p},ol.prototype._setButtonTitle=function(h,v){var p=this._map._getUIString("NavigationControl."+v);h.title=p,h.setAttribute("aria-label",p)};var ls=function(h,v,p){p===void 0&&(p=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new qc({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,p&&(this.mousePitch=new Kc({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),z.addEventListener(v,"mousedown",this.mousedown),z.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(v,"touchmove",this.touchmove),z.addEventListener(v,"touchend",this.touchend),z.addEventListener(v,"touchcancel",this.reset)};function Xl(h,v,p){if(h=new y.LngLat(h.lng,h.lat),v){var g=new y.LngLat(h.lng-360,h.lat),S=new y.LngLat(h.lng+360,h.lat),C=p.locationPoint(h).distSqr(v);p.locationPoint(g).distSqr(v)<C?h=g:p.locationPoint(S).distSqr(v)<C&&(h=S)}for(;Math.abs(h.lng-p.center.lng)>180;){var R=p.locationPoint(h);if(R.x>=0&&R.y>=0&&R.x<=p.width&&R.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}ls.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),z.disableDrag()},ls.prototype.move=function(h,v){var p=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}},ls.prototype.off=function(){var h=this.element;z.removeEventListener(h,"mousedown",this.mousedown),z.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(h,"touchmove",this.touchmove),z.removeEventListener(h,"touchend",this.touchend),z.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},ls.prototype.offTemp=function(){z.enableDrag(),z.removeEventListener(y.window,"mousemove",this.mousemove),z.removeEventListener(y.window,"mouseup",this.mouseup)},ls.prototype.mousedown=function(h){this.down(y.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),z.mousePos(this.element,h)),z.addEventListener(y.window,"mousemove",this.mousemove),z.addEventListener(y.window,"mouseup",this.mouseup)},ls.prototype.mousemove=function(h){this.move(h,z.mousePos(this.element,h))},ls.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},ls.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},ls.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},ls.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ls.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Df(h,v,p){var g=h.classList;for(var S in Eu)g.remove("mapboxgl-"+p+"-anchor-"+S);g.add("mapboxgl-"+p+"-anchor-"+v)}var bc,Jc=function(h){function v(p,g){if(h.call(this),(p instanceof y.window.HTMLElement||g)&&(p=y.extend({element:p},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=y.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");var S=z.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var C=z.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var R=z.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var O=z.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");for(var j=0,$=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];j<$.length;j+=1){var pe=$[j],_e=z.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",pe.rx),_e.setAttributeNS(null,"ry",pe.ry),O.appendChild(_e)}var xe=z.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var Ue=z.createNS("http://www.w3.org/2000/svg","path");Ue.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(Ue);var Be=z.createNS("http://www.w3.org/2000/svg","g");Be.setAttributeNS(null,"opacity","0.25"),Be.setAttributeNS(null,"fill","#000000");var Qe=z.createNS("http://www.w3.org/2000/svg","path");Qe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Be.appendChild(Qe);var Ie=z.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ie.setAttributeNS(null,"fill","#FFFFFF");var qe=z.createNS("http://www.w3.org/2000/svg","g");qe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ft=z.createNS("http://www.w3.org/2000/svg","circle");ft.setAttributeNS(null,"fill","#000000"),ft.setAttributeNS(null,"opacity","0.25"),ft.setAttributeNS(null,"cx","5.5"),ft.setAttributeNS(null,"cy","5.5"),ft.setAttributeNS(null,"r","5.4999962");var Rt=z.createNS("http://www.w3.org/2000/svg","circle");Rt.setAttributeNS(null,"fill","#FFFFFF"),Rt.setAttributeNS(null,"cx","5.5"),Rt.setAttributeNS(null,"cy","5.5"),Rt.setAttributeNS(null,"r","5.4999962"),qe.appendChild(ft),qe.appendChild(Rt),R.appendChild(O),R.appendChild(xe),R.appendChild(Be),R.appendChild(Ie),R.appendChild(qe),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function($t){$t.preventDefault()}),this._element.addEventListener("mousedown",function($t){$t.preventDefault()}),Df(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(p){var g=p.code,S=p.charCode||p.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(p){var g=p.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},v.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,Eu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(p){return this._offset=y.Point.convert(p),this._update(),this},v.prototype._onMove=function(p){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(y.Evented),Ff={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},$l=0,Yl=!1,ph=function(h){function v(p){h.call(this),this.options=y.extend({},Ff,p),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){var g;return this._map=p,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,bc!==void 0?g(bc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(bc=S.state!=="denied")}):g(bc=!!y.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$l=0,Yl=!1},v.prototype._isOutOfMapMaxBounds=function(p){var g=this._map.getMaxBounds(),S=p.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",p)),this._finish()}},v.prototype._updateCamera=function(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude),S=p.coords.accuracy,C=this._map.getBearing(),R=y.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},v.prototype._updateMarker=function(p){if(p){var g=new y.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,g=this._map.unproject([0,p]),S=this._map.unproject([1,p]),C=g.distanceTo(S),R=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&Yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",p)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(p){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=z.create("button","mapboxgl-ctrl-geolocate",this._container),z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Jc(this._dotElement),this._circleElement=z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$l--,Yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++$l>1?(p={maximumAge:6e5,timeout:0},Yl=!0):(p=this.options.positionOptions,Yl=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(y.Evented),Jo={maxWidth:100,unit:"metric"},Su=function(h){this.options=y.extend({},Jo,h),y.bindAll(["_onMove","setUnit"],this)};function ef(h,v,p){var g=p&&p.maxWidth||100,S=h._container.clientHeight/2,C=h.unproject([0,S]),R=h.unproject([g,S]),O=C.distanceTo(R);if(p&&p.unit==="imperial"){var j=3.2808*O;j>5280?Il(v,g,j/5280,h._getUIString("ScaleControl.Miles")):Il(v,g,j,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?Il(v,g,O/1852,h._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Il(v,g,O/1e3,h._getUIString("ScaleControl.Kilometers")):Il(v,g,O,h._getUIString("ScaleControl.Meters"))}function Il(h,v,p,g){var S,C,R,O=(S=p,(C=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/C)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(j){var $=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*$)/$}(R)));h.style.width=v*(O/p)+"px",h.innerHTML=O+"&nbsp;"+g}Su.prototype.getDefaultPosition=function(){return"bottom-left"},Su.prototype._onMove=function(){ef(this._map,this._container,this.options)},Su.prototype.onAdd=function(h){return this._map=h,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Su.prototype.onRemove=function(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Su.prototype.setUnit=function(h){this.options.unit=h,ef(this._map,this._container,this.options)};var uu=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof y.window.HTMLElement?this._container=h.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};uu.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},uu.prototype.onRemove=function(){z.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},uu.prototype._setupUI=function(){var h=this._fullscreenButton=z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},uu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},uu.prototype._isFullscreen=function(){return this._fullscreen},uu.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},uu.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var dh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),kf=function(h){function v(p){h.call(this),this.options=y.extend(Object.create(dh),p),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=y.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(p){return this.setDOMContent(y.window.document.createTextNode(p))},v.prototype.setHTML=function(p){var g,S=y.window.document.createDocumentFragment(),C=y.window.document.createElement("body");for(C.innerHTML=p;g=C.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},v.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},v.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},v.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},v.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(p){this._update(p.point)},v.prototype._onMouseMove=function(p){this._update(p.point)},v.prototype._onDrag=function(p){this._update(p.point)},v.prototype._update=function(p){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(_e){return g._container.classList.add(_e)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var S=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),C=this.options.anchor,R=function _e(xe){if(xe){if(typeof xe=="number"){var Ue=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new y.Point(0,0),top:new y.Point(0,xe),"top-left":new y.Point(Ue,Ue),"top-right":new y.Point(-Ue,Ue),bottom:new y.Point(0,-xe),"bottom-left":new y.Point(Ue,-Ue),"bottom-right":new y.Point(-Ue,-Ue),left:new y.Point(xe,0),right:new y.Point(-xe,0)}}if(xe instanceof y.Point||Array.isArray(xe)){var Be=y.Point.convert(xe);return{center:Be,top:Be,"top-left":Be,"top-right":Be,bottom:Be,"bottom-left":Be,"bottom-right":Be,left:Be,right:Be}}return{center:y.Point.convert(xe.center||[0,0]),top:y.Point.convert(xe.top||[0,0]),"top-left":y.Point.convert(xe["top-left"]||[0,0]),"top-right":y.Point.convert(xe["top-right"]||[0,0]),bottom:y.Point.convert(xe.bottom||[0,0]),"bottom-left":y.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(xe["bottom-right"]||[0,0]),left:y.Point.convert(xe.left||[0,0]),right:y.Point.convert(xe.right||[0,0])}}return _e(new y.Point(0,0))}(this.options.offset);if(!C){var O,j=this._container.offsetWidth,$=this._container.offsetHeight;O=S.y+R.bottom.y<$?["top"]:S.y>this._map.transform.height-$?["bottom"]:[],S.x<j/2?O.push("left"):S.x>this._map.transform.width-j/2&&O.push("right"),C=O.length===0?"bottom":O.join("-")}var pe=S.add(R[C]).round();z.setTransform(this._container,Eu[C]+" translate("+pe.x+"px,"+pe.y+"px)"),Df(this._container,C,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(Zu);p&&p.focus()}},v.prototype._onClose=function(){this.remove()},v}(y.Evented),vh={version:y.version,supported:ce,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:hh,NavigationControl:ol,GeolocateControl:ph,AttributionControl:Qo,ScaleControl:Su,FullscreenControl:uu,Popup:kf,Marker:Jc,Style:Rs,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){rr().acquire(le)},clearPrewarmedResources:function(){var h=En;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(le),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(h){y.config.ACCESS_TOKEN=h},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(h){y.config.API_URL=h},get workerCount(){return br.workerCount},set workerCount(h){br.workerCount=h},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){y.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){y.clearTileCache(h)},workerUrl:""};return vh}),ge})},3614:function(yr,ne,N){"use strict";yr.exports=ee;var ge=N(80645);function ee(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}ee.Varint=0,ee.Fixed64=1,ee.Bytes=2,ee.Fixed32=5;var y=(1<<16)*(1<<16),ce=1/y,z=12,ae=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ee.prototype={destroy:function(){this.buf=null},readFields:function(q,De,F){for(F=F||this.length;this.pos<F;){var Me=this.readVarint(),Te=Me>>3,ht=this.pos;this.type=Me&7,q(Te,De,this),this.pos===ht&&this.skip(Me)}return De},readMessage:function(q,De){return this.readFields(q,De,this.readVarint()+this.pos)},readFixed32:function(){var q=Et(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=Ut(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=Et(this.buf,this.pos)+Et(this.buf,this.pos+4)*y;return this.pos+=8,q},readSFixed64:function(){var q=Et(this.buf,this.pos)+Ut(this.buf,this.pos+4)*y;return this.pos+=8,q},readFloat:function(){var q=ge.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=ge.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var De=this.buf,F,Me;return Me=De[this.pos++],F=Me&127,Me<128||(Me=De[this.pos++],F|=(Me&127)<<7,Me<128)||(Me=De[this.pos++],F|=(Me&127)<<14,Me<128)||(Me=De[this.pos++],F|=(Me&127)<<21,Me<128)?F:(Me=De[this.pos],F|=(Me&15)<<28,te(F,q,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var q=this.readVarint()+this.pos,De=this.pos;return this.pos=q,q-De>=z&&ae?er(this.buf,De,q):vt(this.buf,De,q)},readBytes:function(){var q=this.readVarint()+this.pos,De=this.buf.subarray(this.pos,q);return this.pos=q,De},readPackedVarint:function(q,De){if(this.type!==ee.Bytes)return q.push(this.readVarint(De));var F=Pe(this);for(q=q||[];this.pos<F;)q.push(this.readVarint(De));return q},readPackedSVarint:function(q){if(this.type!==ee.Bytes)return q.push(this.readSVarint());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==ee.Bytes)return q.push(this.readBoolean());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==ee.Bytes)return q.push(this.readFloat());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==ee.Bytes)return q.push(this.readDouble());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==ee.Bytes)return q.push(this.readFixed32());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==ee.Bytes)return q.push(this.readSFixed32());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==ee.Bytes)return q.push(this.readFixed64());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==ee.Bytes)return q.push(this.readSFixed64());var De=Pe(this);for(q=q||[];this.pos<De;)q.push(this.readSFixed64());return q},skip:function(q){var De=q&7;if(De===ee.Varint)for(;this.buf[this.pos++]>127;);else if(De===ee.Bytes)this.pos=this.readVarint()+this.pos;else if(De===ee.Fixed32)this.pos+=4;else if(De===ee.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+De)},writeTag:function(q,De){this.writeVarint(q<<3|De)},realloc:function(q){for(var De=this.length||16;De<this.pos+q;)De*=2;if(De!==this.length){var F=new Uint8Array(De);F.set(this.buf),this.buf=F,this.length=De}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),lt(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),lt(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),lt(this.buf,q&-1,this.pos),lt(this.buf,Math.floor(q*ce),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),lt(this.buf,q&-1,this.pos),lt(this.buf,Math.floor(q*ce),this.pos+4),this.pos+=8},writeVarint:function(q){if(q=+q||0,q>268435455||q<0){Ze(q,this);return}this.realloc(4),this.buf[this.pos++]=q&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=q>>>7&127)))},writeSVarint:function(q){this.writeVarint(q<0?-q*2-1:q*2)},writeBoolean:function(q){this.writeVarint(Boolean(q))},writeString:function(q){q=String(q),this.realloc(q.length*4),this.pos++;var De=this.pos;this.pos=xr(this.buf,q,this.pos);var F=this.pos-De;F>=128&&Tt(De,F,this),this.pos=De-1,this.writeVarint(F),this.pos+=F},writeFloat:function(q){this.realloc(4),ge.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),ge.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var De=q.length;this.writeVarint(De),this.realloc(De);for(var F=0;F<De;F++)this.buf[this.pos++]=q[F]},writeRawMessage:function(q,De){this.pos++;var F=this.pos;q(De,this);var Me=this.pos-F;Me>=128&&Tt(F,Me,this),this.pos=F-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(q,De,F){this.writeTag(q,ee.Bytes),this.writeRawMessage(De,F)},writePackedVarint:function(q,De){De.length&&this.writeMessage(q,Ct,De)},writePackedSVarint:function(q,De){De.length&&this.writeMessage(q,Gt,De)},writePackedBoolean:function(q,De){De.length&&this.writeMessage(q,wt,De)},writePackedFloat:function(q,De){De.length&&this.writeMessage(q,Jt,De)},writePackedDouble:function(q,De){De.length&&this.writeMessage(q,Zt,De)},writePackedFixed32:function(q,De){De.length&&this.writeMessage(q,xt,De)},writePackedSFixed32:function(q,De){De.length&&this.writeMessage(q,Lr,De)},writePackedFixed64:function(q,De){De.length&&this.writeMessage(q,mr,De)},writePackedSFixed64:function(q,De){De.length&&this.writeMessage(q,hr,De)},writeBytesField:function(q,De){this.writeTag(q,ee.Bytes),this.writeBytes(De)},writeFixed32Field:function(q,De){this.writeTag(q,ee.Fixed32),this.writeFixed32(De)},writeSFixed32Field:function(q,De){this.writeTag(q,ee.Fixed32),this.writeSFixed32(De)},writeFixed64Field:function(q,De){this.writeTag(q,ee.Fixed64),this.writeFixed64(De)},writeSFixed64Field:function(q,De){this.writeTag(q,ee.Fixed64),this.writeSFixed64(De)},writeVarintField:function(q,De){this.writeTag(q,ee.Varint),this.writeVarint(De)},writeSVarintField:function(q,De){this.writeTag(q,ee.Varint),this.writeSVarint(De)},writeStringField:function(q,De){this.writeTag(q,ee.Bytes),this.writeString(De)},writeFloatField:function(q,De){this.writeTag(q,ee.Fixed32),this.writeFloat(De)},writeDoubleField:function(q,De){this.writeTag(q,ee.Fixed64),this.writeDouble(De)},writeBooleanField:function(q,De){this.writeVarintField(q,Boolean(De))}};function te(q,De,F){var Me=F.buf,Te,ht;if(ht=Me[F.pos++],Te=(ht&112)>>4,ht<128||(ht=Me[F.pos++],Te|=(ht&127)<<3,ht<128)||(ht=Me[F.pos++],Te|=(ht&127)<<10,ht<128)||(ht=Me[F.pos++],Te|=(ht&127)<<17,ht<128)||(ht=Me[F.pos++],Te|=(ht&127)<<24,ht<128)||(ht=Me[F.pos++],Te|=(ht&1)<<31,ht<128))return re(q,Te,De);throw new Error("Expected varint not more than 10 bytes")}function Pe(q){return q.type===ee.Bytes?q.readVarint()+q.pos:q.pos+1}function re(q,De,F){return F?De*4294967296+(q>>>0):(De>>>0)*4294967296+(q>>>0)}function Ze(q,De){var F,Me;if(q>=0?(F=q%4294967296|0,Me=q/4294967296|0):(F=~(-q%4294967296),Me=~(-q/4294967296),F^4294967295?F=F+1|0:(F=0,Me=Me+1|0)),q>=18446744073709552e3||q<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");De.realloc(10),Ke(F,Me,De),nt(Me,De)}function Ke(q,De,F){F.buf[F.pos++]=q&127|128,q>>>=7,F.buf[F.pos++]=q&127|128,q>>>=7,F.buf[F.pos++]=q&127|128,q>>>=7,F.buf[F.pos++]=q&127|128,q>>>=7,F.buf[F.pos]=q&127}function nt(q,De){var F=(q&7)<<4;De.buf[De.pos++]|=F|((q>>>=3)?128:0),!!q&&(De.buf[De.pos++]=q&127|((q>>>=7)?128:0),!!q&&(De.buf[De.pos++]=q&127|((q>>>=7)?128:0),!!q&&(De.buf[De.pos++]=q&127|((q>>>=7)?128:0),!!q&&(De.buf[De.pos++]=q&127|((q>>>=7)?128:0),!!q&&(De.buf[De.pos++]=q&127)))))}function Tt(q,De,F){var Me=De<=16383?1:De<=2097151?2:De<=268435455?3:Math.floor(Math.log(De)/(Math.LN2*7));F.realloc(Me);for(var Te=F.pos-1;Te>=q;Te--)F.buf[Te+Me]=F.buf[Te]}function Ct(q,De){for(var F=0;F<q.length;F++)De.writeVarint(q[F])}function Gt(q,De){for(var F=0;F<q.length;F++)De.writeSVarint(q[F])}function Jt(q,De){for(var F=0;F<q.length;F++)De.writeFloat(q[F])}function Zt(q,De){for(var F=0;F<q.length;F++)De.writeDouble(q[F])}function wt(q,De){for(var F=0;F<q.length;F++)De.writeBoolean(q[F])}function xt(q,De){for(var F=0;F<q.length;F++)De.writeFixed32(q[F])}function Lr(q,De){for(var F=0;F<q.length;F++)De.writeSFixed32(q[F])}function mr(q,De){for(var F=0;F<q.length;F++)De.writeFixed64(q[F])}function hr(q,De){for(var F=0;F<q.length;F++)De.writeSFixed64(q[F])}function Et(q,De){return(q[De]|q[De+1]<<8|q[De+2]<<16)+q[De+3]*16777216}function lt(q,De,F){q[F]=De,q[F+1]=De>>>8,q[F+2]=De>>>16,q[F+3]=De>>>24}function Ut(q,De){return(q[De]|q[De+1]<<8|q[De+2]<<16)+(q[De+3]<<24)}function vt(q,De,F){for(var Me="",Te=De;Te<F;){var ht=q[Te],bt=null,St=ht>239?4:ht>223?3:ht>191?2:1;if(Te+St>F)break;var qt,or,rn;St===1?ht<128&&(bt=ht):St===2?(qt=q[Te+1],(qt&192)==128&&(bt=(ht&31)<<6|qt&63,bt<=127&&(bt=null))):St===3?(qt=q[Te+1],or=q[Te+2],(qt&192)==128&&(or&192)==128&&(bt=(ht&15)<<12|(qt&63)<<6|or&63,(bt<=2047||bt>=55296&&bt<=57343)&&(bt=null))):St===4&&(qt=q[Te+1],or=q[Te+2],rn=q[Te+3],(qt&192)==128&&(or&192)==128&&(rn&192)==128&&(bt=(ht&15)<<18|(qt&63)<<12|(or&63)<<6|rn&63,(bt<=65535||bt>=1114112)&&(bt=null))),bt===null?(bt=65533,St=1):bt>65535&&(bt-=65536,Me+=String.fromCharCode(bt>>>10&1023|55296),bt=56320|bt&1023),Me+=String.fromCharCode(bt),Te+=St}return Me}function er(q,De,F){return ae.decode(q.subarray(De,F))}function xr(q,De,F){for(var Me=0,Te,ht;Me<De.length;Me++){if(Te=De.charCodeAt(Me),Te>55295&&Te<57344)if(ht)if(Te<56320){q[F++]=239,q[F++]=191,q[F++]=189,ht=Te;continue}else Te=ht-55296<<10|Te-56320|65536,ht=null;else{Te>56319||Me+1===De.length?(q[F++]=239,q[F++]=191,q[F++]=189):ht=Te;continue}else ht&&(q[F++]=239,q[F++]=191,q[F++]=189,ht=null);Te<128?q[F++]=Te:(Te<2048?q[F++]=Te>>6|192:(Te<65536?q[F++]=Te>>12|224:(q[F++]=Te>>18|240,q[F++]=Te>>12&63|128),q[F++]=Te>>6&63|128),q[F++]=Te&63|128)}return F}},32676:function(yr,ne,N){var ge=N(34155);(function(ee,y){yr.exports=y()})(this,function(){"use strict";function ee(Pt,k){if(!(Pt instanceof k))throw new TypeError("Cannot call a class as a function")}function y(Pt,k){for(var se=0;se<k.length;se++){var de=k[se];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(Pt,de.key,de)}}function ce(Pt,k,se){return k&&y(Pt.prototype,k),se&&y(Pt,se),Pt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var z=function(){function Pt(k,se){this.next=null,this.key=k,this.data=se,this.left=null,this.right=null}return Pt}();function ae(Pt,k){return Pt>k?1:Pt<k?-1:0}function te(Pt,k,se){for(var de=new z(null,null),je=de,mt=de;;){var Kt=se(Pt,k.key);if(Kt<0){if(k.left===null)break;if(se(Pt,k.left.key)<0){var Ar=k.left;if(k.left=Ar.right,Ar.right=k,k=Ar,k.left===null)break}mt.left=k,mt=k,k=k.left}else if(Kt>0){if(k.right===null)break;if(se(Pt,k.right.key)>0){var Ar=k.right;if(k.right=Ar.left,Ar.left=k,k=Ar,k.right===null)break}je.right=k,je=k,k=k.right}else break}return je.right=k.left,mt.left=k.right,k.left=de.right,k.right=de.left,k}function Pe(Pt,k,se,de){var je=new z(Pt,k);if(se===null)return je.left=je.right=null,je;se=te(Pt,se,de);var mt=de(Pt,se.key);return mt<0?(je.left=se.left,je.right=se,se.left=null):mt>=0&&(je.right=se.right,je.left=se,se.right=null),je}function re(Pt,k,se){var de=null,je=null;if(k){k=te(Pt,k,se);var mt=se(k.key,Pt);mt===0?(de=k.left,je=k.right):mt<0?(je=k.right,k.right=null,de=k):(de=k.left,k.left=null,je=k)}return{left:de,right:je}}function Ze(Pt,k,se){return k===null?Pt:(Pt===null||(k=te(Pt.key,k,se),k.left=Pt),k)}function Ke(Pt,k,se,de,je){if(Pt){de(""+k+(se?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+je(Pt)+`
`);var mt=k+(se?"    ":"\u2502   ");Pt.left&&Ke(Pt.left,mt,!1,de,je),Pt.right&&Ke(Pt.right,mt,!0,de,je)}}var nt=function(){function Pt(k){k===void 0&&(k=ae),this._root=null,this._size=0,this._comparator=k}return Pt.prototype.insert=function(k,se){return this._size++,this._root=Pe(k,se,this._root,this._comparator)},Pt.prototype.add=function(k,se){var de=new z(k,se);this._root===null&&(de.left=de.right=null,this._size++,this._root=de);var je=this._comparator,mt=te(k,this._root,je),Kt=je(k,mt.key);return Kt===0?this._root=mt:(Kt<0?(de.left=mt.left,de.right=mt,mt.left=null):Kt>0&&(de.right=mt.right,de.left=mt,mt.right=null),this._size++,this._root=de),this._root},Pt.prototype.remove=function(k){this._root=this._remove(k,this._root,this._comparator)},Pt.prototype._remove=function(k,se,de){var je;if(se===null)return null;se=te(k,se,de);var mt=de(k,se.key);return mt===0?(se.left===null?je=se.right:(je=te(k,se.left,de),je.right=se.right),this._size--,je):se},Pt.prototype.pop=function(){var k=this._root;if(k){for(;k.left;)k=k.left;return this._root=te(k.key,this._root,this._comparator),this._root=this._remove(k.key,this._root,this._comparator),{key:k.key,data:k.data}}return null},Pt.prototype.findStatic=function(k){for(var se=this._root,de=this._comparator;se;){var je=de(k,se.key);if(je===0)return se;je<0?se=se.left:se=se.right}return null},Pt.prototype.find=function(k){return this._root&&(this._root=te(k,this._root,this._comparator),this._comparator(k,this._root.key)!==0)?null:this._root},Pt.prototype.contains=function(k){for(var se=this._root,de=this._comparator;se;){var je=de(k,se.key);if(je===0)return!0;je<0?se=se.left:se=se.right}return!1},Pt.prototype.forEach=function(k,se){for(var de=this._root,je=[],mt=!1;!mt;)de!==null?(je.push(de),de=de.left):je.length!==0?(de=je.pop(),k.call(se,de),de=de.right):mt=!0;return this},Pt.prototype.range=function(k,se,de,je){for(var mt=[],Kt=this._comparator,Ar=this._root,Xe;mt.length!==0||Ar;)if(Ar)mt.push(Ar),Ar=Ar.left;else{if(Ar=mt.pop(),Xe=Kt(Ar.key,se),Xe>0)break;if(Kt(Ar.key,k)>=0&&de.call(je,Ar))return this;Ar=Ar.right}return this},Pt.prototype.keys=function(){var k=[];return this.forEach(function(se){var de=se.key;return k.push(de)}),k},Pt.prototype.values=function(){var k=[];return this.forEach(function(se){var de=se.data;return k.push(de)}),k},Pt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Pt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Pt.prototype.minNode=function(k){if(k===void 0&&(k=this._root),k)for(;k.left;)k=k.left;return k},Pt.prototype.maxNode=function(k){if(k===void 0&&(k=this._root),k)for(;k.right;)k=k.right;return k},Pt.prototype.at=function(k){for(var se=this._root,de=!1,je=0,mt=[];!de;)if(se)mt.push(se),se=se.left;else if(mt.length>0){if(se=mt.pop(),je===k)return se;je++,se=se.right}else de=!0;return null},Pt.prototype.next=function(k){var se=this._root,de=null;if(k.right){for(de=k.right;de.left;)de=de.left;return de}for(var je=this._comparator;se;){var mt=je(k.key,se.key);if(mt===0)break;mt<0?(de=se,se=se.left):se=se.right}return de},Pt.prototype.prev=function(k){var se=this._root,de=null;if(k.left!==null){for(de=k.left;de.right;)de=de.right;return de}for(var je=this._comparator;se;){var mt=je(k.key,se.key);if(mt===0)break;mt<0?se=se.left:(de=se,se=se.right)}return de},Pt.prototype.clear=function(){return this._root=null,this._size=0,this},Pt.prototype.toList=function(){return Gt(this._root)},Pt.prototype.load=function(k,se,de){se===void 0&&(se=[]),de===void 0&&(de=!1);var je=k.length,mt=this._comparator;if(de&&wt(k,se,0,je-1,mt),this._root===null)this._root=Tt(k,se,0,je),this._size=je;else{var Kt=Zt(this.toList(),Ct(k,se),mt);je=this._size+je,this._root=Jt({head:Kt},0,je)}return this},Pt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Pt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Pt.prototype.toString=function(k){k===void 0&&(k=function(je){return String(je.key)});var se=[];return Ke(this._root,"",!0,function(de){return se.push(de)},k),se.join("")},Pt.prototype.update=function(k,se,de){var je=this._comparator,mt=re(k,this._root,je),Kt=mt.left,Ar=mt.right;je(k,se)<0?Ar=Pe(se,de,Ar,je):Kt=Pe(se,de,Kt,je),this._root=Ze(Kt,Ar,je)},Pt.prototype.split=function(k){return re(k,this._root,this._comparator)},Pt}();function Tt(Pt,k,se,de){var je=de-se;if(je>0){var mt=se+Math.floor(je/2),Kt=Pt[mt],Ar=k[mt],Xe=new z(Kt,Ar);return Xe.left=Tt(Pt,k,se,mt),Xe.right=Tt(Pt,k,mt+1,de),Xe}return null}function Ct(Pt,k){for(var se=new z(null,null),de=se,je=0;je<Pt.length;je++)de=de.next=new z(Pt[je],k[je]);return de.next=null,se.next}function Gt(Pt){for(var k=Pt,se=[],de=!1,je=new z(null,null),mt=je;!de;)k?(se.push(k),k=k.left):se.length>0?(k=mt=mt.next=se.pop(),k=k.right):de=!0;return mt.next=null,je.next}function Jt(Pt,k,se){var de=se-k;if(de>0){var je=k+Math.floor(de/2),mt=Jt(Pt,k,je),Kt=Pt.head;return Kt.left=mt,Pt.head=Pt.head.next,Kt.right=Jt(Pt,je+1,se),Kt}return null}function Zt(Pt,k,se){for(var de=new z(null,null),je=de,mt=Pt,Kt=k;mt!==null&&Kt!==null;)se(mt.key,Kt.key)<0?(je.next=mt,mt=mt.next):(je.next=Kt,Kt=Kt.next),je=je.next;return mt!==null?je.next=mt:Kt!==null&&(je.next=Kt),de.next}function wt(Pt,k,se,de,je){if(!(se>=de)){for(var mt=Pt[se+de>>1],Kt=se-1,Ar=de+1;;){do Kt++;while(je(Pt[Kt],mt)<0);do Ar--;while(je(Pt[Ar],mt)>0);if(Kt>=Ar)break;var Xe=Pt[Kt];Pt[Kt]=Pt[Ar],Pt[Ar]=Xe,Xe=k[Kt],k[Kt]=k[Ar],k[Ar]=Xe}wt(Pt,k,se,Ar,je),wt(Pt,k,Ar+1,de,je)}}var xt=function(k,se){return k.ll.x<=se.x&&se.x<=k.ur.x&&k.ll.y<=se.y&&se.y<=k.ur.y},Lr=function(k,se){if(se.ur.x<k.ll.x||k.ur.x<se.ll.x||se.ur.y<k.ll.y||k.ur.y<se.ll.y)return null;var de=k.ll.x<se.ll.x?se.ll.x:k.ll.x,je=k.ur.x<se.ur.x?k.ur.x:se.ur.x,mt=k.ll.y<se.ll.y?se.ll.y:k.ll.y,Kt=k.ur.y<se.ur.y?k.ur.y:se.ur.y;return{ll:{x:de,y:mt},ur:{x:je,y:Kt}}},mr=Number.EPSILON;mr===void 0&&(mr=Math.pow(2,-52));var hr=mr*mr,Et=function(k,se){if(-mr<k&&k<mr&&-mr<se&&se<mr)return 0;var de=k-se;return de*de<hr*k*se?0:k<se?-1:1},lt=function(){function Pt(){ee(this,Pt),this.reset()}return ce(Pt,[{key:"reset",value:function(){this.xRounder=new Ut,this.yRounder=new Ut}},{key:"round",value:function(se,de){return{x:this.xRounder.round(se),y:this.yRounder.round(de)}}}]),Pt}(),Ut=function(){function Pt(){ee(this,Pt),this.tree=new nt,this.round(0)}return ce(Pt,[{key:"round",value:function(se){var de=this.tree.add(se),je=this.tree.prev(de);if(je!==null&&Et(de.key,je.key)===0)return this.tree.remove(se),je.key;var mt=this.tree.next(de);return mt!==null&&Et(de.key,mt.key)===0?(this.tree.remove(se),mt.key):se}}]),Pt}(),vt=new lt,er=function(k,se){return k.x*se.y-k.y*se.x},xr=function(k,se){return k.x*se.x+k.y*se.y},q=function(k,se,de){var je={x:se.x-k.x,y:se.y-k.y},mt={x:de.x-k.x,y:de.y-k.y},Kt=er(je,mt);return Et(Kt,0)},De=function(k){return Math.sqrt(xr(k,k))},F=function(k,se,de){var je={x:se.x-k.x,y:se.y-k.y},mt={x:de.x-k.x,y:de.y-k.y};return er(mt,je)/De(mt)/De(je)},Me=function(k,se,de){var je={x:se.x-k.x,y:se.y-k.y},mt={x:de.x-k.x,y:de.y-k.y};return xr(mt,je)/De(mt)/De(je)},Te=function(k,se,de){return se.y===0?null:{x:k.x+se.x/se.y*(de-k.y),y:de}},ht=function(k,se,de){return se.x===0?null:{x:de,y:k.y+se.y/se.x*(de-k.x)}},bt=function(k,se,de,je){if(se.x===0)return ht(de,je,k.x);if(je.x===0)return ht(k,se,de.x);if(se.y===0)return Te(de,je,k.y);if(je.y===0)return Te(k,se,de.y);var mt=er(se,je);if(mt==0)return null;var Kt={x:de.x-k.x,y:de.y-k.y},Ar=er(Kt,se)/mt,Xe=er(Kt,je)/mt,Mt=k.x+Xe*se.x,sr=de.x+Ar*je.x,dr=k.y+Xe*se.y,Gr=de.y+Ar*je.y,Nn=(Mt+sr)/2,On=(dr+Gr)/2;return{x:Nn,y:On}},St=function(){ce(Pt,null,[{key:"compare",value:function(se,de){var je=Pt.comparePoints(se.point,de.point);return je!==0?je:(se.point!==de.point&&se.link(de),se.isLeft!==de.isLeft?se.isLeft?1:-1:or.compare(se.segment,de.segment))}},{key:"comparePoints",value:function(se,de){return se.x<de.x?-1:se.x>de.x?1:se.y<de.y?-1:se.y>de.y?1:0}}]);function Pt(k,se){ee(this,Pt),k.events===void 0?k.events=[this]:k.events.push(this),this.point=k,this.isLeft=se}return ce(Pt,[{key:"link",value:function(se){if(se.point===this.point)throw new Error("Tried to link already linked events");for(var de=se.point.events,je=0,mt=de.length;je<mt;je++){var Kt=de[je];this.point.events.push(Kt),Kt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var se=this.point.events.length,de=0;de<se;de++){var je=this.point.events[de];if(je.segment.consumedBy===void 0)for(var mt=de+1;mt<se;mt++){var Kt=this.point.events[mt];Kt.consumedBy===void 0&&je.otherSE.point.events===Kt.otherSE.point.events&&je.segment.consume(Kt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var se=[],de=0,je=this.point.events.length;de<je;de++){var mt=this.point.events[de];mt!==this&&!mt.segment.ringOut&&mt.segment.isInResult()&&se.push(mt)}return se}},{key:"getLeftmostComparator",value:function(se){var de=this,je=new Map,mt=function(Ar){var Xe=Ar.otherSE;je.set(Ar,{sine:F(de.point,se.point,Xe.point),cosine:Me(de.point,se.point,Xe.point)})};return function(Kt,Ar){je.has(Kt)||mt(Kt),je.has(Ar)||mt(Ar);var Xe=je.get(Kt),Mt=Xe.sine,sr=Xe.cosine,dr=je.get(Ar),Gr=dr.sine,Nn=dr.cosine;return Mt>=0&&Gr>=0?sr<Nn?1:sr>Nn?-1:0:Mt<0&&Gr<0?sr<Nn?-1:sr>Nn?1:0:Gr<Mt?-1:Gr>Mt?1:0}}}]),Pt}(),qt=0,or=function(){ce(Pt,null,[{key:"compare",value:function(se,de){var je=se.leftSE.point.x,mt=de.leftSE.point.x,Kt=se.rightSE.point.x,Ar=de.rightSE.point.x;if(Ar<je)return 1;if(Kt<mt)return-1;var Xe=se.leftSE.point.y,Mt=de.leftSE.point.y,sr=se.rightSE.point.y,dr=de.rightSE.point.y;if(je<mt){if(Mt<Xe&&Mt<sr)return 1;if(Mt>Xe&&Mt>sr)return-1;var Gr=se.comparePoint(de.leftSE.point);if(Gr<0)return 1;if(Gr>0)return-1;var Nn=de.comparePoint(se.rightSE.point);return Nn!==0?Nn:-1}if(je>mt){if(Xe<Mt&&Xe<dr)return-1;if(Xe>Mt&&Xe>dr)return 1;var On=de.comparePoint(se.leftSE.point);if(On!==0)return On;var An=se.comparePoint(de.rightSE.point);return An<0?1:An>0?-1:1}if(Xe<Mt)return-1;if(Xe>Mt)return 1;if(Kt<Ar){var Tn=de.comparePoint(se.rightSE.point);if(Tn!==0)return Tn}if(Kt>Ar){var fi=se.comparePoint(de.rightSE.point);if(fi<0)return 1;if(fi>0)return-1}if(Kt!==Ar){var ni=sr-Xe,ta=Kt-je,ra=dr-Mt,Zo=Ar-mt;if(ni>ta&&ra<Zo)return 1;if(ni<ta&&ra>Zo)return-1}return Kt>Ar?1:Kt<Ar||sr<dr?-1:sr>dr?1:se.id<de.id?-1:se.id>de.id?1:0}}]);function Pt(k,se,de,je){ee(this,Pt),this.id=++qt,this.leftSE=k,k.segment=this,k.otherSE=se,this.rightSE=se,se.segment=this,se.otherSE=k,this.rings=de,this.windings=je}return ce(Pt,[{key:"replaceRightSE",value:function(se){this.rightSE=se,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var se=this.leftSE.point.y,de=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:se<de?se:de},ur:{x:this.rightSE.point.x,y:se>de?se:de}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(se){return se.x===this.leftSE.point.x&&se.y===this.leftSE.point.y||se.x===this.rightSE.point.x&&se.y===this.rightSE.point.y}},{key:"comparePoint",value:function(se){if(this.isAnEndpoint(se))return 0;var de=this.leftSE.point,je=this.rightSE.point,mt=this.vector();if(de.x===je.x)return se.x===de.x?0:se.x<de.x?1:-1;var Kt=(se.y-de.y)/mt.y,Ar=de.x+Kt*mt.x;if(se.x===Ar)return 0;var Xe=(se.x-de.x)/mt.x,Mt=de.y+Xe*mt.y;return se.y===Mt?0:se.y<Mt?-1:1}},{key:"getIntersection",value:function(se){var de=this.bbox(),je=se.bbox(),mt=Lr(de,je);if(mt===null)return null;var Kt=this.leftSE.point,Ar=this.rightSE.point,Xe=se.leftSE.point,Mt=se.rightSE.point,sr=xt(de,Xe)&&this.comparePoint(Xe)===0,dr=xt(je,Kt)&&se.comparePoint(Kt)===0,Gr=xt(de,Mt)&&this.comparePoint(Mt)===0,Nn=xt(je,Ar)&&se.comparePoint(Ar)===0;if(dr&&sr)return Nn&&!Gr?Ar:!Nn&&Gr?Mt:null;if(dr)return Gr&&Kt.x===Mt.x&&Kt.y===Mt.y?null:Kt;if(sr)return Nn&&Ar.x===Xe.x&&Ar.y===Xe.y?null:Xe;if(Nn&&Gr)return null;if(Nn)return Ar;if(Gr)return Mt;var On=bt(Kt,this.vector(),Xe,se.vector());return On===null||!xt(mt,On)?null:vt.round(On.x,On.y)}},{key:"split",value:function(se){var de=[],je=se.events!==void 0,mt=new St(se,!0),Kt=new St(se,!1),Ar=this.rightSE;this.replaceRightSE(Kt),de.push(Kt),de.push(mt);var Xe=new Pt(mt,Ar,this.rings.slice(),this.windings.slice());return St.comparePoints(Xe.leftSE.point,Xe.rightSE.point)>0&&Xe.swapEvents(),St.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),je&&(mt.checkForConsuming(),Kt.checkForConsuming()),de}},{key:"swapEvents",value:function(){var se=this.rightSE;this.rightSE=this.leftSE,this.leftSE=se,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var de=0,je=this.windings.length;de<je;de++)this.windings[de]*=-1}},{key:"consume",value:function(se){for(var de=this,je=se;de.consumedBy;)de=de.consumedBy;for(;je.consumedBy;)je=je.consumedBy;var mt=Pt.compare(de,je);if(mt!==0){if(mt>0){var Kt=de;de=je,je=Kt}if(de.prev===je){var Ar=de;de=je,je=Ar}for(var Xe=0,Mt=je.rings.length;Xe<Mt;Xe++){var sr=je.rings[Xe],dr=je.windings[Xe],Gr=de.rings.indexOf(sr);Gr===-1?(de.rings.push(sr),de.windings.push(dr)):de.windings[Gr]+=dr}je.rings=null,je.windings=null,je.consumedBy=de,je.leftSE.consumedBy=de.leftSE,je.rightSE.consumedBy=de.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var se=this.prev.consumedBy||this.prev;this._beforeState=se.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var se=this.beforeState();this._afterState={rings:se.rings.slice(0),windings:se.windings.slice(0),multiPolys:[]};for(var de=this._afterState.rings,je=this._afterState.windings,mt=this._afterState.multiPolys,Kt=0,Ar=this.rings.length;Kt<Ar;Kt++){var Xe=this.rings[Kt],Mt=this.windings[Kt],sr=de.indexOf(Xe);sr===-1?(de.push(Xe),je.push(Mt)):je[sr]+=Mt}for(var dr=[],Gr=[],Nn=0,On=de.length;Nn<On;Nn++)if(je[Nn]!==0){var An=de[Nn],Tn=An.poly;if(Gr.indexOf(Tn)===-1)if(An.isExterior)dr.push(Tn);else{Gr.indexOf(Tn)===-1&&Gr.push(Tn);var fi=dr.indexOf(An.poly);fi!==-1&&dr.splice(fi,1)}}for(var ni=0,ta=dr.length;ni<ta;ni++){var ra=dr[ni].multiPoly;mt.indexOf(ra)===-1&&mt.push(ra)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var se=this.beforeState().multiPolys,de=this.afterState().multiPolys;switch(Li.type){case"union":{var je=se.length===0,mt=de.length===0;this._isInResult=je!==mt;break}case"intersection":{var Kt,Ar;se.length<de.length?(Kt=se.length,Ar=de.length):(Kt=de.length,Ar=se.length),this._isInResult=Ar===Li.numMultiPolys&&Kt<Ar;break}case"xor":{var Xe=Math.abs(se.length-de.length);this._isInResult=Xe%2==1;break}case"difference":{var Mt=function(dr){return dr.length===1&&dr[0].isSubject};this._isInResult=Mt(se)!==Mt(de);break}default:throw new Error("Unrecognized operation type found ".concat(Li.type))}return this._isInResult}}],[{key:"fromRing",value:function(se,de,je){var mt,Kt,Ar,Xe=St.comparePoints(se,de);if(Xe<0)mt=se,Kt=de,Ar=1;else if(Xe>0)mt=de,Kt=se,Ar=-1;else throw new Error("Tried to create degenerate segment at [".concat(se.x,", ").concat(se.y,"]"));var Mt=new St(mt,!0),sr=new St(Kt,!1);return new Pt(Mt,sr,[je],[Ar])}}]),Pt}(),rn=function(){function Pt(k,se,de){if(ee(this,Pt),!Array.isArray(k)||k.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=se,this.isExterior=de,this.segments=[],typeof k[0][0]!="number"||typeof k[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var je=vt.round(k[0][0],k[0][1]);this.bbox={ll:{x:je.x,y:je.y},ur:{x:je.x,y:je.y}};for(var mt=je,Kt=1,Ar=k.length;Kt<Ar;Kt++){if(typeof k[Kt][0]!="number"||typeof k[Kt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Xe=vt.round(k[Kt][0],k[Kt][1]);Xe.x===mt.x&&Xe.y===mt.y||(this.segments.push(or.fromRing(mt,Xe,this)),Xe.x<this.bbox.ll.x&&(this.bbox.ll.x=Xe.x),Xe.y<this.bbox.ll.y&&(this.bbox.ll.y=Xe.y),Xe.x>this.bbox.ur.x&&(this.bbox.ur.x=Xe.x),Xe.y>this.bbox.ur.y&&(this.bbox.ur.y=Xe.y),mt=Xe)}(je.x!==mt.x||je.y!==mt.y)&&this.segments.push(or.fromRing(mt,je,this))}return ce(Pt,[{key:"getSweepEvents",value:function(){for(var se=[],de=0,je=this.segments.length;de<je;de++){var mt=this.segments[de];se.push(mt.leftSE),se.push(mt.rightSE)}return se}}]),Pt}(),Or=function(){function Pt(k,se){if(ee(this,Pt),!Array.isArray(k))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new rn(k[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var de=1,je=k.length;de<je;de++){var mt=new rn(k[de],this,!1);mt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=mt.bbox.ll.x),mt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=mt.bbox.ll.y),mt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=mt.bbox.ur.x),mt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=mt.bbox.ur.y),this.interiorRings.push(mt)}this.multiPoly=se}return ce(Pt,[{key:"getSweepEvents",value:function(){for(var se=this.exteriorRing.getSweepEvents(),de=0,je=this.interiorRings.length;de<je;de++)for(var mt=this.interiorRings[de].getSweepEvents(),Kt=0,Ar=mt.length;Kt<Ar;Kt++)se.push(mt[Kt]);return se}}]),Pt}(),Kn=function(){function Pt(k,se){if(ee(this,Pt),!Array.isArray(k))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof k[0][0][0]=="number"&&(k=[k])}catch(Kt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var de=0,je=k.length;de<je;de++){var mt=new Or(k[de],this);mt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=mt.bbox.ll.x),mt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=mt.bbox.ll.y),mt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=mt.bbox.ur.x),mt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=mt.bbox.ur.y),this.polys.push(mt)}this.isSubject=se}return ce(Pt,[{key:"getSweepEvents",value:function(){for(var se=[],de=0,je=this.polys.length;de<je;de++)for(var mt=this.polys[de].getSweepEvents(),Kt=0,Ar=mt.length;Kt<Ar;Kt++)se.push(mt[Kt]);return se}}]),Pt}(),on=function(){ce(Pt,null,[{key:"factory",value:function(se){for(var de=[],je=0,mt=se.length;je<mt;je++){var Kt=se[je];if(!(!Kt.isInResult()||Kt.ringOut)){for(var Ar=null,Xe=Kt.leftSE,Mt=Kt.rightSE,sr=[Xe],dr=Xe.point,Gr=[];Ar=Xe,Xe=Mt,sr.push(Xe),Xe.point!==dr;)for(;;){var Nn=Xe.getAvailableLinkedEvents();if(Nn.length===0){var On=sr[0].point,An=sr[sr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(On.x,",")+" ".concat(On.y,"]. Last matching segment found ends at")+" [".concat(An.x,", ").concat(An.y,"]."))}if(Nn.length===1){Mt=Nn[0].otherSE;break}for(var Tn=null,fi=0,ni=Gr.length;fi<ni;fi++)if(Gr[fi].point===Xe.point){Tn=fi;break}if(Tn!==null){var ta=Gr.splice(Tn)[0],ra=sr.splice(ta.index);ra.unshift(ra[0].otherSE),de.push(new Pt(ra.reverse()));continue}Gr.push({index:sr.length,point:Xe.point});var Zo=Xe.getLeftmostComparator(Ar);Mt=Nn.sort(Zo)[0].otherSE;break}de.push(new Pt(sr))}}return de}}]);function Pt(k){ee(this,Pt),this.events=k;for(var se=0,de=k.length;se<de;se++)k[se].segment.ringOut=this;this.poly=null}return ce(Pt,[{key:"getGeom",value:function(){for(var se=this.events[0].point,de=[se],je=1,mt=this.events.length-1;je<mt;je++){var Kt=this.events[je].point,Ar=this.events[je+1].point;q(Kt,se,Ar)!==0&&(de.push(Kt),se=Kt)}if(de.length===1)return null;var Xe=de[0],Mt=de[1];q(Xe,se,Mt)===0&&de.shift(),de.push(de[0]);for(var sr=this.isExteriorRing()?1:-1,dr=this.isExteriorRing()?0:de.length-1,Gr=this.isExteriorRing()?de.length:-1,Nn=[],On=dr;On!=Gr;On+=sr)Nn.push([de[On].x,de[On].y]);return Nn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var se=this.enclosingRing();this._isExteriorRing=se?!se.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var se=this.events[0],de=1,je=this.events.length;de<je;de++){var mt=this.events[de];St.compare(se,mt)>0&&(se=mt)}for(var Kt=se.segment.prevInResult(),Ar=Kt?Kt.prevInResult():null;;){if(!Kt)return null;if(!Ar)return Kt.ringOut;if(Ar.ringOut!==Kt.ringOut)return Ar.ringOut.enclosingRing()!==Kt.ringOut?Kt.ringOut:Kt.ringOut.enclosingRing();Kt=Ar.prevInResult(),Ar=Kt?Kt.prevInResult():null}}}]),Pt}(),Pn=function(){function Pt(k){ee(this,Pt),this.exteriorRing=k,k.poly=this,this.interiorRings=[]}return ce(Pt,[{key:"addInterior",value:function(se){this.interiorRings.push(se),se.poly=this}},{key:"getGeom",value:function(){var se=[this.exteriorRing.getGeom()];if(se[0]===null)return null;for(var de=0,je=this.interiorRings.length;de<je;de++){var mt=this.interiorRings[de].getGeom();mt!==null&&se.push(mt)}return se}}]),Pt}(),mi=function(){function Pt(k){ee(this,Pt),this.rings=k,this.polys=this._composePolys(k)}return ce(Pt,[{key:"getGeom",value:function(){for(var se=[],de=0,je=this.polys.length;de<je;de++){var mt=this.polys[de].getGeom();mt!==null&&se.push(mt)}return se}},{key:"_composePolys",value:function(se){for(var de=[],je=0,mt=se.length;je<mt;je++){var Kt=se[je];if(!Kt.poly)if(Kt.isExteriorRing())de.push(new Pn(Kt));else{var Ar=Kt.enclosingRing();Ar.poly||de.push(new Pn(Ar)),Ar.poly.addInterior(Kt)}}return de}}]),Pt}(),ei=function(){function Pt(k){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:or.compare;ee(this,Pt),this.queue=k,this.tree=new nt(se),this.segments=[]}return ce(Pt,[{key:"process",value:function(se){var de=se.segment,je=[];if(se.consumedBy)return se.isLeft?this.queue.remove(se.otherSE):this.tree.remove(de),je;var mt=se.isLeft?this.tree.insert(de):this.tree.find(de);if(!mt)throw new Error("Unable to find segment #".concat(de.id," ")+"[".concat(de.leftSE.point.x,", ").concat(de.leftSE.point.y,"] -> ")+"[".concat(de.rightSE.point.x,", ").concat(de.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Kt=mt,Ar=mt,Xe=void 0,Mt=void 0;Xe===void 0;)Kt=this.tree.prev(Kt),Kt===null?Xe=null:Kt.key.consumedBy===void 0&&(Xe=Kt.key);for(;Mt===void 0;)Ar=this.tree.next(Ar),Ar===null?Mt=null:Ar.key.consumedBy===void 0&&(Mt=Ar.key);if(se.isLeft){var sr=null;if(Xe){var dr=Xe.getIntersection(de);if(dr!==null&&(de.isAnEndpoint(dr)||(sr=dr),!Xe.isAnEndpoint(dr)))for(var Gr=this._splitSafely(Xe,dr),Nn=0,On=Gr.length;Nn<On;Nn++)je.push(Gr[Nn])}var An=null;if(Mt){var Tn=Mt.getIntersection(de);if(Tn!==null&&(de.isAnEndpoint(Tn)||(An=Tn),!Mt.isAnEndpoint(Tn)))for(var fi=this._splitSafely(Mt,Tn),ni=0,ta=fi.length;ni<ta;ni++)je.push(fi[ni])}if(sr!==null||An!==null){var ra=null;if(sr===null)ra=An;else if(An===null)ra=sr;else{var Zo=St.comparePoints(sr,An);ra=Zo<=0?sr:An}this.queue.remove(de.rightSE),je.push(de.rightSE);for(var Ts=de.split(ra),wi=0,G=Ts.length;wi<G;wi++)je.push(Ts[wi])}je.length>0?(this.tree.remove(de),je.push(se)):(this.segments.push(de),de.prev=Xe)}else{if(Xe&&Mt){var J=Xe.getIntersection(Mt);if(J!==null){if(!Xe.isAnEndpoint(J))for(var ue=this._splitSafely(Xe,J),be=0,ke=ue.length;be<ke;be++)je.push(ue[be]);if(!Mt.isAnEndpoint(J))for(var it=this._splitSafely(Mt,J),ct=0,me=it.length;ct<me;ct++)je.push(it[ct])}}this.tree.remove(de)}return je}},{key:"_splitSafely",value:function(se,de){this.tree.remove(se);var je=se.rightSE;this.queue.remove(je);var mt=se.split(de);return mt.push(je),se.consumedBy===void 0&&this.tree.insert(se),mt}}]),Pt}(),xn=typeof ge!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Fi=typeof ge!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,zi=function(){function Pt(){ee(this,Pt)}return ce(Pt,[{key:"run",value:function(se,de,je){Li.type=se,vt.reset();for(var mt=[new Kn(de,!0)],Kt=0,Ar=je.length;Kt<Ar;Kt++)mt.push(new Kn(je[Kt],!1));if(Li.numMultiPolys=mt.length,Li.type==="difference")for(var Xe=mt[0],Mt=1;Mt<mt.length;)Lr(mt[Mt].bbox,Xe.bbox)!==null?Mt++:mt.splice(Mt,1);if(Li.type==="intersection"){for(var sr=0,dr=mt.length;sr<dr;sr++)for(var Gr=mt[sr],Nn=sr+1,On=mt.length;Nn<On;Nn++)if(Lr(Gr.bbox,mt[Nn].bbox)===null)return[]}for(var An=new nt(St.compare),Tn=0,fi=mt.length;Tn<fi;Tn++)for(var ni=mt[Tn].getSweepEvents(),ta=0,ra=ni.length;ta<ra;ta++)if(An.insert(ni[ta]),An.size>xn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Zo=new ei(An),Ts=An.size,wi=An.pop();wi;){var G=wi.key;if(An.size===Ts){var J=G.segment;throw new Error("Unable to pop() ".concat(G.isLeft?"left":"right"," SweepEvent ")+"[".concat(G.point.x,", ").concat(G.point.y,"] from segment #").concat(J.id," ")+"[".concat(J.leftSE.point.x,", ").concat(J.leftSE.point.y,"] -> ")+"[".concat(J.rightSE.point.x,", ").concat(J.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(An.size>xn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Zo.segments.length>Fi)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ue=Zo.process(G),be=0,ke=ue.length;be<ke;be++){var it=ue[be];it.consumedBy===void 0&&An.insert(it)}Ts=An.size,wi=An.pop()}vt.reset();var ct=on.factory(Zo.segments),me=new mi(ct);return me.getGeom()}}]),Pt}(),Li=new zi,Qn=function(k){for(var se=arguments.length,de=new Array(se>1?se-1:0),je=1;je<se;je++)de[je-1]=arguments[je];return Li.run("union",k,de)},Ln=function(k){for(var se=arguments.length,de=new Array(se>1?se-1:0),je=1;je<se;je++)de[je-1]=arguments[je];return Li.run("intersection",k,de)},Fo=function(k){for(var se=arguments.length,de=new Array(se>1?se-1:0),je=1;je<se;je++)de[je-1]=arguments[je];return Li.run("xor",k,de)},sa=function(k){for(var se=arguments.length,de=new Array(se>1?se-1:0),je=1;je<se;je++)de[je-1]=arguments[je];return Li.run("difference",k,de)},ao={union:Qn,intersection:Ln,xor:Fo,difference:sa};return ao})},28660:function(yr,ne,N){var ge=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ee;(function(y){(function(ce){var z=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ae=te(y);typeof z.Reflect=="undefined"?z.Reflect=y:ae=te(z.Reflect,ae),ce(ae);function te(Pe,re){return function(Ze,Ke){typeof Pe[Ze]!="function"&&Object.defineProperty(Pe,Ze,{configurable:!0,writable:!0,value:Ke}),re&&re(Ze,Ke)}}})(function(ce){var z=Object.prototype.hasOwnProperty,ae=typeof Symbol=="function",te=ae&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Pe=ae&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",re=typeof Object.create=="function",Ze={__proto__:[]}instanceof Array,Ke=!re&&!Ze,nt={create:re?function(){return Ar(Object.create(null))}:Ze?function(){return Ar({__proto__:null})}:function(){return Ar({})},has:Ke?function(Xe,Mt){return z.call(Xe,Mt)}:function(Xe,Mt){return Mt in Xe},get:Ke?function(Xe,Mt){return z.call(Xe,Mt)?Xe[Mt]:void 0}:function(Xe,Mt){return Xe[Mt]}},Tt=Object.getPrototypeOf(Function),Ct=typeof ge=="object"&&ge["env"]&&ge["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",Gt=!Ct&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:je(),Jt=!Ct&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:mt(),Zt=!Ct&&typeof WeakMap=="function"?WeakMap:Kt(),wt=new Zt;function xt(Xe,Mt,sr,dr){if(Or(sr)){if(!Li(Xe))throw new TypeError;if(!Ln(Mt))throw new TypeError;return q(Xe,Mt)}else{if(!Li(Xe))throw new TypeError;if(!Pn(Mt))throw new TypeError;if(!Pn(dr)&&!Or(dr)&&!Kn(dr))throw new TypeError;return Kn(dr)&&(dr=void 0),sr=zi(sr),De(Xe,Mt,sr,dr)}}ce("decorate",xt);function Lr(Xe,Mt){function sr(dr,Gr){if(!Pn(dr))throw new TypeError;if(!Or(Gr)&&!Fo(Gr))throw new TypeError;St(Xe,Mt,dr,Gr)}return sr}ce("metadata",Lr);function mr(Xe,Mt,sr,dr){if(!Pn(sr))throw new TypeError;return Or(dr)||(dr=zi(dr)),St(Xe,Mt,sr,dr)}ce("defineMetadata",mr);function hr(Xe,Mt,sr){if(!Pn(Mt))throw new TypeError;return Or(sr)||(sr=zi(sr)),Me(Xe,Mt,sr)}ce("hasMetadata",hr);function Et(Xe,Mt,sr){if(!Pn(Mt))throw new TypeError;return Or(sr)||(sr=zi(sr)),Te(Xe,Mt,sr)}ce("hasOwnMetadata",Et);function lt(Xe,Mt,sr){if(!Pn(Mt))throw new TypeError;return Or(sr)||(sr=zi(sr)),ht(Xe,Mt,sr)}ce("getMetadata",lt);function Ut(Xe,Mt,sr){if(!Pn(Mt))throw new TypeError;return Or(sr)||(sr=zi(sr)),bt(Xe,Mt,sr)}ce("getOwnMetadata",Ut);function vt(Xe,Mt){if(!Pn(Xe))throw new TypeError;return Or(Mt)||(Mt=zi(Mt)),qt(Xe,Mt)}ce("getMetadataKeys",vt);function er(Xe,Mt){if(!Pn(Xe))throw new TypeError;return Or(Mt)||(Mt=zi(Mt)),or(Xe,Mt)}ce("getOwnMetadataKeys",er);function xr(Xe,Mt,sr){if(!Pn(Mt))throw new TypeError;Or(sr)||(sr=zi(sr));var dr=F(Mt,sr,!1);if(Or(dr)||!dr.delete(Xe))return!1;if(dr.size>0)return!0;var Gr=wt.get(Mt);return Gr.delete(sr),Gr.size>0||wt.delete(Mt),!0}ce("deleteMetadata",xr);function q(Xe,Mt){for(var sr=Xe.length-1;sr>=0;--sr){var dr=Xe[sr],Gr=dr(Mt);if(!Or(Gr)&&!Kn(Gr)){if(!Ln(Gr))throw new TypeError;Mt=Gr}}return Mt}function De(Xe,Mt,sr,dr){for(var Gr=Xe.length-1;Gr>=0;--Gr){var Nn=Xe[Gr],On=Nn(Mt,sr,dr);if(!Or(On)&&!Kn(On)){if(!Pn(On))throw new TypeError;dr=On}}return dr}function F(Xe,Mt,sr){var dr=wt.get(Xe);if(Or(dr)){if(!sr)return;dr=new Gt,wt.set(Xe,dr)}var Gr=dr.get(Mt);if(Or(Gr)){if(!sr)return;Gr=new Gt,dr.set(Mt,Gr)}return Gr}function Me(Xe,Mt,sr){var dr=Te(Xe,Mt,sr);if(dr)return!0;var Gr=de(Mt);return Kn(Gr)?!1:Me(Xe,Gr,sr)}function Te(Xe,Mt,sr){var dr=F(Mt,sr,!1);return Or(dr)?!1:xn(dr.has(Xe))}function ht(Xe,Mt,sr){var dr=Te(Xe,Mt,sr);if(dr)return bt(Xe,Mt,sr);var Gr=de(Mt);if(!Kn(Gr))return ht(Xe,Gr,sr)}function bt(Xe,Mt,sr){var dr=F(Mt,sr,!1);if(!Or(dr))return dr.get(Xe)}function St(Xe,Mt,sr,dr){var Gr=F(sr,dr,!0);Gr.set(Xe,Mt)}function qt(Xe,Mt){var sr=or(Xe,Mt),dr=de(Xe);if(dr===null)return sr;var Gr=qt(dr,Mt);if(Gr.length<=0)return sr;if(sr.length<=0)return Gr;for(var Nn=new Jt,On=[],An=0,Tn=sr;An<Tn.length;An++){var fi=Tn[An],ni=Nn.has(fi);ni||(Nn.add(fi),On.push(fi))}for(var ta=0,ra=Gr;ta<ra.length;ta++){var fi=ra[ta],ni=Nn.has(fi);ni||(Nn.add(fi),On.push(fi))}return On}function or(Xe,Mt){var sr=[],dr=F(Xe,Mt,!1);if(Or(dr))return sr;for(var Gr=dr.keys(),Nn=ao(Gr),On=0;;){var An=k(Nn);if(!An)return sr.length=On,sr;var Tn=Pt(An);try{sr[On]=Tn}catch(fi){try{se(Nn)}finally{throw fi}}On++}}function rn(Xe){if(Xe===null)return 1;switch(typeof Xe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Xe===null?1:6;default:return 6}}function Or(Xe){return Xe===void 0}function Kn(Xe){return Xe===null}function on(Xe){return typeof Xe=="symbol"}function Pn(Xe){return typeof Xe=="object"?Xe!==null:typeof Xe=="function"}function mi(Xe,Mt){switch(rn(Xe)){case 0:return Xe;case 1:return Xe;case 2:return Xe;case 3:return Xe;case 4:return Xe;case 5:return Xe}var sr=Mt===3?"string":Mt===5?"number":"default",dr=sa(Xe,te);if(dr!==void 0){var Gr=dr.call(Xe,sr);if(Pn(Gr))throw new TypeError;return Gr}return ei(Xe,sr==="default"?"number":sr)}function ei(Xe,Mt){if(Mt==="string"){var sr=Xe.toString;if(Qn(sr)){var dr=sr.call(Xe);if(!Pn(dr))return dr}var Gr=Xe.valueOf;if(Qn(Gr)){var dr=Gr.call(Xe);if(!Pn(dr))return dr}}else{var Gr=Xe.valueOf;if(Qn(Gr)){var dr=Gr.call(Xe);if(!Pn(dr))return dr}var Nn=Xe.toString;if(Qn(Nn)){var dr=Nn.call(Xe);if(!Pn(dr))return dr}}throw new TypeError}function xn(Xe){return!!Xe}function Fi(Xe){return""+Xe}function zi(Xe){var Mt=mi(Xe,3);return on(Mt)?Mt:Fi(Mt)}function Li(Xe){return Array.isArray?Array.isArray(Xe):Xe instanceof Object?Xe instanceof Array:Object.prototype.toString.call(Xe)==="[object Array]"}function Qn(Xe){return typeof Xe=="function"}function Ln(Xe){return typeof Xe=="function"}function Fo(Xe){switch(rn(Xe)){case 3:return!0;case 4:return!0;default:return!1}}function sa(Xe,Mt){var sr=Xe[Mt];if(sr!=null){if(!Qn(sr))throw new TypeError;return sr}}function ao(Xe){var Mt=sa(Xe,Pe);if(!Qn(Mt))throw new TypeError;var sr=Mt.call(Xe);if(!Pn(sr))throw new TypeError;return sr}function Pt(Xe){return Xe.value}function k(Xe){var Mt=Xe.next();return Mt.done?!1:Mt}function se(Xe){var Mt=Xe.return;Mt&&Mt.call(Xe)}function de(Xe){var Mt=Object.getPrototypeOf(Xe);if(typeof Xe!="function"||Xe===Tt||Mt!==Tt)return Mt;var sr=Xe.prototype,dr=sr&&Object.getPrototypeOf(sr);if(dr==null||dr===Object.prototype)return Mt;var Gr=dr.constructor;return typeof Gr!="function"||Gr===Xe?Mt:Gr}function je(){var Xe={},Mt=[],sr=function(){function On(An,Tn,fi){this._index=0,this._keys=An,this._values=Tn,this._selector=fi}return On.prototype["@@iterator"]=function(){return this},On.prototype[Pe]=function(){return this},On.prototype.next=function(){var An=this._index;if(An>=0&&An<this._keys.length){var Tn=this._selector(this._keys[An],this._values[An]);return An+1>=this._keys.length?(this._index=-1,this._keys=Mt,this._values=Mt):this._index++,{value:Tn,done:!1}}return{value:void 0,done:!0}},On.prototype.throw=function(An){throw this._index>=0&&(this._index=-1,this._keys=Mt,this._values=Mt),An},On.prototype.return=function(An){return this._index>=0&&(this._index=-1,this._keys=Mt,this._values=Mt),{value:An,done:!0}},On}();return function(){function On(){this._keys=[],this._values=[],this._cacheKey=Xe,this._cacheIndex=-2}return Object.defineProperty(On.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),On.prototype.has=function(An){return this._find(An,!1)>=0},On.prototype.get=function(An){var Tn=this._find(An,!1);return Tn>=0?this._values[Tn]:void 0},On.prototype.set=function(An,Tn){var fi=this._find(An,!0);return this._values[fi]=Tn,this},On.prototype.delete=function(An){var Tn=this._find(An,!1);if(Tn>=0){for(var fi=this._keys.length,ni=Tn+1;ni<fi;ni++)this._keys[ni-1]=this._keys[ni],this._values[ni-1]=this._values[ni];return this._keys.length--,this._values.length--,An===this._cacheKey&&(this._cacheKey=Xe,this._cacheIndex=-2),!0}return!1},On.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Xe,this._cacheIndex=-2},On.prototype.keys=function(){return new sr(this._keys,this._values,dr)},On.prototype.values=function(){return new sr(this._keys,this._values,Gr)},On.prototype.entries=function(){return new sr(this._keys,this._values,Nn)},On.prototype["@@iterator"]=function(){return this.entries()},On.prototype[Pe]=function(){return this.entries()},On.prototype._find=function(An,Tn){return this._cacheKey!==An&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=An)),this._cacheIndex<0&&Tn&&(this._cacheIndex=this._keys.length,this._keys.push(An),this._values.push(void 0)),this._cacheIndex},On}();function dr(On,An){return On}function Gr(On,An){return An}function Nn(On,An){return[On,An]}}function mt(){return function(){function Xe(){this._map=new Gt}return Object.defineProperty(Xe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Xe.prototype.has=function(Mt){return this._map.has(Mt)},Xe.prototype.add=function(Mt){return this._map.set(Mt,Mt),this},Xe.prototype.delete=function(Mt){return this._map.delete(Mt)},Xe.prototype.clear=function(){this._map.clear()},Xe.prototype.keys=function(){return this._map.keys()},Xe.prototype.values=function(){return this._map.values()},Xe.prototype.entries=function(){return this._map.entries()},Xe.prototype["@@iterator"]=function(){return this.keys()},Xe.prototype[Pe]=function(){return this.keys()},Xe}()}function Kt(){var Xe=16,Mt=nt.create(),sr=dr();return function(){function Tn(){this._key=dr()}return Tn.prototype.has=function(fi){var ni=Gr(fi,!1);return ni!==void 0?nt.has(ni,this._key):!1},Tn.prototype.get=function(fi){var ni=Gr(fi,!1);return ni!==void 0?nt.get(ni,this._key):void 0},Tn.prototype.set=function(fi,ni){var ta=Gr(fi,!0);return ta[this._key]=ni,this},Tn.prototype.delete=function(fi){var ni=Gr(fi,!1);return ni!==void 0?delete ni[this._key]:!1},Tn.prototype.clear=function(){this._key=dr()},Tn}();function dr(){var Tn;do Tn="@@WeakMap@@"+An();while(nt.has(Mt,Tn));return Mt[Tn]=!0,Tn}function Gr(Tn,fi){if(!z.call(Tn,sr)){if(!fi)return;Object.defineProperty(Tn,sr,{value:nt.create()})}return Tn[sr]}function Nn(Tn,fi){for(var ni=0;ni<fi;++ni)Tn[ni]=Math.random()*255|0;return Tn}function On(Tn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Tn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Tn)):Nn(new Uint8Array(Tn),Tn):Nn(new Array(Tn),Tn)}function An(){var Tn=On(Xe);Tn[6]=Tn[6]&79|64,Tn[8]=Tn[8]&191|128;for(var fi="",ni=0;ni<Xe;++ni){var ta=Tn[ni];(ni===4||ni===6||ni===8)&&(fi+="-"),ta<16&&(fi+="0"),fi+=ta.toString(16).toLowerCase()}return fi}}function Ar(Xe){return Xe.__=void 0,delete Xe.__,Xe}})})(ee||(ee={}))},81550:function(yr){(function(ne,N){yr.exports=N()})(this,function(){"use strict";var ne=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},N=function(V,Se){for(var He=Object.keys(Se),Ht=0;Ht<He.length;++Ht)V[He[Ht]]=Se[He[Ht]];return V},ge=`
`;function ee(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function y(V){var Se=new Error("(regl) "+V);throw console.error(Se),Se}function ce(V,Se){V||y(Se)}function z(V){return V?": "+V:""}function ae(V,Se,He){V in Se||y("unknown parameter ("+V+")"+z(He)+". possible values: "+Object.keys(Se).join())}function te(V,Se){ne(V)||y("invalid parameter type"+z(Se)+". must be a typed array")}function Pe(V,Se){switch(Se){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function re(V,Se,He){Pe(V,Se)||y("invalid parameter type"+z(He)+". expected "+Se+", got "+typeof V)}function Ze(V,Se){V>=0&&(V|0)===V||y("invalid parameter type, ("+V+")"+z(Se)+". must be a nonnegative integer")}function Ke(V,Se,He){Se.indexOf(V)<0&&y("invalid value"+z(He)+". must be one of: "+Se)}var nt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Tt(V){Object.keys(V).forEach(function(Se){nt.indexOf(Se)<0&&y('invalid regl constructor argument "'+Se+'". must be one of '+nt)})}function Ct(V,Se){for(V=V+"";V.length<Se;)V=" "+V;return V}function Gt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Jt(V,Se){this.number=V,this.line=Se,this.errors=[]}function Zt(V,Se,He){this.file=V,this.line=Se,this.message=He}function wt(){var V=new Error,Se=(V.stack||V).toString(),He=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(He)return He[1];var Ht=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return Ht?Ht[1]:"unknown"}function xt(){var V=new Error,Se=(V.stack||V).toString(),He=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(He)return He[1];var Ht=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return Ht?Ht[1]:"unknown"}function Lr(V,Se){var He=V.split(`
`),Ht=1,cr=0,Xt={unknown:new Gt,0:new Gt};Xt.unknown.name=Xt[0].name=Se||wt(),Xt.unknown.lines.push(new Jt(0,""));for(var Lt=0;Lt<He.length;++Lt){var Dr=He[Lt],Tr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Dr);if(Tr)switch(Tr[1]){case"line":var Vr=/(\d+)(\s+\d+)?/.exec(Tr[2]);Vr&&(Ht=Vr[1]|0,Vr[2]&&(cr=Vr[2]|0,cr in Xt||(Xt[cr]=new Gt)));break;case"define":var kr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Tr[2]);kr&&(Xt[cr].name=kr[1]?ee(kr[2]):kr[2]);break}Xt[cr].lines.push(new Jt(Ht++,Dr))}return Object.keys(Xt).forEach(function(Zr){var Xr=Xt[Zr];Xr.lines.forEach(function(wr){Xr.index[wr.number]=wr})}),Xt}function mr(V){var Se=[];return V.split(`
`).forEach(function(He){if(!(He.length<5)){var Ht=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(He);Ht?Se.push(new Zt(Ht[1]|0,Ht[2]|0,Ht[3].trim())):He.length>0&&Se.push(new Zt("unknown",0,He))}}),Se}function hr(V,Se){Se.forEach(function(He){var Ht=V[He.file];if(Ht){var cr=Ht.index[He.line];if(cr){cr.errors.push(He),Ht.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push(He)})}function Et(V,Se,He,Ht,cr){if(!V.getShaderParameter(Se,V.COMPILE_STATUS)){var Xt=V.getShaderInfoLog(Se),Lt=Ht===V.FRAGMENT_SHADER?"fragment":"vertex";De(He,"string",Lt+" shader source must be a string",cr);var Dr=Lr(He,cr),Tr=mr(Xt);hr(Dr,Tr),Object.keys(Dr).forEach(function(Vr){var kr=Dr[Vr];if(!kr.hasErrors)return;var Zr=[""],Xr=[""];function wr(Nr,At){Zr.push(Nr),Xr.push(At||"")}wr("file number "+Vr+": "+kr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),kr.lines.forEach(function(Nr){if(Nr.errors.length>0){wr(Ct(Nr.number,4)+"|  ","background-color:yellow; font-weight:bold"),wr(Nr.line+ge,"color:red; background-color:yellow; font-weight:bold");var At=0;Nr.errors.forEach(function(tr){var Ir=tr.message,tn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Ir);if(tn){var gr=tn[1];switch(Ir=tn[2],gr){case"assign":gr="=";break}At=Math.max(Nr.line.indexOf(gr,At),0)}else At=0;wr(Ct("| ",6)),wr(Ct("^^^",At+3)+ge,"font-weight:bold"),wr(Ct("| ",6)),wr(Ir+ge,"font-weight:bold")}),wr(Ct("| ",6)+ge)}else wr(Ct(Nr.number,4)+"|  "),wr(Nr.line+ge,"color:red")}),typeof document!="undefined"&&!window.chrome?(Xr[0]=Zr.join("%c"),console.log.apply(console,Xr)):console.log(Zr.join(""))}),ce.raise("Error compiling "+Lt+" shader, "+Dr[0].name)}}function lt(V,Se,He,Ht,cr){if(!V.getProgramParameter(Se,V.LINK_STATUS)){var Xt=V.getProgramInfoLog(Se),Lt=Lr(He,cr),Dr=Lr(Ht,cr),Tr='Error linking program with vertex shader, "'+Dr[0].name+'", and fragment shader "'+Lt[0].name+'"';typeof document!="undefined"?console.log("%c"+Tr+ge+"%c"+Xt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Tr+ge+Xt),ce.raise(Tr)}}function Ut(V){V._commandRef=wt()}function vt(V,Se,He,Ht){Ut(V);function cr(Tr){return Tr?Ht.id(Tr):0}V._fragId=cr(V.static.frag),V._vertId=cr(V.static.vert);function Xt(Tr,Vr){Object.keys(Vr).forEach(function(kr){Tr[Ht.id(kr)]=!0})}var Lt=V._uniformSet={};Xt(Lt,Se.static),Xt(Lt,Se.dynamic);var Dr=V._attributeSet={};Xt(Dr,He.static),Xt(Dr,He.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function er(V,Se){var He=xt();y(V+" in command "+(Se||wt())+(He==="unknown"?"":" called from "+He))}function xr(V,Se,He){V||er(Se,He||wt())}function q(V,Se,He,Ht){V in Se||er("unknown parameter ("+V+")"+z(He)+". possible values: "+Object.keys(Se).join(),Ht||wt())}function De(V,Se,He,Ht){Pe(V,Se)||er("invalid parameter type"+z(He)+". expected "+Se+", got "+typeof V,Ht||wt())}function F(V){V()}function Me(V,Se,He){V.texture?Ke(V.texture._texture.internalformat,Se,"unsupported texture format for attachment"):Ke(V.renderbuffer._renderbuffer.format,He,"unsupported renderbuffer format for attachment")}var Te=33071,ht=9728,bt=9984,St=9985,qt=9986,or=9987,rn=5120,Or=5121,Kn=5122,on=5123,Pn=5124,mi=5125,ei=5126,xn=32819,Fi=32820,zi=33635,Li=34042,Qn=36193,Ln={};Ln[rn]=Ln[Or]=1,Ln[Kn]=Ln[on]=Ln[Qn]=Ln[zi]=Ln[xn]=Ln[Fi]=2,Ln[Pn]=Ln[mi]=Ln[ei]=Ln[Li]=4;function Fo(V,Se){return V===Fi||V===xn||V===zi?2:V===Li?4:Ln[V]*Se}function sa(V){return!(V&V-1)&&!!V}function ao(V,Se,He){var Ht,cr=Se.width,Xt=Se.height,Lt=Se.channels;ce(cr>0&&cr<=He.maxTextureSize&&Xt>0&&Xt<=He.maxTextureSize,"invalid texture shape"),(V.wrapS!==Te||V.wrapT!==Te)&&ce(sa(cr)&&sa(Xt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?cr!==1&&Xt!==1&&ce(V.minFilter!==bt&&V.minFilter!==qt&&V.minFilter!==St&&V.minFilter!==or,"min filter requires mipmap"):(ce(sa(cr)&&sa(Xt),"texture must be a square power of 2 to support mipmapping"),ce(Se.mipmask===(cr<<1)-1,"missing or incomplete mipmap data")),Se.type===ei&&(He.extensions.indexOf("oes_texture_float_linear")<0&&ce(V.minFilter===ht&&V.magFilter===ht,"filter not supported, must enable oes_texture_float_linear"),ce(!V.genMipmaps,"mipmap generation not supported with float textures"));var Dr=Se.images;for(Ht=0;Ht<16;++Ht)if(Dr[Ht]){var Tr=cr>>Ht,Vr=Xt>>Ht;ce(Se.mipmask&1<<Ht,"missing mipmap data");var kr=Dr[Ht];if(ce(kr.width===Tr&&kr.height===Vr,"invalid shape for mip images"),ce(kr.format===Se.format&&kr.internalformat===Se.internalformat&&kr.type===Se.type,"incompatible type for mip image"),!kr.compressed)if(kr.data){var Zr=Math.ceil(Fo(kr.type,Lt)*Tr/kr.unpackAlignment)*kr.unpackAlignment;ce(kr.data.byteLength===Zr*Vr,"invalid data for image, buffer size is inconsistent with image format")}else kr.element||kr.copy}else V.genMipmaps||ce((Se.mipmask&1<<Ht)==0,"extra mipmap data");Se.compressed&&ce(!V.genMipmaps,"mipmap generation for compressed images not supported")}function Pt(V,Se,He,Ht){var cr=V.width,Xt=V.height,Lt=V.channels;ce(cr>0&&cr<=Ht.maxTextureSize&&Xt>0&&Xt<=Ht.maxTextureSize,"invalid texture shape"),ce(cr===Xt,"cube map must be square"),ce(Se.wrapS===Te&&Se.wrapT===Te,"wrap mode not supported by cube map");for(var Dr=0;Dr<He.length;++Dr){var Tr=He[Dr];ce(Tr.width===cr&&Tr.height===Xt,"inconsistent cube map face shape"),Se.genMipmaps&&(ce(!Tr.compressed,"can not generate mipmap for compressed textures"),ce(Tr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Vr=Tr.images,kr=0;kr<16;++kr){var Zr=Vr[kr];if(Zr){var Xr=cr>>kr,wr=Xt>>kr;ce(Tr.mipmask&1<<kr,"missing mipmap data"),ce(Zr.width===Xr&&Zr.height===wr,"invalid shape for mip images"),ce(Zr.format===V.format&&Zr.internalformat===V.internalformat&&Zr.type===V.type,"incompatible type for mip image"),Zr.compressed||(Zr.data?ce(Zr.data.byteLength===Xr*wr*Math.max(Fo(Zr.type,Lt),Zr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Zr.element||Zr.copy)}}}}var k=N(ce,{optional:F,raise:y,commandRaise:er,command:xr,parameter:ae,commandParameter:q,constructor:Tt,type:re,commandType:De,isTypedArray:te,nni:Ze,oneOf:Ke,shaderError:Et,linkError:lt,callSite:xt,saveCommandRef:Ut,saveDrawInfo:vt,framebufferFormat:Me,guessCommand:wt,texture2D:ao,textureCube:Pt}),se=0,de=0;function je(V,Se){this.id=se++,this.type=V,this.data=Se}function mt(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Kt(V){if(V.length===0)return[];var Se=V.charAt(0),He=V.charAt(V.length-1);if(V.length>1&&Se===He&&(Se==='"'||Se==="'"))return['"'+mt(V.substr(1,V.length-2))+'"'];var Ht=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(Ht)return Kt(V.substr(0,Ht.index)).concat(Kt(Ht[1])).concat(Kt(V.substr(Ht.index+Ht[0].length)));var cr=V.split(".");if(cr.length===1)return['"'+mt(V)+'"'];for(var Xt=[],Lt=0;Lt<cr.length;++Lt)Xt=Xt.concat(Kt(cr[Lt]));return Xt}function Ar(V){return"["+Kt(V).join("][")+"]"}function Xe(V,Se){return new je(V,Ar(Se+""))}function Mt(V){return typeof V=="function"&&!V._reglType||V instanceof je}function sr(V,Se){return typeof V=="function"?new je(de,V):V}var dr={DynamicVariable:je,define:Xe,isDynamic:Mt,unbox:sr,accessor:Ar},Gr={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},Nn=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function On(){var V={"":0},Se=[""];return{id:function(He){var Ht=V[He];return Ht||(Ht=V[He]=Se.length,Se.push(He),Ht)},str:function(He){return Se[He]}}}function An(V,Se,He){var Ht=document.createElement("canvas");N(Ht.style,{border:0,margin:0,padding:0,top:0,left:0}),V.appendChild(Ht),V===document.body&&(Ht.style.position="absolute",N(V.style,{margin:0,padding:0}));function cr(){var Dr=window.innerWidth,Tr=window.innerHeight;if(V!==document.body){var Vr=V.getBoundingClientRect();Dr=Vr.right-Vr.left,Tr=Vr.bottom-Vr.top}Ht.width=He*Dr,Ht.height=He*Tr,N(Ht.style,{width:Dr+"px",height:Tr+"px"})}var Xt;V!==document.body&&typeof ResizeObserver=="function"?(Xt=new ResizeObserver(function(){setTimeout(cr)}),Xt.observe(V)):window.addEventListener("resize",cr,!1);function Lt(){Xt?Xt.disconnect():window.removeEventListener("resize",cr),V.removeChild(Ht)}return cr(),{canvas:Ht,onDestroy:Lt}}function Tn(V,Se){function He(Ht){try{return V.getContext(Ht,Se)}catch(cr){return null}}return He("webgl")||He("experimental-webgl")||He("webgl-experimental")}function fi(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function ni(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ta(V){return typeof V=="string"?V.split():(k(Array.isArray(V),"invalid extension array"),V)}function ra(V){return typeof V=="string"?(k(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function Zo(V){var Se=V||{},He,Ht,cr,Xt,Lt={},Dr=[],Tr=[],Vr=typeof window=="undefined"?1:window.devicePixelRatio,kr=!1,Zr=function(Nr){Nr&&k.raise(Nr)},Xr=function(){};if(typeof Se=="string"?(k(typeof document!="undefined","selector queries only supported in DOM enviroments"),He=document.querySelector(Se),k(He,"invalid query string for element")):typeof Se=="object"?fi(Se)?He=Se:ni(Se)?(Xt=Se,cr=Xt.canvas):(k.constructor(Se),"gl"in Se?Xt=Se.gl:"canvas"in Se?cr=ra(Se.canvas):"container"in Se&&(Ht=ra(Se.container)),"attributes"in Se&&(Lt=Se.attributes,k.type(Lt,"object","invalid context attributes")),"extensions"in Se&&(Dr=ta(Se.extensions)),"optionalExtensions"in Se&&(Tr=ta(Se.optionalExtensions)),"onDone"in Se&&(k.type(Se.onDone,"function","invalid or missing onDone callback"),Zr=Se.onDone),"profile"in Se&&(kr=!!Se.profile),"pixelRatio"in Se&&(Vr=+Se.pixelRatio,k(Vr>0,"invalid pixel ratio"))):k.raise("invalid arguments to regl"),He&&(He.nodeName.toLowerCase()==="canvas"?cr=He:Ht=He),!Xt){if(!cr){k(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var wr=An(Ht||document.body,Zr,Vr);if(!wr)return null;cr=wr.canvas,Xr=wr.onDestroy}Lt.premultipliedAlpha===void 0&&(Lt.premultipliedAlpha=!0),Xt=Tn(cr,Lt)}return Xt?{gl:Xt,canvas:cr,container:Ht,extensions:Dr,optionalExtensions:Tr,pixelRatio:Vr,profile:kr,onDone:Zr,onDestroy:Xr}:(Xr(),Zr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ts(V,Se){var He={};function Ht(Lt){k.type(Lt,"string","extension name must be string");var Dr=Lt.toLowerCase(),Tr;try{Tr=He[Dr]=V.getExtension(Dr)}catch(Vr){}return!!Tr}for(var cr=0;cr<Se.extensions.length;++cr){var Xt=Se.extensions[cr];if(!Ht(Xt))return Se.onDestroy(),Se.onDone('"'+Xt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(Ht),{extensions:He,restore:function(){Object.keys(He).forEach(function(Lt){if(He[Lt]&&!Ht(Lt))throw new Error("(regl): error restoring extension "+Lt)})}}}function wi(V,Se){for(var He=Array(V),Ht=0;Ht<V;++Ht)He[Ht]=Se(Ht);return He}var G=5120,J=5121,ue=5122,be=5123,ke=5124,it=5125,ct=5126;function me(V){for(var Se=16;Se<=1<<28;Se*=16)if(V<=Se)return Se;return 0}function Y(V){var Se,He;return Se=(V>65535)<<4,V>>>=Se,He=(V>255)<<3,V>>>=He,Se|=He,He=(V>15)<<2,V>>>=He,Se|=He,He=(V>3)<<1,V>>>=He,Se|=He,Se|V>>1}function ye(){var V=wi(8,function(){return[]});function Se(Xt){var Lt=me(Xt),Dr=V[Y(Lt)>>2];return Dr.length>0?Dr.pop():new ArrayBuffer(Lt)}function He(Xt){V[Y(Xt.byteLength)>>2].push(Xt)}function Ht(Xt,Lt){var Dr=null;switch(Xt){case G:Dr=new Int8Array(Se(Lt),0,Lt);break;case J:Dr=new Uint8Array(Se(Lt),0,Lt);break;case ue:Dr=new Int16Array(Se(2*Lt),0,Lt);break;case be:Dr=new Uint16Array(Se(2*Lt),0,Lt);break;case ke:Dr=new Int32Array(Se(4*Lt),0,Lt);break;case it:Dr=new Uint32Array(Se(4*Lt),0,Lt);break;case ct:Dr=new Float32Array(Se(4*Lt),0,Lt);break;default:return null}return Dr.length!==Lt?Dr.subarray(0,Lt):Dr}function cr(Xt){He(Xt.buffer)}return{alloc:Se,free:He,allocType:Ht,freeType:cr}}var tt=ye();tt.zero=ye();var gt=3408,le=3410,br=3411,En=3412,vn=3413,rr=3414,nn=3415,Hr=33901,Yr=33902,gi=3379,Jr=3386,xi=34921,Gi=36347,_i=36348,Ci=35661,Ri=35660,go=34930,Ji=36349,Sa=34076,Mi=34024,yi=7936,Ai=7937,Ca=7938,Vs=35724,va=34047,Ra=36063,Yu=34852,nu=3553,xa=34067,as=34069,ii=33984,ua=6408,Ma=5126,na=5121,Yo=36160,Vo=36053,Du=36064,ws=16384,fc=function(V,Se){var He=1;Se.ext_texture_filter_anisotropic&&(He=V.getParameter(va));var Ht=1,cr=1;Se.webgl_draw_buffers&&(Ht=V.getParameter(Yu),cr=V.getParameter(Ra));var Xt=!!Se.oes_texture_float;if(Xt){var Lt=V.createTexture();V.bindTexture(nu,Lt),V.texImage2D(nu,0,ua,1,1,0,ua,Ma,null);var Dr=V.createFramebuffer();if(V.bindFramebuffer(Yo,Dr),V.framebufferTexture2D(Yo,Du,nu,Lt,0),V.bindTexture(nu,null),V.checkFramebufferStatus(Yo)!==Vo)Xt=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(ws);var Tr=tt.allocType(Ma,4);V.readPixels(0,0,1,1,ua,Ma,Tr),V.getError()?Xt=!1:(V.deleteFramebuffer(Dr),V.deleteTexture(Lt),Xt=Tr[0]===1),tt.freeType(Tr)}}var Vr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),kr=!0;if(!Vr){var Zr=V.createTexture(),Xr=tt.allocType(na,36);V.activeTexture(ii),V.bindTexture(xa,Zr),V.texImage2D(as,0,ua,3,3,0,ua,na,Xr),tt.freeType(Xr),V.bindTexture(xa,null),V.deleteTexture(Zr),kr=!V.getError()}return{colorBits:[V.getParameter(le),V.getParameter(br),V.getParameter(En),V.getParameter(vn)],depthBits:V.getParameter(rr),stencilBits:V.getParameter(nn),subpixelBits:V.getParameter(gt),extensions:Object.keys(Se).filter(function(wr){return!!Se[wr]}),maxAnisotropic:He,maxDrawbuffers:Ht,maxColorAttachments:cr,pointSizeDims:V.getParameter(Hr),lineWidthDims:V.getParameter(Yr),maxViewportDims:V.getParameter(Jr),maxCombinedTextureUnits:V.getParameter(Ci),maxCubeMapSize:V.getParameter(Sa),maxRenderbufferSize:V.getParameter(Mi),maxTextureUnits:V.getParameter(go),maxTextureSize:V.getParameter(gi),maxAttributes:V.getParameter(xi),maxVertexUniforms:V.getParameter(Gi),maxVertexTextureUnits:V.getParameter(Ri),maxVaryingVectors:V.getParameter(_i),maxFragmentUniforms:V.getParameter(Ji),glsl:V.getParameter(Vs),renderer:V.getParameter(Ai),vendor:V.getParameter(yi),version:V.getParameter(Ca),readFloat:Xt,npotTextureCube:kr}};function Da(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||ne(V.data))}var ji=function(V){return Object.keys(V).map(function(Se){return V[Se]})},jo={shape:Wr,flatten:nr};function Wt(V,Se,He){for(var Ht=0;Ht<Se;++Ht)He[Ht]=V[Ht]}function K(V,Se,He,Ht){for(var cr=0,Xt=0;Xt<Se;++Xt)for(var Lt=V[Xt],Dr=0;Dr<He;++Dr)Ht[cr++]=Lt[Dr]}function Re(V,Se,He,Ht,cr,Xt){for(var Lt=Xt,Dr=0;Dr<Se;++Dr)for(var Tr=V[Dr],Vr=0;Vr<He;++Vr)for(var kr=Tr[Vr],Zr=0;Zr<Ht;++Zr)cr[Lt++]=kr[Zr]}function st(V,Se,He,Ht,cr){for(var Xt=1,Lt=He+1;Lt<Se.length;++Lt)Xt*=Se[Lt];var Dr=Se[He];if(Se.length-He==4){var Tr=Se[He+1],Vr=Se[He+2],kr=Se[He+3];for(Lt=0;Lt<Dr;++Lt)Re(V[Lt],Tr,Vr,kr,Ht,cr),cr+=Xt}else for(Lt=0;Lt<Dr;++Lt)st(V[Lt],Se,He+1,Ht,cr),cr+=Xt}function nr(V,Se,He,Ht){var cr=1;if(Se.length)for(var Xt=0;Xt<Se.length;++Xt)cr*=Se[Xt];else cr=0;var Lt=Ht||tt.allocType(He,cr);switch(Se.length){case 0:break;case 1:Wt(V,Se[0],Lt);break;case 2:K(V,Se[0],Se[1],Lt);break;case 3:Re(V,Se[0],Se[1],Se[2],Lt,0);break;default:st(V,Se,0,Lt,0)}return Lt}function Wr(V){for(var Se=[],He=V;He.length;He=He[0])Se.push(He.length);return Se}var Dn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Hi=5120,oo=5122,_o=5124,to=5121,Cs=5123,Uc=5125,iu=5126,mf=5126,Ho={int8:Hi,int16:oo,int32:_o,uint8:to,uint16:Cs,uint32:Uc,float:iu,float32:mf},yl=35048,xl=35040,Fu={dynamic:yl,stream:xl,static:35044},ku=jo.flatten,qu=jo.shape,zc=35044,Rs=35040,Za=5121,bl=5126,Ku=[];Ku[5120]=1,Ku[5122]=2,Ku[5124]=4,Ku[5121]=1,Ku[5123]=2,Ku[5125]=4,Ku[5126]=4;function gf(V){return Dn[Object.prototype.toString.call(V)]|0}function zh(V,Se){for(var He=0;He<Se.length;++He)V[He]=Se[He]}function _f(V,Se,He,Ht,cr,Xt,Lt){for(var Dr=0,Tr=0;Tr<He;++Tr)for(var Vr=0;Vr<Ht;++Vr)V[Dr++]=Se[cr*Tr+Xt*Vr+Lt]}function rh(V,Se,He,Ht){var cr=0,Xt={};function Lt(At){this.id=cr++,this.buffer=V.createBuffer(),this.type=At,this.usage=zc,this.byteLength=0,this.dimension=1,this.dtype=Za,this.persistentData=null,He.profile&&(this.stats={size:0})}Lt.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},Lt.prototype.destroy=function(){Xr(this)};var Dr=[];function Tr(At,tr){var Ir=Dr.pop();return Ir||(Ir=new Lt(At)),Ir.bind(),Zr(Ir,tr,Rs,0,1,!1),Ir}function Vr(At){Dr.push(At)}function kr(At,tr,Ir){At.byteLength=tr.byteLength,V.bufferData(At.type,tr,Ir)}function Zr(At,tr,Ir,tn,gr,sn){var Cr;if(At.usage=Ir,Array.isArray(tr)){if(At.dtype=tn||bl,tr.length>0){var en;if(Array.isArray(tr[0])){Cr=qu(tr);for(var _r=1,Kr=1;Kr<Cr.length;++Kr)_r*=Cr[Kr];At.dimension=_r,en=ku(tr,Cr,At.dtype),kr(At,en,Ir),sn?At.persistentData=en:tt.freeType(en)}else if(typeof tr[0]=="number"){At.dimension=gr;var Vn=tt.allocType(At.dtype,tr.length);zh(Vn,tr),kr(At,Vn,Ir),sn?At.persistentData=Vn:tt.freeType(Vn)}else ne(tr[0])?(At.dimension=tr[0].length,At.dtype=tn||gf(tr[0])||bl,en=ku(tr,[tr.length,tr[0].length],At.dtype),kr(At,en,Ir),sn?At.persistentData=en:tt.freeType(en)):k.raise("invalid buffer data")}}else if(ne(tr))At.dtype=tn||gf(tr),At.dimension=gr,kr(At,tr,Ir),sn&&(At.persistentData=new Uint8Array(new Uint8Array(tr.buffer)));else if(Da(tr)){Cr=tr.shape;var si=tr.stride,Qr=tr.offset,Pr=0,ot=0,jn=0,pt=0;Cr.length===1?(Pr=Cr[0],ot=1,jn=si[0],pt=0):Cr.length===2?(Pr=Cr[0],ot=Cr[1],jn=si[0],pt=si[1]):k.raise("invalid shape"),At.dtype=tn||gf(tr.data)||bl,At.dimension=ot;var cn=tt.allocType(At.dtype,Pr*ot);_f(cn,tr.data,Pr,ot,jn,pt,Qr),kr(At,cn,Ir),sn?At.persistentData=cn:tt.freeType(cn)}else tr instanceof ArrayBuffer?(At.dtype=Za,At.dimension=gr,kr(At,tr,Ir),sn&&(At.persistentData=new Uint8Array(new Uint8Array(tr)))):k.raise("invalid buffer data")}function Xr(At){Se.bufferCount--,Ht(At);var tr=At.buffer;k(tr,"buffer must not be deleted already"),V.deleteBuffer(tr),At.buffer=null,delete Xt[At.id]}function wr(At,tr,Ir,tn){Se.bufferCount++;var gr=new Lt(tr);Xt[gr.id]=gr;function sn(_r){var Kr=zc,Vn=null,si=0,Qr=0,Pr=1;return Array.isArray(_r)||ne(_r)||Da(_r)||_r instanceof ArrayBuffer?Vn=_r:typeof _r=="number"?si=_r|0:_r&&(k.type(_r,"object","buffer arguments must be an object, a number or an array"),"data"in _r&&(k(Vn===null||Array.isArray(Vn)||ne(Vn)||Da(Vn),"invalid data for buffer"),Vn=_r.data),"usage"in _r&&(k.parameter(_r.usage,Fu,"invalid buffer usage"),Kr=Fu[_r.usage]),"type"in _r&&(k.parameter(_r.type,Ho,"invalid buffer type"),Qr=Ho[_r.type]),"dimension"in _r&&(k.type(_r.dimension,"number","invalid dimension"),Pr=_r.dimension|0),"length"in _r&&(k.nni(si,"buffer length must be a nonnegative integer"),si=_r.length|0)),gr.bind(),Vn?Zr(gr,Vn,Kr,Qr,Pr,tn):(si&&V.bufferData(gr.type,si,Kr),gr.dtype=Qr||Za,gr.usage=Kr,gr.dimension=Pr,gr.byteLength=si),He.profile&&(gr.stats.size=gr.byteLength*Ku[gr.dtype]),sn}function Cr(_r,Kr){k(Kr+_r.byteLength<=gr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+_r.byteLength+" starting from offset "+Kr+" to a buffer of size "+gr.byteLength),V.bufferSubData(gr.type,Kr,_r)}function en(_r,Kr){var Vn=(Kr||0)|0,si;if(gr.bind(),ne(_r)||_r instanceof ArrayBuffer)Cr(_r,Vn);else if(Array.isArray(_r)){if(_r.length>0)if(typeof _r[0]=="number"){var Qr=tt.allocType(gr.dtype,_r.length);zh(Qr,_r),Cr(Qr,Vn),tt.freeType(Qr)}else if(Array.isArray(_r[0])||ne(_r[0])){si=qu(_r);var Pr=ku(_r,si,gr.dtype);Cr(Pr,Vn),tt.freeType(Pr)}else k.raise("invalid buffer data")}else if(Da(_r)){si=_r.shape;var ot=_r.stride,jn=0,pt=0,cn=0,Si=0;si.length===1?(jn=si[0],pt=1,cn=ot[0],Si=0):si.length===2?(jn=si[0],pt=si[1],cn=ot[0],Si=ot[1]):k.raise("invalid shape");var ui=Array.isArray(_r.data)?gr.dtype:gf(_r.data),Jn=tt.allocType(ui,jn*pt);_f(Jn,_r.data,jn,pt,cn,Si,_r.offset),Cr(Jn,Vn),tt.freeType(Jn)}else k.raise("invalid data for buffer subdata");return sn}return Ir||sn(At),sn._reglType="buffer",sn._buffer=gr,sn.subdata=en,He.profile&&(sn.stats=gr.stats),sn.destroy=function(){Xr(gr)},sn}function Nr(){ji(Xt).forEach(function(At){At.buffer=V.createBuffer(),V.bindBuffer(At.type,At.buffer),V.bufferData(At.type,At.persistentData||At.byteLength,At.usage)})}return He.profile&&(Se.getTotalBufferSize=function(){var At=0;return Object.keys(Xt).forEach(function(tr){At+=Xt[tr].stats.size}),At}),{create:wr,createStream:Tr,destroyStream:Vr,clear:function(){ji(Xt).forEach(Xr),Dr.forEach(Xr)},getBuffer:function(At){return At&&At._buffer instanceof Lt?At._buffer:null},restore:Nr,_initBuffer:Zr}}var nh=0,ih=0,Zh=1,Vh=1,Bp=4,Zc=4,Bu={points:nh,point:ih,lines:Zh,line:Vh,triangles:Bp,triangle:Zc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},jh=0,Wo=1,zl=4,El=5120,js=5121,Sl=5122,au=5123,di=5124,Hs=5125,Lu=34963,Qu=35040,ah=35044;function Hh(V,Se,He,Ht){var cr={},Xt=0,Lt={uint8:js,uint16:au};Se.oes_element_index_uint&&(Lt.uint32=Hs);function Dr(Nr){this.id=Xt++,cr[this.id]=this,this.buffer=Nr,this.primType=zl,this.vertCount=0,this.type=0}Dr.prototype.bind=function(){this.buffer.bind()};var Tr=[];function Vr(Nr){var At=Tr.pop();return At||(At=new Dr(He.create(null,Lu,!0,!1)._buffer)),Zr(At,Nr,Qu,-1,-1,0,0),At}function kr(Nr){Tr.push(Nr)}function Zr(Nr,At,tr,Ir,tn,gr,sn){Nr.buffer.bind();var Cr;if(At){var en=sn;!sn&&(!ne(At)||Da(At)&&!ne(At.data))&&(en=Se.oes_element_index_uint?Hs:au),He._initBuffer(Nr.buffer,At,tr,en,3)}else V.bufferData(Lu,gr,tr),Nr.buffer.dtype=Cr||js,Nr.buffer.usage=tr,Nr.buffer.dimension=3,Nr.buffer.byteLength=gr;if(Cr=sn,!sn){switch(Nr.buffer.dtype){case js:case El:Cr=js;break;case au:case Sl:Cr=au;break;case Hs:case di:Cr=Hs;break;default:k.raise("unsupported type for element array")}Nr.buffer.dtype=Cr}Nr.type=Cr,k(Cr!==Hs||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var _r=tn;_r<0&&(_r=Nr.buffer.byteLength,Cr===au?_r>>=1:Cr===Hs&&(_r>>=2)),Nr.vertCount=_r;var Kr=Ir;if(Ir<0){Kr=zl;var Vn=Nr.buffer.dimension;Vn===1&&(Kr=jh),Vn===2&&(Kr=Wo),Vn===3&&(Kr=zl)}Nr.primType=Kr}function Xr(Nr){Ht.elementsCount--,k(Nr.buffer!==null,"must not double destroy elements"),delete cr[Nr.id],Nr.buffer.destroy(),Nr.buffer=null}function wr(Nr,At){var tr=He.create(null,Lu,!0),Ir=new Dr(tr._buffer);Ht.elementsCount++;function tn(gr){if(!gr)tr(),Ir.primType=zl,Ir.vertCount=0,Ir.type=js;else if(typeof gr=="number")tr(gr),Ir.primType=zl,Ir.vertCount=gr|0,Ir.type=js;else{var sn=null,Cr=ah,en=-1,_r=-1,Kr=0,Vn=0;Array.isArray(gr)||ne(gr)||Da(gr)?sn=gr:(k.type(gr,"object","invalid arguments for elements"),"data"in gr&&(sn=gr.data,k(Array.isArray(sn)||ne(sn)||Da(sn),"invalid data for element buffer")),"usage"in gr&&(k.parameter(gr.usage,Fu,"invalid element buffer usage"),Cr=Fu[gr.usage]),"primitive"in gr&&(k.parameter(gr.primitive,Bu,"invalid element buffer primitive"),en=Bu[gr.primitive]),"count"in gr&&(k(typeof gr.count=="number"&&gr.count>=0,"invalid vertex count for elements"),_r=gr.count|0),"type"in gr&&(k.parameter(gr.type,Lt,"invalid buffer type"),Vn=Lt[gr.type]),"length"in gr?Kr=gr.length|0:(Kr=_r,Vn===au||Vn===Sl?Kr*=2:(Vn===Hs||Vn===di)&&(Kr*=4))),Zr(Ir,sn,Cr,en,_r,Kr,Vn)}return tn}return tn(Nr),tn._reglType="elements",tn._elements=Ir,tn.subdata=function(gr,sn){return tr.subdata(gr,sn),tn},tn.destroy=function(){Xr(Ir)},tn}return{create:wr,createStream:Vr,destroyStream:kr,getElements:function(Nr){return typeof Nr=="function"&&Nr._elements instanceof Dr?Nr._elements:null},clear:function(){ji(cr).forEach(Xr)}}}var Fn=new Float32Array(1),Ws=new Uint32Array(Fn.buffer),Ms=5123;function Ju(V){for(var Se=tt.allocType(Ms,V.length),He=0;He<V.length;++He)if(isNaN(V[He]))Se[He]=65535;else if(V[He]===Infinity)Se[He]=31744;else if(V[He]===-Infinity)Se[He]=64512;else{Fn[0]=V[He];var Ht=Ws[0],cr=Ht>>>31<<15,Xt=(Ht<<1>>>24)-127,Lt=Ht>>13&(1<<10)-1;if(Xt<-24)Se[He]=cr;else if(Xt<-14){var Dr=-14-Xt;Se[He]=cr+(Lt+(1<<10)>>Dr)}else Xt>15?Se[He]=cr+31744:Se[He]=cr+(Xt+15<<10)+Lt}return Se}function Va(V){return Array.isArray(V)||ne(V)}var yf=function(V){return!(V&V-1)&&!!V},xf=34467,Is=3553,el=34067,mu=34069,Al=6408,oh=6406,hc=6407,la=6409,pc=6410,tl=32854,Tl=32855,sh=36194,Vc=32819,ca=32820,wl=33635,Wh=34042,Ps=6402,jc=34041,Hc=35904,bf=35906,rl=36193,Zl=33776,Nu=33777,Wc=33778,dc=33779,Vl=35986,Ef=35987,vc=34798,Os=35840,uh=35841,Gc=35842,mc=35843,Cl=36196,Uu=5121,jl=5123,Sf=5125,nl=5126,lh=10242,ch=10243,fh=10497,Af=33071,Gh=33648,so=10240,Xh=10241,Tf=9728,$h=9729,Hl=9984,Yh=9985,ou=9986,fa=9987,Wl=33170,zu=4352,il=4353,Ni=4354,ma=34046,su=3317,Xc=37440,$c=37441,Gs=37443,qh=37444,wf=33984,Cf=[Hl,ou,Yh,fa],Gl=[0,la,pc,hc,Al],yo={};yo[la]=yo[oh]=yo[Ps]=1,yo[jc]=yo[pc]=2,yo[hc]=yo[Hc]=3,yo[Al]=yo[bf]=4;function Fa(V){return"[object "+V+"]"}var Yc=Fa("HTMLCanvasElement"),gc=Fa("OffscreenCanvas"),Ka=Fa("CanvasRenderingContext2D"),_n=Fa("ImageBitmap"),os=Fa("HTMLImageElement"),Rf=Fa("HTMLVideoElement"),_c=Object.keys(Dn).concat([Yc,gc,Ka,_n,os,Rf]),qo=[];qo[Uu]=1,qo[nl]=4,qo[rl]=2,qo[jl]=2,qo[Sf]=4;var ha=[];ha[tl]=2,ha[Tl]=2,ha[sh]=2,ha[jc]=4,ha[Zl]=.5,ha[Nu]=.5,ha[Wc]=1,ha[dc]=1,ha[Vl]=.5,ha[Ef]=1,ha[vc]=1,ha[Os]=.5,ha[uh]=.25,ha[Gc]=.5,ha[mc]=.25,ha[Cl]=.5;function Mf(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function qr(V){if(!Array.isArray(V))return!1;var Se=V.length;return!(Se===0||!Va(V[0]))}function al(V){return Object.prototype.toString.call(V)}function qc(V){return al(V)===Yc}function Kc(V){return al(V)===gc}function gu(V){return al(V)===Ka}function Ds(V){return al(V)===_n}function If(V){return al(V)===os}function Pf(V){return al(V)===Rf}function ss(V){if(!V)return!1;var Se=al(V);return _c.indexOf(Se)>=0?!0:Mf(V)||qr(V)||Da(V)}function _u(V){return Dn[Object.prototype.toString.call(V)]|0}function Kh(V,Se){var He=Se.length;switch(V.type){case Uu:case jl:case Sf:case nl:var Ht=tt.allocType(V.type,He);Ht.set(Se),V.data=Ht;break;case rl:V.data=Ju(Se);break;default:k.raise("unsupported texture type, must specify a typed array")}}function yc(V,Se){return tt.allocType(V.type===rl?nl:V.type,Se)}function xc(V,Se){V.type===rl?(V.data=Ju(Se),tt.freeType(Se)):V.data=Se}function Qc(V,Se,He,Ht,cr,Xt){for(var Lt=V.width,Dr=V.height,Tr=V.channels,Vr=Lt*Dr*Tr,kr=yc(V,Vr),Zr=0,Xr=0;Xr<Dr;++Xr)for(var wr=0;wr<Lt;++wr)for(var Nr=0;Nr<Tr;++Nr)kr[Zr++]=Se[He*wr+Ht*Xr+cr*Nr+Xt];xc(V,kr)}function Fs(V,Se,He,Ht,cr,Xt){var Lt;if(typeof ha[V]!="undefined"?Lt=ha[V]:Lt=yo[V]*qo[Se],Xt&&(Lt*=6),cr){for(var Dr=0,Tr=He;Tr>=1;)Dr+=Lt*Tr*Tr,Tr/=2;return Dr}else return Lt*He*Ht}function Ot(V,Se,He,Ht,cr,Xt,Lt){var Dr={"don't care":zu,"dont care":zu,nice:Ni,fast:il},Tr={repeat:fh,clamp:Af,mirror:Gh},Vr={nearest:Tf,linear:$h},kr=N({mipmap:fa,"nearest mipmap nearest":Hl,"linear mipmap nearest":Yh,"nearest mipmap linear":ou,"linear mipmap linear":fa},Vr),Zr={none:0,browser:qh},Xr={uint8:Uu,rgba4:Vc,rgb565:wl,"rgb5 a1":ca},wr={alpha:oh,luminance:la,"luminance alpha":pc,rgb:hc,rgba:Al,rgba4:tl,"rgb5 a1":Tl,rgb565:sh},Nr={};Se.ext_srgb&&(wr.srgb=Hc,wr.srgba=bf),Se.oes_texture_float&&(Xr.float32=Xr.float=nl),Se.oes_texture_half_float&&(Xr.float16=Xr["half float"]=rl),Se.webgl_depth_texture&&(N(wr,{depth:Ps,"depth stencil":jc}),N(Xr,{uint16:jl,uint32:Sf,"depth stencil":Wh})),Se.webgl_compressed_texture_s3tc&&N(Nr,{"rgb s3tc dxt1":Zl,"rgba s3tc dxt1":Nu,"rgba s3tc dxt3":Wc,"rgba s3tc dxt5":dc}),Se.webgl_compressed_texture_atc&&N(Nr,{"rgb atc":Vl,"rgba atc explicit alpha":Ef,"rgba atc interpolated alpha":vc}),Se.webgl_compressed_texture_pvrtc&&N(Nr,{"rgb pvrtc 4bppv1":Os,"rgb pvrtc 2bppv1":uh,"rgba pvrtc 4bppv1":Gc,"rgba pvrtc 2bppv1":mc}),Se.webgl_compressed_texture_etc1&&(Nr["rgb etc1"]=Cl);var At=Array.prototype.slice.call(V.getParameter(xf));Object.keys(Nr).forEach(function(Ne){var Yt=Nr[Ne];At.indexOf(Yt)>=0&&(wr[Ne]=Yt)});var tr=Object.keys(wr);He.textureFormats=tr;var Ir=[];Object.keys(wr).forEach(function(Ne){var Yt=wr[Ne];Ir[Yt]=Ne});var tn=[];Object.keys(Xr).forEach(function(Ne){var Yt=Xr[Ne];tn[Yt]=Ne});var gr=[];Object.keys(Vr).forEach(function(Ne){var Yt=Vr[Ne];gr[Yt]=Ne});var sn=[];Object.keys(kr).forEach(function(Ne){var Yt=kr[Ne];sn[Yt]=Ne});var Cr=[];Object.keys(Tr).forEach(function(Ne){var Yt=Tr[Ne];Cr[Yt]=Ne});var en=tr.reduce(function(Ne,Yt){var Nt=wr[Yt];return Nt===la||Nt===oh||Nt===la||Nt===pc||Nt===Ps||Nt===jc||Se.ext_srgb&&(Nt===Hc||Nt===bf)?Ne[Nt]=Nt:Nt===Tl||Yt.indexOf("rgba")>=0?Ne[Nt]=Al:Ne[Nt]=hc,Ne},{});function _r(){this.internalformat=Al,this.format=Al,this.type=Uu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=qh,this.width=0,this.height=0,this.channels=0}function Kr(Ne,Yt){Ne.internalformat=Yt.internalformat,Ne.format=Yt.format,Ne.type=Yt.type,Ne.compressed=Yt.compressed,Ne.premultiplyAlpha=Yt.premultiplyAlpha,Ne.flipY=Yt.flipY,Ne.unpackAlignment=Yt.unpackAlignment,Ne.colorSpace=Yt.colorSpace,Ne.width=Yt.width,Ne.height=Yt.height,Ne.channels=Yt.channels}function Vn(Ne,Yt){if(!(typeof Yt!="object"||!Yt)){if("premultiplyAlpha"in Yt&&(k.type(Yt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ne.premultiplyAlpha=Yt.premultiplyAlpha),"flipY"in Yt&&(k.type(Yt.flipY,"boolean","invalid texture flip"),Ne.flipY=Yt.flipY),"alignment"in Yt&&(k.oneOf(Yt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ne.unpackAlignment=Yt.alignment),"colorSpace"in Yt&&(k.parameter(Yt.colorSpace,Zr,"invalid colorSpace"),Ne.colorSpace=Zr[Yt.colorSpace]),"type"in Yt){var Nt=Yt.type;k(Se.oes_texture_float||!(Nt==="float"||Nt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),k(Se.oes_texture_half_float||!(Nt==="half float"||Nt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),k(Se.webgl_depth_texture||!(Nt==="uint16"||Nt==="uint32"||Nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),k.parameter(Nt,Xr,"invalid texture type"),Ne.type=Xr[Nt]}var fn=Ne.width,Ti=Ne.height,pa=Ne.channels,fe=!1;"shape"in Yt?(k(Array.isArray(Yt.shape)&&Yt.shape.length>=2,"shape must be an array"),fn=Yt.shape[0],Ti=Yt.shape[1],Yt.shape.length===3&&(pa=Yt.shape[2],k(pa>0&&pa<=4,"invalid number of channels"),fe=!0),k(fn>=0&&fn<=He.maxTextureSize,"invalid width"),k(Ti>=0&&Ti<=He.maxTextureSize,"invalid height")):("radius"in Yt&&(fn=Ti=Yt.radius,k(fn>=0&&fn<=He.maxTextureSize,"invalid radius")),"width"in Yt&&(fn=Yt.width,k(fn>=0&&fn<=He.maxTextureSize,"invalid width")),"height"in Yt&&(Ti=Yt.height,k(Ti>=0&&Ti<=He.maxTextureSize,"invalid height")),"channels"in Yt&&(pa=Yt.channels,k(pa>0&&pa<=4,"invalid number of channels"),fe=!0)),Ne.width=fn|0,Ne.height=Ti|0,Ne.channels=pa|0;var Ce=!1;if("format"in Yt){var We=Yt.format;k(Se.webgl_depth_texture||!(We==="depth"||We==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),k.parameter(We,wr,"invalid texture format");var zt=Ne.internalformat=wr[We];Ne.format=en[zt],We in Xr&&("type"in Yt||(Ne.type=Xr[We])),We in Nr&&(Ne.compressed=!0),Ce=!0}!fe&&Ce?Ne.channels=yo[Ne.format]:fe&&!Ce?Ne.channels!==Gl[Ne.format]&&(Ne.format=Ne.internalformat=Gl[Ne.channels]):Ce&&fe&&k(Ne.channels===yo[Ne.format],"number of channels inconsistent with specified format")}}function si(Ne){V.pixelStorei(Xc,Ne.flipY),V.pixelStorei($c,Ne.premultiplyAlpha),V.pixelStorei(Gs,Ne.colorSpace),V.pixelStorei(su,Ne.unpackAlignment)}function Qr(){_r.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Pr(Ne,Yt){var Nt=null;if(ss(Yt)?Nt=Yt:Yt&&(k.type(Yt,"object","invalid pixel data type"),Vn(Ne,Yt),"x"in Yt&&(Ne.xOffset=Yt.x|0),"y"in Yt&&(Ne.yOffset=Yt.y|0),ss(Yt.data)&&(Nt=Yt.data)),k(!Ne.compressed||Nt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Yt.copy){k(!Nt,"can not specify copy and data field for the same texture");var fn=cr.viewportWidth,Ti=cr.viewportHeight;Ne.width=Ne.width||fn-Ne.xOffset,Ne.height=Ne.height||Ti-Ne.yOffset,Ne.needsCopy=!0,k(Ne.xOffset>=0&&Ne.xOffset<fn&&Ne.yOffset>=0&&Ne.yOffset<Ti&&Ne.width>0&&Ne.width<=fn&&Ne.height>0&&Ne.height<=Ti,"copy texture read out of bounds")}else if(!Nt)Ne.width=Ne.width||1,Ne.height=Ne.height||1,Ne.channels=Ne.channels||4;else if(ne(Nt))Ne.channels=Ne.channels||4,Ne.data=Nt,!("type"in Yt)&&Ne.type===Uu&&(Ne.type=_u(Nt));else if(Mf(Nt))Ne.channels=Ne.channels||4,Kh(Ne,Nt),Ne.alignment=1,Ne.needsFree=!0;else if(Da(Nt)){var pa=Nt.data;!Array.isArray(pa)&&Ne.type===Uu&&(Ne.type=_u(pa));var fe=Nt.shape,Ce=Nt.stride,We,zt,Ft,Je,ut,dt;fe.length===3?(Ft=fe[2],dt=Ce[2]):(k(fe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ft=1,dt=1),We=fe[0],zt=fe[1],Je=Ce[0],ut=Ce[1],Ne.alignment=1,Ne.width=We,Ne.height=zt,Ne.channels=Ft,Ne.format=Ne.internalformat=Gl[Ft],Ne.needsFree=!0,Qc(Ne,pa,Je,ut,dt,Nt.offset)}else if(qc(Nt)||Kc(Nt)||gu(Nt))qc(Nt)||Kc(Nt)?Ne.element=Nt:Ne.element=Nt.canvas,Ne.width=Ne.element.width,Ne.height=Ne.element.height,Ne.channels=4;else if(Ds(Nt))Ne.element=Nt,Ne.width=Nt.width,Ne.height=Nt.height,Ne.channels=4;else if(If(Nt))Ne.element=Nt,Ne.width=Nt.naturalWidth,Ne.height=Nt.naturalHeight,Ne.channels=4;else if(Pf(Nt))Ne.element=Nt,Ne.width=Nt.videoWidth,Ne.height=Nt.videoHeight,Ne.channels=4;else if(qr(Nt)){var ze=Ne.width||Nt[0].length,et=Ne.height||Nt.length,we=Ne.channels;Va(Nt[0][0])?we=we||Nt[0][0].length:we=we||1;for(var Ye=jo.shape(Nt),Vt=1,ar=0;ar<Ye.length;++ar)Vt*=Ye[ar];var Er=yc(Ne,Vt);jo.flatten(Nt,Ye,"",Er),xc(Ne,Er),Ne.alignment=1,Ne.width=ze,Ne.height=et,Ne.channels=we,Ne.format=Ne.internalformat=Gl[we],Ne.needsFree=!0}Ne.type===nl?k(He.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ne.type===rl&&k(He.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ot(Ne,Yt,Nt){var fn=Ne.element,Ti=Ne.data,pa=Ne.internalformat,fe=Ne.format,Ce=Ne.type,We=Ne.width,zt=Ne.height;si(Ne),fn?V.texImage2D(Yt,Nt,fe,fe,Ce,fn):Ne.compressed?V.compressedTexImage2D(Yt,Nt,pa,We,zt,0,Ti):Ne.needsCopy?(Ht(),V.copyTexImage2D(Yt,Nt,fe,Ne.xOffset,Ne.yOffset,We,zt,0)):V.texImage2D(Yt,Nt,fe,We,zt,0,fe,Ce,Ti||null)}function jn(Ne,Yt,Nt,fn,Ti){var pa=Ne.element,fe=Ne.data,Ce=Ne.internalformat,We=Ne.format,zt=Ne.type,Ft=Ne.width,Je=Ne.height;si(Ne),pa?V.texSubImage2D(Yt,Ti,Nt,fn,We,zt,pa):Ne.compressed?V.compressedTexSubImage2D(Yt,Ti,Nt,fn,Ce,Ft,Je,fe):Ne.needsCopy?(Ht(),V.copyTexSubImage2D(Yt,Ti,Nt,fn,Ne.xOffset,Ne.yOffset,Ft,Je)):V.texSubImage2D(Yt,Ti,Nt,fn,Ft,Je,We,zt,fe)}var pt=[];function cn(){return pt.pop()||new Qr}function Si(Ne){Ne.needsFree&&tt.freeType(Ne.data),Qr.call(Ne),pt.push(Ne)}function ui(){_r.call(this),this.genMipmaps=!1,this.mipmapHint=zu,this.mipmask=0,this.images=Array(16)}function Jn(Ne,Yt,Nt){var fn=Ne.images[0]=cn();Ne.mipmask=1,fn.width=Ne.width=Yt,fn.height=Ne.height=Nt,fn.channels=Ne.channels=4}function Xi(Ne,Yt){var Nt=null;if(ss(Yt))Nt=Ne.images[0]=cn(),Kr(Nt,Ne),Pr(Nt,Yt),Ne.mipmask=1;else if(Vn(Ne,Yt),Array.isArray(Yt.mipmap))for(var fn=Yt.mipmap,Ti=0;Ti<fn.length;++Ti)Nt=Ne.images[Ti]=cn(),Kr(Nt,Ne),Nt.width>>=Ti,Nt.height>>=Ti,Pr(Nt,fn[Ti]),Ne.mipmask|=1<<Ti;else Nt=Ne.images[0]=cn(),Kr(Nt,Ne),Pr(Nt,Yt),Ne.mipmask=1;Kr(Ne,Ne.images[0]),Ne.compressed&&(Ne.internalformat===Zl||Ne.internalformat===Nu||Ne.internalformat===Wc||Ne.internalformat===dc)&&k(Ne.width%4==0&&Ne.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function La(Ne,Yt){for(var Nt=Ne.images,fn=0;fn<Nt.length;++fn){if(!Nt[fn])return;ot(Nt[fn],Yt,fn)}}var $o=[];function Oi(){var Ne=$o.pop()||new ui;_r.call(Ne),Ne.mipmask=0;for(var Yt=0;Yt<16;++Yt)Ne.images[Yt]=null;return Ne}function ro(Ne){for(var Yt=Ne.images,Nt=0;Nt<Yt.length;++Nt)Yt[Nt]&&Si(Yt[Nt]),Yt[Nt]=null;$o.push(Ne)}function ba(){this.minFilter=Tf,this.magFilter=Tf,this.wrapS=Af,this.wrapT=Af,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=zu}function co(Ne,Yt){if("min"in Yt){var Nt=Yt.min;k.parameter(Nt,kr),Ne.minFilter=kr[Nt],Cf.indexOf(Ne.minFilter)>=0&&!("faces"in Yt)&&(Ne.genMipmaps=!0)}if("mag"in Yt){var fn=Yt.mag;k.parameter(fn,Vr),Ne.magFilter=Vr[fn]}var Ti=Ne.wrapS,pa=Ne.wrapT;if("wrap"in Yt){var fe=Yt.wrap;typeof fe=="string"?(k.parameter(fe,Tr),Ti=pa=Tr[fe]):Array.isArray(fe)&&(k.parameter(fe[0],Tr),k.parameter(fe[1],Tr),Ti=Tr[fe[0]],pa=Tr[fe[1]])}else{if("wrapS"in Yt){var Ce=Yt.wrapS;k.parameter(Ce,Tr),Ti=Tr[Ce]}if("wrapT"in Yt){var We=Yt.wrapT;k.parameter(We,Tr),pa=Tr[We]}}if(Ne.wrapS=Ti,Ne.wrapT=pa,"anisotropic"in Yt){var zt=Yt.anisotropic;k(typeof zt=="number"&&zt>=1&&zt<=He.maxAnisotropic,"aniso samples must be between 1 and "),Ne.anisotropic=Yt.anisotropic}if("mipmap"in Yt){var Ft=!1;switch(typeof Yt.mipmap){case"string":k.parameter(Yt.mipmap,Dr,"invalid mipmap hint"),Ne.mipmapHint=Dr[Yt.mipmap],Ne.genMipmaps=!0,Ft=!0;break;case"boolean":Ft=Ne.genMipmaps=Yt.mipmap;break;case"object":k(Array.isArray(Yt.mipmap),"invalid mipmap type"),Ne.genMipmaps=!1,Ft=!0;break;default:k.raise("invalid mipmap type")}Ft&&!("min"in Yt)&&(Ne.minFilter=Hl)}}function fo(Ne,Yt){V.texParameteri(Yt,Xh,Ne.minFilter),V.texParameteri(Yt,so,Ne.magFilter),V.texParameteri(Yt,lh,Ne.wrapS),V.texParameteri(Yt,ch,Ne.wrapT),Se.ext_texture_filter_anisotropic&&V.texParameteri(Yt,ma,Ne.anisotropic),Ne.genMipmaps&&(V.hint(Wl,Ne.mipmapHint),V.generateMipmap(Yt))}var Na=0,ko={},es=He.maxTextureUnits,Ro=Array(es).map(function(){return null});function Ei(Ne){_r.call(this),this.mipmask=0,this.internalformat=Al,this.id=Na++,this.refCount=1,this.target=Ne,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ba,Lt.profile&&(this.stats={size:0})}function ts(Ne){V.activeTexture(wf),V.bindTexture(Ne.target,Ne.texture)}function ea(){var Ne=Ro[0];Ne?V.bindTexture(Ne.target,Ne.texture):V.bindTexture(Is,null)}function Yn(Ne){var Yt=Ne.texture;k(Yt,"must not double destroy texture");var Nt=Ne.unit,fn=Ne.target;Nt>=0&&(V.activeTexture(wf+Nt),V.bindTexture(fn,null),Ro[Nt]=null),V.deleteTexture(Yt),Ne.texture=null,Ne.params=null,Ne.pixels=null,Ne.refCount=0,delete ko[Ne.id],Xt.textureCount--}N(Ei.prototype,{bind:function(){var Ne=this;Ne.bindCount+=1;var Yt=Ne.unit;if(Yt<0){for(var Nt=0;Nt<es;++Nt){var fn=Ro[Nt];if(fn){if(fn.bindCount>0)continue;fn.unit=-1}Ro[Nt]=Ne,Yt=Nt;break}Yt>=es&&k.raise("insufficient number of texture units"),Lt.profile&&Xt.maxTextureUnits<Yt+1&&(Xt.maxTextureUnits=Yt+1),Ne.unit=Yt,V.activeTexture(wf+Yt),V.bindTexture(Ne.target,Ne.texture)}return Yt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Yn(this)}});function Ii(Ne,Yt){var Nt=new Ei(Is);ko[Nt.id]=Nt,Xt.textureCount++;function fn(fe,Ce){var We=Nt.texInfo;ba.call(We);var zt=Oi();return typeof fe=="number"?typeof Ce=="number"?Jn(zt,fe|0,Ce|0):Jn(zt,fe|0,fe|0):fe?(k.type(fe,"object","invalid arguments to regl.texture"),co(We,fe),Xi(zt,fe)):Jn(zt,1,1),We.genMipmaps&&(zt.mipmask=(zt.width<<1)-1),Nt.mipmask=zt.mipmask,Kr(Nt,zt),k.texture2D(We,zt,He),Nt.internalformat=zt.internalformat,fn.width=zt.width,fn.height=zt.height,ts(Nt),La(zt,Is),fo(We,Is),ea(),ro(zt),Lt.profile&&(Nt.stats.size=Fs(Nt.internalformat,Nt.type,zt.width,zt.height,We.genMipmaps,!1)),fn.format=Ir[Nt.internalformat],fn.type=tn[Nt.type],fn.mag=gr[We.magFilter],fn.min=sn[We.minFilter],fn.wrapS=Cr[We.wrapS],fn.wrapT=Cr[We.wrapT],fn}function Ti(fe,Ce,We,zt){k(!!fe,"must specify image data");var Ft=Ce|0,Je=We|0,ut=zt|0,dt=cn();return Kr(dt,Nt),dt.width=0,dt.height=0,Pr(dt,fe),dt.width=dt.width||(Nt.width>>ut)-Ft,dt.height=dt.height||(Nt.height>>ut)-Je,k(Nt.type===dt.type&&Nt.format===dt.format&&Nt.internalformat===dt.internalformat,"incompatible format for texture.subimage"),k(Ft>=0&&Je>=0&&Ft+dt.width<=Nt.width&&Je+dt.height<=Nt.height,"texture.subimage write out of bounds"),k(Nt.mipmask&1<<ut,"missing mipmap data"),k(dt.data||dt.element||dt.needsCopy,"missing image data"),ts(Nt),jn(dt,Is,Ft,Je,ut),ea(),Si(dt),fn}function pa(fe,Ce){var We=fe|0,zt=Ce|0||We;if(We===Nt.width&&zt===Nt.height)return fn;fn.width=Nt.width=We,fn.height=Nt.height=zt,ts(Nt);for(var Ft=0;Nt.mipmask>>Ft;++Ft){var Je=We>>Ft,ut=zt>>Ft;if(!Je||!ut)break;V.texImage2D(Is,Ft,Nt.format,Je,ut,0,Nt.format,Nt.type,null)}return ea(),Lt.profile&&(Nt.stats.size=Fs(Nt.internalformat,Nt.type,We,zt,!1,!1)),fn}return fn(Ne,Yt),fn.subimage=Ti,fn.resize=pa,fn._reglType="texture2d",fn._texture=Nt,Lt.profile&&(fn.stats=Nt.stats),fn.destroy=function(){Nt.decRef()},fn}function $i(Ne,Yt,Nt,fn,Ti,pa){var fe=new Ei(el);ko[fe.id]=fe,Xt.cubeCount++;var Ce=new Array(6);function We(Je,ut,dt,ze,et,we){var Ye,Vt=fe.texInfo;for(ba.call(Vt),Ye=0;Ye<6;++Ye)Ce[Ye]=Oi();if(typeof Je=="number"||!Je){var ar=Je|0||1;for(Ye=0;Ye<6;++Ye)Jn(Ce[Ye],ar,ar)}else if(typeof Je=="object")if(ut)Xi(Ce[0],Je),Xi(Ce[1],ut),Xi(Ce[2],dt),Xi(Ce[3],ze),Xi(Ce[4],et),Xi(Ce[5],we);else if(co(Vt,Je),Vn(fe,Je),"faces"in Je){var Er=Je.faces;for(k(Array.isArray(Er)&&Er.length===6,"cube faces must be a length 6 array"),Ye=0;Ye<6;++Ye)k(typeof Er[Ye]=="object"&&!!Er[Ye],"invalid input for cube map face"),Kr(Ce[Ye],fe),Xi(Ce[Ye],Er[Ye])}else for(Ye=0;Ye<6;++Ye)Xi(Ce[Ye],Je);else k.raise("invalid arguments to cube map");for(Kr(fe,Ce[0]),He.npotTextureCube||k(yf(fe.width)&&yf(fe.height),"your browser does not support non power or two texture dimensions"),Vt.genMipmaps?fe.mipmask=(Ce[0].width<<1)-1:fe.mipmask=Ce[0].mipmask,k.textureCube(fe,Vt,Ce,He),fe.internalformat=Ce[0].internalformat,We.width=Ce[0].width,We.height=Ce[0].height,ts(fe),Ye=0;Ye<6;++Ye)La(Ce[Ye],mu+Ye);for(fo(Vt,el),ea(),Lt.profile&&(fe.stats.size=Fs(fe.internalformat,fe.type,We.width,We.height,Vt.genMipmaps,!0)),We.format=Ir[fe.internalformat],We.type=tn[fe.type],We.mag=gr[Vt.magFilter],We.min=sn[Vt.minFilter],We.wrapS=Cr[Vt.wrapS],We.wrapT=Cr[Vt.wrapT],Ye=0;Ye<6;++Ye)ro(Ce[Ye]);return We}function zt(Je,ut,dt,ze,et){k(!!ut,"must specify image data"),k(typeof Je=="number"&&Je===(Je|0)&&Je>=0&&Je<6,"invalid face");var we=dt|0,Ye=ze|0,Vt=et|0,ar=cn();return Kr(ar,fe),ar.width=0,ar.height=0,Pr(ar,ut),ar.width=ar.width||(fe.width>>Vt)-we,ar.height=ar.height||(fe.height>>Vt)-Ye,k(fe.type===ar.type&&fe.format===ar.format&&fe.internalformat===ar.internalformat,"incompatible format for texture.subimage"),k(we>=0&&Ye>=0&&we+ar.width<=fe.width&&Ye+ar.height<=fe.height,"texture.subimage write out of bounds"),k(fe.mipmask&1<<Vt,"missing mipmap data"),k(ar.data||ar.element||ar.needsCopy,"missing image data"),ts(fe),jn(ar,mu+Je,we,Ye,Vt),ea(),Si(ar),We}function Ft(Je){var ut=Je|0;if(ut!==fe.width){We.width=fe.width=ut,We.height=fe.height=ut,ts(fe);for(var dt=0;dt<6;++dt)for(var ze=0;fe.mipmask>>ze;++ze)V.texImage2D(mu+dt,ze,fe.format,ut>>ze,ut>>ze,0,fe.format,fe.type,null);return ea(),Lt.profile&&(fe.stats.size=Fs(fe.internalformat,fe.type,We.width,We.height,!1,!0)),We}}return We(Ne,Yt,Nt,fn,Ti,pa),We.subimage=zt,We.resize=Ft,We._reglType="textureCube",We._texture=fe,Lt.profile&&(We.stats=fe.stats),We.destroy=function(){fe.decRef()},We}function ho(){for(var Ne=0;Ne<es;++Ne)V.activeTexture(wf+Ne),V.bindTexture(Is,null),Ro[Ne]=null;ji(ko).forEach(Yn),Xt.cubeCount=0,Xt.textureCount=0}Lt.profile&&(Xt.getTotalTextureSize=function(){var Ne=0;return Object.keys(ko).forEach(function(Yt){Ne+=ko[Yt].stats.size}),Ne});function hl(){for(var Ne=0;Ne<es;++Ne){var Yt=Ro[Ne];Yt&&(Yt.bindCount=0,Yt.unit=-1,Ro[Ne]=null)}ji(ko).forEach(function(Nt){Nt.texture=V.createTexture(),V.bindTexture(Nt.target,Nt.texture);for(var fn=0;fn<32;++fn)if((Nt.mipmask&1<<fn)!=0)if(Nt.target===Is)V.texImage2D(Is,fn,Nt.internalformat,Nt.width>>fn,Nt.height>>fn,0,Nt.internalformat,Nt.type,null);else for(var Ti=0;Ti<6;++Ti)V.texImage2D(mu+Ti,fn,Nt.internalformat,Nt.width>>fn,Nt.height>>fn,0,Nt.internalformat,Nt.type,null);fo(Nt.texInfo,Nt.target)})}return{create2D:Ii,createCube:$i,clear:ho,getTexture:function(Ne){return null},restore:hl}}var Ee=36161,B=32854,Xs=32855,ve=36194,Rl=33189,ka=36168,ks=34041,xo=35907,us=34836,kn=34842,Sn=34843,Ko=[];Ko[B]=2,Ko[Xs]=2,Ko[ve]=2,Ko[Rl]=2,Ko[ka]=1,Ko[ks]=4,Ko[xo]=4,Ko[us]=16,Ko[kn]=8,Ko[Sn]=6;function Qo(V,Se,He){return Ko[V]*Se*He}var yu=function(V,Se,He,Ht,cr){var Xt={rgba4:B,rgb565:ve,"rgb5 a1":Xs,depth:Rl,stencil:ka,"depth stencil":ks};Se.ext_srgb&&(Xt.srgba=xo),Se.ext_color_buffer_half_float&&(Xt.rgba16f=kn,Xt.rgb16f=Sn),Se.webgl_color_buffer_float&&(Xt.rgba32f=us);var Lt=[];Object.keys(Xt).forEach(function(wr){var Nr=Xt[wr];Lt[Nr]=wr});var Dr=0,Tr={};function Vr(wr){this.id=Dr++,this.refCount=1,this.renderbuffer=wr,this.format=B,this.width=0,this.height=0,cr.profile&&(this.stats={size:0})}Vr.prototype.decRef=function(){--this.refCount<=0&&kr(this)};function kr(wr){var Nr=wr.renderbuffer;k(Nr,"must not double destroy renderbuffer"),V.bindRenderbuffer(Ee,null),V.deleteRenderbuffer(Nr),wr.renderbuffer=null,wr.refCount=0,delete Tr[wr.id],Ht.renderbufferCount--}function Zr(wr,Nr){var At=new Vr(V.createRenderbuffer());Tr[At.id]=At,Ht.renderbufferCount++;function tr(tn,gr){var sn=0,Cr=0,en=B;if(typeof tn=="object"&&tn){var _r=tn;if("shape"in _r){var Kr=_r.shape;k(Array.isArray(Kr)&&Kr.length>=2,"invalid renderbuffer shape"),sn=Kr[0]|0,Cr=Kr[1]|0}else"radius"in _r&&(sn=Cr=_r.radius|0),"width"in _r&&(sn=_r.width|0),"height"in _r&&(Cr=_r.height|0);"format"in _r&&(k.parameter(_r.format,Xt,"invalid renderbuffer format"),en=Xt[_r.format])}else typeof tn=="number"?(sn=tn|0,typeof gr=="number"?Cr=gr|0:Cr=sn):tn?k.raise("invalid arguments to renderbuffer constructor"):sn=Cr=1;if(k(sn>0&&Cr>0&&sn<=He.maxRenderbufferSize&&Cr<=He.maxRenderbufferSize,"invalid renderbuffer size"),!(sn===At.width&&Cr===At.height&&en===At.format))return tr.width=At.width=sn,tr.height=At.height=Cr,At.format=en,V.bindRenderbuffer(Ee,At.renderbuffer),V.renderbufferStorage(Ee,en,sn,Cr),k(V.getError()===0,"invalid render buffer format"),cr.profile&&(At.stats.size=Qo(At.format,At.width,At.height)),tr.format=Lt[At.format],tr}function Ir(tn,gr){var sn=tn|0,Cr=gr|0||sn;return sn===At.width&&Cr===At.height||(k(sn>0&&Cr>0&&sn<=He.maxRenderbufferSize&&Cr<=He.maxRenderbufferSize,"invalid renderbuffer size"),tr.width=At.width=sn,tr.height=At.height=Cr,V.bindRenderbuffer(Ee,At.renderbuffer),V.renderbufferStorage(Ee,At.format,sn,Cr),k(V.getError()===0,"invalid render buffer format"),cr.profile&&(At.stats.size=Qo(At.format,At.width,At.height))),tr}return tr(wr,Nr),tr.resize=Ir,tr._reglType="renderbuffer",tr._renderbuffer=At,cr.profile&&(tr.stats=At.stats),tr.destroy=function(){At.decRef()},tr}cr.profile&&(Ht.getTotalRenderbufferSize=function(){var wr=0;return Object.keys(Tr).forEach(function(Nr){wr+=Tr[Nr].stats.size}),wr});function Xr(){ji(Tr).forEach(function(wr){wr.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(Ee,wr.renderbuffer),V.renderbufferStorage(Ee,wr.format,wr.width,wr.height)}),V.bindRenderbuffer(Ee,null)}return{create:Zr,clear:function(){ji(Tr).forEach(kr)},restore:Xr}},Ia=36160,$s=36161,xu=3553,bu=34069,ia=36064,uo=36096,hh=36128,Ml=33306,Of=36053,ol=36054,ls=36055,Xl=36057,Eu=36061,Df=36193,bc=5121,Jc=5126,Ff=6407,$l=6408,Yl=6402,ph=[Ff,$l],Jo=[];Jo[$l]=4,Jo[Ff]=3;var Su=[];Su[bc]=1,Su[Jc]=4,Su[Df]=2;var ef=32854,Il=32855,uu=36194,dh=33189,Zu=36168,kf=34041,vh=35907,h=34836,v=34842,p=34843,g=[ef,Il,uu,vh,v,p,h],S={};S[Of]="complete",S[ol]="incomplete attachment",S[Xl]="incomplete dimensions",S[ls]="incomplete, missing attachment",S[Eu]="unsupported";function C(V,Se,He,Ht,cr,Xt){var Lt={cur:null,next:null,dirty:!1,setFBO:null},Dr=["rgba"],Tr=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Tr.push("srgba"),Se.ext_color_buffer_half_float&&Tr.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Tr.push("rgba32f");var Vr=["uint8"];Se.oes_texture_half_float&&Vr.push("half float","float16"),Se.oes_texture_float&&Vr.push("float","float32");function kr(Qr,Pr,ot){this.target=Qr,this.texture=Pr,this.renderbuffer=ot;var jn=0,pt=0;Pr?(jn=Pr.width,pt=Pr.height):ot&&(jn=ot.width,pt=ot.height),this.width=jn,this.height=pt}function Zr(Qr){Qr&&(Qr.texture&&Qr.texture._texture.decRef(),Qr.renderbuffer&&Qr.renderbuffer._renderbuffer.decRef())}function Xr(Qr,Pr,ot){if(!!Qr)if(Qr.texture){var jn=Qr.texture._texture,pt=Math.max(1,jn.width),cn=Math.max(1,jn.height);k(pt===Pr&&cn===ot,"inconsistent width/height for supplied texture"),jn.refCount+=1}else{var Si=Qr.renderbuffer._renderbuffer;k(Si.width===Pr&&Si.height===ot,"inconsistent width/height for renderbuffer"),Si.refCount+=1}}function wr(Qr,Pr){Pr&&(Pr.texture?V.framebufferTexture2D(Ia,Qr,Pr.target,Pr.texture._texture.texture,0):V.framebufferRenderbuffer(Ia,Qr,$s,Pr.renderbuffer._renderbuffer.renderbuffer))}function Nr(Qr){var Pr=xu,ot=null,jn=null,pt=Qr;typeof Qr=="object"&&(pt=Qr.data,"target"in Qr&&(Pr=Qr.target|0)),k.type(pt,"function","invalid attachment data");var cn=pt._reglType;return cn==="texture2d"?(ot=pt,k(Pr===xu)):cn==="textureCube"?(ot=pt,k(Pr>=bu&&Pr<bu+6,"invalid cube map target")):cn==="renderbuffer"?(jn=pt,Pr=$s):k.raise("invalid regl object for attachment"),new kr(Pr,ot,jn)}function At(Qr,Pr,ot,jn,pt){if(ot){var cn=Ht.create2D({width:Qr,height:Pr,format:jn,type:pt});return cn._texture.refCount=0,new kr(xu,cn,null)}else{var Si=cr.create({width:Qr,height:Pr,format:jn});return Si._renderbuffer.refCount=0,new kr($s,null,Si)}}function tr(Qr){return Qr&&(Qr.texture||Qr.renderbuffer)}function Ir(Qr,Pr,ot){Qr&&(Qr.texture?Qr.texture.resize(Pr,ot):Qr.renderbuffer&&Qr.renderbuffer.resize(Pr,ot),Qr.width=Pr,Qr.height=ot)}var tn=0,gr={};function sn(){this.id=tn++,gr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Cr(Qr){Qr.colorAttachments.forEach(Zr),Zr(Qr.depthAttachment),Zr(Qr.stencilAttachment),Zr(Qr.depthStencilAttachment)}function en(Qr){var Pr=Qr.framebuffer;k(Pr,"must not double destroy framebuffer"),V.deleteFramebuffer(Pr),Qr.framebuffer=null,Xt.framebufferCount--,delete gr[Qr.id]}function _r(Qr){var Pr;V.bindFramebuffer(Ia,Qr.framebuffer);var ot=Qr.colorAttachments;for(Pr=0;Pr<ot.length;++Pr)wr(ia+Pr,ot[Pr]);for(Pr=ot.length;Pr<He.maxColorAttachments;++Pr)V.framebufferTexture2D(Ia,ia+Pr,xu,null,0);V.framebufferTexture2D(Ia,Ml,xu,null,0),V.framebufferTexture2D(Ia,uo,xu,null,0),V.framebufferTexture2D(Ia,hh,xu,null,0),wr(uo,Qr.depthAttachment),wr(hh,Qr.stencilAttachment),wr(Ml,Qr.depthStencilAttachment);var jn=V.checkFramebufferStatus(Ia);!V.isContextLost()&&jn!==Of&&k.raise("framebuffer configuration not supported, status = "+S[jn]),V.bindFramebuffer(Ia,Lt.next?Lt.next.framebuffer:null),Lt.cur=Lt.next,V.getError()}function Kr(Qr,Pr){var ot=new sn;Xt.framebufferCount++;function jn(cn,Si){var ui;k(Lt.next!==ot,"can not update framebuffer which is currently in use");var Jn=0,Xi=0,La=!0,$o=!0,Oi=null,ro=!0,ba="rgba",co="uint8",fo=1,Na=null,ko=null,es=null,Ro=!1;if(typeof cn=="number")Jn=cn|0,Xi=Si|0||Jn;else if(!cn)Jn=Xi=1;else{k.type(cn,"object","invalid arguments for framebuffer");var Ei=cn;if("shape"in Ei){var ts=Ei.shape;k(Array.isArray(ts)&&ts.length>=2,"invalid shape for framebuffer"),Jn=ts[0],Xi=ts[1]}else"radius"in Ei&&(Jn=Xi=Ei.radius),"width"in Ei&&(Jn=Ei.width),"height"in Ei&&(Xi=Ei.height);("color"in Ei||"colors"in Ei)&&(Oi=Ei.color||Ei.colors,Array.isArray(Oi)&&k(Oi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Oi||("colorCount"in Ei&&(fo=Ei.colorCount|0,k(fo>0,"invalid color buffer count")),"colorTexture"in Ei&&(ro=!!Ei.colorTexture,ba="rgba4"),"colorType"in Ei&&(co=Ei.colorType,ro?(k(Se.oes_texture_float||!(co==="float"||co==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),k(Se.oes_texture_half_float||!(co==="half float"||co==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):co==="half float"||co==="float16"?(k(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ba="rgba16f"):(co==="float"||co==="float32")&&(k(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ba="rgba32f"),k.oneOf(co,Vr,"invalid color type")),"colorFormat"in Ei&&(ba=Ei.colorFormat,Dr.indexOf(ba)>=0?ro=!0:Tr.indexOf(ba)>=0?ro=!1:ro?k.oneOf(Ei.colorFormat,Dr,"invalid color format for texture"):k.oneOf(Ei.colorFormat,Tr,"invalid color format for renderbuffer"))),("depthTexture"in Ei||"depthStencilTexture"in Ei)&&(Ro=!!(Ei.depthTexture||Ei.depthStencilTexture),k(!Ro||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ei&&(typeof Ei.depth=="boolean"?La=Ei.depth:(Na=Ei.depth,$o=!1)),"stencil"in Ei&&(typeof Ei.stencil=="boolean"?$o=Ei.stencil:(ko=Ei.stencil,La=!1)),"depthStencil"in Ei&&(typeof Ei.depthStencil=="boolean"?La=$o=Ei.depthStencil:(es=Ei.depthStencil,La=!1,$o=!1))}var ea=null,Yn=null,Ii=null,$i=null;if(Array.isArray(Oi))ea=Oi.map(Nr);else if(Oi)ea=[Nr(Oi)];else for(ea=new Array(fo),ui=0;ui<fo;++ui)ea[ui]=At(Jn,Xi,ro,ba,co);k(Se.webgl_draw_buffers||ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),k(ea.length<=He.maxColorAttachments,"too many color attachments, not supported"),Jn=Jn||ea[0].width,Xi=Xi||ea[0].height,Na?Yn=Nr(Na):La&&!$o&&(Yn=At(Jn,Xi,Ro,"depth","uint32")),ko?Ii=Nr(ko):$o&&!La&&(Ii=At(Jn,Xi,!1,"stencil","uint8")),es?$i=Nr(es):!Na&&!ko&&$o&&La&&($i=At(Jn,Xi,Ro,"depth stencil","depth stencil")),k(!!Na+!!ko+!!es<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ho=null;for(ui=0;ui<ea.length;++ui)if(Xr(ea[ui],Jn,Xi),k(!ea[ui]||ea[ui].texture&&ph.indexOf(ea[ui].texture._texture.format)>=0||ea[ui].renderbuffer&&g.indexOf(ea[ui].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ui+" is invalid"),ea[ui]&&ea[ui].texture){var hl=Jo[ea[ui].texture._texture.format]*Su[ea[ui].texture._texture.type];ho===null?ho=hl:k(ho===hl,"all color attachments much have the same number of bits per pixel.")}return Xr(Yn,Jn,Xi),k(!Yn||Yn.texture&&Yn.texture._texture.format===Yl||Yn.renderbuffer&&Yn.renderbuffer._renderbuffer.format===dh,"invalid depth attachment for framebuffer object"),Xr(Ii,Jn,Xi),k(!Ii||Ii.renderbuffer&&Ii.renderbuffer._renderbuffer.format===Zu,"invalid stencil attachment for framebuffer object"),Xr($i,Jn,Xi),k(!$i||$i.texture&&$i.texture._texture.format===kf||$i.renderbuffer&&$i.renderbuffer._renderbuffer.format===kf,"invalid depth-stencil attachment for framebuffer object"),Cr(ot),ot.width=Jn,ot.height=Xi,ot.colorAttachments=ea,ot.depthAttachment=Yn,ot.stencilAttachment=Ii,ot.depthStencilAttachment=$i,jn.color=ea.map(tr),jn.depth=tr(Yn),jn.stencil=tr(Ii),jn.depthStencil=tr($i),jn.width=ot.width,jn.height=ot.height,_r(ot),jn}function pt(cn,Si){k(Lt.next!==ot,"can not resize a framebuffer which is currently in use");var ui=Math.max(cn|0,1),Jn=Math.max(Si|0||ui,1);if(ui===ot.width&&Jn===ot.height)return jn;for(var Xi=ot.colorAttachments,La=0;La<Xi.length;++La)Ir(Xi[La],ui,Jn);return Ir(ot.depthAttachment,ui,Jn),Ir(ot.stencilAttachment,ui,Jn),Ir(ot.depthStencilAttachment,ui,Jn),ot.width=jn.width=ui,ot.height=jn.height=Jn,_r(ot),jn}return jn(Qr,Pr),N(jn,{resize:pt,_reglType:"framebuffer",_framebuffer:ot,destroy:function(){en(ot),Cr(ot)},use:function(cn){Lt.setFBO({framebuffer:jn},cn)}})}function Vn(Qr){var Pr=Array(6);function ot(pt){var cn;k(Pr.indexOf(Lt.next)<0,"can not update framebuffer which is currently in use");var Si={color:null},ui=0,Jn=null,Xi="rgba",La="uint8",$o=1;if(typeof pt=="number")ui=pt|0;else if(!pt)ui=1;else{k.type(pt,"object","invalid arguments for framebuffer");var Oi=pt;if("shape"in Oi){var ro=Oi.shape;k(Array.isArray(ro)&&ro.length>=2,"invalid shape for framebuffer"),k(ro[0]===ro[1],"cube framebuffer must be square"),ui=ro[0]}else"radius"in Oi&&(ui=Oi.radius|0),"width"in Oi?(ui=Oi.width|0,"height"in Oi&&k(Oi.height===ui,"must be square")):"height"in Oi&&(ui=Oi.height|0);("color"in Oi||"colors"in Oi)&&(Jn=Oi.color||Oi.colors,Array.isArray(Jn)&&k(Jn.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Jn||("colorCount"in Oi&&($o=Oi.colorCount|0,k($o>0,"invalid color buffer count")),"colorType"in Oi&&(k.oneOf(Oi.colorType,Vr,"invalid color type"),La=Oi.colorType),"colorFormat"in Oi&&(Xi=Oi.colorFormat,k.oneOf(Oi.colorFormat,Dr,"invalid color format for texture"))),"depth"in Oi&&(Si.depth=Oi.depth),"stencil"in Oi&&(Si.stencil=Oi.stencil),"depthStencil"in Oi&&(Si.depthStencil=Oi.depthStencil)}var ba;if(Jn)if(Array.isArray(Jn))for(ba=[],cn=0;cn<Jn.length;++cn)ba[cn]=Jn[cn];else ba=[Jn];else{ba=Array($o);var co={radius:ui,format:Xi,type:La};for(cn=0;cn<$o;++cn)ba[cn]=Ht.createCube(co)}for(Si.color=Array(ba.length),cn=0;cn<ba.length;++cn){var fo=ba[cn];k(typeof fo=="function"&&fo._reglType==="textureCube","invalid cube map"),ui=ui||fo.width,k(fo.width===ui&&fo.height===ui,"invalid cube map shape"),Si.color[cn]={target:bu,data:ba[cn]}}for(cn=0;cn<6;++cn){for(var Na=0;Na<ba.length;++Na)Si.color[Na].target=bu+cn;cn>0&&(Si.depth=Pr[0].depth,Si.stencil=Pr[0].stencil,Si.depthStencil=Pr[0].depthStencil),Pr[cn]?Pr[cn](Si):Pr[cn]=Kr(Si)}return N(ot,{width:ui,height:ui,color:ba})}function jn(pt){var cn,Si=pt|0;if(k(Si>0&&Si<=He.maxCubeMapSize,"invalid radius for cube fbo"),Si===ot.width)return ot;var ui=ot.color;for(cn=0;cn<ui.length;++cn)ui[cn].resize(Si);for(cn=0;cn<6;++cn)Pr[cn].resize(Si);return ot.width=ot.height=Si,ot}return ot(Qr),N(ot,{faces:Pr,resize:jn,_reglType:"framebufferCube",destroy:function(){Pr.forEach(function(pt){pt.destroy()})}})}function si(){Lt.cur=null,Lt.next=null,Lt.dirty=!0,ji(gr).forEach(function(Qr){Qr.framebuffer=V.createFramebuffer(),_r(Qr)})}return N(Lt,{getFramebuffer:function(Qr){if(typeof Qr=="function"&&Qr._reglType==="framebuffer"){var Pr=Qr._framebuffer;if(Pr instanceof sn)return Pr}return null},create:Kr,createCube:Vn,clear:function(){ji(gr).forEach(en)},restore:si})}var R=5126,O=34962;function j(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function $(V,Se,He,Ht,cr){for(var Xt=He.maxAttributes,Lt=new Array(Xt),Dr=0;Dr<Xt;++Dr)Lt[Dr]=new j;var Tr=0,Vr={},kr={Record:j,scope:{},state:Lt,currentVAO:null,targetVAO:null,restore:Xr()?gr:function(){},createVAO:sn,getVAO:Nr,destroyBuffer:Zr,setVAO:Xr()?At:tr,clear:Xr()?Ir:function(){}};function Zr(Cr){for(var en=0;en<Lt.length;++en){var _r=Lt[en];_r.buffer===Cr&&(V.disableVertexAttribArray(en),_r.buffer=null)}}function Xr(){return Se.oes_vertex_array_object}function wr(){return Se.angle_instanced_arrays}function Nr(Cr){return typeof Cr=="function"&&Cr._vao?Cr._vao:null}function At(Cr){if(Cr!==kr.currentVAO){var en=Xr();Cr?en.bindVertexArrayOES(Cr.vao):en.bindVertexArrayOES(null),kr.currentVAO=Cr}}function tr(Cr){if(Cr!==kr.currentVAO){if(Cr)Cr.bindAttrs();else for(var en=wr(),_r=0;_r<Lt.length;++_r){var Kr=Lt[_r];Kr.buffer?(V.enableVertexAttribArray(_r),V.vertexAttribPointer(_r,Kr.size,Kr.type,Kr.normalized,Kr.stride,Kr.offfset),en&&en.vertexAttribDivisorANGLE(_r,Kr.divisor)):(V.disableVertexAttribArray(_r),V.vertexAttrib4f(_r,Kr.x,Kr.y,Kr.z,Kr.w))}kr.currentVAO=Cr}}function Ir(){ji(Vr).forEach(function(Cr){Cr.destroy()})}function tn(){this.id=++Tr,this.attributes=[];var Cr=Xr();Cr?this.vao=Cr.createVertexArrayOES():this.vao=null,Vr[this.id]=this,this.buffers=[]}tn.prototype.bindAttrs=function(){for(var Cr=wr(),en=this.attributes,_r=0;_r<en.length;++_r){var Kr=en[_r];Kr.buffer?(V.enableVertexAttribArray(_r),V.bindBuffer(O,Kr.buffer.buffer),V.vertexAttribPointer(_r,Kr.size,Kr.type,Kr.normalized,Kr.stride,Kr.offset),Cr&&Cr.vertexAttribDivisorANGLE(_r,Kr.divisor)):(V.disableVertexAttribArray(_r),V.vertexAttrib4f(_r,Kr.x,Kr.y,Kr.z,Kr.w))}for(var Vn=en.length;Vn<Xt;++Vn)V.disableVertexAttribArray(Vn)},tn.prototype.refresh=function(){var Cr=Xr();Cr&&(Cr.bindVertexArrayOES(this.vao),this.bindAttrs(),kr.currentVAO=this)},tn.prototype.destroy=function(){if(this.vao){var Cr=Xr();this===kr.currentVAO&&(kr.currentVAO=null,Cr.bindVertexArrayOES(null)),Cr.deleteVertexArrayOES(this.vao),this.vao=null}Vr[this.id]&&(delete Vr[this.id],Ht.vaoCount-=1)};function gr(){var Cr=Xr();Cr&&ji(Vr).forEach(function(en){en.refresh()})}function sn(Cr){var en=new tn;Ht.vaoCount+=1;function _r(Kr){k(Array.isArray(Kr),"arguments to vertex array constructor must be an array"),k(Kr.length<Xt,"too many attributes"),k(Kr.length>0,"must specify at least one attribute");for(var Vn=0;Vn<en.buffers.length;++Vn)en.buffers[Vn].destroy();en.buffers.length=0;var si=en.attributes;si.length=Kr.length;for(var Qr=0;Qr<Kr.length;++Qr){var Pr=Kr[Qr],ot=si[Qr]=new j;if(Array.isArray(Pr)||ne(Pr)||Da(Pr)){var jn=cr.create(Pr,O,!1,!0);ot.buffer=cr.getBuffer(jn),ot.size=ot.buffer.dimension|0,ot.normalized=!1,ot.type=ot.buffer.dtype,ot.offset=0,ot.stride=0,ot.divisor=0,ot.state=1,en.buffers.push(jn)}else cr.getBuffer(Pr)?(ot.buffer=cr.getBuffer(Pr),ot.size=ot.buffer.dimension|0,ot.normalized=!1,ot.type=ot.buffer.dtype,ot.offset=0,ot.stride=0,ot.divisor=0,ot.state=1):cr.getBuffer(Pr.buffer)?(ot.buffer=cr.getBuffer(Pr.buffer),ot.size=(+Pr.size||ot.buffer.dimension)|0,ot.normalized=!!Pr.normalized||!1,"type"in Pr?(k.parameter(Pr.type,Ho,"invalid buffer type"),ot.type=Ho[Pr.type]):ot.type=ot.buffer.dtype,ot.offset=(Pr.offset||0)|0,ot.stride=(Pr.stride||0)|0,ot.divisor=(Pr.divisor||0)|0,ot.state=1,k(ot.size>=1&&ot.size<=4,"size must be between 1 and 4"),k(ot.offset>=0,"invalid offset"),k(ot.stride>=0&&ot.stride<=255,"stride must be between 0 and 255"),k(ot.divisor>=0,"divisor must be positive"),k(!ot.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Pr?(k(Qr>0,"first attribute must not be a constant"),ot.x=+Pr.x||0,ot.y=+Pr.y||0,ot.z=+Pr.z||0,ot.w=+Pr.w||0,ot.state=2):k(!1,"invalid attribute spec for location "+Qr)}return en.refresh(),_r}return _r.destroy=function(){en.destroy()},_r._vao=en,_r._reglType="vao",_r(Cr)}return kr}var pe=35632,_e=35633,xe=35718,Ue=35721;function Be(V,Se,He,Ht){var cr={},Xt={};function Lt(At,tr,Ir,tn){this.name=At,this.id=tr,this.location=Ir,this.info=tn}function Dr(At,tr){for(var Ir=0;Ir<At.length;++Ir)if(At[Ir].id===tr.id){At[Ir].location=tr.location;return}At.push(tr)}function Tr(At,tr,Ir){var tn=At===pe?cr:Xt,gr=tn[tr];if(!gr){var sn=Se.str(tr);gr=V.createShader(At),V.shaderSource(gr,sn),V.compileShader(gr),k.shaderError(V,gr,sn,At,Ir),tn[tr]=gr}return gr}var Vr={},kr=[],Zr=0;function Xr(At,tr){this.id=Zr++,this.fragId=At,this.vertId=tr,this.program=null,this.uniforms=[],this.attributes=[],Ht.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function wr(At,tr,Ir){var tn,gr,sn=Tr(pe,At.fragId),Cr=Tr(_e,At.vertId),en=At.program=V.createProgram();if(V.attachShader(en,sn),V.attachShader(en,Cr),Ir)for(tn=0;tn<Ir.length;++tn){var _r=Ir[tn];V.bindAttribLocation(en,_r[0],_r[1])}V.linkProgram(en),k.linkError(V,en,Se.str(At.fragId),Se.str(At.vertId),tr);var Kr=V.getProgramParameter(en,xe);Ht.profile&&(At.stats.uniformsCount=Kr);var Vn=At.uniforms;for(tn=0;tn<Kr;++tn)if(gr=V.getActiveUniform(en,tn),gr)if(gr.size>1)for(var si=0;si<gr.size;++si){var Qr=gr.name.replace("[0]","["+si+"]");Dr(Vn,new Lt(Qr,Se.id(Qr),V.getUniformLocation(en,Qr),gr))}else Dr(Vn,new Lt(gr.name,Se.id(gr.name),V.getUniformLocation(en,gr.name),gr));var Pr=V.getProgramParameter(en,Ue);Ht.profile&&(At.stats.attributesCount=Pr);var ot=At.attributes;for(tn=0;tn<Pr;++tn)gr=V.getActiveAttrib(en,tn),gr&&Dr(ot,new Lt(gr.name,Se.id(gr.name),V.getAttribLocation(en,gr.name),gr))}Ht.profile&&(He.getMaxUniformsCount=function(){var At=0;return kr.forEach(function(tr){tr.stats.uniformsCount>At&&(At=tr.stats.uniformsCount)}),At},He.getMaxAttributesCount=function(){var At=0;return kr.forEach(function(tr){tr.stats.attributesCount>At&&(At=tr.stats.attributesCount)}),At});function Nr(){cr={},Xt={};for(var At=0;At<kr.length;++At)wr(kr[At],null,kr[At].attributes.map(function(tr){return[tr.location,tr.name]}))}return{clear:function(){var At=V.deleteShader.bind(V);ji(cr).forEach(At),cr={},ji(Xt).forEach(At),Xt={},kr.forEach(function(tr){V.deleteProgram(tr.program)}),kr.length=0,Vr={},He.shaderCount=0},program:function(At,tr,Ir,tn){k.command(At>=0,"missing vertex shader",Ir),k.command(tr>=0,"missing fragment shader",Ir);var gr=Vr[tr];gr||(gr=Vr[tr]={});var sn=gr[At];if(sn&&!tn)return sn;var Cr=new Xr(tr,At);return He.shaderCount++,wr(Cr,Ir,tn),sn||(gr[At]=Cr),kr.push(Cr),Cr},restore:Nr,shader:Tr,frag:-1,vert:-1}}var Qe=6408,Ie=5121,qe=3333,ft=5126;function Rt(V,Se,He,Ht,cr,Xt,Lt){function Dr(kr){var Zr;Se.next===null?(k(cr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Zr=Ie):(k(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Zr=Se.next.colorAttachments[0].texture._texture.type,Xt.oes_texture_float?(k(Zr===Ie||Zr===ft,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Zr===ft&&k(Lt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):k(Zr===Ie,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Xr=0,wr=0,Nr=Ht.framebufferWidth,At=Ht.framebufferHeight,tr=null;ne(kr)?tr=kr:kr&&(k.type(kr,"object","invalid arguments to regl.read()"),Xr=kr.x|0,wr=kr.y|0,k(Xr>=0&&Xr<Ht.framebufferWidth,"invalid x offset for regl.read"),k(wr>=0&&wr<Ht.framebufferHeight,"invalid y offset for regl.read"),Nr=(kr.width||Ht.framebufferWidth-Xr)|0,At=(kr.height||Ht.framebufferHeight-wr)|0,tr=kr.data||null),tr&&(Zr===Ie?k(tr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Zr===ft&&k(tr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),k(Nr>0&&Nr+Xr<=Ht.framebufferWidth,"invalid width for read pixels"),k(At>0&&At+wr<=Ht.framebufferHeight,"invalid height for read pixels"),He();var Ir=Nr*At*4;return tr||(Zr===Ie?tr=new Uint8Array(Ir):Zr===ft&&(tr=tr||new Float32Array(Ir))),k.isTypedArray(tr,"data buffer for regl.read() must be a typedarray"),k(tr.byteLength>=Ir,"data buffer for regl.read() too small"),V.pixelStorei(qe,4),V.readPixels(Xr,wr,Nr,At,Qe,Zr,tr),tr}function Tr(kr){var Zr;return Se.setFBO({framebuffer:kr.framebuffer},function(){Zr=Dr(kr)}),Zr}function Vr(kr){return!kr||!("framebuffer"in kr)?Dr(kr):Tr(kr)}return Vr}function $t(V){return Array.prototype.slice.call(V)}function jt(V){return $t(V).join("")}function ir(){var V=0,Se=[],He=[];function Ht(Zr){for(var Xr=0;Xr<He.length;++Xr)if(He[Xr]===Zr)return Se[Xr];var wr="g"+V++;return Se.push(wr),He.push(Zr),wr}function cr(){var Zr=[];function Xr(){Zr.push.apply(Zr,$t(arguments))}var wr=[];function Nr(){var At="v"+V++;return wr.push(At),arguments.length>0&&(Zr.push(At,"="),Zr.push.apply(Zr,$t(arguments)),Zr.push(";")),At}return N(Xr,{def:Nr,toString:function(){return jt([wr.length>0?"var "+wr.join(",")+";":"",jt(Zr)])}})}function Xt(){var Zr=cr(),Xr=cr(),wr=Zr.toString,Nr=Xr.toString;function At(tr,Ir){Xr(tr,Ir,"=",Zr.def(tr,Ir),";")}return N(function(){Zr.apply(Zr,$t(arguments))},{def:Zr.def,entry:Zr,exit:Xr,save:At,set:function(tr,Ir,tn){At(tr,Ir),Zr(tr,Ir,"=",tn,";")},toString:function(){return wr()+Nr()}})}function Lt(){var Zr=jt(arguments),Xr=Xt(),wr=Xt(),Nr=Xr.toString,At=wr.toString;return N(Xr,{then:function(){return Xr.apply(Xr,$t(arguments)),this},else:function(){return wr.apply(wr,$t(arguments)),this},toString:function(){var tr=At();return tr&&(tr="else{"+tr+"}"),jt(["if(",Zr,"){",Nr(),"}",tr])}})}var Dr=cr(),Tr={};function Vr(Zr,Xr){var wr=[];function Nr(){var gr="a"+wr.length;return wr.push(gr),gr}Xr=Xr||0;for(var At=0;At<Xr;++At)Nr();var tr=Xt(),Ir=tr.toString,tn=Tr[Zr]=N(tr,{arg:Nr,toString:function(){return jt(["function(",wr.join(),"){",Ir(),"}"])}});return tn}function kr(){var Zr=['"use strict";',Dr,"return {"];Object.keys(Tr).forEach(function(Nr){Zr.push('"',Nr,'":',Tr[Nr].toString(),",")}),Zr.push("}");var Xr=jt(Zr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),wr=Function.apply(null,Se.concat(Xr));return wr.apply(null,He)}return{global:Dr,link:Ht,block:cr,proc:Vr,scope:Xt,cond:Lt,compile:kr}}var pr="xyzw".split(""),Ur=5121,Fr=1,ln=2,Un=0,Bn=1,Zn=2,Zi=3,mn=4,oi="dither",vi="blend.enable",ai="blend.color",ti="blend.equation",pi="blend.func",ri="depth.enable",$n="depth.func",bo="depth.range",ja="depth.mask",Eo="colorMask",lo="cull.enable",Ba="cull.face",Ha="frontFace",cs="lineWidth",fs="polygonOffset.enable",sl="polygonOffset.offset",hs="sample.alpha",lu="sample.enable",Bs="sample.coverage",Ec="stencil.enable",Vu="stencil.mask",Au="stencil.func",ql="stencil.opFront",ul="stencil.opBack",cu="scissor.enable",ll="scissor.box",So="viewport",Qa="profile",ys="framebuffer",fu="vert",Tu="frag",Ui="elements",Go="primitive",Ja="count",hu="offset",Sc="instances",ju="vao",mh="Width",Ao="Height",Mr=ys+mh,Ls=ys+Ao,gh=So+mh,To=So+Ao,Ys="drawingBuffer",wo=Ys+mh,Qh=Ys+Ao,Kl=[pi,ti,Au,ql,ul,Bs,So,ll,sl],cl=34962,Lp=34963,og=35632,kv=35633,Bf=3553,Jh=34067,_h=2884,Rd=3042,Ac=3024,yh=2960,Bv=2929,Md=3089,sg=32823,Np=32926,Id=32928,Pd=5126,Up=35664,Pl=35665,ep=35666,Tc=5124,zp=35667,Wa=35668,Lf=35669,Nf=35670,tf=35671,rf=35672,wc=35673,Uf=35674,xh=35675,Ol=35676,Ql=35678,Cc=35680,Od=4,ps=1028,nf=1029,tp=2304,Zp=2305,bh=32775,Vp=32776,qs=519,Rc=7680,rp=0,Dd=1,Eh=32774,jp=513,Jl=36160,Hp=36064,fl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},np=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ks={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Mc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wp={frag:og,vert:kv},ec={cw:tp,ccw:Zp};function zf(V){return Array.isArray(V)||ne(V)||Da(V)}function Zf(V){return V.sort(function(Se,He){return Se===So?-1:He===So?1:Se<He?-1:1})}function xs(V,Se,He,Ht){this.thisDep=V,this.contextDep=Se,this.propDep=He,this.append=Ht}function ds(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function Co(V){return new xs(!1,!1,!1,V)}function Qs(V,Se){var He=V.type;if(He===Un){var Ht=V.data.length;return new xs(!0,Ht>=1,Ht>=2,Se)}else if(He===mn){var cr=V.data;return new xs(cr.thisDep,cr.contextDep,cr.propDep,Se)}else return new xs(He===Zi,He===Zn,He===Bn,Se)}var ip=new xs(!1,!1,!1,function(){});function Vf(V,Se,He,Ht,cr,Xt,Lt,Dr,Tr,Vr,kr,Zr,Xr,wr,Nr){var At=Vr.Record,tr={add:32774,subtract:32778,"reverse subtract":32779};He.ext_blend_minmax&&(tr.min=bh,tr.max=Vp);var Ir=He.angle_instanced_arrays,tn=He.webgl_draw_buffers,gr={dirty:!0,profile:Nr.profile},sn={},Cr=[],en={},_r={};function Kr(fe){return fe.replace(".","_")}function Vn(fe,Ce,We){var zt=Kr(fe);Cr.push(fe),sn[zt]=gr[zt]=!!We,en[zt]=Ce}function si(fe,Ce,We){var zt=Kr(fe);Cr.push(fe),Array.isArray(We)?(gr[zt]=We.slice(),sn[zt]=We.slice()):gr[zt]=sn[zt]=We,_r[zt]=Ce}Vn(oi,Ac),Vn(vi,Rd),si(ai,"blendColor",[0,0,0,0]),si(ti,"blendEquationSeparate",[Eh,Eh]),si(pi,"blendFuncSeparate",[Dd,rp,Dd,rp]),Vn(ri,Bv,!0),si($n,"depthFunc",jp),si(bo,"depthRange",[0,1]),si(ja,"depthMask",!0),si(Eo,Eo,[!0,!0,!0,!0]),Vn(lo,_h),si(Ba,"cullFace",nf),si(Ha,Ha,Zp),si(cs,cs,1),Vn(fs,sg),si(sl,"polygonOffset",[0,0]),Vn(hs,Np),Vn(lu,Id),si(Bs,"sampleCoverage",[1,!1]),Vn(Ec,yh),si(Vu,"stencilMask",-1),si(Au,"stencilFunc",[qs,0,-1]),si(ql,"stencilOpSeparate",[ps,Rc,Rc,Rc]),si(ul,"stencilOpSeparate",[nf,Rc,Rc,Rc]),Vn(cu,Md),si(ll,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),si(So,So,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var Qr={gl:V,context:Xr,strings:Se,next:sn,current:gr,draw:Zr,elements:Xt,buffer:cr,shader:kr,attributes:Vr.state,vao:Vr,uniforms:Tr,framebuffer:Dr,extensions:He,timer:wr,isBufferArgs:zf},Pr={primTypes:Bu,compareFuncs:Ks,blendFuncs:fl,blendEquations:tr,stencilOps:Mc,glTypes:Ho,orientationType:ec};k.optional(function(){Qr.isArrayLike=Va}),tn&&(Pr.backBuffer=[nf],Pr.drawBuffer=wi(Ht.maxDrawbuffers,function(fe){return fe===0?[0]:wi(fe,function(Ce){return Hp+Ce})}));var ot=0;function jn(){var fe=ir(),Ce=fe.link,We=fe.global;fe.id=ot++,fe.batchId="0";var zt=Ce(Qr),Ft=fe.shared={props:"a0"};Object.keys(Qr).forEach(function(et){Ft[et]=We.def(zt,".",et)}),k.optional(function(){fe.CHECK=Ce(k),fe.commandStr=k.guessCommand(),fe.command=Ce(fe.commandStr),fe.assert=function(et,we,Ye){et("if(!(",we,"))",this.CHECK,".commandRaise(",Ce(Ye),",",this.command,");")},Pr.invalidBlendCombinations=np});var Je=fe.next={},ut=fe.current={};Object.keys(_r).forEach(function(et){Array.isArray(gr[et])&&(Je[et]=We.def(Ft.next,".",et),ut[et]=We.def(Ft.current,".",et))});var dt=fe.constants={};Object.keys(Pr).forEach(function(et){dt[et]=We.def(JSON.stringify(Pr[et]))}),fe.invoke=function(et,we){switch(we.type){case Un:var Ye=["this",Ft.context,Ft.props,fe.batchId];return et.def(Ce(we.data),".call(",Ye.slice(0,Math.max(we.data.length+1,4)),")");case Bn:return et.def(Ft.props,we.data);case Zn:return et.def(Ft.context,we.data);case Zi:return et.def("this",we.data);case mn:return we.data.append(fe,et),we.data.ref}},fe.attribCache={};var ze={};return fe.scopeAttrib=function(et){var we=Se.id(et);if(we in ze)return ze[we];var Ye=Vr.scope[we];Ye||(Ye=Vr.scope[we]=new At);var Vt=ze[we]=Ce(Ye);return Vt},fe}function pt(fe){var Ce=fe.static,We=fe.dynamic,zt;if(Qa in Ce){var Ft=!!Ce[Qa];zt=Co(function(ut,dt){return Ft}),zt.enable=Ft}else if(Qa in We){var Je=We[Qa];zt=Qs(Je,function(ut,dt){return ut.invoke(dt,Je)})}return zt}function cn(fe,Ce){var We=fe.static,zt=fe.dynamic;if(ys in We){var Ft=We[ys];return Ft?(Ft=Dr.getFramebuffer(Ft),k.command(Ft,"invalid framebuffer object"),Co(function(ut,dt){var ze=ut.link(Ft),et=ut.shared;dt.set(et.framebuffer,".next",ze);var we=et.context;return dt.set(we,"."+Mr,ze+".width"),dt.set(we,"."+Ls,ze+".height"),ze})):Co(function(ut,dt){var ze=ut.shared;dt.set(ze.framebuffer,".next","null");var et=ze.context;return dt.set(et,"."+Mr,et+"."+wo),dt.set(et,"."+Ls,et+"."+Qh),"null"})}else if(ys in zt){var Je=zt[ys];return Qs(Je,function(ut,dt){var ze=ut.invoke(dt,Je),et=ut.shared,we=et.framebuffer,Ye=dt.def(we,".getFramebuffer(",ze,")");k.optional(function(){ut.assert(dt,"!"+ze+"||"+Ye,"invalid framebuffer object")}),dt.set(we,".next",Ye);var Vt=et.context;return dt.set(Vt,"."+Mr,Ye+"?"+Ye+".width:"+Vt+"."+wo),dt.set(Vt,"."+Ls,Ye+"?"+Ye+".height:"+Vt+"."+Qh),Ye})}else return null}function Si(fe,Ce,We){var zt=fe.static,Ft=fe.dynamic;function Je(ze){if(ze in zt){var et=zt[ze];k.commandType(et,"object","invalid "+ze,We.commandStr);var we=!0,Ye=et.x|0,Vt=et.y|0,ar,Er;return"width"in et?(ar=et.width|0,k.command(ar>=0,"invalid "+ze,We.commandStr)):we=!1,"height"in et?(Er=et.height|0,k.command(Er>=0,"invalid "+ze,We.commandStr)):we=!1,new xs(!we&&Ce&&Ce.thisDep,!we&&Ce&&Ce.contextDep,!we&&Ce&&Ce.propDep,function(In,yn){var bn=In.shared.context,qn=ar;"width"in et||(qn=yn.def(bn,".",Mr,"-",Ye));var li=Er;return"height"in et||(li=yn.def(bn,".",Ls,"-",Vt)),[Ye,Vt,qn,li]})}else if(ze in Ft){var vr=Ft[ze],Rr=Qs(vr,function(In,yn){var bn=In.invoke(yn,vr);k.optional(function(){In.assert(yn,bn+"&&typeof "+bn+'==="object"',"invalid "+ze)});var qn=In.shared.context,li=yn.def(bn,".x|0"),Pi=yn.def(bn,".y|0"),Ga=yn.def('"width" in ',bn,"?",bn,".width|0:","(",qn,".",Mr,"-",li,")"),Js=yn.def('"height" in ',bn,"?",bn,".height|0:","(",qn,".",Ls,"-",Pi,")");return k.optional(function(){In.assert(yn,Ga+">=0&&"+Js+">=0","invalid "+ze)}),[li,Pi,Ga,Js]});return Ce&&(Rr.thisDep=Rr.thisDep||Ce.thisDep,Rr.contextDep=Rr.contextDep||Ce.contextDep,Rr.propDep=Rr.propDep||Ce.propDep),Rr}else return Ce?new xs(Ce.thisDep,Ce.contextDep,Ce.propDep,function(In,yn){var bn=In.shared.context;return[0,0,yn.def(bn,".",Mr),yn.def(bn,".",Ls)]}):null}var ut=Je(So);if(ut){var dt=ut;ut=new xs(ut.thisDep,ut.contextDep,ut.propDep,function(ze,et){var we=dt.append(ze,et),Ye=ze.shared.context;return et.set(Ye,"."+gh,we[2]),et.set(Ye,"."+To,we[3]),we})}return{viewport:ut,scissor_box:Je(ll)}}function ui(fe,Ce){var We=fe.static,zt=typeof We[Tu]=="string"&&typeof We[fu]=="string";if(zt){if(Object.keys(Ce.dynamic).length>0)return null;var Ft=Ce.static,Je=Object.keys(Ft);if(Je.length>0&&typeof Ft[Je[0]]=="number"){for(var ut=[],dt=0;dt<Je.length;++dt)k(typeof Ft[Je[dt]]=="number","must specify all vertex attribute locations when using vaos"),ut.push([Ft[Je[dt]]|0,Je[dt]]);return ut}}return null}function Jn(fe,Ce,We){var zt=fe.static,Ft=fe.dynamic;function Je(we){if(we in zt){var Ye=Se.id(zt[we]);k.optional(function(){kr.shader(Wp[we],Ye,k.guessCommand())});var Vt=Co(function(){return Ye});return Vt.id=Ye,Vt}else if(we in Ft){var ar=Ft[we];return Qs(ar,function(Er,vr){var Rr=Er.invoke(vr,ar),In=vr.def(Er.shared.strings,".id(",Rr,")");return k.optional(function(){vr(Er.shared.shader,".shader(",Wp[we],",",In,",",Er.command,");")}),In})}return null}var ut=Je(Tu),dt=Je(fu),ze=null,et;return ds(ut)&&ds(dt)?(ze=kr.program(dt.id,ut.id,null,We),et=Co(function(we,Ye){return we.link(ze)})):et=new xs(ut&&ut.thisDep||dt&&dt.thisDep,ut&&ut.contextDep||dt&&dt.contextDep,ut&&ut.propDep||dt&&dt.propDep,function(we,Ye){var Vt=we.shared.shader,ar;ut?ar=ut.append(we,Ye):ar=Ye.def(Vt,".",Tu);var Er;dt?Er=dt.append(we,Ye):Er=Ye.def(Vt,".",fu);var vr=Vt+".program("+Er+","+ar;return k.optional(function(){vr+=","+we.command}),Ye.def(vr+")")}),{frag:ut,vert:dt,progVar:et,program:ze}}function Xi(fe,Ce){var We=fe.static,zt=fe.dynamic;function Ft(){if(Ui in We){var we=We[Ui];zf(we)?we=Xt.getElements(Xt.create(we,!0)):we&&(we=Xt.getElements(we),k.command(we,"invalid elements",Ce.commandStr));var Ye=Co(function(ar,Er){if(we){var vr=ar.link(we);return ar.ELEMENTS=vr,vr}return ar.ELEMENTS=null,null});return Ye.value=we,Ye}else if(Ui in zt){var Vt=zt[Ui];return Qs(Vt,function(ar,Er){var vr=ar.shared,Rr=vr.isBufferArgs,In=vr.elements,yn=ar.invoke(Er,Vt),bn=Er.def("null"),qn=Er.def(Rr,"(",yn,")"),li=ar.cond(qn).then(bn,"=",In,".createStream(",yn,");").else(bn,"=",In,".getElements(",yn,");");return k.optional(function(){ar.assert(li.else,"!"+yn+"||"+bn,"invalid elements")}),Er.entry(li),Er.exit(ar.cond(qn).then(In,".destroyStream(",bn,");")),ar.ELEMENTS=bn,bn})}return null}var Je=Ft();function ut(){if(Go in We){var we=We[Go];return k.commandParameter(we,Bu,"invalid primitve",Ce.commandStr),Co(function(Vt,ar){return Bu[we]})}else if(Go in zt){var Ye=zt[Go];return Qs(Ye,function(Vt,ar){var Er=Vt.constants.primTypes,vr=Vt.invoke(ar,Ye);return k.optional(function(){Vt.assert(ar,vr+" in "+Er,"invalid primitive, must be one of "+Object.keys(Bu))}),ar.def(Er,"[",vr,"]")})}else if(Je)return ds(Je)?Je.value?Co(function(Vt,ar){return ar.def(Vt.ELEMENTS,".primType")}):Co(function(){return Od}):new xs(Je.thisDep,Je.contextDep,Je.propDep,function(Vt,ar){var Er=Vt.ELEMENTS;return ar.def(Er,"?",Er,".primType:",Od)});return null}function dt(we,Ye){if(we in We){var Vt=We[we]|0;return k.command(!Ye||Vt>=0,"invalid "+we,Ce.commandStr),Co(function(Er,vr){return Ye&&(Er.OFFSET=Vt),Vt})}else if(we in zt){var ar=zt[we];return Qs(ar,function(Er,vr){var Rr=Er.invoke(vr,ar);return Ye&&(Er.OFFSET=Rr,k.optional(function(){Er.assert(vr,Rr+">=0","invalid "+we)})),Rr})}else if(Ye&&Je)return Co(function(Er,vr){return Er.OFFSET="0",0});return null}var ze=dt(hu,!0);function et(){if(Ja in We){var we=We[Ja]|0;return k.command(typeof we=="number"&&we>=0,"invalid vertex count",Ce.commandStr),Co(function(){return we})}else if(Ja in zt){var Ye=zt[Ja];return Qs(Ye,function(Er,vr){var Rr=Er.invoke(vr,Ye);return k.optional(function(){Er.assert(vr,"typeof "+Rr+'==="number"&&'+Rr+">=0&&"+Rr+"===("+Rr+"|0)","invalid vertex count")}),Rr})}else if(Je)if(ds(Je)){if(Je)return ze?new xs(ze.thisDep,ze.contextDep,ze.propDep,function(Er,vr){var Rr=vr.def(Er.ELEMENTS,".vertCount-",Er.OFFSET);return k.optional(function(){Er.assert(vr,Rr+">=0","invalid vertex offset/element buffer too small")}),Rr}):Co(function(Er,vr){return vr.def(Er.ELEMENTS,".vertCount")});var Vt=Co(function(){return-1});return k.optional(function(){Vt.MISSING=!0}),Vt}else{var ar=new xs(Je.thisDep||ze.thisDep,Je.contextDep||ze.contextDep,Je.propDep||ze.propDep,function(Er,vr){var Rr=Er.ELEMENTS;return Er.OFFSET?vr.def(Rr,"?",Rr,".vertCount-",Er.OFFSET,":-1"):vr.def(Rr,"?",Rr,".vertCount:-1")});return k.optional(function(){ar.DYNAMIC=!0}),ar}return null}return{elements:Je,primitive:ut(),count:et(),instances:dt(Sc,!1),offset:ze}}function La(fe,Ce){var We=fe.static,zt=fe.dynamic,Ft={};return Cr.forEach(function(Je){var ut=Kr(Je);function dt(ze,et){if(Je in We){var we=ze(We[Je]);Ft[ut]=Co(function(){return we})}else if(Je in zt){var Ye=zt[Je];Ft[ut]=Qs(Ye,function(Vt,ar){return et(Vt,ar,Vt.invoke(ar,Ye))})}}switch(Je){case lo:case vi:case oi:case Ec:case ri:case cu:case fs:case hs:case lu:case ja:return dt(function(ze){return k.commandType(ze,"boolean",Je,Ce.commandStr),ze},function(ze,et,we){return k.optional(function(){ze.assert(et,"typeof "+we+'==="boolean"',"invalid flag "+Je,ze.commandStr)}),we});case $n:return dt(function(ze){return k.commandParameter(ze,Ks,"invalid "+Je,Ce.commandStr),Ks[ze]},function(ze,et,we){var Ye=ze.constants.compareFuncs;return k.optional(function(){ze.assert(et,we+" in "+Ye,"invalid "+Je+", must be one of "+Object.keys(Ks))}),et.def(Ye,"[",we,"]")});case bo:return dt(function(ze){return k.command(Va(ze)&&ze.length===2&&typeof ze[0]=="number"&&typeof ze[1]=="number"&&ze[0]<=ze[1],"depth range is 2d array",Ce.commandStr),ze},function(ze,et,we){k.optional(function(){ze.assert(et,ze.shared.isArrayLike+"("+we+")&&"+we+".length===2&&typeof "+we+'[0]==="number"&&typeof '+we+'[1]==="number"&&'+we+"[0]<="+we+"[1]","depth range must be a 2d array")});var Ye=et.def("+",we,"[0]"),Vt=et.def("+",we,"[1]");return[Ye,Vt]});case pi:return dt(function(ze){k.commandType(ze,"object","blend.func",Ce.commandStr);var et="srcRGB"in ze?ze.srcRGB:ze.src,we="srcAlpha"in ze?ze.srcAlpha:ze.src,Ye="dstRGB"in ze?ze.dstRGB:ze.dst,Vt="dstAlpha"in ze?ze.dstAlpha:ze.dst;return k.commandParameter(et,fl,ut+".srcRGB",Ce.commandStr),k.commandParameter(we,fl,ut+".srcAlpha",Ce.commandStr),k.commandParameter(Ye,fl,ut+".dstRGB",Ce.commandStr),k.commandParameter(Vt,fl,ut+".dstAlpha",Ce.commandStr),k.command(np.indexOf(et+", "+Ye)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+et+", "+Ye+")",Ce.commandStr),[fl[et],fl[Ye],fl[we],fl[Vt]]},function(ze,et,we){var Ye=ze.constants.blendFuncs;k.optional(function(){ze.assert(et,we+"&&typeof "+we+'==="object"',"invalid blend func, must be an object")});function Vt(bn,qn){var li=et.def('"',bn,qn,'" in ',we,"?",we,".",bn,qn,":",we,".",bn);return k.optional(function(){ze.assert(et,li+" in "+Ye,"invalid "+Je+"."+bn+qn+", must be one of "+Object.keys(fl))}),li}var ar=Vt("src","RGB"),Er=Vt("dst","RGB");k.optional(function(){var bn=ze.constants.invalidBlendCombinations;ze.assert(et,bn+".indexOf("+ar+'+", "+'+Er+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var vr=et.def(Ye,"[",ar,"]"),Rr=et.def(Ye,"[",Vt("src","Alpha"),"]"),In=et.def(Ye,"[",Er,"]"),yn=et.def(Ye,"[",Vt("dst","Alpha"),"]");return[vr,In,Rr,yn]});case ti:return dt(function(ze){if(typeof ze=="string")return k.commandParameter(ze,tr,"invalid "+Je,Ce.commandStr),[tr[ze],tr[ze]];if(typeof ze=="object")return k.commandParameter(ze.rgb,tr,Je+".rgb",Ce.commandStr),k.commandParameter(ze.alpha,tr,Je+".alpha",Ce.commandStr),[tr[ze.rgb],tr[ze.alpha]];k.commandRaise("invalid blend.equation",Ce.commandStr)},function(ze,et,we){var Ye=ze.constants.blendEquations,Vt=et.def(),ar=et.def(),Er=ze.cond("typeof ",we,'==="string"');return k.optional(function(){function vr(Rr,In,yn){ze.assert(Rr,yn+" in "+Ye,"invalid "+In+", must be one of "+Object.keys(tr))}vr(Er.then,Je,we),ze.assert(Er.else,we+"&&typeof "+we+'==="object"',"invalid "+Je),vr(Er.else,Je+".rgb",we+".rgb"),vr(Er.else,Je+".alpha",we+".alpha")}),Er.then(Vt,"=",ar,"=",Ye,"[",we,"];"),Er.else(Vt,"=",Ye,"[",we,".rgb];",ar,"=",Ye,"[",we,".alpha];"),et(Er),[Vt,ar]});case ai:return dt(function(ze){return k.command(Va(ze)&&ze.length===4,"blend.color must be a 4d array",Ce.commandStr),wi(4,function(et){return+ze[et]})},function(ze,et,we){return k.optional(function(){ze.assert(et,ze.shared.isArrayLike+"("+we+")&&"+we+".length===4","blend.color must be a 4d array")}),wi(4,function(Ye){return et.def("+",we,"[",Ye,"]")})});case Vu:return dt(function(ze){return k.commandType(ze,"number",ut,Ce.commandStr),ze|0},function(ze,et,we){return k.optional(function(){ze.assert(et,"typeof "+we+'==="number"',"invalid stencil.mask")}),et.def(we,"|0")});case Au:return dt(function(ze){k.commandType(ze,"object",ut,Ce.commandStr);var et=ze.cmp||"keep",we=ze.ref||0,Ye="mask"in ze?ze.mask:-1;return k.commandParameter(et,Ks,Je+".cmp",Ce.commandStr),k.commandType(we,"number",Je+".ref",Ce.commandStr),k.commandType(Ye,"number",Je+".mask",Ce.commandStr),[Ks[et],we,Ye]},function(ze,et,we){var Ye=ze.constants.compareFuncs;k.optional(function(){function vr(){ze.assert(et,Array.prototype.join.call(arguments,""),"invalid stencil.func")}vr(we+"&&typeof ",we,'==="object"'),vr('!("cmp" in ',we,")||(",we,".cmp in ",Ye,")")});var Vt=et.def('"cmp" in ',we,"?",Ye,"[",we,".cmp]",":",Rc),ar=et.def(we,".ref|0"),Er=et.def('"mask" in ',we,"?",we,".mask|0:-1");return[Vt,ar,Er]});case ql:case ul:return dt(function(ze){k.commandType(ze,"object",ut,Ce.commandStr);var et=ze.fail||"keep",we=ze.zfail||"keep",Ye=ze.zpass||"keep";return k.commandParameter(et,Mc,Je+".fail",Ce.commandStr),k.commandParameter(we,Mc,Je+".zfail",Ce.commandStr),k.commandParameter(Ye,Mc,Je+".zpass",Ce.commandStr),[Je===ul?nf:ps,Mc[et],Mc[we],Mc[Ye]]},function(ze,et,we){var Ye=ze.constants.stencilOps;k.optional(function(){ze.assert(et,we+"&&typeof "+we+'==="object"',"invalid "+Je)});function Vt(ar){return k.optional(function(){ze.assert(et,'!("'+ar+'" in '+we+")||("+we+"."+ar+" in "+Ye+")","invalid "+Je+"."+ar+", must be one of "+Object.keys(Mc))}),et.def('"',ar,'" in ',we,"?",Ye,"[",we,".",ar,"]:",Rc)}return[Je===ul?nf:ps,Vt("fail"),Vt("zfail"),Vt("zpass")]});case sl:return dt(function(ze){k.commandType(ze,"object",ut,Ce.commandStr);var et=ze.factor|0,we=ze.units|0;return k.commandType(et,"number",ut+".factor",Ce.commandStr),k.commandType(we,"number",ut+".units",Ce.commandStr),[et,we]},function(ze,et,we){k.optional(function(){ze.assert(et,we+"&&typeof "+we+'==="object"',"invalid "+Je)});var Ye=et.def(we,".factor|0"),Vt=et.def(we,".units|0");return[Ye,Vt]});case Ba:return dt(function(ze){var et=0;return ze==="front"?et=ps:ze==="back"&&(et=nf),k.command(!!et,ut,Ce.commandStr),et},function(ze,et,we){return k.optional(function(){ze.assert(et,we+'==="front"||'+we+'==="back"',"invalid cull.face")}),et.def(we,'==="front"?',ps,":",nf)});case cs:return dt(function(ze){return k.command(typeof ze=="number"&&ze>=Ht.lineWidthDims[0]&&ze<=Ht.lineWidthDims[1],"invalid line width, must be a positive number between "+Ht.lineWidthDims[0]+" and "+Ht.lineWidthDims[1],Ce.commandStr),ze},function(ze,et,we){return k.optional(function(){ze.assert(et,"typeof "+we+'==="number"&&'+we+">="+Ht.lineWidthDims[0]+"&&"+we+"<="+Ht.lineWidthDims[1],"invalid line width")}),we});case Ha:return dt(function(ze){return k.commandParameter(ze,ec,ut,Ce.commandStr),ec[ze]},function(ze,et,we){return k.optional(function(){ze.assert(et,we+'==="cw"||'+we+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),et.def(we+'==="cw"?'+tp+":"+Zp)});case Eo:return dt(function(ze){return k.command(Va(ze)&&ze.length===4,"color.mask must be length 4 array",Ce.commandStr),ze.map(function(et){return!!et})},function(ze,et,we){return k.optional(function(){ze.assert(et,ze.shared.isArrayLike+"("+we+")&&"+we+".length===4","invalid color.mask")}),wi(4,function(Ye){return"!!"+we+"["+Ye+"]"})});case Bs:return dt(function(ze){k.command(typeof ze=="object"&&ze,ut,Ce.commandStr);var et="value"in ze?ze.value:1,we=!!ze.invert;return k.command(typeof et=="number"&&et>=0&&et<=1,"sample.coverage.value must be a number between 0 and 1",Ce.commandStr),[et,we]},function(ze,et,we){k.optional(function(){ze.assert(et,we+"&&typeof "+we+'==="object"',"invalid sample.coverage")});var Ye=et.def('"value" in ',we,"?+",we,".value:1"),Vt=et.def("!!",we,".invert");return[Ye,Vt]})}}),Ft}function $o(fe,Ce){var We=fe.static,zt=fe.dynamic,Ft={};return Object.keys(We).forEach(function(Je){var ut=We[Je],dt;if(typeof ut=="number"||typeof ut=="boolean")dt=Co(function(){return ut});else if(typeof ut=="function"){var ze=ut._reglType;ze==="texture2d"||ze==="textureCube"?dt=Co(function(et){return et.link(ut)}):ze==="framebuffer"||ze==="framebufferCube"?(k.command(ut.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Je+'"',Ce.commandStr),dt=Co(function(et){return et.link(ut.color[0])})):k.commandRaise('invalid data for uniform "'+Je+'"',Ce.commandStr)}else Va(ut)?dt=Co(function(et){var we=et.global.def("[",wi(ut.length,function(Ye){return k.command(typeof ut[Ye]=="number"||typeof ut[Ye]=="boolean","invalid uniform "+Je,et.commandStr),ut[Ye]}),"]");return we}):k.commandRaise('invalid or missing data for uniform "'+Je+'"',Ce.commandStr);dt.value=ut,Ft[Je]=dt}),Object.keys(zt).forEach(function(Je){var ut=zt[Je];Ft[Je]=Qs(ut,function(dt,ze){return dt.invoke(ze,ut)})}),Ft}function Oi(fe,Ce){var We=fe.static,zt=fe.dynamic,Ft={};return Object.keys(We).forEach(function(Je){var ut=We[Je],dt=Se.id(Je),ze=new At;if(zf(ut))ze.state=Fr,ze.buffer=cr.getBuffer(cr.create(ut,cl,!1,!0)),ze.type=0;else{var et=cr.getBuffer(ut);if(et)ze.state=Fr,ze.buffer=et,ze.type=0;else if(k.command(typeof ut=="object"&&ut,"invalid data for attribute "+Je,Ce.commandStr),"constant"in ut){var we=ut.constant;ze.buffer="null",ze.state=ln,typeof we=="number"?ze.x=we:(k.command(Va(we)&&we.length>0&&we.length<=4,"invalid constant for attribute "+Je,Ce.commandStr),pr.forEach(function(In,yn){yn<we.length&&(ze[In]=we[yn])}))}else{zf(ut.buffer)?et=cr.getBuffer(cr.create(ut.buffer,cl,!1,!0)):et=cr.getBuffer(ut.buffer),k.command(!!et,'missing buffer for attribute "'+Je+'"',Ce.commandStr);var Ye=ut.offset|0;k.command(Ye>=0,'invalid offset for attribute "'+Je+'"',Ce.commandStr);var Vt=ut.stride|0;k.command(Vt>=0&&Vt<256,'invalid stride for attribute "'+Je+'", must be integer betweeen [0, 255]',Ce.commandStr);var ar=ut.size|0;k.command(!("size"in ut)||ar>0&&ar<=4,'invalid size for attribute "'+Je+'", must be 1,2,3,4',Ce.commandStr);var Er=!!ut.normalized,vr=0;"type"in ut&&(k.commandParameter(ut.type,Ho,"invalid type for attribute "+Je,Ce.commandStr),vr=Ho[ut.type]);var Rr=ut.divisor|0;"divisor"in ut&&(k.command(Rr===0||Ir,'cannot specify divisor for attribute "'+Je+'", instancing not supported',Ce.commandStr),k.command(Rr>=0,'invalid divisor for attribute "'+Je+'"',Ce.commandStr)),k.optional(function(){var In=Ce.commandStr,yn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ut).forEach(function(bn){k.command(yn.indexOf(bn)>=0,'unknown parameter "'+bn+'" for attribute pointer "'+Je+'" (valid parameters are '+yn+")",In)})}),ze.buffer=et,ze.state=Fr,ze.size=ar,ze.normalized=Er,ze.type=vr||et.dtype,ze.offset=Ye,ze.stride=Vt,ze.divisor=Rr}}Ft[Je]=Co(function(In,yn){var bn=In.attribCache;if(dt in bn)return bn[dt];var qn={isStream:!1};return Object.keys(ze).forEach(function(li){qn[li]=ze[li]}),ze.buffer&&(qn.buffer=In.link(ze.buffer),qn.type=qn.type||qn.buffer+".dtype"),bn[dt]=qn,qn})}),Object.keys(zt).forEach(function(Je){var ut=zt[Je];function dt(ze,et){var we=ze.invoke(et,ut),Ye=ze.shared,Vt=ze.constants,ar=Ye.isBufferArgs,Er=Ye.buffer;k.optional(function(){ze.assert(et,we+"&&(typeof "+we+'==="object"||typeof '+we+'==="function")&&('+ar+"("+we+")||"+Er+".getBuffer("+we+")||"+Er+".getBuffer("+we+".buffer)||"+ar+"("+we+'.buffer)||("constant" in '+we+"&&(typeof "+we+'.constant==="number"||'+Ye.isArrayLike+"("+we+".constant))))",'invalid dynamic attribute "'+Je+'"')});var vr={isStream:et.def(!1)},Rr=new At;Rr.state=Fr,Object.keys(Rr).forEach(function(qn){vr[qn]=et.def(""+Rr[qn])});var In=vr.buffer,yn=vr.type;et("if(",ar,"(",we,")){",vr.isStream,"=true;",In,"=",Er,".createStream(",cl,",",we,");",yn,"=",In,".dtype;","}else{",In,"=",Er,".getBuffer(",we,");","if(",In,"){",yn,"=",In,".dtype;",'}else if("constant" in ',we,"){",vr.state,"=",ln,";","if(typeof "+we+'.constant === "number"){',vr[pr[0]],"=",we,".constant;",pr.slice(1).map(function(qn){return vr[qn]}).join("="),"=0;","}else{",pr.map(function(qn,li){return vr[qn]+"="+we+".constant.length>"+li+"?"+we+".constant["+li+"]:0;"}).join(""),"}}else{","if(",ar,"(",we,".buffer)){",In,"=",Er,".createStream(",cl,",",we,".buffer);","}else{",In,"=",Er,".getBuffer(",we,".buffer);","}",yn,'="type" in ',we,"?",Vt.glTypes,"[",we,".type]:",In,".dtype;",vr.normalized,"=!!",we,".normalized;");function bn(qn){et(vr[qn],"=",we,".",qn,"|0;")}return bn("size"),bn("offset"),bn("stride"),bn("divisor"),et("}}"),et.exit("if(",vr.isStream,"){",Er,".destroyStream(",In,");","}"),vr}Ft[Je]=Qs(ut,dt)}),Ft}function ro(fe,Ce){var We=fe.static,zt=fe.dynamic;if(ju in We){var Ft=We[ju];return Ft!==null&&Vr.getVAO(Ft)===null&&(Ft=Vr.createVAO(Ft)),Co(function(ut){return ut.link(Vr.getVAO(Ft))})}else if(ju in zt){var Je=zt[ju];return Qs(Je,function(ut,dt){var ze=ut.invoke(dt,Je);return dt.def(ut.shared.vao+".getVAO("+ze+")")})}return null}function ba(fe){var Ce=fe.static,We=fe.dynamic,zt={};return Object.keys(Ce).forEach(function(Ft){var Je=Ce[Ft];zt[Ft]=Co(function(ut,dt){return typeof Je=="number"||typeof Je=="boolean"?""+Je:ut.link(Je)})}),Object.keys(We).forEach(function(Ft){var Je=We[Ft];zt[Ft]=Qs(Je,function(ut,dt){return ut.invoke(dt,Je)})}),zt}function co(fe,Ce,We,zt,Ft){var Je=fe.static,ut=fe.dynamic;k.optional(function(){var bn=[ys,fu,Tu,Ui,Go,hu,Ja,Sc,Qa,ju].concat(Cr);function qn(li){Object.keys(li).forEach(function(Pi){k.command(bn.indexOf(Pi)>=0,'unknown parameter "'+Pi+'"',Ft.commandStr)})}qn(Je),qn(ut)});var dt=ui(fe,Ce),ze=cn(fe,Ft),et=Si(fe,ze,Ft),we=Xi(fe,Ft),Ye=La(fe,Ft),Vt=Jn(fe,Ft,dt);function ar(bn){var qn=et[bn];qn&&(Ye[bn]=qn)}ar(So),ar(Kr(ll));var Er=Object.keys(Ye).length>0,vr={framebuffer:ze,draw:we,shader:Vt,state:Ye,dirty:Er,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(vr.profile=pt(fe,Ft),vr.uniforms=$o(We,Ft),vr.drawVAO=vr.scopeVAO=ro(fe,Ft),!vr.drawVAO&&Vt.program&&!dt&&He.angle_instanced_arrays){var Rr=!0,In=Vt.program.attributes.map(function(bn){var qn=Ce.static[bn];return Rr=Rr&&!!qn,qn});if(Rr&&In.length>0){var yn=Vr.getVAO(Vr.createVAO(In));vr.drawVAO=new xs(null,null,null,function(bn,qn){return bn.link(yn)}),vr.useVAO=!0}}return dt?vr.useVAO=!0:vr.attributes=Oi(Ce,Ft),vr.context=ba(zt,Ft),vr}function fo(fe,Ce,We){var zt=fe.shared,Ft=zt.context,Je=fe.scope();Object.keys(We).forEach(function(ut){Ce.save(Ft,"."+ut);var dt=We[ut];Je(Ft,".",ut,"=",dt.append(fe,Ce),";")}),Ce(Je)}function Na(fe,Ce,We,zt){var Ft=fe.shared,Je=Ft.gl,ut=Ft.framebuffer,dt;tn&&(dt=Ce.def(Ft.extensions,".webgl_draw_buffers"));var ze=fe.constants,et=ze.drawBuffer,we=ze.backBuffer,Ye;We?Ye=We.append(fe,Ce):Ye=Ce.def(ut,".next"),zt||Ce("if(",Ye,"!==",ut,".cur){"),Ce("if(",Ye,"){",Je,".bindFramebuffer(",Jl,",",Ye,".framebuffer);"),tn&&Ce(dt,".drawBuffersWEBGL(",et,"[",Ye,".colorAttachments.length]);"),Ce("}else{",Je,".bindFramebuffer(",Jl,",null);"),tn&&Ce(dt,".drawBuffersWEBGL(",we,");"),Ce("}",ut,".cur=",Ye,";"),zt||Ce("}")}function ko(fe,Ce,We){var zt=fe.shared,Ft=zt.gl,Je=fe.current,ut=fe.next,dt=zt.current,ze=zt.next,et=fe.cond(dt,".dirty");Cr.forEach(function(we){var Ye=Kr(we);if(!(Ye in We.state)){var Vt,ar;if(Ye in ut){Vt=ut[Ye],ar=Je[Ye];var Er=wi(gr[Ye].length,function(Rr){return et.def(Vt,"[",Rr,"]")});et(fe.cond(Er.map(function(Rr,In){return Rr+"!=="+ar+"["+In+"]"}).join("||")).then(Ft,".",_r[Ye],"(",Er,");",Er.map(function(Rr,In){return ar+"["+In+"]="+Rr}).join(";"),";"))}else{Vt=et.def(ze,".",Ye);var vr=fe.cond(Vt,"!==",dt,".",Ye);et(vr),Ye in en?vr(fe.cond(Vt).then(Ft,".enable(",en[Ye],");").else(Ft,".disable(",en[Ye],");"),dt,".",Ye,"=",Vt,";"):vr(Ft,".",_r[Ye],"(",Vt,");",dt,".",Ye,"=",Vt,";")}}}),Object.keys(We.state).length===0&&et(dt,".dirty=false;"),Ce(et)}function es(fe,Ce,We,zt){var Ft=fe.shared,Je=fe.current,ut=Ft.current,dt=Ft.gl;Zf(Object.keys(We)).forEach(function(ze){var et=We[ze];if(!(zt&&!zt(et))){var we=et.append(fe,Ce);if(en[ze]){var Ye=en[ze];ds(et)?we?Ce(dt,".enable(",Ye,");"):Ce(dt,".disable(",Ye,");"):Ce(fe.cond(we).then(dt,".enable(",Ye,");").else(dt,".disable(",Ye,");")),Ce(ut,".",ze,"=",we,";")}else if(Va(we)){var Vt=Je[ze];Ce(dt,".",_r[ze],"(",we,");",we.map(function(ar,Er){return Vt+"["+Er+"]="+ar}).join(";"),";")}else Ce(dt,".",_r[ze],"(",we,");",ut,".",ze,"=",we,";")}})}function Ro(fe,Ce){Ir&&(fe.instancing=Ce.def(fe.shared.extensions,".angle_instanced_arrays"))}function Ei(fe,Ce,We,zt,Ft){var Je=fe.shared,ut=fe.stats,dt=Je.current,ze=Je.timer,et=We.profile;function we(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Ye,Vt;function ar(bn){Ye=Ce.def(),bn(Ye,"=",we(),";"),typeof Ft=="string"?bn(ut,".count+=",Ft,";"):bn(ut,".count++;"),wr&&(zt?(Vt=Ce.def(),bn(Vt,"=",ze,".getNumPendingQueries();")):bn(ze,".beginQuery(",ut,");"))}function Er(bn){bn(ut,".cpuTime+=",we(),"-",Ye,";"),wr&&(zt?bn(ze,".pushScopeStats(",Vt,",",ze,".getNumPendingQueries(),",ut,");"):bn(ze,".endQuery();"))}function vr(bn){var qn=Ce.def(dt,".profile");Ce(dt,".profile=",bn,";"),Ce.exit(dt,".profile=",qn,";")}var Rr;if(et){if(ds(et)){et.enable?(ar(Ce),Er(Ce.exit),vr("true")):vr("false");return}Rr=et.append(fe,Ce),vr(Rr)}else Rr=Ce.def(dt,".profile");var In=fe.block();ar(In),Ce("if(",Rr,"){",In,"}");var yn=fe.block();Er(yn),Ce.exit("if(",Rr,"){",yn,"}")}function ts(fe,Ce,We,zt,Ft){var Je=fe.shared;function ut(ze){switch(ze){case Up:case zp:case tf:return 2;case Pl:case Wa:case rf:return 3;case ep:case Lf:case wc:return 4;default:return 1}}function dt(ze,et,we){var Ye=Je.gl,Vt=Ce.def(ze,".location"),ar=Ce.def(Je.attributes,"[",Vt,"]"),Er=we.state,vr=we.buffer,Rr=[we.x,we.y,we.z,we.w],In=["buffer","normalized","offset","stride"];function yn(){Ce("if(!",ar,".buffer){",Ye,".enableVertexAttribArray(",Vt,");}");var qn=we.type,li;if(we.size?li=Ce.def(we.size,"||",et):li=et,Ce("if(",ar,".type!==",qn,"||",ar,".size!==",li,"||",In.map(function(Ga){return ar+"."+Ga+"!=="+we[Ga]}).join("||"),"){",Ye,".bindBuffer(",cl,",",vr,".buffer);",Ye,".vertexAttribPointer(",[Vt,li,qn,we.normalized,we.stride,we.offset],");",ar,".type=",qn,";",ar,".size=",li,";",In.map(function(Ga){return ar+"."+Ga+"="+we[Ga]+";"}).join(""),"}"),Ir){var Pi=we.divisor;Ce("if(",ar,".divisor!==",Pi,"){",fe.instancing,".vertexAttribDivisorANGLE(",[Vt,Pi],");",ar,".divisor=",Pi,";}")}}function bn(){Ce("if(",ar,".buffer){",Ye,".disableVertexAttribArray(",Vt,");",ar,".buffer=null;","}if(",pr.map(function(qn,li){return ar+"."+qn+"!=="+Rr[li]}).join("||"),"){",Ye,".vertexAttrib4f(",Vt,",",Rr,");",pr.map(function(qn,li){return ar+"."+qn+"="+Rr[li]+";"}).join(""),"}")}Er===Fr?yn():Er===ln?bn():(Ce("if(",Er,"===",Fr,"){"),yn(),Ce("}else{"),bn(),Ce("}"))}zt.forEach(function(ze){var et=ze.name,we=We.attributes[et],Ye;if(we){if(!Ft(we))return;Ye=we.append(fe,Ce)}else{if(!Ft(ip))return;var Vt=fe.scopeAttrib(et);k.optional(function(){fe.assert(Ce,Vt+".state","missing attribute "+et)}),Ye={},Object.keys(new At).forEach(function(ar){Ye[ar]=Ce.def(Vt,".",ar)})}dt(fe.link(ze),ut(ze.info.type),Ye)})}function ea(fe,Ce,We,zt,Ft){for(var Je=fe.shared,ut=Je.gl,dt,ze=0;ze<zt.length;++ze){var et=zt[ze],we=et.name,Ye=et.info.type,Vt=We.uniforms[we],ar=fe.link(et),Er=ar+".location",vr;if(Vt){if(!Ft(Vt))continue;if(ds(Vt)){var Rr=Vt.value;if(k.command(Rr!==null&&typeof Rr!="undefined",'missing uniform "'+we+'"',fe.commandStr),Ye===Ql||Ye===Cc){k.command(typeof Rr=="function"&&(Ye===Ql&&(Rr._reglType==="texture2d"||Rr._reglType==="framebuffer")||Ye===Cc&&(Rr._reglType==="textureCube"||Rr._reglType==="framebufferCube")),"invalid texture for uniform "+we,fe.commandStr);var In=fe.link(Rr._texture||Rr.color[0]._texture);Ce(ut,".uniform1i(",Er,",",In+".bind());"),Ce.exit(In,".unbind();")}else if(Ye===Uf||Ye===xh||Ye===Ol){k.optional(function(){k.command(Va(Rr),"invalid matrix for uniform "+we,fe.commandStr),k.command(Ye===Uf&&Rr.length===4||Ye===xh&&Rr.length===9||Ye===Ol&&Rr.length===16,"invalid length for matrix uniform "+we,fe.commandStr)});var yn=fe.global.def("new Float32Array(["+Array.prototype.slice.call(Rr)+"])"),bn=2;Ye===xh?bn=3:Ye===Ol&&(bn=4),Ce(ut,".uniformMatrix",bn,"fv(",Er,",false,",yn,");")}else{switch(Ye){case Pd:k.commandType(Rr,"number","uniform "+we,fe.commandStr),dt="1f";break;case Up:k.command(Va(Rr)&&Rr.length===2,"uniform "+we,fe.commandStr),dt="2f";break;case Pl:k.command(Va(Rr)&&Rr.length===3,"uniform "+we,fe.commandStr),dt="3f";break;case ep:k.command(Va(Rr)&&Rr.length===4,"uniform "+we,fe.commandStr),dt="4f";break;case Nf:k.commandType(Rr,"boolean","uniform "+we,fe.commandStr),dt="1i";break;case Tc:k.commandType(Rr,"number","uniform "+we,fe.commandStr),dt="1i";break;case tf:k.command(Va(Rr)&&Rr.length===2,"uniform "+we,fe.commandStr),dt="2i";break;case zp:k.command(Va(Rr)&&Rr.length===2,"uniform "+we,fe.commandStr),dt="2i";break;case rf:k.command(Va(Rr)&&Rr.length===3,"uniform "+we,fe.commandStr),dt="3i";break;case Wa:k.command(Va(Rr)&&Rr.length===3,"uniform "+we,fe.commandStr),dt="3i";break;case wc:k.command(Va(Rr)&&Rr.length===4,"uniform "+we,fe.commandStr),dt="4i";break;case Lf:k.command(Va(Rr)&&Rr.length===4,"uniform "+we,fe.commandStr),dt="4i";break}Ce(ut,".uniform",dt,"(",Er,",",Va(Rr)?Array.prototype.slice.call(Rr):Rr,");")}continue}else vr=Vt.append(fe,Ce)}else{if(!Ft(ip))continue;vr=Ce.def(Je.uniforms,"[",Se.id(we),"]")}Ye===Ql?Ce("if(",vr,"&&",vr,'._reglType==="framebuffer"){',vr,"=",vr,".color[0];","}"):Ye===Cc&&Ce("if(",vr,"&&",vr,'._reglType==="framebufferCube"){',vr,"=",vr,".color[0];","}"),k.optional(function(){function Js(pl,sp){fe.assert(Ce,pl,'bad data or missing for uniform "'+we+'".  '+sp)}function Yp(pl){Js("typeof "+vr+'==="'+pl+'"',"invalid type, expected "+pl)}function eu(pl,sp){Js(Je.isArrayLike+"("+vr+")&&"+vr+".length==="+pl,"invalid vector, should have length "+pl,fe.commandStr)}function op(pl){Js("typeof "+vr+'==="function"&&'+vr+'._reglType==="texture'+(pl===Bf?"2d":"Cube")+'"',"invalid texture type",fe.commandStr)}switch(Ye){case Tc:Yp("number");break;case zp:eu(2,"number");break;case Wa:eu(3,"number");break;case Lf:eu(4,"number");break;case Pd:Yp("number");break;case Up:eu(2,"number");break;case Pl:eu(3,"number");break;case ep:eu(4,"number");break;case Nf:Yp("boolean");break;case tf:eu(2,"boolean");break;case rf:eu(3,"boolean");break;case wc:eu(4,"boolean");break;case Uf:eu(4,"number");break;case xh:eu(9,"number");break;case Ol:eu(16,"number");break;case Ql:op(Bf);break;case Cc:op(Jh);break}});var qn=1;switch(Ye){case Ql:case Cc:var li=Ce.def(vr,"._texture");Ce(ut,".uniform1i(",Er,",",li,".bind());"),Ce.exit(li,".unbind();");continue;case Tc:case Nf:dt="1i";break;case zp:case tf:dt="2i",qn=2;break;case Wa:case rf:dt="3i",qn=3;break;case Lf:case wc:dt="4i",qn=4;break;case Pd:dt="1f";break;case Up:dt="2f",qn=2;break;case Pl:dt="3f",qn=3;break;case ep:dt="4f",qn=4;break;case Uf:dt="Matrix2fv";break;case xh:dt="Matrix3fv";break;case Ol:dt="Matrix4fv";break}if(Ce(ut,".uniform",dt,"(",Er,","),dt.charAt(0)==="M"){var Pi=Math.pow(Ye-Uf+2,2),Ga=fe.global.def("new Float32Array(",Pi,")");Ce("false,(Array.isArray(",vr,")||",vr," instanceof Float32Array)?",vr,":(",wi(Pi,function(Js){return Ga+"["+Js+"]="+vr+"["+Js+"]"}),",",Ga,")")}else qn>1?Ce(wi(qn,function(Js){return vr+"["+Js+"]"})):Ce(vr);Ce(");")}}function Yn(fe,Ce,We,zt){var Ft=fe.shared,Je=Ft.gl,ut=Ft.draw,dt=zt.draw;function ze(){var li=dt.elements,Pi,Ga=Ce;return li?((li.contextDep&&zt.contextDynamic||li.propDep)&&(Ga=We),Pi=li.append(fe,Ga)):Pi=Ga.def(ut,".",Ui),Pi&&Ga("if("+Pi+")"+Je+".bindBuffer("+Lp+","+Pi+".buffer.buffer);"),Pi}function et(){var li=dt.count,Pi,Ga=Ce;return li?((li.contextDep&&zt.contextDynamic||li.propDep)&&(Ga=We),Pi=li.append(fe,Ga),k.optional(function(){li.MISSING&&fe.assert(Ce,"false","missing vertex count"),li.DYNAMIC&&fe.assert(Ga,Pi+">=0","missing vertex count")})):(Pi=Ga.def(ut,".",Ja),k.optional(function(){fe.assert(Ga,Pi+">=0","missing vertex count")})),Pi}var we=ze();function Ye(li){var Pi=dt[li];return Pi?Pi.contextDep&&zt.contextDynamic||Pi.propDep?Pi.append(fe,We):Pi.append(fe,Ce):Ce.def(ut,".",li)}var Vt=Ye(Go),ar=Ye(hu),Er=et();if(typeof Er=="number"){if(Er===0)return}else We("if(",Er,"){"),We.exit("}");var vr,Rr;Ir&&(vr=Ye(Sc),Rr=fe.instancing);var In=we+".type",yn=dt.elements&&ds(dt.elements);function bn(){function li(){We(Rr,".drawElementsInstancedANGLE(",[Vt,Er,In,ar+"<<(("+In+"-"+Ur+")>>1)",vr],");")}function Pi(){We(Rr,".drawArraysInstancedANGLE(",[Vt,ar,Er,vr],");")}we?yn?li():(We("if(",we,"){"),li(),We("}else{"),Pi(),We("}")):Pi()}function qn(){function li(){We(Je+".drawElements("+[Vt,Er,In,ar+"<<(("+In+"-"+Ur+")>>1)"]+");")}function Pi(){We(Je+".drawArrays("+[Vt,ar,Er]+");")}we?yn?li():(We("if(",we,"){"),li(),We("}else{"),Pi(),We("}")):Pi()}Ir&&(typeof vr!="number"||vr>=0)?typeof vr=="string"?(We("if(",vr,">0){"),bn(),We("}else if(",vr,"<0){"),qn(),We("}")):bn():qn()}function Ii(fe,Ce,We,zt,Ft){var Je=jn(),ut=Je.proc("body",Ft);return k.optional(function(){Je.commandStr=Ce.commandStr,Je.command=Je.link(Ce.commandStr)}),Ir&&(Je.instancing=ut.def(Je.shared.extensions,".angle_instanced_arrays")),fe(Je,ut,We,zt),Je.compile().body}function $i(fe,Ce,We,zt){Ro(fe,Ce),We.useVAO?We.drawVAO?Ce(fe.shared.vao,".setVAO(",We.drawVAO.append(fe,Ce),");"):Ce(fe.shared.vao,".setVAO(",fe.shared.vao,".targetVAO);"):(Ce(fe.shared.vao,".setVAO(null);"),ts(fe,Ce,We,zt.attributes,function(){return!0})),ea(fe,Ce,We,zt.uniforms,function(){return!0}),Yn(fe,Ce,Ce,We)}function ho(fe,Ce){var We=fe.proc("draw",1);Ro(fe,We),fo(fe,We,Ce.context),Na(fe,We,Ce.framebuffer),ko(fe,We,Ce),es(fe,We,Ce.state),Ei(fe,We,Ce,!1,!0);var zt=Ce.shader.progVar.append(fe,We);if(We(fe.shared.gl,".useProgram(",zt,".program);"),Ce.shader.program)$i(fe,We,Ce,Ce.shader.program);else{We(fe.shared.vao,".setVAO(null);");var Ft=fe.global.def("{}"),Je=We.def(zt,".id"),ut=We.def(Ft,"[",Je,"]");We(fe.cond(ut).then(ut,".call(this,a0);").else(ut,"=",Ft,"[",Je,"]=",fe.link(function(dt){return Ii($i,fe,Ce,dt,1)}),"(",zt,");",ut,".call(this,a0);"))}Object.keys(Ce.state).length>0&&We(fe.shared.current,".dirty=true;")}function hl(fe,Ce,We,zt){fe.batchId="a1",Ro(fe,Ce);function Ft(){return!0}ts(fe,Ce,We,zt.attributes,Ft),ea(fe,Ce,We,zt.uniforms,Ft),Yn(fe,Ce,Ce,We)}function Ne(fe,Ce,We,zt){Ro(fe,Ce);var Ft=We.contextDep,Je=Ce.def(),ut="a0",dt="a1",ze=Ce.def();fe.shared.props=ze,fe.batchId=Je;var et=fe.scope(),we=fe.scope();Ce(et.entry,"for(",Je,"=0;",Je,"<",dt,";++",Je,"){",ze,"=",ut,"[",Je,"];",we,"}",et.exit);function Ye(In){return In.contextDep&&Ft||In.propDep}function Vt(In){return!Ye(In)}if(We.needsContext&&fo(fe,we,We.context),We.needsFramebuffer&&Na(fe,we,We.framebuffer),es(fe,we,We.state,Ye),We.profile&&Ye(We.profile)&&Ei(fe,we,We,!1,!0),zt)We.useVAO?We.drawVAO?Ye(We.drawVAO)?we(fe.shared.vao,".setVAO(",We.drawVAO.append(fe,we),");"):et(fe.shared.vao,".setVAO(",We.drawVAO.append(fe,et),");"):et(fe.shared.vao,".setVAO(",fe.shared.vao,".targetVAO);"):(et(fe.shared.vao,".setVAO(null);"),ts(fe,et,We,zt.attributes,Vt),ts(fe,we,We,zt.attributes,Ye)),ea(fe,et,We,zt.uniforms,Vt),ea(fe,we,We,zt.uniforms,Ye),Yn(fe,et,we,We);else{var ar=fe.global.def("{}"),Er=We.shader.progVar.append(fe,we),vr=we.def(Er,".id"),Rr=we.def(ar,"[",vr,"]");we(fe.shared.gl,".useProgram(",Er,".program);","if(!",Rr,"){",Rr,"=",ar,"[",vr,"]=",fe.link(function(In){return Ii(hl,fe,We,In,2)}),"(",Er,");}",Rr,".call(this,a0[",Je,"],",Je,");")}}function Yt(fe,Ce){var We=fe.proc("batch",2);fe.batchId="0",Ro(fe,We);var zt=!1,Ft=!0;Object.keys(Ce.context).forEach(function(ar){zt=zt||Ce.context[ar].propDep}),zt||(fo(fe,We,Ce.context),Ft=!1);var Je=Ce.framebuffer,ut=!1;Je?(Je.propDep?zt=ut=!0:Je.contextDep&&zt&&(ut=!0),ut||Na(fe,We,Je)):Na(fe,We,null),Ce.state.viewport&&Ce.state.viewport.propDep&&(zt=!0);function dt(ar){return ar.contextDep&&zt||ar.propDep}ko(fe,We,Ce),es(fe,We,Ce.state,function(ar){return!dt(ar)}),(!Ce.profile||!dt(Ce.profile))&&Ei(fe,We,Ce,!1,"a1"),Ce.contextDep=zt,Ce.needsContext=Ft,Ce.needsFramebuffer=ut;var ze=Ce.shader.progVar;if(ze.contextDep&&zt||ze.propDep)Ne(fe,We,Ce,null);else{var et=ze.append(fe,We);if(We(fe.shared.gl,".useProgram(",et,".program);"),Ce.shader.program)Ne(fe,We,Ce,Ce.shader.program);else{We(fe.shared.vao,".setVAO(null);");var we=fe.global.def("{}"),Ye=We.def(et,".id"),Vt=We.def(we,"[",Ye,"]");We(fe.cond(Vt).then(Vt,".call(this,a0,a1);").else(Vt,"=",we,"[",Ye,"]=",fe.link(function(ar){return Ii(Ne,fe,Ce,ar,2)}),"(",et,");",Vt,".call(this,a0,a1);"))}}Object.keys(Ce.state).length>0&&We(fe.shared.current,".dirty=true;")}function Nt(fe,Ce){var We=fe.proc("scope",3);fe.batchId="a2";var zt=fe.shared,Ft=zt.current;fo(fe,We,Ce.context),Ce.framebuffer&&Ce.framebuffer.append(fe,We),Zf(Object.keys(Ce.state)).forEach(function(ut){var dt=Ce.state[ut],ze=dt.append(fe,We);Va(ze)?ze.forEach(function(et,we){We.set(fe.next[ut],"["+we+"]",et)}):We.set(zt.next,"."+ut,ze)}),Ei(fe,We,Ce,!0,!0),[Ui,hu,Ja,Sc,Go].forEach(function(ut){var dt=Ce.draw[ut];!dt||We.set(zt.draw,"."+ut,""+dt.append(fe,We))}),Object.keys(Ce.uniforms).forEach(function(ut){We.set(zt.uniforms,"["+Se.id(ut)+"]",Ce.uniforms[ut].append(fe,We))}),Object.keys(Ce.attributes).forEach(function(ut){var dt=Ce.attributes[ut].append(fe,We),ze=fe.scopeAttrib(ut);Object.keys(new At).forEach(function(et){We.set(ze,"."+et,dt[et])})}),Ce.scopeVAO&&We.set(zt.vao,".targetVAO",Ce.scopeVAO.append(fe,We));function Je(ut){var dt=Ce.shader[ut];dt&&We.set(zt.shader,"."+ut,dt.append(fe,We))}Je(fu),Je(Tu),Object.keys(Ce.state).length>0&&(We(Ft,".dirty=true;"),We.exit(Ft,".dirty=true;")),We("a1(",fe.shared.context,",a0,",fe.batchId,");")}function fn(fe){if(!(typeof fe!="object"||Va(fe))){for(var Ce=Object.keys(fe),We=0;We<Ce.length;++We)if(dr.isDynamic(fe[Ce[We]]))return!0;return!1}}function Ti(fe,Ce,We){var zt=Ce.static[We];if(!zt||!fn(zt))return;var Ft=fe.global,Je=Object.keys(zt),ut=!1,dt=!1,ze=!1,et=fe.global.def("{}");Je.forEach(function(Ye){var Vt=zt[Ye];if(dr.isDynamic(Vt)){typeof Vt=="function"&&(Vt=zt[Ye]=dr.unbox(Vt));var ar=Qs(Vt,null);ut=ut||ar.thisDep,ze=ze||ar.propDep,dt=dt||ar.contextDep}else{switch(Ft(et,".",Ye,"="),typeof Vt){case"number":Ft(Vt);break;case"string":Ft('"',Vt,'"');break;case"object":Array.isArray(Vt)&&Ft("[",Vt.join(),"]");break;default:Ft(fe.link(Vt));break}Ft(";")}});function we(Ye,Vt){Je.forEach(function(ar){var Er=zt[ar];if(!!dr.isDynamic(Er)){var vr=Ye.invoke(Vt,Er);Vt(et,".",ar,"=",vr,";")}})}Ce.dynamic[We]=new dr.DynamicVariable(mn,{thisDep:ut,contextDep:dt,propDep:ze,ref:et,append:we}),delete Ce.static[We]}function pa(fe,Ce,We,zt,Ft){var Je=jn();Je.stats=Je.link(Ft),Object.keys(Ce.static).forEach(function(dt){Ti(Je,Ce,dt)}),Kl.forEach(function(dt){Ti(Je,fe,dt)});var ut=co(fe,Ce,We,zt,Je);return ho(Je,ut),Nt(Je,ut),Yt(Je,ut),Je.compile()}return{next:sn,current:gr,procs:function(){var fe=jn(),Ce=fe.proc("poll"),We=fe.proc("refresh"),zt=fe.block();Ce(zt),We(zt);var Ft=fe.shared,Je=Ft.gl,ut=Ft.next,dt=Ft.current;zt(dt,".dirty=false;"),Na(fe,Ce),Na(fe,We,null,!0);var ze;Ir&&(ze=fe.link(Ir)),He.oes_vertex_array_object&&We(fe.link(He.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var et=0;et<Ht.maxAttributes;++et){var we=We.def(Ft.attributes,"[",et,"]"),Ye=fe.cond(we,".buffer");Ye.then(Je,".enableVertexAttribArray(",et,");",Je,".bindBuffer(",cl,",",we,".buffer.buffer);",Je,".vertexAttribPointer(",et,",",we,".size,",we,".type,",we,".normalized,",we,".stride,",we,".offset);").else(Je,".disableVertexAttribArray(",et,");",Je,".vertexAttrib4f(",et,",",we,".x,",we,".y,",we,".z,",we,".w);",we,".buffer=null;"),We(Ye),Ir&&We(ze,".vertexAttribDivisorANGLE(",et,",",we,".divisor);")}return We(fe.shared.vao,".currentVAO=null;",fe.shared.vao,".setVAO(",fe.shared.vao,".targetVAO);"),Object.keys(en).forEach(function(Vt){var ar=en[Vt],Er=zt.def(ut,".",Vt),vr=fe.block();vr("if(",Er,"){",Je,".enable(",ar,")}else{",Je,".disable(",ar,")}",dt,".",Vt,"=",Er,";"),We(vr),Ce("if(",Er,"!==",dt,".",Vt,"){",vr,"}")}),Object.keys(_r).forEach(function(Vt){var ar=_r[Vt],Er=gr[Vt],vr,Rr,In=fe.block();if(In(Je,".",ar,"("),Va(Er)){var yn=Er.length;vr=fe.global.def(ut,".",Vt),Rr=fe.global.def(dt,".",Vt),In(wi(yn,function(bn){return vr+"["+bn+"]"}),");",wi(yn,function(bn){return Rr+"["+bn+"]="+vr+"["+bn+"];"}).join("")),Ce("if(",wi(yn,function(bn){return vr+"["+bn+"]!=="+Rr+"["+bn+"]"}).join("||"),"){",In,"}")}else vr=zt.def(ut,".",Vt),Rr=zt.def(dt,".",Vt),In(vr,");",dt,".",Vt,"=",vr,";"),Ce("if(",vr,"!==",Rr,"){",In,"}");We(In)}),fe.compile()}(),compile:pa}}function Gp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Lv=34918,Nv=34919,ap=35007,Uv=function(V,Se){if(!Se.ext_disjoint_timer_query)return null;var He=[];function Ht(){return He.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function cr(Ir){He.push(Ir)}var Xt=[];function Lt(Ir){var tn=Ht();Se.ext_disjoint_timer_query.beginQueryEXT(ap,tn),Xt.push(tn),wr(Xt.length-1,Xt.length,Ir)}function Dr(){Se.ext_disjoint_timer_query.endQueryEXT(ap)}function Tr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Vr=[];function kr(){return Vr.pop()||new Tr}function Zr(Ir){Vr.push(Ir)}var Xr=[];function wr(Ir,tn,gr){var sn=kr();sn.startQueryIndex=Ir,sn.endQueryIndex=tn,sn.sum=0,sn.stats=gr,Xr.push(sn)}var Nr=[],At=[];function tr(){var Ir,tn,gr=Xt.length;if(gr!==0){At.length=Math.max(At.length,gr+1),Nr.length=Math.max(Nr.length,gr+1),Nr[0]=0,At[0]=0;var sn=0;for(Ir=0,tn=0;tn<Xt.length;++tn){var Cr=Xt[tn];Se.ext_disjoint_timer_query.getQueryObjectEXT(Cr,Nv)?(sn+=Se.ext_disjoint_timer_query.getQueryObjectEXT(Cr,Lv),cr(Cr)):Xt[Ir++]=Cr,Nr[tn+1]=sn,At[tn+1]=Ir}for(Xt.length=Ir,Ir=0,tn=0;tn<Xr.length;++tn){var en=Xr[tn],_r=en.startQueryIndex,Kr=en.endQueryIndex;en.sum+=Nr[Kr]-Nr[_r];var Vn=At[_r],si=At[Kr];si===Vn?(en.stats.gpuTime+=en.sum/1e6,Zr(en)):(en.startQueryIndex=Vn,en.endQueryIndex=si,Xr[Ir++]=en)}Xr.length=Ir}}return{beginQuery:Lt,endQuery:Dr,pushScopeStats:wr,update:tr,getNumPendingQueries:function(){return Xt.length},clear:function(){He.push.apply(He,Xt);for(var Ir=0;Ir<He.length;Ir++)Se.ext_disjoint_timer_query.deleteQueryEXT(He[Ir]);Xt.length=0,He.length=0},restore:function(){Xt.length=0,He.length=0}}},Fd=16384,Xo=256,Xp=1024,kd=34962,af="webglcontextlost",Bd="webglcontextrestored",$p=1,zv=2,Zv=3;function Ld(V,Se){for(var He=0;He<V.length;++He)if(V[He]===Se)return He;return-1}function Nd(V){var Se=Zo(V);if(!Se)return null;var He=Se.gl,Ht=He.getContextAttributes(),cr=He.isContextLost(),Xt=Ts(He,Se);if(!Xt)return null;var Lt=On(),Dr=Gp(),Tr=Xt.extensions,Vr=Uv(He,Tr),kr=Nn(),Zr=He.drawingBufferWidth,Xr=He.drawingBufferHeight,wr={tick:0,time:0,viewportWidth:Zr,viewportHeight:Xr,framebufferWidth:Zr,framebufferHeight:Xr,drawingBufferWidth:Zr,drawingBufferHeight:Xr,pixelRatio:Se.pixelRatio},Nr={},At={elements:null,primitive:4,count:-1,offset:0,instances:-1},tr=fc(He,Tr),Ir=rh(He,Dr,Se,gr),tn=$(He,Tr,tr,Dr,Ir);function gr(Yn){return tn.destroyBuffer(Yn)}var sn=Hh(He,Tr,Ir,Dr),Cr=Be(He,Lt,Dr,Se),en=Ot(He,Tr,tr,function(){Vn.procs.poll()},wr,Dr,Se),_r=yu(He,Tr,tr,Dr,Se),Kr=C(He,Tr,tr,en,_r,Dr),Vn=Vf(He,Lt,Tr,tr,Ir,sn,en,Kr,Nr,tn,Cr,At,wr,Vr,Se),si=Rt(He,Kr,Vn.procs.poll,wr,Ht,Tr,tr),Qr=Vn.next,Pr=He.canvas,ot=[],jn=[],pt=[],cn=[Se.onDestroy],Si=null;function ui(){if(ot.length===0){Vr&&Vr.update(),Si=null;return}Si=Gr.next(ui),es();for(var Yn=ot.length-1;Yn>=0;--Yn){var Ii=ot[Yn];Ii&&Ii(wr,null,0)}He.flush(),Vr&&Vr.update()}function Jn(){!Si&&ot.length>0&&(Si=Gr.next(ui))}function Xi(){Si&&(Gr.cancel(ui),Si=null)}function La(Yn){Yn.preventDefault(),cr=!0,Xi(),jn.forEach(function(Ii){Ii()})}function $o(Yn){He.getError(),cr=!1,Xt.restore(),Cr.restore(),Ir.restore(),en.restore(),_r.restore(),Kr.restore(),tn.restore(),Vr&&Vr.restore(),Vn.procs.refresh(),Jn(),pt.forEach(function(Ii){Ii()})}Pr&&(Pr.addEventListener(af,La,!1),Pr.addEventListener(Bd,$o,!1));function Oi(){ot.length=0,Xi(),Pr&&(Pr.removeEventListener(af,La),Pr.removeEventListener(Bd,$o)),Cr.clear(),Kr.clear(),_r.clear(),en.clear(),sn.clear(),Ir.clear(),tn.clear(),Vr&&Vr.clear(),cn.forEach(function(Yn){Yn()})}function ro(Yn){k(!!Yn,"invalid args to regl({...})"),k.type(Yn,"object","invalid args to regl({...})");function Ii(Ft){var Je=N({},Ft);delete Je.uniforms,delete Je.attributes,delete Je.context,delete Je.vao,"stencil"in Je&&Je.stencil.op&&(Je.stencil.opBack=Je.stencil.opFront=Je.stencil.op,delete Je.stencil.op);function ut(dt){if(dt in Je){var ze=Je[dt];delete Je[dt],Object.keys(ze).forEach(function(et){Je[dt+"."+et]=ze[et]})}}return ut("blend"),ut("depth"),ut("cull"),ut("stencil"),ut("polygonOffset"),ut("scissor"),ut("sample"),"vao"in Ft&&(Je.vao=Ft.vao),Je}function $i(Ft){var Je={},ut={};return Object.keys(Ft).forEach(function(dt){var ze=Ft[dt];dr.isDynamic(ze)?ut[dt]=dr.unbox(ze,dt):Je[dt]=ze}),{dynamic:ut,static:Je}}var ho=$i(Yn.context||{}),hl=$i(Yn.uniforms||{}),Ne=$i(Yn.attributes||{}),Yt=$i(Ii(Yn)),Nt={gpuTime:0,cpuTime:0,count:0},fn=Vn.compile(Yt,Ne,hl,ho,Nt),Ti=fn.draw,pa=fn.batch,fe=fn.scope,Ce=[];function We(Ft){for(;Ce.length<Ft;)Ce.push(null);return Ce}function zt(Ft,Je){var ut;if(cr&&k.raise("context lost"),typeof Ft=="function")return fe.call(this,null,Ft,0);if(typeof Je=="function")if(typeof Ft=="number")for(ut=0;ut<Ft;++ut)fe.call(this,null,Je,ut);else if(Array.isArray(Ft))for(ut=0;ut<Ft.length;++ut)fe.call(this,Ft[ut],Je,ut);else return fe.call(this,Ft,Je,0);else if(typeof Ft=="number"){if(Ft>0)return pa.call(this,We(Ft|0),Ft|0)}else if(Array.isArray(Ft)){if(Ft.length)return pa.call(this,Ft,Ft.length)}else return Ti.call(this,Ft)}return N(zt,{stats:Nt})}var ba=Kr.setFBO=ro({framebuffer:dr.define.call(null,$p,"framebuffer")});function co(Yn,Ii){var $i=0;Vn.procs.poll();var ho=Ii.color;ho&&(He.clearColor(+ho[0]||0,+ho[1]||0,+ho[2]||0,+ho[3]||0),$i|=Fd),"depth"in Ii&&(He.clearDepth(+Ii.depth),$i|=Xo),"stencil"in Ii&&(He.clearStencil(Ii.stencil|0),$i|=Xp),k(!!$i,"called regl.clear with no buffer specified"),He.clear($i)}function fo(Yn){if(k(typeof Yn=="object"&&Yn,"regl.clear() takes an object as input"),"framebuffer"in Yn)if(Yn.framebuffer&&Yn.framebuffer_reglType==="framebufferCube")for(var Ii=0;Ii<6;++Ii)ba(N({framebuffer:Yn.framebuffer.faces[Ii]},Yn),co);else ba(Yn,co);else co(null,Yn)}function Na(Yn){k.type(Yn,"function","regl.frame() callback must be a function"),ot.push(Yn);function Ii(){var $i=Ld(ot,Yn);k($i>=0,"cannot cancel a frame twice");function ho(){var hl=Ld(ot,ho);ot[hl]=ot[ot.length-1],ot.length-=1,ot.length<=0&&Xi()}ot[$i]=ho}return Jn(),{cancel:Ii}}function ko(){var Yn=Qr.viewport,Ii=Qr.scissor_box;Yn[0]=Yn[1]=Ii[0]=Ii[1]=0,wr.viewportWidth=wr.framebufferWidth=wr.drawingBufferWidth=Yn[2]=Ii[2]=He.drawingBufferWidth,wr.viewportHeight=wr.framebufferHeight=wr.drawingBufferHeight=Yn[3]=Ii[3]=He.drawingBufferHeight}function es(){wr.tick+=1,wr.time=Ei(),ko(),Vn.procs.poll()}function Ro(){ko(),Vn.procs.refresh(),Vr&&Vr.update()}function Ei(){return(Nn()-kr)/1e3}Ro();function ts(Yn,Ii){k.type(Ii,"function","listener callback must be a function");var $i;switch(Yn){case"frame":return Na(Ii);case"lost":$i=jn;break;case"restore":$i=pt;break;case"destroy":$i=cn;break;default:k.raise("invalid event, must be one of frame,lost,restore,destroy")}return $i.push(Ii),{cancel:function(){for(var ho=0;ho<$i.length;++ho)if($i[ho]===Ii){$i[ho]=$i[$i.length-1],$i.pop();return}}}}var ea=N(ro,{clear:fo,prop:dr.define.bind(null,$p),context:dr.define.bind(null,zv),this:dr.define.bind(null,Zv),draw:ro({}),buffer:function(Yn){return Ir.create(Yn,kd,!1,!1)},elements:function(Yn){return sn.create(Yn,!1)},texture:en.create2D,cube:en.createCube,renderbuffer:_r.create,framebuffer:Kr.create,framebufferCube:Kr.createCube,vao:tn.createVAO,attributes:Ht,frame:Na,on:ts,limits:tr,hasExtension:function(Yn){return tr.extensions.indexOf(Yn.toLowerCase())>=0},read:si,destroy:Oi,_gl:He,_refresh:Ro,poll:function(){es(),Vr&&Vr.update()},now:Ei,stats:Dr});return Se.onDone(null,ea),ea}return Nd})},69848:function(yr){(function(ne,N){yr.exports=N()})(this,function(){"use strict";function ne(Et,lt,Ut,vt,er,xr){if(!(er-vt<=Ut)){var q=vt+er>>1;N(Et,lt,q,vt,er,xr%2),ne(Et,lt,Ut,vt,q-1,xr+1),ne(Et,lt,Ut,q+1,er,xr+1)}}function N(Et,lt,Ut,vt,er,xr){for(;er>vt;){if(er-vt>600){var q=er-vt+1,De=Ut-vt+1,F=Math.log(q),Me=.5*Math.exp(2*F/3),Te=.5*Math.sqrt(F*Me*(q-Me)/q)*(De-q/2<0?-1:1),ht=Math.max(vt,Math.floor(Ut-De*Me/q+Te)),bt=Math.min(er,Math.floor(Ut+(q-De)*Me/q+Te));N(Et,lt,Ut,ht,bt,xr)}var St=lt[2*Ut+xr],qt=vt,or=er;for(ge(Et,lt,vt,Ut),lt[2*er+xr]>St&&ge(Et,lt,vt,er);qt<or;){for(ge(Et,lt,qt,or),qt++,or--;lt[2*qt+xr]<St;)qt++;for(;lt[2*or+xr]>St;)or--}lt[2*vt+xr]===St?ge(Et,lt,vt,or):(or++,ge(Et,lt,or,er)),or<=Ut&&(vt=or+1),Ut<=or&&(er=or-1)}}function ge(Et,lt,Ut,vt){ee(Et,Ut,vt),ee(lt,2*Ut,2*vt),ee(lt,2*Ut+1,2*vt+1)}function ee(Et,lt,Ut){var vt=Et[lt];Et[lt]=Et[Ut],Et[Ut]=vt}function y(Et,lt,Ut,vt,er,xr,q){for(var De=[0,Et.length-1,0],F=[],Me,Te;De.length;){var ht=De.pop(),bt=De.pop(),St=De.pop();if(bt-St<=q){for(var qt=St;qt<=bt;qt++)Me=lt[2*qt],Te=lt[2*qt+1],Me>=Ut&&Me<=er&&Te>=vt&&Te<=xr&&F.push(Et[qt]);continue}var or=Math.floor((St+bt)/2);Me=lt[2*or],Te=lt[2*or+1],Me>=Ut&&Me<=er&&Te>=vt&&Te<=xr&&F.push(Et[or]);var rn=(ht+1)%2;(ht===0?Ut<=Me:vt<=Te)&&(De.push(St),De.push(or-1),De.push(rn)),(ht===0?er>=Me:xr>=Te)&&(De.push(or+1),De.push(bt),De.push(rn))}return F}function ce(Et,lt,Ut,vt,er,xr){for(var q=[0,Et.length-1,0],De=[],F=er*er;q.length;){var Me=q.pop(),Te=q.pop(),ht=q.pop();if(Te-ht<=xr){for(var bt=ht;bt<=Te;bt++)z(lt[2*bt],lt[2*bt+1],Ut,vt)<=F&&De.push(Et[bt]);continue}var St=Math.floor((ht+Te)/2),qt=lt[2*St],or=lt[2*St+1];z(qt,or,Ut,vt)<=F&&De.push(Et[St]);var rn=(Me+1)%2;(Me===0?Ut-er<=qt:vt-er<=or)&&(q.push(ht),q.push(St-1),q.push(rn)),(Me===0?Ut+er>=qt:vt+er>=or)&&(q.push(St+1),q.push(Te),q.push(rn))}return De}function z(Et,lt,Ut,vt){var er=Et-Ut,xr=lt-vt;return er*er+xr*xr}var ae=function(Et){return Et[0]},te=function(Et){return Et[1]},Pe=function(lt,Ut,vt,er,xr){Ut===void 0&&(Ut=ae),vt===void 0&&(vt=te),er===void 0&&(er=64),xr===void 0&&(xr=Float64Array),this.nodeSize=er,this.points=lt;for(var q=lt.length<65536?Uint16Array:Uint32Array,De=this.ids=new q(lt.length),F=this.coords=new xr(lt.length*2),Me=0;Me<lt.length;Me++)De[Me]=Me,F[2*Me]=Ut(lt[Me]),F[2*Me+1]=vt(lt[Me]);ne(De,F,er,0,De.length-1,0)};Pe.prototype.range=function(lt,Ut,vt,er){return y(this.ids,this.coords,lt,Ut,vt,er,this.nodeSize)},Pe.prototype.within=function(lt,Ut,vt){return ce(this.ids,this.coords,lt,Ut,vt,this.nodeSize)};var re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Et){return Et}},Ze=Math.fround||function(Et){return function(lt){return Et[0]=+lt,Et[0]}}(new Float32Array(1)),Ke=function(lt){this.options=Lr(Object.create(re),lt),this.trees=new Array(this.options.maxZoom+1)};Ke.prototype.load=function(lt){var Ut=this.options,vt=Ut.log,er=Ut.minZoom,xr=Ut.maxZoom,q=Ut.nodeSize;vt&&console.time("total time");var De="prepare "+lt.length+" points";vt&&console.time(De),this.points=lt;for(var F=[],Me=0;Me<lt.length;Me++)!lt[Me].geometry||F.push(Tt(lt[Me],Me));this.trees[xr+1]=new Pe(F,mr,hr,q,Float32Array),vt&&console.timeEnd(De);for(var Te=xr;Te>=er;Te--){var ht=+Date.now();F=this._cluster(F,Te),this.trees[Te]=new Pe(F,mr,hr,q,Float32Array),vt&&console.log("z%d: %d clusters in %dms",Te,F.length,+Date.now()-ht)}return vt&&console.timeEnd("total time"),this},Ke.prototype.getClusters=function(lt,Ut){var vt=((lt[0]+180)%360+360)%360-180,er=Math.max(-90,Math.min(90,lt[1])),xr=lt[2]===180?180:((lt[2]+180)%360+360)%360-180,q=Math.max(-90,Math.min(90,lt[3]));if(lt[2]-lt[0]>=360)vt=-180,xr=180;else if(vt>xr){var De=this.getClusters([vt,er,180,q],Ut),F=this.getClusters([-180,er,xr,q],Ut);return De.concat(F)}for(var Me=this.trees[this._limitZoom(Ut)],Te=Me.range(Jt(vt),Zt(q),Jt(xr),Zt(er)),ht=[],bt=0,St=Te;bt<St.length;bt+=1){var qt=St[bt],or=Me.points[qt];ht.push(or.numPoints?Ct(or):this.points[or.index])}return ht},Ke.prototype.getChildren=function(lt){var Ut=this._getOriginId(lt),vt=this._getOriginZoom(lt),er="No cluster with the specified id.",xr=this.trees[vt];if(!xr)throw new Error(er);var q=xr.points[Ut];if(!q)throw new Error(er);for(var De=this.options.radius/(this.options.extent*Math.pow(2,vt-1)),F=xr.within(q.x,q.y,De),Me=[],Te=0,ht=F;Te<ht.length;Te+=1){var bt=ht[Te],St=xr.points[bt];St.parentId===lt&&Me.push(St.numPoints?Ct(St):this.points[St.index])}if(Me.length===0)throw new Error(er);return Me},Ke.prototype.getLeaves=function(lt,Ut,vt){Ut=Ut||10,vt=vt||0;var er=[];return this._appendLeaves(er,lt,Ut,vt,0),er},Ke.prototype.getTile=function(lt,Ut,vt){var er=this.trees[this._limitZoom(lt)],xr=Math.pow(2,lt),q=this.options,De=q.extent,F=q.radius,Me=F/De,Te=(vt-Me)/xr,ht=(vt+1+Me)/xr,bt={features:[]};return this._addTileFeatures(er.range((Ut-Me)/xr,Te,(Ut+1+Me)/xr,ht),er.points,Ut,vt,xr,bt),Ut===0&&this._addTileFeatures(er.range(1-Me/xr,Te,1,ht),er.points,xr,vt,xr,bt),Ut===xr-1&&this._addTileFeatures(er.range(0,Te,Me/xr,ht),er.points,-1,vt,xr,bt),bt.features.length?bt:null},Ke.prototype.getClusterExpansionZoom=function(lt){for(var Ut=this._getOriginZoom(lt)-1;Ut<=this.options.maxZoom;){var vt=this.getChildren(lt);if(Ut++,vt.length!==1)break;lt=vt[0].properties.cluster_id}return Ut},Ke.prototype._appendLeaves=function(lt,Ut,vt,er,xr){for(var q=this.getChildren(Ut),De=0,F=q;De<F.length;De+=1){var Me=F[De],Te=Me.properties;if(Te&&Te.cluster?xr+Te.point_count<=er?xr+=Te.point_count:xr=this._appendLeaves(lt,Te.cluster_id,vt,er,xr):xr<er?xr++:lt.push(Me),lt.length===vt)break}return xr},Ke.prototype._addTileFeatures=function(lt,Ut,vt,er,xr,q){for(var De=0,F=lt;De<F.length;De+=1){var Me=F[De],Te=Ut[Me],ht=Te.numPoints,bt=void 0,St=void 0,qt=void 0;if(ht)bt=Gt(Te),St=Te.x,qt=Te.y;else{var or=this.points[Te.index];bt=or.properties,St=Jt(or.geometry.coordinates[0]),qt=Zt(or.geometry.coordinates[1])}var rn={type:1,geometry:[[Math.round(this.options.extent*(St*xr-vt)),Math.round(this.options.extent*(qt*xr-er))]],tags:bt},Or=void 0;ht?Or=Te.id:this.options.generateId?Or=Te.index:this.points[Te.index].id&&(Or=this.points[Te.index].id),Or!==void 0&&(rn.id=Or),q.features.push(rn)}},Ke.prototype._limitZoom=function(lt){return Math.max(this.options.minZoom,Math.min(Math.floor(+lt),this.options.maxZoom+1))},Ke.prototype._cluster=function(lt,Ut){for(var vt=[],er=this.options,xr=er.radius,q=er.extent,De=er.reduce,F=er.minPoints,Me=xr/(q*Math.pow(2,Ut)),Te=0;Te<lt.length;Te++){var ht=lt[Te];if(!(ht.zoom<=Ut)){ht.zoom=Ut;for(var bt=this.trees[Ut+1],St=bt.within(ht.x,ht.y,Me),qt=ht.numPoints||1,or=qt,rn=0,Or=St;rn<Or.length;rn+=1){var Kn=Or[rn],on=bt.points[Kn];on.zoom>Ut&&(or+=on.numPoints||1)}if(or>qt&&or>=F){for(var Pn=ht.x*qt,mi=ht.y*qt,ei=De&&qt>1?this._map(ht,!0):null,xn=(Te<<5)+(Ut+1)+this.points.length,Fi=0,zi=St;Fi<zi.length;Fi+=1){var Li=zi[Fi],Qn=bt.points[Li];if(!(Qn.zoom<=Ut)){Qn.zoom=Ut;var Ln=Qn.numPoints||1;Pn+=Qn.x*Ln,mi+=Qn.y*Ln,Qn.parentId=xn,De&&(ei||(ei=this._map(ht,!0)),De(ei,this._map(Qn)))}}ht.parentId=xn,vt.push(nt(Pn/or,mi/or,xn,or,ei))}else if(vt.push(ht),or>1)for(var Fo=0,sa=St;Fo<sa.length;Fo+=1){var ao=sa[Fo],Pt=bt.points[ao];Pt.zoom<=Ut||(Pt.zoom=Ut,vt.push(Pt))}}}return vt},Ke.prototype._getOriginId=function(lt){return lt-this.points.length>>5},Ke.prototype._getOriginZoom=function(lt){return(lt-this.points.length)%32},Ke.prototype._map=function(lt,Ut){if(lt.numPoints)return Ut?Lr({},lt.properties):lt.properties;var vt=this.points[lt.index].properties,er=this.options.map(vt);return Ut&&er===vt?Lr({},er):er};function nt(Et,lt,Ut,vt,er){return{x:Ze(Et),y:Ze(lt),zoom:Infinity,id:Ut,parentId:-1,numPoints:vt,properties:er}}function Tt(Et,lt){var Ut=Et.geometry.coordinates,vt=Ut[0],er=Ut[1];return{x:Ze(Jt(vt)),y:Ze(Zt(er)),zoom:Infinity,index:lt,parentId:-1}}function Ct(Et){return{type:"Feature",id:Et.id,properties:Gt(Et),geometry:{type:"Point",coordinates:[wt(Et.x),xt(Et.y)]}}}function Gt(Et){var lt=Et.numPoints,Ut=lt>=1e4?Math.round(lt/1e3)+"k":lt>=1e3?Math.round(lt/100)/10+"k":lt;return Lr(Lr({},Et.properties),{cluster:!0,cluster_id:Et.id,point_count:lt,point_count_abbreviated:Ut})}function Jt(Et){return Et/360+.5}function Zt(Et){var lt=Math.sin(Et*Math.PI/180),Ut=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return Ut<0?0:Ut>1?1:Ut}function wt(Et){return(Et-.5)*360}function xt(Et){var lt=(180-Et*360)*Math.PI/180;return 360*Math.atan(Math.exp(lt))/Math.PI-90}function Lr(Et,lt){for(var Ut in lt)Et[Ut]=lt[Ut];return Et}function mr(Et){return Et.x}function hr(Et){return Et.y}return Ke})}}]);

//# sourceMappingURL=8400.3fef6450.async.js.map