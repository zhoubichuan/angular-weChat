(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5011],{64335:function(Sr,Q,N){"use strict";var _e=N(67294),J=(0,_e.createContext)({});Q.Z=J},21349:function(Sr,Q,N){"use strict";var _e=N(84305),J=N(39559),y=N(85893),oe=N(94184),V=N.n(oe),ce=N(67294),ie=N(64335),We=N(53645),ae=N.n(We),He=function(ct){var It=(0,ce.useContext)(ie.Z),tr=ct.children,qt=ct.contentWidth,ir=ct.className,rr=ct.style,At=(0,ce.useContext)(J.ZP.ConfigContext),gt=At.getPrefixCls,Br=ct.prefixCls||gt("pro"),dr=qt||It.contentWidth,lr="".concat(Br,"-grid-content");return(0,y.jsx)("div",{className:V()(lr,ir,{wide:dr==="Fixed"}),style:rr,children:(0,y.jsx)("div",{className:"".concat(Br,"-grid-content-children"),children:tr})})};Q.Z=He},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Sr){try{let ae=function(){V||(V=!0,y())},He=function(){try{oe.documentElement.doScroll("left")}catch(nt){return void setTimeout(He,50)}ae()};var ie=ae,We=He,Q=(Q=document.getElementsByTagName("script"))[Q.length-1],N=Q.getAttribute("data-injectcss"),Q=Q.getAttribute("data-disable-injectsvg");if(!Q){var _e,J,y,oe,V,ce=function(ct,It){It.parentNode.insertBefore(ct,It)};if(N&&!Sr.__iconfont__svg__cssinject__){Sr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(nt){console&&console.log(nt)}}_e=function(){var ct,It=document.createElement("div");It.innerHTML=Sr._iconfont_svg_string_3580659,(It=It.getElementsByTagName("svg")[0])&&(It.setAttribute("aria-hidden","true"),It.style.position="absolute",It.style.width=0,It.style.height=0,It.style.overflow="hidden",It=It,(ct=document.body).firstChild?ce(It,ct.firstChild):ct.appendChild(It))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(_e,0):(J=function(){document.removeEventListener("DOMContentLoaded",J,!1),_e()},document.addEventListener("DOMContentLoaded",J,!1)):document.attachEvent&&(y=_e,oe=Sr.document,V=!1,He(),oe.onreadystatechange=function(){oe.readyState=="complete"&&(oe.onreadystatechange=null,ae())})}}catch(ae){}}(window)},34941:function(Sr,Q,N){"use strict";N.d(Q,{zP:function(){return zL},JE:function(){return FP},ns:function(){return BL}});var _e={};N.r(_e),N.d(_e,{add:function(){return Eh},adjoint:function(){return Pr},clone:function(){return $e},copy:function(){return Ee},create:function(){return Ae},determinant:function(){return Tn},equals:function(){return Co},exactEquals:function(){return $m},frob:function(){return Fd},fromQuat:function(){return Hv},fromQuat2:function(){return wh},fromRotation:function(){return Qh},fromRotationTranslation:function(){return Zp},fromRotationTranslationScale:function(){return jv},fromRotationTranslationScaleOrigin:function(){return Gv},fromScaling:function(){return Js},fromTranslation:function(){return Bf},fromValues:function(){return vt},fromXRotation:function(){return du},fromYRotation:function(){return zf},fromZRotation:function(){return Nf},frustum:function(){return Wv},getRotation:function(){return Sa},getScaling:function(){return co},getTranslation:function(){return Vv},identity:function(){return or},invert:function(){return er},lookAt:function(){return Rc},mul:function(){return sf},multiply:function(){return Qn},multiplyScalar:function(){return $v},multiplyScalarAndAdd:function(){return Xv},ortho:function(){return Ao},orthoNO:function(){return Od},orthoZO:function(){return ep},perspective:function(){return Up},perspectiveFromFieldOfView:function(){return Uf},perspectiveNO:function(){return Dd},perspectiveZO:function(){return Zf},rotate:function(){return oi},rotateX:function(){return Bi},rotateY:function(){return Ia},rotateZ:function(){return ns},scale:function(){return zn},set:function(){return Et},str:function(){return jp},sub:function(){return Yv},subtract:function(){return ec},targetTo:function(){return Vp},translate:function(){return gn},transpose:function(){return Bt}});var J=N(67294),y=(0,J.createContext)({});function oe(){return(0,J.useContext)(y)}var V={},ce={},ie=function(i){return ce[i]},We=function(i,r){ce[i]=r},ae=function(i){return V[i]},He=function(i,r){V[i]=r},nt={},ct={},It=34,tr=10,qt=13;function ir(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function rr(e,i){var r=ir(e);return function(n,t){return i(r(n),t,e)}}function At(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var t in n)t in i||r.push(i[t]=t)}),r}function gt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Br(e){return e<0?"-"+gt(-e,6):e>9999?"+"+gt(e,6):gt(e,4)}function dr(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),t=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Br(e.getUTCFullYear(),4)+"-"+gt(e.getUTCMonth()+1,2)+"-"+gt(e.getUTCDate(),2)+(t?"T"+gt(i,2)+":"+gt(r,2)+":"+gt(n,2)+"."+gt(t,3)+"Z":n?"T"+gt(i,2)+":"+gt(r,2)+":"+gt(n,2)+"Z":r||i?"T"+gt(i,2)+":"+gt(r,2)+"Z":"")}function lr(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(S,A){var k,D,R=t(S,function(Z,W){if(k)return k(Z,W-1);D=Z,k=A?rr(Z,A):ir(Z)});return R.columns=D||[],R}function t(S,A){var k=[],D=S.length,R=0,Z=0,W,me=D<=0,ge=!1;S.charCodeAt(D-1)===tr&&--D,S.charCodeAt(D-1)===qt&&--D;function Ze(){if(me)return ct;if(ge)return ge=!1,nt;var rt,wt=R,Ut;if(S.charCodeAt(wt)===It){for(;R++<D&&S.charCodeAt(R)!==It||S.charCodeAt(++R)===It;);return(rt=R)>=D?me=!0:(Ut=S.charCodeAt(R++))===tr?ge=!0:Ut===qt&&(ge=!0,S.charCodeAt(R)===tr&&++R),S.slice(wt+1,rt-1).replace(/""/g,'"')}for(;R<D;){if((Ut=S.charCodeAt(rt=R++))===tr)ge=!0;else if(Ut===qt)ge=!0,S.charCodeAt(R)===tr&&++R;else if(Ut!==r)continue;return S.slice(wt,rt)}return me=!0,S.slice(wt,D)}for(;(W=Ze())!==ct;){for(var Ve=[];W!==nt&&W!==ct;)Ve.push(W),W=Ze();A&&(Ve=A(Ve,Z++))==null||k.push(Ve)}return k}function o(S,A){return S.map(function(k){return A.map(function(D){return x(k[D])}).join(e)})}function u(S,A){return A==null&&(A=At(S)),[A.map(x).join(e)].concat(o(S,A)).join(`
`)}function l(S,A){return A==null&&(A=At(S)),o(S,A).join(`
`)}function p(S){return S.map(v).join(`
`)}function v(S){return S.map(x).join(e)}function x(S){return S==null?"":S instanceof Date?dr(S):i.test(S+="")?'"'+S.replace(/"/g,'""')+'"':S}return{parse:n,parseRows:t,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var _t=lr(","),at=_t.parse,Ot=_t.parseRows,ft=_t.format,Kt=_t.formatBody,xr=_t.formatRows,Y=_t.formatRow,Le=_t.formatValue,O=N(28991),Me=63710088e-1,we={centimeters:Me*100,centimetres:Me*100,degrees:Me/111325,feet:Me*3.28084,inches:Me*39.37,kilometers:Me/1e3,kilometres:Me/1e3,meters:Me,metres:Me,miles:Me/1609.344,millimeters:Me*1e3,millimetres:Me*1e3,nauticalmiles:Me/1852,radians:1,yards:Me*1.0936},ut={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Me,yards:1.0936133},yt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function xt(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function jt(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return nr(i).geometry;case"LineString":return rn(i).geometry;case"Polygon":return Lr(i).geometry;case"MultiPoint":return yn(i).geometry;case"MultiLineString":return Yn(i).geometry;case"MultiPolygon":return Ai(i).geometry;default:throw new Error(e+" is invalid")}}function nr(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fe(e[0])||!fe(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return xt(n,i,r)}function en(e,i,r){return r===void 0&&(r={}),ii(e.map(function(n){return nr(n,i)}),r)}function Lr(e,i,r){r===void 0&&(r={});for(var n=0,t=e;n<t.length;n++){var o=t[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return xt(l,i,r)}function Vn(e,i,r){return r===void 0&&(r={}),ii(e.map(function(n){return Lr(n,i)}),r)}function rn(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return xt(n,i,r)}function Mn(e,i,r){return r===void 0&&(r={}),ii(e.map(function(n){return rn(n,i)}),r)}function ii(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Yn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return xt(n,i,r)}function yn(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return xt(n,i,r)}function Ai(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return xt(n,i,r)}function Pi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return xt(n,i,r)}function Mi(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function Hn(e,i){i===void 0&&(i="kilometers");var r=we[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Ln(e,i){i===void 0&&(i="kilometers");var r=we[i];if(!r)throw new Error(i+" units is invalid");return e/r}function vo(e,i){return Ya(Ln(e,i))}function Xi(e){var i=e%360;return i<0&&(i+=360),i}function Ya(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Mt(e){var i=e%360;return i*Math.PI/180}function L(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Hn(Ln(e,i),r)}function re(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=yt[i];if(!n)throw new Error("invalid original units");var t=yt[r];if(!t)throw new Error("invalid final units");return e/n*t}function fe(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ue(e){return!!e&&e.constructor===Object}function ht(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!fe(i))throw new Error("bbox must only contain numbers")})}function Gt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ar(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function je(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Tt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Tt(e[0]);throw new Error("coordinates must only contain numbers")}function ar(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function wr(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function $r(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,t=e.features;n<t.length;n++){var o=t[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+o.geometry.type)}}function _n(e){return e.type==="Feature"?e.geometry:e}function Cn(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function xn(e,i,r){if(e!==null)for(var n,t,o,u,l,p,v,x=0,S=0,A,k=e.type,D=k==="FeatureCollection",R=k==="Feature",Z=D?e.features.length:1,W=0;W<Z;W++){v=D?e.features[W].geometry:R?e.geometry:e,A=v?v.type==="GeometryCollection":!1,l=A?v.geometries.length:1;for(var me=0;me<l;me++){var ge=0,Ze=0;if(u=A?v.geometries[me]:v,u!==null){p=u.coordinates;var Ve=u.type;switch(x=r&&(Ve==="Polygon"||Ve==="MultiPolygon")?1:0,Ve){case null:break;case"Point":if(i(p,S,W,ge,Ze)===!1)return!1;S++,ge++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],S,W,ge,Ze)===!1)return!1;S++,Ve==="MultiPoint"&&ge++}Ve==="LineString"&&ge++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(t=0;t<p[n].length-x;t++){if(i(p[n][t],S,W,ge,Ze)===!1)return!1;S++}Ve==="MultiLineString"&&ge++,Ve==="Polygon"&&Ze++}Ve==="Polygon"&&ge++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(Ze=0,t=0;t<p[n].length;t++){for(o=0;o<p[n][t].length-x;o++){if(i(p[n][t][o],S,W,ge,Ze)===!1)return!1;S++}Ze++}ge++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(xn(u.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function wn(e,i,r,n){var t=r;return xn(e,function(o,u,l,p,v){u===0&&r===void 0?t=o:t=i(t,o,u,l,p,v)},n),t}function ri(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function Kn(e,i,r){var n=r;return ri(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function Yi(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function qi(e,i,r){var n=r;return Yi(e,function(t,o){o===0&&r===void 0?n=t:n=i(n,t,o)}),n}function mo(e){var i=[];return xn(e,function(r){i.push(r)}),i}function Wo(e,i){var r,n,t,o,u,l,p,v,x,S,A=0,k=e.type==="FeatureCollection",D=e.type==="Feature",R=k?e.features.length:1;for(r=0;r<R;r++){for(l=k?e.features[r].geometry:D?e.geometry:e,v=k?e.features[r].properties:D?e.properties:{},x=k?e.features[r].bbox:D?e.bbox:void 0,S=k?e.features[r].id:D?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,t=0;t<u;t++){if(o=p?l.geometries[t]:l,o===null){if(i(null,A,v,x,S)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,A,v,x,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],A,v,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Ki(e,i,r){var n=r;return Wo(e,function(t,o,u,l,p){o===0&&r===void 0?n=t:n=i(n,t,o,u,l,p)}),n}function G(e,i){Wo(e,function(r,n,t,o,u){var l=r===null?null:r.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(xt(r,t,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<r.coordinates.length;v++){var x=r.coordinates[v],S={type:p,coordinates:x};if(i(xt(S,t),n,v)===!1)return!1}})}function X(e,i,r){var n=r;return G(e,function(t,o,u){o===0&&u===0&&r===void 0?n=t:n=i(n,t,o,u)}),n}function ne(e,i){G(e,function(r,n,t){var o=0;if(!!r.geometry){var u=r.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(xn(r,function(S,A,k,D,R){if(l===void 0||n>p||D>v||R>x){l=S,p=n,v=D,x=R,o=0;return}var Z=lineString([l,S],r.properties);if(i(Z,n,t,R,o)===!1)return!1;o++,l=S})===!1)return!1}}})}function be(e,i,r){var n=r,t=!1;return ne(e,function(o,u,l,p,v){t===!1&&r===void 0?n=o:n=i(n,o,u,l,p,v),t=!0}),n}function Oe(e,i){if(!e)throw new Error("geojson is required");G(e,function(r,n,t){if(r.geometry!==null){var o=r.geometry.type,u=r.geometry.coordinates;switch(o){case"LineString":if(i(r,n,t,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],r.properties),n,t,l)===!1)return!1;break}}})}function Qe(e,i,r){var n=r;return Oe(e,function(t,o,u,l){o===0&&r===void 0?n=t:n=i(n,t,o,u,l)}),n}function ot(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o-1),lineString([p[t][o],p[t][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o-1),lineString([p[n][t][o],p[n][t][o+1]],u,i)}throw new Error("geojson is invalid")}function he(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,t=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),u=u||e.features[r].properties,l=e.features[r].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return t<0&&(t=p.length+t),o<0&&(o=p[t].length+o),point(p[t][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),t<0&&(t=p[n].length+t),o<0&&(o=p[n][t].length-o),point(p[n][t][o],u,i)}throw new Error("geojson is invalid")}var K=N(5991),xe=N(6610),lt=N(10379),pt=N(46070),te=N(77608),br=N(14665);function bn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(i){return typeof e=="function"}}var cn=N(51814);function Qt(e,i,r){return(0,cn.Z)()?Qt=Reflect.construct.bind():Qt=function(t,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(t,l),v=new p;return u&&(0,br.Z)(v,u.prototype),v},Qt.apply(null,arguments)}function tn(e){var i=typeof Map=="function"?new Map:void 0;return tn=function(n){if(n===null||!bn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,t)}function t(){return Qt(n,arguments,(0,te.Z)(this).constructor)}return t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),(0,br.Z)(t,n)},tn(e)}var Hr={REGISTERED_PROTOCOLS:{}};function qr(e){var i=si();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jr=function(i){return Hr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]},fi=function(e){(0,lt.Z)(r,e);var i=qr(r);function r(n,t,o,u){var l;return(0,xe.Z)(this,r),l=i.call(this,"AJAXError: ".concat(t," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=t,l.url=o,l.body=u,l}return(0,K.Z)(r)}(tn(Error));function zi(e,i){var r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=function(){i(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){var o=r.response;if(e.type==="json")try{o=JSON.parse(r.response)}catch(l){return i(l)}i(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{var u=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new fi(r.status,r.statusText,n.toString(),u))}},r.cancel=r.abort,r.send(e.body),r}function ui(e){return new Promise(function(i,r){zi(e,function(n,t,o,u,l){n?r({err:n,data:null,xhr:l}):i({err:null,data:t,cacheControl:o,expires:u,xhr:l})})})}function wi(e,i){return zi(e,i)}var bi=function(i,r){var n=Jr(i.url)||wi;return n((0,O.Z)((0,O.Z)({},i),{},{type:"json"}),r)},oo=function(i,r){var n=Jr(i.url)||wi;return n((0,O.Z)((0,O.Z)({},i),{},{type:"arrayBuffer"}),r)},ji=function(i,r){return wi(_objectSpread(_objectSpread({},i),{},{method:"POST"}),r)};function fa(e){var i=window.document.createElement("a");return i.href=e,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}var mi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function li(e,i){var r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=function(){i(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(function(){r.src=mi})},r.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var t=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(t):mi}function gi(e,i){var r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ha=function(i,r,n){var t=function(u,l){if(u)r(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?gi(v,r):li(v,r)}};return i.type==="json"?bi(i,t):oo(i,t)},Ns=function(i,r){var n=typeof createImageBitmap=="function";n?gi(i,r):li(i,r)},Ji=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hl(e,i,r){var n=e.classList;for(var t in aa)aa.hasOwnProperty(t)&&n.remove("l7-".concat(r,"-anchor-").concat(t));n.add("l7-".concat(r,"-anchor-").concat(i))}var Fu=N(2650);function pa(e){return typeof e=="string"?!!d3.color(e):!1}function qn(e){var i=Fu.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function oa(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],t=i+r*256+n*65536-1;return t}function Qi(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Mo(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=null,t=r.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var p=(e.positions[l]-o)/(u-o);t.addColorStop(p,e.colors[l])}return r.fillStyle=t,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),i=null,r=null,{data:n,width:256,height:1}}function Gi(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;for(var t=n.createLinearGradient(0,0,256,1),o=i[1]-i[0],u=0;u<e.colors.length;++u){var l=Math.max((e.positions[u]-i[0])/o,0);t.addColorStop(l,e.colors[u])}n.fillStyle=t,n.fillRect(0,0,256,1);var p=n.getImageData(0,0,256,1).data,v=zo(n,p);return r=null,n=null,v}function Po(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;var n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(t,o){var u=qn(e.colors[o]);n.data[t*4+0]=u[0]*255,n.data[t*4+1]=u[1]*255,n.data[t*4+2]=u[2]*255,n.data[t*4+3]=u[3]*255}),i=null,r=null,n}function go(e){var i=window.document.createElement("canvas"),r=i.getContext("2d");r.globalAlpha=1,i.width=256,i.height=1;for(var n=256/e.colors.length,t=0;t<e.colors.length;t++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[t],r.moveTo(t*n,0),r.lineTo((t+1)*n,0),r.stroke();var o=r.getImageData(0,0,256,1).data,u=zo(r,o);return i=null,r=null,u}function Cs(e,i){var r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;var t=i[1]-i[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-i[0])/t*255,0),n.lineTo((e.positions[o+1]-i[0])/t*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,l=zo(n,u);return r=null,n=null,l}function zo(e,i){for(var r=e.createImageData(256,1),n=0;n<r.data.length;n+=4)r.data[n+0]=i[n+0],r.data[n+1]=i[n+1],r.data[n+2]=i[n+2],r.data[n+3]=i[n+3];return r}function Dl(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var yo={BACK:1029,FRONT:1028};function Ea(e){switch(e){case"GAODE1.x":return yo.BACK;case"GAODE2.x":return yo.BACK;case"MAPBOX":return yo.FRONT;case"SIMPLE":return yo.FRONT;case"GLOBEL":return yo.BACK;case"DEBAULT":return yo.FRONT;default:return yo.FRONT}}var _r=N(85061),Qr=N(28481),ue=N(74691),Te=N.n(ue),it=N(50361),Jt=N.n(it),Gr=N(23279),kn=N.n(Gr),Di=N(27361),Oa=N.n(Di),so=N(51584),Ga=N.n(so),os=N(60442),$o=N.n(os),th=N(14293),Uc=N.n(th),Ts=N(81763),Bu=N.n(Ts),ss=N(68630),pl=N.n(ss),zu=N(47037),Zs=N.n(zu),Ol=N(36719),Xo=N.n(Ol),Fa=N(82492),Fl=N.n(Fa),Vc=N(30236),gf=N.n(Vc),Nu=N(97019),Bl=N.n(Nu),jc=N(23493),Gc=N.n(jc),yf=N(44908),rh=N.n(yf),nh=N(11700),Hh=N.n(nh),cc=N(23560),fc=N.n(cc),ih=N(13218),Ba=N.n(ih),_f=N(52353),Zu=N.n(_f),Ms=N(68929),dl=N.n(Ms),ei={isNil:Uc(),merge:Fl(),throttle:Gc(),isString:Zs(),debounce:kn(),pull:Bl(),isTypedArray:Xo(),isPlainObject:pl(),isNumber:Bu(),isBoolean:Ga(),isEqual:$o(),cloneDeep:Jt(),uniq:rh(),clamp:Te(),upperFirst:Hh(),get:Oa(),mergeWith:gf(),isFunction:fc(),isObject:Ba(),isUndefined:Zu(),camelCase:dl()},yu=ei.pull;function vs(e){var i=e;return typeof e=="string"&&(i=window.document.getElementById(e)),i}function _u(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Yo(e){return _u(e).split(/\s+/)}function Hc(e){var i,r,n,t=(i=window)===null||i===void 0||(r=i.document)===null||r===void 0||(n=r.documentElement)===null||n===void 0?void 0:n.style;if(!t)return e[0];for(var o in e)if(e[o]&&e[o]in t)return e[o];return e[0]}function Ci(e,i,r){var n=window.document.createElement(e);return i&&(n.className=i||""),r&&r.appendChild(n),n}function Ei(e){var i=e.parentNode;i&&i.removeChild(e)}function Us(e,i){if(e.classList!==void 0)for(var r=Yo(i),n=0,t=r.length;n<t;n++)e.classList.add(r[n]);else if(!ah(e,i)){var o=hc(e);xf(e,(o?o+" ":"")+i)}}function Vs(e,i){if(e.classList!==void 0){var r=Yo(i);r.forEach(function(n){e.classList.remove(n)})}else xf(e,_u((" "+hc(e)+" ").replace(" "+i+" "," ")))}function ah(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=hc(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function xf(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function hc(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function za(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Uu=Hc(["transform","WebkitTransform"]);function xu(e,i){e.style[Uu]=i}function No(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function bf(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function pc(){var e,i=window.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(t){var o=t.split("="),u=(0,Qr.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var ea=pc()<1?1:window.devicePixelRatio;function nu(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function zl(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function iu(e,i){var r,n=zl((r=e.getAttribute("style"))!==null&&r!==void 0?r:""),t=zl(i),o=yu.apply(void 0,[n].concat((0,_r.Z)(t)));e.setAttribute("style",o.join(";"))}function au(e){return Object.entries(e).map(function(i){var r=(0,Qr.Z)(i,2),n=r[0],t=r[1];return"".concat(n,": ").concat(t)}).join(";")}function Sf(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function bu(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Hi(e){e.innerHTML=""}function dc(e){e.setAttribute("draggable","false")}function vl(e,i){if(typeof i=="string"){var r=document.createElement("div");for(r.innerHTML=i;r.firstChild;)e.append(r.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,_r.Z)(i)):e.append(i)}function Nl(e,i){for(var r=Array.isArray(i)?i:[i],n=e;n instanceof Element&&n!==window.document.body;){var t,o;if(r.find(function(u){var l;return(l=n)===null||l===void 0?void 0:l.matches(u)}))return n;n=(t=(o=n)===null||o===void 0?void 0:o.parentElement)!==null&&t!==void 0?t:null}}var Wc;function wf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function vc(){return typeof importScripts=="function"}var mc=vc()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},js=(Wc=navigator)===null||Wc===void 0?void 0:Wc.userAgent,Su=!!js.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),gc=js.indexOf("Android")>-1||js.indexOf("Adr")>-1;function ml(){for(var e=js,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],r=!0,n=0,t=i;n<t.length;n++){var o=t[n];if(e.indexOf(o)>0){r=!1;break}}return r}function wu(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Ef=null;function Eu(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return xn(e,function(r){i[0]>r[0]&&(i[0]=r[0]),i[1]>r[1]&&(i[1]=r[1]),i[2]<r[0]&&(i[2]=r[0]),i[3]<r[1]&&(i[3]=r[1])}),i}Eu.default=Eu;var ks=Eu;function yc(e){return typeof e=="number"}var Zl=2*Math.PI*6378137/2;function Af(e,i){var r=(0,Qr.Z)(i,4),n=r[0],t=r[1],o=r[2],u=r[3];return e.lng>n&&e.lng<=o&&e.lat>t&&e.lat<=u}function Vu(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;gl(i,n)}),i}function gl(e,i){return Array.isArray(i[0])?i.forEach(function(r){gl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function $c(e,i){return Au(e,i)}function Au(e,i){return Array.isArray(e[0])?e.map(function(r){return Au(r,i)}):i(e)}function ju(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=sh(e,i);var n=e[0],t=e[1],o=n*Zl/180,u=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return u=u*Zl/180,r.enable&&(o=Number(o.toFixed(r.decimal)),u=Number(u.toFixed(r.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function oh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],t=r/Zl*180,o=n/Zl*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(t=Number(t.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[t,o,e[2]]:[t,o]}function Gu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Cf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function sh(e,i){if(i===!1)return e;var r=Gu(e[0]),n=Cf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function _o(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,t=Math.PI/180,o=e[0]*t,u=r*t;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return t=.5,o=n*(l*o+p),u=n*(v*u+t),[Math.floor(o),Math.floor(u)]}function _c(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,t=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-r)/i,p=(p/o-t)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,t=Math.PI/180;var v=p/t,x=l/t;return[x,v]}function uh(e,i){var r=85.0511287798,n=Math.PI/180,t=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*t,i*t]}function lh(e,i){var r=Math.PI/180,n=6378137,t=e/n/r,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/r;return[t,o]}function Tf(e,i,r){var n=Mt(i[1]-e[1]),t=Mt(i[0]-e[0]),o=Mt(e[1]),u=Mt(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(o)*Math.cos(u);return Hn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r="meters")}function Ul(e){var i=Math.PI/180,r=85.0511287798,n=6378137,t=Math.max(Math.min(r,e[1]),-r),o=Math.sin(t*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function Vl(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Gs(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function ta(e){return[[e[0],e[1]],[e[2],e[3]]]}function jl(e){var i=ou(e,[0,0]);return[e[0]/i,e[1]/i]}function ou(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Hu(e,i){return e[0]*i[0]+e[1]*i[1]}function yi(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function sa(e,i){return Math.acos(Hu(e,i)/(yi(e)*yi(i)))*180/Math.PI}function ms(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function Xc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,t=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=ou(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=ms(r,v);if(o>0){var S=t[o-1].rotation;S-x>360-S+x&&(x=x+360)}t.push({start:u,end:l,dis:p,rotation:x,duration:0})}return t.map(function(A){A.duration=i*(A.dis/n)}),t}}function us(e){if(yc(e[0]))return e;if(yc(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(yc(e[0][0][0])){var i=e,r=0,n=0,t=0;return i.forEach(function(o){o.forEach(function(u){r+=u[0],n+=u[1],t++})}),[r/t,n/t,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function xc(e){for(var i=e[0],r=e[1],n=e[0],t=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),r=Math.max(x,r),n=Math.min(v,n),t=Math.min(x,t),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-t,2))/2}}function Wh(e){return ks(ii([rn(e)]))}function Tp(e){var i=131,r=137,n=0;e+="x";for(var t=Math.floor(9007199254740991/r),o=0;o<e.length;o++)n>t&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(o);return n}function bc(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}function Cu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=Math.random()*16|0,r=e==="x"?i:i&3|8;return r.toString(16)})}var Wu=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Na(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*(o-1))/(o-1)),n?dn(e,i,l,n,t):dn(e,i,l,.314,t)}function xo(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function yl(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Aa(e,i,r){var n=[i[0]-e[0],i[1]-e[1]],t=yl(n,[0,0]),o=Math.atan2(n[1],n[0]),u=t/2/Math.cos(r),l=o+r,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function dn(e,i,r,n,t){if(t===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=Aa(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(xo(p,r),xo(v,r))),[0])}else{var x=Aa(e,i,n),S=[e[0],x[0],i[0]],A=[e[1],x[1],i[1]];return[xo(S,r),xo(A,r),0]}}function ls(e,i,r,n,t){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=r;return u&&(l=Math.round(r*29)/29),cs(e,i,l,t)}function Sc(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=calDistance(r,[0,0]),t=Math.atan2(r[1],r[0]),o=.314,u=n/2/Math.cos(o),l=t+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function $u(e,i){var r=1-i;return(e[0]*r+e[1]*i)*r+(e[1]*r+e[2]*i)*i}function Is(e,i){var r=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(r[0]/2),Math.sin(r[1]/2)],t=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}function cs(e,i,r,n){var t=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=Sc(t,o),l=[t[0],u[0],o[0]],p=[t[1],u[1],o[1]];return[$u(l,r),$u(p,r),0]}else{var v=Is(t,o);if(Math.abs(v-Math.PI)<.001)return[(1-r)*t[0]+r*o[0],(1-r)*t[1]+r*o[1]];var x=Math.sin((1-r)*v)/Math.sin(v),S=Math.sin(r*v)/Math.sin(v),A=[Math.sin(t[0]),Math.sin(t[1])],k=[Math.cos(t[0]),Math.cos(t[1])],D=[Math.sin(o[0]),Math.sin(o[1])],R=[Math.cos(o[0]),Math.cos(o[1])],Z=x*k[1]*k[0]+S*R[1]*R[0],W=x*k[1]*A[0]+S*R[1]*D[0],me=x*A[1]+S*D[1];return[radiansToDegrees(Math.atan2(W,Z)),radiansToDegrees(Math.atan2(me,Math.sqrt(Z*Z+W*W)))]}}function _l(e,i){for(var r=0,n=[],t=0;t<e.length-1;t++){var o=e[t],u=e[t+1],l=Yc(o,u),p=r;r+=l,n.push({p1:o,p2:u,totalDistance:r,distance:l,lastTotalDistance:p})}for(var v=r*i,x,S,A=0,k=n;A<k.length;A++){var D=k[A],R=D.totalDistance;if(R>v){var Z=D.p1,W=D.p2,me=(v-D.lastTotalDistance)/D.distance,ge=Rr(W,Z,me);x=ge[0],S=ge[1];break}}return{lng:x,lat:S,height:0}}function Rr(e,i,r){return[e[0]*r+i[0]*(1-r),e[1]*r+i[1]*(1-r)]}function Yc(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Gl(e,i){var r=i.featureId,n=e.data.dataArray;return typeof r=="number"&&(n=n.filter(function(t){var o=t.id;return o===r})),n.map(function(t){var o=gs(t,i);return _objectSpread(_objectSpread({},t),o)})}function Xu(e,i){return new Promise(function(r){e.inited?r(Gl(e,i)):e.once("update",function(){r(Gl(e,i))})})}function gs(e,i){var r=i.offset,n=i.shape,t=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,r);var S=x[0],A=x[1],k=typeof t=="string"?e[t]||0:t,D;switch(n){case"arc":D=arcLineAtOffset;break;case"greatcircle":D=greatCircleLineAtOffset;break;default:D=arcLineAtOffset}var R=D(S,A,r,k,o,l,v),Z=_slicedToArray(R,3),W=Z[0],me=Z[1],ge=Z[2];return{lng:W,lat:me,height:ge}}var qo=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,xe.Z)(this,e),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,K.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(t){return t===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function qc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Kc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Ko(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Tu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ko(e)/e.length}function Jc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,t=1,o=1;o<e.length+1;o++)e[o]!==i?(t>n&&(n=t,r=i),t=1,i=e[o]):t++;return r*1}var Yu={min:Kc,max:qc,mean:Tu,sum:Ko,mode:Jc};function wc(e,i){return e.map(function(r){return r[i]})}function Qc(e,i){return Yu[e](i)}var Pt=N(92137),Ie=N(63349),F=N(96156),su=N(87757),pe=N.n(su);function qa(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),t=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[r,n],l=[r,o],p=[t,o],v=[t,n];return Lr([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var Ca=N(26729),Hs=N.n(Ca),Jo=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),da=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),xl=0,In=1,mn=2;function Ec(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function Lo(e){e.forEach(function(i){i.properties.state=xl}),e.forEach(function(i){i.isCurrent&&!uo(i)&&Ps(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&mn)})}function Ka(e){e.forEach(function(r){r.properties.state=xl}),e.forEach(function(r){r.isCurrent&&uo(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&mn),r.children.length&&(r.isVisible||r.properties.state&In)?r.children.forEach(function(n){n.properties.state=In}):r.isCurrent&&Ps(r)})}function uo(e){for(;e;){if(e.isLoaded)return e.properties.state|=mn,!0;e=e.parent}return!1}function Ps(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=mn:Ps(i)})}var Qo,Ac=256,ki=[-Infinity,-Infinity,Infinity,Infinity],Ha=.2,Mf=5,qu=(Qo={},(0,F.Z)(Qo,Jo.Realtime,Ec),(0,F.Z)(Qo,Jo.Overlap,Lo),(0,F.Z)(Qo,Jo.Replace,Ka),Qo),ef=function(){};function Ls(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),t=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,t]}function Zo(e,i,r){var n=e/Math.pow(2,r)*360-180,t=Math.PI-2*Math.PI*i/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)));return[n,o]}var bl=function(i,r,n){var t=Zo(i,r,n),o=(0,Qr.Z)(t,2),u=o[0],l=o[1],p=Zo(i+1,r+1,n),v=(0,Qr.Z)(p,2),x=v[0],S=v[1];return[u,S,x,l]};function uu(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,t=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?ki:v,S=Math.ceil(i)+p;if(Number.isFinite(u)&&S<u)return[];Number.isFinite(t)&&S>t&&(S=t);for(var A=(0,Qr.Z)(r,4),k=A[0],D=A[1],R=A[2],Z=A[3],W=[Math.max(k,x[0]),Math.max(D,x[1]),Math.min(R,x[2]),Math.min(Z,x[3])],me=[],ge=Ls(W[0],W[1],S),Ze=(0,Qr.Z)(ge,2),Ve=Ze[0],rt=Ze[1],wt=Ls(W[2],W[3],S),Ut=(0,Qr.Z)(wt,2),Yt=Ut[0],mr=Ut[1],fr=Ve;fr<=Yt;fr++)for(var Wr=mr;Wr<=rt;Wr++)me.push({x:fr,y:Wr,z:S});var hn=(Yt+Ve)/2,Pn=(rt+mr)/2,Vi=function(ja,ao){return Math.abs(ja-hn)+Math.abs(ao-Pn)};return me.sort(function(Da,ja){return Vi(Da.x,Da.y)-Vi(ja.x,ja.y)}),me}var tf=function(i,r,n){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=r;return t&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function Hl(e){var i=Cc();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Cc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kf=function(e){(0,lt.Z)(r,e);var i=Hl(r);function r(n){var t;(0,xe.Z)(this,r),t=i.call(this),(0,F.Z)((0,Ie.Z)(t),"tileSize",256),(0,F.Z)((0,Ie.Z)(t),"isVisible",!1),(0,F.Z)((0,Ie.Z)(t),"isCurrent",!1),(0,F.Z)((0,Ie.Z)(t),"isVisibleChange",!1),(0,F.Z)((0,Ie.Z)(t),"loadedLayers",0),(0,F.Z)((0,Ie.Z)(t),"isLayerLoaded",!1),(0,F.Z)((0,Ie.Z)(t),"isLoad",!1),(0,F.Z)((0,Ie.Z)(t),"isChildLoad",!1),(0,F.Z)((0,Ie.Z)(t),"parent",null),(0,F.Z)((0,Ie.Z)(t),"children",[]),(0,F.Z)((0,Ie.Z)(t),"data",null),(0,F.Z)((0,Ie.Z)(t),"properties",{}),(0,F.Z)((0,Ie.Z)(t),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return t.x=o,t.y=u,t.z=l,t.warp=x||!0,t.tileSize=p,t}return(0,K.Z)(r,[{key:"isLoading",get:function(){return this.loadStatus===da.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===da.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===da.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===da.Cancelled}},{key:"isDone",get:function(){return[da.Loaded,da.Cancelled,da.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return bl(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Qr.Z)(this.bounds,4),o=t[0],u=t[1],l=t[2],p=t[3],v=[(l-o)/2,(p-u)/2],x=qa(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l,p,v,x,S,A,k,D,R,Z,W,me,ge,Ze,Ve,rt,wt;return pe().wrap(function(Yt){for(;;)switch(Yt.prev=Yt.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=da.Loading,S=null,Yt.prev=7,k=this.x,D=this.y,R=this.z,Z=this.bounds,W=this.tileSize,me=this.warp,ge=tf(k,D,R,me),Ze=ge.warpX,Ve=ge.warpY,rt=this.abortController.signal,wt={x:Ze,y:Ve,z:R,bounds:Z,tileSize:W,signal:rt,warp:me},Yt.next=14,l(wt,this);case 14:S=Yt.sent,Yt.next=20;break;case 17:Yt.prev=17,Yt.t0=Yt.catch(7),A=Yt.t0;case 20:if(x===this.loadDataId){Yt.next=22;break}return Yt.abrupt("return");case 22:if(!(this.isCancelled&&!S)){Yt.next=24;break}return Yt.abrupt("return");case 24:if(!(A||!S)){Yt.next=28;break}return this.loadStatus=da.Failure,v(A,this),Yt.abrupt("return");case 28:this.loadStatus=da.Loaded,this.data=S,p(this);case 31:case"end":return Yt.stop()}},o,this,[[7,17]])}));function t(o){return n.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=da.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(Ca.EventEmitter),Wl=function(i,r){var n=ta(i),t=Vl(n,r),o=360*3-180,u=85.0511287798065,l=[Math.max(t[0][0],-o),Math.max(t[0][1],-u),Math.min(t[1][0],o),Math.min(t[1][1],u)];return l},Ku=function(i,r){var n=ta(i),t=ta(r),o=Gs(n,t);return o};function Ws(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ju(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Ju(e,i){if(!!e){if(typeof e=="string")return Mu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mu(e,i)}}function Mu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $l(e){var i=$s();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function $s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rs=ei.throttle,Qu=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Tc=function(e){(0,lt.Z)(r,e);var i=$l(r);function r(n){var t;return(0,xe.Z)(this,r),t=i.call(this),(0,F.Z)((0,Ie.Z)(t),"currentTiles",[]),(0,F.Z)((0,Ie.Z)(t),"cacheTiles",new Map),(0,F.Z)((0,Ie.Z)(t),"throttleUpdate",Rs(function(o,u){t.update(o,u)},16)),(0,F.Z)((0,Ie.Z)(t),"onTileLoad",function(o){t.emit(Qu.TileLoaded,o),t.updateTileVisible(),t.loadFinished()}),(0,F.Z)((0,Ie.Z)(t),"onTileError",function(o,u){t.emit(Qu.TileError,{error:o,tile:u}),t.updateTileVisible(),t.loadFinished()}),(0,F.Z)((0,Ie.Z)(t),"onTileUnload",function(o){t.emit(Qu.TileUnload,o),t.loadFinished()}),t.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:ki,getTileData:ef,warp:!0,updateStrategy:Jo.Replace},t.updateOptions(n),t}return(0,K.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(t){return t.isDone})}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return t}},{key:"updateOptions",value:function(t){var o=t.minZoom===void 0?this.options.minZoom:Math.ceil(t.minZoom),u=t.maxZoom===void 0?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,O.Z)((0,O.Z)((0,O.Z)({},this.options),t),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(t,o){var u=this,l=Math.max(0,Math.ceil(t));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Ku(this.lastViewStates.latLonBoundsBuffer,o))){var p=Wl(o,Ha);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p},this.currentZoom=l;var v=!1,x=this.getTileIndices(l,p).filter(function(S){return u.options.warp||S.x>=0&&S.x<Math.pow(2,l)});this.emit(Qu.TilesLoadStart),this.currentTiles=x.map(function(S){var A=S.x,k=S.y,D=S.z,R=u.getTile(A,k,D);if(R){var Z,W,me=((Z=R)===null||Z===void 0?void 0:Z.isFailure)||((W=R)===null||W===void 0?void 0:W.isCancelled);return me&&R.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),R}return R=u.createTile(A,k,D),v=!0,R}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t=Ws(this.cacheTiles),o;try{for(t.s();!(o=t.n()).done;){var u=(0,Qr.Z)(o.value,2),l=u[0],p=u[1];if(!this.currentTiles.includes(p)){this.cacheTiles.delete(l),this.onTileUnload(p);return}this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){t.e(v)}finally{t.f()}}},{key:"reloadTileById",value:function(t,o,u){var l=this.cacheTiles.get("".concat(o,",").concat(u,",").concat(t));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,o,u){var l=this.getTileByLngLat(t,o,u);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(t,o){var u=this,l=this.getTileIndices(o,t);l.forEach(function(p){u.reloadTileById(p.z,p.x,p.y)})}},{key:"pruneRequests",value:function(){var t=[],o=Ws(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&t.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;t.length>0;){var p=t.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(t,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=Ls(t,o,p),x=this.tiles.filter(function(S){return S.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"getTileExtent",value:function(t,o){return this.getTileIndices(o,t)}},{key:"getTileByZXY",value:function(t,o,u){var l=this.tiles.filter(function(p){return p.key==="".concat(o,"_").concat(u,"_").concat(t)});return l[0]}},{key:"clear",value:function(){var t=Ws(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.isLoading?u.abortLoad():this.onTileUnload(u)}}catch(l){t.e(l)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t=this.options.updateStrategy,o=new Map,u=Ws(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(D){u.e(D)}finally{u.f()}var v=Ws(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.isCurrent=!0,S.isVisible=!0}}catch(D){v.e(D)}finally{v.f()}var A=Array.from(this.cacheTiles.values());typeof t=="function"?t(A):qu[t](A);var k=!1;Array.from(this.cacheTiles.values()).forEach(function(D){D.isVisible!==o.get(D.key)?(D.isVisibleChange=!0,k=!0):D.isVisibleChange=!1}),k&&this.emit(Qu.TileUpdate)}},{key:"getTileIndices",value:function(t,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),S=Math.ceil(this.options.minZoom),A=uu({maxZoom:x,minZoom:S,zoomOffset:v,tileSize:l,zoom:t,latLonBounds:o,extent:p});return A}},{key:"getTileId",value:function(t,o,u){var l="".concat(t,",").concat(o,",").concat(u);return l}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some(function(o){return!o.isDone});return t&&this.emit(Qu.TilesLoadFinished),t}},{key:"getTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(t,o,u){var l=this.getTileId(t,o,u),p=new kf({x:t,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var t=Mf*this.currentTiles.length,o=this.cacheTiles.size>t;if(o){var u=Ws(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Qr.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=t)break}}catch(S){u.e(S)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t=Ws(this.cacheTiles.values()),o;try{for(t.s();!(o=t.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(S){t.e(S)}finally{t.f()}var l=Ws(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(S){l.e(S)}finally{l.f()}}},{key:"getNearestAncestor",value:function(t,o,u){for(;u>this.options.minZoom;){t=Math.floor(t/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(t,o,u);if(l)return l}return null}}]),r}(Hs());function ch(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function rf(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),t=r[2].charCodeAt(0),o;for(o=n;o<=t;++o)i.push(e.replace(r[0],String.fromCharCode(o)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){for(var u=parseInt(r[2],10),l=parseInt(r[1],10);l<=u;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}function f(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,t=i.z,o=rf(e),u=Math.abs(r+n)%o.length,l=Jr(o[u])?"".concat(o[u],"/{z}/{x}/{y}"):o[u];return l.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,t.toString()).replace(/\{bbox\}/g,bl(r,n,t).join(",")).replace(/\{-y\}/g,(Math.pow(2,t)-n-1).toString())}function d(e,i){var r=i.x,n=i.y,t=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,S=i.service,A=S===void 0?"WMTS":S,k=i.tileMatrixset,D="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(k,"&FORMAT=").concat(x,"&TILECOL=").concat(r,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(t);return D}function h(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var g={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},w=g.self||g.window||{},C=g.window||g.self||{},T=g.self||g.window||{},I=g.document||{},U=typeof importScripts=="function",$=typeof window!="undefined"&&typeof window.orientation!="undefined",le=function(){function e(i,r){var n=this;this.name=i,this.workerThread=r,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(t,o){n.resolve=t,n.reject=o})}return e.prototype.postMessage=function(i,r){this.workerThread.postMessage({source:"Main thread",type:i,payload:r})},e.prototype.done=function(i){h(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){h(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),ve=le,ye=new Map;function ze(e){h(e.source&&!e.url||!e.source&&e.url);var i=ye.get(e.source||e.url);return i||(e.url&&(i=Fe(e.url),ye.set(e.url,i)),e.source&&(i=Ye(e.source),ye.set(e.source,i))),h(i),i}function Fe(e){if(!e.startsWith("http"))return e;var i=Pe(e);return Ye(i)}function Ye(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function Pe(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Xe(e,i,r){i===void 0&&(i=!0);var n=r||new Set;if(e){if(st(e))n.add(e);else if(st(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var t in e)Xe(e[t],i,n)}}return r===void 0?Array.from(n):[]}function st(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Ct=function(){},Wt=function(){function e(i){this.terminated=!1,this.loadableURL="";var r=i.name,n=i.source,t=i.url;h(n||t),this.name=r,this.source=n,this.url=t,this.onMessage=Ct,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Ct,this.onError=Ct,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,r){r=r||Xe(i),this.worker.postMessage(i,r)},e.prototype.getErrorFromErrorEvent=function(i){var r="Failed to load ";return r+="worker "+this.name+" from "+this.url+". ",i.message&&(r+=i.message+" in "),i.lineno&&(r+=":"+i.lineno+":"+i.colno),new Error(r)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=ze({source:this.source,url:this.url});var r=new Worker(this.loadableURL,{name:this.name});return r.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},r.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},r.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},r},e}(),Zt=Wt,Ht=function(){return Ht=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Ht.apply(this,arguments)},hr=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Nr=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Dr=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=Ht(Ht({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,r,n){return r===void 0&&(r=function(t,o,u){return t.done(u)}),n===void 0&&(n=function(t,o){return t.error(o)}),hr(this,void 0,void 0,function(){var t,o=this;return Nr(this,function(u){switch(u.label){case 0:return t=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:r,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,t];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return hr(this,void 0,void 0,function(){var i,r,n;return Nr(this,function(t){switch(t.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(r=this.jobQueue.shift(),!r)return[3,4];this.onDebug({message:"Starting job",name:r.name,backlog:this.jobQueue.length,workerThread:i}),n=new ve(r.name,i),i.onMessage=function(o){return r.onMessage(n,o.type,o.payload)},i.onError=function(o){return r.onError(n,o)},r.onStart(n),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n.result];case 2:return t.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var r=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();r?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zt({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return $?this.maxMobileConcurrency:this.maxConcurrency},e}(),an=Dr,En=function(){return En=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},En.apply(this,arguments)},Dn=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&e[i],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},On={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Li=function(){function e(i){this.workerPools=new Map,this.props=En({},On),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return Zt.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,r;try{for(var n=Dn(this.workerPools.values()),t=n.next();!t.done;t=n.next()){var o=t.value;o.destroy()}}catch(u){i={error:u}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var r,n;this.props=En(En({},this.props),i);try{for(var t=Dn(this.workerPools.values()),o=t.next();!o.done;o=t.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=t.return)&&n.call(t)}finally{if(r)throw r.error}}},e.prototype.getWorkerPool=function(i){var r=i.name,n=i.source,t=i.url,o=this.workerPools.get(r);return o||(o=new an({name:r,source:n,url:t}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(r,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),fn=null,Wn=new Map,ai=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(r){if(!!$n(r)){var n=r.data,t=n.type,o=n.payload;i(t,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var r=Wn.get(i);r||(r=function(n){if(!!$n(n)){var t=n.data,o=t.type,u=t.payload;i(o,u)}}),self.addEventListener("message",r)},e.removeEventListener=function(i){var r=Wn.get(i);Wn.delete(i),self.removeEventListener("message",r)},e.postMessage=function(i,r){if(self){var n={source:"Worker thread",type:i,payload:r},t=Xe(r);self.postMessage(n,t)}},e}(),Jn=null;function $n(e){var i=e.type,r=e.data;return i==="message"&&r&&typeof r.source=="string"&&r.source==="Main thread"}function ci(e){return JSON.parse(Xn(e))}function Xn(e){var i=new Set;return JSON.stringify(e,function(r,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(t){return}i.add(n)}return n})}function jn(e){return""+e.name}function Ja(e,i){i===void 0&&(i={});var r=i[e.id]||{},n=e.name+".worker.js",t=r.workerUrl;return i._workerType==="test"&&(t=e.module+"/dist/"+n),t||(t="https://unpkg.com/"+e.module+"/dist/"+n),assert(t),t}var va=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},bo=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function So(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function _a(e,i,r,n){return r===void 0&&(r={}),n===void 0&&(n={}),va(this,void 0,void 0,function(){var t,o,u,l,p,v,x,S;return bo(this,function(A){switch(A.label){case 0:return t=getWorkerName(e),o=getWorkerURL(e,r),u=WorkerFarm.getWorkerFarm(r),l=u.getWorkerPool({name:t,url:o}),p=r.jobName||e.name,[4,l.startJob(p,Ta.bind(null,n))];case 1:return v=A.sent(),x=removeNontransferableOptions(r),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return S=A.sent(),[2,S.result]}})})}function Ta(e,i,r,n){return va(this,void 0,void 0,function(){var t,o,u,l,p,v,x;return bo(this,function(S){switch(S.label){case 0:switch(t=r,t){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,S.label=4;case 4:return S.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=S.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=S.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+r),S.label=9;case 9:return[2]}})})}var es=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var r=this._settlers.shift();i instanceof Error?r.reject(i):r.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var r=this._values.shift();return r instanceof Error?Promise.reject(r):Promise.resolve({done:!1,value:r})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,t){i._settlers.push({resolve:n,reject:t})})},e}(),Uo=null,ku=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Ro=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},ys=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],r;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),t(l,p,u.done,u.value)})}}function t(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},_s=0,lu,el;function tl(e,i){var r=this;if(typeof self!="undefined"){var n={process:rl};WorkerBody.onmessage=function(t,o){return ku(r,void 0,void 0,function(){var u,l,p,v,x,S,A,k,D,R,Z;return Ro(this,function(W){switch(W.label){case 0:switch(W.trys.push([0,19,,20]),u=t,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=W.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");lu=new AsyncQueue,el=o.options||{},p=i(lu,el,n),W.label=4;case 4:W.trys.push([4,9,10,15]),v=ys(p),W.label=5;case 5:return[4,v.next()];case 6:if(x=W.sent(),!!x.done)return[3,8];S=x.value,WorkerBody.postMessage("output-batch",{result:S}),W.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=W.sent(),R={error:A},[3,15];case 10:return W.trys.push([10,,13,14]),x&&!x.done&&(Z=v.return)?[4,Z.call(v)]:[3,12];case 11:W.sent(),W.label=12;case 12:return[3,14];case 13:if(R)throw R.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return lu.push(o.input),[3,18];case 17:return lu.close(),[3,18];case 18:return[3,20];case 19:return k=W.sent(),D=k instanceof Error?k.message:"",WorkerBody.postMessage("error",{error:D}),[3,20];case 20:return[2]}})})}}}function rl(e,i){return i===void 0&&(i={}),new Promise(function(r,n){var t=_s++,o=function(l,p){if(p.id===t)switch(l){case"done":WorkerBody.removeEventListener(o),r(p.result);break;case"error":WorkerBody.removeEventListener(o),n(p.error);break;default:}};WorkerBody.addEventListener(o);var u={id:t,input:e,options:i};WorkerBody.postMessage("process",u)})}var Sl=function(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},Ds=function(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Iu={};function Xs(e,i,r){return i===void 0&&(i=null),r===void 0&&(r={}),Sl(this,void 0,void 0,function(){return Ds(this,function(n){switch(n.label){case 0:return i&&(e=Ma(e,i,r)),Iu[e]=Iu[e]||cu(e),[4,Iu[e]];case 1:return[2,n.sent()]}})})}function Ma(e,i,r){if(e.startsWith("http"))return e;var n=r.modules||{};return n[e]?n[e]:r.CDN?(assert(r.CDN.startsWith("http")),r.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function cu(e){return Sl(this,void 0,void 0,function(){var i,r,n;return Ds(this,function(t){switch(t.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=t.sent(),[4,i.arrayBuffer()];case 2:return[2,t.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return r=t.sent(),[4,r.text()];case 5:return n=t.sent(),[2,Ys(n,e)]}})})}function Ys(e,i){if(isWorker)return eval.call(global,e),null;var r=document.createElement("script");r.id=i;try{r.appendChild(document.createTextNode(e))}catch(n){r.text=e}return document.body.appendChild(r),null}var fs="0.0.3",Oi={id:"null",name:"null",module:"web-worker-helper",options:{}};function Qa(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function eo(e,i,r){return r.length===2?[r[0],r[1],0]:[r[0],r[1],r[2]]}function xs(e){var i=e.filter;return i?[1]:[0]}function Pu(e,i){return[i]}var fu=N(9187),ko=N.n(fu),Mr=N(31437),nl=Mr.create(),Lu=Mr.create(),xa=Mr.create(),hu=Mr.create(),ts=Mr.create();function to(e,i,r,n,t){Mr.add(e,r,n),Mr.normalize(e,e),i=Mr.fromValues(-e[1],e[0]);var o=Mr.fromValues(-r[1],r[0]);return[t/Mr.dot(i,o),i]}function Xl(e,i){return Mr.set(e,-i[1],i[0])}function Mc(e,i,r){return Mr.sub(e,i,r),Mr.normalize(e,e),e}function fh(e,i){return e[0]===i[0]&&e[1]===i[1]}function Sd(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Mp=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xe.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Mr.fromValues(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,K.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,_r.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(t,u,S,k,R,A,D,Z);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,_r.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,W=this.simpleSegment(t,u,S,k,R,A,D,Z);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,k=r.normals,D=this.cap==="square",R=this.join==="bevel",Z=_o([p[0],p[1]]),W=_o([l[0],l[1]]);Mc(xa,o,t);var me=0;if(this.dash&&(me=this.lineSegmentDistance(Z,W),this.totalDistance+=me),this.normal||(this.normal=Mr.create(),Xl(this.normal,xa)),!this.started)if(this.started=!0,D){var ge=Mr.create(),Ze=Mr.create();Mr.add(ge,this.normal,xa),Mr.add(Ze,this.normal,xa),k.push(Ze[0],Ze[1],0),k.push(ge[0],ge[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,t,this.normal,this.thickness,this.totalDistance-me);if(S.push(n+0,n+1,n+2),u){fh(o,u)&&Mr.add(u,o,Mr.normalize(u,Mr.subtract(u,o,t))),Mc(hu,u,o);var wt=to(ts,Mr.create(),xa,hu,this.thickness),Ut=(0,Qr.Z)(wt,2),Yt=Ut[0],mr=Ut[1],fr=Mr.dot(ts,this.normal)<0?-1:1,Wr=R;if(!Wr&&this.join==="miter"){var hn=Yt;hn>this.miterLimit&&(Wr=!0)}Wr?(k.push(this.normal[0],this.normal[1],0),k.push(mr[0],mr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,_r.Z)(this.lastFlip!==-fr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),Xl(nl,hu),Mr.copy(this.normal,nl),k.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,k,o,mr,Yt,this.totalDistance),S.push.apply(S,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),fr=-1,Mr.copy(this.normal,mr),x+=2),this.lastFlip=fr}else{if(Xl(this.normal,xa),D){var Ve=Mr.create(),rt=Mr.create();Mr.sub(rt,xa,this.normal),Mr.add(Ve,xa,this.normal),k.push(rt[0],rt[1],0),k.push(Ve[0],Ve[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=_o([o[0],o[1]]),A=_o([t[0],t[1]]);Mc(xa,S,A);var k=0;if(this.dash&&(k=this.lineSegmentDistance(S,A),this.totalDistance+=k),this.normal||(this.normal=Mr.create(),Xl(this.normal,xa)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)Xl(this.normal,xa),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=_o([u[0],u[1]]);fh(S,D)&&Mr.add(D,S,Mr.normalize(D,Mr.subtract(D,S,A))),Mc(hu,D,S);var R=to(ts,Mr.create(),xa,hu,this.thickness),Z=(0,Qr.Z)(R,2),W=Z[0],me=Z[1],ge=Mr.dot(ts,this.normal)<0?-1:1;this.extrusions(v,x,o,me,W,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ge=-1,Mr.copy(this.normal,me),l+=2,this.lastFlip=ge}return l}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",k=_o([o[0],o[1]]),D=_o([t[0],t[1]]);Mc(xa,k,D);var R=0;if(this.dash&&(R=this.lineSegmentDistance(k,D),this.totalDistance+=R),this.normal||(this.normal=Mr.create(),Xl(this.normal,xa)),!this.started)if(this.started=!0,S){var Z=Mr.create(),W=Mr.create();Mr.add(Z,this.normal,xa),Mr.add(W,this.normal,xa),x.push(W[0],W[1],0),x.push(Z[0],Z[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-R);if(p.push(n+0,n+1,n+2),u){var Ze=_o([u[0],u[1]]);fh(k,Ze)&&Mr.add(Ze,k,Mr.normalize(Ze,Mr.subtract(Ze,k,D))),Mc(hu,Ze,k);var Ve=to(ts,Mr.create(),xa,hu,this.thickness),rt=(0,Qr.Z)(Ve,2),wt=rt[0],Ut=rt[1],Yt=Mr.dot(ts,this.normal)<0?-1:1,mr=A;if(!mr&&this.join==="miter"){var fr=wt;fr>this.miterLimit&&(mr=!0)}mr?(x.push(this.normal[0],this.normal[1],0),x.push(Ut[0],Ut[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,_r.Z)(this.lastFlip!==-Yt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Xl(nl,hu),Mr.copy(this.normal,nl),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Ut,wt,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Yt=-1,Mr.copy(this.normal,Ut),l+=2),this.lastFlip=Yt}else{if(Xl(this.normal,xa),S){var me=Mr.create(),ge=Mr.create();Mr.sub(ge,xa,this.normal),Mr.add(me,xa,this.normal),x.push(ge[0],ge[1],0),x.push(me[0],me[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),hh=85.0511287798;function il(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new Mp({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function ph(e){var i=us(e.coordinates);return{vertices:[].concat((0,_r.Z)(i),(0,_r.Z)(i),(0,_r.Z)(i),(0,_r.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function If(e){var i=e.coordinates,r=ko().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes,u=ko()(n,o,t);return{indices:u,vertices:n,size:t}}function wd(e,i){var r=i;return i>hh&&(r=hh),i<-hh&&(r=-hh),[Math.PI*e/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*r/180*.5))]}function Yl(e,i){return[(e-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-i))-Math.PI*.25)*2*180/Math.PI]}var Pf=function(){var e=(0,Pt.Z)(pe().mark(function i(r){var n,t,o,u,l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.iconMap,l={a_Color:Qa,a_Position:eo,filter:xs,a_vertexId:Pu,a_PickingColor:function(R){var Z=R.id;return o?Qi(Z):[0,0,0]},a_DistanceAndIndex:function(R,Z,W,me,ge,Ze){return Ze===void 0?[W[3],10]:[W[3],Ze]},a_Total_Distance:function(R,Z,W){return[W[5]]},a_Size:function(R){var Z=R.size,W=Z===void 0?1:Z;return Array.isArray(W)?[W[0],W[1]]:[W,0]},a_Normal:function(R,Z,W,me,ge){return ge},a_Miter:function(R,Z,W){return[W[4]]},a_iconMapUV:function(R){var Z=R.texture,W=u[Z]||{x:0,y:0},me=W.x,ge=W.y;return[me,ge]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(D,R){var Z=il(D),W=Z.indices,me=Z.vertices,ge=Z.normals,Ze=Z.size,Ve=Z.indexes;W.forEach(function(Yt){x.push(Yt+v)}),S=Ze;var rt=me.length/Ze;p.sizePerElement=S,p.elements.push({featureIdx:R,vertices:me,normals:ge,offset:v}),v+=rt;for(var wt=function(mr){var fr=(ge==null?void 0:ge.slice(mr*3,mr*3+3))||[],Wr=me.slice(mr*Ze,mr*Ze+Ze),hn=0;Ve&&Ve[mr]!==void 0&&(hn=Ve[mr]),n.forEach(function(Pn){if(Pn&&l[Pn.name]){var Vi;(Vi=Pn.buffer.data).push.apply(Vi,(0,_r.Z)(l[Pn.name](D,R,Wr,mr,fr,hn)))}})},Ut=0;Ut<rt;Ut++)wt(Ut)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return k.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Ed=function(){var e=(0,Pt.Z)(pe().mark(function i(r){var n,t,o,u,l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u=r.shape2d,l={a_Color:Qa,a_Position:eo,filter:xs,a_vertexId:Pu,a_PickingColor:function(R){var Z=R.id;return o?Qi(Z):[0,0,0]},a_Shape:function(R){var Z=R.shape,W=Z===void 0?2:Z,me=u.indexOf(W);return[me]},a_Extrude:function(R,Z,W,me){var ge=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ze=me%4*3;return[ge[Ze],ge[Ze+1],ge[Ze+2]]},a_Size:function(R){var Z=R.size,W=Z===void 0?5:Z;return Array.isArray(W)?[W[0]]:[W]}},p={sizePerElement:0,elements:[]},v=0,x=[],S=3,t.forEach(function(D,R){var Z=ph(D),W=Z.indices,me=Z.vertices,ge=Z.normals,Ze=Z.size,Ve=Z.indexes;W.forEach(function(Yt){x.push(Yt+v)}),S=Ze;var rt=me.length/Ze;p.sizePerElement=S,p.elements.push({featureIdx:R,vertices:me,normals:ge,offset:v}),v+=rt;for(var wt=function(mr){var fr=(ge==null?void 0:ge.slice(mr*3,mr*3+3))||[],Wr=me.slice(mr*Ze,mr*Ze+Ze),hn=0;Ve&&Ve[mr]!==void 0&&(hn=Ve[mr]),n.forEach(function(Pn){if(Pn&&l[Pn.name]){var Vi;(Vi=Pn.buffer.data).push.apply(Vi,(0,_r.Z)(l[Pn.name](D,R,Wr,mr,fr,hn)))}})},Ut=0;Ut<rt;Ut++)wt(Ut)}),k.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return k.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Ad=function(){var e=(0,Pt.Z)(pe().mark(function i(r){var n,t,o,u,l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=r.descriptors,t=r.features,o=r.enablePicking,u={a_Color:Qa,a_Position:eo,filter:xs,a_vertexId:Pu,a_PickingColor:function(D){var R=D.id;return o?Qi(R):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,t.forEach(function(k,D){var R=If(k),Z=R.indices,W=R.vertices,me=R.normals,ge=R.size,Ze=R.indexes;Z.forEach(function(Ut){v.push(Ut+p)}),x=ge;var Ve=W.length/ge;l.sizePerElement=x,l.elements.push({featureIdx:D,vertices:W,normals:me,offset:p}),p+=Ve;for(var rt=function(Yt){var mr=(me==null?void 0:me.slice(Yt*3,Yt*3+3))||[],fr=W.slice(Yt*ge,Yt*ge+ge),Wr=0;Ze&&Ze[Yt]!==void 0&&(Wr=Ze[Yt]),n.forEach(function(hn){if(hn&&u[hn.name]){var Pn;(Pn=hn.buffer.data).push.apply(Pn,(0,_r.Z)(u[hn.name](k,D,fr,Yt,mr,Wr)))}})},wt=0;wt<Ve;wt++)rt(wt)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return A.stop()}},i)}));return function(r){return e.apply(this,arguments)}}(),Cd={pointFill:Ed,line:Pf,polygonFill:Ad},kp=(0,O.Z)({},Cd);function Zv(e){return $h.apply(this,arguments)}function $h(){return $h=_asyncToGenerator(_regeneratorRuntime.mark(function e(i){var r,n;return _regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=i.workerType,n=i.data,!kp[r]){o.next=3;break}return o.abrupt("return",kp[r](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(r,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),$h.apply(this,arguments)}var Ip=new Map;function Pp(e,i){Ip.set(e,i)}function Uv(e){var i=Ip.get(e);return i}var pu="l7-worker",dh=3,ka=!0;function nf(e){registerWorkerSource(pu,e)}function vh(){var e=getWorkerSource(pu);if(!e)throw new Error("get worker failed by workerName: ".concat(pu,"."));return e}function af(e,i){return wl.apply(this,arguments)}function wl(){return wl=_asyncToGenerator(_regeneratorRuntime.mark(function e(i,r){var n,t,o,u,l;return _regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=vh(),t=WorkerFarm.getWorkerFarm({maxConcurrency:dh,reuseWorkers:ka}),o=t.getWorkerPool({name:pu,source:n}),v.next=5,o.startJob(pu,function(x,S,A){return x.done(A)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:r}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),wl.apply(this,arguments)}var ql=N(38163),mh=N.n(ql);function Lf(e,i){return e.map(function(r){return r[i]*1})}function Kl(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Rf(e){return Array.isArray(e)?e.length===0?!1:!!Kl(e[0]):!1}function Jl(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function kc(e){var i=Object.isFrozen(e)?ei.cloneDeep(e):e;return mh()(i,!0),i}function al(e,i){var r=i.x,n=i.y,t=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(W){return W[l]&&W[l].type&&W[l].coordinates&&W[l].coordinates.length>0}).forEach(function(W,me){var ge=kc(W[l]);G(ge,function(Ze){var Ve=je(Ze),rt=(0,O.Z)((0,O.Z)({},W),{},{_id:me,coordinates:Ve});p.push(rt)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],S=[];if(u){var A="Polygon";Array.isArray(u[0])||(A="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(A="LineString");var k=kc({type:A,coordinates:x[u]});S=k.coordinates}else if(r&&n&&t&&o){var D=[parseFloat(x[r]),parseFloat(x[n])],R=[parseFloat(x[t]),parseFloat(x[o])];S=[D,R]}else r&&n&&(S=[parseFloat(x[r]),parseFloat(x[n])]);var Z=(0,O.Z)((0,O.Z)({},x),{},{_id:v,coordinates:S});p.push(Z)}return{dataArray:p}}function Df(e,i){var r=at(e);return al(r,i)}var ol=N(90484);function Lp(e){for(var i=e.toString(),r=5381,n=i.length;n;)r=r*33^i.charCodeAt(--n);return r>>>0}function Ic(e,i){return i===void 0?null:(0,ol.Z)(e.properties[i])*1==="number"?e.properties[i]*1:e.properties&&e.properties[i]?Lp(e.properties[i]+"")%1000019:null}function El(e,i){var r=[],n={};return e.features?(e.features=e.features.filter(function(t){var o=t.geometry;return t!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),e=kc(e),e.features.length===0?{dataArray:[],featureKeys:n}:(G(e,function(t,o){var u=Ic(t,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=je(t),v=(0,O.Z)((0,O.Z)({},t.properties),{},{coordinates:p,_id:l});r.push(v)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function Os(e,i,r,n){for(var t=n,o=r-i>>1,u=r-i,l,p=e[i],v=e[i+1],x=e[r],S=e[r+1],A=i+3;A<r;A+=3){var k=Xh(e[A],e[A+1],p,v,x,S);if(k>t)l=A,t=k;else if(k===t){var D=Math.abs(A-o);D<u&&(l=A,u=D)}}t>n&&(l-i>3&&Os(e,i,l,n),e[l+2]=t,r-l>3&&Os(e,l,r,n))}function Xh(e,i,r,n,t,o){var u=t-r,l=o-n;if(u!==0||l!==0){var p=((e-r)*u+(i-n)*l)/(u*u+l*l);p>1?(r=t,n=o):p>0&&(r+=u*p,n+=l*p)}return u=e-r,l=i-n,u*u+l*l}function Of(e,i,r,n){var t={id:typeof e=="undefined"?null:e,type:i,geometry:r,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Td(t),t}function Td(e){var i=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Yh(e,i);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<i.length;n++)Yh(e,i[n]);else if(r==="MultiPolygon")for(n=0;n<i.length;n++)for(var t=0;t<i[n].length;t++)Yh(e,i[n][t])}function Yh(e,i){for(var r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function Al(e,i){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)sl(r,e.features[n],i,n);else e.type==="Feature"?sl(r,e,i):sl(r,{geometry:e},i);return r}function sl(e,i,r,n){if(!!i.geometry){var t=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],p=i.id;if(r.promoteId?p=i.properties[r.promoteId]:r.generateId&&(p=n||0),o==="Point")qh(t,l);else if(o==="MultiPoint")for(var v=0;v<t.length;v++)qh(t[v],l);else if(o==="LineString")gh(t,l,u,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(v=0;v<t.length;v++)l=[],gh(t[v],l,u,!1),e.push(Of(p,"LineString",l,i.properties));return}else yh(t,l,u,!1);else if(o==="Polygon")yh(t,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<t.length;v++){var x=[];yh(t[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)sl(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Of(p,o,l,i.properties))}}function qh(e,i){i.push(_h(e[0])),i.push(Rp(e[1])),i.push(0)}function gh(e,i,r,n){for(var t,o,u=0,l=0;l<e.length;l++){var p=_h(e[l][0]),v=Rp(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(t*v-p*o)/2:u+=Math.sqrt(Math.pow(p-t,2)+Math.pow(v-o,2))),t=p,o=v}var x=i.length-3;i[2]=1,Os(i,0,x,r),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function yh(e,i,r,n){for(var t=0;t<e.length;t++){var o=[];gh(e[t],o,r,n),i.push(o)}}function _h(e){return e/360+.5}function Rp(e){var i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function Vo(e,i,r,n,t,o,u,l){if(r/=i,n/=i,o>=r&&u<n)return e;if(u<r||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],S=x.geometry,A=x.type,k=t===0?x.minX:x.minY,D=t===0?x.maxX:x.maxY;if(k>=r&&D<n){p.push(x);continue}else if(D<r||k>=n)continue;var R=[];if(A==="Point"||A==="MultiPoint")Pc(S,R,r,n,t);else if(A==="LineString")Lc(S,R,r,n,t,!1,l.lineMetrics);else if(A==="MultiLineString")Ql(S,R,r,n,t,!1);else if(A==="Polygon")Ql(S,R,r,n,t,!0);else if(A==="MultiPolygon")for(var Z=0;Z<S.length;Z++){var W=[];Ql(S[Z],W,r,n,t,!0),W.length&&R.push(W)}if(R.length){if(l.lineMetrics&&A==="LineString"){for(Z=0;Z<R.length;Z++)p.push(Of(x.id,A,R[Z],x.tags));continue}(A==="LineString"||A==="MultiLineString")&&(R.length===1?(A="LineString",R=R[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=R.length===3?"Point":"MultiPoint"),p.push(Of(x.id,A,R,x.tags))}}return p.length?p:null}function Pc(e,i,r,n,t){for(var o=0;o<e.length;o+=3){var u=e[o+t];u>=r&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Lc(e,i,r,n,t,o,u){for(var l=Ru(e),p=t===0?xh:Dp,v=e.start,x,S,A=0;A<e.length-3;A+=3){var k=e[A],D=e[A+1],R=e[A+2],Z=e[A+3],W=e[A+4],me=t===0?k:D,ge=t===0?Z:W,Ze=!1;u&&(x=Math.sqrt(Math.pow(k-Z,2)+Math.pow(D-W,2))),me<r?ge>r&&(S=p(l,k,D,Z,W,r),u&&(l.start=v+x*S)):me>n?ge<n&&(S=p(l,k,D,Z,W,n),u&&(l.start=v+x*S)):bs(l,k,D,R),ge<r&&me>=r&&(S=p(l,k,D,Z,W,r),Ze=!0),ge>n&&me<=n&&(S=p(l,k,D,Z,W,n),Ze=!0),!o&&Ze&&(u&&(l.end=v+x*S),i.push(l),l=Ru(e)),u&&(v+=x)}var Ve=e.length-3;k=e[Ve],D=e[Ve+1],R=e[Ve+2],me=t===0?k:D,me>=r&&me<=n&&bs(l,k,D,R),Ve=l.length-3,o&&Ve>=3&&(l[Ve]!==l[0]||l[Ve+1]!==l[1])&&bs(l,l[0],l[1],l[2]),l.length&&i.push(l)}function Ru(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function Ql(e,i,r,n,t,o){for(var u=0;u<e.length;u++)Lc(e[u],i,r,n,t,o,!1)}function bs(e,i,r,n){e.push(i),e.push(r),e.push(n)}function xh(e,i,r,n,t,o){var u=(o-i)/(n-i);return e.push(o),e.push(r+(t-r)*u),e.push(1),u}function Dp(e,i,r,n,t,o){var u=(o-r)/(t-r);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function Ss(e,i){var r=i.buffer/i.extent,n=e,t=Vo(e,1,-1-r,r,0,-1,2,i),o=Vo(e,1,1-r,2+r,0,-1,2,i);return(t||o)&&(n=Vo(e,1,-r,1+r,0,-1,2,i)||[],t&&(n=qs(t,1).concat(n)),o&&(n=n.concat(qs(o,-1)))),n}function qs(e,i){for(var r=[],n=0;n<e.length;n++){var t=e[n],o=t.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Za(t.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<t.geometry.length;l++)u.push(Za(t.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<t.geometry.length;l++){for(var p=[],v=0;v<t.geometry[l].length;v++)p.push(Za(t.geometry[l][v],i));u.push(p)}r.push(Of(t.id,o,u,t.tags))}return r}function Za(e,i){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function ws(e,i){if(e.transformed)return e;var r=1<<e.z,n=e.x,t=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(Kh(v[u],v[u+1],i,r,n,t));else for(u=0;u<v.length;u++){var S=[];for(l=0;l<v[u].length;l+=2)S.push(Kh(v[u][l],v[u][l+1],i,r,n,t));p.geometry.push(S)}}return e.transformed=!0,e}function Kh(e,i,r,n,t,o){return[Math.round(r*(e*n-t)),Math.round(r*(i*n-o))]}function Md(e,i,r,n,t){for(var o=i===t.maxZoom?0:t.tolerance/((1<<i)*t.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,kd(u,e[l],o,t);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,S=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),S>u.maxY&&(u.maxY=S)}return u}function kd(e,i,r,n){var t=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<t.length;l+=3)u.push(t[l]),u.push(t[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")bh(u,t,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<t.length;l++)bh(u,t[l],e,r,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<t.length;p++){var v=t[p];for(l=0;l<v.length;l++)bh(u,v[l],e,r,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var S in i.tags)x[S]=i.tags[S];x.mapbox_clip_start=t.start/t.size,x.mapbox_clip_end=t.end/t.size}var A={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(A.id=i.id),e.features.push(A)}}function bh(e,i,r,n,t,o){var u=n*n;if(n>0&&i.size<(t?u:n)){r.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(r.numSimplified++,l.push(i[p]),l.push(i[p+1])),r.numPoints++;t&&rs(l,o),e.push(l)}function rs(e,i){for(var r=0,n=0,t=e.length,o=t-2;n<t;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===i)for(n=0,t=e.length;n<t/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[t-2-n],e[n+1]=e[t-1-n],e[t-2-n]=u,e[t-1-n]=l}}function Op(e,i){return new Ff(e,i)}function Ff(e,i){i=this.options=Id(Object.create(this.options),i);var r=i.debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Al(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Ss(n,i),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Ff.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ff.prototype.splitTile=function(e,i,r,n,t,o,u){for(var l=[e,i,r,n],p=this.options,v=p.debug;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,S=Sh(i,r,n),A=this.tiles[S];if(!A&&(v>1&&console.time("creation"),A=this.tiles[S]=Md(e,i,r,n,p),this.tileCoords.push({z:i,x:r,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var k="z"+i;this.stats[k]=(this.stats[k]||0)+1,this.total++}if(A.source=e,t){if(i===p.maxZoom||i===t)continue;var D=1<<t-i;if(r!==Math.floor(o/D)||n!==Math.floor(u/D))continue}else if(i===p.indexMaxZoom||A.numPoints<=p.indexMaxPoints)continue;if(A.source=null,e.length!==0){v>1&&console.time("clipping");var R=.5*p.buffer/p.extent,Z=.5-R,W=.5+R,me=1+R,ge,Ze,Ve,rt,wt,Ut;ge=Ze=Ve=rt=null,wt=Vo(e,x,r-R,r+W,0,A.minX,A.maxX,p),Ut=Vo(e,x,r+Z,r+me,0,A.minX,A.maxX,p),e=null,wt&&(ge=Vo(wt,x,n-R,n+W,1,A.minY,A.maxY,p),Ze=Vo(wt,x,n+Z,n+me,1,A.minY,A.maxY,p),wt=null),Ut&&(Ve=Vo(Ut,x,n-R,n+W,1,A.minY,A.maxY,p),rt=Vo(Ut,x,n+Z,n+me,1,A.minY,A.maxY,p),Ut=null),v>1&&console.timeEnd("clipping"),l.push(ge||[],i+1,r*2,n*2),l.push(Ze||[],i+1,r*2,n*2+1),l.push(Ve||[],i+1,r*2+1,n*2),l.push(rt||[],i+1,r*2+1,n*2+1)}}},Ff.prototype.getTile=function(e,i,r){var n=this.options,t=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=Sh(e,i,r);if(this.tiles[l])return ws(this.tiles[l],t);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);for(var p=e,v=i,x=r,S;!S&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),S=this.tiles[Sh(p,v,x)];return!S||!S.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(S.source,p,v,x,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[l]?ws(this.tiles[l],t):null)};function Sh(e,i,r){return((1<<e)*r+i)*32+e}function Id(e,i){for(var r in i)e[r]=i[r];return e}var Fp=function(){function e(i,r,n,t){(0,xe.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=i}return(0,K.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Pd={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Bp(e){for(var i=0,r=0,n=e.length,t=n-1,o,u;r<n;t=r++)o=e[r],u=e[t],i+=(u.x-o.x)*(o.y+u.y);return i}function zp(e){var i=e.length;if(i<=1)return[e];for(var r=[],n,t,o=0;o<i;o++){var u=Bp(e[o]);u!==0&&(t===void 0&&(t=u<0),t===u<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var Jh=["Unknown","Point","LineString","Polygon"];function Ld(e,i,r,n,t){var o=t.geometry,u=t.type,l=t.tags,p=t.id,v=e*Math.pow(2,n),x=e*i,S=e*r,A=Jh[u],k,D;function R(me){for(var ge=0;ge<me.length;ge++){var Ze=me[ge];if(Ze[3])break;var Ve=180-(Ze[1]+S)*360/v,rt=(Ze[0]+x)*360/v-180,wt=360/Math.PI*Math.atan(Math.exp(Ve*Math.PI/180))-90;me[ge]=[rt,wt,0,1]}}switch(u){case 1:var Z=[];for(k=0;k<o.length;k++)Z[k]=o[k][0];o=Z,R(o);break;case 2:for(k=0;k<o.length;k++)R(o[k]);break;case 3:for(o=zp(o),k=0;k<o.length;k++)for(D=0;D<o[k].length;D++)R(o[k][D]);break}o.length===1?o=o[0]:A="Multi"+A;var W={type:"Feature",geometry:{type:A,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return W}var Rd=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(r.z,r.x,r.y),x=v?v.features.map(function(k){return Ld(o,t.x,t.y,t.z,k)}):[],S={layers:{defaultLayer:{features:x}}},A=new Fp(S,r.x,r.y,r.z);p(A)}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}();function of(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,O.Z)((0,O.Z)({},i),e.geojsonvtOptions)}function Np(e,i){var r=of(i),n=r.extent||4096,t=Op(e,r),o=function(p,v){return Rd(v,t,p,n)},u=(0,O.Z)((0,O.Z)((0,O.Z)({},Pd),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function B(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,t=new Promise(function(u){e instanceof HTMLImageElement||wf(e)?u([e]):Se(e,function(l){u(l)})}),o={originData:e,images:t,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Se(e,i){var r=e,n=[];if(typeof r=="string")ha({url:r},function(u,l){l&&(n.push(l),i(n))});else{var t=r.length,o=0;r.forEach(function(u){ha({url:u},function(l,p){o++,p&&n.push(p),o===t&&i(n)})})}return B}var ke=N(38929),zt=N(3614),sr=N.n(zt),Dt=function(){function e(i,r,n,t){(0,xe.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=r,this.y=n,this.z=t,this.vectorTile=new ke.VectorTile(new(sr())(i))}return(0,K.Z)(e,[{key:"getTileData",value:function(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];var n=this.vectorTile.layers[r];if(Array.isArray(n.features))return this.vectorLayerCache[r]=n.features,n.features;for(var t=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);t.push((0,O.Z)((0,O.Z)({},l),{},{properties:(0,O.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[r]=t,t}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Xt={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},kr=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o,u){var l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=f(r,n),v.abrupt("return",new Promise(function(x){if(u)u({x:t.x,y:t.y,z:t.z},function(A,k){if(A||!k)x(void 0);else{var D=new Dt(k,t.x,t.y,t.z);x(D)}});else{var S=oo((0,O.Z)((0,O.Z)({},o),{},{url:l}),function(A,k){if(A||!k)x(void 0);else{var D=new Dt(k,t.x,t.y,t.z);x(D)}});t.xhrCancel=function(){return S.cancel()}}}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function Ir(e,i){var r=Array.isArray(e)?e[0]:e,n=function(u,l){return kr(r,u,l,i==null?void 0:i.requestParameters,i==null?void 0:i.getCustomData)},t=(0,O.Z)((0,O.Z)((0,O.Z)({},Xt),i),{},{getTileData:n});return{data:r,dataArray:[],tilesetOptions:t,isTile:!0}}function Or(e,i,r){switch(e){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;case"%":return i%r;case"^":return Math.pow(i,r);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return r===-1?Math.atan(i):Math.atan2(i,r);case"min":return Math.min(i,r);case"max":return Math.max(i,r);case"log10":return Math.log(i);case"log2":return Math.log2(i);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Cr(e,i){for(var r=i[0],n=r.width,t=r.height,o=i.map(function(k){return k.rasterData}),u=n*t,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),S=zr(x,o,v);if(typeof S=="number")l.push(S);else{var A=Er(x);l.push(A)}}return l}function zr(e,i,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,t){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[t]=i[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[t]=0}break;default:zr(n,i,r)}})}function Xr(e){var i=(0,Qr.Z)(e,3),r=i[0],n=i[1],t=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(r===void 0)return console.warn("Express err!"),["+",0,0];var l=r.replace(/\s+/g,"");return[l,t,u]}function Er(e){var i=Xr(e),r=i[0],n=i[1],t=i[2];return Array.isArray(n)&&(n=Er(e[1])),Array.isArray(t)&&(t=Er(e[2])),Or(r,n,t)}var Vr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:St}};function St(e,i){for(var r=e[0].rasterData,n=e[1].rasterData,t=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,Qr.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||Vt(r,p,v),S=(i==null?void 0:i.GMinMax)||Vt(n,p,v),A=(i==null?void 0:i.BMinMax)||Vt(t,p,v),k=0;k<r.length;k++)o.push(Math.max(0,r[k]-x[0])),o.push(Math.max(0,n[k]-S[0])),o.push(Math.max(0,t[k]-A[0]));return{rasterData:o,rMinMax:x,gMinMax:S,bMinMax:A}}function Vt(e,i,r){var n=e.slice().sort(function(l,p){return l-p}),t=n.length,o=n[Math.ceil(t*i/100)],u=n[Math.ceil(t*r/100)];return[o,u]}function Tr(e,i,r){return Kr.apply(this,arguments)}function Kr(){return Kr=(0,Pt.Z)(pe().mark(function e(i,r,n){var t,o,u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(i.length!==0){S.next=2;break}return S.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return S.next=4,Promise.all(i.map(function(A){var k=A.data,D=A.bands,R=D===void 0?[0]:D;return r(k,R)}));case 4:t=S.sent,o=[],t.forEach(function(A){Array.isArray(A)?o.push.apply(o,(0,_r.Z)(A)):o.push(A)}),u=o[0],l=u.width,p=u.height,S.t0=(0,ol.Z)(n),S.next=S.t0==="function"?11:S.t0==="object"?13:15;break;case 11:return v=n(o),S.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:Cr(n,o)}:v=vr(n,o),S.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return S.abrupt("return",(0,O.Z)((0,O.Z)({},v),{},{width:l,height:p}));case 17:case"end":return S.stop()}},e)})),Kr.apply(this,arguments)}function vr(e,i){var r=Vr[e.type];if(r.type==="function")return r.method(i,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?sn(r.expression,i):{rasterData:Cr(r.expression,i)}}function sn(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var r=Cr(e.r||["band",0],i),n=Cr(e.g||["band",0],i),t=Cr(e.b||["band",0],i);return[r,n,t]}function yr(e,i,r,n){return Zr.apply(this,arguments)}function Zr(){return Zr=(0,Pt.Z)(pe().mark(function e(i,r,n,t){var o;return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Tr(i,r,n);case 2:o=l.sent,t(null,{data:o});case 4:case"end":return l.stop()}},e)})),Zr.apply(this,arguments)}function pr(e,i){var r=i.extent,n=i.width,t=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,S;if(l===void 0||Jl(e))v=Array.from(e),x=n,S=t;else{var A=Array.isArray(e)?e:[e];v=Tr(A,l,p)}var k={_id:1,dataArray:[{_id:1,data:v,width:x,height:S,min:o,max:u,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return k}var Ur=N(28660),Nt=N(86700),Fn=N(84879),Ne={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},gr=N(49296),cr=N.n(gr);function Gn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Zn(e,i){if(!!e){if(typeof e=="string")return Sn(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Sn(e,i)}}function Sn(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var hi=30;function ni(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,t=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,S=x===void 0?0:x,A=0,k=v;Array.from(i).forEach(function(R,Z){if(!l[R]){var W=r(R,Z);k+hi>o&&(k=0,A++),l[R]={x:k,y:S+A*hi,width:hi,height:hi,advance:W},k+=hi}});var D=n+t*2;return{mapping:l,xOffset:k,yOffset:S+A*D,canvasHeight:Ua(S+(A+1)*D)}}function vi(e,i,r){var n=0,t=0,o=0,u=[],l={},p=Gn(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var S=x.size;n+S+i>r&&(Fi(l,u,t),n=0,t=o+t+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+S+i,o=Math.max(o,S)}}}catch(k){p.e(k)}finally{p.f()}u.length>0&&Fi(l,u,t);var A=Ua(o+t+i);return{mapping:l,canvasHeight:A}}function Fi(e,i,r){var n=Gn(i),t;try{for(n.s();!(t=n.n()).done;){var o=t.value,u=o.icon,l=o.xOffset;e[u.id]=(0,O.Z)((0,O.Z)({},u),{},{x:l,y:r,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function Ua(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var wo,Si;function ba(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ua(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ua(e,i){if(!!e){if(typeof e=="string")return Wa(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wa(e,i)}}function Wa(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lo(e){var i=Eo();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Eo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Io=De(),Do="sans-serif",$a="normal",pi=24,jo=3,Wi=.25,Un=8,_i=1024,Ii=1,Va=1,Ks=3,Cl=null;function De(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Ft(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Rt(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var vn=(wo=(0,Nt.b2)(),wo(Si=function(e){(0,lt.Z)(r,e);var i=lo(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"fontAtlas",void 0),(0,F.Z)((0,Ie.Z)(n),"iconFontMap",void 0),(0,F.Z)((0,Ie.Z)(n),"iconFontGlyphs",{}),(0,F.Z)((0,Ie.Z)(n),"fontOptions",void 0),(0,F.Z)((0,Ie.Z)(n),"key",void 0),(0,F.Z)((0,Ie.Z)(n),"cache",new qo(Ks)),n}return(0,K.Z)(r,[{key:"scale",get:function(){return Va}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var o=this.cache.get(t);return o&&o.data}},{key:"getMappingByKey",value:function(t){var o=this.cache.get(t);return o&&o.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Do,fontWeight:$a,characterSet:Io,fontSize:pi,buffer:jo,sdf:!0,cutoff:Wi,radius:Un,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var o=this;t.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(t,o){this.iconFontMap.set(t,o)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,O.Z)((0,O.Z)({},this.fontOptions),t),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(t,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(t,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:t})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,S=l.buffer,A=l.sdf,k=l.radius,D=l.cutoff,R=l.iconfont,Z=u&&u.data;Z||(Z=window.document.createElement("canvas"),Z.width=_i);var W=Z.getContext("2d",{willReadFrequently:!0});Ft(W,p,x,v);var me=ni((0,O.Z)({getFontWidth:function(Ho){return W.measureText(Ho).width},fontHeight:x*Va,buffer:S,characterSet:o,maxCanvasWidth:_i},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),ge=me.mapping,Ze=me.canvasHeight,Ve=me.xOffset,rt=me.yOffset,wt=W.getImageData(0,0,Z.width,Z.height);if(Z.height=Ze,W.putImageData(wt,0,0),Ft(W,p,x,v),A){var Ut=new(cr())(x,S,k,D,p,v),Yt=W.getImageData(0,0,Ut.size,Ut.size),mr=ba(o),fr;try{for(mr.s();!(fr=mr.n()).done;){var Wr=fr.value;if(R){var hn=String.fromCharCode(parseInt(Wr.replace("&#x","").replace(";",""),16)),Pn=Ut.draw(hn);Rt(Pn,Yt)}else Rt(Ut.draw(Wr),Yt);W.putImageData(Yt,ge[Wr].x,ge[Wr].y)}}catch(ao){mr.e(ao)}finally{mr.f()}}else{var Vi=ba(o),Da;try{for(Vi.s();!(Da=Vi.n()).done;){var ja=Da.value;W.fillText(ja,ge[ja].x,ge[ja].y+x*Ii)}}catch(ao){Vi.e(ao)}finally{Vi.f()}}return{xOffset:Ve,yOffset:rt,mapping:ge,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){var t=this.fontOptions,o=t.fontFamily,u=t.fontWeight;return"".concat(o,"_").concat(u)}},{key:"getNewChars",value:function(t,o){var u=this.cache.get(t);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(S){v.has(S)||l.push(S)}),l}}]),r}(Ca.EventEmitter))||Si),xi,Ce;function de(e){var i=qe();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mt=3,bt=1024,et=64,Ke=(xi=(0,Nt.b2)(),xi(Ce=function(e){(0,lt.Z)(r,e);var i=de(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"canvasHeight",128),(0,F.Z)((0,Ie.Z)(n),"texture",void 0),(0,F.Z)((0,Ie.Z)(n),"canvas",void 0),(0,F.Z)((0,Ie.Z)(n),"iconData",void 0),(0,F.Z)((0,Ie.Z)(n),"iconMap",void 0),(0,F.Z)((0,Ie.Z)(n),"ctx",void 0),(0,F.Z)((0,Ie.Z)(n),"loadingImageCount",0),n}return(0,K.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u,l){var p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:et}),this.updateIconMap(),S.next=6,this.loadImage(l);case 6:p=S.sent,v=this.iconData.find(function(A){return A.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addImageMini",value:function(t,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:et}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var S=l.iconData.find(function(A){return A.id===t});S&&(S.image=v,S.width=v.width,S.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(function(o){return o.id!==t}),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise(function(o,u){if(t instanceof HTMLImageElement){o(t);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+t))},l.src=t instanceof File?URL.createObjectURL(t):t})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=bt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=t.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,S=x===void 0?64:x,A=u.height,k=A===void 0?64:A,D=Math.max(S,k),R=D/et,Z=k/R,W=S/R;v&&t.ctx.drawImage(v,l+(et-W)/2,p+(et-Z)/2,W,Z)})}},{key:"updateIconMap",value:function(){var t=vi(this.iconData,mt,bt),o=t.mapping,u=t.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(t,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+t))},p.src=t})}}]),r}(Ca.EventEmitter))||Ce),Je=N(49685);function Ae(){var e=new Je.WT(16);return Je.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $e(e){var i=new Je.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Ee(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function vt(e,i,r,n,t,o,u,l,p,v,x,S,A,k,D,R){var Z=new Je.WT(16);return Z[0]=e,Z[1]=i,Z[2]=r,Z[3]=n,Z[4]=t,Z[5]=o,Z[6]=u,Z[7]=l,Z[8]=p,Z[9]=v,Z[10]=x,Z[11]=S,Z[12]=A,Z[13]=k,Z[14]=D,Z[15]=R,Z}function Et(e,i,r,n,t,o,u,l,p,v,x,S,A,k,D,R,Z){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=S,e[11]=A,e[12]=k,e[13]=D,e[14]=R,e[15]=Z,e}function or(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bt(e,i){if(e===i){var r=i[1],n=i[2],t=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=t,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function er(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],k=i[11],D=i[12],R=i[13],Z=i[14],W=i[15],me=r*l-n*u,ge=r*p-t*u,Ze=r*v-o*u,Ve=n*p-t*l,rt=n*v-o*l,wt=t*v-o*p,Ut=x*R-S*D,Yt=x*Z-A*D,mr=x*W-k*D,fr=S*Z-A*R,Wr=S*W-k*R,hn=A*W-k*Z,Pn=me*hn-ge*Wr+Ze*fr+Ve*mr-rt*Yt+wt*Ut;return Pn?(Pn=1/Pn,e[0]=(l*hn-p*Wr+v*fr)*Pn,e[1]=(t*Wr-n*hn-o*fr)*Pn,e[2]=(R*wt-Z*rt+W*Ve)*Pn,e[3]=(A*rt-S*wt-k*Ve)*Pn,e[4]=(p*mr-u*hn-v*Yt)*Pn,e[5]=(r*hn-t*mr+o*Yt)*Pn,e[6]=(Z*Ze-D*wt-W*ge)*Pn,e[7]=(x*wt-A*Ze+k*ge)*Pn,e[8]=(u*Wr-l*mr+v*Ut)*Pn,e[9]=(n*mr-r*Wr-o*Ut)*Pn,e[10]=(D*rt-R*Ze+W*me)*Pn,e[11]=(S*Ze-x*rt-k*me)*Pn,e[12]=(l*Yt-u*fr-p*Ut)*Pn,e[13]=(r*fr-n*Yt+t*Ut)*Pn,e[14]=(R*ge-D*Ve-Z*me)*Pn,e[15]=(x*Ve-S*ge+A*me)*Pn,e):null}function Pr(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],S=i[9],A=i[10],k=i[11],D=i[12],R=i[13],Z=i[14],W=i[15];return e[0]=l*(A*W-k*Z)-S*(p*W-v*Z)+R*(p*k-v*A),e[1]=-(n*(A*W-k*Z)-S*(t*W-o*Z)+R*(t*k-o*A)),e[2]=n*(p*W-v*Z)-l*(t*W-o*Z)+R*(t*v-o*p),e[3]=-(n*(p*k-v*A)-l*(t*k-o*A)+S*(t*v-o*p)),e[4]=-(u*(A*W-k*Z)-x*(p*W-v*Z)+D*(p*k-v*A)),e[5]=r*(A*W-k*Z)-x*(t*W-o*Z)+D*(t*k-o*A),e[6]=-(r*(p*W-v*Z)-u*(t*W-o*Z)+D*(t*v-o*p)),e[7]=r*(p*k-v*A)-u*(t*k-o*A)+x*(t*v-o*p),e[8]=u*(S*W-k*R)-x*(l*W-v*R)+D*(l*k-v*S),e[9]=-(r*(S*W-k*R)-x*(n*W-o*R)+D*(n*k-o*S)),e[10]=r*(l*W-v*R)-u*(n*W-o*R)+D*(n*v-o*l),e[11]=-(r*(l*k-v*S)-u*(n*k-o*S)+x*(n*v-o*l)),e[12]=-(u*(S*Z-A*R)-x*(l*Z-p*R)+D*(l*A-p*S)),e[13]=r*(S*Z-A*R)-x*(n*Z-t*R)+D*(n*A-t*S),e[14]=-(r*(l*Z-p*R)-u*(n*Z-t*R)+D*(n*p-t*l)),e[15]=r*(l*A-p*S)-u*(n*A-t*S)+x*(n*p-t*l),e}function Tn(e){var i=e[0],r=e[1],n=e[2],t=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],S=e[10],A=e[11],k=e[12],D=e[13],R=e[14],Z=e[15],W=i*u-r*o,me=i*l-n*o,ge=i*p-t*o,Ze=r*l-n*u,Ve=r*p-t*u,rt=n*p-t*l,wt=v*D-x*k,Ut=v*R-S*k,Yt=v*Z-A*k,mr=x*R-S*D,fr=x*Z-A*D,Wr=S*Z-A*R;return W*Wr-me*fr+ge*mr+Ze*Yt-Ve*Ut+rt*wt}function Qn(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=i[8],A=i[9],k=i[10],D=i[11],R=i[12],Z=i[13],W=i[14],me=i[15],ge=r[0],Ze=r[1],Ve=r[2],rt=r[3];return e[0]=ge*n+Ze*l+Ve*S+rt*R,e[1]=ge*t+Ze*p+Ve*A+rt*Z,e[2]=ge*o+Ze*v+Ve*k+rt*W,e[3]=ge*u+Ze*x+Ve*D+rt*me,ge=r[4],Ze=r[5],Ve=r[6],rt=r[7],e[4]=ge*n+Ze*l+Ve*S+rt*R,e[5]=ge*t+Ze*p+Ve*A+rt*Z,e[6]=ge*o+Ze*v+Ve*k+rt*W,e[7]=ge*u+Ze*x+Ve*D+rt*me,ge=r[8],Ze=r[9],Ve=r[10],rt=r[11],e[8]=ge*n+Ze*l+Ve*S+rt*R,e[9]=ge*t+Ze*p+Ve*A+rt*Z,e[10]=ge*o+Ze*v+Ve*k+rt*W,e[11]=ge*u+Ze*x+Ve*D+rt*me,ge=r[12],Ze=r[13],Ve=r[14],rt=r[15],e[12]=ge*n+Ze*l+Ve*S+rt*R,e[13]=ge*t+Ze*p+Ve*A+rt*Z,e[14]=ge*o+Ze*v+Ve*k+rt*W,e[15]=ge*u+Ze*x+Ve*D+rt*me,e}function gn(e,i,r){var n=r[0],t=r[1],o=r[2],u,l,p,v,x,S,A,k,D,R,Z,W;return i===e?(e[12]=i[0]*n+i[4]*t+i[8]*o+i[12],e[13]=i[1]*n+i[5]*t+i[9]*o+i[13],e[14]=i[2]*n+i[6]*t+i[10]*o+i[14],e[15]=i[3]*n+i[7]*t+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],S=i[5],A=i[6],k=i[7],D=i[8],R=i[9],Z=i[10],W=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=S,e[6]=A,e[7]=k,e[8]=D,e[9]=R,e[10]=Z,e[11]=W,e[12]=u*n+x*t+D*o+i[12],e[13]=l*n+S*t+R*o+i[13],e[14]=p*n+A*t+Z*o+i[14],e[15]=v*n+k*t+W*o+i[15]),e}function zn(e,i,r){var n=r[0],t=r[1],o=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function oi(e,i,r,n){var t=n[0],o=n[1],u=n[2],l=Math.hypot(t,o,u),p,v,x,S,A,k,D,R,Z,W,me,ge,Ze,Ve,rt,wt,Ut,Yt,mr,fr,Wr,hn,Pn,Vi;return l<Je.Ib?null:(l=1/l,t*=l,o*=l,u*=l,p=Math.sin(r),v=Math.cos(r),x=1-v,S=i[0],A=i[1],k=i[2],D=i[3],R=i[4],Z=i[5],W=i[6],me=i[7],ge=i[8],Ze=i[9],Ve=i[10],rt=i[11],wt=t*t*x+v,Ut=o*t*x+u*p,Yt=u*t*x-o*p,mr=t*o*x-u*p,fr=o*o*x+v,Wr=u*o*x+t*p,hn=t*u*x+o*p,Pn=o*u*x-t*p,Vi=u*u*x+v,e[0]=S*wt+R*Ut+ge*Yt,e[1]=A*wt+Z*Ut+Ze*Yt,e[2]=k*wt+W*Ut+Ve*Yt,e[3]=D*wt+me*Ut+rt*Yt,e[4]=S*mr+R*fr+ge*Wr,e[5]=A*mr+Z*fr+Ze*Wr,e[6]=k*mr+W*fr+Ve*Wr,e[7]=D*mr+me*fr+rt*Wr,e[8]=S*hn+R*Pn+ge*Vi,e[9]=A*hn+Z*Pn+Ze*Vi,e[10]=k*hn+W*Pn+Ve*Vi,e[11]=D*hn+me*Pn+rt*Vi,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Bi(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*t+v*n,e[5]=u*t+x*n,e[6]=l*t+S*n,e[7]=p*t+A*n,e[8]=v*t-o*n,e[9]=x*t-u*n,e[10]=S*t-l*n,e[11]=A*t-p*n,e}function Ia(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],S=i[10],A=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t-v*n,e[1]=u*t-x*n,e[2]=l*t-S*n,e[3]=p*t-A*n,e[8]=o*n+v*t,e[9]=u*n+x*t,e[10]=l*n+S*t,e[11]=p*n+A*t,e}function ns(e,i,r){var n=Math.sin(r),t=Math.cos(r),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],S=i[6],A=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*t+v*n,e[1]=u*t+x*n,e[2]=l*t+S*n,e[3]=p*t+A*n,e[4]=v*t-o*n,e[5]=x*t-u*n,e[6]=S*t-l*n,e[7]=A*t-p*n,e}function Bf(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Js(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qh(e,i,r){var n=r[0],t=r[1],o=r[2],u=Math.hypot(n,t,o),l,p,v;return u<Je.Ib?null:(u=1/u,n*=u,t*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=t*n*v+o*l,e[2]=o*n*v-t*l,e[3]=0,e[4]=n*t*v-o*l,e[5]=t*t*v+p,e[6]=o*t*v+n*l,e[7]=0,e[8]=n*o*v+t*l,e[9]=t*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function du(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zf(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nf(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zp(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3],l=n+n,p=t+t,v=o+o,x=n*l,S=n*p,A=n*v,k=t*p,D=t*v,R=o*v,Z=u*l,W=u*p,me=u*v;return e[0]=1-(k+R),e[1]=S+me,e[2]=A-W,e[3]=0,e[4]=S-me,e[5]=1-(x+R),e[6]=D+Z,e[7]=0,e[8]=A+W,e[9]=D-Z,e[10]=1-(x+k),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function wh(e,i){var r=new Je.WT(3),n=-i[0],t=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],S=n*n+t*t+o*o+u*u;return S>0?(r[0]=(l*u+x*n+p*o-v*t)*2/S,r[1]=(p*u+x*t+v*n-l*o)*2/S,r[2]=(v*u+x*o+l*t-p*n)*2/S):(r[0]=(l*u+x*n+p*o-v*t)*2,r[1]=(p*u+x*t+v*n-l*o)*2,r[2]=(v*u+x*o+l*t-p*n)*2),Zp(e,i,r),e}function Vv(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function co(e,i){var r=i[0],n=i[1],t=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(r,n,t),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function Sa(e,i){var r=new Je.WT(3);co(r,i);var n=1/r[0],t=1/r[1],o=1/r[2],u=i[0]*n,l=i[1]*t,p=i[2]*o,v=i[4]*n,x=i[5]*t,S=i[6]*o,A=i[8]*n,k=i[9]*t,D=i[10]*o,R=u+x+D,Z=0;return R>0?(Z=Math.sqrt(R+1)*2,e[3]=.25*Z,e[0]=(S-k)/Z,e[1]=(A-p)/Z,e[2]=(l-v)/Z):u>x&&u>D?(Z=Math.sqrt(1+u-x-D)*2,e[3]=(S-k)/Z,e[0]=.25*Z,e[1]=(l+v)/Z,e[2]=(A+p)/Z):x>D?(Z=Math.sqrt(1+x-u-D)*2,e[3]=(A-p)/Z,e[0]=(l+v)/Z,e[1]=.25*Z,e[2]=(S+k)/Z):(Z=Math.sqrt(1+D-u-x)*2,e[3]=(l-v)/Z,e[0]=(A+p)/Z,e[1]=(S+k)/Z,e[2]=.25*Z),e}function jv(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3],p=t+t,v=o+o,x=u+u,S=t*p,A=t*v,k=t*x,D=o*v,R=o*x,Z=u*x,W=l*p,me=l*v,ge=l*x,Ze=n[0],Ve=n[1],rt=n[2];return e[0]=(1-(D+Z))*Ze,e[1]=(A+ge)*Ze,e[2]=(k-me)*Ze,e[3]=0,e[4]=(A-ge)*Ve,e[5]=(1-(S+Z))*Ve,e[6]=(R+W)*Ve,e[7]=0,e[8]=(k+me)*rt,e[9]=(R-W)*rt,e[10]=(1-(S+D))*rt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Gv(e,i,r,n,t){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,S=l+l,A=o*v,k=o*x,D=o*S,R=u*x,Z=u*S,W=l*S,me=p*v,ge=p*x,Ze=p*S,Ve=n[0],rt=n[1],wt=n[2],Ut=t[0],Yt=t[1],mr=t[2],fr=(1-(R+W))*Ve,Wr=(k+Ze)*Ve,hn=(D-ge)*Ve,Pn=(k-Ze)*rt,Vi=(1-(A+W))*rt,Da=(Z+me)*rt,ja=(D+ge)*wt,ao=(Z-me)*wt,Ho=(1-(A+R))*wt;return e[0]=fr,e[1]=Wr,e[2]=hn,e[3]=0,e[4]=Pn,e[5]=Vi,e[6]=Da,e[7]=0,e[8]=ja,e[9]=ao,e[10]=Ho,e[11]=0,e[12]=r[0]+Ut-(fr*Ut+Pn*Yt+ja*mr),e[13]=r[1]+Yt-(Wr*Ut+Vi*Yt+ao*mr),e[14]=r[2]+mr-(hn*Ut+Da*Yt+Ho*mr),e[15]=1,e}function Hv(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r+r,l=n+n,p=t+t,v=r*u,x=n*u,S=n*l,A=t*u,k=t*l,D=t*p,R=o*u,Z=o*l,W=o*p;return e[0]=1-S-D,e[1]=x+W,e[2]=A-Z,e[3]=0,e[4]=x-W,e[5]=1-v-D,e[6]=k+R,e[7]=0,e[8]=A+Z,e[9]=k-R,e[10]=1-v-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Wv(e,i,r,n,t,o,u){var l=1/(r-i),p=1/(t-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(r+i)*l,e[9]=(t+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function Dd(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=(t+n)*u,e[14]=2*t*n*u):(e[10]=-1,e[14]=-2*n),e}var Up=Dd;function Zf(e,i,r,n,t){var o=1/Math.tan(i/2),u;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,t!=null&&t!==Infinity?(u=1/(n-t),e[10]=t*u,e[14]=t*n*u):(e[10]=-1,e[14]=-n),e}function Uf(e,i,r,n){var t=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(t+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(t-o)*v*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Od(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=(u+o)*v,e[15]=1,e}var Ao=Od;function ep(e,i,r,n,t,o,u){var l=1/(i-r),p=1/(n-t),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+r)*l,e[13]=(t+n)*p,e[14]=o*v,e[15]=1,e}function Rc(e,i,r,n){var t,o,u,l,p,v,x,S,A,k,D=i[0],R=i[1],Z=i[2],W=n[0],me=n[1],ge=n[2],Ze=r[0],Ve=r[1],rt=r[2];return Math.abs(D-Ze)<Je.Ib&&Math.abs(R-Ve)<Je.Ib&&Math.abs(Z-rt)<Je.Ib?or(e):(x=D-Ze,S=R-Ve,A=Z-rt,k=1/Math.hypot(x,S,A),x*=k,S*=k,A*=k,t=me*A-ge*S,o=ge*x-W*A,u=W*S-me*x,k=Math.hypot(t,o,u),k?(k=1/k,t*=k,o*=k,u*=k):(t=0,o=0,u=0),l=S*u-A*o,p=A*t-x*u,v=x*o-S*t,k=Math.hypot(l,p,v),k?(k=1/k,l*=k,p*=k,v*=k):(l=0,p=0,v=0),e[0]=t,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=S,e[7]=0,e[8]=u,e[9]=v,e[10]=A,e[11]=0,e[12]=-(t*D+o*R+u*Z),e[13]=-(l*D+p*R+v*Z),e[14]=-(x*D+S*R+A*Z),e[15]=1,e)}function Vp(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=t-r[0],S=o-r[1],A=u-r[2],k=x*x+S*S+A*A;k>0&&(k=1/Math.sqrt(k),x*=k,S*=k,A*=k);var D=p*A-v*S,R=v*x-l*A,Z=l*S-p*x;return k=D*D+R*R+Z*Z,k>0&&(k=1/Math.sqrt(k),D*=k,R*=k,Z*=k),e[0]=D,e[1]=R,e[2]=Z,e[3]=0,e[4]=S*Z-A*R,e[5]=A*D-x*Z,e[6]=x*R-S*D,e[7]=0,e[8]=x,e[9]=S,e[10]=A,e[11]=0,e[12]=t,e[13]=o,e[14]=u,e[15]=1,e}function jp(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Fd(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Eh(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function ec(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function $v(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Xv(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function $m(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Co(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],S=e[9],A=e[10],k=e[11],D=e[12],R=e[13],Z=e[14],W=e[15],me=i[0],ge=i[1],Ze=i[2],Ve=i[3],rt=i[4],wt=i[5],Ut=i[6],Yt=i[7],mr=i[8],fr=i[9],Wr=i[10],hn=i[11],Pn=i[12],Vi=i[13],Da=i[14],ja=i[15];return Math.abs(r-me)<=Je.Ib*Math.max(1,Math.abs(r),Math.abs(me))&&Math.abs(n-ge)<=Je.Ib*Math.max(1,Math.abs(n),Math.abs(ge))&&Math.abs(t-Ze)<=Je.Ib*Math.max(1,Math.abs(t),Math.abs(Ze))&&Math.abs(o-Ve)<=Je.Ib*Math.max(1,Math.abs(o),Math.abs(Ve))&&Math.abs(u-rt)<=Je.Ib*Math.max(1,Math.abs(u),Math.abs(rt))&&Math.abs(l-wt)<=Je.Ib*Math.max(1,Math.abs(l),Math.abs(wt))&&Math.abs(p-Ut)<=Je.Ib*Math.max(1,Math.abs(p),Math.abs(Ut))&&Math.abs(v-Yt)<=Je.Ib*Math.max(1,Math.abs(v),Math.abs(Yt))&&Math.abs(x-mr)<=Je.Ib*Math.max(1,Math.abs(x),Math.abs(mr))&&Math.abs(S-fr)<=Je.Ib*Math.max(1,Math.abs(S),Math.abs(fr))&&Math.abs(A-Wr)<=Je.Ib*Math.max(1,Math.abs(A),Math.abs(Wr))&&Math.abs(k-hn)<=Je.Ib*Math.max(1,Math.abs(k),Math.abs(hn))&&Math.abs(D-Pn)<=Je.Ib*Math.max(1,Math.abs(D),Math.abs(Pn))&&Math.abs(R-Vi)<=Je.Ib*Math.max(1,Math.abs(R),Math.abs(Vi))&&Math.abs(Z-Da)<=Je.Ib*Math.max(1,Math.abs(Z),Math.abs(Da))&&Math.abs(W-ja)<=Je.Ib*Math.max(1,Math.abs(W),Math.abs(ja))}var sf=Qn,Yv=ec,a,s,c=(a=(0,Nt.b2)(),a(s=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"viewport",void 0),(0,F.Z)(this,"overridedViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredProjectionMatrix",void 0),(0,F.Z)(this,"viewMatrixInverse",void 0),(0,F.Z)(this,"cameraPosition",void 0)}return(0,K.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Ae(),er(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Qr.Z)(r,2),t=n[0],o=n[1];return[t,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var t=Bf(Ae(),[r,n,0]);this.jitteredProjectionMatrix=Qn(Ae(),t,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Qn(Ae(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||s),m=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),_,b;function E(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=M(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function M(e,i){if(!!e){if(typeof e=="string")return P(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,i)}}function P(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var z={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},j=(_=(0,Nt.b2)(),_(b=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"controlCorners",void 0),(0,F.Z)(this,"controlContainer",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"controls",[]),(0,F.Z)(this,"unAddControls",[])}return(0,K.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ne.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var t=n.get(Ne.IMapService);t.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=E(this.controls),n;try{for(r.s();!(n=r.n()).done;){var t=n.value;t.remove()}}catch(o){r.e(o)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",t=this.controlContainer=Ci("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");r[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=Ci("div",p,t)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,_r.Z)(p),[z[l]])}Object.values(m).forEach(function(l){o(u(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&Ei(this.controlCorners[r]);this.controlContainer&&Ei(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var r=this,n=window.MutationObserver;if(!!n)for(var t=function(){var p=u[o],v=p.match(/^(top|bottom)(left|right)$/);if(v){var x=(0,Qr.Z)(v,3),S=x[1],A=x[2],k=r.controlCorners["".concat(S).concat(A)],D=new n(function(R){var Z=(0,Qr.Z)(R,1),W=Z[0].target;k&&(k.style[S]=W.clientHeight+"px")});D.observe(r.controlCorners["".concat(A).concat(S)],{childList:!0,attributes:!0})}},o=0,u=Object.keys(this.controlCorners);o<u.length;o++)t()}}]),e}())||b),H,ee,se=(H=(0,Nt.b2)(),H(ee=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"markers",[]),(0,F.Z)(this,"markerLayers",[]),(0,F.Z)(this,"unAddMarkers",[]),(0,F.Z)(this,"unAddMarkerLayers",[])}return(0,K.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ne.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ee),Re,Be,tt=(Re=(0,Nt.b2)(),Re(Be=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"popups",[]),(0,F.Z)(this,"unAddPopups",[])}return(0,K.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(r){r!=null&&r.isOpen()&&r.remove();var n=this.popups.indexOf(r);n>-1&&this.popups.splice(n,1);var t=this.unAddPopups.indexOf(r);t>-1&&this.unAddPopups.splice(t,1)}},{key:"destroy",value:function(){this.popups.forEach(function(r){return r.remove()})}},{key:"addPopup",value:function(r){var n=this;r&&r.getOptions().autoClose&&[].concat((0,_r.Z)(this.popups),(0,_r.Z)(this.unAddPopups)).forEach(function(t){t.getOptions().autoClose&&n.removePopup(t)}),this.isMarkerReady?(r.addTo(this.scene),this.popups.push(r)):this.unAddPopups.push(r),r.on("close",function(){n.removePopup(r)})}},{key:"initPopup",value:function(){var r=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){r.addPopup(n),r.unAddPopups=[]})}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ne.IMapService)}}]),e}())||Be),Ge=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),dt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),kt=function(e){return e.AND="and",e.OR="or",e}({}),Lt=function(e){return e.INIT="init",e.UPDATE="update",e}({}),$t={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ur=$t,Fr,Yr,Rn=ei.merge,on={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Bn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:kt.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},un=(Fr=(0,Nt.b2)(),Fr(Yr=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"sceneConfigCache",{}),(0,F.Z)(this,"layerConfigCache",{}),(0,F.Z)(this,"layerAttributeConfigCache",{})}return(0,K.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ur[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=(0,O.Z)((0,O.Z)({},on),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,t){this.layerConfigCache[n]=(0,O.Z)({},Rn({},this.sceneConfigCache[r],Bn,t))}},{key:"getAttributeConfig",value:function(r){return this.layerAttributeConfigCache[r]}},{key:"setAttributeConfig",value:function(r,n){this.layerAttributeConfigCache[r]=(0,O.Z)((0,O.Z)({},this.layerAttributeConfigCache[r]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Yr);function nn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function jr(e,i,r,n,t){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),t&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(t):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function An(){var e=new Je.WT(4);return Je.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ti(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function di(e,i,r,n){var t=new Je.WT(4);return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Ni(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Nn(e,i,r,n,t){return e[0]=i,e[1]=r,e[2]=n,e[3]=t,e}function $i(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Pa(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ro(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Xa(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function La(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function no(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Oo(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Fo(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Es(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Bo(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function As(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function fo(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return Math.hypot(r,n,t,o)}function Go(e,i){var r=i[0]-e[0],n=i[1]-e[1],t=i[2]-e[2],o=i[3]-e[3];return r*r+n*n+t*t+o*o}function Ri(e){var i=e[0],r=e[1],n=e[2],t=e[3];return Math.hypot(i,r,n,t)}function la(e){var i=e[0],r=e[1],n=e[2],t=e[3];return i*i+r*r+n*n+t*t}function ra(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function Ui(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Fs(e,i){var r=i[0],n=i[1],t=i[2],o=i[3],u=r*r+n*n+t*t+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=t*u,e[3]=o*u,e}function hs(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function wa(e,i,r,n){var t=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],l=r[1]*n[2]-r[2]*n[1],p=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],x=i[0],S=i[1],A=i[2],k=i[3];return e[0]=S*v-A*p+k*l,e[1]=-(x*v)+A*u-k*o,e[2]=x*p-S*u+k*t,e[3]=-(x*l)+S*o-A*t,e}function To(e,i,r,n){var t=i[0],o=i[1],u=i[2],l=i[3];return e[0]=t+n*(r[0]-t),e[1]=o+n*(r[1]-o),e[2]=u+n*(r[2]-u),e[3]=l+n*(r[3]-l),e}function ps(e,i){i=i||1;var r,n,t,o,u,l;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=r*r+n*n;while(u>=1);do t=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=t*t+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*t*p,e[3]=i*o*p,e}function Zi(e,i,r){var n=i[0],t=i[1],o=i[2],u=i[3];return e[0]=r[0]*n+r[4]*t+r[8]*o+r[12]*u,e[1]=r[1]*n+r[5]*t+r[9]*o+r[13]*u,e[2]=r[2]*n+r[6]*t+r[10]*o+r[14]*u,e[3]=r[3]*n+r[7]*t+r[11]*o+r[15]*u,e}function Dc(e,i,r){var n=i[0],t=i[1],o=i[2],u=r[0],l=r[1],p=r[2],v=r[3],x=v*n+l*o-p*t,S=v*t+p*n-u*o,A=v*o+u*t-l*n,k=-u*n-l*t-p*o;return e[0]=x*v+k*-u+S*-p-A*-l,e[1]=S*v+k*-l+A*-u-x*-p,e[2]=A*v+k*-p+x*-l-S*-u,e[3]=i[3],e}function Du(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Oc(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ho(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Fc(e,i){var r=e[0],n=e[1],t=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(r-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(t-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var Tl=null,tp=null,Ah=null,rp=null,uf=null,np=null,Bd=null,ip=function(){var e=An();return function(i,r,n,t,o,u){var l,p;for(r||(r=4),n||(n=0),t?p=Math.min(t*r+n,i.length):p=i.length,l=n;l<p;l+=r)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),Vf=Math.PI/180,Gp=512,ap=4003e4;function tc(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,t=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,t);var x={},S=Gp*o,A=Math.cos(r*Vf),k=S/360,D=k/A,R=S/ap/A;if(x.pixelsPerMeter=[R,-R,R],x.metersPerPixel=[1/R,-1/R,1/R],x.pixelsPerDegree=[k,-D,R],x.degreesPerPixel=[1/k,-1/D,1/R],l){var Z=Vf*Math.tan(r*Vf)/A,W=k*Z/2,me=S/ap*Z,ge=me/D*R;x.pixelsPerDegree2=[0,-W,me],x.pixelsPerMeter2=[ge,0,ge],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var rc=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),ul={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Bc,jf,op,Ch,Th,sp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Hp=(Bc=(0,Nt.b2)(),jf=(0,Nt.f3)(Ne.ICameraService),Bc(op=(Ch=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"needRefresh",!0),nn(this,"cameraService",Th,this),(0,F.Z)(this,"coordinateSystem",void 0),(0,F.Z)(this,"viewportCenter",void 0),(0,F.Z)(this,"viewportCenterProjection",void 0),(0,F.Z)(this,"pixelsPerDegree",void 0),(0,F.Z)(this,"pixelsPerDegree2",void 0),(0,F.Z)(this,"pixelsPerMeter",void 0)}return(0,K.Z)(e,[{key:"refresh",value:function(r){var n=this.cameraService.getZoom(),t=this.cameraService.getZoomScale(),o=r||this.cameraService.getCenter(),u=tc({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===rc.LNGLAT||this.coordinateSystem===rc.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===rc.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===rc.P20_OFFSET&&this.calculateLnglatOffset(o,n,t,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,t,o){var u=tc({latitude:r[1],zoom:n,scale:t,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),S=this.cameraService.getProjectionMatrix(),A=Qn([],S,x),k=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Zi([],[k[0],k[1],0,1],A),x=this.cameraService.getViewMatrixUncentered()||x,A=Qn([],S,x),A=Qn([],A,sp),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),Th=jr(Ch.prototype,"cameraService",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch))||op),Mh,kh;function up(e){var i=Wp();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Wp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ih=(Mh=(0,Nt.b2)(),Mh(kh=function(e){(0,lt.Z)(r,e);var i=up(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"renderMap",new Map),(0,F.Z)((0,Ie.Z)(n),"enable",!1),(0,F.Z)((0,Ie.Z)(n),"renderEnable",!1),(0,F.Z)((0,Ie.Z)(n),"cacheLogs",{}),n}return(0,K.Z)(r,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,o){var u=this;if(!!this.enable){var l=t.split("."),p=null;l.forEach(function(v,x){p!==null?(p[v]||(p[v]={}),x!==l.length-1&&(p=p[v])):(u.cacheLogs[v]||(u.cacheLogs[v]={}),x!==l.length-1&&(p=u.cacheLogs[v])),x===l.length-1&&(p[v]=(0,O.Z)((0,O.Z)({time:Date.now()},p[v]),o))})}}},{key:"getLog",value:function(t){var o=this;switch((0,ol.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map(function(u){return o.cacheLogs[u]}).filter(function(u){return u!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Cu():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t)||{};this.renderMap.set(t,(0,O.Z)((0,O.Z)({},o),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(!(!this.renderEnable||!this.enable)){var o=this.renderMap.get(t);if(o){var u=o.renderStart,l=Date.now();this.emit("renderEnd",(0,O.Z)((0,O.Z)({},o),{},{renderEnd:l,renderDuration:l-u})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),r}(Ca.EventEmitter))||kh),$p=N(50840),nc=N.n($p),is=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),lf,Ph,Gf,lp,zd;function Nd(e){var i=qv();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function qv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zd={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Xm=(lf=(0,Nt.b2)(),Ph=(0,Nt.f3)(Ne.IMapService),lf(Gf=(lp=function(e){(0,lt.Z)(r,e);var i=Nd(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"indragging",!1),nn((0,Ie.Z)(n),"mapService",zd,(0,Ie.Z)(n)),(0,F.Z)((0,Ie.Z)(n),"hammertime",void 0),(0,F.Z)((0,Ie.Z)(n),"lastClickTime",0),(0,F.Z)((0,Ie.Z)(n),"lastClickXY",[-1,-1]),(0,F.Z)((0,Ie.Z)(n),"clickTimer",void 0),(0,F.Z)((0,Ie.Z)(n),"$containter",void 0),(0,F.Z)((0,Ie.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=Zd[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(is.Drag,p)}),(0,F.Z)((0,Ie.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(is.Hover,p)}),(0,F.Z)((0,Ie.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,F.Z)((0,Ie.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,S=v,A=l.type,k=n.mapService.getMapContainer();if(k){var D=k.getBoundingClientRect(),R=D.top,Z=D.left;x=x-Z-k.clientLeft,S=S-R-k.clientTop}var W=n.mapService.containerToLngLat([x,S]);if(A==="click"){n.isDoubleTap(x,S,W);return}if(A==="touch"){n.isDoubleTap(x,S,W);return}A!=="click"&&A!=="dblclick"&&n.emit(is.Hover,{x,y:S,lngLat:W,type:A,target:l})}),n}return(0,K.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(is.Hover)}},{key:"triggerHover",value:function(t){var o=t.x,u=t.y;this.emit(is.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(t){this.emit(is.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(is.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t){var o=new(nc()).Manager(t);o.add(new(nc()).Tap({event:"dblclick",taps:2})),o.add(new(nc()).Tap({event:"click"})),o.add(new(nc()).Pan({threshold:0,pointers:0})),o.add(new(nc()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(t){var o=t.type,u=t.pointerType,l,p;u==="touch"?(p=Math.floor(t.pointers[0].clientY),l=Math.floor(t.pointers[0].clientX)):(p=Math.floor(t.srcEvent.y),l=Math.floor(t.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),S=x.top,A=x.left;l-=A,p-=S}var k=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:k,type:o,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(is.Hover,{x:t,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[t,o],this.clickTimer=setTimeout(function(){v="click",l.emit(is.Hover,{x:t,y:o,lngLat:u,type:v})},400))}}]),r}(Hs()),zd=jr(lp.prototype,"mapService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp))||Gf),cp=0;function io(e){var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(cp++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Ml(e){var i,r=!0;if((e==null||(i=e.target)===null||i===void 0?void 0:i.target)instanceof HTMLElement)for(var n,t=e==null||(n=e.target)===null||n===void 0?void 0:n.target;t;){var o,u=Array.from(t.classList);if(u.includes("l7-marker")||u.includes("l7-popup")){r=!1;break}t=(o=t)===null||o===void 0?void 0:o.parentElement}return r}var q=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),zc,Xp,Ud,fp,kl,hp,Lh,ic,pp,Yp,Vd,Rh,jd,Kv=(zc=(0,Nt.b2)(),Xp=(0,Nt.f3)(Ne.IMapService),Ud=(0,Nt.f3)(Ne.IRendererService),fp=(0,Nt.f3)(Ne.IGlobalConfigService),kl=(0,Nt.f3)(Ne.IInteractionService),hp=(0,Nt.f3)(Ne.ILayerService),zc(Lh=(ic=function(){function e(){var i=this;(0,xe.Z)(this,e),(0,F.Z)(this,"pickedColors",void 0),(0,F.Z)(this,"pickedTileLayers",[]),nn(this,"mapService",pp,this),nn(this,"rendererService",Yp,this),nn(this,"configService",Vd,this),nn(this,"interactionService",Rh,this),nn(this,"layerService",jd,this),(0,F.Z)(this,"pickingFBO",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0),(0,F.Z)(this,"alreadyInPicking",!1),(0,F.Z)(this,"pickBufferScale",1),(0,F.Z)(this,"pickFromPickingFBO",function(r,n){var t=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,S=x.readPixels,A=x.getContainer,k=i.getContainerSize(A()),D=k.width,R=k.height;D*=ea,R*=ea;var Z=r.getLayerConfig(),W=Z.enableHighlight,me=Z.enableSelect,ge=t*ea,Ze=o*ea;if(ge>D-1*ea||ge<0||Ze>R-1*ea||Ze<0)return!1;var Ve=S({x:Math.floor(ge/i.pickBufferScale),y:Math.floor((R-(o+1)*ea)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=Ve,Ve[0]!==0||Ve[1]!==0||Ve[2]!==0){var rt=oa(Ve),wt=r.layerPickService.getFeatureById(rt);rt!==r.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Ut={x:t,y:o,type:l,lngLat:u,featureId:rt,feature:wt,target:p};wt&&(v=!0,r.setCurrentPickId(rt),i.triggerHoverOnLayer(r,Ut))}else{var Yt={x:t,y:o,lngLat:u,type:r.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(r,(0,O.Z)((0,O.Z)({},Yt),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Yt),r.setCurrentPickId(null)}if(W&&r.layerPickService.highlightPickedFeature(Ve),me&&l==="click"&&(Ve==null?void 0:Ve.toString())!==[0,0,0,0].toString()){var mr=oa(Ve);r.getCurrentSelectedId()===null||mr!==r.getCurrentSelectedId()?(r.layerPickService.selectFeature(Ve),r.setCurrentSelectedId(mr)):(r.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return v})}return(0,K.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,t=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=ea,v*=ea,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=o({color:t({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(is.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t,o,u){var l=this,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels({ispick:!0}),t.hooks.afterPickingEncode.call();var k=l.pickBox(t,o);u(k)});case 3:case"end":return A.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var t=this,o=n.map(function(mr){var fr=mr<0?0:mr;return Math.floor(fr*ea/t.pickBufferScale)}),u=(0,Qr.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],S=this.rendererService,A=S.readPixels,k=S.getContainer,D=this.getContainerSize(k()),R=D.width,Z=D.height;if(R*=ea,Z*=ea,l>(R-1)*ea/this.pickBufferScale||v<0||p>(Z-1)*ea/this.pickBufferScale||x<0)return[];for(var W=Math.min(R/this.pickBufferScale,v)-l,me=Math.min(Z/this.pickBufferScale,x)-p,ge=A({x:l,y:Math.floor(Z/this.pickBufferScale-(x+1)),width:W,height:me,data:new Uint8Array(W*me*4),framebuffer:this.pickingFBO}),Ze=[],Ve={},rt=0;rt<ge.length/4;rt=rt+1){var wt=ge.slice(rt*4,rt*4+4),Ut=oa(wt);if(Ut!==-1&&!Ve[Ut]){var Yt=r.layerPickService.getFeatureById(Ut);Ze.push((0,O.Z)((0,O.Z)({},Yt),{},{pickedFeatureIdx:Ut})),Ve[Ut]=!0}}return Ze}},{key:"handleCursor",value:function(r,n){var t=r.getLayerConfig(),o=t.cursor,u=o===void 0?"":o,l=t.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ea,height:r.height/ea}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(t.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),t=n.width,o=n.height;t*=ea,o*=ea,(this.width!==t||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=t,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){var o=this,u,l,p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var S=o.layerService.getRenderList();S.filter(function(A){return A.needPick(t.type)}).reverse().some(function(A){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(t);var k=o.pickFromPickingFBO(A,t);return o.layerService.pickedLayerId=k?+A.id:-1,k&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Ml(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}}]),e}(),pp=jr(ic.prototype,"mapService",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=jr(ic.prototype,"rendererService",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=jr(ic.prototype,"configService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rh=jr(ic.prototype,"interactionService",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=jr(ic.prototype,"layerService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ic))||Lh),Jv=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,xe.Z)(this,e),(0,F.Z)(this,"autoStart",void 0),(0,F.Z)(this,"startTime",0),(0,F.Z)(this,"oldTime",0),(0,F.Z)(this,"running",!1),(0,F.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,K.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Gd,Hd,Qs,dp,Wd,vu,Qv,$d,cf;function ff(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Dh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Dh(e,i){if(!!e){if(typeof e=="string")return Hf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hf(e,i)}}function Hf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Oh(e){var i=em();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function em(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xd=ei.throttle,tm=(Gd=(0,Nt.b2)(),Hd=(0,Nt.f3)(Ne.IRendererService),Qs=(0,Nt.f3)(Ne.IMapService),dp=(0,Nt.f3)(Ne.IDebugService),Gd(Wd=(vu=function(e){(0,lt.Z)(r,e);var i=Oh(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"pickedLayerId",-1),(0,F.Z)((0,Ie.Z)(n),"clock",new Jv),(0,F.Z)((0,Ie.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Ie.Z)(n),"layers",[]),(0,F.Z)((0,Ie.Z)(n),"layerList",[]),(0,F.Z)((0,Ie.Z)(n),"layerRenderID",void 0),(0,F.Z)((0,Ie.Z)(n),"sceneInited",!1),(0,F.Z)((0,Ie.Z)(n),"animateInstanceCount",0),(0,F.Z)((0,Ie.Z)(n),"shaderPicking",!0),(0,F.Z)((0,Ie.Z)(n),"enableRender",!0),nn((0,Ie.Z)(n),"renderService",Qv,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"mapService",$d,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"debugService",cf,(0,Ie.Z)(n)),(0,F.Z)((0,Ie.Z)(n),"reRender",Xd(function(){n.renderLayers()},32)),(0,F.Z)((0,Ie.Z)(n),"throttleRenderLayers",Xd(function(){n.renderLayers()},16)),n}return(0,K.Z)(r,[{key:"needPick",value:function(t){return this.layerList.some(function(o){return o.needPick(t)})}},{key:"add",value:function(t){var o=this;this.layers.push(t),this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"addMask",value:function(t){var o=this;this.sceneInited&&t.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u=this;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,Pt.Z)(pe().mark(function x(S){return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(S.startInit){k.next=4;break}return k.next=3,S.init();case 3:u.updateLayerRenderList();case 4:case"end":return k.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(o){return o.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(o){return o.name===t})}},{key:"remove",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u,l){var p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:l?(p=l.layerChildren.indexOf(u),p>-1&&l.layerChildren.splice(p,1)):(v=this.layers.indexOf(u),v>-1&&this.layers.splice(v,1)),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return S.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"removeAllLayers",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){k.next=2;break}return k.abrupt("return");case 2:this.updateLayerRenderList(),u=this.debugService.generateRenderUid(),this.debugService.renderStart(u),this.alreadyInRendering=!0,this.clear(),l=ff(this.layerList),k.prev=8,l.s();case 10:if((p=l.n()).done){k.next=23;break}if(v=p.value,x=v.getLayerConfig(),S=x.enableMask,v.masks.filter(function(D){return D.inited}).length>0&&S&&this.renderMask(v.masks),!v.getLayerConfig().enableMultiPassRenderer){k.next=19;break}return k.next=17,v.renderMultiPass();case 17:k.next=21;break;case 19:return k.next=21,v.render();case 21:k.next=10;break;case 23:k.next=28;break;case 25:k.prev=25,k.t0=k.catch(8),l.e(k.t0);case 28:return k.prev=28,l.f(),k.finish(28);case 31:this.debugService.renderEnd(u),this.alreadyInRendering=!1;case 33:case"end":return k.stop()}},o,this,[[8,25,28,31]])}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMask",value:function(t){var o=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var u=t.length>1?dt.MULTIPLE:dt.SINGLE,l=ff(t),p;try{for(l.s();!(p=l.n()).done;){var v=p.value;v.render({isStencil:!0,stencilType:u,stencilIndex:o++})}}catch(x){l.e(x)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderTileLayerMask",value:function(t){var o=0,u=t.getLayerConfig(),l=u.enableMask,p=l===void 0?!0:l,v=t.tileMask?1:0,x=t.masks.filter(function(R){return R.inited});v=v+(p?x.length:1);var S=v>1?dt.MULTIPLE:dt.SINGLE;if((t.tileMask||x.length&&p)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.length&&p){var A=ff(x),k;try{for(A.s();!(k=A.n()).done;){var D=k.value;D.render({isStencil:!0,stencilType:S,stencilIndex:o++})}}catch(R){A.e(R)}finally{A.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:S,stencilIndex:o++,stencilOperation:kt.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.renderTileLayerMask(u),!u.getLayerConfig().enableMultiPassRenderer){p.next=6;break}return p.next=4,u.renderMultiPass();case 4:p.next=8;break;case 6:return p.next=8,u.render();case 8:case"end":return p.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){t.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=qn(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),r}(Ca.EventEmitter),Qv=jr(vu.prototype,"renderService",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$d=jr(vu.prototype,"mapService",[Qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cf=jr(vu.prototype,"debugService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu))||Wd),ll=N(81253),Yd=ei.isNil,qd=function(){function e(i){var r=this;(0,xe.Z)(this,e),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"type",void 0),(0,F.Z)(this,"scale",void 0),(0,F.Z)(this,"descriptor",void 0),(0,F.Z)(this,"featureBufferLayout",[]),(0,F.Z)(this,"needRescale",!1),(0,F.Z)(this,"needRemapping",!1),(0,F.Z)(this,"needRegenerateVertices",!1),(0,F.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,F.Z)(this,"vertexAttribute",void 0),(0,F.Z)(this,"defaultCallback",function(n){if(n.length===0){var t;return((t=r.scale)===null||t===void 0?void 0:t.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=r.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,K.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var t,o=(t=this.scale)===null||t===void 0?void 0:t.callback.apply(t,(0,_r.Z)(r));if(!Yd(o))return[o]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Nc=["buffer","update","name"],rm=["buffer","update","name"],Wf,qp,Kd,Kp,Jp,Jd,Qd=(Wf={},(0,F.Z)(Wf,q.FLOAT,4),(0,F.Z)(Wf,q.UNSIGNED_BYTE,1),(0,F.Z)(Wf,q.UNSIGNED_SHORT,2),Wf),nm=(qp=(0,Nt.b2)(),Kd=(0,Nt.f3)(Ne.IRendererService),qp(Kp=(Jp=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"attributesAndIndices",void 0),nn(this,"rendererService",Jd,this),(0,F.Z)(this,"attributes",[]),(0,F.Z)(this,"triangulation",void 0),(0,F.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,K.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new qd(r),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(r){var n=this.attributes.findIndex(function(t){return t.name===r});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(r){this.attributes.forEach(function(n){var t,o=n.name,u=(t=n.scale)===null||t===void 0?void 0:t.field;(r[o]||u&&r[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(r,n,t){var o=this.getLayerStyleAttribute(r);o||(o=this.registerStyleAttribute((0,O.Z)((0,O.Z)({},n),{},{name:r})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,t&&t.featureRange&&(o.featureRange=t.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,t=this.getLayerStyleAttribute(r),o=t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Ve){return Ve.name===r});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,S=p.size,A=S===void 0?0:S,k=Qd[x.type||q.FLOAT];if(v){var D=this.featureLayout,R=D.elements,Z=D.sizePerElement,W=R.slice(t,o);if(!W.length)return;var me=W[0].offset,ge=me*A*k,Ze=W.map(function(Ve,rt){for(var wt=Ve.featureIdx,Ut=Ve.vertices,Yt=Ve.normals,mr=Ut.length/Z,fr=[],Wr=0;Wr<mr;Wr++){var hn=Yt?Yt.slice(Wr*3,Wr*3+3):[];fr.push.apply(fr,(0,_r.Z)(v(n[wt],wt,Ut.slice(Wr*Z,Wr*Z+Z),rt,hn)))}return fr}).reduce(function(Ve,rt){return Ve.push.apply(Ve,(0,_r.Z)(rt)),Ve},[]);l.vertexAttribute.updateBuffer({data:Ze,offset:ge}),u==null||u.emit("legend:".concat(r),{type:r,attr:l})}}}},{key:"createAttributesAndIndices",value:function(r,n,t){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(W){return W.resetDescriptor(),W.descriptor}),l=0,p=0,v=[],x=3;r.forEach(function(W,me){var ge=o.triangulation(W,t),Ze=ge.indices,Ve=ge.vertices,rt=ge.normals,wt=ge.size,Ut=ge.indexes,Yt=ge.count;typeof Yt=="number"&&(p+=Yt),Ze.forEach(function(hn){v.push(hn+l)}),x=wt;var mr=Ve.length/wt;o.featureLayout.sizePerElement=x,o.featureLayout.elements.push({featureIdx:me,vertices:Ve,normals:rt,offset:l}),l+=mr;for(var fr=function(Pn){var Vi=(rt==null?void 0:rt.slice(Pn*3,Pn*3+3))||[],Da=Ve.slice(Pn*wt,Pn*wt+wt),ja=0;Ut&&Ut[Pn]!==void 0&&(ja=Ut[Pn]),u.forEach(function(ao,Ho){if(ao&&ao.update){var eh;(eh=ao.buffer.data).push.apply(eh,(0,_r.Z)(ao.update(W,me,Da,Pn,Vi,ja)))}})},Wr=0;Wr<mr;Wr++)fr(Wr)});var S=this.rendererService,A=S.createAttribute,k=S.createBuffer,D=S.createElements,R={};u.forEach(function(W,me){if(W){var ge=W.buffer,Ze=W.update,Ve=W.name,rt=(0,ll.Z)(W,Nc),wt=A((0,O.Z)({buffer:k(ge)},rt));R[W.name||""]=wt,o.attributes[me].vertexAttribute=wt}});var Z=D({data:v,type:q.UNSIGNED_INT,count:v.length});return this.attributesAndIndices={attributes:R,elements:Z,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var t=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(k){return k.resetDescriptor(),k.descriptor}),u=0,l=[],p=3;r.forEach(function(k,D){var R=t.triangulation(k),Z=R.indices,W=R.vertices,me=R.normals,ge=R.size,Ze=R.indexes;Z.forEach(function(Ut){l.push(Ut+u)}),p=ge;var Ve=W.length/ge;t.featureLayout.sizePerElement=p,t.featureLayout.elements.push({featureIdx:D,vertices:W,normals:me,offset:u}),u+=Ve;for(var rt=function(Yt){var mr=(me==null?void 0:me.slice(Yt*3,Yt*3+3))||[],fr=W.slice(Yt*ge,Yt*ge+ge),Wr=0;Ze&&Ze[Yt]!==void 0&&(Wr=Ze[Yt]),o.forEach(function(hn,Pn){if(hn&&hn.update){var Vi;(Vi=hn.buffer.data).push.apply(Vi,(0,_r.Z)(hn.update(k,D,fr,Yt,mr,Wr)))}})},wt=0;wt<Ve;wt++)rt(wt)});var v=this.rendererService,x=v.createAttribute,S=v.createBuffer,A={};return o.forEach(function(k,D){if(k){var R=k.buffer,Z=k.update,W=k.name,me=(0,ll.Z)(k,rm),ge=x((0,O.Z)({buffer:S(R)},me));A[k.name||""]=ge,t.attributes[D].vertexAttribute=ge}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Jd=jr(Jp.prototype,"rendererService",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jp))||Kp),$f=N(34155);function Qp(e,i,r,n){function t(o){return o instanceof r?o:new r(function(u){u(o)})}return new(r||(r=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(S){u(S)}}function p(x){try{v(n.throw(x))}catch(S){u(S)}}function v(x){x.done?o(x.value):t(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function Fh(e,i){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,t,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,t&&(o=v[0]&2?t.return:v[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,v[1])).done)return o;switch(t=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return r.label++,{value:v[1],done:!1};case 5:r.label++,t=v[1],v=[0];continue;case 7:v=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){r=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){r.label=v[1];break}if(v[0]===6&&r.label<o[1]){r.label=o[1],o=v;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(v);break}o[2]&&r.ops.pop(),r.trys.pop();continue}v=i.call(e,r)}catch(x){v=[6,x],t=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function ed(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),t,o=[],u;try{for(;(i===void 0||i-- >0)&&!(t=n.next()).done;)o.push(t.value)}catch(l){u={error:l}}finally{try{t&&!t.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return o}function vp(e,i,r){if(r||arguments.length===2)for(var n=0,t=i.length,o;n<t;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function ev(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var tv={exports:{}},td={exports:{}},mp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(mp,mp.exports);var mu={},rv={exports:{}},nv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];var o=n.pop();return r.call(this,n,o)}},e.exports=i.default})(nv,nv.exports);var hf={};Object.defineProperty(hf,"__esModule",{value:!0}),hf.fallback=Bh,hf.wrap=iv;var ac=hf.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,rd=hf.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,im=hf.hasNextTick=typeof $f=="object"&&typeof $f.nextTick=="function";function Bh(e){setTimeout(e,0)}function iv(e){return function(i){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return i.apply(void 0,r)})}}var av;ac?av=queueMicrotask:rd?av=setImmediate:im?av=$f.nextTick:av=Bh,hf.default=iv(av),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var r=nv.exports,n=l(r),t=hf,o=l(t),u=mu;function l(S){return S&&S.__esModule?S:{default:S}}function p(S){return(0,u.isAsync)(S)?function(){for(var A=[],k=arguments.length;k--;)A[k]=arguments[k];var D=A.pop(),R=S.apply(this,A);return v(R,D)}:(0,n.default)(function(A,k){var D;try{D=S.apply(this,A)}catch(R){return k(R)}if(D&&typeof D.then=="function")return v(D,k);k(null,D)})}function v(S,A){return S.then(function(k){x(A,null,k)},function(k){x(A,k&&k.message?k:new Error(k))})}function x(S,A,k){try{S(A,k)}catch(D){(0,o.default)(function(R){throw R},D)}}e.exports=i.default}(rv,rv.exports),Object.defineProperty(mu,"__esModule",{value:!0}),mu.isAsyncIterable=mu.isAsyncGenerator=mu.isAsync=void 0;var o2=rv.exports,s2=u2(o2);function u2(e){return e&&e.__esModule?e:{default:e}}function rg(e){return e[Symbol.toStringTag]==="AsyncFunction"}function l2(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function c2(e){return typeof e[Symbol.asyncIterator]=="function"}function f2(e){if(typeof e!="function")throw new Error("expected a function");return rg(e)?(0,s2.default)(e):e}mu.default=f2,mu.isAsync=rg,mu.isAsyncGenerator=l2,mu.isAsyncIterable=c2;var gp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,t){if(t===void 0&&(t=n.length),!t)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[t-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[t-1]=function(S){for(var A=[],k=arguments.length-1;k-- >0;)A[k]=arguments[k+1];if(S)return x(S);v(A.length>1?A:A[0])},n.apply(u,l)})}return o}e.exports=i.default})(gp,gp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=p(r),t=mu,o=p(t),u=gp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,S){var A=(0,n.default)(x)?[]:{};v(x,function(k,D,R){(0,o.default)(k)(function(Z){for(var W,me=[],ge=arguments.length-1;ge-- >0;)me[ge]=arguments[ge+1];me.length<2&&(W=me,me=W[0]),A[D]=me,R(Z)})},function(k){return S(k,A)})},3),e.exports=i.default}(td,td.exports);var Ym={exports:{}},am={exports:{}},qm={exports:{}},ov={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function t(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(t,n),t}e.exports=i.default})(ov,ov.exports);var Km={exports:{}},Jm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default})(Jm,Jm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=mp.exports,n=u(r),t=Jm.exports,o=u(t);function u(S){return S&&S.__esModule?S:{default:S}}function l(S){var A=-1,k=S.length;return function(){return++A<k?{value:S[A],key:A}:null}}function p(S){var A=-1;return function(){var D=S.next();return D.done?null:(A++,{value:D.value,key:A})}}function v(S){var A=S?Object.keys(S):[],k=-1,D=A.length;return function R(){var Z=A[++k];return Z==="__proto__"?R():k<D?{value:S[Z],key:Z}:null}}function x(S){if((0,n.default)(S))return l(S);var A=(0,o.default)(S);return A?p(A):v(S)}e.exports=i.default}(Km,Km.exports);var sv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,t)}}e.exports=i.default})(sv,sv.exports);var Qm={exports:{}},uv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default})(uv,uv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=uv.exports,n=t(r);function t(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,S=!1,A=!1,k=0,D=0;function R(){k>=l||A||x||(A=!0,u.next().then(function(me){var ge=me.value,Ze=me.done;if(!(S||x)){if(A=!1,Ze){x=!0,k<=0&&v(null);return}k++,p(ge,D,Z),D++,R()}}).catch(W))}function Z(me,ge){if(k-=1,!S){if(me)return W(me);if(me===!1){x=!0,S=!0;return}if(ge===n.default||x&&k<=0)return x=!0,v(null);R()}}function W(me){S||(A=!1,x=!0,v(me))}R()}e.exports=i.default}(Qm,Qm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=ov.exports,n=k(r),t=Km.exports,o=k(t),u=sv.exports,l=k(u),p=mu,v=Qm.exports,x=k(v),S=uv.exports,A=k(S);function k(D){return D&&D.__esModule?D:{default:D}}i.default=function(D){return function(R,Z,W){if(W=(0,n.default)(W),D<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!R)return W(null);if((0,p.isAsyncGenerator)(R))return(0,x.default)(R,D,Z,W);if((0,p.isAsyncIterable)(R))return(0,x.default)(R[Symbol.asyncIterator](),D,Z,W);var me=(0,o.default)(R),ge=!1,Ze=!1,Ve=0,rt=!1;function wt(Yt,mr){if(!Ze)if(Ve-=1,Yt)ge=!0,W(Yt);else if(Yt===!1)ge=!0,Ze=!0;else{if(mr===A.default||ge&&Ve<=0)return ge=!0,W(null);rt||Ut()}}function Ut(){for(rt=!0;Ve<D&&!ge;){var Yt=me();if(Yt===null){ge=!0,Ve<=0&&W(null);return}Ve+=1,Z(Yt.value,Yt.key,(0,l.default)(wt))}rt=!1}Ut()}},e.exports=i.default}(qm,qm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=qm.exports,n=p(r),t=mu,o=p(t),u=gp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,S,A,k){return(0,n.default)(S)(x,(0,o.default)(A),k)}i.default=(0,l.default)(v,4),e.exports=i.default}(am,am.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=am.exports,n=u(r),t=gp.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(Ym,Ym.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=td.exports,n=u(r),t=Ym.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(tv,tv.exports);var om=ev(tv.exports),pf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(t){r.apply(void 0,vp([],ed(n.args),!1)),t(null,i)})},e}(),e0={exports:{}},t0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=mp.exports,n=Z(r),t=uv.exports,o=Z(t),u=am.exports,l=Z(u),p=ov.exports,v=Z(p),x=sv.exports,S=Z(x),A=mu,k=Z(A),D=gp.exports,R=Z(D);function Z(Ze){return Ze&&Ze.__esModule?Ze:{default:Ze}}function W(Ze,Ve,rt){rt=(0,v.default)(rt);var wt=0,Ut=0,Yt=Ze.length,mr=!1;Yt===0&&rt(null);function fr(Wr,hn){Wr===!1&&(mr=!0),mr!==!0&&(Wr?rt(Wr):(++Ut===Yt||hn===o.default)&&rt(null))}for(;wt<Yt;wt++)Ve(Ze[wt],wt,(0,S.default)(fr))}function me(Ze,Ve,rt){return(0,l.default)(Ze,Infinity,Ve,rt)}function ge(Ze,Ve,rt){var wt=(0,n.default)(Ze)?W:me;return wt(Ze,(0,k.default)(Ve),rt)}i.default=(0,R.default)(ge,3),e.exports=i.default})(t0,t0.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var r=t0.exports,n=u(r),t=td.exports,o=u(t);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(e0,e0.exports);var h2=ev(e0.exports),fR=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return h2(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Qp(n,void 0,void 0,function(){return Fh(this,function(o){switch(o.label){case 0:return[4,r()];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),r0={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=ov.exports,n=x(r),t=sv.exports,o=x(t),u=mu,l=x(u),p=gp.exports,v=x(p);function x(A){return A&&A.__esModule?A:{default:A}}function S(A,k){if(k=(0,n.default)(k),!Array.isArray(A))return k(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return k();var D=0;function R(W){var me=(0,l.default)(A[D++]);me.apply(void 0,W.concat([(0,o.default)(Z)]))}function Z(W){for(var me=[],ge=arguments.length-1;ge-- >0;)me[ge]=arguments[ge+1];if(W!==!1){if(W||D===A.length)return k.apply(void 0,[W].concat(me));R(me)}}R([])}i.default=(0,v.default)(S),e.exports=i.default})(r0,r0.exports);var ng=ev(r0.exports),hR=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ng(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var t=r();n(t?null:!1,t)}):this.tasks.push(function(n,t){var o=r.apply(void 0,vp([],ed(n),!1));t(o?null:!1,i)})},e}(),ig=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return om(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var t=r();n(t,i)})},e}(),p2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Qp(n,void 0,void 0,function(){return Fh(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,vp([],ed(this.args),!1))];case 1:return o.sent(),t(null,i),[2]}})})})},e}(),d2=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,om(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(t){return Qp(n,void 0,void 0,function(){var o;return Fh(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,vp([],ed(this.args),!1))];case 1:return o=u.sent(),t(o,i),[2]}})})})},e}(),v2=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ng(this.tasks)},e.prototype.tapPromise=function(i,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(t){n(null,t)})}):this.tasks.push(function(n,t){r(n).then(function(o){t(null,o)})})},e}(),ag=N(67709),m2=N.n(ag),og,sg,ug,lg,cg,fg,hg,pg,dg,vg,mg,gg,yg,_g,xg,bg,Sg,wg,Bs,Eg,Ag,Cg,Tg,Mg,kg,Ig,Pg,Lg,Rg,Dg,Og,Fg,Bg,zg,Ng;function g2(e){var i=y2();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _2=(og=(0,Nt.b2)(),sg=(0,Nt.f3)(Ne.SceneID),ug=(0,Nt.f3)(Ne.IIconService),lg=(0,Nt.f3)(Ne.IFontService),cg=(0,Nt.f3)(Ne.IControlService),fg=(0,Nt.f3)(Ne.IGlobalConfigService),hg=(0,Nt.f3)(Ne.IMapService),pg=(0,Nt.f3)(Ne.ICoordinateSystemService),dg=(0,Nt.f3)(Ne.IRendererService),vg=(0,Nt.f3)(Ne.ILayerService),mg=(0,Nt.f3)(Ne.IDebugService),gg=(0,Nt.f3)(Ne.ICameraService),yg=(0,Nt.f3)(Ne.IInteractionService),_g=(0,Nt.f3)(Ne.IPickingService),xg=(0,Nt.f3)(Ne.IShaderModuleService),bg=(0,Nt.f3)(Ne.IMarkerService),Sg=(0,Nt.f3)(Ne.IPopupService),og(wg=(Bs=function(e){(0,lt.Z)(r,e);var i=g2(r);function r(){var n;return(0,xe.Z)(this,r),n=i.call(this),(0,F.Z)((0,Ie.Z)(n),"destroyed",!1),(0,F.Z)((0,Ie.Z)(n),"loaded",!1),nn((0,Ie.Z)(n),"id",Eg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"iconService",Ag,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"fontService",Cg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"controlService",Tg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"configService",Mg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"map",kg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"coordinateSystemService",Ig,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"rendererService",Pg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"layerService",Lg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"debugService",Rg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"cameraService",Dg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"interactionService",Og,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"pickingService",Fg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"shaderModuleService",Bg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"markerService",zg,(0,Ie.Z)(n)),nn((0,Ie.Z)(n),"popupService",Ng,(0,Ie.Z)(n)),(0,F.Z)((0,Ie.Z)(n),"inited",!1),(0,F.Z)((0,Ie.Z)(n),"initPromise",void 0),(0,F.Z)((0,Ie.Z)(n),"rendering",!1),(0,F.Z)((0,Ie.Z)(n),"$container",void 0),(0,F.Z)((0,Ie.Z)(n),"canvas",void 0),(0,F.Z)((0,Ie.Z)(n),"markerContainer",void 0),(0,F.Z)((0,Ie.Z)(n),"hooks",void 0),(0,F.Z)((0,Ie.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),No(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,F.Z)((0,Ie.Z)(n),"handleMapCameraChanged",function(t){n.cameraService.update(t),n.render()}),n.hooks={init:new p2},n}return(0,K.Z)(r,[{key:"init",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Pt.Z)(pe().mark(function u(){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o.debugService.log("map.mapInitStart",{type:o.map.version}),p.next=3,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 3:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(is.Drag,o.addSceneEvent.bind(o));case 10:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Pt.Z)(pe().mark(function u(){var l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p=((l=o.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,p?o.$container=p:o.$container=io(o.configService.getSceneConfig(o.id).id||""),!o.$container){S.next=13;break}return o.canvas=Ci("canvas","",o.$container),o.setCanvas(),S.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),t.gl);case 7:o.registerContextLost(),o.initContainer(),m2()(o.$container,o.handleWindowResized),window.matchMedia&&((v=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),S.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:o.pickingService.init(o.id);case 15:case"end":return S.stop()}},u)}))),this.render()}},{key:"registerContextLost",value:function(){var t=this,o=this.rendererService.getCanvas();o&&o.addEventListener("webglcontextlost",function(){return t.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(t){var o=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Pt.Z)(pe().mark(function u(){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(is.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Pt.Z)(pe().mark(function u(){var l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=t.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(t.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addFontFace",value:function(t,o){this.fontService.addFontFace(t,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return p=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],S.next=3,this.render();case 3:return v=u==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png"),S.abrupt("return",v);case 5:case"end":return S.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;t!==null&&(this.markerContainer=Ci("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,ag.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var l;(l=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=t.$container)===null||p===void 0||p.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var t,o,u=ea,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var t,o,u=ea,l=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),r}(Ca.EventEmitter),Eg=jr(Bs.prototype,"id",[sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ag=jr(Bs.prototype,"iconService",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cg=jr(Bs.prototype,"fontService",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=jr(Bs.prototype,"controlService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=jr(Bs.prototype,"configService",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=jr(Bs.prototype,"map",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ig=jr(Bs.prototype,"coordinateSystemService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=jr(Bs.prototype,"rendererService",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=jr(Bs.prototype,"layerService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=jr(Bs.prototype,"debugService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=jr(Bs.prototype,"cameraService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Og=jr(Bs.prototype,"interactionService",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fg=jr(Bs.prototype,"pickingService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bg=jr(Bs.prototype,"shaderModuleService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=jr(Bs.prototype,"markerService",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=jr(Bs.prototype,"popupService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bs))||wg);function x2(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var b2=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function n0(e){var i={};return e=e.replace(b2,function(r,n,t){var o=t.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(x2(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var Zg,Ug,S2=ei.uniq,Vg="#define PI 3.14159265359",w2=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,E2=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,A2=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,C2=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,T2=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,M2=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,k2=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;
uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}`,I2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,P2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,L2=/precision\s+(high|low|medium)p\s+float/,R2=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,D2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,O2=/void\s+main\s*\([^)]*\)\s*\{\n?/,pR=/}\n?[^{}]*$/,F2=(Zg=(0,Nt.b2)(),Zg(Ug=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"moduleCache",{}),(0,F.Z)(this,"rawContentCache",{})}return(0,K.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Vg,fs:Vg}),this.registerModule("decode",{vs:w2,fs:""}),this.registerModule("projection",{vs:k2,fs:""}),this.registerModule("project",{vs:M2,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:P2}),this.registerModule("lighting",{vs:A2,fs:""}),this.registerModule("light",{vs:E2,fs:""}),this.registerModule("picking",{vs:T2,fs:C2}),this.registerModule("rotation_2d",{vs:I2,fs:""})}},{key:"registerModule",value:function(r,n){var t=n.vs,o=n.fs,u=n.uniforms,l=n.inject,p=n0(t),v=p.content,x=p.uniforms,S=n0(o),A=S.content,k=S.uniforms;this.rawContentCache[r]={fs:A,inject:l,uniforms:(0,O.Z)((0,O.Z)((0,O.Z)({},x),k),u),vs:v}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this,t=this.rawContentCache[r].vs,o=this.rawContentCache[r].fs,u=this.rawContentCache[r].inject,l={};u!=null&&u["vs:#decl"]&&(t=(u==null?void 0:u["vs:#decl"])+t,l=n0(u==null?void 0:u["vs:#decl"]).uniforms),u!=null&&u["vs:#main-start"]&&(t=t.replace(O2,function(Z){return Z+(u==null?void 0:u["vs:#main-start"])}));var p=this.processModule(t,[],"vs"),v=p.content,x=p.includeList,S=this.processModule(o,[],"fs"),A=S.content,k=S.includeList,D="",R=S2(x.concat(k).concat(r)).reduce(function(Z,W){return(0,O.Z)((0,O.Z)({},Z),n.rawContentCache[W].uniforms)},(0,O.Z)({},l));return L2.test(A)||(D=D+R2),D=D+A,this.moduleCache[r]={fs:D.trim(),uniforms:R,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,t){var o=this,u=r.replace(D2,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var S=o.rawContentCache[x][t];n.push(x);var A=o.processModule(S,n,t),k=A.content;return k});return{content:u,includeList:n}}},{key:"injectDefines",value:function(r){var n=Object.keys(r).reduce(function(t,o){return t+"#define ".concat(o.toUpperCase()," ").concat(r[o],`;
`)},`
`);return n}}]),e}())||Ug),ia=N(66213),nd=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),jg,Gg,sm=(jg=(0,Nt.b2)(),jg(Gg=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"shaderModuleService",void 0),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"cameraService",void 0),(0,F.Z)(this,"mapService",void 0),(0,F.Z)(this,"interactionService",void 0),(0,F.Z)(this,"layerService",void 0),(0,F.Z)(this,"config",void 0)}return(0,K.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return nd.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ne.IRendererService),this.cameraService=r.getContainer().get(Ne.ICameraService),this.mapService=r.getContainer().get(Ne.IMapService),this.interactionService=r.getContainer().get(Ne.IInteractionService),this.layerService=r.getContainer().get(Ne.ILayerService),this.shaderModuleService=r.getContainer().get(Ne.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Gg),Hg,Wg;function B2(e){var i=z2();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N2=(Hg=(0,Nt.b2)(),Hg(Wg=function(e){(0,lt.Z)(r,e);var i=B2(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,o){(0,ia.Z)((0,te.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(sm))||Wg),$g,Xg,Yg,i0,qg;function Z2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=U2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function U2(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var V2=($g=(0,Nt.b2)(),Xg=(0,Nt.f3)(Ne.IPostProcessor),$g(Yg=(i0=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"passes",[]),nn(this,"postProcessor",qg,this),(0,F.Z)(this,"layer",void 0),(0,F.Z)(this,"renderFlag",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0)}return(0,K.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){var t,o,u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=Z2(this.passes),p.prev=1,t.s();case 3:if((o=t.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),t.e(p.t0);case 14:return p.prev=14,t.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===nd.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,t){r.init(this.layer,n),this.passes.splice(t,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),qg=jr(i0.prototype,"postProcessor",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||Yg),Jg,Qg;function j2(e){var i=G2();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function G2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H2=(Jg=(0,Nt.b2)(),Jg(Qg=function(e){(0,lt.Z)(r,e);var i=j2(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"pickingFBO",void 0),(0,F.Z)((0,Ie.Z)(n),"layer",void 0),(0,F.Z)((0,Ie.Z)(n),"width",0),(0,F.Z)((0,Ie.Z)(n),"height",0),(0,F.Z)((0,Ie.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Ie.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,S=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(S))){var A=n.rendererService,k=A.getViewportSize,D=A.readPixels,R=A.useFramebuffer,Z=k(),W=Z.width,me=Z.height,ge=n.layer.getLayerConfig(),Ze=ge.enableHighlight,Ve=ge.enableSelect,rt=p*ea,wt=v*ea;if(!(rt>W||rt<0||wt>me||wt<0)){var Ut;R(n.pickingFBO,function(){var Yt;if(Ut=D({x:Math.round(rt),y:Math.round(me-(v+1)*ea),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Ut[0]!==0||Ut[1]!==0||Ut[2]!==0){var mr=oa(Ut),fr=n.layer.getSource().getFeatureById(mr),Wr={x:p,y:v,type:S,lngLat:x,featureId:mr,feature:fr};fr&&(n.layer.setCurrentPickId(mr),n.triggerHoverOnLayer(Wr))}else{var hn={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+S:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,O.Z)((0,O.Z)({},hn),{},{type:"unpick"})),n.triggerHoverOnLayer(hn),n.layer.setCurrentPickId(null)}Ze&&n.highlightPickedFeature(Ut),Ve&&S==="click"&&((Yt=Ut)===null||Yt===void 0?void 0:Yt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Ut)})}}}),n}return(0,K.Z)(r,[{key:"getType",value:function(){return nd.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,o){(0,ia.Z)((0,te.Z)(r.prototype),"init",this).call(this,t,o),this.layer=t;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),S=x.width,A=x.height;this.pickingFBO=p({color:l({width:S,height:A,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(is.Hover,this.pickFromPickingFBO),this.interactionService.on(is.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(is.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),S=x.width,A=x.height;this.alreadyInRendering=!0,(this.width!==S||this.height!==A)&&(this.pickingFBO.resize({width:S,height:A}),this.width=S,this.height=A),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var k=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(k),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var o=(0,Qr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var o=(0,Qr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var o=t.featureId,u=Qi(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(t){var o=t.featureId,u=Qi(o);this.highlightPickedFeature(new Uint8Array(u))}}]),r}(sm))||Qg),ey,ty,ry,a0,ny,W2=ei.camelCase,$2=ei.isNil,X2=ei.upperFirst,Y2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xf=(ey=(0,Nt.b2)(),ty=(0,Nt.f3)(Ne.IShaderModuleService),ey(ry=(a0=function(){function e(){(0,xe.Z)(this,e),nn(this,"shaderModuleService",ny,this),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"config",void 0),(0,F.Z)(this,"quad",Y2),(0,F.Z)(this,"enabled",!0),(0,F.Z)(this,"renderToScreen",!1),(0,F.Z)(this,"model",void 0),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"optionsToUpdate",{})}return(0,K.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return nd.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ne.IRendererService),this.shaderModuleService=r.getContainer().get(Ne.IShaderModuleService);var t=this.rendererService,o=t.createAttribute,u=t.createBuffer,l=t.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,S=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)((0,O.Z)({u_Texture:null},S),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var t=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),S=x.width,A=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var k=(0,O.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[S,A]},t.convertOptionsToUniforms(t.optionsToUpdate));n&&(k.u_BloomFinal=1,k.u_Texture2=n),t.model.draw({uniforms:k})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=(0,O.Z)((0,O.Z)({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(t){$2(r[t])||(n["u_".concat(X2(W2(t)))]=r[t])}),n}}]),e}(),ny=jr(a0.prototype,"shaderModuleService",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0))||ry),iy,ay;function q2(e){var i=K2();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function K2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,o0=ei.isNil,eS=(iy=(0,Nt.b2)(),iy(ay=function(e){(0,lt.Z)(r,e);var i=q2(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Q2,fs:J2});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return o0(t.bloomRadius)||(o.u_radius=t.bloomRadius),o0(t.bloomIntensity)||(o.u_intensity=t.bloomIntensity),o0(t.bloomBaseRadio)||(o.u_baseRadio=t.bloomBaseRadio),o}}]),r}(Xf))||ay),oy,sy;function tS(e){var i=rS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,iS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aS=ei.isNil,oS=(oy=(0,Nt.b2)(),oy(sy=function(e){(0,lt.Z)(r,e);var i=tS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:iS,fs:nS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return aS(t.blurRadius)||(o.u_BlurDir=[t.blurRadius,0]),o}}]),r}(Xf))||sy),uy,ly;function sS(e){var i=uS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,cS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fS=ei.isNil,hS=(uy=(0,Nt.b2)(),uy(ly=function(e){(0,lt.Z)(r,e);var i=sS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:cS,fs:lS});var t=this.shaderModuleService.getModule("blur-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(t){var o={};return fS(t.blurRadius)||(o.u_BlurDir=[0,t.blurRadius]),o}}]),r}(Xf))||ly),cy,fy;function pS(e){var i=dS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,mS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gS=(cy=(0,Nt.b2)(),cy(fy=function(e){(0,lt.Z)(r,e);var i=pS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:mS,fs:vS});var t=this.shaderModuleService.getModule("colorhalftone-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Xf))||fy),hy,py;function yS(e){var i=_S();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,bS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,SS=(hy=(0,Nt.b2)(),hy(py=function(e){(0,lt.Z)(r,e);var i=yS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:bS,fs:xS}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Xf))||py),dy,vy;function wS(e){var i=ES();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,CS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TS=(dy=(0,Nt.b2)(),dy(vy=function(e){(0,lt.Z)(r,e);var i=wS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:CS,fs:AS});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Xf))||vy),gy,yy;function MS(e){var i=kS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,PS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LS=(gy=(0,Nt.b2)(),gy(yy=function(e){(0,lt.Z)(r,e);var i=MS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:PS,fs:IS});var t=this.shaderModuleService.getModule("ink-pass"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,O.Z)((0,O.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),r}(Xf))||yy),_y,xy;function RS(e){var i=DS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,FS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BS=(_y=(0,Nt.b2)(),_y(xy=function(e){(0,lt.Z)(r,e);var i=RS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:FS,fs:OS}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Xf))||xy),by,Sy;function zS(e){var i=NS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function NS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,US=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,VS=(by=(0,Nt.b2)(),by(Sy=function(e){(0,lt.Z)(r,e);var i=zS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:ZS,fs:US}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Xf))||Sy),wy,Ey,Ay,Cy,id,Ty,jS=(wy=(0,Nt.b2)(),Ey=(0,Nt.f3)(Ne.IRendererService),Ay=(0,Nt.zY)(),wy(Cy=(id=function(){function e(){(0,xe.Z)(this,e),nn(this,"rendererService",Ty,this),(0,F.Z)(this,"passes",[]),(0,F.Z)(this,"readFBO",void 0),(0,F.Z)(this,"writeFBO",void 0)}return(0,K.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,t=r.createTexture2D,o=n(),u=o.width,l=o.height;return t({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(t){n(r.readFBO,(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t(r.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t,o){var u,l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(t,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){var o,u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(t,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(t);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,t){r.init(n,t),this.passes.push(r)}},{key:"insert",value:function(r,n,t,o){r.init(t,o),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,t=r.createTexture2D;this.readFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.writeFBO=n({color:t({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Ty=jr(id.prototype,"rendererService",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr(id.prototype,"init",[Ay],Object.getOwnPropertyDescriptor(id.prototype,"init"),id.prototype),id))||Cy),My,ky;function GS(e){var i=HS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=(My=(0,Nt.b2)(),My(ky=function(e){(0,lt.Z)(r,e);var i=GS(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getType",value:function(){return nd.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,o){(0,ia.Z)((0,te.Z)(r.prototype),"init",this).call(this,t,o)}},{key:"render",value:function(t){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=t.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(function(v){v.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}]),r}(sm))||ky),Iy,Py,Ly,s0,Ry;function $S(e){var i=XS();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Dy=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Oy(e,i){for(var r=0,n=1/i,t=e;t>0;)r=r+n*(t%i),t=Math.floor(t/i),n=n/i;return r}var KS=1,JS=(Iy=(0,Nt.b2)(),Py=(0,Nt.f3)(Ne.IShaderModuleService),Iy(Ly=(s0=function(e){(0,lt.Z)(r,e);var i=$S(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),nn((0,Ie.Z)(n),"shaderModuleService",Ry,(0,Ie.Z)(n)),(0,F.Z)((0,Ie.Z)(n),"haltonSequence",[]),(0,F.Z)((0,Ie.Z)(n),"accumulatingId",0),(0,F.Z)((0,Ie.Z)(n),"frame",0),(0,F.Z)((0,Ie.Z)(n),"timer",void 0),(0,F.Z)((0,Ie.Z)(n),"sampleRenderTarget",void 0),(0,F.Z)((0,Ie.Z)(n),"prevRenderTarget",void 0),(0,F.Z)((0,Ie.Z)(n),"outputRenderTarget",void 0),(0,F.Z)((0,Ie.Z)(n),"copyRenderTarget",void 0),(0,F.Z)((0,Ie.Z)(n),"blendModel",void 0),(0,F.Z)((0,Ie.Z)(n),"outputModel",void 0),(0,F.Z)((0,Ie.Z)(n),"copyModel",void 0),n}return(0,K.Z)(r,[{key:"getType",value:function(){return nd.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,o){(0,ia.Z)((0,te.Z)(r.prototype),"init",this).call(this,t,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([Oy(v,2),Oy(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",YS),this.outputModel=this.createTriangleModel("copy-pass",Dy,{blend:{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:q.ONE,dstAlpha:q.ONE_MINUS_SRC_ALPHA},equation:{rgb:q.FUNC_ADD,alpha:q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Dy)}},{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height;this.sampleRenderTarget.resize({width:S,height:A}),this.prevRenderTarget.resize({width:S,height:A}),this.outputRenderTarget.resize({width:S,height:A}),this.copyRenderTarget.resize({width:S,height:A}),this.resetFrame(),this.stopAccumulating();var k=t.multiPassRenderer.getPostProcessor().getReadFBO();v(k,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:k}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});var D=function R(Z){!o.accumulatingId||Z!==o.accumulatingId||o.isFinished()||(o.doRender(t),window.requestAnimationFrame(function(){R(Z)}))};this.accumulatingId=KS++,this.timer=window.setTimeout(function(){D(o.accumulatingId)},50)}},{key:"doRender",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),S=x.width,A=x.height,k=t.getLayerConfig(),D=k.jitterScale,R=D===void 0?1:D,Z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Z[0]*2-1)/S*R,(Z[1]*2-1)/A*R),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var W=t.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:W.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(t.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));var me=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=me,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,o,u){this.shaderModuleService.registerModule(t,{vs:qS,fs:o});var l=this.shaderModuleService.getModule(t),p=l.vs,v=l.fs,x=l.uniforms,S=this.rendererService,A=S.createAttribute,k=S.createBuffer,D=S.createModel;return D((0,O.Z)({vs:p,fs:v,attributes:{a_Position:A({buffer:k({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)({},x),depth:{enable:!1},count:3},u))}}]),r}(sm),Ry=jr(s0.prototype,"shaderModuleService",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s0))||Ly),lv=new Nt.W2;lv.bind(Ne.IGlobalConfigService).to(un).inSingletonScope(),(0,Nt.GW)((0,Nt.b2)(),Ca.EventEmitter),lv.bind(Ne.IEventEmitter).to(Ca.EventEmitter);var Fy=(0,Fn.Z)(lv,!1),u0=function(i){var r=Fy.lazyInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},dR=function(i){var r=Fy.lazyMultiInject(i);return function(n,t,o){r.call(this,n,t),o&&(o.initializer=function(){return n[t]})}},cl=lv,QS=0;function ew(){var e=new Nt.W2;return e.parent=lv,e.bind(Ne.SceneID).toConstantValue("".concat(QS++)),e.bind(Ne.IShaderModuleService).to(F2).inSingletonScope(),e.bind(Ne.ILayerService).to(tm).inSingletonScope(),e.bind(Ne.IDebugService).to(Ih).inSingletonScope(),e.bind(Ne.ISceneService).to(_2).inSingletonScope(),e.bind(Ne.ICameraService).to(c).inSingletonScope(),e.bind(Ne.ICoordinateSystemService).to(Hp).inSingletonScope(),e.bind(Ne.IInteractionService).to(Xm).inSingletonScope(),e.bind(Ne.IPickingService).to(Kv).inSingletonScope(),e.bind(Ne.IControlService).to(j).inSingletonScope(),e.bind(Ne.IMarkerService).to(se).inSingletonScope(),e.bind(Ne.IIconService).to(Ke).inSingletonScope(),e.bind(Ne.IFontService).to(vn).inSingletonScope(),e.bind(Ne.IPopupService).to(tt).inSingletonScope(),e.bind(Ne.INormalPass).to(N2).whenTargetNamed("clear"),e.bind(Ne.INormalPass).to(H2).whenTargetNamed("pixelPicking"),e.bind(Ne.INormalPass).to(WS).whenTargetNamed("render"),e.bind(Ne.INormalPass).to(JS).whenTargetNamed("taa"),e.bind(Ne.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ne.INormalPass,r)}}),e.bind(Ne.IPostProcessingPass).to(SS).whenTargetNamed("copy"),e.bind(Ne.IPostProcessingPass).to(eS).whenTargetNamed("bloom"),e.bind(Ne.IPostProcessingPass).to(oS).whenTargetNamed("blurH"),e.bind(Ne.IPostProcessingPass).to(hS).whenTargetNamed("blurV"),e.bind(Ne.IPostProcessingPass).to(BS).whenTargetNamed("noise"),e.bind(Ne.IPostProcessingPass).to(VS).whenTargetNamed("sepia"),e.bind(Ne.IPostProcessingPass).to(gS).whenTargetNamed("colorHalftone"),e.bind(Ne.IPostProcessingPass).to(TS).whenTargetNamed("hexagonalPixelate"),e.bind(Ne.IPostProcessingPass).to(LS).whenTargetNamed("ink"),e.bind(Ne.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ne.IPostProcessingPass,r);return n.setName(r),n}}),e}function cv(e){var i=new Nt.W2;return i.parent=e,i.bind(Ne.IStyleAttributeService).to(nm).inSingletonScope(),i.bind(Ne.IMultiPassRenderer).to(V2).inSingletonScope(),i.bind(Ne.IPostProcessor).to(jS).inSingletonScope(),i}var tw=null;function vR(e){return tw.indexOf(e)}var By=ei.clamp,rw=2,mR=4,nw=64,gR=128,iw=256,aw=512,yR=8192,_R=16384,xR=32768,ow=null,zy=131072,bR=262144,sw=524288,SR=1048576,uw=2097152,wR=4194304,lw=8388608,cw=16777216,fw=null;function um(e,i){return e=By(Math.floor(e),0,255),i=By(Math.floor(i),0,255),256*e+i}function ER(e){var i=e.color,r=e.radius,n=e.tileX,t=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],S=[],A=[],k=[um(i[0],i[1]),um(i[2],i[3])],D=[um(l[0],l[1]),um(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(R){var Z=_slicedToArray(R,2),W=Z[0],me=Z[1];x.push([].concat(k,[(W+1)*lw+(me+1)*uw+getShapeIndex(o)*zy+r,(n+512)*sw+(t+512)*nw])),S.push([].concat(D,[p,v])),A.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:S,packedBuffer3:A}}function AR(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*fw+r*cw+n*zy+r*ow+n*aw+r*iw+n*rw+r}var yp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},as={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},Ra=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),ad=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),ln=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),hw=["mapload","mapchange","mapAfterFrameChange"],lm=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],eu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),pw=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:r.x,y:r.y,z:r.z},function(x,S){if(x||S.length===0){v(x);return}S&&yr([{data:S,bands:[0]}],t,o,function(A,k){A?v(A):k&&p(k)})})}));case 1:case"end":return l.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),dw=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n){return pe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(u,l){n({x:r.x,y:r.y,z:r.z},function(p,v){if(p||!v){l(p);return}v instanceof ArrayBuffer?Ns(v,function(x,S){x&&l(x),u(S)}):v instanceof HTMLImageElement?u(v):l(p)})}));case 1:case"end":return o.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function vw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(r){return f(r,i)}):e.map(function(r){return{url:f(r.url,i),bands:r.bands||[0]}}):f(e,i)}function mw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function Ny(e,i){e.xhrCancel=function(){i.map(function(r){r.abort()})}}var gw=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o,u){var l,p,v,x,S,A;return pe().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(l=mw(n.url),!(l.length>1)){D.next=15;break}return D.next=4,yw(l,n);case 4:if(p=D.sent,v=p.rasterFiles,x=p.xhrList,S=p.errList,Ny(r,x),!(S.length>0)){D.next=12;break}return t(S,null),D.abrupt("return");case 12:yr(v,o,u,t),D.next=17;break;case 15:A=oo(n,function(R,Z){if(R)t(R);else if(Z){var W=[{data:Z,bands:l[0].bands}];yr(W,o,u,t)}}),Ny(r,[A]);case 17:case"end":return D.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}();function yw(e,i){return l0.apply(this,arguments)}function l0(){return l0=(0,Pt.Z)(pe().mark(function e(i,r){var n,t,o,u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:n=[],t=[],o=[],u=0;case 4:if(!(u<i.length)){R.next=20;break}return l=i[u],p=(0,O.Z)((0,O.Z)({},r),{},{url:l.url}),v=l.bands,R.next=10,ui((0,O.Z)((0,O.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=R.sent,S=x.err,A=x.data,k=x.xhr,S&&o.push(S),t.push(k),n.push({data:A,bands:v});case 17:u++,R.next=4;break;case 20:return R.abrupt("return",{rasterFiles:n,xhrList:t,errList:o});case 21:case"end":return R.stop()}},e)})),l0.apply(this,arguments)}var _w=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o,u){var l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:vw(r,n)},v.abrupt("return",new Promise(function(x,S){gw(t,l,function(A,k){A?S(A):k&&x(k)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(r,n,t,o,u){return e.apply(this,arguments)}}(),Zy=function(){var e=(0,Pt.Z)(pe().mark(function i(r,n,t,o){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return l=Array.isArray(r)?r[0]:r,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||d,u=p(l,(0,O.Z)((0,O.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||f,u=v(l,n)),S.abrupt("return",new Promise(function(A,k){var D,R=ha({url:u,type:(o==null||(D=o.requestParameters)===null||D===void 0?void 0:D.type)||"arrayBuffer"},function(Z,W){Z?k(Z):W&&A(W)},o.transformResponse);t.xhrCancel=function(){return R.cancel()}}));case 3:case"end":return S.stop()}},i)}));return function(r,n,t,o){return e.apply(this,arguments)}}(),Uy=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},xw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},CR=[eu.ARRAYBUFFER,eu.RGB];function bw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Sw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(bw(e))throw new Error("tile server url is error");var r=(i==null?void 0:i.dataType)||eu.IMAGE;r===eu.RGB&&(r=eu.ARRAYBUFFER);var n=function(u,l){switch(r){case eu.IMAGE:return Zy(e,u,l,i);case eu.CUSTOMIMAGE:case eu.CUSTOMTERRAINRGB:return dw(l,i==null?void 0:i.getCustomData);case eu.ARRAYBUFFER:return _w(e,u,l,(i==null?void 0:i.format)||Uy,i==null?void 0:i.operation);case eu.CUSTOMARRAYBUFFER:case eu.CUSTOMRGB:return pw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||Uy,i==null?void 0:i.operation);default:return Zy(e,u,l,i)}},t=(0,O.Z)((0,O.Z)((0,O.Z)({},xw),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:t,isTile:!0}}var ww=["extent","min","max","width","height","format","operation"];function Ew(e,i){var r=i.extent,n=i.min,t=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,ll.Z)(i,ww),x;if(l===void 0||Jl(e))x=Array.from(e);else{var S=Array.isArray(e)?e:[e];x=Tr(S,l,p)}var A={_id:1,dataArray:[(0,O.Z)((0,O.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:t,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return A}var Aw={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},Cw=function(){var e=(0,Pt.Z)(pe().mark(function i(r){return pe().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(o){var u=(0,Qr.Z)(r.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],S={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(l+v)/2,y:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(S)}));case 1:case"end":return t.stop()}},i)}));return function(r){return e.apply(this,arguments)}}();function Tw(e,i){var r=function(o){return Cw(o)},n=(0,O.Z)((0,O.Z)((0,O.Z)({},Aw),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var Mw=N(69848),Vy=N.n(Mw);function jy(e,i){var r=i.radius,n=r===void 0?40:r,t=i.maxZoom,o=t===void 0?18:t,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=kw(x),e}var S=new(Vy())({radius:n,minZoom:l,maxZoom:o}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(k){return{type:"Feature",geometry:{type:"Point",coordinates:k.coordinates},properties:(0,O.Z)({},k)}}),S.load(A.features),S}function kw(e){return e.map(function(i,r){return(0,O.Z)({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Iw(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Pw(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Gy(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,t=1;t<e.length;t++)n=i+e[t]*1,Math.abs(i)>=Math.abs(e[t])?r+=i-n+e[t]:r+=e[t]-n+i,i=n;return i+r*1}function Lw(e){if(e.length===0)throw new Error("mean requires at least one data point");return Gy(e)/e.length}var Rw={min:Pw,max:Iw,mean:Lw,sum:Gy};function Dw(e){var i=Ow();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw=ei.cloneDeep,Hy=ei.isFunction,Bw=ei.isString,zw=ei.mergeWith;function Nw(e,i){if(Array.isArray(i))return i}var Zw=function(e){(0,lt.Z)(r,e);var i=Dw(r);function r(n,t){var o;return(0,xe.Z)(this,r),o=i.call(this),(0,F.Z)((0,Ie.Z)(o),"type","source"),(0,F.Z)((0,Ie.Z)(o),"isTile",!1),(0,F.Z)((0,Ie.Z)(o),"inited",!1),(0,F.Z)((0,Ie.Z)(o),"hooks",{init:new pf}),(0,F.Z)((0,Ie.Z)(o),"parser",{type:"geojson"}),(0,F.Z)((0,Ie.Z)(o),"transforms",[]),(0,F.Z)((0,Ie.Z)(o),"cluster",!1),(0,F.Z)((0,Ie.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,F.Z)((0,Ie.Z)(o),"invalidExtent",!1),(0,F.Z)((0,Ie.Z)(o),"dataArrayChanged",!1),(0,F.Z)((0,Ie.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(t),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,K.Z)(r,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,x.forEach(function(S){S.id||(S.properties.point_count=1)}),(v||Hy(p))&&(x=x.map(function(S){var A=S.id;if(A){var k=o.clusterIndex.getLeaves(A,Infinity),D=k.map(function(W){return W.properties}),R;if(Bw(p)&&v){var Z=Lf(D,v);R=Rw[p](Z)}Hy(p)&&(R=p(D)),S.properties.stat=R}else S.properties.point_count=1;return S})),this.data=ie("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=t<this.originData.features.length?this.originData.features[t]:"null",x=Fw(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var S=this.data.dataArray.find(function(A){return A._id===t});x.properties=S}return x}else return l==="json"&&p?this.data.dataArray.find(function(A){return A._id===t}):t<this.data.dataArray.length?this.data.dataArray[t]:"null"}},{key:"updateFeaturePropertiesById",value:function(t,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===t?(0,O.Z)((0,O.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,o){var u=this.data.dataArray.find(function(l){return l[t]===o});return u==null?void 0:u._id}},{key:"setData",value:function(t,o){var u=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var t;(t=this.tileset)===null||t===void 0||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(t,o,u)}},{key:"reloadTileByLnglat",value:function(t,o,u){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(t,o,u)}},{key:"getTileExtent",value:function(t,o){var u;return(u=this.tileset)===null||u===void 0?void 0:u.getTileExtent(t,o)}},{key:"getTileByZXY",value:function(t,o,u){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(t,o,u)}},{key:"reloadTileByExtent",value:function(t,o){var u;(u=this.tileset)===null||u===void 0||u.reloadTileByExtent(t,o)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(t=this.tileset)===null||t===void 0||t.destroy()}},{key:"processData",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u=this;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(S){x(S)}}));case 1:case"end":return p.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"initCfg",value:function(t){this.cfg=zw(this.cfg,t,Nw);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,O.Z)((0,O.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"excuteParser",value:function(){var t=this.parser,o=t.type||"geojson",u=ie(o);this.data=u(this.originData,t),this.tileset=this.initTileset(),!t.cancelExtent&&(this.extent=Vu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(!!t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var o=new Tc((0,O.Z)({},t));return o}}},{key:"executeTrans",value:function(){var t=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=ae(l)(t.data,u);Object.assign(t.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var t=this.clusterOptions||{};this.clusterIndex=jy(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=Vl(ta(this.extent),t)),o[0].concat(o[1])}}]),r}(Ca.EventEmitter);function Uw(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Wy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function Vw(e,i){if(!!e){if(typeof e=="string")return $y(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $y(e,i)}}function $y(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var c0=6378e3;function jw(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=t/(2*Math.PI*c0)*(256<<20)/2,u=Gw(r,t),l=u.gridHash,p=u.gridOffset,v=Xw(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function Gw(e,i){var r=Infinity,n=-Infinity,t,o=Wy(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;t=l.coordinates[1],Number.isFinite(t)&&(r=t<r?t:r,n=t>n?t:n)}}catch(ge){o.e(ge)}finally{o.f()}var p=(r+n)/2,v=Hw(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},S=Wy(e),A;try{for(S.s();!(A=S.n()).done;){var k=A.value,D=k.coordinates[1],R=k.coordinates[0];if(Number.isFinite(D)&&Number.isFinite(R)){var Z=Math.floor((D+90)/v.yOffset),W=Math.floor((R+180)/v.xOffset),me="".concat(Z,"-").concat(W);x[me]=x[me]||{count:0,points:[]},x[me].count+=1,x[me].points.push(k)}}}catch(ge){S.e(ge)}finally{S.f()}return{gridHash:x,gridOffset:v}}function Hw(e,i){var r=Ww(e),n=$w(i,e);return{yOffset:r,xOffset:n}}function Ww(e){return e/c0*(180/Math.PI)}function $w(e,i){return i/c0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Xw(e,i,r){return Object.keys(e).reduce(function(n,t,o){var u=t.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(r.field&&r.method){var x=wc(e[t].points,r.field);v[r.method]=Yu[r.method](x)}return Object.assign(v,{_id:o,coordinates:_o([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[t].points,count:e[t].count}),n.push(v),n},[])}var od=Math.PI/3,Yw=[0,od,2*od,3*od,4*od,5*od];function qw(e){return e[0]}function Kw(e){return e[1]}function Jw(){var e=0,i=0,r=1,n=1,t=qw,o=Kw,u,l,p;function v(S){var A={},k=[],D,R=S.length;for(D=0;D<R;++D)if(!(isNaN(W=+t.call(null,Z=S[D],D,S))||isNaN(me=+o.call(null,Z,D,S)))){var Z,W,me,ge=Math.round(me=me/p),Ze=Math.round(W=W/l-(ge&1)/2),Ve=me-ge;if(Math.abs(Ve)*3>1){var rt=W-Ze,wt=Ze+(W<Ze?-1:1)/2,Ut=ge+(me<ge?-1:1),Yt=W-wt,mr=me-Ut;rt*rt+Ve*Ve>Yt*Yt+mr*mr&&(Ze=wt+(ge&1?1:-1)/2,ge=Ut)}var fr=Ze+"-"+ge,Wr=A[fr];Wr?Wr.push(Z):(k.push(Wr=A[fr]=[Z]),Wr.x=(Ze+(ge&1)/2)*l,Wr.y=ge*p)}return k}function x(S){var A=0,k=0;return Yw.map(function(D){var R=Math.sin(D)*S,Z=-Math.cos(D)*S,W=R-A,me=Z-k;return A=R,k=Z,[W,me]})}return v.hexagon=function(S){return"m"+x(S==null?u:+S).join("l")+"z"},v.centers=function(){for(var S=[],A=Math.round(i/p),k=Math.round(e/l),D=A*p;D<n+u;D+=p,++A)for(var R=k*l+(A&1)*l/2;R<r+l/2;R+=l)S.push([R,D]);return S},v.mesh=function(){var S=x(u).slice(0,4).join("l");return v.centers().map(function(A){return"M"+A+"m"+S}).join("")},v.x=function(S){return arguments.length?(t=S,v):t},v.y=function(S){return arguments.length?(o=S,v):o},v.radius=function(S){return arguments.length?(u=+S,l=u*2*Math.sin(od),p=u*1.5,v):u},v.size=function(S){return arguments.length?(e=i=0,r=+S[0],n=+S[1],v):[r-e,n-i]},v.extent=function(S){return arguments.length?(e=+S[0][0],i=+S[0][1],r=+S[1][0],n=+S[1][1],v):[[e,i],[r,n]]},v.radius(1)}var Qw=6378e3;function e3(e,i){var r=e.dataArray,n=i.size,t=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=t/(2*Math.PI*Qw)*(256<<20)/2,p=r.map(function(A){var k=_o(A.coordinates),D=(0,Qr.Z)(k,2),R=D[0],Z=D[1];return(0,O.Z)((0,O.Z)({},A),{},{coordinates:[R,Z]})}),v=Jw().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),x=v(p),S={dataArray:x.map(function(A,k){var D;if(i.field&&u){var R=wc(A,i.field);A[u]=Yu[u](R)}return D={},(0,F.Z)(D,i.method,A[u]),(0,F.Z)(D,"count",A.length),(0,F.Z)(D,"rawData",A),(0,F.Z)(D,"coordinates",[A.x,A.y]),(0,F.Z)(D,"_id",k),D}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return S}function t3(e,i){var r=i.sourceField,n=i.targetField,t=i.data,o={};return t.forEach(function(u){o[u[r]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,O.Z)((0,O.Z)({},u),o[l])}),e}function r3(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}We("rasterTile",Sw),We("mvt",Ir),We("geojsonvt",Np),We("testTile",Tw),We("geojson",El),We("image",B),We("csv",Df),We("json",al),We("raster",pr),We("rasterRgb",Ew),He("cluster",jy),He("filter",Uw),He("join",t3),He("map",r3),He("grid",jw),He("hexagon",e3);var f0=Zw;function n3(e){var i=i3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xy=function(e){(0,lt.Z)(r,e);var i=n3(r);function r(n){var t;return(0,xe.Z)(this,r),t=i.call(this),(0,F.Z)((0,Ie.Z)(t),"added",!1),(0,F.Z)((0,Ie.Z)(t),"eventHandle",function(o){t.polyfillEvent(o),t.emit(o.type,{target:o,data:t.markerOption.extData,lngLat:t.lngLat})}),t.markerOption=(0,O.Z)((0,O.Z)({},t.getDefault()),n),wu(["update","onMove","onMapClick"],(0,Ie.Z)(t)),t.init(),t}return(0,K.Z)(r,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ji.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(Ne.IMapService),this.sceneSerive=t.get(Ne.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&Ei(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var o=this;if(!this.added)return this.once("added",function(){o.setElement(t)}),this;var u=this.markerOption.element;return u&&Ei(u),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",function(){t.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",function(){t.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.anchor;this.updatePosition(),xu(o,"".concat(aa[u]))}}},{key:"onMapClick",value:function(t){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var t=this.markerOption,o=t.element,u=t.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var S=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=S.containerHeight,k=S.containerWidth,D=S.bounds;if(!D)return;if(Math.abs(D[0][0])>180||Math.abs(D[1][0])>180){if(x.x>k){var R=this.mapsService.lngLatToContainer([p-360,v]);x.x=R.x}if(x.x<0){var Z=this.mapsService.lngLatToContainer([p+360,v]);x.x=Z.x}}(x.x>k||x.x<0||x.y>A||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var t=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=Ci("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}Us(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(S){var A,k,D=((A=t.markerOption)===null||A===void 0?void 0:A.style)&&((k=t.markerOption)===null||k===void 0?void 0:k.style[S]);o&&(o.style[S]=D)}),hl(o,p,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){!this.mapsService||this.mapsService.version!=="GAODE2.x"||ml()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),r}(Ca.EventEmitter);function a3(e){var i=o3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function o3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s3=ei.merge,TR=function(e){(0,lt.Z)(r,e);var i=a3(r);function r(n){var t,o;return(0,xe.Z)(this,r),o=i.call(this),(0,F.Z)((0,Ie.Z)(o),"markers",[]),(0,F.Z)((0,Ie.Z)(o),"points",[]),(0,F.Z)((0,Ie.Z)(o),"clusterMarkers",[]),o.markerLayerOption=s3(o.getDefault(),n),wu(["update"],(0,Ie.Z)(o)),o.zoom=((t=o.markerLayerOption.clusterOption)===null||t===void 0?void 0:t.zoom)||-99,o}return(0,K.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(Ne.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var o=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(t,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=Vl(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var o=this.markers.indexOf(t);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(t){t.getElement().style.opacity="0"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(t){t.getElement().style.opacity="1"}),this.clusterMarkers.map(function(t){t.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach(function(o){o.addTo(t.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(t){t.remove()}),this.clusterMarkers.forEach(function(t){t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,o){var u=t.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,O.Z)((0,O.Z)({},t.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,o=t.radius,u=t.minZoom,l=u===void 0?0:u,p=t.maxZoom;this.clusterIndex=new(Vy())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,o){var u=this,l=t[0].concat(t[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,S=u.markerLayerOption.clusterOption,A=S.field,k=S.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var D,R=u.getLeaves((D=v.properties)===null||D===void 0?void 0:D.cluster_id);if(v.properties.clusterData=R,A&&k){var Z=R==null?void 0:R.map(function(Ve){var rt=(0,F.Z)({},A,Ve.properties[A]);return rt}),W=wc(Z,A),me=Qc(k,W),ge="point_"+k;v.properties[ge]=me.toFixed(2)}}var Ze=u.clusterMarker(v);u.clusterMarkers.push(Ze),Ze.addTo(u.scene)})}},{key:"getLeaves",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,o,u):null}},{key:"clusterMarker",value:function(t){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new Xy({element:p(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(t){var o=t.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var t=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Gs(this.bbox,o))&&(this.bbox=Vl(o,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var o=Ci("div","l7-marker-cluster"),u=Ci("div","",o),l=Ci("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;t.properties.point_count=t.properties.point_count||1;var S=v&&x?t.properties["point_"+x]||t.properties[v]:t.properties.point_count;return l.textContent=S,o}}]),r}(Ca.EventEmitter),MR=N(4157);function u3(e){var i=l3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sd=function(e){(0,lt.Z)(r,e);var i=u3(r);function r(n){var t;return(0,xe.Z)(this,r),t=i.call(this),r.controlCount++,t.controlOption=(0,O.Z)((0,O.Z)({},t.getDefault(n)),n||{}),t}return(0,K.Z)(r,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var o=this.getDefault(t);Object.entries(t).forEach(function(u){var l=(0,Qr.Z)(u,2),p=l[0],v=l[1];v===void 0&&(t[p]=o[p])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,O.Z)((0,O.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(Ne.IMapService),this.renderService=t.get(Ne.IRendererService),this.layerService=t.get(Ne.ILayerService),this.controlService=t.get(Ne.IControlService),this.configService=t.get(Ne.IGlobalConfigService),this.scene=t.get(Ne.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Us(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ei(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Ci("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Vs(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;Us(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:m.TOPRIGHT,name:"".concat(r.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:m.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=t,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var o=this.container,u=this.controlOption.className;u&&Vs(o,u),t&&Us(o,t)}},{key:"setStyle",value:function(t){var o=this.container;t?o.setAttribute("style",t):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,o=this.container;if(t instanceof Element)t.appendChild(o);else{var u=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(Hs());(0,F.Z)(sd,"controlCount",0);function c3(e){var i=f3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function f3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cm=function(e){(0,lt.Z)(r,e);var i=c3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"isDisable",!1),n}return(0,K.Z)(r,[{key:"setIsDisable",value:function(t){if(this.isDisable=t,t){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return Ci("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,o=t.title,u=t.btnText,l=t.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var o=t.title,u=t.btnText,l=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(u),(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",t!=null?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&Ei(this.buttonIcon),t){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(t,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(t)}this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(!!this.button)if(Vs(this.button,"l7-button-control--row"),Vs(this.button,"l7-button-control--column"),t){var o=this.buttonText;if(!o){var u;o=Ci("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=t,Us(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(Ei(this.buttonText),this.buttonText=void 0)}}]),r}(sd);function h3(e){var i=p3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yy=function(e){(0,lt.Z)(r,e);var i=h3(r);function r(n,t){var o;return(0,xe.Z)(this,r),o=i.call(this),(0,F.Z)((0,Ie.Z)(o),"isShow",!1),(0,F.Z)((0,Ie.Z)(o),"timeout",null),(0,F.Z)((0,Ie.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Vs(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&r.conflictPopperList.forEach(function(u){u!==(0,Ie.Z)(o)&&u.isShow&&u.hide()}),o.emit("show"),window.addEventListener("pointerdown",o.onPopperUnClick)),(0,Ie.Z)(o)}),(0,F.Z)((0,Ie.Z)(o),"hide",function(){return o.isShow&&(Us(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide"),window.removeEventListener("pointerdown",o.onPopperUnClick)),(0,Ie.Z)(o)}),(0,F.Z)((0,Ie.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,F.Z)((0,Ie.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,F.Z)((0,Ie.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,F.Z)((0,Ie.Z)(o),"onPopperUnClick",function(u){Nl(u.target,[".l7-button-control",".l7-popper-content"])||o.hide()}),(0,F.Z)((0,Ie.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,F.Z)((0,Ie.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=t,o.init(),t.unique&&r.conflictPopperList.push((0,Ie.Z)(o)),o}return(0,K.Z)(r,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(Hi(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ei(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,Qr.Z)(p,2),S=x[0],A=x[1],k=this.button.getBoundingClientRect(),D=u.getBoundingClientRect(),R=Sf(k,D),Z=R.left,W=R.right,me=R.top,ge=R.bottom,Ze=!1,Ve=!1;/^(left|right)/.test(v)?(v.includes("left")?t.right="".concat(k.width+W,"px"):v.includes("right")&&(t.left="".concat(k.width+Z,"px")),v.includes("start")?t.top="".concat(me,"px"):v.includes("end")?t.bottom="".concat(ge,"px"):(t.top="".concat(me+k.height/2,"px"),Ve=!0,t.transform="translate(".concat(S,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?t.bottom="".concat(k.height+ge,"px"):v.includes("bottom")&&(t.top="".concat(k.height+me,"px")),v.includes("start")?t.left="".concat(Z,"px"):v.includes("end")?t.right="".concat(W,"px"):(t.left="".concat(Z+k.width/2,"px"),Ze=!0,t.transform="translate(calc(".concat(S,"px - 50%), ").concat(A,"px)"))),t.transform="translate(calc(".concat(S,"px - ").concat(Ze?"50%":"0%","), calc(").concat(A,"px - ").concat(Ve?"50%":"0%",")");var rt=v.split("-");rt.length&&Us(this.popperDOM,rt.map(function(wt){return"l7-popper-".concat(wt)}).join(" ")),nu(this.popperDOM,au(t))}},{key:"createPopper",value:function(){var t=this.option,o=t.container,u=t.className,l=u===void 0?"":u,p=t.content,v=Ci("div","l7-popper l7-popper-hide ".concat(l)),x=Ci("div","l7-popper-content"),S=Ci("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(S),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),r}(Ca.EventEmitter);(0,F.Z)(Yy,"conflictPopperList",[]);function v3(e){var i=m3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function m3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g3={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},y3=function(e){(0,lt.Z)(r,e);var i=v3(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,ia.Z)((0,te.Z)(r.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var o,u=(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t),l=(o=t==null?void 0:t.position)!==null&&o!==void 0?o:u.position;return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:l instanceof Element?"bottom":g3[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new Yy(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){t.emit("popperShow",t)}).on("hide",function(){t.emit("popperHide",t)}),this.popper}},{key:"setOptions",value:function(t){if((0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),r}(cm);function _3(e){var i=x3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function x3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zh=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(zh||{}),qy=function(e){(0,lt.Z)(r,e);var i=_3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"selectValue",[]),(0,F.Z)((0,Ie.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=Ci("div","l7-select-control-item ".concat(p?zh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=Ci("span");return x.innerText=l.text,v.appendChild(x),v}),(0,F.Z)((0,Ie.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,_r.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,K.Z)(r,[{key:"setOptions",value:function(t){(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t);var o=t.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(t);this.optionDOMList.forEach(function(p){var v=p.getAttribute(zh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(Us(p,zh.ActiveOptionClassName),x&&bu(x,!0)):(Vs(p,zh.ActiveOptionClassName),x&&bu(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var o=this,u=this.isImageOptions(),l=Ci("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Us(l,"l7-select-control--multiple");var p=t.map(function(v,x){var S=u?o.createImageOption(v):o.createNormalOption(v);return S.setAttribute(zh.OptionValueAttrKey,v.value),S.setAttribute(zh.OptionIndexAttrKey,window.String(x)),S.addEventListener("click",o.onItemClick.bind(o,v)),S});return l.append.apply(l,(0,_r.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(t){var o=this.selectValue.includes(t.value),u=Ci("div","l7-select-control-item ".concat(o?zh.ActiveOptionClassName:"")),l=Ci("img");l.setAttribute("src",t.img),dc(l),u.appendChild(l);var p=Ci("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=Ci("span");return v.innerText=t.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(t){var o=Ci("input");return o.setAttribute("type","checkbox"),t&&bu(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(t){return t.img})}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),r}(y3),Yf=function(i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("l7-iconfont"),r.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),r.appendChild(n),r};function b3(e){var i=S3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w3=function(e){(0,lt.Z)(r,e);var i=b3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"onClick",(0,Pt.Z)(pe().mark(function l(){var p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,F.Z)((0,Ie.Z)(n),"mergeImage",(0,Pt.Z)(pe().mark(function l(){var p,v,x,S,A,k,D,R,Z,W,me,ge,Ze,Ve,rt=arguments;return pe().wrap(function(Ut){for(;;)switch(Ut.prev=Ut.next){case 0:for(x=n.controlOption.imageType,S=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},A=S.width,k=A===void 0?0:A,D=S.height,R=D===void 0?0:D,Z=document.createElement("canvas"),Z.width=k,Z.height=R,W=Z.getContext("2d"),me=rt.length,ge=new Array(me),Ze=0;Ze<me;Ze++)ge[Ze]=rt[Ze];return Ut.next=9,Promise.all(ge.map(function(Yt){return new Promise(function(mr){var fr=new Image;fr.onload=function(){mr(fr)},fr.src=Yt})}));case 9:return Ve=Ut.sent,Ve.forEach(function(Yt){W==null||W.drawImage(Yt,0,0,k,R)}),Ut.abrupt("return",Z.toDataURL("image/".concat(x)));case 12:case"end":return Ut.stop()}},l)}))),n}return(0,K.Z)(r,[{key:"onAdd",value:function(){var t=(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Yf("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return u=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage.apply(this,(0,_r.Z)([u,l].filter(function(x){return x}))));case 7:case"end":return v.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(cm);function E3(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=A3(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function A3(e,i){if(!!e){if(typeof e=="string")return Ky(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ky(e,i)}}function Ky(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Jy=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],qf=function(){if(typeof document=="undefined")return!1;for(var e=Jy[0],i={},r=0,n=Jy;r<n.length;r++){var t=n[r],o=t==null?void 0:t[1];if(o in document){var u=E3(t.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,Qr.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(S){u.e(S)}finally{u.f()}return i}}return!1}(),Qy={change:qf.fullscreenchange,error:qf.fullscreenerror},Il={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,r=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,t){var o=function l(){Il.off("change",l),n()};Il.on("change",o);var u=i[qf.requestFullscreen](r);u instanceof Promise&&u.then(o).catch(t)})},exit:function(){return new Promise(function(i,r){if(!Il.isFullscreen){i();return}var n=function o(){Il.off("change",o),i()};Il.on("change",n);var t=document[qf.exitFullscreen]();t instanceof Promise&&t.then(n).catch(r)})},toggle:function(i,r){return Il.isFullscreen?Il.exit():Il.request(i,r)},onchange:function(i){Il.on("change",i)},onerror:function(i){Il.on("error",i)},on:function(i,r){var n=Qy[i];n&&document.addEventListener(n,r,!1)},off:function(i,r){var n=Qy[i];n&&document.removeEventListener(n,r,!1)},raw:qf};Object.defineProperties(Il,{isFullscreen:{get:function(){return Boolean(document[qf.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[qf.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[qf.fullscreenEnabled])}}}),qf||(Il={isEnabled:!1});var h0=Il;function C3(e){var i=T3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function T3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M3=function(e){(0,lt.Z)(r,e);var i=C3(r);function r(n){var t;return(0,xe.Z)(this,r),t=i.call(this,n),(0,F.Z)((0,Ie.Z)(t),"isFullscreen",!1),(0,F.Z)((0,Ie.Z)(t),"toggleFullscreen",(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!h0.isEnabled){l.next=3;break}return l.next=3,h0.toggle(t.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,F.Z)((0,Ie.Z)(t),"onClick",function(){t.toggleFullscreen()}),(0,F.Z)((0,Ie.Z)(t),"onFullscreenChange",function(){t.isFullscreen=!!document.fullscreenElement;var o=t.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,S=o.exitTitle;t.isFullscreen?(t.setBtnTitle(S),t.setBtnText(v),t.setBtnIcon(x)):(t.setBtnTitle(p),t.setBtnText(u),t.setBtnIcon(l)),t.emit("fullscreenChange",t.isFullscreen)}),h0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),t}return(0,K.Z)(r,[{key:"setOptions",value:function(t){var o=t.exitBtnText,u=t.exitBtnIcon,l=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(l)),(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=vs(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){(0,ia.Z)((0,te.Z)(r.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5168\u5C4F",btnIcon:Yf("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Yf("l7-icon-exit-fullscreen")})}}]),r}(cm);function k3(e){var i=I3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function I3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P3=function(e){(0,lt.Z)(r,e);var i=k3(r);function r(n){var t;return(0,xe.Z)(this,r),t=i.call(this,n),(0,F.Z)((0,Ie.Z)(t),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,S=v.latitude;!isNaN(x)&&!isNaN(S)?o([x,S]):u()},function(l){u(l)})})}),(0,F.Z)((0,Ie.Z)(t),"onClick",(0,Pt.Z)(pe().mark(function o(){var u,l,p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=t.controlOption.transform,x.next=5,t.getGeoLocation();case 5:if(l=x.sent,p=t.mapsService.getZoom(),x.t0=t.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),t}return(0,K.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5B9A\u4F4D",btnIcon:Yf("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),r}(cm);function L3(e){var i=R3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function R3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e_=function(e){(0,lt.Z)(r,e);var i=L3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,F.Z)((0,Ie.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,F.Z)((0,Ie.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,K.Z)(r,[{key:"layers",get:function(){var t=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=t.getLayer(l)||t.getLayerByName(l);p&&u.push(p)}}),u}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Yf("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(t){return t.isVisible()}).map(function(t){return t.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(t){return{text:t.name,value:t.name}})}},{key:"setOptions",value:function(t){var o=this.checkUpdateOption(t,["layers"]);(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),r}(qy);function D3(e){var i=O3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t_=function(e){(0,lt.Z)(r,e);var i=D3(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getDefault",value:function(){return{position:m.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Ci("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(Hi(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var o=this.controlOption,u=o.href,l=o.img,p=Ci("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),dc(p),u){var v=Ci("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),t.appendChild(v)}else t.appendChild(p)}}]),r}(sd),F3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},B3={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function z3(e){var i=N3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function N3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z3=function(e){(0,lt.Z)(r,e);var i=z3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,K.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Yf("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t=this.mapsService.getType()==="mapbox"?B3:F3;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,Qr.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,Qr.Z)(o,2),p=l[0],v=l[1],x=(u=t[p])!==null&&u!==void 0?u:{},S=x.text,A=x.img;return{text:S!=null?S:p,value:v,img:A,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,o=this;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,ia.Z)((0,te.Z)(r.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),r}(qy);function U3(e){var i=V3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function V3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j3=function(e){(0,lt.Z)(r,e);var i=U3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"location",[0,0]),(0,F.Z)((0,Ie.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,K.Z)(r,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:m.BOTTOMLEFT,transform:function(u){var l=(0,Qr.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Ci("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),r}(sd);function G3(e){var i=H3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function H3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=function(e){(0,lt.Z)(r,e);var i=G3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),S=l.containerToLngLat([p,v]),A=Tf([x.lng,x.lat],[S.lng,S.lat]);n.updateScales(A)}),n}return(0,K.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:m.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",o=Ci("div",t);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var o=this.controlOption,u=o.metric,l=o.imperial;u&&t&&this.updateMetric(t),l&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){Hi(t);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&nu(t,"width: ".concat(p,"px")),u&&(this.mScale=Ci("div","l7-control-scale-line",t)),l&&(this.iScale=Ci("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,o,u){var l=this.controlOption.maxWidth;t.style.width=Math.round(l*u)+"px",t.innerHTML=o}},{key:"getRoundNum",value:function(t){var o=Math.pow(10,(Math.floor(t)+"").length-1),u=t/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(t){var o=this.getRoundNum(t),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/t)}},{key:"updateImperial",value:function(t){var o=t*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),r}(sd);function $3(e){var i=X3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function X3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y3=function(e){(0,lt.Z)(r,e);var i=$3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,F.Z)((0,Ie.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,F.Z)((0,Ie.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,K.Z)(r,[{key:"getDefault",value:function(t){return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{position:m.BOTTOMRIGHT,name:"zoom",zoomInText:Yf("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Yf("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(t){(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Ci("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){Hi(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,o,u,l,p){var v=Ci("button",u,l);return typeof t=="string"?v.innerHTML=t:v.append(t),v.title=o,p&&v.addEventListener("click",p),v}}]),r}(sd);function q3(e){var i=K3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function K3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p0=function(e){(0,lt.Z)(r,e);var i=q3(r);function r(n){var t;(0,xe.Z)(this,r),t=i.call(this),(0,F.Z)((0,Ie.Z)(t),"isShow",!0),(0,F.Z)((0,Ie.Z)(t),"onMouseMove",function(u){var l,p=t.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,S=x===void 0?0:x,A=v.top,k=A===void 0?0:A;t.setPopupPosition(u.clientX-S,u.clientY-k)}),(0,F.Z)((0,Ie.Z)(t),"updateLngLatPosition",function(){if(!(!t.mapsService||t.popupOption.followCursor)){var u=t.lngLat,l=u.lng,p=u.lat,v=t.mapsService.lngLatToContainer([l,p]),x=v.x,S=v.y;t.setPopupPosition(x,S)}}),(0,F.Z)((0,Ie.Z)(t),"onKeyDown",function(u){u.keyCode===27&&t.remove()}),(0,F.Z)((0,Ie.Z)(t),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),t.hide()}),(0,F.Z)((0,Ie.Z)(t),"update",function(){var u=!!t.lngLat,l=t.popupOption,p=l.className,v=l.style,x=l.maxWidth,S=l.anchor,A=l.stopPropagation;if(!(!t.mapsService||!u||!t.content)){var k=t.mapsService.getMarkerContainer();if(!t.container&&k&&(t.container=Ci("div","l7-popup ".concat(p!=null?p:""," ").concat(t.isShow?"":"l7-popup-hide"),k),v&&t.container.setAttribute("style",v),t.tip=Ci("div","l7-popup-tip",t.container),t.container.appendChild(t.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(Z){t.container.addEventListener(Z,function(W){W.stopPropagation()})}),t.container.style.whiteSpace="nowrap"),t.updateLngLatPosition(),xu(t.container,"".concat(aa[S])),hl(t.container,S,"popup"),x){var D=t.container.getBoundingClientRect(),R=D.width;R>parseFloat(x)&&(t.container.style.width=x)}else t.container.style.removeProperty("width")}}),t.popupOption=(0,O.Z)((0,O.Z)({},t.getDefault(n!=null?n:{})),n);var o=t.popupOption.lngLat;return o&&(t.lngLat=o),t}return(0,K.Z)(r,[{key:"lngLat",get:function(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(Ne.IMapService),this.sceneService=t.get(Ne.ISceneService),this.layerService=t.get(Ne.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&Ei(this.content),this.container&&(Ei(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,O.Z)((0,O.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ei(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Vs(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Us(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Ci("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Hi(this.contentTitle),vl(this.contentTitle,t)):this.contentTitle&&(Ei(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,o=t.lng,u=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var o=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ji.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),vl(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&Ei(this.content),this.contentTitle=void 0,this.content=Ci("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=Yf("l7-icon-guanbi");Us(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(u){t.hide()}),o.addEventListener("pointerup",function(u){u.stopPropagation()}),o.addEventListener("pointerdown",function(u){u.stopPropagation()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=Ci("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=t+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(t,o){return o.some(function(u){return u in t})}}]),r}(Ca.EventEmitter);function J3(e){var i=Q3();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Q3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eE=ei.get,kR=function(e){(0,lt.Z)(r,e);var i=J3(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"layerClickCountByFrame",0),(0,F.Z)((0,Ie.Z)(n),"layerConfigMap",new WeakMap),(0,F.Z)((0,Ie.Z)(n),"onLayerClick",function(l,p){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,p.featureId))n.hide();else{var v=n.getLayerInfoFrag(l,p),x=v.title,S=v.content;n.setDOMContent(S),n.setLnglat(p.lngLat),n.setTitle(x),n.displayFeatureInfo={layer:l,featureId:p.featureId},n.show()}})}),(0,F.Z)((0,Ie.Z)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),(0,F.Z)((0,Ie.Z)(n),"updateCloseOnClick",function(){}),n}return(0,K.Z)(r,[{key:"layerConfigItems",get:function(){var t,o=this.popupOption,u=o.config,l=o.items;return(t=u!=null?u:l)!==null&&t!==void 0?t:[]}},{key:"addTo",value:function(t){return(0,ia.Z)((0,te.Z)(r.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,ia.Z)((0,te.Z)(r.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),(0,ia.Z)((0,te.Z)(r.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var o=t.trigger==="click";return(0,O.Z)((0,O.Z)({},(0,ia.Z)((0,te.Z)(r.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,o=this.popupOption,u=o.trigger,l=o.closeOnClick;this.layerConfigItems.forEach(function(p){var v,x=t.getLayerByConfig(p);if(!!x){var S=(0,O.Z)({},p);if(u==="hover"){var A=t.onLayerMouseMove.bind(t,x),k=t.onLayerMouseOut.bind(t,x);S.onMouseMove=A,S.onMouseOut=k,x==null||x.on("mousemove",A),x==null||x.on("mouseout",k)}else{var D,R=t.onLayerClick.bind(t,x);S.onClick=R,x==null||x.on("click",R);var Z=(D=t.mapsService)===null||D===void 0?void 0:D.getMapContainer();Z&&l&&Z.addEventListener("click",t.onSceneClick)}var W=x==null||(v=x.getSource)===null||v===void 0?void 0:v.call(x),me=t.onSourceUpdate.bind(t,x);W==null||W.on("update",me),S.onSourceUpdate=me,t.layerConfigMap.set(x,S)}})}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach(function(o){var u,l=t.getLayerByConfig(o),p=l&&t.layerConfigMap.get(l);if(!!p){var v=p.onMouseMove,x=p.onMouseOut,S=p.onClick,A=p.onSourceUpdate;if(v&&l.off("mousemove",v),x&&l.off("mouseout",x),S&&l.off("click",S),A){var k;l==null||(k=l.getSource())===null||k===void 0||k.off("update",A)}var D=(u=t.mapsService)===null||u===void 0?void 0:u.getMapContainer();D&&D.removeEventListener("click",t.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(t,o){if(!this.isSameFeature(t,o.featureId)){var u=this.getLayerInfoFrag(t,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:t,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(t){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(t,o){var u=this.layerConfigMap.get(t),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var x=u.title,S=u.fields,A=u.customContent;if(x){l=document.createDocumentFragment();var k=x instanceof Function?x(v):x;vl(l,k)}if(A){var D=A instanceof Function?A(v):A;vl(p,D)}else S!=null&&S.length&&(S==null||S.forEach(function(R){var Z,W,me=typeof R=="string"?{field:R}:R,ge=me.field,Ze=me.formatField,Ve=me.formatValue,rt=me.getValue,wt=Ci("div","l7-layer-popup__row"),Ut=rt?rt(o.feature):eE(v,ge),Yt=(Z=Ze instanceof Function?Ze(ge,v):Ze)!==null&&Z!==void 0?Z:ge,mr=(W=Ve instanceof Function?Ve(Ut,v):Ve)!==null&&W!==void 0?W:Ut,fr=Ci("span","l7-layer-popup__key",wt);vl(fr,Yt),vl(fr,document.createTextNode("\uFF1A"));var Wr=Ci("span","l7-layer-popup__value",wt);Array.isArray(mr)&&mr.every(function(hn){return!(hn instanceof Object)})&&(mr=mr.map(function(hn){return String(hn)}).join(",")),vl(Wr,mr),p.appendChild(wt)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(t){var o=t.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(t,o){var u=this.displayFeatureInfo;return u&&t===u.layer&&o===u.featureId}}]),r}(p0);function tE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}tE(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Nh,r_=(Nh={},(0,F.Z)(Nh,Ge.additive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Nh,Ge.none,{enable:!1}),(0,F.Z)(Nh,Ge.normal,{enable:!0,func:{srcRGB:q.SRC_ALPHA,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Nh,Ge.subtractive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:q.ZERO,dstAlpha:q.ONE_MINUS_SRC_COLOR},equation:{rgb:q.FUNC_SUBTRACT,alpha:q.FUNC_SUBTRACT}}),(0,F.Z)(Nh,Ge.max,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MAX_EXT}}),(0,F.Z)(Nh,Ge.min,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MIN_EXT}}),Nh),oc=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({}),n_=ei.cloneDeep;function rE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=jl(r),t=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return t}function nE(e,i,r){if(e.length>0&&i.version===oc["GAODE2.x"]){var n=r.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=oc["GAODE2.x"],t.originCoordinates=n_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)}):e.filter(function(t){return!t.originCoordinates}).map(function(t){t.version=oc["GAODE2.x"],t.originCoordinates=n_(t.coordinates),t.coordinates=i.coordToAMap2RelativeCoordinates(t.coordinates,n)})}}function iE(e,i){e.length>0&&i.version===oc.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=aE(r.coordinates,i),r.simpleCoordinate=!0)})}function aE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(t){var o=[];t.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),r.push(o)}),r}else{var n=[];return e.map(function(t){n.push(i.simpleMapCoord.unproject(t))}),n}}function oE(e,i){var r;if(!e.scale)return[];var n=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],t=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&t.push(i[p])});var o=e.mapping?e.mapping(t):[];return o}function sE(e,i,r,n,t){var o=t==null?void 0:t.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(k){return k.scale!==void 0}).forEach(function(k){var D=oE(k,v);k.needRemapping=!1,k.name==="color"&&(D=D.map(function(R){return qn(R)})),x[k.name]=Array.isArray(D)&&D.length===1?D[0]:D,k.name==="shape"&&(x.shape=r.getIconFontKey(x[k.name]))}),x.shape==="line"&&l.enable){var S=x.coordinates,A=rE(S[0],S[1]);x.coordinates.splice(1,0,A,A)}return x});return nE(p,n,t),iE(p,n),p}function uE(e,i,r,n,t,o){var u=new f0(t,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=sE(l,v,i,r,e);return u.destroy(),x}function i_(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function a_(e,i,r,n){var t=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?t.add(n("taa")):t.add(n("render")),i_(i).forEach(function(l){var p=(0,Qr.Z)(l,2),v=p[0],x=p[1];t.add(r(v),x)}),t.add(r("copy")),t}var lE=function(){function e(i){(0,xe.Z)(this,e),this.layer=i}return(0,K.Z)(e,[{key:"pickRender",value:function(r){var n=this.layer.getContainer(),t=n.get(Ne.ILayerService),o=this.layer;if(o.tileLayer)return o.tileLayer.pickRender(r);o.hooks.beforePickingEncode.call(),t.renderTileLayerMask(o),o.renderModels({ispick:!0}),o.hooks.afterPickingEncode.call()}},{key:"pick",value:function(r,n){var t=this.layer.getContainer(),o=t.get(Ne.IPickingService);return r.type==="RasterLayer"?this.pickRasterLayer(r,n):(this.pickRender(n),o.pickFromPickingFBO(r,n))}},{key:"pickRasterLayer",value:function(r,n,t){var o=this.layer.getContainer(),u=o.get(Ne.IPickingService),l=o.get(Ne.IMapService),p=this.layer.getSource().extent,v=Af(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},S=t||r;if(v){var A=this.readRasterValue(r,p,l,n.x,n.y);return x.rasterValue=A,u.triggerHoverOnLayer(S,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(S,(0,O.Z)((0,O.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(S,x),!1}},{key:"readRasterValue",value:function(r,n,t,o,u){var l=r.getSource().data.dataArray[0],p=(0,Qr.Z)(n,4),v=p[0],x=v===void 0?0:v,S=p[1],A=S===void 0?0:S,k=p[2],D=k===void 0?10:k,R=p[3],Z=R===void 0?-10:R,W=t.lngLatToContainer([x,A]),me=t.lngLatToContainer([D,Z]),ge=me.x-W.x,Ze=W.y-me.y,Ve=[(o-W.x)/ge,(u-me.y)/Ze],rt=l.width||1,wt=l.height||1,Ut=Math.floor(Ve[0]*rt),Yt=Math.floor(Ve[1]*wt),mr=Math.max(0,Yt-1)*rt+Ut,fr=l.data[mr];return fr}},{key:"selectFeature",value:function(r){var n=this.layer,t=(0,Qr.Z)(r,3),o=t[0],u=t[1],l=t[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(r){var n=(0,Qr.Z)(r,3),t=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([t,o,u])}},{key:"getFeatureById",value:function(r){return this.layer.getSource().getFeatureById(r)}}]),e}(),cE=function(){function e(i){(0,xe.Z)(this,e),this.layer=i;var r=this.layer.getContainer();this.rendererService=r.get(Ne.IRendererService)}return(0,K.Z)(e,[{key:"getColorTexture",value:function(r,n){var t=this.getTextureKey(r,n);return this.key===t?this.colorTexture:(this.createColorTexture(r,n),this.key=t,this.colorTexture)}},{key:"createColorTexture",value:function(r,n){var t=this.rendererService.createTexture2D,o=this.getColorRampBar(r,n),u=t({data:new Uint8Array(o.data),width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(r,n,t){this.key=this.getTextureKey(n,t),this.colorTexture=r}},{key:"destroy",value:function(){var r;(r=this.colorTexture)===null||r===void 0||r.destroy()}},{key:"getColorRampBar",value:function(r,n){switch(r.type){case"cat":return Po(r);case"quantize":return go(r);case"custom":return Cs(r,n);case"linear":return Gi(r,n);default:return Mo(r)}}},{key:"getTextureKey",value:function(r,n){var t;return"".concat(r.colors.join("_"),"_").concat(r==null||(t=r.positions)===null||t===void 0?void 0:t.join("_"),"_").concat(r.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),fE=["passes"],hE=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"],o_,d0,s_;function pE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=dE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function dE(e,i){if(!!e){if(typeof e=="string")return u_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u_(e,i)}}function u_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function vE(e){var i=mE();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function mE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v0=ei.isEqual,l_=ei.isFunction,c_=ei.isNumber,tu=ei.isObject,gE=ei.isPlainObject,yE=ei.isUndefined,f_=0,Zh=(o_=u0(Ne.IGlobalConfigService),d0=function(e){(0,lt.Z)(r,e);var i=vE(r);function r(){var n,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,xe.Z)(this,r),n=i.call(this),(0,F.Z)((0,Ie.Z)(n),"id","".concat(f_++)),(0,F.Z)((0,Ie.Z)(n),"name","".concat(f_)),(0,F.Z)((0,Ie.Z)(n),"visible",!0),(0,F.Z)((0,Ie.Z)(n),"zIndex",0),(0,F.Z)((0,Ie.Z)(n),"inited",!1),(0,F.Z)((0,Ie.Z)(n),"layerModelNeedUpdate",!1),(0,F.Z)((0,Ie.Z)(n),"pickedFeatureID",null),(0,F.Z)((0,Ie.Z)(n),"selectedFeatureID",null),(0,F.Z)((0,Ie.Z)(n),"styleNeedUpdate",!1),(0,F.Z)((0,Ie.Z)(n),"forceRender",!1),(0,F.Z)((0,Ie.Z)(n),"clusterZoom",0),(0,F.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,F.Z)((0,Ie.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,F.Z)((0,Ie.Z)(n),"hooks",{init:new d2,afterInit:new ig,beforeRender:new ig,beforeRenderData:new v2,afterRender:new pf,beforePickingEncode:new pf,afterPickingEncode:new pf,beforeHighlight:new pf(["pickedColor"]),afterHighlight:new pf,beforeSelect:new pf(["pickedColor"]),afterSelect:new pf,beforeDestroy:new pf,afterDestroy:new pf}),(0,F.Z)((0,Ie.Z)(n),"models",[]),(0,F.Z)((0,Ie.Z)(n),"startInit",!1),(0,F.Z)((0,Ie.Z)(n),"layerChildren",[]),(0,F.Z)((0,Ie.Z)(n),"masks",[]),nn((0,Ie.Z)(n),"configService",s_,(0,Ie.Z)(n)),(0,F.Z)((0,Ie.Z)(n),"animateOptions",{enable:!1}),(0,F.Z)((0,Ie.Z)(n),"currentPickId",null),(0,F.Z)((0,Ie.Z)(n),"encodeStyleAttribute",{}),(0,F.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",[]),(0,F.Z)((0,Ie.Z)(n),"enableDataEncodeStyles",[]),(0,F.Z)((0,Ie.Z)(n),"enablg",[]),(0,F.Z)((0,Ie.Z)(n),"pendingStyleAttributes",[]),(0,F.Z)((0,Ie.Z)(n),"scaleOptions",{}),(0,F.Z)((0,Ie.Z)(n),"animateStatus",!1),(0,F.Z)((0,Ie.Z)(n),"isDestroyed",!1),(0,F.Z)((0,Ie.Z)(n),"encodeDataLength",0),(0,F.Z)((0,Ie.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=t.name||n.id,n.zIndex=t.zIndex||0,n.rawConfig=t,n}return(0,K.Z)(r,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var o=this.masks.indexOf(t);o>-1&&this.masks.splice(o,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var o=this;if(Object.keys(t).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=t[l])}),!this.startInit)this.needUpdateConfig=(0,O.Z)((0,O.Z)({},this.needUpdateConfig),t);else{var u=this.container.get(Ne.SceneID);this.configService.setLayerConfig(u,this.id,(0,O.Z)((0,O.Z)((0,O.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(t,o){this.container=t,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u=this,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:l=this.container.get(Ne.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ne.IIconService),this.fontService=this.container.get(Ne.IFontService),this.rendererService=this.container.get(Ne.IRendererService),this.layerService=this.container.get(Ne.ILayerService),this.debugService=this.container.get(Ne.IDebugService),this.interactionService=this.container.get(Ne.IInteractionService),this.pickingService=this.container.get(Ne.IPickingService),this.mapService=this.container.get(Ne.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(Ne.ICameraService),this.coordinateService=this.container.get(Ne.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ne.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ne.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ne.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ne.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(Ne.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(Z){var W=Z.attributeName,me=Z.attributeField,ge=Z.attributeValues,Ze=Z.updateOptions;u.styleAttributeService.updateStyleAttribute(W,{scale:(0,O.Z)({field:me},u.splitValuesAndCallbackInAttribute(ge,me?void 0:u.getLayerConfig()[W]))},Ze)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ne.ILayerPlugin),S=pE(this.plugins);try{for(S.s();!(A=S.n()).done;)k=A.value,k.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(Z){S.e(Z)}finally{S.f()}return this.layerPickService=new lE(this),this.textureService=new cE(this),this.log(as.LayerInitStart),R.next=31,this.hooks.init.promise();case 31:this.log(as.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"log",value:function(t){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(u,".").concat(t),p={id:this.id,type:this.type};(o=this.debugService)===null||o===void 0||o.log(l,p)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models.map(function(o){o.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}},{key:"createModelData",value:function(t,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(t,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,o){return this.inited?uE(this,this.fontService,this.mapService,this.styleAttributeService,t,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var t=this.getLayerConfig(),o=t.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,o,u){return this.updateStyleAttribute("color",t,o,u),this}},{key:"texture",value:function(t,o,u){return this.updateStyleAttribute("texture",t,o,u),this}},{key:"rotate",value:function(t,o,u){return this.updateStyleAttribute("rotate",t,o,u),this}},{key:"size",value:function(t,o,u){return this.updateStyleAttribute("size",t,o,u),this}},{key:"filter",value:function(t,o,u){var l=this.updateStyleAttribute("filter",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(t,o,u){this.shapeOption={field:t,values:o};var l=this.updateStyleAttribute("shape",t,o,u);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(t,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(t){var o={};return tu(t)?(o.enable=!0,o=(0,O.Z)((0,O.Z)({},o),t)):o.enable=t,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(t,o){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(t,o){var u=this;return this.inited?(this.log(as.SourceInitStart,Lt.UPDATE),this.layerSource.setData(t,o),this.log(as.SourceInitEnd,Lt.UPDATE)):this.on("inited",function(){u.log(as.SourceInitStart,Lt.UPDATE);var l=u.getSource();l?u.layerSource.setData(t,o):u.source(new f0(t,o)),u.layerSource.once("update",function(){u.log(as.SourceInitEnd,Lt.UPDATE)})}),this}},{key:"style",value:function(t){var o=this,u=t.passes,l=(0,ll.Z)(t,fE);u&&i_(u).forEach(function(v){var x=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(v[0]);x&&x.updateOptions(v[1])});var p=l;return Object.keys(l).forEach(function(v){var x=l[v];Array.isArray(x)&&x.length===2&&!c_(x[0])&&!c_(x[1])&&(p[v]={field:x[0],value:x[1]})}),this.encodeStyle(p),this.updateLayerConfig(p),this}},{key:"encodeStyle",value:function(t){var o=this;Object.keys(t).forEach(function(u){[].concat((0,_r.Z)(o.enableShaderEncodeStyles),(0,_r.Z)(o.enableDataEncodeStyles)).includes(u)&&gE(t[u])&&(t[u].field||t[u].value)&&!v0(o.encodeStyleAttribute[u],t[u])?(o.encodeStyleAttribute[u]=t[u],o.updateStyleAttribute(u,t[u].field,t[u].value),o.inited&&(o.dataState.dataMappingNeedUpdate=!0)):o.encodeStyleAttribute[u]&&(delete o.encodeStyleAttribute[u],o.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(t,o){var u=(0,O.Z)({},this.scaleOptions);if(tu(t)?this.scaleOptions=(0,O.Z)((0,O.Z)({},this.scaleOptions),t):this.scaleOptions[t]=o,this.styleAttributeService&&!v0(u,this.scaleOptions)){var l=tu(t)?t:(0,F.Z)({},t,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}},{key:"renderMultiPass",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"active",value:function(t){var o={};return o.enableHighlight=tu(t)?!0:t,tu(t)?(o.enableHighlight=!0,t.color&&(o.highlightColor=t.color),t.mix&&(o.activeMix=t.mix)):o.enableHighlight=!!t,this.updateLayerConfig(o),this}},{key:"setActive",value:function(t,o){var u=this;if(tu(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:tu(o)?o.color:this.getLayerConfig().highlightColor,activeMix:tu(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:tu(o)?o.color:this.getLayerConfig().highlightColor,activeMix:tu(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Qi(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(t){var o={};return o.enableSelect=tu(t)?!0:t,tu(t)?(o.enableSelect=!0,t.color&&(o.selectColor=t.color),t.mix&&(o.selectMix=t.mix)):o.enableSelect=!!t,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(t,o){var u=this;if(tu(t)){var l=t.x,p=l===void 0?0:l,v=t.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:tu(o)?o.color:this.getLayerConfig().selectColor,selectMix:tu(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:tu(o)?o.color:this.getLayerConfig().selectColor,selectMix:tu(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Qi(t)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&t>=p&&t<x}},{key:"setMultiPass",value:function(t,o){if(this.updateLayerConfig({enableMultiPassRenderer:t}),o&&this.updateLayerConfig({passes:o}),t){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=a_(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,S=v.height;this.multiPassRenderer.resize(x,S)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),o=t.minZoom;return o}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),o=t.maxZoom;return o}},{key:"get",value:function(t){var o=this.getLayerConfig();return o[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],t),this)}},{key:"destroy",value:function(){var t,o,u,l,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){this.layerChildren.map(function(S){return S.destroy(!1)}),this.layerChildren=[];var v=this.getLayerConfig(),x=v.maskfence;x&&(this.masks.map(function(S){return S.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(t=this.multiPassRenderer)===null||t===void 0||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(p),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(l=this.debugService)===null||l===void 0||l.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach(function(o){return o.destroy()}),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices}).length}},{key:"setSource",value:function(t){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}if(p==="update"){if(o.tileLayer){o.tileLayer.reload();return}o.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(t),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var o=this.styleAttributeService.getLayerAttributeScale(t);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,F.Z)({value:o.invertExtent(v)},t,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,F.Z)({value:v},t,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!yE(v)}).map(function(v){return(0,F.Z)({value:v},t,o(v))});return p}return[]}},{key:"pick",value:function(t){var o=t.x,u=t.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(t,o){this.pickingService.boxPickLayer(this,t,o)}},{key:"buildLayerModel",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l=this,p,v,x,S,A,k,D,R,Z,W,me,ge;return pe().wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,S=u.inject,A=u.triangulation,k=u.segmentNumber,D=(0,ll.Z)(u,hE),this.shaderModuleService.registerModule(p,{vs:v,fs:x,inject:S}),R=this.shaderModuleService.getModule(p),Z=R.vs,W=R.fs,me=R.uniforms,ge=this.rendererService.createModel,Ve.abrupt("return",new Promise(function(rt){var wt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,k),Ut=wt.attributes,Yt=wt.elements,mr=wt.count,fr=(0,O.Z)({attributes:Ut,uniforms:me,fs:W,vs:Z,elements:Yt,blend:r_[Ge.normal]},D);mr&&(fr.count=mr);var Wr=ge(fr);rt(Wr)}));case 5:case"end":return Ve.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"createAttributes",value:function(t){var o=t.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&v&&(x=!0),t==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderMulPass",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)},(o==null?void 0:o.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,o,u,l){var p=this.configService.getAttributeConfig(this.id)||{};return v0(p[t],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,(0,F.Z)({},t,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,O.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:t,attributeField:o,attributeValues:u,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){console.warn("empty fn")}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,o){return{values:l_(t)?void 0:t,callback:l_(t)?t:void 0}}}]),r}(Ca.EventEmitter),s_=jr(d0.prototype,"configService",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d0);function _E(e,i){return{enable:e,mask:255,func:{cmp:q.EQUAL,ref:i?1:0,mask:1}}}function h_(e){return e.maskOperation===kt.OR?{enable:!0,mask:255,func:{cmp:q.ALWAYS,ref:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===dt.SINGLE||e.stencilIndex===0?q.ALWAYS:q.LESS,ref:e.stencilType===dt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:q.KEEP,zfail:q.REPLACE,zpass:q.REPLACE}}}function xE(e){switch(e){case"rotation":return{name:"Rotation",type:ln.Attribute,descriptor:{name:"a_Rotation",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.rotation,t=n===void 0?0:n;return Array.isArray(t)?[t[0]]:[t]}}};case"stroke":return{name:"stroke",type:ln.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(r){var n=r.stroke,t=n===void 0?[1,1,1,1]:n;return t}}};case"opacity":return{name:"opacity",type:ln.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.opacity,t=n===void 0?1:n;return[t]}}};case"extrusionBase":return{name:"extrusionBase",type:ln.Attribute,descriptor:{name:"a_ExtrusionBase",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r){var n=r.extrusionBase,t=n===void 0?0:n;return[t]}}};case"offsets":return{name:"offsets",type:ln.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(r){var n=r.offsets;return n}}};default:return}}var p_,m0,d_,ca=(p_=u0(Ne.IGlobalConfigService),m0=function(){function e(i){(0,xe.Z)(this,e),(0,F.Z)(this,"preStyleAttribute",{}),(0,F.Z)(this,"encodeStyleAttribute",{}),nn(this,"configService",d_,this),this.layer=i,this.rendererService=i.getContainer().get(Ne.IRendererService),this.pickingService=i.getContainer().get(Ne.IPickingService),this.shaderModuleService=i.getContainer().get(Ne.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ne.IStyleAttributeService),this.mapService=i.getContainer().get(Ne.IMapService),this.iconService=i.getContainer().get(Ne.IIconService),this.fontService=i.getContainer().get(Ne.IFontService),this.cameraService=i.getContainer().get(Ne.ICameraService),this.layerService=i.getContainer().get(Ne.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r}return(0,K.Z)(e,[{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,t=n===void 0?"normal":n;return r_[Ge[t]]}},{key:"getStencil",value:function(r){var n=this.layer.getLayerConfig(),t=n.mask,o=t===void 0?!1:t,u=n.maskInside,l=u===void 0?!0:u,p=n.enableMask,v=n.maskOperation,x=v===void 0?kt.AND:v;if(this.layer.type==="MaskLayer")return h_({isStencil:!0,stencilType:dt.SINGLE});if(r.isStencil)return h_((0,O.Z)((0,O.Z)({},r),{},{maskOperation:x}));var S=o||p&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return _E(S,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){return pe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){return pe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){return pe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function r(){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(r){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var r=this.layer.encodeStyleAttribute,n="",t={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float"};this.layer.enableShaderEncodeStyles.forEach(function(u){r[u]&&(n+="#define USE_ATTRIBUTE_".concat(u.toUpperCase(),` 0.0; 

`)),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
      attribute `).concat(t[u]," a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
    #else
      uniform `).concat(t[u]," u_").concat(u,`;
    #endif

    `)});var o="";return this.layer.enableShaderEncodeStyles.forEach(function(u){o+=`

#ifdef USE_ATTRIBUTE_`.concat(u.toUpperCase(),`
  `).concat(t[u]," ").concat(u,"  = a_").concat(u.charAt(0).toUpperCase()+u.slice(1),`;
#else
  `).concat(t[u]," ").concat(u," = u_").concat(u,`;
#endif

`)}),{"vs:#decl":n,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var r=this,n={},t={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0};return this.layer.enableShaderEncodeStyles.forEach(function(o){if(!r.layer.encodeStyleAttribute[o]){var u=r.layer.getLayerConfig()[o],l=typeof u=="undefined"?t[o]:u;o==="stroke"&&(l=qn(l)),n["u_"+o]=l}}),n}},{key:"registerStyleAttribute",value:function(){var r=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var t=xE(n);t&&r.styleAttributeService.registerStyleAttribute(t)})}},{key:"updateEncodeAttribute",value:function(r,n){this.encodeStyleAttribute[r]=n}}]),e}(),d_=jr(m0.prototype,"configService",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m0),g0=100,IR=36,PR=40;function v_(e){return e/180*Math.acos(-1)}function m_(e){var i=v_(e[0])+Math.PI/2,r=v_(e[1]),n=g0+Math.random()*.4,t=n*Math.cos(r)*Math.cos(i),o=n*Math.cos(r)*Math.sin(i),u=n*Math.sin(r);return[o,u,t]}function LR(e,i){var r=mat4.create(),n=mat4.create(),t=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],S=[],A=[],k=[],D=[],R=0;R<=l;R++){for(var Z=R/l,W=Z*Math.PI,me=0;me<=p;me++){var ge=me/p,Ze=ge*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-W),mat4.identity(r),mat4.rotateY(r,r,Ze),vec3.transformMat4(o,t,n),vec3.transformMat4(o,o,r),vec3.scale(o,o,-e),S.push(o.slice()),A.push.apply(A,_toConsumableArray(o.slice())),vec3.normalize(o,o),k.push.apply(k,_toConsumableArray(o.slice())),D.push([ge,1-Z]),A.push(ge,1-Z)}if(R>0)for(var Ve=S.length,rt=Ve-2*(p+1);rt+p+2<Ve;rt++)v.push([rt,rt+1,rt+p+1]),x.push(rt,rt+1,rt+p+1),v.push([rt+p+1,rt+1,rt+p+2]),x.push(rt+p+1,rt+1,rt+p+2)}return{cells:v,positions:S,uvs:D,positionsArr:A,indicesArr:x,normalArr:k}}var fm=Mr.create(),RR=Mr.create(),ds=Mr.create(),Uh=Mr.create(),ud=Mr.create();function y0(e,i,r,n,t){Mr.add(e,r,n),Mr.normalize(e,e),i=Mr.fromValues(-e[1],e[0]);var o=Mr.fromValues(-r[1],r[0]);return[t/Mr.dot(i,o),i]}function Vh(e,i){return Mr.set(e,-i[1],i[0])}function ld(e,i,r){return Mr.sub(e,i,r),Mr.normalize(e,e),e}function _0(e,i){return e[0]===i[0]&&e[1]===i[1]}function DR(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var bE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xe.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",Mr.fromValues(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,K.Z)(e,[{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,_r.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,W=this.simpleSegment(t,u,S,k,R,A,D,Z);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude_gaode2",value:function(r,n){var t=this.complex;if(r.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=t.startIndex,l=1;l<o;l++){var p,v,x,S=r[l-1];S.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],k=r[l];k.push((v=n[l][2])!==null&&v!==void 0?v:0);var D=n[l],R=l<r.length-1?[].concat((0,_r.Z)(r[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,Z=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(t,u,S,k,R,A,D,Z);u+=W}if(this.dash)for(var me=0;me<t.positions.length/6;me++)t.positions[me*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var t=r.length,o=n.startIndex,u=1;u<t;u++){var l=r[u-1],p=r[u],v=u<r.length-1?r[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var S=0;S<n.positions.length/6;S++)n.positions[S*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=_o([o[0],o[1]]),A=_o([t[0],t[1]]);ld(ds,S,A);var k=0;if(this.dash&&(k=this.lineSegmentDistance(S,A),this.totalDistance+=k),this.normal||(this.normal=Mr.create(),Vh(this.normal,ds)),this.started||(this.started=!0,this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-k)),p.push(n+0,n+1,n+2),!u)Vh(this.normal,ds),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var D=_o([u[0],u[1]]);_0(S,D)&&Mr.add(D,S,Mr.normalize(D,Mr.subtract(D,S,A))),ld(Uh,D,S);var R=y0(ud,Mr.create(),ds,Uh,this.thickness),Z=(0,Qr.Z)(R,2),W=Z[0],me=Z[1],ge=Mr.dot(ud,this.normal)<0?-1:1;this.extrusions(v,x,o,me,W,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ge=-1,Mr.copy(this.normal,me),l+=2,this.lastFlip=ge}return l}},{key:"segment_gaode2",value:function(r,n,t,o,u,l,p,v){var x=0,S=r.indices,A=r.positions,k=r.normals,D=this.cap==="square",R=this.join==="bevel",Z=_o([p[0],p[1]]),W=_o([l[0],l[1]]);ld(ds,o,t);var me=0;if(this.dash&&(me=this.lineSegmentDistance(Z,W),this.totalDistance+=me),this.normal||(this.normal=Mr.create(),Vh(this.normal,ds)),!this.started)if(this.started=!0,D){var ge=Mr.create(),Ze=Mr.create();Mr.add(ge,this.normal,ds),Mr.add(Ze,this.normal,ds),k.push(Ze[0],Ze[1],0),k.push(ge[0],ge[1],0),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),A.push(t[0],t[1],t[2]|0,this.totalDistance-me,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,t,this.normal,this.thickness,this.totalDistance-me);if(S.push(n+0,n+1,n+2),u){_0(o,u)&&Mr.add(u,o,Mr.normalize(u,Mr.subtract(u,o,t))),ld(Uh,u,o);var wt=y0(ud,Mr.create(),ds,Uh,this.thickness),Ut=(0,Qr.Z)(wt,2),Yt=Ut[0],mr=Ut[1],fr=Mr.dot(ud,this.normal)<0?-1:1,Wr=R;if(!Wr&&this.join==="miter"){var hn=Yt;hn>this.miterLimit&&(Wr=!0)}Wr?(k.push(this.normal[0],this.normal[1],0),k.push(mr[0],mr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,S.push.apply(S,(0,_r.Z)(this.lastFlip!==-fr?[n,n+2,n+3]:[n+2,n+1,n+3])),S.push(n+2,n+3,n+4),Vh(fm,Uh),Mr.copy(this.normal,fm),k.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*fr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,k,o,mr,Yt,this.totalDistance),S.push.apply(S,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),fr=-1,Mr.copy(this.normal,mr),x+=2),this.lastFlip=fr}else{if(Vh(this.normal,ds),D){var Ve=Mr.create(),rt=Mr.create();Mr.sub(rt,ds,this.normal),Mr.add(Ve,ds,this.normal),k.push(rt[0],rt[1],0),k.push(Ve[0],Ve[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,k,o,this.normal,this.thickness,this.totalDistance);S.push.apply(S,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(r,n,t,o,u){var l=0,p=r.indices,v=r.positions,x=r.normals,S=this.cap==="square",A=this.join==="bevel",k=_o([o[0],o[1]]),D=_o([t[0],t[1]]);ld(ds,k,D);var R=0;if(this.dash&&(R=this.lineSegmentDistance(k,D),this.totalDistance+=R),this.normal||(this.normal=Mr.create(),Vh(this.normal,ds)),!this.started)if(this.started=!0,S){var Z=Mr.create(),W=Mr.create();Mr.add(Z,this.normal,ds),Mr.add(W,this.normal,ds),x.push(W[0],W[1],0),x.push(Z[0],Z[1],0),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,-this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),v.push(t[0],t[1],t[2]|0,this.totalDistance-R,this.thickness,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,t,this.normal,this.thickness,this.totalDistance-R);if(p.push(n+0,n+1,n+2),u){var Ze=_o([u[0],u[1]]);_0(k,Ze)&&Mr.add(Ze,k,Mr.normalize(Ze,Mr.subtract(Ze,k,D))),ld(Uh,Ze,k);var Ve=y0(ud,Mr.create(),ds,Uh,this.thickness),rt=(0,Qr.Z)(Ve,2),wt=rt[0],Ut=rt[1],Yt=Mr.dot(ud,this.normal)<0?-1:1,mr=A;if(!mr&&this.join==="miter"){var fr=wt;fr>this.miterLimit&&(mr=!0)}mr?(x.push(this.normal[0],this.normal[1],0),x.push(Ut[0],Ut[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,_r.Z)(this.lastFlip!==-Yt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Vh(fm,Uh),Mr.copy(this.normal,fm),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Yt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Ut,wt,this.totalDistance),p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Yt=-1,Mr.copy(this.normal,Ut),l+=2),this.lastFlip=Yt}else{if(Vh(this.normal,ds),S){var me=Mr.create(),ge=Mr.create();Mr.sub(ge,ds,this.normal),Mr.add(me,ds,this.normal),x.push(ge[0],ge[1],0),x.push(me[0],me[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,_r.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(r,n,t,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),r.push(t[0],t[1],t[2]|0,l,-u,t[2]|0),this.complex.indexes.push(this.currentIndex),r.push(t[0],t[1],t[2]|0,l,u,t[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var t=n[0]-r[0],o=n[1]-r[1];return Math.sqrt(t*t+o*o)}}]),e}(),ma=N(77160);function SE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,t=ko().flatten(e),o=t.vertices,u=t.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=ko()(t.vertices,t.holes,t.dimensions);p.push.apply(p,(0,_r.Z)(x));for(var S=function(){var D=t.vertices.slice(A*u,(A+1)*u),R=t.vertices.slice((A+1)*u,(A+2)*u);R.length===0&&(R=t.vertices.slice(0,u));var Z=l.length/3;l.push(D[0],D[1],1,R[0],R[1],1,D[0],D[1],0,R[0],R[1],0),p.push.apply(p,(0,_r.Z)([0,2,1,2,3,1].map(function(W){return W+Z})))},A=0;A<n;A++)S();return{positions:l,index:p}}function wE(e){var i=ko().flatten(e),r=ko()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function g_(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var t=e[0].length,o=ko().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],S=0;S<u.length/l;S++)p.push(u[S*l],u[S*l+1],1,-1,-1),x.push(0,0,1);var A=ko()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,_r.Z)(A));for(var k=function(){var Z=o.vertices.slice(D*l,(D+1)*l),W=o.vertices.slice((D+1)*l,(D+2)*l);W.length===0&&(W=o.vertices.slice(0,l));var me=p.length/5;p.push(Z[0],Z[1],1,0,0,W[0],W[1],1,.1,0,Z[0],Z[1],0,0,.8,W[0],W[1],0,.1,.8);var ge=EE([W[0],W[1],1],[Z[0],Z[1],0],[Z[0],Z[1],1],i);x.push.apply(x,(0,_r.Z)(ge).concat((0,_r.Z)(ge),(0,_r.Z)(ge),(0,_r.Z)(ge))),v.push.apply(v,(0,_r.Z)([1,2,0,3,2,1].map(function(Ze){return Ze+me})))},D=0;D<t;D++)k();return{positions:p,index:v,normals:x}}function EE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=ma.create(),o=ma.create(),u=ma.create();n&&(e=ju(e),i=ju(i),r=ju(r));var l=ma.fromValues.apply(ma,(0,_r.Z)(e)),p=ma.fromValues.apply(ma,(0,_r.Z)(i)),v=ma.fromValues.apply(ma,(0,_r.Z)(r));ma.sub(t,v,p),ma.sub(o,l,p),ma.cross(u,t,o);var x=ma.create();return ma.normalize(x,u),x}var sc,fv=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),hv=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function pv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],t=0;t<e;t++)n.push(r*t+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function y_(){return pv(30)}function __(){return pv(4)}function x_(){return pv(3)}function b_(){return pv(6,1)}function S_(){return pv(5)}var cd=(sc={},(0,F.Z)(sc,hv.CIRCLE,y_),(0,F.Z)(sc,hv.HEXAGON,b_),(0,F.Z)(sc,hv.TRIANGLE,x_),(0,F.Z)(sc,hv.SQUARE,__),(0,F.Z)(sc,hv.PENTAGON,S_),(0,F.Z)(sc,fv.CYLINDER,y_),(0,F.Z)(sc,fv.HEXAGONCOLUMN,b_),(0,F.Z)(sc,fv.TRIANGLECOLUMN,x_),(0,F.Z)(sc,fv.SQUARECOLUMN,__),(0,F.Z)(sc,fv.PENTAGONCOLUMN,S_),sc),hm={};function pm(e){var i=us(e.coordinates);return{vertices:[].concat((0,_r.Z)(i),(0,_r.Z)(i),(0,_r.Z)(i),(0,_r.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function w_(e){var i=us(e.coordinates),r=m_(i);return{vertices:[].concat((0,_r.Z)(r),(0,_r.Z)(r),(0,_r.Z)(r),(0,_r.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function x0(e){var i=e.shape,r=LE(i,!1),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function AE(e){var i=us(e.coordinates);return{vertices:(0,_r.Z)(i),indices:[0],size:i.length}}function b0(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,t=new bE({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=r;Array.isArray(u[0][0])||(u=[r]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];t.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){t.extrude(A)})}var S=t.complex;return{vertices:S.positions,indices:S.indices,normals:S.normals,indexes:S.indexes,size:6}}function CE(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat((0,_r.Z)(i),[1,2,-3],(0,_r.Z)(i),[1,1,-3],(0,_r.Z)(i),[0,1,0],(0,_r.Z)(i),[0,0,0],(0,_r.Z)(i),[1,0,0],(0,_r.Z)(i),[1,2,-3],(0,_r.Z)(i),[1,1,-3],(0,_r.Z)(i),[0,1,0],(0,_r.Z)(i),[0,0,0],(0,_r.Z)(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function OR(e){var i=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(i),[1,2,-3],_toConsumableArray(i),[1,1,-3],_toConsumableArray(i),[0,1,0],_toConsumableArray(i),[0,0,0],_toConsumableArray(i)),normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1],indices:[0,1,1,2,2,3,3,4,4,0],size:7}}function TE(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=ME(i),t=n.results,o=n.totalDistance;return t.map(function(u){r.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:r,indices:[],normals:[],size:6,count:t.length}}function FR(e){var i=e.coordinates,r=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=kE(i),t=n.results;return t.map(function(o){r.push(o[0],o[1],o[2],o[3])}),{vertices:r,indices:[],size:4,count:t.length}}function E_(e,i){var r=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(r*r+n*n)}function fd(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function ME(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var r=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],t=fd(i[0],r);n.push(t);for(var o=1;o<i.length-1;o++){var u=E_(i[o-1],i[o]);r+=u;var l=fd(i[o],r);n.push(l),n.push(l)}var p=E_(i[i.length-2],i[i.length-1]);return r+=p,n.push(fd(i[i.length-1],r)),{results:n,totalDistance:r}}function kE(e){if(e.length<2)return{results:e};var i=[],r=fd(e[0]);i.push(r);for(var n=1;n<e.length-1;n++){var t=fd(e[n]);i.push(t),i.push(t)}return i.push(fd(e[e.length-1])),{results:i}}function S0(e){var i=e.coordinates,r=ko().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:ko()(n,o,t),vertices:n,size:t}}function IE(e){var i=e.coordinates,r=ko().flatten(i),n=r.vertices,t=r.dimensions,o=r.holes;return{indices:ko()(n,o,t),vertices:PE(n),size:t+4}}function PE(e){for(var i=[],r=xc(e),n=r.center,t=r.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,_r.Z)(n),[t]))}return i}function w0(e){var i=e.coordinates,r=g_(i,!0),n=r.positions,t=r.index,o=r.normals;return{vertices:n,indices:t,normals:o,size:5}}function A_(e){var i=e.shape,r=DE(i),n=r.positions,t=r.index;return{vertices:n,indices:t,size:3}}function dm(e){var i=e.coordinates,r=[].concat((0,_r.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,_r.Z)(i[1]),[0,1,0],(0,_r.Z)(i[0]),[0,0,1],(0,_r.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function vm(e,i){for(var r=i||30,n=e.coordinates,t=[],o=[],u=function(v){t.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==r-1&&o.push.apply(o,(0,_r.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<r;l++)u(l);return{vertices:t,indices:o,size:7}}function C_(e){var i=e.coordinates;i.length===2&&i.push(0);var r=mm(-1,1),n=mm(1,1),t=mm(-1,-1),o=mm(1,-1),u=[].concat((0,_r.Z)(i),(0,_r.Z)(r),(0,_r.Z)(i),(0,_r.Z)(t),(0,_r.Z)(i),(0,_r.Z)(o),(0,_r.Z)(i),(0,_r.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function LE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(hm&&hm[e])return hm[e];var r=cd[e]?cd[e]():cd.cylinder(),n=g_([r],i);return hm[e]=n,n}function BR(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,t=new Float32Array(e.length/r*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),S=0,A=i.length;S<A;S+=3){o=i[S+0]*3,u=i[S+1]*3,l=i[S+2]*3;var k=[e[o],e[o+1]],D=[e[u],e[u+1]],R=[e[l],e[l+1]];n&&(k=lngLatToMeters(k),D=lngLatToMeters(D),R=lngLatToMeters(R));var Z=k,W=_slicedToArray(Z,2),me=W[0],ge=W[1],Ze=vec3.fromValues(me,ge,e[o+2]),Ve=D,rt=_slicedToArray(Ve,2),wt=rt[0],Ut=rt[1],Yt=vec3.fromValues(wt,Ut,e[u+2]),mr=R,fr=_slicedToArray(mr,2),Wr=fr[0],hn=fr[1],Pn=vec3.fromValues(Wr,hn,e[l+2]);vec3.sub(p,Pn,Yt),vec3.sub(v,Ze,Yt),vec3.cross(x,p,v),t[o]+=p[0],t[o+1]+=p[1],t[o+2]+=p[2],t[u]+=p[0],t[u+1]+=p[1],t[u+2]+=p[2],t[l]+=p[0],t[l+1]+=p[1],t[l+2]+=p[2]}return RE(t),t}function RE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),t=vec3.create();vec3.normalize(t,n),e.set(t,i)}}function zR(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function DE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=cd[e]?cd[e]():cd.circle(),n=i.indexOf(e)===-1?wE([r]):SE([r]);return n}function mm(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function NR(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function ZR(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function OE(e){var i=FE();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,zE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,NE=function(e){(0,lt.Z)(r,e);var i=OE(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=t.brightColor,x=v===void 0?"rgb(255,176,38)":v,S=t.windowColor,A=S===void 0?"rgb(30,60,89)":S,k=t.time,D=k===void 0?0:k,R=t.sweep,Z=R===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:R;return{u_cityCenter:Z.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Z.sweepRadius,u_circleSweep:Z.enable?1:0,u_circleSweepColor:qn(Z.sweepColor).slice(0,3),u_circleSweepSpeed:Z.sweepSpeed,u_opacity:u,u_baseColor:qn(p),u_brightColor:qn(x),u_windowColor:qn(A),u_time:this.layer.getLayerAnimateTime()||D}}},{key:"calCityGeo",value:function(){var t=(0,Qr.Z)(this.layer.getSource().extent,4),o=t[0],u=t[1],l=t[2],p=t[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var S=l-o,A=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(S,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:zE,fragmentShader:BE,triangulation:w0,depth:{enable:!0},cull:{enable:!0,face:q.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ca);function ZE(e){var i=UE();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function UE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VE=function(e){(0,lt.Z)(r,e);var i=ZE(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","CityBuildingLayer"),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new NE(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Zh);function jE(e){var i=GE();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,WE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$E=function(e){(0,lt.Z)(r,e);var i=jE(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:HE,fragmentShader:WE,triangulation:A_,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ca);function XE(e){var i=YE();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function YE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,KE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,JE=function(e){(0,lt.Z)(r,e);var i=XE(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:qE,fragmentShader:KE,triangulation:x0,primitive:q.TRIANGLES,depth:{enable:!0}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ca);function QE(e,i){for(var r=[],n=[],t=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,S=0;S<o;S++){var A=S-l;n.push(A/l,-x/p,0),t.push(S/e),t.push(1-v/i)}for(var k=0;k<i;k++)for(var D=0;D<e;D++){var R=D+o*k,Z=D+o*(k+1),W=D+1+o*(k+1),me=D+1+o*k;r.push(R,Z,me),r.push(Z,W,me)}return{vertices:n,indices:r,uvs:t}}var T_,M_;function eA(e){var i=tA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,nA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,iA=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,aA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,oA=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,sA=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,uA=ei.isEqual,k_=(T_=(0,Nt.b2)(),T_(M_=function(e){(0,lt.Z)(r,e);var i=eA(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"render",value:function(t){var o=this,u=this.rendererService,l=u.clear,p=u.useFramebuffer,v=this.layer.getLayerConfig(),x=v.rampColors;p(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),uA(this.preRampColors,x)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k,D,R;return pe().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,S=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(S==null||(u=S.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=A,W.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=W.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),k=v(),D=k.width,R=k.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(D/4),height:Math.floor(R/4),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),depth:!1}),this.updateColorTexture(),W.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return W.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:ln.Attribute,descriptor:{name:"a_Dir",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=C_,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:sA,fragmentShader:oA,triangulation:C_,depth:{enable:!1},cull:{enable:!0,face:Ea(this.mapService.version)}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:aA,fs:iA});var t=this.shaderModuleService.getModule("heatmapColor"),o=t.vs,u=t.fs,l=t.uniforms,p=this.rendererService,v=p.createAttribute,x=p.createElements,S=p.createBuffer,A=p.createModel;return A({vs:o,fs:u,attributes:{a_Position:v({buffer:S({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:q.FLOAT}),size:3}),a_Uv:v({buffer:S({data:[0,1,1,1,0,0,1,0],type:q.FLOAT}),size:2})},uniforms:(0,O.Z)({},l),depth:{enable:!1},elements:x({data:[0,2,1,2,3,1],type:q.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p},blend:{enable:!0,func:{srcRGB:q.ONE,srcAlpha:1,dstRGB:q.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity;(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var o,u=this.layer.getLayerConfig(),l=u.opacity,p=Ae();er(p,this.cameraService.getViewProjectionMatrixUncentered()),(o=this.colorModel)===null||o===void 0||o.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,_r.Z)(p)},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=this.rendererService.getViewportSize,o=t(),u=o.width,l=o.height,p=QE(u/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:nA,fs:rA});var v=this.shaderModuleService.getModule("heatmap3dColor"),x=v.vs,S=v.fs,A=v.uniforms,k=this.rendererService,D=k.createAttribute,R=k.createElements,Z=k.createBuffer,W=k.createModel;return W({vs:x,fs:S,attributes:{a_Position:D({buffer:Z({data:p.vertices,type:q.FLOAT}),size:3}),a_Uv:D({buffer:Z({data:p.uvs,type:q.FLOAT}),size:2})},primitive:q.TRIANGLES,uniforms:(0,O.Z)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:R({data:p.indices,type:q.UNSIGNED_INT,count:p.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=Mo(u);this.colorTexture=t({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1}),this.preRampColors=u}}]),r}(ca))||M_);function lA(e){var i=cA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,hA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,pA=function(e){(0,lt.Z)(r,e);var i=lA(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.coverage,l=t.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:hA,fragmentShader:fA,triangulation:A_,depth:{enable:!1},primitive:q.TRIANGLES});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),r}(ca),dA={heatmap:k_,heatmap3d:k_,grid:$E,grid3d:JE,hexagon:pA},vA=dA;function mA(e){var i=gA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yA=function(e){(0,lt.Z)(r,e);var i=mA(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","HeatMapLayer"),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new vA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"renderModels",value:function(){var t=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(o),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(o)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(t=o.scale)===null||t===void 0?void 0:t.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),r}(Zh);function _A(e){var i=xA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,SA=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,wA=function(e){(0,lt.Z)(r,e);var i=_A(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),S.next=5,u.data.images;case 5:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,mag:q.LINEAR,min:q.LINEAR}),S.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:SA,fragmentShader:bA,triangulation:dm,primitive:q.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return v=S.sent,S.abrupt("return",[v]);case 11:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ca),EA={image:wA},AA=EA;function CA(e){var i=TA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I_=function(e){(0,lt.Z)(r,e);var i=CA(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","ImageLayer"),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new AA[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={image:{}};return o[t]}},{key:"getModelType",value:function(){return"image"}}]),r}(Zh);function MA(e){var i=kA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function kA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;


  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,PA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,LA=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  
  gl_FragColor.a *= u_opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,RA=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;

uniform float u_opacity: 1.0;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,DA=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,OA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;
uniform float u_opacity: 1.0;

uniform float u_thetaOffset: 0.314;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= u_opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,FA={solid:0,dash:1},BA=ei.isNumber,zA=function(e){(0,lt.Z)(r,e);var i=MA(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.forward,Z=R===void 0?!0:R,W=t.lineTexture,me=W===void 0?!1:W,ge=t.iconStep,Ze=ge===void 0?100:ge,Ve=t.segmentNumber,rt=Ve===void 0?30:Ve,wt=t.thetaOffset,Ut=wt===void 0?.314:wt;D.length===2&&D.push(0,0);var Yt=0,mr=[0,0,0,0],fr=[0,0,0,0];return l&&p&&(mr=qn(l),fr=qn(p),Yt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:Ut,u_opacity:BA(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:rt,u_line_type:FA[A||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:Z?1:-1,u_texture:this.texture,u_line_texture:me?1:0,u_icon_step:Ze,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Yt,u_sourceColor:mr,u_targetColor:fr}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:IA,vert:PA,type:"Dash"}:o&&u?{frag:DA,vert:OA,type:"Linear"}:{frag:LA,vert:RA,type:""}}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:S,fragmentShader:x,triangulation:vm,depth:{enable:!1},segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca);function NA(e){var i=ZA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,VA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,jA=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,GA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,HA={solid:0,dash:1},WA=function(e){(0,lt.Z)(r,e);var i=NA(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5]:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,Z=R===void 0?100:R,W=t.segmentNumber,me=W===void 0?30:W,ge=t.globalArcHeight,Ze=ge===void 0?10:ge;A.length===2&&A.push(0,0);var Ve=0,rt=[0,0,0,0],wt=[0,0,0,0];return o&&u&&(rt=qn(o),wt=qn(u),Ve=1),this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:g0,u_global_height:Ze,u_textureBlend:p==="normal"?0:1,segmentNumber:me,u_line_type:HA[x]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ve,u_sourceColor:rt,u_targetColor:wt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:jA,vert:GA,type:"Linear"}:{frag:UA,vert:VA,type:""}}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:vm,segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca);function $A(e){var i=XA();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function XA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
uniform float u_opacity;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,qA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,KA=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,JA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,QA={solid:0,dash:1},eC=function(e){(0,lt.Z)(r,e);var i=$A(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.lineTexture,Z=R===void 0?!1:R,W=t.iconStep,me=W===void 0?100:W,ge=t.segmentNumber,Ze=ge===void 0?30:ge,Ve=t.globalArcHeight,rt=Ve===void 0?10:Ve;D.length===2&&D.push(0,0);var wt=0,Ut=[0,0,0,0],Yt=[0,0,0,0];return l&&p&&(Ut=qn(l),Yt=qn(p),wt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:g0,u_global_height:rt,u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:Ze,u_line_type:QA[A]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:Z?1:0,u_icon_step:me,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:wt,u_sourceColor:Ut,u_targetColor:Yt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:KA,vert:JA,type:"Linear"}:{frag:YA,vert:qA,type:""}}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,R.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+A,vertexShader:S,fragmentShader:x,triangulation:vm,depth:{enable:!0},segmentNumber:p});case 4:return k=R.sent,R.abrupt("return",[k]);case 6:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca);function tC(e){var i=rC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,iC=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = normalize(target - source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.8), project_pixel(lengthCommon*.8)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);

  float gapCommon =  project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,aC=function(e){(0,lt.Z)(r,e);var i=tC(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.gapWidth,u=o===void 0?2:o,l=t.strokeWidth,p=l===void 0?1:l,v=t.stroke,x=v===void 0?"#000":v,S=t.strokeOpacity,A=S===void 0?1:S;return(0,O.Z)({u_gap_width:u,u_stroke_width:p,u_stroke:qn(x),u_stroke_opacity:A},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:iC,fragmentShader:nC,inject:this.getInject(),triangulation:CE,primitive:q.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(o,u,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}})}}]),r}(ca);function oC(e){var i=sC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,lC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,cC={solid:0,dash:1},fC=function(e){(0,lt.Z)(r,e);var i=oC(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.lineType,A=S===void 0?"solid":S,k=t.dashArray,D=k===void 0?[10,5]:k,R=t.lineTexture,Z=R===void 0?!1:R,W=t.iconStep,me=W===void 0?100:W,ge=t.segmentNumber,Ze=ge===void 0?30:ge;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ve=0,rt=[0,0,0,0],wt=[0,0,0,0];return l&&p&&(rt=qn(l),wt=qn(p),Ve=1),{u_opacity:u,u_textureBlend:x==="normal"?0:1,segmentNumber:Ze,u_line_type:cC[A]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:Z?1:0,u_icon_step:me,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ve,u_sourceColor:rt,u_targetColor:wt}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:lC,fragmentShader:uC,triangulation:vm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca),UR=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),gm=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),hC=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),E0=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),VR=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function pC(e){var i=dC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

 
  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,mC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,gC=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth / 2.0;


    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,P_=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,yC=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity: 1.0;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,_C={solid:0,dash:1},L_=function(e){(0,lt.Z)(r,e);var i=pC(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"textureEventFlag",!1),(0,F.Z)((0,Ie.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.textureBlend,p=l===void 0?"normal":l,v=t.lineType,x=v===void 0?"solid":v,S=t.dashArray,A=S===void 0?[10,5,0,0]:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,Z=R===void 0?100:R,W=t.vertexHeightScale,me=W===void 0?20:W,ge=t.borderWidth,Ze=ge===void 0?0:ge,Ve=t.borderColor,rt=Ve===void 0?"#ccc":Ve,wt=t.raisingHeight,Ut=wt===void 0?0:wt,Yt=t.heightfixed,mr=Yt===void 0?!1:Yt,fr=t.linearDir,Wr=fr===void 0?gm.VERTICAL:fr,hn=t.blur,Pn=hn===void 0?[1,1,1]:hn,Vi=t.arrow,Da=Vi===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Vi;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var ja=0,ao=[0,0,0,0],Ho=[0,0,0,0];return o&&u&&(ao=qn(o),Ho=qn(u),ja=1),(0,O.Z)({u_textureBlend:p===hC.NORMAL?0:1,u_line_type:_C[x],u_dash_array:A,u_blur:Pn,u_texture:this.texture,u_line_texture:D?1:0,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ze,u_borderColor:qn(rt),u_linearDir:Wr===gm.VERTICAL?1:0,u_linearColor:ja,u_sourceColor:ao,u_targetColor:Ho,u_heightfixed:Number(mr),u_vertexScale:me,u_raisingHeight:Number(Ut),u_arrow:Number(Da.enable),u_arrowHeight:Da.arrowHeight||3,u_arrowWidth:Da.arrowWidth||2,u_tailWidth:Da.tailWidth===void 0?1:Da.tailWidth},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,v=this.getShaders(),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=il,R.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:S,fragmentShader:x,triangulation:il,inject:this.getInject(),depth:{enable:p}});case 5:return k=R.sent,R.abrupt("return",[k]);case 7:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor,l=t.lineType;return l==="dash"?{frag:vC,vert:mC,type:"Dash"}:o&&u?{frag:yC,vert:P_,type:"Linear"}:{frag:gC,vert:P_,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:ln.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,l,p,v,x,S){return S===void 0?[p[3],10]:[p[3],S]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca);function xC(e){var i=bC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,wC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,EC=ei.isNumber,AC=function(e){(0,lt.Z)(r,e);var i=xC(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=Mo(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.vertexHeightScale,p=l===void 0?20:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S,k=t.linearDir,D=k===void 0?gm.VERTICAL:k;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:D===gm.VERTICAL?1:0,u_opacity:EC(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!1:l,this.layer.triangulation=b0,S.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:wC,fragmentShader:SC,triangulation:b0,depth:{enable:p}});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:ln.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),r}(ca);function CC(e){var i=TC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,kC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
uniform float u_opacity: 1.0;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,R_=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); 
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,IC=ei.isNumber,PC=function(e){(0,lt.Z)(r,e);var i=CC(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.vertexHeightScale,x=v===void 0?20:v,S=0,A=[0,0,0,0],k=[0,0,0,0];return l&&p&&(A=qn(l),k=qn(p),S=1),{u_opacity:IC(u)?u:1,u_linearColor:S,u_sourceColor:A,u_targetColor:k,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.sourceColor,u=t.targetColor;return o&&u?{frag:kC,vert:R_,type:"lineSimpleLinear"}:{frag:MC,vert:R_,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,triangulation:TE,primitive:q.LINES,depth:{enable:!1},pick:!1});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:ln.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),r}(ca);function LC(e){var i=RC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,OC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,FC=ei.isNumber,BC=function(e){(0,lt.Z)(r,e);var i=LC(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.sourceColor,p=t.targetColor,v=t.textureBlend,x=v===void 0?"normal":v,S=t.heightfixed,A=S===void 0?!1:S,k=t.lineTexture,D=k===void 0?!1:k,R=t.iconStep,Z=R===void 0?100:R,W=t.iconStepCount,me=W===void 0?1:W;this.rendererService.getDirty()&&this.texture.bind();var ge=0,Ze=[0,0,0,0],Ve=[0,0,0,0];return l&&p&&(Ze=qn(l),Ve=qn(p),ge=1),{u_heightfixed:Number(A),u_opacity:FC(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:me,u_icon_step:Z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ge,u_sourceColor:Ze,u_targetColor:Ve}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:OC,fragmentShader:DC,triangulation:b0,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:ln.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca),zC={arc:zA,arc3d:WA,greatcircle:fC,wall:BC,line:L_,simple:PC,linearline:AC,earthArc3d:eC,flowline:aC},NC=zC;function ZC(e){var i=UC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A0=function(e){(0,lt.Z)(r,e);var i=ZC(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","LineLayer"),(0,F.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke"]),(0,F.Z)((0,Ie.Z)(n),"arrowInsertCount",0),(0,F.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new NC[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return o[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u||"line"}},{key:"processData",value:function(t){if(this.getModelType()!=="simple")return t;var o=[];return t.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,O.Z)({},u);u.coordinates.map(function(p){o.push((0,O.Z)((0,O.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),r}(Zh);function VC(e){var i=jC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GC=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,HC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function D_(e){var i=e.coordinates;return{vertices:(0,_r.Z)(i),indices:[0],size:i.length}}var WC=function(e){(0,lt.Z)(r,e);var i=VC(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.blend,x=t.strokeOpacity,S=x===void 0?1:x,A=t.strokeWidth,k=A===void 0?0:A,D=t.stroke,R=D===void 0?"#fff":D;return{u_additive:v==="additive"?1:0,u_opacity:u,u_offsets:p,u_stroke_opacity:S,u_stroke_width:k,u_stroke_color:qn(R)}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=D_,p.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:HC,fragmentShader:GC,triangulation:D_,depth:{enable:!1},primitive:q.POINTS});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ca);function $C(e){var i=XC();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function XC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,qC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,KC=ei.isNumber,JC=function(e){(0,lt.Z)(r,e);var i=$C(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"raiseCount",0),(0,F.Z)((0,Ie.Z)(n),"raiseRepeat",0),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,k=t.heightfixed,D=k===void 0?!1:k,R=t.opacityLinear,Z=R===void 0?{enable:!1,dir:"up"}:R,W=t.lightEnable,me=W===void 0?!0:W,ge=0,Ze=[0,0,0,0],Ve=[0,0,0,0];if(v&&x&&(Ze=qn(v),Ve=qn(x),ge=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var rt=u.speed,wt=rt===void 0?.01:rt;this.raiseCount+=wt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:KC(p)?p:1,u_linearColor:ge,u_sourceColor:Ze,u_targetColor:Ve,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(me)}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,S.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:qC,fragmentShader:YC,triangulation:x0,depth:{enable:!0},cull:{enable:!0,face:Ea(this.mapService.version)},blend:this.getBlend()});case 4:return v=S.sent,S.abrupt("return",[v]);case 6:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=us(o.coordinates);return m_([u[0],u[1]])}}})}}]),r}(ca);function QC(e){var i=eT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tT=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,nT=function(e){(0,lt.Z)(r,e);var i=QC(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.strokeOpacity,p=l===void 0?1:l,v=t.strokeWidth,x=v===void 0?0:v,S=t.stroke,A=S===void 0?"rgba(0,0,0,0)":S,k=t.blend,D=t.blur,R=D===void 0?0:D;return{u_blur:R,u_additive:k==="additive"?1:0,u_opacity:u,u_stroke_opacity:p,u_stroke_width:x,u_stroke_color:qn(A)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=w_,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:rT,fragmentShader:tT,triangulation:w_,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=(0,Qr.Z)(p,3),S=x[0],A=x[1],k=x[2],D=ma.fromValues(0,0,1),R=ma.fromValues(S,0,k),Z=S>=0?ma.angle(D,R):Math.PI*2-ma.angle(D,R),W=Math.PI*2-Math.asin(A/100),me=Ae();Ia(me,me,Z),Bi(me,me,W);var ge=ma.fromValues(1,1,0);ma.transformMat4(ge,ge,me),ma.normalize(ge,ge);var Ze=ma.fromValues(-1,1,0);ma.transformMat4(Ze,Ze,me),ma.normalize(Ze,Ze);var Ve=ma.fromValues(-1,-1,0);ma.transformMat4(Ve,Ve,me),ma.normalize(Ve,Ve);var rt=ma.fromValues(1,-1,0);ma.transformMat4(rt,rt,me),ma.normalize(rt,rt);var wt=[].concat((0,_r.Z)(ge),(0,_r.Z)(Ze),(0,_r.Z)(Ve),(0,_r.Z)(rt)),Ut=v%4*3;return[wt[Ut],wt[Ut+1],wt[Ut+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:ln.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),r}(ca);function iT(e){var i=aT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function aT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oT=`varying vec4 v_color;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"


void main() {

  gl_FragColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,sT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;
varying float v_lightWeight;
varying float v_barLinearZ;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
uniform float u_opacitylinear: 0.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacitylinear_dir: 1.0;
uniform float  u_linearColor: 0.0;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * u_opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  // gl_Position = project_common_position_to_clipspace(pos);

  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,O_=function(e){(0,lt.Z)(r,e);var i=iT(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"raiseCount",0),(0,F.Z)((0,Ie.Z)(n),"raiseRepeat",0),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=t.opacity,p=l===void 0?1:l,v=t.sourceColor,x=t.targetColor,S=t.pickLight,A=S===void 0?!1:S,k=t.heightfixed,D=k===void 0?!1:k,R=t.opacityLinear,Z=R===void 0?{enable:!1,dir:"up"}:R,W=t.lightEnable,me=W===void 0?!0:W,ge=0,Ze=[0,0,0,0],Ve=[0,0,0,0];if(v&&x&&(Ze=qn(v),Ve=qn(x),ge=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var rt=u.speed,wt=rt===void 0?.01:rt;this.raiseCount+=wt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(D),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:p,u_linearColor:ge,u_sourceColor:Ze,u_targetColor:Ve,u_opacitylinear:Number(Z.enable),u_opacitylinear_dir:Z.dir==="up"?1:0,u_lightEnable:Number(me)}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,k.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:sT,fragmentShader:oT,triangulation:x0,cull:{enable:!0,face:Ea(this.mapService.version)},depth:{enable:p}});case 4:return S=k.sent,k.abrupt("return",[S]);case 6:case"end":return k.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o){var u=us(o.coordinates);return[u[0],u[1],0]}}})}}]),r}(ca);function uT(e){var i=lT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function lT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F_=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cT=`uniform float u_additive;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;


#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    gl_FragColor = v_color;
  } else {
    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(gl_FragColor.a < 0.01) {
    discard;
  } 
}
`,C0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec4 v_stroke;
uniform float u_stroke_width: 2;
uniform vec3 u_blur_height_fixed: [0, 0, 0];


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,B_=function(e){(0,lt.Z)(r,e);var i=uT(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.strokeOpacity,u=o===void 0?1:o,l=t.strokeWidth,p=l===void 0?0:l,v=t.blend,x=t.blur,S=x===void 0?0:x,A=t.raisingHeight,k=A===void 0?0:A,D=t.heightfixed,R=D===void 0?!1:D,Z=t.unit,W=Z===void 0?"pixel":Z;return(0,O.Z)({u_blur_height_fixed:[S,Number(k),Number(R)],u_additive:v==="additive"?1:0,u_stroke_opacity:u,u_stroke_width:p,u_size_unit:E0[W]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ph)}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption,p=l===void 0?{enable:!1}:l,v=this.getShaders(p),x=v.frag,S=v.vert,A=v.type,this.layer.triangulation=ph,R.next=5,this.layer.buildLayerModel({moduleName:A,vertexShader:S,fragmentShader:x,inject:this.getInject(),triangulation:ph,depth:{enable:!1}});case 5:return k=R.sent,R.abrupt("return",[k]);case 7:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(t){if(t.enable)switch(t.type){case"wave":return{frag:F_,vert:C0,type:"pointWave"};default:return{frag:F_,vert:C0,type:"pointWave"}}else return{frag:cT,vert:C0,type:"pointFill"}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:ln.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=t.indexOf(p);return[v]}}})}}]),r}(ca);function fT(e){var i=hT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,dT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,vT=function(e){(0,lt.Z)(r,e);var i=fT(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"meter2coord",1),(0,F.Z)((0,Ie.Z)(n),"isMeter",!1),(0,F.Z)((0,Ie.Z)(n),"radian",0),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.heightfixed,p=l===void 0?!1:l,v=t.unit,x=v===void 0?"pixel":v;return this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_raisingHeight:Number(u),u_heightfixed:Number(p),u_size_unit:E0[x],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pm)}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:dT,fragmentShader:pT,triangulation:pm,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:Ea(this.mapService.version)}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],S=v%4*3;return[x[S],x[S+1],x[S+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}})}}]),r}(ca);function mT(e){var i=gT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,_T=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,z_=function(e){(0,lt.Z)(r,e);var i=mT(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.offsets,p=l===void 0?[0,0]:l,v=t.raisingHeight,x=v===void 0?0:v,S=t.heightfixed,A=S===void 0?!1:S;return this.rendererService.getDirty()&&this.texture.bind(),(0,O.Z)({u_raisingHeight:Number(x),u_heightfixed:Number(A),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:_T,fragmentShader:yT,triangulation:AE,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u){var l=t.iconService.getIconMap(),p=u.shape,v=l[p]||{x:-64,y:-64},x=v.x,S=v.y;return[x,S]}}})}}]),r}(ca);function xT(e){var i=bT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=`varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
}
`,wT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`,jR=ei.isNumber;function N_(e){var i=e.coordinates;return{vertices:(0,_r.Z)(i),indices:[0],size:i.length}}var Z_=function(e){(0,lt.Z)(r,e);var i=xT(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o;return(0,O.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=N_,p.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:wT,fragmentShader:ST,triangulation:N_,inject:this.getInject(),depth:{enable:!1},primitive:q.POINTS,pick:!1});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ca);function ET(e){var i=AT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function AT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CT=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,TT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,MT=function(e){(0,lt.Z)(r,e);var i=ET(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.blend,p=t.speed,v=p===void 0?1:p,x=t.unit,S=x===void 0?"pixel":x;return{u_size_unit:E0[S],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:u}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),o=t.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pm)}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:TT,fragmentShader:CT,triangulation:pm,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[v[x],v[x+1],v[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?5:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ca);function kT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=IT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function IT(e,i){if(!!e){if(typeof e=="string")return U_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U_(e,i)}}function U_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var PT=function(){function e(i,r,n){(0,xe.Z)(this,e),(0,F.Z)(this,"boxCells",[]);var t=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)t.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,K.Z)(e,[{key:"insert",value:function(r,n,t,o,u){this.forEachCell(n,t,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!1,u)}},{key:"hitTest",value:function(r,n,t,o,u){return this.queryHitTest(r,n,t,o,!0,u)}},{key:"insertBoxCell",value:function(r,n,t,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(r,n,t,o,u,l){if(t<0||r>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(r<=0&&n<=0&&this.width<=t&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,t,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(r,n,t,o,u,l,p,v){var x=p.seenUids,S=this.boxCells[u];if(S!==null){var A=this.bboxes,k=kT(S),D;try{for(k.s();!(D=k.n()).done;){var R=D.value;if(!x.box[R]){x.box[R]=!0;var Z=R*4;if(r<=A[Z+2]&&n<=A[Z+3]&&t>=A[Z+0]&&o>=A[Z+1]&&(!v||v(this.boxKeys[R]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[R],x1:A[Z],y1:A[Z+1],x2:A[Z+2],y2:A[Z+3]})}}}}catch(W){k.e(W)}finally{k.f()}}return!1}},{key:"forEachCell",value:function(r,n,t,o,u,l,p,v){for(var x=this.convertToXCellCoord(r),S=this.convertToYCellCoord(n),A=this.convertToXCellCoord(t),k=this.convertToYCellCoord(o),D=x;D<=A;D++)for(var R=S;R<=k;R++){var Z=this.xCellCount*R+D;if(u.call(this,r,n,t,o,Z,l,p,v))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),LT=PT,RT=function(){function e(i,r){(0,xe.Z)(this,e),(0,F.Z)(this,"viewportPadding",100),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new LT(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,K.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,t=r.y1+r.anchorPointY+this.viewportPadding,o=r.x2+r.anchorPointX+this.viewportPadding,u=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,t,o,u)||this.grid.hitTest(n,t,o,u)?{box:[]}:{box:[n,t,o,u]}}},{key:"insertCollisionBox",value:function(r,n){var t={featureIndex:n};this.grid.insert(t,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,t){var o=di(n,t,0,1),u=An(),l=vt.apply(_e,(0,_r.Z)(r));return Zi(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,t,o){return t>=0&&r<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function V_(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=DT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function DT(e,i){if(!!e){if(typeof e=="string")return j_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j_(e,i)}}function j_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function G_(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function H_(e,i,r,n,t){if(!!t){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*t,v=r;v<=n;v++)e[v].x-=p}}function W_(e,i,r,n,t,o,u){var l=(i-r)*t,p=(-n*u+.5)*o,v=V_(e),x;try{for(v.s();!(x=v.n()).done;){var S=x.value;S.x+=l,S.y+=p}}catch(A){v.e(A)}finally{v.f()}}function OT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,k=S.length;r.forEach(function(me){if(me.split("").forEach(function(Ze){var Ve=i[Ze],rt=0;Ve&&(S.push({glyph:Ze,x:p,y:v+rt,vertical:!1,scale:1,metrics:Ve}),p+=Ve.advance+u)}),S.length!==k){var ge=p-u;x=Math.max(ge,x),H_(S,i,k,S.length-1,A)}p=0,v-=n+5});var D=G_(t),R=D.horizontalAlign,Z=D.verticalAlign;W_(S,A,R,Z,x,n,r.length);var W=v-l;e.top+=-Z*W,e.bottom=e.top-W,e.left+=-R*x,e.right=e.left+x}function FT(e,i,r,n,t,o,u){var l=-8,p=0,v=l,x=0,S=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,k=S.length;r.forEach(function(me){var ge=i[me],Ze=0;if(ge&&(S.push({glyph:me,x:ge.advance/2,y:v+Ze,vertical:!1,scale:1,metrics:ge}),p+=ge.advance+u),S.length!==k){var Ve=p-u;x=Math.max(Ve,x),H_(S,i,k,S.length-1,A)}p=0,v-=n+5});var D=G_(t),R=D.horizontalAlign,Z=D.verticalAlign;W_(S,A,R,Z,x,n,r.length);var W=v-l;e.top+=-Z*W,e.bottom=e.top-W,e.left+=-R*x,e.right=e.left+x}function BT(e,i,r,n,t,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?FT(x,i,p,r,n,t,o):OT(x,i,p,r,n,t,o),v.length?x:!1}function zT(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,t=n===void 0?[]:n,o=[],u=V_(t),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,S=v.advance*p.scale/2,A=r?[p.x+S,p.y]:[0,0],k=r?[0,0]:[p.x+S+i[0],p.y+i[1]],D=(0-x)*p.scale-S+k[0],R=(0-x)*p.scale+k[1],Z=D+v.width*p.scale,W=R+v.height*p.scale,me={x:D,y:R},ge={x:Z,y:R},Ze={x:D,y:W},Ve={x:Z,y:W};o.push({tl:me,tr:ge,bl:Ze,br:Ve,tex:v,glyphOffset:A})}}catch(rt){u.e(rt)}finally{u.f()}return o}function NT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ZT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function ZT(e,i){if(!!e){if(typeof e=="string")return $_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $_(e,i)}}function $_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function UT(e){var i=VT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,Y_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,dv=ei.isEqual;function q_(e){var i=this,r=e.id,n=[],t=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[r].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[r].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,_r.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,_r.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,_r.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,_r.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),t.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:t,size:7}}var K_=function(e){(0,lt.Z)(r,e);var i=UT(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"glyphInfoMap",{}),(0,F.Z)((0,Ie.Z)(n),"currentZoom",-1),(0,F.Z)((0,Ie.Z)(n),"textureHeight",0),(0,F.Z)((0,Ie.Z)(n),"textCount",0),(0,F.Z)((0,Ie.Z)(n),"preTextStyle",{}),(0,F.Z)((0,Ie.Z)(n),"mapping",(0,Pt.Z)(pe().mark(function l(){return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.stroke,u=o===void 0?"#fff":o,l=t.strokeWidth,p=l===void 0?0:l,v=t.halo,x=v===void 0?.5:v,S=t.gamma,A=S===void 0?2:S,k=t.raisingHeight,D=k===void 0?0:k,R=this.getFontServiceMapping(),Z=this.getFontServiceCanvas();return R&&Object.keys(R).length!==this.textCount&&Z&&(this.updateTexture(),this.textCount=Object.keys(R).length),this.preTextStyle=this.getTextStyle(),(0,O.Z)({u_raisingHeight:Number(D),u_stroke_width:p,u_stroke_color:qn(u),u_sdf_map:this.texture,u_halo_blur:x,u_gamma_scale:A,u_sdf_map_size:[(Z==null?void 0:Z.width)||1,(Z==null?void 0:Z.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getLayerConfig(),l=u.textAllowOverlap,p=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),p||this.filterGlyphs(),S.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Y_,fragmentShader:X_,inject:this.getInject(),triangulation:q_.bind(this),depth:{enable:!1}});case 6:return v=S.sent,S.abrupt("return",[v]);case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"needUpdate",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k,D,R,Z,W;return pe().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(u=this.getTextStyle(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,x=v===void 0?"center":v,S=u.textOffset,A=u.padding,k=u.fontFamily,D=u.fontWeight,!(!dv(A,this.preTextStyle.padding)||!dv(S,this.preTextStyle.textOffset)||!dv(x,this.preTextStyle.textAnchor)||!dv(k,this.preTextStyle.fontFamily)||!dv(D,this.preTextStyle.fontWeight))){ge.next=5;break}return ge.next=4,this.mapping();case 4:return ge.abrupt("return",!0);case 5:if(!p){ge.next=7;break}return ge.abrupt("return",!1);case 7:if(R=this.mapService.getZoom(),Z=this.mapService.getBounds(),W=Gs(this.extent,Z),!(Math.abs(this.currentZoom-R)>.5||!W||p!==this.preTextStyle.textAllowOverlap)){ge.next=14;break}return ge.next=13,this.reBuildModel();case 13:return ge.abrupt("return",!0);case 14:return ge.abrupt("return",!1);case 15:case"end":return ge.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:ln.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:ln.Attribute,descriptor:{name:"a_tex",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return Vl(t,.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S=S.toString();var A=NT(S),k;try{for(A.s();!(k=A.n()).done;){var D=k.value;p.indexOf(D)===-1&&p.push(D)}}catch(R){A.e(R)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),o=t.fontWeight,u=t.fontFamily,l=this.rawEncodeData,p=[];l.forEach(function(v){var x=v.shape,S=x===void 0?"":x;S="".concat(S),p.indexOf(S)===-1&&p.push(S)}),this.fontService.setFontOptions({characterSet:p,fontWeight:o,fontFamily:u,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l,v=t.textAllowOverlap,x=v===void 0?!1:v,S=t.padding,A=S===void 0?[0,0]:S,k=t.textAnchor,D=k===void 0?"center":k,R=t.textOffset,Z=R===void 0?[0,0]:R,W=t.opacity,me=W===void 0?1:W,ge=t.strokeOpacity,Ze=ge===void 0?1:ge,Ve=t.strokeWidth,rt=Ve===void 0?0:Ve,wt=t.stroke,Ut=wt===void 0?"#000":wt;return{fontWeight:u,fontFamily:p,textAllowOverlap:x,padding:A,textAnchor:D,textOffset:Z,opacity:me,strokeOpacity:Ze,strokeWidth:rt,stroke:Ut}}},{key:"generateGlyphLayout",value:function(t){var o=this,u=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,S=x===void 0?"center":x,A=l.textOffset,k=this.rawEncodeData;this.glyphInfo=k.map(function(D){var R=D.shape,Z=R===void 0?"":R,W=D.id,me=D.size,ge=me===void 0?1:me,Ze=D.textOffset?D.textOffset:A||[0,0],Ve=D.textAnchor?D.textAnchor:S||"center",rt=BT(Z.toString(),u,ge,Ve,"left",v,Ze,t),wt=zT(rt,Ze,!1);return D.shaping=rt,D.glyphQuads=wt,D.centroid=us(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?us(D.originCoordinates):D.originCentroid=D.centroid,o.glyphInfoMap[W]={shaping:rt,glyphQuads:wt,centroid:us(D.coordinates)},D})}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(p,"_").concat(u))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),o=t.fontWeight,u=o===void 0?"400":o,l=t.fontFamily,p=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(p,"_").concat(u))}},{key:"filterGlyphs",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[0,0]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),S=x.width,A=x.height,k=new RT(S,A),D=this.glyphInfo.filter(function(R){var Z=R.shaping,W=R.id,me=W===void 0?0:W,ge=R.version==="GAODE2.x"?R.originCentroid:R.centroid,Ze=R.size,Ve=Ze/16,rt=t.mapService.lngLatToContainer(ge),wt=k.placeCollisionBox({x1:Z.left*Ve-l[0],x2:Z.right*Ve+l[0],y1:Z.top*Ve-l[1],y2:Z.bottom*Ve+l[1],anchorPointX:rt.x,anchorPointY:rt.y}),Ut=wt.box;return Ut&&Ut.length?(k.insertCollisionBox(Ut,me),!0):!1});D.forEach(function(R){t.glyphInfoMap[R.id]=R})}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),o=t.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,o=this.getFontServiceCanvas();this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=t({data:o,mag:q.LINEAR,min:q.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.filterGlyphs(),p.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Y_,fragmentShader:X_,triangulation:q_.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:u=p.sent,this.layer.models=[u];case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(ca),jT={fillImage:vT,fill:B_,radar:MT,image:z_,normal:Z_,simplePoint:WC,extrude:O_,text:K_,earthFill:nT,earthExtrude:JC},GT=jT;function HT(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WT(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){r=r.call(e)},n:function(){var v=r.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(u)throw l}}}}function WT(e,i){if(!!e){if(typeof e=="string")return J_(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J_(e,i)}}function J_(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $T(e){var i=XT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function XT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ym=function(e){(0,lt.Z)(r,e);var i=$T(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","PointLayer"),(0,F.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","rotation"]),(0,F.Z)((0,Ie.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,F.Z)((0,Ie.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new GT[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"rebuildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,o=t.field,u=t.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=HT(u),S;try{for(x.s();!(S=x.n()).done;){var A=S.value;if(typeof A=="string"&&v.hasOwnProperty(A))return"image"}}catch(k){x.e(k)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=o.billboard,v=p===void 0?!0:p,x=this.iconService.getIconMap(),S=t.find(function(k){return k.hasOwnProperty("shape")});if(S){var A=S.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||v===!1?"fillImage":(u==null?void 0:u.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":x.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Zh);function YT(e){var i=qT();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function qT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KT=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,JT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,QT=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,eM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,tM=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,rM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,nM=function(e){(0,lt.Z)(r,e);var i=YT(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.heightfixed,u=o===void 0?!1:o,l=t.raisingHeight,p=l===void 0?0:l,v=t.topsurface,x=v===void 0?!0:v,S=t.sidesurface,A=S===void 0?!0:S,k=t.sourceColor,D=t.targetColor,R=0,Z=[1,1,1,1],W=[1,1,1,1];return k&&D&&(Z=qn(k),W=qn(D),R=1),(0,O.Z)({u_topsurface:Number(x),u_sidesurface:Number(A),u_heightfixed:Number(u),u_raisingHeight:Number(p),u_linearColor:R,u_sourceColor:Z,u_targetColor:W,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:w0});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),o=t.pickLight,u=t.mapTexture;return u?{frag:QT,vert:eM,type:"polygonExtrudeTexture"}:o?{frag:tM,vert:rM,type:"polygonExtrudePickLight"}:{frag:KT,vert:JT,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=t,u=this.layer.coordCenter||this.layer.getSource().center,l=o[2]-o[0],p=o[3]-o[1];if(this.mapService.version==="GAODE2.x"){var v=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],u),x=(0,Qr.Z)(v,2),S=x[0],A=x[1],k=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],u),D=(0,Qr.Z)(k,2),R=D[0],Z=D[1];l=R-S,p=Z-A,o=[S,A,R,Z]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:ln.Attribute,descriptor:{name:"a_uvs",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(me,ge,Ze){var Ve=Ze[0],rt=Ze[1];return[(Ve-o[0])/l,(rt-o[1])/p,Ze[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(me,ge,Ze,Ve,rt){return rt}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(me){var ge=me.size,Ze=ge===void 0?10:ge;return Array.isArray(Ze)?[Ze[0]]:[Ze]}}})}},{key:"loadTexture",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u=this,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mapTexture,v=this.rendererService.createTexture2D,this.texture=v({height:0,width:0}),!p){S.next=5;break}return S.abrupt("return",new Promise(function(A,k){var D=new Image;D.crossOrigin="anonymous",D.src=p,D.onload=function(){return u.texture=v({data:D,width:D.width,height:D.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),A(null)},D.onerror=function(){k(new Error("image load error"))}}));case 5:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()}]),r}(ca);function iM(e){var i=aM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function aM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oM=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sM=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,uM=function(e){(0,lt.Z)(r,e);var i=iM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){return(0,O.Z)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=this.getShaders(),l=u.frag,p=u.vert,v=u.type,A.next=3,this.layer.buildLayerModel({moduleName:v,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:w0});case 3:return x=A.sent,A.abrupt("return",[x]);case 5:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getShaders",value:function(){return{frag:oM,vert:sM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),r}(ca);function lM(e){var i=cM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function cM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fM=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hM=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,pM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,dM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,vM=function(e){(0,lt.Z)(r,e);var i=lM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.raisingHeight,u=o===void 0?0:o,l=t.opacityLinear,p=l===void 0?{enable:!1,dir:"in"}:l;return(0,O.Z)({u_raisingHeight:Number(u),u_opacitylinear:Number(p.enable),u_dir:p.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,this.layer.triangulation=v,k.next=4,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,inject:this.getInject(),triangulation:v,primitive:q.TRIANGLES,depth:{enable:!1}});case 4:return S=k.sent,k.abrupt("return",[S]);case 6:case"end":return k.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:ln.Attribute,descriptor:{name:"a_linear",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),o=t.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:hM,vert:pM,type:"polygonLinear",triangulation:IE}:{frag:fM,vert:dM,type:"polygonFill",triangulation:If}}}]),r}(ca);function mM(e){var i=gM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,_M=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,xM=ei.isNumber,bM=function(e){(0,lt.Z)(r,e);var i=mM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.watercolor,p=l===void 0?"#6D99A8":l,v=t.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:qn(p),u_watercolor2:qn(x),u_opacity:xM(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:_M,fragmentShader:yM,triangulation:S0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o,u;(t=this.texture1)===null||t===void 0||t.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,Qr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:ln.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(k,D,R,Z){var W=k.version===oc["GAODE2.x"]?k.originCoordinates[0][Z]:R,me=(0,Qr.Z)(W,2),ge=me[0],Ze=me[1];return[(ge-u)/x,(Ze-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){t.texture1=p(v[0]),t.texture2=p(v[1]),t.texture3=p(v[2]),t.layerService.reRender()});function l(v){var x=0,S=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(k){var D=new Image;D.crossOrigin="",D.src=k,S.push(D),D.onload=function(){x++,x===3&&v(S)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR})}}}]),r}(ca);function SM(e){var i=wM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,AM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,CM=ei.isNumber,TM=function(e){(0,lt.Z)(r,e);var i=SM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:CM(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:AM,fragmentShader:EM,triangulation:S0,primitive:q.TRIANGLES,depth:{enable:!1}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,o=(0,Qr.Z)(t,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,S=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:ln.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(k,D,R,Z){var W=k.version===oc["GAODE2.x"]?k.originCoordinates[0][Z]:R,me=(0,Qr.Z)(W,2),ge=me[0],Ze=me[1];return[(ge-u)/x,(Ze-l)/S]}}})}},{key:"loadTexture",value:function(){var t=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){t.texture=l({data:p,width:p.width,height:p.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR}),t.layerService.reRender()}}}]),r}(ca),MM={fill:vM,line:L_,extrude:nM,text:K_,point_fill:B_,point_image:z_,point_normal:Z_,point_extrude:O_,water:TM,ocean:bM,extrusion:uM},kM=MM;function IM(e){var i=PM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function PM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _m=function(e){(0,lt.Z)(r,e);var i=IM(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","PolygonLayer"),(0,F.Z)((0,Ie.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new kM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){var t,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(t=o.scale)===null||t===void 0?void 0:t.field;return u==="fill"||!u?"fill":u==="extrude"?"extrude":u==="extrusion"?"extrusion":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=t.find(function(S){return S.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),r}(Zh);function LM(e){var i=RM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function RM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DM=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,OM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,Q_=function(e){(0,lt.Z)(r,e);var i=LM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.clampLow,p=l===void 0?!0:l,v=t.clampHigh,x=v===void 0?!0:v,S=t.noDataValue,A=S===void 0?-9999999:S,k=t.domain,D=t.rampColors,R=k||Dl(D);return this.colorTexture=this.layer.textureService.getColorTexture(D,R),{u_opacity:u||1,u_texture:this.texture,u_domain:R,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(u.data)){A.next=4;break}return A.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return A.next=6,u.data;case 6:return l=A.sent,p=l.rasterData,v=l.width,x=l.height,A.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return A.stop()}},o)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],R.next=5,this.getRasterData(p);case 5:return v=R.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.LUMINANCE,type:q.FLOAT}),R.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:OM,fragmentShader:DM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return k=R.sent,R.abrupt("return",[k]);case 14:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t,o;(t=this.texture)===null||t===void 0||t.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ca),FM=["data"],BM=["rasterData"];function zM(e){var i=NM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function NM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,UM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,VM=function(e){(0,lt.Z)(r,e);var i=zM(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"dataOption",{}),n}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,S=v.gMinMax,A=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:S,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l,p,v,x,S;return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!Array.isArray(u.data)){k.next=4;break}return l=u.data,p=(0,ll.Z)(u,FM),this.dataOption=p,k.abrupt("return",(0,O.Z)({data:l},p));case 4:return k.next=6,u.data;case 6:if(v=k.sent,x=v.rasterData,S=(0,ll.Z)(v,BM),this.dataOption=S,!Array.isArray(x)){k.next=14;break}return k.abrupt("return",(0,O.Z)({data:x},S));case 14:return k.abrupt("return",(0,O.Z)({data:Array.from(x)},S));case 15:case"end":return k.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,p=u.data.dataArray[0],R.next=5,this.getRasterData(p);case 5:return v=R.sent,x=v.data,S=v.width,A=v.height,this.texture=l({data:x,width:S,height:A,format:q.RGB,type:q.FLOAT}),R.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:ZM,fragmentShader:UM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 12:return k=R.sent,R.abrupt("return",[k]);case 14:case"end":return R.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ca);function jM(e){var i=GM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function GM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,WM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,$M=function(e){(0,lt.Z)(r,e);var i=jM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=t.clampLow,l=u===void 0?!0:u,p=t.clampHigh,v=p===void 0?!0:p,x=t.noDataValue,S=x===void 0?-9999999:x,A=t.domain,k=t.rampColors,D=t.colorTexture,R=t.rScaler,Z=R===void 0?6553.6:R,W=t.gScaler,me=W===void 0?25.6:W,ge=t.bScaler,Ze=ge===void 0?.1:ge,Ve=t.offset,rt=Ve===void 0?1e4:Ve,wt=A||Dl(k),Ut=D;return D?this.layer.textureService.setColorTexture(D,k,wt):Ut=this.layer.textureService.getColorTexture(k,wt),{u_opacity:o||1,u_texture:this.texture,u_domain:wt,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:S,u_unpack:[Z,me,Ze,rt],u_colorTexture:Ut}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.layer.getSource(),l=this.rendererService.createTexture2D,S.next=4,u.data.images;case 4:return p=S.sent,this.texture=l({data:p[0],width:p[0].width,height:p[0].height,min:q.LINEAR,mag:q.LINEAR}),S.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:WM,fragmentShader:HM,triangulation:dm,primitive:q.TRIANGLES,depth:{enable:!1}});case 8:return v=S.sent,S.abrupt("return",[v]);case 10:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t;(t=this.texture)===null||t===void 0||t.destroy()}},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),r}(ca),XM={raster:Q_,rasterRgb:VM,raster3d:Q_,rasterTerrainRgb:$M},YM=XM;function qM(e){var i=KM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function KM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xm=function(e){(0,lt.Z)(r,e);var i=qM(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","RasterLayer"),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new YM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),r}(Zh);function JM(e){var i=QM();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function QM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e5=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,t5=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,r5=ei.isNumber,n5=function(e){(0,lt.Z)(r,e);var i=JM(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),o=t.opacity,u=o===void 0?1:o,l=t.color,p=l===void 0?"#000":l;return{u_opacity:r5(u)?u:0,u_color:qn(p)}}},{key:"initModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:t5,fragmentShader:e5,triangulation:S0,depth:{enable:!1},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(ca),i5={fill:n5},a5=i5;function o5(e){var i=s5();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function s5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e1=function(e){(0,lt.Z)(r,e);var i=o5(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"type","MaskLayer"),n}return(0,K.Z)(r,[{key:"buildModels",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new a5[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getModelType",value:function(){return"fill"}}]),r}(Zh),t1,r1,n1,i1,bm,a1,o1,u5=ei.cloneDeep,l5=(t1=(0,Nt.b2)(),r1=(0,Nt.f3)(Ne.IMapService),n1=(0,Nt.f3)(Ne.IFontService),t1(i1=(bm=function(){function e(){(0,xe.Z)(this,e),nn(this,"mapService",a1,this),nn(this,"fontService",o1,this)}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("DataMappingPlugin",(0,Pt.Z)(pe().mark(function u(){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r.log(as.MappingStart,Lt.INIT),t.generateMaping(r,{styleAttributeService:o}),r.log(as.MappingEnd,Lt.INIT);case 3:case"end":return p.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,Pt.Z)(pe().mark(function l(p){var v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(p){S.next=2;break}return S.abrupt("return",p);case 2:return r.dataState.dataMappingNeedUpdate=!1,r.log(as.MappingStart,Lt.UPDATE),v=t.generateMaping(r,{styleAttributeService:o}),r.log(as.MappingEnd,Lt.UPDATE),S.abrupt("return",v);case 7:case"end":return S.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=r.getSource();if(!(r.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(k){return k.needRemapping}),S=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(S=v.filter(function(k){return t.applyAttributeMapping(p,k)[0]})),x.length){var A=t.mapping(r,x,S,r.getEncodedData());r.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(r,n){var t=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=r.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(S){return t.applyAttributeMapping(l,S)[0]})),v=r.processData(v);var x=this.mapping(r,u,v,void 0);return r.setEncodedData(x),p.length===0&&r.encodeDataLength===0?!1:(r.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(r,n,t,o){var u=this,l=r.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(A){return A.scale!==void 0}).filter(function(A){return A.name!=="filter"}),S=t.map(function(A,k){var D=o?o[k]:{},R=(0,O.Z)({id:A._id,coordinates:A.coordinates},D);if(x.forEach(function(me){var ge=u.applyAttributeMapping(me,A);(me.name==="color"||me.name==="stroke")&&(ge=ge.map(function(Ze){return qn(Ze)})),R[me.name]=Array.isArray(ge)&&ge.length===1?ge[0]:ge,me.name==="shape"&&(R.shape=u.fontService.getIconFontKey(R[me.name]))}),v.enable&&R.shape==="line"){var Z=R.coordinates;if(r.arrowInsertCount<r.encodeDataLength){var W=u.getArrowPoints(Z[0],Z[1]);R.coordinates.splice(1,0,W,W),r.arrowInsertCount++}}return R});return n.forEach(function(A){A.needRemapping=!1}),this.adjustData2Amap2Coordinates(S,r),this.adjustData2SimpleCoordinates(S),S}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var t=this;if(r.length>0&&this.mapService.version===oc["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;r.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=oc["GAODE2.x"],u.originCoordinates=u5(u.coordinates),u.coordinates=t.mapService.coordToAMap2RelativeCoordinates(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===oc.SIMPLE&&r.map(function(t){t.simpleCoordinate||(t.coordinates=n.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var t=[];return r.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),t.push(l)}),t}else{var o=[];return r.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(r,n){var t;if(!r.scale)return[];var o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=r.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=r.mapping?r.mapping(u):[];return l}},{key:"getArrowPoints",value:function(r,n){var t=[n[0]-r[0],n[1]-r[1]],o=jl(t),u=[r[0]+o[0]*1e-4,r[1]+o[1]*1e-4];return u}}]),e}(),a1=jr(bm.prototype,"mapService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=jr(bm.prototype,"fontService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||i1),s1,u1,c5=(s1=(0,Nt.b2)(),s1(u1=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ne.IMapService),r.hooks.init.tapPromise("DataSourcePlugin",(0,Pt.Z)(pe().mark(function t(){var o,u,l,p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.log(as.SourceInitStart,Lt.INIT),o=r.getSource(),o||(u=r.sourceOption||r.defaultSourceConfig,l=u.data,p=u.options,o=new f0(l,p),r.setSource(o)),!o.inited){x.next=8;break}n.updateClusterData(r),r.log(as.SourceInitEnd,Lt.INIT),x.next=10;break;case 8:return x.next=10,new Promise(function(S){o.on("update",function(A){A.type==="inited"&&(n.updateClusterData(r),r.log(as.SourceInitEnd,Lt.INIT)),S(null)})});case 10:case"end":return x.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Pt.Z)(pe().mark(function t(){var o,u,l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate,r.dataState.dataSourceNeedUpdate=!1,l=o||u,v.abrupt("return",l);case 5:case"end":return v.stop()}},t)})))}},{key:"updateClusterData",value:function(r){if(r.isTileLayer||r.tileLayer||!r.getSource())return!1;var n=r.getSource(),t=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=r.dataState.dataSourceNeedUpdate;return t&&p&&n.updateClusterData(Math.floor(l)),t&&Math.abs(r.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),r.clusterZoom=l,!0):!1}}]),e}())||u1);function T0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function l1(e){return e.length===1&&(e=f5(e)),{left:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)<0?n=o+1:t=o}return n},right:function(i,r,n,t){for(n==null&&(n=0),t==null&&(t=i.length);n<t;){var o=n+t>>>1;e(i[o],r)>0?t=o:n=o+1}return n}}}function f5(e){return function(i,r){return T0(e(i),r)}}var c1=l1(T0),h5=c1.right,GR=c1.left,Sm=h5;function f1(e,i){var r=e.length,n=-1,t,o,u;if(i==null){for(;++n<r;)if((t=e[n])!=null&&t>=t)for(o=u=t;++n<r;)(t=e[n])!=null&&(o>t&&(o=t),u<t&&(u=t))}else for(;++n<r;)if((t=i(e[n],n,e))!=null&&t>=t)for(o=u=t;++n<r;)(t=i(e[n],n,e))!=null&&(o>t&&(o=t),u<t&&(u=t));return[o,u]}var h1=Array.prototype,HR=h1.slice,WR=h1.map,M0=Math.sqrt(50),k0=Math.sqrt(10),I0=Math.sqrt(2);function p1(e,i,r){var n,t=-1,o,u,l;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=wm(e,i,r))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++t<o;)u[t]=(e+t)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++t<o;)u[t]=(e-t)/l;return n&&u.reverse(),u}function wm(e,i,r){var n=(i-e)/Math.max(0,r),t=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,t);return t>=0?(o>=M0?10:o>=k0?5:o>=I0?2:1)*Math.pow(10,t):-Math.pow(10,-t)/(o>=M0?10:o>=k0?5:o>=I0?2:1)}function P0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),t=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/t;return o>=M0?t*=10:o>=k0?t*=5:o>=I0&&(t*=2),i<e?-t:t}function $R(){var e=identity,i=extent,r=sturges;function n(t){var o,u=t.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(t[o],o,t);var v=i(p),x=v[0],S=v[1],A=r(p,x,S);Array.isArray(A)||(A=tickStep(x,S,A),A=range(Math.ceil(x/A)*A,S,A));for(var k=A.length;A[0]<=x;)A.shift(),--k;for(;A[k-1]>S;)A.pop(),--k;var D=new Array(k+1),R;for(o=0;o<=k;++o)R=D[o]=[],R.x0=o>0?A[o-1]:x,R.x1=o<k?A[o]:S;for(o=0;o<u;++o)l=p[o],x<=l&&l<=S&&D[bisect(A,l,0,k)].push(t[o]);return D}return n.value=function(t){return arguments.length?(e=typeof t=="function"?t:constant(t),n):e},n.domain=function(t){return arguments.length?(i=typeof t=="function"?t:constant([t[0],t[1]]),n):i},n.thresholds=function(t){return arguments.length?(r=typeof t=="function"?t:Array.isArray(t)?constant(slice.call(t)):constant(t),n):r},n}function XR(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function p5(e){return e===null?NaN:+e}function d5(e,i,r){if(r==null&&(r=p5),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,t=(n-1)*i,o=Math.floor(t),u=+r(e[o],o,e),l=+r(e[o+1],o+1,e);return u+(l-u)*(t-o)}}var v5=N(87765),uc="$";function Em(){}Em.prototype=d1.prototype={constructor:Em,has:function(e){return uc+e in this},get:function(e){return this[uc+e]},set:function(e,i){return this[uc+e]=i,this},remove:function(e){var i=uc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===uc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===uc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===uc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===uc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===uc&&++e;return e},empty:function(){for(var e in this)if(e[0]===uc)return!1;return!0},each:function(e){for(var i in this)i[0]===uc&&e(this[i],i.slice(1),this)}};function d1(e,i){var r=new Em;if(e instanceof Em)e.each(function(l,p){r.set(p,l)});else if(Array.isArray(e)){var n=-1,t=e.length,o;if(i==null)for(;++n<t;)r.set(n,e[n]);else for(;++n<t;)r.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)r.set(u,e[u]);return r}var L0=d1;function YR(){var e=[],i=[],r,n,t;function o(l,p,v,x){if(p>=e.length)return r!=null&&l.sort(r),n!=null?n(l):l;for(var S=-1,A=l.length,k=e[p++],D,R,Z=map(),W,me=v();++S<A;)(W=Z.get(D=k(R=l[S])+""))?W.push(R):Z.set(D,[R]);return Z.each(function(ge,Ze){x(me,Ze,o(ge,p,v,x))}),me}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(S,A){v.push({key:A,values:u(S,p)})})),x!=null?v.sort(function(S,A){return x(S.key,A.key)}):v}return t={object:function(l){return o(l,0,m5,g5)},map:function(l){return o(l,0,v1,m1)},entries:function(l){return u(o(l,0,v1,m1),0)},key:function(l){return e.push(l),t},sortKeys:function(l){return i[e.length-1]=l,t},sortValues:function(l){return r=l,t},rollup:function(l){return n=l,t}}}function m5(){return{}}function g5(e,i,r){e[i]=r}function v1(){return map()}function m1(e,i,r){e.set(i,r)}function Am(){}var _p=L0.prototype;Am.prototype=y5.prototype={constructor:Am,has:_p.has,add:function(e){return e+="",this[uc+e]=e,this},remove:_p.remove,clear:_p.clear,values:_p.keys,size:_p.size,empty:_p.empty,each:_p.each};function y5(e,i){var r=new Am;if(e instanceof Am)e.each(function(o){r.add(o)});else if(e){var n=-1,t=e.length;if(i==null)for(;++n<t;)r.add(e[n]);else for(;++n<t;)r.add(i(e[n],n,e))}return r}var qR=null,g1=Array.prototype,y1=g1.map,xp=g1.slice;function jh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function _1(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var x1={name:"implicit"};function Cm(){var e=L0(),i=[],r=[],n=x1;function t(o){var u=o+"",l=e.get(u);if(!l){if(n!==x1)return n;e.set(u,l=i.push(o))}return r[(l-1)%r.length]}return t.domain=function(o){if(!arguments.length)return i.slice();i=[],e=L0();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return t},t.range=function(o){return arguments.length?(r=xp.call(o),t):r.slice()},t.unknown=function(o){return arguments.length?(n=o,t):n},t.copy=function(){return Cm(i,r).unknown(n)},jh.apply(t,arguments),t}function b1(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],t,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var S=i().length,A=n[1]<n[0],k=n[A-0],D=n[1-A];t=(D-k)/Math.max(1,S-l+p*2),u&&(t=Math.floor(t)),k+=(D-k-t*(S-l))*v,o=t*(1-l),u&&(k=Math.round(k),o=Math.round(o));var R=sequence(S).map(function(Z){return k+t*Z});return r(A?R.reverse():R)}return e.domain=function(S){return arguments.length?(i(S),x()):i()},e.range=function(S){return arguments.length?(n=[+S[0],+S[1]],x()):n.slice()},e.rangeRound=function(S){return n=[+S[0],+S[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return t},e.round=function(S){return arguments.length?(u=!!S,x()):u},e.padding=function(S){return arguments.length?(l=Math.min(1,p=+S),x()):l},e.paddingInner=function(S){return arguments.length?(l=Math.min(1,S),x()):l},e.paddingOuter=function(S){return arguments.length?(p=+S,x()):p},e.align=function(S){return arguments.length?(v=Math.max(0,Math.min(1,S)),x()):v},e.copy=function(){return b1(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function S1(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return S1(i())},e}function KR(){return S1(b1.apply(null,arguments).paddingInner(1))}var _5=N(21775),x5=N(73626);function b5(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function S5(e){return function(){return e}}function w5(e){return+e}var w1=[0,1];function gu(e){return e}function R0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:S5(isNaN(i)?NaN:.5)}function E1(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(t){return Math.max(i,Math.min(r,t))}}function E5(e,i,r){var n=e[0],t=e[1],o=i[0],u=i[1];return t<n?(n=R0(t,n),o=r(u,o)):(n=R0(n,t),o=r(o,u)),function(l){return o(n(l))}}function A5(e,i,r){var n=Math.min(e.length,i.length)-1,t=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)t[u]=R0(e[u],e[u+1]),o[u]=r(i[u],i[u+1]);return function(l){var p=Sm(e,l,1,n)-1;return o[p](t[p](l))}}function Tm(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function D0(){var e=w1,i=w1,r=_5.Z,n,t,o,u=gu,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?A5:E5,p=v=null,S}function S(A){return isNaN(A=+A)?o:(p||(p=l(e.map(n),i,r)))(n(u(A)))}return S.invert=function(A){return u(t((v||(v=l(i,e.map(n),x5.Z)))(A)))},S.domain=function(A){return arguments.length?(e=y1.call(A,w5),u===gu||(u=E1(e)),x()):e.slice()},S.range=function(A){return arguments.length?(i=xp.call(A),x()):i.slice()},S.rangeRound=function(A){return i=xp.call(A),r=b5,x()},S.clamp=function(A){return arguments.length?(u=A?E1(e):gu,S):u!==gu},S.interpolate=function(A){return arguments.length?(r=A,x()):r},S.unknown=function(A){return arguments.length?(o=A,S):o},function(A,k){return n=A,t=k,x()}}function A1(e,i){return D0()(e,i)}var C5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Mm(e){if(!(i=C5.exec(e)))throw new Error("invalid format: "+e);var i;return new O0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Mm.prototype=O0.prototype;function O0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}O0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function T5(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function km(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function hd(e){return e=km(Math.abs(e)),e?e[1]:NaN}function M5(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(hd(i)/3)))*3-hd(Math.abs(e)))}function k5(e,i){return function(r,n){for(var t=r.length,o=[],u=0,l=e[0],p=0;t>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(r.substring(t-=l,t+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function I5(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function P5(e){e:for(var i=e.length,r=1,n=-1,t;r<i;++r)switch(e[r]){case".":n=t=r;break;case"0":n===0&&(n=r),t=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(t+1):e}var C1;function L5(e,i){var r=km(e,i);if(!r)return e+"";var n=r[0],t=r[1],o=t-(C1=Math.max(-8,Math.min(8,Math.floor(t/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+km(e,Math.max(0,i+o-1))[0]}function T1(e,i){var r=km(e,i);if(!r)return e+"";var n=r[0],t=r[1];return t<0?"0."+new Array(-t).join("0")+n:n.length>t+1?n.slice(0,t+1)+"."+n.slice(t+1):n+new Array(t-n.length+2).join("0")}var M1={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:T5,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return T1(e*100,i)},r:T1,s:L5,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function k1(e){return e}var I1=Array.prototype.map,P1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function R5(e){var i=e.grouping===void 0||e.thousands===void 0?k1:k5(I1.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",t=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?k1:I5(I1.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(S){S=Mm(S);var A=S.fill,k=S.align,D=S.sign,R=S.symbol,Z=S.zero,W=S.width,me=S.comma,ge=S.precision,Ze=S.trim,Ve=S.type;Ve==="n"?(me=!0,Ve="g"):M1[Ve]||(ge===void 0&&(ge=12),Ze=!0,Ve="g"),(Z||A==="0"&&k==="=")&&(Z=!0,A="0",k="=");var rt=R==="$"?r:R==="#"&&/[boxX]/.test(Ve)?"0"+Ve.toLowerCase():"",wt=R==="$"?n:/[%p]/.test(Ve)?u:"",Ut=M1[Ve],Yt=/[defgprs%]/.test(Ve);ge=ge===void 0?6:/[gprs]/.test(Ve)?Math.max(1,Math.min(21,ge)):Math.max(0,Math.min(20,ge));function mr(fr){var Wr=rt,hn=wt,Pn,Vi,Da;if(Ve==="c")hn=Ut(fr)+hn,fr="";else{fr=+fr;var ja=fr<0||1/fr<0;if(fr=isNaN(fr)?p:Ut(Math.abs(fr),ge),Ze&&(fr=P5(fr)),ja&&+fr==0&&D!=="+"&&(ja=!1),Wr=(ja?D==="("?D:l:D==="-"||D==="("?"":D)+Wr,hn=(Ve==="s"?P1[8+C1/3]:"")+hn+(ja&&D==="("?")":""),Yt){for(Pn=-1,Vi=fr.length;++Pn<Vi;)if(Da=fr.charCodeAt(Pn),48>Da||Da>57){hn=(Da===46?t+fr.slice(Pn+1):fr.slice(Pn))+hn,fr=fr.slice(0,Pn);break}}}me&&!Z&&(fr=i(fr,Infinity));var ao=Wr.length+fr.length+hn.length,Ho=ao<W?new Array(W-ao+1).join(A):"";switch(me&&Z&&(fr=i(Ho+fr,Ho.length?W-hn.length:Infinity),Ho=""),k){case"<":fr=Wr+fr+hn+Ho;break;case"=":fr=Wr+Ho+fr+hn;break;case"^":fr=Ho.slice(0,ao=Ho.length>>1)+Wr+fr+hn+Ho.slice(ao);break;default:fr=Ho+Wr+fr+hn;break}return o(fr)}return mr.toString=function(){return S+""},mr}function x(S,A){var k=v((S=Mm(S),S.type="f",S)),D=Math.max(-8,Math.min(8,Math.floor(hd(A)/3)))*3,R=Math.pow(10,-D),Z=P1[8+D/3];return function(W){return k(R*W)+Z}}return{format:v,formatPrefix:x}}var Im,F0,L1;D5({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function D5(e){return Im=R5(e),F0=Im.format,L1=Im.formatPrefix,Im}function O5(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,hd(i)-hd(e))+1}function F5(e){return Math.max(0,-hd(Math.abs(e)))}function B5(e,i,r,n){var t=P0(e,i,r),o;switch(n=Mm(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=M5(t,u))&&(n.precision=o),L1(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=O5(t,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=F5(t))&&(n.precision=o-(n.type==="%")*2);break}}return F0(n)}function vv(e){var i=e.domain;return e.ticks=function(r){var n=i();return p1(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var t=i();return B5(t[0],t[t.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),t=0,o=n.length-1,u=n[t],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=t,t=o,o=p),p=wm(u,l,r),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=wm(u,l,r)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=wm(u,l,r)),p>0?(n[t]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[t]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function R1(){var e=A1(gu,gu);return e.copy=function(){return Tm(e,R1())},jh.apply(e,arguments),vv(e)}function z5(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=map.call(n,number),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return z5(e).unknown(i)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function D1(e,i){e=e.slice();var r=0,n=e.length-1,t=e[r],o=e[n],u;return o<t&&(u=r,r=n,n=u,u=t,t=o,o=u),e[r]=i.floor(t),e[n]=i.ceil(o),e}function O1(e){return Math.log(e)}function F1(e){return Math.exp(e)}function N5(e){return-Math.log(-e)}function Z5(e){return-Math.exp(-e)}function U5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function V5(e){return e===10?U5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function j5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function B1(e){return function(i){return-e(-i)}}function G5(e){var i=e(O1,F1),r=i.domain,n=10,t,o;function u(){return t=j5(n),o=V5(n),r()[0]<0?(t=B1(t),o=B1(o),e(N5,Z5)):e(O1,F1),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(r(l),u()):r()},i.ticks=function(l){var p=r(),v=p[0],x=p[p.length-1],S;(S=x<v)&&(A=v,v=x,x=A);var A=t(v),k=t(x),D,R,Z,W=l==null?10:+l,me=[];if(!(n%1)&&k-A<W){if(A=Math.round(A)-1,k=Math.round(k)+1,v>0){for(;A<k;++A)for(R=1,D=o(A);R<n;++R)if(Z=D*R,!(Z<v)){if(Z>x)break;me.push(Z)}}else for(;A<k;++A)for(R=n-1,D=o(A);R>=1;--R)if(Z=D*R,!(Z<v)){if(Z>x)break;me.push(Z)}}else me=p1(A,k,Math.min(k-A,W)).map(o);return S?me.reverse():me},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=F0(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var S=x/o(Math.round(t(x)));return S*n<n-.5&&(S*=n),S<=v?p(x):""}},i.nice=function(){return r(D1(r(),{floor:function(l){return o(Math.floor(t(l)))},ceil:function(l){return o(Math.ceil(t(l)))}}))},i}function z1(){var e=G5(D0()).domain([1,10]);return e.copy=function(){return Tm(e,z1()).base(e.base())},jh.apply(e,arguments),e}function N1(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Z1(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function H5(e){var i=1,r=e(N1(i),Z1(i));return r.constant=function(n){return arguments.length?e(N1(i=+n),Z1(i)):i},linearish(r)}function W5(){var e=H5(transformer());return e.copy=function(){return copy(e,W5()).constant(e.constant())},initRange.apply(e,arguments)}function U1(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function $5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function X5(e){return e<0?-e*e:e*e}function Y5(e){var i=e(gu,gu),r=1;function n(){return r===1?e(gu,gu):r===.5?e($5,X5):e(U1(r),U1(1/r))}return i.exponent=function(t){return arguments.length?(r=+t,n()):r},vv(i)}function B0(){var e=Y5(D0());return e.copy=function(){return Tm(e,B0()).exponent(e.exponent())},jh.apply(e,arguments),e}function JR(){return B0.apply(null,arguments).exponent(.5)}function V1(){var e=[],i=[],r=[],n;function t(){var u=0,l=Math.max(1,i.length);for(r=new Array(l-1);++u<l;)r[u-1]=d5(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[Sm(r,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?r[l-1]:e[0],l<r.length?r[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(T0),t()},o.range=function(u){return arguments.length?(i=xp.call(u),t()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return V1().domain(e).range(i).unknown(n)},jh.apply(o,arguments)}function j1(){var e=0,i=1,r=1,n=[.5],t=[0,1],o;function u(p){return p<=p?t[Sm(n,p,0,r)]:o}function l(){var p=-1;for(n=new Array(r);++p<r;)n[p]=((p+1)*i-(p-r)*e)/(r+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(r=(t=xp.call(p)).length-1,l()):t.slice()},u.invertExtent=function(p){var v=t.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=r?[n[r-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return j1().domain([e,i]).range(t).unknown(o)},jh.apply(vv(u),arguments)}function G1(){var e=[.5],i=[0,1],r,n=1;function t(o){return o<=o?i[Sm(e,o,0,n)]:r}return t.domain=function(o){return arguments.length?(e=xp.call(o),n=Math.min(e.length,i.length-1),t):e.slice()},t.range=function(o){return arguments.length?(i=xp.call(o),n=Math.min(e.length,i.length-1),t):i.slice()},t.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},t.unknown=function(o){return arguments.length?(r=o,t):r},t.copy=function(){return G1().domain(e).range(i).unknown(r)},jh.apply(t,arguments)}var z0=new Date,N0=new Date;function Ou(e,i,r,n){function t(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return t.floor=function(o){return e(o=new Date(+o)),o},t.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},t.round=function(o){var u=t(o),l=t.ceil(o);return o-u<l-o?u:l},t.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},t.range=function(o,u,l){var p=[],v;if(o=t.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},t.filter=function(o){return Ou(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},r&&(t.count=function(o,u){return z0.setTime(+o),N0.setTime(+u),e(z0),e(N0),Math.floor(r(z0,N0))},t.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?t.filter(n?function(u){return n(u)%o==0}:function(u){return t.count(0,u)%o==0}):t}),t}var Z0=Ou(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Z0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ou(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var pd=Z0,QR=Z0.range,H1=Ou(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),q5=H1,e6=H1.range,Pm=1e3,mv=6e4,W1=36e5,$1=864e5,X1=6048e5;function bp(e){return Ou(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*mv)/X1})}var U0=bp(0),Lm=bp(1),K5=bp(2),J5=bp(3),dd=bp(4),Q5=bp(5),e4=bp(6),t6=U0.range,r6=Lm.range,n6=K5.range,i6=J5.range,a6=dd.range,o6=Q5.range,s6=e4.range,Y1=Ou(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*mv)/$1},function(e){return e.getDate()-1}),V0=Y1,u6=Y1.range,q1=Ou(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Pm-e.getMinutes()*mv)},function(e,i){e.setTime(+e+i*W1)},function(e,i){return(i-e)/W1},function(e){return e.getHours()}),t4=q1,l6=q1.range,K1=Ou(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Pm)},function(e,i){e.setTime(+e+i*mv)},function(e,i){return(i-e)/mv},function(e){return e.getMinutes()}),r4=K1,c6=K1.range,J1=Ou(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Pm)},function(e,i){return(i-e)/Pm},function(e){return e.getUTCSeconds()}),n4=J1,f6=J1.range,Rm=Ou(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});Rm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ou(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):Rm};var i4=Rm,h6=Rm.range;function Sp(e){return Ou(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/X1})}var Q1=Sp(0),Dm=Sp(1),a4=Sp(2),o4=Sp(3),vd=Sp(4),s4=Sp(5),u4=Sp(6),p6=Q1.range,d6=Dm.range,v6=a4.range,m6=o4.range,g6=vd.range,y6=s4.range,_6=u4.range,ex=Ou(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/$1},function(e){return e.getUTCDate()-1}),tx=ex,x6=ex.range,j0=Ou(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});j0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ou(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var gv=j0,b6=j0.range;function G0(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function H0(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function yv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function l4(e){var i=e.dateTime,r=e.date,n=e.time,t=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=_v(t),x=xv(t),S=_v(o),A=xv(o),k=_v(u),D=xv(u),R=_v(l),Z=xv(l),W=_v(p),me=xv(p),ge={a:ja,A:ao,b:Ho,B:eh,c:null,d:sx,e:sx,f:L4,g:V4,G:G4,H:k4,I:I4,j:P4,L:ux,m:R4,M:D4,p:nR,q:iR,Q:dx,s:vx,S:O4,u:F4,U:B4,V:z4,w:N4,W:Z4,x:null,X:null,y:U4,Y:j4,Z:H4,"%":px},Ze={a:aR,A:oR,b:sR,B:uR,c:null,d:cx,e:cx,f:Y4,g:ak,G:sk,H:W4,I:$4,j:X4,L:fx,m:q4,M:K4,p:lR,q:cR,Q:dx,s:vx,S:J4,u:Q4,U:ek,V:tk,w:rk,W:nk,x:null,X:null,y:ik,Y:ok,Z:uk,"%":px},Ve={a:mr,A:fr,b:Wr,B:hn,c:Pn,d:ax,e:ax,f:A4,g:ix,G:nx,H:ox,I:ox,j:b4,L:E4,m:x4,M:S4,p:Yt,q:_4,Q:T4,s:M4,S:w4,u:d4,U:v4,V:m4,w:p4,W:g4,x:Vi,X:Da,y:ix,Y:nx,Z:y4,"%":C4};ge.x=rt(r,ge),ge.X=rt(n,ge),ge.c=rt(i,ge),Ze.x=rt(r,Ze),Ze.X=rt(n,Ze),Ze.c=rt(i,Ze);function rt(ti,na){return function(ya){var pn=[],fl=-1,po=0,Ll=ti.length,Rl,Cp,a2;for(ya instanceof Date||(ya=new Date(+ya));++fl<Ll;)ti.charCodeAt(fl)===37&&(pn.push(ti.slice(po,fl)),(Cp=rx[Rl=ti.charAt(++fl)])!=null?Rl=ti.charAt(++fl):Cp=Rl==="e"?" ":"0",(a2=na[Rl])&&(Rl=a2(ya,Cp)),pn.push(Rl),po=fl+1);return pn.push(ti.slice(po,fl)),pn.join("")}}function wt(ti,na){return function(ya){var pn=yv(1900,void 0,1),fl=Ut(pn,ti,ya+="",0),po,Ll;if(fl!=ya.length)return null;if("Q"in pn)return new Date(pn.Q);if("s"in pn)return new Date(pn.s*1e3+("L"in pn?pn.L:0));if(na&&!("Z"in pn)&&(pn.Z=0),"p"in pn&&(pn.H=pn.H%12+pn.p*12),pn.m===void 0&&(pn.m="q"in pn?pn.q:0),"V"in pn){if(pn.V<1||pn.V>53)return null;"w"in pn||(pn.w=1),"Z"in pn?(po=H0(yv(pn.y,0,1)),Ll=po.getUTCDay(),po=Ll>4||Ll===0?Dm.ceil(po):Dm(po),po=tx.offset(po,(pn.V-1)*7),pn.y=po.getUTCFullYear(),pn.m=po.getUTCMonth(),pn.d=po.getUTCDate()+(pn.w+6)%7):(po=G0(yv(pn.y,0,1)),Ll=po.getDay(),po=Ll>4||Ll===0?Lm.ceil(po):Lm(po),po=V0.offset(po,(pn.V-1)*7),pn.y=po.getFullYear(),pn.m=po.getMonth(),pn.d=po.getDate()+(pn.w+6)%7)}else("W"in pn||"U"in pn)&&("w"in pn||(pn.w="u"in pn?pn.u%7:"W"in pn?1:0),Ll="Z"in pn?H0(yv(pn.y,0,1)).getUTCDay():G0(yv(pn.y,0,1)).getDay(),pn.m=0,pn.d="W"in pn?(pn.w+6)%7+pn.W*7-(Ll+5)%7:pn.w+pn.U*7-(Ll+6)%7);return"Z"in pn?(pn.H+=pn.Z/100|0,pn.M+=pn.Z%100,H0(pn)):G0(pn)}}function Ut(ti,na,ya,pn){for(var fl=0,po=na.length,Ll=ya.length,Rl,Cp;fl<po;){if(pn>=Ll)return-1;if(Rl=na.charCodeAt(fl++),Rl===37){if(Rl=na.charAt(fl++),Cp=Ve[Rl in rx?na.charAt(fl++):Rl],!Cp||(pn=Cp(ti,ya,pn))<0)return-1}else if(Rl!=ya.charCodeAt(pn++))return-1}return pn}function Yt(ti,na,ya){var pn=v.exec(na.slice(ya));return pn?(ti.p=x[pn[0].toLowerCase()],ya+pn[0].length):-1}function mr(ti,na,ya){var pn=k.exec(na.slice(ya));return pn?(ti.w=D[pn[0].toLowerCase()],ya+pn[0].length):-1}function fr(ti,na,ya){var pn=S.exec(na.slice(ya));return pn?(ti.w=A[pn[0].toLowerCase()],ya+pn[0].length):-1}function Wr(ti,na,ya){var pn=W.exec(na.slice(ya));return pn?(ti.m=me[pn[0].toLowerCase()],ya+pn[0].length):-1}function hn(ti,na,ya){var pn=R.exec(na.slice(ya));return pn?(ti.m=Z[pn[0].toLowerCase()],ya+pn[0].length):-1}function Pn(ti,na,ya){return Ut(ti,i,na,ya)}function Vi(ti,na,ya){return Ut(ti,r,na,ya)}function Da(ti,na,ya){return Ut(ti,n,na,ya)}function ja(ti){return u[ti.getDay()]}function ao(ti){return o[ti.getDay()]}function Ho(ti){return p[ti.getMonth()]}function eh(ti){return l[ti.getMonth()]}function nR(ti){return t[+(ti.getHours()>=12)]}function iR(ti){return 1+~~(ti.getMonth()/3)}function aR(ti){return u[ti.getUTCDay()]}function oR(ti){return o[ti.getUTCDay()]}function sR(ti){return p[ti.getUTCMonth()]}function uR(ti){return l[ti.getUTCMonth()]}function lR(ti){return t[+(ti.getUTCHours()>=12)]}function cR(ti){return 1+~~(ti.getUTCMonth()/3)}return{format:function(ti){var na=rt(ti+="",ge);return na.toString=function(){return ti},na},parse:function(ti){var na=wt(ti+="",!1);return na.toString=function(){return ti},na},utcFormat:function(ti){var na=rt(ti+="",Ze);return na.toString=function(){return ti},na},utcParse:function(ti){var na=wt(ti+="",!0);return na.toString=function(){return ti},na}}}var rx={"-":"",_:" ","0":"0"},zs=/^\s*\d+/,c4=/^%/,f4=/[\\^$*+?|[\]().{}]/g;function ga(e,i,r){var n=e<0?"-":"",t=(n?-e:e)+"",o=t.length;return n+(o<r?new Array(r-o+1).join(i)+t:t)}function h4(e){return e.replace(f4,"\\$&")}function _v(e){return new RegExp("^(?:"+e.map(h4).join("|")+")","i")}function xv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function p4(e,i,r){var n=zs.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function d4(e,i,r){var n=zs.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function v4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function m4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function g4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function nx(e,i,r){var n=zs.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function ix(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function y4(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function _4(e,i,r){var n=zs.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function x4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function ax(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function b4(e,i,r){var n=zs.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function ox(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function S4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function w4(e,i,r){var n=zs.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function E4(e,i,r){var n=zs.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function A4(e,i,r){var n=zs.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function C4(e,i,r){var n=c4.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function T4(e,i,r){var n=zs.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function M4(e,i,r){var n=zs.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function sx(e,i){return ga(e.getDate(),i,2)}function k4(e,i){return ga(e.getHours(),i,2)}function I4(e,i){return ga(e.getHours()%12||12,i,2)}function P4(e,i){return ga(1+V0.count(pd(e),e),i,3)}function ux(e,i){return ga(e.getMilliseconds(),i,3)}function L4(e,i){return ux(e,i)+"000"}function R4(e,i){return ga(e.getMonth()+1,i,2)}function D4(e,i){return ga(e.getMinutes(),i,2)}function O4(e,i){return ga(e.getSeconds(),i,2)}function F4(e){var i=e.getDay();return i===0?7:i}function B4(e,i){return ga(U0.count(pd(e)-1,e),i,2)}function lx(e){var i=e.getDay();return i>=4||i===0?dd(e):dd.ceil(e)}function z4(e,i){return e=lx(e),ga(dd.count(pd(e),e)+(pd(e).getDay()===4),i,2)}function N4(e){return e.getDay()}function Z4(e,i){return ga(Lm.count(pd(e)-1,e),i,2)}function U4(e,i){return ga(e.getFullYear()%100,i,2)}function V4(e,i){return e=lx(e),ga(e.getFullYear()%100,i,2)}function j4(e,i){return ga(e.getFullYear()%1e4,i,4)}function G4(e,i){var r=e.getDay();return e=r>=4||r===0?dd(e):dd.ceil(e),ga(e.getFullYear()%1e4,i,4)}function H4(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ga(i/60|0,"0",2)+ga(i%60,"0",2)}function cx(e,i){return ga(e.getUTCDate(),i,2)}function W4(e,i){return ga(e.getUTCHours(),i,2)}function $4(e,i){return ga(e.getUTCHours()%12||12,i,2)}function X4(e,i){return ga(1+tx.count(gv(e),e),i,3)}function fx(e,i){return ga(e.getUTCMilliseconds(),i,3)}function Y4(e,i){return fx(e,i)+"000"}function q4(e,i){return ga(e.getUTCMonth()+1,i,2)}function K4(e,i){return ga(e.getUTCMinutes(),i,2)}function J4(e,i){return ga(e.getUTCSeconds(),i,2)}function Q4(e){var i=e.getUTCDay();return i===0?7:i}function ek(e,i){return ga(Q1.count(gv(e)-1,e),i,2)}function hx(e){var i=e.getUTCDay();return i>=4||i===0?vd(e):vd.ceil(e)}function tk(e,i){return e=hx(e),ga(vd.count(gv(e),e)+(gv(e).getUTCDay()===4),i,2)}function rk(e){return e.getUTCDay()}function nk(e,i){return ga(Dm.count(gv(e)-1,e),i,2)}function ik(e,i){return ga(e.getUTCFullYear()%100,i,2)}function ak(e,i){return e=hx(e),ga(e.getUTCFullYear()%100,i,2)}function ok(e,i){return ga(e.getUTCFullYear()%1e4,i,4)}function sk(e,i){var r=e.getUTCDay();return e=r>=4||r===0?vd(e):vd.ceil(e),ga(e.getUTCFullYear()%1e4,i,4)}function uk(){return"+0000"}function px(){return"%"}function dx(e){return+e}function vx(e){return Math.floor(+e/1e3)}var md,mx,lk,ck,fk;hk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function hk(e){return md=l4(e),mx=md.format,lk=md.parse,ck=md.utcFormat,fk=md.utcParse,md}var bv=1e3,Sv=bv*60,wv=Sv*60,Ev=wv*24,pk=Ev*7,gx=Ev*30,W0=Ev*365;function dk(e){return new Date(e)}function vk(e){return e instanceof Date?+e:+new Date(+e)}function yx(e,i,r,n,t,o,u,l,p){var v=A1(gu,gu),x=v.invert,S=v.domain,A=p(".%L"),k=p(":%S"),D=p("%I:%M"),R=p("%I %p"),Z=p("%a %d"),W=p("%b %d"),me=p("%B"),ge=p("%Y"),Ze=[[u,1,bv],[u,5,5*bv],[u,15,15*bv],[u,30,30*bv],[o,1,Sv],[o,5,5*Sv],[o,15,15*Sv],[o,30,30*Sv],[t,1,wv],[t,3,3*wv],[t,6,6*wv],[t,12,12*wv],[n,1,Ev],[n,2,2*Ev],[r,1,pk],[i,1,gx],[i,3,3*gx],[e,1,W0]];function Ve(wt){return(u(wt)<wt?A:o(wt)<wt?k:t(wt)<wt?D:n(wt)<wt?R:i(wt)<wt?r(wt)<wt?Z:W:e(wt)<wt?me:ge)(wt)}function rt(wt,Ut,Yt,mr){if(wt==null&&(wt=10),typeof wt=="number"){var fr=Math.abs(Yt-Ut)/wt,Wr=l1(function(hn){return hn[2]}).right(Ze,fr);Wr===Ze.length?(mr=P0(Ut/W0,Yt/W0,wt),wt=e):Wr?(Wr=Ze[fr/Ze[Wr-1][2]<Ze[Wr][2]/fr?Wr-1:Wr],mr=Wr[1],wt=Wr[0]):(mr=Math.max(P0(Ut,Yt,wt),1),wt=l)}return mr==null?wt:wt.every(mr)}return v.invert=function(wt){return new Date(x(wt))},v.domain=function(wt){return arguments.length?S(y1.call(wt,vk)):S().map(dk)},v.ticks=function(wt,Ut){var Yt=S(),mr=Yt[0],fr=Yt[Yt.length-1],Wr=fr<mr,hn;return Wr&&(hn=mr,mr=fr,fr=hn),hn=rt(wt,mr,fr,Ut),hn=hn?hn.range(mr,fr+1):[],Wr?hn.reverse():hn},v.tickFormat=function(wt,Ut){return Ut==null?Ve:p(Ut)},v.nice=function(wt,Ut){var Yt=S();return(wt=rt(wt,Yt[0],Yt[Yt.length-1],Ut))?S(D1(Yt,wt)):v},v.copy=function(){return Tm(v,yx(e,i,r,n,t,o,u,l,p))},v}function mk(){return jh.apply(yx(pd,q5,U0,V0,t4,r4,n4,i4,mx).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function S6(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Om(){var e=0,i=1,r,n,t,o,u=gu,l=!1,p;function v(x){return isNaN(x=+x)?p:u(t===0?.5:(x=(o(x)-r)*t,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(r=o(e=+x[0]),n=o(i=+x[1]),t=r===n?0:1/(n-r),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,r=x(e),n=x(i),t=r===n?0:1/(n-r),v}}function Av(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function _x(){var e=vv(Om()(gu));return e.copy=function(){return Av(e,_x())},_1.apply(e,arguments)}function gk(){var e=loggish(Om()).domain([1,10]);return e.copy=function(){return Av(e,gk()).base(e.base())},initInterpolator.apply(e,arguments)}function yk(){var e=symlogish(Om());return e.copy=function(){return Av(e,yk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function xx(){var e=powish(Om());return e.copy=function(){return Av(e,xx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function w6(){return xx.apply(null,arguments).exponent(.5)}function _k(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var t=0,o=n.length,u;t<o;++t)u=n[t],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return _k(i).domain(e)},initInterpolator.apply(r,arguments)}function Fm(){var e=0,i=.5,r=1,n,t,o,u,l,p=gu,v,x=!1,S;function A(k){return isNaN(k=+k)?S:(k=.5+((k=+v(k))-t)*(k<t?u:l),p(x?Math.max(0,Math.min(1,k)):k))}return A.domain=function(k){return arguments.length?(n=v(e=+k[0]),t=v(i=+k[1]),o=v(r=+k[2]),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A):[e,i,r]},A.clamp=function(k){return arguments.length?(x=!!k,A):x},A.interpolator=function(k){return arguments.length?(p=k,A):p},A.unknown=function(k){return arguments.length?(S=k,A):S},function(k){return v=k,n=k(e),t=k(i),o=k(r),u=n===t?0:.5/(t-n),l=t===o?0:.5/(o-t),A}}function bx(){var e=vv(Fm()(gu));return e.copy=function(){return Av(e,bx())},_1.apply(e,arguments)}function xk(){var e=loggish(Fm()).domain([.1,1,10]);return e.copy=function(){return copy(e,xk()).base(e.base())},initInterpolator.apply(e,arguments)}function bk(){var e=symlogish(Fm());return e.copy=function(){return copy(e,bk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Sx(){var e=powish(Fm());return e.copy=function(){return copy(e,Sx()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function E6(){return Sx.apply(null,arguments).exponent(.5)}function Ex(e){var i,r=[];function n(t){return t==null?i:t}return n.invert=n,n.domain=n.range=function(t){return t?(r=t,t):r},n.unknown=function(t){return t?(i=t,t):i},n.copy=function(){return Ex(e).unknown(i)},n}var Pl,Ax,Cx,$0=ei.isNil,Sk=ei.isString,wk=ei.uniq,Ek=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Ak=(Pl={},(0,F.Z)(Pl,Ra.LINEAR,R1),(0,F.Z)(Pl,Ra.POWER,B0),(0,F.Z)(Pl,Ra.LOG,z1),(0,F.Z)(Pl,Ra.IDENTITY,Ex),(0,F.Z)(Pl,Ra.SEQUENTIAL,_x),(0,F.Z)(Pl,Ra.TIME,mk),(0,F.Z)(Pl,Ra.QUANTILE,V1),(0,F.Z)(Pl,Ra.QUANTIZE,j1),(0,F.Z)(Pl,Ra.THRESHOLD,G1),(0,F.Z)(Pl,Ra.CAT,Cm),(0,F.Z)(Pl,Ra.DIVERGING,bx),Pl),Ck=(Ax=(0,Nt.b2)(),Ax(Cx=function(){function e(){(0,xe.Z)(this,e),(0,F.Z)(this,"scaleOptions",{})}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("FeatureScalePlugin",(0,Pt.Z)(pe().mark(function u(){var l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(r.log(as.ScaleInitStart,Lt.INIT),t.scaleOptions=r.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=r.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){S.next=8;break}return S.abrupt("return");case 8:t.caculateScalesForAttributes(p||[],v);case 9:r.log(as.ScaleInitEnd,Lt.INIT);case 10:case"end":return S.stop()}},u)}))),r.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,Pt.Z)(pe().mark(function l(p){var v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(p){A.next=2;break}return A.abrupt("return",p);case 2:if(r.log(as.ScaleInitStart,Lt.UPDATE),t.scaleOptions=r.getScaleOptions(),v=o.getLayerStyleAttributes(),x=r.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return t.caculateScalesForAttributes(v||[],x),r.log(as.ScaleInitEnd,Lt.UPDATE),r.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){t.scaleOptions=r.getScaleOptions();var u=o.getLayerStyleAttributes(),l=r.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&t.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var t=this;r.forEach(function(o){if(o.scale){var u=o.scale,l=o.scale.field;u.names=t.parseFields($0(l)?[]:l);var p=[];u.names.forEach(function(v){var x;p.push(t.createScale(v,o.name,(x=o.scale)===null||x===void 0?void 0:x.values,n))}),p.some(function(v){return v.type===ad.VARIABLE})?(u.type=ad.VARIABLE,p.forEach(function(v){if(!u.callback&&u.values!=="text"){var x;switch((x=v.option)===null||x===void 0?void 0:x.type){case Ra.LOG:case Ra.LINEAR:case Ra.POWER:if(u.values&&u.values.length>2){var S=v.scale.ticks(u.values.length);v.scale.domain(S)}u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case Ra.QUANTILE:case Ra.QUANTIZE:case Ra.THRESHOLD:v.scale.range(u.values);break;case Ra.IDENTITY:break;case Ra.CAT:u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case Ra.DIVERGING:case Ra.SEQUENTIAL:v.scale.interpolator(v5.hD(u.values));break}}if(u.values==="text"){var A;v.scale.range((A=v.option)===null||A===void 0?void 0:A.domain)}})):(u.type=ad.CONSTANT,u.defaultValues=p.map(function(v,x){return v.scale(u.names[x])})),u.scalers=p.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Sk(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,t,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===r?this.scaleOptions[n]:this.scaleOptions[r],v={field:r,scale:void 0,type:ad.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=Cm([r]),v.type=ad.CONSTANT),v;var x=(l=o.find(function(k){return!$0(k[r])}))===null||l===void 0?void 0:l[r];if(this.isNumber(r)||$0(x)&&!p)v.scale=Cm([r]),v.type=ad.CONSTANT;else{var S=p&&p.type||this.getDefaultType(x);t==="text"&&(S=Ra.CAT),t===void 0&&(S=Ra.IDENTITY);var A=this.createScaleConfig(S,r,p,o);v.scale=this.createDefaultScale(A),v.option=A}return v}},{key:"getDefaultType",value:function(r){var n=Ra.LINEAR;return typeof r=="string"&&(n=Ek.test(r)?Ra.TIME:Ra.CAT),n}},{key:"createScaleConfig",value:function(r,n,t,o){var u={type:r},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(t!=null&&t.domain)u.domain=t==null?void 0:t.domain;else if(r===Ra.CAT||r===Ra.IDENTITY)u.domain=wk(l);else if(r===Ra.QUANTILE)u.domain=l;else if(r===Ra.DIVERGING){var p=f1(l),v=(t==null?void 0:t.neutral)!==void 0?t==null?void 0:t.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}else u.domain=f1(l);return(0,O.Z)((0,O.Z)({},u),t)}},{key:"createDefaultScale",value:function(r){var n=r.type,t=r.domain,o=r.unknown,u=r.clamp,l=r.nice,p=Ak[n]();return t&&p.domain&&p.domain(t),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||Cx),Tx,Mx,Tk=(Tx=(0,Nt.b2)(),Tx(Mx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=r.animateStatus;n&&r.models.forEach(function(t){t.addUniforms((0,O.Z)({},r.layerModel.getAnimateUniforms()))})})}}]),e}())||Mx),kx,Ix,Mk=(kx=(0,Nt.b2)(),kx(Ix=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=r.getLayerConfig(),t=n.maskLayers,o=n.enableMask;if(!r.tileLayer&&t&&t.length>0){var u;(u=r.masks).push.apply(u,(0,_r.Z)(t)),r.updateLayerConfig({mask:o})}})}}]),e}())||Ix),kk=function(){function e(i){var r=i.rendererService,n=i.layerService,t=i.parent;(0,xe.Z)(this,e),(0,F.Z)(this,"tileResource",new Map),(0,F.Z)(this,"layerTiles",[]),this.rendererService=r,this.layerService=n,this.parent=t}return(0,K.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(r){return this.layerTiles.some(function(n){return n.key===r})}},{key:"addTile",value:function(r){this.layerTiles.push(r)}},{key:"getTile",value:function(r){return this.layerTiles.find(function(n){return n.key===r})}},{key:"getVisibleTileBylngLat",value:function(r){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(r)})}},{key:"removeTile",value:function(r){var n=this.layerTiles.findIndex(function(o){return o.key===r}),t=this.layerTiles.splice(n,1);t[0]&&t[0].destroy()}},{key:"updateTileVisible",value:function(r){var n=this.getTile(r.key);if(r.isVisible)if(r.parent){var t=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(t)}else n==null||n.updateVisible(!0);else if(r.parent){var o=this.isChildrenLoaded(r.parent);n==null||n.updateVisible(!o)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(r){var n=r.parent;if(!n)return!0;var t=this.getTile(n==null?void 0:n.key);return!!(t!=null&&t.isLoaded)}},{key:"isChildrenLoaded",value:function(r){var n=this,t=r==null?void 0:r.children;return t.length===0?!0:t.every(function(o){var u=n.getTile(o==null?void 0:o.key);return u?(u==null?void 0:u.isLoaded)===!0:!0})}},{key:"render",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){var t=this,o,u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=this.getRenderLayers(),u=o.map(function(){var v=(0,Pt.Z)(pe().mark(function x(S){return pe().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,t.layerService.renderTileLayer(S);case 2:case"end":return k.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()),p.next=4,Promise.all(u);case 4:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"getRenderLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.visible&&t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,_r.Z)(t.getLayers()))}),n}},{key:"getLayers",value:function(){var r=this.layerTiles.filter(function(t){return t.isLoaded}),n=[];return r.map(function(t){return n.push.apply(n,(0,_r.Z)(t.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(r){return r.destroy()}),this.tileResource.clear()}}]),e}(),Ik=N(32676);function Pk(e,i,r){r===void 0&&(r={});var n=_n(e),t=_n(i),o=Ik.union(n.coordinates,t.coordinates);return o.length===0?null:o.length===1?Lr(o[0],r.properties):Ai(o,r.properties)}var Lk=Pk,Rk=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"getCombineFeature",value:function(r){var n=null,t=r[0];return r.map(function(o){var u=Lr(o.coordinates);n===null?n=u:n=Lk(n,u)}),t&&(n.properties=(0,O.Z)({},t)),n}}]),e}(),Cv="select",Tv="active",Dk=function(){function e(i){var r=i.layerService,n=i.tileLayerService,t=i.parent;(0,xe.Z)(this,e),(0,F.Z)(this,"tilePickID",new Map),this.layerService=r,this.tileLayerService=n,this.parent=t,this.tileSourceService=new Rk}return(0,K.Z)(e,[{key:"pickRender",value:function(r){var n=this.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(n){var t=n.getMainLayer();t==null||t.layerPickService.pickRender(r)}}},{key:"pick",value:function(r,n){var t=this.parent.getContainer(),o=t.get(Ne.IPickingService);if(r.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(r,n)}},{key:"selectFeature",value:function(r){var n=(0,Qr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Cv,l),this.updateHighLight(t,o,u,Cv)}},{key:"highlightPickedFeature",value:function(r){var n=(0,Qr.Z)(r,3),t=n[0],o=n[1],u=n[2],l=this.color2PickId(t,o,u);this.tilePickID.set(Tv,l),this.updateHighLight(t,o,u,Tv)}},{key:"updateHighLight",value:function(r,n,t,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case Cv:l==null||l.hooks.beforeSelect.call([r,n,t]);break;case Tv:l==null||l.hooks.beforeHighlight.call([r,n,t]);break}})}},{key:"setPickState",value:function(){var r=this.tilePickID.get(Cv),n=this.tilePickID.get(Tv);if(r){var t=this.pickId2Color(r),o=(0,Qr.Z)(t,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,Cv);return}if(n){var v=this.pickId2Color(n),x=(0,Qr.Z)(v,3),S=x[0],A=x[1],k=x[2];this.updateHighLight(S,A,k,Tv);return}}},{key:"color2PickId",value:function(r,n,t){return oa(new Uint8Array([r,n,t]))}},{key:"pickId2Color",value:function(r){return Qi(r)}},{key:"getFeatureById",value:function(r){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),t=[];return n.forEach(function(o){t.push.apply(t,(0,_r.Z)(o.getFeatureById(r)))}),t}},{key:"pickRasterLayer",value:function(r,n,t){return!1}}]),e}();function Ok(e){return e==="PolygonLayer"?_m:e==="LineLayer"?A0:ym}function Fk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function Bk(e){var i=zk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function zk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wp=function(e){(0,lt.Z)(r,e);var i=Bk(r);function r(n,t){var o;return(0,xe.Z)(this,r),o=i.call(this),(0,F.Z)((0,Ie.Z)(o),"visible",!0),(0,F.Z)((0,Ie.Z)(o),"layers",[]),(0,F.Z)((0,Ie.Z)(o),"isLoaded",!1),(0,F.Z)((0,Ie.Z)(o),"tileMaskLayers",[]),o.parent=t,o.sourceTile=n,o.x=n.x,o.y=n.y,o.z=n.z,o.key="".concat(o.x,"_").concat(o.y,"_").concat(o.z),o}return(0,K.Z)(r,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var o=(0,Qr.Z)(this.sourceTile.bounds,4),u=o[0],l=o[1],p=o[2],v=o[3],x=t.lng,S=t.lat;return x>=u&&x<=p&&S>=l&&S<=v}},{key:"getLayerOptions",value:function(){var t,o=this.parent.getLayerConfig();return(0,O.Z)((0,O.Z)({},o),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Fk(this.parent.type),mask:o.mask||((t=o.maskLayers)===null||t===void 0?void 0:t.length)!==0&&o.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,o=this.parent.getLayerConfig(),u=o.maskLayers,l=[];return u==null||u.forEach(function(p){if(!p.tileLayer)return l.push(p),p;var v=p.tileLayer,x=v.getTile(t.sourceTile.key),S=x==null?void 0:x.getLayers()[0];S&&l.push(S)}),l}},{key:"addTileMask",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return u=new _m({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=cv(this.parent.sceneContainer),u.setContainer(l,this.parent.sceneContainer),x.next=5,u.init();case 5:return this.tileMask=u,p=this.getMainLayer(),p!==void 0&&(p.tileMask=u),x.abrupt("return",u);case 9:case"end":return x.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"addMask",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u,l){var p;return pe().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return p=cv(this.parent.sceneContainer),l.setContainer(p,this.parent.sceneContainer),x.next=4,l.init();case 4:u.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return x.stop()}},o,this)}));function t(o,u){return n.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(u){var l;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u.isTileLayer=!0,l=cv(this.parent.sceneContainer),u.setContainer(l,this.parent.sceneContainer),this.layers.push(u),v.next=6,u.init();case 6:case"end":return v.stop()}},o,this)}));function t(o){return n.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,o){this.layers.forEach(function(u){u.updateLayerConfig((0,F.Z)({},t,o))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(function(o){return o.destroy()})}}]),r}(Ca.EventEmitter);function Nk(e){var i=Zk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Zk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uk=function(e){(0,lt.Z)(r,e);var i=Nk(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new A0().source(u.data,u.options).size(1).shape("line").color("red"),v=new ym({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),S.next=6,this.addLayer(p);case 6:return S.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),r}(wp);function Vk(e){var i=jk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gk=function(e){(0,lt.Z)(r,e);var i=Vk(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new I_((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(wp);function Hk(e){var i=Wk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Wk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $k=function(e){(0,lt.Z)(r,e);var i=Hk(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new e1((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getFeatures",value:function(t){if(!t)return[];var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:t.transforms}}}}]),r}(wp),Xk=["rasterData"];function Yk(e){var i=qk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kk=function(e){(0,lt.Z)(r,e);var i=Yk(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new xm((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,ll.Z)(o,Xk);return{data:u,options:{parser:(0,O.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}}]),r}(wp);function Jk(e){var i=Qk();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function Qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eI=function(e){(0,lt.Z)(r,e);var i=Jk(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v;return pe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new xm((0,O.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var k,D,R=A;v[R]((k=u[R])===null||k===void 0?void 0:k.field,(D=u[R])===null||D===void 0?void 0:D.values)}),S.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return S.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),r}(wp),tI=["rasterData"];function rI(e){var i=nI();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function nI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iI={positions:[0,1],colors:["#000","#fff"]},aI=function(e){(0,lt.Z)(r,e);var i=rI(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x,S,A;return pe().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=this.getLayerOptions(),x=v.rampColors,S=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(x,S),A=new xm((0,O.Z)((0,O.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(R){var Z,W,me=R;A[me]((Z=u[me])===null||Z===void 0?void 0:Z.field,(W=u[me])===null||W===void 0?void 0:W.values)}),D.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return D.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,ll.Z)(o,tI);return{data:u,options:{parser:(0,O.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u,v=p.rampColors,x=v===void 0?iI:v,S=p.domain;this.colorTexture=this.parent.textureService.getColorTexture(x,S||Dl(x)),this.layers.forEach(function(A){return A.style({colorTexture:t.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),r}(wp);function oI(e){var i=sI();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bm=function(e){(0,lt.Z)(r,e);var i=oI(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"initTileLayer",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u,l,p,v,x;return pe().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=Ok(this.parent.type),v=this.getSourceOption(),v){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return x=new p((0,O.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(k){var D,R,Z=k;x[Z]((D=u[Z])===null||D===void 0?void 0:D.field,(R=u[Z])===null||R===void 0?void 0:R.values)}),A.next=12,this.addLayer(x);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(x),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var o=this.sourceTile.data;return o.getTileData(t)}},{key:"getFeatureById",value:function(t){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(l){return l._id===t});return u}}]),r}(wp);function uI(e){var i=e.type;switch(i){case"PolygonLayer":return Bm;case"LineLayer":return Bm;case"PointLayer":return Bm;case"TileDebugLayer":return Uk;case"MaskLayer":return $k;case"RasterLayer":var r=e.getSource().parser.dataType;switch(r){case eu.RGB:case eu.CUSTOMRGB:return Kk;case eu.ARRAYBUFFER:case eu.CUSTOMARRAYBUFFER:return aI;case eu.TERRAINRGB:case eu.CUSTOMTERRAINRGB:return eI;default:return Gk}default:return Bm}}var lI=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],cI=ei.debounce,Px=function(){function e(i){var r=this;(0,xe.Z)(this,e),(0,F.Z)(this,"initedTileset",!1),(0,F.Z)(this,"mapchange",function(){var t;if(r.parent.isVisible()!==!1){var o=r.getCurrentView(),u=o.latLonBounds,l=o.zoom;if(r.mapService.version==="GAODE1.x"){var p=r.parent.getLayerConfig(),v=p.visible;l<2&&v?(r.parent.updateLayerConfig({visible:!1}),r.layerService.reRender()):l>=2&&!v&&(r.parent.updateLayerConfig({visible:!0}),r.layerService.reRender())}r.lastViewStates&&r.lastViewStates.zoom===l&&r.lastViewStates.latLonBounds.toString()===u.toString()||(r.lastViewStates={zoom:l,latLonBounds:u},(t=r.tilesetManager)===null||t===void 0||t.throttleUpdate(l,u))}}),(0,F.Z)(this,"viewchange",cI(this.mapchange,24)),this.parent=i;var n=this.parent.getContainer();this.rendererService=n.get(Ne.IRendererService),this.layerService=n.get(Ne.ILayerService),this.mapService=n.get(Ne.IMapService),this.pickingService=n.get(Ne.IPickingService),this.tileLayerService=new kk({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new Dk({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,K.Z)(e,[{key:"initTileSetManager",value:function(){var r,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var t=this.getCurrentView(),o=t.latLonBounds,u=t.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(u,o)}}},{key:"getCurrentView",value:function(){var r=this.mapService.getBounds(),n=[r[0][0],r[0][1],r[1][0],r[1][1]],t=this.mapService.getZoom();return{latLonBounds:n,zoom:t}}},{key:"bindTilesetEvent",value:function(){var r=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){r.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,t){r.tileError(n)}),this.tilesetManager.on("tile-update",function(){r.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(r){return this.tileLayerService.getTile(r)}},{key:"tileLoaded",value:function(r){}},{key:"tileError",value:function(r){console.warn("error:",r)}},{key:"destroy",value:function(){var r;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(r=this.tilesetManager)===null||r===void 0||r.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var r;this.tilesetManager.clear();var n=this.getCurrentView(),t=n.latLonBounds,o=n.zoom;(r=this.tilesetManager)===null||r===void 0||r.update(o,t)}},{key:"tileUnLoad",value:function(r){this.tileLayerService.removeTile(r.key)}},{key:"tileUpdate",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){var t=this,o,u;return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,Pt.Z)(pe().mark(function x(S){var A,k;return pe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(t.tileLayerService.hasTile(S.key)){R.next=9;break}return A=uI(t.parent),k=new A(S,t.parent),R.next=5,k.initTileLayer();case 5:t.tilePickService.setPickState(),k.getLayers().length!==0&&(t.tileLayerService.addTile(k),t.tileLayerService.updateTileVisible(S),t.layerService.reRender()),R.next=12;break;case 9:t.tileLayerService.updateTileVisible(S),t.tilePickService.setPickState(),t.layerService.reRender();case 12:case"end":return R.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"setPickState",value:function(r){}},{key:"pickRender",value:function(r){this.tilePickService.pickRender(r)}},{key:"selectFeature",value:function(r){this.tilePickService.selectFeature(r)}},{key:"highlightPickedFeature",value:function(r){this.tilePickService.highlightPickedFeature(r)}},{key:"proxy",value:function(r){var n=this;lI.forEach(function(t){var o=r[t].bind(r);r[t]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[t].apply(v,l)}),t==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),r}})}}]),e}(),Lx,Rx,fI=(Lx=(0,Nt.b2)(),Lx(Rx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"build",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t.prepareBuildModel(),u.next=3,t.buildModels();case 3:case"end":return u.stop()}},n)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"initLayerModel",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"prepareLayerModel",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"apply",value:function(r){var n=this;r.hooks.init.tapPromise("LayerModelPlugin",(0,Pt.Z)(pe().mark(function t(){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!r.getSource().isTile){u.next=4;break}return r.prepareBuildModel(),r.tileLayer=new Px(r),u.abrupt("return");case 4:return r.log(as.BuildModelStart,Lt.INIT),u.next=7,n.initLayerModel(r);case 7:r.log(as.BuildModelEnd,Lt.INIT);case 8:case"end":return u.stop()}},t)}))),r.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var t=(0,Pt.Z)(pe().mark(function o(u){return pe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!r.getSource().isTile){p.next=5;break}return r.tileLayer=new Px(r),p.abrupt("return",!1);case 5:return r.log(as.BuildModelStart,Lt.UPDATE),p.next=8,n.prepareLayerModel(r);case 8:return r.log(as.BuildModelEnd,Lt.UPDATE),p.abrupt("return",!0);case 10:case"end":return p.stop()}},o)}));return function(o){return t.apply(this,arguments)}}())}}]),e}())||Rx),Dx,Ox,hI=(Dx=(0,Nt.b2)(),Dx(Ox=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){var n=r.getLayerConfig(),t=n.autoFit,o=n.fitBoundsOptions;t&&r.fitBounds(o),r.styleNeedUpdate=!1})}}]),e}())||Ox),Fx,Bx,pI=["type"],zx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},dI={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},vI={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},mI={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function gI(e){var i={u_DirectionalLights:new Array(3).fill((0,O.Z)({},vI)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,O.Z)({},mI)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[dI]),e.forEach(function(r){var n=r.type,t=n===void 0?"directional":n,o=(0,ll.Z)(r,pI),u=zx[t].lights,l=zx[t].num,p=i[l];i[u][p]=(0,O.Z)((0,O.Z)({},i[u][p]),o),i[l]++}),i}var yI=(Fx=(0,Nt.b2)(),Fx(Bx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),t=n.enableLighting;t&&r.models.forEach(function(o){return o.addUniforms((0,O.Z)({},gI()))})})}}]),e}())||Bx),Nx,Zx,_I=(Nx=(0,Nt.b2)(),Nx(Zx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;r.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=r.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,S=x===void 0?[]:x;t.enabled=!!v&&r.getLayerConfig().enableMultiPassRenderer!==!1,t.enabled&&(r.multiPassRenderer=a_(r,S,u,l),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(t.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;r.multiPassRenderer.resize(v,x)}})}}]),e}())||Zx),Ux,Vx,zm={NONE:0,ENCODE:1,HIGHLIGHT:2},xI=(Ux=(0,Nt.b2)(),Ux(Vx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=n.styleAttributeService;r.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;t.registerStyleAttribute({name:"pickingColor",type:ln.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:q.FLOAT},size:3,update:function(p){var v=p.id;return u?Qi(v):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:zm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=r.getLayerConfig(),u=o.enablePicking;u&&r.isVisible()&&r.models.forEach(function(l){return l.addUniforms({u_PickingStage:zm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?qn(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:oa(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:zm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=r.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?qn(l):l||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:oa(new Uint8Array(o))}),r.models.forEach(function(S){return S.addUniforms({u_PickingStage:zm.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(A){return A*255}),u_EnableSelect:1})})})}}]),e}())||Vx),bI=["mvt","geojsonvt","testTile"];function SI(e){var i=e.getSource();return bI.includes(i.parser.type)}function A6(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var jx,Gx,wI=(jx=(0,Nt.b2)(),jx(Gx=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){SI(r)||t.registerBuiltinAttributes(o,r)})}},{key:"registerBuiltinAttributes",value:function(r,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(r);return}this.registerPositionAttribute(r),this.registerColorAttribute(r),this.registerVertexIdAttribute(r)}},{key:"registerPositionAttribute",value:function(r){r.registerStyleAttribute({name:"position",type:ln.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:q.FLOAT},size:3,update:function(t,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(r){r.registerStyleAttribute({name:"filter",type:ln.Attribute,descriptor:{name:"filter",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t){var o=t.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(r){r.registerStyleAttribute({name:"color",type:ln.Attribute,descriptor:{name:"a_Color",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(t){var o=t.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(r){r.registerStyleAttribute({name:"vertexId",type:ln.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(t,o){return[o]}}})}}]),e}())||Gx),Hx,Wx,$x,Xx,Yx,qx,gd,Kx,Jx,Qx,eb,EI=(Hx=(0,Nt.b2)(),Wx=(0,Nt.f3)(Ne.ICameraService),$x=(0,Nt.f3)(Ne.ICoordinateSystemService),Xx=(0,Nt.f3)(Ne.IRendererService),Yx=(0,Nt.f3)(Ne.IMapService),Hx(qx=(gd=function(){function e(){(0,xe.Z)(this,e),nn(this,"cameraService",Kx,this),nn(this,"coordinateSystemService",Jx,this),nn(this,"rendererService",Qx,this),nn(this,"mapService",eb,this)}return(0,K.Z)(e,[{key:"apply",value:function(r){var n=this,t=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=r.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),t==="GAODE2.x"&&(n.setLayerCenter(r),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;r.models.forEach(function(S){var A;S.addUniforms((A={},(0,F.Z)(A,yp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,F.Z)(A,yp.ViewMatrix,n.cameraService.getViewMatrix()),(0,F.Z)(A,yp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,F.Z)(A,yp.Zoom,n.cameraService.getZoom()),(0,F.Z)(A,yp.ZoomScale,n.cameraService.getZoomScale()),(0,F.Z)(A,yp.FocalDistance,n.cameraService.getFocalDistance()),(0,F.Z)(A,yp.CameraPosition,n.cameraService.getCameraPosition()),(0,F.Z)(A,ul.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,F.Z)(A,ul.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,F.Z)(A,ul.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,F.Z)(A,ul.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,F.Z)(A,ul.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,F.Z)(A,ul.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,F.Z)(A,ul.Mvp,o),(0,F.Z)(A,"u_sceneCenterMercator",u),(0,F.Z)(A,"u_ViewportSize",[v,x]),(0,F.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,F.Z)(A,"u_DevicePixelRatio",window.devicePixelRatio),(0,F.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,F.Z)(A,"u_shaderPick",Number(r.getShaderPickStat())),A))})})}},{key:"setLayerCenter",value:function(r){r.coordCenter===void 0&&(r.coordCenter=r.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(r.coordCenter)}}]),e}(),Kx=jr(gd.prototype,"cameraService",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jx=jr(gd.prototype,"coordinateSystemService",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qx=jr(gd.prototype,"rendererService",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=jr(gd.prototype,"mapService",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||qx),tb,rb,AI=(tb=(0,Nt.b2)(),tb(rb=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate().then(function(n){n&&r.renderLayers()})}),r.hooks.afterRender.tap("UpdateModelPlugin",function(){r.layerModelNeedUpdate=!1})}}]),e}())||rb),nb,ib,CI=(nb=(0,Nt.b2)(),nb(ib=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"apply",value:function(r,n){var t=this,o=n.styleAttributeService;r.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){t.initStyleAttribute(r,{styleAttributeService:o})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||r.inited&&t.updateStyleAttribute(r,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[],u=t.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){r.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){t.updateAttributeByFeatureRange(l.name,r.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,r),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var t=n.styleAttributeService,o=t.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){t.updateAttributeByFeatureRange(u.name,r.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||ib);cl.bind(Ne.ILayerPlugin).to(c5).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(wI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(Ck).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(l5).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(hI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(Mk).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(CI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(AI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(_I).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(EI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(Tk).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(yI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(xI).inRequestScope(),cl.bind(Ne.ILayerPlugin).to(fI).inRequestScope();var TI=N(81550),MI=N.n(TI),kI=function(){function e(i,r){(0,xe.Z)(this,e);var n=r.buffer,t=r.offset,o=r.stride,u=r.normalized,l=r.size,p=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:t||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Kf,Mv,Jf,lc,kv,Gh,Iv,Nm,df,Ep,ru,vf,mf,Zm,II=(Kf={},(0,F.Z)(Kf,q.POINTS,"points"),(0,F.Z)(Kf,q.LINES,"lines"),(0,F.Z)(Kf,q.LINE_LOOP,"line loop"),(0,F.Z)(Kf,q.LINE_STRIP,"line strip"),(0,F.Z)(Kf,q.TRIANGLES,"triangles"),(0,F.Z)(Kf,q.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(Kf,q.TRIANGLE_STRIP,"triangle strip"),Kf),ab=(Mv={},(0,F.Z)(Mv,q.STATIC_DRAW,"static"),(0,F.Z)(Mv,q.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Mv,q.STREAM_DRAW,"stream"),Mv),X0=(Jf={},(0,F.Z)(Jf,q.BYTE,"int8"),(0,F.Z)(Jf,q.UNSIGNED_INT,"int16"),(0,F.Z)(Jf,q.INT,"int32"),(0,F.Z)(Jf,q.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Jf,q.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Jf,q.UNSIGNED_INT,"uint32"),(0,F.Z)(Jf,q.FLOAT,"float"),Jf),PI=(lc={},(0,F.Z)(lc,q.ALPHA,"alpha"),(0,F.Z)(lc,q.LUMINANCE,"luminance"),(0,F.Z)(lc,q.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(lc,q.RGB,"rgb"),(0,F.Z)(lc,q.RGBA,"rgba"),(0,F.Z)(lc,q.RGBA4,"rgba4"),(0,F.Z)(lc,q.RGB5_A1,"rgb5 a1"),(0,F.Z)(lc,q.RGB565,"rgb565"),(0,F.Z)(lc,q.DEPTH_COMPONENT,"depth"),(0,F.Z)(lc,q.DEPTH_STENCIL,"depth stencil"),lc),LI=(kv={},(0,F.Z)(kv,q.DONT_CARE,"dont care"),(0,F.Z)(kv,q.NICEST,"nice"),(0,F.Z)(kv,q.FASTEST,"fast"),kv),ob=(Gh={},(0,F.Z)(Gh,q.NEAREST,"nearest"),(0,F.Z)(Gh,q.LINEAR,"linear"),(0,F.Z)(Gh,q.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(Gh,q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(Gh,q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(Gh,q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Gh),sb=(Iv={},(0,F.Z)(Iv,q.REPEAT,"repeat"),(0,F.Z)(Iv,q.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(Iv,q.MIRRORED_REPEAT,"mirror"),Iv),RI=(Nm={},(0,F.Z)(Nm,q.NONE,"none"),(0,F.Z)(Nm,q.BROWSER_DEFAULT_WEBGL,"browser"),Nm),DI=(df={},(0,F.Z)(df,q.NEVER,"never"),(0,F.Z)(df,q.ALWAYS,"always"),(0,F.Z)(df,q.LESS,"less"),(0,F.Z)(df,q.LEQUAL,"lequal"),(0,F.Z)(df,q.GREATER,"greater"),(0,F.Z)(df,q.GEQUAL,"gequal"),(0,F.Z)(df,q.EQUAL,"equal"),(0,F.Z)(df,q.NOTEQUAL,"notequal"),df),ub=(Ep={},(0,F.Z)(Ep,q.FUNC_ADD,"add"),(0,F.Z)(Ep,q.MIN_EXT,"min"),(0,F.Z)(Ep,q.MAX_EXT,"max"),(0,F.Z)(Ep,q.FUNC_SUBTRACT,"subtract"),(0,F.Z)(Ep,q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ep),Um=(ru={},(0,F.Z)(ru,q.ZERO,"zero"),(0,F.Z)(ru,q.ONE,"one"),(0,F.Z)(ru,q.SRC_COLOR,"src color"),(0,F.Z)(ru,q.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(ru,q.SRC_ALPHA,"src alpha"),(0,F.Z)(ru,q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(ru,q.DST_COLOR,"dst color"),(0,F.Z)(ru,q.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(ru,q.DST_ALPHA,"dst alpha"),(0,F.Z)(ru,q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(ru,q.CONSTANT_COLOR,"constant color"),(0,F.Z)(ru,q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(ru,q.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(ru,q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(ru,q.SRC_ALPHA_SATURATE,"src alpha saturate"),ru),OI=(vf={},(0,F.Z)(vf,q.NEVER,"never"),(0,F.Z)(vf,q.ALWAYS,"always"),(0,F.Z)(vf,q.LESS,"less"),(0,F.Z)(vf,q.LEQUAL,"lequal"),(0,F.Z)(vf,q.GREATER,"greater"),(0,F.Z)(vf,q.GEQUAL,"gequal"),(0,F.Z)(vf,q.EQUAL,"equal"),(0,F.Z)(vf,q.NOTEQUAL,"notequal"),vf),yd=(mf={},(0,F.Z)(mf,q.ZERO,"zero"),(0,F.Z)(mf,q.KEEP,"keep"),(0,F.Z)(mf,q.REPLACE,"replace"),(0,F.Z)(mf,q.INVERT,"invert"),(0,F.Z)(mf,q.INCR,"increment"),(0,F.Z)(mf,q.DECR,"decrement"),(0,F.Z)(mf,q.INCR_WRAP,"increment wrap"),(0,F.Z)(mf,q.DECR_WRAP,"decrement wrap"),mf),FI=(Zm={},(0,F.Z)(Zm,q.FRONT,"front"),(0,F.Z)(Zm,q.BACK,"back"),Zm),BI=function(){function e(i,r){(0,xe.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=r.data,t=r.usage,o=r.type;this.buffer=i.buffer({data:n,usage:ab[t||q.STATIC_DRAW],type:X0[o||q.UNSIGNED_BYTE]})}return(0,K.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(r){var n=r.data,t=r.offset;this.buffer.subdata(n,t)}}]),e}(),zI=function(){function e(i,r){(0,xe.Z)(this,e);var n=r.data,t=r.usage,o=r.type,u=r.count;this.elements=i.elements({data:n,usage:ab[t||q.STATIC_DRAW],type:X0[o||q.UNSIGNED_BYTE],count:u})}return(0,K.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),NI=function(){function e(i,r){(0,xe.Z)(this,e);var n=r.width,t=r.height,o=r.color,u=r.colors,l={width:n,height:t};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,K.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.framebuffer.resize(n,t)}}]),e}(),ZI=ei.isPlainObject,UI=ei.isTypedArray,VI=function(){function e(i,r){(0,xe.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,t=r.fs,o=r.attributes,u=r.uniforms,l=r.primitive,p=r.count,v=r.elements,x=r.depth,S=r.cull,A=r.instances,k={};this.options=r,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Z){k[Z]=i.prop(Z)}));var D={};Object.keys(o).forEach(function(Z){D[Z]=o[Z].get()});var R={attributes:D,frag:t,uniforms:k,vert:n,colorMask:i.prop("colorMask"),lineWidth:1,blend:{enable:i.prop("blend.enable"),func:i.prop("blend.func"),equation:i.prop("blend.equation"),color:i.prop("blend.color")},stencil:{enable:i.prop("stencil.enable"),mask:i.prop("stencil.mask"),func:i.prop("stencil.func"),opFront:i.prop("stencil.opFront"),opBack:i.prop("stencil.opBack")},primitive:II[l===void 0?q.TRIANGLES:l]};A&&(R.instances=A),p?R.count=p:v&&(R.elements=v.get()),this.initDepthDrawParams({depth:x},R),this.initCullDrawParams({cull:S},R),this.drawCommand=i(R),this.drawParams=R}return(0,K.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var t={};Object.keys(r).forEach(function(o){t[o]=r[o].get()}),this.drawParams.attributes=t,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(t){n[t]=r[t].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(r){this.uniforms=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var t=(0,O.Z)((0,O.Z)({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(t).forEach(function(u){var l=(0,ol.Z)(t[u]);l==="boolean"||l==="number"||Array.isArray(t[u])||t[u].BYTES_PER_ELEMENT?o[u]=t[u]:o[u]=t[u].get()}),o.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),o.stencil=this.getStencilDrawParams(r),o.colorMask=this.getColorMaskDrawParams(r,n),this.drawCommand(o)}}},{key:"destroy",value:function(){var r,n;(r=this.drawParams)===null||r===void 0||(n=r.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t==null||t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var t=r.depth;t&&(n.depth={enable:t.enable===void 0?!0:!!t.enable,mask:t.mask===void 0?!0:!!t.mask,func:DI[t.func||q.LESS],range:t.range||[0,1]})}},{key:"getBlendDrawParams",value:function(r){var n=r.blend,t=n||{},o=t.enable,u=t.func,l=t.equation,p=t.color,v=p===void 0?[0,0,0,0]:p;return{enable:!!o,func:{srcRGB:Um[u&&u.srcRGB||q.SRC_ALPHA],srcAlpha:Um[u&&u.srcAlpha||q.SRC_ALPHA],dstRGB:Um[u&&u.dstRGB||q.ONE_MINUS_SRC_ALPHA],dstAlpha:Um[u&&u.dstAlpha||q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ub[l&&l.rgb||q.FUNC_ADD],alpha:ub[l&&l.alpha||q.FUNC_ADD]},color:v}}},{key:"getStencilDrawParams",value:function(r){var n=r.stencil,t=n||{},o=t.enable,u=t.mask,l=u===void 0?-1:u,p=t.func,v=p===void 0?{cmp:q.ALWAYS,ref:0,mask:-1}:p,x=t.opFront,S=x===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:x,A=t.opBack,k=A===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:A;return{enable:!!o,mask:l,func:(0,O.Z)((0,O.Z)({},v),{},{cmp:OI[v.cmp]}),opFront:{fail:yd[S.fail],zfail:yd[S.zfail],zpass:yd[S.zpass]},opBack:{fail:yd[k.fail],zfail:yd[k.zfail],zpass:yd[k.zpass]}}}},{key:"getColorMaskDrawParams",value:function(r,n){var t=r.stencil,o=t!=null&&t.enable&&t.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return o}},{key:"initCullDrawParams",value:function(r,n){var t=r.cull;if(t){var o=t.enable,u=t.face,l=u===void 0?q.BACK:u;n.cull={enable:!!o,face:FI[l]}}}},{key:"extractUniforms",value:function(r){var n=this,t={};return Object.keys(r).forEach(function(o){n.extractUniformsRecursively(o,r[o],t,"")}),t}},{key:"extractUniformsRecursively",value:function(r,n,t,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||UI(n)||n===""||"resize"in n){t["".concat(o&&o+".").concat(r)]=n;return}ZI(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],t,"".concat(o&&o+".").concat(r))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],t,"".concat(o&&o+".").concat(r,"[").concat(p,"]"))})})}}]),e}(),jI=function(){function e(i,r){(0,xe.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=r.data,t=r.type,o=t===void 0?q.UNSIGNED_BYTE:t,u=r.width,l=r.height,p=r.flipY,v=p===void 0?!1:p,x=r.format,S=x===void 0?q.RGBA:x,A=r.mipmap,k=A===void 0?!1:A,D=r.wrapS,R=D===void 0?q.CLAMP_TO_EDGE:D,Z=r.wrapT,W=Z===void 0?q.CLAMP_TO_EDGE:Z,me=r.aniso,ge=me===void 0?0:me,Ze=r.alignment,Ve=Ze===void 0?1:Ze,rt=r.premultiplyAlpha,wt=rt===void 0?!1:rt,Ut=r.mag,Yt=Ut===void 0?q.NEAREST:Ut,mr=r.min,fr=mr===void 0?q.NEAREST:mr,Wr=r.colorSpace,hn=Wr===void 0?q.BROWSER_DEFAULT_WEBGL:Wr,Pn=r.x,Vi=Pn===void 0?0:Pn,Da=r.y,ja=Da===void 0?0:Da,ao=r.copy,Ho=ao===void 0?!1:ao;this.width=u,this.height=l;var eh={width:u,height:l,type:X0[o],format:PI[S],wrapS:sb[R],wrapT:sb[W],mag:ob[Yt],min:ob[fr],alignment:Ve,flipY:v,colorSpace:RI[hn],premultiplyAlpha:wt,aniso:ge,x:Vi,y:ja,copy:Ho};n&&(eh.data=n),typeof k=="number"?eh.mipmap=LI[k]:typeof k=="boolean"&&(eh.mipmap=k),this.texture=i.texture(eh)}return(0,K.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,t=r.height;this.texture.resize(n,t),this.width=n,this.height=t}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDestroy=!0}}]),e}(),lb,cb,GI=(lb=(0,Nt.b2)(),lb(cb=function(){function e(){var i=this;(0,xe.Z)(this,e),(0,F.Z)(this,"createModel",function(r){return new VI(i.gl,r)}),(0,F.Z)(this,"createAttribute",function(r){return new kI(i.gl,r)}),(0,F.Z)(this,"createBuffer",function(r){return new BI(i.gl,r)}),(0,F.Z)(this,"createElements",function(r){return new zI(i.gl,r)}),(0,F.Z)(this,"createTexture2D",function(r){return new jI(i.gl,r)}),(0,F.Z)(this,"createFramebuffer",function(r){return new NI(i.gl,r)}),(0,F.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,F.Z)(this,"clear",function(r){var n,t=r.color,o=r.depth,u=r.stencil,l=r.framebuffer,p=l===void 0?null:l,v={color:t,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,F.Z)(this,"viewport",function(r){var n=r.x,t=r.y,o=r.width,u=r.height;i.gl._gl.viewport(n,t,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,F.Z)(this,"readPixels",function(r){var n=r.framebuffer,t=r.x,o=r.y,u=r.width,l=r.height,p={x:t,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,F.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,F.Z)(this,"getContainer",function(){var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,F.Z)(this,"getCanvas",function(){return i.canvas}),(0,F.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,F.Z)(this,"destroy",function(){var r,n,t;i.canvas=null,(r=i.gl)===null||r===void 0||(n=r._gl)===null||n===void 0||(t=n.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),i.gl.destroy(),i.gl=null})}return(0,K.Z)(e,[{key:"init",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t,o,u){var l=this;return pe().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=t,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,S){MI()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(k,D){(k||!D)&&S(k),x(D)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function r(n,t,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||cb);function HI(e){var i=WI();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function WI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y0=["selectstart","selecting","selectend"],$I=function(e){(0,lt.Z)(r,e);var i=HI(r);function r(n){var t,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,xe.Z)(this,r),t=i.call(this),(0,F.Z)((0,Ie.Z)(t),"isEnable",!1),(0,F.Z)((0,Ie.Z)(t),"onDragStart",function(u){t.box.style.display="block",t.startEvent=t.endEvent=u,t.syncBoxBound(),t.emit("selectstart",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,F.Z)((0,Ie.Z)(t),"onDragging",function(u){t.endEvent=u,t.syncBoxBound(),t.emit("selecting",t.getLngLatBox(),t.startEvent,t.endEvent)}),(0,F.Z)((0,Ie.Z)(t),"onDragEnd",function(u){t.endEvent=u,t.box.style.display="none",t.emit("selectend",t.getLngLatBox(),t.startEvent,t.endEvent)}),t.scene=n,t.options=o,t}return(0,K.Z)(r,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=Ci("div",void 0,this.container);o.classList.add("l7-select-box"),t&&o.classList.add(t),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,o=t.x,u=t.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),S=Math.min(u,v),A=Math.abs(o-p),k=Math.abs(u-v);this.box.style.top="".concat(S,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(k,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,o=t.lng,u=t.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return Wh([[o,u],[p,v]])}}]),r}(Ca.EventEmitter),XI=function(){function e(i){(0,xe.Z)(this,e);var r=i.id,n=i.map,t=i.canvas,o=i.hasBaseMap,u=ew();this.container=u,n.setContainer(u,r,t,o),u.bind(Ne.IRendererService).to(GI).inSingletonScope(),this.sceneService=u.get(Ne.ISceneService),this.mapService=u.get(Ne.IMapService),this.iconService=u.get(Ne.IIconService),this.fontService=u.get(Ne.IFontService),this.controlService=u.get(Ne.IControlService),this.layerService=u.get(Ne.ILayerService),this.debugService=u.get(Ne.IDebugService),this.debugService.setEnable(i.debug),this.markerService=u.get(Ne.IMarkerService),this.interactionService=u.get(Ne.IInteractionService),this.popupService=u.get(Ne.IPopupService),this.boxSelect=new $I(this,{}),this.initComponent(r),this.sceneService.init(i),this.initControl()}return(0,K.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"exportMap",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t){return pe().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return u.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var t=new r(this);t.init()}else this.on("loaded",function(){var o=new r(n);o.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=this,t=cv(this.container);if(r.setContainer(t,this.container),this.sceneService.addLayer(r),r.inited){var o=this.initMask(r);this.addMask(o,r.id)}else r.on("inited",function(){var u=n.initMask(r);n.addMask(u,r.id)})}},{key:"initMask",value:function(r){var n=r.getLayerConfig(),t=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!t||!o)){var x=new e1().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(r,n){if(!!r){var t=this.getLayer(n);if(t){var o=cv(this.container);r.setContainer(o,this.container),t.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t,o){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"removeAllLayer",value:function(){var i=(0,Pt.Z)(pe().mark(function n(){return pe().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(t){var o=(0,Qr.Z)(t,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(r,n){var t=this;this.fontService.once("fontloaded",function(o){t.emit("fontloaded",o)}),this.fontService.addFontFace(r,n)}},{key:"addImage",value:function(){var i=(0,Pt.Z)(pe().mark(function n(t,o){return pe().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(t,o);case 2:case"end":return l.stop()}},n,this)}));function r(n,t){return i.apply(this,arguments)}return r}()},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"removePopup",value:function(r){this.popupService.removePopup(r)}},{key:"on",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.on(r,n)}else lm.includes(r)?this.sceneService.on(r,n):this.mapService.on(r,n)}},{key:"once",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.once(r,n)}else lm.includes(r)?this.sceneService.once(r,n):this.mapService.once(r,n)}},{key:"emit",value:function(r,n){lm.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.emit(r,n)}},{key:"off",value:function(r,n){if(Y0.includes(r)){var t;(t=this.boxSelect)===null||t===void 0||t.off(r,n)}else lm.includes(r)?this.sceneService.off(r,n):this.mapService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var t=this.sceneService.getSceneConfig(),o=t.fitBoundsOptions,u=t.animate;this.mapService.fitBounds(r,n||(0,O.Z)((0,O.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ne.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){r.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(r){return Hr.REGISTERED_PROTOCOLS[r]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:vs(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,t=r.logoPosition;n&&this.addControl(new t_({position:t}))}}],[{key:"addProtocol",value:function(r,n){Hr.REGISTERED_PROTOCOLS[r]=n}},{key:"removeProtocol",value:function(r){delete Hr.REGISTERED_PROTOCOLS[r]}}]),e}(),C6="2.17.11";function Pv(e){return Pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Pv(e)}function fb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function T6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fb(Object(r),!0).forEach(function(n){YI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function YI(e,i,r){return i=qI(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function qI(e){var i=KI(e,"string");return Pv(i)==="symbol"?i:String(i)}function KI(e,i){if(Pv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Pv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function M6(e,i){return tP(e)||eP(e,i)||QI(e,i)||JI()}function JI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QI(e,i){if(!!e){if(typeof e=="string")return hb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hb(e,i)}}function hb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function eP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function tP(e){if(Array.isArray(e))return e}var k6=null,I6=null,pb,q0,db,rP=(pb=u0(Ne.IGlobalConfigService),q0=function(){function e(i){(0,xe.Z)(this,e),nn(this,"configService",db,this),this.config=i}return(0,K.Z)(e,[{key:"setContainer",value:function(r,n,t,o){r.bind(Ne.MapConfig).toConstantValue((0,O.Z)((0,O.Z)({},this.config),{},{id:n,canvas:t,hasBaseMap:o})),r.bind(Ne.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),db=jr(q0.prototype,"configService",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q0),nP=N(6158),Lv=N.n(nP),iP=function(){function e(i){(0,xe.Z)(this,e),(0,F.Z)(this,"size",1e4),this.size=i||1e4}return(0,K.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),t=this.mercatorYfromLat(r[1]);return[n,t]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),t=this.latFromMercatorY(r[1]);return[n,t]}}]),e}(),aP={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},vb,mb,gb,yb,_b,xb,_d,bb,Sb,wb,Eb,Ab={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},oP=12,sP=(vb=(0,Nt.b2)(),mb=(0,Nt.f3)(Ne.MapConfig),gb=(0,Nt.f3)(Ne.IGlobalConfigService),yb=(0,Nt.f3)(Ne.ICoordinateSystemService),_b=(0,Nt.f3)(Ne.IEventEmitter),vb(xb=(_d=function(){function e(){var i=this;(0,xe.Z)(this,e),(0,F.Z)(this,"version",oc.DEFUALT),(0,F.Z)(this,"simpleMapCoord",new iP),(0,F.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),nn(this,"config",bb,this),nn(this,"configService",Sb,this),nn(this,"coordinateSystemService",wb,this),nn(this,"eventEmitter",Eb,this),(0,F.Z)(this,"handleCameraChanged",function(r){var n=i.map.getCenter(),t=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,t],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,K.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ci("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(r,n){hw.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Ab[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Ab[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===oc.SIMPLE)return this.simpleMapCoord.getSize();var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.dragEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyleValue(r))}},{key:"meterToCoord",value:function(r,n){return 1}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"getMapStyle",value:function(){try{var r,n=(r=this.map.getStyle().sprite)!==null&&r!==void 0?r:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(t){return""}}},{key:"getMapStyleConfig",value:function(){return aP}},{key:"getMapStyleValue",value:function(r){var n;return(n=this.getMapStyleConfig()[r])!==null&&n!==void 0?n:r}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[r].concat(o))}},{key:"once",value:function(r){for(var n,t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[r].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),t=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return t}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatMapContainer",value:function(r){var n=r;return typeof r=="string"&&(n=document.getElementById(r)),n}},{key:"updateView",value:function(r){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:r.bearing,center:r.center,viewportHeight:r.viewportHeight,pitch:r.pitch,viewportWidth:r.viewportWidth,zoom:r.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var r=this.config.offsetCoordinate,n=r===void 0?!0:r;this.viewport.getZoom()>oP&&n?this.coordinateSystemService.setCoordinateSystem(rc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(rc.LNGLAT)}}]),e}(),bb=jr(_d.prototype,"config",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=jr(_d.prototype,"configService",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb=jr(_d.prototype,"coordinateSystemService",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=jr(_d.prototype,"eventEmitter",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||xb);function Rv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vm(e,i){var r=Zi([],i,e);return Bo(r,r,1/r[3]),r}function P6(e,i){var r=e%i;return r<0?i+r:r}function L6(e,i,r){return r*i+(1-r)*e}function Ap(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Zc=Math.PI,Cb=Zc/4,Qf=Zc/180,Tb=180/Zc,K0=512,J0=4003e4,uP=1.5;function Mb(e){return Math.pow(2,e)}function lP(e){return Math.log2(e)}function jm(e,i){var r=(0,Qr.Z)(e,2),n=r[0],t=r[1];Ap(Number.isFinite(n)&&Number.isFinite(i)),Ap(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude"),i*=K0;var o=n*Qf,u=t*Qf,l=i*(o+Zc)/(2*Zc),p=i*(Zc-Math.log(Math.tan(Cb+u*.5)))/(2*Zc);return[l,p]}function Q0(e,i){var r=(0,Qr.Z)(e,2),n=r[0],t=r[1];i*=K0;var o=n/i*(2*Zc)-Zc,u=2*(Math.atan(Math.exp(Zc-t/i*(2*Zc)))-Cb);return[o*Tb,u*Tb]}function R6(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Qf);return lP(J0*r)-9}function kb(e){var i=e.latitude,r=e.longitude,n=e.zoom,t=e.scale,o=e.highPrecision,u=o===void 0?!1:o;t=t!==void 0?t:Mb(n),Ap(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(t));var l={},p=K0*t,v=Math.cos(i*Qf),x=p/360,S=x/v,A=p/J0/v;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[x,-S,A],l.degreesPerPixel=[1/x,-1/S,1/A],u){var k=Qf*Math.tan(i*Qf)/v,D=x*k/2,R=p/J0*k,Z=R/S*A;l.pixelsPerDegree2=[0,-D,R],l.pixelsPerMeter2=[Z,0,Z]}return l}function D6(e,i){var r=_slicedToArray(e,3),n=r[0],t=r[1],o=r[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,S=kb({longitude:n,latitude:t,scale:x,highPrecision:!0}),A=S.pixelsPerMeter,k=S.pixelsPerMeter2,D=jm(e,x);D[0]+=l*(A[0]+k[0]*p),D[1]+=p*(A[1]+k[1]*p);var R=Q0(D,x),Z=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[R[0],R[1],Z]:R}function cP(e){var i=e.height,r=e.pitch,n=e.bearing,t=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=Rv();return gn(v,v,[0,0,-t]),zn(v,v,[1,1,1/i]),Bi(v,v,-r*Qf),ns(v,v,n*Qf),p&&zn(v,v,[1,-1,1]),u&&gn(v,v,ma.negate([],u)),v}function fP(e){var i=e.width,r=e.height,n=e.altitude,t=n===void 0?uP:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,S=u*Qf,A=Math.atan(.5/t),k=Math.sin(A)*t/Math.sin(Math.PI/2-S-A),D=Math.cos(Math.PI/2-S)*k+t;return{fov:2*Math.atan(r/2/t),aspect:i/r,focalDistance:t,near:p,far:D*x}}function hP(e){var i=e.width,r=e.height,n=e.pitch,t=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=fP({width:i,height:r,altitude:t,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,S=l.far,A=Up([],p,v,x,S);return A}function pP(e,i){var r=(0,Qr.Z)(e,3),n=r[0],t=r[1],o=r[2],u=o===void 0?0:o;return Ap(Number.isFinite(n)&&Number.isFinite(t)&&Number.isFinite(u)),Vm(i,[n,t,u,1])}function Ib(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Qr.Z)(e,3),t=n[0],o=n[1],u=n[2];if(Ap(Number.isFinite(t)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=Vm(i,[t,o,u,1]);return l}var p=Vm(i,[t,o,0,1]),v=Vm(i,[t,o,1,1]),x=p[2],S=v[2],A=x===S?0:((r||0)-x)/(S-x);return Mr.lerp([],p,v,A)}var Pb=Rv(),dP=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,t=i.viewMatrix,o=t===void 0?Pb:t,u=i.projectionMatrix,l=u===void 0?Pb:u;(0,xe.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=Rv();Qn(p,p,this.projectionMatrix),Qn(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=Rv();zn(v,v,[this.width/2,-this.height/2,1]),gn(v,v,[1,-1,0]),Qn(v,v,this.viewProjectionMatrix);var x=er(Rv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,K.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Co(r.projectionMatrix,this.projectionMatrix)&&Co(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=this.projectPosition(r),l=pP(u,this.pixelProjectionMatrix),p=(0,Qr.Z)(l,2),v=p[0],x=p[1],S=o?x:this.height-x;return r.length===2?[v,S]:[v,S,l[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=n.topLeft,o=t===void 0?!0:t,u=n.targetZ,l=(0,Qr.Z)(r,3),p=l[0],v=l[1],x=l[2],S=o?v:this.height-v,A=u&&u*this.pixelsPerMeter,k=Ib([p,S,x],this.pixelUnprojectionMatrix,A),D=this.unprojectPosition(k),R=(0,Qr.Z)(D,3),Z=R[0],W=R[1],me=R[2];return Number.isFinite(x)?[Z,W,me]:Number.isFinite(u)?[Z,W,u]:[Z,W]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),t=(0,Qr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),t=(0,Qr.Z)(n,2),o=t[0],u=t[1],l=(r[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function vP(e){var i=e.width,r=e.height,n=e.bounds,t=e.minExtent,o=t===void 0?0:t,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,S=x===void 0?[0,0]:x,A=(0,Qr.Z)(n,2),k=(0,Qr.Z)(A[0],2),D=k[0],R=k[1],Z=(0,Qr.Z)(A[1],2),W=Z[0],me=Z[1];if(Number.isFinite(v)){var ge=v;v={top:ge,bottom:ge,left:ge,right:ge}}else Ap(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var Ze=new Lb({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ve=Ze.project([D,me]),rt=Ze.project([W,R]),wt=[Math.max(Math.abs(rt[0]-Ve[0]),o),Math.max(Math.abs(rt[1]-Ve[1]),o)],Ut=[i-v.left-v.right-Math.abs(S[0])*2,r-v.top-v.bottom-Math.abs(S[1])*2];Ap(Ut[0]>0&&Ut[1]>0);var Yt=Ut[0]/wt[0],mr=Ut[1]/wt[1],fr=(v.right-v.left)/2/Yt,Wr=(v.bottom-v.top)/2/mr,hn=[(rt[0]+Ve[0])/2+fr,(rt[1]+Ve[1])/2+Wr],Pn=Ze.unproject(hn),Vi=Ze.zoom+Math.log2(Math.abs(Math.min(Yt,mr)));return{longitude:Pn[0],latitude:Pn[1],zoom:Math.min(Vi,l)}}var Lb=function(e){(0,lt.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,S=x===void 0?0:x,A=n.pitch,k=A===void 0?0:A,D=n.bearing,R=D===void 0?0:D,Z=n.altitude,W=Z===void 0?1.5:Z,me=n.nearZMultiplier,ge=n.farZMultiplier;(0,xe.Z)(this,i),t=t||1,o=o||1;var Ze=Mb(S);W=Math.max(.75,W);var Ve=jm([v,l],Ze);Ve[2]=0;var rt=hP({width:t,height:o,pitch:k,bearing:R,altitude:W,nearZMultiplier:me||1/o,farZMultiplier:ge||1.01}),wt=cP({height:o,center:Ve,pitch:k,bearing:R,altitude:W,flipY:!0});return r=(0,pt.Z)(this,(0,te.Z)(i).call(this,{width:t,height:o,viewMatrix:wt,projectionMatrix:rt})),r.latitude=l,r.longitude=v,r.zoom=S,r.pitch=k,r.bearing=R,r.altitude=W,r.scale=Ze,r.center=Ve,r.pixelsPerMeter=kb((0,Ie.Z)((0,Ie.Z)(r))).pixelsPerMeter[2],Object.freeze((0,Ie.Z)((0,Ie.Z)(r))),r}return(0,K.Z)(i,[{key:"projectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return jm(n,t)}},{key:"unprojectFlat",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q0(n,t)}},{key:"getMapCenterByLngLatPosition",value:function(n){var t=n.lngLat,o=n.pos,u=Ib(o,this.pixelUnprojectionMatrix),l=jm(t,this.scale),p=Mr.add([],l,Mr.negate([],u)),v=Mr.add([],this.center,p);return Q0(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var t=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:o})}},{key:"fitBounds",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=vP(Object.assign({width:o,height:u,bounds:n},t)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(dP),mP=function(){function e(){(0,xe.Z)(this,e)}return(0,K.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,t=r.zoom,o=r.pitch,u=r.bearing,l=r.viewportHeight,p=r.viewportWidth;this.viewport=new Lb({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:t,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),gP=["id","attributionControl","style","token","rotation","mapInstance"],Rb,Db;function yP(e){var i=_P();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function _P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xP(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}xP(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Lv();var bP=0,Ob="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",SP=(Rb=(0,Nt.b2)(),Rb(Db=function(e){(0,lt.Z)(r,e);var i=yP(r);function r(){var n;(0,xe.Z)(this,r);for(var t=arguments.length,o=new Array(t),u=0;u<t;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,F.Z)((0,Ie.Z)(n),"version",oc.MAPBOX),n}return(0,K.Z)(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(t,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(t,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,S=u.z,A=S===void 0?0:S;return{x:p,y:x,z:A}}},{key:"getModelMatrix",value:function(t,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,o),x=v.meterInMercatorCoordinateUnits(),S=Ae();return gn(S,S,ma.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),zn(S,S,ma.fromValues(x*l[0],-x*l[1],x*l[2])),Bi(S,S,u[0]),Ia(S,S,u[1]),ns(S,S,u[2]),S}},{key:"init",value:function(){var n=(0,Pt.Z)(pe().mark(function o(){var u=this,l,p,v,x,S,A,k,D,R,Z,W,me,ge;return pe().wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,S=x===void 0?!1:x,A=l.style,k=A===void 0?"light":A,D=l.token,R=D===void 0?Ob:D,Z=l.rotation,W=Z===void 0?0:Z,me=l.mapInstance,ge=(0,ll.Z)(l,gP),this.viewport=new mP,!me&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===Ob&&k!=="blank"&&!window.mapboxgl.accessToken&&!me&&console.warn(this.configService.getSceneWarninfo("MapToken")),!me&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),me?(this.map=me,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,O.Z)({container:this.$mapContainer,style:this.getMapStyleValue(k),attributionControl:S,bearing:W},ge))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ve.stop()}},o,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,o;(t=this.$mapContainer)===null||t===void 0||(o=t.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[t].concat(l))}},{key:"once",value:function(t){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[t].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,o){var u=new(Lv()).LngLat(t[0],t[1]),l=new(Lv()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=Lv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),x=Lv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),S=v.x,A=v.y,k=x.x,D=x.y,R=Math.sqrt(Math.pow(S-k,2)+Math.pow(A-D,2))*4194304*2;return R/p}},{key:"exportMap",value:function(t){var o=this.map.getCanvas(),u=t==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(t){var o=t;typeof t=="string"&&(o=document.getElementById(t));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+bP++,o.appendChild(u),u}}]),r}(sP))||Db);function wP(e){var i=EP();return function(){var n=(0,te.Z)(e),t;if(i){var o=(0,te.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,pt.Z)(this,t)}}function EP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function AP(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var t=i.head||i.getElementsByTagName("head")[0];if(!t){t=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(t,o):i.documentElement.appendChild(t)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),t.appendChild(u),u}}AP(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var CP=function(e){(0,lt.Z)(r,e);var i=wP(r);function r(){return(0,xe.Z)(this,r),i.apply(this,arguments)}return(0,K.Z)(r,[{key:"getServiceConstructor",value:function(){return SP}}]),r}(rP);function Dv(e){return Dv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Dv(e)}function Fb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Bb(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fb(Object(r),!0).forEach(function(n){TP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TP(e,i,r){return i=MP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function MP(e){var i=kP(e,"string");return Dv(i)==="symbol"?i:String(i)}function kP(e,i){if(Dv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Dv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function IP(e,i){return DP(e)||RP(e,i)||LP(e,i)||PP()}function PP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LP(e,i){if(!!e){if(typeof e=="string")return zb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zb(e,i)}}function zb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function RP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function DP(e){if(Array.isArray(e))return e}var OP=J.memo(function(e){var i=e.style,r=e.className,n=e.map,t=e.option,o=e.onSceneLoaded,u=(0,J.createRef)(),l=(0,J.useState)(),p=IP(l,2),v=p[0],x=p[1];return(0,J.useEffect)(function(){var S=new XI(Bb(Bb({id:u.current},t),{},{map:new CP(n)}));return S.on("loaded",function(){x(S),o&&o(S)}),function(){S.destroy()}},[]),(0,J.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,J.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,J.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,J.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,J.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),J.createElement(y.Provider,{value:v},(0,J.createElement)("div",{ref:u,style:i,className:r},v&&e.children))}),FP=OP;function Ov(e){return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ov(e)}function Nb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Nb(Object(r),!0).forEach(function(n){BP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BP(e,i,r){return i=zP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function zP(e){var i=NP(e,"string");return Ov(i)==="symbol"?i:String(i)}function NP(e,i){if(Ov(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Ov(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function F6(e,i){return jP(e)||VP(e,i)||UP(e,i)||ZP()}function ZP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UP(e,i){if(!!e){if(typeof e=="string")return Zb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zb(e,i)}}function Zb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function VP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function jP(e){if(Array.isArray(e))return e}var B6=null,z6=null;function Fv(e){return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Fv(e)}function Ub(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function N6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ub(Object(r),!0).forEach(function(n){GP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ub(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GP(e,i,r){return i=HP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function HP(e){var i=WP(e,"string");return Fv(i)==="symbol"?i:String(i)}function WP(e,i){if(Fv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Fv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function Z6(e,i){return qP(e)||YP(e,i)||XP(e,i)||$P()}function $P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XP(e,i){if(!!e){if(typeof e=="string")return Vb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vb(e,i)}}function Vb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function YP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function qP(e){if(Array.isArray(e))return e}var U6=null,V6=null;function Bv(e){return Bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Bv(e)}function jb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function j6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jb(Object(r),!0).forEach(function(n){KP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KP(e,i,r){return i=JP(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function JP(e){var i=QP(e,"string");return Bv(i)==="symbol"?i:String(i)}function QP(e,i){if(Bv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(Bv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function G6(e,i){return nL(e)||rL(e,i)||tL(e,i)||eL()}function eL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tL(e,i){if(!!e){if(typeof e=="string")return Gb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gb(e,i)}}function Gb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function rL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function nL(e){if(Array.isArray(e))return e}var H6=null,W6=null;function $6(e,i){return sL(e)||oL(e,i)||aL(e,i)||iL()}function iL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aL(e,i){if(!!e){if(typeof e=="string")return Hb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hb(e,i)}}function Hb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function sL(e){if(Array.isArray(e))return e}var X6=null;function zv(e){return zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},zv(e)}var Y6=null;function Wb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function q6(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wb(Object(r),!0).forEach(function(n){uL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uL(e,i,r){return i=lL(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function lL(e){var i=cL(e,"string");return zv(i)==="symbol"?i:String(i)}function cL(e,i){if(zv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(zv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function K6(e,i){if(e==null)return{};var r=fL(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function fL(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var J6={exportImage:w3,fullscreen:M3,geoLocate:P3,layer:e_,layerSwitch:e_,logo:t_,mapTheme:Z3,mouseLocation:j3,zoom:Y3,scale:W3},Q6=null,$b=N(73935);function Xb(e,i){return vL(e)||dL(e,i)||pL(e,i)||hL()}function hL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pL(e,i){if(!!e){if(typeof e=="string")return Yb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yb(e,i)}}function Yb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function dL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function vL(e){if(Array.isArray(e))return e}var qb=J.useEffect,Kb=J.useState,mL=/\B([A-Z])/g,gL=function(i){return i.replace(mL,"-$1").toLowerCase()};function eD(e){var i=e.className,r=e.style,n=e.children,t=e.position,o=Kb(),u=Xb(o,2),l=u[0],p=u[1],v=useSceneValue(),x=Kb(function(){return document.createElement("div")}),S=Xb(x,1),A=S[0];return qb(function(){var k=new Control({position:t});return k.onAdd=function(){if(i&&(A.className=i),r){var D=Object.keys(r).map(function(R){return"".concat(gL(R),":").concat(r[R])}).join(";");A.style.cssText=D}return A},k.onRemove=function(){},p(k),v.addControl(k),function(){v.removeControl(k)}},[]),qb(function(){l&&l.setPosition(t||"bottomleft")},[t]),createPortal(n,A)}var Jb=(0,J.createContext)({});function tD(){return useContext(Jb)}var yL=J.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},$o()),_L=J.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},$o()),xL=J.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},$o()),bL=J.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},$o()),SL=J.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},$o()),wL=J.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},$o()),EL=J.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},$o()),AL=J.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},$o()),CL=["data"];function TL(e,i){if(e==null)return{};var r=ML(e,i),n,t;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function ML(e,i){if(e==null)return{};var r={},n=Object.keys(e),t,o;for(o=0;o<n.length;o++)t=n[o],!(i.indexOf(t)>=0)&&(r[t]=e[t]);return r}var kL=J.memo(function(i){var r=i.layer,n=i.source,t=n.data,o=TL(n,CL);return r.inited?r.setData(t,o):r.source(t,o),o.autoFit&&r.fitBounds(o&&o.fitBoundsOptions),null},$o()),rD=J.useEffect,IL=J.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},$o());function PL(e,i){return OL(e)||DL(e,i)||RL(e,i)||LL()}function LL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RL(e,i){if(!!e){if(typeof e=="string")return Qb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qb(e,i)}}function Qb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function DL(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,t,o,u,l=[],p=!0,v=!1;try{if(o=(r=r.call(e)).next,i===0){if(Object(r)!==r)return;p=!1}else for(;!(p=(n=o.call(r)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,t=x}finally{try{if(!p&&r.return!=null&&(u=r.return(),Object(u)!==u))return}finally{if(v)throw t}}return l}}function OL(e){if(Array.isArray(e))return e}var Nv=J.useEffect,FL=J.useState;function e2(e,i){var r=i.source,n=i.color,t=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,S=i.animate,A=i.options,k=i.onLayerLoaded,D=oe(),R=FL(function(){var me;switch(e){case"polygonLayer":me=new _m(A);break;case"lineLayer":me=new A0(A);break;case"pointLayer":me=new ym(A);break;case"heatmapLayer":me=new yA(A);break;case"rasterLayer":me=new xm(A);break;case"imageLayer":me=new I_(A);break;case"citybuildingLayer":me=new VE(A);break;default:me=new _m(A)}return me.on("inited",function(){k&&k(me,D)}),me}),Z=PL(R,1),W=Z[0];return Nv(function(){return D.addLayer(W),function(){D.removeLayer(W)}},[]),Nv(function(){W.inited&&A&&W.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),Nv(function(){W.inited&&(A==null?void 0:A.zIndex)&&W.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),Nv(function(){W.inited&&(A==null?void 0:A.blend)&&W.setBlend(A.blend)},[A==null?void 0:A.blend]),Nv(function(){D.render()}),J.createElement(Jb.Provider,{value:W},J.createElement(kL,{layer:W,source:r}),l&&J.createElement(SL,{layer:W,scale:l}),n&&J.createElement(xL,{layer:W,color:n}),u&&J.createElement(AL,{layer:W,size:u}),t&&J.createElement(EL,{layer:W,shape:t}),o&&J.createElement(IL,{layer:W,style:o}),p&&J.createElement(yL,{layer:W,active:p}),v&&J.createElement(wL,{layer:W,select:v}),x&&J.createElement(bL,{layer:W,filter:x}),S&&J.createElement(_L,{layer:W,animate:S}),i.children)}var nD=null,iD=null,BL=J.memo(function(i){return e2("pointLayer",i)}),zL=J.memo(function(i){return e2("heatmapLayer",i)}),aD=null,oD=null,sD=null,uD=J.useEffect,lD=null,cD=null;function xd(e){return xd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},xd(e)}function t2(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Gm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?t2(Object(r),!0).forEach(function(n){NL(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NL(e,i,r){return i=n2(i),i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function ZL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function r2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n2(n.key),n)}}function UL(e,i,r){return i&&r2(e.prototype,i),r&&r2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function n2(e){var i=VL(e,"string");return xd(i)==="symbol"?i:String(i)}function VL(e,i){if(xd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(xd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function jL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&eg(e,i)}function eg(e,i){return eg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},eg(e,i)}function GL(e){var i=$L();return function(){var n=Hm(e),t;if(i){var o=Hm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return HL(this,t)}}function HL(e,i){if(i&&(xd(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WL(e)}function WL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Hm(e){return Hm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Hm(e)}var fD=function(e){jL(r,e);var i=GL(r);function r(n){var t;return ZL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.popup=void 0,t.el=document.createElement("div"),t}return UL(r,[{key:"componentDidMount",value:function(){var t,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new p0(Gm(Gm({},p),{},{stopPropagation:(t=this.props.option)===null||t===void 0?void 0:t.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(t){var o,u,l,p,v,x,S=Array.isArray(t.lnglat)?t.lnglat:[t==null||(o=t.lnglat)===null||o===void 0?void 0:o.lng,t==null||(u=t.lnglat)===null||u===void 0?void 0:u.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],k=S.toString()!==A.toString();if(k){var D;this.popup.remove(),this.popup=new p0(Gm(Gm({},this.props.option),{},{stopPropagation:(D=this.props.option)===null||D===void 0?void 0:D.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var t=this;return J.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,$b.createPortal)(t.props.children,t.el)})}}]),r}(J.PureComponent);function bd(e){return bd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},bd(e)}function XL(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function i2(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qL(n.key),n)}}function YL(e,i,r){return i&&i2(e.prototype,i),r&&i2(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qL(e){var i=KL(e,"string");return bd(i)==="symbol"?i:String(i)}function KL(e,i){if(bd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,i||"default");if(bd(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function JL(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&tg(e,i)}function tg(e,i){return tg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},tg(e,i)}function QL(e){var i=rR();return function(){var n=Wm(e),t;if(i){var o=Wm(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return eR(this,t)}}function eR(e,i){if(i&&(bd(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tR(e)}function tR(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Wm(e){return Wm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Wm(e)}var hD=function(e){JL(r,e);var i=QL(r);function r(n){var t;return XL(this,r),t=i.call(this,n),t.el=void 0,t.scene=void 0,t.marker=void 0,t.el=document.createElement("div"),t}return YL(r,[{key:"componentDidMount",value:function(){var t=this.props,o=t.lnglat,u=t.children,l=t.option,p=t.onMarkerLoaded,v=new Xy(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(t){var o,u=JSON.stringify(t==null?void 0:t.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var t=this;return J.createElement(y.Consumer,{},function(o){return o&&(t.scene=o),(0,$b.createPortal)(t.props.children,t.el)})}}]),r}(J.PureComponent),pD=J.useEffect,dD=null,vD=null,mD=J.useEffect,gD=null},66213:function(Sr,Q,N){"use strict";N.d(Q,{Z:function(){return y}});var _e=N(77608);function J(oe,V){for(;!Object.prototype.hasOwnProperty.call(oe,V)&&(oe=(0,_e.Z)(oe),oe!==null););return oe}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(V,ce,ie){var We=J(V,ce);if(!!We){var ae=Object.getOwnPropertyDescriptor(We,ce);return ae.get?ae.get.call(arguments.length<3?V:ie):ae.value}},y.apply(this,arguments)}},38163:function(Sr){Sr.exports=Q;function Q(J,y){var oe=J&&J.type,V;if(oe==="FeatureCollection")for(V=0;V<J.features.length;V++)Q(J.features[V],y);else if(oe==="GeometryCollection")for(V=0;V<J.geometries.length;V++)Q(J.geometries[V],y);else if(oe==="Feature")Q(J.geometry,y);else if(oe==="Polygon")N(J.coordinates,y);else if(oe==="MultiPolygon")for(V=0;V<J.coordinates.length;V++)N(J.coordinates[V],y);return J}function N(J,y){if(J.length!==0){_e(J[0],y);for(var oe=1;oe<J.length;oe++)_e(J[oe],!y)}}function _e(J,y){for(var oe=0,V=0,ce=0,ie=J.length,We=ie-1;ce<ie;We=ce++){var ae=(J[ce][0]-J[We][0])*(J[We][1]+J[ce][1]),He=oe+ae;V+=Math.abs(oe)>=Math.abs(ae)?oe-He+ae:ae-He+oe,oe=He}oe+V>=0!=!!y&&J.reverse()}},75550:function(Sr){"use strict";Sr.exports=Q;function Q(N,_e){this.x=N,this.y=_e}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(N){return this.clone()._add(N)},sub:function(N){return this.clone()._sub(N)},multByPoint:function(N){return this.clone()._multByPoint(N)},divByPoint:function(N){return this.clone()._divByPoint(N)},mult:function(N){return this.clone()._mult(N)},div:function(N){return this.clone()._div(N)},rotate:function(N){return this.clone()._rotate(N)},rotateAround:function(N,_e){return this.clone()._rotateAround(N,_e)},matMult:function(N){return this.clone()._matMult(N)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(N){return this.x===N.x&&this.y===N.y},dist:function(N){return Math.sqrt(this.distSqr(N))},distSqr:function(N){var _e=N.x-this.x,J=N.y-this.y;return _e*_e+J*J},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(N){return Math.atan2(this.y-N.y,this.x-N.x)},angleWith:function(N){return this.angleWithSep(N.x,N.y)},angleWithSep:function(N,_e){return Math.atan2(this.x*_e-this.y*N,this.x*N+this.y*_e)},_matMult:function(N){var _e=N[0]*this.x+N[1]*this.y,J=N[2]*this.x+N[3]*this.y;return this.x=_e,this.y=J,this},_add:function(N){return this.x+=N.x,this.y+=N.y,this},_sub:function(N){return this.x-=N.x,this.y-=N.y,this},_mult:function(N){return this.x*=N,this.y*=N,this},_div:function(N){return this.x/=N,this.y/=N,this},_multByPoint:function(N){return this.x*=N.x,this.y*=N.y,this},_divByPoint:function(N){return this.x/=N.x,this.y/=N.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var N=this.y;return this.y=this.x,this.x=-N,this},_rotate:function(N){var _e=Math.cos(N),J=Math.sin(N),y=_e*this.x-J*this.y,oe=J*this.x+_e*this.y;return this.x=y,this.y=oe,this},_rotateAround:function(N,_e){var J=Math.cos(N),y=Math.sin(N),oe=_e.x+J*(this.x-_e.x)-y*(this.y-_e.y),V=_e.y+y*(this.x-_e.x)+J*(this.y-_e.y);return this.x=oe,this.y=V,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(N){return N instanceof Q?N:Array.isArray(N)?new Q(N[0],N[1]):N}},49296:function(Sr){"use strict";Sr.exports=N,Sr.exports.default=N;var Q=1e20;function N(V,ce,ie,We,ae,He){this.fontSize=V||24,this.buffer=ce===void 0?3:ce,this.cutoff=We||.25,this.fontFamily=ae||"sans-serif",this.fontWeight=He||"normal",this.radius=ie||8;var nt=this.size=this.fontSize+this.buffer*2,ct=nt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=nt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ct*ct),this.gridInner=new Float64Array(ct*ct),this.f=new Float64Array(ct),this.z=new Float64Array(ct+1),this.v=new Uint16Array(ct),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(nt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _e(V,ce,ie,We,ae,He,nt){He.fill(Q,0,ce*ie),nt.fill(0,0,ce*ie);for(var ct=(ce-We)/2,It=0;It<ae;It++)for(var tr=0;tr<We;tr++){var qt=(It+ct)*ce+tr+ct,ir=V.data[4*(It*We+tr)+3]/255;if(ir===1)He[qt]=0,nt[qt]=Q;else if(ir===0)He[qt]=Q,nt[qt]=0;else{var rr=Math.max(0,.5-ir),At=Math.max(0,ir-.5);He[qt]=rr*rr,nt[qt]=At*At}}}function J(V,ce,ie,We,ae,He,nt){for(var ct=0;ct<ce*ie;ct++){var It=Math.sqrt(We[ct])-Math.sqrt(ae[ct]);V[ct]=Math.round(255-255*(It/He+nt))}}N.prototype._draw=function(V,ce){var ie=this.ctx.measureText(V),We=ie.width,ae=2*this.buffer,He,nt,ct,It,tr,qt,ir,rr;ce&&this.useMetrics?(tr=Math.floor(ie.actualBoundingBoxAscent),rr=this.buffer+Math.ceil(ie.actualBoundingBoxAscent),qt=this.buffer,ir=this.buffer,nt=Math.min(this.size,Math.ceil(ie.actualBoundingBoxRight-ie.actualBoundingBoxLeft)),It=Math.min(this.size-qt,Math.ceil(ie.actualBoundingBoxAscent+ie.actualBoundingBoxDescent)),He=nt+ae,ct=It+ae,this.ctx.textBaseline="alphabetic"):(He=nt=this.size,ct=It=this.size,tr=19*this.fontSize/24,qt=ir=0,rr=this.middle,this.ctx.textBaseline="middle");var At;nt&&It&&(this.ctx.clearRect(ir,qt,nt,It),this.ctx.fillText(V,this.buffer,rr),At=this.ctx.getImageData(ir,qt,nt,It));var gt=new Uint8ClampedArray(He*ct);return _e(At,He,ct,nt,It,this.gridOuter,this.gridInner),y(this.gridOuter,He,ct,this.f,this.v,this.z),y(this.gridInner,He,ct,this.f,this.v,this.z),J(gt,He,ct,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:gt,metrics:{width:nt,height:It,sdfWidth:He,sdfHeight:ct,top:tr,left:0,advance:We}}},N.prototype.draw=function(V){return this._draw(V,!1).data},N.prototype.drawWithMetrics=function(V){return this._draw(V,!0)};function y(V,ce,ie,We,ae,He){for(var nt=0;nt<ce;nt++)oe(V,nt,ce,ie,We,ae,He);for(var ct=0;ct<ie;ct++)oe(V,ct*ce,1,ce,We,ae,He)}function oe(V,ce,ie,We,ae,He,nt){var ct,It,tr,qt;for(He[0]=0,nt[0]=-Q,nt[1]=Q,ct=0;ct<We;ct++)ae[ct]=V[ce+ct*ie];for(ct=1,It=0,tr=0;ct<We;ct++){do qt=He[It],tr=(ae[ct]-ae[qt]+ct*ct-qt*qt)/(ct-qt)/2;while(tr<=nt[It]&&--It>-1);It++,He[It]=ct,nt[It]=tr,nt[It+1]=Q}for(ct=0,It=0;ct<We;ct++){for(;nt[It+1]<ct;)It++;qt=He[It],V[ce+ct*ie]=ae[qt]+(ct-qt)*(ct-qt)}}},38929:function(Sr,Q,N){Sr.exports.VectorTile=N(22779),N(66024),N(59701)},22779:function(Sr,Q,N){"use strict";var _e=N(59701);Sr.exports=J;function J(oe,V){this.layers=oe.readFields(y,{},V)}function y(oe,V,ce){if(oe===3){var ie=new _e(ce,ce.readVarint()+ce.pos);ie.length&&(V[ie.name]=ie)}}},66024:function(Sr,Q,N){"use strict";var _e=N(75550);Sr.exports=J;function J(ie,We,ae,He,nt){this.properties={},this.extent=ae,this.type=0,this._pbf=ie,this._geometry=-1,this._keys=He,this._values=nt,ie.readFields(y,this,We)}function y(ie,We,ae){ie==1?We.id=ae.readVarint():ie==2?oe(ae,We):ie==3?We.type=ae.readVarint():ie==4&&(We._geometry=ae.pos)}function oe(ie,We){for(var ae=ie.readVarint()+ie.pos;ie.pos<ae;){var He=We._keys[ie.readVarint()],nt=We._values[ie.readVarint()];We.properties[He]=nt}}J.types=["Unknown","Point","LineString","Polygon"],J.prototype.loadGeometry=function(){var ie=this._pbf;ie.pos=this._geometry;for(var We=ie.readVarint()+ie.pos,ae=1,He=0,nt=0,ct=0,It=[],tr;ie.pos<We;){if(He<=0){var qt=ie.readVarint();ae=qt&7,He=qt>>3}if(He--,ae===1||ae===2)nt+=ie.readSVarint(),ct+=ie.readSVarint(),ae===1&&(tr&&It.push(tr),tr=[]),tr.push(new _e(nt,ct));else if(ae===7)tr&&tr.push(tr[0].clone());else throw new Error("unknown command "+ae)}return tr&&It.push(tr),It},J.prototype.bbox=function(){var ie=this._pbf;ie.pos=this._geometry;for(var We=ie.readVarint()+ie.pos,ae=1,He=0,nt=0,ct=0,It=Infinity,tr=-Infinity,qt=Infinity,ir=-Infinity;ie.pos<We;){if(He<=0){var rr=ie.readVarint();ae=rr&7,He=rr>>3}if(He--,ae===1||ae===2)nt+=ie.readSVarint(),ct+=ie.readSVarint(),nt<It&&(It=nt),nt>tr&&(tr=nt),ct<qt&&(qt=ct),ct>ir&&(ir=ct);else if(ae!==7)throw new Error("unknown command "+ae)}return[It,qt,tr,ir]},J.prototype.toGeoJSON=function(ie,We,ae){var He=this.extent*Math.pow(2,ae),nt=this.extent*ie,ct=this.extent*We,It=this.loadGeometry(),tr=J.types[this.type],qt,ir;function rr(Br){for(var dr=0;dr<Br.length;dr++){var lr=Br[dr],_t=180-(lr.y+ct)*360/He;Br[dr]=[(lr.x+nt)*360/He-180,360/Math.PI*Math.atan(Math.exp(_t*Math.PI/180))-90]}}switch(this.type){case 1:var At=[];for(qt=0;qt<It.length;qt++)At[qt]=It[qt][0];It=At,rr(It);break;case 2:for(qt=0;qt<It.length;qt++)rr(It[qt]);break;case 3:for(It=V(It),qt=0;qt<It.length;qt++)for(ir=0;ir<It[qt].length;ir++)rr(It[qt][ir]);break}It.length===1?It=It[0]:tr="Multi"+tr;var gt={type:"Feature",geometry:{type:tr,coordinates:It},properties:this.properties};return"id"in this&&(gt.id=this.id),gt};function V(ie){var We=ie.length;if(We<=1)return[ie];for(var ae=[],He,nt,ct=0;ct<We;ct++){var It=ce(ie[ct]);It!==0&&(nt===void 0&&(nt=It<0),nt===It<0?(He&&ae.push(He),He=[ie[ct]]):He.push(ie[ct]))}return He&&ae.push(He),ae}function ce(ie){for(var We=0,ae=0,He=ie.length,nt=He-1,ct,It;ae<He;nt=ae++)ct=ie[ae],It=ie[nt],We+=(It.x-ct.x)*(ct.y+It.y);return We}},59701:function(Sr,Q,N){"use strict";var _e=N(66024);Sr.exports=J;function J(V,ce){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=V,this._keys=[],this._values=[],this._features=[],V.readFields(y,this,ce),this.length=this._features.length}function y(V,ce,ie){V===15?ce.version=ie.readVarint():V===1?ce.name=ie.readString():V===5?ce.extent=ie.readVarint():V===2?ce._features.push(ie.pos):V===3?ce._keys.push(ie.readString()):V===4&&ce._values.push(oe(ie))}function oe(V){for(var ce=null,ie=V.readVarint()+V.pos;V.pos<ie;){var We=V.readVarint()>>3;ce=We===1?V.readString():We===2?V.readFloat():We===3?V.readDouble():We===4?V.readVarint64():We===5?V.readVarint():We===6?V.readSVarint():We===7?V.readBoolean():null}return ce}J.prototype.feature=function(V){if(V<0||V>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[V];var ce=this._pbf.readVarint()+this._pbf.pos;return new _e(this._pbf,ce,this.extent,this._keys,this._values)}},53645:function(){},81903:function(){},7277:function(Sr,Q,N){"use strict";N.d(Q,{Z:function(){return Kt}});var _e=N(22122),J=N(67294),y=N(57838),oe=N(96159),V=N(96156),ce=N(94184),ie=N.n(ce),We=N(53124),ae=N(90860),He=N(11726),nt=N.n(He),ct=function(Y){var Le=Y.value,O=Y.formatter,Me=Y.precision,we=Y.decimalSeparator,ut=Y.groupSeparator,yt=ut===void 0?"":ut,xt=Y.prefixCls,jt;if(typeof O=="function")jt=O(Le);else{var nr=String(Le),en=nr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!en||nr==="-")jt=nr;else{var Lr=en[1],Vn=en[2]||"0",rn=en[4]||"";Vn=Vn.replace(/\B(?=(\d{3})+(?!\d))/g,yt),typeof Me=="number"&&(rn=nt()(rn,Me,"0").slice(0,Me>0?Me:0)),rn&&(rn="".concat(we).concat(rn)),jt=[J.createElement("span",{key:"int",className:"".concat(xt,"-content-value-int")},Lr,Vn),rn&&J.createElement("span",{key:"decimal",className:"".concat(xt,"-content-value-decimal")},rn)]}}return J.createElement("span",{className:"".concat(xt,"-content-value")},jt)},It=ct,tr=function(Y){var Le=Y.prefixCls,O=Y.className,Me=Y.style,we=Y.valueStyle,ut=Y.value,yt=ut===void 0?0:ut,xt=Y.title,jt=Y.valueRender,nr=Y.prefix,en=Y.suffix,Lr=Y.loading,Vn=Lr===void 0?!1:Lr,rn=Y.direction,Mn=Y.onMouseEnter,ii=Y.onMouseLeave,Yn=Y.decimalSeparator,yn=Yn===void 0?".":Yn,Ai=Y.groupSeparator,Pi=Ai===void 0?",":Ai,Mi=J.createElement(It,(0,_e.Z)({decimalSeparator:yn,groupSeparator:Pi},Y,{value:yt})),Hn=ie()(Le,(0,V.Z)({},"".concat(Le,"-rtl"),rn==="rtl"),O);return J.createElement("div",{className:Hn,style:Me,onMouseEnter:Mn,onMouseLeave:ii},xt&&J.createElement("div",{className:"".concat(Le,"-title")},xt),J.createElement(ae.Z,{paragraph:!1,loading:Vn,className:"".concat(Le,"-skeleton")},J.createElement("div",{style:we,className:"".concat(Le,"-content")},nr&&J.createElement("span",{className:"".concat(Le,"-content-prefix")},nr),jt?jt(Mi):Mi,en&&J.createElement("span",{className:"".concat(Le,"-content-suffix")},en))))},qt=(0,We.PG)({prefixCls:"statistic"})(tr),ir=qt,rr=N(28481),At=N(32475),gt=N.n(At),Br=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function dr(xr,Y){var Le=xr,O=/\[[^\]]*]/g,Me=(Y.match(O)||[]).map(function(xt){return xt.slice(1,-1)}),we=Y.replace(O,"[]"),ut=Br.reduce(function(xt,jt){var nr=(0,rr.Z)(jt,2),en=nr[0],Lr=nr[1];if(xt.includes(en)){var Vn=Math.floor(Le/Lr);return Le-=Vn*Lr,xt.replace(new RegExp("".concat(en,"+"),"g"),function(rn){var Mn=rn.length;return gt()(Vn.toString(),Mn,"0")})}return xt},we),yt=0;return ut.replace(O,function(){var xt=Me[yt];return yt+=1,xt})}function lr(xr,Y){var Le=Y.format,O=Le===void 0?"":Le,Me=new Date(xr).getTime(),we=Date.now(),ut=Math.max(Me-we,0);return dr(ut,O)}var _t=1e3/30;function at(xr){return new Date(xr).getTime()}var Ot=function(Y){var Le=Y.value,O=Y.format,Me=O===void 0?"HH:mm:ss":O,we=Y.onChange,ut=Y.onFinish,yt=(0,y.Z)(),xt=J.useRef(null),jt=function(){ut==null||ut(),xt.current&&(clearInterval(xt.current),xt.current=null)},nr=function(){var rn=at(Le);rn>=Date.now()&&(xt.current=setInterval(function(){yt(),we==null||we(rn-Date.now()),rn<Date.now()&&jt()},_t))};J.useEffect(function(){return nr(),function(){xt.current&&(clearInterval(xt.current),xt.current=null)}},[Le]);var en=function(rn,Mn){return lr(rn,(0,_e.Z)((0,_e.Z)({},Mn),{format:Me}))},Lr=function(rn){return(0,oe.Tm)(rn,{title:void 0})};return J.createElement(ir,(0,_e.Z)({},Y,{valueRender:Lr,formatter:en}))},ft=J.memo(Ot);ir.Countdown=ft;var Kt=ir},95300:function(Sr,Q,N){"use strict";var _e=N(38663),J=N.n(_e),y=N(81903),oe=N.n(y),V=N(18446)},9187:function(Sr){"use strict";Sr.exports=Q,Sr.exports.default=Q;function Q(O,Me,we){we=we||2;var ut=Me&&Me.length,yt=ut?Me[0]*we:O.length,xt=N(O,0,yt,we,!0),jt=[];if(!xt||xt.next===xt.prev)return jt;var nr,en,Lr,Vn,rn,Mn,ii;if(ut&&(xt=ie(O,Me,xt,we)),O.length>80*we){nr=Lr=O[0],en=Vn=O[1];for(var Yn=we;Yn<yt;Yn+=we)rn=O[Yn],Mn=O[Yn+1],rn<nr&&(nr=rn),Mn<en&&(en=Mn),rn>Lr&&(Lr=rn),Mn>Vn&&(Vn=Mn);ii=Math.max(Lr-nr,Vn-en),ii=ii!==0?32767/ii:0}return J(xt,jt,we,nr,en,ii,0),jt}function N(O,Me,we,ut,yt){var xt,jt;if(yt===Le(O,Me,we,ut)>0)for(xt=Me;xt<we;xt+=ut)jt=Kt(xt,O[xt],O[xt+1],jt);else for(xt=we-ut;xt>=Me;xt-=ut)jt=Kt(xt,O[xt],O[xt+1],jt);return jt&&gt(jt,jt.next)&&(xr(jt),jt=jt.next),jt}function _e(O,Me){if(!O)return O;Me||(Me=O);var we=O,ut;do if(ut=!1,!we.steiner&&(gt(we,we.next)||At(we.prev,we,we.next)===0)){if(xr(we),we=Me=we.prev,we===we.next)break;ut=!0}else we=we.next;while(ut||we!==Me);return Me}function J(O,Me,we,ut,yt,xt,jt){if(!!O){!jt&&xt&&ct(O,ut,yt,xt);for(var nr=O,en,Lr;O.prev!==O.next;){if(en=O.prev,Lr=O.next,xt?oe(O,ut,yt,xt):y(O)){Me.push(en.i/we|0),Me.push(O.i/we|0),Me.push(Lr.i/we|0),xr(O),O=Lr.next,nr=Lr.next;continue}if(O=Lr,O===nr){jt?jt===1?(O=V(_e(O),Me,we),J(O,Me,we,ut,yt,xt,2)):jt===2&&ce(O,Me,we,ut,yt,xt):J(_e(O),Me,we,ut,yt,xt,1);break}}}}function y(O){var Me=O.prev,we=O,ut=O.next;if(At(Me,we,ut)>=0)return!1;for(var yt=Me.x,xt=we.x,jt=ut.x,nr=Me.y,en=we.y,Lr=ut.y,Vn=yt<xt?yt<jt?yt:jt:xt<jt?xt:jt,rn=nr<en?nr<Lr?nr:Lr:en<Lr?en:Lr,Mn=yt>xt?yt>jt?yt:jt:xt>jt?xt:jt,ii=nr>en?nr>Lr?nr:Lr:en>Lr?en:Lr,Yn=ut.next;Yn!==Me;){if(Yn.x>=Vn&&Yn.x<=Mn&&Yn.y>=rn&&Yn.y<=ii&&ir(yt,nr,xt,en,jt,Lr,Yn.x,Yn.y)&&At(Yn.prev,Yn,Yn.next)>=0)return!1;Yn=Yn.next}return!0}function oe(O,Me,we,ut){var yt=O.prev,xt=O,jt=O.next;if(At(yt,xt,jt)>=0)return!1;for(var nr=yt.x,en=xt.x,Lr=jt.x,Vn=yt.y,rn=xt.y,Mn=jt.y,ii=nr<en?nr<Lr?nr:Lr:en<Lr?en:Lr,Yn=Vn<rn?Vn<Mn?Vn:Mn:rn<Mn?rn:Mn,yn=nr>en?nr>Lr?nr:Lr:en>Lr?en:Lr,Ai=Vn>rn?Vn>Mn?Vn:Mn:rn>Mn?rn:Mn,Pi=tr(ii,Yn,Me,we,ut),Mi=tr(yn,Ai,Me,we,ut),Hn=O.prevZ,Ln=O.nextZ;Hn&&Hn.z>=Pi&&Ln&&Ln.z<=Mi;){if(Hn.x>=ii&&Hn.x<=yn&&Hn.y>=Yn&&Hn.y<=Ai&&Hn!==yt&&Hn!==jt&&ir(nr,Vn,en,rn,Lr,Mn,Hn.x,Hn.y)&&At(Hn.prev,Hn,Hn.next)>=0||(Hn=Hn.prevZ,Ln.x>=ii&&Ln.x<=yn&&Ln.y>=Yn&&Ln.y<=Ai&&Ln!==yt&&Ln!==jt&&ir(nr,Vn,en,rn,Lr,Mn,Ln.x,Ln.y)&&At(Ln.prev,Ln,Ln.next)>=0))return!1;Ln=Ln.nextZ}for(;Hn&&Hn.z>=Pi;){if(Hn.x>=ii&&Hn.x<=yn&&Hn.y>=Yn&&Hn.y<=Ai&&Hn!==yt&&Hn!==jt&&ir(nr,Vn,en,rn,Lr,Mn,Hn.x,Hn.y)&&At(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.prevZ}for(;Ln&&Ln.z<=Mi;){if(Ln.x>=ii&&Ln.x<=yn&&Ln.y>=Yn&&Ln.y<=Ai&&Ln!==yt&&Ln!==jt&&ir(nr,Vn,en,rn,Lr,Mn,Ln.x,Ln.y)&&At(Ln.prev,Ln,Ln.next)>=0)return!1;Ln=Ln.nextZ}return!0}function V(O,Me,we){var ut=O;do{var yt=ut.prev,xt=ut.next.next;!gt(yt,xt)&&Br(yt,ut,ut.next,xt)&&at(yt,xt)&&at(xt,yt)&&(Me.push(yt.i/we|0),Me.push(ut.i/we|0),Me.push(xt.i/we|0),xr(ut),xr(ut.next),ut=O=xt),ut=ut.next}while(ut!==O);return _e(ut)}function ce(O,Me,we,ut,yt,xt){var jt=O;do{for(var nr=jt.next.next;nr!==jt.prev;){if(jt.i!==nr.i&&rr(jt,nr)){var en=ft(jt,nr);jt=_e(jt,jt.next),en=_e(en,en.next),J(jt,Me,we,ut,yt,xt,0),J(en,Me,we,ut,yt,xt,0);return}nr=nr.next}jt=jt.next}while(jt!==O)}function ie(O,Me,we,ut){var yt=[],xt,jt,nr,en,Lr;for(xt=0,jt=Me.length;xt<jt;xt++)nr=Me[xt]*ut,en=xt<jt-1?Me[xt+1]*ut:O.length,Lr=N(O,nr,en,ut,!1),Lr===Lr.next&&(Lr.steiner=!0),yt.push(qt(Lr));for(yt.sort(We),xt=0;xt<yt.length;xt++)we=ae(yt[xt],we);return we}function We(O,Me){return O.x-Me.x}function ae(O,Me){var we=He(O,Me);if(!we)return Me;var ut=ft(we,O);return _e(ut,ut.next),_e(we,we.next)}function He(O,Me){var we=Me,ut=O.x,yt=O.y,xt=-Infinity,jt;do{if(yt<=we.y&&yt>=we.next.y&&we.next.y!==we.y){var nr=we.x+(yt-we.y)*(we.next.x-we.x)/(we.next.y-we.y);if(nr<=ut&&nr>xt&&(xt=nr,jt=we.x<we.next.x?we:we.next,nr===ut))return jt}we=we.next}while(we!==Me);if(!jt)return null;var en=jt,Lr=jt.x,Vn=jt.y,rn=Infinity,Mn;we=jt;do ut>=we.x&&we.x>=Lr&&ut!==we.x&&ir(yt<Vn?ut:xt,yt,Lr,Vn,yt<Vn?xt:ut,yt,we.x,we.y)&&(Mn=Math.abs(yt-we.y)/(ut-we.x),at(we,O)&&(Mn<rn||Mn===rn&&(we.x>jt.x||we.x===jt.x&&nt(jt,we)))&&(jt=we,rn=Mn)),we=we.next;while(we!==en);return jt}function nt(O,Me){return At(O.prev,O,Me.prev)<0&&At(Me.next,O,O.next)<0}function ct(O,Me,we,ut){var yt=O;do yt.z===0&&(yt.z=tr(yt.x,yt.y,Me,we,ut)),yt.prevZ=yt.prev,yt.nextZ=yt.next,yt=yt.next;while(yt!==O);yt.prevZ.nextZ=null,yt.prevZ=null,It(yt)}function It(O){var Me,we,ut,yt,xt,jt,nr,en,Lr=1;do{for(we=O,O=null,xt=null,jt=0;we;){for(jt++,ut=we,nr=0,Me=0;Me<Lr&&(nr++,ut=ut.nextZ,!!ut);Me++);for(en=Lr;nr>0||en>0&&ut;)nr!==0&&(en===0||!ut||we.z<=ut.z)?(yt=we,we=we.nextZ,nr--):(yt=ut,ut=ut.nextZ,en--),xt?xt.nextZ=yt:O=yt,yt.prevZ=xt,xt=yt;we=ut}xt.nextZ=null,Lr*=2}while(jt>1);return O}function tr(O,Me,we,ut,yt){return O=(O-we)*yt|0,Me=(Me-ut)*yt|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,O|Me<<1}function qt(O){var Me=O,we=O;do(Me.x<we.x||Me.x===we.x&&Me.y<we.y)&&(we=Me),Me=Me.next;while(Me!==O);return we}function ir(O,Me,we,ut,yt,xt,jt,nr){return(yt-jt)*(Me-nr)>=(O-jt)*(xt-nr)&&(O-jt)*(ut-nr)>=(we-jt)*(Me-nr)&&(we-jt)*(xt-nr)>=(yt-jt)*(ut-nr)}function rr(O,Me){return O.next.i!==Me.i&&O.prev.i!==Me.i&&!_t(O,Me)&&(at(O,Me)&&at(Me,O)&&Ot(O,Me)&&(At(O.prev,O,Me.prev)||At(O,Me.prev,Me))||gt(O,Me)&&At(O.prev,O,O.next)>0&&At(Me.prev,Me,Me.next)>0)}function At(O,Me,we){return(Me.y-O.y)*(we.x-Me.x)-(Me.x-O.x)*(we.y-Me.y)}function gt(O,Me){return O.x===Me.x&&O.y===Me.y}function Br(O,Me,we,ut){var yt=lr(At(O,Me,we)),xt=lr(At(O,Me,ut)),jt=lr(At(we,ut,O)),nr=lr(At(we,ut,Me));return!!(yt!==xt&&jt!==nr||yt===0&&dr(O,we,Me)||xt===0&&dr(O,ut,Me)||jt===0&&dr(we,O,ut)||nr===0&&dr(we,Me,ut))}function dr(O,Me,we){return Me.x<=Math.max(O.x,we.x)&&Me.x>=Math.min(O.x,we.x)&&Me.y<=Math.max(O.y,we.y)&&Me.y>=Math.min(O.y,we.y)}function lr(O){return O>0?1:O<0?-1:0}function _t(O,Me){var we=O;do{if(we.i!==O.i&&we.next.i!==O.i&&we.i!==Me.i&&we.next.i!==Me.i&&Br(we,we.next,O,Me))return!0;we=we.next}while(we!==O);return!1}function at(O,Me){return At(O.prev,O,O.next)<0?At(O,Me,O.next)>=0&&At(O,O.prev,Me)>=0:At(O,Me,O.prev)<0||At(O,O.next,Me)<0}function Ot(O,Me){var we=O,ut=!1,yt=(O.x+Me.x)/2,xt=(O.y+Me.y)/2;do we.y>xt!=we.next.y>xt&&we.next.y!==we.y&&yt<(we.next.x-we.x)*(xt-we.y)/(we.next.y-we.y)+we.x&&(ut=!ut),we=we.next;while(we!==O);return ut}function ft(O,Me){var we=new Y(O.i,O.x,O.y),ut=new Y(Me.i,Me.x,Me.y),yt=O.next,xt=Me.prev;return O.next=Me,Me.prev=O,we.next=yt,yt.prev=we,ut.next=we,we.prev=ut,xt.next=ut,ut.prev=xt,ut}function Kt(O,Me,we,ut){var yt=new Y(O,Me,we);return ut?(yt.next=ut.next,yt.prev=ut,ut.next.prev=yt,ut.next=yt):(yt.prev=yt,yt.next=yt),yt}function xr(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function Y(O,Me,we){this.i=O,this.x=Me,this.y=we,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Q.deviation=function(O,Me,we,ut){var yt=Me&&Me.length,xt=yt?Me[0]*we:O.length,jt=Math.abs(Le(O,0,xt,we));if(yt)for(var nr=0,en=Me.length;nr<en;nr++){var Lr=Me[nr]*we,Vn=nr<en-1?Me[nr+1]*we:O.length;jt-=Math.abs(Le(O,Lr,Vn,we))}var rn=0;for(nr=0;nr<ut.length;nr+=3){var Mn=ut[nr]*we,ii=ut[nr+1]*we,Yn=ut[nr+2]*we;rn+=Math.abs((O[Mn]-O[Yn])*(O[ii+1]-O[Mn+1])-(O[Mn]-O[ii])*(O[Yn+1]-O[Mn+1]))}return jt===0&&rn===0?0:Math.abs((rn-jt)/jt)};function Le(O,Me,we,ut){for(var yt=0,xt=Me,jt=we-ut;xt<we;xt+=ut)yt+=(O[jt]-O[xt])*(O[xt+1]+O[jt+1]),jt=xt;return yt}Q.flatten=function(O){for(var Me=O[0][0].length,we={vertices:[],holes:[],dimensions:Me},ut=0,yt=0;yt<O.length;yt++){for(var xt=0;xt<O[yt].length;xt++)for(var jt=0;jt<Me;jt++)we.vertices.push(O[yt][xt][jt]);yt>0&&(ut+=O[yt-1].length,we.holes.push(ut))}return we}},67709:function(Sr){function Q(_e){var J=_e.target||_e.srcElement;J.__resizeRAF__&&cancelAnimationFrame(J.__resizeRAF__),J.__resizeRAF__=requestAnimationFrame(function(){var y=J.__resizeTrigger__,oe=y&&y.__resizeListeners__;oe&&oe.forEach(function(V){V.call(y,_e)})})}var N=function(J,y){var oe=this,V=oe.document,ce,ie=V.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function We(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Q)}if(!J.__resizeListeners__)if(J.__resizeListeners__=[],ie)J.__resizeTrigger__=J,J.attachEvent("onresize",Q);else{getComputedStyle(J).position==="static"&&(J.style.position="relative");var ae=J.__resizeTrigger__=V.createElement("object");ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ae.setAttribute("class","resize-sensor"),ae.setAttribute("tabindex","-1"),ae.setAttribute("title",""),ae.__resizeElement__=J,ae.onload=We,ae.type="text/html",ce&&J.appendChild(ae),ae.data="about:blank",ce||J.appendChild(ae)}J.__resizeListeners__.push(y)};Sr.exports=typeof window=="undefined"?N:N.bind(window),Sr.exports.unbind=function(_e,J){var y=document.attachEvent,oe=_e.__resizeListeners__||[];if(J){var V=oe.indexOf(J);V!==-1&&oe.splice(V,1)}else oe=_e.__resizeListeners__=[];if(!oe.length){if(y)_e.detachEvent("onresize",Q);else if(_e.__resizeTrigger__){var ce=_e.__resizeTrigger__.contentDocument,ie=ce&&ce.defaultView;ie&&(ie.removeEventListener("resize",Q),delete ie.__resizeTrigger__),_e.__resizeTrigger__=!_e.removeChild(_e.__resizeTrigger__)}delete _e.__resizeListeners__}}},26729:function(Sr){"use strict";var Q=Object.prototype.hasOwnProperty,N="~";function _e(){}Object.create&&(_e.prototype=Object.create(null),new _e().__proto__||(N=!1));function J(ce,ie,We){this.fn=ce,this.context=ie,this.once=We||!1}function y(ce,ie,We,ae,He){if(typeof We!="function")throw new TypeError("The listener must be a function");var nt=new J(We,ae||ce,He),ct=N?N+ie:ie;return ce._events[ct]?ce._events[ct].fn?ce._events[ct]=[ce._events[ct],nt]:ce._events[ct].push(nt):(ce._events[ct]=nt,ce._eventsCount++),ce}function oe(ce,ie){--ce._eventsCount==0?ce._events=new _e:delete ce._events[ie]}function V(){this._events=new _e,this._eventsCount=0}V.prototype.eventNames=function(){var ie=[],We,ae;if(this._eventsCount===0)return ie;for(ae in We=this._events)Q.call(We,ae)&&ie.push(N?ae.slice(1):ae);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols(We)):ie},V.prototype.listeners=function(ie){var We=N?N+ie:ie,ae=this._events[We];if(!ae)return[];if(ae.fn)return[ae.fn];for(var He=0,nt=ae.length,ct=new Array(nt);He<nt;He++)ct[He]=ae[He].fn;return ct},V.prototype.listenerCount=function(ie){var We=N?N+ie:ie,ae=this._events[We];return ae?ae.fn?1:ae.length:0},V.prototype.emit=function(ie,We,ae,He,nt,ct){var It=N?N+ie:ie;if(!this._events[It])return!1;var tr=this._events[It],qt=arguments.length,ir,rr;if(tr.fn){switch(tr.once&&this.removeListener(ie,tr.fn,void 0,!0),qt){case 1:return tr.fn.call(tr.context),!0;case 2:return tr.fn.call(tr.context,We),!0;case 3:return tr.fn.call(tr.context,We,ae),!0;case 4:return tr.fn.call(tr.context,We,ae,He),!0;case 5:return tr.fn.call(tr.context,We,ae,He,nt),!0;case 6:return tr.fn.call(tr.context,We,ae,He,nt,ct),!0}for(rr=1,ir=new Array(qt-1);rr<qt;rr++)ir[rr-1]=arguments[rr];tr.fn.apply(tr.context,ir)}else{var At=tr.length,gt;for(rr=0;rr<At;rr++)switch(tr[rr].once&&this.removeListener(ie,tr[rr].fn,void 0,!0),qt){case 1:tr[rr].fn.call(tr[rr].context);break;case 2:tr[rr].fn.call(tr[rr].context,We);break;case 3:tr[rr].fn.call(tr[rr].context,We,ae);break;case 4:tr[rr].fn.call(tr[rr].context,We,ae,He);break;default:if(!ir)for(gt=1,ir=new Array(qt-1);gt<qt;gt++)ir[gt-1]=arguments[gt];tr[rr].fn.apply(tr[rr].context,ir)}}return!0},V.prototype.on=function(ie,We,ae){return y(this,ie,We,ae,!1)},V.prototype.once=function(ie,We,ae){return y(this,ie,We,ae,!0)},V.prototype.removeListener=function(ie,We,ae,He){var nt=N?N+ie:ie;if(!this._events[nt])return this;if(!We)return oe(this,nt),this;var ct=this._events[nt];if(ct.fn)ct.fn===We&&(!He||ct.once)&&(!ae||ct.context===ae)&&oe(this,nt);else{for(var It=0,tr=[],qt=ct.length;It<qt;It++)(ct[It].fn!==We||He&&!ct[It].once||ae&&ct[It].context!==ae)&&tr.push(ct[It]);tr.length?this._events[nt]=tr.length===1?tr[0]:tr:oe(this,nt)}return this},V.prototype.removeAllListeners=function(ie){var We;return ie?(We=N?N+ie:ie,this._events[We]&&oe(this,We)):(this._events=new _e,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,Sr.exports=V},50840:function(Sr,Q,N){var _e;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(J,y,oe,V){"use strict";var ce=["","webkit","Moz","MS","ms","o"],ie=y.createElement("div"),We="function",ae=Math.round,He=Math.abs,nt=Date.now;function ct(ue,Te,it){return setTimeout(Br(ue,it),Te)}function It(ue,Te,it){return Array.isArray(ue)?(tr(ue,it[Te],it),!0):!1}function tr(ue,Te,it){var Jt;if(!!ue)if(ue.forEach)ue.forEach(Te,it);else if(ue.length!==V)for(Jt=0;Jt<ue.length;)Te.call(it,ue[Jt],Jt,ue),Jt++;else for(Jt in ue)ue.hasOwnProperty(Jt)&&Te.call(it,ue[Jt],Jt,ue)}function qt(ue,Te,it){var Jt="DEPRECATED METHOD: "+Te+`
`+it+` AT 
`;return function(){var Gr=new Error("get-stack-trace"),kn=Gr&&Gr.stack?Gr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Di=J.console&&(J.console.warn||J.console.log);return Di&&Di.call(J.console,Jt,kn),ue.apply(this,arguments)}}var ir;typeof Object.assign!="function"?ir=function(Te){if(Te===V||Te===null)throw new TypeError("Cannot convert undefined or null to object");for(var it=Object(Te),Jt=1;Jt<arguments.length;Jt++){var Gr=arguments[Jt];if(Gr!==V&&Gr!==null)for(var kn in Gr)Gr.hasOwnProperty(kn)&&(it[kn]=Gr[kn])}return it}:ir=Object.assign;var rr=qt(function(Te,it,Jt){for(var Gr=Object.keys(it),kn=0;kn<Gr.length;)(!Jt||Jt&&Te[Gr[kn]]===V)&&(Te[Gr[kn]]=it[Gr[kn]]),kn++;return Te},"extend","Use `assign`."),At=qt(function(Te,it){return rr(Te,it,!0)},"merge","Use `assign`.");function gt(ue,Te,it){var Jt=Te.prototype,Gr;Gr=ue.prototype=Object.create(Jt),Gr.constructor=ue,Gr._super=Jt,it&&ir(Gr,it)}function Br(ue,Te){return function(){return ue.apply(Te,arguments)}}function dr(ue,Te){return typeof ue==We?ue.apply(Te&&Te[0]||V,Te):ue}function lr(ue,Te){return ue===V?Te:ue}function _t(ue,Te,it){tr(Kt(Te),function(Jt){ue.addEventListener(Jt,it,!1)})}function at(ue,Te,it){tr(Kt(Te),function(Jt){ue.removeEventListener(Jt,it,!1)})}function Ot(ue,Te){for(;ue;){if(ue==Te)return!0;ue=ue.parentNode}return!1}function ft(ue,Te){return ue.indexOf(Te)>-1}function Kt(ue){return ue.trim().split(/\s+/g)}function xr(ue,Te,it){if(ue.indexOf&&!it)return ue.indexOf(Te);for(var Jt=0;Jt<ue.length;){if(it&&ue[Jt][it]==Te||!it&&ue[Jt]===Te)return Jt;Jt++}return-1}function Y(ue){return Array.prototype.slice.call(ue,0)}function Le(ue,Te,it){for(var Jt=[],Gr=[],kn=0;kn<ue.length;){var Di=Te?ue[kn][Te]:ue[kn];xr(Gr,Di)<0&&Jt.push(ue[kn]),Gr[kn]=Di,kn++}return it&&(Te?Jt=Jt.sort(function(so,Ga){return so[Te]>Ga[Te]}):Jt=Jt.sort()),Jt}function O(ue,Te){for(var it,Jt,Gr=Te[0].toUpperCase()+Te.slice(1),kn=0;kn<ce.length;){if(it=ce[kn],Jt=it?it+Gr:Te,Jt in ue)return Jt;kn++}return V}var Me=1;function we(){return Me++}function ut(ue){var Te=ue.ownerDocument||ue;return Te.defaultView||Te.parentWindow||J}var yt=/mobile|tablet|ip(ad|hone|od)|android/i,xt="ontouchstart"in J,jt=O(J,"PointerEvent")!==V,nr=xt&&yt.test(navigator.userAgent),en="touch",Lr="pen",Vn="mouse",rn="kinect",Mn=25,ii=1,Yn=2,yn=4,Ai=8,Pi=1,Mi=2,Hn=4,Ln=8,vo=16,Xi=Mi|Hn,Ya=Ln|vo,Mt=Xi|Ya,L=["x","y"],re=["clientX","clientY"];function fe(ue,Te){var it=this;this.manager=ue,this.callback=Te,this.element=ue.element,this.target=ue.options.inputTarget,this.domHandler=function(Jt){dr(ue.options.enable,[ue])&&it.handler(Jt)},this.init()}fe.prototype={handler:function(){},init:function(){this.evEl&&_t(this.element,this.evEl,this.domHandler),this.evTarget&&_t(this.target,this.evTarget,this.domHandler),this.evWin&&_t(ut(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&at(this.element,this.evEl,this.domHandler),this.evTarget&&at(this.target,this.evTarget,this.domHandler),this.evWin&&at(ut(this.element),this.evWin,this.domHandler)}};function Ue(ue){var Te,it=ue.options.inputClass;return it?Te=it:jt?Te=X:nr?Te=xe:xt?Te=br:Te=qi,new Te(ue,ht)}function ht(ue,Te,it){var Jt=it.pointers.length,Gr=it.changedPointers.length,kn=Te&ii&&Jt-Gr==0,Di=Te&(yn|Ai)&&Jt-Gr==0;it.isFirst=!!kn,it.isFinal=!!Di,kn&&(ue.session={}),it.eventType=Te,Gt(ue,it),ue.emit("hammer.input",it),ue.recognize(it),ue.session.prevInput=it}function Gt(ue,Te){var it=ue.session,Jt=Te.pointers,Gr=Jt.length;it.firstInput||(it.firstInput=Tt(Te)),Gr>1&&!it.firstMultiple?it.firstMultiple=Tt(Te):Gr===1&&(it.firstMultiple=!1);var kn=it.firstInput,Di=it.firstMultiple,Oa=Di?Di.center:kn.center,so=Te.center=ar(Jt);Te.timeStamp=nt(),Te.deltaTime=Te.timeStamp-kn.timeStamp,Te.angle=Cn(Oa,so),Te.distance=_n(Oa,so),Ar(it,Te),Te.offsetDirection=$r(Te.deltaX,Te.deltaY);var Ga=wr(Te.deltaTime,Te.deltaX,Te.deltaY);Te.overallVelocityX=Ga.x,Te.overallVelocityY=Ga.y,Te.overallVelocity=He(Ga.x)>He(Ga.y)?Ga.x:Ga.y,Te.scale=Di?wn(Di.pointers,Jt):1,Te.rotation=Di?xn(Di.pointers,Jt):0,Te.maxPointers=it.prevInput?Te.pointers.length>it.prevInput.maxPointers?Te.pointers.length:it.prevInput.maxPointers:Te.pointers.length,je(it,Te);var os=ue.element;Ot(Te.srcEvent.target,os)&&(os=Te.srcEvent.target),Te.target=os}function Ar(ue,Te){var it=Te.center,Jt=ue.offsetDelta||{},Gr=ue.prevDelta||{},kn=ue.prevInput||{};(Te.eventType===ii||kn.eventType===yn)&&(Gr=ue.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},Jt=ue.offsetDelta={x:it.x,y:it.y}),Te.deltaX=Gr.x+(it.x-Jt.x),Te.deltaY=Gr.y+(it.y-Jt.y)}function je(ue,Te){var it=ue.lastInterval||Te,Jt=Te.timeStamp-it.timeStamp,Gr,kn,Di,Oa;if(Te.eventType!=Ai&&(Jt>Mn||it.velocity===V)){var so=Te.deltaX-it.deltaX,Ga=Te.deltaY-it.deltaY,os=wr(Jt,so,Ga);kn=os.x,Di=os.y,Gr=He(os.x)>He(os.y)?os.x:os.y,Oa=$r(so,Ga),ue.lastInterval=Te}else Gr=it.velocity,kn=it.velocityX,Di=it.velocityY,Oa=it.direction;Te.velocity=Gr,Te.velocityX=kn,Te.velocityY=Di,Te.direction=Oa}function Tt(ue){for(var Te=[],it=0;it<ue.pointers.length;)Te[it]={clientX:ae(ue.pointers[it].clientX),clientY:ae(ue.pointers[it].clientY)},it++;return{timeStamp:nt(),pointers:Te,center:ar(Te),deltaX:ue.deltaX,deltaY:ue.deltaY}}function ar(ue){var Te=ue.length;if(Te===1)return{x:ae(ue[0].clientX),y:ae(ue[0].clientY)};for(var it=0,Jt=0,Gr=0;Gr<Te;)it+=ue[Gr].clientX,Jt+=ue[Gr].clientY,Gr++;return{x:ae(it/Te),y:ae(Jt/Te)}}function wr(ue,Te,it){return{x:Te/ue||0,y:it/ue||0}}function $r(ue,Te){return ue===Te?Pi:He(ue)>=He(Te)?ue<0?Mi:Hn:Te<0?Ln:vo}function _n(ue,Te,it){it||(it=L);var Jt=Te[it[0]]-ue[it[0]],Gr=Te[it[1]]-ue[it[1]];return Math.sqrt(Jt*Jt+Gr*Gr)}function Cn(ue,Te,it){it||(it=L);var Jt=Te[it[0]]-ue[it[0]],Gr=Te[it[1]]-ue[it[1]];return Math.atan2(Gr,Jt)*180/Math.PI}function xn(ue,Te){return Cn(Te[1],Te[0],re)+Cn(ue[1],ue[0],re)}function wn(ue,Te){return _n(Te[0],Te[1],re)/_n(ue[0],ue[1],re)}var ri={mousedown:ii,mousemove:Yn,mouseup:yn},Kn="mousedown",Yi="mousemove mouseup";function qi(){this.evEl=Kn,this.evWin=Yi,this.pressed=!1,fe.apply(this,arguments)}gt(qi,fe,{handler:function(Te){var it=ri[Te.type];it&ii&&Te.button===0&&(this.pressed=!0),it&Yn&&Te.which!==1&&(it=yn),!!this.pressed&&(it&yn&&(this.pressed=!1),this.callback(this.manager,it,{pointers:[Te],changedPointers:[Te],pointerType:Vn,srcEvent:Te}))}});var mo={pointerdown:ii,pointermove:Yn,pointerup:yn,pointercancel:Ai,pointerout:Ai},Wo={2:en,3:Lr,4:Vn,5:rn},Ki="pointerdown",G="pointermove pointerup pointercancel";J.MSPointerEvent&&!J.PointerEvent&&(Ki="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function X(){this.evEl=Ki,this.evWin=G,fe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}gt(X,fe,{handler:function(Te){var it=this.store,Jt=!1,Gr=Te.type.toLowerCase().replace("ms",""),kn=mo[Gr],Di=Wo[Te.pointerType]||Te.pointerType,Oa=Di==en,so=xr(it,Te.pointerId,"pointerId");kn&ii&&(Te.button===0||Oa)?so<0&&(it.push(Te),so=it.length-1):kn&(yn|Ai)&&(Jt=!0),!(so<0)&&(it[so]=Te,this.callback(this.manager,kn,{pointers:it,changedPointers:[Te],pointerType:Di,srcEvent:Te}),Jt&&it.splice(so,1))}});var ne={touchstart:ii,touchmove:Yn,touchend:yn,touchcancel:Ai},be="touchstart",Oe="touchstart touchmove touchend touchcancel";function Qe(){this.evTarget=be,this.evWin=Oe,this.started=!1,fe.apply(this,arguments)}gt(Qe,fe,{handler:function(Te){var it=ne[Te.type];if(it===ii&&(this.started=!0),!!this.started){var Jt=ot.call(this,Te,it);it&(yn|Ai)&&Jt[0].length-Jt[1].length==0&&(this.started=!1),this.callback(this.manager,it,{pointers:Jt[0],changedPointers:Jt[1],pointerType:en,srcEvent:Te})}}});function ot(ue,Te){var it=Y(ue.touches),Jt=Y(ue.changedTouches);return Te&(yn|Ai)&&(it=Le(it.concat(Jt),"identifier",!0)),[it,Jt]}var he={touchstart:ii,touchmove:Yn,touchend:yn,touchcancel:Ai},K="touchstart touchmove touchend touchcancel";function xe(){this.evTarget=K,this.targetIds={},fe.apply(this,arguments)}gt(xe,fe,{handler:function(Te){var it=he[Te.type],Jt=lt.call(this,Te,it);!Jt||this.callback(this.manager,it,{pointers:Jt[0],changedPointers:Jt[1],pointerType:en,srcEvent:Te})}});function lt(ue,Te){var it=Y(ue.touches),Jt=this.targetIds;if(Te&(ii|Yn)&&it.length===1)return Jt[it[0].identifier]=!0,[it,it];var Gr,kn,Di=Y(ue.changedTouches),Oa=[],so=this.target;if(kn=it.filter(function(Ga){return Ot(Ga.target,so)}),Te===ii)for(Gr=0;Gr<kn.length;)Jt[kn[Gr].identifier]=!0,Gr++;for(Gr=0;Gr<Di.length;)Jt[Di[Gr].identifier]&&Oa.push(Di[Gr]),Te&(yn|Ai)&&delete Jt[Di[Gr].identifier],Gr++;if(!!Oa.length)return[Le(kn.concat(Oa),"identifier",!0),Oa]}var pt=2500,te=25;function br(){fe.apply(this,arguments);var ue=Br(this.handler,this);this.touch=new xe(this.manager,ue),this.mouse=new qi(this.manager,ue),this.primaryTouch=null,this.lastTouches=[]}gt(br,fe,{handler:function(Te,it,Jt){var Gr=Jt.pointerType==en,kn=Jt.pointerType==Vn;if(!(kn&&Jt.sourceCapabilities&&Jt.sourceCapabilities.firesTouchEvents)){if(Gr)bn.call(this,it,Jt);else if(kn&&Qt.call(this,Jt))return;this.callback(Te,it,Jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bn(ue,Te){ue&ii?(this.primaryTouch=Te.changedPointers[0].identifier,cn.call(this,Te)):ue&(yn|Ai)&&cn.call(this,Te)}function cn(ue){var Te=ue.changedPointers[0];if(Te.identifier===this.primaryTouch){var it={x:Te.clientX,y:Te.clientY};this.lastTouches.push(it);var Jt=this.lastTouches,Gr=function(){var kn=Jt.indexOf(it);kn>-1&&Jt.splice(kn,1)};setTimeout(Gr,pt)}}function Qt(ue){for(var Te=ue.srcEvent.clientX,it=ue.srcEvent.clientY,Jt=0;Jt<this.lastTouches.length;Jt++){var Gr=this.lastTouches[Jt],kn=Math.abs(Te-Gr.x),Di=Math.abs(it-Gr.y);if(kn<=te&&Di<=te)return!0}return!1}var tn=O(ie.style,"touchAction"),Hr=tn!==V,qr="compute",si="auto",Jr="manipulation",fi="none",zi="pan-x",ui="pan-y",wi=ji();function bi(ue,Te){this.manager=ue,this.set(Te)}bi.prototype={set:function(ue){ue==qr&&(ue=this.compute()),Hr&&this.manager.element.style&&wi[ue]&&(this.manager.element.style[tn]=ue),this.actions=ue.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ue=[];return tr(this.manager.recognizers,function(Te){dr(Te.options.enable,[Te])&&(ue=ue.concat(Te.getTouchAction()))}),oo(ue.join(" "))},preventDefaults:function(ue){var Te=ue.srcEvent,it=ue.offsetDirection;if(this.manager.session.prevented){Te.preventDefault();return}var Jt=this.actions,Gr=ft(Jt,fi)&&!wi[fi],kn=ft(Jt,ui)&&!wi[ui],Di=ft(Jt,zi)&&!wi[zi];if(Gr){var Oa=ue.pointers.length===1,so=ue.distance<2,Ga=ue.deltaTime<250;if(Oa&&so&&Ga)return}if(!(Di&&kn)&&(Gr||kn&&it&Xi||Di&&it&Ya))return this.preventSrc(Te)},preventSrc:function(ue){this.manager.session.prevented=!0,ue.preventDefault()}};function oo(ue){if(ft(ue,fi))return fi;var Te=ft(ue,zi),it=ft(ue,ui);return Te&&it?fi:Te||it?Te?zi:ui:ft(ue,Jr)?Jr:si}function ji(){if(!Hr)return!1;var ue={},Te=J.CSS&&J.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(it){ue[it]=Te?J.CSS.supports("touch-action",it):!0}),ue}var fa=1,mi=2,li=4,gi=8,ha=gi,Ns=16,Ji=32;function aa(ue){this.options=ir({},this.defaults,ue||{}),this.id=we(),this.manager=null,this.options.enable=lr(this.options.enable,!0),this.state=fa,this.simultaneous={},this.requireFail=[]}aa.prototype={defaults:{},set:function(ue){return ir(this.options,ue),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ue){if(It(ue,"recognizeWith",this))return this;var Te=this.simultaneous;return ue=pa(ue,this),Te[ue.id]||(Te[ue.id]=ue,ue.recognizeWith(this)),this},dropRecognizeWith:function(ue){return It(ue,"dropRecognizeWith",this)?this:(ue=pa(ue,this),delete this.simultaneous[ue.id],this)},requireFailure:function(ue){if(It(ue,"requireFailure",this))return this;var Te=this.requireFail;return ue=pa(ue,this),xr(Te,ue)===-1&&(Te.push(ue),ue.requireFailure(this)),this},dropRequireFailure:function(ue){if(It(ue,"dropRequireFailure",this))return this;ue=pa(ue,this);var Te=xr(this.requireFail,ue);return Te>-1&&this.requireFail.splice(Te,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ue){return!!this.simultaneous[ue.id]},emit:function(ue){var Te=this,it=this.state;function Jt(Gr){Te.manager.emit(Gr,ue)}it<gi&&Jt(Te.options.event+hl(it)),Jt(Te.options.event),ue.additionalEvent&&Jt(ue.additionalEvent),it>=gi&&Jt(Te.options.event+hl(it))},tryEmit:function(ue){if(this.canEmit())return this.emit(ue);this.state=Ji},canEmit:function(){for(var ue=0;ue<this.requireFail.length;){if(!(this.requireFail[ue].state&(Ji|fa)))return!1;ue++}return!0},recognize:function(ue){var Te=ir({},ue);if(!dr(this.options.enable,[this,Te])){this.reset(),this.state=Ji;return}this.state&(ha|Ns|Ji)&&(this.state=fa),this.state=this.process(Te),this.state&(mi|li|gi|Ns)&&this.tryEmit(Te)},process:function(ue){},getTouchAction:function(){},reset:function(){}};function hl(ue){return ue&Ns?"cancel":ue&gi?"end":ue&li?"move":ue&mi?"start":""}function Fu(ue){return ue==vo?"down":ue==Ln?"up":ue==Mi?"left":ue==Hn?"right":""}function pa(ue,Te){var it=Te.manager;return it?it.get(ue):ue}function qn(){aa.apply(this,arguments)}gt(qn,aa,{defaults:{pointers:1},attrTest:function(ue){var Te=this.options.pointers;return Te===0||ue.pointers.length===Te},process:function(ue){var Te=this.state,it=ue.eventType,Jt=Te&(mi|li),Gr=this.attrTest(ue);return Jt&&(it&Ai||!Gr)?Te|Ns:Jt||Gr?it&yn?Te|gi:Te&mi?Te|li:mi:Ji}});function oa(){qn.apply(this,arguments),this.pX=null,this.pY=null}gt(oa,qn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Mt},getTouchAction:function(){var ue=this.options.direction,Te=[];return ue&Xi&&Te.push(ui),ue&Ya&&Te.push(zi),Te},directionTest:function(ue){var Te=this.options,it=!0,Jt=ue.distance,Gr=ue.direction,kn=ue.deltaX,Di=ue.deltaY;return Gr&Te.direction||(Te.direction&Xi?(Gr=kn===0?Pi:kn<0?Mi:Hn,it=kn!=this.pX,Jt=Math.abs(ue.deltaX)):(Gr=Di===0?Pi:Di<0?Ln:vo,it=Di!=this.pY,Jt=Math.abs(ue.deltaY))),ue.direction=Gr,it&&Jt>Te.threshold&&Gr&Te.direction},attrTest:function(ue){return qn.prototype.attrTest.call(this,ue)&&(this.state&mi||!(this.state&mi)&&this.directionTest(ue))},emit:function(ue){this.pX=ue.deltaX,this.pY=ue.deltaY;var Te=Fu(ue.direction);Te&&(ue.additionalEvent=this.options.event+Te),this._super.emit.call(this,ue)}});function Qi(){qn.apply(this,arguments)}gt(Qi,qn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fi]},attrTest:function(ue){return this._super.attrTest.call(this,ue)&&(Math.abs(ue.scale-1)>this.options.threshold||this.state&mi)},emit:function(ue){if(ue.scale!==1){var Te=ue.scale<1?"in":"out";ue.additionalEvent=this.options.event+Te}this._super.emit.call(this,ue)}});function Mo(){aa.apply(this,arguments),this._timer=null,this._input=null}gt(Mo,aa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[si]},process:function(ue){var Te=this.options,it=ue.pointers.length===Te.pointers,Jt=ue.distance<Te.threshold,Gr=ue.deltaTime>Te.time;if(this._input=ue,!Jt||!it||ue.eventType&(yn|Ai)&&!Gr)this.reset();else if(ue.eventType&ii)this.reset(),this._timer=ct(function(){this.state=ha,this.tryEmit()},Te.time,this);else if(ue.eventType&yn)return ha;return Ji},reset:function(){clearTimeout(this._timer)},emit:function(ue){this.state===ha&&(ue&&ue.eventType&yn?this.manager.emit(this.options.event+"up",ue):(this._input.timeStamp=nt(),this.manager.emit(this.options.event,this._input)))}});function Gi(){qn.apply(this,arguments)}gt(Gi,qn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fi]},attrTest:function(ue){return this._super.attrTest.call(this,ue)&&(Math.abs(ue.rotation)>this.options.threshold||this.state&mi)}});function Po(){qn.apply(this,arguments)}gt(Po,qn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Xi|Ya,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(ue){var Te=this.options.direction,it;return Te&(Xi|Ya)?it=ue.overallVelocity:Te&Xi?it=ue.overallVelocityX:Te&Ya&&(it=ue.overallVelocityY),this._super.attrTest.call(this,ue)&&Te&ue.offsetDirection&&ue.distance>this.options.threshold&&ue.maxPointers==this.options.pointers&&He(it)>this.options.velocity&&ue.eventType&yn},emit:function(ue){var Te=Fu(ue.offsetDirection);Te&&this.manager.emit(this.options.event+Te,ue),this.manager.emit(this.options.event,ue)}});function go(){aa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}gt(go,aa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Jr]},process:function(ue){var Te=this.options,it=ue.pointers.length===Te.pointers,Jt=ue.distance<Te.threshold,Gr=ue.deltaTime<Te.time;if(this.reset(),ue.eventType&ii&&this.count===0)return this.failTimeout();if(Jt&&Gr&&it){if(ue.eventType!=yn)return this.failTimeout();var kn=this.pTime?ue.timeStamp-this.pTime<Te.interval:!0,Di=!this.pCenter||_n(this.pCenter,ue.center)<Te.posThreshold;this.pTime=ue.timeStamp,this.pCenter=ue.center,!Di||!kn?this.count=1:this.count+=1,this._input=ue;var Oa=this.count%Te.taps;if(Oa===0)return this.hasRequireFailures()?(this._timer=ct(function(){this.state=ha,this.tryEmit()},Te.interval,this),mi):ha}return Ji},failTimeout:function(){return this._timer=ct(function(){this.state=Ji},this.options.interval,this),Ji},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ha&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Cs(ue,Te){return Te=Te||{},Te.recognizers=lr(Te.recognizers,Cs.defaults.preset),new yo(ue,Te)}Cs.VERSION="2.0.7",Cs.defaults={domEvents:!1,touchAction:qr,enable:!0,inputTarget:null,inputClass:null,preset:[[Gi,{enable:!1}],[Qi,{enable:!1},["rotate"]],[Po,{direction:Xi}],[oa,{direction:Xi},["swipe"]],[go],[go,{event:"doubletap",taps:2},["tap"]],[Mo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var zo=1,Dl=2;function yo(ue,Te){this.options=ir({},Cs.defaults,Te||{}),this.options.inputTarget=this.options.inputTarget||ue,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ue,this.input=Ue(this),this.touchAction=new bi(this,this.options.touchAction),Ea(this,!0),tr(this.options.recognizers,function(it){var Jt=this.add(new it[0](it[1]));it[2]&&Jt.recognizeWith(it[2]),it[3]&&Jt.requireFailure(it[3])},this)}yo.prototype={set:function(ue){return ir(this.options,ue),ue.touchAction&&this.touchAction.update(),ue.inputTarget&&(this.input.destroy(),this.input.target=ue.inputTarget,this.input.init()),this},stop:function(ue){this.session.stopped=ue?Dl:zo},recognize:function(ue){var Te=this.session;if(!Te.stopped){this.touchAction.preventDefaults(ue);var it,Jt=this.recognizers,Gr=Te.curRecognizer;(!Gr||Gr&&Gr.state&ha)&&(Gr=Te.curRecognizer=null);for(var kn=0;kn<Jt.length;)it=Jt[kn],Te.stopped!==Dl&&(!Gr||it==Gr||it.canRecognizeWith(Gr))?it.recognize(ue):it.reset(),!Gr&&it.state&(mi|li|gi)&&(Gr=Te.curRecognizer=it),kn++}},get:function(ue){if(ue instanceof aa)return ue;for(var Te=this.recognizers,it=0;it<Te.length;it++)if(Te[it].options.event==ue)return Te[it];return null},add:function(ue){if(It(ue,"add",this))return this;var Te=this.get(ue.options.event);return Te&&this.remove(Te),this.recognizers.push(ue),ue.manager=this,this.touchAction.update(),ue},remove:function(ue){if(It(ue,"remove",this))return this;if(ue=this.get(ue),ue){var Te=this.recognizers,it=xr(Te,ue);it!==-1&&(Te.splice(it,1),this.touchAction.update())}return this},on:function(ue,Te){if(ue!==V&&Te!==V){var it=this.handlers;return tr(Kt(ue),function(Jt){it[Jt]=it[Jt]||[],it[Jt].push(Te)}),this}},off:function(ue,Te){if(ue!==V){var it=this.handlers;return tr(Kt(ue),function(Jt){Te?it[Jt]&&it[Jt].splice(xr(it[Jt],Te),1):delete it[Jt]}),this}},emit:function(ue,Te){this.options.domEvents&&_r(ue,Te);var it=this.handlers[ue]&&this.handlers[ue].slice();if(!(!it||!it.length)){Te.type=ue,Te.preventDefault=function(){Te.srcEvent.preventDefault()};for(var Jt=0;Jt<it.length;)it[Jt](Te),Jt++}},destroy:function(){this.element&&Ea(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ea(ue,Te){var it=ue.element;if(!!it.style){var Jt;tr(ue.options.cssProps,function(Gr,kn){Jt=O(it.style,kn),Te?(ue.oldCssProps[Jt]=it.style[Jt],it.style[Jt]=Gr):it.style[Jt]=ue.oldCssProps[Jt]||""}),Te||(ue.oldCssProps={})}}function _r(ue,Te){var it=y.createEvent("Event");it.initEvent(ue,!0,!0),it.gesture=Te,Te.target.dispatchEvent(it)}ir(Cs,{INPUT_START:ii,INPUT_MOVE:Yn,INPUT_END:yn,INPUT_CANCEL:Ai,STATE_POSSIBLE:fa,STATE_BEGAN:mi,STATE_CHANGED:li,STATE_ENDED:gi,STATE_RECOGNIZED:ha,STATE_CANCELLED:Ns,STATE_FAILED:Ji,DIRECTION_NONE:Pi,DIRECTION_LEFT:Mi,DIRECTION_RIGHT:Hn,DIRECTION_UP:Ln,DIRECTION_DOWN:vo,DIRECTION_HORIZONTAL:Xi,DIRECTION_VERTICAL:Ya,DIRECTION_ALL:Mt,Manager:yo,Input:fe,TouchAction:bi,TouchInput:xe,MouseInput:qi,PointerEventInput:X,TouchMouseInput:br,SingleTouchInput:Qe,Recognizer:aa,AttrRecognizer:qn,Tap:go,Pan:oa,Swipe:Po,Pinch:Qi,Rotate:Gi,Press:Mo,on:_t,off:at,each:tr,merge:At,extend:rr,assign:ir,inherit:gt,bindFn:Br,prefixed:O});var Qr=typeof J!="undefined"?J:typeof self!="undefined"?self:{};Qr.Hammer=Cs,_e=function(){return Cs}.call(Q,N,Q,Sr),_e!==V&&(Sr.exports=_e)})(window,document,"Hammer")},80645:function(Sr,Q){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Q.read=function(N,_e,J,y,oe){var V,ce,ie=oe*8-y-1,We=(1<<ie)-1,ae=We>>1,He=-7,nt=J?oe-1:0,ct=J?-1:1,It=N[_e+nt];for(nt+=ct,V=It&(1<<-He)-1,It>>=-He,He+=ie;He>0;V=V*256+N[_e+nt],nt+=ct,He-=8);for(ce=V&(1<<-He)-1,V>>=-He,He+=y;He>0;ce=ce*256+N[_e+nt],nt+=ct,He-=8);if(V===0)V=1-ae;else{if(V===We)return ce?NaN:(It?-1:1)*Infinity;ce=ce+Math.pow(2,y),V=V-ae}return(It?-1:1)*ce*Math.pow(2,V-y)},Q.write=function(N,_e,J,y,oe,V){var ce,ie,We,ae=V*8-oe-1,He=(1<<ae)-1,nt=He>>1,ct=oe===23?Math.pow(2,-24)-Math.pow(2,-77):0,It=y?0:V-1,tr=y?1:-1,qt=_e<0||_e===0&&1/_e<0?1:0;for(_e=Math.abs(_e),isNaN(_e)||_e===Infinity?(ie=isNaN(_e)?1:0,ce=He):(ce=Math.floor(Math.log(_e)/Math.LN2),_e*(We=Math.pow(2,-ce))<1&&(ce--,We*=2),ce+nt>=1?_e+=ct/We:_e+=ct*Math.pow(2,1-nt),_e*We>=2&&(ce++,We/=2),ce+nt>=He?(ie=0,ce=He):ce+nt>=1?(ie=(_e*We-1)*Math.pow(2,oe),ce=ce+nt):(ie=_e*Math.pow(2,nt-1)*Math.pow(2,oe),ce=0));oe>=8;N[J+It]=ie&255,It+=tr,ie/=256,oe-=8);for(ce=ce<<oe|ie,ae+=oe;ae>0;N[J+It]=ce&255,It+=tr,ce/=256,ae-=8);N[J+It-tr]|=qt*128}},7375:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function _e(ce,ie,We,ae){function He(){return ae&&!Reflect.hasMetadata(N,this,ie)&&Reflect.defineMetadata(N,We(),this,ie),Reflect.hasMetadata(N,this,ie)?Reflect.getMetadata(N,this,ie):We()}function nt(ct){Reflect.defineMetadata(N,ct,this,ie)}Object.defineProperty(ce,ie,{configurable:!0,enumerable:!0,get:He,set:nt})}function J(ce,ie){return function(We){return function(ae,He){var nt=function(){return ce.get(We)};_e(ae,He,nt,ie)}}}Q.makePropertyInjectDecorator=J;function y(ce,ie){return function(We,ae){return function(He,nt){var ct=function(){return ce.getNamed(We,ae)};_e(He,nt,ct,ie)}}}Q.makePropertyInjectNamedDecorator=y;function oe(ce,ie){return function(We,ae,He){return function(nt,ct){var It=function(){return ce.getTagged(We,ae,He)};_e(nt,ct,It,ie)}}}Q.makePropertyInjectTaggedDecorator=oe;function V(ce,ie){return function(We){return function(ae,He){var nt=function(){return ce.getAll(We)};_e(ae,He,nt,ie)}}}Q.makePropertyMultiInjectDecorator=V},84879:function(Sr,Q,N){"use strict";var _e;_e={value:!0};var J=N(7375);function y(oe,V){V===void 0&&(V=!0);var ce=J.makePropertyInjectDecorator(oe,V),ie=J.makePropertyInjectNamedDecorator(oe,V),We=J.makePropertyInjectTaggedDecorator(oe,V),ae=J.makePropertyMultiInjectDecorator(oe,V);return{lazyInject:ce,lazyInjectNamed:ie,lazyInjectTagged:We,lazyMultiInject:ae}}Q.Z=y},99934:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagProperty=Q.tagParameter=Q.decorate=void 0;var _e=N(16674),J=N(6867);function y(ae,He,nt,ct){var It=J.TAGGED;V(It,ae,He,ct,nt)}Q.tagParameter=y;function oe(ae,He,nt){var ct=J.TAGGED_PROP;V(ct,ae.constructor,He,nt)}Q.tagProperty=oe;function V(ae,He,nt,ct,It){var tr={},qt=typeof It=="number",ir=It!==void 0&&qt?It.toString():nt;if(qt&&nt!==void 0)throw new Error(_e.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ae,He)&&(tr=Reflect.getMetadata(ae,He));var rr=tr[ir];if(!Array.isArray(rr))rr=[];else for(var At=0,gt=rr;At<gt.length;At++){var Br=gt[At];if(Br.key===ct.key)throw new Error(_e.DUPLICATED_METADATA+" "+Br.key.toString())}rr.push(ct),tr[ir]=rr,Reflect.defineMetadata(ae,tr,He)}function ce(ae,He){Reflect.decorate(ae,He)}function ie(ae,He){return function(nt,ct){He(nt,ct,ae)}}function We(ae,He,nt){typeof nt=="number"?ce([ie(nt,ae)],He):typeof nt=="string"?Reflect.decorate([ae],He,nt):ce([ae],He)}Q.decorate=We},5744:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.inject=Q.LazyServiceIdentifer=void 0;var _e=N(16674),J=N(6867),y=N(47738),oe=N(99934),V=function(){function ie(We){this._cb=We}return ie.prototype.unwrap=function(){return this._cb()},ie}();Q.LazyServiceIdentifer=V;function ce(ie){return function(We,ae,He){if(ie===void 0)throw new Error(_e.UNDEFINED_INJECT_ANNOTATION(We.name));var nt=new y.Metadata(J.INJECT_TAG,ie);typeof He=="number"?oe.tagParameter(We,ae,He,nt):oe.tagProperty(We,ae,nt)}}Q.inject=ce},64315:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.injectable=void 0;var _e=N(16674),J=N(6867);function y(){return function(oe){if(Reflect.hasOwnMetadata(J.PARAM_TYPES,oe))throw new Error(_e.DUPLICATED_INJECTABLE_DECORATOR);var V=Reflect.getMetadata(J.DESIGN_PARAM_TYPES,oe)||[];return Reflect.defineMetadata(J.PARAM_TYPES,V,oe),oe}}Q.injectable=y},71693:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiInject=void 0;var _e=N(6867),J=N(47738),y=N(99934);function oe(V){return function(ce,ie,We){var ae=new J.Metadata(_e.MULTI_INJECT_TAG,V);typeof We=="number"?y.tagParameter(ce,ie,We,ae):y.tagProperty(ce,ie,ae)}}Q.multiInject=oe},38085:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.named=void 0;var _e=N(6867),J=N(47738),y=N(99934);function oe(V){return function(ce,ie,We){var ae=new J.Metadata(_e.NAMED_TAG,V);typeof We=="number"?y.tagParameter(ce,ie,We,ae):y.tagProperty(ce,ie,ae)}}Q.named=oe},6515:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.optional=void 0;var _e=N(6867),J=N(47738),y=N(99934);function oe(){return function(V,ce,ie){var We=new J.Metadata(_e.OPTIONAL_TAG,!0);typeof ie=="number"?y.tagParameter(V,ce,ie,We):y.tagProperty(V,ce,We)}}Q.optional=oe},7014:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.postConstruct=void 0;var _e=N(16674),J=N(6867),y=N(47738);function oe(){return function(V,ce,ie){var We=new y.Metadata(J.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(J.POST_CONSTRUCT,V.constructor))throw new Error(_e.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(J.POST_CONSTRUCT,We,V.constructor)}}Q.postConstruct=oe},32052:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagged=void 0;var _e=N(47738),J=N(99934);function y(oe,V){return function(ce,ie,We){var ae=new _e.Metadata(oe,V);typeof We=="number"?J.tagParameter(ce,ie,We,ae):J.tagProperty(ce,ie,ae)}}Q.tagged=y},55638:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.targetName=void 0;var _e=N(6867),J=N(47738),y=N(99934);function oe(V){return function(ce,ie,We){var ae=new J.Metadata(_e.NAME_TAG,V);y.tagParameter(ce,ie,We,ae)}}Q.targetName=oe},86757:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.unmanaged=void 0;var _e=N(6867),J=N(47738),y=N(99934);function oe(){return function(V,ce,ie){var We=new J.Metadata(_e.UNMANAGED_TAG,!0);y.tagParameter(V,ce,ie,We)}}Q.unmanaged=oe},44290:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Binding=void 0;var _e=N(28421),J=N(37791),y=function(){function oe(V,ce){this.id=J.id(),this.activated=!1,this.serviceIdentifier=V,this.scope=ce,this.type=_e.BindingTypeEnum.Invalid,this.constraint=function(ie){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return oe.prototype.clone=function(){var V=new oe(this.serviceIdentifier,this.scope);return V.activated=V.scope===_e.BindingScopeEnum.Singleton?this.activated:!1,V.implementationType=this.implementationType,V.dynamicValue=this.dynamicValue,V.scope=this.scope,V.type=this.type,V.factory=this.factory,V.provider=this.provider,V.constraint=this.constraint,V.onActivation=this.onActivation,V.cache=this.cache,V},oe}();Q.Binding=y},23184:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Q.BindingCount=N},16674:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.STACK_OVERFLOW=Q.CIRCULAR_DEPENDENCY_IN_FACTORY=Q.POST_CONSTRUCT_ERROR=Q.MULTIPLE_POST_CONSTRUCT_METHODS=Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Q.ARGUMENTS_LENGTH_MISMATCH=Q.INVALID_DECORATOR_OPERATION=Q.INVALID_TO_SELF_VALUE=Q.INVALID_FUNCTION_BINDING=Q.INVALID_MIDDLEWARE_RETURN=Q.NO_MORE_SNAPSHOTS_AVAILABLE=Q.INVALID_BINDING_TYPE=Q.NOT_IMPLEMENTED=Q.CIRCULAR_DEPENDENCY=Q.UNDEFINED_INJECT_ANNOTATION=Q.MISSING_INJECT_ANNOTATION=Q.MISSING_INJECTABLE_ANNOTATION=Q.NOT_REGISTERED=Q.CANNOT_UNBIND=Q.AMBIGUOUS_MATCH=Q.KEY_NOT_FOUND=Q.NULL_ARGUMENT=Q.DUPLICATED_METADATA=Q.DUPLICATED_INJECTABLE_DECORATOR=void 0,Q.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Q.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Q.NULL_ARGUMENT="NULL argument",Q.KEY_NOT_FOUND="Key Not Found",Q.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Q.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Q.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Q.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Q.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(oe){return"@inject called with undefined this could mean that the class "+oe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Q.UNDEFINED_INJECT_ANNOTATION=N,Q.CIRCULAR_DEPENDENCY="Circular dependency found:",Q.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Q.INVALID_BINDING_TYPE="Invalid binding type:",Q.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Q.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Q.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Q.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Q.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var _e=function(){for(var oe=[],V=0;V<arguments.length;V++)oe[V]=arguments[V];return"The number of constructor arguments in the derived class "+(oe[0]+" must be >= than the number of constructor arguments of its base class.")};Q.ARGUMENTS_LENGTH_MISMATCH=_e,Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Q.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var J=function(){for(var oe=[],V=0;V<arguments.length;V++)oe[V]=arguments[V];return"@postConstruct error in class "+oe[0]+": "+oe[1]};Q.POST_CONSTRUCT_ERROR=J;var y=function(){for(var oe=[],V=0;V<arguments.length;V++)oe[V]=arguments[V];return"It looks like there is a circular dependency "+("in one of the '"+oe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+oe[1]+"'.")};Q.CIRCULAR_DEPENDENCY_IN_FACTORY=y,Q.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.TargetTypeEnum=Q.BindingTypeEnum=Q.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Q.BindingScopeEnum=N;var _e={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Q.BindingTypeEnum=_e;var J={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Q.TargetTypeEnum=J},6867:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NON_CUSTOM_TAG_KEYS=Q.POST_CONSTRUCT=Q.DESIGN_PARAM_TYPES=Q.PARAM_TYPES=Q.TAGGED_PROP=Q.TAGGED=Q.MULTI_INJECT_TAG=Q.INJECT_TAG=Q.OPTIONAL_TAG=Q.UNMANAGED_TAG=Q.NAME_TAG=Q.NAMED_TAG=void 0,Q.NAMED_TAG="named",Q.NAME_TAG="name",Q.UNMANAGED_TAG="unmanaged",Q.OPTIONAL_TAG="optional",Q.INJECT_TAG="inject",Q.MULTI_INJECT_TAG="multi_inject",Q.TAGGED="inversify:tagged",Q.TAGGED_PROP="inversify:tagged_props",Q.PARAM_TYPES="inversify:paramtypes",Q.DESIGN_PARAM_TYPES="design:paramtypes",Q.POST_CONSTRUCT="post_construct";function N(){return[Q.INJECT_TAG,Q.MULTI_INJECT_TAG,Q.NAME_TAG,Q.UNMANAGED_TAG,Q.NAMED_TAG,Q.OPTIONAL_TAG]}Q.NON_CUSTOM_TAG_KEYS=N()},51389:function(Sr,Q,N){"use strict";var _e=this&&this.__awaiter||function(rr,At,gt,Br){function dr(lr){return lr instanceof gt?lr:new gt(function(_t){_t(lr)})}return new(gt||(gt=Promise))(function(lr,_t){function at(Kt){try{ft(Br.next(Kt))}catch(xr){_t(xr)}}function Ot(Kt){try{ft(Br.throw(Kt))}catch(xr){_t(xr)}}function ft(Kt){Kt.done?lr(Kt.value):dr(Kt.value).then(at,Ot)}ft((Br=Br.apply(rr,At||[])).next())})},J=this&&this.__generator||function(rr,At){var gt={label:0,sent:function(){if(lr[0]&1)throw lr[1];return lr[1]},trys:[],ops:[]},Br,dr,lr,_t;return _t={next:at(0),throw:at(1),return:at(2)},typeof Symbol=="function"&&(_t[Symbol.iterator]=function(){return this}),_t;function at(ft){return function(Kt){return Ot([ft,Kt])}}function Ot(ft){if(Br)throw new TypeError("Generator is already executing.");for(;gt;)try{if(Br=1,dr&&(lr=ft[0]&2?dr.return:ft[0]?dr.throw||((lr=dr.return)&&lr.call(dr),0):dr.next)&&!(lr=lr.call(dr,ft[1])).done)return lr;switch(dr=0,lr&&(ft=[ft[0]&2,lr.value]),ft[0]){case 0:case 1:lr=ft;break;case 4:return gt.label++,{value:ft[1],done:!1};case 5:gt.label++,dr=ft[1],ft=[0];continue;case 7:ft=gt.ops.pop(),gt.trys.pop();continue;default:if(lr=gt.trys,!(lr=lr.length>0&&lr[lr.length-1])&&(ft[0]===6||ft[0]===2)){gt=0;continue}if(ft[0]===3&&(!lr||ft[1]>lr[0]&&ft[1]<lr[3])){gt.label=ft[1];break}if(ft[0]===6&&gt.label<lr[1]){gt.label=lr[1],lr=ft;break}if(lr&&gt.label<lr[2]){gt.label=lr[2],gt.ops.push(ft);break}lr[2]&&gt.ops.pop(),gt.trys.pop();continue}ft=At.call(rr,gt)}catch(Kt){ft=[6,Kt],dr=0}finally{Br=lr=0}if(ft[0]&5)throw ft[1];return{value:ft[0]?ft[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(rr,At){for(var gt=0,Br=At.length,dr=rr.length;gt<Br;gt++,dr++)rr[dr]=At[gt];return rr};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Container=void 0;var oe=N(44290),V=N(16674),ce=N(28421),ie=N(6867),We=N(51377),ae=N(86311),He=N(31927),nt=N(15451),ct=N(37791),It=N(55800),tr=N(85700),qt=N(80175),ir=function(){function rr(At){this._appliedMiddleware=[];var gt=At||{};if(typeof gt!="object")throw new Error(""+V.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(gt.defaultScope===void 0)gt.defaultScope=ce.BindingScopeEnum.Transient;else if(gt.defaultScope!==ce.BindingScopeEnum.Singleton&&gt.defaultScope!==ce.BindingScopeEnum.Transient&&gt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+V.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(gt.autoBindInjectable===void 0)gt.autoBindInjectable=!1;else if(typeof gt.autoBindInjectable!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(gt.skipBaseClassChecks===void 0)gt.skipBaseClassChecks=!1;else if(typeof gt.skipBaseClassChecks!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:gt.autoBindInjectable,defaultScope:gt.defaultScope,skipBaseClassChecks:gt.skipBaseClassChecks},this.id=ct.id(),this._bindingDictionary=new qt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new We.MetadataReader}return rr.merge=function(At,gt){for(var Br=[],dr=2;dr<arguments.length;dr++)Br[dr-2]=arguments[dr];var lr=new rr,_t=y([At,gt],Br).map(function(ft){return ae.getBindingDictionary(ft)}),at=ae.getBindingDictionary(lr);function Ot(ft,Kt){ft.traverse(function(xr,Y){Y.forEach(function(Le){Kt.add(Le.serviceIdentifier,Le.clone())})})}return _t.forEach(function(ft){Ot(ft,at)}),lr},rr.prototype.load=function(){for(var At=[],gt=0;gt<arguments.length;gt++)At[gt]=arguments[gt];for(var Br=this._getContainerModuleHelpersFactory(),dr=0,lr=At;dr<lr.length;dr++){var _t=lr[dr],at=Br(_t.id);_t.registry(at.bindFunction,at.unbindFunction,at.isboundFunction,at.rebindFunction)}},rr.prototype.loadAsync=function(){for(var At=[],gt=0;gt<arguments.length;gt++)At[gt]=arguments[gt];return _e(this,void 0,void 0,function(){var Br,dr,lr,_t,at;return J(this,function(Ot){switch(Ot.label){case 0:Br=this._getContainerModuleHelpersFactory(),dr=0,lr=At,Ot.label=1;case 1:return dr<lr.length?(_t=lr[dr],at=Br(_t.id),[4,_t.registry(at.bindFunction,at.unbindFunction,at.isboundFunction,at.rebindFunction)]):[3,4];case 2:Ot.sent(),Ot.label=3;case 3:return dr++,[3,1];case 4:return[2]}})})},rr.prototype.unload=function(){for(var At=this,gt=[],Br=0;Br<arguments.length;Br++)gt[Br]=arguments[Br];var dr=function(lr){return function(_t){return _t.moduleId===lr}};gt.forEach(function(lr){var _t=dr(lr.id);At._bindingDictionary.removeByCondition(_t)})},rr.prototype.bind=function(At){var gt=this.options.defaultScope||ce.BindingScopeEnum.Transient,Br=new oe.Binding(At,gt);return this._bindingDictionary.add(At,Br),new nt.BindingToSyntax(Br)},rr.prototype.rebind=function(At){return this.unbind(At),this.bind(At)},rr.prototype.unbind=function(At){try{this._bindingDictionary.remove(At)}catch(gt){throw new Error(V.CANNOT_UNBIND+" "+It.getServiceIdentifierAsString(At))}},rr.prototype.unbindAll=function(){this._bindingDictionary=new qt.Lookup},rr.prototype.isBound=function(At){var gt=this._bindingDictionary.hasKey(At);return!gt&&this.parent&&(gt=this.parent.isBound(At)),gt},rr.prototype.isBoundNamed=function(At,gt){return this.isBoundTagged(At,ie.NAMED_TAG,gt)},rr.prototype.isBoundTagged=function(At,gt,Br){var dr=!1;if(this._bindingDictionary.hasKey(At)){var lr=this._bindingDictionary.get(At),_t=ae.createMockRequest(this,At,gt,Br);dr=lr.some(function(at){return at.constraint(_t)})}return!dr&&this.parent&&(dr=this.parent.isBoundTagged(At,gt,Br)),dr},rr.prototype.snapshot=function(){this._snapshots.push(tr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},rr.prototype.restore=function(){var At=this._snapshots.pop();if(At===void 0)throw new Error(V.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=At.bindings,this._middleware=At.middleware},rr.prototype.createChild=function(At){var gt=new rr(At||this.options);return gt.parent=this,gt},rr.prototype.applyMiddleware=function(){for(var At=[],gt=0;gt<arguments.length;gt++)At[gt]=arguments[gt];this._appliedMiddleware=this._appliedMiddleware.concat(At);var Br=this._middleware?this._middleware:this._planAndResolve();this._middleware=At.reduce(function(dr,lr){return lr(dr)},Br)},rr.prototype.applyCustomMetadataReader=function(At){this._metadataReader=At},rr.prototype.get=function(At){return this._get(!1,!1,ce.TargetTypeEnum.Variable,At)},rr.prototype.getTagged=function(At,gt,Br){return this._get(!1,!1,ce.TargetTypeEnum.Variable,At,gt,Br)},rr.prototype.getNamed=function(At,gt){return this.getTagged(At,ie.NAMED_TAG,gt)},rr.prototype.getAll=function(At){return this._get(!0,!0,ce.TargetTypeEnum.Variable,At)},rr.prototype.getAllTagged=function(At,gt,Br){return this._get(!1,!0,ce.TargetTypeEnum.Variable,At,gt,Br)},rr.prototype.getAllNamed=function(At,gt){return this.getAllTagged(At,ie.NAMED_TAG,gt)},rr.prototype.resolve=function(At){var gt=this.createChild();return gt.bind(At).toSelf(),this._appliedMiddleware.forEach(function(Br){gt.applyMiddleware(Br)}),gt.get(At)},rr.prototype._getContainerModuleHelpersFactory=function(){var At=this,gt=function(at,Ot){at._binding.moduleId=Ot},Br=function(at){return function(Ot){var ft=At.bind.bind(At),Kt=ft(Ot);return gt(Kt,at),Kt}},dr=function(at){return function(Ot){var ft=At.unbind.bind(At);ft(Ot)}},lr=function(at){return function(Ot){var ft=At.isBound.bind(At);return ft(Ot)}},_t=function(at){return function(Ot){var ft=At.rebind.bind(At),Kt=ft(Ot);return gt(Kt,at),Kt}};return function(at){return{bindFunction:Br(at),isboundFunction:lr(at),rebindFunction:_t(at),unbindFunction:dr(at)}}},rr.prototype._get=function(At,gt,Br,dr,lr,_t){var at=null,Ot={avoidConstraints:At,contextInterceptor:function(ft){return ft},isMultiInject:gt,key:lr,serviceIdentifier:dr,targetType:Br,value:_t};if(this._middleware){if(at=this._middleware(Ot),at==null)throw new Error(V.INVALID_MIDDLEWARE_RETURN)}else at=this._planAndResolve()(Ot);return at},rr.prototype._planAndResolve=function(){var At=this;return function(gt){var Br=ae.plan(At._metadataReader,At,gt.isMultiInject,gt.targetType,gt.serviceIdentifier,gt.key,gt.value,gt.avoidConstraints);Br=gt.contextInterceptor(Br);var dr=He.resolve(Br);return dr}},rr}();Q.Container=ir},33244:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.AsyncContainerModule=Q.ContainerModule=void 0;var _e=N(37791),J=function(){function oe(V){this.id=_e.id(),this.registry=V}return oe}();Q.ContainerModule=J;var y=function(){function oe(V){this.id=_e.id(),this.registry=V}return oe}();Q.AsyncContainerModule=y},85700:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ContainerSnapshot=void 0;var N=function(){function _e(){}return _e.of=function(J,y){var oe=new _e;return oe.bindings=J,oe.middleware=y,oe},_e}();Q.ContainerSnapshot=N},80175:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Lookup=void 0;var _e=N(16674),J=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(oe,V){if(oe==null)throw new Error(_e.NULL_ARGUMENT);if(V==null)throw new Error(_e.NULL_ARGUMENT);var ce=this._map.get(oe);ce!==void 0?(ce.push(V),this._map.set(oe,ce)):this._map.set(oe,[V])},y.prototype.get=function(oe){if(oe==null)throw new Error(_e.NULL_ARGUMENT);var V=this._map.get(oe);if(V!==void 0)return V;throw new Error(_e.KEY_NOT_FOUND)},y.prototype.remove=function(oe){if(oe==null)throw new Error(_e.NULL_ARGUMENT);if(!this._map.delete(oe))throw new Error(_e.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(oe){var V=this;this._map.forEach(function(ce,ie){var We=ce.filter(function(ae){return!oe(ae)});We.length>0?V._map.set(ie,We):V._map.delete(ie)})},y.prototype.hasKey=function(oe){if(oe==null)throw new Error(_e.NULL_ARGUMENT);return this._map.has(oe)},y.prototype.clone=function(){var oe=new y;return this._map.forEach(function(V,ce){V.forEach(function(ie){return oe.add(ce,ie.clone())})}),oe},y.prototype.traverse=function(oe){this._map.forEach(function(V,ce){oe(ce,V)})},y}();Q.Lookup=J},86700:function(Sr,Q,N){"use strict";var _e;_e={value:!0},_e=_e=_e=_e=_e=_e=Q.GW=_e=_e=Q.zY=_e=_e=_e=_e=_e=Q.f3=_e=_e=Q.b2=_e=_e=_e=_e=_e=Q.W2=_e=void 0;var J=N(6867);_e=J;var y=N(51389);Object.defineProperty(Q,"W2",{enumerable:!0,get:function(){return y.Container}});var oe=N(28421);_e={enumerable:!0,get:function(){return oe.BindingScopeEnum}},_e={enumerable:!0,get:function(){return oe.BindingTypeEnum}},_e={enumerable:!0,get:function(){return oe.TargetTypeEnum}};var V=N(33244);_e={enumerable:!0,get:function(){return V.AsyncContainerModule}},_e={enumerable:!0,get:function(){return V.ContainerModule}};var ce=N(64315);Object.defineProperty(Q,"b2",{enumerable:!0,get:function(){return ce.injectable}});var ie=N(32052);_e={enumerable:!0,get:function(){return ie.tagged}};var We=N(38085);_e={enumerable:!0,get:function(){return We.named}};var ae=N(5744);Object.defineProperty(Q,"f3",{enumerable:!0,get:function(){return ae.inject}}),_e={enumerable:!0,get:function(){return ae.LazyServiceIdentifer}};var He=N(6515);_e={enumerable:!0,get:function(){return He.optional}};var nt=N(86757);_e={enumerable:!0,get:function(){return nt.unmanaged}};var ct=N(71693);_e={enumerable:!0,get:function(){return ct.multiInject}};var It=N(55638);_e={enumerable:!0,get:function(){return It.targetName}};var tr=N(7014);Object.defineProperty(Q,"zY",{enumerable:!0,get:function(){return tr.postConstruct}});var qt=N(51377);_e={enumerable:!0,get:function(){return qt.MetadataReader}};var ir=N(37791);_e={enumerable:!0,get:function(){return ir.id}};var rr=N(99934);Object.defineProperty(Q,"GW",{enumerable:!0,get:function(){return rr.decorate}});var At=N(80758);_e={enumerable:!0,get:function(){return At.traverseAncerstors}},_e={enumerable:!0,get:function(){return At.taggedConstraint}},_e={enumerable:!0,get:function(){return At.namedConstraint}},_e={enumerable:!0,get:function(){return At.typeConstraint}};var gt=N(55800);_e={enumerable:!0,get:function(){return gt.getServiceIdentifierAsString}};var Br=N(70600);_e={enumerable:!0,get:function(){return Br.multiBindToService}}},95228:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Context=void 0;var _e=N(37791),J=function(){function y(oe){this.id=_e.id(),this.container=oe}return y.prototype.addPlan=function(oe){this.plan=oe},y.prototype.setCurrentRequest=function(oe){this.currentRequest=oe},y}();Q.Context=J},47738:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Metadata=void 0;var _e=N(6867),J=function(){function y(oe,V){this.key=oe,this.value=V}return y.prototype.toString=function(){return this.key===_e.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();Q.Metadata=J},51377:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.MetadataReader=void 0;var _e=N(6867),J=function(){function y(){}return y.prototype.getConstructorMetadata=function(oe){var V=Reflect.getMetadata(_e.PARAM_TYPES,oe),ce=Reflect.getMetadata(_e.TAGGED,oe);return{compilerGeneratedMetadata:V,userGeneratedMetadata:ce||{}}},y.prototype.getPropertiesMetadata=function(oe){var V=Reflect.getMetadata(_e.TAGGED_PROP,oe)||[];return V},y}();Q.MetadataReader=J},55314:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Plan=void 0;var N=function(){function _e(J,y){this.parentContext=J,this.rootRequest=y}return _e}();Q.Plan=N},86311:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getBindingDictionary=Q.createMockRequest=Q.plan=void 0;var _e=N(23184),J=N(16674),y=N(28421),oe=N(6867),V=N(85265),ce=N(55800),ie=N(95228),We=N(47738),ae=N(55314),He=N(6e3),nt=N(6748),ct=N(18924);function It(dr){return dr._bindingDictionary}Q.getBindingDictionary=It;function tr(dr,lr,_t,at,Ot,ft){var Kt=dr?oe.MULTI_INJECT_TAG:oe.INJECT_TAG,xr=new We.Metadata(Kt,_t),Y=new ct.Target(lr,at,_t,xr);if(Ot!==void 0){var Le=new We.Metadata(Ot,ft);Y.metadata.push(Le)}return Y}function qt(dr,lr,_t,at,Ot){var ft=At(_t.container,Ot.serviceIdentifier),Kt=[];return ft.length===_e.BindingCount.NoBindingsAvailable&&_t.container.options.autoBindInjectable&&typeof Ot.serviceIdentifier=="function"&&dr.getConstructorMetadata(Ot.serviceIdentifier).compilerGeneratedMetadata&&(_t.container.bind(Ot.serviceIdentifier).toSelf(),ft=At(_t.container,Ot.serviceIdentifier)),lr?Kt=ft:Kt=ft.filter(function(xr){var Y=new nt.Request(xr.serviceIdentifier,_t,at,xr,Ot);return xr.constraint(Y)}),ir(Ot.serviceIdentifier,Kt,Ot,_t.container),Kt}function ir(dr,lr,_t,at){switch(lr.length){case _e.BindingCount.NoBindingsAvailable:if(_t.isOptional())return lr;var Ot=ce.getServiceIdentifierAsString(dr),ft=J.NOT_REGISTERED;throw ft+=ce.listMetadataForTarget(Ot,_t),ft+=ce.listRegisteredBindingsForServiceIdentifier(at,Ot,At),new Error(ft);case _e.BindingCount.OnlyOneBindingAvailable:if(!_t.isArray())return lr;case _e.BindingCount.MultipleBindingsAvailable:default:if(_t.isArray())return lr;var Ot=ce.getServiceIdentifierAsString(dr),ft=J.AMBIGUOUS_MATCH+" "+Ot;throw ft+=ce.listRegisteredBindingsForServiceIdentifier(at,Ot,At),new Error(ft)}}function rr(dr,lr,_t,at,Ot,ft){var Kt,xr;if(Ot===null){Kt=qt(dr,lr,at,null,ft),xr=new nt.Request(_t,at,null,Kt,ft);var Y=new ae.Plan(at,xr);at.addPlan(Y)}else Kt=qt(dr,lr,at,Ot,ft),xr=Ot.addChildRequest(ft.serviceIdentifier,Kt,ft);Kt.forEach(function(Le){var O=null;if(ft.isArray())O=xr.addChildRequest(Le.serviceIdentifier,Le,ft);else{if(Le.cache)return;O=xr}if(Le.type===y.BindingTypeEnum.Instance&&Le.implementationType!==null){var Me=He.getDependencies(dr,Le.implementationType);if(!at.container.options.skipBaseClassChecks){var we=He.getBaseClassDependencyCount(dr,Le.implementationType);if(Me.length<we){var ut=J.ARGUMENTS_LENGTH_MISMATCH(He.getFunctionName(Le.implementationType));throw new Error(ut)}}Me.forEach(function(yt){rr(dr,!1,yt.serviceIdentifier,at,O,yt)})}})}function At(dr,lr){var _t=[],at=It(dr);return at.hasKey(lr)?_t=at.get(lr):dr.parent!==null&&(_t=At(dr.parent,lr)),_t}function gt(dr,lr,_t,at,Ot,ft,Kt,xr){xr===void 0&&(xr=!1);var Y=new ie.Context(lr),Le=tr(_t,at,Ot,"",ft,Kt);try{return rr(dr,xr,Ot,Y,null,Le),Y}catch(O){throw V.isStackOverflowExeption(O)&&Y.plan&&ce.circularDependencyToException(Y.plan.rootRequest),O}}Q.plan=gt;function Br(dr,lr,_t,at){var Ot=new ct.Target(y.TargetTypeEnum.Variable,"",lr,new We.Metadata(_t,at)),ft=new ie.Context(dr),Kt=new nt.Request(lr,ft,null,[],Ot);return Kt}Q.createMockRequest=Br},88460:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.QueryableString=void 0;var N=function(){function _e(J){this.str=J}return _e.prototype.startsWith=function(J){return this.str.indexOf(J)===0},_e.prototype.endsWith=function(J){var y="",oe=J.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},oe)},_e.prototype.contains=function(J){return this.str.indexOf(J)!==-1},_e.prototype.equals=function(J){return this.str===J},_e.prototype.value=function(){return this.str},_e}();Q.QueryableString=N},6e3:function(Sr,Q,N){"use strict";var _e=this&&this.__spreadArray||function(qt,ir){for(var rr=0,At=ir.length,gt=qt.length;rr<At;rr++,gt++)qt[gt]=ir[rr];return qt};Object.defineProperty(Q,"__esModule",{value:!0}),Q.getFunctionName=Q.getBaseClassDependencyCount=Q.getDependencies=void 0;var J=N(5744),y=N(16674),oe=N(28421),V=N(6867),ce=N(55800);Object.defineProperty(Q,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var ie=N(18924);function We(qt,ir){var rr=ce.getFunctionName(ir),At=ae(qt,rr,ir,!1);return At}Q.getDependencies=We;function ae(qt,ir,rr,At){var gt=qt.getConstructorMetadata(rr),Br=gt.compilerGeneratedMetadata;if(Br===void 0){var dr=y.MISSING_INJECTABLE_ANNOTATION+" "+ir+".";throw new Error(dr)}var lr=gt.userGeneratedMetadata,_t=Object.keys(lr),at=rr.length===0&&_t.length>0,Ot=_t.length>rr.length,ft=at||Ot?_t.length:rr.length,Kt=nt(At,ir,Br,lr,ft),xr=ct(qt,rr),Y=_e(_e([],Kt),xr);return Y}function He(qt,ir,rr,At,gt){var Br=gt[qt.toString()]||[],dr=tr(Br),lr=dr.unmanaged!==!0,_t=At[qt],at=dr.inject||dr.multiInject;if(_t=at||_t,_t instanceof J.LazyServiceIdentifer&&(_t=_t.unwrap()),lr){var Ot=_t===Object,ft=_t===Function,Kt=_t===void 0,xr=Ot||ft||Kt;if(!ir&&xr){var Y=y.MISSING_INJECT_ANNOTATION+" argument "+qt+" in class "+rr+".";throw new Error(Y)}var Le=new ie.Target(oe.TargetTypeEnum.ConstructorArgument,dr.targetName,_t);return Le.metadata=Br,Le}return null}function nt(qt,ir,rr,At,gt){for(var Br=[],dr=0;dr<gt;dr++){var lr=dr,_t=He(lr,qt,ir,rr,At);_t!==null&&Br.push(_t)}return Br}function ct(qt,ir){for(var rr=qt.getPropertiesMetadata(ir),At=[],gt=Object.keys(rr),Br=0,dr=gt;Br<dr.length;Br++){var lr=dr[Br],_t=rr[lr],at=tr(rr[lr]),Ot=at.targetName||lr,ft=at.inject||at.multiInject,Kt=new ie.Target(oe.TargetTypeEnum.ClassProperty,Ot,ft);Kt.metadata=_t,At.push(Kt)}var xr=Object.getPrototypeOf(ir.prototype).constructor;if(xr!==Object){var Y=ct(qt,xr);At=_e(_e([],At),Y)}return At}function It(qt,ir){var rr=Object.getPrototypeOf(ir.prototype).constructor;if(rr!==Object){var At=ce.getFunctionName(rr),gt=ae(qt,At,rr,!0),Br=gt.map(function(_t){return _t.metadata.filter(function(at){return at.key===V.UNMANAGED_TAG})}),dr=[].concat.apply([],Br).length,lr=gt.length-dr;return lr>0?lr:It(qt,rr)}else return 0}Q.getBaseClassDependencyCount=It;function tr(qt){var ir={};return qt.forEach(function(rr){ir[rr.key.toString()]=rr.value}),{inject:ir[V.INJECT_TAG],multiInject:ir[V.MULTI_INJECT_TAG],targetName:ir[V.NAME_TAG],unmanaged:ir[V.UNMANAGED_TAG]}}},6748:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Request=void 0;var _e=N(37791),J=function(){function y(oe,V,ce,ie,We){this.id=_e.id(),this.serviceIdentifier=oe,this.parentContext=V,this.parentRequest=ce,this.target=We,this.childRequests=[],this.bindings=Array.isArray(ie)?ie:[ie],this.requestScope=ce===null?new Map:null}return y.prototype.addChildRequest=function(oe,V,ce){var ie=new y(oe,this.parentContext,this,V,ce);return this.childRequests.push(ie),ie},y}();Q.Request=J},18924:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Target=void 0;var _e=N(6867),J=N(37791),y=N(47738),oe=N(88460),V=function(){function ce(ie,We,ae,He){this.id=J.id(),this.type=ie,this.serviceIdentifier=ae,this.name=new oe.QueryableString(We||""),this.metadata=new Array;var nt=null;typeof He=="string"?nt=new y.Metadata(_e.NAMED_TAG,He):He instanceof y.Metadata&&(nt=He),nt!==null&&this.metadata.push(nt)}return ce.prototype.hasTag=function(ie){for(var We=0,ae=this.metadata;We<ae.length;We++){var He=ae[We];if(He.key===ie)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(_e.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(ie){return this.matchesTag(_e.MULTI_INJECT_TAG)(ie)},ce.prototype.isNamed=function(){return this.hasTag(_e.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(ie){return _e.NON_CUSTOM_TAG_KEYS.every(function(We){return ie.key!==We})})},ce.prototype.isOptional=function(){return this.matchesTag(_e.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ie){return ie.key===_e.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ie){return _e.NON_CUSTOM_TAG_KEYS.every(function(We){return ie.key!==We})}):null},ce.prototype.matchesNamedTag=function(ie){return this.matchesTag(_e.NAMED_TAG)(ie)},ce.prototype.matchesTag=function(ie){var We=this;return function(ae){for(var He=0,nt=We.metadata;He<nt.length;He++){var ct=nt[He];if(ct.key===ie&&ct.value===ae)return!0}return!1}},ce}();Q.Target=V},52279:function(Sr,Q,N){"use strict";var _e=this&&this.__spreadArray||function(ae,He){for(var nt=0,ct=He.length,It=ae.length;nt<ct;nt++,It++)ae[It]=He[nt];return ae};Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolveInstance=void 0;var J=N(16674),y=N(28421),oe=N(6867);function V(ae,He,nt){var ct=He.filter(function(tr){return tr.target!==null&&tr.target.type===y.TargetTypeEnum.ClassProperty}),It=ct.map(nt);return ct.forEach(function(tr,qt){var ir="";ir=tr.target.name.value();var rr=It[qt];ae[ir]=rr}),ae}function ce(ae,He){return new(ae.bind.apply(ae,_e([void 0],He)))}function ie(ae,He){if(Reflect.hasMetadata(oe.POST_CONSTRUCT,ae)){var nt=Reflect.getMetadata(oe.POST_CONSTRUCT,ae);try{He[nt.value]()}catch(ct){throw new Error(J.POST_CONSTRUCT_ERROR(ae.name,ct.message))}}}function We(ae,He,nt){var ct=null;if(He.length>0){var It=He.filter(function(qt){return qt.target!==null&&qt.target.type===y.TargetTypeEnum.ConstructorArgument}),tr=It.map(nt);ct=ce(ae,tr),ct=V(ct,He,nt)}else ct=new ae;return ie(ae,ct),ct}Q.resolveInstance=We},31927:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolve=void 0;var _e=N(16674),J=N(28421),y=N(85265),oe=N(55800),V=N(52279),ce=function(ae,He,nt){try{return nt()}catch(ct){throw y.isStackOverflowExeption(ct)?new Error(_e.CIRCULAR_DEPENDENCY_IN_FACTORY(ae,He.toString())):ct}},ie=function(ae){return function(He){He.parentContext.setCurrentRequest(He);var nt=He.bindings,ct=He.childRequests,It=He.target&&He.target.isArray(),tr=!He.parentRequest||!He.parentRequest.target||!He.target||!He.parentRequest.target.matchesArray(He.target.serviceIdentifier);if(It&&tr)return ct.map(function(Br){var dr=ie(ae);return dr(Br)});var qt=null;if(He.target.isOptional()&&nt.length===0)return;var ir=nt[0],rr=ir.scope===J.BindingScopeEnum.Singleton,At=ir.scope===J.BindingScopeEnum.Request;if(rr&&ir.activated)return ir.cache;if(At&&ae!==null&&ae.has(ir.id))return ae.get(ir.id);if(ir.type===J.BindingTypeEnum.ConstantValue)qt=ir.cache,ir.activated=!0;else if(ir.type===J.BindingTypeEnum.Function)qt=ir.cache,ir.activated=!0;else if(ir.type===J.BindingTypeEnum.Constructor)qt=ir.implementationType;else if(ir.type===J.BindingTypeEnum.DynamicValue&&ir.dynamicValue!==null)qt=ce("toDynamicValue",ir.serviceIdentifier,function(){return ir.dynamicValue(He.parentContext)});else if(ir.type===J.BindingTypeEnum.Factory&&ir.factory!==null)qt=ce("toFactory",ir.serviceIdentifier,function(){return ir.factory(He.parentContext)});else if(ir.type===J.BindingTypeEnum.Provider&&ir.provider!==null)qt=ce("toProvider",ir.serviceIdentifier,function(){return ir.provider(He.parentContext)});else if(ir.type===J.BindingTypeEnum.Instance&&ir.implementationType!==null)qt=V.resolveInstance(ir.implementationType,ct,ie(ae));else{var gt=oe.getServiceIdentifierAsString(He.serviceIdentifier);throw new Error(_e.INVALID_BINDING_TYPE+" "+gt)}return typeof ir.onActivation=="function"&&(qt=ir.onActivation(He.parentContext,qt)),rr&&(ir.cache=qt,ir.activated=!0),At&&ae!==null&&!ae.has(ir.id)&&ae.set(ir.id,qt),qt}};function We(ae){var He=ie(ae.plan.rootRequest.requestScope);return He(ae.plan.rootRequest)}Q.resolve=We},83366:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInSyntax=void 0;var _e=N(28421),J=N(71325),y=function(){function oe(V){this._binding=V}return oe.prototype.inRequestScope=function(){return this._binding.scope=_e.BindingScopeEnum.Request,new J.BindingWhenOnSyntax(this._binding)},oe.prototype.inSingletonScope=function(){return this._binding.scope=_e.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},oe.prototype.inTransientScope=function(){return this._binding.scope=_e.BindingScopeEnum.Transient,new J.BindingWhenOnSyntax(this._binding)},oe}();Q.BindingInSyntax=y},74889:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInWhenOnSyntax=void 0;var _e=N(83366),J=N(51811),y=N(98370),oe=function(){function V(ce){this._binding=ce,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding),this._bindingInSyntax=new _e.BindingInSyntax(ce)}return V.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},V.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},V.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},V.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},V.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},V.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},V.prototype.whenTargetTagged=function(ce,ie){return this._bindingWhenSyntax.whenTargetTagged(ce,ie)},V.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},V.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},V.prototype.whenParentTagged=function(ce,ie){return this._bindingWhenSyntax.whenParentTagged(ce,ie)},V.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},V.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},V.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},V.prototype.whenAnyAncestorTagged=function(ce,ie){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,ie)},V.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},V.prototype.whenNoAncestorTagged=function(ce,ie){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,ie)},V.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},V.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},V.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},V}();Q.BindingInWhenOnSyntax=oe},51811:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingOnSyntax=void 0;var _e=N(98370),J=function(){function y(oe){this._binding=oe}return y.prototype.onActivation=function(oe){return this._binding.onActivation=oe,new _e.BindingWhenSyntax(this._binding)},y}();Q.BindingOnSyntax=J},15451:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingToSyntax=void 0;var _e=N(16674),J=N(28421),y=N(74889),oe=N(71325),V=function(){function ce(ie){this._binding=ie}return ce.prototype.to=function(ie){return this._binding.type=J.BindingTypeEnum.Instance,this._binding.implementationType=ie,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+_e.INVALID_TO_SELF_VALUE);var ie=this._binding.serviceIdentifier;return this.to(ie)},ce.prototype.toConstantValue=function(ie){return this._binding.type=J.BindingTypeEnum.ConstantValue,this._binding.cache=ie,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=J.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(ie){return this._binding.type=J.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ie,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(ie){return this._binding.type=J.BindingTypeEnum.Constructor,this._binding.implementationType=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(ie){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(ie){if(typeof ie!="function")throw new Error(_e.INVALID_FUNCTION_BINDING);var We=this.toConstantValue(ie);return this._binding.type=J.BindingTypeEnum.Function,this._binding.scope=J.BindingScopeEnum.Singleton,We},ce.prototype.toAutoFactory=function(ie){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=function(We){var ae=function(){return We.container.get(ie)};return ae},this._binding.scope=J.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(ie){return this._binding.type=J.BindingTypeEnum.Provider,this._binding.provider=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(ie){this.toDynamicValue(function(We){return We.container.get(ie)})},ce}();Q.BindingToSyntax=V},71325:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenOnSyntax=void 0;var _e=N(51811),J=N(98370),y=function(){function oe(V){this._binding=V,this._bindingWhenSyntax=new J.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new _e.BindingOnSyntax(this._binding)}return oe.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},oe.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},oe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},oe.prototype.whenTargetTagged=function(V,ce){return this._bindingWhenSyntax.whenTargetTagged(V,ce)},oe.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},oe.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},oe.prototype.whenParentTagged=function(V,ce){return this._bindingWhenSyntax.whenParentTagged(V,ce)},oe.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},oe.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},oe.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},oe.prototype.whenAnyAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,ce)},oe.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},oe.prototype.whenNoAncestorTagged=function(V,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(V,ce)},oe.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},oe.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},oe.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},oe}();Q.BindingWhenOnSyntax=y},98370:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenSyntax=void 0;var _e=N(51811),J=N(80758),y=function(){function oe(V){this._binding=V}return oe.prototype.when=function(V){return this._binding.constraint=V,new _e.BindingOnSyntax(this._binding)},oe.prototype.whenTargetNamed=function(V){return this._binding.constraint=J.namedConstraint(V),new _e.BindingOnSyntax(this._binding)},oe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(V){var ce=V.target!==null&&!V.target.isNamed()&&!V.target.isTagged();return ce},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenTargetTagged=function(V,ce){return this._binding.constraint=J.taggedConstraint(V)(ce),new _e.BindingOnSyntax(this._binding)},oe.prototype.whenInjectedInto=function(V){return this._binding.constraint=function(ce){return J.typeConstraint(V)(ce.parentRequest)},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenParentNamed=function(V){return this._binding.constraint=function(ce){return J.namedConstraint(V)(ce.parentRequest)},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenParentTagged=function(V,ce){return this._binding.constraint=function(ie){return J.taggedConstraint(V)(ce)(ie.parentRequest)},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenAnyAncestorIs=function(V){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,J.typeConstraint(V))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenNoAncestorIs=function(V){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,J.typeConstraint(V))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenAnyAncestorNamed=function(V){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,J.namedConstraint(V))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenNoAncestorNamed=function(V){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,J.namedConstraint(V))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenAnyAncestorTagged=function(V,ce){return this._binding.constraint=function(ie){return J.traverseAncerstors(ie,J.taggedConstraint(V)(ce))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenNoAncestorTagged=function(V,ce){return this._binding.constraint=function(ie){return!J.traverseAncerstors(ie,J.taggedConstraint(V)(ce))},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenAnyAncestorMatches=function(V){return this._binding.constraint=function(ce){return J.traverseAncerstors(ce,V)},new _e.BindingOnSyntax(this._binding)},oe.prototype.whenNoAncestorMatches=function(V){return this._binding.constraint=function(ce){return!J.traverseAncerstors(ce,V)},new _e.BindingOnSyntax(this._binding)},oe}();Q.BindingWhenSyntax=y},80758:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.typeConstraint=Q.namedConstraint=Q.taggedConstraint=Q.traverseAncerstors=void 0;var _e=N(6867),J=N(47738),y=function(ie,We){var ae=ie.parentRequest;return ae!==null?We(ae)?!0:y(ae,We):!1};Q.traverseAncerstors=y;var oe=function(ie){return function(We){var ae=function(He){return He!==null&&He.target!==null&&He.target.matchesTag(ie)(We)};return ae.metaData=new J.Metadata(ie,We),ae}};Q.taggedConstraint=oe;var V=oe(_e.NAMED_TAG);Q.namedConstraint=V;var ce=function(ie){return function(We){var ae=null;if(We!==null)if(ae=We.bindings[0],typeof ie=="string"){var He=ae.serviceIdentifier;return He===ie}else{var nt=We.bindings[0].implementationType;return ie===nt}return!1}};Q.typeConstraint=ce},70600:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiBindToService=void 0;var N=function(_e){return function(J){return function(){for(var y=[],oe=0;oe<arguments.length;oe++)y[oe]=arguments[oe];return y.forEach(function(V){return _e.bind(V).toService(J)})}}};Q.multiBindToService=N},85265:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.isStackOverflowExeption=void 0;var _e=N(16674);function J(y){return y instanceof RangeError||y.message===_e.STACK_OVERFLOW}Q.isStackOverflowExeption=J},37791:function(Sr,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.id=void 0;var N=0;function _e(){return N++}Q.id=_e},55800:function(Sr,Q,N){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.circularDependencyToException=Q.listMetadataForTarget=Q.listRegisteredBindingsForServiceIdentifier=Q.getServiceIdentifierAsString=Q.getFunctionName=void 0;var _e=N(16674);function J(ae){if(typeof ae=="function"){var He=ae;return He.name}else{if(typeof ae=="symbol")return ae.toString();var He=ae;return He}}Q.getServiceIdentifierAsString=J;function y(ae,He,nt){var ct="",It=nt(ae,He);return It.length!==0&&(ct=`
Registered bindings:`,It.forEach(function(tr){var qt="Object";tr.implementationType!==null&&(qt=We(tr.implementationType)),ct=ct+`
 `+qt,tr.constraint.metaData&&(ct=ct+" - "+tr.constraint.metaData)})),ct}Q.listRegisteredBindingsForServiceIdentifier=y;function oe(ae,He){return ae.parentRequest===null?!1:ae.parentRequest.serviceIdentifier===He?!0:oe(ae.parentRequest,He)}function V(ae){function He(ct,It){It===void 0&&(It=[]);var tr=J(ct.serviceIdentifier);return It.push(tr),ct.parentRequest!==null?He(ct.parentRequest,It):It}var nt=He(ae);return nt.reverse().join(" --> ")}function ce(ae){ae.childRequests.forEach(function(He){if(oe(He,He.serviceIdentifier)){var nt=V(He);throw new Error(_e.CIRCULAR_DEPENDENCY+" "+nt)}else ce(He)})}Q.circularDependencyToException=ce;function ie(ae,He){if(He.isTagged()||He.isNamed()){var nt="",ct=He.getNamedTag(),It=He.getCustomTags();return ct!==null&&(nt+=ct.toString()+`
`),It!==null&&It.forEach(function(tr){nt+=tr.toString()+`
`})," "+ae+`
 `+ae+" - "+nt}else return" "+ae}Q.listMetadataForTarget=ie;function We(ae){if(ae.name)return ae.name;var He=ae.toString(),nt=He.match(/^function\s*([^\s(]+)/);return nt?nt[1]:"Anonymous function: "+He}Q.getFunctionName=We},29750:function(Sr){function Q(N,_e,J){return N===N&&(J!==void 0&&(N=N<=J?N:J),_e!==void 0&&(N=N>=_e?N:_e)),N}Sr.exports=Q},74221:function(Sr){function Q(N,_e,J,y){for(var oe=J-1,V=N.length;++oe<V;)if(y(N[oe],_e))return oe;return-1}Sr.exports=Q},65464:function(Sr,Q,N){var _e=N(29932),J=N(42118),y=N(74221),oe=N(7518),V=N(278),ce=Array.prototype,ie=ce.splice;function We(ae,He,nt,ct){var It=ct?y:J,tr=-1,qt=He.length,ir=ae;for(ae===He&&(He=V(He)),nt&&(ir=_e(ae,oe(nt)));++tr<qt;)for(var rr=0,At=He[tr],gt=nt?nt(At):At;(rr=It(ir,gt,rr,ct))>-1;)ir!==ae&&ie.call(ir,rr,1),ie.call(ae,rr,1);return ae}Sr.exports=We},18190:function(Sr){var Q=9007199254740991,N=Math.floor;function _e(J,y){var oe="";if(!J||y<1||y>Q)return oe;do y%2&&(oe+=J),y=N(y/2),y&&(J+=J);while(y);return oe}Sr.exports=_e},78302:function(Sr,Q,N){var _e=N(18190),J=N(80531),y=N(40180),oe=N(62689),V=N(88016),ce=N(83140),ie=Math.ceil;function We(ae,He){He=He===void 0?" ":J(He);var nt=He.length;if(nt<2)return nt?_e(He,ae):He;var ct=_e(He,ie(ae/V(He)));return oe(He)?y(ce(ct),0,ae).join(""):ct.slice(0,ae)}Sr.exports=We},74691:function(Sr,Q,N){var _e=N(29750),J=N(14841);function y(oe,V,ce){return ce===void 0&&(ce=V,V=void 0),ce!==void 0&&(ce=J(ce),ce=ce===ce?ce:0),V!==void 0&&(V=J(V),V=V===V?V:0),_e(J(oe),V,ce)}Sr.exports=y},51584:function(Sr,Q,N){var _e=N(44239),J=N(37005),y="[object Boolean]";function oe(V){return V===!0||V===!1||J(V)&&_e(V)==y}Sr.exports=oe},60442:function(Sr,Q,N){var _e=N(90939);function J(y,oe){return _e(y,oe)}Sr.exports=J},14293:function(Sr){function Q(N){return N==null}Sr.exports=Q},81763:function(Sr,Q,N){var _e=N(44239),J=N(37005),y="[object Number]";function oe(V){return typeof V=="number"||J(V)&&_e(V)==y}Sr.exports=oe},30236:function(Sr,Q,N){var _e=N(42980),J=N(21463),y=J(function(oe,V,ce,ie){_e(oe,V,ce,ie)});Sr.exports=y},11726:function(Sr,Q,N){var _e=N(78302),J=N(88016),y=N(40554),oe=N(79833);function V(ce,ie,We){ce=oe(ce),ie=y(ie);var ae=ie?J(ce):0;return ie&&ae<ie?ce+_e(ie-ae,We):ce}Sr.exports=V},32475:function(Sr,Q,N){var _e=N(78302),J=N(88016),y=N(40554),oe=N(79833);function V(ce,ie,We){ce=oe(ce),ie=y(ie);var ae=ie?J(ce):0;return ie&&ae<ie?_e(ie-ae,We)+ce:ce}Sr.exports=V},97019:function(Sr,Q,N){var _e=N(5976),J=N(45604),y=_e(J);Sr.exports=y},45604:function(Sr,Q,N){var _e=N(65464);function J(y,oe){return y&&y.length&&oe&&oe.length?_e(y,oe):y}Sr.exports=J},23493:function(Sr,Q,N){var _e=N(23279),J=N(13218),y="Expected a function";function oe(V,ce,ie){var We=!0,ae=!0;if(typeof V!="function")throw new TypeError(y);return J(ie)&&(We="leading"in ie?!!ie.leading:We,ae="trailing"in ie?!!ie.trailing:ae),_e(V,ce,{leading:We,maxWait:ce,trailing:ae})}Sr.exports=oe},44908:function(Sr,Q,N){var _e=N(45652);function J(y){return y&&y.length?_e(y):[]}Sr.exports=J},6158:function(Sr){(function(Q,N){Sr.exports=N()})(this,function(){"use strict";var Q,N,_e;function J(y,oe){if(!Q)Q=oe;else if(!N)N=oe;else{var V="var sharedChunk = {}; ("+Q+")(sharedChunk); ("+N+")(sharedChunk);",ce={};Q(ce),_e=oe(ce),typeof window!="undefined"&&(_e.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}return J(["exports"],function(y){"use strict";function oe(a,s){return a(s={exports:{}},s.exports),s.exports}var V=ce;function ce(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}ce.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},ce.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},ce.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},ce.prototype.solveCurveX=function(a,s){var c,m,_,b,E;for(s===void 0&&(s=1e-6),_=a,E=0;E<8;E++){if(b=this.sampleCurveX(_)-a,Math.abs(b)<s)return _;var M=this.sampleCurveDerivativeX(_);if(Math.abs(M)<1e-6)break;_-=b/M}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(b=this.sampleCurveX(_),Math.abs(b-a)<s)return _;a>b?c=_:m=_,_=.5*(m-c)+c}return _},ce.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var ie=We;function We(a,s){this.x=a,this.y=s}We.prototype={clone:function(){return new We(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},We.convert=function(a){return a instanceof We?a:Array.isArray(a)?new We(a[0],a[1]):a};var ae=typeof self!="undefined"?self:{},He=Math.pow(2,53)-1;function nt(a,s,c,m){var _=new V(a,s,c,m);return function(b){return _.solve(b)}}var ct=nt(.25,.1,.25,1);function It(a,s,c){return Math.min(c,Math.max(s,a))}function tr(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function qt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}var ir=1;function rr(){return ir++}function At(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function gt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Br(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function dr(a,s){return a.indexOf(s,a.length-s.length)!==-1}function lr(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function _t(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function at(a){return Array.isArray(a)?a.map(at):typeof a=="object"&&a?lr(a,at):a}var Ot={};function ft(a){Ot[a]||(typeof console!="undefined"&&console.warn(a),Ot[a]=!0)}function Kt(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function xr(a){for(var s=0,c=0,m=a.length,_=m-1,b=void 0,E=void 0;c<m;_=c++)s+=((E=a[_]).x-(b=a[c]).x)*(b.y+E.y);return s}function Y(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Le(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,b,E){var M=b||E;return s[_]=!M||M.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var O=null;function Me(a){if(O==null){var s=a.navigator?a.navigator.userAgent:null;O=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return O}function we(a){try{var s=ae[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var ut,yt,xt,jt,nr=ae.performance&&ae.performance.now?ae.performance.now.bind(ae.performance):Date.now.bind(Date),en=ae.requestAnimationFrame||ae.mozRequestAnimationFrame||ae.webkitRequestAnimationFrame||ae.msRequestAnimationFrame,Lr=ae.cancelAnimationFrame||ae.mozCancelAnimationFrame||ae.webkitCancelAnimationFrame||ae.msCancelAnimationFrame,Vn={now:nr,frame:function(a){var s=en(a);return{cancel:function(){return Lr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=ae.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return ut||(ut=ae.document.createElement("a")),ut.href=a,ut.href},hardwareConcurrency:ae.navigator&&ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(yt==null&&(yt=ae.matchMedia("(prefers-reduced-motion: reduce)")),yt.matches)}},rn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Mn={supported:!1,testSupport:function(a){!ii&&jt&&(Yn?yn(a):xt=a)}},ii=!1,Yn=!1;function yn(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,jt),a.isContextLost())return;Mn.supported=!0}catch(c){}a.deleteTexture(s),ii=!0}ae.document&&((jt=ae.document.createElement("img")).onload=function(){xt&&yn(xt),xt=null,Yn=!0},jt.onerror=function(){ii=!0,xt=null},jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ai="01",Pi=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function Mi(a){return a.indexOf("mapbox:")===0}Pi.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ai,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Pi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Pi.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},Pi.prototype.normalizeStyleURL=function(a,s){if(!Mi(a))return a;var c=Xi(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Pi.prototype.normalizeGlyphsURL=function(a,s){if(!Mi(a))return a;var c=Xi(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Pi.prototype.normalizeSourceURL=function(a,s){if(!Mi(a))return a;var c=Xi(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},Pi.prototype.normalizeSpriteURL=function(a,s,c,m){var _=Xi(a);return Mi(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,Ya(_))},Pi.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Mi(a))return a;var c=Xi(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vn.devicePixelRatio>=2||s===512?"@2x":"")+(Mn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var b=0,E=_;b<E.length;b+=1){var M=E[b].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(c.params)||rn.ACCESS_TOKEN;return rn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Pi.prototype.canonicalizeTileURL=function(a,s){var c=Xi(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(b){return!b.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},Pi.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&Mi(s),m=[],_=0,b=a.tiles||[];_<b.length;_+=1){var E=b[_];Ln(E)?m.push(this.canonicalizeTileURL(E,c)):m.push(E)}return m},Pi.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Xi(rn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!rn.REQUIRE_ACCESS_TOKEN)return Ya(a);if(!(s=s||rn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(b){return b.indexOf("access_token")===-1}),a.params.push("access_token="+s),Ya(a)};var Hn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ln(a){return Hn.test(a)}var vo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xi(a){var s=a.match(vo);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ya(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function Mt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(ae.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var L=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};L.prototype.getStorageKey=function(a){var s,c=Mt(rn.ACCESS_TOKEN);return s=c&&c.u?ae.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):rn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},L.prototype.fetchEventData=function(){var a=we("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=ae.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=ae.localStorage.getItem(c);_&&(this.anonId=_)}catch(b){ft("Unable to read from LocalStorage")}},L.prototype.saveEventData=function(){var a=we("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{ae.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){ft("Unable to write to LocalStorage")}},L.prototype.processRequests=function(a){},L.prototype.postEvent=function(a,s,c,m){var _=this;if(rn.EVENTS_URL){var b=Xi(rn.EVENTS_URL);b.params.push("access_token="+(m||rn.ACCESS_TOKEN||""));var E={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ai,userId:this.anonId},M=s?qt(E,s):E,P={url:Ya(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ki(P,function(z){_.pendingRequest=null,c(z),_.saveEventData(),_.processRequests(m)})}},L.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var re,fe,Ue=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,b){this.skuToken=_;var E=!(!b&&!rn.ACCESS_TOKEN),M=Array.isArray(c)&&c.some(function(P){return Mi(P)||Ln(P)});rn.EVENTS_URL&&E&&M&&this.queueRequest({id:m,timestamp:Date.now()},b)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),b=_.id,E=_.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),gt(this.anonId)||(this.anonId=At()),this.postEvent(E,{skuToken:this.skuToken},function(M){M||b&&(m.success[b]=!0)},c))}},s}(L),ht=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){rn.EVENTS_URL&&rn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return Mi(_)||Ln(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Mt(rn.ACCESS_TOKEN),b=_?_.u:rn.ACCESS_TOKEN,E=b!==this.eventData.tokenU;gt(this.anonId)||(this.anonId=At(),E=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var P=new Date(this.eventData.lastSuccess),z=new Date(M),j=(M-this.eventData.lastSuccess)/864e5;E=E||j>=1||j<-1||P.getDate()!==z.getDate()}else E=!0;if(!E)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(H){H||(m.eventData.lastSuccess=M,m.eventData.tokenU=b)},c)}},s}(L)),Gt=ht.postTurnstileEvent.bind(ht),Ar=new Ue,je=Ar.postMapLoadEvent.bind(Ar),Tt=500,ar=50;function wr(){ae.caches&&!re&&(re=ae.caches.open("mapbox-tiles"))}function $r(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var _n,Cn=1/0;function xn(){return _n==null&&(_n=ae.OffscreenCanvas&&new ae.OffscreenCanvas(1,1).getContext("2d")&&typeof ae.createImageBitmap=="function"),_n}var wn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(wn);var ri=function(a){function s(c,m,_){m===401&&Ln(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Kn=Y()?function(){return self.worker&&self.worker.referrer}:function(){return(ae.location.protocol==="blob:"?ae.parent:ae).location.href},Yi,qi,mo=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(Kn())&&!/^\w+:/.test(c))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(m,_){var b,E=new ae.AbortController,M=new ae.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:Kn(),signal:E.signal}),P=!1,z=!1,j=(b=M.url).indexOf("sku=")>0&&Ln(b);m.type==="json"&&M.headers.set("Accept","application/json");var H=function(se,Re,Be){if(!z){if(se&&se.message!=="SecurityError"&&ft(se),Re&&Be)return ee(Re);var tt=Date.now();ae.fetch(M).then(function(Ge){if(Ge.ok){var dt=j?Ge.clone():null;return ee(Ge,dt,tt)}return _(new ri(Ge.statusText,Ge.status,m.url))}).catch(function(Ge){Ge.code!==20&&_(new Error(Ge.message))})}},ee=function(se,Re,Be){(m.type==="arrayBuffer"?se.arrayBuffer():m.type==="json"?se.json():se.text()).then(function(tt){z||(Re&&Be&&function(Ge,dt,kt){if(wr(),re){var Lt={status:dt.status,statusText:dt.statusText,headers:new ae.Headers};dt.headers.forEach(function(ur,Fr){return Lt.headers.set(Fr,ur)});var $t=Le(dt.headers.get("Cache-Control")||"");$t["no-store"]||($t["max-age"]&&Lt.headers.set("Expires",new Date(kt+1e3*$t["max-age"]).toUTCString()),new Date(Lt.headers.get("Expires")).getTime()-kt<42e4||function(ur,Fr){if(fe===void 0)try{new Response(new ReadableStream),fe=!0}catch(Yr){fe=!1}fe?Fr(ur.body):ur.blob().then(Fr)}(dt,function(ur){var Fr=new ae.Response(ur,Lt);wr(),re&&re.then(function(Yr){return Yr.put($r(Ge.url),Fr)}).catch(function(Yr){return ft(Yr.message)})}))}}(M,Re,Be),P=!0,_(null,tt,se.headers.get("Cache-Control"),se.headers.get("Expires")))}).catch(function(tt){z||_(new Error(tt.message))})};return j?function(se,Re){if(wr(),!re)return Re(null);var Be=$r(se.url);re.then(function(tt){tt.match(Be).then(function(Ge){var dt=function(kt){if(!kt)return!1;var Lt=new Date(kt.headers.get("Expires")||0),$t=Le(kt.headers.get("Cache-Control")||"");return Lt>Date.now()&&!$t["no-cache"]}(Ge);tt.delete(Be),dt&&tt.put(Be,Ge.clone()),Re(null,Ge,dt)}).catch(Re)}).catch(Re)}(M,H):H(null,null),{cancel:function(){z=!0,P||E.abort()}}}(a,s);if(Y()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var b=new ae.XMLHttpRequest;for(var E in b.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(b.responseType="arraybuffer"),m.headers)b.setRequestHeader(E,m.headers[E]);return m.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=m.credentials==="include",b.onerror=function(){_(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var M=b.response;if(m.type==="json")try{M=JSON.parse(b.response)}catch(P){return _(P)}_(null,M,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else _(new ri(b.statusText,b.status,m.url))},b.send(m.body),{cancel:function(){return b.abort()}}}(a,s)},Wo=function(a,s){return mo(qt(a,{type:"arrayBuffer"}),s)},Ki=function(a,s){return mo(qt(a,{method:"POST"}),s)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Yi=[],qi=0;var X=function(a,s){if(Mn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),qi>=rn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Yi.push(c),c}qi++;var m=!1,_=function(){if(!m)for(m=!0,qi--;Yi.length&&qi<rn.MAX_PARALLEL_IMAGE_REQUESTS;){var E=Yi.shift();E.cancelled||(E.cancel=X(E.requestParameters,E.callback).cancel)}},b=Wo(a,function(E,M,P,z){_(),E?s(E):M&&(xn()?function(j,H){var ee=new ae.Blob([new Uint8Array(j)],{type:"image/png"});ae.createImageBitmap(ee).then(function(se){H(null,se)}).catch(function(se){H(new Error("Could not load image because of "+se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,s):function(j,H,ee,se){var Re=new ae.Image,Be=ae.URL;Re.onload=function(){H(null,Re),Be.revokeObjectURL(Re.src),Re.onload=null,ae.requestAnimationFrame(function(){Re.src=G})},Re.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var tt=new ae.Blob([new Uint8Array(j)],{type:"image/png"});Re.cacheControl=ee,Re.expires=se,Re.src=j.byteLength?Be.createObjectURL(tt):G}(M,s,P,z))});return{cancel:function(){b.cancel(),_()}}};function ne(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function be(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Oe=function(a,s){s===void 0&&(s={}),qt(this,s),this.type=a},Qe=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",qt({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Oe),ot=function(){};ot.prototype.on=function(a,s){return this._listeners=this._listeners||{},ne(a,s,this._listeners),this},ot.prototype.off=function(a,s){return be(a,s,this._listeners),be(a,s,this._oneTimeListeners),this},ot.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},ne(a,s,this._oneTimeListeners),this},ot.prototype.fire=function(a,s){typeof a=="string"&&(a=new Oe(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var b=0,E=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];b<E.length;b+=1){var M=E[b];be(c,M,this._oneTimeListeners),M.call(this,a)}var P=this._eventedParent;P&&(qt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(a))}else a instanceof Qe&&console.error(a.error);return this},ot.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},ot.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},K=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function xe(a){var s=a.value;return s?[new K(a.key,s,"constants have been deprecated as of v8")]:[]}function lt(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var b=_[m];for(var E in b)a[E]=b[E]}return a}function pt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function te(a){if(Array.isArray(a))return a.map(te);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=te(a[c]);return s}return pt(a)}var br=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),bn=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};bn.prototype.concat=function(a){return new bn(this,a)},bn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},bn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var cn={kind:"null"},Qt={kind:"number"},tn={kind:"string"},Hr={kind:"boolean"},qr={kind:"color"},si={kind:"object"},Jr={kind:"value"},fi={kind:"collator"},zi={kind:"formatted"},ui={kind:"resolvedImage"};function wi(a,s){return{kind:"array",itemType:a,N:s}}function bi(a){if(a.kind==="array"){var s=bi(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var oo=[cn,Qt,tn,Hr,qr,zi,si,wi(Jr),ui];function ji(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ji(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=oo;c<m.length;c+=1)if(!ji(m[c],s))return null}}return"Expected "+bi(a)+" but found "+bi(s)+" instead."}function fa(a,s){return s.some(function(c){return c.kind===a.kind})}function mi(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var li=oe(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(M){return(M=Math.round(M))<0?0:M>255?255:M}function _(M){return m(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function b(M){return(P=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:P>1?1:P;var P}function E(M,P,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?M+(P-M)*z*6:2*z<1?P:3*z<2?M+(P-M)*(2/3-z)*6:M}try{s.parseCSSColor=function(M){var P,z=M.replace(/ /g,"").toLowerCase();if(z in c)return c[z].slice();if(z[0]==="#")return z.length===4?(P=parseInt(z.substr(1),16))>=0&&P<=4095?[(3840&P)>>4|(3840&P)>>8,240&P|(240&P)>>4,15&P|(15&P)<<4,1]:null:z.length===7&&(P=parseInt(z.substr(1),16))>=0&&P<=16777215?[(16711680&P)>>16,(65280&P)>>8,255&P,1]:null;var j=z.indexOf("("),H=z.indexOf(")");if(j!==-1&&H+1===z.length){var ee=z.substr(0,j),se=z.substr(j+1,H-(j+1)).split(","),Re=1;switch(ee){case"rgba":if(se.length!==4)return null;Re=b(se.pop());case"rgb":return se.length!==3?null:[_(se[0]),_(se[1]),_(se[2]),Re];case"hsla":if(se.length!==4)return null;Re=b(se.pop());case"hsl":if(se.length!==3)return null;var Be=(parseFloat(se[0])%360+360)%360/360,tt=b(se[1]),Ge=b(se[2]),dt=Ge<=.5?Ge*(tt+1):Ge+tt-Ge*tt,kt=2*Ge-dt;return[m(255*E(kt,dt,Be+1/3)),m(255*E(kt,dt,Be)),m(255*E(kt,dt,Be-1/3)),Re];default:return null}}return null}}catch(M){}}).parseCSSColor,gi=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};gi.parse=function(a){if(a){if(a instanceof gi)return a;if(typeof a=="string"){var s=li(a);if(s)return new gi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},gi.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},gi.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},gi.black=new gi(0,0,0,1),gi.white=new gi(1,1,1,1),gi.transparent=new gi(0,0,0,0),gi.red=new gi(1,0,0,1);var ha=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ha.prototype.compare=function(a,s){return this.collator.compare(a,s)},ha.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ns=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},Ji=function(a){this.sections=a};Ji.fromString=function(a){return new Ji([new Ns(a,null,null,null,null)])},Ji.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},Ji.factory=function(a){return a instanceof Ji?a:Ji.fromString(a)},Ji.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},Ji.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var aa=function(a){this.name=a.name,this.available=a.available};function hl(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Fu(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof gi||a instanceof ha||a instanceof Ji||a instanceof aa)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!Fu(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!Fu(a[m]))return!1;return!0}return!1}function pa(a){if(a===null)return cn;if(typeof a=="string")return tn;if(typeof a=="boolean")return Hr;if(typeof a=="number")return Qt;if(a instanceof gi)return qr;if(a instanceof ha)return fi;if(a instanceof Ji)return zi;if(a instanceof aa)return ui;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var b=pa(_[m]);if(s){if(s===b)continue;s=Jr;break}s=b}return wi(s||Jr,c)}return si}function qn(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof gi||a instanceof Ji||a instanceof aa?a.toString():JSON.stringify(a)}aa.prototype.toString=function(){return this.name},aa.fromString=function(a){return a?new aa({name:a,available:!1}):null},aa.prototype.serialize=function(){return["image",this.name]};var oa=function(a,s){this.type=a,this.value=s};oa.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Fu(a[1]))return s.error("invalid value");var c=a[1],m=pa(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new oa(m,c)},oa.prototype.evaluate=function(){return this.value},oa.prototype.eachChild=function(){},oa.prototype.outputDefined=function(){return!0},oa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gi?["rgba"].concat(this.value.toArray()):this.value instanceof Ji?this.value.serialize():this.value};var Qi=function(a){this.name="ExpressionEvaluationError",this.message=a};Qi.prototype.toJSON=function(){return this.message};var Mo={string:tn,number:Qt,boolean:Hr,object:si},Gi=function(a,s){this.type=a,this.args=s};Gi.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var b,E;if(a.length>2){var M=a[1];if(typeof M!="string"||!(M in Mo)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Mo[M],m++}else b=Jr;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=a[2],m++}c=wi(b,E)}else c=Mo[_];for(var P=[];m<a.length;m++){var z=s.parse(a[m],m,Jr);if(!z)return null;P.push(z)}return new Gi(c,P)},Gi.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!ji(this.type,pa(c)))return c;if(s===this.args.length-1)throw new Qi("Expected value to be of type "+bi(this.type)+", but found "+bi(pa(c))+" instead.")}return null},Gi.prototype.eachChild=function(a){this.args.forEach(a)},Gi.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Gi.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var Po=function(a){this.type=zi,this.sections=a};Po.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,b=1;b<=a.length-1;++b){var E=a[b];if(_&&typeof E=="object"&&!Array.isArray(E)){_=!1;var M=null;if(E["font-scale"]&&!(M=s.parse(E["font-scale"],1,Qt)))return null;var P=null;if(E["text-font"]&&!(P=s.parse(E["text-font"],1,wi(tn))))return null;var z=null;if(E["text-color"]&&!(z=s.parse(E["text-color"],1,qr)))return null;var j=m[m.length-1];j.scale=M,j.font=P,j.textColor=z}else{var H=s.parse(a[b],1,Jr);if(!H)return null;var ee=H.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:H,scale:null,font:null,textColor:null})}}return new Po(m)},Po.prototype.evaluate=function(a){return new Ji(this.sections.map(function(s){var c=s.content.evaluate(a);return pa(c)===ui?new Ns("",c,null,null,null):new Ns(qn(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},Po.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},Po.prototype.outputDefined=function(){return!1},Po.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var go=function(a){this.type=ui,this.input=a};go.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,tn);return c?new go(c):s.error("No image name provided.")},go.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=aa.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},go.prototype.eachChild=function(a){a(this.input)},go.prototype.outputDefined=function(){return!1},go.prototype.serialize=function(){return["image",this.input.serialize()]};var Cs={"to-boolean":Hr,"to-color":qr,"to-number":Qt,"to-string":tn},zo=function(a,s){this.type=a,this.args=s};zo.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=Cs[c],_=[],b=1;b<a.length;b++){var E=s.parse(a[b],b,Jr);if(!E)return null;_.push(E)}return new zo(m,_)},zo.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof gi)return s;if(typeof s=="string"){var b=a.parseColor(s);if(b)return b}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":hl(s[0],s[1],s[2],s[3])))return new gi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Qi(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var E=null,M=0,P=this.args;M<P.length;M+=1){if((E=P[M].evaluate(a))===null)return 0;var z=Number(E);if(!isNaN(z))return z}throw new Qi("Could not convert "+JSON.stringify(E)+" to number.")}return this.type.kind==="formatted"?Ji.fromString(qn(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?aa.fromString(qn(this.args[0].evaluate(a))):qn(this.args[0].evaluate(a))},zo.prototype.eachChild=function(a){this.args.forEach(a)},zo.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},zo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Po([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new go(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var Dl=["Unknown","Point","LineString","Polygon"],yo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};yo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},yo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Dl[this.feature.type]:this.feature.type:null},yo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},yo.prototype.canonicalID=function(){return this.canonical},yo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},yo.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=gi.parse(a)),s};var Ea=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};Ea.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Ea.prototype.eachChild=function(a){this.args.forEach(a)},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Ea.parse=function(a,s){var c,m=a[0],_=Ea.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(_)?_[0]:_.type,E=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=E.filter(function(Bn){var un=Bn[0];return!Array.isArray(un)||un.length===a.length-1}),P=null,z=0,j=M;z<j.length;z+=1){var H=j[z],ee=H[0],se=H[1];P=new Zs(s.registry,s.path,null,s.scope);for(var Re=[],Be=!1,tt=1;tt<a.length;tt++){var Ge=a[tt],dt=Array.isArray(ee)?ee[tt-1]:ee.type,kt=P.parse(Ge,1+Re.length,dt);if(!kt){Be=!0;break}Re.push(kt)}if(!Be)if(Array.isArray(ee)&&ee.length!==Re.length)P.error("Expected "+ee.length+" arguments, but found "+Re.length+" instead.");else{for(var Lt=0;Lt<Re.length;Lt++){var $t=Array.isArray(ee)?ee[Lt]:ee.type,ur=Re[Lt];P.concat(Lt+1).checkSubtype($t,ur.type)}if(P.errors.length===0)return new Ea(m,b,se,Re)}}if(M.length===1)(c=s.errors).push.apply(c,P.errors);else{for(var Fr=(M.length?M:E).map(function(Bn){var un;return un=Bn[0],Array.isArray(un)?"("+un.map(bi).join(", ")+")":"("+bi(un.type)+"...)"}).join(" | "),Yr=[],Rn=1;Rn<a.length;Rn++){var on=s.parse(a[Rn],1+Yr.length);if(!on)return null;Yr.push(bi(on.type))}s.error("Expected arguments of type "+Fr+", but found ("+Yr.join(", ")+") instead.")}return null},Ea.register=function(a,s){for(var c in Ea.definitions=s,s)a[c]=Ea};var _r=function(a,s,c){this.type=fi,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Qr(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function ue(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Te(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function it(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function Jt(a,s){for(var c,m,_,b,E,M,P,z=!1,j=0,H=s.length;j<H;j++)for(var ee=s[j],se=0,Re=ee.length;se<Re-1;se++){if((b=(c=a)[0]-(m=ee[se])[0])*(P=c[1]-(_=ee[se+1])[1])-(M=c[0]-_[0])*(E=c[1]-m[1])==0&&b*M<=0&&E*P<=0)return!1;it(a,ee[se],ee[se+1])&&(z=!z)}return z}function Gr(a,s){for(var c=0;c<s.length;c++)if(Jt(a,s[c]))return!0;return!1}function kn(a,s,c,m){var _=m[0]-c[0],b=m[1]-c[1],E=(a[0]-c[0])*b-_*(a[1]-c[1]),M=(s[0]-c[0])*b-_*(s[1]-c[1]);return E>0&&M<0||E<0&&M>0}function Di(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var b=_[m],E=0;E<b.length-1;++E)if((H=[(j=b[E+1])[0]-(z=b[E])[0],j[1]-z[1]])[0]*(ee=[(P=s)[0]-(M=a)[0],P[1]-M[1]])[1]-H[1]*ee[0]!=0&&kn(M,P,z,j)&&kn(z,j,M,P))return!0;var M,P,z,j,H,ee;return!1}function Oa(a,s){for(var c=0;c<a.length;++c)if(!Jt(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(Di(a[m],a[m+1],s))return!1;return!0}function so(a,s){for(var c=0;c<s.length;c++)if(Oa(a,s[c]))return!0;return!1}function Ga(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var b=[],E=0;E<a[_].length;E++){var M=Te(a[_][E],c);Qr(s,M),b.push(M)}m.push(b)}return m}function os(a,s,c){for(var m=[],_=0;_<a.length;_++){var b=Ga(a[_],s,c);m.push(b)}return m}function $o(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,b=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;b===0&&(b=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=b}Qr(s,a)}function th(a,s,c,m){for(var _=8192*Math.pow(2,m.z),b=[8192*m.x,8192*m.y],E=[],M=0,P=a;M<P.length;M+=1)for(var z=0,j=P[M];z<j.length;z+=1){var H=j[z],ee=[H.x+b[0],H.y+b[1]];$o(ee,s,c,_),E.push(ee)}return E}function Uc(a,s,c,m){for(var _,b=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],M=[],P=0,z=a;P<z.length;P+=1){for(var j=[],H=0,ee=z[P];H<ee.length;H+=1){var se=ee[H],Re=[se.x+E[0],se.y+E[1]];Qr(s,Re),j.push(Re)}M.push(j)}if(s[2]-s[0]<=b/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Be=0,tt=M;Be<tt.length;Be+=1)for(var Ge=0,dt=tt[Be];Ge<dt.length;Ge+=1)$o(dt[Ge],s,c,b)}return M}_r.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Hr);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Hr);if(!_)return null;var b=null;return c.locale&&!(b=s.parse(c.locale,1,tn))?null:new _r(m,_,b)},_r.prototype.evaluate=function(a){return new ha(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},_r.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},_r.prototype.outputDefined=function(){return!1},_r.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Ts=function(a,s){this.type=Hr,this.geojson=a,this.geometries=s};function Bu(a){if(a instanceof Ea&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ts)return!1;var s=!0;return a.eachChild(function(c){s&&!Bu(c)&&(s=!1)}),s}function ss(a){if(a instanceof Ea&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!ss(c)&&(s=!1)}),s}function pl(a,s){if(a instanceof Ea&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!pl(m,s)&&(c=!1)}),c}Ts.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Fu(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ts(c,c.features[m].geometry)}else if(c.type==="Feature"){var b=c.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Ts(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ts(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ts.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ga(c.coordinates,_,b),M=th(s.geometry(),m,_,b);if(!ue(m,_))return!1;for(var P=0,z=M;P<z.length;P+=1)if(!Jt(z[P],E))return!1}if(c.type==="MultiPolygon"){var j=os(c.coordinates,_,b),H=th(s.geometry(),m,_,b);if(!ue(m,_))return!1;for(var ee=0,se=H;ee<se.length;ee+=1)if(!Gr(se[ee],j))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=s.canonicalID();if(c.type==="Polygon"){var E=Ga(c.coordinates,_,b),M=Uc(s.geometry(),m,_,b);if(!ue(m,_))return!1;for(var P=0,z=M;P<z.length;P+=1)if(!Oa(z[P],E))return!1}if(c.type==="MultiPolygon"){var j=os(c.coordinates,_,b),H=Uc(s.geometry(),m,_,b);if(!ue(m,_))return!1;for(var ee=0,se=H;ee<se.length;ee+=1)if(!so(se[ee],j))return!1}return!0}(a,this.geometries)}return!1},Ts.prototype.eachChild=function(){},Ts.prototype.outputDefined=function(){return!0},Ts.prototype.serialize=function(){return["within",this.geojson]};var zu=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};zu.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new zu(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},zu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},zu.prototype.eachChild=function(){},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){return["var",this.name]};var Zs=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new bn),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(b){return"["+b+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function Ol(a,s){for(var c,m=a.length-1,_=0,b=m,E=0;_<=b;)if((c=a[E=Math.floor((_+b)/2)])<=s){if(E===m||s<a[E+1])return E;_=E+1}else{if(!(c>s))throw new Qi("Input is not a number.");b=E-1}return 0}Zs.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},Zs.prototype._parse=function(a,s){function c(z,j,H){return H==="assert"?new Gi(j,[z]):H==="coerce"?new zo(j,[z]):z}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var b=_.parse(a,this);if(!b)return null;if(this.expectedType){var E=this.expectedType,M=b.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(E,M))return null}else b=c(b,E,s.typeAnnotation||"coerce");else b=c(b,E,s.typeAnnotation||"assert")}if(!(b instanceof oa)&&b.type.kind!=="resolvedImage"&&function z(j){if(j instanceof zu)return z(j.boundExpression);if(j instanceof Ea&&j.name==="error"||j instanceof _r||j instanceof Ts)return!1;var H=j instanceof zo||j instanceof Gi,ee=!0;return j.eachChild(function(se){ee=H?ee&&z(se):ee&&se instanceof oa}),!!ee&&Bu(j)&&pl(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var P=new yo;try{b=new oa(b.type,b.evaluate(P))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Zs.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new Zs(this.registry,m,s||null,_,this.errors)},Zs.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new br(m,a))},Zs.prototype.checkSubtype=function(a,s){var c=ji(a,s);return c&&this.error(c),c};var Xo=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var b=_[m],E=b[1];this.labels.push(b[0]),this.outputs.push(E)}};function Fa(a,s,c){return a*(1-c)+s*c}Xo.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var b=1;b<a.length;b+=2){var E=b===1?-1/0:a[b],M=a[b+1],P=b,z=b+1;if(typeof E!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=E)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);var j=s.parse(M,z,_);if(!j)return null;_=_||j.type,m.push([E,j])}return new Xo(_,c,m)},Xo.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[Ol(s,m)].evaluate(a)},Xo.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Xo.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Xo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var Fl=Object.freeze({__proto__:null,number:Fa,color:function(a,s,c){return new gi(Fa(a.r,s.r,c),Fa(a.g,s.g,c),Fa(a.b,s.b,c),Fa(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return Fa(m,s[_],c)})}}),Vc=6/29*3*(6/29),gf=Math.PI/180,Nu=180/Math.PI;function Bl(a){return a>.008856451679035631?Math.pow(a,1/3):a/Vc+4/29}function jc(a){return a>6/29?a*a*a:Vc*(a-4/29)}function Gc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function yf(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function rh(a){var s=yf(a.r),c=yf(a.g),m=yf(a.b),_=Bl((.4124564*s+.3575761*c+.1804375*m)/.95047),b=Bl((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*b-16,a:500*(_-b),b:200*(b-Bl((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function nh(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*jc(s),c=.95047*jc(c),m=1.08883*jc(m),new gi(Gc(3.2404542*c-1.5371385*s-.4985314*m),Gc(-.969266*c+1.8760108*s+.041556*m),Gc(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function Hh(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var cc={forward:rh,reverse:nh,interpolate:function(a,s,c){return{l:Fa(a.l,s.l,c),a:Fa(a.a,s.a,c),b:Fa(a.b,s.b,c),alpha:Fa(a.alpha,s.alpha,c)}}},fc={forward:function(a){var s=rh(a),c=s.l,m=s.a,_=s.b,b=Math.atan2(_,m)*Nu;return{h:b<0?b+360:b,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*gf,c=a.c;return nh({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:Hh(a.h,s.h,c),c:Fa(a.c,s.c,c),l:Fa(a.l,s.l,c),alpha:Fa(a.alpha,s.alpha,c)}}},ih=Object.freeze({__proto__:null,lab:cc,hcl:fc}),Ba=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var b=0,E=_;b<E.length;b+=1){var M=E[b],P=M[1];this.labels.push(M[0]),this.outputs.push(P)}};function _f(a,s,c,m){var _=m-c,b=a-c;return _===0?0:s===1?b/_:(Math.pow(s,b)-1)/(Math.pow(s,_)-1)}Ba.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=_f(s,a.base,c,m);else if(a.name==="linear")_=_f(s,1,c,m);else if(a.name==="cubic-bezier"){var b=a.controlPoints;_=new V(b[0],b[1],b[2],b[3]).solve(_f(s,1,c,m))}return _},Ba.parse=function(a,s){var c=a[0],m=a[1],_=a[2],b=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var E=m[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:E}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var M=m.slice(1);if(M.length!==4||M.some(function(tt){return typeof tt!="number"||tt<0||tt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Qt)))return null;var P=[],z=null;c==="interpolate-hcl"||c==="interpolate-lab"?z=qr:s.expectedType&&s.expectedType.kind!=="value"&&(z=s.expectedType);for(var j=0;j<b.length;j+=2){var H=b[j],ee=b[j+1],se=j+3,Re=j+4;if(typeof H!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(P.length&&P[P.length-1][0]>=H)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);var Be=s.parse(ee,Re,z);if(!Be)return null;z=z||Be.type,P.push([H,Be])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new Ba(z,c,m,_,P):s.error("Type "+bi(z)+" is not interpolatable.")},Ba.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var b=Ol(s,m),E=Ba.interpolationFactor(this.interpolation,m,s[b],s[b+1]),M=c[b].evaluate(a),P=c[b+1].evaluate(a);return this.operator==="interpolate"?Fl[this.type.kind.toLowerCase()](M,P,E):this.operator==="interpolate-hcl"?fc.reverse(fc.interpolate(fc.forward(M),fc.forward(P),E)):cc.reverse(cc.interpolate(cc.forward(M),cc.forward(P),E))},Ba.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Ba.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ba.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Zu=function(a,s){this.type=a,this.args=s};Zu.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],b=0,E=a.slice(1);b<E.length;b+=1){var M=s.parse(E[b],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,_.push(M)}var P=m&&_.some(function(z){return ji(m,z.type)});return new Zu(P?Jr:c,_)},Zu.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,b=this.args;_<b.length&&(m++,(c=b[_].evaluate(a))&&c instanceof aa&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Zu.prototype.eachChild=function(a){this.args.forEach(a)},Zu.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Zu.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Ms=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Ms.prototype.evaluate=function(a){return this.result.evaluate(a)},Ms.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Ms.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var b=s.parse(a[m+1],m+1);if(!b)return null;c.push([_,b])}var E=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return E?new Ms(c,E):null},Ms.prototype.outputDefined=function(){return this.result.outputDefined()},Ms.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var dl=function(a,s,c){this.type=a,this.index=s,this.input=c};dl.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Qt),m=s.parse(a[2],2,wi(s.expectedType||Jr));return c&&m?new dl(m.type.itemType,c,m):null},dl.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Qi("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Qi("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Qi("Array index must be an integer, but found "+s+" instead.");return c[s]},dl.prototype.eachChild=function(a){a(this.index),a(this.input)},dl.prototype.outputDefined=function(){return!1},dl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ei=function(a,s){this.type=Hr,this.needle=a,this.haystack=s};ei.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Jr),m=s.parse(a[2],2,Jr);return c&&m?fa(c.type,[Hr,tn,Qt,cn,Jr])?new ei(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+bi(c.type)+" instead"):null},ei.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!mi(s,["boolean","string","number","null"]))throw new Qi("Expected first argument to be of type boolean, string, number or null, but found "+bi(pa(s))+" instead.");if(!mi(c,["string","array"]))throw new Qi("Expected second argument to be of type array or string, but found "+bi(pa(c))+" instead.");return c.indexOf(s)>=0},ei.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},ei.prototype.outputDefined=function(){return!0},ei.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var yu=function(a,s,c){this.type=Qt,this.needle=a,this.haystack=s,this.fromIndex=c};yu.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Jr),m=s.parse(a[2],2,Jr);if(!c||!m)return null;if(!fa(c.type,[Hr,tn,Qt,cn,Jr]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+bi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new yu(c,m,_):null}return new yu(c,m)},yu.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!mi(s,["boolean","string","number","null"]))throw new Qi("Expected first argument to be of type boolean, string, number or null, but found "+bi(pa(s))+" instead.");if(!mi(c,["string","array"]))throw new Qi("Expected second argument to be of type array or string, but found "+bi(pa(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},yu.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var vs=function(a,s,c,m,_,b){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=b};vs.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},b=[],E=2;E<a.length-1;E+=2){var M=a[E],P=a[E+1];Array.isArray(M)||(M=[M]);var z=s.concat(E);if(M.length===0)return z.error("Expected at least one branch label.");for(var j=0,H=M;j<H.length;j+=1){var ee=H[j];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,pa(ee)))return null}else c=pa(ee);if(_[String(ee)]!==void 0)return z.error("Branch labels must be unique.");_[String(ee)]=b.length}var se=s.parse(P,E,m);if(!se)return null;m=m||se.type,b.push(se)}var Re=s.parse(a[1],1,Jr);if(!Re)return null;var Be=s.parse(a[a.length-1],a.length-1,m);return Be?Re.type.kind!=="value"&&s.concat(1).checkSubtype(c,Re.type)?null:new vs(c,m,Re,_,b,Be):null},vs.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(pa(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},vs.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},vs.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},vs.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,b=Object.keys(this.cases).sort();_<b.length;_+=1){var E=b[_];(H=m[this.cases[E]])===void 0?(m[this.cases[E]]=c.length,c.push([this.cases[E],[E]])):c[H][1].push(E)}for(var M=function(se){return a.inputType.kind==="number"?Number(se):se},P=0,z=c;P<z.length;P+=1){var j=z[P],H=j[0],ee=j[1];s.push(ee.length===1?M(ee[0]):ee.map(M)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var _u=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};_u.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var b=s.parse(a[_],_,Hr);if(!b)return null;var E=s.parse(a[_+1],_+1,c);if(!E)return null;m.push([b,E]),c=c||E.type}var M=s.parse(a[a.length-1],a.length-1,c);return M?new _u(c,m,M):null},_u.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},_u.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},_u.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},_u.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Yo=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function Hc(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Ci(a,s,c,m){return m.compare(s,c)===0}function Ei(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(b,E,M){this.type=Hr,this.lhs=b,this.rhs=E,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||E.type.kind==="value"}return _.parse=function(b,E){if(b.length!==3&&b.length!==4)return E.error("Expected two or three arguments.");var M=b[0],P=E.parse(b[1],1,Jr);if(!P)return null;if(!Hc(M,P.type))return E.concat(1).error('"'+M+`" comparisons are not supported for type '`+bi(P.type)+"'.");var z=E.parse(b[2],2,Jr);if(!z)return null;if(!Hc(M,z.type))return E.concat(2).error('"'+M+`" comparisons are not supported for type '`+bi(z.type)+"'.");if(P.type.kind!==z.type.kind&&P.type.kind!=="value"&&z.type.kind!=="value")return E.error("Cannot compare types '"+bi(P.type)+"' and '"+bi(z.type)+"'.");m&&(P.type.kind==="value"&&z.type.kind!=="value"?P=new Gi(z.type,[P]):P.type.kind!=="value"&&z.type.kind==="value"&&(z=new Gi(P.type,[z])));var j=null;if(b.length===4){if(P.type.kind!=="string"&&z.type.kind!=="string"&&P.type.kind!=="value"&&z.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(!(j=E.parse(b[3],3,fi)))return null}return new _(P,z,j)},_.prototype.evaluate=function(b){var E=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(m&&this.hasUntypedArgument){var P=pa(E),z=pa(M);if(P.kind!==z.kind||P.kind!=="string"&&P.kind!=="number")throw new Qi('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+P.kind+", "+z.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var j=pa(E),H=pa(M);if(j.kind!=="string"||H.kind!=="string")return s(b,E,M)}return this.collator?c(b,E,M,this.collator.evaluate(b)):s(b,E,M)},_.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var b=[a];return this.eachChild(function(E){b.push(E.serialize())}),b},_}()}Yo.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,Jr),m=s.parse(a[2],2,Qt);if(!c||!m)return null;if(!fa(c.type,[wi(Jr),tn,Jr]))return s.error("Expected first argument to be of type array or string, but found "+bi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,Qt);return _?new Yo(c.type,c,m,_):null}return new Yo(c.type,c,m)},Yo.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!mi(s,["string","array"]))throw new Qi("Expected first argument to be of type array or string, but found "+bi(pa(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},Yo.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Us=Ei("==",function(a,s,c){return s===c},Ci),Vs=Ei("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!Ci(0,s,c,m)}),ah=Ei("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),xf=Ei(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),hc=Ei("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),za=Ei(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),Uu=function(a,s,c,m,_){this.type=tn,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};Uu.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,Qt);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,tn)))return null;var b=null;if(m.currency&&!(b=s.parse(m.currency,1,tn)))return null;var E=null;if(m["min-fraction-digits"]&&!(E=s.parse(m["min-fraction-digits"],1,Qt)))return null;var M=null;return m["max-fraction-digits"]&&!(M=s.parse(m["max-fraction-digits"],1,Qt))?null:new Uu(c,_,b,E,M)},Uu.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Uu.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Uu.prototype.outputDefined=function(){return!1},Uu.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var xu=function(a){this.type=Qt,this.input=a};xu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+bi(c.type)+" instead."):new xu(c):null},xu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Qi("Expected value to be of type string or array, but found "+bi(pa(s))+" instead.")},xu.prototype.eachChild=function(a){a(this.input)},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var No={"==":Us,"!=":Vs,">":xf,"<":ah,">=":za,"<=":hc,array:Gi,at:dl,boolean:Gi,case:_u,coalesce:Zu,collator:_r,format:Po,image:go,in:ei,"index-of":yu,interpolate:Ba,"interpolate-hcl":Ba,"interpolate-lab":Ba,length:xu,let:Ms,literal:oa,match:vs,number:Gi,"number-format":Uu,object:Gi,slice:Yo,step:Xo,string:Gi,"to-boolean":zo,"to-color":zo,"to-number":zo,"to-string":zo,var:zu,within:Ts};function bf(a,s){var c=s[0],m=s[1],_=s[2],b=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var E=b?b.evaluate(a):1,M=hl(c,m,_,E);if(M)throw new Qi(M);return new gi(c/255*E,m/255*E,_/255*E,E)}function pc(a,s){return a in s}function ea(a,s){var c=s[a];return c===void 0?null:c}function nu(a){return{type:a}}function zl(a){return{result:"success",value:a}}function iu(a){return{result:"error",value:a}}function au(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Sf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function bu(a){return!!a.expression&&a.expression.interpolated}function Hi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function dc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function vl(a){return a}function Nl(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function Wc(a,s,c,m,_){return Nl(typeof c===_?m[c]:void 0,a.default,s.default)}function wf(a,s,c){if(Hi(c)!=="number")return Nl(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=Ol(a.stops.map(function(b){return b[0]}),c);return a.stops[_][1]}function vc(a,s,c){var m=a.base!==void 0?a.base:1;if(Hi(c)!=="number")return Nl(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var b=Ol(a.stops.map(function(H){return H[0]}),c),E=function(H,ee,se,Re){var Be=Re-se,tt=H-se;return Be===0?0:ee===1?tt/Be:(Math.pow(ee,tt)-1)/(Math.pow(ee,Be)-1)}(c,m,a.stops[b][0],a.stops[b+1][0]),M=a.stops[b][1],P=a.stops[b+1][1],z=Fl[s.type]||vl;if(a.colorSpace&&a.colorSpace!=="rgb"){var j=ih[a.colorSpace];z=function(H,ee){return j.reverse(j.interpolate(j.forward(H),j.forward(ee),E))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var H=[],ee=arguments.length;ee--;)H[ee]=arguments[ee];var se=M.evaluate.apply(void 0,H),Re=P.evaluate.apply(void 0,H);if(se!==void 0&&Re!==void 0)return z(se,Re,E)}}:z(M,P,E)}function mc(a,s,c){return s.type==="color"?c=gi.parse(c):s.type==="formatted"?c=Ji.fromString(c.toString()):s.type==="resolvedImage"?c=aa.fromString(c.toString()):Hi(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Nl(c,a.default,s.default)}Ea.register(No,{error:[{kind:"error"},[tn],function(a,s){throw new Qi(s[0].evaluate(a))}],typeof:[tn,[Jr],function(a,s){return bi(pa(s[0].evaluate(a)))}],"to-rgba":[wi(Qt,4),[qr],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[qr,[Qt,Qt,Qt],bf],rgba:[qr,[Qt,Qt,Qt,Qt],bf],has:{type:Hr,overloads:[[[tn],function(a,s){return pc(s[0].evaluate(a),a.properties())}],[[tn,si],function(a,s){var c=s[1];return pc(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:Jr,overloads:[[[tn],function(a,s){return ea(s[0].evaluate(a),a.properties())}],[[tn,si],function(a,s){var c=s[1];return ea(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[Jr,[tn],function(a,s){return ea(s[0].evaluate(a),a.featureState||{})}],properties:[si,[],function(a){return a.properties()}],"geometry-type":[tn,[],function(a){return a.geometryType()}],id:[Jr,[],function(a){return a.id()}],zoom:[Qt,[],function(a){return a.globals.zoom}],"heatmap-density":[Qt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[Qt,[],function(a){return a.globals.lineProgress||0}],accumulated:[Jr,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[Qt,nu(Qt),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[Qt,nu(Qt),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:Qt,overloads:[[[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[Qt],function(a,s){return-s[0].evaluate(a)}]]},"/":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[Qt,[Qt,Qt],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[Qt,[],function(){return Math.LN2}],pi:[Qt,[],function(){return Math.PI}],e:[Qt,[],function(){return Math.E}],"^":[Qt,[Qt,Qt],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[Qt,[Qt],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[Qt,[Qt],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[Qt,[Qt],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[Qt,[Qt],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[Qt,[Qt],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[Qt,[Qt],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[Qt,[Qt],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[Qt,[Qt],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[Qt,nu(Qt),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[Qt,nu(Qt),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[Qt,[Qt],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[Qt,[Qt],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Qt,[Qt],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[Qt,[Qt],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[Hr,[tn,Jr],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[Hr,[Jr],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[Hr,[tn],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[Hr,[tn,Jr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<b}],"filter-id-<":[Hr,[Jr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[Hr,[tn,Jr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>b}],"filter-id->":[Hr,[Jr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[Hr,[tn,Jr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_<=b}],"filter-id-<=":[Hr,[Jr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[Hr,[tn,Jr],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],b=m.value;return typeof _==typeof b&&_>=b}],"filter-id->=":[Hr,[Jr],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[Hr,[Jr],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[Hr,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Hr,[wi(tn)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Hr,[wi(Jr)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[Hr,[tn,wi(Jr)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[Hr,[tn,wi(Jr)],function(a,s){var c=s[0],m=s[1];return function(_,b,E,M){for(;E<=M;){var P=E+M>>1;if(b[P]===_)return!0;b[P]>_?M=P-1:E=P+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:Hr,overloads:[[[Hr,Hr],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[nu(Hr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[nu(Hr),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[Hr,[Hr],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[Hr,[tn],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[tn,[tn],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[tn,[tn],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[tn,nu(Jr),function(a,s){return s.map(function(c){return qn(c.evaluate(a))}).join("")}],"resolved-locale":[tn,[fi],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var js=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new yo,this._defaultValue=s?function(c){return c.type==="color"&&dc(c.default)?new gi(0,0,0,0):c.type==="color"?gi.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Su(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in No}function gc(a,s){var c=new Zs(No,[],s?function(_){var b={color:qr,string:tn,number:Qt,enum:tn,boolean:Hr,formatted:zi,resolvedImage:ui};return _.type==="array"?wi(b[_.value]||Jr,_.length):b[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?zl(new js(m,s)):iu(c.errors)}js.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},js.prototype.evaluate=function(a,s,c,m,_,b){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{var E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Qi("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(E)+" instead.");return E}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var ml=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!ss(s.expression)};ml.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},ml.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)};var wu=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!ss(s.expression),this.interpolationType=m};function Ef(a,s){if((a=gc(a,s)).result==="error")return a;var c=a.value.expression,m=Bu(c);if(!m&&!au(s))return iu([new br("","data expressions not supported")]);var _=pl(c,["zoom"]);if(!_&&!Sf(s))return iu([new br("","zoom expressions not supported")]);var b=function E(M){var P=null;if(M instanceof Ms)P=E(M.result);else if(M instanceof Zu)for(var z=0,j=M.args;z<j.length&&!(P=E(j[z]));z+=1);else(M instanceof Xo||M instanceof Ba)&&M.input instanceof Ea&&M.input.name==="zoom"&&(P=M);return P instanceof br||M.eachChild(function(H){var ee=E(H);ee instanceof br?P=ee:!P&&ee?P=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):P&&ee&&P!==ee&&(P=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),P}(c);return b||_?b instanceof br?iu([b]):b instanceof Ba&&!bu(s)?iu([new br("",'"interpolate" expressions cannot be used with this property')]):zl(b?new wu(m?"camera":"composite",a.value,b.labels,b instanceof Ba?b.interpolation:void 0):new ml(m?"constant":"source",a.value)):iu([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}wu.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,b)},wu.prototype.evaluate=function(a,s,c,m,_,b){return this._styleExpression.evaluate(a,s,c,m,_,b)},wu.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?Ba.interpolationFactor(this.interpolationType,a,s,c):0};var Eu=function(a,s){this._parameters=a,this._specification=s,lt(this,function c(m,_){var b,E,M,P=_.type==="color",z=m.stops&&typeof m.stops[0][0]=="object",j=z||!(z||m.property!==void 0),H=m.type||(bu(_)?"exponential":"interval");if(P&&((m=lt({},m)).stops&&(m.stops=m.stops.map(function(on){return[on[0],gi.parse(on[1])]})),m.default=gi.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ih[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(H==="exponential")b=vc;else if(H==="interval")b=wf;else if(H==="categorical"){b=Wc,E=Object.create(null);for(var ee=0,se=m.stops;ee<se.length;ee+=1){var Re=se[ee];E[Re[0]]=Re[1]}M=typeof m.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');b=mc}if(z){for(var Be={},tt=[],Ge=0;Ge<m.stops.length;Ge++){var dt=m.stops[Ge],kt=dt[0].zoom;Be[kt]===void 0&&(Be[kt]={zoom:kt,type:m.type,property:m.property,default:m.default,stops:[]},tt.push(kt)),Be[kt].stops.push([dt[0].value,dt[1]])}for(var Lt=[],$t=0,ur=tt;$t<ur.length;$t+=1){var Fr=ur[$t];Lt.push([Be[Fr].zoom,c(Be[Fr],_)])}var Yr={name:"linear"};return{kind:"composite",interpolationType:Yr,interpolationFactor:Ba.interpolationFactor.bind(void 0,Yr),zoomStops:Lt.map(function(on){return on[0]}),evaluate:function(on,Bn){var un=on.zoom;return vc({stops:Lt,base:m.base},_,un).evaluate(un,Bn)}}}if(j){var Rn=H==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Rn,interpolationFactor:Ba.interpolationFactor.bind(void 0,Rn),zoomStops:m.stops.map(function(on){return on[0]}),evaluate:function(on){return b(m,_,on.zoom,E,M)}}}return{kind:"source",evaluate:function(on,Bn){var un=Bn&&Bn.properties?Bn.properties[m.property]:void 0;return un===void 0?Nl(m.default,_.default):b(m,_,un,E,M)}}}(this._parameters,this._specification))};function ks(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},b=a.style,E=a.styleSpec,M=[],P=Hi(c);if(P!=="object")return[new K(s,c,"object expected, "+P+" found")];for(var z in c){var j=z.split(".")[0],H=m[j]||m["*"],ee=void 0;if(_[j])ee=_[j];else if(m[j])ee=yi;else if(_["*"])ee=_["*"];else{if(!m["*"]){M.push(new K(s,c[z],'unknown property "'+z+'"'));continue}ee=yi}M=M.concat(ee({key:(s&&s+".")+z,value:c[z],valueSpec:H,style:b,styleSpec:E,object:c,objectKey:z},c))}for(var se in m)_[se]||m[se].required&&m[se].default===void 0&&c[se]===void 0&&M.push(new K(s,c,'missing required property "'+se+'"'));return M}function yc(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,b=a.key,E=a.arrayElementValidator||yi;if(Hi(s)!=="array")return[new K(b,s,"array expected, "+Hi(s)+" found")];if(c.length&&s.length!==c.length)return[new K(b,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new K(b,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var M={type:c.value,values:c.values};_.$version<7&&(M.function=c.function),Hi(c.value)==="object"&&(M=c.value);for(var P=[],z=0;z<s.length;z++)P=P.concat(E({array:s,arrayIndex:z,value:s[z],valueSpec:M,style:m,styleSpec:_,key:b+"["+z+"]"}));return P}function Zl(a){var s=a.key,c=a.value,m=a.valueSpec,_=Hi(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new K(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new K(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new K(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Af(a){var s,c,m,_=a.valueSpec,b=pt(a.value.type),E={},M=b!=="categorical"&&a.value.property===void 0,P=!M,z=Hi(a.value.stops)==="array"&&Hi(a.value.stops[0])==="array"&&Hi(a.value.stops[0][0])==="object",j=ks({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(se){if(b==="identity")return[new K(se.key,se.value,'identity function may not have a "stops" property')];var Re=[],Be=se.value;return Re=Re.concat(yc({key:se.key,value:Be,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:H})),Hi(Be)==="array"&&Be.length===0&&Re.push(new K(se.key,Be,"array must have at least one stop")),Re},default:function(se){return yi({key:se.key,value:se.value,valueSpec:_,style:se.style,styleSpec:se.styleSpec})}}});return b==="identity"&&M&&j.push(new K(a.key,a.value,'missing required property "property"')),b==="identity"||a.value.stops||j.push(new K(a.key,a.value,'missing required property "stops"')),b==="exponential"&&a.valueSpec.expression&&!bu(a.valueSpec)&&j.push(new K(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!au(a.valueSpec)?j.push(new K(a.key,a.value,"property functions not supported")):M&&!Sf(a.valueSpec)&&j.push(new K(a.key,a.value,"zoom functions not supported"))),b!=="categorical"&&!z||a.value.property!==void 0||j.push(new K(a.key,a.value,'"property" property is required')),j;function H(se){var Re=[],Be=se.value,tt=se.key;if(Hi(Be)!=="array")return[new K(tt,Be,"array expected, "+Hi(Be)+" found")];if(Be.length!==2)return[new K(tt,Be,"array length 2 expected, length "+Be.length+" found")];if(z){if(Hi(Be[0])!=="object")return[new K(tt,Be,"object expected, "+Hi(Be[0])+" found")];if(Be[0].zoom===void 0)return[new K(tt,Be,"object stop key must have zoom")];if(Be[0].value===void 0)return[new K(tt,Be,"object stop key must have value")];if(m&&m>pt(Be[0].zoom))return[new K(tt,Be[0].zoom,"stop zoom values must appear in ascending order")];pt(Be[0].zoom)!==m&&(m=pt(Be[0].zoom),c=void 0,E={}),Re=Re.concat(ks({key:tt+"[0]",value:Be[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:Zl,value:ee}}))}else Re=Re.concat(ee({key:tt+"[0]",value:Be[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},Be));return Su(te(Be[1]))?Re.concat([new K(tt+"[1]",Be[1],"expressions are not allowed in function stops.")]):Re.concat(yi({key:tt+"[1]",value:Be[1],valueSpec:_,style:se.style,styleSpec:se.styleSpec}))}function ee(se,Re){var Be=Hi(se.value),tt=pt(se.value),Ge=se.value!==null?se.value:Re;if(s){if(Be!==s)return[new K(se.key,Ge,Be+" stop domain type must match previous stop domain type "+s)]}else s=Be;if(Be!=="number"&&Be!=="string"&&Be!=="boolean")return[new K(se.key,Ge,"stop domain value must be a number, string, or boolean")];if(Be!=="number"&&b!=="categorical"){var dt="number expected, "+Be+" found";return au(_)&&b===void 0&&(dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new K(se.key,Ge,dt)]}return b!=="categorical"||Be!=="number"||isFinite(tt)&&Math.floor(tt)===tt?b!=="categorical"&&Be==="number"&&c!==void 0&&tt<c?[new K(se.key,Ge,"stop domain values must appear in ascending order")]:(c=tt,b==="categorical"&&tt in E?[new K(se.key,Ge,"stop domain values must be unique")]:(E[tt]=!0,[])):[new K(se.key,Ge,"integer expected, found "+tt)]}}function Vu(a){var s=(a.expressionContext==="property"?Ef:gc)(te(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new K(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new K(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ss(c))return[new K(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ss(c))return[new K(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!pl(c,["zoom","feature-state"]))return[new K(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Bu(c))return[new K(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gl(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(pt(c))===-1&&_.push(new K(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(pt(c))===-1&&_.push(new K(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function $c(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!$c(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}Eu.deserialize=function(a){return new Eu(a._parameters,a._specification)},Eu.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Au={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ju(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};$c(a)||(a=Gu(a));var s=gc(a,Au);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function oh(a,s){return a<s?-1:a>s?1:0}function Gu(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?Cf(a[1],a[2],"=="):c==="!="?_c(Cf(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Cf(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(Gu))):c==="all"?["all"].concat(a.slice(1).map(Gu)):c==="none"?["all"].concat(a.slice(1).map(Gu).map(_c)):c==="in"?sh(a[1],a.slice(2)):c==="!in"?_c(sh(a[1],a.slice(2))):c==="has"?_o(a[1]):c==="!has"?_c(_o(a[1])):c!=="within"||a}function Cf(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function sh(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(oh)]]:["filter-in-small",a,["literal",s]]}}function _o(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function _c(a){return["!",a]}function uh(a){return $c(te(a.value))?Vu(lt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(Hi(m)!=="array")return[new K(_,m,"array expected, "+Hi(m)+" found")];var b,E=c.styleSpec,M=[];if(m.length<1)return[new K(_,m,"filter array must have at least 1 element")];switch(M=M.concat(gl({key:_+"[0]",value:m[0],valueSpec:E.filter_operator,style:c.style,styleSpec:c.styleSpec})),pt(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&pt(m[1])==="$type"&&M.push(new K(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&M.push(new K(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(b=Hi(m[1]))!=="string"&&M.push(new K(_+"[1]",m[1],"string expected, "+b+" found"));for(var P=2;P<m.length;P++)b=Hi(m[P]),pt(m[1])==="$type"?M=M.concat(gl({key:_+"["+P+"]",value:m[P],valueSpec:E.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new K(_+"["+P+"]",m[P],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<m.length;z++)M=M.concat(s({key:_+"["+z+"]",value:m[z],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Hi(m[1]),m.length!==2?M.push(new K(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="string"&&M.push(new K(_+"[1]",m[1],"string expected, "+b+" found"));break;case"within":b=Hi(m[1]),m.length!==2?M.push(new K(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):b!=="object"&&M.push(new K(_+"[1]",m[1],"object expected, "+b+" found"))}return M}(a)}function lh(a,s){var c=a.key,m=a.style,_=a.styleSpec,b=a.value,E=a.objectKey,M=_[s+"_"+a.layerType];if(!M)return[];var P=E.match(/^(.*)-transition$/);if(s==="paint"&&P&&M[P[1]]&&M[P[1]].transition)return yi({key:c,value:b,valueSpec:_.transition,style:m,styleSpec:_});var z,j=a.valueSpec||M[E];if(!j)return[new K(c,b,'unknown property "'+E+'"')];if(Hi(b)==="string"&&au(j)&&!j.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new K(c,b,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var H=[];return a.layerType==="symbol"&&(E==="text-field"&&m&&!m.glyphs&&H.push(new K(c,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&dc(te(b))&&pt(b.type)==="identity"&&H.push(new K(c,b,'"text-font" does not support identity functions'))),H.concat(yi({key:a.key,value:b,valueSpec:j,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:E}))}function Tf(a){return lh(a,"paint")}function Ul(a){return lh(a,"layout")}function Vl(a){var s=[],c=a.value,m=a.key,_=a.style,b=a.styleSpec;c.type||c.ref||s.push(new K(m,c,'either "type" or "ref" is required'));var E,M=pt(c.type),P=pt(c.ref);if(c.id)for(var z=pt(c.id),j=0;j<a.arrayIndex;j++){var H=_.layers[j];pt(H.id)===z&&s.push(new K(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+H.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Re){Re in c&&s.push(new K(m,c[Re],'"'+Re+'" is prohibited for ref layers'))}),_.layers.forEach(function(Re){pt(Re.id)===P&&(E=Re)}),E?E.ref?s.push(new K(m,c.ref,"ref cannot reference another ref layer")):M=pt(E.type):s.push(new K(m,c.ref,'ref layer "'+P+'" not found'));else if(M!=="background")if(c.source){var ee=_.sources&&_.sources[c.source],se=ee&&pt(ee.type);ee?se==="vector"&&M==="raster"?s.push(new K(m,c.source,'layer "'+c.id+'" requires a raster source')):se==="raster"&&M!=="raster"?s.push(new K(m,c.source,'layer "'+c.id+'" requires a vector source')):se!=="vector"||c["source-layer"]?se==="raster-dem"&&M!=="hillshade"?s.push(new K(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!c.paint||!c.paint["line-gradient"]||se==="geojson"&&ee.lineMetrics||s.push(new K(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new K(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new K(m,c.source,'source "'+c.source+'" not found'))}else s.push(new K(m,c,'missing required property "source"'));return s=s.concat(ks({key:m,value:c,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return yi({key:m+".type",value:c.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:uh,layout:function(Re){return ks({layer:c,key:Re.key,value:Re.value,style:Re.style,styleSpec:Re.styleSpec,objectElementValidators:{"*":function(Be){return Ul(lt({layerType:M},Be))}}})},paint:function(Re){return ks({layer:c,key:Re.key,value:Re.value,style:Re.style,styleSpec:Re.styleSpec,objectElementValidators:{"*":function(Be){return Tf(lt({layerType:M},Be))}}})}}}))}function Gs(a){var s=a.value,c=a.key,m=Hi(s);return m!=="string"?[new K(c,s,"string expected, "+m+" found")]:[]}var ta={promoteId:function(a){var s=a.key,c=a.value;if(Hi(c)==="string")return Gs({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,Gs({key:s+"."+_,value:c[_]}));return m}};function jl(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new K(c,s,'"type" is required')];var b,E=pt(s.type);switch(E){case"vector":case"raster":case"raster-dem":return ks({key:c,value:s,valueSpec:m["source_"+E.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:ta});case"geojson":if(b=ks({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:ta}),s.cluster)for(var M in s.clusterProperties){var P=s.clusterProperties[M],z=P[0],j=typeof z=="string"?[z,["accumulated"],["get",M]]:z;b.push.apply(b,Vu({key:c+"."+M+".map",value:P[1],expressionContext:"cluster-map"})),b.push.apply(b,Vu({key:c+"."+M+".reduce",value:j,expressionContext:"cluster-reduce"}))}return b;case"video":return ks({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return ks({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new K(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gl({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function ou(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,b=[],E=Hi(s);if(s===void 0)return b;if(E!=="object")return b.concat([new K("light",s,"object expected, "+E+" found")]);for(var M in s){var P=M.match(/^(.*)-transition$/);b=b.concat(P&&m[P[1]]&&m[P[1]].transition?yi({key:M,value:s[M],valueSpec:c.transition,style:_,styleSpec:c}):m[M]?yi({key:M,value:s[M],valueSpec:m[M],style:_,styleSpec:c}):[new K(M,s[M],'unknown property "'+M+'"')])}return b}var Hu={"*":function(){return[]},array:yc,boolean:function(a){var s=a.value,c=a.key,m=Hi(s);return m!=="boolean"?[new K(c,s,"boolean expected, "+m+" found")]:[]},number:Zl,color:function(a){var s=a.key,c=a.value,m=Hi(c);return m!=="string"?[new K(s,c,"color expected, "+m+" found")]:li(c)===null?[new K(s,c,'color expected, "'+c+'" found')]:[]},constants:xe,enum:gl,filter:uh,function:Af,layer:Vl,object:ks,source:jl,light:ou,string:Gs,formatted:function(a){return Gs(a).length===0?[]:Vu(a)},resolvedImage:function(a){return Gs(a).length===0?[]:Vu(a)}};function yi(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&dc(pt(s))?Af(a):c.expression&&Su(te(s))?Vu(a):c.type&&Hu[c.type]?Hu[c.type](a):ks(lt({},a,{valueSpec:c.type?m[c.type]:c}))}function sa(a){var s=a.value,c=a.key,m=Gs(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new K(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new K(c,s,'"glyphs" url must include a "{range}" token'))),m}function ms(a,s){s===void 0&&(s=he);var c=[];return c=c.concat(yi({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:sa,"*":function(){return[]}}})),a.constants&&(c=c.concat(xe({key:"constants",value:a.constants,style:a,styleSpec:s}))),Xc(c)}function Xc(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function us(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return Xc(a.apply(this,s))}}ms.source=us(jl),ms.light=us(ou),ms.layer=us(Vl),ms.filter=us(uh),ms.paintProperty=us(Tf),ms.layoutProperty=us(Ul);var xc=ms,Wh=xc.light,Tp=xc.paintProperty,bc=xc.layoutProperty;function Cu(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new Qe(new Error(_[m].message))),c=!0;return c}var Wu=Na;function Na(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var b=0;b<this.d*this.d;b++){var E=_[3+b],M=_[3+b+1];m.push(E===M?null:_.subarray(E,M))}var P=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],P),this.bboxes=_.subarray(P),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var z=0;z<this.d*this.d;z++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var j=c/s*a;this.min=-j,this.max=a+j}Na.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Na.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Na.prototype._insertCell=function(a,s,c,m,_,b){this.cells[_].push(b)},Na.prototype.query=function(a,s,c,m,_){var b=this.min,E=this.max;if(a<=b&&s<=b&&E<=c&&E<=m&&!_)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,s,c,m,this._queryCell,M,{},_),M},Na.prototype._queryCell=function(a,s,c,m,_,b,E,M){var P=this.cells[_];if(P!==null)for(var z=this.keys,j=this.bboxes,H=0;H<P.length;H++){var ee=P[H];if(E[ee]===void 0){var se=4*ee;(M?M(j[se+0],j[se+1],j[se+2],j[se+3]):a<=j[se+2]&&s<=j[se+3]&&c>=j[se+0]&&m>=j[se+1])?(E[ee]=!0,b.push(z[ee])):E[ee]=!1}}},Na.prototype._forEachCell=function(a,s,c,m,_,b,E,M){for(var P=this._convertToCellCoord(a),z=this._convertToCellCoord(s),j=this._convertToCellCoord(c),H=this._convertToCellCoord(m),ee=P;ee<=j;ee++)for(var se=z;se<=H;se++){var Re=this.d*se+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(se),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(se+1)))&&_.call(this,a,s,c,m,Re,b,E,M))return}},Na.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Na.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Na.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var b=s,E=0;E<a.length;E++){var M=a[E];_[3+E]=b,_.set(M,b),b+=M.length}return _[3+a.length]=b,_.set(this.keys,b),_[3+a.length+1]=b+=this.keys.length,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer};var xo=ae.ImageData,yl=ae.ImageBitmap,Aa={};function dn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Aa[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var ls in dn("Object",Object),Wu.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},Wu.deserialize=function(a){return new Wu(a.buffer)},dn("Grid",Wu),dn("Color",gi),dn("Error",Error),dn("ResolvedImage",aa),dn("StylePropertyFunction",Eu),dn("StyleExpression",js,{omit:["_evaluator"]}),dn("ZoomDependentExpression",wu),dn("ZoomConstantExpression",ml),dn("CompoundExpression",Ea,{omit:["_evaluate"]}),No)No[ls]._classRegistryKey||dn("Expression_"+ls,No[ls]);function Sc(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function $u(a){return yl&&a instanceof yl}function Is(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Sc(a)||$u(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof xo)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,b=a;_<b.length;_+=1)m.push(Is(b[_],s));return m}if(typeof a=="object"){var E=a.constructor,M=E._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var P=E.serialize?E.serialize(a,s):{};if(!E.serialize){for(var z in a)if(a.hasOwnProperty(z)&&!(Aa[M].omit.indexOf(z)>=0)){var j=a[z];P[z]=Aa[M].shallow.indexOf(z)>=0?j:Is(j,s)}a instanceof Error&&(P.message=a.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(P.$name=M),P}throw new Error("can't serialize object of type "+typeof a)}function cs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Sc(a)||$u(a)||ArrayBuffer.isView(a)||a instanceof xo)return a;if(Array.isArray(a))return a.map(cs);if(typeof a=="object"){var s=a.$name||"Object",c=Aa[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,b=Object.keys(a);_<b.length;_+=1){var E=b[_];if(E!=="$name"){var M=a[E];m[E]=Aa[s].shallow.indexOf(E)>=0?M:cs(M)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var _l=function(){this.first=!0};_l.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var Rr={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Yc(a){for(var s=0,c=a;s<c.length;s+=1)if(Gl(c[s].charCodeAt(0)))return!0;return!1}function Gl(a){return!(a!==746&&a!==747&&(a<4352||!(Rr["Bopomofo Extended"](a)||Rr.Bopomofo(a)||Rr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Rr["CJK Compatibility Ideographs"](a)||Rr["CJK Compatibility"](a)||Rr["CJK Radicals Supplement"](a)||Rr["CJK Strokes"](a)||!(!Rr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Rr["CJK Unified Ideographs Extension A"](a)||Rr["CJK Unified Ideographs"](a)||Rr["Enclosed CJK Letters and Months"](a)||Rr["Hangul Compatibility Jamo"](a)||Rr["Hangul Jamo Extended-A"](a)||Rr["Hangul Jamo Extended-B"](a)||Rr["Hangul Jamo"](a)||Rr["Hangul Syllables"](a)||Rr.Hiragana(a)||Rr["Ideographic Description Characters"](a)||Rr.Kanbun(a)||Rr["Kangxi Radicals"](a)||Rr["Katakana Phonetic Extensions"](a)||Rr.Katakana(a)&&a!==12540||!(!Rr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Rr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Rr["Unified Canadian Aboriginal Syllabics"](a)||Rr["Unified Canadian Aboriginal Syllabics Extended"](a)||Rr["Vertical Forms"](a)||Rr["Yijing Hexagram Symbols"](a)||Rr["Yi Syllables"](a)||Rr["Yi Radicals"](a))))}function Xu(a){return!(Gl(a)||function(s){return!!(Rr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Rr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Rr["Letterlike Symbols"](s)||Rr["Number Forms"](s)||Rr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Rr["Control Pictures"](s)&&s!==9251||Rr["Optical Character Recognition"](s)||Rr["Enclosed Alphanumerics"](s)||Rr["Geometric Shapes"](s)||Rr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Rr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Rr["CJK Symbols and Punctuation"](s)||Rr.Katakana(s)||Rr["Private Use Area"](s)||Rr["CJK Compatibility Forms"](s)||Rr["Small Form Variants"](s)||Rr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function gs(a){return a>=1424&&a<=2303||Rr["Arabic Presentation Forms-A"](a)||Rr["Arabic Presentation Forms-B"](a)}function qo(a,s){return!(!s&&gs(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Rr.Khmer(a))}function qc(a){for(var s=0,c=a;s<c.length;s+=1)if(gs(c[s].charCodeAt(0)))return!0;return!1}var Kc=null,Ko="unavailable",Tu=null,Jc=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Ko="error"),Kc&&Kc(a)};function Yu(){wc.fire(new Oe("pluginStateChange",{pluginStatus:Ko,pluginURL:Tu}))}var wc=new ot,Qc=function(){return Ko},Pt=function(){if(Ko!=="deferred"||!Tu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko="loading",Yu(),Tu&&Wo({url:Tu},function(a){a?Jc(a):(Ko="loaded",Yu())})},Ie={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ko==="loaded"||Ie.applyArabicShaping!=null},isLoading:function(){return Ko==="loading"},setState:function(a){Ko=a.pluginStatus,Tu=a.pluginURL},isParsed:function(){return Ie.applyArabicShaping!=null&&Ie.processBidirectionalText!=null&&Ie.processStyledBidirectionalText!=null},getPluginURL:function(){return Tu}},F=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _l,this.transition={})};F.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!qo(_[m].charCodeAt(0),c))return!1;return!0}(a,Ie.isLoaded())},F.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},F.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var su=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(dc(c))return new Eu(c,m);if(Su(c)){var _=Ef(c,m);if(_.result==="error")throw new Error(_.value.map(function(E){return E.key+": "+E.message}).join(", "));return _.value}var b=c;return typeof c=="string"&&m.type==="color"&&(b=gi.parse(c)),{kind:"constant",evaluate:function(){return b}}}(s===void 0?a.specification.default:s,a.specification)};su.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},su.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var pe=function(a){this.property=a,this.value=new su(a,void 0)};pe.prototype.transitioned=function(a,s){return new Ca(this.property,this.value,s,qt({},a.transition,this.transition),a.now)},pe.prototype.untransitioned=function(){return new Ca(this.property,this.value,null,{},0)};var qa=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};qa.prototype.getValue=function(a){return at(this._values[a].value.value)},qa.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new pe(this._values[a].property)),this._values[a].value=new su(this._values[a].property,s===null?void 0:at(s))},qa.prototype.getTransition=function(a){return at(this._values[a].transition)},qa.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new pe(this._values[a].property)),this._values[a].transition=at(s)||void 0},qa.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var b=this.getTransition(m);b!==void 0&&(a[m+"-transition"]=b)}return a},qa.prototype.transitioned=function(a,s){for(var c=new Hs(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var b=_[m];c._values[b]=this._values[b].transitioned(a,s._values[b])}return c},qa.prototype.untransitioned=function(){for(var a=new Hs(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var Ca=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Ca.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),b=this.prior;if(b){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return b.possiblyEvaluate(a,s,c);var E=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,s,c),_,function(M){if(M<=0)return 0;if(M>=1)return 1;var P=M*M,z=P*M;return 4*(M<.5?z:3*(M-P)+z-.75)}(E))}return _};var Hs=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Hs.prototype.possiblyEvaluate=function(a,s,c){for(var m=new xl(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m},Hs.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var Jo=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Jo.prototype.getValue=function(a){return at(this._values[a].value)},Jo.prototype.setValue=function(a,s){this._values[a]=new su(this._values[a].property,s===null?void 0:at(s))},Jo.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},Jo.prototype.possiblyEvaluate=function(a,s,c){for(var m=new xl(this._properties),_=0,b=Object.keys(this._values);_<b.length;_+=1){var E=b[_];m._values[E]=this._values[E].possiblyEvaluate(a,s,c)}return m};var da=function(a,s,c){this.property=a,this.value=s,this.parameters=c};da.prototype.isConstant=function(){return this.value.kind==="constant"},da.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},da.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var xl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};xl.prototype.get=function(a){return this._values[a]};var In=function(a){this.specification=a};In.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},In.prototype.interpolate=function(a,s,c){var m=Fl[this.specification.type];return m?m(a,s,c):a};var mn=function(a,s){this.specification=a,this.overrides=s};mn.prototype.possiblyEvaluate=function(a,s,c,m){return new da(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},mn.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new da(this,{kind:"constant",value:void 0},a.parameters);var m=Fl[this.specification.type];return m?new da(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},mn.prototype.evaluate=function(a,s,c,m,_,b){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,b)};var Ec=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,b){if(c.value===void 0)return new da(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var E=c.expression.evaluate(m,null,{},_,b),M=c.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(M,M,M,m);return new da(this,{kind:"constant",value:P},m)}if(c.expression.kind==="camera"){var z=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new da(this,{kind:"constant",value:z},m)}return new da(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,b,E,M){if(c.kind==="source"){var P=c.evaluate(m,_,b,E,M);return this._calculate(P,P,P,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,b),c.evaluate({zoom:Math.floor(m.zoom)},_,b),c.evaluate({zoom:Math.floor(m.zoom)+1},_,b),m):c.value},s.prototype._calculate=function(c,m,_,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(mn),Lo=function(a){this.specification=a};Lo.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new F(Math.floor(s.zoom-1),s)),a.expression.evaluate(new F(Math.floor(s.zoom),s)),a.expression.evaluate(new F(Math.floor(s.zoom+1),s)),s)}},Lo.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},Lo.prototype.interpolate=function(a){return a};var Ka=function(a){this.specification=a};Ka.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},Ka.prototype.interpolate=function(){return!1};var uo=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new su(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new pe(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};dn("DataDrivenProperty",mn),dn("DataConstantProperty",In),dn("CrossFadedDataDrivenProperty",Ec),dn("CrossFadedProperty",Lo),dn("ColorRampProperty",Ka);var Ps=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new Jo(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new qa(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var b in c.layout)this.setLayoutProperty(b,c.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xl(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(bc,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return dr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(Tp,"layers."+this.id+".paint."+c,c,m,_))return!1;if(dr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var b=this._transitionablePaint._values[c],E=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),P=b.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var z=this._transitionablePaint._values[c].value;return z.isDataDriven()||M||E||this._handleOverridablePaintPropertyUpdate(c,P,z)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),_t(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,b,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&Cu(this,c.call(xc,{key:m,layerType:this.type,objectKey:_,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof da&&au(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(ot),Qo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ac=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ha(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var b=Qo[_.type].BYTES_PER_ELEMENT,E=c=Mf(c,Math.max(s,b)),M=_.components||1;return m=Math.max(m,b),c+=b*M,{name:_.name,type:_.type,components:M,offset:E}}),size:Mf(c,Math.max(m,s)),alignment:s}}function Mf(a,s){return Math.ceil(a/s)*s}ki.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},ki.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ki.prototype.clear=function(){this.length=0},ki.prototype.resize=function(a){this.reserve(a),this.length=a},ki.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.int16[b+0]=m,this.int16[b+1]=_,c},s}(ki);qu.prototype.bytesPerElement=4,dn("StructArrayLayout2i4",qu);var ef=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.int16[M+0]=m,this.int16[M+1]=_,this.int16[M+2]=b,this.int16[M+3]=E,c},s}(ki);ef.prototype.bytesPerElement=8,dn("StructArrayLayout4i8",ef);var Ls=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var z=6*c;return this.int16[z+0]=m,this.int16[z+1]=_,this.int16[z+2]=b,this.int16[z+3]=E,this.int16[z+4]=M,this.int16[z+5]=P,c},s}(ki);Ls.prototype.bytesPerElement=12,dn("StructArrayLayout2i4i12",Ls);var Zo=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var z=4*c,j=8*c;return this.int16[z+0]=m,this.int16[z+1]=_,this.uint8[j+4]=b,this.uint8[j+5]=E,this.uint8[j+6]=M,this.uint8[j+7]=P,c},s}(ki);Zo.prototype.bytesPerElement=8,dn("StructArrayLayout2i4ub8",Zo);var bl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.float32[b+0]=m,this.float32[b+1]=_,c},s}(ki);bl.prototype.bytesPerElement=8,dn("StructArrayLayout2f8",bl);var uu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,z,j,H){var ee=this.length;return this.resize(ee+1),this.emplace(ee,c,m,_,b,E,M,P,z,j,H)},s.prototype.emplace=function(c,m,_,b,E,M,P,z,j,H,ee){var se=10*c;return this.uint16[se+0]=m,this.uint16[se+1]=_,this.uint16[se+2]=b,this.uint16[se+3]=E,this.uint16[se+4]=M,this.uint16[se+5]=P,this.uint16[se+6]=z,this.uint16[se+7]=j,this.uint16[se+8]=H,this.uint16[se+9]=ee,c},s}(ki);uu.prototype.bytesPerElement=20,dn("StructArrayLayout10ui20",uu);var tf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,z,j,H,ee,se){var Re=this.length;return this.resize(Re+1),this.emplace(Re,c,m,_,b,E,M,P,z,j,H,ee,se)},s.prototype.emplace=function(c,m,_,b,E,M,P,z,j,H,ee,se,Re){var Be=12*c;return this.int16[Be+0]=m,this.int16[Be+1]=_,this.int16[Be+2]=b,this.int16[Be+3]=E,this.uint16[Be+4]=M,this.uint16[Be+5]=P,this.uint16[Be+6]=z,this.uint16[Be+7]=j,this.int16[Be+8]=H,this.int16[Be+9]=ee,this.int16[Be+10]=se,this.int16[Be+11]=Re,c},s}(ki);tf.prototype.bytesPerElement=24,dn("StructArrayLayout4i4ui4i24",tf);var Hl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.float32[E+0]=m,this.float32[E+1]=_,this.float32[E+2]=b,c},s}(ki);Hl.prototype.bytesPerElement=12,dn("StructArrayLayout3f12",Hl);var Cc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(ki);Cc.prototype.bytesPerElement=4,dn("StructArrayLayout1ul4",Cc);var kf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,z,j){var H=this.length;return this.resize(H+1),this.emplace(H,c,m,_,b,E,M,P,z,j)},s.prototype.emplace=function(c,m,_,b,E,M,P,z,j,H){var ee=10*c,se=5*c;return this.int16[ee+0]=m,this.int16[ee+1]=_,this.int16[ee+2]=b,this.int16[ee+3]=E,this.int16[ee+4]=M,this.int16[ee+5]=P,this.uint32[se+3]=z,this.uint16[ee+8]=j,this.uint16[ee+9]=H,c},s}(ki);kf.prototype.bytesPerElement=20,dn("StructArrayLayout6i1ul2ui20",kf);var Wl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,b,E,M)},s.prototype.emplace=function(c,m,_,b,E,M,P){var z=6*c;return this.int16[z+0]=m,this.int16[z+1]=_,this.int16[z+2]=b,this.int16[z+3]=E,this.int16[z+4]=M,this.int16[z+5]=P,c},s}(ki);Wl.prototype.bytesPerElement=12,dn("StructArrayLayout2i2i2i12",Wl);var Ku=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E){var M=this.length;return this.resize(M+1),this.emplace(M,c,m,_,b,E)},s.prototype.emplace=function(c,m,_,b,E,M){var P=4*c,z=8*c;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=b,this.int16[z+6]=E,this.int16[z+7]=M,c},s}(ki);Ku.prototype.bytesPerElement=16,dn("StructArrayLayout2f1f2i16",Ku);var Ws=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=12*c,P=3*c;return this.uint8[M+0]=m,this.uint8[M+1]=_,this.float32[P+1]=b,this.float32[P+2]=E,c},s}(ki);Ws.prototype.bytesPerElement=12,dn("StructArrayLayout2ub2f12",Ws);var Ju=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.uint16[E+0]=m,this.uint16[E+1]=_,this.uint16[E+2]=b,c},s}(ki);Ju.prototype.bytesPerElement=6,dn("StructArrayLayout3ui6",Ju);var Mu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt){var kt=this.length;return this.resize(kt+1),this.emplace(kt,c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt)},s.prototype.emplace=function(c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt,kt){var Lt=24*c,$t=12*c,ur=48*c;return this.int16[Lt+0]=m,this.int16[Lt+1]=_,this.uint16[Lt+2]=b,this.uint16[Lt+3]=E,this.uint32[$t+2]=M,this.uint32[$t+3]=P,this.uint32[$t+4]=z,this.uint16[Lt+10]=j,this.uint16[Lt+11]=H,this.uint16[Lt+12]=ee,this.float32[$t+7]=se,this.float32[$t+8]=Re,this.uint8[ur+36]=Be,this.uint8[ur+37]=tt,this.uint8[ur+38]=Ge,this.uint32[$t+10]=dt,this.int16[Lt+22]=kt,c},s}(ki);Mu.prototype.bytesPerElement=48,dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Mu);var $l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt,kt,Lt,$t,ur,Fr,Yr,Rn,on,Bn,un,nn){var jr=this.length;return this.resize(jr+1),this.emplace(jr,c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt,kt,Lt,$t,ur,Fr,Yr,Rn,on,Bn,un,nn)},s.prototype.emplace=function(c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be,tt,Ge,dt,kt,Lt,$t,ur,Fr,Yr,Rn,on,Bn,un,nn,jr){var An=34*c,Ti=17*c;return this.int16[An+0]=m,this.int16[An+1]=_,this.int16[An+2]=b,this.int16[An+3]=E,this.int16[An+4]=M,this.int16[An+5]=P,this.int16[An+6]=z,this.int16[An+7]=j,this.uint16[An+8]=H,this.uint16[An+9]=ee,this.uint16[An+10]=se,this.uint16[An+11]=Re,this.uint16[An+12]=Be,this.uint16[An+13]=tt,this.uint16[An+14]=Ge,this.uint16[An+15]=dt,this.uint16[An+16]=kt,this.uint16[An+17]=Lt,this.uint16[An+18]=$t,this.uint16[An+19]=ur,this.uint16[An+20]=Fr,this.uint16[An+21]=Yr,this.uint16[An+22]=Rn,this.uint32[Ti+12]=on,this.float32[Ti+13]=Bn,this.float32[Ti+14]=un,this.float32[Ti+15]=nn,this.float32[Ti+16]=jr,c},s}(ki);$l.prototype.bytesPerElement=68,dn("StructArrayLayout8i15ui1ul4f68",$l);var $s=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(ki);$s.prototype.bytesPerElement=4,dn("StructArrayLayout1f4",$s);var Rs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=3*c;return this.int16[E+0]=m,this.int16[E+1]=_,this.int16[E+2]=b,c},s}(ki);Rs.prototype.bytesPerElement=6,dn("StructArrayLayout3i6",Rs);var Qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var b=this.length;return this.resize(b+1),this.emplace(b,c,m,_)},s.prototype.emplace=function(c,m,_,b){var E=4*c;return this.uint32[2*c+0]=m,this.uint16[E+2]=_,this.uint16[E+3]=b,c},s}(ki);Qu.prototype.bytesPerElement=8,dn("StructArrayLayout1ul2ui8",Qu);var Tc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var b=2*c;return this.uint16[b+0]=m,this.uint16[b+1]=_,c},s}(ki);Tc.prototype.bytesPerElement=4,dn("StructArrayLayout2ui4",Tc);var ch=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(ki);ch.prototype.bytesPerElement=2,dn("StructArrayLayout1ui2",ch);var rf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,b){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,_,b)},s.prototype.emplace=function(c,m,_,b,E){var M=4*c;return this.float32[M+0]=m,this.float32[M+1]=_,this.float32[M+2]=b,this.float32[M+3]=E,c},s}(ki);rf.prototype.bytesPerElement=16,dn("StructArrayLayout4f16",rf);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new ie(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(Ac);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(kf);dn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(Ac);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(Mu);dn("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(Ac);w.prototype.size=68;var C=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}($l);dn("SymbolInstanceArray",C);var T=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}($s);dn("GlyphOffsetArray",T);var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Rs);dn("SymbolLineVertexArray",I);var U=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(Ac);U.prototype.size=8;var $=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new U(this,c)},s}(Qu);dn("FeatureIndexArray",$);var le=Ha([{name:"a_pos",components:2,type:"Int16"}],4).members,ve=function(a){a===void 0&&(a=[]),this.segments=a};function ye(a,s){return 256*(a=It(Math.floor(a),0,255))+It(Math.floor(s),0,255)}ve.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>ve.MAX_VERTEX_ARRAY_LENGTH&&ft("Max vertices per segment is "+ve.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>ve.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},ve.prototype.get=function(){return this.segments},ve.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},ve.simpleSegment=function(a,s,c,m){return new ve([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},ve.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn("SegmentVector",ve);var ze=Ha([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fe=oe(function(a){a.exports=function(s,c){var m,_,b,E,M,P,z,j;for(_=s.length-(m=3&s.length),b=c,M=3432918353,P=461845907,j=0;j<_;)z=255&s.charCodeAt(j)|(255&s.charCodeAt(++j))<<8|(255&s.charCodeAt(++j))<<16|(255&s.charCodeAt(++j))<<24,++j,b=27492+(65535&(E=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(z=0,m){case 3:z^=(255&s.charCodeAt(j+2))<<16;case 2:z^=(255&s.charCodeAt(j+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&s.charCodeAt(j)))*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*P+(((z>>>16)*P&65535)<<16)&4294967295}return b^=s.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ye=oe(function(a){a.exports=function(s,c){for(var m,_=s.length,b=c^_,E=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24))+((1540483477*(m>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++E;switch(_){case 3:b^=(255&s.charCodeAt(E+2))<<16;case 2:b^=(255&s.charCodeAt(E+1))<<8;case 1:b=1540483477*(65535&(b^=255&s.charCodeAt(E)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Pe=Fe,Xe=Ye;Pe.murmur3=Fe,Pe.murmur2=Xe;var st=function(){this.ids=[],this.positions=[],this.indexed=!1};st.prototype.add=function(a,s,c,m){this.ids.push(Wt(a)),this.positions.push(s,c,m)},st.prototype.getPositions=function(a){for(var s=Wt(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var b=[];this.ids[c]===s;)b.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return b},st.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(b,E,M,P){for(;M<P;){for(var z=b[M+P>>1],j=M-1,H=P+1;;){do j++;while(b[j]<z);do H--;while(b[H]>z);if(j>=H)break;Zt(b,j,H),Zt(E,3*j,3*H),Zt(E,3*j+1,3*H+1),Zt(E,3*j+2,3*H+2)}H-M<P-H?(_(b,E,M,H),M=H+1):(_(b,E,H+1,P),P=H)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},st.deserialize=function(a){var s=new st;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Ct=Math.pow(2,53)-1;function Wt(a){var s=+a;return!isNaN(s)&&s<=Ct?s:Pe(String(a))}function Zt(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}dn("FeaturePositionMap",st);var Ht=function(a,s){this.gl=a.gl,this.location=s},hr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(Ht),Nr=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(Ht),Dr=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(Ht),an=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(Ht),En=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(Ht),Dn=function(a){function s(c,m){a.call(this,c,m),this.current=gi.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(Ht),On=new Float32Array(16),Li=function(a){function s(c,m){a.call(this,c,m),this.current=On}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(Ht);function fn(a){return[ye(255*a.r,255*a.g),ye(255*a.b,255*a.a)]}var Wn=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};Wn.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},Wn.prototype.getBinding=function(a,s,c){return this.type==="color"?new Dn(a,s):new Nr(a,s)};var ai=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ai.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},ai.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},ai.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new En(a,s):new Nr(a,s)};var Jn=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};Jn.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.paintVertexArray.length,E=this.expression.evaluate(new F(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(b,a,E)},Jn.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},Jn.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=fn(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var b=a;b<s;b++)this.paintVertexArray.emplace(b,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},Jn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var $n=function(a,s,c,m,_,b){this.expression=a,this.uniformNames=s.map(function(E){return"u_"+E+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(E){return{name:"a_"+E,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new b};$n.prototype.populatePaintArray=function(a,s,c,m,_){var b=this.expression.evaluate(new F(this.zoom),s,{},m,[],_),E=this.expression.evaluate(new F(this.zoom+1),s,{},m,[],_),M=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(M,a,b,E)},$n.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),b=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,b)},$n.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=fn(c),b=fn(m),E=a;E<s;E++)this.paintVertexArray.emplace(E,_[0],_[1],b[0],b[1]);else{for(var M=a;M<s;M++)this.paintVertexArray.emplace(M,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},$n.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},$n.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=It(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},$n.prototype.getBinding=function(a,s,c){return new Nr(a,s)};var ci=function(a,s,c,m,_,b){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};ci.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},ci.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},ci.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],b=m[c.mid],E=m[c.max];if(_&&b&&E)for(var M=a;M<s;M++)this.zoomInPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],b.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],b.pixelRatio,E.pixelRatio)}},ci.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))},ci.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Xn=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var b=a.paint.get(_);if(b instanceof da&&au(b.property.specification)){var E=Ja(_,a.type),M=b.value,P=b.property.specification.type,z=b.property.useIntegerZoom,j=b.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[_]=H?new ai(M.value,E):new Wn(M.value,E,P),m.push("/u_"+_);else if(M.kind==="source"||H){var ee=va(_,P,"source");this.binders[_]=H?new ci(M,P,z,s,ee,a.id):new Jn(M,E,P,ee),m.push("/a_"+_)}else{var se=va(_,P,"composite");this.binders[_]=new $n(M,E,P,z,s,se),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};Xn.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof Jn||s instanceof $n?s.maxValue:0},Xn.prototype.populatePaintArrays=function(a,s,c,m,_){for(var b in this.binders){var E=this.binders[b];(E instanceof Jn||E instanceof $n||E instanceof ci)&&E.populatePaintArray(a,s,c,m,_)}},Xn.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof ai&&m.setConstantPatternPositions(a,s)}},Xn.prototype.updatePaintArrays=function(a,s,c,m,_){var b=!1;for(var E in a)for(var M=0,P=s.getPositions(E);M<P.length;M+=1){var z=P[M],j=c.feature(z.index);for(var H in this.binders){var ee=this.binders[H];if((ee instanceof Jn||ee instanceof $n||ee instanceof ci)&&ee.expression.isStateDependent===!0){var se=m.paint.get(H);ee.expression=se.value,ee.updatePaintArray(z.start,z.end,j,a[E],_),b=!0}}}return b},Xn.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof Wn||c instanceof ai)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},Xn.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Jn||c instanceof $n)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof ci)for(var _=0;_<ze.members.length;_++)a.push(ze.members[_].name)}return a},Xn.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Wn||c instanceof ai||c instanceof $n)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},Xn.prototype.getPaintVertexBuffers=function(){return this._buffers},Xn.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof Wn||_ instanceof ai||_ instanceof $n)for(var b=0,E=_.uniformNames;b<E.length;b+=1){var M=E[b];if(s[M]){var P=_.getBinding(a,s[M],M);c.push({name:M,property:m,binding:P})}}}return c},Xn.prototype.setUniforms=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1){var E=b[_],M=E.name,P=E.property;this.binders[P].setUniform(E.binding,m,c.get(P),M)}},Xn.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof ci){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof Jn||c instanceof $n)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},Xn.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof Jn||c instanceof $n||c instanceof ci)&&c.upload(a)}this.updatePaintBuffers()},Xn.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof Jn||s instanceof $n||s instanceof ci)&&s.destroy()}};var jn=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var b=_[m];this.programConfigurations[b.id]=new Xn(b,s,c)}this.needsUpload=!1,this._featureMap=new st,this._bufferOffset=0};function Ja(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function va(a,s,c){var m={color:{source:bl,composite:rf},number:{source:$s,composite:bl}},_=function(b){return{"line-pattern":{source:uu,composite:uu},"fill-pattern":{source:uu,composite:uu},"fill-extrusion-pattern":{source:uu,composite:uu}}[b]}(a);return _&&_[c]||m[s][c]}jn.prototype.populatePaintArrays=function(a,s,c,m,_,b){for(var E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,s,m,_,b);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},jn.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,b=c;_<b.length;_+=1){var E=b[_];this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(a,this._featureMap,s,E,m)||this.needsUpload}},jn.prototype.get=function(a){return this.programConfigurations[a]},jn.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},jn.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},dn("ConstantBinder",Wn),dn("CrossFadedConstantBinder",ai),dn("SourceExpressionBinder",Jn),dn("CrossFadedCompositeBinder",ci),dn("CompositeExpressionBinder",$n),dn("ProgramConfiguration",Xn,{omit:["_buffers"]}),dn("ProgramConfigurationSet",jn);var bo=Math.pow(2,14)-1,So=-bo-1;function _a(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],b=0;b<_.length;b++){var E=_[b],M=Math.round(E.x*s),P=Math.round(E.y*s);E.x=It(M,So,bo),E.y=It(P,So,bo),(M<E.x||M>E.x+1||P<E.y||P>E.y+1)&&ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function Ta(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?_a(a):[]}}function es(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var Uo=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new qu,this.indexArray=new Ju,this.segments=new ve,this.programConfigurations=new jn(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function ku(a,s){for(var c=0;c<a.length;c++)if(Ds(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(Ds(a,s[m]))return!0;return!!lu(a,s)}function Ro(a,s,c){return!!Ds(a,s)||!!tl(s,a,c)}function ys(a,s){if(a.length===1)return Sl(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(Ds(a,m[_]))return!0;for(var b=0;b<a.length;b++)if(Sl(s,a[b]))return!0;for(var E=0;E<s.length;E++)if(lu(a,s[E]))return!0;return!1}function _s(a,s,c){if(a.length>1){if(lu(a,s))return!0;for(var m=0;m<s.length;m++)if(tl(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(tl(a[_],s,c))return!0;return!1}function lu(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],b=0;b<s.length-1;b++)if(el(m,_,s[b],s[b+1]))return!0;return!1}function el(a,s,c,m){return Kt(a,c,m)!==Kt(s,c,m)&&Kt(a,s,c)!==Kt(a,s,m)}function tl(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(rl(a,s[_-1],s[_])<m)return!0;return!1}function rl(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Sl(a,s){for(var c,m,_,b=!1,E=0;E<a.length;E++)for(var M=0,P=(c=a[E]).length-1;M<c.length;P=M++)(m=c[M]).y>s.y!=(_=c[P]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(b=!b);return b}function Ds(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var b=a[m],E=a[_];b.y>s.y!=E.y>s.y&&s.x<(E.x-b.x)*(s.y-b.y)/(E.y-b.y)+b.x&&(c=!c)}return c}function Iu(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var b=Kt(a,s,c[0]);return b!==Kt(a,s,c[1])||b!==Kt(a,s,c[2])||b!==Kt(a,s,c[3])}function Xs(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function Ma(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function cu(a,s,c,m,_){if(!s[0]&&!s[1])return a;var b=ie.convert(s)._mult(_);c==="viewport"&&b._rotate(-m);for(var E=[],M=0;M<a.length;M++)E.push(a[M].sub(b));return E}Uo.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],b=null;m.type==="circle"&&(b=m.layout.get("circle-sort-key"));for(var E=0,M=a;E<M.length;E+=1){var P=M[E],z=P.feature,j=P.id,H=P.index,ee=P.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,Re=Ta(z,se);if(this.layers[0]._featureFilter.filter(new F(this.zoom),Re,c)){var Be=b?b.evaluate(Re,{},c):void 0,tt={id:j,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:H,geometry:se?Re.geometry:_a(z),patterns:{},sortKey:Be};_.push(tt)}}b&&_.sort(function(Yr,Rn){return Yr.sortKey-Rn.sortKey});for(var Ge=0,dt=_;Ge<dt.length;Ge+=1){var kt=dt[Ge],Lt=kt.geometry,$t=kt.index,ur=kt.sourceLayerIndex,Fr=a[$t].feature;this.addFeature(kt,Lt,$t,c),s.featureIndex.insert(Fr,Lt,$t,ur,this.index)}},Uo.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Uo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uo.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Uo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uo.prototype.addFeature=function(a,s,c,m){for(var _=0,b=s;_<b.length;_+=1)for(var E=0,M=b[_];E<M.length;E+=1){var P=M[E],z=P.x,j=P.y;if(!(z<0||z>=8192||j<0||j>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ee=H.vertexLength;es(this.layoutVertexArray,z,j,-1,-1),es(this.layoutVertexArray,z,j,1,-1),es(this.layoutVertexArray,z,j,1,1),es(this.layoutVertexArray,z,j,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},dn("CircleBucket",Uo,{omit:["layers"]});var Ys=new uo({"circle-sort-key":new mn(he.layout_circle["circle-sort-key"])}),fs={paint:new uo({"circle-radius":new mn(he.paint_circle["circle-radius"]),"circle-color":new mn(he.paint_circle["circle-color"]),"circle-blur":new mn(he.paint_circle["circle-blur"]),"circle-opacity":new mn(he.paint_circle["circle-opacity"]),"circle-translate":new In(he.paint_circle["circle-translate"]),"circle-translate-anchor":new In(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mn(he.paint_circle["circle-stroke-opacity"])}),layout:Ys},Oi=typeof Float32Array!="undefined"?Float32Array:Array;function Qa(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function eo(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=s[4],P=s[5],z=s[6],j=s[7],H=s[8],ee=s[9],se=s[10],Re=s[11],Be=s[12],tt=s[13],Ge=s[14],dt=s[15],kt=c[0],Lt=c[1],$t=c[2],ur=c[3];return a[0]=kt*m+Lt*M+$t*H+ur*Be,a[1]=kt*_+Lt*P+$t*ee+ur*tt,a[2]=kt*b+Lt*z+$t*se+ur*Ge,a[3]=kt*E+Lt*j+$t*Re+ur*dt,a[4]=(kt=c[4])*m+(Lt=c[5])*M+($t=c[6])*H+(ur=c[7])*Be,a[5]=kt*_+Lt*P+$t*ee+ur*tt,a[6]=kt*b+Lt*z+$t*se+ur*Ge,a[7]=kt*E+Lt*j+$t*Re+ur*dt,a[8]=(kt=c[8])*m+(Lt=c[9])*M+($t=c[10])*H+(ur=c[11])*Be,a[9]=kt*_+Lt*P+$t*ee+ur*tt,a[10]=kt*b+Lt*z+$t*se+ur*Ge,a[11]=kt*E+Lt*j+$t*Re+ur*dt,a[12]=(kt=c[12])*m+(Lt=c[13])*M+($t=c[14])*H+(ur=c[15])*Be,a[13]=kt*_+Lt*P+$t*ee+ur*tt,a[14]=kt*b+Lt*z+$t*se+ur*Ge,a[15]=kt*E+Lt*j+$t*Re+ur*dt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var xs,Pu=eo;function fu(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*b+c[12]*E,a[1]=c[1]*m+c[5]*_+c[9]*b+c[13]*E,a[2]=c[2]*m+c[6]*_+c[10]*b+c[14]*E,a[3]=c[3]*m+c[7]*_+c[11]*b+c[15]*E,a}xs=new Oi(3),Oi!=Float32Array&&(xs[0]=0,xs[1]=0,xs[2]=0),function(){var a=new Oi(4);Oi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var ko=(function(){var a=new Oi(2);Oi!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,fs)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Uo(c)},s.prototype.queryRadius=function(c){var m=c;return Xs("circle-radius",this,m)+Xs("circle-stroke-width",this,m)+Ma(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P,z){for(var j=cu(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,P),H=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),ee=this.paint.get("circle-pitch-alignment")==="map",se=ee?j:function(Fr,Yr){return Fr.map(function(Rn){return Mr(Rn,Yr)})}(j,z),Re=ee?H*P:H,Be=0,tt=b;Be<tt.length;Be+=1)for(var Ge=0,dt=tt[Be];Ge<dt.length;Ge+=1){var kt=dt[Ge],Lt=ee?kt:Mr(kt,z),$t=Re,ur=fu([],[kt.x,kt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$t*=ur[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($t*=M.cameraToCenterDistance/ur[3]),Ro(se,Lt,$t))return!0}return!1},s}(Ps));function Mr(a,s){var c=fu([],[a.x,a.y,0,1],s);return new ie(c[0]/c[3],c[1]/c[3])}var nl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Uo);function Lu(a,s,c,m){var _=s.width,b=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*b*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*b*c);return a.width=_,a.height=b,a.data=m,a}function xa(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var b=Lu({},{width:m,height:_},c);hu(a,b,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=b.data}}function hu(a,s,c,m,_,b){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=a.data,M=s.data,P=0;P<_.height;P++)for(var z=((c.y+P)*a.width+c.x)*b,j=((m.y+P)*s.width+m.x)*b,H=0;H<_.width*b;H++)M[j+H]=E[z+H];return s}dn("HeatmapBucket",nl,{omit:["layers"]});var ts=function(a,s){Lu(this,a,1,s)};ts.prototype.resize=function(a){xa(this,a,1)},ts.prototype.clone=function(){return new ts({width:this.width,height:this.height},new Uint8Array(this.data))},ts.copy=function(a,s,c,m,_){hu(a,s,c,m,_,1)};var to=function(a,s){Lu(this,a,4,s)};to.prototype.resize=function(a){xa(this,a,4)},to.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},to.prototype.clone=function(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))},to.copy=function(a,s,c,m,_){hu(a,s,c,m,_,4)},dn("AlphaImage",ts),dn("RGBAImage",to);var Xl={paint:new uo({"heatmap-radius":new mn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ka(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(he.paint_heatmap["heatmap-opacity"])})};function Mc(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new to({width:c,height:m}),b=function(Re,Be,tt){s[a.evaluationKey]=tt;var Ge=a.expression.evaluate(s);_.data[Re+Be+0]=Math.floor(255*Ge.r/Ge.a),_.data[Re+Be+1]=Math.floor(255*Ge.g/Ge.a),_.data[Re+Be+2]=Math.floor(255*Ge.b/Ge.a),_.data[Re+Be+3]=Math.floor(255*Ge.a)};if(a.clips)for(var E=0,M=0;E<m;++E,M+=4*c)for(var P=0,z=0;P<c;P++,z+=4){var j=P/(c-1),H=a.clips[E];b(M,z,H.start*(1-j)+H.end*j)}else for(var ee=0,se=0;ee<c;ee++,se+=4)b(0,se,ee/(c-1));return _}var fh=function(a){function s(c){a.call(this,c,Xl),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new nl(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Mc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Ps),Sd={paint:new uo({"hillshade-illumination-direction":new In(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(he.paint_hillshade["hillshade-accent-color"])})},Mp=function(a){function s(c){a.call(this,c,Sd)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Ps),hh=Ha([{name:"a_pos",components:2,type:"Int16"}],4).members,il=If,ph=If;function If(a,s,c){c=c||2;var m,_,b,E,M,P,z,j=s&&s.length,H=j?s[0]*c:a.length,ee=wd(a,0,H,c,!0),se=[];if(!ee||ee.next===ee.prev)return se;if(j&&(ee=function(Be,tt,Ge,dt){var kt,Lt,$t,ur=[];for(kt=0,Lt=tt.length;kt<Lt;kt++)($t=wd(Be,tt[kt]*dt,kt<Lt-1?tt[kt+1]*dt:Be.length,dt,!1))===$t.next&&($t.steiner=!0),ur.push(Uv($t));for(ur.sort(Zv),kt=0;kt<ur.length;kt++)$h(ur[kt],Ge),Ge=Yl(Ge,Ge.next);return Ge}(a,s,ee,c)),a.length>80*c){m=b=a[0],_=E=a[1];for(var Re=c;Re<H;Re+=c)(M=a[Re])<m&&(m=M),(P=a[Re+1])<_&&(_=P),M>b&&(b=M),P>E&&(E=P);z=(z=Math.max(b-m,E-_))!==0?1/z:0}return Pf(ee,se,c,m,_,z),se}function wd(a,s,c,m,_){var b,E;if(_===Jl(a,s,c,m)>0)for(b=s;b<c;b+=m)E=Lf(b,a[b],a[b+1],E);else for(b=c-m;b>=s;b-=m)E=Lf(b,a[b],a[b+1],E);return E&&nf(E,E.next)&&(Kl(E),E=E.next),E}function Yl(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!nf(m,m.next)&&ka(m.prev,m,m.next)!==0)m=m.next;else{if(Kl(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function Pf(a,s,c,m,_,b,E){if(a){!E&&b&&function(j,H,ee,se){var Re=j;do Re.z===null&&(Re.z=Pp(Re.x,Re.y,H,ee,se)),Re.prevZ=Re.prev,Re.nextZ=Re.next,Re=Re.next;while(Re!==j);Re.prevZ.nextZ=null,Re.prevZ=null,function(Be){var tt,Ge,dt,kt,Lt,$t,ur,Fr,Yr=1;do{for(Ge=Be,Be=null,Lt=null,$t=0;Ge;){for($t++,dt=Ge,ur=0,tt=0;tt<Yr&&(ur++,dt=dt.nextZ);tt++);for(Fr=Yr;ur>0||Fr>0&&dt;)ur!==0&&(Fr===0||!dt||Ge.z<=dt.z)?(kt=Ge,Ge=Ge.nextZ,ur--):(kt=dt,dt=dt.nextZ,Fr--),Lt?Lt.nextZ=kt:Be=kt,kt.prevZ=Lt,Lt=kt;Ge=dt}Lt.nextZ=null,Yr*=2}while($t>1)}(Re)}(a,m,_,b);for(var M,P,z=a;a.prev!==a.next;)if(M=a.prev,P=a.next,b?Ad(a,m,_,b):Ed(a))s.push(M.i/c),s.push(a.i/c),s.push(P.i/c),Kl(a),a=P.next,z=P.next;else if((a=P)===z){E?E===1?Pf(a=Cd(Yl(a),s,c),s,c,m,_,b,2):E===2&&kp(a,s,c,m,_,b):Pf(Yl(a),s,c,m,_,b,1);break}}}function Ed(a){var s=a.prev,c=a,m=a.next;if(ka(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(pu(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&ka(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Ad(a,s,c,m){var _=a.prev,b=a,E=a.next;if(ka(_,b,E)>=0)return!1;for(var M=_.x>b.x?_.x>E.x?_.x:E.x:b.x>E.x?b.x:E.x,P=_.y>b.y?_.y>E.y?_.y:E.y:b.y>E.y?b.y:E.y,z=Pp(_.x<b.x?_.x<E.x?_.x:E.x:b.x<E.x?b.x:E.x,_.y<b.y?_.y<E.y?_.y:E.y:b.y<E.y?b.y:E.y,s,c,m),j=Pp(M,P,s,c,m),H=a.prevZ,ee=a.nextZ;H&&H.z>=z&&ee&&ee.z<=j;){if(H!==a.prev&&H!==a.next&&pu(_.x,_.y,b.x,b.y,E.x,E.y,H.x,H.y)&&ka(H.prev,H,H.next)>=0||(H=H.prevZ,ee!==a.prev&&ee!==a.next&&pu(_.x,_.y,b.x,b.y,E.x,E.y,ee.x,ee.y)&&ka(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;H&&H.z>=z;){if(H!==a.prev&&H!==a.next&&pu(_.x,_.y,b.x,b.y,E.x,E.y,H.x,H.y)&&ka(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;ee&&ee.z<=j;){if(ee!==a.prev&&ee!==a.next&&pu(_.x,_.y,b.x,b.y,E.x,E.y,ee.x,ee.y)&&ka(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Cd(a,s,c){var m=a;do{var _=m.prev,b=m.next.next;!nf(_,b)&&vh(_,m,m.next,b)&&ql(_,b)&&ql(b,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(b.i/c),Kl(m),Kl(m.next),m=a=b),m=m.next}while(m!==a);return Yl(m)}function kp(a,s,c,m,_,b){var E=a;do{for(var M=E.next.next;M!==E.prev;){if(E.i!==M.i&&dh(E,M)){var P=mh(E,M);return E=Yl(E,E.next),P=Yl(P,P.next),Pf(E,s,c,m,_,b),void Pf(P,s,c,m,_,b)}M=M.next}E=E.next}while(E!==a)}function Zv(a,s){return a.x-s.x}function $h(a,s){if(s=function(m,_){var b,E=_,M=m.x,P=m.y,z=-1/0;do{if(P<=E.y&&P>=E.next.y&&E.next.y!==E.y){var j=E.x+(P-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(j<=M&&j>z){if(z=j,j===M){if(P===E.y)return E;if(P===E.next.y)return E.next}b=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!b)return null;if(M===z)return b;var H,ee=b,se=b.x,Re=b.y,Be=1/0;E=b;do M>=E.x&&E.x>=se&&M!==E.x&&pu(P<Re?M:z,P,se,Re,P<Re?z:M,P,E.x,E.y)&&(H=Math.abs(P-E.y)/(M-E.x),ql(E,m)&&(H<Be||H===Be&&(E.x>b.x||E.x===b.x&&Ip(b,E)))&&(b=E,Be=H)),E=E.next;while(E!==ee);return b}(a,s)){var c=mh(s,a);Yl(s,s.next),Yl(c,c.next)}}function Ip(a,s){return ka(a.prev,a,s.prev)<0&&ka(s.next,a,a.next)<0}function Pp(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Uv(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function pu(a,s,c,m,_,b,E,M){return(_-E)*(s-M)-(a-E)*(b-M)>=0&&(a-E)*(m-M)-(c-E)*(s-M)>=0&&(c-E)*(b-M)-(_-E)*(m-M)>=0}function dh(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&vh(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(ql(a,s)&&ql(s,a)&&function(c,m){var _=c,b=!1,E=(c.x+m.x)/2,M=(c.y+m.y)/2;do _.y>M!=_.next.y>M&&_.next.y!==_.y&&E<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==c);return b}(a,s)&&(ka(a.prev,a,s.prev)||ka(a,s.prev,s))||nf(a,s)&&ka(a.prev,a,a.next)>0&&ka(s.prev,s,s.next)>0)}function ka(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function nf(a,s){return a.x===s.x&&a.y===s.y}function vh(a,s,c,m){var _=wl(ka(a,s,c)),b=wl(ka(a,s,m)),E=wl(ka(c,m,a)),M=wl(ka(c,m,s));return _!==b&&E!==M||!(_!==0||!af(a,c,s))||!(b!==0||!af(a,m,s))||!(E!==0||!af(c,a,m))||!(M!==0||!af(c,s,m))}function af(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function wl(a){return a>0?1:a<0?-1:0}function ql(a,s){return ka(a.prev,a,a.next)<0?ka(a,s,a.next)>=0&&ka(a,a.prev,s)>=0:ka(a,s,a.prev)<0||ka(a,a.next,s)<0}function mh(a,s){var c=new Rf(a.i,a.x,a.y),m=new Rf(s.i,s.x,s.y),_=a.next,b=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,b.next=m,m.prev=b,m}function Lf(a,s,c,m){var _=new Rf(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function Kl(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Rf(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jl(a,s,c,m){for(var _=0,b=s,E=c-m;b<c;b+=m)_+=(a[E]-a[b])*(a[b+1]+a[E+1]),E=b;return _}function kc(a,s,c,m,_){(function b(E,M,P,z,j){for(;z>P;){if(z-P>600){var H=z-P+1,ee=M-P+1,se=Math.log(H),Re=.5*Math.exp(2*se/3),Be=.5*Math.sqrt(se*Re*(H-Re)/H)*(ee-H/2<0?-1:1);b(E,M,Math.max(P,Math.floor(M-ee*Re/H+Be)),Math.min(z,Math.floor(M+(H-ee)*Re/H+Be)),j)}var tt=E[M],Ge=P,dt=z;for(al(E,P,M),j(E[z],tt)>0&&al(E,P,z);Ge<dt;){for(al(E,Ge,dt),Ge++,dt--;j(E[Ge],tt)<0;)Ge++;for(;j(E[dt],tt)>0;)dt--}j(E[P],tt)===0?al(E,P,dt):al(E,++dt,z),dt<=M&&(P=dt+1),M<=dt&&(z=dt-1)}})(a,s,c||0,m||a.length-1,_||Df)}function al(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function Df(a,s){return a<s?-1:a>s?1:0}function ol(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,b=[],E=0;E<c;E++){var M=xr(a[E]);M!==0&&(a[E].area=Math.abs(M),_===void 0&&(_=M<0),_===M<0?(m&&b.push(m),m=[a[E]]):m.push(a[E]))}if(m&&b.push(m),s>1)for(var P=0;P<b.length;P++)b[P].length<=s||(kc(b[P],s,1,b[P].length-1,Lp),b[P]=b[P].slice(0,s));return b}function Lp(a,s){return s.area-a.area}function Ic(a,s,c){for(var m=c.patternDependencies,_=!1,b=0,E=s;b<E.length;b+=1){var M=E[b].paint.get(a+"-pattern");M.isConstant()||(_=!0);var P=M.constantOr(null);P&&(_=!0,m[P.to]=!0,m[P.from]=!0)}return _}function El(a,s,c,m,_){for(var b=_.patternDependencies,E=0,M=s;E<M.length;E+=1){var P=M[E],z=P.paint.get(a+"-pattern").value;if(z.kind!=="constant"){var j=z.evaluate({zoom:m-1},c,{},_.availableImages),H=z.evaluate({zoom:m},c,{},_.availableImages),ee=z.evaluate({zoom:m+1},c,{},_.availableImages);H=H&&H.name?H.name:H,ee=ee&&ee.name?ee.name:ee,b[j=j&&j.name?j.name:j]=!0,b[H]=!0,b[ee]=!0,c.patterns[P.id]={min:j,mid:H,max:ee}}}return c}If.deviation=function(a,s,c,m){var _=s&&s.length,b=Math.abs(Jl(a,0,_?s[0]*c:a.length,c));if(_)for(var E=0,M=s.length;E<M;E++)b-=Math.abs(Jl(a,s[E]*c,E<M-1?s[E+1]*c:a.length,c));var P=0;for(E=0;E<m.length;E+=3){var z=m[E]*c,j=m[E+1]*c,H=m[E+2]*c;P+=Math.abs((a[z]-a[H])*(a[j+1]-a[z+1])-(a[z]-a[j])*(a[H+1]-a[z+1]))}return b===0&&P===0?0:Math.abs((P-b)/b)},If.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var b=0;b<a[_].length;b++)for(var E=0;E<s;E++)c.vertices.push(a[_][b][E]);_>0&&c.holes.push(m+=a[_-1].length)}return c},il.default=ph;var Os=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qu,this.indexArray=new Ju,this.indexArray2=new Tc,this.programConfigurations=new jn(a.layers,a.zoom),this.segments=new ve,this.segments2=new ve,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Os.prototype.populate=function(a,s,c){this.hasPattern=Ic("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],P=M.feature,z=M.id,j=M.index,H=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=Ta(P,ee);if(this.layers[0]._featureFilter.filter(new F(this.zoom),se,c)){var Re=m?m.evaluate(se,{},c,s.availableImages):void 0,Be={id:z,properties:P.properties,type:P.type,sourceLayerIndex:H,index:j,geometry:ee?se.geometry:_a(P),patterns:{},sortKey:Re};_.push(Be)}}m&&_.sort(function(Fr,Yr){return Fr.sortKey-Yr.sortKey});for(var tt=0,Ge=_;tt<Ge.length;tt+=1){var dt=Ge[tt],kt=dt.geometry,Lt=dt.index,$t=dt.sourceLayerIndex;if(this.hasPattern){var ur=El("fill",this.layers,dt,this.zoom,s);this.patternFeatures.push(ur)}else this.addFeature(dt,kt,Lt,c,{});s.featureIndex.insert(a[Lt].feature,kt,Lt,$t,this.index)}},Os.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Os.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},Os.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Os.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hh),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Os.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=ol(s,500);b<E.length;b+=1){for(var M=E[b],P=0,z=0,j=M;z<j.length;z+=1)P+=j[z].length;for(var H=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),ee=H.vertexLength,se=[],Re=[],Be=0,tt=M;Be<tt.length;Be+=1){var Ge=tt[Be];if(Ge.length!==0){Ge!==M[0]&&Re.push(se.length/2);var dt=this.segments2.prepareSegment(Ge.length,this.layoutVertexArray,this.indexArray2),kt=dt.vertexLength;this.layoutVertexArray.emplaceBack(Ge[0].x,Ge[0].y),this.indexArray2.emplaceBack(kt+Ge.length-1,kt),se.push(Ge[0].x),se.push(Ge[0].y);for(var Lt=1;Lt<Ge.length;Lt++)this.layoutVertexArray.emplaceBack(Ge[Lt].x,Ge[Lt].y),this.indexArray2.emplaceBack(kt+Lt-1,kt+Lt),se.push(Ge[Lt].x),se.push(Ge[Lt].y);dt.vertexLength+=Ge.length,dt.primitiveLength+=Ge.length}}for(var $t=il(se,Re),ur=0;ur<$t.length;ur+=3)this.indexArray.emplaceBack(ee+$t[ur],ee+$t[ur+1],ee+$t[ur+2]);H.vertexLength+=P,H.primitiveLength+=$t.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},dn("FillBucket",Os,{omit:["layers","patternFeatures"]});var Xh=new uo({"fill-sort-key":new mn(he.layout_fill["fill-sort-key"])}),Of={paint:new uo({"fill-antialias":new In(he.paint_fill["fill-antialias"]),"fill-opacity":new mn(he.paint_fill["fill-opacity"]),"fill-color":new mn(he.paint_fill["fill-color"]),"fill-outline-color":new mn(he.paint_fill["fill-outline-color"]),"fill-translate":new In(he.paint_fill["fill-translate"]),"fill-translate-anchor":new In(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ec(he.paint_fill["fill-pattern"])}),layout:Xh},Td=function(a){function s(c){a.call(this,c,Of)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new Os(c)},s.prototype.queryRadius=function(){return Ma(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P){return ys(cu(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,P),b)},s.prototype.isTileClipped=function(){return!0},s}(Ps),Yh=Ha([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Al=sl;function sl(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(qh,this,s)}function qh(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var b=m.readVarint()+m.pos;m.pos<b;){var E=_._keys[m.readVarint()],M=_._values[m.readVarint()];_.properties[E]=M}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function gh(a){for(var s,c,m=0,_=0,b=a.length,E=b-1;_<b;E=_++)m+=((c=a[E]).x-(s=a[_]).x)*(s.y+c.y);return m}sl.types=["Unknown","Point","LineString","Polygon"],sl.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,b=0,E=0,M=[];a.pos<c;){if(_<=0){var P=a.readVarint();m=7&P,_=P>>3}if(_--,m===1||m===2)b+=a.readSVarint(),E+=a.readSVarint(),m===1&&(s&&M.push(s),s=[]),s.push(new ie(b,E));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&M.push(s),M},sl.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,b=0,E=1/0,M=-1/0,P=1/0,z=-1/0;a.pos<s;){if(m<=0){var j=a.readVarint();c=7&j,m=j>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<E&&(E=_),_>M&&(M=_),(b+=a.readSVarint())<P&&(P=b),b>z&&(z=b);else if(c!==7)throw new Error("unknown command "+c)}return[E,P,M,z]},sl.prototype.toGeoJSON=function(a,s,c){var m,_,b=this.extent*Math.pow(2,c),E=this.extent*a,M=this.extent*s,P=this.loadGeometry(),z=sl.types[this.type];function j(se){for(var Re=0;Re<se.length;Re++){var Be=se[Re];se[Re]=[360*(Be.x+E)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Be.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(m=0;m<P.length;m++)H[m]=P[m][0];j(P=H);break;case 2:for(m=0;m<P.length;m++)j(P[m]);break;case 3:for(P=function(se){var Re=se.length;if(Re<=1)return[se];for(var Be,tt,Ge=[],dt=0;dt<Re;dt++){var kt=gh(se[dt]);kt!==0&&(tt===void 0&&(tt=kt<0),tt===kt<0?(Be&&Ge.push(Be),Be=[se[dt]]):Be.push(se[dt]))}return Be&&Ge.push(Be),Ge}(P),m=0;m<P.length;m++)for(_=0;_<P[m].length;_++)j(P[m][_])}P.length===1?P=P[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:P},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var yh=_h;function _h(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Rp,this,s),this.length=this._features.length}function Rp(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,b=m.readVarint()+m.pos;m.pos<b;){var E=m.readVarint()>>3;_=E===1?m.readString():E===2?m.readFloat():E===3?m.readDouble():E===4?m.readVarint64():E===5?m.readVarint():E===6?m.readSVarint():E===7?m.readBoolean():null}return _}(c))}function Vo(a,s,c){if(a===3){var m=new yh(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}_h.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new Al(this._pbf,s,this.extent,this._keys,this._values)};var Pc={VectorTile:function(a,s){this.layers=a.readFields(Vo,{},s)},VectorTileFeature:Al,VectorTileLayer:yh},Lc=Pc.VectorTileFeature.types,Ru=Math.pow(2,13);function Ql(a,s,c,m,_,b,E,M){a.emplaceBack(s,c,2*Math.floor(m*Ru)+E,_*Ru*2,b*Ru*2,Math.round(M))}var bs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ls,this.indexArray=new Ju,this.programConfigurations=new jn(a.layers,a.zoom),this.segments=new ve,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function xh(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}bs.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Ic("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var b=_[m],E=b.feature,M=b.id,P=b.index,z=b.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,H=Ta(E,j);if(this.layers[0]._featureFilter.filter(new F(this.zoom),H,c)){var ee={id:M,sourceLayerIndex:z,index:P,geometry:j?H.geometry:_a(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(El("fill-extrusion",this.layers,ee,this.zoom,s)):this.addFeature(ee,ee.geometry,P,c,{}),s.featureIndex.insert(E,ee.geometry,P,z,this.index,!0)}}},bs.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},bs.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},bs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},bs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bs.prototype.addFeature=function(a,s,c,m,_){for(var b=0,E=ol(s,500);b<E.length;b+=1){for(var M=E[b],P=0,z=0,j=M;z<j.length;z+=1)P+=j[z].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,se=M;ee<se.length;ee+=1){var Re=se[ee];if(Re.length!==0&&!((Ti=Re).every(function(di){return di.x<0})||Ti.every(function(di){return di.x>8192})||Ti.every(function(di){return di.y<0})||Ti.every(function(di){return di.y>8192})))for(var Be=0,tt=0;tt<Re.length;tt++){var Ge=Re[tt];if(tt>=1){var dt=Re[tt-1];if(!xh(Ge,dt)){H.vertexLength+4>ve.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var kt=Ge.sub(dt)._perp()._unit(),Lt=dt.dist(Ge);Be+Lt>32768&&(Be=0),Ql(this.layoutVertexArray,Ge.x,Ge.y,kt.x,kt.y,0,0,Be),Ql(this.layoutVertexArray,Ge.x,Ge.y,kt.x,kt.y,0,1,Be),Ql(this.layoutVertexArray,dt.x,dt.y,kt.x,kt.y,0,0,Be+=Lt),Ql(this.layoutVertexArray,dt.x,dt.y,kt.x,kt.y,0,1,Be);var $t=H.vertexLength;this.indexArray.emplaceBack($t,$t+2,$t+1),this.indexArray.emplaceBack($t+1,$t+2,$t+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+P>ve.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),Lc[a.type]==="Polygon"){for(var ur=[],Fr=[],Yr=H.vertexLength,Rn=0,on=M;Rn<on.length;Rn+=1){var Bn=on[Rn];if(Bn.length!==0){Bn!==M[0]&&Fr.push(ur.length/2);for(var un=0;un<Bn.length;un++){var nn=Bn[un];Ql(this.layoutVertexArray,nn.x,nn.y,0,0,1,1,0),ur.push(nn.x),ur.push(nn.y)}}}for(var jr=il(ur,Fr),An=0;An<jr.length;An+=3)this.indexArray.emplaceBack(Yr+jr[An],Yr+jr[An+2],Yr+jr[An+1]);H.primitiveLength+=jr.length/3,H.vertexLength+=P}}var Ti;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},dn("FillExtrusionBucket",bs,{omit:["layers","features"]});var Dp={paint:new uo({"fill-extrusion-opacity":new In(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ec(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ss=function(a){function s(c){a.call(this,c,Dp)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new bs(c)},s.prototype.queryRadius=function(){return Ma(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P,z){var j=cu(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,P),H=this.paint.get("fill-extrusion-height").evaluate(m,_),ee=this.paint.get("fill-extrusion-base").evaluate(m,_),se=function(Be,tt,Ge,dt){for(var kt=[],Lt=0,$t=Be;Lt<$t.length;Lt+=1){var ur=$t[Lt],Fr=[ur.x,ur.y,0,1];fu(Fr,Fr,tt),kt.push(new ie(Fr[0]/Fr[3],Fr[1]/Fr[3]))}return kt}(j,z),Re=function(Be,tt,Ge,dt){for(var kt=[],Lt=[],$t=dt[8]*tt,ur=dt[9]*tt,Fr=dt[10]*tt,Yr=dt[11]*tt,Rn=dt[8]*Ge,on=dt[9]*Ge,Bn=dt[10]*Ge,un=dt[11]*Ge,nn=0,jr=Be;nn<jr.length;nn+=1){for(var An=[],Ti=[],di=0,Ni=jr[nn];di<Ni.length;di+=1){var Nn=Ni[di],$i=Nn.x,Pa=Nn.y,ro=dt[0]*$i+dt[4]*Pa+dt[12],Xa=dt[1]*$i+dt[5]*Pa+dt[13],La=dt[2]*$i+dt[6]*Pa+dt[14],no=dt[3]*$i+dt[7]*Pa+dt[15],Oo=La+Fr,Fo=no+Yr,Es=ro+Rn,Bo=Xa+on,As=La+Bn,fo=no+un,Go=new ie((ro+$t)/Fo,(Xa+ur)/Fo);Go.z=Oo/Fo,An.push(Go);var Ri=new ie(Es/fo,Bo/fo);Ri.z=As/fo,Ti.push(Ri)}kt.push(An),Lt.push(Ti)}return[kt,Lt]}(b,ee,H,z);return function(Be,tt,Ge){var dt=1/0;ys(Ge,tt)&&(dt=Za(Ge,tt[0]));for(var kt=0;kt<tt.length;kt++)for(var Lt=tt[kt],$t=Be[kt],ur=0;ur<Lt.length-1;ur++){var Fr=Lt[ur],Yr=[Fr,Lt[ur+1],$t[ur+1],$t[ur],Fr];ku(Ge,Yr)&&(dt=Math.min(dt,Za(Ge,Yr)))}return dt!==1/0&&dt}(Re[0],Re[1],se)},s}(Ps);function qs(a,s){return a.x*s.x+a.y*s.y}function Za(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var b=s[m],E=a[0],M=c.sub(_),P=b.sub(_),z=E.sub(_),j=qs(M,M),H=qs(M,P),ee=qs(P,P),se=qs(z,M),Re=qs(z,P),Be=j*ee-H*H,tt=(ee*se-H*Re)/Be,Ge=(j*Re-H*se)/Be,dt=_.z*(1-tt-Ge)+c.z*tt+b.z*Ge;if(isFinite(dt))return dt}return 1/0}for(var kt=1/0,Lt=0,$t=s;Lt<$t.length;Lt+=1)kt=Math.min(kt,$t[Lt].z);return kt}var ws=Ha([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Kh=Ha([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Md=Pc.VectorTileFeature.types,kd=Math.cos(Math.PI/180*37.5),bh=Math.pow(2,14)/.5,rs=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Zo,this.layoutVertexArray2=new bl,this.indexArray=new Ju,this.programConfigurations=new jn(a.layers,a.zoom),this.segments=new ve,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};rs.prototype.populate=function(a,s,c){this.hasPattern=Ic("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],b=0,E=a;b<E.length;b+=1){var M=E[b],P=M.feature,z=M.id,j=M.index,H=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=Ta(P,ee);if(this.layers[0]._featureFilter.filter(new F(this.zoom),se,c)){var Re=m?m.evaluate(se,{},c):void 0,Be={id:z,properties:P.properties,type:P.type,sourceLayerIndex:H,index:j,geometry:ee?se.geometry:_a(P),patterns:{},sortKey:Re};_.push(Be)}}m&&_.sort(function(Fr,Yr){return Fr.sortKey-Yr.sortKey});for(var tt=0,Ge=_;tt<Ge.length;tt+=1){var dt=Ge[tt],kt=dt.geometry,Lt=dt.index,$t=dt.sourceLayerIndex;if(this.hasPattern){var ur=El("line",this.layers,dt,this.zoom,s);this.patternFeatures.push(ur)}else this.addFeature(dt,kt,Lt,c,{});s.featureIndex.insert(a[Lt].feature,kt,Lt,$t,this.index)}},rs.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},rs.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var b=_[m];this.addFeature(b,b.geometry,b.index,s,c)}},rs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},rs.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Kh)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ws),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},rs.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},rs.prototype.addFeature=function(a,s,c,m,_){var b=this.layers[0].layout,E=b.get("line-join").evaluate(a,{}),M=b.get("line-cap"),P=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var j=0,H=s;j<H.length;j+=1)this.addLine(H[j],a,E,M,P,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},rs.prototype.addLine=function(a,s,c,m,_,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var E=0;E<a.length-1;E++)this.totalDistance+=a[E].dist(a[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Md[s.type]==="Polygon",P=a.length;P>=2&&a[P-1].equals(a[P-2]);)P--;for(var z=0;z<P-1&&a[z].equals(a[z+1]);)z++;if(!(P<(M?3:2))){c==="bevel"&&(_=1.05);var j,H=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray),se=void 0,Re=void 0,Be=void 0,tt=void 0;this.e1=this.e2=-1,M&&(tt=a[z].sub(j=a[P-2])._unit()._perp());for(var Ge=z;Ge<P;Ge++)if(!(Re=Ge===P-1?M?a[z+1]:void 0:a[Ge+1])||!a[Ge].equals(Re)){tt&&(Be=tt),j&&(se=j),j=a[Ge],tt=Re?Re.sub(j)._unit()._perp():Be;var dt=(Be=Be||tt).add(tt);dt.x===0&&dt.y===0||dt._unit();var kt=Be.x*tt.x+Be.y*tt.y,Lt=dt.x*tt.x+dt.y*tt.y,$t=Lt!==0?1/Lt:1/0,ur=2*Math.sqrt(2-2*Lt),Fr=Lt<kd&&se&&Re,Yr=Be.x*tt.y-Be.y*tt.x>0;if(Fr&&Ge>z){var Rn=j.dist(se);if(Rn>2*H){var on=j.sub(j.sub(se)._mult(H/Rn)._round());this.updateDistance(se,on),this.addCurrentVertex(on,Be,0,0,ee),se=on}}var Bn=se&&Re,un=Bn?c:M?"butt":m;if(Bn&&un==="round"&&($t<b?un="miter":$t<=2&&(un="fakeround")),un==="miter"&&$t>_&&(un="bevel"),un==="bevel"&&($t>2&&(un="flipbevel"),$t<_&&(un="miter")),se&&this.updateDistance(se,j),un==="miter")dt._mult($t),this.addCurrentVertex(j,dt,0,0,ee);else if(un==="flipbevel"){if($t>100)dt=tt.mult(-1);else{var nn=$t*Be.add(tt).mag()/Be.sub(tt).mag();dt._perp()._mult(nn*(Yr?-1:1))}this.addCurrentVertex(j,dt,0,0,ee),this.addCurrentVertex(j,dt.mult(-1),0,0,ee)}else if(un==="bevel"||un==="fakeround"){var jr=-Math.sqrt($t*$t-1),An=Yr?jr:0,Ti=Yr?0:jr;if(se&&this.addCurrentVertex(j,Be,An,Ti,ee),un==="fakeround")for(var di=Math.round(180*ur/Math.PI/20),Ni=1;Ni<di;Ni++){var Nn=Ni/di;if(Nn!==.5){var $i=Nn-.5;Nn+=Nn*$i*(Nn-1)*((1.0904+kt*(kt*(3.55645-1.43519*kt)-3.2452))*$i*$i+(.848013+kt*(.215638*kt-1.06021)))}var Pa=tt.sub(Be)._mult(Nn)._add(Be)._unit()._mult(Yr?-1:1);this.addHalfVertex(j,Pa.x,Pa.y,!1,Yr,0,ee)}Re&&this.addCurrentVertex(j,tt,-An,-Ti,ee)}else if(un==="butt")this.addCurrentVertex(j,dt,0,0,ee);else if(un==="square"){var ro=se?1:-1;this.addCurrentVertex(j,dt,ro,ro,ee)}else un==="round"&&(se&&(this.addCurrentVertex(j,Be,0,0,ee),this.addCurrentVertex(j,Be,1,1,ee,!0)),Re&&(this.addCurrentVertex(j,tt,-1,-1,ee,!0),this.addCurrentVertex(j,tt,0,0,ee)));if(Fr&&Ge<P-1){var Xa=j.dist(Re);if(Xa>2*H){var La=j.add(Re.sub(j)._mult(H/Xa)._round());this.updateDistance(j,La),this.addCurrentVertex(La,tt,0,0,ee),j=La}}}}},rs.prototype.addCurrentVertex=function(a,s,c,m,_,b){b===void 0&&(b=!1);var E=s.y*m-s.x,M=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,b,!1,c,_),this.addHalfVertex(a,E,M,b,!0,-m,_),this.distance>bh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,b))},rs.prototype.addHalfVertex=function(a,s,c,m,_,b,E){var M=.5*(this.lineClips?this.scaledDistance*(bh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var P=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),E.primitiveLength++),_?this.e2=P:this.e1=P},rs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},rs.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},dn("LineBucket",rs,{omit:["layers","patternFeatures"]});var Op=new uo({"line-cap":new In(he.layout_line["line-cap"]),"line-join":new mn(he.layout_line["line-join"]),"line-miter-limit":new In(he.layout_line["line-miter-limit"]),"line-round-limit":new In(he.layout_line["line-round-limit"]),"line-sort-key":new mn(he.layout_line["line-sort-key"])}),Ff={paint:new uo({"line-opacity":new mn(he.paint_line["line-opacity"]),"line-color":new mn(he.paint_line["line-color"]),"line-translate":new In(he.paint_line["line-translate"]),"line-translate-anchor":new In(he.paint_line["line-translate-anchor"]),"line-width":new mn(he.paint_line["line-width"]),"line-gap-width":new mn(he.paint_line["line-gap-width"]),"line-offset":new mn(he.paint_line["line-offset"]),"line-blur":new mn(he.paint_line["line-blur"]),"line-dasharray":new Lo(he.paint_line["line-dasharray"]),"line-pattern":new Ec(he.paint_line["line-pattern"]),"line-gradient":new Ka(he.paint_line["line-gradient"])}),layout:Op},Sh=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new F(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,b){return m=qt({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,b)},s}(mn))(Ff.paint.properties["line-width"].specification);Sh.useIntegerZoom=!0;var Id=function(a){function s(c){a.call(this,c,Ff),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Xo,this.gradientVersion=(this.gradientVersion+1)%He)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=Sh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new rs(c)},s.prototype.queryRadius=function(c){var m=c,_=Fp(Xs("line-width",this,m),Xs("line-gap-width",this,m)),b=Xs("line-offset",this,m);return _/2+Math.abs(b)+Ma(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,b,E,M,P){var z=cu(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,P),j=P/2*Fp(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),H=this.paint.get("line-offset").evaluate(m,_);return H&&(b=function(ee,se){for(var Re=[],Be=new ie(0,0),tt=0;tt<ee.length;tt++){for(var Ge=ee[tt],dt=[],kt=0;kt<Ge.length;kt++){var Lt=Ge[kt],$t=Ge[kt+1],ur=kt===0?Be:Lt.sub(Ge[kt-1])._unit()._perp(),Fr=kt===Ge.length-1?Be:$t.sub(Lt)._unit()._perp(),Yr=ur._add(Fr)._unit();Yr._mult(1/(Yr.x*Fr.x+Yr.y*Fr.y)),dt.push(Yr._mult(se)._add(Lt))}Re.push(dt)}return Re}(b,H*P)),function(ee,se,Re){for(var Be=0;Be<se.length;Be++){var tt=se[Be];if(ee.length>=3){for(var Ge=0;Ge<tt.length;Ge++)if(Ds(ee,tt[Ge]))return!0}if(_s(ee,tt,Re))return!0}return!1}(z,b,j)},s.prototype.isTileClipped=function(){return!0},s}(Ps);function Fp(a,s){return s>0?s+2*a:a}var Pd=Ha([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bp=Ha([{name:"a_projected_pos",components:3,type:"Float32"}],4),zp=(Ha([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ha([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Jh=(Ha([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ha([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ld=Ha([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rd(a,s,c){return a.sections.forEach(function(m){m.text=function(_,b,E){var M=b.layout.get("text-transform").evaluate(E,{});return M==="uppercase"?_=_.toLocaleUpperCase():M==="lowercase"&&(_=_.toLocaleLowerCase()),Ie.applyArabicShaping&&(_=Ie.applyArabicShaping(_)),_}(m.text,s,c)}),a}Ha([{name:"triangle",components:3,type:"Uint16"}]),Ha([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ha([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ha([{type:"Float32",name:"offsetX"}]),Ha([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var of={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Np=function(a,s,c,m,_){var b,E,M=8*_-m-1,P=(1<<M)-1,z=P>>1,j=-7,H=c?_-1:0,ee=c?-1:1,se=a[s+H];for(H+=ee,b=se&(1<<-j)-1,se>>=-j,j+=M;j>0;b=256*b+a[s+H],H+=ee,j-=8);for(E=b&(1<<-j)-1,b>>=-j,j+=m;j>0;E=256*E+a[s+H],H+=ee,j-=8);if(b===0)b=1-z;else{if(b===P)return E?NaN:1/0*(se?-1:1);E+=Math.pow(2,m),b-=z}return(se?-1:1)*E*Math.pow(2,b-m)},B=function(a,s,c,m,_,b){var E,M,P,z=8*b-_-1,j=(1<<z)-1,H=j>>1,ee=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=m?0:b-1,Re=m?1:-1,Be=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(M=isNaN(s)?1:0,E=j):(E=Math.floor(Math.log(s)/Math.LN2),s*(P=Math.pow(2,-E))<1&&(E--,P*=2),(s+=E+H>=1?ee/P:ee*Math.pow(2,1-H))*P>=2&&(E++,P/=2),E+H>=j?(M=0,E=j):E+H>=1?(M=(s*P-1)*Math.pow(2,_),E+=H):(M=s*Math.pow(2,H-1)*Math.pow(2,_),E=0));_>=8;a[c+se]=255&M,se+=Re,M/=256,_-=8);for(E=E<<_|M,z+=_;z>0;a[c+se]=255&E,se+=Re,E/=256,z-=8);a[c+se-Re]|=128*Be},Se=ke;function ke(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}ke.Varint=0,ke.Fixed64=1,ke.Bytes=2,ke.Fixed32=5;var zt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function sr(a){return a.type===ke.Bytes?a.readVarint()+a.pos:a.pos+1}function Dt(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Xt(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function kr(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function Ir(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function Or(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function Cr(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function zr(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function Xr(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Er(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function Vr(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function St(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Vt(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Tr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function Kr(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function vr(a,s,c){a===1&&c.readMessage(sn,s)}function sn(a,s,c){if(a===3){var m=c.readMessage(yr,{}),_=m.width,b=m.height,E=m.left,M=m.top,P=m.advance;s.push({id:m.id,bitmap:new ts({width:_+6,height:b+6},m.bitmap),metrics:{width:_,height:b,left:E,top:M,advance:P}})}}function yr(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Zr(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var b=_[m];s+=b.w*b.h,c=Math.max(c,b.w)}a.sort(function(Be,tt){return tt.h-Be.h});for(var E=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],M=0,P=0,z=0,j=a;z<j.length;z+=1)for(var H=j[z],ee=E.length-1;ee>=0;ee--){var se=E[ee];if(!(H.w>se.w||H.h>se.h)){if(H.x=se.x,H.y=se.y,P=Math.max(P,H.y+H.h),M=Math.max(M,H.x+H.w),H.w===se.w&&H.h===se.h){var Re=E.pop();ee<E.length&&(E[ee]=Re)}else H.h===se.h?(se.x+=H.w,se.w-=H.w):H.w===se.w?(se.y+=H.h,se.h-=H.h):(E.push({x:se.x+H.w,y:se.y,w:se.w-H.w,h:H.h}),se.y+=H.h,se.h-=H.h);break}}return{w:M,h:P,fill:s/(M*P)||0}}ke.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,b=this.pos;this.type=7&m,a(_,s,this),this.pos===b&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Vt(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Kr(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Vt(this.buf,this.pos)+4294967296*Vt(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Vt(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=Np(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Np(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,b,E){var M,P,z=E.buf;if(M=(112&(P=z[E.pos++]))>>4,P<128||(M|=(127&(P=z[E.pos++]))<<3,P<128)||(M|=(127&(P=z[E.pos++]))<<10,P<128)||(M|=(127&(P=z[E.pos++]))<<17,P<128)||(M|=(127&(P=z[E.pos++]))<<24,P<128)||(M|=(1&(P=z[E.pos++]))<<31,P<128))return Dt(_,M,b);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&zt?function(c,m,_){return zt.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var b="",E=m;E<_;){var M,P,z,j=c[E],H=null,ee=j>239?4:j>223?3:j>191?2:1;if(E+ee>_)break;ee===1?j<128&&(H=j):ee===2?(192&(M=c[E+1]))==128&&(H=(31&j)<<6|63&M)<=127&&(H=null):ee===3?(P=c[E+2],(192&(M=c[E+1]))==128&&(192&P)==128&&((H=(15&j)<<12|(63&M)<<6|63&P)<=2047||H>=55296&&H<=57343)&&(H=null)):ee===4&&(P=c[E+2],z=c[E+3],(192&(M=c[E+1]))==128&&(192&P)==128&&(192&z)==128&&((H=(15&j)<<18|(63&M)<<12|(63&P)<<6|63&z)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,ee=1):H>65535&&(H-=65536,b+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),b+=String.fromCharCode(H),E+=ee}return b}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==ke.Bytes)return a.push(this.readVarint(s));var c=sr(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==ke.Bytes)return a.push(this.readSVarint());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==ke.Bytes)return a.push(this.readBoolean());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==ke.Bytes)return a.push(this.readFloat());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==ke.Bytes)return a.push(this.readDouble());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==ke.Bytes)return a.push(this.readFixed32());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==ke.Bytes)return a.push(this.readSFixed32());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==ke.Bytes)return a.push(this.readFixed64());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==ke.Bytes)return a.push(this.readSFixed64());var s=sr(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===ke.Varint)for(;this.buf[this.pos++]>127;);else if(s===ke.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ke.Fixed32)this.pos+=4;else{if(s!==ke.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Tr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Tr(this.buf,-1&a,this.pos),Tr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,E,M){M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,b>>>=7,M.buf[M.pos++]=127&b|128,M.buf[M.pos]=127&(b>>>=7)}(m,0,c),function(b,E){var M=(7&b)<<4;E.buf[E.pos++]|=M|((b>>>=3)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,b){for(var E,M,P=0;P<_.length;P++){if((E=_.charCodeAt(P))>55295&&E<57344){if(!M){E>56319||P+1===_.length?(m[b++]=239,m[b++]=191,m[b++]=189):M=E;continue}if(E<56320){m[b++]=239,m[b++]=191,m[b++]=189,M=E;continue}E=M-55296<<10|E-56320|65536,M=null}else M&&(m[b++]=239,m[b++]=191,m[b++]=189,M=null);E<128?m[b++]=E:(E<2048?m[b++]=E>>6|192:(E<65536?m[b++]=E>>12|224:(m[b++]=E>>18|240,m[b++]=E>>12&63|128),m[b++]=E>>6&63|128),m[b++]=63&E|128)}return b}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&Xt(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),B(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),B(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&Xt(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,ke.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,kr,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,Ir,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,zr,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,Or,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Cr,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,Xr,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Er,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,Vr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,St,s)},writeBytesField:function(a,s){this.writeTag(a,ke.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,ke.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,ke.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,ke.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,ke.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,ke.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,ke.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,ke.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,ke.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,ke.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var pr=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,b=s.stretchY,E=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=b,this.content=E,this.version=m},Ur={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ur.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ur.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ur.tlbr.get=function(){return this.tl.concat(this.br)},Ur.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(pr.prototype,Ur);var Nt=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var b=Zr(_),E=new to({width:b.w||1,height:b.h||1});for(var M in a){var P=a[M],z=c[M].paddedRect;to.copy(P.data,E,{x:0,y:0},{x:z.x+1,y:z.y+1},P.data)}for(var j in s){var H=s[j],ee=m[j].paddedRect,se=ee.x+1,Re=ee.y+1,Be=H.data.width,tt=H.data.height;to.copy(H.data,E,{x:0,y:0},{x:se,y:Re},H.data),to.copy(H.data,E,{x:0,y:tt-1},{x:se,y:Re-1},{width:Be,height:1}),to.copy(H.data,E,{x:0,y:0},{x:se,y:Re+tt},{width:Be,height:1}),to.copy(H.data,E,{x:Be-1,y:0},{x:se-1,y:Re},{width:1,height:tt}),to.copy(H.data,E,{x:0,y:0},{x:se+Be,y:Re},{width:1,height:tt})}this.image=E,this.iconPositions=c,this.patternPositions=m};Nt.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(b),s[m]=new pr(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Nt.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},Nt.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},dn("ImagePosition",pr),dn("ImageAtlas",Nt);var Fn={horizontal:1,vertical:2,horizontalOnly:3},Ne=function(){this.scale=1,this.fontStack="",this.imageName=null};Ne.forText=function(a,s){var c=new Ne;return c.scale=a||1,c.fontStack=s,c},Ne.forImage=function(a){var s=new Ne;return s.imageName=a,s};var gr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function cr(a,s,c,m,_,b,E,M,P,z,j,H,ee,se,Re,Be){var tt,Ge=gr.fromFeature(a,_);H===Fn.vertical&&Ge.verticalizePunctuation();var dt=Ie.processBidirectionalText,kt=Ie.processStyledBidirectionalText;if(dt&&Ge.sections.length===1){tt=[];for(var Lt=0,$t=dt(Ge.toString(),Fi(Ge,z,b,s,m,se,Re));Lt<$t.length;Lt+=1){var ur=$t[Lt],Fr=new gr;Fr.text=ur,Fr.sections=Ge.sections;for(var Yr=0;Yr<ur.length;Yr++)Fr.sectionIndex.push(0);tt.push(Fr)}}else if(kt){tt=[];for(var Rn=0,on=kt(Ge.text,Ge.sectionIndex,Fi(Ge,z,b,s,m,se,Re));Rn<on.length;Rn+=1){var Bn=on[Rn],un=new gr;un.text=Bn[0],un.sectionIndex=Bn[1],un.sections=Ge.sections,tt.push(un)}}else tt=function(An,Ti){for(var di=[],Ni=An.text,Nn=0,$i=0,Pa=Ti;$i<Pa.length;$i+=1){var ro=Pa[$i];di.push(An.substring(Nn,ro)),Nn=ro}return Nn<Ni.length&&di.push(An.substring(Nn,Ni.length)),di}(Ge,Fi(Ge,z,b,s,m,se,Re));var nn=[],jr={positionedLines:nn,text:Ge.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(An,Ti,di,Ni,Nn,$i,Pa,ro,Xa,La,no,Oo){for(var Fo=0,Es=-17,Bo=0,As=0,fo=ro==="right"?1:ro==="left"?0:.5,Go=0,Ri=0,la=Nn;Ri<la.length;Ri+=1){var ra=la[Ri];ra.trim();var Ui=ra.getMaxScale(),Fs=24*(Ui-1),hs={positionedGlyphs:[],lineOffset:0};An.positionedLines[Go]=hs;var wa=hs.positionedGlyphs,To=0;if(ra.length()){for(var ps=0;ps<ra.length();ps++){var Zi=ra.getSection(ps),Dc=ra.getSectionIndex(ps),Du=ra.getCharCode(ps),Oc=0,ho=null,Fc=null,Tl=null,tp=24,Ah=!(Xa===Fn.horizontal||!no&&!Gl(Du)||no&&(Gn[Du]||(tc=Du,Rr.Arabic(tc)||Rr["Arabic Supplement"](tc)||Rr["Arabic Extended-A"](tc)||Rr["Arabic Presentation Forms-A"](tc)||Rr["Arabic Presentation Forms-B"](tc))));if(Zi.imageName){var rp=Ni[Zi.imageName];if(!rp)continue;Tl=Zi.imageName,An.iconsInText=An.iconsInText||!0,Fc=rp.paddedRect;var uf=rp.displaySize;Zi.scale=24*Zi.scale/Oo,Oc=Fs+(24-uf[1]*Zi.scale),tp=(ho={width:uf[0],height:uf[1],left:1,top:-3,advance:Ah?uf[1]:uf[0]}).advance;var np=Ah?uf[0]*Zi.scale-24*Ui:uf[1]*Zi.scale-24*Ui;np>0&&np>To&&(To=np)}else{var Bd=di[Zi.fontStack],ip=Bd&&Bd[Du];if(ip&&ip.rect)Fc=ip.rect,ho=ip.metrics;else{var Vf=Ti[Zi.fontStack],Gp=Vf&&Vf[Du];if(!Gp)continue;ho=Gp.metrics}Oc=24*(Ui-Zi.scale)}Ah?(An.verticalizable=!0,wa.push({glyph:Du,imageName:Tl,x:Fo,y:Es+Oc,vertical:Ah,scale:Zi.scale,fontStack:Zi.fontStack,sectionIndex:Dc,metrics:ho,rect:Fc}),Fo+=tp*Zi.scale+La):(wa.push({glyph:Du,imageName:Tl,x:Fo,y:Es+Oc,vertical:Ah,scale:Zi.scale,fontStack:Zi.fontStack,sectionIndex:Dc,metrics:ho,rect:Fc}),Fo+=ho.advance*Zi.scale+La)}wa.length!==0&&(Bo=Math.max(Fo-La,Bo),wo(wa,0,wa.length-1,fo,To)),Fo=0;var ap=$i*Ui+To;hs.lineOffset=Math.max(To,Fs),Es+=ap,As=Math.max(ap,As),++Go}else Es+=$i,++Go}var tc,rc=Es- -17,ul=Ua(Pa),Bc=ul.horizontalAlign,jf=ul.verticalAlign;(function(op,Ch,Th,sp,Hp,Mh,kh,up,Wp){var Ih,$p=(Ch-Th)*Hp;Ih=Mh!==kh?-up*sp- -17:(-sp*Wp+.5)*kh;for(var nc=0,is=op;nc<is.length;nc+=1)for(var lf=0,Ph=is[nc].positionedGlyphs;lf<Ph.length;lf+=1){var Gf=Ph[lf];Gf.x+=$p,Gf.y+=Ih}})(An.positionedLines,fo,Bc,jf,Bo,As,$i,rc,Nn.length),An.top+=-jf*rc,An.bottom=An.top+rc,An.left+=-Bc*Bo,An.right=An.left+Bo}(jr,s,c,m,tt,E,M,P,H,z,ee,Be),!function(An){for(var Ti=0,di=An;Ti<di.length;Ti+=1)if(di[Ti].positionedGlyphs.length!==0)return!1;return!0}(nn)&&jr}gr.fromFeature=function(a,s){for(var c=new gr,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},gr.prototype.length=function(){return this.text.length},gr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},gr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},gr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},gr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&Xu(m)&&!of[a[c+1]]||_&&Xu(_)&&!of[a[c-1]]||!of[a[c]]?a[c]:of[a[c]]}return s}(this.text)},gr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&Gn[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&Gn[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},gr.prototype.substring=function(a,s){var c=new gr;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},gr.prototype.toString=function(){return this.text},gr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},gr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Ne.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},gr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Ne.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ft("Reached maximum number of images 6401")}else ft("Can't add FormattedSection with an empty image.")},gr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Gn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zn={};function Sn(a,s,c,m,_,b){if(s.imageName){var E=m[s.imageName];return E?E.displaySize[0]*s.scale*24/b+_:0}var M=c[s.fontStack],P=M&&M[a];return P?P.metrics.advance*s.scale+_:0}function hi(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function ni(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function vi(a,s,c,m,_,b){for(var E=null,M=hi(s,c,_,b),P=0,z=m;P<z.length;P+=1){var j=z[P],H=hi(s-j.x,c,_,b)+j.badness;H<=M&&(E=j,M=H)}return{index:a,x:s,priorBreak:E,badness:M}}function Fi(a,s,c,m,_,b,E){if(b!=="point")return[];if(!a)return[];for(var M,P=[],z=function(tt,Ge,dt,kt,Lt,$t){for(var ur=0,Fr=0;Fr<tt.length();Fr++){var Yr=tt.getSection(Fr);ur+=Sn(tt.getCharCode(Fr),Yr,kt,Lt,Ge,$t)}return ur/Math.max(1,Math.ceil(ur/dt))}(a,s,c,m,_,E),j=a.text.indexOf("\u200B")>=0,H=0,ee=0;ee<a.length();ee++){var se=a.getSection(ee),Re=a.getCharCode(ee);if(Gn[Re]||(H+=Sn(Re,se,m,_,s,E)),ee<a.length()-1){var Be=!((M=Re)<11904||!(Rr["Bopomofo Extended"](M)||Rr.Bopomofo(M)||Rr["CJK Compatibility Forms"](M)||Rr["CJK Compatibility Ideographs"](M)||Rr["CJK Compatibility"](M)||Rr["CJK Radicals Supplement"](M)||Rr["CJK Strokes"](M)||Rr["CJK Symbols and Punctuation"](M)||Rr["CJK Unified Ideographs Extension A"](M)||Rr["CJK Unified Ideographs"](M)||Rr["Enclosed CJK Letters and Months"](M)||Rr["Halfwidth and Fullwidth Forms"](M)||Rr.Hiragana(M)||Rr["Ideographic Description Characters"](M)||Rr["Kangxi Radicals"](M)||Rr["Katakana Phonetic Extensions"](M)||Rr.Katakana(M)||Rr["Vertical Forms"](M)||Rr["Yi Radicals"](M)||Rr["Yi Syllables"](M)));(Zn[Re]||Be||se.imageName)&&P.push(vi(ee+1,H,z,P,ni(Re,a.getCharCode(ee+1),Be&&j),!1))}}return function tt(Ge){return Ge?tt(Ge.priorBreak).concat(Ge.index):[]}(vi(a.length(),H,z,P,0,!0))}function Ua(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function wo(a,s,c,m,_){if(m||_)for(var b=a[c],E=(a[c].x+b.metrics.advance*b.scale)*m,M=s;M<=c;M++)a[M].x-=E,a[M].y+=_}function Si(a,s,c,m,_,b){var E,M=a.image;if(M.content){var P=M.content,z=M.pixelRatio||1;E=[P[0]/z,P[1]/z,M.displaySize[0]-P[2]/z,M.displaySize[1]-P[3]/z]}var j,H,ee,se,Re=s.left*b,Be=s.right*b;c==="width"||c==="both"?(se=_[0]+Re-m[3],H=_[0]+Be+m[1]):H=(se=_[0]+(Re+Be-M.displaySize[0])/2)+M.displaySize[0];var tt=s.top*b,Ge=s.bottom*b;return c==="height"||c==="both"?(j=_[1]+tt-m[0],ee=_[1]+Ge+m[2]):ee=(j=_[1]+(tt+Ge-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:j,right:H,bottom:ee,left:se,collisionPadding:E}}Zn[10]=!0,Zn[32]=!0,Zn[38]=!0,Zn[40]=!0,Zn[41]=!0,Zn[43]=!0,Zn[45]=!0,Zn[47]=!0,Zn[173]=!0,Zn[183]=!0,Zn[8203]=!0,Zn[8208]=!0,Zn[8211]=!0,Zn[8231]=!0;var ba=function(a){function s(c,m,_,b){a.call(this,c,m),this.angle=_,b!==void 0&&(this.segment=b)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ie);function ua(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new F(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,b=0;b<m.length&&m[b]<=a;)b++;for(var E=b=Math.max(0,b-1);E<m.length&&m[E]<a+1;)E++;E=Math.min(m.length-1,E);var M=m[b],P=m[E];return c.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:P,minSize:c.evaluate(new F(M)),maxSize:c.evaluate(new F(P)),interpolationType:_}}function Wa(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?Fa(_/128,c.upperSize/128,s.uSizeT):m}function lo(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,b=_?It(Ba.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=Fa(a.minSize,a.maxSize,b):c=b}return{uSizeT:c,uSize:m}}dn("Anchor",ba);var Eo=Object.freeze({__proto__:null,getSizeData:ua,evaluateSizeForFeature:Wa,evaluateSizeForZoom:lo,SIZE_PACK_FACTOR:128});function Io(a,s,c,m,_){if(s.segment===void 0)return!0;for(var b=s,E=s.segment+1,M=0;M>-c/2;){if(--E<0)return!1;M-=a[E].dist(b),b=a[E]}M+=a[E].dist(a[E+1]),E++;for(var P=[],z=0;M<c/2;){var j=a[E],H=a[E+1];if(!H)return!1;var ee=a[E-1].angleTo(j)-j.angleTo(H);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:ee}),z+=ee;M-P[0].distance>m;)z-=P.shift().angleDelta;if(z>_)return!1;E++,M+=j.dist(H)}return!0}function Do(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function $a(a,s,c){return a?.6*s*c:0}function pi(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function jo(a,s,c,m,_,b){for(var E=$a(c,_,b),M=pi(c,m)*b,P=0,z=Do(a)/2,j=0;j<a.length-1;j++){var H=a[j],ee=a[j+1],se=H.dist(ee);if(P+se>z){var Re=(z-P)/se,Be=Fa(H.x,ee.x,Re),tt=Fa(H.y,ee.y,Re),Ge=new ba(Be,tt,ee.angleTo(H),j);return Ge._round(),!E||Io(a,Ge,M,E,s)?Ge:void 0}P+=se}}function Wi(a,s,c,m,_,b,E,M,P){var z=$a(m,b,E),j=pi(m,_),H=j*E,ee=a[0].x===0||a[0].x===P||a[0].y===0||a[0].y===P;return s-H<s/4&&(s=H+s/4),function se(Re,Be,tt,Ge,dt,kt,Lt,$t,ur){for(var Fr=kt/2,Yr=Do(Re),Rn=0,on=Be-tt,Bn=[],un=0;un<Re.length-1;un++){for(var nn=Re[un],jr=Re[un+1],An=nn.dist(jr),Ti=jr.angleTo(nn);on+tt<Rn+An;){var di=((on+=tt)-Rn)/An,Ni=Fa(nn.x,jr.x,di),Nn=Fa(nn.y,jr.y,di);if(Ni>=0&&Ni<ur&&Nn>=0&&Nn<ur&&on-Fr>=0&&on+Fr<=Yr){var $i=new ba(Ni,Nn,Ti,un);$i._round(),Ge&&!Io(Re,$i,kt,Ge,dt)||Bn.push($i)}}Rn+=An}return $t||Bn.length||Lt||(Bn=se(Re,Rn/2,tt,Ge,dt,kt,Lt,!0,ur)),Bn}(a,ee?s/2*M%s:(j/2+2*b)*E*M%s,s,z,c,H,ee,!1,P)}function Un(a,s,c,m,_){for(var b=[],E=0;E<a.length;E++)for(var M=a[E],P=void 0,z=0;z<M.length-1;z++){var j=M[z],H=M[z+1];j.x<s&&H.x<s||(j.x<s?j=new ie(s,j.y+(s-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x<s&&(H=new ie(s,j.y+(s-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y<c&&H.y<c||(j.y<c?j=new ie(j.x+(c-j.y)/(H.y-j.y)*(H.x-j.x),c)._round():H.y<c&&(H=new ie(j.x+(c-j.y)/(H.y-j.y)*(H.x-j.x),c)._round()),j.x>=m&&H.x>=m||(j.x>=m?j=new ie(m,j.y+(m-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x>=m&&(H=new ie(m,j.y+(m-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y>=_&&H.y>=_||(j.y>=_?j=new ie(j.x+(_-j.y)/(H.y-j.y)*(H.x-j.x),_)._round():H.y>=_&&(H=new ie(j.x+(_-j.y)/(H.y-j.y)*(H.x-j.x),_)._round()),P&&j.equals(P[P.length-1])||b.push(P=[j]),P.push(H)))))}return b}function _i(a,s,c,m){var _=[],b=a.image,E=b.pixelRatio,M=b.paddedRect.w-2,P=b.paddedRect.h-2,z=a.right-a.left,j=a.bottom-a.top,H=b.stretchX||[[0,M]],ee=b.stretchY||[[0,P]],se=function(Ni,Nn){return Ni+Nn[1]-Nn[0]},Re=H.reduce(se,0),Be=ee.reduce(se,0),tt=M-Re,Ge=P-Be,dt=0,kt=Re,Lt=0,$t=Be,ur=0,Fr=tt,Yr=0,Rn=Ge;if(b.content&&m){var on=b.content;dt=Ii(H,0,on[0]),Lt=Ii(ee,0,on[1]),kt=Ii(H,on[0],on[2]),$t=Ii(ee,on[1],on[3]),ur=on[0]-dt,Yr=on[1]-Lt,Fr=on[2]-on[0]-kt,Rn=on[3]-on[1]-$t}var Bn=function(Ni,Nn,$i,Pa){var ro=Ks(Ni.stretch-dt,kt,z,a.left),Xa=Cl(Ni.fixed-ur,Fr,Ni.stretch,Re),La=Ks(Nn.stretch-Lt,$t,j,a.top),no=Cl(Nn.fixed-Yr,Rn,Nn.stretch,Be),Oo=Ks($i.stretch-dt,kt,z,a.left),Fo=Cl($i.fixed-ur,Fr,$i.stretch,Re),Es=Ks(Pa.stretch-Lt,$t,j,a.top),Bo=Cl(Pa.fixed-Yr,Rn,Pa.stretch,Be),As=new ie(ro,La),fo=new ie(Oo,La),Go=new ie(Oo,Es),Ri=new ie(ro,Es),la=new ie(Xa/E,no/E),ra=new ie(Fo/E,Bo/E),Ui=s*Math.PI/180;if(Ui){var Fs=Math.sin(Ui),hs=Math.cos(Ui),wa=[hs,-Fs,Fs,hs];As._matMult(wa),fo._matMult(wa),Ri._matMult(wa),Go._matMult(wa)}var To=Ni.stretch+Ni.fixed,ps=Nn.stretch+Nn.fixed;return{tl:As,tr:fo,bl:Ri,br:Go,tex:{x:b.paddedRect.x+1+To,y:b.paddedRect.y+1+ps,w:$i.stretch+$i.fixed-To,h:Pa.stretch+Pa.fixed-ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:la,pixelOffsetBR:ra,minFontScaleX:Fr/E/z,minFontScaleY:Rn/E/j,isSDF:c}};if(m&&(b.stretchX||b.stretchY))for(var un=Va(H,tt,Re),nn=Va(ee,Ge,Be),jr=0;jr<un.length-1;jr++)for(var An=un[jr],Ti=un[jr+1],di=0;di<nn.length-1;di++)_.push(Bn(An,nn[di],Ti,nn[di+1]));else _.push(Bn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return _}function Ii(a,s,c){for(var m=0,_=0,b=a;_<b.length;_+=1){var E=b[_];m+=Math.max(s,Math.min(c,E[1]))-Math.max(s,Math.min(c,E[0]))}return m}function Va(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,b=a;_<b.length;_+=1){var E=b[_],M=E[0],P=E[1],z=m[m.length-1];m.push({fixed:M-z.stretch,stretch:z.stretch}),m.push({fixed:M-z.stretch,stretch:z.stretch+(P-M)})}return m.push({fixed:s+1,stretch:c}),m}function Ks(a,s,c,m){return a/s*c+m}function Cl(a,s,c,m){return a-s*c/m}var De=function(a,s,c,m,_,b,E,M,P,z){if(this.boxStartIndex=a.length,P){var j=b.top,H=b.bottom,ee=b.collisionPadding;ee&&(j-=ee[1],H+=ee[3]);var se=H-j;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{var Re=b.top*E-M,Be=b.bottom*E+M,tt=b.left*E-M,Ge=b.right*E+M,dt=b.collisionPadding;if(dt&&(tt-=dt[0]*E,Re-=dt[1]*E,Ge+=dt[2]*E,Be+=dt[3]*E),z){var kt=new ie(tt,Re),Lt=new ie(Ge,Re),$t=new ie(tt,Be),ur=new ie(Ge,Be),Fr=z*Math.PI/180;kt._rotate(Fr),Lt._rotate(Fr),$t._rotate(Fr),ur._rotate(Fr),tt=Math.min(kt.x,Lt.x,$t.x,ur.x),Ge=Math.max(kt.x,Lt.x,$t.x,ur.x),Re=Math.min(kt.y,Lt.y,$t.y,ur.y),Be=Math.max(kt.y,Lt.y,$t.y,ur.y)}a.emplaceBack(s.x,s.y,tt,Re,Ge,Be,c,m,_)}this.boxEndIndex=a.length},Ft=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=Rt),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Rt(a,s){return a<s?-1:a>s?1:0}function vn(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,b=-1/0,E=-1/0,M=a[0],P=0;P<M.length;P++){var z=M[P];(!P||z.x<m)&&(m=z.x),(!P||z.y<_)&&(_=z.y),(!P||z.x>b)&&(b=z.x),(!P||z.y>E)&&(E=z.y)}var j=Math.min(b-m,E-_),H=j/2,ee=new Ft([],xi);if(j===0)return new ie(m,_);for(var se=m;se<b;se+=j)for(var Re=_;Re<E;Re+=j)ee.push(new Ce(se+H,Re+H,H,a));for(var Be=function(dt){for(var kt=0,Lt=0,$t=0,ur=dt[0],Fr=0,Yr=ur.length,Rn=Yr-1;Fr<Yr;Rn=Fr++){var on=ur[Fr],Bn=ur[Rn],un=on.x*Bn.y-Bn.x*on.y;Lt+=(on.x+Bn.x)*un,$t+=(on.y+Bn.y)*un,kt+=3*un}return new Ce(Lt/kt,$t/kt,0,dt)}(a),tt=ee.length;ee.length;){var Ge=ee.pop();(Ge.d>Be.d||!Be.d)&&(Be=Ge,c&&console.log("found best %d after %d probes",Math.round(1e4*Ge.d)/1e4,tt)),Ge.max-Be.d<=s||(ee.push(new Ce(Ge.p.x-(H=Ge.h/2),Ge.p.y-H,H,a)),ee.push(new Ce(Ge.p.x+H,Ge.p.y-H,H,a)),ee.push(new Ce(Ge.p.x-H,Ge.p.y+H,H,a)),ee.push(new Ce(Ge.p.x+H,Ge.p.y+H,H,a)),tt+=4)}return c&&(console.log("num probes: "+tt),console.log("best distance: "+Be.d)),Be.p}function xi(a,s){return s.max-a.max}function Ce(a,s,c,m){this.p=new ie(a,s),this.h=c,this.d=function(_,b){for(var E=!1,M=1/0,P=0;P<b.length;P++)for(var z=b[P],j=0,H=z.length,ee=H-1;j<H;ee=j++){var se=z[j],Re=z[ee];se.y>_.y!=Re.y>_.y&&_.x<(Re.x-se.x)*(_.y-se.y)/(Re.y-se.y)+se.x&&(E=!E),M=Math.min(M,rl(_,se,Re))}return(E?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}Ft.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Ft.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},Ft.prototype.peek=function(){return this.data[0]},Ft.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,b=s[_];if(c(m,b)>=0)break;s[a]=b,a=_}s[a]=m},Ft.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var b=1+(a<<1),E=s[b],M=b+1;if(M<this.length&&c(s[M],E)<0&&(b=M,E=s[M]),c(E,_)>=0)break;s[a]=E,a=b}s[a]=_};var de=Number.POSITIVE_INFINITY;function qe(a,s){return s[1]!==de?function(c,m,_){var b=0,E=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":E=_-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-_}switch(c){case"top-right":case"bottom-right":case"right":b=-m;break;case"top-left":case"bottom-left":case"left":b=m}return[b,E]}(a,s[0],s[1]):function(c,m){var _=0,b=0;m<0&&(m=0);var E=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":b=E-7;break;case"bottom-right":case"bottom-left":b=7-E;break;case"bottom":b=7-m;break;case"top":b=m-7}switch(c){case"top-right":case"bottom-right":_=-E;break;case"top-left":case"bottom-left":_=E;break;case"left":_=m;break;case"right":_=-m}return[_,b]}(a,s[0])}function mt(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bt(a,s,c,m,_,b,E,M,P,z,j,H,ee,se,Re){var Be=function(Lt,$t,ur,Fr,Yr,Rn,on,Bn){for(var un=Fr.layout.get("text-rotate").evaluate(Rn,{})*Math.PI/180,nn=[],jr=0,An=$t.positionedLines;jr<An.length;jr+=1)for(var Ti=An[jr],di=0,Ni=Ti.positionedGlyphs;di<Ni.length;di+=1){var Nn=Ni[di];if(Nn.rect){var $i=Nn.rect||{},Pa=4,ro=!0,Xa=1,La=0,no=(Yr||Bn)&&Nn.vertical,Oo=Nn.metrics.advance*Nn.scale/2;if(Bn&&$t.verticalizable&&(La=Ti.lineOffset/2-(Nn.imageName?-(24-Nn.metrics.width*Nn.scale)/2:24*(Nn.scale-1))),Nn.imageName){var Fo=on[Nn.imageName];ro=Fo.sdf,Pa=1/(Xa=Fo.pixelRatio)}var Es=Yr?[Nn.x+Oo,Nn.y]:[0,0],Bo=Yr?[0,0]:[Nn.x+Oo+ur[0],Nn.y+ur[1]-La],As=[0,0];no&&(As=Bo,Bo=[0,0]);var fo=(Nn.metrics.left-Pa)*Nn.scale-Oo+Bo[0],Go=(-Nn.metrics.top-Pa)*Nn.scale+Bo[1],Ri=fo+$i.w*Nn.scale/Xa,la=Go+$i.h*Nn.scale/Xa,ra=new ie(fo,Go),Ui=new ie(Ri,Go),Fs=new ie(fo,la),hs=new ie(Ri,la);if(no){var wa=new ie(-Oo,Oo- -17),To=-Math.PI/2,ps=12-Oo,Zi=new ie(22-ps,-(Nn.imageName?ps:0)),Dc=new(Function.prototype.bind.apply(ie,[null].concat(As)));ra._rotateAround(To,wa)._add(Zi)._add(Dc),Ui._rotateAround(To,wa)._add(Zi)._add(Dc),Fs._rotateAround(To,wa)._add(Zi)._add(Dc),hs._rotateAround(To,wa)._add(Zi)._add(Dc)}if(un){var Du=Math.sin(un),Oc=Math.cos(un),ho=[Oc,-Du,Du,Oc];ra._matMult(ho),Ui._matMult(ho),Fs._matMult(ho),hs._matMult(ho)}var Fc=new ie(0,0),Tl=new ie(0,0);nn.push({tl:ra,tr:Ui,bl:Fs,br:hs,tex:$i,writingMode:$t.writingMode,glyphOffset:Es,sectionIndex:Nn.sectionIndex,isSDF:ro,pixelOffsetTL:Fc,pixelOffsetBR:Tl,minFontScaleX:0,minFontScaleY:0})}}return nn}(0,c,M,_,b,E,m,a.allowVerticalPlacement),tt=a.textSizeData,Ge=null;tt.kind==="source"?(Ge=[128*_.layout.get("text-size").evaluate(E,{})])[0]>32640&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):tt.kind==="composite"&&((Ge=[128*se.compositeTextSizes[0].evaluate(E,{},Re),128*se.compositeTextSizes[1].evaluate(E,{},Re)])[0]>32640||Ge[1]>32640)&&ft(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Be,Ge,M,b,E,z,s,P.lineStartIndex,P.lineLength,ee,Re);for(var dt=0,kt=j;dt<kt.length;dt+=1)H[kt[dt]]=a.text.placedSymbolArray.length-1;return 4*Be.length}function et(a){for(var s in a)return a[s];return null}function Ke(a,s,c,m){var _=a.compareText;if(s in _){for(var b=_[s],E=b.length-1;E>=0;E--)if(m.dist(b[E])<c)return!0}else _[s]=[];return _[s].push(m),!1}var Je=Pc.VectorTileFeature.types,Ae=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $e(a,s,c,m,_,b,E,M,P,z,j,H,ee){var se=M?Math.min(32640,Math.round(M[0])):0,Re=M?Math.min(32640,Math.round(M[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),b,E,(se<<1)+(P?1:0),Re,16*z,16*j,256*H,256*ee)}function Ee(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function vt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(qc(c[s].text))return!0;return!1}var Et=function(a){this.layoutVertexArray=new tf,this.indexArray=new Ju,this.programConfigurations=a,this.segments=new ve,this.dynamicLayoutVertexArray=new Hl,this.opacityVertexArray=new Cc,this.placedSymbolArray=new g};Et.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Et.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Pd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Bp.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Ae,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},Et.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},dn("SymbolBuffers",Et);var or=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ve,this.collisionVertexArray=new Ws};or.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,zp.members,!0)},or.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},dn("CollisionBuffers",or);var Bt=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qa([]),this.placementViewportMatrix=Qa([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ua(this.zoom,s["text-size"]),this.iconSizeData=ua(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(b){return Fn[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=a.sourceID};Bt.prototype.createArrays=function(){this.text=new Et(new jn(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Et(new jn(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new T,this.lineVertexArray=new I,this.symbolInstances=new C},Bt.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var b=0;b<a.length;b++)if(s[a.charCodeAt(b)]=!0,(c||m)&&_){var E=of[a.charAt(b)];E&&(s[E.charCodeAt(0)]=!0)}},Bt.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,b=_.get("text-font"),E=_.get("text-field"),M=_.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof Ji&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=_.get("symbol-sort-key");if(this.features=[],P||z){for(var H=s.iconDependencies,ee=s.glyphDependencies,se=s.availableImages,Re=new F(this.zoom),Be=0,tt=a;Be<tt.length;Be+=1){var Ge=tt[Be],dt=Ge.feature,kt=Ge.id,Lt=Ge.index,$t=Ge.sourceLayerIndex,ur=m._featureFilter.needGeometry,Fr=Ta(dt,ur);if(m._featureFilter.filter(Re,Fr,c)){ur||(Fr.geometry=_a(dt));var Yr=void 0;if(P){var Rn=m.getValueAndResolveTokens("text-field",Fr,c,se),on=Ji.factory(Rn);vt(on)&&(this.hasRTLText=!0),(!this.hasRTLText||Qc()==="unavailable"||this.hasRTLText&&Ie.isParsed())&&(Yr=Rd(on,m,Fr))}var Bn=void 0;if(z){var un=m.getValueAndResolveTokens("icon-image",Fr,c,se);Bn=un instanceof aa?un:aa.fromString(un)}if(Yr||Bn){var nn=this.sortFeaturesByKey?j.evaluate(Fr,{},c):void 0;if(this.features.push({id:kt,text:Yr,icon:Bn,index:Lt,sourceLayerIndex:$t,geometry:Fr.geometry,properties:dt.properties,type:Je[dt.type],sortKey:nn}),Bn&&(H[Bn.name]=!0),Yr){var jr=b.evaluate(Fr,{},c).join(","),An=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fn.vertical)>=0;for(var Ti=0,di=Yr.sections;Ti<di.length;Ti+=1){var Ni=di[Ti];if(Ni.image)H[Ni.image.name]=!0;else{var Nn=Yc(Yr.toString()),$i=Ni.fontStack||jr,Pa=ee[$i]=ee[$i]||{};this.calculateGlyphDependencies(Ni.text,Pa,An,this.allowVerticalPlacement,Nn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(ro){var Xa={},La={},no=[],Oo=0;function Fo(wa){no.push(ro[wa]),Oo++}function Es(wa,To,ps){var Zi=La[wa];return delete La[wa],La[To]=Zi,no[Zi].geometry[0].pop(),no[Zi].geometry[0]=no[Zi].geometry[0].concat(ps[0]),Zi}function Bo(wa,To,ps){var Zi=Xa[To];return delete Xa[To],Xa[wa]=Zi,no[Zi].geometry[0].shift(),no[Zi].geometry[0]=ps[0].concat(no[Zi].geometry[0]),Zi}function As(wa,To,ps){var Zi=ps?To[0][To[0].length-1]:To[0][0];return wa+":"+Zi.x+":"+Zi.y}for(var fo=0;fo<ro.length;fo++){var Go=ro[fo],Ri=Go.geometry,la=Go.text?Go.text.toString():null;if(la){var ra=As(la,Ri),Ui=As(la,Ri,!0);if(ra in La&&Ui in Xa&&La[ra]!==Xa[Ui]){var Fs=Bo(ra,Ui,Ri),hs=Es(ra,Ui,no[Fs].geometry);delete Xa[ra],delete La[Ui],La[As(la,no[hs].geometry,!0)]=hs,no[Fs].geometry=null}else ra in La?Es(ra,Ui,Ri):Ui in Xa?Bo(ra,Ui,Ri):(Fo(fo),Xa[ra]=Oo-1,La[Ui]=Oo-1)}else Fo(fo)}return no.filter(function(wa){return wa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ro,Xa){return ro.sortKey-Xa.sortKey})}},Bt.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},Bt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Bt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Bt.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Bt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Bt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Bt.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),b={},E=a.segment+1;E<s.length;E++)b[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:m},E<s.length-1&&(m+=s[E+1].dist(s[E]));for(var M=a.segment||0;M>=0;M--)b[M]={x:s[M].x,y:s[M].y,tileUnitDistanceFromAnchor:_},M>0&&(_+=s[M-1].dist(s[M]));for(var P=0;P<s.length;P++){var z=b[P];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},Bt.prototype.addSymbols=function(a,s,c,m,_,b,E,M,P,z,j,H){for(var ee=a.indexArray,se=a.layoutVertexArray,Re=a.segments.prepareSegment(4*s.length,se,ee,this.canOverlap?b.sortKey:void 0),Be=this.glyphOffsetArray.length,tt=Re.vertexLength,Ge=this.allowVerticalPlacement&&E===Fn.vertical?Math.PI/2:0,dt=b.text&&b.text.sections,kt=0;kt<s.length;kt++){var Lt=s[kt],$t=Lt.tl,ur=Lt.tr,Fr=Lt.bl,Yr=Lt.br,Rn=Lt.tex,on=Lt.pixelOffsetTL,Bn=Lt.pixelOffsetBR,un=Lt.minFontScaleX,nn=Lt.minFontScaleY,jr=Lt.glyphOffset,An=Lt.isSDF,Ti=Lt.sectionIndex,di=Re.vertexLength,Ni=jr[1];$e(se,M.x,M.y,$t.x,Ni+$t.y,Rn.x,Rn.y,c,An,on.x,on.y,un,nn),$e(se,M.x,M.y,ur.x,Ni+ur.y,Rn.x+Rn.w,Rn.y,c,An,Bn.x,on.y,un,nn),$e(se,M.x,M.y,Fr.x,Ni+Fr.y,Rn.x,Rn.y+Rn.h,c,An,on.x,Bn.y,un,nn),$e(se,M.x,M.y,Yr.x,Ni+Yr.y,Rn.x+Rn.w,Rn.y+Rn.h,c,An,Bn.x,Bn.y,un,nn),Ee(a.dynamicLayoutVertexArray,M,Ge),ee.emplaceBack(di,di+1,di+2),ee.emplaceBack(di+1,di+2,di+3),Re.vertexLength+=4,Re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jr[0]),kt!==s.length-1&&Ti===s[kt+1].sectionIndex||a.programConfigurations.populatePaintArrays(se.length,b,b.index,{},H,dt&&dt[Ti])}a.placedSymbolArray.emplaceBack(M.x,M.y,Be,this.glyphOffsetArray.length-Be,tt,P,z,M.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],E,0,!1,0,j)},Bt.prototype._addCollisionDebugVertex=function(a,s,c,m,_,b){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(b.x),Math.round(b.y))},Bt.prototype.addCollisionDebugVertices=function(a,s,c,m,_,b,E){var M=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),P=M.vertexLength,z=_.layoutVertexArray,j=_.collisionVertexArray,H=E.anchorX,ee=E.anchorY;this._addCollisionDebugVertex(z,j,b,H,ee,new ie(a,s)),this._addCollisionDebugVertex(z,j,b,H,ee,new ie(c,s)),this._addCollisionDebugVertex(z,j,b,H,ee,new ie(c,m)),this._addCollisionDebugVertex(z,j,b,H,ee,new ie(a,m)),M.vertexLength+=4;var se=_.indexArray;se.emplaceBack(P,P+1),se.emplaceBack(P+1,P+2),se.emplaceBack(P+2,P+3),se.emplaceBack(P+3,P),M.primitiveLength+=4},Bt.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,m?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,c)}},Bt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new or(Wl,Jh.members,Tc),this.iconCollisionBox=new or(Wl,Jh.members,Tc);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Bt.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,b,E,M,P){for(var z={},j=s;j<c;j++){var H=a.get(j);z.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},z.textFeatureIndex=H.featureIndex;break}for(var ee=m;ee<_;ee++){var se=a.get(ee);z.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},z.verticalTextFeatureIndex=se.featureIndex;break}for(var Re=b;Re<E;Re++){var Be=a.get(Re);z.iconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},z.iconFeatureIndex=Be.featureIndex;break}for(var tt=M;tt<P;tt++){var Ge=a.get(tt);z.verticalIconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},z.verticalIconFeatureIndex=Ge.featureIndex;break}return z},Bt.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},Bt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Bt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Bt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Bt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Bt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Bt.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},Bt.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],b=[],E=0;E<this.symbolInstances.length;++E){b.push(E);var M=this.symbolInstances.get(E);m.push(0|Math.round(s*M.anchorX+c*M.anchorY)),_.push(M.featureIndex)}return b.sort(function(P,z){return m[P]-m[z]||_[z]-_[P]}),b},Bt.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Bt.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(b,E,M){b>=0&&M.indexOf(b)===E&&s.addIndicesForPlacedSymbol(s.text,b)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},dn("SymbolBucket",Bt,{omit:["layers","collisionBoxArray","features","compareText"]}),Bt.MAX_GLYPHS=65535,Bt.addDynamicAttributes=Ee;var er=new uo({"symbol-placement":new In(he.layout_symbol["symbol-placement"]),"symbol-spacing":new In(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new In(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new mn(he.layout_symbol["icon-size"]),"icon-text-fit":new In(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new mn(he.layout_symbol["icon-image"]),"icon-rotate":new mn(he.layout_symbol["icon-rotate"]),"icon-padding":new In(he.layout_symbol["icon-padding"]),"icon-keep-upright":new In(he.layout_symbol["icon-keep-upright"]),"icon-offset":new mn(he.layout_symbol["icon-offset"]),"icon-anchor":new mn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(he.layout_symbol["text-rotation-alignment"]),"text-field":new mn(he.layout_symbol["text-field"]),"text-font":new mn(he.layout_symbol["text-font"]),"text-size":new mn(he.layout_symbol["text-size"]),"text-max-width":new mn(he.layout_symbol["text-max-width"]),"text-line-height":new In(he.layout_symbol["text-line-height"]),"text-letter-spacing":new mn(he.layout_symbol["text-letter-spacing"]),"text-justify":new mn(he.layout_symbol["text-justify"]),"text-radial-offset":new mn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(he.layout_symbol["text-variable-anchor"]),"text-anchor":new mn(he.layout_symbol["text-anchor"]),"text-max-angle":new In(he.layout_symbol["text-max-angle"]),"text-writing-mode":new In(he.layout_symbol["text-writing-mode"]),"text-rotate":new mn(he.layout_symbol["text-rotate"]),"text-padding":new In(he.layout_symbol["text-padding"]),"text-keep-upright":new In(he.layout_symbol["text-keep-upright"]),"text-transform":new mn(he.layout_symbol["text-transform"]),"text-offset":new mn(he.layout_symbol["text-offset"]),"text-allow-overlap":new In(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new In(he.layout_symbol["text-ignore-placement"]),"text-optional":new In(he.layout_symbol["text-optional"])}),Pr={paint:new uo({"icon-opacity":new mn(he.paint_symbol["icon-opacity"]),"icon-color":new mn(he.paint_symbol["icon-color"]),"icon-halo-color":new mn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new mn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new In(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new mn(he.paint_symbol["text-opacity"]),"text-color":new mn(he.paint_symbol["text-color"],{runtimeType:qr,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new mn(he.paint_symbol["text-halo-color"]),"text-halo-width":new mn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new mn(he.paint_symbol["text-halo-blur"]),"text-translate":new In(he.paint_symbol["text-translate"]),"text-translate-anchor":new In(he.paint_symbol["text-translate-anchor"])}),layout:er},Tn=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:cn,this.defaultValue=a};Tn.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Tn.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){return null},dn("FormatSectionOverride",Tn,{omit:["defaultValue"]});var Qn=function(a){function s(c){a.call(this,c,Pr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var b=[],E=0,M=_;E<M.length;E+=1){var P=M[E];b.indexOf(P)<0&&b.push(P)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,b){var E=this.layout.get(c).evaluate(m,{},_,b),M=this._unevaluatedLayout._values[c];return M.isDataDriven()||Su(M.value)||!E?E:function(P,z){return z.replace(/{([^{}]+)}/g,function(j,H){return H in P?String(P[H]):""})}(m.properties,E)},s.prototype.createBucket=function(c){return new Bt(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=Pr.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var b,E=this.paint.get(_),M=new Tn(E),P=new js(M,E.property.specification);b=E.value.kind==="constant"||E.value.kind==="source"?new ml("source",P):new wu("composite",P,E.value.zoomStops,E.value._interpolationType),this.paint._values[_]=new da(E.property,b,E.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),b=Pr.paint.properties[m],E=!1,M=function(j){for(var H=0,ee=j;H<ee.length;H+=1)if(b.overrides&&b.overrides.hasOverride(ee[H]))return void(E=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Ji)M(_.value.value.sections);else if(_.value.kind==="source"){var P=function(j){E||(j instanceof oa&&pa(j.value)===zi?M(j.value.sections):j instanceof Po?M(j.sections):j.eachChild(P))},z=_.value;z._styleExpression&&P(z._styleExpression.expression)}return E},s}(Ps),gn={paint:new uo({"background-color":new In(he.paint_background["background-color"]),"background-pattern":new Lo(he.paint_background["background-pattern"]),"background-opacity":new In(he.paint_background["background-opacity"])})},zn=function(a){function s(c){a.call(this,c,gn)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ps),oi={paint:new uo({"raster-opacity":new In(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(he.paint_raster["raster-brightness-max"]),"raster-saturation":new In(he.paint_raster["raster-saturation"]),"raster-contrast":new In(he.paint_raster["raster-contrast"]),"raster-resampling":new In(he.paint_raster["raster-resampling"]),"raster-fade-duration":new In(he.paint_raster["raster-fade-duration"])})},Bi=function(a){function s(c){a.call(this,c,oi)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Ps),Ia=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(Ps),ns={circle:ko,heatmap:fh,hillshade:Mp,fill:Td,"fill-extrusion":Ss,line:Id,symbol:Qn,background:zn,raster:Bi},Bf=ae.HTMLImageElement,Js=ae.HTMLCanvasElement,Qh=ae.HTMLVideoElement,du=ae.ImageData,zf=ae.ImageBitmap,Nf=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};Nf.prototype.update=function(a,s,c){var m=a.width,_=a.height,b=!(this.size&&this.size[0]===m&&this.size[1]===_||c),E=this.context,M=E.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[m,_],a instanceof Bf||a instanceof Js||a instanceof Qh||a instanceof du||zf&&a instanceof zf?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,a):M.texImage2D(M.TEXTURE_2D,0,this.format,m,_,0,this.format,M.UNSIGNED_BYTE,a.data);else{var P=c||{x:0,y:0},z=P.x,j=P.y;a instanceof Bf||a instanceof Js||a instanceof Qh||a instanceof du||zf&&a instanceof zf?M.texSubImage2D(M.TEXTURE_2D,0,z,j,M.RGBA,M.UNSIGNED_BYTE,a):M.texSubImage2D(M.TEXTURE_2D,0,z,j,m,_,M.RGBA,M.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},Nf.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},Nf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Nf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Zp=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Zp.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Zp.prototype.remove=function(){delete this._channel,this._callback=function(){}};var wh=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Br(["receive","process"],this),this.invoker=new Zp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Y()?a:ae};function Vv(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}wh.prototype.send=function(a,s,c,m,_){var b=this;_===void 0&&(_=!1);var E=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[E]=c);var M=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:Is(s,M)},M),{cancel:function(){c&&delete b.callbacks[E],b.target.postMessage({id:E,type:"<cancel>",targetMapId:m,sourceMapId:b.mapId})}}},wh.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else Y()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},wh.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},wh.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(cs(s.error)):m(null,cs(s.data)))}else{var _=!1,b=Me(this.globalScope)?void 0:[],E=s.hasCallback?function(j,H){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:j?Is(j):null,data:Is(H,b)},b)}:function(j){_=!0},M=null,P=cs(s.data);if(this.parent[s.type])M=this.parent[s.type](s.sourceMapId,P,E);else if(this.parent.getWorkerSource){var z=s.type.split(".");M=this.parent.getWorkerSource(s.sourceMapId,z[0],P.source)[z[1]](P,E)}else E(new Error("Could not find function "+s.type));!_&&M&&M.cancel&&(this.cancelCallbacks[a]=M.cancel)}},wh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var co=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};co.prototype.setNorthEast=function(a){return this._ne=a instanceof Sa?new Sa(a.lng,a.lat):Sa.convert(a),this},co.prototype.setSouthWest=function(a){return this._sw=a instanceof Sa?new Sa(a.lng,a.lat):Sa.convert(a),this},co.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof Sa)s=a,c=a;else{if(!(a instanceof co))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(co.convert(a)):this.extend(Sa.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new Sa(s.lng,s.lat),this._ne=new Sa(c.lng,c.lat)),this},co.prototype.getCenter=function(){return new Sa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},co.prototype.getSouthWest=function(){return this._sw},co.prototype.getNorthEast=function(){return this._ne},co.prototype.getNorthWest=function(){return new Sa(this.getWest(),this.getNorth())},co.prototype.getSouthEast=function(){return new Sa(this.getEast(),this.getSouth())},co.prototype.getWest=function(){return this._sw.lng},co.prototype.getSouth=function(){return this._sw.lat},co.prototype.getEast=function(){return this._ne.lng},co.prototype.getNorth=function(){return this._ne.lat},co.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},co.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},co.prototype.isEmpty=function(){return!(this._sw&&this._ne)},co.prototype.contains=function(a){var s=Sa.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},co.convert=function(a){return!a||a instanceof co?a:new co(a)};var Sa=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Sa.prototype.wrap=function(){return new Sa(tr(this.lng,-180,180),this.lat)},Sa.prototype.toArray=function(){return[this.lng,this.lat]},Sa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Sa.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},Sa.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new co(new Sa(this.lng-c,this.lat-s),new Sa(this.lng+c,this.lat+s))},Sa.convert=function(a){if(a instanceof Sa)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Sa(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Sa(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var jv=2*Math.PI*63710088e-1;function Gv(a){return jv*Math.cos(a*Math.PI/180)}function Hv(a){return(180+a)/360}function Wv(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Dd(a,s){return a/Gv(s)}function Up(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Zf=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};Zf.fromLngLat=function(a,s){s===void 0&&(s=0);var c=Sa.convert(a);return new Zf(Hv(c.lng),Wv(c.lat),Dd(s,c.lat))},Zf.prototype.toLngLat=function(){return new Sa(360*this.x-180,Up(this.y))},Zf.prototype.toAltitude=function(){return this.z*Gv(Up(this.y))},Zf.prototype.meterInMercatorCoordinateUnits=function(){return 1/jv*(a=Up(this.y),1/Math.cos(a*Math.PI/180));var a};var Uf=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=ep(0,a,a,s,c)};Uf.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Uf.prototype.url=function(a,s){var c,m,_,b,E,M=(m=this.y,_=this.z,b=Vv(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),E=Vv(256*(c+1),256*(m+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]),P=function(z,j,H){for(var ee,se="",Re=z;Re>0;Re--)se+=(j&(ee=1<<Re-1)?1:0)+(H&ee?2:0);return se}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",P).replace("{bbox-epsg-3857}",M)},Uf.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new ie(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},Uf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Od=function(a,s){this.wrap=a,this.canonical=s,this.key=ep(a,s.z,s.z,s.x,s.y)},Ao=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new Uf(c,+m,+_),this.key=ep(s,a,c,m,_)};function ep(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var b=1<<c;return(b*b*a+b*_+m).toString(36)+c.toString(36)+s.toString(36)}Ao.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Ao.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new Ao(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ao(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},Ao.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?ep(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):ep(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},Ao.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},Ao.prototype.children=function(a){if(this.overscaledZ>=a)return[new Ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Ao(s,this.wrap,s,c,m),new Ao(s,this.wrap,s,c+1,m),new Ao(s,this.wrap,s,c,m+1),new Ao(s,this.wrap,s,c+1,m+1)]},Ao.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Ao.prototype.wrapped=function(){return new Ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ao.prototype.unwrapTo=function(a){return new Ao(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Ao.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ao.prototype.toUnwrapped=function(){return new Od(this.wrap,this.canonical)},Ao.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ao.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Zf(a.x-this.wrap,a.y))},dn("CanonicalTileID",Uf),dn("OverscaledTileID",Ao,{omit:["posMatrix"]});var Rc=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return ft('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Rc.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Rc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Rc.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},Rc.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},Rc.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},Rc.prototype.getPixels=function(){return new to({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Rc.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,b=c*this.dim,E=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:b=E-1;break;case 1:E=b+1}for(var M=-s*this.dim,P=-c*this.dim,z=b;z<E;z++)for(var j=m;j<_;j++)this.data[this._idx(j,z)]=a.data[this._idx(j+M,z+P)]},dn("DEMData",Rc);var Vp=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};Vp.prototype.encode=function(a){return this._stringToNumber[a]},Vp.prototype.decode=function(a){return this._numberToString[a]};var jp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},Fd={geometry:{configurable:!0}};Fd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Fd.geometry.set=function(a){this._geometry=a},jp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(jp.prototype,Fd);var Eh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Eh.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},qt(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var b in this.deletedStates[a][m]={},this.state[a][m])c[b]||(this.deletedStates[a][m][b]=null);else for(var E in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][E]===null&&delete this.deletedStates[a][m][E]},Eh.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},Eh.prototype.getState=function(a,s){var c=String(s),m=qt({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var b in _)delete m[b]}return m},Eh.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},Eh.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var b in this.stateChanges[m])this.state[m][b]||(this.state[m][b]={}),qt(this.state[m][b],this.stateChanges[m][b]),_[b]=this.state[m][b];c[m]=_}for(var E in this.deletedStates){this.state[E]=this.state[E]||{};var M={};if(this.deletedStates[E]===null)for(var P in this.state[E])M[P]={},this.state[E][P]={};else for(var z in this.deletedStates[E]){if(this.deletedStates[E][z]===null)this.state[E][z]={};else for(var j=0,H=Object.keys(this.deletedStates[E][z]);j<H.length;j+=1)delete this.state[E][z][H[j]];M[z]=this.state[E][z]}c[E]=c[E]||{},qt(c[E],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var ee in a)a[ee].setFeatureState(c,s)};var ec=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Wu(8192,16,0),this.grid3D=new Wu(8192,16,0),this.featureIndexArray=new $,this.promoteId=s};function $v(a,s,c,m,_){return lr(a,function(b,E){var M=s instanceof xl?s.get(E):null;return M&&M.evaluate?M.evaluate(c,m,_):M})}function Xv(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,b=0,E=a;b<E.length;b+=1){var M=E[b];s=Math.min(s,M.x),c=Math.min(c,M.y),m=Math.max(m,M.x),_=Math.max(_,M.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function $m(a,s){return s-a}ec.prototype.insert=function(a,s,c,m,_,b){var E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var M=b?this.grid3D:this.grid,P=0;P<s.length;P++){for(var z=s[P],j=[1/0,1/0,-1/0,-1/0],H=0;H<z.length;H++){var ee=z[H];j[0]=Math.min(j[0],ee.x),j[1]=Math.min(j[1],ee.y),j[2]=Math.max(j[2],ee.x),j[3]=Math.max(j[3],ee.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&M.insert(E,j[0],j[1],j[2],j[3])}},ec.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Pc.VectorTile(new Se(this.rawTileData)).layers,this.sourceLayerCoder=new Vp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ec.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var b=a.params||{},E=8192/a.tileSize/a.scale,M=ju(b.filter),P=a.queryGeometry,z=a.queryPadding*E,j=Xv(P),H=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),ee=Xv(a.cameraQueryGeometry),se=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Lt,$t,ur,Fr){return function(Yr,Rn,on,Bn,un){for(var nn=0,jr=Yr;nn<jr.length;nn+=1){var An=jr[nn];if(Rn<=An.x&&on<=An.y&&Bn>=An.x&&un>=An.y)return!0}var Ti=[new ie(Rn,on),new ie(Rn,un),new ie(Bn,un),new ie(Bn,on)];if(Yr.length>2){for(var di=0,Ni=Ti;di<Ni.length;di+=1)if(Ds(Yr,Ni[di]))return!0}for(var Nn=0;Nn<Yr.length-1;Nn++)if(Iu(Yr[Nn],Yr[Nn+1],Ti))return!0;return!1}(a.cameraQueryGeometry,Lt-z,$t-z,ur+z,Fr+z)}),Re=0,Be=se;Re<Be.length;Re+=1)H.push(Be[Re]);H.sort($m);for(var tt,Ge={},dt=function(Lt){var $t=H[Lt];if($t!==tt){tt=$t;var ur=_.featureIndexArray.get($t),Fr=null;_.loadMatchingFeature(Ge,ur.bucketIndex,ur.sourceLayerIndex,ur.featureIndex,M,b.layers,b.availableImages,s,c,m,function(Yr,Rn,on){return Fr||(Fr=_a(Yr)),Rn.queryIntersectsFeature(P,Yr,on,Fr,_.z,a.transform,E,a.pixelPosMatrix)})}},kt=0;kt<H.length;kt++)dt(kt);return Ge},ec.prototype.loadMatchingFeature=function(a,s,c,m,_,b,E,M,P,z,j){var H=this.bucketLayerIDs[s];if(!b||function(Yr,Rn){for(var on=0;on<Yr.length;on++)if(Rn.indexOf(Yr[on])>=0)return!0;return!1}(b,H)){var ee=this.sourceLayerCoder.decode(c),se=this.vtLayers[ee].feature(m);if(_.needGeometry){var Re=Ta(se,!0);if(!_.filter(new F(this.tileID.overscaledZ),Re,this.tileID.canonical))return}else if(!_.filter(new F(this.tileID.overscaledZ),se))return;for(var Be=this.getId(se,ee),tt=0;tt<H.length;tt++){var Ge=H[tt];if(!(b&&b.indexOf(Ge)<0)){var dt=M[Ge];if(dt){var kt={};Be!==void 0&&z&&(kt=z.getState(dt.sourceLayer||"_geojsonTileLayer",Be));var Lt=qt({},P[Ge]);Lt.paint=$v(Lt.paint,dt.paint,se,kt,E),Lt.layout=$v(Lt.layout,dt.layout,se,kt,E);var $t=!j||j(se,dt,kt);if($t){var ur=new jp(se,this.z,this.x,this.y,Be);ur.layer=Lt;var Fr=a[Ge];Fr===void 0&&(Fr=a[Ge]=[]),Fr.push({featureIndex:m,feature:ur,intersectionZ:$t})}}}}}},ec.prototype.lookupSymbolFeatures=function(a,s,c,m,_,b,E,M){var P={};this.loadVTLayers();for(var z=ju(_),j=0,H=a;j<H.length;j+=1)this.loadMatchingFeature(P,c,m,H[j],z,b,E,M,s);return P},ec.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},ec.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},dn("FeatureIndex",ec,{omit:["rawTileData","sourceLayerCoder"]});var Co=function(a,s){this.tileID=a,this.uid=rr(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Co.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<Vn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Co.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Co.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(z,j){var H={};if(!j)return H;for(var ee=function(){var Be=Re[se],tt=Be.layerIds.map(function(kt){return j.getLayer(kt)}).filter(Boolean);if(tt.length!==0){Be.layers=tt,Be.stateDependentLayerIds&&(Be.stateDependentLayers=Be.stateDependentLayerIds.map(function(kt){return tt.filter(function(Lt){return Lt.id===kt})[0]}));for(var Ge=0,dt=tt;Ge<dt.length;Ge+=1)H[dt[Ge].id]=Be}},se=0,Re=z;se<Re.length;se+=1)ee();return H}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof Bt){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var E=this.buckets[b];if(E instanceof Bt&&E.hasRTLText){this.hasRTLText=!0,Ie.isLoading()||Ie.isLoaded()||Qc()!=="deferred"||Pt();break}}for(var M in this.queryPadding=0,this.buckets){var P=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(M).queryRadius(P))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},Co.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Co.prototype.getBucket=function(a){return this.buckets[a.id]},Co.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nf(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nf(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},Co.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Co.prototype.queryRenderedFeatures=function(a,s,c,m,_,b,E,M,P,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:M,params:E,queryPadding:this.queryPadding*P},a,s,c):{}},Co.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",b=m._geojsonTileLayer||m[_];if(b)for(var E=ju(s&&s.filter),M=this.tileID.canonical,P=M.z,z=M.x,j=M.y,H={z:P,x:z,y:j},ee=0;ee<b.length;ee++){var se=b.feature(ee);if(E.needGeometry){var Re=Ta(se,!0);if(!E.filter(new F(this.tileID.overscaledZ),Re,this.tileID.canonical))continue}else if(!E.filter(new F(this.tileID.overscaledZ),se))continue;var Be=c.getId(se,_),tt=new jp(se,P,z,j,Be);tt.tile=H,a.push(tt)}}},Co.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Co.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Co.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Le(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var b=this.expirationTime-s;b?this.expirationTime=m+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Co.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Co.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],b=_.layers[0].sourceLayer||"_geojsonTileLayer",E=c[b],M=a[b];if(E&&M&&Object.keys(M).length!==0){_.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});var P=s&&s.style&&s.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(_)))}}}},Co.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Co.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vn.now()},Co.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Co.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Vn.now()+a},Co.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},Co.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var b=0,E=s;b<E.length;b+=1)if(_[E[b]])return!0}}return!1};var sf=ae.performance,Yv=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},sf.mark(this._marks.start)};Yv.prototype.finish=function(){sf.mark(this._marks.end);var a=sf.getEntriesByName(this._marks.measure);return a.length===0&&(sf.measure(this._marks.measure,this._marks.start,this._marks.end),a=sf.getEntriesByName(this._marks.measure),sf.clearMarks(this._marks.start),sf.clearMarks(this._marks.end),sf.clearMeasures(this._marks.measure)),a},y.Actor=wh,y.AlphaImage=ts,y.CanonicalTileID=Uf,y.CollisionBoxArray=d,y.Color=gi,y.DEMData=Rc,y.DataConstantProperty=In,y.DictionaryCoder=Vp,y.EXTENT=8192,y.ErrorEvent=Qe,y.EvaluationParameters=F,y.Event=Oe,y.Evented=ot,y.FeatureIndex=ec,y.FillBucket=Os,y.FillExtrusionBucket=bs,y.ImageAtlas=Nt,y.ImagePosition=pr,y.LineBucket=rs,y.LngLat=Sa,y.LngLatBounds=co,y.MercatorCoordinate=Zf,y.ONE_EM=24,y.OverscaledTileID=Ao,y.Point=ie,y.Point$1=ie,y.Properties=uo,y.Protobuf=Se,y.RGBAImage=to,y.RequestManager=Pi,y.RequestPerformance=Yv,y.ResourceType=wn,y.SegmentVector=ve,y.SourceFeatureState=Eh,y.StructArrayLayout1ui2=ch,y.StructArrayLayout2f1f2i16=Ku,y.StructArrayLayout2i4=qu,y.StructArrayLayout3ui6=Ju,y.StructArrayLayout4i8=ef,y.SymbolBucket=Bt,y.Texture=Nf,y.Tile=Co,y.Transitionable=qa,y.Uniform1f=Nr,y.Uniform1i=hr,y.Uniform2f=Dr,y.Uniform3f=an,y.Uniform4f=En,y.UniformColor=Dn,y.UniformMatrix4f=Li,y.UnwrappedTileID=Od,y.ValidationError=K,y.WritingMode=Fn,y.ZoomHistory=_l,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=Ee,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),b=null;a.forEach(function(E,M){s(E,function(P,z){P&&(b=P),_[M]=z,--m==0&&c(b,_)})})},y.bezier=nt,y.bindAll=Br,y.browser=Vn,y.cacheEntryPossiblyAdded=function(a){++Cn>ar&&(a.getActor().send("enforceCacheSizeLimit",Tt),Cn=0)},y.clamp=It,y.clearTileCache=function(a){var s=ae.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Un,y.clone=function(a){var s=new Oi(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=at,y.clone$2=function(a){var s=new Oi(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=Ld,y.config=rn,y.create=function(){var a=new Oi(16);return Oi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new Oi(9);return Oi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new Oi(4);return Oi!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=oe,y.createExpression=gc,y.createLayout=Ha,y.createStyleLayer=function(a){return a.type==="custom"?new Ia(a):new ns[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=c[0],M=c[1],P=c[2];return a[0]=_*P-b*M,a[1]=b*E-m*P,a[2]=m*M-_*E,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=ct,y.emitValidationErrors=Cu,y.endsWith=dr,y.enforceCacheSizeLimit=function(a){wr(),re&&re.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=Wa,y.evaluateSizeForZoom=lo,y.evaluateVariableOffset=qe,y.evented=wc,y.extend=qt,y.featureFilter=ju,y.filterObject=_t,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=Ua,y.getAnchorJustification=mt,y.getArrayBuffer=Wo,y.getImage=X,y.getJSON=function(a,s){return mo(qt(a,{type:"json"}),s)},y.getRTLTextPluginStatus=Qc,y.getReferrer=Kn,y.getVideo=function(a,s){var c,m,_=ae.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var b=0;b<a.length;b++){var E=ae.document.createElement("source");c=a[b],m=void 0,(m=ae.document.createElement("a")).href=c,(m.protocol!==ae.document.location.protocol||m.host!==ae.document.location.host)&&(_.crossOrigin="Anonymous"),E.src=a[b],_.appendChild(E)}return{cancel:function(){}}},y.identity=Qa,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],b=s[3],E=s[4],M=s[5],P=s[6],z=s[7],j=s[8],H=s[9],ee=s[10],se=s[11],Re=s[12],Be=s[13],tt=s[14],Ge=s[15],dt=c*M-m*E,kt=c*P-_*E,Lt=c*z-b*E,$t=m*P-_*M,ur=m*z-b*M,Fr=_*z-b*P,Yr=j*Be-H*Re,Rn=j*tt-ee*Re,on=j*Ge-se*Re,Bn=H*tt-ee*Be,un=H*Ge-se*Be,nn=ee*Ge-se*tt,jr=dt*nn-kt*un+Lt*Bn+$t*on-ur*Rn+Fr*Yr;return jr?(a[0]=(M*nn-P*un+z*Bn)*(jr=1/jr),a[1]=(_*un-m*nn-b*Bn)*jr,a[2]=(Be*Fr-tt*ur+Ge*$t)*jr,a[3]=(ee*ur-H*Fr-se*$t)*jr,a[4]=(P*on-E*nn-z*Rn)*jr,a[5]=(c*nn-_*on+b*Rn)*jr,a[6]=(tt*Lt-Re*Fr-Ge*kt)*jr,a[7]=(j*Fr-ee*Lt+se*kt)*jr,a[8]=(E*un-M*on+z*Yr)*jr,a[9]=(m*on-c*un-b*Yr)*jr,a[10]=(Re*ur-Be*Lt+Ge*dt)*jr,a[11]=(H*Lt-j*ur-se*dt)*jr,a[12]=(M*Rn-E*Bn-P*Yr)*jr,a[13]=(c*Bn-m*Rn+_*Yr)*jr,a[14]=(Be*kt-Re*$t-tt*dt)*jr,a[15]=(j*$t-H*kt+ee*dt)*jr,a):null},y.isChar=Rr,y.isMapboxURL=Mi,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=mo,y.mapObject=lr,y.mercatorXfromLng=Hv,y.mercatorYfromLat=Wv,y.mercatorZfromAltitude=Dd,y.mul=Pu,y.multiply=eo,y.mvt=Pc,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],b=c*c+m*m+_*_;return b>0&&(b=1/Math.sqrt(b)),a[0]=s[0]*b,a[1]=s[1]*b,a[2]=s[2]*b,a},y.number=Fa,y.offscreenCanvasSupported=xn,y.ortho=function(a,s,c,m,_,b,E){var M=1/(s-c),P=1/(m-_),z=1/(b-E);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*z,a[11]=0,a[12]=(s+c)*M,a[13]=(_+m)*P,a[14]=(E+b)*z,a[15]=1,a},y.parseGlyphPBF=function(a){return new Se(a).readFields(vr,[])},y.pbf=Se,y.performSymbolLayout=function(a,s,c,m,_,b,E){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var M=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,z={};if(a.textSizeData.kind==="composite"){var j=a.textSizeData,H=j.maxZoom;z.compositeTextSizes=[P["text-size"].possiblyEvaluate(new F(j.minZoom),E),P["text-size"].possiblyEvaluate(new F(H),E)]}if(a.iconSizeData.kind==="composite"){var ee=a.iconSizeData,se=ee.maxZoom;z.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new F(ee.minZoom),E),P["icon-size"].possiblyEvaluate(new F(se),E)]}z.layoutTextSize=P["text-size"].possiblyEvaluate(new F(a.zoom+1),E),z.layoutIconSize=P["icon-size"].possiblyEvaluate(new F(a.zoom+1),E),z.textMaxSize=P["text-size"].possiblyEvaluate(new F(18));for(var Re=24*M.get("text-line-height"),Be=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",tt=M.get("text-keep-upright"),Ge=M.get("text-size"),dt=function(){var $t=Lt[kt],ur=M.get("text-font").evaluate($t,{},E).join(","),Fr=Ge.evaluate($t,{},E),Yr=z.layoutTextSize.evaluate($t,{},E),Rn=z.layoutIconSize.evaluate($t,{},E),on={horizontal:{},vertical:void 0},Bn=$t.text,un=[0,0];if(Bn){var nn=Bn.toString(),jr=24*M.get("text-letter-spacing").evaluate($t,{},E),An=function(Ri){for(var la=0,ra=Ri;la<ra.length;la+=1)if(Ui=ra[la].charCodeAt(0),Rr.Arabic(Ui)||Rr["Arabic Supplement"](Ui)||Rr["Arabic Extended-A"](Ui)||Rr["Arabic Presentation Forms-A"](Ui)||Rr["Arabic Presentation Forms-B"](Ui))return!1;var Ui;return!0}(nn)?jr:0,Ti=M.get("text-anchor").evaluate($t,{},E),di=M.get("text-variable-anchor");if(!di){var Ni=M.get("text-radial-offset").evaluate($t,{},E);un=Ni?qe(Ti,[24*Ni,de]):M.get("text-offset").evaluate($t,{},E).map(function(Ri){return 24*Ri})}var Nn=Be?"center":M.get("text-justify").evaluate($t,{},E),$i=M.get("symbol-placement"),Pa=$i==="point"?24*M.get("text-max-width").evaluate($t,{},E):0,ro=function(){a.allowVerticalPlacement&&Yc(nn)&&(on.vertical=cr(Bn,s,c,_,ur,Pa,Re,Ti,"left",An,un,Fn.vertical,!0,$i,Yr,Fr))};if(!Be&&di){for(var Xa=Nn==="auto"?di.map(function(Ri){return mt(Ri)}):[Nn],La=!1,no=0;no<Xa.length;no++){var Oo=Xa[no];if(!on.horizontal[Oo])if(La)on.horizontal[Oo]=on.horizontal[0];else{var Fo=cr(Bn,s,c,_,ur,Pa,Re,"center",Oo,An,un,Fn.horizontal,!1,$i,Yr,Fr);Fo&&(on.horizontal[Oo]=Fo,La=Fo.positionedLines.length===1)}}ro()}else{Nn==="auto"&&(Nn=mt(Ti));var Es=cr(Bn,s,c,_,ur,Pa,Re,Ti,Nn,An,un,Fn.horizontal,!1,$i,Yr,Fr);Es&&(on.horizontal[Nn]=Es),ro(),Yc(nn)&&Be&&tt&&(on.vertical=cr(Bn,s,c,_,ur,Pa,Re,Ti,Nn,An,un,Fn.vertical,!1,$i,Yr,Fr))}}var Bo=void 0,As=!1;if($t.icon&&$t.icon.name){var fo=m[$t.icon.name];fo&&(Bo=function(Ri,la,ra){var Ui=Ua(ra),Fs=la[0]-Ri.displaySize[0]*Ui.horizontalAlign,hs=la[1]-Ri.displaySize[1]*Ui.verticalAlign;return{image:Ri,top:hs,bottom:hs+Ri.displaySize[1],left:Fs,right:Fs+Ri.displaySize[0]}}(_[$t.icon.name],M.get("icon-offset").evaluate($t,{},E),M.get("icon-anchor").evaluate($t,{},E)),As=fo.sdf,a.sdfIcons===void 0?a.sdfIcons=fo.sdf:a.sdfIcons!==fo.sdf&&ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fo.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Go=et(on.horizontal)||on.vertical;a.iconsInText=!!Go&&Go.iconsInText,(Go||Bo)&&function(Ri,la,ra,Ui,Fs,hs,wa,To,ps,Zi,Dc){var Du=hs.textMaxSize.evaluate(la,{});Du===void 0&&(Du=wa);var Oc,ho=Ri.layers[0].layout,Fc=ho.get("icon-offset").evaluate(la,{},Dc),Tl=et(ra.horizontal),tp=wa/24,Ah=Ri.tilePixelRatio*tp,rp=Ri.tilePixelRatio*Du/24,uf=Ri.tilePixelRatio*To,np=Ri.tilePixelRatio*ho.get("symbol-spacing"),Bd=ho.get("text-padding")*Ri.tilePixelRatio,ip=ho.get("icon-padding")*Ri.tilePixelRatio,Vf=ho.get("text-max-angle")/180*Math.PI,Gp=ho.get("text-rotation-alignment")==="map"&&ho.get("symbol-placement")!=="point",ap=ho.get("icon-rotation-alignment")==="map"&&ho.get("symbol-placement")!=="point",tc=ho.get("symbol-placement"),rc=np/2,ul=ho.get("icon-text-fit");Ui&&ul!=="none"&&(Ri.allowVerticalPlacement&&ra.vertical&&(Oc=Si(Ui,ra.vertical,ul,ho.get("icon-text-fit-padding"),Fc,tp)),Tl&&(Ui=Si(Ui,Tl,ul,ho.get("icon-text-fit-padding"),Fc,tp)));var Bc=function(Xm,cp){cp.x<0||cp.x>=8192||cp.y<0||cp.y>=8192||function(io,Ml,q,zc,Xp,Ud,fp,kl,hp,Lh,ic,pp,Yp,Vd,Rh,jd,Kv,Jv,Gd,Hd,Qs,dp,Wd,vu,Qv){var $d,cf,ff,Dh,Hf,Oh=io.addToLineVertexArray(Ml,q),em=0,Xd=0,tm=0,ll=0,Yd=-1,qd=-1,Nc={},rm=Pe(""),Wf=0,qp=0;if(kl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Wf=($d=kl.layout.get("text-offset").evaluate(Qs,{},vu).map(function(Bh){return 24*Bh}))[0],qp=$d[1]):(Wf=24*kl.layout.get("text-radial-offset").evaluate(Qs,{},vu),qp=de),io.allowVerticalPlacement&&zc.vertical){var Kd=kl.layout.get("text-rotate").evaluate(Qs,{},vu)+90;Dh=new De(hp,Ml,Lh,ic,pp,zc.vertical,Yp,Vd,Rh,Kd),fp&&(Hf=new De(hp,Ml,Lh,ic,pp,fp,Kv,Jv,Rh,Kd))}if(Xp){var Kp=kl.layout.get("icon-rotate").evaluate(Qs,{}),Jp=kl.layout.get("icon-text-fit")!=="none",Jd=_i(Xp,Kp,Wd,Jp),Qd=fp?_i(fp,Kp,Wd,Jp):void 0;ff=new De(hp,Ml,Lh,ic,pp,Xp,Kv,Jv,!1,Kp),em=4*Jd.length;var nm=io.iconSizeData,$f=null;nm.kind==="source"?($f=[128*kl.layout.get("icon-size").evaluate(Qs,{})])[0]>32640&&ft(io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):nm.kind==="composite"&&(($f=[128*dp.compositeIconSizes[0].evaluate(Qs,{},vu),128*dp.compositeIconSizes[1].evaluate(Qs,{},vu)])[0]>32640||$f[1]>32640)&&ft(io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),io.addSymbols(io.icon,Jd,$f,Hd,Gd,Qs,!1,Ml,Oh.lineStartIndex,Oh.lineLength,-1,vu),Yd=io.icon.placedSymbolArray.length-1,Qd&&(Xd=4*Qd.length,io.addSymbols(io.icon,Qd,$f,Hd,Gd,Qs,Fn.vertical,Ml,Oh.lineStartIndex,Oh.lineLength,-1,vu),qd=io.icon.placedSymbolArray.length-1)}for(var Qp in zc.horizontal){var Fh=zc.horizontal[Qp];if(!cf){rm=Pe(Fh.text);var ed=kl.layout.get("text-rotate").evaluate(Qs,{},vu);cf=new De(hp,Ml,Lh,ic,pp,Fh,Yp,Vd,Rh,ed)}var vp=Fh.positionedLines.length===1;if(tm+=bt(io,Ml,Fh,Ud,kl,Rh,Qs,jd,Oh,zc.vertical?Fn.horizontal:Fn.horizontalOnly,vp?Object.keys(zc.horizontal):[Qp],Nc,Yd,dp,vu),vp)break}zc.vertical&&(ll+=bt(io,Ml,zc.vertical,Ud,kl,Rh,Qs,jd,Oh,Fn.vertical,["vertical"],Nc,qd,dp,vu));var ev=cf?cf.boxStartIndex:io.collisionBoxArray.length,tv=cf?cf.boxEndIndex:io.collisionBoxArray.length,td=Dh?Dh.boxStartIndex:io.collisionBoxArray.length,mp=Dh?Dh.boxEndIndex:io.collisionBoxArray.length,mu=ff?ff.boxStartIndex:io.collisionBoxArray.length,rv=ff?ff.boxEndIndex:io.collisionBoxArray.length,nv=Hf?Hf.boxStartIndex:io.collisionBoxArray.length,hf=Hf?Hf.boxEndIndex:io.collisionBoxArray.length,ac=-1,rd=function(Bh,iv){return Bh&&Bh.circleDiameter?Math.max(Bh.circleDiameter,iv):iv};ac=rd(cf,ac),ac=rd(Dh,ac),ac=rd(ff,ac);var im=(ac=rd(Hf,ac))>-1?1:0;im&&(ac*=Qv/24),io.glyphOffsetArray.length>=Bt.MAX_GLYPHS&&ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qs.sortKey!==void 0&&io.addToSortKeyRanges(io.symbolInstances.length,Qs.sortKey),io.symbolInstances.emplaceBack(Ml.x,Ml.y,Nc.right>=0?Nc.right:-1,Nc.center>=0?Nc.center:-1,Nc.left>=0?Nc.left:-1,Nc.vertical||-1,Yd,qd,rm,ev,tv,td,mp,mu,rv,nv,hf,Lh,tm,ll,em,Xd,im,0,Yp,Wf,qp,ac)}(Ri,cp,Xm,ra,Ui,Fs,Oc,Ri.layers[0],Ri.collisionBoxArray,la.index,la.sourceLayerIndex,Ri.index,Ah,Bd,Gp,ps,uf,ip,ap,Fc,la,hs,Zi,Dc,wa)};if(tc==="line")for(var jf=0,op=Un(la.geometry,0,0,8192,8192);jf<op.length;jf+=1)for(var Ch=op[jf],Th=0,sp=Wi(Ch,np,Vf,ra.vertical||Tl,Ui,24,rp,Ri.overscaling,8192);Th<sp.length;Th+=1){var Hp=sp[Th];Tl&&Ke(Ri,Tl.text,rc,Hp)||Bc(Ch,Hp)}else if(tc==="line-center")for(var Mh=0,kh=la.geometry;Mh<kh.length;Mh+=1){var up=kh[Mh];if(up.length>1){var Wp=jo(up,Vf,ra.vertical||Tl,Ui,24,rp);Wp&&Bc(up,Wp)}}else if(la.type==="Polygon")for(var Ih=0,$p=ol(la.geometry,0);Ih<$p.length;Ih+=1){var nc=$p[Ih],is=vn(nc,16);Bc(nc[0],new ba(is.x,is.y,0))}else if(la.type==="LineString")for(var lf=0,Ph=la.geometry;lf<Ph.length;lf+=1){var Gf=Ph[lf];Bc(Gf,new ba(Gf[0].x,Gf[0].y,0))}else if(la.type==="Point")for(var lp=0,zd=la.geometry;lp<zd.length;lp+=1)for(var Nd=0,qv=zd[lp];Nd<qv.length;Nd+=1){var Zd=qv[Nd];Bc([Zd],new ba(Zd.x,Zd.y,0))}}(a,$t,on,Bo,m,z,Yr,Rn,un,As,E)},kt=0,Lt=a.features;kt<Lt.length;kt+=1)dt();b&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var b,E=1/Math.tan(s/2);return a[0]=E/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(b=1/(m-_)),a[14]=2*_*m*b):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=Ie,y.polygonIntersectsPolygon=ku,y.postMapLoadEvent=je,y.postTurnstileEvent=Gt,y.potpack=Zr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=dn,y.registerForPluginStateChange=function(a){return a({pluginStatus:Ko,pluginURL:Tu}),wc.on("pluginStateChange",a),a},y.renderColorRamp=Mc,y.rotate=function(a,s,c){var m=s[0],_=s[1],b=s[2],E=s[3],M=Math.sin(c),P=Math.cos(c);return a[0]=m*P+b*M,a[1]=_*P+E*M,a[2]=m*-M+b*P,a[3]=_*-M+E*P,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[4],E=s[5],M=s[6],P=s[7],z=s[8],j=s[9],H=s[10],ee=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=b*_+z*m,a[5]=E*_+j*m,a[6]=M*_+H*m,a[7]=P*_+ee*m,a[8]=z*_-b*m,a[9]=j*_-E*m,a[10]=H*_-M*m,a[11]=ee*_-P*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),b=s[0],E=s[1],M=s[2],P=s[3],z=s[4],j=s[5],H=s[6],ee=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=b*_+z*m,a[1]=E*_+j*m,a[2]=M*_+H*m,a[3]=P*_+ee*m,a[4]=z*_-b*m,a[5]=j*_-E*m,a[6]=H*_-M*m,a[7]=ee*_-P*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],b=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*b,a[9]=s[9]*b,a[10]=s[10]*b,a[11]=s[11]*b,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){Tt=a,ar=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),Ko==="deferred"||Ko==="loading"||Ko==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Tu=Vn.resolveURL(a),Ko="deferred",Kc=s,Yu(),c||Pt()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=he,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=Eo,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],b=s[2];return a[0]=m*c[0]+_*c[3]+b*c[6],a[1]=m*c[1]+_*c[4]+b*c[7],a[2]=m*c[2]+_*c[5]+b*c[8],a},y.transformMat4=fu,y.translate=function(a,s,c){var m,_,b,E,M,P,z,j,H,ee,se,Re,Be=c[0],tt=c[1],Ge=c[2];return s===a?(a[12]=s[0]*Be+s[4]*tt+s[8]*Ge+s[12],a[13]=s[1]*Be+s[5]*tt+s[9]*Ge+s[13],a[14]=s[2]*Be+s[6]*tt+s[10]*Ge+s[14],a[15]=s[3]*Be+s[7]*tt+s[11]*Ge+s[15]):(_=s[1],b=s[2],E=s[3],M=s[4],P=s[5],z=s[6],j=s[7],H=s[8],ee=s[9],se=s[10],Re=s[11],a[0]=m=s[0],a[1]=_,a[2]=b,a[3]=E,a[4]=M,a[5]=P,a[6]=z,a[7]=j,a[8]=H,a[9]=ee,a[10]=se,a[11]=Re,a[12]=m*Be+M*tt+H*Ge+s[12],a[13]=_*Be+P*tt+ee*Ge+s[13],a[14]=b*Be+z*tt+se*Ge+s[14],a[15]=E*Be+j*tt+Re*Ge+s[15]),a},y.triggerPluginCompletionEvent=Jc,y.uniqueId=rr,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Wh,y.validateStyle=xc,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=Pc,y.version="1.13.3",y.warnOnce=ft,y.webpSupported=Mn,y.window=ae,y.wrap=tr}),J(["./shared"],function(y){"use strict";function oe(G){var X=typeof G;if(X==="number"||X==="boolean"||X==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ne="[",be=0,Oe=G;be<Oe.length;be+=1)ne+=oe(Oe[be])+",";return ne+"]"}for(var Qe=Object.keys(G).sort(),ot="{",he=0;he<Qe.length;he++)ot+=JSON.stringify(Qe[he])+":"+oe(G[Qe[he]])+",";return ot+"}"}function V(G){for(var X="",ne=0,be=y.refProperties;ne<be.length;ne+=1)X+="/"+oe(G[be[ne]]);return X}var ce=function(G){this.keyCache={},G&&this.replace(G)};ce.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},ce.prototype.update=function(G,X){for(var ne=this,be=0,Oe=G;be<Oe.length;be+=1){var Qe=Oe[be];this._layerConfigs[Qe.id]=Qe;var ot=this._layers[Qe.id]=y.createStyleLayer(Qe);ot._featureFilter=y.featureFilter(ot.filter),this.keyCache[Qe.id]&&delete this.keyCache[Qe.id]}for(var he=0,K=X;he<K.length;he+=1){var xe=K[he];delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe]}this.familiesBySource={};for(var lt=0,pt=function(Hr,qr){for(var si={},Jr=0;Jr<Hr.length;Jr++){var fi=qr&&qr[Hr[Jr].id]||V(Hr[Jr]);qr&&(qr[Hr[Jr].id]=fi);var zi=si[fi];zi||(zi=si[fi]=[]),zi.push(Hr[Jr])}var ui=[];for(var wi in si)ui.push(si[wi]);return ui}(y.values(this._layerConfigs),this.keyCache);lt<pt.length;lt+=1){var te=pt[lt].map(function(Hr){return ne._layers[Hr.id]}),br=te[0];if(br.visibility!=="none"){var bn=br.source||"",cn=this.familiesBySource[bn];cn||(cn=this.familiesBySource[bn]={});var Qt=br.sourceLayer||"_geojsonTileLayer",tn=cn[Qt];tn||(tn=cn[Qt]=[]),tn.push(te)}}};var ie=function(G){var X={},ne=[];for(var be in G){var Oe=G[be],Qe=X[be]={};for(var ot in Oe){var he=Oe[+ot];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var K={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};ne.push(K),Qe[ot]={rect:K,metrics:he.metrics}}}}var xe=y.potpack(ne),lt=new y.AlphaImage({width:xe.w||1,height:xe.h||1});for(var pt in G){var te=G[pt];for(var br in te){var bn=te[+br];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var cn=X[pt][br].rect;y.AlphaImage.copy(bn.bitmap,lt,{x:0,y:0},{x:cn.x+1,y:cn.y+1},bn.bitmap)}}}this.image=lt,this.positions=X};y.register("GlyphAtlas",ie);var We=function(G){this.tileID=new y.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ae(G,X,ne){for(var be=new y.EvaluationParameters(X),Oe=0,Qe=G;Oe<Qe.length;Oe+=1)Qe[Oe].recalculate(be,ne)}function He(G,X){var ne=y.getArrayBuffer(G.request,function(be,Oe,Qe,ot){be?X(be):Oe&&X(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Oe)),rawData:Oe,cacheControl:Qe,expires:ot})});return function(){ne.cancel(),X()}}We.prototype.parse=function(G,X,ne,be,Oe){var Qe=this;this.status="parsing",this.data=G,this.collisionBoxArray=new y.CollisionBoxArray;var ot=new y.DictionaryCoder(Object.keys(G.layers).sort()),he=new y.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var K,xe,lt,pt,te={},br={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},bn=X.familiesBySource[this.source];for(var cn in bn){var Qt=G.layers[cn];if(Qt){Qt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var tn=ot.encode(cn),Hr=[],qr=0;qr<Qt.length;qr++){var si=Qt.feature(qr),Jr=he.getId(si,cn);Hr.push({feature:si,id:Jr,index:qr,sourceLayerIndex:tn})}for(var fi=0,zi=bn[cn];fi<zi.length;fi+=1){var ui=zi[fi],wi=ui[0];wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(ae(ui,this.zoom,ne),(te[wi.id]=wi.createBucket({index:he.bucketLayerIDs.length,layers:ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tn,sourceID:this.source})).populate(Hr,br,this.tileID.canonical),he.bucketLayerIDs.push(ui.map(function(mi){return mi.id})))}}}var bi=y.mapObject(br.glyphDependencies,function(mi){return Object.keys(mi).map(Number)});Object.keys(bi).length?be.send("getGlyphs",{uid:this.uid,stacks:bi},function(mi,li){K||(K=mi,xe=li,fa.call(Qe))}):xe={};var oo=Object.keys(br.iconDependencies);oo.length?be.send("getImages",{icons:oo,source:this.source,tileID:this.tileID,type:"icons"},function(mi,li){K||(K=mi,lt=li,fa.call(Qe))}):lt={};var ji=Object.keys(br.patternDependencies);function fa(){if(K)return Oe(K);if(xe&&lt&&pt){var mi=new ie(xe),li=new y.ImageAtlas(lt,pt);for(var gi in te){var ha=te[gi];ha instanceof y.SymbolBucket?(ae(ha.layers,this.zoom,ne),y.performSymbolLayout(ha,xe,mi.positions,lt,li.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ha.hasPattern&&(ha instanceof y.LineBucket||ha instanceof y.FillBucket||ha instanceof y.FillExtrusionBucket)&&(ae(ha.layers,this.zoom,ne),ha.addFeatures(br,this.tileID.canonical,li.patternPositions))}this.status="done",Oe(null,{buckets:y.values(te).filter(function(Ns){return!Ns.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:li,glyphMap:this.returnDependencies?xe:null,iconMap:this.returnDependencies?lt:null,glyphPositions:this.returnDependencies?mi.positions:null})}}ji.length?be.send("getImages",{icons:ji,source:this.source,tileID:this.tileID,type:"patterns"},function(mi,li){K||(K=mi,pt=li,fa.call(Qe))}):pt={},fa.call(this)};var nt=function(G,X,ne,be){this.actor=G,this.layerIndex=X,this.availableImages=ne,this.loadVectorData=be||He,this.loading={},this.loaded={}};nt.prototype.loadTile=function(G,X){var ne=this,be=G.uid;this.loading||(this.loading={});var Oe=!!(G&&G.request&&G.request.collectResourceTiming)&&new y.RequestPerformance(G.request),Qe=this.loading[be]=new We(G);Qe.abort=this.loadVectorData(G,function(ot,he){if(delete ne.loading[be],ot||!he)return Qe.status="done",ne.loaded[be]=Qe,X(ot);var K=he.rawData,xe={};he.expires&&(xe.expires=he.expires),he.cacheControl&&(xe.cacheControl=he.cacheControl);var lt={};if(Oe){var pt=Oe.finish();pt&&(lt.resourceTiming=JSON.parse(JSON.stringify(pt)))}Qe.vectorTile=he.vectorTile,Qe.parse(he.vectorTile,ne.layerIndex,ne.availableImages,ne.actor,function(te,br){if(te||!br)return X(te);X(null,y.extend({rawTileData:K.slice(0)},br,xe,lt))}),ne.loaded=ne.loaded||{},ne.loaded[be]=Qe})},nt.prototype.reloadTile=function(G,X){var ne=this,be=this.loaded,Oe=G.uid,Qe=this;if(be&&be[Oe]){var ot=be[Oe];ot.showCollisionBoxes=G.showCollisionBoxes;var he=function(K,xe){var lt=ot.reloadCallback;lt&&(delete ot.reloadCallback,ot.parse(ot.vectorTile,Qe.layerIndex,ne.availableImages,Qe.actor,lt)),X(K,xe)};ot.status==="parsing"?ot.reloadCallback=he:ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},nt.prototype.abortTile=function(G,X){var ne=this.loading,be=G.uid;ne&&ne[be]&&ne[be].abort&&(ne[be].abort(),delete ne[be]),X()},nt.prototype.removeTile=function(G,X){var ne=this.loaded,be=G.uid;ne&&ne[be]&&delete ne[be],X()};var ct=y.window.ImageBitmap,It=function(){this.loaded={}};function tr(G,X){if(G.length!==0){qt(G[0],X);for(var ne=1;ne<G.length;ne++)qt(G[ne],!X)}}function qt(G,X){for(var ne=0,be=0,Oe=0,Qe=G.length,ot=Qe-1;Oe<Qe;ot=Oe++){var he=(G[Oe][0]-G[ot][0])*(G[ot][1]+G[Oe][1]),K=ne+he;be+=Math.abs(ne)>=Math.abs(he)?ne-K+he:he-K+ne,ne=K}ne+be>=0!=!!X&&G.reverse()}It.prototype.loadTile=function(G,X){var ne=G.uid,be=G.encoding,Oe=G.rawImageData,Qe=ct&&Oe instanceof ct?this.getImageData(Oe):Oe,ot=new y.DEMData(ne,Qe,be);this.loaded=this.loaded||{},this.loaded[ne]=ot,X(null,ot)},It.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var X=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:X.width,height:X.height},X.data)},It.prototype.removeTile=function(G){var X=this.loaded,ne=G.uid;X&&X[ne]&&delete X[ne]};var ir=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,rr=function(G){this._feature=G,this.extent=y.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};rr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],X=0,ne=this._feature.geometry;X<ne.length;X+=1){var be=ne[X];G.push([new y.Point$1(be[0],be[1])])}return G}for(var Oe=[],Qe=0,ot=this._feature.geometry;Qe<ot.length;Qe+=1){for(var he=[],K=0,xe=ot[Qe];K<xe.length;K+=1){var lt=xe[K];he.push(new y.Point$1(lt[0],lt[1]))}Oe.push(he)}return Oe},rr.prototype.toGeoJSON=function(G,X,ne){return ir.call(this,G,X,ne)};var At=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=G.length,this._features=G};At.prototype.feature=function(G){return new rr(this._features[G])};var gt=y.vectorTile.VectorTileFeature,Br=dr;function dr(G,X){this.options=X||{},this.features=G,this.length=G.length}function lr(G,X){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=X||4096}dr.prototype.feature=function(G){return new lr(this.features[G],this.options.extent)},lr.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var X=0;X<G.length;X++){for(var ne=G[X],be=[],Oe=0;Oe<ne.length;Oe++)be.push(new y.Point$1(ne[Oe][0],ne[Oe][1]));this.geometry.push(be)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,X=1/0,ne=-1/0,be=1/0,Oe=-1/0,Qe=0;Qe<G.length;Qe++)for(var ot=G[Qe],he=0;he<ot.length;he++){var K=ot[he];X=Math.min(X,K.x),ne=Math.max(ne,K.x),be=Math.min(be,K.y),Oe=Math.max(Oe,K.y)}return[X,be,ne,Oe]},lr.prototype.toGeoJSON=gt.prototype.toGeoJSON;var _t=Ot,at=Br;function Ot(G){var X=new y.pbf;return function(ne,be){for(var Oe in ne.layers)be.writeMessage(3,ft,ne.layers[Oe])}(G,X),X.finish()}function ft(G,X){var ne;X.writeVarintField(15,G.version||1),X.writeStringField(1,G.name||""),X.writeVarintField(5,G.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<G.length;ne++)be.feature=G.feature(ne),X.writeMessage(2,Kt,be);var Oe=be.keys;for(ne=0;ne<Oe.length;ne++)X.writeStringField(3,Oe[ne]);var Qe=be.values;for(ne=0;ne<Qe.length;ne++)X.writeMessage(4,Me,Qe[ne])}function Kt(G,X){var ne=G.feature;ne.id!==void 0&&X.writeVarintField(1,ne.id),X.writeMessage(2,xr,G),X.writeVarintField(3,ne.type),X.writeMessage(4,O,ne)}function xr(G,X){var ne=G.feature,be=G.keys,Oe=G.values,Qe=G.keycache,ot=G.valuecache;for(var he in ne.properties){var K=Qe[he];K===void 0&&(be.push(he),Qe[he]=K=be.length-1),X.writeVarint(K);var xe=ne.properties[he],lt=typeof xe;lt!=="string"&&lt!=="boolean"&&lt!=="number"&&(xe=JSON.stringify(xe));var pt=lt+":"+xe,te=ot[pt];te===void 0&&(Oe.push(xe),ot[pt]=te=Oe.length-1),X.writeVarint(te)}}function Y(G,X){return(X<<3)+(7&G)}function Le(G){return G<<1^G>>31}function O(G,X){for(var ne=G.loadGeometry(),be=G.type,Oe=0,Qe=0,ot=ne.length,he=0;he<ot;he++){var K=ne[he],xe=1;be===1&&(xe=K.length),X.writeVarint(Y(1,xe));for(var lt=be===3?K.length-1:K.length,pt=0;pt<lt;pt++){pt===1&&be!==1&&X.writeVarint(Y(2,lt-1));var te=K[pt].x-Oe,br=K[pt].y-Qe;X.writeVarint(Le(te)),X.writeVarint(Le(br)),Oe+=te,Qe+=br}be===3&&X.writeVarint(Y(7,1))}}function Me(G,X){var ne=typeof G;ne==="string"?X.writeStringField(1,G):ne==="boolean"?X.writeBooleanField(7,G):ne==="number"&&(G%1!=0?X.writeDoubleField(3,G):G<0?X.writeSVarintField(6,G):X.writeVarintField(5,G))}function we(G,X,ne,be){ut(G,ne,be),ut(X,2*ne,2*be),ut(X,2*ne+1,2*be+1)}function ut(G,X,ne){var be=G[X];G[X]=G[ne],G[ne]=be}function yt(G,X,ne,be){var Oe=G-ne,Qe=X-be;return Oe*Oe+Qe*Qe}_t.fromVectorTileJs=Ot,_t.fromGeojsonVt=function(G,X){X=X||{};var ne={};for(var be in G)ne[be]=new Br(G[be].features,X),ne[be].name=be,ne[be].version=X.version,ne[be].extent=X.extent;return Ot({layers:ne})},_t.GeoJSONWrapper=at;var xt=function(G){return G[0]},jt=function(G){return G[1]},nr=function(G,X,ne,be,Oe){X===void 0&&(X=xt),ne===void 0&&(ne=jt),be===void 0&&(be=64),Oe===void 0&&(Oe=Float64Array),this.nodeSize=be,this.points=G;for(var Qe=G.length<65536?Uint16Array:Uint32Array,ot=this.ids=new Qe(G.length),he=this.coords=new Oe(2*G.length),K=0;K<G.length;K++)ot[K]=K,he[2*K]=X(G[K]),he[2*K+1]=ne(G[K]);(function xe(lt,pt,te,br,bn,cn){if(!(bn-br<=te)){var Qt=br+bn>>1;(function tn(Hr,qr,si,Jr,fi,zi){for(;fi>Jr;){if(fi-Jr>600){var ui=fi-Jr+1,wi=si-Jr+1,bi=Math.log(ui),oo=.5*Math.exp(2*bi/3),ji=.5*Math.sqrt(bi*oo*(ui-oo)/ui)*(wi-ui/2<0?-1:1);tn(Hr,qr,si,Math.max(Jr,Math.floor(si-wi*oo/ui+ji)),Math.min(fi,Math.floor(si+(ui-wi)*oo/ui+ji)),zi)}var fa=qr[2*si+zi],mi=Jr,li=fi;for(we(Hr,qr,Jr,si),qr[2*fi+zi]>fa&&we(Hr,qr,Jr,fi);mi<li;){for(we(Hr,qr,mi,li),mi++,li--;qr[2*mi+zi]<fa;)mi++;for(;qr[2*li+zi]>fa;)li--}qr[2*Jr+zi]===fa?we(Hr,qr,Jr,li):we(Hr,qr,++li,fi),li<=si&&(Jr=li+1),si<=li&&(fi=li-1)}})(lt,pt,Qt,br,bn,cn%2),xe(lt,pt,te,br,Qt-1,cn+1),xe(lt,pt,te,Qt+1,bn,cn+1)}})(ot,he,be,0,ot.length-1,0)};nr.prototype.range=function(G,X,ne,be){return function(Oe,Qe,ot,he,K,xe,lt){for(var pt,te,br=[0,Oe.length-1,0],bn=[];br.length;){var cn=br.pop(),Qt=br.pop(),tn=br.pop();if(Qt-tn<=lt)for(var Hr=tn;Hr<=Qt;Hr++)te=Qe[2*Hr+1],(pt=Qe[2*Hr])>=ot&&pt<=K&&te>=he&&te<=xe&&bn.push(Oe[Hr]);else{var qr=Math.floor((tn+Qt)/2);te=Qe[2*qr+1],(pt=Qe[2*qr])>=ot&&pt<=K&&te>=he&&te<=xe&&bn.push(Oe[qr]);var si=(cn+1)%2;(cn===0?ot<=pt:he<=te)&&(br.push(tn),br.push(qr-1),br.push(si)),(cn===0?K>=pt:xe>=te)&&(br.push(qr+1),br.push(Qt),br.push(si))}}return bn}(this.ids,this.coords,G,X,ne,be,this.nodeSize)},nr.prototype.within=function(G,X,ne){return function(be,Oe,Qe,ot,he,K){for(var xe=[0,be.length-1,0],lt=[],pt=he*he;xe.length;){var te=xe.pop(),br=xe.pop(),bn=xe.pop();if(br-bn<=K)for(var cn=bn;cn<=br;cn++)yt(Oe[2*cn],Oe[2*cn+1],Qe,ot)<=pt&&lt.push(be[cn]);else{var Qt=Math.floor((bn+br)/2),tn=Oe[2*Qt],Hr=Oe[2*Qt+1];yt(tn,Hr,Qe,ot)<=pt&&lt.push(be[Qt]);var qr=(te+1)%2;(te===0?Qe-he<=tn:ot-he<=Hr)&&(xe.push(bn),xe.push(Qt-1),xe.push(qr)),(te===0?Qe+he>=tn:ot+he>=Hr)&&(xe.push(Qt+1),xe.push(br),xe.push(qr))}}return lt}(this.ids,this.coords,G,X,ne,this.nodeSize)};var en={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},Lr=function(G){this.options=Ai(Object.create(en),G),this.trees=new Array(this.options.maxZoom+1)};function Vn(G,X,ne,be,Oe){return{x:G,y:X,zoom:1/0,id:ne,parentId:-1,numPoints:be,properties:Oe}}function rn(G,X){var ne=G.geometry.coordinates,be=ne[1];return{x:Yn(ne[0]),y:yn(be),zoom:1/0,index:X,parentId:-1}}function Mn(G){return{type:"Feature",id:G.id,properties:ii(G),geometry:{type:"Point",coordinates:[(be=G.x,360*(be-.5)),(X=G.y,ne=(180-360*X)*Math.PI/180,360*Math.atan(Math.exp(ne))/Math.PI-90)]}};var X,ne,be}function ii(G){var X=G.numPoints,ne=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return Ai(Ai({},G.properties),{cluster:!0,cluster_id:G.id,point_count:X,point_count_abbreviated:ne})}function Yn(G){return G/360+.5}function yn(G){var X=Math.sin(G*Math.PI/180),ne=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ne<0?0:ne>1?1:ne}function Ai(G,X){for(var ne in X)G[ne]=X[ne];return G}function Pi(G){return G.x}function Mi(G){return G.y}function Hn(G,X,ne,be,Oe,Qe){var ot=Oe-ne,he=Qe-be;if(ot!==0||he!==0){var K=((G-ne)*ot+(X-be)*he)/(ot*ot+he*he);K>1?(ne=Oe,be=Qe):K>0&&(ne+=ot*K,be+=he*K)}return(ot=G-ne)*ot+(he=X-be)*he}function Ln(G,X,ne,be){var Oe={id:G===void 0?null:G,type:X,geometry:ne,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Qe){var ot=Qe.geometry,he=Qe.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")vo(Qe,ot);else if(he==="Polygon"||he==="MultiLineString")for(var K=0;K<ot.length;K++)vo(Qe,ot[K]);else if(he==="MultiPolygon")for(K=0;K<ot.length;K++)for(var xe=0;xe<ot[K].length;xe++)vo(Qe,ot[K][xe])}(Oe),Oe}function vo(G,X){for(var ne=0;ne<X.length;ne+=3)G.minX=Math.min(G.minX,X[ne]),G.minY=Math.min(G.minY,X[ne+1]),G.maxX=Math.max(G.maxX,X[ne]),G.maxY=Math.max(G.maxY,X[ne+1])}function Xi(G,X,ne,be){if(X.geometry){var Oe=X.geometry.coordinates,Qe=X.geometry.type,ot=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),he=[],K=X.id;if(ne.promoteId?K=X.properties[ne.promoteId]:ne.generateId&&(K=be||0),Qe==="Point")Ya(Oe,he);else if(Qe==="MultiPoint")for(var xe=0;xe<Oe.length;xe++)Ya(Oe[xe],he);else if(Qe==="LineString")Mt(Oe,he,ot,!1);else if(Qe==="MultiLineString"){if(ne.lineMetrics){for(xe=0;xe<Oe.length;xe++)Mt(Oe[xe],he=[],ot,!1),G.push(Ln(K,"LineString",he,X.properties));return}L(Oe,he,ot,!1)}else if(Qe==="Polygon")L(Oe,he,ot,!0);else{if(Qe!=="MultiPolygon"){if(Qe==="GeometryCollection"){for(xe=0;xe<X.geometry.geometries.length;xe++)Xi(G,{id:K,geometry:X.geometry.geometries[xe],properties:X.properties},ne,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xe=0;xe<Oe.length;xe++){var lt=[];L(Oe[xe],lt,ot,!0),he.push(lt)}}G.push(Ln(K,Qe,he,X.properties))}}function Ya(G,X){X.push(re(G[0])),X.push(fe(G[1])),X.push(0)}function Mt(G,X,ne,be){for(var Oe,Qe,ot=0,he=0;he<G.length;he++){var K=re(G[he][0]),xe=fe(G[he][1]);X.push(K),X.push(xe),X.push(0),he>0&&(ot+=be?(Oe*xe-K*Qe)/2:Math.sqrt(Math.pow(K-Oe,2)+Math.pow(xe-Qe,2))),Oe=K,Qe=xe}var lt=X.length-3;X[2]=1,function pt(te,br,bn,cn){for(var Qt,tn=cn,Hr=bn-br>>1,qr=bn-br,si=te[br],Jr=te[br+1],fi=te[bn],zi=te[bn+1],ui=br+3;ui<bn;ui+=3){var wi=Hn(te[ui],te[ui+1],si,Jr,fi,zi);if(wi>tn)Qt=ui,tn=wi;else if(wi===tn){var bi=Math.abs(ui-Hr);bi<qr&&(Qt=ui,qr=bi)}}tn>cn&&(Qt-br>3&&pt(te,br,Qt,cn),te[Qt+2]=tn,bn-Qt>3&&pt(te,Qt,bn,cn))}(X,0,lt,ne),X[lt+2]=1,X.size=Math.abs(ot),X.start=0,X.end=X.size}function L(G,X,ne,be){for(var Oe=0;Oe<G.length;Oe++){var Qe=[];Mt(G[Oe],Qe,ne,be),X.push(Qe)}}function re(G){return G/360+.5}function fe(G){var X=Math.sin(G*Math.PI/180),ne=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ne<0?0:ne>1?1:ne}function Ue(G,X,ne,be,Oe,Qe,ot,he){if(be/=X,Qe>=(ne/=X)&&ot<be)return G;if(ot<ne||Qe>=be)return null;for(var K=[],xe=0;xe<G.length;xe++){var lt=G[xe],pt=lt.geometry,te=lt.type,br=Oe===0?lt.minX:lt.minY,bn=Oe===0?lt.maxX:lt.maxY;if(br>=ne&&bn<be)K.push(lt);else if(!(bn<ne||br>=be)){var cn=[];if(te==="Point"||te==="MultiPoint")ht(pt,cn,ne,be,Oe);else if(te==="LineString")Gt(pt,cn,ne,be,Oe,!1,he.lineMetrics);else if(te==="MultiLineString")je(pt,cn,ne,be,Oe,!1);else if(te==="Polygon")je(pt,cn,ne,be,Oe,!0);else if(te==="MultiPolygon")for(var Qt=0;Qt<pt.length;Qt++){var tn=[];je(pt[Qt],tn,ne,be,Oe,!0),tn.length&&cn.push(tn)}if(cn.length){if(he.lineMetrics&&te==="LineString"){for(Qt=0;Qt<cn.length;Qt++)K.push(Ln(lt.id,te,cn[Qt],lt.tags));continue}te!=="LineString"&&te!=="MultiLineString"||(cn.length===1?(te="LineString",cn=cn[0]):te="MultiLineString"),te!=="Point"&&te!=="MultiPoint"||(te=cn.length===3?"Point":"MultiPoint"),K.push(Ln(lt.id,te,cn,lt.tags))}}}return K.length?K:null}function ht(G,X,ne,be,Oe){for(var Qe=0;Qe<G.length;Qe+=3){var ot=G[Qe+Oe];ot>=ne&&ot<=be&&(X.push(G[Qe]),X.push(G[Qe+1]),X.push(G[Qe+2]))}}function Gt(G,X,ne,be,Oe,Qe,ot){for(var he,K,xe=Ar(G),lt=Oe===0?ar:wr,pt=G.start,te=0;te<G.length-3;te+=3){var br=G[te],bn=G[te+1],cn=G[te+2],Qt=G[te+3],tn=G[te+4],Hr=Oe===0?br:bn,qr=Oe===0?Qt:tn,si=!1;ot&&(he=Math.sqrt(Math.pow(br-Qt,2)+Math.pow(bn-tn,2))),Hr<ne?qr>ne&&(K=lt(xe,br,bn,Qt,tn,ne),ot&&(xe.start=pt+he*K)):Hr>be?qr<be&&(K=lt(xe,br,bn,Qt,tn,be),ot&&(xe.start=pt+he*K)):Tt(xe,br,bn,cn),qr<ne&&Hr>=ne&&(K=lt(xe,br,bn,Qt,tn,ne),si=!0),qr>be&&Hr<=be&&(K=lt(xe,br,bn,Qt,tn,be),si=!0),!Qe&&si&&(ot&&(xe.end=pt+he*K),X.push(xe),xe=Ar(G)),ot&&(pt+=he)}var Jr=G.length-3;br=G[Jr],bn=G[Jr+1],cn=G[Jr+2],(Hr=Oe===0?br:bn)>=ne&&Hr<=be&&Tt(xe,br,bn,cn),Jr=xe.length-3,Qe&&Jr>=3&&(xe[Jr]!==xe[0]||xe[Jr+1]!==xe[1])&&Tt(xe,xe[0],xe[1],xe[2]),xe.length&&X.push(xe)}function Ar(G){var X=[];return X.size=G.size,X.start=G.start,X.end=G.end,X}function je(G,X,ne,be,Oe,Qe){for(var ot=0;ot<G.length;ot++)Gt(G[ot],X,ne,be,Oe,Qe,!1)}function Tt(G,X,ne,be){G.push(X),G.push(ne),G.push(be)}function ar(G,X,ne,be,Oe,Qe){var ot=(Qe-X)/(be-X);return G.push(Qe),G.push(ne+(Oe-ne)*ot),G.push(1),ot}function wr(G,X,ne,be,Oe,Qe){var ot=(Qe-ne)/(Oe-ne);return G.push(X+(be-X)*ot),G.push(Qe),G.push(1),ot}function $r(G,X){for(var ne=[],be=0;be<G.length;be++){var Oe,Qe=G[be],ot=Qe.type;if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")Oe=_n(Qe.geometry,X);else if(ot==="MultiLineString"||ot==="Polygon"){Oe=[];for(var he=0;he<Qe.geometry.length;he++)Oe.push(_n(Qe.geometry[he],X))}else if(ot==="MultiPolygon")for(Oe=[],he=0;he<Qe.geometry.length;he++){for(var K=[],xe=0;xe<Qe.geometry[he].length;xe++)K.push(_n(Qe.geometry[he][xe],X));Oe.push(K)}ne.push(Ln(Qe.id,ot,Oe,Qe.tags))}return ne}function _n(G,X){var ne=[];ne.size=G.size,G.start!==void 0&&(ne.start=G.start,ne.end=G.end);for(var be=0;be<G.length;be+=3)ne.push(G[be]+X,G[be+1],G[be+2]);return ne}function Cn(G,X){if(G.transformed)return G;var ne,be,Oe,Qe=1<<G.z,ot=G.x,he=G.y;for(ne=0;ne<G.features.length;ne++){var K=G.features[ne],xe=K.geometry,lt=K.type;if(K.geometry=[],lt===1)for(be=0;be<xe.length;be+=2)K.geometry.push(xn(xe[be],xe[be+1],X,Qe,ot,he));else for(be=0;be<xe.length;be++){var pt=[];for(Oe=0;Oe<xe[be].length;Oe+=2)pt.push(xn(xe[be][Oe],xe[be][Oe+1],X,Qe,ot,he));K.geometry.push(pt)}}return G.transformed=!0,G}function xn(G,X,ne,be,Oe,Qe){return[Math.round(ne*(G*be-Oe)),Math.round(ne*(X*be-Qe))]}function wn(G,X,ne,be,Oe){for(var Qe=X===Oe.maxZoom?0:Oe.tolerance/((1<<X)*Oe.extent),ot={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:be,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<G.length;he++){ot.numFeatures++,ri(ot,G[he],Qe,Oe);var K=G[he].minX,xe=G[he].minY,lt=G[he].maxX,pt=G[he].maxY;K<ot.minX&&(ot.minX=K),xe<ot.minY&&(ot.minY=xe),lt>ot.maxX&&(ot.maxX=lt),pt>ot.maxY&&(ot.maxY=pt)}return ot}function ri(G,X,ne,be){var Oe=X.geometry,Qe=X.type,ot=[];if(Qe==="Point"||Qe==="MultiPoint")for(var he=0;he<Oe.length;he+=3)ot.push(Oe[he]),ot.push(Oe[he+1]),G.numPoints++,G.numSimplified++;else if(Qe==="LineString")Kn(ot,Oe,G,ne,!1,!1);else if(Qe==="MultiLineString"||Qe==="Polygon")for(he=0;he<Oe.length;he++)Kn(ot,Oe[he],G,ne,Qe==="Polygon",he===0);else if(Qe==="MultiPolygon")for(var K=0;K<Oe.length;K++){var xe=Oe[K];for(he=0;he<xe.length;he++)Kn(ot,xe[he],G,ne,!0,he===0)}if(ot.length){var lt=X.tags||null;if(Qe==="LineString"&&be.lineMetrics){for(var pt in lt={},X.tags)lt[pt]=X.tags[pt];lt.mapbox_clip_start=Oe.start/Oe.size,lt.mapbox_clip_end=Oe.end/Oe.size}var te={geometry:ot,type:Qe==="Polygon"||Qe==="MultiPolygon"?3:Qe==="LineString"||Qe==="MultiLineString"?2:1,tags:lt};X.id!==null&&(te.id=X.id),G.features.push(te)}}function Kn(G,X,ne,be,Oe,Qe){var ot=be*be;if(be>0&&X.size<(Oe?ot:be))ne.numPoints+=X.length/3;else{for(var he=[],K=0;K<X.length;K+=3)(be===0||X[K+2]>ot)&&(ne.numSimplified++,he.push(X[K]),he.push(X[K+1])),ne.numPoints++;Oe&&function(xe,lt){for(var pt=0,te=0,br=xe.length,bn=br-2;te<br;bn=te,te+=2)pt+=(xe[te]-xe[bn])*(xe[te+1]+xe[bn+1]);if(pt>0===lt)for(te=0,br=xe.length;te<br/2;te+=2){var cn=xe[te],Qt=xe[te+1];xe[te]=xe[br-2-te],xe[te+1]=xe[br-1-te],xe[br-2-te]=cn,xe[br-1-te]=Qt}}(he,Qe),G.push(he)}}function Yi(G,X){var ne=(X=this.options=function(Oe,Qe){for(var ot in Qe)Oe[ot]=Qe[ot];return Oe}(Object.create(this.options),X)).debug;if(ne&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var be=function(Oe,Qe){var ot=[];if(Oe.type==="FeatureCollection")for(var he=0;he<Oe.features.length;he++)Xi(ot,Oe.features[he],Qe,he);else Xi(ot,Oe.type==="Feature"?Oe:{geometry:Oe},Qe);return ot}(G,X);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(be=function(Oe,Qe){var ot=Qe.buffer/Qe.extent,he=Oe,K=Ue(Oe,1,-1-ot,ot,0,-1,2,Qe),xe=Ue(Oe,1,1-ot,2+ot,0,-1,2,Qe);return(K||xe)&&(he=Ue(Oe,1,-ot,1+ot,0,-1,2,Qe)||[],K&&(he=$r(K,1).concat(he)),xe&&(he=he.concat($r(xe,-1)))),he}(be,X)).length&&this.splitTile(be,0,0,0),ne&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function qi(G,X,ne){return 32*((1<<G)*ne+X)+G}function mo(G,X){var ne=G.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);var be=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!be)return X(null,null);var Oe=new At(be.features),Qe=_t(Oe);Qe.byteOffset===0&&Qe.byteLength===Qe.buffer.byteLength||(Qe=new Uint8Array(Qe)),X(null,{vectorTile:Oe,rawData:Qe.buffer})}Lr.prototype.load=function(G){var X=this.options,ne=X.log,be=X.minZoom,Oe=X.maxZoom,Qe=X.nodeSize;ne&&console.time("total time");var ot="prepare "+G.length+" points";ne&&console.time(ot),this.points=G;for(var he=[],K=0;K<G.length;K++)G[K].geometry&&he.push(rn(G[K],K));this.trees[Oe+1]=new nr(he,Pi,Mi,Qe,Float32Array),ne&&console.timeEnd(ot);for(var xe=Oe;xe>=be;xe--){var lt=+Date.now();he=this._cluster(he,xe),this.trees[xe]=new nr(he,Pi,Mi,Qe,Float32Array),ne&&console.log("z%d: %d clusters in %dms",xe,he.length,+Date.now()-lt)}return ne&&console.timeEnd("total time"),this},Lr.prototype.getClusters=function(G,X){var ne=((G[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,G[1])),Oe=G[2]===180?180:((G[2]+180)%360+360)%360-180,Qe=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ne=-180,Oe=180;else if(ne>Oe){var ot=this.getClusters([ne,be,180,Qe],X),he=this.getClusters([-180,be,Oe,Qe],X);return ot.concat(he)}for(var K=this.trees[this._limitZoom(X)],xe=[],lt=0,pt=K.range(Yn(ne),yn(Qe),Yn(Oe),yn(be));lt<pt.length;lt+=1){var te=K.points[pt[lt]];xe.push(te.numPoints?Mn(te):this.points[te.index])}return xe},Lr.prototype.getChildren=function(G){var X=this._getOriginId(G),ne=this._getOriginZoom(G),be="No cluster with the specified id.",Oe=this.trees[ne];if(!Oe)throw new Error(be);var Qe=Oe.points[X];if(!Qe)throw new Error(be);for(var ot=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),he=[],K=0,xe=Oe.within(Qe.x,Qe.y,ot);K<xe.length;K+=1){var lt=Oe.points[xe[K]];lt.parentId===G&&he.push(lt.numPoints?Mn(lt):this.points[lt.index])}if(he.length===0)throw new Error(be);return he},Lr.prototype.getLeaves=function(G,X,ne){var be=[];return this._appendLeaves(be,G,X=X||10,ne=ne||0,0),be},Lr.prototype.getTile=function(G,X,ne){var be=this.trees[this._limitZoom(G)],Oe=Math.pow(2,G),Qe=this.options,ot=Qe.radius/Qe.extent,he=(ne-ot)/Oe,K=(ne+1+ot)/Oe,xe={features:[]};return this._addTileFeatures(be.range((X-ot)/Oe,he,(X+1+ot)/Oe,K),be.points,X,ne,Oe,xe),X===0&&this._addTileFeatures(be.range(1-ot/Oe,he,1,K),be.points,Oe,ne,Oe,xe),X===Oe-1&&this._addTileFeatures(be.range(0,he,ot/Oe,K),be.points,-1,ne,Oe,xe),xe.features.length?xe:null},Lr.prototype.getClusterExpansionZoom=function(G){for(var X=this._getOriginZoom(G)-1;X<=this.options.maxZoom;){var ne=this.getChildren(G);if(X++,ne.length!==1)break;G=ne[0].properties.cluster_id}return X},Lr.prototype._appendLeaves=function(G,X,ne,be,Oe){for(var Qe=0,ot=this.getChildren(X);Qe<ot.length;Qe+=1){var he=ot[Qe],K=he.properties;if(K&&K.cluster?Oe+K.point_count<=be?Oe+=K.point_count:Oe=this._appendLeaves(G,K.cluster_id,ne,be,Oe):Oe<be?Oe++:G.push(he),G.length===ne)break}return Oe},Lr.prototype._addTileFeatures=function(G,X,ne,be,Oe,Qe){for(var ot=0,he=G;ot<he.length;ot+=1){var K=X[he[ot]],xe=K.numPoints,lt={type:1,geometry:[[Math.round(this.options.extent*(K.x*Oe-ne)),Math.round(this.options.extent*(K.y*Oe-be))]],tags:xe?ii(K):this.points[K.index].properties},pt=void 0;xe?pt=K.id:this.options.generateId?pt=K.index:this.points[K.index].id&&(pt=this.points[K.index].id),pt!==void 0&&(lt.id=pt),Qe.features.push(lt)}},Lr.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},Lr.prototype._cluster=function(G,X){for(var ne=[],be=this.options,Oe=be.reduce,Qe=be.minPoints,ot=be.radius/(be.extent*Math.pow(2,X)),he=0;he<G.length;he++){var K=G[he];if(!(K.zoom<=X)){K.zoom=X;for(var xe=this.trees[X+1],lt=xe.within(K.x,K.y,ot),pt=K.numPoints||1,te=pt,br=0,bn=lt;br<bn.length;br+=1){var cn=xe.points[bn[br]];cn.zoom>X&&(te+=cn.numPoints||1)}if(te>=Qe){for(var Qt=K.x*pt,tn=K.y*pt,Hr=Oe&&pt>1?this._map(K,!0):null,qr=(he<<5)+(X+1)+this.points.length,si=0,Jr=lt;si<Jr.length;si+=1){var fi=xe.points[Jr[si]];if(!(fi.zoom<=X)){fi.zoom=X;var zi=fi.numPoints||1;Qt+=fi.x*zi,tn+=fi.y*zi,fi.parentId=qr,Oe&&(Hr||(Hr=this._map(K,!0)),Oe(Hr,this._map(fi)))}}K.parentId=qr,ne.push(Vn(Qt/te,tn/te,qr,te,Hr))}else if(ne.push(K),te>1)for(var ui=0,wi=lt;ui<wi.length;ui+=1){var bi=xe.points[wi[ui]];bi.zoom<=X||(bi.zoom=X,ne.push(bi))}}}return ne},Lr.prototype._getOriginId=function(G){return G-this.points.length>>5},Lr.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},Lr.prototype._map=function(G,X){if(G.numPoints)return X?Ai({},G.properties):G.properties;var ne=this.points[G.index].properties,be=this.options.map(ne);return X&&be===ne?Ai({},be):be},Yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yi.prototype.splitTile=function(G,X,ne,be,Oe,Qe,ot){for(var he=[G,X,ne,be],K=this.options,xe=K.debug;he.length;){be=he.pop(),ne=he.pop(),X=he.pop(),G=he.pop();var lt=1<<X,pt=qi(X,ne,be),te=this.tiles[pt];if(!te&&(xe>1&&console.time("creation"),te=this.tiles[pt]=wn(G,X,ne,be,K),this.tileCoords.push({z:X,x:ne,y:be}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ne,be,te.numFeatures,te.numPoints,te.numSimplified),console.timeEnd("creation"));var br="z"+X;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(te.source=G,Oe){if(X===K.maxZoom||X===Oe)continue;var bn=1<<Oe-X;if(ne!==Math.floor(Qe/bn)||be!==Math.floor(ot/bn))continue}else if(X===K.indexMaxZoom||te.numPoints<=K.indexMaxPoints)continue;if(te.source=null,G.length!==0){xe>1&&console.time("clipping");var cn,Qt,tn,Hr,qr,si,Jr=.5*K.buffer/K.extent,fi=.5-Jr,zi=.5+Jr,ui=1+Jr;cn=Qt=tn=Hr=null,qr=Ue(G,lt,ne-Jr,ne+zi,0,te.minX,te.maxX,K),si=Ue(G,lt,ne+fi,ne+ui,0,te.minX,te.maxX,K),G=null,qr&&(cn=Ue(qr,lt,be-Jr,be+zi,1,te.minY,te.maxY,K),Qt=Ue(qr,lt,be+fi,be+ui,1,te.minY,te.maxY,K),qr=null),si&&(tn=Ue(si,lt,be-Jr,be+zi,1,te.minY,te.maxY,K),Hr=Ue(si,lt,be+fi,be+ui,1,te.minY,te.maxY,K),si=null),xe>1&&console.timeEnd("clipping"),he.push(cn||[],X+1,2*ne,2*be),he.push(Qt||[],X+1,2*ne,2*be+1),he.push(tn||[],X+1,2*ne+1,2*be),he.push(Hr||[],X+1,2*ne+1,2*be+1)}}},Yi.prototype.getTile=function(G,X,ne){var be=this.options,Oe=be.extent,Qe=be.debug;if(G<0||G>24)return null;var ot=1<<G,he=qi(G,X=(X%ot+ot)%ot,ne);if(this.tiles[he])return Cn(this.tiles[he],Oe);Qe>1&&console.log("drilling down to z%d-%d-%d",G,X,ne);for(var K,xe=G,lt=X,pt=ne;!K&&xe>0;)xe--,lt=Math.floor(lt/2),pt=Math.floor(pt/2),K=this.tiles[qi(xe,lt,pt)];return K&&K.source?(Qe>1&&console.log("found parent tile z%d-%d-%d",xe,lt,pt),Qe>1&&console.time("drilling down"),this.splitTile(K.source,xe,lt,pt,G,X,ne),Qe>1&&console.timeEnd("drilling down"),this.tiles[he]?Cn(this.tiles[he],Oe):null):null};var Wo=function(G){function X(ne,be,Oe,Qe){G.call(this,ne,be,Oe,mo),Qe&&(this.loadGeoJSON=Qe)}return G&&(X.__proto__=G),(X.prototype=Object.create(G&&G.prototype)).constructor=X,X.prototype.loadData=function(ne,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=be,this._pendingLoadDataParams=ne,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},X.prototype._loadData=function(){var ne=this;if(this._pendingCallback&&this._pendingLoadDataParams){var be=this._pendingCallback,Oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Qe=!!(Oe&&Oe.request&&Oe.request.collectResourceTiming)&&new y.RequestPerformance(Oe.request);this.loadGeoJSON(Oe,function(ot,he){if(ot||!he)return be(ot);if(typeof he!="object")return be(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));(function te(br,bn){var cn,Qt=br&&br.type;if(Qt==="FeatureCollection")for(cn=0;cn<br.features.length;cn++)te(br.features[cn],bn);else if(Qt==="GeometryCollection")for(cn=0;cn<br.geometries.length;cn++)te(br.geometries[cn],bn);else if(Qt==="Feature")te(br.geometry,bn);else if(Qt==="Polygon")tr(br.coordinates,bn);else if(Qt==="MultiPolygon")for(cn=0;cn<br.coordinates.length;cn++)tr(br.coordinates[cn],bn);return br})(he,!0);try{if(Oe.filter){var K=y.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(function(te){return te.key+": "+te.message}).join(", "));var xe=he.features.filter(function(te){return K.value.evaluate({zoom:0},te)});he={type:"FeatureCollection",features:xe}}ne._geoJSONIndex=Oe.cluster?new Lr(function(te){var br=te.superclusterOptions,bn=te.clusterProperties;if(!bn||!br)return br;for(var cn={},Qt={},tn={accumulated:null,zoom:0},Hr={properties:null},qr=Object.keys(bn),si=0,Jr=qr;si<Jr.length;si+=1){var fi=Jr[si],zi=bn[fi],ui=zi[0],wi=y.createExpression(zi[1]),bi=y.createExpression(typeof ui=="string"?[ui,["accumulated"],["get",fi]]:ui);cn[fi]=wi.value,Qt[fi]=bi.value}return br.map=function(oo){Hr.properties=oo;for(var ji={},fa=0,mi=qr;fa<mi.length;fa+=1){var li=mi[fa];ji[li]=cn[li].evaluate(tn,Hr)}return ji},br.reduce=function(oo,ji){Hr.properties=ji;for(var fa=0,mi=qr;fa<mi.length;fa+=1){var li=mi[fa];tn.accumulated=oo[li],oo[li]=Qt[li].evaluate(tn,Hr)}},br}(Oe)).load(he.features):function(te,br){return new Yi(te,br)}(he,Oe.geojsonVtOptions)}catch(te){return be(te)}ne.loaded={};var lt={};if(Qe){var pt=Qe.finish();pt&&(lt.resourceTiming={},lt.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(pt)))}be(null,lt)})}},X.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},X.prototype.reloadTile=function(ne,be){var Oe=this.loaded;return Oe&&Oe[ne.uid]?G.prototype.reloadTile.call(this,ne,be):this.loadTile(ne,be)},X.prototype.loadGeoJSON=function(ne,be){if(ne.request)y.getJSON(ne.request,be);else{if(typeof ne.data!="string")return be(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."));try{return be(null,JSON.parse(ne.data))}catch(Oe){return be(new Error("Input data given to '"+ne.source+"' is not a valid GeoJSON object."))}}},X.prototype.removeSource=function(ne,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),be()},X.prototype.getClusterExpansionZoom=function(ne,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Oe){be(Oe)}},X.prototype.getClusterChildren=function(ne,be){try{be(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Oe){be(Oe)}},X.prototype.getClusterLeaves=function(ne,be){try{be(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Oe){be(Oe)}},X}(nt),Ki=function(G){var X=this;this.self=G,this.actor=new y.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:nt,geojson:Wo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ne,be){if(X.workerSourceTypes[ne])throw new Error('Worker source with name "'+ne+'" already registered.');X.workerSourceTypes[ne]=be},this.self.registerRTLTextPlugin=function(ne){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=ne.applyArabicShaping,y.plugin.processBidirectionalText=ne.processBidirectionalText,y.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}};return Ki.prototype.setReferrer=function(G,X){this.referrer=X},Ki.prototype.setImages=function(G,X,ne){for(var be in this.availableImages[G]=X,this.workerSources[G]){var Oe=this.workerSources[G][be];for(var Qe in Oe)Oe[Qe].availableImages=X}ne()},Ki.prototype.setLayers=function(G,X,ne){this.getLayerIndex(G).replace(X),ne()},Ki.prototype.updateLayers=function(G,X,ne){this.getLayerIndex(G).update(X.layers,X.removedIds),ne()},Ki.prototype.loadTile=function(G,X,ne){this.getWorkerSource(G,X.type,X.source).loadTile(X,ne)},Ki.prototype.loadDEMTile=function(G,X,ne){this.getDEMWorkerSource(G,X.source).loadTile(X,ne)},Ki.prototype.reloadTile=function(G,X,ne){this.getWorkerSource(G,X.type,X.source).reloadTile(X,ne)},Ki.prototype.abortTile=function(G,X,ne){this.getWorkerSource(G,X.type,X.source).abortTile(X,ne)},Ki.prototype.removeTile=function(G,X,ne){this.getWorkerSource(G,X.type,X.source).removeTile(X,ne)},Ki.prototype.removeDEMTile=function(G,X){this.getDEMWorkerSource(G,X.source).removeTile(X)},Ki.prototype.removeSource=function(G,X,ne){if(this.workerSources[G]&&this.workerSources[G][X.type]&&this.workerSources[G][X.type][X.source]){var be=this.workerSources[G][X.type][X.source];delete this.workerSources[G][X.type][X.source],be.removeSource!==void 0?be.removeSource(X,ne):ne()}},Ki.prototype.loadWorkerSource=function(G,X,ne){try{this.self.importScripts(X.url),ne()}catch(be){ne(be.toString())}},Ki.prototype.syncRTLPluginState=function(G,X,ne){try{y.plugin.setState(X);var be=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&be!=null){this.self.importScripts(be);var Oe=y.plugin.isParsed();ne(Oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+be),Oe)}}catch(Qe){ne(Qe.toString())}},Ki.prototype.getAvailableImages=function(G){var X=this.availableImages[G];return X||(X=[]),X},Ki.prototype.getLayerIndex=function(G){var X=this.layerIndexes[G];return X||(X=this.layerIndexes[G]=new ce),X},Ki.prototype.getWorkerSource=function(G,X,ne){var be=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][X]||(this.workerSources[G][X]={}),this.workerSources[G][X][ne]||(this.workerSources[G][X][ne]=new this.workerSourceTypes[X]({send:function(Oe,Qe,ot){be.actor.send(Oe,Qe,ot,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][X][ne]},Ki.prototype.getDEMWorkerSource=function(G,X){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][X]||(this.demWorkerSources[G][X]=new It),this.demWorkerSources[G][X]},Ki.prototype.enforceCacheSizeLimit=function(G,X){y.enforceCacheSizeLimit(X)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ki(self)),Ki}),J(["./shared"],function(y){"use strict";var oe=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,I,U=new Blob([""],{type:"text/javascript"}),$=URL.createObjectURL(U);try{I=new Worker($),T=!0}catch(le){T=!1}return I&&I.terminate(),URL.revokeObjectURL($),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var I=T.getContext("2d");if(!I)return!1;var U=I.getImageData(0,0,1,1);return U&&U.width===T.width}()?(g[C=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[C]=function(T){var I=function($){var le=document.createElement("canvas"),ve=Object.create(d.webGLContextAttributes);return ve.failIfMajorPerformanceCaveat=$,le.probablySupportsContext?le.probablySupportsContext("webgl",ve)||le.probablySupportsContext("experimental-webgl",ve):le.supportsContext?le.supportsContext("webgl",ve)||le.supportsContext("experimental-webgl",ve):le.getContext("webgl",ve)||le.getContext("experimental-webgl",ve)}(T);if(!I)return!1;var U=I.createShader(I.VERTEX_SHADER);return!(!U||I.isContextLost())&&(I.shaderSource(U,"void main() {}"),I.compileShader(U),I.getShaderParameter(U,I.COMPILE_STATUS)===!0)}(C)),g[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),V={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},ce=y.window.document&&y.window.document.documentElement.style;function ie(f){if(!ce)return f[0];for(var d=0;d<f.length;d++)if(f[d]in ce)return f[d];return f[0]}var We,ae=ie(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);V.disableDrag=function(){ce&&ae&&(We=ce[ae],ce[ae]="none")},V.enableDrag=function(){ce&&ae&&(ce[ae]=We)};var He=ie(["transform","WebkitTransform"]);V.setTransform=function(f,d){f.style[He]=d};var nt=!1;try{var ct=Object.defineProperty({},"passive",{get:function(){nt=!0}});y.window.addEventListener("test",ct,ct),y.window.removeEventListener("test",ct,ct)}catch(f){nt=!1}V.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&nt?g:g.capture)},V.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&nt?g:g.capture)};var It=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",It,!0)};function tr(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}V.suppressClick=function(){y.window.addEventListener("click",It,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",It,!0)},0)},V.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},V.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},V.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},V.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var qt=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var C=w[g];this._notify(C.ids,C.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,C=0,T=h;C<T.length;C+=1){var I=T[C];if(I[0]<w||I[1]<I[0]||g<I[1])return!1;w=I[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var C=0,T=h;C<T.length;C+=1)this.images[T[C]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},C=0,T=h;C<T.length;C+=1){var I=T[C];this.images[I]||this.fire(new y.Event("styleimagemissing",{id:I}));var U=this.images[I];U?w[I]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:y.warnOnce('Image "'+I+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var C={w:w.data.width+2,h:w.data.height+2,x:0,y:0},T=new y.ImagePosition(C,w);this.patterns[h]={bin:C,position:T}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),C=w.w,T=w.h,I=this.atlasImage;for(var U in I.resize({width:C||1,height:T||1}),this.patterns){var $=this.patterns[U].bin,le=$.x+1,ve=$.y+1,ye=this.images[U].data,ze=ye.width,Fe=ye.height;y.RGBAImage.copy(ye,I,{x:0,y:0},{x:le,y:ve},{width:ze,height:Fe}),y.RGBAImage.copy(ye,I,{x:0,y:Fe-1},{x:le,y:ve-1},{width:ze,height:1}),y.RGBAImage.copy(ye,I,{x:0,y:0},{x:le,y:ve+Fe},{width:ze,height:1}),y.RGBAImage.copy(ye,I,{x:ze-1,y:0},{x:le-1,y:ve},{width:1,height:Fe}),y.RGBAImage.copy(ye,I,{x:0,y:0},{x:le+ze,y:ve},{width:1,height:Fe})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var C=w[g];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var T=this.images[C];tr(T)&&this.updateImage(C,T)}}},d}(y.Evented),ir=gt,rr=gt,At=1e20;function gt(f,d,h,g,w,C){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=C||"normal",this.radius=h||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Br(f,d,h,g,w,C,T){for(var I=0;I<d;I++){for(var U=0;U<h;U++)g[U]=f[U*d+I];for(dr(g,w,C,T,h),U=0;U<h;U++)f[U*d+I]=w[U]}for(U=0;U<h;U++){for(I=0;I<d;I++)g[I]=f[U*d+I];for(dr(g,w,C,T,d),I=0;I<d;I++)f[U*d+I]=Math.sqrt(w[I])}}function dr(f,d,h,g,w){h[0]=0,g[0]=-At,g[1]=+At;for(var C=1,T=0;C<w;C++){for(var I=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);I<=g[T];)T--,I=(f[C]+C*C-(f[h[T]]+h[T]*h[T]))/(2*C-2*h[T]);h[++T]=C,g[T]=I,g[T+1]=+At}for(C=0,T=0;C<w;C++){for(;g[T+1]<C;)T++;d[C]=(C-h[T])*(C-h[T])+f[h[T]]}}gt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?At:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?At:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(Br(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Br(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},ir.default=rr;var lr=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};lr.prototype.setURL=function(f){this.url=f},lr.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var C=0,T=f[w];C<T.length;C+=1)g.push({stack:w,id:T[C]});y.asyncAll(g,function(I,U){var $=I.stack,le=I.id,ve=h.entries[$];ve||(ve=h.entries[$]={glyphs:{},requests:{},ranges:{}});var ye=ve.glyphs[le];if(ye===void 0){if(ye=h._tinySDF(ve,$,le))return ve.glyphs[le]=ye,void U(null,{stack:$,id:le,glyph:ye});var ze=Math.floor(le/256);if(256*ze>65535)U(new Error("glyphs > 65535 not supported"));else if(ve.ranges[ze])U(null,{stack:$,id:le,glyph:ye});else{var Fe=ve.requests[ze];Fe||(Fe=ve.requests[ze]=[],lr.loadGlyphRange($,ze,h.url,h.requestManager,function(Ye,Pe){if(Pe){for(var Xe in Pe)h._doesCharSupportLocalGlyph(+Xe)||(ve.glyphs[+Xe]=Pe[+Xe]);ve.ranges[ze]=!0}for(var st=0,Ct=Fe;st<Ct.length;st+=1)(0,Ct[st])(Ye,Pe);delete ve.requests[ze]})),Fe.push(function(Ye,Pe){Ye?U(Ye):Pe&&U(null,{stack:$,id:le,glyph:Pe[le]||null})})}}else U(null,{stack:$,id:le,glyph:ye})},function(I,U){if(I)d(I);else if(U){for(var $={},le=0,ve=U;le<ve.length;le+=1){var ye=ve[le],ze=ye.stack,Fe=ye.id,Ye=ye.glyph;($[ze]||($[ze]={}))[Fe]=Ye&&{id:Ye.id,bitmap:Ye.bitmap.clone(),metrics:Ye.metrics}}d(null,$)}})},lr.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},lr.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var C="400";/bold/i.test(d)?C="900":/medium/i.test(d)?C="500":/light/i.test(d)&&(C="200"),w=f.tinySDF=new lr.TinySDF(24,3,8,.25,g,C)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(f,d,h,g,w){var C=256*d,T=C+255,I=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",C+"-"+T),y.ResourceType.Glyphs);y.getArrayBuffer(I,function(U,$){if(U)w(U);else if($){for(var le={},ve=0,ye=y.parseGlyphPBF($);ve<ye.length;ve+=1){var ze=ye[ve];le[ze.id]=ze}w(null,le)}})},lr.TinySDF=ir;var _t=function(){this.specification=y.styleSpec.light.position};_t.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},_t.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var at=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new _t,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Ot=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(at),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var C=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),C):this._transitionable.setValue(w,C)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),ft=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ft.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},ft.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,C=f[0]*h,T=!0;g.push({left:w,right:C,isDash:T,zeroLength:f[0]===0});for(var I=f[0],U=1;U<f.length;U++){var $=f[U];g.push({left:w=I*h,right:C=(I+=$)*h,isDash:T=!T,zeroLength:$===0})}return g},ft.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var C=this.width*(this.nextRow+h+w),T=0,I=f[T],U=0;U<this.width;U++){U/I.right>1&&(I=f[++T]);var $=Math.abs(U-I.left),le=Math.abs(U-I.right),ve=Math.min($,le),ye=void 0,ze=w/h*(g+1);if(I.isDash){var Fe=g-Math.abs(ze);ye=Math.sqrt(ve*ve+Fe*Fe)}else ye=g-Math.sqrt(ve*ve+ze*ze);this.data[C+U]=Math.max(0,Math.min(255,ye+128))}},ft.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],C=f[f.length-1];w.isDash===C.isDash&&(w.left=C.left-this.width,C.right=w.right+this.width);for(var T=this.width*this.nextRow,I=0,U=f[I],$=0;$<this.width;$++){$/U.right>1&&(U=f[++I]);var le=Math.abs($-U.left),ve=Math.abs($-U.right),ye=Math.min(le,ve);this.data[T+$]=Math.max(0,Math.min(255,(U.isDash?ye:-ye)+128))}},ft.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,C=0;C<f.length;C++)w+=f[C];if(w!==0){var T=this.width/w,I=this.getDashRanges(f,this.width,T);d?this.addRoundDash(I,T,h):this.addRegularDash(I)}var U={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,U},ft.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Kt=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var C=new f.Actor(g[w],h,this.id);C.name="Worker "+w,this.actors.push(C)}};function xr(f,d,h){var g=function(w,C){if(w)return h(w);if(C){var T=y.pick(y.extend(C,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(T.vectorLayers=C.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(I){return I.id})),T.tiles=d.canonicalizeTileset(T,f.url),h(null,T)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}Kt.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},Kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kt.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},Kt.Actor=y.Actor;var Y=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};Y.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},Y.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<C};var Le=function(f){function d(h,g,w,C){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new Y(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(I,U){return delete h.request,h.aborted?g(null):I&&I.status!==404?g(I):(U&&U.resourceTiming&&(h.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&h.setExpiryData(U),h.loadVectorData(U,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",C,T.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",C,T.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),O=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new Y(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,C=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(C,y.ResourceType.Tile),function(T,I){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(I){w.map._refreshExpiredTiles&&h.setExpiryData(I),delete I.cacheControl,delete I.expires;var U=w.map.painter.context,$=U.gl;h.texture=w.map.painter.getTileTexture(I.width),h.texture?h.texture.update(I,{useMipmap:!0}):(h.texture=new y.Texture(U,I,$.RGBA,{useMipmap:!0}),h.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Me=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(T,I){T&&(h.state="errored",g(T)),I&&(h.dem=I,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(T,I){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(T)h.state="errored",g(T);else if(I){this.map._refreshExpiredTiles&&h.setExpiryData(I),delete I.cacheControl,delete I.expires;var U=y.window.ImageBitmap&&I instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?I:y.browser.getImageData(I,1),$={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:U,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",$,C.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),C=(g.x-1+w)%w,T=g.x===0?h.wrap-1:h.wrap,I=(g.x+1+w)%w,U=g.x+1===w?h.wrap+1:h.wrap,$={};return $[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,U,g.z,I,g.y).key]={backfilled:!1},g.y>0&&($[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,U,g.z,I,g.y-1).key]={backfilled:!1}),g.y+1<w&&($[new y.OverscaledTileID(h.overscaledZ,T,g.z,C,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},$[new y.OverscaledTileID(h.overscaledZ,U,g.z,I,g.y+1).key]={backfilled:!1}),$},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(O),we=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(C),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var T=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*T,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*T,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*T,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var C={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(C.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",C))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},C),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),C=this._data;typeof C=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(C),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(C),this.actor.send(this.type+".loadData",w,function(T,I){g._removed||I&&I.abandoned||(g._loaded=!0,I&&I.resourceTiming&&I.resourceTiming[g.id]&&(g._resourceTiming=I.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(T))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,C=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(C,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,I){return delete h.request,h.unloadVectorData(),h.aborted?g(null):T?g(T):(h.loadVectorData(I,w.map.painter,C==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ut=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),yt=function(f){function d(h,g,w,C){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(C,T){w._loaded=!0,C?w.fire(new y.ErrorEvent(C)):T&&(w.image=T,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var I=1/0,U=1/0,$=-1/0,le=-1/0,ve=0,ye=T;ve<ye.length;ve+=1){var ze=ye[ve];I=Math.min(I,ze.x),U=Math.min(U,ze.y),$=Math.max($,ze.x),le=Math.max(le,ze.y)}var Fe=Math.max($-I,le-U),Ye=Math.max(0,Math.floor(-Math.log(Fe)/Math.LN2)),Pe=Math.pow(2,Ye);return new y.CanonicalTileID(Ye,Math.floor((I+$)/2*Pe),Math.floor((U+le)/2*Pe))}(w),this.minzoom=this.maxzoom=this.tileID.z;var C=w.map(function(T){return g.tileID.getTilePoint(T)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),xt=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,C=g.urls;w<C.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(C[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(T,I){h._loaded=!0,T?h.fire(new y.ErrorEvent(T)):I&&(h.video=I,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(yt),jt=function(f){function d(h,g,w,C){f.call(this,h,g,w,C),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(I){return typeof I!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(yt),nr={vector:Le,raster:O,"raster-dem":Me,geojson:we,video:xt,image:yt,canvas:jt};function en(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Lr(f,d,h,g,w,C){var T=function(Ye,Pe,Xe){if(Ye)for(var st=0,Ct=Ye;st<Ct.length;st+=1){var Wt=Pe[Ct[st]];if(Wt&&Wt.source===Xe&&Wt.type==="fill-extrusion")return!0}else for(var Zt in Pe){var Ht=Pe[Zt];if(Ht.source===Xe&&Ht.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),I=C.maxPitchScaleFactor(),U=f.tilesIn(g,I,T);U.sort(Vn);for(var $=[],le=0,ve=U;le<ve.length;le+=1){var ye=ve[le];$.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(d,h,f._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,w,C,I,en(f.transform,ye.tileID))})}var ze=function(Ye){for(var Pe={},Xe={},st=0,Ct=Ye;st<Ct.length;st+=1){var Wt=Ct[st],Zt=Wt.queryResults,Ht=Wt.wrappedTileID,hr=Xe[Ht]=Xe[Ht]||{};for(var Nr in Zt)for(var Dr=Zt[Nr],an=hr[Nr]=hr[Nr]||{},En=Pe[Nr]=Pe[Nr]||[],Dn=0,On=Dr;Dn<On.length;Dn+=1){var Li=On[Dn];an[Li.featureIndex]||(an[Li.featureIndex]=!0,En.push(Li))}}return Pe}($);for(var Fe in ze)ze[Fe].forEach(function(Ye){var Pe=Ye.feature,Xe=f.getFeatureState(Pe.layer["source-layer"],Pe.id);Pe.source=Pe.layer.source,Pe.layer["source-layer"]&&(Pe.sourceLayer=Pe.layer["source-layer"]),Pe.state=Xe});return ze}function Vn(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var rn=function(f,d){this.max=f,this.onRemove=d,this.reset()};rn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},rn.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var C={value:d,timeout:void 0};if(h!==void 0&&(C.timeout=setTimeout(function(){g.remove(f,C)},h)),this.data[w].push(C),this.order.push(w),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},rn.prototype.has=function(f){return f.wrapped().key in this.data},rn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},rn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},rn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},rn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},rn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},rn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},rn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var C=w[g];f(C.value)||d.push(C)}for(var T=0,I=d;T<I.length;T+=1){var U=I[T];this.remove(U.value.tileID,U)}};var Mn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Mn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Mn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Mn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ii={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Yn=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Yn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Yn.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Yn.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Yn.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],C=d.attributes[w.name];C!==void 0&&f.vertexAttribPointer(C,w.components,f[ii[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},Yn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var yn=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};yn.prototype.get=function(){return this.current},yn.prototype.set=function(f){},yn.prototype.getDefault=function(){return this.default},yn.prototype.setDefault=function(){this.set(this.default)};var Ai=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(yn),Pi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(yn),Mi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(yn),Hn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(yn),Ln=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(yn),vo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(yn),Xi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(yn),Ya=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(yn),Mt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(yn),L=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(yn),re=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(yn),fe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(yn),Ue=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(yn),ht=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(yn),Gt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(yn),Ar=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(yn),je=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(yn),Tt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(yn),ar=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(yn),wr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(yn),$r=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(yn),_n=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(yn),Cn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(yn),xn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(yn),wn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(yn),ri=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(yn),Kn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(yn),Yi=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(yn),qi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(yn),mo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(yn),Wo=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(yn),Ki=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(yn),G=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Ki),X=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Ki),ne=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new G(f,w),g&&(this.depthAttachment=new X(f,w))};ne.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var be=function(f,d,h){this.func=f,this.mask=d,this.range=h};be.ReadOnly=!1,be.ReadWrite=!0,be.disabled=new be(519,be.ReadOnly,[0,1]);var Oe=function(f,d,h,g,w,C){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=C};Oe.disabled=new Oe({func:519,mask:0},0,0,7680,7680,7680);var Qe=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};Qe.disabled=new Qe(Qe.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Qe.unblended=new Qe(Qe.Replace,y.Color.transparent,[!0,!0,!0,!0]),Qe.alphaBlended=new Qe([1,771],y.Color.transparent,[!0,!0,!0,!0]);var ot=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};ot.disabled=new ot(!1,1029,2305),ot.backCCW=new ot(!0,1029,2305);var he=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ai(this),this.clearDepth=new Pi(this),this.clearStencil=new Mi(this),this.colorMask=new Hn(this),this.depthMask=new Ln(this),this.stencilMask=new vo(this),this.stencilFunc=new Xi(this),this.stencilOp=new Ya(this),this.stencilTest=new Mt(this),this.depthRange=new L(this),this.depthTest=new re(this),this.depthFunc=new fe(this),this.blend=new Ue(this),this.blendFunc=new ht(this),this.blendColor=new Gt(this),this.blendEquation=new Ar(this),this.cullFace=new je(this),this.cullFaceSide=new Tt(this),this.frontFace=new ar(this),this.program=new wr(this),this.activeTexture=new $r(this),this.viewport=new _n(this),this.bindFramebuffer=new Cn(this),this.bindRenderbuffer=new xn(this),this.bindTexture=new wn(this),this.bindVertexBuffer=new ri(this),this.bindElementBuffer=new Kn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Yi(this),this.pixelStoreUnpack=new qi(this),this.pixelStoreUnpackPremultiplyAlpha=new mo(this),this.pixelStoreUnpackFlipY=new Wo(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(f,d){return new Mn(this,f,d)},he.prototype.createVertexBuffer=function(f,d,h){return new Yn(this,f,d,h)},he.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},he.prototype.createFramebuffer=function(f,d,h){return new ne(this,f,d,h)},he.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},he.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},he.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,Qe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var K=function(f){function d(h,g,w){var C=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(T,I,U,$){var le=new nr[I.type](T,I,U,$);if(le.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+le.id);return y.bindAll(["load","abort","unload","serialize","prepare"],le),le}(h,g,w,this),this._tiles={},this._cache=new rn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(xe).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var C in this._tiles)this._isIdRenderable(C,h)&&w.push(this._tiles[C]);return h?w.sort(function(T,I){var U=T.tileID,$=I.tileID,le=new y.Point(U.canonical.x,U.canonical.y)._rotate(g.transform.angle),ve=new y.Point($.canonical.x,$.canonical.y)._rotate(g.transform.angle);return U.overscaledZ-$.overscaledZ||ve.y-le.y||ve.x-le.x}).map(function(T){return T.tileID.key}):w.map(function(T){return T.tileID}).sort(xe).map(function(T){return T.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,C){if(C)return h.state="errored",void(C.status!==404?this._source.fire(new y.ErrorEvent(C,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var C=g[w];if(h.neighboringTiles&&h.neighboringTiles[C]){var T=this.getTileByID(C);I(h,T),I(T,h)}}function I(U,$){U.needsHillshadePrepare=!0;var le=$.tileID.canonical.x-U.tileID.canonical.x,ve=$.tileID.canonical.y-U.tileID.canonical.y,ye=Math.pow(2,U.tileID.canonical.z),ze=$.tileID.key;le===0&&ve===0||Math.abs(ve)>1||(Math.abs(le)>1&&(Math.abs(le+ye)===1?le+=ye:Math.abs(le-ye)===1&&(le-=ye)),$.dem&&U.dem&&(U.dem.backfillBorder($.dem,le,ve),U.neighboringTiles&&U.neighboringTiles[ze]&&(U.neighboringTiles[ze].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,C){for(var T in this._tiles){var I=this._tiles[T];if(!(C[T]||!I.hasData()||I.tileID.overscaledZ<=g||I.tileID.overscaledZ>w)){for(var U=I.tileID;I&&I.tileID.overscaledZ>g+1;){var $=I.tileID.scaledTo(I.tileID.overscaledZ-1);(I=this._tiles[$.key])&&I.hasData()&&(U=$)}for(var le=U;le.overscaledZ>g;)if(h[(le=le.scaledTo(le.overscaledZ-1)).key]){C[U.key]=U;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var C=h.overscaledZ-1;C>=g;C--){var T=h.scaledTo(C),I=this._getLoadedTile(T);if(I)return I}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,C=Math.floor(g*w*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var C in this._tiles){var T=this._tiles[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+g),w[T.tileID.key]=T}for(var I in this._tiles=w,this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(hr){return new y.OverscaledTileID(hr.canonical.z,hr.wrap,hr.canonical.z,hr.canonical.x,hr.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(hr){return g._source.hasTile(hr)}))):w=[];var C=h.coveringZoomLevel(this._source),T=Math.max(C-d.maxOverzooming,this._source.minzoom),I=Math.max(C+d.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(w,C);if(lt(this._source.type)){for(var $={},le={},ve=0,ye=Object.keys(U);ve<ye.length;ve+=1){var ze=ye[ve],Fe=U[ze],Ye=this._tiles[ze];if(Ye&&!(Ye.fadeEndTime&&Ye.fadeEndTime<=y.browser.now())){var Pe=this.findLoadedParent(Fe,T);Pe&&(this._addTile(Pe.tileID),$[Pe.tileID.key]=Pe.tileID),le[ze]=Fe}}for(var Xe in this._retainLoadedChildren(le,C,I,U),$)U[Xe]||(this._coveredTiles[Xe]=!0,U[Xe]=$[Xe])}for(var st in U)this._tiles[st].clearFadeHold();for(var Ct=0,Wt=y.keysDifference(this._tiles,U);Ct<Wt.length;Ct+=1){var Zt=Wt[Ct],Ht=this._tiles[Zt];Ht.hasSymbolBuckets&&!Ht.holdingForFade()?Ht.setHoldDuration(this.map._fadeDuration):Ht.hasSymbolBuckets&&!Ht.symbolFadeFinished()||this._removeTile(Zt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},C={},T=Math.max(g-d.maxOverzooming,this._source.minzoom),I=Math.max(g+d.maxUnderzooming,this._source.minzoom),U={},$=0,le=h;$<le.length;$+=1){var ve=le[$],ye=this._addTile(ve);w[ve.key]=ve,ye.hasData()||g<this._source.maxzoom&&(U[ve.key]=ve)}this._retainLoadedChildren(U,g,I,w);for(var ze=0,Fe=h;ze<Fe.length;ze+=1){var Ye=Fe[ze],Pe=this._tiles[Ye.key];if(!Pe.hasData()){if(g+1>this._source.maxzoom){var Xe=Ye.children(this._source.maxzoom)[0],st=this.getTile(Xe);if(st&&st.hasData()){w[Xe.key]=Xe;continue}}else{var Ct=Ye.children(this._source.maxzoom);if(w[Ct[0].key]&&w[Ct[1].key]&&w[Ct[2].key]&&w[Ct[3].key])continue}for(var Wt=Pe.wasRequested(),Zt=Ye.overscaledZ-1;Zt>=T;--Zt){var Ht=Ye.scaledTo(Zt);if(C[Ht.key]||(C[Ht.key]=!0,!(Pe=this.getTile(Ht))&&Wt&&(Pe=this._addTile(Ht)),Pe&&(w[Ht.key]=Ht,Wt=Pe.wasRequested(),Pe.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,C=this._tiles[h].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){w=this._loadedParentTiles[C.key];break}g.push(C.key);var T=C.scaledTo(C.overscaledZ-1);if(w=this._getLoadedTile(T))break;C=T}for(var I=0,U=g;I<U.length;I+=1)this._loadedParentTiles[U[I]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var C=g.getExpiryTimeout();C&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},C))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var C=this,T=[],I=this.transform;if(!I)return T;for(var U=w?I.getCameraQueryGeometry(h):h,$=h.map(function(Zt){return I.pointCoordinate(Zt)}),le=U.map(function(Zt){return I.pointCoordinate(Zt)}),ve=this.getIds(),ye=1/0,ze=1/0,Fe=-1/0,Ye=-1/0,Pe=0,Xe=le;Pe<Xe.length;Pe+=1){var st=Xe[Pe];ye=Math.min(ye,st.x),ze=Math.min(ze,st.y),Fe=Math.max(Fe,st.x),Ye=Math.max(Ye,st.y)}for(var Ct=function(Zt){var Ht=C._tiles[ve[Zt]];if(!Ht.holdingForFade()){var hr=Ht.tileID,Nr=Math.pow(2,I.zoom-Ht.tileID.overscaledZ),Dr=g*Ht.queryPadding*y.EXTENT/Ht.tileSize/Nr,an=[hr.getTilePoint(new y.MercatorCoordinate(ye,ze)),hr.getTilePoint(new y.MercatorCoordinate(Fe,Ye))];if(an[0].x-Dr<y.EXTENT&&an[0].y-Dr<y.EXTENT&&an[1].x+Dr>=0&&an[1].y+Dr>=0){var En=$.map(function(On){return hr.getTilePoint(On)}),Dn=le.map(function(On){return hr.getTilePoint(On)});T.push({tile:Ht,tileID:hr,queryGeometry:En,cameraQueryGeometry:Dn,scale:Nr})}}},Wt=0;Wt<ve.length;Wt++)Ct(Wt);return T},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(U){return g._tiles[U].tileID}),C=0,T=w;C<T.length;C+=1){var I=T[C];I.posMatrix=this.transform.calculatePosMatrix(I.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(lt(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var C=this._tiles[h];C&&C.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(C){return!C.hasDependency(h,g)})},d}(y.Evented);function xe(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function lt(f){return f==="raster"||f==="image"||f==="video"}function pt(){return new y.window.Worker(rf.workerUrl)}K.maxOverzooming=10,K.maxUnderzooming=3;var te="mapboxgl_preloaded_worker_pool",br=function(){this.active={}};br.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<br.workerCount;)this.workers.push(new pt);return this.active[f]=!0,this.workers.slice()},br.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},br.prototype.isPreloaded=function(){return!!this.active[te]},br.prototype.numActive=function(){return Object.keys(this.active).length};var bn,cn=Math.floor(y.browser.hardwareConcurrency/2);function Qt(){return bn||(bn=new br),bn}function tn(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function Hr(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=tn(f[g],d[f[g].ref]));return f}br.workerCount=Math.max(Math.min(cn,6),1);var qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function si(f,d,h){h.push({command:qr.addSource,args:[f,d[f]]})}function Jr(f,d,h){d.push({command:qr.removeSource,args:[f]}),h[f]=!0}function fi(f,d,h,g){Jr(f,h,g),si(f,d,h)}function zi(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function ui(f,d,h,g,w,C){var T;for(T in d=d||{},f=f||{})f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}));for(T in d)d.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(y.deepEqual(f[T],d[T])||h.push({command:C,args:[g,T,d[T],w]}))}function wi(f){return f.id}function bi(f,d){return f[d.id]=d,f}var oo=function(f,d){this.reset(f,d)};oo.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},oo.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,C=this._distances[w],T=h-C,I=T>0?(g-C)/T:0;return this.points[w].mult(1-I).add(this.points[d].mult(I))};var ji=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function fa(f,d,h,g,w){var C=y.create();return d?(y.scale(C,C,[1/w,1/w,1]),h||y.rotateZ(C,C,g.angle)):y.multiply(C,g.labelPlaneMatrix,f),C}function mi(f,d,h,g,w){if(d){var C=y.clone(f);return y.scale(C,C,[w,w,1]),h||y.rotateZ(C,C,-g.angle),C}return g.glCoordMatrix}function li(f,d){var h=[f.x,f.y,0,1];Qi(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function gi(f,d){return .5+f/d*.5}function ha(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function Ns(f,d,h,g,w,C,T,I){var U=g?f.textSizeData:f.iconSizeData,$=y.evaluateSizeForZoom(U,h.transform.zoom),le=[256/h.width*2+1,256/h.height*2+1],ve=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ve.clear();for(var ye=f.lineVertexArray,ze=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Fe=h.transform.width/h.transform.height,Ye=!1,Pe=0;Pe<ze.length;Pe++){var Xe=ze.get(Pe);if(Xe.hidden||Xe.writingMode===y.WritingMode.vertical&&!Ye)oa(Xe.numGlyphs,ve);else{Ye=!1;var st=[Xe.anchorX,Xe.anchorY,0,1];if(y.transformMat4(st,st,d),ha(st,le)){var Ct=gi(h.transform.cameraToCenterDistance,st[3]),Wt=y.evaluateSizeForFeature(U,$,Xe),Zt=T?Wt/Ct:Wt*Ct,Ht=new y.Point(Xe.anchorX,Xe.anchorY),hr=li(Ht,w).point,Nr={},Dr=hl(Xe,Zt,!1,I,d,w,C,f.glyphOffsetArray,ye,ve,hr,Ht,Nr,Fe);Ye=Dr.useVertical,(Dr.notEnoughRoom||Ye||Dr.needsFlipping&&hl(Xe,Zt,!0,I,d,w,C,f.glyphOffsetArray,ye,ve,hr,Ht,Nr,Fe).notEnoughRoom)&&oa(Xe.numGlyphs,ve)}else oa(Xe.numGlyphs,ve)}}g?f.text.dynamicLayoutVertexBuffer.updateData(ve):f.icon.dynamicLayoutVertexBuffer.updateData(ve)}function Ji(f,d,h,g,w,C,T,I,U,$,le){var ve=I.glyphStartIndex+I.numGlyphs,ye=I.lineStartIndex,ze=I.lineStartIndex+I.lineLength,Fe=d.getoffsetX(I.glyphStartIndex),Ye=d.getoffsetX(ve-1),Pe=pa(f*Fe,h,g,w,C,T,I.segment,ye,ze,U,$,le);if(!Pe)return null;var Xe=pa(f*Ye,h,g,w,C,T,I.segment,ye,ze,U,$,le);return Xe?{first:Pe,last:Xe}:null}function aa(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function hl(f,d,h,g,w,C,T,I,U,$,le,ve,ye,ze){var Fe,Ye=d/24,Pe=f.lineOffsetX*Ye,Xe=f.lineOffsetY*Ye;if(f.numGlyphs>1){var st=f.glyphStartIndex+f.numGlyphs,Ct=f.lineStartIndex,Wt=f.lineStartIndex+f.lineLength,Zt=Ji(Ye,I,Pe,Xe,h,le,ve,f,U,C,ye);if(!Zt)return{notEnoughRoom:!0};var Ht=li(Zt.first.point,T).point,hr=li(Zt.last.point,T).point;if(g&&!h){var Nr=aa(f.writingMode,Ht,hr,ze);if(Nr)return Nr}Fe=[Zt.first];for(var Dr=f.glyphStartIndex+1;Dr<st-1;Dr++)Fe.push(pa(Ye*I.getoffsetX(Dr),Pe,Xe,h,le,ve,f.segment,Ct,Wt,U,C,ye));Fe.push(Zt.last)}else{if(g&&!h){var an=li(ve,w).point,En=f.lineStartIndex+f.segment+1,Dn=new y.Point(U.getx(En),U.gety(En)),On=li(Dn,w),Li=On.signedDistanceFromCamera>0?On.point:Fu(ve,Dn,an,1,w),fn=aa(f.writingMode,an,Li,ze);if(fn)return fn}var Wn=pa(Ye*I.getoffsetX(f.glyphStartIndex),Pe,Xe,h,le,ve,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,U,C,ye);if(!Wn)return{notEnoughRoom:!0};Fe=[Wn]}for(var ai=0,Jn=Fe;ai<Jn.length;ai+=1){var $n=Jn[ai];y.addDynamicAttributes($,$n.point,$n.angle)}return{}}function Fu(f,d,h,g,w){var C=li(f.add(f.sub(d)._unit()),w).point,T=h.sub(C);return h.add(T._mult(g/T.mag()))}function pa(f,d,h,g,w,C,T,I,U,$,le,ve){var ye=g?f-d:f+d,ze=ye>0?1:-1,Fe=0;g&&(ze*=-1,Fe=Math.PI),ze<0&&(Fe+=Math.PI);for(var Ye=ze>0?I+T:I+T+1,Pe=w,Xe=w,st=0,Ct=0,Wt=Math.abs(ye),Zt=[];st+Ct<=Wt;){if((Ye+=ze)<I||Ye>=U)return null;if(Xe=Pe,Zt.push(Pe),(Pe=ve[Ye])===void 0){var Ht=new y.Point($.getx(Ye),$.gety(Ye)),hr=li(Ht,le);if(hr.signedDistanceFromCamera>0)Pe=ve[Ye]=hr.point;else{var Nr=Ye-ze;Pe=Fu(st===0?C:new y.Point($.getx(Nr),$.gety(Nr)),Ht,Xe,Wt-st+1,le)}}st+=Ct,Ct=Xe.dist(Pe)}var Dr=(Wt-st)/Ct,an=Pe.sub(Xe),En=an.mult(Dr)._add(Xe);En._add(an._unit()._perp()._mult(h*ze));var Dn=Fe+Math.atan2(Pe.y-Xe.y,Pe.x-Xe.x);return Zt.push(En),{point:En,angle:Dn,path:Zt}}ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ji.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},ji.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},ji.prototype._insertBoxCell=function(f,d,h,g,w,C){this.boxCells[w].push(C)},ji.prototype._insertCircleCell=function(f,d,h,g,w,C){this.circleCells[w].push(C)},ji.prototype._query=function(f,d,h,g,w,C){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var T=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(var U=0;U<this.circleKeys.length;U++){var $=this.circles[3*U],le=this.circles[3*U+1],ve=this.circles[3*U+2];T.push({key:this.circleKeys[U],x1:$-ve,y1:le-ve,x2:$+ve,y2:le+ve})}return C?T.filter(C):T}return this._forEachCell(f,d,h,g,this._queryCell,T,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?T.length>0:T},ji.prototype._queryCircle=function(f,d,h,g,w){var C=f-h,T=f+h,I=d-h,U=d+h;if(T<0||C>this.width||U<0||I>this.height)return!g&&[];var $=[];return this._forEachCell(C,I,T,U,this._queryCellCircle,$,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?$.length>0:$},ji.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},ji.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},ji.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},ji.prototype._queryCell=function(f,d,h,g,w,C,T,I){var U=T.seenUids,$=this.boxCells[w];if($!==null)for(var le=this.bboxes,ve=0,ye=$;ve<ye.length;ve+=1){var ze=ye[ve];if(!U.box[ze]){U.box[ze]=!0;var Fe=4*ze;if(f<=le[Fe+2]&&d<=le[Fe+3]&&h>=le[Fe+0]&&g>=le[Fe+1]&&(!I||I(this.boxKeys[ze]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[ze],x1:le[Fe],y1:le[Fe+1],x2:le[Fe+2],y2:le[Fe+3]})}}}var Ye=this.circleCells[w];if(Ye!==null)for(var Pe=this.circles,Xe=0,st=Ye;Xe<st.length;Xe+=1){var Ct=st[Xe];if(!U.circle[Ct]){U.circle[Ct]=!0;var Wt=3*Ct;if(this._circleAndRectCollide(Pe[Wt],Pe[Wt+1],Pe[Wt+2],f,d,h,g)&&(!I||I(this.circleKeys[Ct]))){if(T.hitTest)return C.push(!0),!0;var Zt=Pe[Wt],Ht=Pe[Wt+1],hr=Pe[Wt+2];C.push({key:this.circleKeys[Ct],x1:Zt-hr,y1:Ht-hr,x2:Zt+hr,y2:Ht+hr})}}}},ji.prototype._queryCellCircle=function(f,d,h,g,w,C,T,I){var U=T.circle,$=T.seenUids,le=this.boxCells[w];if(le!==null)for(var ve=this.bboxes,ye=0,ze=le;ye<ze.length;ye+=1){var Fe=ze[ye];if(!$.box[Fe]){$.box[Fe]=!0;var Ye=4*Fe;if(this._circleAndRectCollide(U.x,U.y,U.radius,ve[Ye+0],ve[Ye+1],ve[Ye+2],ve[Ye+3])&&(!I||I(this.boxKeys[Fe])))return C.push(!0),!0}}var Pe=this.circleCells[w];if(Pe!==null)for(var Xe=this.circles,st=0,Ct=Pe;st<Ct.length;st+=1){var Wt=Ct[st];if(!$.circle[Wt]){$.circle[Wt]=!0;var Zt=3*Wt;if(this._circlesCollide(Xe[Zt],Xe[Zt+1],Xe[Zt+2],U.x,U.y,U.radius)&&(!I||I(this.circleKeys[Wt])))return C.push(!0),!0}}},ji.prototype._forEachCell=function(f,d,h,g,w,C,T,I){for(var U=this._convertToXCellCoord(f),$=this._convertToYCellCoord(d),le=this._convertToXCellCoord(h),ve=this._convertToYCellCoord(g),ye=U;ye<=le;ye++)for(var ze=$;ze<=ve;ze++)if(w.call(this,f,d,h,g,this.xCellCount*ze+ye,C,T,I))return},ji.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},ji.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},ji.prototype._circlesCollide=function(f,d,h,g,w,C){var T=g-f,I=w-d,U=h+C;return U*U>T*T+I*I},ji.prototype._circleAndRectCollide=function(f,d,h,g,w,C,T){var I=(C-g)/2,U=Math.abs(f-(g+I));if(U>I+h)return!1;var $=(T-w)/2,le=Math.abs(d-(w+$));if(le>$+h)return!1;if(U<=I||le<=$)return!0;var ve=U-I,ye=le-$;return ve*ve+ye*ye<=h*h};var qn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oa(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set(qn,3*g)}}function Qi(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var Mo=function(f,d,h){d===void 0&&(d=new ji(f.width+200,f.height+200,25)),h===void 0&&(h=new ji(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function Gi(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}Mo.prototype.placeCollisionBox=function(f,d,h,g,w){var C=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),T=h*C.perspectiveRatio,I=f.x1*T+C.point.x,U=f.y1*T+C.point.y,$=f.x2*T+C.point.x,le=f.y2*T+C.point.y;return!this.isInsideGrid(I,U,$,le)||!d&&this.grid.hitTest(I,U,$,le,w)?{box:[],offscreen:!1}:{box:[I,U,$,le],offscreen:this.isOffscreen(I,U,$,le)}},Mo.prototype.placeCollisionCircles=function(f,d,h,g,w,C,T,I,U,$,le,ve,ye){var ze=[],Fe=new y.Point(d.anchorX,d.anchorY),Ye=li(Fe,C),Pe=gi(this.transform.cameraToCenterDistance,Ye.signedDistanceFromCamera),Xe=($?w/Pe:w*Pe)/y.ONE_EM,st=li(Fe,T).point,Ct=Ji(Xe,g,d.lineOffsetX*Xe,d.lineOffsetY*Xe,!1,st,Fe,d,h,T,{}),Wt=!1,Zt=!1,Ht=!0;if(Ct){for(var hr=.5*ve*Pe+ye,Nr=new y.Point(-100,-100),Dr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new oo,En=Ct.first,Dn=Ct.last,On=[],Li=En.path.length-1;Li>=1;Li--)On.push(En.path[Li]);for(var fn=1;fn<Dn.path.length;fn++)On.push(Dn.path[fn]);var Wn=2.5*hr;if(I){var ai=On.map(function(_s){return li(_s,I)});On=ai.some(function(_s){return _s.signedDistanceFromCamera<=0})?[]:ai.map(function(_s){return _s.point})}var Jn=[];if(On.length>0){for(var $n=On[0].clone(),ci=On[0].clone(),Xn=1;Xn<On.length;Xn++)$n.x=Math.min($n.x,On[Xn].x),$n.y=Math.min($n.y,On[Xn].y),ci.x=Math.max(ci.x,On[Xn].x),ci.y=Math.max(ci.y,On[Xn].y);Jn=$n.x>=Nr.x&&ci.x<=Dr.x&&$n.y>=Nr.y&&ci.y<=Dr.y?[On]:ci.x<Nr.x||$n.x>Dr.x||ci.y<Nr.y||$n.y>Dr.y?[]:y.clipLine([On],Nr.x,Nr.y,Dr.x,Dr.y)}for(var jn=0,Ja=Jn;jn<Ja.length;jn+=1){var va;an.reset(Ja[jn],.25*hr),va=an.length<=.5*hr?1:Math.ceil(an.paddedLength/Wn)+1;for(var bo=0;bo<va;bo++){var So=bo/Math.max(va-1,1),_a=an.lerp(So),Ta=_a.x+100,es=_a.y+100;ze.push(Ta,es,hr,0);var Uo=Ta-hr,ku=es-hr,Ro=Ta+hr,ys=es+hr;if(Ht=Ht&&this.isOffscreen(Uo,ku,Ro,ys),Zt=Zt||this.isInsideGrid(Uo,ku,Ro,ys),!f&&this.grid.hitTestCircle(Ta,es,hr,le)&&(Wt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!U&&Wt||!Zt?[]:ze,offscreen:Ht,collisionDetected:Wt}},Mo.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,C=-1/0,T=0,I=f;T<I.length;T+=1){var U=I[T],$=new y.Point(U.x+100,U.y+100);h=Math.min(h,$.x),g=Math.min(g,$.y),w=Math.max(w,$.x),C=Math.max(C,$.y),d.push($)}for(var le={},ve={},ye=0,ze=this.grid.query(h,g,w,C).concat(this.ignoredGrid.query(h,g,w,C));ye<ze.length;ye+=1){var Fe=ze[ye],Ye=Fe.key;if(le[Ye.bucketInstanceId]===void 0&&(le[Ye.bucketInstanceId]={}),!le[Ye.bucketInstanceId][Ye.featureIndex]){var Pe=[new y.Point(Fe.x1,Fe.y1),new y.Point(Fe.x2,Fe.y1),new y.Point(Fe.x2,Fe.y2),new y.Point(Fe.x1,Fe.y2)];y.polygonIntersectsPolygon(d,Pe)&&(le[Ye.bucketInstanceId][Ye.featureIndex]=!0,ve[Ye.bucketInstanceId]===void 0&&(ve[Ye.bucketInstanceId]=[]),ve[Ye.bucketInstanceId].push(Ye.featureIndex))}}return ve},Mo.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},Mo.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var C=d?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},I=0;I<f.length;I+=4)C.insertCircle(T,f[I],f[I+1],f[I+2])},Mo.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Qi(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Mo.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},Mo.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},Mo.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var Po=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};Po.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var go=function(f,d,h,g,w){this.text=new Po(f?f.text:null,d,h,w),this.icon=new Po(f?f.icon:null,d,g,w)};go.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Cs=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},zo=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Dl=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},yo=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function Ea(f,d,h,g,w){var C=y.getAnchorAlignment(f),T=-(C.horizontalAlign-.5)*d,I=-(C.verticalAlign-.5)*h,U=y.evaluateVariableOffset(f,g);return new y.Point(T+U[0]*w,I+U[1]*w)}function _r(f,d,h,g,w,C){var T=f.x1,I=f.x2,U=f.y1,$=f.y2,le=f.anchorPointX,ve=f.anchorPointY,ye=new y.Point(d,h);return g&&ye._rotate(w?C:-C),{x1:T+ye.x,y1:U+ye.y,x2:I+ye.x,y2:$+ye.y,anchorPointX:le,anchorPointY:ve}}yo.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Qr=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new Mo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new yo(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function ue(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}Qr.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),C=h.latestFeatureIndex;if(w&&C&&d.id===w.layerIds[0]){var T=h.collisionBoxArray,I=w.layers[0].layout,U=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),$=h.tileSize/y.EXTENT,le=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),ve=I.get("text-pitch-alignment")==="map",ye=I.get("text-rotation-alignment")==="map",ze=Gi(h,1,this.transform.zoom),Fe=fa(le,ve,ye,this.transform,ze),Ye=null;if(ve){var Pe=mi(le,ve,ye,this.transform,ze);Ye=y.multiply([],this.transform.labelPlaneMatrix,Pe)}this.retainedQueryData[w.bucketInstanceId]=new Dl(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,h.tileID);var Xe={bucket:w,layout:I,posMatrix:le,textLabelPlaneMatrix:Fe,labelToScreenMatrix:Ye,scale:U,textPixelRatio:$,holdingForFade:h.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var st=0,Ct=w.sortKeyRanges;st<Ct.length;st+=1){var Wt=Ct[st];f.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:Xe})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Xe})}},Qr.prototype.attemptAnchorPlacement=function(f,d,h,g,w,C,T,I,U,$,le,ve,ye,ze,Fe){var Ye,Pe=[ve.textOffset0,ve.textOffset1],Xe=Ea(f,h,g,Pe,w),st=this.collisionIndex.placeCollisionBox(_r(d,Xe.x,Xe.y,C,T,this.transform.angle),le,I,U,$.predicate);if(!Fe||this.collisionIndex.placeCollisionBox(_r(Fe,Xe.x,Xe.y,C,T,this.transform.angle),le,I,U,$.predicate).box.length!==0)return st.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID].text&&(Ye=this.prevPlacement.variableOffsets[ve.crossTileID].anchor),this.variableOffsets[ve.crossTileID]={textOffset:Pe,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:Ye},this.markUsedJustification(ye,f,ve,ze),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,ze,ve),this.placedOrientations[ve.crossTileID]=ze),{shift:Xe,placedGlyphBoxes:st}):void 0},Qr.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,C=w.bucket,T=w.layout,I=w.posMatrix,U=w.textLabelPlaneMatrix,$=w.labelToScreenMatrix,le=w.textPixelRatio,ve=w.holdingForFade,ye=w.collisionBoxArray,ze=w.partiallyEvaluatedTextSize,Fe=w.collisionGroup,Ye=T.get("text-optional"),Pe=T.get("icon-optional"),Xe=T.get("text-allow-overlap"),st=T.get("icon-allow-overlap"),Ct=T.get("text-rotation-alignment")==="map",Wt=T.get("text-pitch-alignment")==="map",Zt=T.get("icon-text-fit")!=="none",Ht=T.get("symbol-z-order")==="viewport-y",hr=Xe&&(st||!C.hasIconData()||Pe),Nr=st&&(Xe||!C.hasTextData()||Ye);!C.collisionArrays&&ye&&C.deserializeCollisionBoxes(ye);var Dr=function(fn,Wn){if(!d[fn.crossTileID])if(ve)g.placements[fn.crossTileID]=new Cs(!1,!1,!1);else{var ai,Jn=!1,$n=!1,ci=!0,Xn=null,jn={box:null,offscreen:null},Ja={box:null,offscreen:null},va=null,bo=null,So=0,_a=0,Ta=0;Wn.textFeatureIndex?So=Wn.textFeatureIndex:fn.useRuntimeCollisionCircles&&(So=fn.featureIndex),Wn.verticalTextFeatureIndex&&(_a=Wn.verticalTextFeatureIndex);var es=Wn.textBox;if(es){var Uo=function(Oi){var Qa=y.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Oi&&g.prevPlacement){var eo=g.prevPlacement.placedOrientations[fn.crossTileID];eo&&(g.placedOrientations[fn.crossTileID]=eo,g.markUsedOrientation(C,Qa=eo,fn))}return Qa},ku=function(Oi,Qa){if(C.allowVerticalPlacement&&fn.numVerticalGlyphVertices>0&&Wn.verticalTextBox)for(var eo=0,xs=C.writingModes;eo<xs.length&&(xs[eo]===y.WritingMode.vertical?(jn=Qa(),Ja=jn):jn=Oi(),!(jn&&jn.box&&jn.box.length));eo+=1);else jn=Oi()};if(T.get("text-variable-anchor")){var Ro=T.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[fn.crossTileID]){var ys=g.prevPlacement.variableOffsets[fn.crossTileID];Ro.indexOf(ys.anchor)>0&&(Ro=Ro.filter(function(Oi){return Oi!==ys.anchor})).unshift(ys.anchor)}var _s=function(Oi,Qa,eo){for(var xs=Oi.x2-Oi.x1,Pu=Oi.y2-Oi.y1,fu=fn.textBoxScale,ko=Zt&&!st?Qa:null,Mr={box:[],offscreen:!1},nl=Xe?2*Ro.length:Ro.length,Lu=0;Lu<nl;++Lu){var xa=g.attemptAnchorPlacement(Ro[Lu%Ro.length],Oi,xs,Pu,fu,Ct,Wt,le,I,Fe,Lu>=Ro.length,fn,C,eo,ko);if(xa&&(Mr=xa.placedGlyphBoxes)&&Mr.box&&Mr.box.length){Jn=!0,Xn=xa.shift;break}}return Mr};ku(function(){return _s(es,Wn.iconBox,y.WritingMode.horizontal)},function(){var Oi=Wn.verticalTextBox;return C.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&fn.numVerticalGlyphVertices>0&&Oi?_s(Oi,Wn.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),jn&&(Jn=jn.box,ci=jn.offscreen);var lu=Uo(jn&&jn.box);if(!Jn&&g.prevPlacement){var el=g.prevPlacement.variableOffsets[fn.crossTileID];el&&(g.variableOffsets[fn.crossTileID]=el,g.markUsedJustification(C,el.anchor,fn,lu))}}else{var tl=function(Oi,Qa){var eo=g.collisionIndex.placeCollisionBox(Oi,Xe,le,I,Fe.predicate);return eo&&eo.box&&eo.box.length&&(g.markUsedOrientation(C,Qa,fn),g.placedOrientations[fn.crossTileID]=Qa),eo};ku(function(){return tl(es,y.WritingMode.horizontal)},function(){var Oi=Wn.verticalTextBox;return C.allowVerticalPlacement&&fn.numVerticalGlyphVertices>0&&Oi?tl(Oi,y.WritingMode.vertical):{box:null,offscreen:null}}),Uo(jn&&jn.box&&jn.box.length)}}if(Jn=(ai=jn)&&ai.box&&ai.box.length>0,ci=ai&&ai.offscreen,fn.useRuntimeCollisionCircles){var rl=C.text.placedSymbolArray.get(fn.centerJustifiedTextSymbolIndex),Sl=y.evaluateSizeForFeature(C.textSizeData,ze,rl),Ds=T.get("text-padding");va=g.collisionIndex.placeCollisionCircles(Xe,rl,C.lineVertexArray,C.glyphOffsetArray,Sl,I,U,$,h,Wt,Fe.predicate,fn.collisionCircleDiameter,Ds),Jn=Xe||va.circles.length>0&&!va.collisionDetected,ci=ci&&va.offscreen}if(Wn.iconFeatureIndex&&(Ta=Wn.iconFeatureIndex),Wn.iconBox){var Iu=function(Oi){var Qa=Zt&&Xn?_r(Oi,Xn.x,Xn.y,Ct,Wt,g.transform.angle):Oi;return g.collisionIndex.placeCollisionBox(Qa,st,le,I,Fe.predicate)};$n=Ja&&Ja.box&&Ja.box.length&&Wn.verticalIconBox?(bo=Iu(Wn.verticalIconBox)).box.length>0:(bo=Iu(Wn.iconBox)).box.length>0,ci=ci&&bo.offscreen}var Xs=Ye||fn.numHorizontalGlyphVertices===0&&fn.numVerticalGlyphVertices===0,Ma=Pe||fn.numIconVertices===0;if(Xs||Ma?Ma?Xs||($n=$n&&Jn):Jn=$n&&Jn:$n=Jn=$n&&Jn,Jn&&ai&&ai.box&&g.collisionIndex.insertCollisionBox(ai.box,T.get("text-ignore-placement"),C.bucketInstanceId,Ja&&Ja.box&&_a?_a:So,Fe.ID),$n&&bo&&g.collisionIndex.insertCollisionBox(bo.box,T.get("icon-ignore-placement"),C.bucketInstanceId,Ta,Fe.ID),va&&(Jn&&g.collisionIndex.insertCollisionCircles(va.circles,T.get("text-ignore-placement"),C.bucketInstanceId,So,Fe.ID),h)){var cu=C.bucketInstanceId,Ys=g.collisionCircleArrays[cu];Ys===void 0&&(Ys=g.collisionCircleArrays[cu]=new zo);for(var fs=0;fs<va.circles.length;fs+=4)Ys.circles.push(va.circles[fs+0]),Ys.circles.push(va.circles[fs+1]),Ys.circles.push(va.circles[fs+2]),Ys.circles.push(va.collisionDetected?1:0)}g.placements[fn.crossTileID]=new Cs(Jn||hr,$n||Nr,ci||C.justReloaded),d[fn.crossTileID]=!0}};if(Ht)for(var an=C.getSortedSymbolIndexes(this.transform.angle),En=an.length-1;En>=0;--En){var Dn=an[En];Dr(C.symbolInstances.get(Dn),C.collisionArrays[Dn])}else for(var On=f.symbolInstanceStart;On<f.symbolInstanceEnd;On++)Dr(C.symbolInstances.get(On),C.collisionArrays[On]);if(h&&C.bucketInstanceId in this.collisionCircleArrays){var Li=this.collisionCircleArrays[C.bucketInstanceId];y.invert(Li.invProjMatrix,I),Li.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Qr.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];C<T.length;C+=1){var I=T[C];I>=0&&(f.text.placedSymbolArray.get(I).crossTileID=w>=0&&I!==w?0:h.crossTileID)}},Qr.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,C=0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];C<T.length;C+=1)f.text.placedSymbolArray.get(T[C]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},Qr.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},T=d?d.placedOrientations:{};for(var I in this.placements){var U=this.placements[I],$=w[I];$?(this.opacities[I]=new go($,g,U.text,U.icon),h=h||U.text!==$.text.placed||U.icon!==$.icon.placed):(this.opacities[I]=new go(null,g,U.text,U.icon,U.skipFade),h=h||U.text||U.icon)}for(var le in w){var ve=w[le];if(!this.opacities[le]){var ye=new go(ve,g,!1,!1);ye.isHidden()||(this.opacities[le]=ye,h=h||ve.text.placed||ve.icon.placed)}}for(var ze in C)this.variableOffsets[ze]||!this.opacities[ze]||this.opacities[ze].isHidden()||(this.variableOffsets[ze]=C[ze]);for(var Fe in T)this.placedOrientations[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.placedOrientations[Fe]=T[Fe]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Qr.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var C=w[g],T=C.getBucket(f);T&&C.latestFeatureIndex&&f.id===T.layerIds[0]&&this.updateBucketOpacities(T,h,C.collisionBoxArray)}},Qr.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,C=new go(null,0,!1,!1,!0),T=w.get("text-allow-overlap"),I=w.get("icon-allow-overlap"),U=w.get("text-variable-anchor"),$=w.get("text-rotation-alignment")==="map",le=w.get("text-pitch-alignment")==="map",ve=w.get("icon-text-fit")!=="none",ye=new go(null,0,T&&(I||!f.hasIconData()||w.get("icon-optional")),I&&(T||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var ze=function(Xe,st,Ct){for(var Wt=0;Wt<st/4;Wt++)Xe.opacityVertexArray.emplaceBack(Ct)},Fe=function(Xe){var st=f.symbolInstances.get(Xe),Ct=st.numHorizontalGlyphVertices,Wt=st.numVerticalGlyphVertices,Zt=st.crossTileID,Ht=g.opacities[Zt];d[Zt]?Ht=C:Ht||(g.opacities[Zt]=Ht=ye),d[Zt]=!0;var hr=st.numIconVertices>0,Nr=g.placedOrientations[st.crossTileID],Dr=Nr===y.WritingMode.vertical,an=Nr===y.WritingMode.horizontal||Nr===y.WritingMode.horizontalOnly;if(Ct>0||Wt>0){var En=so(Ht.text);ze(f.text,Ct,Dr?Ga:En),ze(f.text,Wt,an?Ga:En);var Dn=Ht.text.isHidden();[st.rightJustifiedTextSymbolIndex,st.centerJustifiedTextSymbolIndex,st.leftJustifiedTextSymbolIndex].forEach(function(jn){jn>=0&&(f.text.placedSymbolArray.get(jn).hidden=Dn||Dr?1:0)}),st.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(st.verticalPlacedTextSymbolIndex).hidden=Dn||an?1:0);var On=g.variableOffsets[st.crossTileID];On&&g.markUsedJustification(f,On.anchor,st,Nr);var Li=g.placedOrientations[st.crossTileID];Li&&(g.markUsedJustification(f,"left",st,Li),g.markUsedOrientation(f,Li,st))}if(hr){var fn=so(Ht.icon),Wn=!(ve&&st.verticalPlacedIconSymbolIndex&&Dr);st.placedIconSymbolIndex>=0&&(ze(f.icon,st.numIconVertices,Wn?fn:Ga),f.icon.placedSymbolArray.get(st.placedIconSymbolIndex).hidden=Ht.icon.isHidden()),st.verticalPlacedIconSymbolIndex>=0&&(ze(f.icon,st.numVerticalIconVertices,Wn?Ga:fn),f.icon.placedSymbolArray.get(st.verticalPlacedIconSymbolIndex).hidden=Ht.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var ai=f.collisionArrays[Xe];if(ai){var Jn=new y.Point(0,0);if(ai.textBox||ai.verticalTextBox){var $n=!0;if(U){var ci=g.variableOffsets[Zt];ci?(Jn=Ea(ci.anchor,ci.width,ci.height,ci.textOffset,ci.textBoxScale),$&&Jn._rotate(le?g.transform.angle:-g.transform.angle)):$n=!1}ai.textBox&&ue(f.textCollisionBox.collisionVertexArray,Ht.text.placed,!$n||Dr,Jn.x,Jn.y),ai.verticalTextBox&&ue(f.textCollisionBox.collisionVertexArray,Ht.text.placed,!$n||an,Jn.x,Jn.y)}var Xn=Boolean(!an&&ai.verticalIconBox);ai.iconBox&&ue(f.iconCollisionBox.collisionVertexArray,Ht.icon.placed,Xn,ve?Jn.x:0,ve?Jn.y:0),ai.verticalIconBox&&ue(f.iconCollisionBox.collisionVertexArray,Ht.icon.placed,!Xn,ve?Jn.x:0,ve?Jn.y:0)}}},Ye=0;Ye<f.symbolInstances.length;Ye++)Fe(Ye);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Pe=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Pe.invProjMatrix,f.placementViewportMatrix=Pe.viewportMatrix,f.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Qr.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Qr.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Qr.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Qr.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Qr.prototype.setStale=function(){this.stale=!0};var Te=Math.pow(2,25),it=Math.pow(2,24),Jt=Math.pow(2,17),Gr=Math.pow(2,16),kn=Math.pow(2,9),Di=Math.pow(2,8),Oa=Math.pow(2,1);function so(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Te+d*it+h*Jt+d*Gr+h*kn+d*Di+h*Oa+d}var Ga=0,os=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};os.prototype.continuePlacement=function(f,d,h,g,w){for(var C=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(C,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(T,I){return T.sortKey-I.sortKey}));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var $o=function(f,d,h,g,w,C,T){this.placement=new Qr(f,w,C,T),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};$o.prototype.isDone=function(){return this._done},$o.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),C=function(){var U=y.browser.now()-w;return!g._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var T=d[f[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=I)&&(!T.maxzoom||T.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new os(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},$o.prototype.commit=function(f){return this.placement.commit(f),this.placement};var th=512/y.EXTENT/2,Uc=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),C=w.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};Uc.prototype.getScaledCoordinates=function(f,d){var h=th/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},Uc.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var C=f.get(w);if(!C.crossTileID){var T=this.indexedSymbolInstances[C.key];if(T)for(var I=this.getScaledCoordinates(C,d),U=0,$=T;U<$.length;U+=1){var le=$[U];if(Math.abs(le.coord.x-I.x)<=g&&Math.abs(le.coord.y-I.y)<=g&&!h[le.crossTileID]){h[le.crossTileID]=!0,C.crossTileID=le.crossTileID;break}}}}};var Ts=function(){this.maxCrossTileID=0};Ts.prototype.generate=function(){return++this.maxCrossTileID};var Bu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Bu.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var C in g){var T=g[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),w[T.tileID.key]=T}this.indexes[h]=w}this.lng=f},Bu.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var C in this.indexes){var T=this.indexes[C];if(Number(C)>f.overscaledZ)for(var I in T){var U=T[I];U.tileID.isChildOf(f)&&U.findMatches(d.symbolInstances,f,w)}else{var $=T[f.scaledTo(Number(C)).key];$&&$.findMatches(d.symbolInstances,f,w)}}for(var le=0;le<d.symbolInstances.length;le++){var ve=d.symbolInstances.get(le);ve.crossTileID||(ve.crossTileID=h.generate(),w[ve.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new Uc(f,d.symbolInstances,d.bucketInstanceId),!0},Bu.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},Bu.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var ss=function(){this.layerIndexes={},this.crossTileIDs=new Ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ss.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new Bu);var w=!1,C={};g.handleWrapJump(h);for(var T=0,I=d;T<I.length;T+=1){var U=I[T],$=U.getBucket(f);$&&f.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(U.tileID,$,this.crossTileIDs)&&(w=!0),C[$.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(w=!0),w},ss.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var pl=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},zu=y.pick(qr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Zs=y.pick(qr,["setCenter","setZoom","setBearing","setPitch"]),Ol=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),Xo=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new Kt(Qt(),this),this.imageManager=new qt,this.imageManager.setEventedParent(this),this.glyphManager=new lr(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var C=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(T){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(I,U){if(y.triggerPluginCompletionEvent(I),U&&U.every(function(le){return le}))for(var $ in C.sourceCaches)C.sourceCaches[$].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var I=w.sourceCaches[T.sourceId];if(I){var U=I.getSource();if(U&&U.vectorLayerIds)for(var $ in w._layers){var le=w._layers[$];le.source===U.id&&w._validateLayer(le)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var C=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var T=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(T,function(I,U){w._request=null,I?w.fire(new y.ErrorEvent(I)):U&&w._load(U,C)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Ol,!1)},d.prototype._load=function(h,g){if(!g||!pl(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var C=Hr(this.stylesheet.layers);this._order=C.map(function($){return $.id}),this._layers={},this._serializedLayers={};for(var T=0,I=C;T<I.length;T+=1){var U=I[T];(U=y.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ot(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,C,T){var I,U,$,le=y.browser.devicePixelRatio>1?"@2x":"",ve=y.getJSON(C.transformRequest(C.normalizeSpriteURL(w,le,".json"),y.ResourceType.SpriteJSON),function(Fe,Ye){ve=null,$||($=Fe,I=Ye,ze())}),ye=y.getImage(C.transformRequest(C.normalizeSpriteURL(w,le,".png"),y.ResourceType.SpriteImage),function(Fe,Ye){ye=null,$||($=Fe,U=Ye,ze())});function ze(){if($)T($);else if(I&&U){var Fe=y.browser.getImageData(U),Ye={};for(var Pe in I){var Xe=I[Pe],st=Xe.width,Ct=Xe.height,Wt=Xe.x,Zt=Xe.y,Ht=Xe.sdf,hr=Xe.pixelRatio,Nr=Xe.stretchX,Dr=Xe.stretchY,an=Xe.content,En=new y.RGBAImage({width:st,height:Ct});y.RGBAImage.copy(Fe,En,{x:Wt,y:Zt},{x:0,y:0},{width:st,height:Ct}),Ye[Pe]={data:En,pixelRatio:hr,sdf:Ht,stretchX:Nr,stretchY:Dr,content:an}}T(null,Ye)}}return{cancel:function(){ve&&(ve.cancel(),ve=null),ye&&(ye.cancel(),ye=null)}}}(h,this.map._requestManager,function(w,C){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(C)for(var T in C)g.imageManager.addImage(T,C[T]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var C=g.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+C.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,C=h;w<C.length;w+=1){var T=this._layers[C[w]];T.type!=="custom"&&g.push(T.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var T in(w.length||C.length)&&this._updateWorkerLayers(w,C),this._updatedSources){var I=this._updatedSources[T];I==="reload"?this._reloadSource(T):I==="clear"&&this._clearSource(T)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var $={};for(var le in this.sourceCaches){var ve=this.sourceCaches[le];$[le]=ve.used,ve.used=!1}for(var ye=0,ze=this._order;ye<ze.length;ye+=1){var Fe=this._layers[ze[ye]];Fe.recalculate(h,this._availableImages),!Fe.isHidden(h.zoom)&&Fe.source&&(this.sourceCaches[Fe.source].used=!0)}for(var Ye in $){var Pe=this.sourceCaches[Ye];$[Ye]!==Pe.used&&Pe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ye}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),pl(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=Hr(h.layers);var w=function(T,I){if(!T)return[{command:qr.setStyle,args:[I]}];var U=[];try{if(!y.deepEqual(T.version,I.version))return[{command:qr.setStyle,args:[I]}];y.deepEqual(T.center,I.center)||U.push({command:qr.setCenter,args:[I.center]}),y.deepEqual(T.zoom,I.zoom)||U.push({command:qr.setZoom,args:[I.zoom]}),y.deepEqual(T.bearing,I.bearing)||U.push({command:qr.setBearing,args:[I.bearing]}),y.deepEqual(T.pitch,I.pitch)||U.push({command:qr.setPitch,args:[I.pitch]}),y.deepEqual(T.sprite,I.sprite)||U.push({command:qr.setSprite,args:[I.sprite]}),y.deepEqual(T.glyphs,I.glyphs)||U.push({command:qr.setGlyphs,args:[I.glyphs]}),y.deepEqual(T.transition,I.transition)||U.push({command:qr.setTransition,args:[I.transition]}),y.deepEqual(T.light,I.light)||U.push({command:qr.setLight,args:[I.light]});var $={},le=[];(function(ye,ze,Fe,Ye){var Pe;for(Pe in ze=ze||{},ye=ye||{})ye.hasOwnProperty(Pe)&&(ze.hasOwnProperty(Pe)||Jr(Pe,Fe,Ye));for(Pe in ze)ze.hasOwnProperty(Pe)&&(ye.hasOwnProperty(Pe)?y.deepEqual(ye[Pe],ze[Pe])||(ye[Pe].type==="geojson"&&ze[Pe].type==="geojson"&&zi(ye,ze,Pe)?Fe.push({command:qr.setGeoJSONSourceData,args:[Pe,ze[Pe].data]}):fi(Pe,ze,Fe,Ye)):si(Pe,ze,Fe))})(T.sources,I.sources,le,$);var ve=[];T.layers&&T.layers.forEach(function(ye){$[ye.source]?U.push({command:qr.removeLayer,args:[ye.id]}):ve.push(ye)}),U=U.concat(le),function(ye,ze,Fe){ze=ze||[];var Ye,Pe,Xe,st,Ct,Wt,Zt,Ht=(ye=ye||[]).map(wi),hr=ze.map(wi),Nr=ye.reduce(bi,{}),Dr=ze.reduce(bi,{}),an=Ht.slice(),En=Object.create(null);for(Ye=0,Pe=0;Ye<Ht.length;Ye++)Dr.hasOwnProperty(Xe=Ht[Ye])?Pe++:(Fe.push({command:qr.removeLayer,args:[Xe]}),an.splice(an.indexOf(Xe,Pe),1));for(Ye=0,Pe=0;Ye<hr.length;Ye++)an[an.length-1-Ye]!==(Xe=hr[hr.length-1-Ye])&&(Nr.hasOwnProperty(Xe)?(Fe.push({command:qr.removeLayer,args:[Xe]}),an.splice(an.lastIndexOf(Xe,an.length-Pe),1)):Pe++,Fe.push({command:qr.addLayer,args:[Dr[Xe],Wt=an[an.length-Ye]]}),an.splice(an.length-Ye,0,Xe),En[Xe]=!0);for(Ye=0;Ye<hr.length;Ye++)if(st=Nr[Xe=hr[Ye]],Ct=Dr[Xe],!En[Xe]&&!y.deepEqual(st,Ct))if(y.deepEqual(st.source,Ct.source)&&y.deepEqual(st["source-layer"],Ct["source-layer"])&&y.deepEqual(st.type,Ct.type)){for(Zt in ui(st.layout,Ct.layout,Fe,Xe,null,qr.setLayoutProperty),ui(st.paint,Ct.paint,Fe,Xe,null,qr.setPaintProperty),y.deepEqual(st.filter,Ct.filter)||Fe.push({command:qr.setFilter,args:[Xe,Ct.filter]}),y.deepEqual(st.minzoom,Ct.minzoom)&&y.deepEqual(st.maxzoom,Ct.maxzoom)||Fe.push({command:qr.setLayerZoomRange,args:[Xe,Ct.minzoom,Ct.maxzoom]}),st)st.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?ui(st[Zt],Ct[Zt],Fe,Xe,Zt.slice(6),qr.setPaintProperty):y.deepEqual(st[Zt],Ct[Zt])||Fe.push({command:qr.setLayerProperty,args:[Xe,Zt,Ct[Zt]]}));for(Zt in Ct)Ct.hasOwnProperty(Zt)&&!st.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?ui(st[Zt],Ct[Zt],Fe,Xe,Zt.slice(6),qr.setPaintProperty):y.deepEqual(st[Zt],Ct[Zt])||Fe.push({command:qr.setLayerProperty,args:[Xe,Zt,Ct[Zt]]}))}else Fe.push({command:qr.removeLayer,args:[Xe]}),Wt=an[an.lastIndexOf(Xe)+1],Fe.push({command:qr.addLayer,args:[Ct,Wt]})}(ve,I.layers,U)}catch(ye){console.warn("Unable to compute style diff:",ye),U=[{command:qr.setStyle,args:[I]}]}return U}(this.serialize(),h).filter(function(T){return!(T.command in Zs)});if(w.length===0)return!1;var C=w.filter(function(T){return!(T.command in zu)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(T){return T.command}).join(", ")+".");return w.forEach(function(T){T.command!=="setTransition"&&g[T.command].apply(g,T.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var C=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var T=this.sourceCaches[h]=new K(h,g,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:T.serialize(),sourceId:h}}),T.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=h.id;if(this.getLayer(C))this.fire(new y.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var T;if(h.type==="custom"){if(pl(this,y.validateCustomStyleLayer(h)))return;T=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(C,h.source),h=y.clone$1(h),h=y.extend(h,{source:C})),this._validate(y.validateStyle.layer,"layers."+C,h,{arrayIndex:-1},w))return;T=y.createStyleLayer(h),this._validateLayer(T),T.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[T.id]=T.serialize()}var I=g?this._order.indexOf(g):this._order.length;if(g&&I===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(I,0,C),this._layerOrderChanged=!0,this._layers[C]=T,this._removedLayers[C]&&T.source&&T.type!=="custom"){var U=this._removedLayers[C];delete this._removedLayers[C],U.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var C=g?this._order.indexOf(g):this._order.length;g&&C===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(C,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var C=this.getLayer(h);C?C.minzoom===g&&C.maxzoom===w||(g!=null&&(C.minzoom=g),w!=null&&(C.maxzoom=w),this._updateLayer(C)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(h);if(C){if(!y.deepEqual(C.filter,g))return g==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(y.validateStyle.filter,"layers."+C.id+".filter",g,null,w)||(C.filter=y.clone$1(g),this._updateLayer(C)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getLayoutProperty(g),w)||(T.setLayoutProperty(g,w,C),this._updateLayer(T)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(h);T?y.deepEqual(T.getPaintProperty(g),w)||(T.setPaintProperty(g,w,C)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=h.sourceLayer,T=this.sourceCaches[w];if(T!==void 0){var I=T.getSource().type;I==="geojson"&&C?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||C?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(C,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,C=this.sourceCaches[w];if(C!==void 0){var T=C.getSource().type,I=T==="vector"?h.sourceLayer:void 0;T!=="vector"||I?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(I,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,C=this.sourceCaches[g];if(C!==void 0){if(C.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(Nr){return g._layers[Nr].type==="fill-extrusion"},C={},T=[],I=this._order.length-1;I>=0;I--){var U=this._order[I];if(w(U)){C[U]=I;for(var $=0,le=h;$<le.length;$+=1){var ve=le[$][U];if(ve)for(var ye=0,ze=ve;ye<ze.length;ye+=1)T.push(ze[ye])}}}T.sort(function(Nr,Dr){return Dr.intersectionZ-Nr.intersectionZ});for(var Fe=[],Ye=this._order.length-1;Ye>=0;Ye--){var Pe=this._order[Ye];if(w(Pe))for(var Xe=T.length-1;Xe>=0;Xe--){var st=T[Xe].feature;if(C[st.layer.id]<Ye)break;Fe.push(st),T.pop()}else for(var Ct=0,Wt=h;Ct<Wt.length;Ct+=1){var Zt=Wt[Ct][Pe];if(Zt)for(var Ht=0,hr=Zt;Ht<hr.length;Ht+=1)Fe.push(hr[Ht].feature)}}return Fe},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var C={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,I=g.layers;T<I.length;T+=1){var U=I[T],$=this._layers[U];if(!$)return this.fire(new y.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];C[$.source]=!0}}var le=[];for(var ve in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!C[ve]||le.push(Lr(this.sourceCaches[ve],this._layers,this._serializedLayers,h,g,w));return this.placement&&le.push(function(ye,ze,Fe,Ye,Pe,Xe,st){for(var Ct={},Wt=Xe.queryRenderedSymbols(Ye),Zt=[],Ht=0,hr=Object.keys(Wt).map(Number);Ht<hr.length;Ht+=1)Zt.push(st[hr[Ht]]);Zt.sort(Vn);for(var Nr=function(){var On=an[Dr],Li=On.featureIndex.lookupSymbolFeatures(Wt[On.bucketInstanceId],ze,On.bucketIndex,On.sourceLayerIndex,Pe.filter,Pe.layers,Pe.availableImages,ye);for(var fn in Li){var Wn=Ct[fn]=Ct[fn]||[],ai=Li[fn];ai.sort(function(ci,Xn){var jn=On.featureSortOrder;if(jn){var Ja=jn.indexOf(ci.featureIndex);return jn.indexOf(Xn.featureIndex)-Ja}return Xn.featureIndex-ci.featureIndex});for(var Jn=0,$n=ai;Jn<$n.length;Jn+=1)Wn.push($n[Jn])}},Dr=0,an=Zt;Dr<an.length;Dr+=1)Nr();var En=function(On){Ct[On].forEach(function(Li){var fn=Li.feature,Wn=Fe[ye[On].source].getFeatureState(fn.layer["source-layer"],fn.id);fn.source=fn.layer.source,fn.layer["source-layer"]&&(fn.sourceLayer=fn.layer["source-layer"]),fn.state=Wn})};for(var Dn in Ct)En(Dn);return Ct}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(C,T){for(var I=C.getRenderableIds().map(function(ze){return C.getTileByID(ze)}),U=[],$={},le=0;le<I.length;le++){var ve=I[le],ye=ve.tileID.canonical.key;$[ye]||($[ye]=!0,ve.querySourceFeatures(U,T))}return U}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),C=!1;for(var T in h)if(!y.deepEqual(h[T],w[T])){C=!0;break}if(C){var I={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(I)}},d.prototype._validate=function(h,g,w,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&pl(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},C)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,C,T){T===void 0&&(T=!1);for(var I=!1,U=!1,$={},le=0,ve=this._order;le<ve.length;le+=1){var ye=this._layers[ve[le]];if(ye.type==="symbol"){if(!$[ye.source]){var ze=this.sourceCaches[ye.source];$[ye.source]=ze.getRenderableIds(!0).map(function(st){return ze.getTileByID(st)}).sort(function(st,Ct){return Ct.tileID.overscaledZ-st.tileID.overscaledZ||(st.tileID.isLessThan(Ct.tileID)?-1:1)})}var Fe=this.crossTileSymbolIndex.addLayer(ye,$[ye.source],h.center.lng);I=I||Fe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new $o(h,this._order,T,g,w,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),U=!0),I&&this.pauseablePlacement.placement.setStale()),U||I)for(var Ye=0,Pe=this._order;Ye<Pe.length;Ye+=1){var Xe=this._layers[Pe[Ye]];Xe.type==="symbol"&&this.placement.updateLayerOpacities(Xe,$[Xe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var C=this.sourceCaches[g.source];C&&C.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);Xo.getSourceType=function(f){return nr[f]},Xo.setSourceType=function(f,d){nr[f]=d},Xo.registerForPluginStateChange=y.registerForPluginStateChange;var Fa=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Fl=Ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Vc=Ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gf=Ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Nu=Ei(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Bl=Ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),jc=Ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Gc=Ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),yf=Ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),rh=Ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),nh=Ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Hh=Ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),cc=Ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fc=Ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ih=Ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ba=Ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),_f=Ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Zu=Ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ms=Ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),dl=Ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ei=Ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),yu=Ei(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),vs=Ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),_u=Ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yo=Ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Hc=Ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ci=Ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ei(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=C?C.concat(w):w,I={};return{fragmentSource:f=f.replace(h,function(U,$,le,ve,ye){return I[ye]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
varying `+le+" "+ve+" "+ye+`;
#else
uniform `+le+" "+ve+" u_"+ye+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ye+`
    `+le+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),vertexSource:d=d.replace(h,function(U,$,le,ve,ye){var ze=ve==="float"?"vec2":"vec4",Fe=ye.match(/color/)?"color":ze;return I[ye]?$==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+le+" "+ze+" a_"+ye+`;
varying `+le+" "+ve+" "+ye+`;
#else
uniform `+le+" "+ve+" u_"+ye+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = a_"+ye+`;
#else
    `+le+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = unpack_mix_"+Fe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+le+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+le+" "+ze+" a_"+ye+`;
#else
uniform `+le+" "+ve+" u_"+ye+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+le+" "+ve+" "+ye+" = a_"+ye+`;
#else
    `+le+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+le+" "+ve+" "+ye+" = unpack_mix_"+Fe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+le+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),staticAttributes:g,staticUniforms:T}}var Us=Object.freeze({__proto__:null,prelude:Fl,background:Vc,backgroundPattern:gf,circle:Nu,clippingMask:Bl,heatmap:jc,heatmapTexture:Gc,collisionBox:yf,collisionCircle:rh,debug:nh,fill:Hh,fillOutline:cc,fillOutlinePattern:fc,fillPattern:ih,fillExtrusion:Ba,fillExtrusionPattern:_f,hillshadePrepare:Zu,hillshade:Ms,line:dl,lineGradient:ei,linePattern:yu,lineSDF:vs,raster:_u,symbolIcon:Yo,symbolSDF:Hc,symbolTextAndIcon:Ci}),Vs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ah(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}Vs.prototype.bind=function(f,d,h,g,w,C,T,I){this.context=f;for(var U=this.boundPaintVertexBuffers.length!==g.length,$=0;!U&&$<g.length;$++)this.boundPaintVertexBuffers[$]!==g[$]&&(U=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!U&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===I?(f.bindVertexArrayOES.set(this.vao),T&&T.bind(),w&&w.dynamicDraw&&w.bind(),I&&I.bind()):this.freshBind(d,h,g,w,C,T,I)},Vs.prototype.freshBind=function(f,d,h,g,w,C,T){var I,U=f.numAttributes,$=this.context,le=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T;else{I=$.currentNumAttributes||0;for(var ve=U;ve<I;ve++)le.disableVertexAttribArray(ve)}d.enableAttributes(le,f);for(var ye=0,ze=h;ye<ze.length;ye+=1)ze[ye].enableAttributes(le,f);C&&C.enableAttributes(le,f),T&&T.enableAttributes(le,f),d.bind(),d.setVertexAttribPointers(le,f,w);for(var Fe=0,Ye=h;Fe<Ye.length;Fe+=1){var Pe=Ye[Fe];Pe.bind(),Pe.setVertexAttribPointers(le,f,w)}C&&(C.bind(),C.setVertexAttribPointers(le,f,w)),g&&g.bind(),T&&(T.bind(),T.setVertexAttribPointers(le,f,w)),$.currentNumAttributes=U},Vs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var xf=function(f,d,h,g,w,C){var T=f.gl;this.program=T.createProgram();for(var I=ah(h.staticAttributes),U=g?g.getBinderAttributes():[],$=I.concat(U),le=h.staticUniforms?ah(h.staticUniforms):[],ve=g?g.getBinderUniforms():[],ye=[],ze=0,Fe=le.concat(ve);ze<Fe.length;ze+=1){var Ye=Fe[ze];ye.indexOf(Ye)<0&&ye.push(Ye)}var Pe=g?g.defines():[];C&&Pe.push("#define OVERDRAW_INSPECTOR;");var Xe=Pe.concat(Fl.fragmentSource,h.fragmentSource).join(`
`),st=Pe.concat(Fl.vertexSource,h.vertexSource).join(`
`),Ct=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Ct,Xe),T.compileShader(Ct),T.attachShader(this.program,Ct);var Wt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Wt,st),T.compileShader(Wt),T.attachShader(this.program,Wt),this.attributes={};var Zt={};this.numAttributes=$.length;for(var Ht=0;Ht<this.numAttributes;Ht++)$[Ht]&&(T.bindAttribLocation(this.program,Ht,$[Ht]),this.attributes[$[Ht]]=Ht);T.linkProgram(this.program),T.deleteShader(Wt),T.deleteShader(Ct);for(var hr=0;hr<ye.length;hr++){var Nr=ye[hr];if(Nr&&!Zt[Nr]){var Dr=T.getUniformLocation(this.program,Nr);Dr&&(Zt[Nr]=Dr)}}this.fixedUniforms=w(f,Zt),this.binderUniforms=g?g.getUniforms(f,Zt):[]}}};function hc(f,d,h){var g=1/Gi(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),C=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,T=C*(h.tileID.canonical.x+h.tileID.wrap*w),I=C*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[T>>16,I>>16],u_pixel_coord_lower:[65535&T,65535&I]}}xf.prototype.draw=function(f,d,h,g,w,C,T,I,U,$,le,ve,ye,ze,Fe,Ye){var Pe,Xe=f.gl;if(!this.failedToCreate){for(var st in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(C),this.fixedUniforms)this.fixedUniforms[st].set(T[st]);ze&&ze.setUniforms(f,this.binderUniforms,ve,{zoom:ye});for(var Ct=(Pe={},Pe[Xe.LINES]=2,Pe[Xe.TRIANGLES]=3,Pe[Xe.LINE_STRIP]=1,Pe)[d],Wt=0,Zt=le.get();Wt<Zt.length;Wt+=1){var Ht=Zt[Wt],hr=Ht.vaos||(Ht.vaos={});(hr[I]||(hr[I]=new Vs)).bind(f,this,U,ze?ze.getPaintVertexBuffers():[],$,Ht.vertexOffset,Fe,Ye),Xe.drawElements(d,Ht.primitiveLength*Ct,Xe.UNSIGNED_SHORT,Ht.primitiveOffset*Ct*2)}}};var za=function(f,d,h,g){var w=d.style.light,C=w.properties.get("position"),T=[C.x,C.y,C.z],I=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(I,-d.transform.angle),y.transformMat3(T,T,I);var U=w.properties.get("color");return{u_matrix:f,u_lightpos:T,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+h,u_opacity:g}},Uu=function(f,d,h,g,w,C,T){return y.extend(za(f,d,h,g),hc(C,d,T),{u_height_factor:-Math.pow(2,w.overscaledZ)/T.tileSize/8})},xu=function(f){return{u_matrix:f}},No=function(f,d,h,g){return y.extend(xu(f),hc(h,d,g))},bf=function(f,d){return{u_matrix:f,u_world:d}},pc=function(f,d,h,g,w){return y.extend(No(f,d,h,g),{u_world:w})},ea=function(f,d,h,g){var w,C,T=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var I=Gi(h,1,T.zoom);w=!0,C=[I,I]}else w=!1,C=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:C}},nu=function(f,d,h){var g=Gi(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),C=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:C}},zl=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},iu=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},au=function(f){return{u_matrix:f}},Sf=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:Gi(d,1,h),u_intensity:g}},bu=function(f,d,h){var g=f.transform;return{u_matrix:Wc(f,d,h),u_ratio:1/Gi(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Hi=function(f,d,h,g){return y.extend(bu(f,d,h),{u_image:0,u_image_height:g})},dc=function(f,d,h,g){var w=f.transform,C=Nl(d,w);return{u_matrix:Wc(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Gi(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},vl=function(f,d,h,g,w){var C=f.lineAtlas,T=Nl(d,f.transform),I=h.layout.get("line-cap")==="round",U=C.getDash(g.from,I),$=C.getDash(g.to,I),le=U.width*w.fromScale,ve=$.width*w.toScale;return y.extend(bu(f,d,h),{u_patternscale_a:[T/le,-U.height/2],u_patternscale_b:[T/ve,-$.height/2],u_sdfgamma:C.width/(256*Math.min(le,ve)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:$.y,u_mix:w.t})};function Nl(f,d){return 1/Gi(f,1,d.tileZoom)}function Wc(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var wf=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(T=w.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(C=w.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:vc(w.paint.get("raster-hue-rotate"))};var C,T};function vc(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var mc,js=function(f,d,h,g,w,C,T,I,U,$){var le=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+U,u_pitch_with_map:+g,u_texsize:$,u_texture:0}},Su=function(f,d,h,g,w,C,T,I,U,$,le){var ve=w.transform;return y.extend(js(f,d,h,g,w,C,T,I,U,$),{u_gamma_scale:g?Math.cos(ve._pitch)*ve.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+le})},gc=function(f,d,h,g,w,C,T,I,U,$){return y.extend(Su(f,d,h,g,w,C,T,I,!0,U,!0),{u_texsize_icon:$,u_texture_icon:1})},ml=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},wu=function(f,d,h,g,w,C){return y.extend(function(T,I,U,$){var le=U.imageManager.getPattern(T.from.toString()),ve=U.imageManager.getPattern(T.to.toString()),ye=U.imageManager.getPixelSize(),ze=ye.width,Fe=ye.height,Ye=Math.pow(2,$.tileID.overscaledZ),Pe=$.tileSize*Math.pow(2,U.transform.tileZoom)/Ye,Xe=Pe*($.tileID.canonical.x+$.tileID.wrap*Ye),st=Pe*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:ve.tl,u_pattern_br_b:ve.br,u_texsize:[ze,Fe],u_mix:I.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:ve.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Gi($,1,U.transform.tileZoom),u_pixel_coord_upper:[Xe>>16,st>>16],u_pixel_coord_lower:[65535&Xe,65535&st]}}(g,C,h,w),{u_matrix:f,u_opacity:d})},Ef={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function Eu(f,d,h,g,w,C,T){for(var I=f.context,U=I.gl,$=f.useProgram("collisionBox"),le=[],ve=0,ye=0,ze=0;ze<g.length;ze++){var Fe=g[ze],Ye=d.getTile(Fe),Pe=Ye.getBucket(h);if(Pe){var Xe=Fe.posMatrix;w[0]===0&&w[1]===0||(Xe=f.translatePosMatrix(Fe.posMatrix,Ye,w,C));var st=T?Pe.textCollisionBox:Pe.iconCollisionBox,Ct=Pe.collisionCircleArray;if(Ct.length>0){var Wt=y.create(),Zt=Xe;y.mul(Wt,Pe.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(Wt,Wt,Pe.placementViewportMatrix),le.push({circleArray:Ct,circleOffset:ye,transform:Zt,invTransform:Wt}),ye=ve+=Ct.length/4}st&&$.draw(I,U.LINES,be.disabled,Oe.disabled,f.colorModeForRenderPass(),ot.disabled,nu(Xe,f.transform,Ye),h.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,null,f.transform.zoom,null,null,st.collisionVertexBuffer)}}if(T&&le.length){var Ht=f.useProgram("collisionCircle"),hr=new y.StructArrayLayout2f1f2i16;hr.resize(4*ve),hr._trim();for(var Nr=0,Dr=0,an=le;Dr<an.length;Dr+=1)for(var En=an[Dr],Dn=0;Dn<En.circleArray.length/4;Dn++){var On=4*Dn,Li=En.circleArray[On+0],fn=En.circleArray[On+1],Wn=En.circleArray[On+2],ai=En.circleArray[On+3];hr.emplace(Nr++,Li,fn,Wn,ai,0),hr.emplace(Nr++,Li,fn,Wn,ai,1),hr.emplace(Nr++,Li,fn,Wn,ai,2),hr.emplace(Nr++,Li,fn,Wn,ai,3)}(!mc||mc.length<2*ve)&&(mc=function(va){var bo=2*va,So=new y.StructArrayLayout3ui6;So.resize(bo),So._trim();for(var _a=0;_a<bo;_a++){var Ta=6*_a;So.uint16[Ta+0]=4*_a+0,So.uint16[Ta+1]=4*_a+1,So.uint16[Ta+2]=4*_a+2,So.uint16[Ta+3]=4*_a+2,So.uint16[Ta+4]=4*_a+3,So.uint16[Ta+5]=4*_a+0}return So}(ve));for(var Jn=I.createIndexBuffer(mc,!0),$n=I.createVertexBuffer(hr,y.collisionCircleLayout.members,!0),ci=0,Xn=le;ci<Xn.length;ci+=1){var jn=Xn[ci],Ja=zl(jn.transform,jn.invTransform,f.transform);Ht.draw(I,U.TRIANGLES,be.disabled,Oe.disabled,f.colorModeForRenderPass(),ot.disabled,Ja,h.id,$n,Jn,y.SegmentVector.simpleSegment(0,2*jn.circleOffset,jn.circleArray.length,jn.circleArray.length/2),null,f.transform.zoom,null,null,null)}$n.destroy(),Jn.destroy()}}var ks=y.identity(new Float32Array(16));function yc(f,d,h,g,w,C){var T=y.getAnchorAlignment(f),I=-(T.horizontalAlign-.5)*d,U=-(T.verticalAlign-.5)*h,$=y.evaluateVariableOffset(f,g);return new y.Point((I/w+$[0])*C,(U/w+$[1])*C)}function Zl(f,d,h,g,w,C,T,I,U,$,le){var ve=f.text.placedSymbolArray,ye=f.text.dynamicLayoutVertexArray,ze=f.icon.dynamicLayoutVertexArray,Fe={};ye.clear();for(var Ye=0;Ye<ve.length;Ye++){var Pe=ve.get(Ye),Xe=Pe.hidden||!Pe.crossTileID||f.allowVerticalPlacement&&!Pe.placedOrientation?null:g[Pe.crossTileID];if(Xe){var st=new y.Point(Pe.anchorX,Pe.anchorY),Ct=li(st,h?I:T),Wt=gi(C.cameraToCenterDistance,Ct.signedDistanceFromCamera),Zt=w.evaluateSizeForFeature(f.textSizeData,$,Pe)*Wt/y.ONE_EM;h&&(Zt*=f.tilePixelRatio/U);for(var Ht=yc(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale,Zt),hr=h?li(st.add(Ht),T).point:Ct.point.add(d?Ht.rotate(-C.angle):Ht),Nr=f.allowVerticalPlacement&&Pe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,Dr=0;Dr<Pe.numGlyphs;Dr++)y.addDynamicAttributes(ye,hr,Nr);le&&Pe.associatedIconIndex>=0&&(Fe[Pe.associatedIconIndex]={shiftedAnchor:hr,angle:Nr})}else oa(Pe.numGlyphs,ye)}if(le){ze.clear();for(var an=f.icon.placedSymbolArray,En=0;En<an.length;En++){var Dn=an.get(En);if(Dn.hidden)oa(Dn.numGlyphs,ze);else{var On=Fe[En];if(On)for(var Li=0;Li<Dn.numGlyphs;Li++)y.addDynamicAttributes(ze,On.shiftedAnchor,On.angle);else oa(Dn.numGlyphs,ze)}}f.icon.dynamicLayoutVertexBuffer.updateData(ze)}f.text.dynamicLayoutVertexBuffer.updateData(ye)}function Af(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Vu(f,d,h,g,w,C,T,I,U,$,le,ve){for(var ye=f.context,ze=ye.gl,Fe=f.transform,Ye=I==="map",Pe=U==="map",Xe=Ye&&h.layout.get("symbol-placement")!=="point",st=Ye&&!Pe&&!Xe,Ct=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,Zt=f.depthModeForSublayer(0,be.ReadOnly),Ht=h.layout.get("text-variable-anchor"),hr=[],Nr=0,Dr=g;Nr<Dr.length;Nr+=1){var an=Dr[Nr],En=d.getTile(an),Dn=En.getBucket(h);if(Dn){var On=w?Dn.text:Dn.icon;if(On&&On.segments.get().length){var Li=On.programConfigurations.get(h.id),fn=w||Dn.sdfIcons,Wn=w?Dn.textSizeData:Dn.iconSizeData,ai=Pe||Fe.pitch!==0,Jn=f.useProgram(Af(fn,w,Dn),Li),$n=y.evaluateSizeForZoom(Wn,Fe.zoom),ci=void 0,Xn=[0,0],jn=void 0,Ja=void 0,va=null,bo=void 0;if(w)jn=En.glyphAtlasTexture,Ja=ze.LINEAR,ci=En.glyphAtlasTexture.size,Dn.iconsInText&&(Xn=En.imageAtlasTexture.size,va=En.imageAtlasTexture,bo=ai||f.options.rotating||f.options.zooming||Wn.kind==="composite"||Wn.kind==="camera"?ze.LINEAR:ze.NEAREST);else{var So=h.layout.get("icon-size").constantOr(0)!==1||Dn.iconsNeedLinear;jn=En.imageAtlasTexture,Ja=fn||f.options.rotating||f.options.zooming||So||ai?ze.LINEAR:ze.NEAREST,ci=En.imageAtlasTexture.size}var _a=Gi(En,1,f.transform.zoom),Ta=fa(an.posMatrix,Pe,Ye,f.transform,_a),es=mi(an.posMatrix,Pe,Ye,f.transform,_a),Uo=Ht&&Dn.hasTextData(),ku=h.layout.get("icon-text-fit")!=="none"&&Uo&&Dn.hasIconData();Xe&&Ns(Dn,an.posMatrix,f,w,Ta,es,Pe,$);var Ro=f.translatePosMatrix(an.posMatrix,En,C,T),ys=Xe||w&&Ht||ku?ks:Ta,_s=f.translatePosMatrix(es,En,C,T,!0),lu=fn&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,el={program:Jn,buffers:On,uniformValues:fn?Dn.iconsInText?gc(Wn.kind,$n,st,Pe,f,Ro,ys,_s,ci,Xn):Su(Wn.kind,$n,st,Pe,f,Ro,ys,_s,w,ci,!0):js(Wn.kind,$n,st,Pe,f,Ro,ys,_s,w,ci),atlasTexture:jn,atlasTextureIcon:va,atlasInterpolation:Ja,atlasInterpolationIcon:bo,isSDF:fn,hasHalo:lu};if(Ct&&Dn.canOverlap){Wt=!0;for(var tl=0,rl=On.segments.get();tl<rl.length;tl+=1){var Sl=rl[tl];hr.push({segments:new y.SegmentVector([Sl]),sortKey:Sl.sortKey,state:el})}}else hr.push({segments:On.segments,sortKey:0,state:el})}}}Wt&&hr.sort(function(Ys,fs){return Ys.sortKey-fs.sortKey});for(var Ds=0,Iu=hr;Ds<Iu.length;Ds+=1){var Xs=Iu[Ds],Ma=Xs.state;if(ye.activeTexture.set(ze.TEXTURE0),Ma.atlasTexture.bind(Ma.atlasInterpolation,ze.CLAMP_TO_EDGE),Ma.atlasTextureIcon&&(ye.activeTexture.set(ze.TEXTURE1),Ma.atlasTextureIcon&&Ma.atlasTextureIcon.bind(Ma.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),Ma.isSDF){var cu=Ma.uniformValues;Ma.hasHalo&&(cu.u_is_halo=1,gl(Ma.buffers,Xs.segments,h,f,Ma.program,Zt,le,ve,cu)),cu.u_is_halo=0}gl(Ma.buffers,Xs.segments,h,f,Ma.program,Zt,le,ve,Ma.uniformValues)}}function gl(f,d,h,g,w,C,T,I,U){var $=g.context;w.draw($,$.gl.TRIANGLES,C,T,I,ot.disabled,U,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function $c(f,d,h,g,w,C,T){var I,U,$,le,ve,ye=f.context.gl,ze=h.paint.get("fill-pattern"),Fe=ze&&ze.constantOr(1),Ye=h.getCrossfadeParameters();T?(U=Fe&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=ye.LINES):(U=Fe?"fillPattern":"fill",I=ye.TRIANGLES);for(var Pe=0,Xe=g;Pe<Xe.length;Pe+=1){var st=Xe[Pe],Ct=d.getTile(st);if(!Fe||Ct.patternsLoaded()){var Wt=Ct.getBucket(h);if(Wt){var Zt=Wt.programConfigurations.get(h.id),Ht=f.useProgram(U,Zt);Fe&&(f.context.activeTexture.set(ye.TEXTURE0),Ct.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Ye));var hr=ze.constantOr(null);if(hr&&Ct.imageAtlas){var Nr=Ct.imageAtlas,Dr=Nr.patternPositions[hr.to.toString()],an=Nr.patternPositions[hr.from.toString()];Dr&&an&&Zt.setConstantPatternPositions(Dr,an)}var En=f.translatePosMatrix(st.posMatrix,Ct,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){le=Wt.indexBuffer2,ve=Wt.segments2;var Dn=[ye.drawingBufferWidth,ye.drawingBufferHeight];$=U==="fillOutlinePattern"&&Fe?pc(En,f,Ye,Ct,Dn):bf(En,Dn)}else le=Wt.indexBuffer,ve=Wt.segments,$=Fe?No(En,f,Ye,Ct):xu(En);Ht.draw(f.context,I,w,f.stencilModeForClipping(st),C,ot.disabled,$,h.id,Wt.layoutVertexBuffer,le,ve,h.paint,f.transform.zoom,Zt)}}}}function Au(f,d,h,g,w,C,T){for(var I=f.context,U=I.gl,$=h.paint.get("fill-extrusion-pattern"),le=$.constantOr(1),ve=h.getCrossfadeParameters(),ye=h.paint.get("fill-extrusion-opacity"),ze=0,Fe=g;ze<Fe.length;ze+=1){var Ye=Fe[ze],Pe=d.getTile(Ye),Xe=Pe.getBucket(h);if(Xe){var st=Xe.programConfigurations.get(h.id),Ct=f.useProgram(le?"fillExtrusionPattern":"fillExtrusion",st);le&&(f.context.activeTexture.set(U.TEXTURE0),Pe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),st.updatePaintBuffers(ve));var Wt=$.constantOr(null);if(Wt&&Pe.imageAtlas){var Zt=Pe.imageAtlas,Ht=Zt.patternPositions[Wt.to.toString()],hr=Zt.patternPositions[Wt.from.toString()];Ht&&hr&&st.setConstantPatternPositions(Ht,hr)}var Nr=f.translatePosMatrix(Ye.posMatrix,Pe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Dr=h.paint.get("fill-extrusion-vertical-gradient"),an=le?Uu(Nr,f,Dr,ye,Ye,ve,Pe):za(Nr,f,Dr,ye);Ct.draw(I,I.gl.TRIANGLES,w,C,T,ot.backCCW,an,h.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,h.paint,f.transform.zoom,st)}}}function ju(f,d,h,g,w,C){var T=f.context,I=T.gl,U=d.fbo;if(U){var $=f.useProgram("hillshade");T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,U.colorAttachment.get());var le=function(ve,ye,ze){var Fe=ze.paint.get("hillshade-shadow-color"),Ye=ze.paint.get("hillshade-highlight-color"),Pe=ze.paint.get("hillshade-accent-color"),Xe=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&(Xe-=ve.transform.angle);var st,Ct,Wt,Zt=!ve.options.moving;return{u_matrix:ve.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),Zt),u_image:0,u_latrange:(st=ye.tileID,Ct=Math.pow(2,st.canonical.z),Wt=st.canonical.y,[new y.MercatorCoordinate(0,Wt/Ct).toLngLat().lat,new y.MercatorCoordinate(0,(Wt+1)/Ct).toLngLat().lat]),u_light:[ze.paint.get("hillshade-exaggeration"),Xe],u_shadow:Fe,u_highlight:Ye,u_accent:Pe}}(f,d,h);$.draw(T,I.TRIANGLES,g,w,C,ot.disabled,le,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function oh(f,d,h,g,w,C){var T=f.context,I=T.gl,U=d.dem;if(U&&U.data){var $=U.dim,le=U.stride,ve=U.getPixels();if(T.activeTexture.set(I.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(le),d.demTexture){var ye=d.demTexture;ye.update(ve,{premultiply:!1}),ye.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(T,ve,I.RGBA,{premultiply:!1}),d.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);T.activeTexture.set(I.TEXTURE0);var ze=d.fbo;if(!ze){var Fe=new y.Texture(T,{width:$,height:$,data:null},I.RGBA);Fe.bind(I.LINEAR,I.CLAMP_TO_EDGE),(ze=d.fbo=T.createFramebuffer($,$,!0)).colorAttachment.set(Fe.texture)}T.bindFramebuffer.set(ze.framebuffer),T.viewport.set([0,0,$,$]),f.useProgram("hillshadePrepare").draw(T,I.TRIANGLES,g,w,C,ot.disabled,function(Ye,Pe){var Xe=Pe.stride,st=y.create();return y.ortho(st,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(st,st,[0,-y.EXTENT,0]),{u_matrix:st,u_image:1,u_dimension:[Xe,Xe],u_zoom:Ye.overscaledZ,u_unpack:Pe.getUnpackVector()}}(d.tileID,U),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Gu(f,d,h,g,w){var C=g.paint.get("raster-fade-duration");if(C>0){var T=y.browser.now(),I=(T-f.timeAdded)/C,U=d?(T-d.timeAdded)/C:-1,$=h.getSource(),le=w.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),ve=!d||Math.abs(d.tileID.overscaledZ-le)>Math.abs(f.tileID.overscaledZ-le),ye=ve&&f.refreshedUponExpiration?1:y.clamp(ve?I:1-U,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}var Cf=new y.Color(1,0,0,1),sh=new y.Color(0,1,0,1),_o=new y.Color(0,0,1,1),_c=new y.Color(1,0,1,1),uh=new y.Color(0,1,1,1);function lh(f,d,h,g){Ul(f,0,d+h/2,f.transform.width,h,g)}function Tf(f,d,h,g){Ul(f,d-h/2,0,h,f.transform.height,g)}function Ul(f,d,h,g,w,C){var T=f.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),T.clear({color:C}),I.disable(I.SCISSOR_TEST)}function Vl(f,d,h){var g=f.context,w=g.gl,C=h.posMatrix,T=f.useProgram("debug"),I=be.disabled,U=Oe.disabled,$=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),T.draw(g,w.LINE_STRIP,I,U,$,ot.disabled,iu(C,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var le=d.getTileByID(h.key).latestRawTileData,ve=Math.floor((le&&le.byteLength||0)/1024),ye=d.getTile(h).tileSize,ze=512/Math.min(ye,512)*(h.overscaledZ/f.transform.zoom)*.5,Fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Fe+=" => "+h.overscaledZ),function(Ye,Pe){Ye.initDebugOverlayCanvas();var Xe=Ye.debugOverlayCanvas,st=Ye.context.gl,Ct=Ye.debugOverlayCanvas.getContext("2d");Ct.clearRect(0,0,Xe.width,Xe.height),Ct.shadowColor="white",Ct.shadowBlur=2,Ct.lineWidth=1.5,Ct.strokeStyle="white",Ct.textBaseline="top",Ct.font="bold 36px Open Sans, sans-serif",Ct.fillText(Pe,5,5),Ct.strokeText(Pe,5,5),Ye.debugOverlayTexture.update(Xe),Ye.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(f,Fe+" "+ve+"kb"),T.draw(g,w.TRIANGLES,I,U,Qe.alphaBlended,ot.disabled,iu(C,y.Color.transparent,ze),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var Gs={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var C=Oe.disabled,T=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,U,$,le,ve,ye,ze){for(var Fe=U.transform,Ye=ve==="map",Pe=ye==="map",Xe=0,st=I;Xe<st.length;Xe+=1){var Ct=st[Xe],Wt=le.getTile(Ct),Zt=Wt.getBucket($);if(Zt&&Zt.text&&Zt.text.segments.get().length){var Ht=y.evaluateSizeForZoom(Zt.textSizeData,Fe.zoom),hr=Gi(Wt,1,U.transform.zoom),Nr=fa(Ct.posMatrix,Pe,Ye,U.transform,hr),Dr=$.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(Ht){var an=Math.pow(2,Fe.zoom-Wt.tileID.overscaledZ);Zl(Zt,Ye,Pe,ze,y.symbolSize,Fe,Nr,Ct.posMatrix,an,Ht,Dr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Vu(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),C,T),h.paint.get("text-opacity").constantOr(1)!==0&&Vu(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),C,T),d.map.showCollisionBoxes&&(Eu(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Eu(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),C=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||C.constantOr(1)!==0&&T.constantOr(1)!==0){for(var U=f.context,$=U.gl,le=f.depthModeForSublayer(0,be.ReadOnly),ve=Oe.disabled,ye=f.colorModeForRenderPass(),ze=[],Fe=0;Fe<g.length;Fe++){var Ye=g[Fe],Pe=d.getTile(Ye),Xe=Pe.getBucket(h);if(Xe){var st=Xe.programConfigurations.get(h.id),Ct={programConfiguration:st,program:f.useProgram("circle",st),layoutVertexBuffer:Xe.layoutVertexBuffer,indexBuffer:Xe.indexBuffer,uniformValues:ea(f,Ye,Pe,h)};if(I)for(var Wt=0,Zt=Xe.segments.get();Wt<Zt.length;Wt+=1){var Ht=Zt[Wt];ze.push({segments:new y.SegmentVector([Ht]),sortKey:Ht.sortKey,state:Ct})}else ze.push({segments:Xe.segments,sortKey:0,state:Ct})}}I&&ze.sort(function(En,Dn){return En.sortKey-Dn.sortKey});for(var hr=0,Nr=ze;hr<Nr.length;hr+=1){var Dr=Nr[hr],an=Dr.state;an.program.draw(U,$.TRIANGLES,le,ve,ye,ot.disabled,an.uniformValues,h.id,an.layoutVertexBuffer,an.indexBuffer,Dr.segments,h.paint,f.transform.zoom,an.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,C=w.gl,T=Oe.disabled,I=new Qe([C.ONE,C.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(ze,Fe,Ye){var Pe=ze.gl;ze.activeTexture.set(Pe.TEXTURE1),ze.viewport.set([0,0,Fe.width/4,Fe.height/4]);var Xe=Ye.heatmapFbo;if(Xe)Pe.bindTexture(Pe.TEXTURE_2D,Xe.colorAttachment.get()),ze.bindFramebuffer.set(Xe.framebuffer);else{var st=Pe.createTexture();Pe.bindTexture(Pe.TEXTURE_2D,st),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR),Xe=Ye.heatmapFbo=ze.createFramebuffer(Fe.width/4,Fe.height/4,!1),function(Ct,Wt,Zt,Ht){var hr=Ct.gl;hr.texImage2D(hr.TEXTURE_2D,0,hr.RGBA,Wt.width/4,Wt.height/4,0,hr.RGBA,Ct.extRenderToTextureHalfFloat?Ct.extTextureHalfFloat.HALF_FLOAT_OES:hr.UNSIGNED_BYTE,null),Ht.colorAttachment.set(Zt)}(ze,Fe,st,Xe)}})(w,f,h),w.clear({color:y.Color.transparent});for(var U=0;U<g.length;U++){var $=g[U];if(!d.hasRenderableParent($)){var le=d.getTile($),ve=le.getBucket(h);if(ve){var ye=ve.programConfigurations.get(h.id);f.useProgram("heatmap",ye).draw(w,C.TRIANGLES,be.disabled,T,I,ot.disabled,Sf($.posMatrix,le,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,h.paint,f.transform.zoom,ye)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(ze,Fe){var Ye=ze.context,Pe=Ye.gl,Xe=Fe.heatmapFbo;if(Xe){Ye.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_2D,Xe.colorAttachment.get()),Ye.activeTexture.set(Pe.TEXTURE1);var st=Fe.colorRampTexture;st||(st=Fe.colorRampTexture=new y.Texture(Ye,Fe.colorRamp,Pe.RGBA)),st.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),ze.useProgram("heatmapTexture").draw(Ye,Pe.TRIANGLES,be.disabled,Oe.disabled,ze.colorModeForRenderPass(),ot.disabled,function(Ct,Wt,Zt,Ht){var hr=y.create();y.ortho(hr,0,Ct.width,Ct.height,0,0,1);var Nr=Ct.context.gl;return{u_matrix:hr,u_world:[Nr.drawingBufferWidth,Nr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(ze,Fe),Fe.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments,Fe.paint,ze.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),C=h.paint.get("line-width");if(w.constantOr(1)!==0&&C.constantOr(1)!==0)for(var T=f.depthModeForSublayer(0,be.ReadOnly),I=f.colorModeForRenderPass(),U=h.paint.get("line-dasharray"),$=h.paint.get("line-pattern"),le=$.constantOr(1),ve=h.paint.get("line-gradient"),ye=h.getCrossfadeParameters(),ze=le?"linePattern":U?"lineSDF":ve?"lineGradient":"line",Fe=f.context,Ye=Fe.gl,Pe=!0,Xe=0,st=g;Xe<st.length;Xe+=1){var Ct=st[Xe],Wt=d.getTile(Ct);if(!le||Wt.patternsLoaded()){var Zt=Wt.getBucket(h);if(Zt){var Ht=Zt.programConfigurations.get(h.id),hr=f.context.program.get(),Nr=f.useProgram(ze,Ht),Dr=Pe||Nr.program!==hr,an=$.constantOr(null);if(an&&Wt.imageAtlas){var En=Wt.imageAtlas,Dn=En.patternPositions[an.to.toString()],On=En.patternPositions[an.from.toString()];Dn&&On&&Ht.setConstantPatternPositions(Dn,On)}var Li=le?dc(f,Wt,h,ye):U?vl(f,Wt,h,U,ye):ve?Hi(f,Wt,h,Zt.lineClipsArray.length):bu(f,Wt,h);if(le)Fe.activeTexture.set(Ye.TEXTURE0),Wt.imageAtlasTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),Ht.updatePaintBuffers(ye);else if(U&&(Dr||f.lineAtlas.dirty))Fe.activeTexture.set(Ye.TEXTURE0),f.lineAtlas.bind(Fe);else if(ve){var fn=Zt.gradients[h.id],Wn=fn.texture;if(h.gradientVersion!==fn.version){var ai=256;if(h.stepInterpolant){var Jn=d.getSource().maxzoom,$n=Ct.canonical.z===Jn?Math.ceil(1<<f.transform.maxZoom-Ct.canonical.z):1;ai=y.clamp(y.nextPowerOfTwo(Zt.maxLineLength/y.EXTENT*1024*$n),256,Fe.maxTextureSize)}fn.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:fn.gradient||void 0,clips:Zt.lineClipsArray}),fn.texture?fn.texture.update(fn.gradient):fn.texture=new y.Texture(Fe,fn.gradient,Ye.RGBA),fn.version=h.gradientVersion,Wn=fn.texture}Fe.activeTexture.set(Ye.TEXTURE0),Wn.bind(h.stepInterpolant?Ye.NEAREST:Ye.LINEAR,Ye.CLAMP_TO_EDGE)}Nr.draw(Fe,Ye.TRIANGLES,T,f.stencilModeForClipping(Ct),I,ot.disabled,Li,h.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,h.paint,f.transform.zoom,Ht,Zt.layoutVertexBuffer2),Pe=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),C=h.paint.get("fill-opacity");if(C.constantOr(1)!==0){var T=f.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),U=f.opaquePassEnabledForLayer()&&!I.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===U){var $=f.depthModeForSublayer(1,f.renderPass==="opaque"?be.ReadWrite:be.ReadOnly);$c(f,d,h,g,$,T,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var le=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,be.ReadOnly);$c(f,d,h,g,le,T,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var C=new be(f.context.gl.LEQUAL,be.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Au(f,d,h,g,C,Oe.disabled,Qe.disabled),Au(f,d,h,g,C,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var T=f.colorModeForRenderPass();Au(f,d,h,g,C,Oe.disabled,T)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,C=f.depthModeForSublayer(0,be.ReadOnly),T=f.colorModeForRenderPass(),I=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],U=I[0],$=0,le=I[1];$<le.length;$+=1){var ve=le[$],ye=d.getTile(ve);ye.needsHillshadePrepare&&f.renderPass==="offscreen"?oh(f,ye,h,C,Oe.disabled,T):f.renderPass==="translucent"&&ju(f,ye,h,C,U[ve.overscaledZ],T)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,C=w.gl,T=d.getSource(),I=f.useProgram("raster"),U=f.colorModeForRenderPass(),$=T instanceof yt?[{},g]:f.stencilConfigForOverlap(g),le=$[0],ve=$[1],ye=ve[ve.length-1].overscaledZ,ze=!f.options.moving,Fe=0,Ye=ve;Fe<Ye.length;Fe+=1){var Pe=Ye[Fe],Xe=f.depthModeForSublayer(Pe.overscaledZ-ye,h.paint.get("raster-opacity")===1?be.ReadWrite:be.ReadOnly,C.LESS),st=d.getTile(Pe),Ct=f.transform.calculatePosMatrix(Pe.toUnwrapped(),ze);st.registerFadeDuration(h.paint.get("raster-fade-duration"));var Wt=d.findLoadedParent(Pe,0),Zt=Gu(st,Wt,d,h,f.transform),Ht=void 0,hr=void 0,Nr=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;w.activeTexture.set(C.TEXTURE0),st.texture.bind(Nr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(C.TEXTURE1),Wt?(Wt.texture.bind(Nr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Ht=Math.pow(2,Wt.tileID.overscaledZ-st.tileID.overscaledZ),hr=[st.tileID.canonical.x*Ht%1,st.tileID.canonical.y*Ht%1]):st.texture.bind(Nr,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Dr=wf(Ct,hr||[0,0],Ht||1,Zt,h);T instanceof yt?I.draw(w,C.TRIANGLES,Xe,Oe.disabled,U,ot.disabled,Dr,h.id,T.boundsBuffer,f.quadTriangleIndexBuffer,T.boundsSegments):I.draw(w,C.TRIANGLES,Xe,le[Pe.overscaledZ],U,ot.disabled,Dr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var C=f.context,T=C.gl,I=f.transform,U=I.tileSize,$=h.paint.get("background-pattern");if(!f.isPatternMissing($)){var le=!$&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===le){var ve=Oe.disabled,ye=f.depthModeForSublayer(0,le==="opaque"?be.ReadWrite:be.ReadOnly),ze=f.colorModeForRenderPass(),Fe=f.useProgram($?"backgroundPattern":"background"),Ye=I.coveringTiles({tileSize:U});$&&(C.activeTexture.set(T.TEXTURE0),f.imageManager.bind(f.context));for(var Pe=h.getCrossfadeParameters(),Xe=0,st=Ye;Xe<st.length;Xe+=1){var Ct=st[Xe],Wt=f.transform.calculatePosMatrix(Ct.toUnwrapped()),Zt=$?wu(Wt,w,f,$,{tileID:Ct,tileSize:U},Pe):ml(Wt,w,g);Fe.draw(C,T.TRIANGLES,ye,ve,ze,ot.disabled,Zt,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)Vl(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var C=w.prerender;C&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),C.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Oe.disabled);var T=w.renderingMode==="3d"?new be(f.context.gl.LEQUAL,be.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,be.ReadOnly);g.setDepthMode(T),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},ta=function(f,d){this.context=new he(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=K.maxUnderzooming+K.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ss,this.gpuTimers={}};ta.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},ta.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,Fa.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,Fa.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,ut.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,Fa.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var C=new y.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(C);var T=new y.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(T),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var I=this.context.gl;this.stencilClearMode=new Oe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)},ta.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,be.disabled,this.stencilClearMode,Qe.disabled,ot.disabled,au(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ta.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(Qe.disabled),h.setDepthMode(be.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,T=d;C<T.length;C+=1){var I=T[C],U=this._tileClippingMaskIDs[I.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,be.disabled,new Oe({func:g.ALWAYS,mask:0},U,255,g.KEEP,g.KEEP,g.REPLACE),Qe.disabled,ot.disabled,au(I.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ta.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Oe({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},ta.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Oe({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},ta.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(U,$){return $.overscaledZ-U.overscaledZ}),w=g[g.length-1].overscaledZ,C=g[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var T={},I=0;I<C;I++)T[I+w]=new Oe({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=C,[T,g]}return[(d={},d[w]=Oe.disabled,d),g]},ta.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new Qe([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qe.unblended:Qe.alphaBlended},ta.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return be.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new be(h||this.context.gl.LEQUAL,d,[g,g])},ta.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ta.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var C in w){var T=w[C];T.used&&T.prepare(this.context)}var I,U,$={},le={},ve={};for(var ye in w){var ze=w[ye];$[ye]=ze.getVisibleCoordinates(),le[ye]=$[ye].slice().reverse(),ve[ye]=ze.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Fe=0;Fe<g.length;Fe++)if(this.style._layers[g[Fe]].is3D()){this.opaquePassCutoff=Fe;break}this.renderPass="offscreen";for(var Ye=0,Pe=g;Ye<Pe.length;Ye+=1){var Xe=this.style._layers[Pe[Ye]];if(Xe.hasOffscreenPass()&&!Xe.isHidden(this.transform.zoom)){var st=le[Xe.source];(Xe.type==="custom"||st.length)&&this.renderLayer(this,w[Xe.source],Xe,st)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Ct=this.style._layers[g[this.currentLayer]],Wt=w[Ct.source],Zt=$[Ct.source];this._renderTileClippingMasks(Ct,Zt),this.renderLayer(this,Wt,Ct,Zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var Ht=this.style._layers[g[this.currentLayer]],hr=w[Ht.source],Nr=(Ht.type==="symbol"?ve:le)[Ht.source];this._renderTileClippingMasks(Ht,$[Ht.source]),this.renderLayer(this,hr,Ht,Nr)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(Dr){Dr.source&&!Dr.isHidden(h.transform.zoom)&&(Dr.source!==(U&&U.id)&&(U=h.style.sourceCaches[Dr.source]),(!I||I.getSource().maxzoom<U.getSource().maxzoom)&&(I=U))}),I&&Gs.debug(this,I,I.getVisibleCoordinates())),this.options.showPadding&&function(Dr){var an=Dr.transform.padding;lh(Dr,Dr.transform.height-(an.top||0),3,Cf),lh(Dr,an.bottom||0,3,sh),Tf(Dr,an.left||0,3,_o),Tf(Dr,Dr.transform.width-(an.right||0),3,_c);var En=Dr.transform.centerPoint;(function(Dn,On,Li,fn){Ul(Dn,On-1,Li-10,2,20,fn),Ul(Dn,On-10,Li-1,20,2,fn)})(Dr,En.x,Dr.transform.height-En.y,uh)}(this),this.context.setDefault()},ta.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),Gs[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},ta.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},ta.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},ta.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},ta.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=C}return d},ta.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var C=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){var T=Math.sin(C),I=Math.cos(C);h=[h[0]*I-h[1]*T,h[0]*T+h[1]*I]}var U=[w?h[0]:Gi(d,h[0],this.transform.zoom),w?h[1]:Gi(d,h[1],this.transform.zoom),0],$=new Float32Array(16);return y.translate($,f,U),$},ta.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},ta.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},ta.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},ta.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new xf(this.context,f,Us[f],d,Ef[f],this._showOverdrawInspector)),this.cache[h]},ta.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ta.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},ta.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ta.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var jl=function(f,d){this.points=f,this.planes=d};jl.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return y.transformMat4([],T,f)}).map(function(T){return y.scale$1([],T,1/T[3]/d*g)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var I=y.sub([],w[T[0]],w[T[1]]),U=y.sub([],w[T[2]],w[T[1]]),$=y.normalize([],y.cross([],I,U)),le=-y.dot($,w[T[1]]);return $.concat(le)});return new jl(w,C)};var ou=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};ou.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new ou(h,g)},ou.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},ou.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},ou.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],C=0,T=0;T<d.length;T++)C+=y.dot$1(w,d[T])>=0;if(C===0)return 0;C!==d.length&&(h=!1)}if(h)return 2;for(var I=0;I<3;I++){for(var U=Number.MAX_VALUE,$=-Number.MAX_VALUE,le=0;le<f.points.length;le++){var ve=f.points[le][I]-this.min[I];U=Math.min(U,ve),$=Math.max($,ve)}if($<0||U>this.max[I]-this.min[I])return 0}return 1};var Hu=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};Hu.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},Hu.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},Hu.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},Hu.prototype.clone=function(){return new Hu(this.top,this.bottom,this.left,this.right)},Hu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var yi=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Hu,this._posMatrixCache={},this._alignedPosMatrixCache={}},sa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};yi.prototype.clone=function(){var f=new yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},sa.minZoom.get=function(){return this._minZoom},sa.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},sa.maxZoom.get=function(){return this._maxZoom},sa.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},sa.minPitch.get=function(){return this._minPitch},sa.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},sa.maxPitch.get=function(){return this._maxPitch},sa.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},sa.renderWorldCopies.get=function(){return this._renderWorldCopies},sa.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},sa.worldSize.get=function(){return this.tileSize*this.scale},sa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},sa.size.get=function(){return new y.Point(this.width,this.height)},sa.bearing.get=function(){return-this.angle/Math.PI*180},sa.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},sa.pitch.get=function(){return this._pitch/Math.PI*180},sa.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},sa.fov.get=function(){return this._fov/Math.PI*180},sa.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},sa.zoom.get=function(){return this._zoom},sa.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},sa.center.get=function(){return this._center},sa.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},sa.padding.get=function(){return this._edgeInsets.toJSON()},sa.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},sa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},yi.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},yi.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},yi.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},yi.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),C=this.pointCoordinate(new y.Point(0,this.height)),T=Math.floor(Math.min(h.x,g.x,w.x,C.x)),I=Math.floor(Math.max(h.x,g.x,w.x,C.x)),U=T-1;U<=I+1;U++)U!==0&&d.push(new y.UnwrappedTileID(U,f));return d},yi.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),C=[w*g.x,w*g.y,0],T=jl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),I=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(I=d);var U=function(Dr){return{aabb:new ou([Dr*w,0,0],[(Dr+1)*w,w,0]),zoom:0,x:0,y:0,wrap:Dr,fullyVisible:!1}},$=[],le=[],ve=d,ye=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var ze=1;ze<=3;ze++)$.push(U(-ze)),$.push(U(ze));for($.push(U(0));$.length>0;){var Fe=$.pop(),Ye=Fe.x,Pe=Fe.y,Xe=Fe.fullyVisible;if(!Xe){var st=Fe.aabb.intersects(T);if(st===0)continue;Xe=st===2}var Ct=Fe.aabb.distanceX(C),Wt=Fe.aabb.distanceY(C),Zt=Math.max(Math.abs(Ct),Math.abs(Wt));if(Fe.zoom===ve||Zt>3+(1<<ve-Fe.zoom)-2&&Fe.zoom>=I)le.push({tileID:new y.OverscaledTileID(Fe.zoom===ve?ye:Fe.zoom,Fe.wrap,Fe.zoom,Ye,Pe),distanceSq:y.sqrLen([C[0]-.5-Ye,C[1]-.5-Pe])});else for(var Ht=0;Ht<4;Ht++){var hr=(Ye<<1)+Ht%2,Nr=(Pe<<1)+(Ht>>1);$.push({aabb:Fe.aabb.quadrant(Ht),zoom:Fe.zoom+1,x:hr,y:Nr,wrap:Fe.wrap,fullyVisible:Xe})}}return le.sort(function(Dr,an){return Dr.distanceSq-an.distanceSq}).map(function(Dr){return Dr.tileID})},yi.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},sa.unmodified.get=function(){return this._unmodified},yi.prototype.zoomScale=function(f){return Math.pow(2,f)},yi.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},yi.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},yi.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},sa.point.get=function(){return this.project(this.center)},yi.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),C=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},yi.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},yi.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},yi.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},yi.prototype.coordinateLocation=function(f){return f.toLngLat()},yi.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],C=d[1]/g,T=h[1]/w,I=d[2]/g,U=h[2]/w,$=I===U?0:(0-I)/(U-I);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,$)/this.worldSize,y.number(C,T,$)/this.worldSize)},yi.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},yi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},yi.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},yi.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,C=this.worldSize/this.zoomScale(w.z),T=w.x+Math.pow(2,w.z)*f.wrap,I=y.identity(new Float64Array(16));return y.translate(I,I,[T*C,w.y*C,0]),y.scale(I,I,[C/y.EXTENT,C/y.EXTENT,1]),y.multiply(I,d?this.alignedProjMatrix:this.projMatrix,I),g[h]=new Float32Array(I),g[h]},yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,C=90,T=-180,I=180,U=this.size,$=this._unmodified;if(this.latRange){var le=this.latRange;w=y.mercatorYfromLat(le[1])*this.worldSize,f=(C=y.mercatorYfromLat(le[0])*this.worldSize)-w<U.y?U.y/(C-w):0}if(this.lngRange){var ve=this.lngRange;T=y.mercatorXfromLng(ve[0])*this.worldSize,d=(I=y.mercatorXfromLng(ve[1])*this.worldSize)-T<U.x?U.x/(I-T):0}var ye=this.point,ze=Math.max(d||0,f||0);if(ze)return this.center=this.unproject(new y.Point(d?(I+T)/2:ye.x,f?(C+w)/2:ye.y)),this.zoom+=this.scaleZoom(ze),this._unmodified=$,void(this._constraining=!1);if(this.latRange){var Fe=ye.y,Ye=U.y/2;Fe-Ye<w&&(g=w+Ye),Fe+Ye>C&&(g=C-Ye)}if(this.lngRange){var Pe=ye.x,Xe=U.x/2;Pe-Xe<T&&(h=T+Xe),Pe+Xe>I&&(h=I-Xe)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:ye.x,g!==void 0?g:ye.y))),this._unmodified=$,this._constraining=!1}},yi.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,C=w.x,T=w.y,I=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),U=this.height/50,$=new Float64Array(16);y.perspective($,this._fov,this.width/this.height,U,I),$[8]=2*-f.x/this.width,$[9]=2*f.y/this.height,y.scale($,$,[1,-1,1]),y.translate($,$,[0,0,-this.cameraToCenterDistance]),y.rotateX($,$,this._pitch),y.rotateZ($,$,this.angle),y.translate($,$,[-C,-T,0]),this.mercatorMatrix=y.scale([],$,[this.worldSize,this.worldSize,this.worldSize]),y.scale($,$,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=$,this.invProjMatrix=y.invert([],this.projMatrix);var le=this.width%2/2,ve=this.height%2/2,ye=Math.cos(this.angle),ze=Math.sin(this.angle),Fe=C-Math.round(C)+ye*le+ze*ve,Ye=T-Math.round(T)+ye*ve+ze*le,Pe=new Float64Array($);if(y.translate(Pe,Pe,[Fe>.5?Fe-1:Fe,Ye>.5?Ye-1:Ye,0]),this.alignedProjMatrix=Pe,$=y.create(),y.scale($,$,[this.width/2,-this.height/2,1]),y.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=y.create(),y.scale($,$,[1,-1,1]),y.translate($,$,[-1,-1,0]),y.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!($=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=$,this._posMatrixCache={},this._alignedPosMatrixCache={}}},yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},yi.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},yi.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,C=d.y,T=0,I=f;T<I.length;T+=1){var U=I[T];h=Math.min(h,U.x),g=Math.min(g,U.y),w=Math.max(w,U.x),C=Math.max(C,U.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,C),new y.Point(h,C),new y.Point(h,g)]},Object.defineProperties(yi.prototype,sa);var ms=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};ms.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ms.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ms.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),C=Math.round(d.lng*w)/w,T=Math.round(d.lat*w)/w,I=this._map.getBearing(),U=this._map.getPitch(),$="";if($+=f?"/"+C+"/"+T+"/"+h:h+"/"+T+"/"+C,(I||U)&&($+="/"+Math.round(10*I)/10),U&&($+="/"+Math.round(U)),this._hashName){var le=this._hashName,ve=!1,ye=y.window.location.hash.slice(1).split("&").map(function(ze){var Fe=ze.split("=")[0];return Fe===le?(ve=!0,Fe+"="+$):ze}).filter(function(ze){return ze});return ve||ye.push(le+"="+$),"#"+ye.join("&")}return"#"+$},ms.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},ms.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},ms.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var Xc={linearity:.3,easing:y.bezier(0,0,.3,1)},us=y.extend({deceleration:2500,maxSpeed:1400},Xc),xc=y.extend({deceleration:20,maxSpeed:1400},Xc),Wh=y.extend({deceleration:1e3,maxSpeed:360},Xc),Tp=y.extend({deceleration:1e3,maxSpeed:90},Xc),bc=function(f){this._map=f,this.clear()};function Cu(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function Wu(f,d,h){var g=h.maxSpeed,w=h.linearity,C=h.deceleration,T=y.clamp(f*w/(d/1e3),-g,g),I=Math.abs(T)/(C*w);return{easing:h.easing,duration:1e3*I,amount:T*(I/2)}}bc.prototype.clear=function(){this._inertiaBuffer=[]},bc.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},bc.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},bc.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(d.pan.mag()){var I=Wu(d.pan.mag(),C,y.extend({},us,f||{}));T.offset=d.pan.mult(I.amount/d.pan.mag()),T.center=this._map.transform.center,Cu(T,I)}if(d.zoom){var U=Wu(d.zoom,C,xc);T.zoom=this._map.transform.zoom+U.amount,Cu(T,U)}if(d.bearing){var $=Wu(d.bearing,C,Wh);T.bearing=this._map.transform.bearing+y.clamp($.amount,-179,179),Cu(T,$)}if(d.pitch){var le=Wu(d.pitch,C,Tp);T.pitch=this._map.transform.pitch+le.amount,Cu(T,le)}if(T.zoom||T.bearing){var ve=d.pinchAround===void 0?d.around:d.pinchAround;T.around=ve?this._map.unproject(ve):this._map.getCenter()}return this.clear(),y.extend(T,{noMoveStart:!0})}};var Na=function(f){function d(g,w,C,T){T===void 0&&(T={});var I=V.mousePos(w.getCanvasContainer(),C),U=w.unproject(I);f.call(this,g,y.extend({point:I,lngLat:U,originalEvent:C},T)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),xo=function(f){function d(g,w,C){var T=g==="touchend"?C.changedTouches:C.touches,I=V.touchPos(w.getCanvasContainer(),T),U=I.map(function(ve){return w.unproject(ve)}),$=I.reduce(function(ve,ye,ze,Fe){return ve.add(ye.div(Fe.length))},new y.Point(0,0)),le=w.unproject($);f.call(this,g,{points:I,point:$,lngLats:U,lngLat:le,originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),yl=function(f){function d(g,w,C){f.call(this,g,{originalEvent:C}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Aa=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};Aa.prototype.reset=function(){delete this._mousedownPos},Aa.prototype.wheel=function(f){return this._firePreventable(new yl(f.type,this._map,f))},Aa.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Na(f.type,this._map,f))},Aa.prototype.mouseup=function(f){this._map.fire(new Na(f.type,this._map,f))},Aa.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Na(f.type,this._map,f))},Aa.prototype.dblclick=function(f){return this._firePreventable(new Na(f.type,this._map,f))},Aa.prototype.mouseover=function(f){this._map.fire(new Na(f.type,this._map,f))},Aa.prototype.mouseout=function(f){this._map.fire(new Na(f.type,this._map,f))},Aa.prototype.touchstart=function(f){return this._firePreventable(new xo(f.type,this._map,f))},Aa.prototype.touchmove=function(f){this._map.fire(new xo(f.type,this._map,f))},Aa.prototype.touchend=function(f){this._map.fire(new xo(f.type,this._map,f))},Aa.prototype.touchcancel=function(f){this._map.fire(new xo(f.type,this._map,f))},Aa.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},Aa.prototype.isEnabled=function(){return!0},Aa.prototype.isActive=function(){return!1},Aa.prototype.enable=function(){},Aa.prototype.disable=function(){};var dn=function(f){this._map=f};dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},dn.prototype.mousemove=function(f){this._map.fire(new Na(f.type,this._map,f))},dn.prototype.mousedown=function(){this._delayContextMenu=!0},dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Na("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},dn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Na(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},dn.prototype.isEnabled=function(){return!0},dn.prototype.isActive=function(){return!1},dn.prototype.enable=function(){},dn.prototype.disable=function(){};var ls=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function Sc(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}ls.prototype.isEnabled=function(){return!!this._enabled},ls.prototype.isActive=function(){return!!this._active},ls.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ls.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ls.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(V.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ls.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),C=Math.max(g.x,h.x),T=Math.min(g.y,h.y),I=Math.max(g.y,h.y);V.setTransform(this._box,"translate("+w+"px,"+T+"px)"),this._box.style.width=C-w+"px",this._box.style.height=I-T+"px"}}},ls.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),V.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(C){return C.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},ls.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},ls.prototype.blur=function(){this.reset()},ls.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos},ls.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var $u=function(f){this.reset(),this.numTouches=f.numTouches};$u.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},$u.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),C=0,T=g;C<T.length;C+=1)w._add(T[C]);return w.div(g.length)}(d),this.touches=Sc(h,d)))},$u.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=Sc(h,d);for(var w in this.touches){var C=g[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}},$u.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var Is=function(f){this.singleTap=new $u(f),this.numTaps=f.numTaps,this.reset()};Is.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Is.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},Is.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},Is.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(w&&C||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var cs=function(){this._zoomIn=new Is({numTouches:1,numTaps:2}),this._zoomOut=new Is({numTouches:2,numTaps:1}),this.reset()};cs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},cs.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},cs.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},cs.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),C=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(w)},{originalEvent:f})}}):C?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:f})}}):void 0},cs.prototype.touchcancel=function(){this.reset()},cs.prototype.enable=function(){this._enabled=!0},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active};var _l={0:1,2:2},Rr=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};Rr.prototype.blur=function(){this.reset()},Rr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Rr.prototype._correctButton=function(f,d){return!1},Rr.prototype._move=function(f,d){return{}},Rr.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=V.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},Rr.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var C=_l[w];return g.buttons===void 0||(g.buttons&C)!==C}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},Rr.prototype.mouseupWindow=function(f){this._lastPoint&&V.mouseButton(f)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())},Rr.prototype.enable=function(){this._enabled=!0},Rr.prototype.disable=function(){this._enabled=!1,this.reset()},Rr.prototype.isEnabled=function(){return this._enabled},Rr.prototype.isActive=function(){return this._active};var Yc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(Rr),Gl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Rr),Xu=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(Rr),gs=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};gs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},gs.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},gs.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},gs.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},gs.prototype.touchcancel=function(){this.reset()},gs.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=Sc(h,d),w=new y.Point(0,0),C=new y.Point(0,0),T=0;for(var I in g){var U=g[I],$=this._touches[I];$&&(w._add(U),C._add(U.sub($)),T++,g[I]=U)}if(this._touches=g,!(T<this._minTouches)&&C.mag()){var le=C.div(T);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:w.div(T),panDelta:le}}},gs.prototype.enable=function(){this._enabled=!0},gs.prototype.disable=function(){this._enabled=!1,this.reset()},gs.prototype.isEnabled=function(){return this._enabled},gs.prototype.isActive=function(){return this._active};var qo=function(){this.reset()};function qc(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function Kc(f,d){return Math.log(f/d)/Math.LN2}qo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},qo.prototype._start=function(f){},qo.prototype._move=function(f,d,h){return{}},qo.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},qo.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],C=qc(h,d,g[0]),T=qc(h,d,w);if(C&&T){var I=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],I,f)}}},qo.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],C=qc(h,d,g[0]),T=qc(h,d,w);C&&T||(this._active&&V.suppressClick(),this.reset())}},qo.prototype.touchcancel=function(){this.reset()},qo.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},qo.prototype.disable=function(){this._enabled=!1,this.reset()},qo.prototype.isEnabled=function(){return this._enabled},qo.prototype.isActive=function(){return this._active};var Ko=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,w),pinchAround:g}},d}(qo);function Tu(f,d){return 180*f.angleWith(d)/Math.PI}var Jc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tu(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=Tu(h,this._startVector);return Math.abs(w)<g},d}(qo);function Yu(f){return Math.abs(f.y)>Math.abs(f.x)}var wc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Yu(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var C=h[0].sub(this._lastPoints[0]),T=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,T,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var C=h.mag()>=2,T=g.mag()>=2;if(C||T){if(!C||!T)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var I=h.y>0==g.y>0;return Yu(h)&&Yu(g)&&I}},d}(qo),Qc={panStep:100,bearingStep:15,pitchStep:10},Pt=function(){var f=Qc;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function Ie(f){return f*(2-f)}Pt.prototype.blur=function(){this.reset()},Pt.prototype.reset=function(){this._active=!1},Pt.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,C=0,T=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),C=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),C=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),T=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(I){var U=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Ie,zoom:h?Math.round(U)+h*(f.shiftKey?2:1):U,bearing:I.getBearing()+g*d._bearingStep,pitch:I.getPitch()+w*d._pitchStep,offset:[-C*d._panStep,-T*d._panStep],center:I.getCenter()},{originalEvent:f})}}}},Pt.prototype.enable=function(){this._enabled=!0},Pt.prototype.disable=function(){this._enabled=!1,this.reset()},Pt.prototype.isEnabled=function(){return this._enabled},Pt.prototype.isActive=function(){return this._active},Pt.prototype.disableRotation=function(){this._rotationDisabled=!0},Pt.prototype.enableRotation=function(){this._rotationDisabled=!1};var F=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};F.prototype.setZoomRate=function(f){this._defaultZoomRate=f},F.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},F.prototype.isEnabled=function(){return!!this._enabled},F.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},F.prototype.isZooming=function(){return!!this._zooming},F.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},F.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},F.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},F.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},F.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=V.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},F.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,T=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,I=this._startZoom,U=this._easing,$=!1;if(this._type==="wheel"&&I&&U){var le=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),ve=U(le);C=y.number(I,T,ve),le<1?this._frameId||(this._frameId=!0):$=!0}else C=T,$=!0;return this._active=!0,$&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!$,zoomDelta:C-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},F.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),C=.27/Math.sqrt(w*w+1e-4)*.01,T=Math.sqrt(.0729-C*C);d=y.bezier(C,T,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},F.prototype.blur=function(){this.reset()},F.prototype.reset=function(){this._active=!1};var su=function(f,d){this._clickZoom=f,this._tapZoom=d};su.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},su.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},su.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},su.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pe=function(){this.reset()};pe.prototype.reset=function(){this._active=!1},pe.prototype.blur=function(){this.reset()},pe.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},pe.prototype.enable=function(){this._enabled=!0},pe.prototype.disable=function(){this._enabled=!1,this.reset()},pe.prototype.isEnabled=function(){return this._enabled},pe.prototype.isActive=function(){return this._active};var qa=function(){this._tap=new Is({numTouches:1,numTaps:1}),this.reset()};qa.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},qa.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},qa.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},qa.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},qa.prototype.touchcancel=function(){this.reset()},qa.prototype.enable=function(){this._enabled=!0},qa.prototype.disable=function(){this._enabled=!1,this.reset()},qa.prototype.isEnabled=function(){return this._enabled},qa.prototype.isActive=function(){return this._active};var Ca=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};Ca.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ca.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ca.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ca.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Hs=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};Hs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Hs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Hs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Hs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Jo=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Jo.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Jo.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Jo.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Jo.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Jo.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Jo.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var da=function(f){return f.zoom||f.drag||f.pitch||f.rotate},xl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function In(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var mn=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bc(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var C=w[g],T=C[0];V.addEventListener(T,C[1],T===y.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};mn.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];V.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},mn.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new Aa(d,f));var g=d.boxZoom=new ls(d,f);this._add("boxZoom",g);var w=new cs,C=new pe;d.doubleClickZoom=new su(C,w),this._add("tapZoom",w),this._add("clickZoom",C);var T=new qa;this._add("tapDragZoom",T);var I=d.touchPitch=new wc;this._add("touchPitch",I);var U=new Gl(f),$=new Xu(f);d.dragRotate=new Hs(f,U,$),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);var le=new Yc(f),ve=new gs(f);d.dragPan=new Ca(h,le,ve),this._add("mousePan",le),this._add("touchPan",ve,["touchZoom","touchRotate"]);var ye=new Jc,ze=new Ko;d.touchZoomRotate=new Jo(h,ze,ye,T),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]);var Fe=d.scrollZoom=new F(d,this);this._add("scrollZoom",Fe,["mousePan"]);var Ye=d.keyboard=new Pt;this._add("keyboard",Ye),this._add("blockableMapEvent",new dn(d));for(var Pe=0,Xe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Pe<Xe.length;Pe+=1){var st=Xe[Pe];f.interactive&&f[st]&&d[st].enable(f[st])}},mn.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},mn.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},mn.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},mn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},mn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},mn.prototype.isMoving=function(){return Boolean(da(this._eventsInProgress))||this.isZooming()},mn.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},mn.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},mn.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},mn.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},C={},T=f.touches?this._getMapTouches(f.touches):void 0,I=T?V.touchPos(this._el,T):V.mousePos(this._el,f),U=0,$=this._handlers;U<$.length;U+=1){var le=$[U],ve=le.handlerName,ye=le.handler,ze=le.allowed;if(ye.isEnabled()){var Fe=void 0;this._blockedByActive(C,ze,ve)?ye.reset():ye[d||f.type]&&(Fe=ye[d||f.type](f,I,T),this.mergeHandlerResult(g,w,Fe,ve,h),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||ye.isActive())&&(C[ve]=ye)}}var Ye={};for(var Pe in this._previousActiveHandlers)C[Pe]||(Ye[Pe]=h);this._previousActiveHandlers=C,(Object.keys(Ye).length||In(g))&&(this._changes.push([g,w,Ye]),this._triggerRenderFrame()),(Object.keys(C).length||In(g))&&this._map._stop(!0),this._updatingCamera=!1;var Xe=g.cameraAnimation;Xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Xe(this._map))},mn.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var C={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=C),h.panDelta!==void 0&&(d.drag=C),h.pitchDelta!==void 0&&(d.pitch=C),h.bearingDelta!==void 0&&(d.rotate=C)}},mn.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var C=w[g],T=C[0],I=C[1],U=C[2];T.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(f.around=T.around),T.pinchAround!==void 0&&(f.pinchAround=T.pinchAround),T.noInertia&&(f.noInertia=T.noInertia),y.extend(d,I),y.extend(h,U)}this._updateMapTransform(f,d,h),this._changes=[]},mn.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!In(f))return this._fireEvents(d,h,!0);var C=f.panDelta,T=f.zoomDelta,I=f.bearingDelta,U=f.pitchDelta,$=f.around,le=f.pinchAround;le!==void 0&&($=le),g._stop(!0),$=$||g.transform.centerPoint;var ve=w.pointLocation(C?$.sub(C):$);I&&(w.bearing+=I),U&&(w.pitch+=U),T&&(w.zoom+=T),w.setLocationAtPoint(ve,$),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},mn.prototype._fireEvents=function(f,d,h){var g=this,w=da(this._eventsInProgress),C=da(f),T={};for(var I in f)this._eventsInProgress[I]||(T[I+"start"]=f[I].originalEvent),this._eventsInProgress[I]=f[I];for(var U in!w&&C&&this._fireEvent("movestart",C.originalEvent),T)this._fireEvent(U,T[U]);for(var $ in C&&this._fireEvent("move",C.originalEvent),f)this._fireEvent($,f[$].originalEvent);var le,ve={};for(var ye in this._eventsInProgress){var ze=this._eventsInProgress[ye],Fe=ze.handlerName,Ye=ze.originalEvent;this._handlersById[Fe].isActive()||(delete this._eventsInProgress[ye],ve[ye+"end"]=le=d[Fe]||Ye)}for(var Pe in ve)this._fireEvent(Pe,ve[Pe]);var Xe=da(this._eventsInProgress);if(h&&(w||C)&&!Xe){this._updatingCamera=!0;var st=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ct=function(Wt){return Wt!==0&&-g._bearingSnap<Wt&&Wt<g._bearingSnap};st?(Ct(st.bearing||this._map.getBearing())&&(st.bearing=0),this._map.easeTo(st,{originalEvent:le})):(this._map.fire(new y.Event("moveend",{originalEvent:le})),Ct(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},mn.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},mn.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new xl("renderFrame",{timeStamp:d})),f._applyChanges()})},mn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ec=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,C){var T={top:0,bottom:0,right:0,left:0};if(typeof(C=y.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var I=C.padding;C.padding={top:I,bottom:I,right:I,left:I}}C.padding=y.extend(T,C.padding);var U=this.transform,$=U.padding,le=U.project(y.LngLat.convert(h)),ve=U.project(y.LngLat.convert(g)),ye=le.rotate(-w*Math.PI/180),ze=ve.rotate(-w*Math.PI/180),Fe=new y.Point(Math.max(ye.x,ze.x),Math.max(ye.y,ze.y)),Ye=new y.Point(Math.min(ye.x,ze.x),Math.min(ye.y,ze.y)),Pe=Fe.sub(Ye),Xe=(U.width-($.left+$.right+C.padding.left+C.padding.right))/Pe.x,st=(U.height-($.top+$.bottom+C.padding.top+C.padding.bottom))/Pe.y;if(!(st<0||Xe<0)){var Ct=Math.min(U.scaleZoom(U.scale*Math.min(Xe,st)),C.maxZoom),Wt=typeof C.offset.x=="number"?new y.Point(C.offset.x,C.offset.y):y.Point.convert(C.offset),Zt=new y.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(w*Math.PI/180),Ht=Wt.add(Zt).mult(U.scale/U.zoomScale(Ct));return{center:U.unproject(le.add(ve).div(2).sub(Ht)),zoom:Ct,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,C,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,C),C,T)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,C=!1,T=!1,I=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(C=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(T=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(I=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),C&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),T&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),I&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var C=this.transform,T=this.getZoom(),I=this.getBearing(),U=this.getPitch(),$=this.getPadding(),le="zoom"in h?+h.zoom:T,ve="bearing"in h?this._normalizeBearing(h.bearing,I):I,ye="pitch"in h?+h.pitch:U,ze="padding"in h?h.padding:C.padding,Fe=y.Point.convert(h.offset),Ye=C.centerPoint.add(Fe),Pe=C.pointLocation(Ye),Xe=y.LngLat.convert(h.center||Pe);this._normalizeCenter(Xe);var st,Ct,Wt=C.project(Pe),Zt=C.project(Xe).sub(Wt),Ht=C.zoomScale(le-T);h.around&&(st=y.LngLat.convert(h.around),Ct=C.locationPoint(st));var hr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==T,this._rotating=this._rotating||I!==ve,this._pitching=this._pitching||ye!==U,this._padding=!C.isPaddingEqual(ze),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,hr),this._ease(function(Nr){if(w._zooming&&(C.zoom=y.number(T,le,Nr)),w._rotating&&(C.bearing=y.number(I,ve,Nr)),w._pitching&&(C.pitch=y.number(U,ye,Nr)),w._padding&&(C.interpolatePadding($,ze,Nr),Ye=C.centerPoint.add(Fe)),st)C.setLocationAtPoint(st,Ct);else{var Dr=C.zoomScale(C.zoom-T),an=le>T?Math.min(2,Ht):Math.max(.5,Ht),En=Math.pow(an,1-Nr),Dn=C.unproject(Wt.add(Zt.mult(Nr*En)).mult(Dr));C.setLocationAtPoint(C.renderWorldCopies?Dn.wrap():Dn,Ye)}w._fireMoveEvents(g)},function(Nr){w._afterEase(g,Nr)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,C=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),C&&this.fire(new y.Event("rotateend",h)),T&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var C=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var T=this.transform,I=this.getZoom(),U=this.getBearing(),$=this.getPitch(),le=this.getPadding(),ve="zoom"in h?y.clamp(+h.zoom,T.minZoom,T.maxZoom):I,ye="bearing"in h?this._normalizeBearing(h.bearing,U):U,ze="pitch"in h?+h.pitch:$,Fe="padding"in h?h.padding:T.padding,Ye=T.zoomScale(ve-I),Pe=y.Point.convert(h.offset),Xe=T.centerPoint.add(Pe),st=T.pointLocation(Xe),Ct=y.LngLat.convert(h.center||st);this._normalizeCenter(Ct);var Wt=T.project(st),Zt=T.project(Ct).sub(Wt),Ht=h.curve,hr=Math.max(T.width,T.height),Nr=hr/Ye,Dr=Zt.mag();if("minZoom"in h){var an=y.clamp(Math.min(h.minZoom,I,ve),T.minZoom,T.maxZoom),En=hr/T.zoomScale(an-I);Ht=Math.sqrt(En/Dr*2)}var Dn=Ht*Ht;function On(Xn){var jn=(Nr*Nr-hr*hr+(Xn?-1:1)*Dn*Dn*Dr*Dr)/(2*(Xn?Nr:hr)*Dn*Dr);return Math.log(Math.sqrt(jn*jn+1)-jn)}function Li(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function fn(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}var Wn=On(0),ai=function(Xn){return fn(Wn)/fn(Wn+Ht*Xn)},Jn=function(Xn){return hr*((fn(Wn)*(Li(jn=Wn+Ht*Xn)/fn(jn))-Li(Wn))/Dn)/Dr;var jn},$n=(On(1)-Wn)/Ht;if(Math.abs(Dr)<1e-6||!isFinite($n)){if(Math.abs(hr-Nr)<1e-6)return this.easeTo(h,g);var ci=Nr<hr?-1:1;$n=Math.abs(Math.log(Nr/hr))/Ht,Jn=function(){return 0},ai=function(Xn){return Math.exp(ci*Ht*Xn)}}return h.duration="duration"in h?+h.duration:1e3*$n/("screenSpeed"in h?+h.screenSpeed/Ht:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=U!==ye,this._pitching=ze!==$,this._padding=!T.isPaddingEqual(Fe),this._prepareEase(g,!1),this._ease(function(Xn){var jn=Xn*$n,Ja=1/ai(jn);T.zoom=Xn===1?ve:I+T.scaleZoom(Ja),w._rotating&&(T.bearing=y.number(U,ye,Xn)),w._pitching&&(T.pitch=y.number($,ze,Xn)),w._padding&&(T.interpolatePadding(le,Fe,Xn),Xe=T.centerPoint.add(Pe));var va=Xn===1?Ct:T.unproject(Wt.add(Zt.mult(Jn(jn))).mult(Ja));T.setLocationAtPoint(T.renderWorldCopies?va.wrap():va,Xe),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var C=this.handlers;C&&C.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),Lo=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Lo.prototype.getDefaultPosition=function(){return"bottom-right"},Lo.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Lo.prototype.onRemove=function(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Lo.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},Lo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Lo.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,C){return w.value&&(g+=w.key+"="+w.value+(C<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},Lo.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Lo.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(I){return typeof I!="string"?"":I})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var C=w.getSource();C.attribution&&f.indexOf(C.attribution)<0&&f.push(C.attribution)}}f.sort(function(I,U){return I.length-U.length});var T=(f=f.filter(function(I,U){for(var $=U+1;$<f.length;$++)if(f[$].indexOf(I)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,f.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Lo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ka=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};Ka.prototype.onAdd=function(f){this._map=f,this._container=V.create("div","mapboxgl-ctrl");var d=V.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ka.prototype.onRemove=function(){V.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ka.prototype.getDefaultPosition=function(){return"bottom-left"},Ka.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ka.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},Ka.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var uo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};uo.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},uo.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},uo.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},uo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ps={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Qo=y.window.HTMLImageElement,Ac=y.window.HTMLElement,ki=y.window.ImageBitmap,Ha={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Mf=function(f){function d(g){var w=this;if((g=y.extend({},Ha,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new yi(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,C,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new uo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Ps,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Ac))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new mn(this,g),this._hash=g.hash&&new ms(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Lo({customAttribution:g.customAttribution})),this.addControl(new Ka,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(T){w._update(T.dataType==="style"),w.fire(new y.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){w.fire(new y.Event(T.dataType+"dataloading",T))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=g.onAdd(this);this._controls.push(g);var T=this._controlPositions[w];return w.indexOf("bottom")!==-1?T.insertBefore(C,T.firstChild):T.appendChild(C),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),C=w[0],T=w[1];if(C===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(C,T),this.transform.resize(C,T),this.painter.resize(C,T);var I=!this._moving;return I&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),I&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,C){var T,I=this;if(g==="mouseenter"||g==="mouseover"){var U=!1;return{layer:w,listener:C,delegates:{mousemove:function(le){var ve=I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[];ve.length?U||(U=!0,C.call(I,new Na(g,I,le.originalEvent,{features:ve}))):U=!1},mouseout:function(){U=!1}}}}if(g==="mouseleave"||g==="mouseout"){var $=!1;return{layer:w,listener:C,delegates:{mousemove:function(le){(I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[]).length?$=!0:$&&($=!1,C.call(I,new Na(g,I,le.originalEvent)))},mouseout:function(le){$&&($=!1,C.call(I,new Na(g,I,le.originalEvent)))}}}}return{layer:w,listener:C,delegates:(T={},T[g]=function(le){var ve=I.getLayer(w)?I.queryRenderedFeatures(le.point,{layers:[w]}):[];ve.length&&(le.features=ve,C.call(I,le),delete le.features)},T)}},d.prototype.on=function(g,w,C){if(C===void 0)return f.prototype.on.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var I in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(T),T.delegates)this.on(I,T.delegates[I]);return this},d.prototype.once=function(g,w,C){if(C===void 0)return f.prototype.once.call(this,g,w);var T=this._createDelegatedListener(g,w,C);for(var I in T.delegates)this.once(I,T.delegates[I]);return this},d.prototype.off=function(g,w,C){var T=this;return C===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(I){for(var U=I[g],$=0;$<U.length;$++){var le=U[$];if(le.layer===w&&le.listener===C){for(var ve in le.delegates)T.off(ve,le.delegates[ve]);return U.splice($,1),T}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var C;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")C=[y.Point.convert(g)];else{var T=y.Point.convert(g[0]),I=y.Point.convert(g[1]);C=[T,new y.Point(I.x,T.y),I,new y.Point(T.x,I.y),T]}return this.style.queryRenderedFeatures(C,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Xo(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var C=this;if(typeof g=="string"){var T=this._requestManager.normalizeStyleURL(g),I=this._requestManager.transformRequest(T,y.ResourceType.Style);y.getJSON(I,function(U,$){U?C.fire(new y.ErrorEvent(U)):$&&C._updateDiff($,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(C){y.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var C=g[w]._tiles;for(var T in C){var I=C[T];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,C)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,C){C===void 0&&(C={});var T=C.pixelRatio;T===void 0&&(T=1);var I=C.sdf;I===void 0&&(I=!1);var U=C.stretchX,$=C.stretchY,le=C.content;if(this._lazyInitEmptyStyle(),w instanceof Qo||ki&&w instanceof ki){var ve=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:ve.width,height:ve.height},ve.data),pixelRatio:T,stretchX:U,stretchY:$,content:le,sdf:I,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ye=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:T,stretchX:U,stretchY:$,content:le,sdf:I,version:0,userImage:ye}),ye.onAdd&&ye.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var C=this.style.getImage(g);if(!C)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=w instanceof Qo||ki&&w instanceof ki?y.browser.getImageData(w):w,I=T.width,U=T.height,$=T.data;return I===void 0||U===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):I!==C.data.width||U!==C.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace($,!(w instanceof Qo||ki&&w instanceof ki)),void this.style.updateImage(g,C))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,C){return this.style.setLayerZoomRange(g,w,C),this._update(!0)},d.prototype.setFilter=function(g,w,C){return C===void 0&&(C={}),this.style.setFilter(g,w,C),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setPaintProperty(g,w,C,T),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,C,T){return T===void 0&&(T={}),this.style.setLayoutProperty(g,w,C,T),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=V.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var T=this._controlContainer=V.create("div","mapboxgl-control-container",g),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){I[U]=V.create("div","mapboxgl-ctrl-"+U,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var C=y.browser.devicePixelRatio||1;this._canvas.width=C*g,this._canvas.height=C*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},oe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new ta(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,C=this,T=0,I=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=I.createQueryEXT(),I.beginQueryEXT(I.TIME_ELAPSED_EXT,w),T=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var $=this.transform.zoom,le=y.browser.now();this.style.zoomHistory.update($,le);var ve=new y.EvaluationParameters($,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ye=ve.crossFadingFactor();ye===1&&ye===this._crossFadingFactor||(U=!0,this._crossFadingFactor=ye),this.style.update(ve)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ze=y.browser.now()-T;I.endQueryEXT(I.TIME_ELAPSED_EXT,w),setTimeout(function(){var Pe=I.getQueryObjectEXT(w,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(w),C.fire(new y.Event("gpu-timing-frame",{cpuTime:ze,gpuTime:Pe}))},50)}if(this.listens("gpu-timing-layer")){var Fe=this.painter.collectGpuTimers();setTimeout(function(){var Pe=C.painter.queryGpuTimers(Fe);C.fire(new y.Event("gpu-timing-layer",{layerTimes:Pe}))},50)}var Ye=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ye||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||Ye||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),qu(this._canvasContainer),qu(this._controlContainer),qu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(Ec);function qu(f){f.parentNode&&f.parentNode.removeChild(f)}var ef={showCompass:!0,showZoom:!0,visualizePitch:!1},Ls=function(f){var d=this;this.options=y.extend({},ef,f),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ls.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},Ls.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},Ls.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zo(this._map,this._compass,this.options.visualizePitch)),this._container},Ls.prototype.onRemove=function(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ls.prototype._createButton=function(f,d){var h=V.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},Ls.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Zo=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new Gl({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new Xu({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),V.addEventListener(d,"mousedown",this.mousedown),V.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(d,"touchmove",this.touchmove),V.addEventListener(d,"touchend",this.touchend),V.addEventListener(d,"touchcancel",this.reset)};function bl(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),C=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<C?f=g:h.locationPoint(w).distSqr(d)<C&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var T=h.locationPoint(f);if(T.x>=0&&T.y>=0&&T.x<=h.width&&T.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Zo.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),V.disableDrag()},Zo.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Zo.prototype.off=function(){var f=this.element;V.removeEventListener(f,"mousedown",this.mousedown),V.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(f,"touchmove",this.touchmove),V.removeEventListener(f,"touchend",this.touchend),V.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Zo.prototype.offTemp=function(){V.enableDrag(),V.removeEventListener(y.window,"mousemove",this.mousemove),V.removeEventListener(y.window,"mouseup",this.mouseup)},Zo.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),V.mousePos(this.element,f)),V.addEventListener(y.window,"mousemove",this.mousemove),V.addEventListener(y.window,"mouseup",this.mouseup)},Zo.prototype.mousemove=function(f){this.move(f,V.mousePos(this.element,f))},Zo.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Zo.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Zo.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Zo.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Zo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var uu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function tf(f,d,h){var g=f.classList;for(var w in uu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Hl,Cc=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");var w=V.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var C=V.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var T=V.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var I=V.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");for(var U=0,$=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<$.length;U+=1){var le=$[U],ve=V.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",le.rx),ve.setAttributeNS(null,"ry",le.ry),I.appendChild(ve)}var ye=V.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"fill",this._color);var ze=V.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ye.appendChild(ze);var Fe=V.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"fill","#000000");var Ye=V.createNS("http://www.w3.org/2000/svg","path");Ye.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Fe.appendChild(Ye);var Pe=V.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Pe.setAttributeNS(null,"fill","#FFFFFF");var Xe=V.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var st=V.createNS("http://www.w3.org/2000/svg","circle");st.setAttributeNS(null,"fill","#000000"),st.setAttributeNS(null,"opacity","0.25"),st.setAttributeNS(null,"cx","5.5"),st.setAttributeNS(null,"cy","5.5"),st.setAttributeNS(null,"r","5.4999962");var Ct=V.createNS("http://www.w3.org/2000/svg","circle");Ct.setAttributeNS(null,"fill","#FFFFFF"),Ct.setAttributeNS(null,"cx","5.5"),Ct.setAttributeNS(null,"cy","5.5"),Ct.setAttributeNS(null,"r","5.4999962"),Xe.appendChild(st),Xe.appendChild(Ct),T.appendChild(I),T.appendChild(ye),T.appendChild(Fe),T.appendChild(Pe),T.appendChild(Xe),w.appendChild(T),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),tf(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=bl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,uu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),kf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Wl=0,Ku=!1,Ws=function(f){function d(h){f.call(this),this.options=y.extend({},kf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Hl!==void 0?g(Hl):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Hl=w.state!=="denied")}):g(Hl=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wl=0,Ku=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,C=this._map.getBearing(),T=y.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),T,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),C=g.distanceTo(w),T=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Ku)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Cc(this._dotElement),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||g._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wl--,Ku=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Wl>1?(h={maximumAge:6e5,timeout:0},Ku=!0):(h=this.options.positionOptions,Ku=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),Ju={maxWidth:100,unit:"metric"},Mu=function(f){this.options=y.extend({},Ju,f),y.bindAll(["_onMove","setUnit"],this)};function $l(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,C=f.unproject([0,w]),T=f.unproject([g,w]),I=C.distanceTo(T);if(h&&h.unit==="imperial"){var U=3.2808*I;U>5280?$s(d,g,U/5280,f._getUIString("ScaleControl.Miles")):$s(d,g,U,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?$s(d,g,I/1852,f._getUIString("ScaleControl.NauticalMiles")):I>=1e3?$s(d,g,I/1e3,f._getUIString("ScaleControl.Kilometers")):$s(d,g,I,f._getUIString("ScaleControl.Meters"))}function $s(f,d,h,g){var w,C,T,I=(w=h,(C=Math.pow(10,(""+Math.floor(w)).length-1))*(T=(T=w/C)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(U){var $=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*$)/$}(T)));f.style.width=d*(I/h)+"px",f.innerHTML=I+"&nbsp;"+g}Mu.prototype.getDefaultPosition=function(){return"bottom-left"},Mu.prototype._onMove=function(){$l(this._map,this._container,this.options)},Mu.prototype.onAdd=function(f){return this._map=f,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Mu.prototype.onRemove=function(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Mu.prototype.setUnit=function(f){this.options.unit=f,$l(this._map,this._container,this.options)};var Rs=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Rs.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Rs.prototype.onRemove=function(){V.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Rs.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Rs.prototype._setupUI=function(){var f=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Rs.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Rs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Rs.prototype._isFullscreen=function(){return this._fullscreen},Rs.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Rs.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Qu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Tc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ch=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(Qu),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),C=y.window.document.createElement("body");for(C.innerHTML=h;g=C.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ve){return g._container.classList.add(ve)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),C=this.options.anchor,T=function ve(ye){if(ye){if(typeof ye=="number"){var ze=Math.round(Math.sqrt(.5*Math.pow(ye,2)));return{center:new y.Point(0,0),top:new y.Point(0,ye),"top-left":new y.Point(ze,ze),"top-right":new y.Point(-ze,ze),bottom:new y.Point(0,-ye),"bottom-left":new y.Point(ze,-ze),"bottom-right":new y.Point(-ze,-ze),left:new y.Point(ye,0),right:new y.Point(-ye,0)}}if(ye instanceof y.Point||Array.isArray(ye)){var Fe=y.Point.convert(ye);return{center:Fe,top:Fe,"top-left":Fe,"top-right":Fe,bottom:Fe,"bottom-left":Fe,"bottom-right":Fe,left:Fe,right:Fe}}return{center:y.Point.convert(ye.center||[0,0]),top:y.Point.convert(ye.top||[0,0]),"top-left":y.Point.convert(ye["top-left"]||[0,0]),"top-right":y.Point.convert(ye["top-right"]||[0,0]),bottom:y.Point.convert(ye.bottom||[0,0]),"bottom-left":y.Point.convert(ye["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(ye["bottom-right"]||[0,0]),left:y.Point.convert(ye.left||[0,0]),right:y.Point.convert(ye.right||[0,0])}}return ve(new y.Point(0,0))}(this.options.offset);if(!C){var I,U=this._container.offsetWidth,$=this._container.offsetHeight;I=w.y+T.bottom.y<$?["top"]:w.y>this._map.transform.height-$?["bottom"]:[],w.x<U/2?I.push("left"):w.x>this._map.transform.width-U/2&&I.push("right"),C=I.length===0?"bottom":I.join("-")}var le=w.add(T[C]).round();V.setTransform(this._container,uu[C]+" translate("+le.x+"px,"+le.y+"px)"),tf(this._container,C,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(Tc);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),rf={version:y.version,supported:oe,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Mf,NavigationControl:Ls,GeolocateControl:Ws,AttributionControl:Lo,ScaleControl:Mu,FullscreenControl:Rs,Popup:ch,Marker:Cc,Style:Xo,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Qt().acquire(te)},clearPrewarmedResources:function(){var f=bn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(te),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return br.workerCount},set workerCount(f){br.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return rf}),_e})},3614:function(Sr,Q,N){"use strict";Sr.exports=J;var _e=N(80645);function J(Y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Y)?Y:new Uint8Array(Y||0),this.pos=0,this.type=0,this.length=this.buf.length}J.Varint=0,J.Fixed64=1,J.Bytes=2,J.Fixed32=5;var y=(1<<16)*(1<<16),oe=1/y,V=12,ce=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");J.prototype={destroy:function(){this.buf=null},readFields:function(Y,Le,O){for(O=O||this.length;this.pos<O;){var Me=this.readVarint(),we=Me>>3,ut=this.pos;this.type=Me&7,Y(we,Le,this),this.pos===ut&&this.skip(Me)}return Le},readMessage:function(Y,Le){return this.readFields(Y,Le,this.readVarint()+this.pos)},readFixed32:function(){var Y=_t(this.buf,this.pos);return this.pos+=4,Y},readSFixed32:function(){var Y=Ot(this.buf,this.pos);return this.pos+=4,Y},readFixed64:function(){var Y=_t(this.buf,this.pos)+_t(this.buf,this.pos+4)*y;return this.pos+=8,Y},readSFixed64:function(){var Y=_t(this.buf,this.pos)+Ot(this.buf,this.pos+4)*y;return this.pos+=8,Y},readFloat:function(){var Y=_e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Y},readDouble:function(){var Y=_e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Y},readVarint:function(Y){var Le=this.buf,O,Me;return Me=Le[this.pos++],O=Me&127,Me<128||(Me=Le[this.pos++],O|=(Me&127)<<7,Me<128)||(Me=Le[this.pos++],O|=(Me&127)<<14,Me<128)||(Me=Le[this.pos++],O|=(Me&127)<<21,Me<128)?O:(Me=Le[this.pos],O|=(Me&15)<<28,ie(O,Y,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Y=this.readVarint();return Y%2==1?(Y+1)/-2:Y/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var Y=this.readVarint()+this.pos,Le=this.pos;return this.pos=Y,Y-Le>=V&&ce?Kt(this.buf,Le,Y):ft(this.buf,Le,Y)},readBytes:function(){var Y=this.readVarint()+this.pos,Le=this.buf.subarray(this.pos,Y);return this.pos=Y,Le},readPackedVarint:function(Y,Le){if(this.type!==J.Bytes)return Y.push(this.readVarint(Le));var O=We(this);for(Y=Y||[];this.pos<O;)Y.push(this.readVarint(Le));return Y},readPackedSVarint:function(Y){if(this.type!==J.Bytes)return Y.push(this.readSVarint());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSVarint());return Y},readPackedBoolean:function(Y){if(this.type!==J.Bytes)return Y.push(this.readBoolean());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readBoolean());return Y},readPackedFloat:function(Y){if(this.type!==J.Bytes)return Y.push(this.readFloat());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFloat());return Y},readPackedDouble:function(Y){if(this.type!==J.Bytes)return Y.push(this.readDouble());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readDouble());return Y},readPackedFixed32:function(Y){if(this.type!==J.Bytes)return Y.push(this.readFixed32());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFixed32());return Y},readPackedSFixed32:function(Y){if(this.type!==J.Bytes)return Y.push(this.readSFixed32());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSFixed32());return Y},readPackedFixed64:function(Y){if(this.type!==J.Bytes)return Y.push(this.readFixed64());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readFixed64());return Y},readPackedSFixed64:function(Y){if(this.type!==J.Bytes)return Y.push(this.readSFixed64());var Le=We(this);for(Y=Y||[];this.pos<Le;)Y.push(this.readSFixed64());return Y},skip:function(Y){var Le=Y&7;if(Le===J.Varint)for(;this.buf[this.pos++]>127;);else if(Le===J.Bytes)this.pos=this.readVarint()+this.pos;else if(Le===J.Fixed32)this.pos+=4;else if(Le===J.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Le)},writeTag:function(Y,Le){this.writeVarint(Y<<3|Le)},realloc:function(Y){for(var Le=this.length||16;Le<this.pos+Y;)Le*=2;if(Le!==this.length){var O=new Uint8Array(Le);O.set(this.buf),this.buf=O,this.length=Le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Y){this.realloc(4),at(this.buf,Y,this.pos),this.pos+=4},writeSFixed32:function(Y){this.realloc(4),at(this.buf,Y,this.pos),this.pos+=4},writeFixed64:function(Y){this.realloc(8),at(this.buf,Y&-1,this.pos),at(this.buf,Math.floor(Y*oe),this.pos+4),this.pos+=8},writeSFixed64:function(Y){this.realloc(8),at(this.buf,Y&-1,this.pos),at(this.buf,Math.floor(Y*oe),this.pos+4),this.pos+=8},writeVarint:function(Y){if(Y=+Y||0,Y>268435455||Y<0){He(Y,this);return}this.realloc(4),this.buf[this.pos++]=Y&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=(Y>>>=7)&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=(Y>>>=7)&127|(Y>127?128:0),!(Y<=127)&&(this.buf[this.pos++]=Y>>>7&127)))},writeSVarint:function(Y){this.writeVarint(Y<0?-Y*2-1:Y*2)},writeBoolean:function(Y){this.writeVarint(Boolean(Y))},writeString:function(Y){Y=String(Y),this.realloc(Y.length*4),this.pos++;var Le=this.pos;this.pos=xr(this.buf,Y,this.pos);var O=this.pos-Le;O>=128&&It(Le,O,this),this.pos=Le-1,this.writeVarint(O),this.pos+=O},writeFloat:function(Y){this.realloc(4),_e.write(this.buf,Y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Y){this.realloc(8),_e.write(this.buf,Y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Y){var Le=Y.length;this.writeVarint(Le),this.realloc(Le);for(var O=0;O<Le;O++)this.buf[this.pos++]=Y[O]},writeRawMessage:function(Y,Le){this.pos++;var O=this.pos;Y(Le,this);var Me=this.pos-O;Me>=128&&It(O,Me,this),this.pos=O-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(Y,Le,O){this.writeTag(Y,J.Bytes),this.writeRawMessage(Le,O)},writePackedVarint:function(Y,Le){Le.length&&this.writeMessage(Y,tr,Le)},writePackedSVarint:function(Y,Le){Le.length&&this.writeMessage(Y,qt,Le)},writePackedBoolean:function(Y,Le){Le.length&&this.writeMessage(Y,At,Le)},writePackedFloat:function(Y,Le){Le.length&&this.writeMessage(Y,ir,Le)},writePackedDouble:function(Y,Le){Le.length&&this.writeMessage(Y,rr,Le)},writePackedFixed32:function(Y,Le){Le.length&&this.writeMessage(Y,gt,Le)},writePackedSFixed32:function(Y,Le){Le.length&&this.writeMessage(Y,Br,Le)},writePackedFixed64:function(Y,Le){Le.length&&this.writeMessage(Y,dr,Le)},writePackedSFixed64:function(Y,Le){Le.length&&this.writeMessage(Y,lr,Le)},writeBytesField:function(Y,Le){this.writeTag(Y,J.Bytes),this.writeBytes(Le)},writeFixed32Field:function(Y,Le){this.writeTag(Y,J.Fixed32),this.writeFixed32(Le)},writeSFixed32Field:function(Y,Le){this.writeTag(Y,J.Fixed32),this.writeSFixed32(Le)},writeFixed64Field:function(Y,Le){this.writeTag(Y,J.Fixed64),this.writeFixed64(Le)},writeSFixed64Field:function(Y,Le){this.writeTag(Y,J.Fixed64),this.writeSFixed64(Le)},writeVarintField:function(Y,Le){this.writeTag(Y,J.Varint),this.writeVarint(Le)},writeSVarintField:function(Y,Le){this.writeTag(Y,J.Varint),this.writeSVarint(Le)},writeStringField:function(Y,Le){this.writeTag(Y,J.Bytes),this.writeString(Le)},writeFloatField:function(Y,Le){this.writeTag(Y,J.Fixed32),this.writeFloat(Le)},writeDoubleField:function(Y,Le){this.writeTag(Y,J.Fixed64),this.writeDouble(Le)},writeBooleanField:function(Y,Le){this.writeVarintField(Y,Boolean(Le))}};function ie(Y,Le,O){var Me=O.buf,we,ut;if(ut=Me[O.pos++],we=(ut&112)>>4,ut<128||(ut=Me[O.pos++],we|=(ut&127)<<3,ut<128)||(ut=Me[O.pos++],we|=(ut&127)<<10,ut<128)||(ut=Me[O.pos++],we|=(ut&127)<<17,ut<128)||(ut=Me[O.pos++],we|=(ut&127)<<24,ut<128)||(ut=Me[O.pos++],we|=(ut&1)<<31,ut<128))return ae(Y,we,Le);throw new Error("Expected varint not more than 10 bytes")}function We(Y){return Y.type===J.Bytes?Y.readVarint()+Y.pos:Y.pos+1}function ae(Y,Le,O){return O?Le*4294967296+(Y>>>0):(Le>>>0)*4294967296+(Y>>>0)}function He(Y,Le){var O,Me;if(Y>=0?(O=Y%4294967296|0,Me=Y/4294967296|0):(O=~(-Y%4294967296),Me=~(-Y/4294967296),O^4294967295?O=O+1|0:(O=0,Me=Me+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Le.realloc(10),nt(O,Me,Le),ct(Me,Le)}function nt(Y,Le,O){O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos++]=Y&127|128,Y>>>=7,O.buf[O.pos]=Y&127}function ct(Y,Le){var O=(Y&7)<<4;Le.buf[Le.pos++]|=O|((Y>>>=3)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127|((Y>>>=7)?128:0),!!Y&&(Le.buf[Le.pos++]=Y&127)))))}function It(Y,Le,O){var Me=Le<=16383?1:Le<=2097151?2:Le<=268435455?3:Math.floor(Math.log(Le)/(Math.LN2*7));O.realloc(Me);for(var we=O.pos-1;we>=Y;we--)O.buf[we+Me]=O.buf[we]}function tr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeVarint(Y[O])}function qt(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSVarint(Y[O])}function ir(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFloat(Y[O])}function rr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeDouble(Y[O])}function At(Y,Le){for(var O=0;O<Y.length;O++)Le.writeBoolean(Y[O])}function gt(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFixed32(Y[O])}function Br(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSFixed32(Y[O])}function dr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeFixed64(Y[O])}function lr(Y,Le){for(var O=0;O<Y.length;O++)Le.writeSFixed64(Y[O])}function _t(Y,Le){return(Y[Le]|Y[Le+1]<<8|Y[Le+2]<<16)+Y[Le+3]*16777216}function at(Y,Le,O){Y[O]=Le,Y[O+1]=Le>>>8,Y[O+2]=Le>>>16,Y[O+3]=Le>>>24}function Ot(Y,Le){return(Y[Le]|Y[Le+1]<<8|Y[Le+2]<<16)+(Y[Le+3]<<24)}function ft(Y,Le,O){for(var Me="",we=Le;we<O;){var ut=Y[we],yt=null,xt=ut>239?4:ut>223?3:ut>191?2:1;if(we+xt>O)break;var jt,nr,en;xt===1?ut<128&&(yt=ut):xt===2?(jt=Y[we+1],(jt&192)==128&&(yt=(ut&31)<<6|jt&63,yt<=127&&(yt=null))):xt===3?(jt=Y[we+1],nr=Y[we+2],(jt&192)==128&&(nr&192)==128&&(yt=(ut&15)<<12|(jt&63)<<6|nr&63,(yt<=2047||yt>=55296&&yt<=57343)&&(yt=null))):xt===4&&(jt=Y[we+1],nr=Y[we+2],en=Y[we+3],(jt&192)==128&&(nr&192)==128&&(en&192)==128&&(yt=(ut&15)<<18|(jt&63)<<12|(nr&63)<<6|en&63,(yt<=65535||yt>=1114112)&&(yt=null))),yt===null?(yt=65533,xt=1):yt>65535&&(yt-=65536,Me+=String.fromCharCode(yt>>>10&1023|55296),yt=56320|yt&1023),Me+=String.fromCharCode(yt),we+=xt}return Me}function Kt(Y,Le,O){return ce.decode(Y.subarray(Le,O))}function xr(Y,Le,O){for(var Me=0,we,ut;Me<Le.length;Me++){if(we=Le.charCodeAt(Me),we>55295&&we<57344)if(ut)if(we<56320){Y[O++]=239,Y[O++]=191,Y[O++]=189,ut=we;continue}else we=ut-55296<<10|we-56320|65536,ut=null;else{we>56319||Me+1===Le.length?(Y[O++]=239,Y[O++]=191,Y[O++]=189):ut=we;continue}else ut&&(Y[O++]=239,Y[O++]=191,Y[O++]=189,ut=null);we<128?Y[O++]=we:(we<2048?Y[O++]=we>>6|192:(we<65536?Y[O++]=we>>12|224:(Y[O++]=we>>18|240,Y[O++]=we>>12&63|128),Y[O++]=we>>6&63|128),Y[O++]=we&63|128)}return O}},32676:function(Sr,Q,N){var _e=N(34155);(function(J,y){Sr.exports=y()})(this,function(){"use strict";function J(Mt,L){if(!(Mt instanceof L))throw new TypeError("Cannot call a class as a function")}function y(Mt,L){for(var re=0;re<L.length;re++){var fe=L[re];fe.enumerable=fe.enumerable||!1,fe.configurable=!0,"value"in fe&&(fe.writable=!0),Object.defineProperty(Mt,fe.key,fe)}}function oe(Mt,L,re){return L&&y(Mt.prototype,L),re&&y(Mt,re),Mt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var V=function(){function Mt(L,re){this.next=null,this.key=L,this.data=re,this.left=null,this.right=null}return Mt}();function ce(Mt,L){return Mt>L?1:Mt<L?-1:0}function ie(Mt,L,re){for(var fe=new V(null,null),Ue=fe,ht=fe;;){var Gt=re(Mt,L.key);if(Gt<0){if(L.left===null)break;if(re(Mt,L.left.key)<0){var Ar=L.left;if(L.left=Ar.right,Ar.right=L,L=Ar,L.left===null)break}ht.left=L,ht=L,L=L.left}else if(Gt>0){if(L.right===null)break;if(re(Mt,L.right.key)>0){var Ar=L.right;if(L.right=Ar.left,Ar.left=L,L=Ar,L.right===null)break}Ue.right=L,Ue=L,L=L.right}else break}return Ue.right=L.left,ht.left=L.right,L.left=fe.right,L.right=fe.left,L}function We(Mt,L,re,fe){var Ue=new V(Mt,L);if(re===null)return Ue.left=Ue.right=null,Ue;re=ie(Mt,re,fe);var ht=fe(Mt,re.key);return ht<0?(Ue.left=re.left,Ue.right=re,re.left=null):ht>=0&&(Ue.right=re.right,Ue.left=re,re.right=null),Ue}function ae(Mt,L,re){var fe=null,Ue=null;if(L){L=ie(Mt,L,re);var ht=re(L.key,Mt);ht===0?(fe=L.left,Ue=L.right):ht<0?(Ue=L.right,L.right=null,fe=L):(fe=L.left,L.left=null,Ue=L)}return{left:fe,right:Ue}}function He(Mt,L,re){return L===null?Mt:(Mt===null||(L=ie(Mt.key,L,re),L.left=Mt),L)}function nt(Mt,L,re,fe,Ue){if(Mt){fe(""+L+(re?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ue(Mt)+`
`);var ht=L+(re?"    ":"\u2502   ");Mt.left&&nt(Mt.left,ht,!1,fe,Ue),Mt.right&&nt(Mt.right,ht,!0,fe,Ue)}}var ct=function(){function Mt(L){L===void 0&&(L=ce),this._root=null,this._size=0,this._comparator=L}return Mt.prototype.insert=function(L,re){return this._size++,this._root=We(L,re,this._root,this._comparator)},Mt.prototype.add=function(L,re){var fe=new V(L,re);this._root===null&&(fe.left=fe.right=null,this._size++,this._root=fe);var Ue=this._comparator,ht=ie(L,this._root,Ue),Gt=Ue(L,ht.key);return Gt===0?this._root=ht:(Gt<0?(fe.left=ht.left,fe.right=ht,ht.left=null):Gt>0&&(fe.right=ht.right,fe.left=ht,ht.right=null),this._size++,this._root=fe),this._root},Mt.prototype.remove=function(L){this._root=this._remove(L,this._root,this._comparator)},Mt.prototype._remove=function(L,re,fe){var Ue;if(re===null)return null;re=ie(L,re,fe);var ht=fe(L,re.key);return ht===0?(re.left===null?Ue=re.right:(Ue=ie(L,re.left,fe),Ue.right=re.right),this._size--,Ue):re},Mt.prototype.pop=function(){var L=this._root;if(L){for(;L.left;)L=L.left;return this._root=ie(L.key,this._root,this._comparator),this._root=this._remove(L.key,this._root,this._comparator),{key:L.key,data:L.data}}return null},Mt.prototype.findStatic=function(L){for(var re=this._root,fe=this._comparator;re;){var Ue=fe(L,re.key);if(Ue===0)return re;Ue<0?re=re.left:re=re.right}return null},Mt.prototype.find=function(L){return this._root&&(this._root=ie(L,this._root,this._comparator),this._comparator(L,this._root.key)!==0)?null:this._root},Mt.prototype.contains=function(L){for(var re=this._root,fe=this._comparator;re;){var Ue=fe(L,re.key);if(Ue===0)return!0;Ue<0?re=re.left:re=re.right}return!1},Mt.prototype.forEach=function(L,re){for(var fe=this._root,Ue=[],ht=!1;!ht;)fe!==null?(Ue.push(fe),fe=fe.left):Ue.length!==0?(fe=Ue.pop(),L.call(re,fe),fe=fe.right):ht=!0;return this},Mt.prototype.range=function(L,re,fe,Ue){for(var ht=[],Gt=this._comparator,Ar=this._root,je;ht.length!==0||Ar;)if(Ar)ht.push(Ar),Ar=Ar.left;else{if(Ar=ht.pop(),je=Gt(Ar.key,re),je>0)break;if(Gt(Ar.key,L)>=0&&fe.call(Ue,Ar))return this;Ar=Ar.right}return this},Mt.prototype.keys=function(){var L=[];return this.forEach(function(re){var fe=re.key;return L.push(fe)}),L},Mt.prototype.values=function(){var L=[];return this.forEach(function(re){var fe=re.data;return L.push(fe)}),L},Mt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Mt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Mt.prototype.minNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.left;)L=L.left;return L},Mt.prototype.maxNode=function(L){if(L===void 0&&(L=this._root),L)for(;L.right;)L=L.right;return L},Mt.prototype.at=function(L){for(var re=this._root,fe=!1,Ue=0,ht=[];!fe;)if(re)ht.push(re),re=re.left;else if(ht.length>0){if(re=ht.pop(),Ue===L)return re;Ue++,re=re.right}else fe=!0;return null},Mt.prototype.next=function(L){var re=this._root,fe=null;if(L.right){for(fe=L.right;fe.left;)fe=fe.left;return fe}for(var Ue=this._comparator;re;){var ht=Ue(L.key,re.key);if(ht===0)break;ht<0?(fe=re,re=re.left):re=re.right}return fe},Mt.prototype.prev=function(L){var re=this._root,fe=null;if(L.left!==null){for(fe=L.left;fe.right;)fe=fe.right;return fe}for(var Ue=this._comparator;re;){var ht=Ue(L.key,re.key);if(ht===0)break;ht<0?re=re.left:(fe=re,re=re.right)}return fe},Mt.prototype.clear=function(){return this._root=null,this._size=0,this},Mt.prototype.toList=function(){return qt(this._root)},Mt.prototype.load=function(L,re,fe){re===void 0&&(re=[]),fe===void 0&&(fe=!1);var Ue=L.length,ht=this._comparator;if(fe&&At(L,re,0,Ue-1,ht),this._root===null)this._root=It(L,re,0,Ue),this._size=Ue;else{var Gt=rr(this.toList(),tr(L,re),ht);Ue=this._size+Ue,this._root=ir({head:Gt},0,Ue)}return this},Mt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Mt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Mt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Mt.prototype.toString=function(L){L===void 0&&(L=function(Ue){return String(Ue.key)});var re=[];return nt(this._root,"",!0,function(fe){return re.push(fe)},L),re.join("")},Mt.prototype.update=function(L,re,fe){var Ue=this._comparator,ht=ae(L,this._root,Ue),Gt=ht.left,Ar=ht.right;Ue(L,re)<0?Ar=We(re,fe,Ar,Ue):Gt=We(re,fe,Gt,Ue),this._root=He(Gt,Ar,Ue)},Mt.prototype.split=function(L){return ae(L,this._root,this._comparator)},Mt}();function It(Mt,L,re,fe){var Ue=fe-re;if(Ue>0){var ht=re+Math.floor(Ue/2),Gt=Mt[ht],Ar=L[ht],je=new V(Gt,Ar);return je.left=It(Mt,L,re,ht),je.right=It(Mt,L,ht+1,fe),je}return null}function tr(Mt,L){for(var re=new V(null,null),fe=re,Ue=0;Ue<Mt.length;Ue++)fe=fe.next=new V(Mt[Ue],L[Ue]);return fe.next=null,re.next}function qt(Mt){for(var L=Mt,re=[],fe=!1,Ue=new V(null,null),ht=Ue;!fe;)L?(re.push(L),L=L.left):re.length>0?(L=ht=ht.next=re.pop(),L=L.right):fe=!0;return ht.next=null,Ue.next}function ir(Mt,L,re){var fe=re-L;if(fe>0){var Ue=L+Math.floor(fe/2),ht=ir(Mt,L,Ue),Gt=Mt.head;return Gt.left=ht,Mt.head=Mt.head.next,Gt.right=ir(Mt,Ue+1,re),Gt}return null}function rr(Mt,L,re){for(var fe=new V(null,null),Ue=fe,ht=Mt,Gt=L;ht!==null&&Gt!==null;)re(ht.key,Gt.key)<0?(Ue.next=ht,ht=ht.next):(Ue.next=Gt,Gt=Gt.next),Ue=Ue.next;return ht!==null?Ue.next=ht:Gt!==null&&(Ue.next=Gt),fe.next}function At(Mt,L,re,fe,Ue){if(!(re>=fe)){for(var ht=Mt[re+fe>>1],Gt=re-1,Ar=fe+1;;){do Gt++;while(Ue(Mt[Gt],ht)<0);do Ar--;while(Ue(Mt[Ar],ht)>0);if(Gt>=Ar)break;var je=Mt[Gt];Mt[Gt]=Mt[Ar],Mt[Ar]=je,je=L[Gt],L[Gt]=L[Ar],L[Ar]=je}At(Mt,L,re,Ar,Ue),At(Mt,L,Ar+1,fe,Ue)}}var gt=function(L,re){return L.ll.x<=re.x&&re.x<=L.ur.x&&L.ll.y<=re.y&&re.y<=L.ur.y},Br=function(L,re){if(re.ur.x<L.ll.x||L.ur.x<re.ll.x||re.ur.y<L.ll.y||L.ur.y<re.ll.y)return null;var fe=L.ll.x<re.ll.x?re.ll.x:L.ll.x,Ue=L.ur.x<re.ur.x?L.ur.x:re.ur.x,ht=L.ll.y<re.ll.y?re.ll.y:L.ll.y,Gt=L.ur.y<re.ur.y?L.ur.y:re.ur.y;return{ll:{x:fe,y:ht},ur:{x:Ue,y:Gt}}},dr=Number.EPSILON;dr===void 0&&(dr=Math.pow(2,-52));var lr=dr*dr,_t=function(L,re){if(-dr<L&&L<dr&&-dr<re&&re<dr)return 0;var fe=L-re;return fe*fe<lr*L*re?0:L<re?-1:1},at=function(){function Mt(){J(this,Mt),this.reset()}return oe(Mt,[{key:"reset",value:function(){this.xRounder=new Ot,this.yRounder=new Ot}},{key:"round",value:function(re,fe){return{x:this.xRounder.round(re),y:this.yRounder.round(fe)}}}]),Mt}(),Ot=function(){function Mt(){J(this,Mt),this.tree=new ct,this.round(0)}return oe(Mt,[{key:"round",value:function(re){var fe=this.tree.add(re),Ue=this.tree.prev(fe);if(Ue!==null&&_t(fe.key,Ue.key)===0)return this.tree.remove(re),Ue.key;var ht=this.tree.next(fe);return ht!==null&&_t(fe.key,ht.key)===0?(this.tree.remove(re),ht.key):re}}]),Mt}(),ft=new at,Kt=function(L,re){return L.x*re.y-L.y*re.x},xr=function(L,re){return L.x*re.x+L.y*re.y},Y=function(L,re,fe){var Ue={x:re.x-L.x,y:re.y-L.y},ht={x:fe.x-L.x,y:fe.y-L.y},Gt=Kt(Ue,ht);return _t(Gt,0)},Le=function(L){return Math.sqrt(xr(L,L))},O=function(L,re,fe){var Ue={x:re.x-L.x,y:re.y-L.y},ht={x:fe.x-L.x,y:fe.y-L.y};return Kt(ht,Ue)/Le(ht)/Le(Ue)},Me=function(L,re,fe){var Ue={x:re.x-L.x,y:re.y-L.y},ht={x:fe.x-L.x,y:fe.y-L.y};return xr(ht,Ue)/Le(ht)/Le(Ue)},we=function(L,re,fe){return re.y===0?null:{x:L.x+re.x/re.y*(fe-L.y),y:fe}},ut=function(L,re,fe){return re.x===0?null:{x:fe,y:L.y+re.y/re.x*(fe-L.x)}},yt=function(L,re,fe,Ue){if(re.x===0)return ut(fe,Ue,L.x);if(Ue.x===0)return ut(L,re,fe.x);if(re.y===0)return we(fe,Ue,L.y);if(Ue.y===0)return we(L,re,fe.y);var ht=Kt(re,Ue);if(ht==0)return null;var Gt={x:fe.x-L.x,y:fe.y-L.y},Ar=Kt(Gt,re)/ht,je=Kt(Gt,Ue)/ht,Tt=L.x+je*re.x,ar=fe.x+Ar*Ue.x,wr=L.y+je*re.y,$r=fe.y+Ar*Ue.y,_n=(Tt+ar)/2,Cn=(wr+$r)/2;return{x:_n,y:Cn}},xt=function(){oe(Mt,null,[{key:"compare",value:function(re,fe){var Ue=Mt.comparePoints(re.point,fe.point);return Ue!==0?Ue:(re.point!==fe.point&&re.link(fe),re.isLeft!==fe.isLeft?re.isLeft?1:-1:nr.compare(re.segment,fe.segment))}},{key:"comparePoints",value:function(re,fe){return re.x<fe.x?-1:re.x>fe.x?1:re.y<fe.y?-1:re.y>fe.y?1:0}}]);function Mt(L,re){J(this,Mt),L.events===void 0?L.events=[this]:L.events.push(this),this.point=L,this.isLeft=re}return oe(Mt,[{key:"link",value:function(re){if(re.point===this.point)throw new Error("Tried to link already linked events");for(var fe=re.point.events,Ue=0,ht=fe.length;Ue<ht;Ue++){var Gt=fe[Ue];this.point.events.push(Gt),Gt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var re=this.point.events.length,fe=0;fe<re;fe++){var Ue=this.point.events[fe];if(Ue.segment.consumedBy===void 0)for(var ht=fe+1;ht<re;ht++){var Gt=this.point.events[ht];Gt.consumedBy===void 0&&Ue.otherSE.point.events===Gt.otherSE.point.events&&Ue.segment.consume(Gt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var re=[],fe=0,Ue=this.point.events.length;fe<Ue;fe++){var ht=this.point.events[fe];ht!==this&&!ht.segment.ringOut&&ht.segment.isInResult()&&re.push(ht)}return re}},{key:"getLeftmostComparator",value:function(re){var fe=this,Ue=new Map,ht=function(Ar){var je=Ar.otherSE;Ue.set(Ar,{sine:O(fe.point,re.point,je.point),cosine:Me(fe.point,re.point,je.point)})};return function(Gt,Ar){Ue.has(Gt)||ht(Gt),Ue.has(Ar)||ht(Ar);var je=Ue.get(Gt),Tt=je.sine,ar=je.cosine,wr=Ue.get(Ar),$r=wr.sine,_n=wr.cosine;return Tt>=0&&$r>=0?ar<_n?1:ar>_n?-1:0:Tt<0&&$r<0?ar<_n?-1:ar>_n?1:0:$r<Tt?-1:$r>Tt?1:0}}}]),Mt}(),jt=0,nr=function(){oe(Mt,null,[{key:"compare",value:function(re,fe){var Ue=re.leftSE.point.x,ht=fe.leftSE.point.x,Gt=re.rightSE.point.x,Ar=fe.rightSE.point.x;if(Ar<Ue)return 1;if(Gt<ht)return-1;var je=re.leftSE.point.y,Tt=fe.leftSE.point.y,ar=re.rightSE.point.y,wr=fe.rightSE.point.y;if(Ue<ht){if(Tt<je&&Tt<ar)return 1;if(Tt>je&&Tt>ar)return-1;var $r=re.comparePoint(fe.leftSE.point);if($r<0)return 1;if($r>0)return-1;var _n=fe.comparePoint(re.rightSE.point);return _n!==0?_n:-1}if(Ue>ht){if(je<Tt&&je<wr)return-1;if(je>Tt&&je>wr)return 1;var Cn=fe.comparePoint(re.leftSE.point);if(Cn!==0)return Cn;var xn=re.comparePoint(fe.rightSE.point);return xn<0?1:xn>0?-1:1}if(je<Tt)return-1;if(je>Tt)return 1;if(Gt<Ar){var wn=fe.comparePoint(re.rightSE.point);if(wn!==0)return wn}if(Gt>Ar){var ri=re.comparePoint(fe.rightSE.point);if(ri<0)return 1;if(ri>0)return-1}if(Gt!==Ar){var Kn=ar-je,Yi=Gt-Ue,qi=wr-Tt,mo=Ar-ht;if(Kn>Yi&&qi<mo)return 1;if(Kn<Yi&&qi>mo)return-1}return Gt>Ar?1:Gt<Ar||ar<wr?-1:ar>wr?1:re.id<fe.id?-1:re.id>fe.id?1:0}}]);function Mt(L,re,fe,Ue){J(this,Mt),this.id=++jt,this.leftSE=L,L.segment=this,L.otherSE=re,this.rightSE=re,re.segment=this,re.otherSE=L,this.rings=fe,this.windings=Ue}return oe(Mt,[{key:"replaceRightSE",value:function(re){this.rightSE=re,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var re=this.leftSE.point.y,fe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:re<fe?re:fe},ur:{x:this.rightSE.point.x,y:re>fe?re:fe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(re){return re.x===this.leftSE.point.x&&re.y===this.leftSE.point.y||re.x===this.rightSE.point.x&&re.y===this.rightSE.point.y}},{key:"comparePoint",value:function(re){if(this.isAnEndpoint(re))return 0;var fe=this.leftSE.point,Ue=this.rightSE.point,ht=this.vector();if(fe.x===Ue.x)return re.x===fe.x?0:re.x<fe.x?1:-1;var Gt=(re.y-fe.y)/ht.y,Ar=fe.x+Gt*ht.x;if(re.x===Ar)return 0;var je=(re.x-fe.x)/ht.x,Tt=fe.y+je*ht.y;return re.y===Tt?0:re.y<Tt?-1:1}},{key:"getIntersection",value:function(re){var fe=this.bbox(),Ue=re.bbox(),ht=Br(fe,Ue);if(ht===null)return null;var Gt=this.leftSE.point,Ar=this.rightSE.point,je=re.leftSE.point,Tt=re.rightSE.point,ar=gt(fe,je)&&this.comparePoint(je)===0,wr=gt(Ue,Gt)&&re.comparePoint(Gt)===0,$r=gt(fe,Tt)&&this.comparePoint(Tt)===0,_n=gt(Ue,Ar)&&re.comparePoint(Ar)===0;if(wr&&ar)return _n&&!$r?Ar:!_n&&$r?Tt:null;if(wr)return $r&&Gt.x===Tt.x&&Gt.y===Tt.y?null:Gt;if(ar)return _n&&Ar.x===je.x&&Ar.y===je.y?null:je;if(_n&&$r)return null;if(_n)return Ar;if($r)return Tt;var Cn=yt(Gt,this.vector(),je,re.vector());return Cn===null||!gt(ht,Cn)?null:ft.round(Cn.x,Cn.y)}},{key:"split",value:function(re){var fe=[],Ue=re.events!==void 0,ht=new xt(re,!0),Gt=new xt(re,!1),Ar=this.rightSE;this.replaceRightSE(Gt),fe.push(Gt),fe.push(ht);var je=new Mt(ht,Ar,this.rings.slice(),this.windings.slice());return xt.comparePoints(je.leftSE.point,je.rightSE.point)>0&&je.swapEvents(),xt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ue&&(ht.checkForConsuming(),Gt.checkForConsuming()),fe}},{key:"swapEvents",value:function(){var re=this.rightSE;this.rightSE=this.leftSE,this.leftSE=re,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var fe=0,Ue=this.windings.length;fe<Ue;fe++)this.windings[fe]*=-1}},{key:"consume",value:function(re){for(var fe=this,Ue=re;fe.consumedBy;)fe=fe.consumedBy;for(;Ue.consumedBy;)Ue=Ue.consumedBy;var ht=Mt.compare(fe,Ue);if(ht!==0){if(ht>0){var Gt=fe;fe=Ue,Ue=Gt}if(fe.prev===Ue){var Ar=fe;fe=Ue,Ue=Ar}for(var je=0,Tt=Ue.rings.length;je<Tt;je++){var ar=Ue.rings[je],wr=Ue.windings[je],$r=fe.rings.indexOf(ar);$r===-1?(fe.rings.push(ar),fe.windings.push(wr)):fe.windings[$r]+=wr}Ue.rings=null,Ue.windings=null,Ue.consumedBy=fe,Ue.leftSE.consumedBy=fe.leftSE,Ue.rightSE.consumedBy=fe.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var re=this.prev.consumedBy||this.prev;this._beforeState=re.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var re=this.beforeState();this._afterState={rings:re.rings.slice(0),windings:re.windings.slice(0),multiPolys:[]};for(var fe=this._afterState.rings,Ue=this._afterState.windings,ht=this._afterState.multiPolys,Gt=0,Ar=this.rings.length;Gt<Ar;Gt++){var je=this.rings[Gt],Tt=this.windings[Gt],ar=fe.indexOf(je);ar===-1?(fe.push(je),Ue.push(Tt)):Ue[ar]+=Tt}for(var wr=[],$r=[],_n=0,Cn=fe.length;_n<Cn;_n++)if(Ue[_n]!==0){var xn=fe[_n],wn=xn.poly;if($r.indexOf(wn)===-1)if(xn.isExterior)wr.push(wn);else{$r.indexOf(wn)===-1&&$r.push(wn);var ri=wr.indexOf(xn.poly);ri!==-1&&wr.splice(ri,1)}}for(var Kn=0,Yi=wr.length;Kn<Yi;Kn++){var qi=wr[Kn].multiPoly;ht.indexOf(qi)===-1&&ht.push(qi)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var re=this.beforeState().multiPolys,fe=this.afterState().multiPolys;switch(Mi.type){case"union":{var Ue=re.length===0,ht=fe.length===0;this._isInResult=Ue!==ht;break}case"intersection":{var Gt,Ar;re.length<fe.length?(Gt=re.length,Ar=fe.length):(Gt=fe.length,Ar=re.length),this._isInResult=Ar===Mi.numMultiPolys&&Gt<Ar;break}case"xor":{var je=Math.abs(re.length-fe.length);this._isInResult=je%2==1;break}case"difference":{var Tt=function(wr){return wr.length===1&&wr[0].isSubject};this._isInResult=Tt(re)!==Tt(fe);break}default:throw new Error("Unrecognized operation type found ".concat(Mi.type))}return this._isInResult}}],[{key:"fromRing",value:function(re,fe,Ue){var ht,Gt,Ar,je=xt.comparePoints(re,fe);if(je<0)ht=re,Gt=fe,Ar=1;else if(je>0)ht=fe,Gt=re,Ar=-1;else throw new Error("Tried to create degenerate segment at [".concat(re.x,", ").concat(re.y,"]"));var Tt=new xt(ht,!0),ar=new xt(Gt,!1);return new Mt(Tt,ar,[Ue],[Ar])}}]),Mt}(),en=function(){function Mt(L,re,fe){if(J(this,Mt),!Array.isArray(L)||L.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=re,this.isExterior=fe,this.segments=[],typeof L[0][0]!="number"||typeof L[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ue=ft.round(L[0][0],L[0][1]);this.bbox={ll:{x:Ue.x,y:Ue.y},ur:{x:Ue.x,y:Ue.y}};for(var ht=Ue,Gt=1,Ar=L.length;Gt<Ar;Gt++){if(typeof L[Gt][0]!="number"||typeof L[Gt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var je=ft.round(L[Gt][0],L[Gt][1]);je.x===ht.x&&je.y===ht.y||(this.segments.push(nr.fromRing(ht,je,this)),je.x<this.bbox.ll.x&&(this.bbox.ll.x=je.x),je.y<this.bbox.ll.y&&(this.bbox.ll.y=je.y),je.x>this.bbox.ur.x&&(this.bbox.ur.x=je.x),je.y>this.bbox.ur.y&&(this.bbox.ur.y=je.y),ht=je)}(Ue.x!==ht.x||Ue.y!==ht.y)&&this.segments.push(nr.fromRing(ht,Ue,this))}return oe(Mt,[{key:"getSweepEvents",value:function(){for(var re=[],fe=0,Ue=this.segments.length;fe<Ue;fe++){var ht=this.segments[fe];re.push(ht.leftSE),re.push(ht.rightSE)}return re}}]),Mt}(),Lr=function(){function Mt(L,re){if(J(this,Mt),!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new en(L[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var fe=1,Ue=L.length;fe<Ue;fe++){var ht=new en(L[fe],this,!1);ht.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ht.bbox.ll.x),ht.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ht.bbox.ll.y),ht.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ht.bbox.ur.x),ht.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ht.bbox.ur.y),this.interiorRings.push(ht)}this.multiPoly=re}return oe(Mt,[{key:"getSweepEvents",value:function(){for(var re=this.exteriorRing.getSweepEvents(),fe=0,Ue=this.interiorRings.length;fe<Ue;fe++)for(var ht=this.interiorRings[fe].getSweepEvents(),Gt=0,Ar=ht.length;Gt<Ar;Gt++)re.push(ht[Gt]);return re}}]),Mt}(),Vn=function(){function Mt(L,re){if(J(this,Mt),!Array.isArray(L))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof L[0][0][0]=="number"&&(L=[L])}catch(Gt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var fe=0,Ue=L.length;fe<Ue;fe++){var ht=new Lr(L[fe],this);ht.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ht.bbox.ll.x),ht.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ht.bbox.ll.y),ht.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ht.bbox.ur.x),ht.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ht.bbox.ur.y),this.polys.push(ht)}this.isSubject=re}return oe(Mt,[{key:"getSweepEvents",value:function(){for(var re=[],fe=0,Ue=this.polys.length;fe<Ue;fe++)for(var ht=this.polys[fe].getSweepEvents(),Gt=0,Ar=ht.length;Gt<Ar;Gt++)re.push(ht[Gt]);return re}}]),Mt}(),rn=function(){oe(Mt,null,[{key:"factory",value:function(re){for(var fe=[],Ue=0,ht=re.length;Ue<ht;Ue++){var Gt=re[Ue];if(!(!Gt.isInResult()||Gt.ringOut)){for(var Ar=null,je=Gt.leftSE,Tt=Gt.rightSE,ar=[je],wr=je.point,$r=[];Ar=je,je=Tt,ar.push(je),je.point!==wr;)for(;;){var _n=je.getAvailableLinkedEvents();if(_n.length===0){var Cn=ar[0].point,xn=ar[ar.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Cn.x,",")+" ".concat(Cn.y,"]. Last matching segment found ends at")+" [".concat(xn.x,", ").concat(xn.y,"]."))}if(_n.length===1){Tt=_n[0].otherSE;break}for(var wn=null,ri=0,Kn=$r.length;ri<Kn;ri++)if($r[ri].point===je.point){wn=ri;break}if(wn!==null){var Yi=$r.splice(wn)[0],qi=ar.splice(Yi.index);qi.unshift(qi[0].otherSE),fe.push(new Mt(qi.reverse()));continue}$r.push({index:ar.length,point:je.point});var mo=je.getLeftmostComparator(Ar);Tt=_n.sort(mo)[0].otherSE;break}fe.push(new Mt(ar))}}return fe}}]);function Mt(L){J(this,Mt),this.events=L;for(var re=0,fe=L.length;re<fe;re++)L[re].segment.ringOut=this;this.poly=null}return oe(Mt,[{key:"getGeom",value:function(){for(var re=this.events[0].point,fe=[re],Ue=1,ht=this.events.length-1;Ue<ht;Ue++){var Gt=this.events[Ue].point,Ar=this.events[Ue+1].point;Y(Gt,re,Ar)!==0&&(fe.push(Gt),re=Gt)}if(fe.length===1)return null;var je=fe[0],Tt=fe[1];Y(je,re,Tt)===0&&fe.shift(),fe.push(fe[0]);for(var ar=this.isExteriorRing()?1:-1,wr=this.isExteriorRing()?0:fe.length-1,$r=this.isExteriorRing()?fe.length:-1,_n=[],Cn=wr;Cn!=$r;Cn+=ar)_n.push([fe[Cn].x,fe[Cn].y]);return _n}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var re=this.enclosingRing();this._isExteriorRing=re?!re.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var re=this.events[0],fe=1,Ue=this.events.length;fe<Ue;fe++){var ht=this.events[fe];xt.compare(re,ht)>0&&(re=ht)}for(var Gt=re.segment.prevInResult(),Ar=Gt?Gt.prevInResult():null;;){if(!Gt)return null;if(!Ar)return Gt.ringOut;if(Ar.ringOut!==Gt.ringOut)return Ar.ringOut.enclosingRing()!==Gt.ringOut?Gt.ringOut:Gt.ringOut.enclosingRing();Gt=Ar.prevInResult(),Ar=Gt?Gt.prevInResult():null}}}]),Mt}(),Mn=function(){function Mt(L){J(this,Mt),this.exteriorRing=L,L.poly=this,this.interiorRings=[]}return oe(Mt,[{key:"addInterior",value:function(re){this.interiorRings.push(re),re.poly=this}},{key:"getGeom",value:function(){var re=[this.exteriorRing.getGeom()];if(re[0]===null)return null;for(var fe=0,Ue=this.interiorRings.length;fe<Ue;fe++){var ht=this.interiorRings[fe].getGeom();ht!==null&&re.push(ht)}return re}}]),Mt}(),ii=function(){function Mt(L){J(this,Mt),this.rings=L,this.polys=this._composePolys(L)}return oe(Mt,[{key:"getGeom",value:function(){for(var re=[],fe=0,Ue=this.polys.length;fe<Ue;fe++){var ht=this.polys[fe].getGeom();ht!==null&&re.push(ht)}return re}},{key:"_composePolys",value:function(re){for(var fe=[],Ue=0,ht=re.length;Ue<ht;Ue++){var Gt=re[Ue];if(!Gt.poly)if(Gt.isExteriorRing())fe.push(new Mn(Gt));else{var Ar=Gt.enclosingRing();Ar.poly||fe.push(new Mn(Ar)),Ar.poly.addInterior(Gt)}}return fe}}]),Mt}(),Yn=function(){function Mt(L){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nr.compare;J(this,Mt),this.queue=L,this.tree=new ct(re),this.segments=[]}return oe(Mt,[{key:"process",value:function(re){var fe=re.segment,Ue=[];if(re.consumedBy)return re.isLeft?this.queue.remove(re.otherSE):this.tree.remove(fe),Ue;var ht=re.isLeft?this.tree.insert(fe):this.tree.find(fe);if(!ht)throw new Error("Unable to find segment #".concat(fe.id," ")+"[".concat(fe.leftSE.point.x,", ").concat(fe.leftSE.point.y,"] -> ")+"[".concat(fe.rightSE.point.x,", ").concat(fe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Gt=ht,Ar=ht,je=void 0,Tt=void 0;je===void 0;)Gt=this.tree.prev(Gt),Gt===null?je=null:Gt.key.consumedBy===void 0&&(je=Gt.key);for(;Tt===void 0;)Ar=this.tree.next(Ar),Ar===null?Tt=null:Ar.key.consumedBy===void 0&&(Tt=Ar.key);if(re.isLeft){var ar=null;if(je){var wr=je.getIntersection(fe);if(wr!==null&&(fe.isAnEndpoint(wr)||(ar=wr),!je.isAnEndpoint(wr)))for(var $r=this._splitSafely(je,wr),_n=0,Cn=$r.length;_n<Cn;_n++)Ue.push($r[_n])}var xn=null;if(Tt){var wn=Tt.getIntersection(fe);if(wn!==null&&(fe.isAnEndpoint(wn)||(xn=wn),!Tt.isAnEndpoint(wn)))for(var ri=this._splitSafely(Tt,wn),Kn=0,Yi=ri.length;Kn<Yi;Kn++)Ue.push(ri[Kn])}if(ar!==null||xn!==null){var qi=null;if(ar===null)qi=xn;else if(xn===null)qi=ar;else{var mo=xt.comparePoints(ar,xn);qi=mo<=0?ar:xn}this.queue.remove(fe.rightSE),Ue.push(fe.rightSE);for(var Wo=fe.split(qi),Ki=0,G=Wo.length;Ki<G;Ki++)Ue.push(Wo[Ki])}Ue.length>0?(this.tree.remove(fe),Ue.push(re)):(this.segments.push(fe),fe.prev=je)}else{if(je&&Tt){var X=je.getIntersection(Tt);if(X!==null){if(!je.isAnEndpoint(X))for(var ne=this._splitSafely(je,X),be=0,Oe=ne.length;be<Oe;be++)Ue.push(ne[be]);if(!Tt.isAnEndpoint(X))for(var Qe=this._splitSafely(Tt,X),ot=0,he=Qe.length;ot<he;ot++)Ue.push(Qe[ot])}}this.tree.remove(fe)}return Ue}},{key:"_splitSafely",value:function(re,fe){this.tree.remove(re);var Ue=re.rightSE;this.queue.remove(Ue);var ht=re.split(fe);return ht.push(Ue),re.consumedBy===void 0&&this.tree.insert(re),ht}}]),Mt}(),yn=typeof _e!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ai=typeof _e!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Pi=function(){function Mt(){J(this,Mt)}return oe(Mt,[{key:"run",value:function(re,fe,Ue){Mi.type=re,ft.reset();for(var ht=[new Vn(fe,!0)],Gt=0,Ar=Ue.length;Gt<Ar;Gt++)ht.push(new Vn(Ue[Gt],!1));if(Mi.numMultiPolys=ht.length,Mi.type==="difference")for(var je=ht[0],Tt=1;Tt<ht.length;)Br(ht[Tt].bbox,je.bbox)!==null?Tt++:ht.splice(Tt,1);if(Mi.type==="intersection"){for(var ar=0,wr=ht.length;ar<wr;ar++)for(var $r=ht[ar],_n=ar+1,Cn=ht.length;_n<Cn;_n++)if(Br($r.bbox,ht[_n].bbox)===null)return[]}for(var xn=new ct(xt.compare),wn=0,ri=ht.length;wn<ri;wn++)for(var Kn=ht[wn].getSweepEvents(),Yi=0,qi=Kn.length;Yi<qi;Yi++)if(xn.insert(Kn[Yi]),xn.size>yn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var mo=new Yn(xn),Wo=xn.size,Ki=xn.pop();Ki;){var G=Ki.key;if(xn.size===Wo){var X=G.segment;throw new Error("Unable to pop() ".concat(G.isLeft?"left":"right"," SweepEvent ")+"[".concat(G.point.x,", ").concat(G.point.y,"] from segment #").concat(X.id," ")+"[".concat(X.leftSE.point.x,", ").concat(X.leftSE.point.y,"] -> ")+"[".concat(X.rightSE.point.x,", ").concat(X.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(xn.size>yn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(mo.segments.length>Ai)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ne=mo.process(G),be=0,Oe=ne.length;be<Oe;be++){var Qe=ne[be];Qe.consumedBy===void 0&&xn.insert(Qe)}Wo=xn.size,Ki=xn.pop()}ft.reset();var ot=rn.factory(mo.segments),he=new ii(ot);return he.getGeom()}}]),Mt}(),Mi=new Pi,Hn=function(L){for(var re=arguments.length,fe=new Array(re>1?re-1:0),Ue=1;Ue<re;Ue++)fe[Ue-1]=arguments[Ue];return Mi.run("union",L,fe)},Ln=function(L){for(var re=arguments.length,fe=new Array(re>1?re-1:0),Ue=1;Ue<re;Ue++)fe[Ue-1]=arguments[Ue];return Mi.run("intersection",L,fe)},vo=function(L){for(var re=arguments.length,fe=new Array(re>1?re-1:0),Ue=1;Ue<re;Ue++)fe[Ue-1]=arguments[Ue];return Mi.run("xor",L,fe)},Xi=function(L){for(var re=arguments.length,fe=new Array(re>1?re-1:0),Ue=1;Ue<re;Ue++)fe[Ue-1]=arguments[Ue];return Mi.run("difference",L,fe)},Ya={union:Hn,intersection:Ln,xor:vo,difference:Xi};return Ya})},28660:function(Sr,Q,N){var _e=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var J;(function(y){(function(oe){var V=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=ie(y);typeof V.Reflect=="undefined"?V.Reflect=y:ce=ie(V.Reflect,ce),oe(ce);function ie(We,ae){return function(He,nt){typeof We[He]!="function"&&Object.defineProperty(We,He,{configurable:!0,writable:!0,value:nt}),ae&&ae(He,nt)}}})(function(oe){var V=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",ie=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",We=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ae=typeof Object.create=="function",He={__proto__:[]}instanceof Array,nt=!ae&&!He,ct={create:ae?function(){return Ar(Object.create(null))}:He?function(){return Ar({__proto__:null})}:function(){return Ar({})},has:nt?function(je,Tt){return V.call(je,Tt)}:function(je,Tt){return Tt in je},get:nt?function(je,Tt){return V.call(je,Tt)?je[Tt]:void 0}:function(je,Tt){return je[Tt]}},It=Object.getPrototypeOf(Function),tr=typeof _e=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",qt=!tr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ue(),ir=!tr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ht(),rr=!tr&&typeof WeakMap=="function"?WeakMap:Gt(),At=new rr;function gt(je,Tt,ar,wr){if(Lr(ar)){if(!Mi(je))throw new TypeError;if(!Ln(Tt))throw new TypeError;return Y(je,Tt)}else{if(!Mi(je))throw new TypeError;if(!Mn(Tt))throw new TypeError;if(!Mn(wr)&&!Lr(wr)&&!Vn(wr))throw new TypeError;return Vn(wr)&&(wr=void 0),ar=Pi(ar),Le(je,Tt,ar,wr)}}oe("decorate",gt);function Br(je,Tt){function ar(wr,$r){if(!Mn(wr))throw new TypeError;if(!Lr($r)&&!vo($r))throw new TypeError;xt(je,Tt,wr,$r)}return ar}oe("metadata",Br);function dr(je,Tt,ar,wr){if(!Mn(ar))throw new TypeError;return Lr(wr)||(wr=Pi(wr)),xt(je,Tt,ar,wr)}oe("defineMetadata",dr);function lr(je,Tt,ar){if(!Mn(Tt))throw new TypeError;return Lr(ar)||(ar=Pi(ar)),Me(je,Tt,ar)}oe("hasMetadata",lr);function _t(je,Tt,ar){if(!Mn(Tt))throw new TypeError;return Lr(ar)||(ar=Pi(ar)),we(je,Tt,ar)}oe("hasOwnMetadata",_t);function at(je,Tt,ar){if(!Mn(Tt))throw new TypeError;return Lr(ar)||(ar=Pi(ar)),ut(je,Tt,ar)}oe("getMetadata",at);function Ot(je,Tt,ar){if(!Mn(Tt))throw new TypeError;return Lr(ar)||(ar=Pi(ar)),yt(je,Tt,ar)}oe("getOwnMetadata",Ot);function ft(je,Tt){if(!Mn(je))throw new TypeError;return Lr(Tt)||(Tt=Pi(Tt)),jt(je,Tt)}oe("getMetadataKeys",ft);function Kt(je,Tt){if(!Mn(je))throw new TypeError;return Lr(Tt)||(Tt=Pi(Tt)),nr(je,Tt)}oe("getOwnMetadataKeys",Kt);function xr(je,Tt,ar){if(!Mn(Tt))throw new TypeError;Lr(ar)||(ar=Pi(ar));var wr=O(Tt,ar,!1);if(Lr(wr)||!wr.delete(je))return!1;if(wr.size>0)return!0;var $r=At.get(Tt);return $r.delete(ar),$r.size>0||At.delete(Tt),!0}oe("deleteMetadata",xr);function Y(je,Tt){for(var ar=je.length-1;ar>=0;--ar){var wr=je[ar],$r=wr(Tt);if(!Lr($r)&&!Vn($r)){if(!Ln($r))throw new TypeError;Tt=$r}}return Tt}function Le(je,Tt,ar,wr){for(var $r=je.length-1;$r>=0;--$r){var _n=je[$r],Cn=_n(Tt,ar,wr);if(!Lr(Cn)&&!Vn(Cn)){if(!Mn(Cn))throw new TypeError;wr=Cn}}return wr}function O(je,Tt,ar){var wr=At.get(je);if(Lr(wr)){if(!ar)return;wr=new qt,At.set(je,wr)}var $r=wr.get(Tt);if(Lr($r)){if(!ar)return;$r=new qt,wr.set(Tt,$r)}return $r}function Me(je,Tt,ar){var wr=we(je,Tt,ar);if(wr)return!0;var $r=fe(Tt);return Vn($r)?!1:Me(je,$r,ar)}function we(je,Tt,ar){var wr=O(Tt,ar,!1);return Lr(wr)?!1:yn(wr.has(je))}function ut(je,Tt,ar){var wr=we(je,Tt,ar);if(wr)return yt(je,Tt,ar);var $r=fe(Tt);if(!Vn($r))return ut(je,$r,ar)}function yt(je,Tt,ar){var wr=O(Tt,ar,!1);if(!Lr(wr))return wr.get(je)}function xt(je,Tt,ar,wr){var $r=O(ar,wr,!0);$r.set(je,Tt)}function jt(je,Tt){var ar=nr(je,Tt),wr=fe(je);if(wr===null)return ar;var $r=jt(wr,Tt);if($r.length<=0)return ar;if(ar.length<=0)return $r;for(var _n=new ir,Cn=[],xn=0,wn=ar;xn<wn.length;xn++){var ri=wn[xn],Kn=_n.has(ri);Kn||(_n.add(ri),Cn.push(ri))}for(var Yi=0,qi=$r;Yi<qi.length;Yi++){var ri=qi[Yi],Kn=_n.has(ri);Kn||(_n.add(ri),Cn.push(ri))}return Cn}function nr(je,Tt){var ar=[],wr=O(je,Tt,!1);if(Lr(wr))return ar;for(var $r=wr.keys(),_n=Ya($r),Cn=0;;){var xn=L(_n);if(!xn)return ar.length=Cn,ar;var wn=Mt(xn);try{ar[Cn]=wn}catch(ri){try{re(_n)}finally{throw ri}}Cn++}}function en(je){if(je===null)return 1;switch(typeof je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return je===null?1:6;default:return 6}}function Lr(je){return je===void 0}function Vn(je){return je===null}function rn(je){return typeof je=="symbol"}function Mn(je){return typeof je=="object"?je!==null:typeof je=="function"}function ii(je,Tt){switch(en(je)){case 0:return je;case 1:return je;case 2:return je;case 3:return je;case 4:return je;case 5:return je}var ar=Tt===3?"string":Tt===5?"number":"default",wr=Xi(je,ie);if(wr!==void 0){var $r=wr.call(je,ar);if(Mn($r))throw new TypeError;return $r}return Yn(je,ar==="default"?"number":ar)}function Yn(je,Tt){if(Tt==="string"){var ar=je.toString;if(Hn(ar)){var wr=ar.call(je);if(!Mn(wr))return wr}var $r=je.valueOf;if(Hn($r)){var wr=$r.call(je);if(!Mn(wr))return wr}}else{var $r=je.valueOf;if(Hn($r)){var wr=$r.call(je);if(!Mn(wr))return wr}var _n=je.toString;if(Hn(_n)){var wr=_n.call(je);if(!Mn(wr))return wr}}throw new TypeError}function yn(je){return!!je}function Ai(je){return""+je}function Pi(je){var Tt=ii(je,3);return rn(Tt)?Tt:Ai(Tt)}function Mi(je){return Array.isArray?Array.isArray(je):je instanceof Object?je instanceof Array:Object.prototype.toString.call(je)==="[object Array]"}function Hn(je){return typeof je=="function"}function Ln(je){return typeof je=="function"}function vo(je){switch(en(je)){case 3:return!0;case 4:return!0;default:return!1}}function Xi(je,Tt){var ar=je[Tt];if(ar!=null){if(!Hn(ar))throw new TypeError;return ar}}function Ya(je){var Tt=Xi(je,We);if(!Hn(Tt))throw new TypeError;var ar=Tt.call(je);if(!Mn(ar))throw new TypeError;return ar}function Mt(je){return je.value}function L(je){var Tt=je.next();return Tt.done?!1:Tt}function re(je){var Tt=je.return;Tt&&Tt.call(je)}function fe(je){var Tt=Object.getPrototypeOf(je);if(typeof je!="function"||je===It||Tt!==It)return Tt;var ar=je.prototype,wr=ar&&Object.getPrototypeOf(ar);if(wr==null||wr===Object.prototype)return Tt;var $r=wr.constructor;return typeof $r!="function"||$r===je?Tt:$r}function Ue(){var je={},Tt=[],ar=function(){function Cn(xn,wn,ri){this._index=0,this._keys=xn,this._values=wn,this._selector=ri}return Cn.prototype["@@iterator"]=function(){return this},Cn.prototype[We]=function(){return this},Cn.prototype.next=function(){var xn=this._index;if(xn>=0&&xn<this._keys.length){var wn=this._selector(this._keys[xn],this._values[xn]);return xn+1>=this._keys.length?(this._index=-1,this._keys=Tt,this._values=Tt):this._index++,{value:wn,done:!1}}return{value:void 0,done:!0}},Cn.prototype.throw=function(xn){throw this._index>=0&&(this._index=-1,this._keys=Tt,this._values=Tt),xn},Cn.prototype.return=function(xn){return this._index>=0&&(this._index=-1,this._keys=Tt,this._values=Tt),{value:xn,done:!0}},Cn}();return function(){function Cn(){this._keys=[],this._values=[],this._cacheKey=je,this._cacheIndex=-2}return Object.defineProperty(Cn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Cn.prototype.has=function(xn){return this._find(xn,!1)>=0},Cn.prototype.get=function(xn){var wn=this._find(xn,!1);return wn>=0?this._values[wn]:void 0},Cn.prototype.set=function(xn,wn){var ri=this._find(xn,!0);return this._values[ri]=wn,this},Cn.prototype.delete=function(xn){var wn=this._find(xn,!1);if(wn>=0){for(var ri=this._keys.length,Kn=wn+1;Kn<ri;Kn++)this._keys[Kn-1]=this._keys[Kn],this._values[Kn-1]=this._values[Kn];return this._keys.length--,this._values.length--,xn===this._cacheKey&&(this._cacheKey=je,this._cacheIndex=-2),!0}return!1},Cn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=je,this._cacheIndex=-2},Cn.prototype.keys=function(){return new ar(this._keys,this._values,wr)},Cn.prototype.values=function(){return new ar(this._keys,this._values,$r)},Cn.prototype.entries=function(){return new ar(this._keys,this._values,_n)},Cn.prototype["@@iterator"]=function(){return this.entries()},Cn.prototype[We]=function(){return this.entries()},Cn.prototype._find=function(xn,wn){return this._cacheKey!==xn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=xn)),this._cacheIndex<0&&wn&&(this._cacheIndex=this._keys.length,this._keys.push(xn),this._values.push(void 0)),this._cacheIndex},Cn}();function wr(Cn,xn){return Cn}function $r(Cn,xn){return xn}function _n(Cn,xn){return[Cn,xn]}}function ht(){return function(){function je(){this._map=new qt}return Object.defineProperty(je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),je.prototype.has=function(Tt){return this._map.has(Tt)},je.prototype.add=function(Tt){return this._map.set(Tt,Tt),this},je.prototype.delete=function(Tt){return this._map.delete(Tt)},je.prototype.clear=function(){this._map.clear()},je.prototype.keys=function(){return this._map.keys()},je.prototype.values=function(){return this._map.values()},je.prototype.entries=function(){return this._map.entries()},je.prototype["@@iterator"]=function(){return this.keys()},je.prototype[We]=function(){return this.keys()},je}()}function Gt(){var je=16,Tt=ct.create(),ar=wr();return function(){function wn(){this._key=wr()}return wn.prototype.has=function(ri){var Kn=$r(ri,!1);return Kn!==void 0?ct.has(Kn,this._key):!1},wn.prototype.get=function(ri){var Kn=$r(ri,!1);return Kn!==void 0?ct.get(Kn,this._key):void 0},wn.prototype.set=function(ri,Kn){var Yi=$r(ri,!0);return Yi[this._key]=Kn,this},wn.prototype.delete=function(ri){var Kn=$r(ri,!1);return Kn!==void 0?delete Kn[this._key]:!1},wn.prototype.clear=function(){this._key=wr()},wn}();function wr(){var wn;do wn="@@WeakMap@@"+xn();while(ct.has(Tt,wn));return Tt[wn]=!0,wn}function $r(wn,ri){if(!V.call(wn,ar)){if(!ri)return;Object.defineProperty(wn,ar,{value:ct.create()})}return wn[ar]}function _n(wn,ri){for(var Kn=0;Kn<ri;++Kn)wn[Kn]=Math.random()*255|0;return wn}function Cn(wn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(wn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(wn)):_n(new Uint8Array(wn),wn):_n(new Array(wn),wn)}function xn(){var wn=Cn(je);wn[6]=wn[6]&79|64,wn[8]=wn[8]&191|128;for(var ri="",Kn=0;Kn<je;++Kn){var Yi=wn[Kn];(Kn===4||Kn===6||Kn===8)&&(ri+="-"),Yi<16&&(ri+="0"),ri+=Yi.toString(16).toLowerCase()}return ri}}function Ar(je){return je.__=void 0,delete je.__,je}})})(J||(J={}))},81550:function(Sr){(function(Q,N){Sr.exports=N()})(this,function(){"use strict";var Q=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},N=function(B,Se){for(var ke=Object.keys(Se),zt=0;zt<ke.length;++zt)B[ke[zt]]=Se[ke[zt]];return B},_e=`
`;function J(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function y(B){var Se=new Error("(regl) "+B);throw console.error(Se),Se}function oe(B,Se){B||y(Se)}function V(B){return B?": "+B:""}function ce(B,Se,ke){B in Se||y("unknown parameter ("+B+")"+V(ke)+". possible values: "+Object.keys(Se).join())}function ie(B,Se){Q(B)||y("invalid parameter type"+V(Se)+". must be a typed array")}function We(B,Se){switch(Se){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function ae(B,Se,ke){We(B,Se)||y("invalid parameter type"+V(ke)+". expected "+Se+", got "+typeof B)}function He(B,Se){B>=0&&(B|0)===B||y("invalid parameter type, ("+B+")"+V(Se)+". must be a nonnegative integer")}function nt(B,Se,ke){Se.indexOf(B)<0&&y("invalid value"+V(ke)+". must be one of: "+Se)}var ct=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function It(B){Object.keys(B).forEach(function(Se){ct.indexOf(Se)<0&&y('invalid regl constructor argument "'+Se+'". must be one of '+ct)})}function tr(B,Se){for(B=B+"";B.length<Se;)B=" "+B;return B}function qt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ir(B,Se){this.number=B,this.line=Se,this.errors=[]}function rr(B,Se,ke){this.file=B,this.line=Se,this.message=ke}function At(){var B=new Error,Se=(B.stack||B).toString(),ke=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(ke)return ke[1];var zt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return zt?zt[1]:"unknown"}function gt(){var B=new Error,Se=(B.stack||B).toString(),ke=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(ke)return ke[1];var zt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return zt?zt[1]:"unknown"}function Br(B,Se){var ke=B.split(`
`),zt=1,sr=0,Dt={unknown:new qt,0:new qt};Dt.unknown.name=Dt[0].name=Se||At(),Dt.unknown.lines.push(new ir(0,""));for(var Xt=0;Xt<ke.length;++Xt){var kr=ke[Xt],Ir=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(kr);if(Ir)switch(Ir[1]){case"line":var Or=/(\d+)(\s+\d+)?/.exec(Ir[2]);Or&&(zt=Or[1]|0,Or[2]&&(sr=Or[2]|0,sr in Dt||(Dt[sr]=new qt)));break;case"define":var Cr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ir[2]);Cr&&(Dt[sr].name=Cr[1]?J(Cr[2]):Cr[2]);break}Dt[sr].lines.push(new ir(zt++,kr))}return Object.keys(Dt).forEach(function(zr){var Xr=Dt[zr];Xr.lines.forEach(function(Er){Xr.index[Er.number]=Er})}),Dt}function dr(B){var Se=[];return B.split(`
`).forEach(function(ke){if(!(ke.length<5)){var zt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ke);zt?Se.push(new rr(zt[1]|0,zt[2]|0,zt[3].trim())):ke.length>0&&Se.push(new rr("unknown",0,ke))}}),Se}function lr(B,Se){Se.forEach(function(ke){var zt=B[ke.file];if(zt){var sr=zt.index[ke.line];if(sr){sr.errors.push(ke),zt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(ke)})}function _t(B,Se,ke,zt,sr){if(!B.getShaderParameter(Se,B.COMPILE_STATUS)){var Dt=B.getShaderInfoLog(Se),Xt=zt===B.FRAGMENT_SHADER?"fragment":"vertex";Le(ke,"string",Xt+" shader source must be a string",sr);var kr=Br(ke,sr),Ir=dr(Dt);lr(kr,Ir),Object.keys(kr).forEach(function(Or){var Cr=kr[Or];if(!Cr.hasErrors)return;var zr=[""],Xr=[""];function Er(Vr,St){zr.push(Vr),Xr.push(St||"")}Er("file number "+Or+": "+Cr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Cr.lines.forEach(function(Vr){if(Vr.errors.length>0){Er(tr(Vr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Er(Vr.line+_e,"color:red; background-color:yellow; font-weight:bold");var St=0;Vr.errors.forEach(function(Vt){var Tr=Vt.message,Kr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Tr);if(Kr){var vr=Kr[1];switch(Tr=Kr[2],vr){case"assign":vr="=";break}St=Math.max(Vr.line.indexOf(vr,St),0)}else St=0;Er(tr("| ",6)),Er(tr("^^^",St+3)+_e,"font-weight:bold"),Er(tr("| ",6)),Er(Tr+_e,"font-weight:bold")}),Er(tr("| ",6)+_e)}else Er(tr(Vr.number,4)+"|  "),Er(Vr.line+_e,"color:red")}),typeof document!="undefined"&&!window.chrome?(Xr[0]=zr.join("%c"),console.log.apply(console,Xr)):console.log(zr.join(""))}),oe.raise("Error compiling "+Xt+" shader, "+kr[0].name)}}function at(B,Se,ke,zt,sr){if(!B.getProgramParameter(Se,B.LINK_STATUS)){var Dt=B.getProgramInfoLog(Se),Xt=Br(ke,sr),kr=Br(zt,sr),Ir='Error linking program with vertex shader, "'+kr[0].name+'", and fragment shader "'+Xt[0].name+'"';typeof document!="undefined"?console.log("%c"+Ir+_e+"%c"+Dt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ir+_e+Dt),oe.raise(Ir)}}function Ot(B){B._commandRef=At()}function ft(B,Se,ke,zt){Ot(B);function sr(Ir){return Ir?zt.id(Ir):0}B._fragId=sr(B.static.frag),B._vertId=sr(B.static.vert);function Dt(Ir,Or){Object.keys(Or).forEach(function(Cr){Ir[zt.id(Cr)]=!0})}var Xt=B._uniformSet={};Dt(Xt,Se.static),Dt(Xt,Se.dynamic);var kr=B._attributeSet={};Dt(kr,ke.static),Dt(kr,ke.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Kt(B,Se){var ke=gt();y(B+" in command "+(Se||At())+(ke==="unknown"?"":" called from "+ke))}function xr(B,Se,ke){B||Kt(Se,ke||At())}function Y(B,Se,ke,zt){B in Se||Kt("unknown parameter ("+B+")"+V(ke)+". possible values: "+Object.keys(Se).join(),zt||At())}function Le(B,Se,ke,zt){We(B,Se)||Kt("invalid parameter type"+V(ke)+". expected "+Se+", got "+typeof B,zt||At())}function O(B){B()}function Me(B,Se,ke){B.texture?nt(B.texture._texture.internalformat,Se,"unsupported texture format for attachment"):nt(B.renderbuffer._renderbuffer.format,ke,"unsupported renderbuffer format for attachment")}var we=33071,ut=9728,yt=9984,xt=9985,jt=9986,nr=9987,en=5120,Lr=5121,Vn=5122,rn=5123,Mn=5124,ii=5125,Yn=5126,yn=32819,Ai=32820,Pi=33635,Mi=34042,Hn=36193,Ln={};Ln[en]=Ln[Lr]=1,Ln[Vn]=Ln[rn]=Ln[Hn]=Ln[Pi]=Ln[yn]=Ln[Ai]=2,Ln[Mn]=Ln[ii]=Ln[Yn]=Ln[Mi]=4;function vo(B,Se){return B===Ai||B===yn||B===Pi?2:B===Mi?4:Ln[B]*Se}function Xi(B){return!(B&B-1)&&!!B}function Ya(B,Se,ke){var zt,sr=Se.width,Dt=Se.height,Xt=Se.channels;oe(sr>0&&sr<=ke.maxTextureSize&&Dt>0&&Dt<=ke.maxTextureSize,"invalid texture shape"),(B.wrapS!==we||B.wrapT!==we)&&oe(Xi(sr)&&Xi(Dt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?sr!==1&&Dt!==1&&oe(B.minFilter!==yt&&B.minFilter!==jt&&B.minFilter!==xt&&B.minFilter!==nr,"min filter requires mipmap"):(oe(Xi(sr)&&Xi(Dt),"texture must be a square power of 2 to support mipmapping"),oe(Se.mipmask===(sr<<1)-1,"missing or incomplete mipmap data")),Se.type===Yn&&(ke.extensions.indexOf("oes_texture_float_linear")<0&&oe(B.minFilter===ut&&B.magFilter===ut,"filter not supported, must enable oes_texture_float_linear"),oe(!B.genMipmaps,"mipmap generation not supported with float textures"));var kr=Se.images;for(zt=0;zt<16;++zt)if(kr[zt]){var Ir=sr>>zt,Or=Dt>>zt;oe(Se.mipmask&1<<zt,"missing mipmap data");var Cr=kr[zt];if(oe(Cr.width===Ir&&Cr.height===Or,"invalid shape for mip images"),oe(Cr.format===Se.format&&Cr.internalformat===Se.internalformat&&Cr.type===Se.type,"incompatible type for mip image"),!Cr.compressed)if(Cr.data){var zr=Math.ceil(vo(Cr.type,Xt)*Ir/Cr.unpackAlignment)*Cr.unpackAlignment;oe(Cr.data.byteLength===zr*Or,"invalid data for image, buffer size is inconsistent with image format")}else Cr.element||Cr.copy}else B.genMipmaps||oe((Se.mipmask&1<<zt)==0,"extra mipmap data");Se.compressed&&oe(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Mt(B,Se,ke,zt){var sr=B.width,Dt=B.height,Xt=B.channels;oe(sr>0&&sr<=zt.maxTextureSize&&Dt>0&&Dt<=zt.maxTextureSize,"invalid texture shape"),oe(sr===Dt,"cube map must be square"),oe(Se.wrapS===we&&Se.wrapT===we,"wrap mode not supported by cube map");for(var kr=0;kr<ke.length;++kr){var Ir=ke[kr];oe(Ir.width===sr&&Ir.height===Dt,"inconsistent cube map face shape"),Se.genMipmaps&&(oe(!Ir.compressed,"can not generate mipmap for compressed textures"),oe(Ir.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Or=Ir.images,Cr=0;Cr<16;++Cr){var zr=Or[Cr];if(zr){var Xr=sr>>Cr,Er=Dt>>Cr;oe(Ir.mipmask&1<<Cr,"missing mipmap data"),oe(zr.width===Xr&&zr.height===Er,"invalid shape for mip images"),oe(zr.format===B.format&&zr.internalformat===B.internalformat&&zr.type===B.type,"incompatible type for mip image"),zr.compressed||(zr.data?oe(zr.data.byteLength===Xr*Er*Math.max(vo(zr.type,Xt),zr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):zr.element||zr.copy)}}}}var L=N(oe,{optional:O,raise:y,commandRaise:Kt,command:xr,parameter:ce,commandParameter:Y,constructor:It,type:ae,commandType:Le,isTypedArray:ie,nni:He,oneOf:nt,shaderError:_t,linkError:at,callSite:gt,saveCommandRef:Ot,saveDrawInfo:ft,framebufferFormat:Me,guessCommand:At,texture2D:Ya,textureCube:Mt}),re=0,fe=0,Ue=5,ht=6;function Gt(B,Se){this.id=re++,this.type=B,this.data=Se}function Ar(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function je(B){if(B.length===0)return[];var Se=B.charAt(0),ke=B.charAt(B.length-1);if(B.length>1&&Se===ke&&(Se==='"'||Se==="'"))return['"'+Ar(B.substr(1,B.length-2))+'"'];var zt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(zt)return je(B.substr(0,zt.index)).concat(je(zt[1])).concat(je(B.substr(zt.index+zt[0].length)));var sr=B.split(".");if(sr.length===1)return['"'+Ar(B)+'"'];for(var Dt=[],Xt=0;Xt<sr.length;++Xt)Dt=Dt.concat(je(sr[Xt]));return Dt}function Tt(B){return"["+je(B).join("][")+"]"}function ar(B,Se){return new Gt(B,Tt(Se+""))}function wr(B){return typeof B=="function"&&!B._reglType||B instanceof Gt}function $r(B,Se){if(typeof B=="function")return new Gt(fe,B);if(typeof B=="number"||typeof B=="boolean")return new Gt(Ue,B);if(Array.isArray(B))return new Gt(ht,B.map((ke,zt)=>$r(ke,Se+"["+zt+"]")));if(B instanceof Gt)return B;L(!1,"invalid option type in uniform "+Se)}var _n={DynamicVariable:Gt,define:ar,isDynamic:wr,unbox:$r,accessor:Tt},Cn={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},xn=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function wn(){var B={"":0},Se=[""];return{id:function(ke){var zt=B[ke];return zt||(zt=B[ke]=Se.length,Se.push(ke),zt)},str:function(ke){return Se[ke]}}}function ri(B,Se,ke){var zt=document.createElement("canvas");N(zt.style,{border:0,margin:0,padding:0,top:0,left:0}),B.appendChild(zt),B===document.body&&(zt.style.position="absolute",N(B.style,{margin:0,padding:0}));function sr(){var kr=window.innerWidth,Ir=window.innerHeight;if(B!==document.body){var Or=B.getBoundingClientRect();kr=Or.right-Or.left,Ir=Or.bottom-Or.top}zt.width=ke*kr,zt.height=ke*Ir,N(zt.style,{width:kr+"px",height:Ir+"px"})}var Dt;B!==document.body&&typeof ResizeObserver=="function"?(Dt=new ResizeObserver(function(){setTimeout(sr)}),Dt.observe(B)):window.addEventListener("resize",sr,!1);function Xt(){Dt?Dt.disconnect():window.removeEventListener("resize",sr),B.removeChild(zt)}return sr(),{canvas:zt,onDestroy:Xt}}function Kn(B,Se){function ke(zt){try{return B.getContext(zt,Se)}catch(sr){return null}}return ke("webgl")||ke("experimental-webgl")||ke("webgl-experimental")}function Yi(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function qi(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function mo(B){return typeof B=="string"?B.split():(L(Array.isArray(B),"invalid extension array"),B)}function Wo(B){return typeof B=="string"?(L(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function Ki(B){var Se=B||{},ke,zt,sr,Dt,Xt={},kr=[],Ir=[],Or=typeof window=="undefined"?1:window.devicePixelRatio,Cr=!1,zr=function(Vr){Vr&&L.raise(Vr)},Xr=function(){};if(typeof Se=="string"?(L(typeof document!="undefined","selector queries only supported in DOM enviroments"),ke=document.querySelector(Se),L(ke,"invalid query string for element")):typeof Se=="object"?Yi(Se)?ke=Se:qi(Se)?(Dt=Se,sr=Dt.canvas):(L.constructor(Se),"gl"in Se?Dt=Se.gl:"canvas"in Se?sr=Wo(Se.canvas):"container"in Se&&(zt=Wo(Se.container)),"attributes"in Se&&(Xt=Se.attributes,L.type(Xt,"object","invalid context attributes")),"extensions"in Se&&(kr=mo(Se.extensions)),"optionalExtensions"in Se&&(Ir=mo(Se.optionalExtensions)),"onDone"in Se&&(L.type(Se.onDone,"function","invalid or missing onDone callback"),zr=Se.onDone),"profile"in Se&&(Cr=!!Se.profile),"pixelRatio"in Se&&(Or=+Se.pixelRatio,L(Or>0,"invalid pixel ratio"))):L.raise("invalid arguments to regl"),ke&&(ke.nodeName.toLowerCase()==="canvas"?sr=ke:zt=ke),!Dt){if(!sr){L(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Er=ri(zt||document.body,zr,Or);if(!Er)return null;sr=Er.canvas,Xr=Er.onDestroy}Xt.premultipliedAlpha===void 0&&(Xt.premultipliedAlpha=!0),Dt=Kn(sr,Xt)}return Dt?{gl:Dt,canvas:sr,container:zt,extensions:kr,optionalExtensions:Ir,pixelRatio:Or,profile:Cr,onDone:zr,onDestroy:Xr}:(Xr(),zr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(B,Se){var ke={};function zt(Xt){L.type(Xt,"string","extension name must be string");var kr=Xt.toLowerCase(),Ir;try{Ir=ke[kr]=B.getExtension(kr)}catch(Or){}return!!Ir}for(var sr=0;sr<Se.extensions.length;++sr){var Dt=Se.extensions[sr];if(!zt(Dt))return Se.onDestroy(),Se.onDone('"'+Dt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(zt),{extensions:ke,restore:function(){Object.keys(ke).forEach(function(Xt){if(ke[Xt]&&!zt(Xt))throw new Error("(regl): error restoring extension "+Xt)})}}}function X(B,Se){for(var ke=Array(B),zt=0;zt<B;++zt)ke[zt]=Se(zt);return ke}var ne=5120,be=5121,Oe=5122,Qe=5123,ot=5124,he=5125,K=5126;function xe(B){for(var Se=16;Se<=1<<28;Se*=16)if(B<=Se)return Se;return 0}function lt(B){var Se,ke;return Se=(B>65535)<<4,B>>>=Se,ke=(B>255)<<3,B>>>=ke,Se|=ke,ke=(B>15)<<2,B>>>=ke,Se|=ke,ke=(B>3)<<1,B>>>=ke,Se|=ke,Se|B>>1}function pt(){var B=X(8,function(){return[]});function Se(Dt){var Xt=xe(Dt),kr=B[lt(Xt)>>2];return kr.length>0?kr.pop():new ArrayBuffer(Xt)}function ke(Dt){B[lt(Dt.byteLength)>>2].push(Dt)}function zt(Dt,Xt){var kr=null;switch(Dt){case ne:kr=new Int8Array(Se(Xt),0,Xt);break;case be:kr=new Uint8Array(Se(Xt),0,Xt);break;case Oe:kr=new Int16Array(Se(2*Xt),0,Xt);break;case Qe:kr=new Uint16Array(Se(2*Xt),0,Xt);break;case ot:kr=new Int32Array(Se(4*Xt),0,Xt);break;case he:kr=new Uint32Array(Se(4*Xt),0,Xt);break;case K:kr=new Float32Array(Se(4*Xt),0,Xt);break;default:return null}return kr.length!==Xt?kr.subarray(0,Xt):kr}function sr(Dt){ke(Dt.buffer)}return{alloc:Se,free:ke,allocType:zt,freeType:sr}}var te=pt();te.zero=pt();var br=3408,bn=3410,cn=3411,Qt=3412,tn=3413,Hr=3414,qr=3415,si=33901,Jr=33902,fi=3379,zi=3386,ui=34921,wi=36347,bi=36348,oo=35661,ji=35660,fa=34930,mi=36349,li=34076,gi=34024,ha=7936,Ns=7937,Ji=7938,aa=35724,hl=34047,Fu=36063,pa=34852,qn=3553,oa=34067,Qi=34069,Mo=33984,Gi=6408,Po=5126,go=5121,Cs=36160,zo=36053,Dl=36064,yo=16384,Ea=function(B,Se){var ke=1;Se.ext_texture_filter_anisotropic&&(ke=B.getParameter(hl));var zt=1,sr=1;Se.webgl_draw_buffers&&(zt=B.getParameter(pa),sr=B.getParameter(Fu));var Dt=!!Se.oes_texture_float;if(Dt){var Xt=B.createTexture();B.bindTexture(qn,Xt),B.texImage2D(qn,0,Gi,1,1,0,Gi,Po,null);var kr=B.createFramebuffer();if(B.bindFramebuffer(Cs,kr),B.framebufferTexture2D(Cs,Dl,qn,Xt,0),B.bindTexture(qn,null),B.checkFramebufferStatus(Cs)!==zo)Dt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(yo);var Ir=te.allocType(Po,4);B.readPixels(0,0,1,1,Gi,Po,Ir),B.getError()?Dt=!1:(B.deleteFramebuffer(kr),B.deleteTexture(Xt),Dt=Ir[0]===1),te.freeType(Ir)}}var Or=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Cr=!0;if(!Or){var zr=B.createTexture(),Xr=te.allocType(go,36);B.activeTexture(Mo),B.bindTexture(oa,zr),B.texImage2D(Qi,0,Gi,3,3,0,Gi,go,Xr),te.freeType(Xr),B.bindTexture(oa,null),B.deleteTexture(zr),Cr=!B.getError()}return{colorBits:[B.getParameter(bn),B.getParameter(cn),B.getParameter(Qt),B.getParameter(tn)],depthBits:B.getParameter(Hr),stencilBits:B.getParameter(qr),subpixelBits:B.getParameter(br),extensions:Object.keys(Se).filter(function(Er){return!!Se[Er]}),maxAnisotropic:ke,maxDrawbuffers:zt,maxColorAttachments:sr,pointSizeDims:B.getParameter(si),lineWidthDims:B.getParameter(Jr),maxViewportDims:B.getParameter(zi),maxCombinedTextureUnits:B.getParameter(oo),maxCubeMapSize:B.getParameter(li),maxRenderbufferSize:B.getParameter(gi),maxTextureUnits:B.getParameter(fa),maxTextureSize:B.getParameter(fi),maxAttributes:B.getParameter(ui),maxVertexUniforms:B.getParameter(wi),maxVertexTextureUnits:B.getParameter(ji),maxVaryingVectors:B.getParameter(bi),maxFragmentUniforms:B.getParameter(mi),glsl:B.getParameter(aa),renderer:B.getParameter(Ns),vendor:B.getParameter(ha),version:B.getParameter(Ji),readFloat:Dt,npotTextureCube:Cr}};function _r(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||Q(B.data))}var Qr=function(B){return Object.keys(B).map(function(Se){return B[Se]})},ue={shape:Di,flatten:kn};function Te(B,Se,ke){for(var zt=0;zt<Se;++zt)ke[zt]=B[zt]}function it(B,Se,ke,zt){for(var sr=0,Dt=0;Dt<Se;++Dt)for(var Xt=B[Dt],kr=0;kr<ke;++kr)zt[sr++]=Xt[kr]}function Jt(B,Se,ke,zt,sr,Dt){for(var Xt=Dt,kr=0;kr<Se;++kr)for(var Ir=B[kr],Or=0;Or<ke;++Or)for(var Cr=Ir[Or],zr=0;zr<zt;++zr)sr[Xt++]=Cr[zr]}function Gr(B,Se,ke,zt,sr){for(var Dt=1,Xt=ke+1;Xt<Se.length;++Xt)Dt*=Se[Xt];var kr=Se[ke];if(Se.length-ke==4){var Ir=Se[ke+1],Or=Se[ke+2],Cr=Se[ke+3];for(Xt=0;Xt<kr;++Xt)Jt(B[Xt],Ir,Or,Cr,zt,sr),sr+=Dt}else for(Xt=0;Xt<kr;++Xt)Gr(B[Xt],Se,ke+1,zt,sr),sr+=Dt}function kn(B,Se,ke,zt){var sr=1;if(Se.length)for(var Dt=0;Dt<Se.length;++Dt)sr*=Se[Dt];else sr=0;var Xt=zt||te.allocType(ke,sr);switch(Se.length){case 0:break;case 1:Te(B,Se[0],Xt);break;case 2:it(B,Se[0],Se[1],Xt);break;case 3:Jt(B,Se[0],Se[1],Se[2],Xt,0);break;default:Gr(B,Se,0,Xt,0)}return Xt}function Di(B){for(var Se=[],ke=B;ke.length;ke=ke[0])Se.push(ke.length);return Se}var Oa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},so=5120,Ga=5122,os=5124,$o=5121,th=5123,Uc=5125,Ts=5126,Bu=5126,ss={int8:so,int16:Ga,int32:os,uint8:$o,uint16:th,uint32:Uc,float:Ts,float32:Bu},pl=35048,zu=35040,Zs={dynamic:pl,stream:zu,static:35044},Ol=ue.flatten,Xo=ue.shape,Fa=35044,Fl=35040,Vc=5121,gf=5126,Nu=[];Nu[5120]=1,Nu[5122]=2,Nu[5124]=4,Nu[5121]=1,Nu[5123]=2,Nu[5125]=4,Nu[5126]=4;function Bl(B){return Oa[Object.prototype.toString.call(B)]|0}function jc(B,Se){for(var ke=0;ke<Se.length;++ke)B[ke]=Se[ke]}function Gc(B,Se,ke,zt,sr,Dt,Xt){for(var kr=0,Ir=0;Ir<ke;++Ir)for(var Or=0;Or<zt;++Or)B[kr++]=Se[sr*Ir+Dt*Or+Xt]}function yf(B,Se,ke,zt){var sr=0,Dt={};function Xt(St){this.id=sr++,this.buffer=B.createBuffer(),this.type=St,this.usage=Fa,this.byteLength=0,this.dimension=1,this.dtype=Vc,this.persistentData=null,ke.profile&&(this.stats={size:0})}Xt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Xt.prototype.destroy=function(){Xr(this)};var kr=[];function Ir(St,Vt){var Tr=kr.pop();return Tr||(Tr=new Xt(St)),Tr.bind(),zr(Tr,Vt,Fl,0,1,!1),Tr}function Or(St){kr.push(St)}function Cr(St,Vt,Tr){St.byteLength=Vt.byteLength,B.bufferData(St.type,Vt,Tr)}function zr(St,Vt,Tr,Kr,vr,sn){var yr;if(St.usage=Tr,Array.isArray(Vt)){if(St.dtype=Kr||gf,Vt.length>0){var Zr;if(Array.isArray(Vt[0])){yr=Xo(Vt);for(var pr=1,Ur=1;Ur<yr.length;++Ur)pr*=yr[Ur];St.dimension=pr,Zr=Ol(Vt,yr,St.dtype),Cr(St,Zr,Tr),sn?St.persistentData=Zr:te.freeType(Zr)}else if(typeof Vt[0]=="number"){St.dimension=vr;var Nt=te.allocType(St.dtype,Vt.length);jc(Nt,Vt),Cr(St,Nt,Tr),sn?St.persistentData=Nt:te.freeType(Nt)}else Q(Vt[0])?(St.dimension=Vt[0].length,St.dtype=Kr||Bl(Vt[0])||gf,Zr=Ol(Vt,[Vt.length,Vt[0].length],St.dtype),Cr(St,Zr,Tr),sn?St.persistentData=Zr:te.freeType(Zr)):L.raise("invalid buffer data")}}else if(Q(Vt))St.dtype=Kr||Bl(Vt),St.dimension=vr,Cr(St,Vt,Tr),sn&&(St.persistentData=new Uint8Array(new Uint8Array(Vt.buffer)));else if(_r(Vt)){yr=Vt.shape;var Fn=Vt.stride,Ne=Vt.offset,gr=0,cr=0,Gn=0,Zn=0;yr.length===1?(gr=yr[0],cr=1,Gn=Fn[0],Zn=0):yr.length===2?(gr=yr[0],cr=yr[1],Gn=Fn[0],Zn=Fn[1]):L.raise("invalid shape"),St.dtype=Kr||Bl(Vt.data)||gf,St.dimension=cr;var Sn=te.allocType(St.dtype,gr*cr);Gc(Sn,Vt.data,gr,cr,Gn,Zn,Ne),Cr(St,Sn,Tr),sn?St.persistentData=Sn:te.freeType(Sn)}else Vt instanceof ArrayBuffer?(St.dtype=Vc,St.dimension=vr,Cr(St,Vt,Tr),sn&&(St.persistentData=new Uint8Array(new Uint8Array(Vt)))):L.raise("invalid buffer data")}function Xr(St){Se.bufferCount--,zt(St);var Vt=St.buffer;L(Vt,"buffer must not be deleted already"),B.deleteBuffer(Vt),St.buffer=null,delete Dt[St.id]}function Er(St,Vt,Tr,Kr){Se.bufferCount++;var vr=new Xt(Vt);Dt[vr.id]=vr;function sn(pr){var Ur=Fa,Nt=null,Fn=0,Ne=0,gr=1;return Array.isArray(pr)||Q(pr)||_r(pr)||pr instanceof ArrayBuffer?Nt=pr:typeof pr=="number"?Fn=pr|0:pr&&(L.type(pr,"object","buffer arguments must be an object, a number or an array"),"data"in pr&&(L(Nt===null||Array.isArray(Nt)||Q(Nt)||_r(Nt),"invalid data for buffer"),Nt=pr.data),"usage"in pr&&(L.parameter(pr.usage,Zs,"invalid buffer usage"),Ur=Zs[pr.usage]),"type"in pr&&(L.parameter(pr.type,ss,"invalid buffer type"),Ne=ss[pr.type]),"dimension"in pr&&(L.type(pr.dimension,"number","invalid dimension"),gr=pr.dimension|0),"length"in pr&&(L.nni(Fn,"buffer length must be a nonnegative integer"),Fn=pr.length|0)),vr.bind(),Nt?zr(vr,Nt,Ur,Ne,gr,Kr):(Fn&&B.bufferData(vr.type,Fn,Ur),vr.dtype=Ne||Vc,vr.usage=Ur,vr.dimension=gr,vr.byteLength=Fn),ke.profile&&(vr.stats.size=vr.byteLength*Nu[vr.dtype]),sn}function yr(pr,Ur){L(Ur+pr.byteLength<=vr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+pr.byteLength+" starting from offset "+Ur+" to a buffer of size "+vr.byteLength),B.bufferSubData(vr.type,Ur,pr)}function Zr(pr,Ur){var Nt=(Ur||0)|0,Fn;if(vr.bind(),Q(pr)||pr instanceof ArrayBuffer)yr(pr,Nt);else if(Array.isArray(pr)){if(pr.length>0)if(typeof pr[0]=="number"){var Ne=te.allocType(vr.dtype,pr.length);jc(Ne,pr),yr(Ne,Nt),te.freeType(Ne)}else if(Array.isArray(pr[0])||Q(pr[0])){Fn=Xo(pr);var gr=Ol(pr,Fn,vr.dtype);yr(gr,Nt),te.freeType(gr)}else L.raise("invalid buffer data")}else if(_r(pr)){Fn=pr.shape;var cr=pr.stride,Gn=0,Zn=0,Sn=0,hi=0;Fn.length===1?(Gn=Fn[0],Zn=1,Sn=cr[0],hi=0):Fn.length===2?(Gn=Fn[0],Zn=Fn[1],Sn=cr[0],hi=cr[1]):L.raise("invalid shape");var ni=Array.isArray(pr.data)?vr.dtype:Bl(pr.data),vi=te.allocType(ni,Gn*Zn);Gc(vi,pr.data,Gn,Zn,Sn,hi,pr.offset),yr(vi,Nt),te.freeType(vi)}else L.raise("invalid data for buffer subdata");return sn}return Tr||sn(St),sn._reglType="buffer",sn._buffer=vr,sn.subdata=Zr,ke.profile&&(sn.stats=vr.stats),sn.destroy=function(){Xr(vr)},sn}function Vr(){Qr(Dt).forEach(function(St){St.buffer=B.createBuffer(),B.bindBuffer(St.type,St.buffer),B.bufferData(St.type,St.persistentData||St.byteLength,St.usage)})}return ke.profile&&(Se.getTotalBufferSize=function(){var St=0;return Object.keys(Dt).forEach(function(Vt){St+=Dt[Vt].stats.size}),St}),{create:Er,createStream:Ir,destroyStream:Or,clear:function(){Qr(Dt).forEach(Xr),kr.forEach(Xr)},getBuffer:function(St){return St&&St._buffer instanceof Xt?St._buffer:null},restore:Vr,_initBuffer:zr}}var rh=0,nh=0,Hh=1,cc=1,fc=4,ih=4,Ba={points:rh,point:nh,lines:Hh,line:cc,triangles:fc,triangle:ih,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},_f=0,Zu=1,Ms=4,dl=5120,ei=5121,yu=5122,vs=5123,_u=5124,Yo=5125,Hc=34963,Ci=35040,Ei=35044;function Us(B,Se,ke,zt){var sr={},Dt=0,Xt={uint8:ei,uint16:vs};Se.oes_element_index_uint&&(Xt.uint32=Yo);function kr(Vr){this.id=Dt++,sr[this.id]=this,this.buffer=Vr,this.primType=Ms,this.vertCount=0,this.type=0}kr.prototype.bind=function(){this.buffer.bind()};var Ir=[];function Or(Vr){var St=Ir.pop();return St||(St=new kr(ke.create(null,Hc,!0,!1)._buffer)),zr(St,Vr,Ci,-1,-1,0,0),St}function Cr(Vr){Ir.push(Vr)}function zr(Vr,St,Vt,Tr,Kr,vr,sn){Vr.buffer.bind();var yr;if(St){var Zr=sn;!sn&&(!Q(St)||_r(St)&&!Q(St.data))&&(Zr=Se.oes_element_index_uint?Yo:vs),ke._initBuffer(Vr.buffer,St,Vt,Zr,3)}else B.bufferData(Hc,vr,Vt),Vr.buffer.dtype=yr||ei,Vr.buffer.usage=Vt,Vr.buffer.dimension=3,Vr.buffer.byteLength=vr;if(yr=sn,!sn){switch(Vr.buffer.dtype){case ei:case dl:yr=ei;break;case vs:case yu:yr=vs;break;case Yo:case _u:yr=Yo;break;default:L.raise("unsupported type for element array")}Vr.buffer.dtype=yr}Vr.type=yr,L(yr!==Yo||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var pr=Kr;pr<0&&(pr=Vr.buffer.byteLength,yr===vs?pr>>=1:yr===Yo&&(pr>>=2)),Vr.vertCount=pr;var Ur=Tr;if(Tr<0){Ur=Ms;var Nt=Vr.buffer.dimension;Nt===1&&(Ur=_f),Nt===2&&(Ur=Zu),Nt===3&&(Ur=Ms)}Vr.primType=Ur}function Xr(Vr){zt.elementsCount--,L(Vr.buffer!==null,"must not double destroy elements"),delete sr[Vr.id],Vr.buffer.destroy(),Vr.buffer=null}function Er(Vr,St){var Vt=ke.create(null,Hc,!0),Tr=new kr(Vt._buffer);zt.elementsCount++;function Kr(vr){if(!vr)Vt(),Tr.primType=Ms,Tr.vertCount=0,Tr.type=ei;else if(typeof vr=="number")Vt(vr),Tr.primType=Ms,Tr.vertCount=vr|0,Tr.type=ei;else{var sn=null,yr=Ei,Zr=-1,pr=-1,Ur=0,Nt=0;Array.isArray(vr)||Q(vr)||_r(vr)?sn=vr:(L.type(vr,"object","invalid arguments for elements"),"data"in vr&&(sn=vr.data,L(Array.isArray(sn)||Q(sn)||_r(sn),"invalid data for element buffer")),"usage"in vr&&(L.parameter(vr.usage,Zs,"invalid element buffer usage"),yr=Zs[vr.usage]),"primitive"in vr&&(L.parameter(vr.primitive,Ba,"invalid element buffer primitive"),Zr=Ba[vr.primitive]),"count"in vr&&(L(typeof vr.count=="number"&&vr.count>=0,"invalid vertex count for elements"),pr=vr.count|0),"type"in vr&&(L.parameter(vr.type,Xt,"invalid buffer type"),Nt=Xt[vr.type]),"length"in vr?Ur=vr.length|0:(Ur=pr,Nt===vs||Nt===yu?Ur*=2:(Nt===Yo||Nt===_u)&&(Ur*=4))),zr(Tr,sn,yr,Zr,pr,Ur,Nt)}return Kr}return Kr(Vr),Kr._reglType="elements",Kr._elements=Tr,Kr.subdata=function(vr,sn){return Vt.subdata(vr,sn),Kr},Kr.destroy=function(){Xr(Tr)},Kr}return{create:Er,createStream:Or,destroyStream:Cr,getElements:function(Vr){return typeof Vr=="function"&&Vr._elements instanceof kr?Vr._elements:null},clear:function(){Qr(sr).forEach(Xr)}}}var Vs=new Float32Array(1),ah=new Uint32Array(Vs.buffer),xf=5123;function hc(B){for(var Se=te.allocType(xf,B.length),ke=0;ke<B.length;++ke)if(isNaN(B[ke]))Se[ke]=65535;else if(B[ke]===Infinity)Se[ke]=31744;else if(B[ke]===-Infinity)Se[ke]=64512;else{Vs[0]=B[ke];var zt=ah[0],sr=zt>>>31<<15,Dt=(zt<<1>>>24)-127,Xt=zt>>13&(1<<10)-1;if(Dt<-24)Se[ke]=sr;else if(Dt<-14){var kr=-14-Dt;Se[ke]=sr+(Xt+(1<<10)>>kr)}else Dt>15?Se[ke]=sr+31744:Se[ke]=sr+(Dt+15<<10)+Xt}return Se}function za(B){return Array.isArray(B)||Q(B)}var Uu=function(B){return!(B&B-1)&&!!B},xu=34467,No=3553,bf=34067,pc=34069,ea=6408,nu=6406,zl=6407,iu=6409,au=6410,Sf=32854,bu=32855,Hi=36194,dc=32819,vl=32820,Nl=33635,Wc=34042,wf=6402,vc=34041,mc=35904,js=35906,Su=36193,gc=33776,ml=33777,wu=33778,Ef=33779,Eu=35986,ks=35987,yc=34798,Zl=35840,Af=35841,Vu=35842,gl=35843,$c=36196,Au=5121,ju=5123,oh=5125,Gu=5126,Cf=10242,sh=10243,_o=10497,_c=33071,uh=33648,lh=10240,Tf=10241,Ul=9728,Vl=9729,Gs=9984,ta=9985,jl=9986,ou=9987,Hu=33170,yi=4352,sa=4353,ms=4354,Xc=34046,us=3317,xc=37440,Wh=37441,Tp=37443,bc=37444,Cu=33984,Wu=[Gs,jl,ta,ou],Na=[0,iu,au,zl,ea],xo={};xo[iu]=xo[nu]=xo[wf]=1,xo[vc]=xo[au]=2,xo[zl]=xo[mc]=3,xo[ea]=xo[js]=4;function yl(B){return"[object "+B+"]"}var Aa=yl("HTMLCanvasElement"),dn=yl("OffscreenCanvas"),ls=yl("CanvasRenderingContext2D"),Sc=yl("ImageBitmap"),$u=yl("HTMLImageElement"),Is=yl("HTMLVideoElement"),cs=Object.keys(Oa).concat([Aa,dn,ls,Sc,$u,Is]),_l=[];_l[Au]=1,_l[Gu]=4,_l[Su]=2,_l[ju]=2,_l[oh]=4;var Rr=[];Rr[Sf]=2,Rr[bu]=2,Rr[Hi]=2,Rr[vc]=4,Rr[gc]=.5,Rr[ml]=.5,Rr[wu]=1,Rr[Ef]=1,Rr[Eu]=.5,Rr[ks]=1,Rr[yc]=1,Rr[Zl]=.5,Rr[Af]=.25,Rr[Vu]=.5,Rr[gl]=.25,Rr[$c]=.5;function Yc(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function Gl(B){if(!Array.isArray(B))return!1;var Se=B.length;return!(Se===0||!za(B[0]))}function Xu(B){return Object.prototype.toString.call(B)}function gs(B){return Xu(B)===Aa}function qo(B){return Xu(B)===dn}function qc(B){return Xu(B)===ls}function Kc(B){return Xu(B)===Sc}function Ko(B){return Xu(B)===$u}function Tu(B){return Xu(B)===Is}function Jc(B){if(!B)return!1;var Se=Xu(B);return cs.indexOf(Se)>=0?!0:Yc(B)||Gl(B)||_r(B)}function Yu(B){return Oa[Object.prototype.toString.call(B)]|0}function wc(B,Se){var ke=Se.length;switch(B.type){case Au:case ju:case oh:case Gu:var zt=te.allocType(B.type,ke);zt.set(Se),B.data=zt;break;case Su:B.data=hc(Se);break;default:L.raise("unsupported texture type, must specify a typed array")}}function Qc(B,Se){return te.allocType(B.type===Su?Gu:B.type,Se)}function Pt(B,Se){B.type===Su?(B.data=hc(Se),te.freeType(Se)):B.data=Se}function Ie(B,Se,ke,zt,sr,Dt){for(var Xt=B.width,kr=B.height,Ir=B.channels,Or=Xt*kr*Ir,Cr=Qc(B,Or),zr=0,Xr=0;Xr<kr;++Xr)for(var Er=0;Er<Xt;++Er)for(var Vr=0;Vr<Ir;++Vr)Cr[zr++]=Se[ke*Er+zt*Xr+sr*Vr+Dt];Pt(B,Cr)}function F(B,Se,ke,zt,sr,Dt){var Xt;if(typeof Rr[B]!="undefined"?Xt=Rr[B]:Xt=xo[B]*_l[Se],Dt&&(Xt*=6),sr){for(var kr=0,Ir=ke;Ir>=1;)kr+=Xt*Ir*Ir,Ir/=2;return kr}else return Xt*ke*zt}function su(B,Se,ke,zt,sr,Dt,Xt){var kr={"don't care":yi,"dont care":yi,nice:ms,fast:sa},Ir={repeat:_o,clamp:_c,mirror:uh},Or={nearest:Ul,linear:Vl},Cr=N({mipmap:ou,"nearest mipmap nearest":Gs,"linear mipmap nearest":ta,"nearest mipmap linear":jl,"linear mipmap linear":ou},Or),zr={none:0,browser:bc},Xr={uint8:Au,rgba4:dc,rgb565:Nl,"rgb5 a1":vl},Er={alpha:nu,luminance:iu,"luminance alpha":au,rgb:zl,rgba:ea,rgba4:Sf,"rgb5 a1":bu,rgb565:Hi},Vr={};Se.ext_srgb&&(Er.srgb=mc,Er.srgba=js),Se.oes_texture_float&&(Xr.float32=Xr.float=Gu),Se.oes_texture_half_float&&(Xr.float16=Xr["half float"]=Su),Se.webgl_depth_texture&&(N(Er,{depth:wf,"depth stencil":vc}),N(Xr,{uint16:ju,uint32:oh,"depth stencil":Wc})),Se.webgl_compressed_texture_s3tc&&N(Vr,{"rgb s3tc dxt1":gc,"rgba s3tc dxt1":ml,"rgba s3tc dxt3":wu,"rgba s3tc dxt5":Ef}),Se.webgl_compressed_texture_atc&&N(Vr,{"rgb atc":Eu,"rgba atc explicit alpha":ks,"rgba atc interpolated alpha":yc}),Se.webgl_compressed_texture_pvrtc&&N(Vr,{"rgb pvrtc 4bppv1":Zl,"rgb pvrtc 2bppv1":Af,"rgba pvrtc 4bppv1":Vu,"rgba pvrtc 2bppv1":gl}),Se.webgl_compressed_texture_etc1&&(Vr["rgb etc1"]=$c);var St=Array.prototype.slice.call(B.getParameter(xu));Object.keys(Vr).forEach(function(De){var Ft=Vr[De];St.indexOf(Ft)>=0&&(Er[De]=Ft)});var Vt=Object.keys(Er);ke.textureFormats=Vt;var Tr=[];Object.keys(Er).forEach(function(De){var Ft=Er[De];Tr[Ft]=De});var Kr=[];Object.keys(Xr).forEach(function(De){var Ft=Xr[De];Kr[Ft]=De});var vr=[];Object.keys(Or).forEach(function(De){var Ft=Or[De];vr[Ft]=De});var sn=[];Object.keys(Cr).forEach(function(De){var Ft=Cr[De];sn[Ft]=De});var yr=[];Object.keys(Ir).forEach(function(De){var Ft=Ir[De];yr[Ft]=De});var Zr=Vt.reduce(function(De,Ft){var Rt=Er[Ft];return Rt===iu||Rt===nu||Rt===iu||Rt===au||Rt===wf||Rt===vc||Se.ext_srgb&&(Rt===mc||Rt===js)?De[Rt]=Rt:Rt===bu||Ft.indexOf("rgba")>=0?De[Rt]=ea:De[Rt]=zl,De},{});function pr(){this.internalformat=ea,this.format=ea,this.type=Au,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=bc,this.width=0,this.height=0,this.channels=0}function Ur(De,Ft){De.internalformat=Ft.internalformat,De.format=Ft.format,De.type=Ft.type,De.compressed=Ft.compressed,De.premultiplyAlpha=Ft.premultiplyAlpha,De.flipY=Ft.flipY,De.unpackAlignment=Ft.unpackAlignment,De.colorSpace=Ft.colorSpace,De.width=Ft.width,De.height=Ft.height,De.channels=Ft.channels}function Nt(De,Ft){if(!(typeof Ft!="object"||!Ft)){if("premultiplyAlpha"in Ft&&(L.type(Ft.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),De.premultiplyAlpha=Ft.premultiplyAlpha),"flipY"in Ft&&(L.type(Ft.flipY,"boolean","invalid texture flip"),De.flipY=Ft.flipY),"alignment"in Ft&&(L.oneOf(Ft.alignment,[1,2,4,8],"invalid texture unpack alignment"),De.unpackAlignment=Ft.alignment),"colorSpace"in Ft&&(L.parameter(Ft.colorSpace,zr,"invalid colorSpace"),De.colorSpace=zr[Ft.colorSpace]),"type"in Ft){var Rt=Ft.type;L(Se.oes_texture_float||!(Rt==="float"||Rt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),L(Se.oes_texture_half_float||!(Rt==="half float"||Rt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),L(Se.webgl_depth_texture||!(Rt==="uint16"||Rt==="uint32"||Rt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),L.parameter(Rt,Xr,"invalid texture type"),De.type=Xr[Rt]}var vn=De.width,xi=De.height,Ce=De.channels,de=!1;"shape"in Ft?(L(Array.isArray(Ft.shape)&&Ft.shape.length>=2,"shape must be an array"),vn=Ft.shape[0],xi=Ft.shape[1],Ft.shape.length===3&&(Ce=Ft.shape[2],L(Ce>0&&Ce<=4,"invalid number of channels"),de=!0),L(vn>=0&&vn<=ke.maxTextureSize,"invalid width"),L(xi>=0&&xi<=ke.maxTextureSize,"invalid height")):("radius"in Ft&&(vn=xi=Ft.radius,L(vn>=0&&vn<=ke.maxTextureSize,"invalid radius")),"width"in Ft&&(vn=Ft.width,L(vn>=0&&vn<=ke.maxTextureSize,"invalid width")),"height"in Ft&&(xi=Ft.height,L(xi>=0&&xi<=ke.maxTextureSize,"invalid height")),"channels"in Ft&&(Ce=Ft.channels,L(Ce>0&&Ce<=4,"invalid number of channels"),de=!0)),De.width=vn|0,De.height=xi|0,De.channels=Ce|0;var qe=!1;if("format"in Ft){var mt=Ft.format;L(Se.webgl_depth_texture||!(mt==="depth"||mt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),L.parameter(mt,Er,"invalid texture format");var bt=De.internalformat=Er[mt];De.format=Zr[bt],mt in Xr&&("type"in Ft||(De.type=Xr[mt])),mt in Vr&&(De.compressed=!0),qe=!0}!de&&qe?De.channels=xo[De.format]:de&&!qe?De.channels!==Na[De.format]&&(De.format=De.internalformat=Na[De.channels]):qe&&de&&L(De.channels===xo[De.format],"number of channels inconsistent with specified format")}}function Fn(De){B.pixelStorei(xc,De.flipY),B.pixelStorei(Wh,De.premultiplyAlpha),B.pixelStorei(Tp,De.colorSpace),B.pixelStorei(us,De.unpackAlignment)}function Ne(){pr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function gr(De,Ft){var Rt=null;if(Jc(Ft)?Rt=Ft:Ft&&(L.type(Ft,"object","invalid pixel data type"),Nt(De,Ft),"x"in Ft&&(De.xOffset=Ft.x|0),"y"in Ft&&(De.yOffset=Ft.y|0),Jc(Ft.data)&&(Rt=Ft.data)),L(!De.compressed||Rt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ft.copy){L(!Rt,"can not specify copy and data field for the same texture");var vn=sr.viewportWidth,xi=sr.viewportHeight;De.width=De.width||vn-De.xOffset,De.height=De.height||xi-De.yOffset,De.needsCopy=!0,L(De.xOffset>=0&&De.xOffset<vn&&De.yOffset>=0&&De.yOffset<xi&&De.width>0&&De.width<=vn&&De.height>0&&De.height<=xi,"copy texture read out of bounds")}else if(!Rt)De.width=De.width||1,De.height=De.height||1,De.channels=De.channels||4;else if(Q(Rt))De.channels=De.channels||4,De.data=Rt,!("type"in Ft)&&De.type===Au&&(De.type=Yu(Rt));else if(Yc(Rt))De.channels=De.channels||4,wc(De,Rt),De.alignment=1,De.needsFree=!0;else if(_r(Rt)){var Ce=Rt.data;!Array.isArray(Ce)&&De.type===Au&&(De.type=Yu(Ce));var de=Rt.shape,qe=Rt.stride,mt,bt,et,Ke,Je,Ae;de.length===3?(et=de[2],Ae=qe[2]):(L(de.length===2,"invalid ndarray pixel data, must be 2 or 3D"),et=1,Ae=1),mt=de[0],bt=de[1],Ke=qe[0],Je=qe[1],De.alignment=1,De.width=mt,De.height=bt,De.channels=et,De.format=De.internalformat=Na[et],De.needsFree=!0,Ie(De,Ce,Ke,Je,Ae,Rt.offset)}else if(gs(Rt)||qo(Rt)||qc(Rt))gs(Rt)||qo(Rt)?De.element=Rt:De.element=Rt.canvas,De.width=De.element.width,De.height=De.element.height,De.channels=4;else if(Kc(Rt))De.element=Rt,De.width=Rt.width,De.height=Rt.height,De.channels=4;else if(Ko(Rt))De.element=Rt,De.width=Rt.naturalWidth,De.height=Rt.naturalHeight,De.channels=4;else if(Tu(Rt))De.element=Rt,De.width=Rt.videoWidth,De.height=Rt.videoHeight,De.channels=4;else if(Gl(Rt)){var $e=De.width||Rt[0].length,Ee=De.height||Rt.length,vt=De.channels;za(Rt[0][0])?vt=vt||Rt[0][0].length:vt=vt||1;for(var Et=ue.shape(Rt),or=1,Bt=0;Bt<Et.length;++Bt)or*=Et[Bt];var er=Qc(De,or);ue.flatten(Rt,Et,"",er),Pt(De,er),De.alignment=1,De.width=$e,De.height=Ee,De.channels=vt,De.format=De.internalformat=Na[vt],De.needsFree=!0}De.type===Gu?L(ke.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):De.type===Su&&L(ke.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function cr(De,Ft,Rt){var vn=De.element,xi=De.data,Ce=De.internalformat,de=De.format,qe=De.type,mt=De.width,bt=De.height;Fn(De),vn?B.texImage2D(Ft,Rt,de,de,qe,vn):De.compressed?B.compressedTexImage2D(Ft,Rt,Ce,mt,bt,0,xi):De.needsCopy?(zt(),B.copyTexImage2D(Ft,Rt,de,De.xOffset,De.yOffset,mt,bt,0)):B.texImage2D(Ft,Rt,de,mt,bt,0,de,qe,xi||null)}function Gn(De,Ft,Rt,vn,xi){var Ce=De.element,de=De.data,qe=De.internalformat,mt=De.format,bt=De.type,et=De.width,Ke=De.height;Fn(De),Ce?B.texSubImage2D(Ft,xi,Rt,vn,mt,bt,Ce):De.compressed?B.compressedTexSubImage2D(Ft,xi,Rt,vn,qe,et,Ke,de):De.needsCopy?(zt(),B.copyTexSubImage2D(Ft,xi,Rt,vn,De.xOffset,De.yOffset,et,Ke)):B.texSubImage2D(Ft,xi,Rt,vn,et,Ke,mt,bt,de)}var Zn=[];function Sn(){return Zn.pop()||new Ne}function hi(De){De.needsFree&&te.freeType(De.data),Ne.call(De),Zn.push(De)}function ni(){pr.call(this),this.genMipmaps=!1,this.mipmapHint=yi,this.mipmask=0,this.images=Array(16)}function vi(De,Ft,Rt){var vn=De.images[0]=Sn();De.mipmask=1,vn.width=De.width=Ft,vn.height=De.height=Rt,vn.channels=De.channels=4}function Fi(De,Ft){var Rt=null;if(Jc(Ft))Rt=De.images[0]=Sn(),Ur(Rt,De),gr(Rt,Ft),De.mipmask=1;else if(Nt(De,Ft),Array.isArray(Ft.mipmap))for(var vn=Ft.mipmap,xi=0;xi<vn.length;++xi)Rt=De.images[xi]=Sn(),Ur(Rt,De),Rt.width>>=xi,Rt.height>>=xi,gr(Rt,vn[xi]),De.mipmask|=1<<xi;else Rt=De.images[0]=Sn(),Ur(Rt,De),gr(Rt,Ft),De.mipmask=1;Ur(De,De.images[0]),De.compressed&&(De.internalformat===gc||De.internalformat===ml||De.internalformat===wu||De.internalformat===Ef)&&L(De.width%4==0&&De.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ua(De,Ft){for(var Rt=De.images,vn=0;vn<Rt.length;++vn){if(!Rt[vn])return;cr(Rt[vn],Ft,vn)}}var wo=[];function Si(){var De=wo.pop()||new ni;pr.call(De),De.mipmask=0;for(var Ft=0;Ft<16;++Ft)De.images[Ft]=null;return De}function ba(De){for(var Ft=De.images,Rt=0;Rt<Ft.length;++Rt)Ft[Rt]&&hi(Ft[Rt]),Ft[Rt]=null;wo.push(De)}function ua(){this.minFilter=Ul,this.magFilter=Ul,this.wrapS=_c,this.wrapT=_c,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=yi}function Wa(De,Ft){if("min"in Ft){var Rt=Ft.min;L.parameter(Rt,Cr),De.minFilter=Cr[Rt],Wu.indexOf(De.minFilter)>=0&&!("faces"in Ft)&&(De.genMipmaps=!0)}if("mag"in Ft){var vn=Ft.mag;L.parameter(vn,Or),De.magFilter=Or[vn]}var xi=De.wrapS,Ce=De.wrapT;if("wrap"in Ft){var de=Ft.wrap;typeof de=="string"?(L.parameter(de,Ir),xi=Ce=Ir[de]):Array.isArray(de)&&(L.parameter(de[0],Ir),L.parameter(de[1],Ir),xi=Ir[de[0]],Ce=Ir[de[1]])}else{if("wrapS"in Ft){var qe=Ft.wrapS;L.parameter(qe,Ir),xi=Ir[qe]}if("wrapT"in Ft){var mt=Ft.wrapT;L.parameter(mt,Ir),Ce=Ir[mt]}}if(De.wrapS=xi,De.wrapT=Ce,"anisotropic"in Ft){var bt=Ft.anisotropic;L(typeof bt=="number"&&bt>=1&&bt<=ke.maxAnisotropic,"aniso samples must be between 1 and "),De.anisotropic=Ft.anisotropic}if("mipmap"in Ft){var et=!1;switch(typeof Ft.mipmap){case"string":L.parameter(Ft.mipmap,kr,"invalid mipmap hint"),De.mipmapHint=kr[Ft.mipmap],De.genMipmaps=!0,et=!0;break;case"boolean":et=De.genMipmaps=Ft.mipmap;break;case"object":L(Array.isArray(Ft.mipmap),"invalid mipmap type"),De.genMipmaps=!1,et=!0;break;default:L.raise("invalid mipmap type")}et&&!("min"in Ft)&&(De.minFilter=Gs)}}function lo(De,Ft){B.texParameteri(Ft,Tf,De.minFilter),B.texParameteri(Ft,lh,De.magFilter),B.texParameteri(Ft,Cf,De.wrapS),B.texParameteri(Ft,sh,De.wrapT),Se.ext_texture_filter_anisotropic&&B.texParameteri(Ft,Xc,De.anisotropic),De.genMipmaps&&(B.hint(Hu,De.mipmapHint),B.generateMipmap(Ft))}var Eo=0,Io={},Do=ke.maxTextureUnits,$a=Array(Do).map(function(){return null});function pi(De){pr.call(this),this.mipmask=0,this.internalformat=ea,this.id=Eo++,this.refCount=1,this.target=De,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ua,Xt.profile&&(this.stats={size:0})}function jo(De){B.activeTexture(Cu),B.bindTexture(De.target,De.texture)}function Wi(){var De=$a[0];De?B.bindTexture(De.target,De.texture):B.bindTexture(No,null)}function Un(De){var Ft=De.texture;L(Ft,"must not double destroy texture");var Rt=De.unit,vn=De.target;Rt>=0&&(B.activeTexture(Cu+Rt),B.bindTexture(vn,null),$a[Rt]=null),B.deleteTexture(Ft),De.texture=null,De.params=null,De.pixels=null,De.refCount=0,delete Io[De.id],Dt.textureCount--}N(pi.prototype,{bind:function(){var De=this;De.bindCount+=1;var Ft=De.unit;if(Ft<0){for(var Rt=0;Rt<Do;++Rt){var vn=$a[Rt];if(vn){if(vn.bindCount>0)continue;vn.unit=-1}$a[Rt]=De,Ft=Rt;break}Ft>=Do&&L.raise("insufficient number of texture units"),Xt.profile&&Dt.maxTextureUnits<Ft+1&&(Dt.maxTextureUnits=Ft+1),De.unit=Ft,B.activeTexture(Cu+Ft),B.bindTexture(De.target,De.texture)}return Ft},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Un(this)}});function _i(De,Ft){var Rt=new pi(No);Io[Rt.id]=Rt,Dt.textureCount++;function vn(de,qe){var mt=Rt.texInfo;ua.call(mt);var bt=Si();return typeof de=="number"?typeof qe=="number"?vi(bt,de|0,qe|0):vi(bt,de|0,de|0):de?(L.type(de,"object","invalid arguments to regl.texture"),Wa(mt,de),Fi(bt,de)):vi(bt,1,1),mt.genMipmaps&&(bt.mipmask=(bt.width<<1)-1),Rt.mipmask=bt.mipmask,Ur(Rt,bt),L.texture2D(mt,bt,ke),Rt.internalformat=bt.internalformat,vn.width=bt.width,vn.height=bt.height,jo(Rt),Ua(bt,No),lo(mt,No),Wi(),ba(bt),Xt.profile&&(Rt.stats.size=F(Rt.internalformat,Rt.type,bt.width,bt.height,mt.genMipmaps,!1)),vn.format=Tr[Rt.internalformat],vn.type=Kr[Rt.type],vn.mag=vr[mt.magFilter],vn.min=sn[mt.minFilter],vn.wrapS=yr[mt.wrapS],vn.wrapT=yr[mt.wrapT],vn}function xi(de,qe,mt,bt){L(!!de,"must specify image data");var et=qe|0,Ke=mt|0,Je=bt|0,Ae=Sn();return Ur(Ae,Rt),Ae.width=0,Ae.height=0,gr(Ae,de),Ae.width=Ae.width||(Rt.width>>Je)-et,Ae.height=Ae.height||(Rt.height>>Je)-Ke,L(Rt.type===Ae.type&&Rt.format===Ae.format&&Rt.internalformat===Ae.internalformat,"incompatible format for texture.subimage"),L(et>=0&&Ke>=0&&et+Ae.width<=Rt.width&&Ke+Ae.height<=Rt.height,"texture.subimage write out of bounds"),L(Rt.mipmask&1<<Je,"missing mipmap data"),L(Ae.data||Ae.element||Ae.needsCopy,"missing image data"),jo(Rt),Gn(Ae,No,et,Ke,Je),Wi(),hi(Ae),vn}function Ce(de,qe){var mt=de|0,bt=qe|0||mt;if(mt===Rt.width&&bt===Rt.height)return vn;vn.width=Rt.width=mt,vn.height=Rt.height=bt,jo(Rt);for(var et=0;Rt.mipmask>>et;++et){var Ke=mt>>et,Je=bt>>et;if(!Ke||!Je)break;B.texImage2D(No,et,Rt.format,Ke,Je,0,Rt.format,Rt.type,null)}return Wi(),Xt.profile&&(Rt.stats.size=F(Rt.internalformat,Rt.type,mt,bt,!1,!1)),vn}return vn(De,Ft),vn.subimage=xi,vn.resize=Ce,vn._reglType="texture2d",vn._texture=Rt,Xt.profile&&(vn.stats=Rt.stats),vn.destroy=function(){Rt.decRef()},vn}function Ii(De,Ft,Rt,vn,xi,Ce){var de=new pi(bf);Io[de.id]=de,Dt.cubeCount++;var qe=new Array(6);function mt(Ke,Je,Ae,$e,Ee,vt){var Et,or=de.texInfo;for(ua.call(or),Et=0;Et<6;++Et)qe[Et]=Si();if(typeof Ke=="number"||!Ke){var Bt=Ke|0||1;for(Et=0;Et<6;++Et)vi(qe[Et],Bt,Bt)}else if(typeof Ke=="object")if(Je)Fi(qe[0],Ke),Fi(qe[1],Je),Fi(qe[2],Ae),Fi(qe[3],$e),Fi(qe[4],Ee),Fi(qe[5],vt);else if(Wa(or,Ke),Nt(de,Ke),"faces"in Ke){var er=Ke.faces;for(L(Array.isArray(er)&&er.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)L(typeof er[Et]=="object"&&!!er[Et],"invalid input for cube map face"),Ur(qe[Et],de),Fi(qe[Et],er[Et])}else for(Et=0;Et<6;++Et)Fi(qe[Et],Ke);else L.raise("invalid arguments to cube map");for(Ur(de,qe[0]),ke.npotTextureCube||L(Uu(de.width)&&Uu(de.height),"your browser does not support non power or two texture dimensions"),or.genMipmaps?de.mipmask=(qe[0].width<<1)-1:de.mipmask=qe[0].mipmask,L.textureCube(de,or,qe,ke),de.internalformat=qe[0].internalformat,mt.width=qe[0].width,mt.height=qe[0].height,jo(de),Et=0;Et<6;++Et)Ua(qe[Et],pc+Et);for(lo(or,bf),Wi(),Xt.profile&&(de.stats.size=F(de.internalformat,de.type,mt.width,mt.height,or.genMipmaps,!0)),mt.format=Tr[de.internalformat],mt.type=Kr[de.type],mt.mag=vr[or.magFilter],mt.min=sn[or.minFilter],mt.wrapS=yr[or.wrapS],mt.wrapT=yr[or.wrapT],Et=0;Et<6;++Et)ba(qe[Et]);return mt}function bt(Ke,Je,Ae,$e,Ee){L(!!Je,"must specify image data"),L(typeof Ke=="number"&&Ke===(Ke|0)&&Ke>=0&&Ke<6,"invalid face");var vt=Ae|0,Et=$e|0,or=Ee|0,Bt=Sn();return Ur(Bt,de),Bt.width=0,Bt.height=0,gr(Bt,Je),Bt.width=Bt.width||(de.width>>or)-vt,Bt.height=Bt.height||(de.height>>or)-Et,L(de.type===Bt.type&&de.format===Bt.format&&de.internalformat===Bt.internalformat,"incompatible format for texture.subimage"),L(vt>=0&&Et>=0&&vt+Bt.width<=de.width&&Et+Bt.height<=de.height,"texture.subimage write out of bounds"),L(de.mipmask&1<<or,"missing mipmap data"),L(Bt.data||Bt.element||Bt.needsCopy,"missing image data"),jo(de),Gn(Bt,pc+Ke,vt,Et,or),Wi(),hi(Bt),mt}function et(Ke){var Je=Ke|0;if(Je!==de.width){mt.width=de.width=Je,mt.height=de.height=Je,jo(de);for(var Ae=0;Ae<6;++Ae)for(var $e=0;de.mipmask>>$e;++$e)B.texImage2D(pc+Ae,$e,de.format,Je>>$e,Je>>$e,0,de.format,de.type,null);return Wi(),Xt.profile&&(de.stats.size=F(de.internalformat,de.type,mt.width,mt.height,!1,!0)),mt}}return mt(De,Ft,Rt,vn,xi,Ce),mt.subimage=bt,mt.resize=et,mt._reglType="textureCube",mt._texture=de,Xt.profile&&(mt.stats=de.stats),mt.destroy=function(){de.decRef()},mt}function Va(){for(var De=0;De<Do;++De)B.activeTexture(Cu+De),B.bindTexture(No,null),$a[De]=null;Qr(Io).forEach(Un),Dt.cubeCount=0,Dt.textureCount=0}Xt.profile&&(Dt.getTotalTextureSize=function(){var De=0;return Object.keys(Io).forEach(function(Ft){De+=Io[Ft].stats.size}),De});function Ks(){for(var De=0;De<Do;++De){var Ft=$a[De];Ft&&(Ft.bindCount=0,Ft.unit=-1,$a[De]=null)}Qr(Io).forEach(function(Rt){Rt.texture=B.createTexture(),B.bindTexture(Rt.target,Rt.texture);for(var vn=0;vn<32;++vn)if((Rt.mipmask&1<<vn)!=0)if(Rt.target===No)B.texImage2D(No,vn,Rt.internalformat,Rt.width>>vn,Rt.height>>vn,0,Rt.internalformat,Rt.type,null);else for(var xi=0;xi<6;++xi)B.texImage2D(pc+xi,vn,Rt.internalformat,Rt.width>>vn,Rt.height>>vn,0,Rt.internalformat,Rt.type,null);lo(Rt.texInfo,Rt.target)})}function Cl(){for(var De=0;De<Do;++De){var Ft=$a[De];Ft&&(Ft.bindCount=0,Ft.unit=-1,$a[De]=null),B.activeTexture(Cu+De),B.bindTexture(No,null),B.bindTexture(bf,null)}}return{create2D:_i,createCube:Ii,clear:Va,getTexture:function(De){return null},restore:Ks,refresh:Cl}}var pe=36161,qa=32854,Ca=32855,Hs=36194,Jo=33189,da=36168,xl=34041,In=35907,mn=34836,Ec=34842,Lo=34843,Ka=[];Ka[qa]=2,Ka[Ca]=2,Ka[Hs]=2,Ka[Jo]=2,Ka[da]=1,Ka[xl]=4,Ka[In]=4,Ka[mn]=16,Ka[Ec]=8,Ka[Lo]=6;function uo(B,Se,ke){return Ka[B]*Se*ke}var Ps=function(B,Se,ke,zt,sr){var Dt={rgba4:qa,rgb565:Hs,"rgb5 a1":Ca,depth:Jo,stencil:da,"depth stencil":xl};Se.ext_srgb&&(Dt.srgba=In),Se.ext_color_buffer_half_float&&(Dt.rgba16f=Ec,Dt.rgb16f=Lo),Se.webgl_color_buffer_float&&(Dt.rgba32f=mn);var Xt=[];Object.keys(Dt).forEach(function(Er){var Vr=Dt[Er];Xt[Vr]=Er});var kr=0,Ir={};function Or(Er){this.id=kr++,this.refCount=1,this.renderbuffer=Er,this.format=qa,this.width=0,this.height=0,sr.profile&&(this.stats={size:0})}Or.prototype.decRef=function(){--this.refCount<=0&&Cr(this)};function Cr(Er){var Vr=Er.renderbuffer;L(Vr,"must not double destroy renderbuffer"),B.bindRenderbuffer(pe,null),B.deleteRenderbuffer(Vr),Er.renderbuffer=null,Er.refCount=0,delete Ir[Er.id],zt.renderbufferCount--}function zr(Er,Vr){var St=new Or(B.createRenderbuffer());Ir[St.id]=St,zt.renderbufferCount++;function Vt(Kr,vr){var sn=0,yr=0,Zr=qa;if(typeof Kr=="object"&&Kr){var pr=Kr;if("shape"in pr){var Ur=pr.shape;L(Array.isArray(Ur)&&Ur.length>=2,"invalid renderbuffer shape"),sn=Ur[0]|0,yr=Ur[1]|0}else"radius"in pr&&(sn=yr=pr.radius|0),"width"in pr&&(sn=pr.width|0),"height"in pr&&(yr=pr.height|0);"format"in pr&&(L.parameter(pr.format,Dt,"invalid renderbuffer format"),Zr=Dt[pr.format])}else typeof Kr=="number"?(sn=Kr|0,typeof vr=="number"?yr=vr|0:yr=sn):Kr?L.raise("invalid arguments to renderbuffer constructor"):sn=yr=1;if(L(sn>0&&yr>0&&sn<=ke.maxRenderbufferSize&&yr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),!(sn===St.width&&yr===St.height&&Zr===St.format))return Vt.width=St.width=sn,Vt.height=St.height=yr,St.format=Zr,B.bindRenderbuffer(pe,St.renderbuffer),B.renderbufferStorage(pe,Zr,sn,yr),L(B.getError()===0,"invalid render buffer format"),sr.profile&&(St.stats.size=uo(St.format,St.width,St.height)),Vt.format=Xt[St.format],Vt}function Tr(Kr,vr){var sn=Kr|0,yr=vr|0||sn;return sn===St.width&&yr===St.height||(L(sn>0&&yr>0&&sn<=ke.maxRenderbufferSize&&yr<=ke.maxRenderbufferSize,"invalid renderbuffer size"),Vt.width=St.width=sn,Vt.height=St.height=yr,B.bindRenderbuffer(pe,St.renderbuffer),B.renderbufferStorage(pe,St.format,sn,yr),L(B.getError()===0,"invalid render buffer format"),sr.profile&&(St.stats.size=uo(St.format,St.width,St.height))),Vt}return Vt(Er,Vr),Vt.resize=Tr,Vt._reglType="renderbuffer",Vt._renderbuffer=St,sr.profile&&(Vt.stats=St.stats),Vt.destroy=function(){St.decRef()},Vt}sr.profile&&(zt.getTotalRenderbufferSize=function(){var Er=0;return Object.keys(Ir).forEach(function(Vr){Er+=Ir[Vr].stats.size}),Er});function Xr(){Qr(Ir).forEach(function(Er){Er.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(pe,Er.renderbuffer),B.renderbufferStorage(pe,Er.format,Er.width,Er.height)}),B.bindRenderbuffer(pe,null)}return{create:zr,clear:function(){Qr(Ir).forEach(Cr)},restore:Xr}},Qo=36160,Ac=36161,ki=3553,Ha=34069,Mf=36064,qu=36096,ef=36128,Ls=33306,Zo=36053,bl=36054,uu=36055,tf=36057,Hl=36061,Cc=36193,kf=5121,Wl=5126,Ku=6407,Ws=6408,Ju=6402,Mu=[Ku,Ws],$l=[];$l[Ws]=4,$l[Ku]=3;var $s=[];$s[kf]=1,$s[Wl]=4,$s[Cc]=2;var Rs=32854,Qu=32855,Tc=36194,ch=33189,rf=36168,f=34041,d=35907,h=34836,g=34842,w=34843,C=[Rs,Qu,Tc,d,g,w,h],T={};T[Zo]="complete",T[bl]="incomplete attachment",T[tf]="incomplete dimensions",T[uu]="incomplete, missing attachment",T[Hl]="unsupported";function I(B,Se,ke,zt,sr,Dt){var Xt={cur:null,next:null,dirty:!1,setFBO:null},kr=["rgba"],Ir=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Ir.push("srgba"),Se.ext_color_buffer_half_float&&Ir.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Ir.push("rgba32f");var Or=["uint8"];Se.oes_texture_half_float&&Or.push("half float","float16"),Se.oes_texture_float&&Or.push("float","float32");function Cr(Ne,gr,cr){this.target=Ne,this.texture=gr,this.renderbuffer=cr;var Gn=0,Zn=0;gr?(Gn=gr.width,Zn=gr.height):cr&&(Gn=cr.width,Zn=cr.height),this.width=Gn,this.height=Zn}function zr(Ne){Ne&&(Ne.texture&&Ne.texture._texture.decRef(),Ne.renderbuffer&&Ne.renderbuffer._renderbuffer.decRef())}function Xr(Ne,gr,cr){if(!!Ne)if(Ne.texture){var Gn=Ne.texture._texture,Zn=Math.max(1,Gn.width),Sn=Math.max(1,Gn.height);L(Zn===gr&&Sn===cr,"inconsistent width/height for supplied texture"),Gn.refCount+=1}else{var hi=Ne.renderbuffer._renderbuffer;L(hi.width===gr&&hi.height===cr,"inconsistent width/height for renderbuffer"),hi.refCount+=1}}function Er(Ne,gr){gr&&(gr.texture?B.framebufferTexture2D(Qo,Ne,gr.target,gr.texture._texture.texture,0):B.framebufferRenderbuffer(Qo,Ne,Ac,gr.renderbuffer._renderbuffer.renderbuffer))}function Vr(Ne){var gr=ki,cr=null,Gn=null,Zn=Ne;typeof Ne=="object"&&(Zn=Ne.data,"target"in Ne&&(gr=Ne.target|0)),L.type(Zn,"function","invalid attachment data");var Sn=Zn._reglType;return Sn==="texture2d"?(cr=Zn,L(gr===ki)):Sn==="textureCube"?(cr=Zn,L(gr>=Ha&&gr<Ha+6,"invalid cube map target")):Sn==="renderbuffer"?(Gn=Zn,gr=Ac):L.raise("invalid regl object for attachment"),new Cr(gr,cr,Gn)}function St(Ne,gr,cr,Gn,Zn){if(cr){var Sn=zt.create2D({width:Ne,height:gr,format:Gn,type:Zn});return Sn._texture.refCount=0,new Cr(ki,Sn,null)}else{var hi=sr.create({width:Ne,height:gr,format:Gn});return hi._renderbuffer.refCount=0,new Cr(Ac,null,hi)}}function Vt(Ne){return Ne&&(Ne.texture||Ne.renderbuffer)}function Tr(Ne,gr,cr){Ne&&(Ne.texture?Ne.texture.resize(gr,cr):Ne.renderbuffer&&Ne.renderbuffer.resize(gr,cr),Ne.width=gr,Ne.height=cr)}var Kr=0,vr={};function sn(){this.id=Kr++,vr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function yr(Ne){Ne.colorAttachments.forEach(zr),zr(Ne.depthAttachment),zr(Ne.stencilAttachment),zr(Ne.depthStencilAttachment)}function Zr(Ne){var gr=Ne.framebuffer;L(gr,"must not double destroy framebuffer"),B.deleteFramebuffer(gr),Ne.framebuffer=null,Dt.framebufferCount--,delete vr[Ne.id]}function pr(Ne){var gr;B.bindFramebuffer(Qo,Ne.framebuffer);var cr=Ne.colorAttachments;for(gr=0;gr<cr.length;++gr)Er(Mf+gr,cr[gr]);for(gr=cr.length;gr<ke.maxColorAttachments;++gr)B.framebufferTexture2D(Qo,Mf+gr,ki,null,0);B.framebufferTexture2D(Qo,Ls,ki,null,0),B.framebufferTexture2D(Qo,qu,ki,null,0),B.framebufferTexture2D(Qo,ef,ki,null,0),Er(qu,Ne.depthAttachment),Er(ef,Ne.stencilAttachment),Er(Ls,Ne.depthStencilAttachment);var Gn=B.checkFramebufferStatus(Qo);!B.isContextLost()&&Gn!==Zo&&L.raise("framebuffer configuration not supported, status = "+T[Gn]),B.bindFramebuffer(Qo,Xt.next?Xt.next.framebuffer:null),Xt.cur=Xt.next,B.getError()}function Ur(Ne,gr){var cr=new sn;Dt.framebufferCount++;function Gn(Sn,hi){var ni;L(Xt.next!==cr,"can not update framebuffer which is currently in use");var vi=0,Fi=0,Ua=!0,wo=!0,Si=null,ba=!0,ua="rgba",Wa="uint8",lo=1,Eo=null,Io=null,Do=null,$a=!1;if(typeof Sn=="number")vi=Sn|0,Fi=hi|0||vi;else if(!Sn)vi=Fi=1;else{L.type(Sn,"object","invalid arguments for framebuffer");var pi=Sn;if("shape"in pi){var jo=pi.shape;L(Array.isArray(jo)&&jo.length>=2,"invalid shape for framebuffer"),vi=jo[0],Fi=jo[1]}else"radius"in pi&&(vi=Fi=pi.radius),"width"in pi&&(vi=pi.width),"height"in pi&&(Fi=pi.height);("color"in pi||"colors"in pi)&&(Si=pi.color||pi.colors,Array.isArray(Si)&&L(Si.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Si||("colorCount"in pi&&(lo=pi.colorCount|0,L(lo>0,"invalid color buffer count")),"colorTexture"in pi&&(ba=!!pi.colorTexture,ua="rgba4"),"colorType"in pi&&(Wa=pi.colorType,ba?(L(Se.oes_texture_float||!(Wa==="float"||Wa==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),L(Se.oes_texture_half_float||!(Wa==="half float"||Wa==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Wa==="half float"||Wa==="float16"?(L(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ua="rgba16f"):(Wa==="float"||Wa==="float32")&&(L(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ua="rgba32f"),L.oneOf(Wa,Or,"invalid color type")),"colorFormat"in pi&&(ua=pi.colorFormat,kr.indexOf(ua)>=0?ba=!0:Ir.indexOf(ua)>=0?ba=!1:ba?L.oneOf(pi.colorFormat,kr,"invalid color format for texture"):L.oneOf(pi.colorFormat,Ir,"invalid color format for renderbuffer"))),("depthTexture"in pi||"depthStencilTexture"in pi)&&($a=!!(pi.depthTexture||pi.depthStencilTexture),L(!$a||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in pi&&(typeof pi.depth=="boolean"?Ua=pi.depth:(Eo=pi.depth,wo=!1)),"stencil"in pi&&(typeof pi.stencil=="boolean"?wo=pi.stencil:(Io=pi.stencil,Ua=!1)),"depthStencil"in pi&&(typeof pi.depthStencil=="boolean"?Ua=wo=pi.depthStencil:(Do=pi.depthStencil,Ua=!1,wo=!1))}var Wi=null,Un=null,_i=null,Ii=null;if(Array.isArray(Si))Wi=Si.map(Vr);else if(Si)Wi=[Vr(Si)];else for(Wi=new Array(lo),ni=0;ni<lo;++ni)Wi[ni]=St(vi,Fi,ba,ua,Wa);L(Se.webgl_draw_buffers||Wi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),L(Wi.length<=ke.maxColorAttachments,"too many color attachments, not supported"),vi=vi||Wi[0].width,Fi=Fi||Wi[0].height,Eo?Un=Vr(Eo):Ua&&!wo&&(Un=St(vi,Fi,$a,"depth","uint32")),Io?_i=Vr(Io):wo&&!Ua&&(_i=St(vi,Fi,!1,"stencil","uint8")),Do?Ii=Vr(Do):!Eo&&!Io&&wo&&Ua&&(Ii=St(vi,Fi,$a,"depth stencil","depth stencil")),L(!!Eo+!!Io+!!Do<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Va=null;for(ni=0;ni<Wi.length;++ni)if(Xr(Wi[ni],vi,Fi),L(!Wi[ni]||Wi[ni].texture&&Mu.indexOf(Wi[ni].texture._texture.format)>=0||Wi[ni].renderbuffer&&C.indexOf(Wi[ni].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ni+" is invalid"),Wi[ni]&&Wi[ni].texture){var Ks=$l[Wi[ni].texture._texture.format]*$s[Wi[ni].texture._texture.type];Va===null?Va=Ks:L(Va===Ks,"all color attachments much have the same number of bits per pixel.")}return Xr(Un,vi,Fi),L(!Un||Un.texture&&Un.texture._texture.format===Ju||Un.renderbuffer&&Un.renderbuffer._renderbuffer.format===ch,"invalid depth attachment for framebuffer object"),Xr(_i,vi,Fi),L(!_i||_i.renderbuffer&&_i.renderbuffer._renderbuffer.format===rf,"invalid stencil attachment for framebuffer object"),Xr(Ii,vi,Fi),L(!Ii||Ii.texture&&Ii.texture._texture.format===f||Ii.renderbuffer&&Ii.renderbuffer._renderbuffer.format===f,"invalid depth-stencil attachment for framebuffer object"),yr(cr),cr.width=vi,cr.height=Fi,cr.colorAttachments=Wi,cr.depthAttachment=Un,cr.stencilAttachment=_i,cr.depthStencilAttachment=Ii,Gn.color=Wi.map(Vt),Gn.depth=Vt(Un),Gn.stencil=Vt(_i),Gn.depthStencil=Vt(Ii),Gn.width=cr.width,Gn.height=cr.height,pr(cr),Gn}function Zn(Sn,hi){L(Xt.next!==cr,"can not resize a framebuffer which is currently in use");var ni=Math.max(Sn|0,1),vi=Math.max(hi|0||ni,1);if(ni===cr.width&&vi===cr.height)return Gn;for(var Fi=cr.colorAttachments,Ua=0;Ua<Fi.length;++Ua)Tr(Fi[Ua],ni,vi);return Tr(cr.depthAttachment,ni,vi),Tr(cr.stencilAttachment,ni,vi),Tr(cr.depthStencilAttachment,ni,vi),cr.width=Gn.width=ni,cr.height=Gn.height=vi,pr(cr),Gn}return Gn(Ne,gr),N(Gn,{resize:Zn,_reglType:"framebuffer",_framebuffer:cr,destroy:function(){Zr(cr),yr(cr)},use:function(Sn){Xt.setFBO({framebuffer:Gn},Sn)}})}function Nt(Ne){var gr=Array(6);function cr(Zn){var Sn;L(gr.indexOf(Xt.next)<0,"can not update framebuffer which is currently in use");var hi={color:null},ni=0,vi=null,Fi="rgba",Ua="uint8",wo=1;if(typeof Zn=="number")ni=Zn|0;else if(!Zn)ni=1;else{L.type(Zn,"object","invalid arguments for framebuffer");var Si=Zn;if("shape"in Si){var ba=Si.shape;L(Array.isArray(ba)&&ba.length>=2,"invalid shape for framebuffer"),L(ba[0]===ba[1],"cube framebuffer must be square"),ni=ba[0]}else"radius"in Si&&(ni=Si.radius|0),"width"in Si?(ni=Si.width|0,"height"in Si&&L(Si.height===ni,"must be square")):"height"in Si&&(ni=Si.height|0);("color"in Si||"colors"in Si)&&(vi=Si.color||Si.colors,Array.isArray(vi)&&L(vi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),vi||("colorCount"in Si&&(wo=Si.colorCount|0,L(wo>0,"invalid color buffer count")),"colorType"in Si&&(L.oneOf(Si.colorType,Or,"invalid color type"),Ua=Si.colorType),"colorFormat"in Si&&(Fi=Si.colorFormat,L.oneOf(Si.colorFormat,kr,"invalid color format for texture"))),"depth"in Si&&(hi.depth=Si.depth),"stencil"in Si&&(hi.stencil=Si.stencil),"depthStencil"in Si&&(hi.depthStencil=Si.depthStencil)}var ua;if(vi)if(Array.isArray(vi))for(ua=[],Sn=0;Sn<vi.length;++Sn)ua[Sn]=vi[Sn];else ua=[vi];else{ua=Array(wo);var Wa={radius:ni,format:Fi,type:Ua};for(Sn=0;Sn<wo;++Sn)ua[Sn]=zt.createCube(Wa)}for(hi.color=Array(ua.length),Sn=0;Sn<ua.length;++Sn){var lo=ua[Sn];L(typeof lo=="function"&&lo._reglType==="textureCube","invalid cube map"),ni=ni||lo.width,L(lo.width===ni&&lo.height===ni,"invalid cube map shape"),hi.color[Sn]={target:Ha,data:ua[Sn]}}for(Sn=0;Sn<6;++Sn){for(var Eo=0;Eo<ua.length;++Eo)hi.color[Eo].target=Ha+Sn;Sn>0&&(hi.depth=gr[0].depth,hi.stencil=gr[0].stencil,hi.depthStencil=gr[0].depthStencil),gr[Sn]?gr[Sn](hi):gr[Sn]=Ur(hi)}return N(cr,{width:ni,height:ni,color:ua})}function Gn(Zn){var Sn,hi=Zn|0;if(L(hi>0&&hi<=ke.maxCubeMapSize,"invalid radius for cube fbo"),hi===cr.width)return cr;var ni=cr.color;for(Sn=0;Sn<ni.length;++Sn)ni[Sn].resize(hi);for(Sn=0;Sn<6;++Sn)gr[Sn].resize(hi);return cr.width=cr.height=hi,cr}return cr(Ne),N(cr,{faces:gr,resize:Gn,_reglType:"framebufferCube",destroy:function(){gr.forEach(function(Zn){Zn.destroy()})}})}function Fn(){Xt.cur=null,Xt.next=null,Xt.dirty=!0,Qr(vr).forEach(function(Ne){Ne.framebuffer=B.createFramebuffer(),pr(Ne)})}return N(Xt,{getFramebuffer:function(Ne){if(typeof Ne=="function"&&Ne._reglType==="framebuffer"){var gr=Ne._framebuffer;if(gr instanceof sn)return gr}return null},create:Ur,createCube:Nt,clear:function(){Qr(vr).forEach(Zr)},restore:Fn})}var U=5126,$=34962;function le(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=U,this.offset=0,this.stride=0,this.divisor=0}function ve(B,Se,ke,zt,sr){for(var Dt=ke.maxAttributes,Xt=new Array(Dt),kr=0;kr<Dt;++kr)Xt[kr]=new le;var Ir=0,Or={},Cr={Record:le,scope:{},state:Xt,currentVAO:null,targetVAO:null,restore:Xr()?vr:function(){},createVAO:sn,getVAO:Vr,destroyBuffer:zr,setVAO:Xr()?St:Vt,clear:Xr()?Tr:function(){}};function zr(yr){for(var Zr=0;Zr<Xt.length;++Zr){var pr=Xt[Zr];pr.buffer===yr&&(B.disableVertexAttribArray(Zr),pr.buffer=null)}}function Xr(){return Se.oes_vertex_array_object}function Er(){return Se.angle_instanced_arrays}function Vr(yr){return typeof yr=="function"&&yr._vao?yr._vao:null}function St(yr){if(yr!==Cr.currentVAO){var Zr=Xr();yr?Zr.bindVertexArrayOES(yr.vao):Zr.bindVertexArrayOES(null),Cr.currentVAO=yr}}function Vt(yr){if(yr!==Cr.currentVAO){if(yr)yr.bindAttrs();else for(var Zr=Er(),pr=0;pr<Xt.length;++pr){var Ur=Xt[pr];Ur.buffer?(B.enableVertexAttribArray(pr),B.vertexAttribPointer(pr,Ur.size,Ur.type,Ur.normalized,Ur.stride,Ur.offfset),Zr&&Ur.divisor&&Zr.vertexAttribDivisorANGLE(pr,Ur.divisor)):(B.disableVertexAttribArray(pr),B.vertexAttrib4f(pr,Ur.x,Ur.y,Ur.z,Ur.w))}Cr.currentVAO=yr}}function Tr(){Qr(Or).forEach(function(yr){yr.destroy()})}function Kr(){this.id=++Ir,this.attributes=[];var yr=Xr();yr?this.vao=yr.createVertexArrayOES():this.vao=null,Or[this.id]=this,this.buffers=[]}Kr.prototype.bindAttrs=function(){for(var yr=Er(),Zr=this.attributes,pr=0;pr<Zr.length;++pr){var Ur=Zr[pr];Ur.buffer?(B.enableVertexAttribArray(pr),B.bindBuffer($,Ur.buffer.buffer),B.vertexAttribPointer(pr,Ur.size,Ur.type,Ur.normalized,Ur.stride,Ur.offset),yr&&Ur.divisor&&yr.vertexAttribDivisorANGLE(pr,Ur.divisor)):(B.disableVertexAttribArray(pr),B.vertexAttrib4f(pr,Ur.x,Ur.y,Ur.z,Ur.w))}for(var Nt=Zr.length;Nt<Dt;++Nt)B.disableVertexAttribArray(Nt)},Kr.prototype.refresh=function(){var yr=Xr();yr&&(yr.bindVertexArrayOES(this.vao),this.bindAttrs(),Cr.currentVAO=this)},Kr.prototype.destroy=function(){if(this.vao){var yr=Xr();this===Cr.currentVAO&&(Cr.currentVAO=null,yr.bindVertexArrayOES(null)),yr.deleteVertexArrayOES(this.vao),this.vao=null}Or[this.id]&&(delete Or[this.id],zt.vaoCount-=1)};function vr(){var yr=Xr();yr&&Qr(Or).forEach(function(Zr){Zr.refresh()})}function sn(yr){var Zr=new Kr;zt.vaoCount+=1;function pr(Ur){L(Array.isArray(Ur),"arguments to vertex array constructor must be an array"),L(Ur.length<Dt,"too many attributes"),L(Ur.length>0,"must specify at least one attribute");var Nt={},Fn=Zr.attributes;Fn.length=Ur.length;for(var Ne=0;Ne<Ur.length;++Ne){var gr=Ur[Ne],cr=Fn[Ne]=new le,Gn=gr.data||gr;if(Array.isArray(Gn)||Q(Gn)||_r(Gn)){var Zn;Zr.buffers[Ne]&&(Zn=Zr.buffers[Ne],Q(Gn)&&Zn._buffer.byteLength>=Gn.byteLength?Zn.subdata(Gn):(Zn.destroy(),Zr.buffers[Ne]=null)),Zr.buffers[Ne]||(Zn=Zr.buffers[Ne]=sr.create(gr,$,!1,!0)),cr.buffer=sr.getBuffer(Zn),cr.size=cr.buffer.dimension|0,cr.normalized=!1,cr.type=cr.buffer.dtype,cr.offset=0,cr.stride=0,cr.divisor=0,cr.state=1,Nt[Ne]=1}else sr.getBuffer(gr)?(cr.buffer=sr.getBuffer(gr),cr.size=cr.buffer.dimension|0,cr.normalized=!1,cr.type=cr.buffer.dtype,cr.offset=0,cr.stride=0,cr.divisor=0,cr.state=1):sr.getBuffer(gr.buffer)?(cr.buffer=sr.getBuffer(gr.buffer),cr.size=(+gr.size||cr.buffer.dimension)|0,cr.normalized=!!gr.normalized||!1,"type"in gr?(L.parameter(gr.type,ss,"invalid buffer type"),cr.type=ss[gr.type]):cr.type=cr.buffer.dtype,cr.offset=(gr.offset||0)|0,cr.stride=(gr.stride||0)|0,cr.divisor=(gr.divisor||0)|0,cr.state=1,L(cr.size>=1&&cr.size<=4,"size must be between 1 and 4"),L(cr.offset>=0,"invalid offset"),L(cr.stride>=0&&cr.stride<=255,"stride must be between 0 and 255"),L(cr.divisor>=0,"divisor must be positive"),L(!cr.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in gr?(L(Ne>0,"first attribute must not be a constant"),cr.x=+gr.x||0,cr.y=+gr.y||0,cr.z=+gr.z||0,cr.w=+gr.w||0,cr.state=2):L(!1,"invalid attribute spec for location "+Ne)}for(var Sn=0;Sn<Zr.buffers.length;++Sn)!Nt[Sn]&&Zr.buffers[Sn]&&(Zr.buffers[Sn].destroy(),Zr.buffers[Sn]=null);return Zr.refresh(),pr}return pr.destroy=function(){for(var Ur=0;Ur<Zr.buffers.length;++Ur)Zr.buffers[Ur]&&Zr.buffers[Ur].destroy();Zr.buffers.length=0,Zr.destroy()},pr._vao=Zr,pr._reglType="vao",pr(yr)}return Cr}var ye=35632,ze=35633,Fe=35718,Ye=35721;function Pe(B,Se,ke,zt){var sr={},Dt={};function Xt(St,Vt,Tr,Kr){this.name=St,this.id=Vt,this.location=Tr,this.info=Kr}function kr(St,Vt){for(var Tr=0;Tr<St.length;++Tr)if(St[Tr].id===Vt.id){St[Tr].location=Vt.location;return}St.push(Vt)}function Ir(St,Vt,Tr){var Kr=St===ye?sr:Dt,vr=Kr[Vt];if(!vr){var sn=Se.str(Vt);vr=B.createShader(St),B.shaderSource(vr,sn),B.compileShader(vr),L.shaderError(B,vr,sn,St,Tr),Kr[Vt]=vr}return vr}var Or={},Cr=[],zr=0;function Xr(St,Vt){this.id=zr++,this.fragId=St,this.vertId=Vt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,zt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Er(St,Vt,Tr){var Kr,vr,sn=Ir(ye,St.fragId),yr=Ir(ze,St.vertId),Zr=St.program=B.createProgram();if(B.attachShader(Zr,sn),B.attachShader(Zr,yr),Tr)for(Kr=0;Kr<Tr.length;++Kr){var pr=Tr[Kr];B.bindAttribLocation(Zr,pr[0],pr[1])}B.linkProgram(Zr),L.linkError(B,Zr,Se.str(St.fragId),Se.str(St.vertId),Vt);var Ur=B.getProgramParameter(Zr,Fe);zt.profile&&(St.stats.uniformsCount=Ur);var Nt=St.uniforms;for(Kr=0;Kr<Ur;++Kr)if(vr=B.getActiveUniform(Zr,Kr),vr)if(vr.size>1)for(var Fn=0;Fn<vr.size;++Fn){var Ne=vr.name.replace("[0]","["+Fn+"]");kr(Nt,new Xt(Ne,Se.id(Ne),B.getUniformLocation(Zr,Ne),vr))}else kr(Nt,new Xt(vr.name,Se.id(vr.name),B.getUniformLocation(Zr,vr.name),vr));var gr=B.getProgramParameter(Zr,Ye);zt.profile&&(St.stats.attributesCount=gr);var cr=St.attributes;for(Kr=0;Kr<gr;++Kr)vr=B.getActiveAttrib(Zr,Kr),vr&&kr(cr,new Xt(vr.name,Se.id(vr.name),B.getAttribLocation(Zr,vr.name),vr))}zt.profile&&(ke.getMaxUniformsCount=function(){var St=0;return Cr.forEach(function(Vt){Vt.stats.uniformsCount>St&&(St=Vt.stats.uniformsCount)}),St},ke.getMaxAttributesCount=function(){var St=0;return Cr.forEach(function(Vt){Vt.stats.attributesCount>St&&(St=Vt.stats.attributesCount)}),St});function Vr(){sr={},Dt={};for(var St=0;St<Cr.length;++St)Er(Cr[St],null,Cr[St].attributes.map(function(Vt){return[Vt.location,Vt.name]}))}return{clear:function(){var St=B.deleteShader.bind(B);Qr(sr).forEach(St),sr={},Qr(Dt).forEach(St),Dt={},Cr.forEach(function(Vt){B.deleteProgram(Vt.program)}),Cr.length=0,Or={},ke.shaderCount=0},program:function(St,Vt,Tr,Kr){L.command(St>=0,"missing vertex shader",Tr),L.command(Vt>=0,"missing fragment shader",Tr);var vr=Or[Vt];vr||(vr=Or[Vt]={});var sn=vr[St];if(sn&&(sn.refCount++,!Kr))return sn;var yr=new Xr(Vt,St);return ke.shaderCount++,Er(yr,Tr,Kr),sn||(vr[St]=yr),Cr.push(yr),N(yr,{destroy:function(){if(yr.refCount--,yr.refCount<=0){B.deleteProgram(yr.program);var Zr=Cr.indexOf(yr);Cr.splice(Zr,1),ke.shaderCount--}vr[yr.vertId].refCount<=0&&(B.deleteShader(Dt[yr.vertId]),delete Dt[yr.vertId],delete Or[yr.fragId][yr.vertId]),Object.keys(Or[yr.fragId]).length||(B.deleteShader(sr[yr.fragId]),delete sr[yr.fragId],delete Or[yr.fragId])}})},restore:Vr,shader:Ir,frag:-1,vert:-1}}var Xe=6408,st=5121,Ct=3333,Wt=5126;function Zt(B,Se,ke,zt,sr,Dt,Xt){function kr(Cr){var zr;Se.next===null?(L(sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),zr=st):(L(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),zr=Se.next.colorAttachments[0].texture._texture.type,Dt.oes_texture_float?(L(zr===st||zr===Wt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),zr===Wt&&L(Xt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):L(zr===st,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Xr=0,Er=0,Vr=zt.framebufferWidth,St=zt.framebufferHeight,Vt=null;Q(Cr)?Vt=Cr:Cr&&(L.type(Cr,"object","invalid arguments to regl.read()"),Xr=Cr.x|0,Er=Cr.y|0,L(Xr>=0&&Xr<zt.framebufferWidth,"invalid x offset for regl.read"),L(Er>=0&&Er<zt.framebufferHeight,"invalid y offset for regl.read"),Vr=(Cr.width||zt.framebufferWidth-Xr)|0,St=(Cr.height||zt.framebufferHeight-Er)|0,Vt=Cr.data||null),Vt&&(zr===st?L(Vt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):zr===Wt&&L(Vt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),L(Vr>0&&Vr+Xr<=zt.framebufferWidth,"invalid width for read pixels"),L(St>0&&St+Er<=zt.framebufferHeight,"invalid height for read pixels"),ke();var Tr=Vr*St*4;return Vt||(zr===st?Vt=new Uint8Array(Tr):zr===Wt&&(Vt=Vt||new Float32Array(Tr))),L.isTypedArray(Vt,"data buffer for regl.read() must be a typedarray"),L(Vt.byteLength>=Tr,"data buffer for regl.read() too small"),B.pixelStorei(Ct,4),B.readPixels(Xr,Er,Vr,St,Xe,zr,Vt),Vt}function Ir(Cr){var zr;return Se.setFBO({framebuffer:Cr.framebuffer},function(){zr=kr(Cr)}),zr}function Or(Cr){return!Cr||!("framebuffer"in Cr)?kr(Cr):Ir(Cr)}return Or}function Ht(B){return Array.prototype.slice.call(B)}function hr(B){return Ht(B).join("")}function Nr(){var B=0,Se=[],ke=[];function zt(zr){for(var Xr=0;Xr<ke.length;++Xr)if(ke[Xr]===zr)return Se[Xr];var Er="g"+B++;return Se.push(Er),ke.push(zr),Er}function sr(){var zr=[];function Xr(){zr.push.apply(zr,Ht(arguments))}var Er=[];function Vr(){var St="v"+B++;return Er.push(St),arguments.length>0&&(zr.push(St,"="),zr.push.apply(zr,Ht(arguments)),zr.push(";")),St}return N(Xr,{def:Vr,toString:function(){return hr([Er.length>0?"var "+Er.join(",")+";":"",hr(zr)])}})}function Dt(){var zr=sr(),Xr=sr(),Er=zr.toString,Vr=Xr.toString;function St(Vt,Tr){Xr(Vt,Tr,"=",zr.def(Vt,Tr),";")}return N(function(){zr.apply(zr,Ht(arguments))},{def:zr.def,entry:zr,exit:Xr,save:St,set:function(Vt,Tr,Kr){St(Vt,Tr),zr(Vt,Tr,"=",Kr,";")},toString:function(){return Er()+Vr()}})}function Xt(){var zr=hr(arguments),Xr=Dt(),Er=Dt(),Vr=Xr.toString,St=Er.toString;return N(Xr,{then:function(){return Xr.apply(Xr,Ht(arguments)),this},else:function(){return Er.apply(Er,Ht(arguments)),this},toString:function(){var Vt=St();return Vt&&(Vt="else{"+Vt+"}"),hr(["if(",zr,"){",Vr(),"}",Vt])}})}var kr=sr(),Ir={};function Or(zr,Xr){var Er=[];function Vr(){var vr="a"+Er.length;return Er.push(vr),vr}Xr=Xr||0;for(var St=0;St<Xr;++St)Vr();var Vt=Dt(),Tr=Vt.toString,Kr=Ir[zr]=N(Vt,{arg:Vr,toString:function(){return hr(["function(",Er.join(),"){",Tr(),"}"])}});return Kr}function Cr(){var zr=['"use strict";',kr,"return {"];Object.keys(Ir).forEach(function(Vr){zr.push('"',Vr,'":',Ir[Vr].toString(),",")}),zr.push("}");var Xr=hr(zr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Er=Function.apply(null,Se.concat(Xr));return Er.apply(null,ke)}return{global:kr,link:zt,block:sr,proc:Or,scope:Dt,cond:Xt,compile:Cr}}var Dr="xyzw".split(""),an=5121,En=1,Dn=2,On=0,Li=1,fn=2,Wn=3,ai=4,Jn=5,$n=6,ci="dither",Xn="blend.enable",jn="blend.color",Ja="blend.equation",va="blend.func",bo="depth.enable",So="depth.func",_a="depth.range",Ta="depth.mask",es="colorMask",Uo="cull.enable",ku="cull.face",Ro="frontFace",ys="lineWidth",_s="polygonOffset.enable",lu="polygonOffset.offset",el="sample.alpha",tl="sample.enable",rl="sample.coverage",Sl="stencil.enable",Ds="stencil.mask",Iu="stencil.func",Xs="stencil.opFront",Ma="stencil.opBack",cu="scissor.enable",Ys="scissor.box",fs="viewport",Oi="profile",Qa="framebuffer",eo="vert",xs="frag",Pu="elements",fu="primitive",ko="count",Mr="offset",nl="instances",Lu="vao",xa="Width",hu="Height",ts=Qa+xa,to=Qa+hu,Xl=fs+xa,Mc=fs+hu,fh="drawingBuffer",Sd=fh+xa,Mp=fh+hu,hh=[va,Ja,Iu,Xs,Ma,rl,fs,Ys,lu],il=34962,ph=34963,If=35632,wd=35633,Yl=3553,Pf=34067,Ed=2884,Ad=3042,Cd=3024,kp=2960,Zv=2929,$h=3089,Ip=32823,Pp=32926,Uv=32928,pu=5126,dh=35664,ka=35665,nf=35666,vh=5124,af=35667,wl=35668,ql=35669,mh=35670,Lf=35671,Kl=35672,Rf=35673,Jl=35674,kc=35675,al=35676,Df=35678,ol=35680,Lp=4,Ic=1028,El=1029,Os=2304,Xh=2305,Of=32775,Td=32776,Yh=519,Al=7680,sl=0,qh=1,gh=32774,yh=513,_h=36160,Rp=36064,Vo={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Pc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Lc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ru={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ql={frag:If,vert:wd},bs={cw:Os,ccw:Xh};function xh(B){return Array.isArray(B)||Q(B)||_r(B)}function Dp(B){return B.sort(function(Se,ke){return Se===fs?-1:ke===fs?1:Se<ke?-1:1})}function Ss(B,Se,ke,zt){this.thisDep=B,this.contextDep=Se,this.propDep=ke,this.append=zt}function qs(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Za(B){return new Ss(!1,!1,!1,B)}function ws(B,Se){var ke=B.type;if(ke===On){var zt=B.data.length;return new Ss(!0,zt>=1,zt>=2,Se)}else if(ke===ai){var sr=B.data;return new Ss(sr.thisDep,sr.contextDep,sr.propDep,Se)}else{if(ke===Jn)return new Ss(!1,!1,!1,Se);if(ke===$n){for(var Dt=!1,Xt=!1,kr=!1,Ir=0;Ir<B.data.length;++Ir){var Or=B.data[Ir];if(Or.type===Li)kr=!0;else if(Or.type===fn)Xt=!0;else if(Or.type===Wn)Dt=!0;else if(Or.type===On){Dt=!0;var Cr=Or.data;Cr>=1&&(Xt=!0),Cr>=2&&(kr=!0)}else Or.type===ai&&(Dt=Dt||Or.data.thisDep,Xt=Xt||Or.data.contextDep,kr=kr||Or.data.propDep)}return new Ss(Dt,Xt,kr,Se)}else return new Ss(ke===Wn,ke===fn,ke===Li,Se)}}var Kh=new Ss(!1,!1,!1,function(){});function Md(B,Se,ke,zt,sr,Dt,Xt,kr,Ir,Or,Cr,zr,Xr,Er,Vr){var St=Or.Record,Vt={add:32774,subtract:32778,"reverse subtract":32779};ke.ext_blend_minmax&&(Vt.min=Of,Vt.max=Td);var Tr=ke.angle_instanced_arrays,Kr=ke.webgl_draw_buffers,vr={dirty:!0,profile:Vr.profile},sn={},yr=[],Zr={},pr={};function Ur(Ce){return Ce.replace(".","_")}function Nt(Ce,de,qe){var mt=Ur(Ce);yr.push(Ce),sn[mt]=vr[mt]=!!qe,Zr[mt]=de}function Fn(Ce,de,qe){var mt=Ur(Ce);yr.push(Ce),Array.isArray(qe)?(vr[mt]=qe.slice(),sn[mt]=qe.slice()):vr[mt]=sn[mt]=qe,pr[mt]=de}Nt(ci,Cd),Nt(Xn,Ad),Fn(jn,"blendColor",[0,0,0,0]),Fn(Ja,"blendEquationSeparate",[gh,gh]),Fn(va,"blendFuncSeparate",[qh,sl,qh,sl]),Nt(bo,Zv,!0),Fn(So,"depthFunc",yh),Fn(_a,"depthRange",[0,1]),Fn(Ta,"depthMask",!0),Fn(es,es,[!0,!0,!0,!0]),Nt(Uo,Ed),Fn(ku,"cullFace",El),Fn(Ro,Ro,Xh),Fn(ys,ys,1),Nt(_s,Ip),Fn(lu,"polygonOffset",[0,0]),Nt(el,Pp),Nt(tl,Uv),Fn(rl,"sampleCoverage",[1,!1]),Nt(Sl,kp),Fn(Ds,"stencilMask",-1),Fn(Iu,"stencilFunc",[Yh,0,-1]),Fn(Xs,"stencilOpSeparate",[Ic,Al,Al,Al]),Fn(Ma,"stencilOpSeparate",[El,Al,Al,Al]),Nt(cu,$h),Fn(Ys,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Fn(fs,fs,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Ne={gl:B,context:Xr,strings:Se,next:sn,current:vr,draw:zr,elements:Dt,buffer:sr,shader:Cr,attributes:Or.state,vao:Or,uniforms:Ir,framebuffer:kr,extensions:ke,timer:Er,isBufferArgs:xh},gr={primTypes:Ba,compareFuncs:Lc,blendFuncs:Vo,blendEquations:Vt,stencilOps:Ru,glTypes:ss,orientationType:bs};L.optional(function(){Ne.isArrayLike=za}),Kr&&(gr.backBuffer=[El],gr.drawBuffer=X(zt.maxDrawbuffers,function(Ce){return Ce===0?[0]:X(Ce,function(de){return Rp+de})}));var cr=0;function Gn(){var Ce=Nr(),de=Ce.link,qe=Ce.global;Ce.id=cr++,Ce.batchId="0";var mt=de(Ne),bt=Ce.shared={props:"a0"};Object.keys(Ne).forEach(function($e){bt[$e]=qe.def(mt,".",$e)}),L.optional(function(){Ce.CHECK=de(L),Ce.commandStr=L.guessCommand(),Ce.command=de(Ce.commandStr),Ce.assert=function($e,Ee,vt){$e("if(!(",Ee,"))",this.CHECK,".commandRaise(",de(vt),",",this.command,");")},gr.invalidBlendCombinations=Pc});var et=Ce.next={},Ke=Ce.current={};Object.keys(pr).forEach(function($e){Array.isArray(vr[$e])&&(et[$e]=qe.def(bt.next,".",$e),Ke[$e]=qe.def(bt.current,".",$e))});var Je=Ce.constants={};Object.keys(gr).forEach(function($e){Je[$e]=qe.def(JSON.stringify(gr[$e]))}),Ce.invoke=function($e,Ee){switch(Ee.type){case On:var vt=["this",bt.context,bt.props,Ce.batchId];return $e.def(de(Ee.data),".call(",vt.slice(0,Math.max(Ee.data.length+1,4)),")");case Li:return $e.def(bt.props,Ee.data);case fn:return $e.def(bt.context,Ee.data);case Wn:return $e.def("this",Ee.data);case ai:return Ee.data.append(Ce,$e),Ee.data.ref;case Jn:return Ee.data.toString();case $n:return Ee.data.map(function(Et){return Ce.invoke($e,Et)})}},Ce.attribCache={};var Ae={};return Ce.scopeAttrib=function($e){var Ee=Se.id($e);if(Ee in Ae)return Ae[Ee];var vt=Or.scope[Ee];vt||(vt=Or.scope[Ee]=new St);var Et=Ae[Ee]=de(vt);return Et},Ce}function Zn(Ce){var de=Ce.static,qe=Ce.dynamic,mt;if(Oi in de){var bt=!!de[Oi];mt=Za(function(Ke,Je){return bt}),mt.enable=bt}else if(Oi in qe){var et=qe[Oi];mt=ws(et,function(Ke,Je){return Ke.invoke(Je,et)})}return mt}function Sn(Ce,de){var qe=Ce.static,mt=Ce.dynamic;if(Qa in qe){var bt=qe[Qa];return bt?(bt=kr.getFramebuffer(bt),L.command(bt,"invalid framebuffer object"),Za(function(Ke,Je){var Ae=Ke.link(bt),$e=Ke.shared;Je.set($e.framebuffer,".next",Ae);var Ee=$e.context;return Je.set(Ee,"."+ts,Ae+".width"),Je.set(Ee,"."+to,Ae+".height"),Ae})):Za(function(Ke,Je){var Ae=Ke.shared;Je.set(Ae.framebuffer,".next","null");var $e=Ae.context;return Je.set($e,"."+ts,$e+"."+Sd),Je.set($e,"."+to,$e+"."+Mp),"null"})}else if(Qa in mt){var et=mt[Qa];return ws(et,function(Ke,Je){var Ae=Ke.invoke(Je,et),$e=Ke.shared,Ee=$e.framebuffer,vt=Je.def(Ee,".getFramebuffer(",Ae,")");L.optional(function(){Ke.assert(Je,"!"+Ae+"||"+vt,"invalid framebuffer object")}),Je.set(Ee,".next",vt);var Et=$e.context;return Je.set(Et,"."+ts,vt+"?"+vt+".width:"+Et+"."+Sd),Je.set(Et,"."+to,vt+"?"+vt+".height:"+Et+"."+Mp),vt})}else return null}function hi(Ce,de,qe){var mt=Ce.static,bt=Ce.dynamic;function et(Ae){if(Ae in mt){var $e=mt[Ae];L.commandType($e,"object","invalid "+Ae,qe.commandStr);var Ee=!0,vt=$e.x|0,Et=$e.y|0,or,Bt;return"width"in $e?(or=$e.width|0,L.command(or>=0,"invalid "+Ae,qe.commandStr)):Ee=!1,"height"in $e?(Bt=$e.height|0,L.command(Bt>=0,"invalid "+Ae,qe.commandStr)):Ee=!1,new Ss(!Ee&&de&&de.thisDep,!Ee&&de&&de.contextDep,!Ee&&de&&de.propDep,function(Tn,Qn){var gn=Tn.shared.context,zn=or;"width"in $e||(zn=Qn.def(gn,".",ts,"-",vt));var oi=Bt;return"height"in $e||(oi=Qn.def(gn,".",to,"-",Et)),[vt,Et,zn,oi]})}else if(Ae in bt){var er=bt[Ae],Pr=ws(er,function(Tn,Qn){var gn=Tn.invoke(Qn,er);L.optional(function(){Tn.assert(Qn,gn+"&&typeof "+gn+'==="object"',"invalid "+Ae)});var zn=Tn.shared.context,oi=Qn.def(gn,".x|0"),Bi=Qn.def(gn,".y|0"),Ia=Qn.def('"width" in ',gn,"?",gn,".width|0:","(",zn,".",ts,"-",oi,")"),ns=Qn.def('"height" in ',gn,"?",gn,".height|0:","(",zn,".",to,"-",Bi,")");return L.optional(function(){Tn.assert(Qn,Ia+">=0&&"+ns+">=0","invalid "+Ae)}),[oi,Bi,Ia,ns]});return de&&(Pr.thisDep=Pr.thisDep||de.thisDep,Pr.contextDep=Pr.contextDep||de.contextDep,Pr.propDep=Pr.propDep||de.propDep),Pr}else return de?new Ss(de.thisDep,de.contextDep,de.propDep,function(Tn,Qn){var gn=Tn.shared.context;return[0,0,Qn.def(gn,".",ts),Qn.def(gn,".",to)]}):null}var Ke=et(fs);if(Ke){var Je=Ke;Ke=new Ss(Ke.thisDep,Ke.contextDep,Ke.propDep,function(Ae,$e){var Ee=Je.append(Ae,$e),vt=Ae.shared.context;return $e.set(vt,"."+Xl,Ee[2]),$e.set(vt,"."+Mc,Ee[3]),Ee})}return{viewport:Ke,scissor_box:et(Ys)}}function ni(Ce,de){var qe=Ce.static,mt=typeof qe[xs]=="string"&&typeof qe[eo]=="string";if(mt){if(Object.keys(de.dynamic).length>0)return null;var bt=de.static,et=Object.keys(bt);if(et.length>0&&typeof bt[et[0]]=="number"){for(var Ke=[],Je=0;Je<et.length;++Je)L(typeof bt[et[Je]]=="number","must specify all vertex attribute locations when using vaos"),Ke.push([bt[et[Je]]|0,et[Je]]);return Ke}}return null}function vi(Ce,de,qe){var mt=Ce.static,bt=Ce.dynamic;function et(Ee){if(Ee in mt){var vt=Se.id(mt[Ee]);L.optional(function(){Cr.shader(Ql[Ee],vt,L.guessCommand())});var Et=Za(function(){return vt});return Et.id=vt,Et}else if(Ee in bt){var or=bt[Ee];return ws(or,function(Bt,er){var Pr=Bt.invoke(er,or),Tn=er.def(Bt.shared.strings,".id(",Pr,")");return L.optional(function(){er(Bt.shared.shader,".shader(",Ql[Ee],",",Tn,",",Bt.command,");")}),Tn})}return null}var Ke=et(xs),Je=et(eo),Ae=null,$e;return qs(Ke)&&qs(Je)?(Ae=Cr.program(Je.id,Ke.id,null,qe),$e=Za(function(Ee,vt){return Ee.link(Ae)})):$e=new Ss(Ke&&Ke.thisDep||Je&&Je.thisDep,Ke&&Ke.contextDep||Je&&Je.contextDep,Ke&&Ke.propDep||Je&&Je.propDep,function(Ee,vt){var Et=Ee.shared.shader,or;Ke?or=Ke.append(Ee,vt):or=vt.def(Et,".",xs);var Bt;Je?Bt=Je.append(Ee,vt):Bt=vt.def(Et,".",eo);var er=Et+".program("+Bt+","+or;return L.optional(function(){er+=","+Ee.command}),vt.def(er+")")}),{frag:Ke,vert:Je,progVar:$e,program:Ae}}function Fi(Ce,de){var qe=Ce.static,mt=Ce.dynamic;function bt(){if(Pu in qe){var Ee=qe[Pu];xh(Ee)?Ee=Dt.getElements(Dt.create(Ee,!0)):Ee&&(Ee=Dt.getElements(Ee),L.command(Ee,"invalid elements",de.commandStr));var vt=Za(function(or,Bt){if(Ee){var er=or.link(Ee);return or.ELEMENTS=er,er}return or.ELEMENTS=null,null});return vt.value=Ee,vt}else if(Pu in mt){var Et=mt[Pu];return ws(Et,function(or,Bt){var er=or.shared,Pr=er.isBufferArgs,Tn=er.elements,Qn=or.invoke(Bt,Et),gn=Bt.def("null"),zn=Bt.def(Pr,"(",Qn,")"),oi=or.cond(zn).then(gn,"=",Tn,".createStream(",Qn,");").else(gn,"=",Tn,".getElements(",Qn,");");return L.optional(function(){or.assert(oi.else,"!"+Qn+"||"+gn,"invalid elements")}),Bt.entry(oi),Bt.exit(or.cond(zn).then(Tn,".destroyStream(",gn,");")),or.ELEMENTS=gn,gn})}return null}var et=bt();function Ke(){if(fu in qe){var Ee=qe[fu];return L.commandParameter(Ee,Ba,"invalid primitve",de.commandStr),Za(function(Et,or){return Ba[Ee]})}else if(fu in mt){var vt=mt[fu];return ws(vt,function(Et,or){var Bt=Et.constants.primTypes,er=Et.invoke(or,vt);return L.optional(function(){Et.assert(or,er+" in "+Bt,"invalid primitive, must be one of "+Object.keys(Ba))}),or.def(Bt,"[",er,"]")})}else if(et)return qs(et)?et.value?Za(function(Et,or){return or.def(Et.ELEMENTS,".primType")}):Za(function(){return Lp}):new Ss(et.thisDep,et.contextDep,et.propDep,function(Et,or){var Bt=Et.ELEMENTS;return or.def(Bt,"?",Bt,".primType:",Lp)});return null}function Je(Ee,vt){if(Ee in qe){var Et=qe[Ee]|0;return L.command(!vt||Et>=0,"invalid "+Ee,de.commandStr),Za(function(Bt,er){return vt&&(Bt.OFFSET=Et),Et})}else if(Ee in mt){var or=mt[Ee];return ws(or,function(Bt,er){var Pr=Bt.invoke(er,or);return vt&&(Bt.OFFSET=Pr,L.optional(function(){Bt.assert(er,Pr+">=0","invalid "+Ee)})),Pr})}else if(vt&&et)return Za(function(Bt,er){return Bt.OFFSET="0",0});return null}var Ae=Je(Mr,!0);function $e(){if(ko in qe){var Ee=qe[ko]|0;return L.command(typeof Ee=="number"&&Ee>=0,"invalid vertex count",de.commandStr),Za(function(){return Ee})}else if(ko in mt){var vt=mt[ko];return ws(vt,function(Bt,er){var Pr=Bt.invoke(er,vt);return L.optional(function(){Bt.assert(er,"typeof "+Pr+'==="number"&&'+Pr+">=0&&"+Pr+"===("+Pr+"|0)","invalid vertex count")}),Pr})}else if(et)if(qs(et)){if(et)return Ae?new Ss(Ae.thisDep,Ae.contextDep,Ae.propDep,function(Bt,er){var Pr=er.def(Bt.ELEMENTS,".vertCount-",Bt.OFFSET);return L.optional(function(){Bt.assert(er,Pr+">=0","invalid vertex offset/element buffer too small")}),Pr}):Za(function(Bt,er){return er.def(Bt.ELEMENTS,".vertCount")});var Et=Za(function(){return-1});return L.optional(function(){Et.MISSING=!0}),Et}else{var or=new Ss(et.thisDep||Ae.thisDep,et.contextDep||Ae.contextDep,et.propDep||Ae.propDep,function(Bt,er){var Pr=Bt.ELEMENTS;return Bt.OFFSET?er.def(Pr,"?",Pr,".vertCount-",Bt.OFFSET,":-1"):er.def(Pr,"?",Pr,".vertCount:-1")});return L.optional(function(){or.DYNAMIC=!0}),or}return null}return{elements:et,primitive:Ke(),count:$e(),instances:Je(nl,!1),offset:Ae}}function Ua(Ce,de){var qe=Ce.static,mt=Ce.dynamic,bt={};return yr.forEach(function(et){var Ke=Ur(et);function Je(Ae,$e){if(et in qe){var Ee=Ae(qe[et]);bt[Ke]=Za(function(){return Ee})}else if(et in mt){var vt=mt[et];bt[Ke]=ws(vt,function(Et,or){return $e(Et,or,Et.invoke(or,vt))})}}switch(et){case Uo:case Xn:case ci:case Sl:case bo:case cu:case _s:case el:case tl:case Ta:return Je(function(Ae){return L.commandType(Ae,"boolean",et,de.commandStr),Ae},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,"typeof "+Ee+'==="boolean"',"invalid flag "+et,Ae.commandStr)}),Ee});case So:return Je(function(Ae){return L.commandParameter(Ae,Lc,"invalid "+et,de.commandStr),Lc[Ae]},function(Ae,$e,Ee){var vt=Ae.constants.compareFuncs;return L.optional(function(){Ae.assert($e,Ee+" in "+vt,"invalid "+et+", must be one of "+Object.keys(Lc))}),$e.def(vt,"[",Ee,"]")});case _a:return Je(function(Ae){return L.command(za(Ae)&&Ae.length===2&&typeof Ae[0]=="number"&&typeof Ae[1]=="number"&&Ae[0]<=Ae[1],"depth range is 2d array",de.commandStr),Ae},function(Ae,$e,Ee){L.optional(function(){Ae.assert($e,Ae.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===2&&typeof "+Ee+'[0]==="number"&&typeof '+Ee+'[1]==="number"&&'+Ee+"[0]<="+Ee+"[1]","depth range must be a 2d array")});var vt=$e.def("+",Ee,"[0]"),Et=$e.def("+",Ee,"[1]");return[vt,Et]});case va:return Je(function(Ae){L.commandType(Ae,"object","blend.func",de.commandStr);var $e="srcRGB"in Ae?Ae.srcRGB:Ae.src,Ee="srcAlpha"in Ae?Ae.srcAlpha:Ae.src,vt="dstRGB"in Ae?Ae.dstRGB:Ae.dst,Et="dstAlpha"in Ae?Ae.dstAlpha:Ae.dst;return L.commandParameter($e,Vo,Ke+".srcRGB",de.commandStr),L.commandParameter(Ee,Vo,Ke+".srcAlpha",de.commandStr),L.commandParameter(vt,Vo,Ke+".dstRGB",de.commandStr),L.commandParameter(Et,Vo,Ke+".dstAlpha",de.commandStr),L.command(Pc.indexOf($e+", "+vt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+$e+", "+vt+")",de.commandStr),[Vo[$e],Vo[vt],Vo[Ee],Vo[Et]]},function(Ae,$e,Ee){var vt=Ae.constants.blendFuncs;L.optional(function(){Ae.assert($e,Ee+"&&typeof "+Ee+'==="object"',"invalid blend func, must be an object")});function Et(gn,zn){var oi=$e.def('"',gn,zn,'" in ',Ee,"?",Ee,".",gn,zn,":",Ee,".",gn);return L.optional(function(){Ae.assert($e,oi+" in "+vt,"invalid "+et+"."+gn+zn+", must be one of "+Object.keys(Vo))}),oi}var or=Et("src","RGB"),Bt=Et("dst","RGB");L.optional(function(){var gn=Ae.constants.invalidBlendCombinations;Ae.assert($e,gn+".indexOf("+or+'+", "+'+Bt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var er=$e.def(vt,"[",or,"]"),Pr=$e.def(vt,"[",Et("src","Alpha"),"]"),Tn=$e.def(vt,"[",Bt,"]"),Qn=$e.def(vt,"[",Et("dst","Alpha"),"]");return[er,Tn,Pr,Qn]});case Ja:return Je(function(Ae){if(typeof Ae=="string")return L.commandParameter(Ae,Vt,"invalid "+et,de.commandStr),[Vt[Ae],Vt[Ae]];if(typeof Ae=="object")return L.commandParameter(Ae.rgb,Vt,et+".rgb",de.commandStr),L.commandParameter(Ae.alpha,Vt,et+".alpha",de.commandStr),[Vt[Ae.rgb],Vt[Ae.alpha]];L.commandRaise("invalid blend.equation",de.commandStr)},function(Ae,$e,Ee){var vt=Ae.constants.blendEquations,Et=$e.def(),or=$e.def(),Bt=Ae.cond("typeof ",Ee,'==="string"');return L.optional(function(){function er(Pr,Tn,Qn){Ae.assert(Pr,Qn+" in "+vt,"invalid "+Tn+", must be one of "+Object.keys(Vt))}er(Bt.then,et,Ee),Ae.assert(Bt.else,Ee+"&&typeof "+Ee+'==="object"',"invalid "+et),er(Bt.else,et+".rgb",Ee+".rgb"),er(Bt.else,et+".alpha",Ee+".alpha")}),Bt.then(Et,"=",or,"=",vt,"[",Ee,"];"),Bt.else(Et,"=",vt,"[",Ee,".rgb];",or,"=",vt,"[",Ee,".alpha];"),$e(Bt),[Et,or]});case jn:return Je(function(Ae){return L.command(za(Ae)&&Ae.length===4,"blend.color must be a 4d array",de.commandStr),X(4,function($e){return+Ae[$e]})},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,Ae.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","blend.color must be a 4d array")}),X(4,function(vt){return $e.def("+",Ee,"[",vt,"]")})});case Ds:return Je(function(Ae){return L.commandType(Ae,"number",Ke,de.commandStr),Ae|0},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,"typeof "+Ee+'==="number"',"invalid stencil.mask")}),$e.def(Ee,"|0")});case Iu:return Je(function(Ae){L.commandType(Ae,"object",Ke,de.commandStr);var $e=Ae.cmp||"keep",Ee=Ae.ref||0,vt="mask"in Ae?Ae.mask:-1;return L.commandParameter($e,Lc,et+".cmp",de.commandStr),L.commandType(Ee,"number",et+".ref",de.commandStr),L.commandType(vt,"number",et+".mask",de.commandStr),[Lc[$e],Ee,vt]},function(Ae,$e,Ee){var vt=Ae.constants.compareFuncs;L.optional(function(){function er(){Ae.assert($e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}er(Ee+"&&typeof ",Ee,'==="object"'),er('!("cmp" in ',Ee,")||(",Ee,".cmp in ",vt,")")});var Et=$e.def('"cmp" in ',Ee,"?",vt,"[",Ee,".cmp]",":",Al),or=$e.def(Ee,".ref|0"),Bt=$e.def('"mask" in ',Ee,"?",Ee,".mask|0:-1");return[Et,or,Bt]});case Xs:case Ma:return Je(function(Ae){L.commandType(Ae,"object",Ke,de.commandStr);var $e=Ae.fail||"keep",Ee=Ae.zfail||"keep",vt=Ae.zpass||"keep";return L.commandParameter($e,Ru,et+".fail",de.commandStr),L.commandParameter(Ee,Ru,et+".zfail",de.commandStr),L.commandParameter(vt,Ru,et+".zpass",de.commandStr),[et===Ma?El:Ic,Ru[$e],Ru[Ee],Ru[vt]]},function(Ae,$e,Ee){var vt=Ae.constants.stencilOps;L.optional(function(){Ae.assert($e,Ee+"&&typeof "+Ee+'==="object"',"invalid "+et)});function Et(or){return L.optional(function(){Ae.assert($e,'!("'+or+'" in '+Ee+")||("+Ee+"."+or+" in "+vt+")","invalid "+et+"."+or+", must be one of "+Object.keys(Ru))}),$e.def('"',or,'" in ',Ee,"?",vt,"[",Ee,".",or,"]:",Al)}return[et===Ma?El:Ic,Et("fail"),Et("zfail"),Et("zpass")]});case lu:return Je(function(Ae){L.commandType(Ae,"object",Ke,de.commandStr);var $e=Ae.factor|0,Ee=Ae.units|0;return L.commandType($e,"number",Ke+".factor",de.commandStr),L.commandType(Ee,"number",Ke+".units",de.commandStr),[$e,Ee]},function(Ae,$e,Ee){L.optional(function(){Ae.assert($e,Ee+"&&typeof "+Ee+'==="object"',"invalid "+et)});var vt=$e.def(Ee,".factor|0"),Et=$e.def(Ee,".units|0");return[vt,Et]});case ku:return Je(function(Ae){var $e=0;return Ae==="front"?$e=Ic:Ae==="back"&&($e=El),L.command(!!$e,Ke,de.commandStr),$e},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,Ee+'==="front"||'+Ee+'==="back"',"invalid cull.face")}),$e.def(Ee,'==="front"?',Ic,":",El)});case ys:return Je(function(Ae){return L.command(typeof Ae=="number"&&Ae>=zt.lineWidthDims[0]&&Ae<=zt.lineWidthDims[1],"invalid line width, must be a positive number between "+zt.lineWidthDims[0]+" and "+zt.lineWidthDims[1],de.commandStr),Ae},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,"typeof "+Ee+'==="number"&&'+Ee+">="+zt.lineWidthDims[0]+"&&"+Ee+"<="+zt.lineWidthDims[1],"invalid line width")}),Ee});case Ro:return Je(function(Ae){return L.commandParameter(Ae,bs,Ke,de.commandStr),bs[Ae]},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,Ee+'==="cw"||'+Ee+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),$e.def(Ee+'==="cw"?'+Os+":"+Xh)});case es:return Je(function(Ae){return L.command(za(Ae)&&Ae.length===4,"color.mask must be length 4 array",de.commandStr),Ae.map(function($e){return!!$e})},function(Ae,$e,Ee){return L.optional(function(){Ae.assert($e,Ae.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","invalid color.mask")}),X(4,function(vt){return"!!"+Ee+"["+vt+"]"})});case rl:return Je(function(Ae){L.command(typeof Ae=="object"&&Ae,Ke,de.commandStr);var $e="value"in Ae?Ae.value:1,Ee=!!Ae.invert;return L.command(typeof $e=="number"&&$e>=0&&$e<=1,"sample.coverage.value must be a number between 0 and 1",de.commandStr),[$e,Ee]},function(Ae,$e,Ee){L.optional(function(){Ae.assert($e,Ee+"&&typeof "+Ee+'==="object"',"invalid sample.coverage")});var vt=$e.def('"value" in ',Ee,"?+",Ee,".value:1"),Et=$e.def("!!",Ee,".invert");return[vt,Et]})}}),bt}function wo(Ce,de){var qe=Ce.static,mt=Ce.dynamic,bt={};return Object.keys(qe).forEach(function(et){var Ke=qe[et],Je;if(typeof Ke=="number"||typeof Ke=="boolean")Je=Za(function(){return Ke});else if(typeof Ke=="function"){var Ae=Ke._reglType;Ae==="texture2d"||Ae==="textureCube"?Je=Za(function($e){return $e.link(Ke)}):Ae==="framebuffer"||Ae==="framebufferCube"?(L.command(Ke.color.length>0,'missing color attachment for framebuffer sent to uniform "'+et+'"',de.commandStr),Je=Za(function($e){return $e.link(Ke.color[0])})):L.commandRaise('invalid data for uniform "'+et+'"',de.commandStr)}else za(Ke)?Je=Za(function($e){var Ee=$e.global.def("[",X(Ke.length,function(vt){return L.command(typeof Ke[vt]=="number"||typeof Ke[vt]=="boolean","invalid uniform "+et,$e.commandStr),Ke[vt]}),"]");return Ee}):L.commandRaise('invalid or missing data for uniform "'+et+'"',de.commandStr);Je.value=Ke,bt[et]=Je}),Object.keys(mt).forEach(function(et){var Ke=mt[et];bt[et]=ws(Ke,function(Je,Ae){return Je.invoke(Ae,Ke)})}),bt}function Si(Ce,de){var qe=Ce.static,mt=Ce.dynamic,bt={};return Object.keys(qe).forEach(function(et){var Ke=qe[et],Je=Se.id(et),Ae=new St;if(xh(Ke))Ae.state=En,Ae.buffer=sr.getBuffer(sr.create(Ke,il,!1,!0)),Ae.type=0;else{var $e=sr.getBuffer(Ke);if($e)Ae.state=En,Ae.buffer=$e,Ae.type=0;else if(L.command(typeof Ke=="object"&&Ke,"invalid data for attribute "+et,de.commandStr),"constant"in Ke){var Ee=Ke.constant;Ae.buffer="null",Ae.state=Dn,typeof Ee=="number"?Ae.x=Ee:(L.command(za(Ee)&&Ee.length>0&&Ee.length<=4,"invalid constant for attribute "+et,de.commandStr),Dr.forEach(function(Tn,Qn){Qn<Ee.length&&(Ae[Tn]=Ee[Qn])}))}else{xh(Ke.buffer)?$e=sr.getBuffer(sr.create(Ke.buffer,il,!1,!0)):$e=sr.getBuffer(Ke.buffer),L.command(!!$e,'missing buffer for attribute "'+et+'"',de.commandStr);var vt=Ke.offset|0;L.command(vt>=0,'invalid offset for attribute "'+et+'"',de.commandStr);var Et=Ke.stride|0;L.command(Et>=0&&Et<256,'invalid stride for attribute "'+et+'", must be integer betweeen [0, 255]',de.commandStr);var or=Ke.size|0;L.command(!("size"in Ke)||or>0&&or<=4,'invalid size for attribute "'+et+'", must be 1,2,3,4',de.commandStr);var Bt=!!Ke.normalized,er=0;"type"in Ke&&(L.commandParameter(Ke.type,ss,"invalid type for attribute "+et,de.commandStr),er=ss[Ke.type]);var Pr=Ke.divisor|0;"divisor"in Ke&&(L.command(Pr===0||Tr,'cannot specify divisor for attribute "'+et+'", instancing not supported',de.commandStr),L.command(Pr>=0,'invalid divisor for attribute "'+et+'"',de.commandStr)),L.optional(function(){var Tn=de.commandStr,Qn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ke).forEach(function(gn){L.command(Qn.indexOf(gn)>=0,'unknown parameter "'+gn+'" for attribute pointer "'+et+'" (valid parameters are '+Qn+")",Tn)})}),Ae.buffer=$e,Ae.state=En,Ae.size=or,Ae.normalized=Bt,Ae.type=er||$e.dtype,Ae.offset=vt,Ae.stride=Et,Ae.divisor=Pr}}bt[et]=Za(function(Tn,Qn){var gn=Tn.attribCache;if(Je in gn)return gn[Je];var zn={isStream:!1};return Object.keys(Ae).forEach(function(oi){zn[oi]=Ae[oi]}),Ae.buffer&&(zn.buffer=Tn.link(Ae.buffer),zn.type=zn.type||zn.buffer+".dtype"),gn[Je]=zn,zn})}),Object.keys(mt).forEach(function(et){var Ke=mt[et];function Je(Ae,$e){var Ee=Ae.invoke($e,Ke),vt=Ae.shared,Et=Ae.constants,or=vt.isBufferArgs,Bt=vt.buffer;L.optional(function(){Ae.assert($e,Ee+"&&(typeof "+Ee+'==="object"||typeof '+Ee+'==="function")&&('+or+"("+Ee+")||"+Bt+".getBuffer("+Ee+")||"+Bt+".getBuffer("+Ee+".buffer)||"+or+"("+Ee+'.buffer)||("constant" in '+Ee+"&&(typeof "+Ee+'.constant==="number"||'+vt.isArrayLike+"("+Ee+".constant))))",'invalid dynamic attribute "'+et+'"')});var er={isStream:$e.def(!1)},Pr=new St;Pr.state=En,Object.keys(Pr).forEach(function(zn){er[zn]=$e.def(""+Pr[zn])});var Tn=er.buffer,Qn=er.type;$e("if(",or,"(",Ee,")){",er.isStream,"=true;",Tn,"=",Bt,".createStream(",il,",",Ee,");",Qn,"=",Tn,".dtype;","}else{",Tn,"=",Bt,".getBuffer(",Ee,");","if(",Tn,"){",Qn,"=",Tn,".dtype;",'}else if("constant" in ',Ee,"){",er.state,"=",Dn,";","if(typeof "+Ee+'.constant === "number"){',er[Dr[0]],"=",Ee,".constant;",Dr.slice(1).map(function(zn){return er[zn]}).join("="),"=0;","}else{",Dr.map(function(zn,oi){return er[zn]+"="+Ee+".constant.length>"+oi+"?"+Ee+".constant["+oi+"]:0;"}).join(""),"}}else{","if(",or,"(",Ee,".buffer)){",Tn,"=",Bt,".createStream(",il,",",Ee,".buffer);","}else{",Tn,"=",Bt,".getBuffer(",Ee,".buffer);","}",Qn,'="type" in ',Ee,"?",Et.glTypes,"[",Ee,".type]:",Tn,".dtype;",er.normalized,"=!!",Ee,".normalized;");function gn(zn){$e(er[zn],"=",Ee,".",zn,"|0;")}return gn("size"),gn("offset"),gn("stride"),gn("divisor"),$e("}}"),$e.exit("if(",er.isStream,"){",Bt,".destroyStream(",Tn,");","}"),er}bt[et]=ws(Ke,Je)}),bt}function ba(Ce,de){var qe=Ce.static,mt=Ce.dynamic;if(Lu in qe){var bt=qe[Lu];return bt!==null&&Or.getVAO(bt)===null&&(bt=Or.createVAO(bt)),Za(function(Ke){return Ke.link(Or.getVAO(bt))})}else if(Lu in mt){var et=mt[Lu];return ws(et,function(Ke,Je){var Ae=Ke.invoke(Je,et);return Je.def(Ke.shared.vao+".getVAO("+Ae+")")})}return null}function ua(Ce){var de=Ce.static,qe=Ce.dynamic,mt={};return Object.keys(de).forEach(function(bt){var et=de[bt];mt[bt]=Za(function(Ke,Je){return typeof et=="number"||typeof et=="boolean"?""+et:Ke.link(et)})}),Object.keys(qe).forEach(function(bt){var et=qe[bt];mt[bt]=ws(et,function(Ke,Je){return Ke.invoke(Je,et)})}),mt}function Wa(Ce,de,qe,mt,bt){var et=Ce.static,Ke=Ce.dynamic;L.optional(function(){var gn=[Qa,eo,xs,Pu,fu,Mr,ko,nl,Oi,Lu].concat(yr);function zn(oi){Object.keys(oi).forEach(function(Bi){L.command(gn.indexOf(Bi)>=0,'unknown parameter "'+Bi+'"',bt.commandStr)})}zn(et),zn(Ke)});var Je=ni(Ce,de),Ae=Sn(Ce,bt),$e=hi(Ce,Ae,bt),Ee=Fi(Ce,bt),vt=Ua(Ce,bt),Et=vi(Ce,bt,Je);function or(gn){var zn=$e[gn];zn&&(vt[gn]=zn)}or(fs),or(Ur(Ys));var Bt=Object.keys(vt).length>0,er={framebuffer:Ae,draw:Ee,shader:Et,state:vt,dirty:Bt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(er.profile=Zn(Ce,bt),er.uniforms=wo(qe,bt),er.drawVAO=er.scopeVAO=ba(Ce,bt),!er.drawVAO&&Et.program&&!Je&&ke.angle_instanced_arrays){var Pr=!0,Tn=Et.program.attributes.map(function(gn){var zn=de.static[gn];return Pr=Pr&&!!zn,zn});if(Pr&&Tn.length>0){var Qn=Or.getVAO(Or.createVAO(Tn));er.drawVAO=new Ss(null,null,null,function(gn,zn){return gn.link(Qn)}),er.useVAO=!0}}return Je?er.useVAO=!0:er.attributes=Si(de,bt),er.context=ua(mt,bt),er}function lo(Ce,de,qe){var mt=Ce.shared,bt=mt.context,et=Ce.scope();Object.keys(qe).forEach(function(Ke){de.save(bt,"."+Ke);var Je=qe[Ke],Ae=Je.append(Ce,de);Array.isArray(Ae)?et(bt,".",Ke,"=[",Ae.join(),"];"):et(bt,".",Ke,"=",Ae,";")}),de(et)}function Eo(Ce,de,qe,mt){var bt=Ce.shared,et=bt.gl,Ke=bt.framebuffer,Je;Kr&&(Je=de.def(bt.extensions,".webgl_draw_buffers"));var Ae=Ce.constants,$e=Ae.drawBuffer,Ee=Ae.backBuffer,vt;qe?vt=qe.append(Ce,de):vt=de.def(Ke,".next"),mt||de("if(",vt,"!==",Ke,".cur){"),de("if(",vt,"){",et,".bindFramebuffer(",_h,",",vt,".framebuffer);"),Kr&&de(Je,".drawBuffersWEBGL(",$e,"[",vt,".colorAttachments.length]);"),de("}else{",et,".bindFramebuffer(",_h,",null);"),Kr&&de(Je,".drawBuffersWEBGL(",Ee,");"),de("}",Ke,".cur=",vt,";"),mt||de("}")}function Io(Ce,de,qe){var mt=Ce.shared,bt=mt.gl,et=Ce.current,Ke=Ce.next,Je=mt.current,Ae=mt.next,$e=Ce.cond(Je,".dirty");yr.forEach(function(Ee){var vt=Ur(Ee);if(!(vt in qe.state)){var Et,or;if(vt in Ke){Et=Ke[vt],or=et[vt];var Bt=X(vr[vt].length,function(Pr){return $e.def(Et,"[",Pr,"]")});$e(Ce.cond(Bt.map(function(Pr,Tn){return Pr+"!=="+or+"["+Tn+"]"}).join("||")).then(bt,".",pr[vt],"(",Bt,");",Bt.map(function(Pr,Tn){return or+"["+Tn+"]="+Pr}).join(";"),";"))}else{Et=$e.def(Ae,".",vt);var er=Ce.cond(Et,"!==",Je,".",vt);$e(er),vt in Zr?er(Ce.cond(Et).then(bt,".enable(",Zr[vt],");").else(bt,".disable(",Zr[vt],");"),Je,".",vt,"=",Et,";"):er(bt,".",pr[vt],"(",Et,");",Je,".",vt,"=",Et,";")}}}),Object.keys(qe.state).length===0&&$e(Je,".dirty=false;"),de($e)}function Do(Ce,de,qe,mt){var bt=Ce.shared,et=Ce.current,Ke=bt.current,Je=bt.gl;Dp(Object.keys(qe)).forEach(function(Ae){var $e=qe[Ae];if(!(mt&&!mt($e))){var Ee=$e.append(Ce,de);if(Zr[Ae]){var vt=Zr[Ae];qs($e)?Ee?de(Je,".enable(",vt,");"):de(Je,".disable(",vt,");"):de(Ce.cond(Ee).then(Je,".enable(",vt,");").else(Je,".disable(",vt,");")),de(Ke,".",Ae,"=",Ee,";")}else if(za(Ee)){var Et=et[Ae];de(Je,".",pr[Ae],"(",Ee,");",Ee.map(function(or,Bt){return Et+"["+Bt+"]="+or}).join(";"),";")}else de(Je,".",pr[Ae],"(",Ee,");",Ke,".",Ae,"=",Ee,";")}})}function $a(Ce,de){Tr&&(Ce.instancing=de.def(Ce.shared.extensions,".angle_instanced_arrays"))}function pi(Ce,de,qe,mt,bt){var et=Ce.shared,Ke=Ce.stats,Je=et.current,Ae=et.timer,$e=qe.profile;function Ee(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var vt,Et;function or(gn){vt=de.def(),gn(vt,"=",Ee(),";"),typeof bt=="string"?gn(Ke,".count+=",bt,";"):gn(Ke,".count++;"),Er&&(mt?(Et=de.def(),gn(Et,"=",Ae,".getNumPendingQueries();")):gn(Ae,".beginQuery(",Ke,");"))}function Bt(gn){gn(Ke,".cpuTime+=",Ee(),"-",vt,";"),Er&&(mt?gn(Ae,".pushScopeStats(",Et,",",Ae,".getNumPendingQueries(),",Ke,");"):gn(Ae,".endQuery();"))}function er(gn){var zn=de.def(Je,".profile");de(Je,".profile=",gn,";"),de.exit(Je,".profile=",zn,";")}var Pr;if($e){if(qs($e)){$e.enable?(or(de),Bt(de.exit),er("true")):er("false");return}Pr=$e.append(Ce,de),er(Pr)}else Pr=de.def(Je,".profile");var Tn=Ce.block();or(Tn),de("if(",Pr,"){",Tn,"}");var Qn=Ce.block();Bt(Qn),de.exit("if(",Pr,"){",Qn,"}")}function jo(Ce,de,qe,mt,bt){var et=Ce.shared;function Ke(Ae){switch(Ae){case dh:case af:case Lf:return 2;case ka:case wl:case Kl:return 3;case nf:case ql:case Rf:return 4;default:return 1}}function Je(Ae,$e,Ee){var vt=et.gl,Et=de.def(Ae,".location"),or=de.def(et.attributes,"[",Et,"]"),Bt=Ee.state,er=Ee.buffer,Pr=[Ee.x,Ee.y,Ee.z,Ee.w],Tn=["buffer","normalized","offset","stride"];function Qn(){de("if(!",or,".buffer){",vt,".enableVertexAttribArray(",Et,");}");var zn=Ee.type,oi;if(Ee.size?oi=de.def(Ee.size,"||",$e):oi=$e,de("if(",or,".type!==",zn,"||",or,".size!==",oi,"||",Tn.map(function(Ia){return or+"."+Ia+"!=="+Ee[Ia]}).join("||"),"){",vt,".bindBuffer(",il,",",er,".buffer);",vt,".vertexAttribPointer(",[Et,oi,zn,Ee.normalized,Ee.stride,Ee.offset],");",or,".type=",zn,";",or,".size=",oi,";",Tn.map(function(Ia){return or+"."+Ia+"="+Ee[Ia]+";"}).join(""),"}"),Tr){var Bi=Ee.divisor;de("if(",or,".divisor!==",Bi,"){",Ce.instancing,".vertexAttribDivisorANGLE(",[Et,Bi],");",or,".divisor=",Bi,";}")}}function gn(){de("if(",or,".buffer){",vt,".disableVertexAttribArray(",Et,");",or,".buffer=null;","}if(",Dr.map(function(zn,oi){return or+"."+zn+"!=="+Pr[oi]}).join("||"),"){",vt,".vertexAttrib4f(",Et,",",Pr,");",Dr.map(function(zn,oi){return or+"."+zn+"="+Pr[oi]+";"}).join(""),"}")}Bt===En?Qn():Bt===Dn?gn():(de("if(",Bt,"===",En,"){"),Qn(),de("}else{"),gn(),de("}"))}mt.forEach(function(Ae){var $e=Ae.name,Ee=qe.attributes[$e],vt;if(Ee){if(!bt(Ee))return;vt=Ee.append(Ce,de)}else{if(!bt(Kh))return;var Et=Ce.scopeAttrib($e);L.optional(function(){Ce.assert(de,Et+".state","missing attribute "+$e)}),vt={},Object.keys(new St).forEach(function(or){vt[or]=de.def(Et,".",or)})}Je(Ce.link(Ae),Ke(Ae.info.type),vt)})}function Wi(Ce,de,qe,mt,bt){for(var et=Ce.shared,Ke=et.gl,Je,Ae=0;Ae<mt.length;++Ae){var $e=mt[Ae],Ee=$e.name,vt=$e.info.type,Et=qe.uniforms[Ee],or=Ce.link($e),Bt=or+".location",er;if(Et){if(!bt(Et))continue;if(qs(Et)){var Pr=Et.value;if(L.command(Pr!==null&&typeof Pr!="undefined",'missing uniform "'+Ee+'"',Ce.commandStr),vt===Df||vt===ol){L.command(typeof Pr=="function"&&(vt===Df&&(Pr._reglType==="texture2d"||Pr._reglType==="framebuffer")||vt===ol&&(Pr._reglType==="textureCube"||Pr._reglType==="framebufferCube")),"invalid texture for uniform "+Ee,Ce.commandStr);var Tn=Ce.link(Pr._texture||Pr.color[0]._texture);de(Ke,".uniform1i(",Bt,",",Tn+".bind());"),de.exit(Tn,".unbind();")}else if(vt===Jl||vt===kc||vt===al){L.optional(function(){L.command(za(Pr),"invalid matrix for uniform "+Ee,Ce.commandStr),L.command(vt===Jl&&Pr.length===4||vt===kc&&Pr.length===9||vt===al&&Pr.length===16,"invalid length for matrix uniform "+Ee,Ce.commandStr)});var Qn=Ce.global.def("new Float32Array(["+Array.prototype.slice.call(Pr)+"])"),gn=2;vt===kc?gn=3:vt===al&&(gn=4),de(Ke,".uniformMatrix",gn,"fv(",Bt,",false,",Qn,");")}else{switch(vt){case pu:L.commandType(Pr,"number","uniform "+Ee,Ce.commandStr),Je="1f";break;case dh:L.command(za(Pr)&&Pr.length===2,"uniform "+Ee,Ce.commandStr),Je="2f";break;case ka:L.command(za(Pr)&&Pr.length===3,"uniform "+Ee,Ce.commandStr),Je="3f";break;case nf:L.command(za(Pr)&&Pr.length===4,"uniform "+Ee,Ce.commandStr),Je="4f";break;case mh:L.commandType(Pr,"boolean","uniform "+Ee,Ce.commandStr),Je="1i";break;case vh:L.commandType(Pr,"number","uniform "+Ee,Ce.commandStr),Je="1i";break;case Lf:L.command(za(Pr)&&Pr.length===2,"uniform "+Ee,Ce.commandStr),Je="2i";break;case af:L.command(za(Pr)&&Pr.length===2,"uniform "+Ee,Ce.commandStr),Je="2i";break;case Kl:L.command(za(Pr)&&Pr.length===3,"uniform "+Ee,Ce.commandStr),Je="3i";break;case wl:L.command(za(Pr)&&Pr.length===3,"uniform "+Ee,Ce.commandStr),Je="3i";break;case Rf:L.command(za(Pr)&&Pr.length===4,"uniform "+Ee,Ce.commandStr),Je="4i";break;case ql:L.command(za(Pr)&&Pr.length===4,"uniform "+Ee,Ce.commandStr),Je="4i";break}de(Ke,".uniform",Je,"(",Bt,",",za(Pr)?Array.prototype.slice.call(Pr):Pr,");")}continue}else er=Et.append(Ce,de)}else{if(!bt(Kh))continue;er=de.def(et.uniforms,"[",Se.id(Ee),"]")}vt===Df?(L(!Array.isArray(er),"must specify a scalar prop for textures"),de("if(",er,"&&",er,'._reglType==="framebuffer"){',er,"=",er,".color[0];","}")):vt===ol&&(L(!Array.isArray(er),"must specify a scalar prop for cube maps"),de("if(",er,"&&",er,'._reglType==="framebufferCube"){',er,"=",er,".color[0];","}")),L.optional(function(){function ns(du,zf){Ce.assert(de,du,'bad data or missing for uniform "'+Ee+'".  '+zf)}function Bf(du){L(!Array.isArray(er),"must not specify an array type for uniform"),ns("typeof "+er+'==="'+du+'"',"invalid type, expected "+du)}function Js(du,zf){Array.isArray(er)?L(er.length===du,"must have length "+du):ns(et.isArrayLike+"("+er+")&&"+er+".length==="+du,"invalid vector, should have length "+du,Ce.commandStr)}function Qh(du){L(!Array.isArray(er),"must not specify a value type"),ns("typeof "+er+'==="function"&&'+er+'._reglType==="texture'+(du===Yl?"2d":"Cube")+'"',"invalid texture type",Ce.commandStr)}switch(vt){case vh:Bf("number");break;case af:Js(2,"number");break;case wl:Js(3,"number");break;case ql:Js(4,"number");break;case pu:Bf("number");break;case dh:Js(2,"number");break;case ka:Js(3,"number");break;case nf:Js(4,"number");break;case mh:Bf("boolean");break;case Lf:Js(2,"boolean");break;case Kl:Js(3,"boolean");break;case Rf:Js(4,"boolean");break;case Jl:Js(4,"number");break;case kc:Js(9,"number");break;case al:Js(16,"number");break;case Df:Qh(Yl);break;case ol:Qh(Pf);break}});var zn=1;switch(vt){case Df:case ol:var oi=de.def(er,"._texture");de(Ke,".uniform1i(",Bt,",",oi,".bind());"),de.exit(oi,".unbind();");continue;case vh:case mh:Je="1i";break;case af:case Lf:Je="2i",zn=2;break;case wl:case Kl:Je="3i",zn=3;break;case ql:case Rf:Je="4i",zn=4;break;case pu:Je="1f";break;case dh:Je="2f",zn=2;break;case ka:Je="3f",zn=3;break;case nf:Je="4f",zn=4;break;case Jl:Je="Matrix2fv";break;case kc:Je="Matrix3fv";break;case al:Je="Matrix4fv";break}if(de(Ke,".uniform",Je,"(",Bt,","),Je.charAt(0)==="M"){var Bi=Math.pow(vt-Jl+2,2),Ia=Ce.global.def("new Float32Array(",Bi,")");Array.isArray(er)?de("false,(",X(Bi,function(ns){return Ia+"["+ns+"]="+er[ns]}),",",Ia,")"):de("false,(Array.isArray(",er,")||",er," instanceof Float32Array)?",er,":(",X(Bi,function(ns){return Ia+"["+ns+"]="+er+"["+ns+"]"}),",",Ia,")")}else zn>1?de(X(zn,function(ns){return Array.isArray(er)?er[ns]:er+"["+ns+"]"})):(L(!Array.isArray(er),"uniform value must not be an array"),de(er));de(");")}}function Un(Ce,de,qe,mt){var bt=Ce.shared,et=bt.gl,Ke=bt.draw,Je=mt.draw;function Ae(){var oi=Je.elements,Bi,Ia=de;return oi?((oi.contextDep&&mt.contextDynamic||oi.propDep)&&(Ia=qe),Bi=oi.append(Ce,Ia)):Bi=Ia.def(Ke,".",Pu),Bi&&Ia("if("+Bi+")"+et+".bindBuffer("+ph+","+Bi+".buffer.buffer);"),Bi}function $e(){var oi=Je.count,Bi,Ia=de;return oi?((oi.contextDep&&mt.contextDynamic||oi.propDep)&&(Ia=qe),Bi=oi.append(Ce,Ia),L.optional(function(){oi.MISSING&&Ce.assert(de,"false","missing vertex count"),oi.DYNAMIC&&Ce.assert(Ia,Bi+">=0","missing vertex count")})):(Bi=Ia.def(Ke,".",ko),L.optional(function(){Ce.assert(Ia,Bi+">=0","missing vertex count")})),Bi}var Ee=Ae();function vt(oi){var Bi=Je[oi];return Bi?Bi.contextDep&&mt.contextDynamic||Bi.propDep?Bi.append(Ce,qe):Bi.append(Ce,de):de.def(Ke,".",oi)}var Et=vt(fu),or=vt(Mr),Bt=$e();if(typeof Bt=="number"){if(Bt===0)return}else qe("if(",Bt,"){"),qe.exit("}");var er,Pr;Tr&&(er=vt(nl),Pr=Ce.instancing);var Tn=Ee+".type",Qn=Je.elements&&qs(Je.elements);function gn(){function oi(){qe(Pr,".drawElementsInstancedANGLE(",[Et,Bt,Tn,or+"<<(("+Tn+"-"+an+")>>1)",er],");")}function Bi(){qe(Pr,".drawArraysInstancedANGLE(",[Et,or,Bt,er],");")}Ee?Qn?oi():(qe("if(",Ee,"){"),oi(),qe("}else{"),Bi(),qe("}")):Bi()}function zn(){function oi(){qe(et+".drawElements("+[Et,Bt,Tn,or+"<<(("+Tn+"-"+an+")>>1)"]+");")}function Bi(){qe(et+".drawArrays("+[Et,or,Bt]+");")}Ee?Qn?oi():(qe("if(",Ee,"){"),oi(),qe("}else{"),Bi(),qe("}")):Bi()}Tr&&(typeof er!="number"||er>=0)?typeof er=="string"?(qe("if(",er,">0){"),gn(),qe("}else if(",er,"<0){"),zn(),qe("}")):gn():zn()}function _i(Ce,de,qe,mt,bt){var et=Gn(),Ke=et.proc("body",bt);return L.optional(function(){et.commandStr=de.commandStr,et.command=et.link(de.commandStr)}),Tr&&(et.instancing=Ke.def(et.shared.extensions,".angle_instanced_arrays")),Ce(et,Ke,qe,mt),et.compile().body}function Ii(Ce,de,qe,mt){$a(Ce,de),qe.useVAO?qe.drawVAO?de(Ce.shared.vao,".setVAO(",qe.drawVAO.append(Ce,de),");"):de(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(de(Ce.shared.vao,".setVAO(null);"),jo(Ce,de,qe,mt.attributes,function(){return!0})),Wi(Ce,de,qe,mt.uniforms,function(){return!0}),Un(Ce,de,de,qe)}function Va(Ce,de){var qe=Ce.proc("draw",1);$a(Ce,qe),lo(Ce,qe,de.context),Eo(Ce,qe,de.framebuffer),Io(Ce,qe,de),Do(Ce,qe,de.state),pi(Ce,qe,de,!1,!0);var mt=de.shader.progVar.append(Ce,qe);if(qe(Ce.shared.gl,".useProgram(",mt,".program);"),de.shader.program)Ii(Ce,qe,de,de.shader.program);else{qe(Ce.shared.vao,".setVAO(null);");var bt=Ce.global.def("{}"),et=qe.def(mt,".id"),Ke=qe.def(bt,"[",et,"]");qe(Ce.cond(Ke).then(Ke,".call(this,a0);").else(Ke,"=",bt,"[",et,"]=",Ce.link(function(Je){return _i(Ii,Ce,de,Je,1)}),"(",mt,");",Ke,".call(this,a0);"))}Object.keys(de.state).length>0&&qe(Ce.shared.current,".dirty=true;")}function Ks(Ce,de,qe,mt){Ce.batchId="a1",$a(Ce,de);function bt(){return!0}jo(Ce,de,qe,mt.attributes,bt),Wi(Ce,de,qe,mt.uniforms,bt),Un(Ce,de,de,qe)}function Cl(Ce,de,qe,mt){$a(Ce,de);var bt=qe.contextDep,et=de.def(),Ke="a0",Je="a1",Ae=de.def();Ce.shared.props=Ae,Ce.batchId=et;var $e=Ce.scope(),Ee=Ce.scope();de($e.entry,"for(",et,"=0;",et,"<",Je,";++",et,"){",Ae,"=",Ke,"[",et,"];",Ee,"}",$e.exit);function vt(Tn){return Tn.contextDep&&bt||Tn.propDep}function Et(Tn){return!vt(Tn)}if(qe.needsContext&&lo(Ce,Ee,qe.context),qe.needsFramebuffer&&Eo(Ce,Ee,qe.framebuffer),Do(Ce,Ee,qe.state,vt),qe.profile&&vt(qe.profile)&&pi(Ce,Ee,qe,!1,!0),mt)qe.useVAO?qe.drawVAO?vt(qe.drawVAO)?Ee(Ce.shared.vao,".setVAO(",qe.drawVAO.append(Ce,Ee),");"):$e(Ce.shared.vao,".setVAO(",qe.drawVAO.append(Ce,$e),");"):$e(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):($e(Ce.shared.vao,".setVAO(null);"),jo(Ce,$e,qe,mt.attributes,Et),jo(Ce,Ee,qe,mt.attributes,vt)),Wi(Ce,$e,qe,mt.uniforms,Et),Wi(Ce,Ee,qe,mt.uniforms,vt),Un(Ce,$e,Ee,qe);else{var or=Ce.global.def("{}"),Bt=qe.shader.progVar.append(Ce,Ee),er=Ee.def(Bt,".id"),Pr=Ee.def(or,"[",er,"]");Ee(Ce.shared.gl,".useProgram(",Bt,".program);","if(!",Pr,"){",Pr,"=",or,"[",er,"]=",Ce.link(function(Tn){return _i(Ks,Ce,qe,Tn,2)}),"(",Bt,");}",Pr,".call(this,a0[",et,"],",et,");")}}function De(Ce,de){var qe=Ce.proc("batch",2);Ce.batchId="0",$a(Ce,qe);var mt=!1,bt=!0;Object.keys(de.context).forEach(function(or){mt=mt||de.context[or].propDep}),mt||(lo(Ce,qe,de.context),bt=!1);var et=de.framebuffer,Ke=!1;et?(et.propDep?mt=Ke=!0:et.contextDep&&mt&&(Ke=!0),Ke||Eo(Ce,qe,et)):Eo(Ce,qe,null),de.state.viewport&&de.state.viewport.propDep&&(mt=!0);function Je(or){return or.contextDep&&mt||or.propDep}Io(Ce,qe,de),Do(Ce,qe,de.state,function(or){return!Je(or)}),(!de.profile||!Je(de.profile))&&pi(Ce,qe,de,!1,"a1"),de.contextDep=mt,de.needsContext=bt,de.needsFramebuffer=Ke;var Ae=de.shader.progVar;if(Ae.contextDep&&mt||Ae.propDep)Cl(Ce,qe,de,null);else{var $e=Ae.append(Ce,qe);if(qe(Ce.shared.gl,".useProgram(",$e,".program);"),de.shader.program)Cl(Ce,qe,de,de.shader.program);else{qe(Ce.shared.vao,".setVAO(null);");var Ee=Ce.global.def("{}"),vt=qe.def($e,".id"),Et=qe.def(Ee,"[",vt,"]");qe(Ce.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",Ee,"[",vt,"]=",Ce.link(function(or){return _i(Cl,Ce,de,or,2)}),"(",$e,");",Et,".call(this,a0,a1);"))}}Object.keys(de.state).length>0&&qe(Ce.shared.current,".dirty=true;")}function Ft(Ce,de){var qe=Ce.proc("scope",3);Ce.batchId="a2";var mt=Ce.shared,bt=mt.current;lo(Ce,qe,de.context),de.framebuffer&&de.framebuffer.append(Ce,qe),Dp(Object.keys(de.state)).forEach(function(Ke){var Je=de.state[Ke],Ae=Je.append(Ce,qe);za(Ae)?Ae.forEach(function($e,Ee){qe.set(Ce.next[Ke],"["+Ee+"]",$e)}):qe.set(mt.next,"."+Ke,Ae)}),pi(Ce,qe,de,!0,!0),[Pu,Mr,ko,nl,fu].forEach(function(Ke){var Je=de.draw[Ke];!Je||qe.set(mt.draw,"."+Ke,""+Je.append(Ce,qe))}),Object.keys(de.uniforms).forEach(function(Ke){var Je=de.uniforms[Ke].append(Ce,qe);Array.isArray(Je)&&(Je="["+Je.join()+"]"),qe.set(mt.uniforms,"["+Se.id(Ke)+"]",Je)}),Object.keys(de.attributes).forEach(function(Ke){var Je=de.attributes[Ke].append(Ce,qe),Ae=Ce.scopeAttrib(Ke);Object.keys(new St).forEach(function($e){qe.set(Ae,"."+$e,Je[$e])})}),de.scopeVAO&&qe.set(mt.vao,".targetVAO",de.scopeVAO.append(Ce,qe));function et(Ke){var Je=de.shader[Ke];Je&&qe.set(mt.shader,"."+Ke,Je.append(Ce,qe))}et(eo),et(xs),Object.keys(de.state).length>0&&(qe(bt,".dirty=true;"),qe.exit(bt,".dirty=true;")),qe("a1(",Ce.shared.context,",a0,",Ce.batchId,");")}function Rt(Ce){if(!(typeof Ce!="object"||za(Ce))){for(var de=Object.keys(Ce),qe=0;qe<de.length;++qe)if(_n.isDynamic(Ce[de[qe]]))return!0;return!1}}function vn(Ce,de,qe){var mt=de.static[qe];if(!mt||!Rt(mt))return;var bt=Ce.global,et=Object.keys(mt),Ke=!1,Je=!1,Ae=!1,$e=Ce.global.def("{}");et.forEach(function(vt){var Et=mt[vt];if(_n.isDynamic(Et)){typeof Et=="function"&&(Et=mt[vt]=_n.unbox(Et));var or=ws(Et,null);Ke=Ke||or.thisDep,Ae=Ae||or.propDep,Je=Je||or.contextDep}else{switch(bt($e,".",vt,"="),typeof Et){case"number":bt(Et);break;case"string":bt('"',Et,'"');break;case"object":Array.isArray(Et)&&bt("[",Et.join(),"]");break;default:bt(Ce.link(Et));break}bt(";")}});function Ee(vt,Et){et.forEach(function(or){var Bt=mt[or];if(!!_n.isDynamic(Bt)){var er=vt.invoke(Et,Bt);Et($e,".",or,"=",er,";")}})}de.dynamic[qe]=new _n.DynamicVariable(ai,{thisDep:Ke,contextDep:Je,propDep:Ae,ref:$e,append:Ee}),delete de.static[qe]}function xi(Ce,de,qe,mt,bt){var et=Gn();et.stats=et.link(bt),Object.keys(de.static).forEach(function(Je){vn(et,de,Je)}),hh.forEach(function(Je){vn(et,Ce,Je)});var Ke=Wa(Ce,de,qe,mt,et);return Va(et,Ke),Ft(et,Ke),De(et,Ke),N(et.compile(),{destroy:function(){Ke.shader.program.destroy()}})}return{next:sn,current:vr,procs:function(){var Ce=Gn(),de=Ce.proc("poll"),qe=Ce.proc("refresh"),mt=Ce.block();de(mt),qe(mt);var bt=Ce.shared,et=bt.gl,Ke=bt.next,Je=bt.current;mt(Je,".dirty=false;"),Eo(Ce,de),Eo(Ce,qe,null,!0);var Ae;Tr&&(Ae=Ce.link(Tr)),ke.oes_vertex_array_object&&qe(Ce.link(ke.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var $e=0;$e<zt.maxAttributes;++$e){var Ee=qe.def(bt.attributes,"[",$e,"]"),vt=Ce.cond(Ee,".buffer");vt.then(et,".enableVertexAttribArray(",$e,");",et,".bindBuffer(",il,",",Ee,".buffer.buffer);",et,".vertexAttribPointer(",$e,",",Ee,".size,",Ee,".type,",Ee,".normalized,",Ee,".stride,",Ee,".offset);").else(et,".disableVertexAttribArray(",$e,");",et,".vertexAttrib4f(",$e,",",Ee,".x,",Ee,".y,",Ee,".z,",Ee,".w);",Ee,".buffer=null;"),qe(vt),Tr&&qe(Ae,".vertexAttribDivisorANGLE(",$e,",",Ee,".divisor);")}return qe(Ce.shared.vao,".currentVAO=null;",Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"),Object.keys(Zr).forEach(function(Et){var or=Zr[Et],Bt=mt.def(Ke,".",Et),er=Ce.block();er("if(",Bt,"){",et,".enable(",or,")}else{",et,".disable(",or,")}",Je,".",Et,"=",Bt,";"),qe(er),de("if(",Bt,"!==",Je,".",Et,"){",er,"}")}),Object.keys(pr).forEach(function(Et){var or=pr[Et],Bt=vr[Et],er,Pr,Tn=Ce.block();if(Tn(et,".",or,"("),za(Bt)){var Qn=Bt.length;er=Ce.global.def(Ke,".",Et),Pr=Ce.global.def(Je,".",Et),Tn(X(Qn,function(gn){return er+"["+gn+"]"}),");",X(Qn,function(gn){return Pr+"["+gn+"]="+er+"["+gn+"];"}).join("")),de("if(",X(Qn,function(gn){return er+"["+gn+"]!=="+Pr+"["+gn+"]"}).join("||"),"){",Tn,"}")}else er=mt.def(Ke,".",Et),Pr=mt.def(Je,".",Et),Tn(er,");",Je,".",Et,"=",er,";"),de("if(",er,"!==",Pr,"){",Tn,"}");qe(Tn)}),Ce.compile()}(),compile:xi}}function kd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var bh=34918,rs=34919,Op=35007,Ff=function(B,Se){if(!Se.ext_disjoint_timer_query)return null;var ke=[];function zt(){return ke.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function sr(Tr){ke.push(Tr)}var Dt=[];function Xt(Tr){var Kr=zt();Se.ext_disjoint_timer_query.beginQueryEXT(Op,Kr),Dt.push(Kr),Er(Dt.length-1,Dt.length,Tr)}function kr(){Se.ext_disjoint_timer_query.endQueryEXT(Op)}function Ir(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Or=[];function Cr(){return Or.pop()||new Ir}function zr(Tr){Or.push(Tr)}var Xr=[];function Er(Tr,Kr,vr){var sn=Cr();sn.startQueryIndex=Tr,sn.endQueryIndex=Kr,sn.sum=0,sn.stats=vr,Xr.push(sn)}var Vr=[],St=[];function Vt(){var Tr,Kr,vr=Dt.length;if(vr!==0){St.length=Math.max(St.length,vr+1),Vr.length=Math.max(Vr.length,vr+1),Vr[0]=0,St[0]=0;var sn=0;for(Tr=0,Kr=0;Kr<Dt.length;++Kr){var yr=Dt[Kr];Se.ext_disjoint_timer_query.getQueryObjectEXT(yr,rs)?(sn+=Se.ext_disjoint_timer_query.getQueryObjectEXT(yr,bh),sr(yr)):Dt[Tr++]=yr,Vr[Kr+1]=sn,St[Kr+1]=Tr}for(Dt.length=Tr,Tr=0,Kr=0;Kr<Xr.length;++Kr){var Zr=Xr[Kr],pr=Zr.startQueryIndex,Ur=Zr.endQueryIndex;Zr.sum+=Vr[Ur]-Vr[pr];var Nt=St[pr],Fn=St[Ur];Fn===Nt?(Zr.stats.gpuTime+=Zr.sum/1e6,zr(Zr)):(Zr.startQueryIndex=Nt,Zr.endQueryIndex=Fn,Xr[Tr++]=Zr)}Xr.length=Tr}}return{beginQuery:Xt,endQuery:kr,pushScopeStats:Er,update:Vt,getNumPendingQueries:function(){return Dt.length},clear:function(){ke.push.apply(ke,Dt);for(var Tr=0;Tr<ke.length;Tr++)Se.ext_disjoint_timer_query.deleteQueryEXT(ke[Tr]);Dt.length=0,ke.length=0},restore:function(){Dt.length=0,ke.length=0}}},Sh=16384,Id=256,Fp=1024,Pd=34962,Bp="webglcontextlost",zp="webglcontextrestored",Jh=1,Ld=2,Rd=3;function of(B,Se){for(var ke=0;ke<B.length;++ke)if(B[ke]===Se)return ke;return-1}function Np(B){var Se=Ki(B);if(!Se)return null;var ke=Se.gl,zt=ke.getContextAttributes(),sr=ke.isContextLost(),Dt=G(ke,Se);if(!Dt)return null;var Xt=wn(),kr=kd(),Ir=Dt.extensions,Or=Ff(ke,Ir),Cr=xn(),zr=ke.drawingBufferWidth,Xr=ke.drawingBufferHeight,Er={tick:0,time:0,viewportWidth:zr,viewportHeight:Xr,framebufferWidth:zr,framebufferHeight:Xr,drawingBufferWidth:zr,drawingBufferHeight:Xr,pixelRatio:Se.pixelRatio},Vr={},St={elements:null,primitive:4,count:-1,offset:0,instances:-1},Vt=Ea(ke,Ir),Tr=yf(ke,kr,Se,vr),Kr=ve(ke,Ir,Vt,kr,Tr);function vr(Un){return Kr.destroyBuffer(Un)}var sn=Us(ke,Ir,Tr,kr),yr=Pe(ke,Xt,kr,Se),Zr=su(ke,Ir,Vt,function(){Nt.procs.poll()},Er,kr,Se),pr=Ps(ke,Ir,Vt,kr,Se),Ur=I(ke,Ir,Vt,Zr,pr,kr),Nt=Md(ke,Xt,Ir,Vt,Tr,sn,Zr,Ur,Vr,Kr,yr,St,Er,Or,Se),Fn=Zt(ke,Ur,Nt.procs.poll,Er,zt,Ir,Vt),Ne=Nt.next,gr=ke.canvas,cr=[],Gn=[],Zn=[],Sn=[Se.onDestroy],hi=null;function ni(){if(cr.length===0){Or&&Or.update(),hi=null;return}hi=Cn.next(ni),Do();for(var Un=cr.length-1;Un>=0;--Un){var _i=cr[Un];_i&&_i(Er,null,0)}ke.flush(),Or&&Or.update()}function vi(){!hi&&cr.length>0&&(hi=Cn.next(ni))}function Fi(){hi&&(Cn.cancel(ni),hi=null)}function Ua(Un){Un.preventDefault(),sr=!0,Fi(),Gn.forEach(function(_i){_i()})}function wo(Un){ke.getError(),sr=!1,Dt.restore(),yr.restore(),Tr.restore(),Zr.restore(),pr.restore(),Ur.restore(),Kr.restore(),Or&&Or.restore(),Nt.procs.refresh(),vi(),Zn.forEach(function(_i){_i()})}gr&&(gr.addEventListener(Bp,Ua,!1),gr.addEventListener(zp,wo,!1));function Si(){cr.length=0,Fi(),gr&&(gr.removeEventListener(Bp,Ua),gr.removeEventListener(zp,wo)),yr.clear(),Ur.clear(),pr.clear(),Zr.clear(),sn.clear(),Tr.clear(),Kr.clear(),Or&&Or.clear(),Sn.forEach(function(Un){Un()})}function ba(Un){L(!!Un,"invalid args to regl({...})"),L.type(Un,"object","invalid args to regl({...})");function _i(bt){var et=N({},bt);delete et.uniforms,delete et.attributes,delete et.context,delete et.vao,"stencil"in et&&et.stencil.op&&(et.stencil.opBack=et.stencil.opFront=et.stencil.op,delete et.stencil.op);function Ke(Je){if(Je in et){var Ae=et[Je];delete et[Je],Object.keys(Ae).forEach(function($e){et[Je+"."+$e]=Ae[$e]})}}return Ke("blend"),Ke("depth"),Ke("cull"),Ke("stencil"),Ke("polygonOffset"),Ke("scissor"),Ke("sample"),"vao"in bt&&(et.vao=bt.vao),et}function Ii(bt,et){var Ke={},Je={};return Object.keys(bt).forEach(function(Ae){var $e=bt[Ae];if(_n.isDynamic($e)){Je[Ae]=_n.unbox($e,Ae);return}else if(et&&Array.isArray($e)){for(var Ee=0;Ee<$e.length;++Ee)if(_n.isDynamic($e[Ee])){Je[Ae]=_n.unbox($e,Ae);return}}Ke[Ae]=$e}),{dynamic:Je,static:Ke}}var Va=Ii(Un.context||{},!0),Ks=Ii(Un.uniforms||{},!0),Cl=Ii(Un.attributes||{},!1),De=Ii(_i(Un),!1),Ft={gpuTime:0,cpuTime:0,count:0},Rt=Nt.compile(De,Cl,Ks,Va,Ft),vn=Rt.draw,xi=Rt.batch,Ce=Rt.scope,de=[];function qe(bt){for(;de.length<bt;)de.push(null);return de}function mt(bt,et){var Ke;if(sr&&L.raise("context lost"),typeof bt=="function")return Ce.call(this,null,bt,0);if(typeof et=="function")if(typeof bt=="number")for(Ke=0;Ke<bt;++Ke)Ce.call(this,null,et,Ke);else if(Array.isArray(bt))for(Ke=0;Ke<bt.length;++Ke)Ce.call(this,bt[Ke],et,Ke);else return Ce.call(this,bt,et,0);else if(typeof bt=="number"){if(bt>0)return xi.call(this,qe(bt|0),bt|0)}else if(Array.isArray(bt)){if(bt.length)return xi.call(this,bt,bt.length)}else return vn.call(this,bt)}return N(mt,{stats:Ft,destroy:function(){Rt.destroy()}})}var ua=Ur.setFBO=ba({framebuffer:_n.define.call(null,Jh,"framebuffer")});function Wa(Un,_i){var Ii=0;Nt.procs.poll();var Va=_i.color;Va&&(ke.clearColor(+Va[0]||0,+Va[1]||0,+Va[2]||0,+Va[3]||0),Ii|=Sh),"depth"in _i&&(ke.clearDepth(+_i.depth),Ii|=Id),"stencil"in _i&&(ke.clearStencil(_i.stencil|0),Ii|=Fp),L(!!Ii,"called regl.clear with no buffer specified"),ke.clear(Ii)}function lo(Un){if(L(typeof Un=="object"&&Un,"regl.clear() takes an object as input"),"framebuffer"in Un)if(Un.framebuffer&&Un.framebuffer_reglType==="framebufferCube")for(var _i=0;_i<6;++_i)ua(N({framebuffer:Un.framebuffer.faces[_i]},Un),Wa);else ua(Un,Wa);else Wa(null,Un)}function Eo(Un){L.type(Un,"function","regl.frame() callback must be a function"),cr.push(Un);function _i(){var Ii=of(cr,Un);L(Ii>=0,"cannot cancel a frame twice");function Va(){var Ks=of(cr,Va);cr[Ks]=cr[cr.length-1],cr.length-=1,cr.length<=0&&Fi()}cr[Ii]=Va}return vi(),{cancel:_i}}function Io(){var Un=Ne.viewport,_i=Ne.scissor_box;Un[0]=Un[1]=_i[0]=_i[1]=0,Er.viewportWidth=Er.framebufferWidth=Er.drawingBufferWidth=Un[2]=_i[2]=ke.drawingBufferWidth,Er.viewportHeight=Er.framebufferHeight=Er.drawingBufferHeight=Un[3]=_i[3]=ke.drawingBufferHeight}function Do(){Er.tick+=1,Er.time=pi(),Io(),Nt.procs.poll()}function $a(){Zr.refresh(),Io(),Nt.procs.refresh(),Or&&Or.update()}function pi(){return(xn()-Cr)/1e3}$a();function jo(Un,_i){L.type(_i,"function","listener callback must be a function");var Ii;switch(Un){case"frame":return Eo(_i);case"lost":Ii=Gn;break;case"restore":Ii=Zn;break;case"destroy":Ii=Sn;break;default:L.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ii.push(_i),{cancel:function(){for(var Va=0;Va<Ii.length;++Va)if(Ii[Va]===_i){Ii[Va]=Ii[Ii.length-1],Ii.pop();return}}}}var Wi=N(ba,{clear:lo,prop:_n.define.bind(null,Jh),context:_n.define.bind(null,Ld),this:_n.define.bind(null,Rd),draw:ba({}),buffer:function(Un){return Tr.create(Un,Pd,!1,!1)},elements:function(Un){return sn.create(Un,!1)},texture:Zr.create2D,cube:Zr.createCube,renderbuffer:pr.create,framebuffer:Ur.create,framebufferCube:Ur.createCube,vao:Kr.createVAO,attributes:zt,frame:Eo,on:jo,limits:Vt,hasExtension:function(Un){return Vt.extensions.indexOf(Un.toLowerCase())>=0},read:Fn,destroy:Si,_gl:ke,_refresh:$a,poll:function(){Do(),Or&&Or.update()},now:pi,stats:kr});return Se.onDone(null,Wi),Wi}return Np})},69848:function(Sr){(function(Q,N){Sr.exports=N()})(this,function(){"use strict";function Q(_t,at,Ot,ft,Kt,xr){if(!(Kt-ft<=Ot)){var Y=ft+Kt>>1;N(_t,at,Y,ft,Kt,xr%2),Q(_t,at,Ot,ft,Y-1,xr+1),Q(_t,at,Ot,Y+1,Kt,xr+1)}}function N(_t,at,Ot,ft,Kt,xr){for(;Kt>ft;){if(Kt-ft>600){var Y=Kt-ft+1,Le=Ot-ft+1,O=Math.log(Y),Me=.5*Math.exp(2*O/3),we=.5*Math.sqrt(O*Me*(Y-Me)/Y)*(Le-Y/2<0?-1:1),ut=Math.max(ft,Math.floor(Ot-Le*Me/Y+we)),yt=Math.min(Kt,Math.floor(Ot+(Y-Le)*Me/Y+we));N(_t,at,Ot,ut,yt,xr)}var xt=at[2*Ot+xr],jt=ft,nr=Kt;for(_e(_t,at,ft,Ot),at[2*Kt+xr]>xt&&_e(_t,at,ft,Kt);jt<nr;){for(_e(_t,at,jt,nr),jt++,nr--;at[2*jt+xr]<xt;)jt++;for(;at[2*nr+xr]>xt;)nr--}at[2*ft+xr]===xt?_e(_t,at,ft,nr):(nr++,_e(_t,at,nr,Kt)),nr<=Ot&&(ft=nr+1),Ot<=nr&&(Kt=nr-1)}}function _e(_t,at,Ot,ft){J(_t,Ot,ft),J(at,2*Ot,2*ft),J(at,2*Ot+1,2*ft+1)}function J(_t,at,Ot){var ft=_t[at];_t[at]=_t[Ot],_t[Ot]=ft}function y(_t,at,Ot,ft,Kt,xr,Y){for(var Le=[0,_t.length-1,0],O=[],Me,we;Le.length;){var ut=Le.pop(),yt=Le.pop(),xt=Le.pop();if(yt-xt<=Y){for(var jt=xt;jt<=yt;jt++)Me=at[2*jt],we=at[2*jt+1],Me>=Ot&&Me<=Kt&&we>=ft&&we<=xr&&O.push(_t[jt]);continue}var nr=Math.floor((xt+yt)/2);Me=at[2*nr],we=at[2*nr+1],Me>=Ot&&Me<=Kt&&we>=ft&&we<=xr&&O.push(_t[nr]);var en=(ut+1)%2;(ut===0?Ot<=Me:ft<=we)&&(Le.push(xt),Le.push(nr-1),Le.push(en)),(ut===0?Kt>=Me:xr>=we)&&(Le.push(nr+1),Le.push(yt),Le.push(en))}return O}function oe(_t,at,Ot,ft,Kt,xr){for(var Y=[0,_t.length-1,0],Le=[],O=Kt*Kt;Y.length;){var Me=Y.pop(),we=Y.pop(),ut=Y.pop();if(we-ut<=xr){for(var yt=ut;yt<=we;yt++)V(at[2*yt],at[2*yt+1],Ot,ft)<=O&&Le.push(_t[yt]);continue}var xt=Math.floor((ut+we)/2),jt=at[2*xt],nr=at[2*xt+1];V(jt,nr,Ot,ft)<=O&&Le.push(_t[xt]);var en=(Me+1)%2;(Me===0?Ot-Kt<=jt:ft-Kt<=nr)&&(Y.push(ut),Y.push(xt-1),Y.push(en)),(Me===0?Ot+Kt>=jt:ft+Kt>=nr)&&(Y.push(xt+1),Y.push(we),Y.push(en))}return Le}function V(_t,at,Ot,ft){var Kt=_t-Ot,xr=at-ft;return Kt*Kt+xr*xr}var ce=function(_t){return _t[0]},ie=function(_t){return _t[1]},We=function(at,Ot,ft,Kt,xr){Ot===void 0&&(Ot=ce),ft===void 0&&(ft=ie),Kt===void 0&&(Kt=64),xr===void 0&&(xr=Float64Array),this.nodeSize=Kt,this.points=at;for(var Y=at.length<65536?Uint16Array:Uint32Array,Le=this.ids=new Y(at.length),O=this.coords=new xr(at.length*2),Me=0;Me<at.length;Me++)Le[Me]=Me,O[2*Me]=Ot(at[Me]),O[2*Me+1]=ft(at[Me]);Q(Le,O,Kt,0,Le.length-1,0)};We.prototype.range=function(at,Ot,ft,Kt){return y(this.ids,this.coords,at,Ot,ft,Kt,this.nodeSize)},We.prototype.within=function(at,Ot,ft){return oe(this.ids,this.coords,at,Ot,ft,this.nodeSize)};var ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(_t){return _t}},He=Math.fround||function(_t){return function(at){return _t[0]=+at,_t[0]}}(new Float32Array(1)),nt=function(at){this.options=Br(Object.create(ae),at),this.trees=new Array(this.options.maxZoom+1)};nt.prototype.load=function(at){var Ot=this.options,ft=Ot.log,Kt=Ot.minZoom,xr=Ot.maxZoom,Y=Ot.nodeSize;ft&&console.time("total time");var Le="prepare "+at.length+" points";ft&&console.time(Le),this.points=at;for(var O=[],Me=0;Me<at.length;Me++)!at[Me].geometry||O.push(It(at[Me],Me));this.trees[xr+1]=new We(O,dr,lr,Y,Float32Array),ft&&console.timeEnd(Le);for(var we=xr;we>=Kt;we--){var ut=+Date.now();O=this._cluster(O,we),this.trees[we]=new We(O,dr,lr,Y,Float32Array),ft&&console.log("z%d: %d clusters in %dms",we,O.length,+Date.now()-ut)}return ft&&console.timeEnd("total time"),this},nt.prototype.getClusters=function(at,Ot){var ft=((at[0]+180)%360+360)%360-180,Kt=Math.max(-90,Math.min(90,at[1])),xr=at[2]===180?180:((at[2]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,at[3]));if(at[2]-at[0]>=360)ft=-180,xr=180;else if(ft>xr){var Le=this.getClusters([ft,Kt,180,Y],Ot),O=this.getClusters([-180,Kt,xr,Y],Ot);return Le.concat(O)}for(var Me=this.trees[this._limitZoom(Ot)],we=Me.range(ir(ft),rr(Y),ir(xr),rr(Kt)),ut=[],yt=0,xt=we;yt<xt.length;yt+=1){var jt=xt[yt],nr=Me.points[jt];ut.push(nr.numPoints?tr(nr):this.points[nr.index])}return ut},nt.prototype.getChildren=function(at){var Ot=this._getOriginId(at),ft=this._getOriginZoom(at),Kt="No cluster with the specified id.",xr=this.trees[ft];if(!xr)throw new Error(Kt);var Y=xr.points[Ot];if(!Y)throw new Error(Kt);for(var Le=this.options.radius/(this.options.extent*Math.pow(2,ft-1)),O=xr.within(Y.x,Y.y,Le),Me=[],we=0,ut=O;we<ut.length;we+=1){var yt=ut[we],xt=xr.points[yt];xt.parentId===at&&Me.push(xt.numPoints?tr(xt):this.points[xt.index])}if(Me.length===0)throw new Error(Kt);return Me},nt.prototype.getLeaves=function(at,Ot,ft){Ot=Ot||10,ft=ft||0;var Kt=[];return this._appendLeaves(Kt,at,Ot,ft,0),Kt},nt.prototype.getTile=function(at,Ot,ft){var Kt=this.trees[this._limitZoom(at)],xr=Math.pow(2,at),Y=this.options,Le=Y.extent,O=Y.radius,Me=O/Le,we=(ft-Me)/xr,ut=(ft+1+Me)/xr,yt={features:[]};return this._addTileFeatures(Kt.range((Ot-Me)/xr,we,(Ot+1+Me)/xr,ut),Kt.points,Ot,ft,xr,yt),Ot===0&&this._addTileFeatures(Kt.range(1-Me/xr,we,1,ut),Kt.points,xr,ft,xr,yt),Ot===xr-1&&this._addTileFeatures(Kt.range(0,we,Me/xr,ut),Kt.points,-1,ft,xr,yt),yt.features.length?yt:null},nt.prototype.getClusterExpansionZoom=function(at){for(var Ot=this._getOriginZoom(at)-1;Ot<=this.options.maxZoom;){var ft=this.getChildren(at);if(Ot++,ft.length!==1)break;at=ft[0].properties.cluster_id}return Ot},nt.prototype._appendLeaves=function(at,Ot,ft,Kt,xr){for(var Y=this.getChildren(Ot),Le=0,O=Y;Le<O.length;Le+=1){var Me=O[Le],we=Me.properties;if(we&&we.cluster?xr+we.point_count<=Kt?xr+=we.point_count:xr=this._appendLeaves(at,we.cluster_id,ft,Kt,xr):xr<Kt?xr++:at.push(Me),at.length===ft)break}return xr},nt.prototype._addTileFeatures=function(at,Ot,ft,Kt,xr,Y){for(var Le=0,O=at;Le<O.length;Le+=1){var Me=O[Le],we=Ot[Me],ut=we.numPoints,yt=void 0,xt=void 0,jt=void 0;if(ut)yt=qt(we),xt=we.x,jt=we.y;else{var nr=this.points[we.index];yt=nr.properties,xt=ir(nr.geometry.coordinates[0]),jt=rr(nr.geometry.coordinates[1])}var en={type:1,geometry:[[Math.round(this.options.extent*(xt*xr-ft)),Math.round(this.options.extent*(jt*xr-Kt))]],tags:yt},Lr=void 0;ut?Lr=we.id:this.options.generateId?Lr=we.index:this.points[we.index].id&&(Lr=this.points[we.index].id),Lr!==void 0&&(en.id=Lr),Y.features.push(en)}},nt.prototype._limitZoom=function(at){return Math.max(this.options.minZoom,Math.min(Math.floor(+at),this.options.maxZoom+1))},nt.prototype._cluster=function(at,Ot){for(var ft=[],Kt=this.options,xr=Kt.radius,Y=Kt.extent,Le=Kt.reduce,O=Kt.minPoints,Me=xr/(Y*Math.pow(2,Ot)),we=0;we<at.length;we++){var ut=at[we];if(!(ut.zoom<=Ot)){ut.zoom=Ot;for(var yt=this.trees[Ot+1],xt=yt.within(ut.x,ut.y,Me),jt=ut.numPoints||1,nr=jt,en=0,Lr=xt;en<Lr.length;en+=1){var Vn=Lr[en],rn=yt.points[Vn];rn.zoom>Ot&&(nr+=rn.numPoints||1)}if(nr>jt&&nr>=O){for(var Mn=ut.x*jt,ii=ut.y*jt,Yn=Le&&jt>1?this._map(ut,!0):null,yn=(we<<5)+(Ot+1)+this.points.length,Ai=0,Pi=xt;Ai<Pi.length;Ai+=1){var Mi=Pi[Ai],Hn=yt.points[Mi];if(!(Hn.zoom<=Ot)){Hn.zoom=Ot;var Ln=Hn.numPoints||1;Mn+=Hn.x*Ln,ii+=Hn.y*Ln,Hn.parentId=yn,Le&&(Yn||(Yn=this._map(ut,!0)),Le(Yn,this._map(Hn)))}}ut.parentId=yn,ft.push(ct(Mn/nr,ii/nr,yn,nr,Yn))}else if(ft.push(ut),nr>1)for(var vo=0,Xi=xt;vo<Xi.length;vo+=1){var Ya=Xi[vo],Mt=yt.points[Ya];Mt.zoom<=Ot||(Mt.zoom=Ot,ft.push(Mt))}}}return ft},nt.prototype._getOriginId=function(at){return at-this.points.length>>5},nt.prototype._getOriginZoom=function(at){return(at-this.points.length)%32},nt.prototype._map=function(at,Ot){if(at.numPoints)return Ot?Br({},at.properties):at.properties;var ft=this.points[at.index].properties,Kt=this.options.map(ft);return Ot&&Kt===ft?Br({},Kt):Kt};function ct(_t,at,Ot,ft,Kt){return{x:He(_t),y:He(at),zoom:Infinity,id:Ot,parentId:-1,numPoints:ft,properties:Kt}}function It(_t,at){var Ot=_t.geometry.coordinates,ft=Ot[0],Kt=Ot[1];return{x:He(ir(ft)),y:He(rr(Kt)),zoom:Infinity,index:at,parentId:-1}}function tr(_t){return{type:"Feature",id:_t.id,properties:qt(_t),geometry:{type:"Point",coordinates:[At(_t.x),gt(_t.y)]}}}function qt(_t){var at=_t.numPoints,Ot=at>=1e4?Math.round(at/1e3)+"k":at>=1e3?Math.round(at/100)/10+"k":at;return Br(Br({},_t.properties),{cluster:!0,cluster_id:_t.id,point_count:at,point_count_abbreviated:Ot})}function ir(_t){return _t/360+.5}function rr(_t){var at=Math.sin(_t*Math.PI/180),Ot=.5-.25*Math.log((1+at)/(1-at))/Math.PI;return Ot<0?0:Ot>1?1:Ot}function At(_t){return(_t-.5)*360}function gt(_t){var at=(180-_t*360)*Math.PI/180;return 360*Math.atan(Math.exp(at))/Math.PI-90}function Br(_t,at){for(var Ot in at)_t[Ot]=at[Ot];return _t}function dr(_t){return _t.x}function lr(_t){return _t.y}return nt})}}]);

//# sourceMappingURL=5011.bed5f391.async.js.map